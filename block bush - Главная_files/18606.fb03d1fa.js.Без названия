try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[18606],{332437:(t,e,i)=>{i.d(e,{b:()=>m});var n=i(331635),s=i(42107),r=i(414618),a=i(710231),o=i(861700),l=i(434518),d=i(763812),c=i(327813),p=i(144046),u=function(t){return t.OpenUrl="OpenUrl",t}({}),g=(0,d._)("_rawData");class y extends p.d{get type(){return u.OpenUrl}get key(){return u.OpenUrl}get title(){return this.rawData.title??""}get href(){return this.rawData.action?.url??null}get rawData(){return(0,l._)(this,g)[g]}constructor(t){super({onExecuted:t.onExecuted}),Object.defineProperty(this,g,{writable:!0,value:void 0}),(0,l._)(this,g)[g]=t.rawData,(0,c.Gn)(this)}}(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],y.prototype,"title",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],y.prototype,"href",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],y.prototype,"rawData",null);var h=i(53013),v=(0,d._)("_params");class _{get trackCode(){return(0,l._)(this,v)[v].rawData.track_code}get title(){return(0,l._)(this,v)[v].rawData.title}get text(){return(0,l._)(this,v)[v].rawData.text}get style(){return(0,l._)(this,v)[v].rawData.style}get button(){return(0,l._)(this,v)[v].rawData.button?this.createAction((0,l._)(this,v)[v].rawData.button):null}get image(){return(0,l._)(this,v)[v].rawData.image.length?(0,h.Z)(this.baseImageToAudioImageData((0,l._)(this,v)[v].rawData.image[0])):null}get backgroundImage(){return(0,l._)(this,v)[v].rawData.background_image.length?(0,h.Z)(this.baseImageToAudioImageData((0,l._)(this,v)[v].rawData.background_image[0])):null}createAction(t){const e=t.action?.type;return e&&"open_url"===e?new y({rawData:t,onExecuted:()=>{this.consume("link")}}):null}consume(t){(0,l._)(this,v)[v].consume(t)}baseImageToAudioImageData(t){return{sizes:[{width:t.width,height:t.height,src:t.url}]}}constructor(t){Object.defineProperty(this,v,{writable:!0,value:void 0}),this.onClose=()=>{this.consume("close")},(0,l._)(this,v)[v]=t,(0,c.Gn)(this)}}(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"trackCode",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"title",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"text",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"style",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"button",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"image",null),(0,n.Cg)([c.EW,(0,n.Sn)("design:type",void 0),(0,n.Sn)("design:paramtypes",[])],_.prototype,"backgroundImage",null);class m{async tryModal(t){const{openSpecialProjectModal:e}=this.platformConfig;if(!e)return;const i=await this.fetch(t);i&&await e(i)}async fetch(t){try{const e=await this.api.getSpecialProject({special_project_id:t});return this.create({...e,id:t})}catch(t){return null}}consume(t){try{this.api.consumeSpecialProject({special_project_id:t.id,reason:t.reason})}catch(t){throw a.v.fromUnknownError(t)}}create(t){return new _({rawData:t,consume:e=>this.consume({reason:e,id:t.id})})}constructor(t,e){this.api=t,this.platformConfig=e}}m=(0,n.Cg)([s.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===r.B?Object:r.B,void 0===o.w?Object:o.w])],m)},418859:(t,e,i)=>{i.d(e,{Q:()=>o});var n=i(221020),s=i(356035),r=i(165051),a=i(896749);const o=(0,s.P)((function({audio:t,"data-testid":e}){const i=t.authors,s=t.data.rightholderMarks,o=t.data.isBlocked,l=(0,n.Y)(a.l,{model:i,disabled:o,"data-testid":e});if(!s||s.length<1)return l;const d=s.map((t=>`[${t}]`));return(0,n.FD)(r.r,{separator:", ",children:[(0,n.Y)(r.r,{separator:"",children:d}),l]})}))},896749:(t,e,i)=>{i.d(e,{l:()=>o});var n=i(221020),s=i(356035),r=i(423654),a=i(165051);const o=(0,s.P)((function({model:t,disabled:e,...i}){const{mainList:s,featList:o,searchLink:d}=t;if(d&&s.length<1&&o.length<1){const t=e?void 0:d.href;return(0,n.Y)(r.N,{mode:"secondary",href:t,...i,children:d.title})}return(0,n.FD)(a.r,{separator:" feat. ",children:[!!s.length&&(0,n.Y)(l,{items:s,...i}),!!o.length&&(0,n.Y)(l,{items:o,...i})]})}));function l({items:t,disabled:e,...i}){return(0,n.Y)(a.r,{separator:", ",children:t.map((({title:t,href:s},a)=>(s=!e&&s?s:void 0,(0,n.Y)(r.N,{mode:"secondary",href:s,disabled:e,...i,children:t},a))))})}},768319:(t,e,i)=>{i.d(e,{b:()=>y});var n=i(331635),s=i(42107),r=i(990126),a=i(945215),o=i(194257),l=i(273193),d=i(861700),c=i(788535),p=i(161308),u=i(595432),g=i(484658);class y extends g.b{constructor(t,e,i,n,s,r,a,o){super({audioConfig:t,notifications:e,langs:i,channel:n.main,musicService:s,entityProvider:r,audioGroups:a,albumFactory:o})}}y=(0,n.Cg)([s.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===d.w?Object:d.w,void 0===c.F?Object:c.F,void 0===l.Y?Object:l.Y,void 0===p.Y?Object:p.Y,void 0===r.v?Object:r.v,void 0===a.X?Object:a.X,void 0===o.K?Object:o.K,void 0===u.K?Object:u.K])],y)},36457:(t,e,i)=>{i.d(e,{l:()=>j});var n=i(221020),s=i(356035),r=i(750778),a=i(463469),o=i(277576),l=i(705560),d=i(298096),c=i(240557),p=i(267952),u=i(933052),g=i(529028),y=i(664179),h=i(907763),v=i(191601),_=i(134857),m=i(648179),w=i(159103),f=i(848659),O=i(677251),S=i(198838),b=i(726519),P=i(340615),I=i(351435),k=i(287443);const C=Object.freeze({[k.y.Broadcast]:{idle:{20:null,24:null,48:null}},[k.y.Open]:{idle:{20:null,24:null,48:null}},[k.y.OpenSimilar]:{idle:{20:r.v,24:a.r,48:null}},[k.y.OpenUma]:{idle:{20:P.r,24:P.r,48:null}},[k.y.OpenSnippet]:{idle:{20:o.t,24:null,48:null}},[k.y.ToggleOwning]:{idle:{20:l.F,24:d.p,48:null},active:{20:c.O,24:p._,48:null}},[k.y.ToggleDislike]:{idle:{20:u.r,24:g.T,48:null},active:{20:y.p,24:h.N,48:null}},[k.y.TogglePlaying]:{idle:{20:null,24:v.K,48:_.a},active:{20:null,24:m.o,48:w.C}},[k.y.Share]:{idle:{20:f.f,24:O.T,48:null}},[k.y.OpenLyrics]:{idle:{20:null,24:S.F,48:null}},[k.y.CopyPageURL]:{idle:{20:b.V,24:null,48:null}}}),j=(0,s.P)((function({size:t=24,...e}){return(0,n.Y)(I.k,{iconMap:C,getIconFromVariant:e=>e?e[t]??null:null,...e})}))},949956:(t,e,i)=>{i.d(e,{m:()=>v});var n=i(221020),s=i(356035),r=i(705560),a=i(240557),o=i(351435),l=i(676291),d=i(287443),c=i(36457),p=i(871186);const u=Object.freeze({[l.Z.Open]:{idle:p.C}}),g=(0,s.P)((function(t){return(0,n.Y)(o.k,{...t,iconMap:u,getIconFromVariant:t=>t})}));var y=i(883928);const h=Object.freeze({[y.p.OpenPlaylistCreation]:{idle:r.F},[y.p.OpenPlaylistOwningList]:{idle:null},[y.p.TogglePlaylistOwning]:{idle:null,active:a.O}}),v=(0,s.P)((function({action:t,...e}){switch(t.type){case d.y.Open:case d.y.OpenSimilar:case d.y.OpenUma:case d.y.OpenSnippet:case d.y.Share:case d.y.ToggleDislike:case d.y.ToggleOwning:case d.y.CopyPageURL:return(0,n.Y)(c.l,{size:20,action:t,...e});case l.Z.Open:return(0,n.Y)(g,{action:t,...e});case y.p.OpenPlaylistCreation:case y.p.OpenPlaylistOwningList:case y.p.TogglePlaylistOwning:return(0,n.Y)(o.k,{...e,action:t,iconMap:h,getIconFromVariant:t=>t});default:throw new TypeError("Unsupported action icon",{cause:{action:t}})}}))},317385:(t,e,i)=>{i.d(e,{E:()=>h});var n=i(221020),s=i(356035),r=i(56188),a=i(516427),o=i(56471),l=i(799649),d=i(772812),c=i(946918),p=i(917716),u=i(391847),g=i(949956),y=i(545021);const h=(0,s.P)((function({primary:t,secondary:e,subMenu:i,onMenuShownChanged:s}){const h=(0,c.B)().getLang("audio_open_action_menu_hint");return(0,n.FD)(n.FK,{children:[t.map((t=>t?(0,n.Y)(p.M,{action:t,size:"m",noPadding:!0,hoverMode:"opacity",activeMode:"opacity",icon:(0,n.Y)(g.m,{action:t,colorMode:"secondary",disabledColorMode:"tertiary_alpha",fallback:(0,n.Y)(u.E.EmptyIcon,{})})},t.key):null)),(0,n.Y)(u.E,{trigger:"click",width:236,onShownChanged:s,sub:i,"data-testid":"MusicTrackRow_ActionSheet",main:e.map((t=>t?(0,n.Y)(u.E.Item,{action:t,keepOpen:(0,y.e)(t),icon:(0,n.Y)(g.m,{action:t,colorMode:"accent",disabledColorMode:"tertiary_alpha",fallback:(0,n.Y)(u.E.EmptyIcon,{})})},t.key):null)),children:(0,n.Y)(a.SB4,{hasHover:!1,hasActive:!1,children:(0,n.Y)(o.f,{hideWhenReferenceHidden:!0,enableInteractive:!1,description:h,children:(0,n.Y)(l.K,{noPadding:!0,draggable:"false",hoverMode:"opacity",activeMode:"opacity",label:h,children:(0,n.Y)(r.F,{className:(0,d.I)("color_icon_secondary")})})})})})]})}))},545834:(t,e,i)=>{i.d(e,{H:()=>p});var n=i(221020),s=i(356035),r=i(875717),a=i(772812),o=i(946918),l=i(391847),d=i(949956),c=i(545021);const p=(0,s.P)((function({actions:t,playlistOwning:e}){const i=(0,o.B)(),{openPlaylistCreation:s,openPlaylistOwningList:p}=t,u=[...e.toggleOwningActions,p];return(0,n.Y)(l.E.Sub,{before:(0,n.Y)(r.i,{className:(0,a.I)("color_icon_accent")}),isAdditionalLoading:e.isEnsuring,"data-testid":"MusicTrackRow_AdditionalActionSheet",main:s&&(0,n.Y)(l.E.Sub.Item,{action:s,keepOpen:(0,c.e)(s),icon:(0,n.Y)(d.m,{action:s,colorMode:"accent",disabledColorMode:"tertiary_alpha",fallback:(0,n.Y)(l.E.EmptyIcon,{})})}),additional:u.map((t=>t?(0,n.Y)(l.E.Sub.Item,{action:t,keepOpen:(0,c.e)(t),icon:(0,n.Y)(d.m,{action:t,colorMode:"accent",disabledColorMode:"tertiary_alpha",fallback:(0,n.Y)(l.E.EmptyIcon,{})})},t.key):null)),children:i.getLang("audio_add_to_playlist")})}))},740577:(t,e,i)=>{i.d(e,{q:()=>u});var n=i(221020),s=i(356035),r=i(773149),a=i(423654),o=i(165051),l=i(772812),d=i(418859),c=i(898018);const p={xs:"s",s:"s",m:"m"},u=(0,s.P)((function({track:t,size:e}){const{legalNoticeLines:i}=t,{title:s,subtitle:u}=t.data,g=t.actions.open;return(0,n.Y)(r.v,{size:p[e],"data-testid":"MusicTrackRow_Info",title:(0,n.Y)(a.N,{href:g?.href??void 0,target:g?.target,onClick:g?.onExecute,mode:"primary","data-testid":"MusicTrackRow_Title",children:(0,n.FD)(o.r,{separator:" ",children:[s,(0,n.Y)("span",{className:(0,l.I)("color_text_secondary"),children:u})]})}),subtitle:(0,n.Y)(d.Q,{audio:t,"data-testid":"MusicTrackRow_Authors"}),noticeIcon:!!i?.length&&(0,n.Y)(c.X,{lines:i})})}))},545021:(t,e,i)=>{i.d(e,{e:()=>a});var n=i(883928),s=i(287443);const r=[s.y.ToggleDislike,s.y.ToggleOwning,s.y.CopyPageURL,n.p.TogglePlaylistOwning];function a(t){return r.includes(t.type)}},883928:(t,e,i)=>{i.d(e,{p:()=>n});var n=function(t){return t.OpenPlaylistCreation="MusicTrackCell_OpenPlaylistCreation",t.OpenPlaylistOwningList="MusicTrackCell_OpenPlaylistOwningList",t.TogglePlaylistOwning="MusicTrackCell_TogglePlaylistOwning",t}({})},72452:(t,e,i)=>{i.d(e,{a:()=>r});var n=i(434518),s=(0,i(763812)._)("_provider");class r{get openPlaylistCreation(){return(0,n._)(this,s)[s].provideOpenPlaylistCreation()}get openPlaylistOwningList(){return(0,n._)(this,s)[s].provideOpenPlaylistOwningList()}constructor(t){Object.defineProperty(this,s,{writable:!0,value:void 0}),(0,n._)(this,s)[s]=t.provider}}},92874:(t,e,i)=>{i.d(e,{H:()=>w});var n=i(434518),s=i(763812),r=i(331635),a=i(327813),o=i(285732),l=i(144046);class d extends l.d{get key(){return`MusicTrackCell/${this.type}/${this.identity.fullId}`}get identity(){return this.track.identity}constructor(t){super(t),this.type=t.type,this.track=t.track,this.langs=t.langs,(0,a.Gn)(this)}}(0,r.Cg)([a.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],d.prototype,"key",null),(0,r.Cg)([a.EW,(0,r.Sn)("design:type","undefined"==typeof IMusicAudioIdentity?Object:IMusicAudioIdentity),(0,r.Sn)("design:paramtypes",[])],d.prototype,"identity",null);var c=i(883928);class p extends d{get title(){return this.langs.getLang("audio_add_to_new_pl")}execute(){(0,o._)(this.targetOwnerId,{preparedTrack:this.track.apiAudio})}constructor({targetOwnerId:t,...e}){super({...e,type:c.p.OpenPlaylistCreation}),this.targetOwnerId=t,(0,a.Gn)(this)}}(0,r.Cg)([a.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],p.prototype,"title",null),(0,r.Cg)([a.$Z,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",void 0)],p.prototype,"execute",null);var u=i(917128);class g extends d{get title(){return this.langs.getLang("audio_row_show_all_playlists")}execute(){!function({ownerId:t,trackIdentity:e},{onSaved:i}={}){(0,u.rL)("al_audio.php?act=more_playlists_add",{owner_id:t,audio_owner_id:e.ownerId,audio_id:e.id},{params:{bodyStyle:"padding: 0px",width:560},onDone(){i?.()}})}({ownerId:this.targetOwnerId,trackIdentity:this.track.identity})}constructor({targetOwnerId:t,...e}){super({...e,type:c.p.OpenPlaylistOwningList}),this.targetOwnerId=t,(0,a.Gn)(this)}}(0,r.Cg)([a.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],g.prototype,"title",null),(0,r.Cg)([a.$Z,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",void 0)],g.prototype,"execute",null);var y=(0,s._)("_playlist");class h extends d{get key(){return`${super.key}/${(0,n._)(this,y)[y].key}`}get title(){return(0,n._)(this,y)[y].data.title}get isActive(){return this.playlistAudiosEditor.has(this.identity)}get isPending(){return super.isPending||this.playlistAudiosEditor.checkToggling(this.identity)}async execute(){await this.playlistAudiosEditor.toggle(this.identity)}get playlistAudiosEditor(){return(0,n._)(this,y)[y].audiosEditor}constructor({playlist:t,...e}){super({...e,type:c.p.TogglePlaylistOwning}),Object.defineProperty(this,y,{writable:!0,value:void 0}),(0,n._)(this,y)[y]=t,(0,a.Gn)(this)}}(0,r.Cg)([a.$Z,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],h.prototype,"key",null),(0,r.Cg)([a.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],h.prototype,"title",null),(0,r.Cg)([a.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],h.prototype,"isActive",null),(0,r.Cg)([a.$Z,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],h.prototype,"isPending",null),(0,r.Cg)([a.$Z,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",Promise)],h.prototype,"execute",null),(0,r.Cg)([a.EW,(0,r.Sn)("design:type","undefined"==typeof IMusicPlaylistAudiosEditor?Object:IMusicPlaylistAudiosEditor),(0,r.Sn)("design:paramtypes",[])],h.prototype,"playlistAudiosEditor",null);var v=(0,s._)("_langs"),_=(0,s._)("_track"),m=(0,s._)("_targetOwnerId");class w{provideOpenPlaylistCreation(){return new p({langs:(0,n._)(this,v)[v],track:(0,n._)(this,_)[_],targetOwnerId:(0,n._)(this,m)[m]})}provideOpenPlaylistOwningList(){return new g({langs:(0,n._)(this,v)[v],track:(0,n._)(this,_)[_],targetOwnerId:(0,n._)(this,m)[m]})}provideTogglePlaylistOwning(t){return new h({langs:(0,n._)(this,v)[v],track:(0,n._)(this,_)[_],playlist:t})}constructor(t){Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),(0,n._)(this,v)[v]=t.langs,(0,n._)(this,_)[_]=t.track,(0,n._)(this,m)[m]=t.targetOwnerId}}},282688:(t,e,i)=>{i.d(e,{A:()=>K});var n=i(434518),s=i(763812),r=i(331635),a=i(42107),o=i(327813),l=i(432320),d=i(945215);var c=(0,s._)("_repository"),p=(0,s._)("_entityProvider"),u=(0,s._)("_entityProviderEvents"),g=(0,s._)("_context"),y=(0,s._)("_ownerId"),h=(0,s._)("_connectEntityProviderEvents"),v=(0,s._)("_disconnectEntityProviderEvents"),_=(0,s._)("_handleCreateOwningCopy"),m=(0,s._)("_handleDeleted"),w=(0,s._)("_trimAlreadyFetchedCount"),f=(0,s._)("_getUnfetchedIndexStrict");class O{get count(){return null===this._count?null:this._count-this.invalidCount}get length(){return this.items.length}get head(){const t=[];for(const e of this.items){const i=(0,n._)(this,p)[p].get(e,(0,n._)(this,g)[g]);i&&t.push(i)}return t}get hasFetchingItems(){return this._hasFetchingItems}get invalidCount(){return this.items.reduce(((t,e)=>(0,n._)(this,p)[p].get(e,(0,n._)(this,g)[g])?t:t+1),0)}init(){(0,n._)(this,h)[h]()}dispose(){(0,n._)(this,v)[v]()}async ensure(t=5){const e=(0,n._)(this,w)[w](t);if(!(e<=0))return this.fetchNext(e)}async fetchNext(t=5){if(!(t<=0||this.hasFetchingItems))try{this.markItemsFetching();const e=(0,n._)(this,f)[f](),{items:i,count:s}=await(0,n._)(this,c)[c].getPlaylists({owner_id:(0,n._)(this,y)[y],count:t,offset:e,filters:"owned"}),r=[],a=[];for(const t of i){const e=this.provideFromAPI(t);r.push(e),a.push(e.identity)}(0,o.h5)((()=>{this._count=s,this.items.push(...a),this.unmarkItemsFetching()}))}catch(t){throw this.unmarkItemsFetching(),t}}addItem(t){this.items.unshift(t)}deleteItem(t){const{items:e}=this,i=e.findIndex((e=>e.fullId===t.fullId));-1!==i&&e.slice(i,1)}markItemsFetching(){this._hasFetchingItems=!0}unmarkItemsFetching(){this._hasFetchingItems=!1}provideFromAPI(t){return(0,n._)(this,p)[p].provideFromAPI(t,(0,n._)(this,g)[g])}constructor(t){Object.defineProperty(this,h,{value:S}),Object.defineProperty(this,v,{value:b}),Object.defineProperty(this,w,{value:P}),Object.defineProperty(this,f,{value:I}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),this._count=null,this.items=[],this._hasFetchingItems=!1,(0,n._)(this,_)[_]=({target:t})=>{t.ownerId==(0,n._)(this,y)[y]&&this.addItem(t)},(0,n._)(this,m)[m]=({target:t})=>{t.ownerId==(0,n._)(this,y)[y]&&this.deleteItem(t)},(0,n._)(this,c)[c]=t.repository,(0,n._)(this,p)[p]=t.entityProvider,(0,n._)(this,g)[g]=t.context,(0,n._)(this,y)[y]=t.ownerId,(0,n._)(this,u)[u]=t.entityProvider.events.createAggregator(),(0,o.Gn)(this),(0,n._)(this,h)[h]()}}function S(){const t=(0,n._)(this,u)[u];t.on("copiedToMyMusic",(0,n._)(this,_)[_]),t.on("deleted",(0,n._)(this,m)[m])}function b(){(0,n._)(this,u)[u].dispose()}function P(t){return t<=0?t:Math.max(t-this.head.length,0)}function I(){if(null!==this.count&&this.count===this.length)throw new Error("All music playlists have already been fetched");return this.length}(0,r.Cg)([o.sH,(0,r.Sn)("design:type",Object)],O.prototype,"_count",void 0),(0,r.Cg)([o.sH,(0,r.Sn)("design:type",Array)],O.prototype,"items",void 0),(0,r.Cg)([o.sH],O.prototype,"_hasFetchingItems",void 0),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Object),(0,r.Sn)("design:paramtypes",[])],O.prototype,"count",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Number),(0,r.Sn)("design:paramtypes",[])],O.prototype,"length",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Object),(0,r.Sn)("design:paramtypes",[])],O.prototype,"head",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],O.prototype,"hasFetchingItems",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Number),(0,r.Sn)("design:paramtypes",[])],O.prototype,"invalidCount",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0]),(0,r.Sn)("design:returntype",Promise)],O.prototype,"ensure",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0]),(0,r.Sn)("design:returntype",Promise)],O.prototype,"fetchNext",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],O.prototype,"addItem",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],O.prototype,"deleteItem",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",void 0)],O.prototype,"markItemsFetching",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",void 0)],O.prototype,"unmarkItemsFetching",null);var k=(0,s._)("_lists"),C=(0,s._)("_get"),j=(0,s._)("_createListKey");let E=a.zr;class M{[E](){for(const t of(0,n._)(this,k)[k].values())t.dispose()}provide(t){return(0,n._)(this,C)[C](t)??this.createCached(t)}createCached(t){const e=new O({repository:this.repository,entityProvider:this.entityProvider,ownerId:t.ownerId,context:t.context});e.init();const i=(0,n._)(this,j)[j](t);return(0,n._)(this,k)[k].set(i,e),e}constructor(t,e){Object.defineProperty(this,C,{value:F}),Object.defineProperty(this,j,{value:Y}),Object.defineProperty(this,k,{writable:!0,value:void 0}),this.repository=t,this.entityProvider=e,(0,n._)(this,k)[k]=new Map}}function F(t){return(0,n._)(this,k)[k].get((0,n._)(this,j)[j](t))}function Y(t){return`${t.ownerId}_${t.context.ref}`}M=(0,r.Cg)([a.z8.container(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===l.J?Object:l.J,void 0===d.X?Object:d.X])],M);var T=i(768319);var A=(0,s._)("_viewModelFactory"),x=(0,s._)("_list"),D=(0,s._)("_createPlaylistViewModel");class z{get count(){return(0,n._)(this,x)[x].count}get length(){return(0,n._)(this,x)[x].length}get head(){return(0,n._)(this,x)[x].head.map((t=>(0,n._)(this,D)[D](t)))}get hasFetchingItems(){return(0,n._)(this,x)[x].hasFetchingItems}async ensure(t=5){await(0,n._)(this,x)[x].ensure(t)}constructor(t){Object.defineProperty(this,D,{value:W}),Object.defineProperty(this,A,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),(0,n._)(this,A)[A]=t.viewModelFactory,(0,n._)(this,x)[x]=t.entity,(0,o.Gn)(this)}}function W(t){return(0,n._)(this,A)[A].create({entity:t})}(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],z.prototype,"count",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],z.prototype,"length",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Object),(0,r.Sn)("design:paramtypes",[])],z.prototype,"head",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],z.prototype,"hasFetchingItems",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0]),(0,r.Sn)("design:returntype",Promise)],z.prototype,"ensure",null);class L{provide(t){const e=this.entityProvider.provide(t);return new z({entity:e,viewModelFactory:this.viewModelFactory})}constructor(t,e){this.entityProvider=t,this.viewModelFactory=e,(0,o.Gn)(this)}}(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistOwningListCreationParams?Object:IMusicPlaylistOwningListCreationParams]),(0,r.Sn)("design:returntype","undefined"==typeof IMusicPlaylistOwningListViewModel?Object:IMusicPlaylistOwningListViewModel)],L.prototype,"provide",null),L=(0,r.Cg)([a.z8.container(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===M?Object:M,void 0===T.b?Object:T.b])],L);var H=(0,s._)("_playlistList"),B=(0,s._)("_actionsProvider"),N=(0,s._)("_ensure");class R{get isEnsuring(){return!!this.ensuring}get toggleOwningActions(){return(0,n._)(this,H)[H].head.slice(0,3).map((t=>(0,n._)(this,B)[B].provideTogglePlaylistOwning(t)))}async ensure(){if(this.isEnsured)return;let{ensuring:t}=this;return t||(t=(0,n._)(this,N)[N]().finally((()=>{(0,o.h5)((()=>{this.ensuring=null}))})),this.ensuring=t),t}constructor(t){Object.defineProperty(this,N,{value:U}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),this.ensuring=null,this.isEnsured=!1,(0,n._)(this,H)[H]=t.playlistList,(0,n._)(this,B)[B]=t.actionsProvider,(0,o.Gn)(this)}}async function U(){await(0,n._)(this,H)[H].ensure(3);const t=(0,n._)(this,H)[H].head.slice(0,3).map((t=>t.ensureData()));await Promise.all(t),(0,o.h5)((()=>{this.isEnsured=!0}))}(0,r.Cg)([o.sH.ref,(0,r.Sn)("design:type",Object)],R.prototype,"ensuring",void 0),(0,r.Cg)([o.sH],R.prototype,"isEnsured",void 0),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],R.prototype,"isEnsuring",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Object),(0,r.Sn)("design:paramtypes",[])],R.prototype,"toggleOwningActions",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",Promise)],R.prototype,"ensure",null);var X=(0,s._)("_models"),$=(0,s._)("_createCached"),G=(0,s._)("_createKey");class K{provide(t){const e=(0,n._)(this,G)[G](t),i=(0,n._)(this,X)[X].get(e);return i||(0,n._)(this,$)[$](t)}constructor(t){Object.defineProperty(this,$,{value:V}),Object.defineProperty(this,G,{value:Z}),Object.defineProperty(this,X,{writable:!0,value:void 0}),this.playlistsProvider=t,(0,n._)(this,X)[X]=new o.Es}}function V(t){const e=this.playlistsProvider.provide({ownerId:t.targetOwnerId,context:{ref:null}}),i=new R({actionsProvider:t.actionsProvider,playlistList:e});return(0,n._)(this,X)[X].set((0,n._)(this,G)[G](t),i),i}function Z(t){return`${t.track.identity.fullId}_${t.targetOwnerId}`}K=(0,r.Cg)([a.z8.container(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===L?Object:L])],K)},918606:(t,e,i)=>{i.d(e,{z:()=>B});var n=i(221020),s=i(356035),r=i(42107),a=i(529088),o=i(395097),l=i(497831),d=i(423775),c=i(919549),p=i(583366),u=i(437655),g=i(772812),y=i(386383),h=i(578844);const v=({state:t="paused",onStateChange:e,size:i="s",cover:s,"aria-label":r,"data-testid":a,disabled:o,active:l,...d})=>(0,n.Y)(y.s,{size:i,src:s,overlayVisibility:"idle"!==t||l?"always":"on-hover",onOverlayClick:l?()=>{e?.(t)}:void 0,"data-testid":a,fallbackIcon:(0,n.Y)(u.r,{className:(0,g.I)("color_icon_tertiary")}),"aria-label":r,children:o||(0,n.Y)(h.S,{size:i,state:t,colorMode:"contrast",disabled:o,active:l,...d})});var _=i(5500),m=i(391796);const w={xs:"s",s:"s",m:"m"},f=(0,s.P)((function({track:t,onTogglePlaying:e,size:i,isHovering:s}){const{playback:r}=t,a=t.cover?.pickByWidth?.(48)?.src??"",o=t.data.isBlocked,l=(0,m.L)(r),d=!o&&s;return(0,n.Y)(v,{size:w[i],cover:a,state:l,disabled:o,active:d,"data-testid":"MusicTrackRow_PlaybackControls","aria-label":r.togglePlayingAction.title,onStateChange:e,frequencyBars:(0,n.Y)(_.F,{fillMode:"contrast",model:r,size:i})})}));var O=i(180329),S=i(638945),b=i(413621);const P="styles__root--TT6uy",I=(0,s.P)((function({track:t}){if(!t.data.chartInfo)return null;const e=function(t){switch(t){case"new_release":return"images/svg_icons/audio/audio_row_new_release.svg";case"no_changes":return"images/svg_icons/audio/audio_row_no_changes.svg";case"moved_up":return"images/svg_icons/audio/audio_row_moved_up.svg";case"moved_down":return"images/svg_icons/audio/audio_row_moved_down.svg";case"state_crown":return"images/svg_icons/audio/audio_row_crown.svg";default:return null}}(t.data.chartInfo.state);return(0,n.FD)(O.s,{className:P,direction:"column",align:"center",justify:"center",children:[(0,n.Y)(S.tW,{className:(0,g.I)("color_text_muted"),weight:"2",children:t.data.chartInfo.position}),!!e&&(0,n.Y)(b._,{alt:"",objectFit:"none",noBorder:!0,withTransparentBackground:!0,src:e??void 0,heightSize:14,widthSize:14})]})}));var k=i(545834),C=i(740577),j=i(317385);const E=(0,s.P)((function({track:t,size:e,...i}){const s="xs"===e,r=s?[t.actions.toggleOwning,t.actions.openUma]:[t.actions.openSnippet,t.actions.toggleDislike,t.actions.openSimilar,t.actions.toggleOwning,t.actions.openUma],a=s?[t.actions.share,t.actions.openSnippet,t.actions.toggleDislike,t.actions.openSimilar,t.album?.actions.open??null,t.actions.copyPageURL]:[t.actions.share,t.actions.toggleDislike,t.album?.actions.open??null,t.actions.copyPageURL];return(0,n.Y)(j.E,{primary:r,secondary:a,...i})}));var M=i(331635),F=i(327813),Y=i(273193),T=i(332437),A=i(72452),x=i(92874),D=i(282688);class z{get track(){return this.props.current.track}get playlistOwning(){return this.playlistOwningProvider.provide({track:this.track.data,targetOwnerId:this.track.context.targetOwnerId,actionsProvider:this.actionsProvider})}get actions(){return new A.a({provider:this.actionsProvider})}get actionsProvider(){return new x.H({track:this.track.data,langs:this.langs,targetOwnerId:this.track.context.targetOwnerId})}constructor(t,e,i,n){this.props=t,this.langs=e,this.specialProjectModalService=i,this.playlistOwningProvider=n,this.emitTogglePlayingClick=()=>{const{track:t}=this,{togglePlayingAction:e}=t.playback,{specialProjectId:i}=t.data;t.data.isBlocked||(i&&!e.isActive&&this.specialProjectModalService.tryModal(i),e.onExecute?.())},(0,F.Gn)(this)}}(0,M.Cg)([F.EW,(0,M.Sn)("design:type",void 0),(0,M.Sn)("design:paramtypes",[])],z.prototype,"track",null),(0,M.Cg)([F.EW,(0,M.Sn)("design:type","undefined"==typeof IMusicTrackCellPlaylistOwning?Object:IMusicTrackCellPlaylistOwning),(0,M.Sn)("design:paramtypes",[])],z.prototype,"playlistOwning",null),(0,M.Cg)([F.EW,(0,M.Sn)("design:type","undefined"==typeof IMusicTrackCellActions?Object:IMusicTrackCellActions),(0,M.Sn)("design:paramtypes",[])],z.prototype,"actions",null),(0,M.Cg)([F.EW,(0,M.Sn)("design:type",void 0===x.H?Object:x.H),(0,M.Sn)("design:paramtypes",[])],z.prototype,"actionsProvider",null),z=(0,M.Cg)([r.z8.transient(),(0,M.Sn)("design:type",Function),(0,M.Sn)("design:paramtypes",[void 0===r.Ji?Object:r.Ji,void 0===Y.Y?Object:Y.Y,void 0===T.b?Object:T.b,void 0===D.A?Object:D.A])],z);const{Provider:W,useModel:L}=(0,r.Qd)(z,{initInEffect:!1}),H=(0,s.P)((function(){const t=L(),{props:e,track:i,playlistOwning:s,actions:r,emitTogglePlayingClick:a}=t,{playback:u}=i,g=e.current.size??"m",y=i.data.isBlocked,h=i.data.duration,v=u.volumeInput,_=e.current["data-testid"]??"MusicTrackRow",m=e.current.noHorizontalSpacing,w=e.current.showChartInfo&&!!i.data.chartInfo;return(0,n.FD)(n.FK,{children:[(0,n.Y)(o.N,{...e.current,size:g,noHorizontalSpacing:e.current.noHorizontalSpacing,activated:u.isCurrent,disabled:y,"aria-label":u.togglePlayingAction.title,"data-testid":_,onClick:a,beforePaddingRight:w?0:12,before:({rootHovered:t})=>w?(0,n.FD)(O.s,{direction:"row",gap:10,noWrap:!0,children:[(0,n.Y)(f,{track:i,onTogglePlaying:a,size:g,isHovering:t}),(0,n.Y)(O.s.Item,{flex:"fixed",flexBasis:24,children:(0,n.Y)(I,{track:i})})]}):(0,n.Y)(f,{track:i,onTogglePlaying:a,size:g,isHovering:t}),after:!y&&(0,n.Y)(d.x,{model:u,duration:h,"data-testid":"MusicTrackRow_Duration"}),actions:y?void 0:(0,n.Y)(E,{track:i,size:g,onMenuShownChanged:e=>{e&&t.playlistOwning.ensure()},subMenu:(0,n.Y)(k.H,{actions:r,playlistOwning:s})}),footer:!y&&(0,n.Y)(c.h,{model:u,duration:h,"data-testid":"MusicTrackRow_PlayerProgressBar"}),footerAfter:!y&&v&&(0,n.Y)(p.Q,{model:v,"data-testid":"MusicTrackRow_VolumeSlider"}),children:(0,n.Y)(C.q,{track:i,size:g})}),(0,n.Y)(l.R,{audioIdentity:i.identity,audioTitle:i.data.title,audioAuthor:i.authors.single,noHorizontalSpacing:m})]})})),B=(0,a.T)((0,r.jn)(W,H),{onError:(t,{logger:e,uiDegradationLogger:i})=>{e.log(t),i.log({elementName:"music_track_cell"})}})},285732:(t,e,i)=>{i.d(e,{_:()=>r});var n=i(853821),s=i(544528);function r(t,{preparedTrack:e,onCreationDone:i}={}){const r=e?(0,s.U)(e):null;(0,n.h)(t,!1,"edit",{addAudio:r,onSavePlaylistDone:i})}}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/18606.fb03d1fa.js")}catch(t){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/18606.fb03d1fa.js",t),t}