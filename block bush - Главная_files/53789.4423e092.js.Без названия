try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[53789],{663138:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Cb:()=>showAudioClaimWarning,iB:()=>imageStatusPopup});var _web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(917128),_web_audio_player_track_showAudioRestriction__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(525423),_web_audio_player_track_drawAudio__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(13095),_shared_audio_enums__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(342443),_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(214578),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(956905),_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(799835),_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(257263),_icons_desktop__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(798991),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(888920),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(752855);function showSettingsAddressBox(){showBox("al_settings.php",{act:"address_box"},{stat:[window.jsc("web/settings.js"),"settings.css"],params:{bodyStyle:"padding: 0;",hideButtons:!0},onDone(e,{hash:t}){initSettingsAddressBox(e,t)}})}function giftsBox(e,t,i){if(!isNewUserGiftsModalEnabled())return cur.viewAsBox?cur.viewAsBox():!showBox("al_gifts.php",{act:"box",tab:i||"received",mid:e},{cache:1,stat:["gifts.css",window.jsc("web/gifts.js")]},t);ensureDIRootWebContainer().resolve(WebLayers).open("userGiftsModal",{layerParams:{userId:e.toString()},replace:!0})}function reportAd(e,t){{let i="",n=null;const o=showBox("/reports.php",{act:"report_ad_box",ad_data:t},{onDone:function(){const e=geByClass("radiobtn","ad_report");window.radioBtns.ad_report={val:0,els:e};const t=ge("ad_csrf");i=t?t.value:i,n=ge("ad_comment")},params:{width:370,onClean:()=>{delete window.radioBtns.ad_report}},stat:["reports.css"]});o.removeButtons(),o.addButton(getLang("box_send"),(s=>{ajax.post("reports.php",{act:"a_report_ad",ad_id:e,reason:window.radioBtns.ad_report.val,comment:n?n.value:"",ad_data:t,hash:i},{onDone:()=>{o.hide(),showDoneBox(getLang("reports_thanks_for_report"))},showProgress:()=>lockButton(s),hideProgress:()=>unlockButton(s)})})),o.addButton(getLang("global_cancel"),!1,"no")}}const mobilePromo=()=>showBox("al_login.php",{act:"mobile",box:1});function showAudioClaimWarning(e,t,i){const{id:n,ownerId:o,title:s}=e,r=t.id,{reason:a,original:d}=t,c={width:470};let l,h;if(e.restrictionStatus)return(0,_web_audio_player_track_showAudioRestriction__WEBPACK_IMPORTED_MODULE_0__.U)(e);"geo"===a?(l=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claimed_geo"),h=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_warning_title")):"site_rules_violation"===a?(l=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_site_rules_violation_warning"),h=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_site_rules_violation_header")):"replace"===a?(l=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claimed_replacement_available"),h=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_warning_title")):"subscription"===a?(c.hideButtons=!0,c.bodyStyle="padding: 0; border-radius: 4px;",c.width=450,h=!1,l=`\n      <div class="audio_claim_popup">\n        <div class="audio_claim_popup__title">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("global_audio_only_with_subscription_title")}</div>\n        <div class="audio_claim_popup__text">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("global_audio_only_with_subscription_text")}</div>\n        <div class="audio_claim_popup__close" onclick="curBox().hide()">${(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_2__.O)().icon}</div>\n        ${_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_3__.kc.render({appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_4__.M.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_4__.v.M,round:!0,restAttrs:{onclick:"AudioPlayer.showSubscriptionPopup()"},children:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("global_audio_only_with_subscription_btn")}).outerHTML}\n      </div>`):(l=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_warning"),h=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_warning_title")),c.title=h,l=l.replace(/\{audio\}/g,`<b>${s}</b>`),l=l.replace(/\{objection_link\}/g,`<a href="/help?act=cc_objection&claim=${r}&content=audio${o}_${n}">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_objection")}</a>`),l=l.replace(/\{delete_link\}/g,`<a onclick="deleteAudioOnClaim(${o}, ${n}); return false;">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_delete")}</a>`);const p=[c,l];let u=null;if(i&&d){const e=(0,_web_audio_player_track_drawAudio__WEBPACK_IMPORTED_MODULE_5__.drawAudio)(d,"no_extra");p[1]=l.replace(/\{original\}/g,d[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_6__.Ot.AUDIO_ITEM_INDEX_PERFORMER]+" - "+d[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_6__.Ot.AUDIO_ITEM_INDEX_TITLE])+"<br/><br/>"+e,p.push((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_replace_with_original"),(function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.UG)(u.btns.ok[0]),i((()=>u.hide()))})),c.textControls=`<a onclick="deleteAudioOnClaim(${o}, ${n}); return false;">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_1__.Xo)("audio_claim_delete_capital")}</a>`}cur.claimWarning=u=_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.NL.apply(null,p)}function sureDeleteAll(title,text,where,objectId,toId,fromId,hash,event){if(checkEvent(event))return;const box=showFastBox({title},text,getLang("global_delete"),(function(btn){ajax.post("/delete_all.php",{act:where,object_id:objectId,to_id:toId,from_id:fromId,hash,loc:nav.objLoc[0]},{onDone:function(res){if(__debugMode)eval(res);else try{eval(res)}catch(e){logEvalError(e,res)}box.hide()},showProgress:()=>lockButton(btn),hideProgress:()=>unlockButton(btn)})}),getLang("global_cancel"));return!1}function imageStatusPopup(e,t){Object.assign(t,{act:"image_status"});const i=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.rL)("special_event.php",t,{containerClass:"ImageStatusPopup__container",params:{hideButtons:!0,needShadow:!1},onFail:function(){return window.cur.imageStatusBox&&window.cur.imageStatusBox.hide(),!0},onDone:function(e,t){const{status_id:i}=t;i&&(0,_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_9__.bl)({name:"image_status",value:i,keys:["show_popup"]})}},e);i&&((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_10__.TL)(e),window.cur.imageStatusBox=i)}function showPollBox(e,{ref:t,className:i}={}){showBox("al_voting.php",{act:"get_layout",voting_id:e,for_box:!0,ref:t},{containerClass:i,params:{hideButtons:!0,width:510}})}},375780:(e,t,i)=>{function n(e){return e+.5|0}async function o(e,t=20,i=3,n=10){try{const o=await function(e){return new Promise(((t,i)=>{const n=document.createElement("canvas"),o=n.getContext("2d",{willReadFrequently:!0}),s=new Image;s.onload=()=>{var e;n.height=s.height,n.width=s.width,e=()=>{if(!o)return i("Context is null");o.drawImage(s,0,0);const e=o.getImageData(0,0,s.width,s.height);t(e.data)},"requestIdleCallback"in window?window.requestIdleCallback(e):"requestAnimationFrame"in window?window.requestAnimationFrame(e):setTimeout(e,0)},s.onerror=i,s.crossOrigin="",s.src=e}))}(e);return function(e,t,i,n){const o=4*n,d=new Map;for(let i=0;i<e.length;i+=o){const n=a(e[i],t)<<16|a(e[i+1],t)<<8|a(e[i+2],t),o=d.get(n);o?d.set(n,o+1):d.set(n,1)}return[...d.entries()].sort(s).slice(0,i).map(r)}(o,t,i,n)}catch(e){return null}}function s(e,t){return t[1]-e[1]}function r(e){return[e[0]>>16&255,e[0]>>8&255,255&e[0]]}function a(e,t){return n(e/t)*t}async function d(e){return l(e,"hex")}async function c(e){return l(e,"rgb")}async function l(e,t="hex"){try{const i=await o(e,40,20);if(null===i)return null;if("hex"===t)return function(e){const t=h(e);if(!t)return null;return i=t,`#${y(i[0])}${y(i[1])}${y(i[2])}`.toUpperCase();var i}(i);if("rgb"===t){const e=h(i);if(!e)return null;const t=e.map((e=>n(255*e)));return[t[0],t[1],t[2]]}return null}catch(e){return null}}function h(e){const t=e.map(p).filter(u).sort(m)[0];return t?function(e,t){let i=v(e);const n=v(t);let o=_(i,n),s=e;for(;o<3.57&&(s=[w(s[0]-.02,0,1),w(s[1]-.02,0,1),w(s[2]-.02,0,1)],i=v(s),o=_(i,n),1!==s[0]||1!==s[1]||1!==s[2]););return s}(function(e){const t=e[0],i=e[1],n=e[2];if(0===i){const e=255*n;return[e,e,e]}const o=n<.5?n*(1+i):n+i-n*i,s=2*n-o,r=g(s,o,t+1/3),a=g(s,o,t),d=g(s,o,t-1/3);return[r,a,d]}(t),[1,1,1]):null}function p(e){const t=e[0]/255,i=e[1]/255,n=e[2]/255,o=Math.max(t,i,n),s=Math.min(t,i,n),r=(o+s)/2;if(o===s)return[0,0,r];const a=o-s;let d=0;return o===t?d=(i-n)/a+(i<n?6:0):o===i?d=(n-t)/a+2:o===n&&(d=(t-i)/a+4),[d/6,r>.5?a/(2-o-s):a/(o+s),r]}function u(e){const t=e[1],i=e[2];return!(t<.2)&&(!(t<.3&&(i>.55||i<.35))&&(!(t<.4&&(i>.57||i<.33))&&(!(t<.5&&(i>.64||i<.31))&&(!(t<.6&&(i>.7||i<.28))&&(!(t<.7&&(i>.73||i<.21))&&(!(t<.8&&(i>.76||i<.19))&&(!(t<.9&&(i>.79||i<.17))&&!(i>.85||i<.15))))))))}function m(e,t){const i=e[1],n=e[2],o=t[1],s=t[2];return o===i?s-n:o-i}function g(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function _(e,t){return(Math.max(e,t)+.05)/(Math.min(e,t)+.05)}function v(e){return.2126*f(e[0])+.7152*f(e[1])+.0722*f(e[2])}function f(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function w(e,t,i){return Math.max(t,Math.min(i,e))}function y(e){const t=n(255*e).toString(16);return 1===t.length?`0${t}`:t}i.d(t,{Dz:()=>d,uM:()=>c})},787187:(e,t,i)=>{i.d(t,{W:()=>o,y:()=>n});const n="mini_apps_current_app",o=1},38191:(e,t,i)=>{i.d(t,{N:()=>s,w:()=>r});var n=i(860656),o=i(787187);const s=(0,n.b)(o.y,(()=>({value:null})),{version:1}),r=()=>s().value},579400:(e,t,i)=>{i.d(t,{T:()=>r});var n=i(327813),o=i(860656);class s{get videoControlsCurrentlyHandling(){return this._videoControlsCurrentlyHandling}constructor(){this._videoControlsCurrentlyHandling=!1,this.setVideoControlsCurrentlyHandling=e=>{this._videoControlsCurrentlyHandling=e},(0,n.l_)(this)}}const r=(0,o.b)("attachment-shared-legacy-state",(()=>new s),{version:0})},187131:(e,t,i)=>{i.d(t,{N:()=>r});var n=i(221020),o=i(962644);const s={root:"OnMediaAttachmentOverlay__root--62QKS"};function r({children:e,attachment:t}){return(0,n.FD)("div",{className:s.root,children:[e,!!t&&(0,n.Y)(o.h,{placement:"bottom",stretch:!0,children:t})]})}},649474:(e,t,i)=>{i.d(t,{m9:()=>r,rN:()=>a});var n=i(978350),o=i(328911),s=i(9467);const r=(e,t,i,r)=>{const a=e.video;let d="";t?.isAutoplayEnabled&&(d+=" page_video_autoplayable"),a.restriction&&(d+=" VideoRestriction"),i&&i!==n.w.SQUARE&&(d+=" page_video_croppable");let c=a.access_key,l=null;a.owner_id&&a.id&&(l=(0,o.o)({ownerId:a.owner_id,itemId:a.id}),!c&&a.album_id&&(c=(0,o.o)({ownerId:a.owner_id,itemId:a.album_id})));const h={};return(0,s.z2)("post_adblock_protection_promo")&&(h["data-post-locator"]='"'),a?.promo_post_hash&&(h["data-promo-post-hash"]=a.promo_post_hash),a?.should_stretch&&(h["data-stretch-vertical"]="1"),l&&(h["data-video"]=l),a.duration&&(h["data-duration"]=`${a.duration}`),(0,s.z2)("frontend.vkcom_video_card_view_log")&&a.track_code&&(h["data-track-code"]=a.track_code),r&&(h["data-ad-data"]=r),{"data-list":c,wrapperClassName:d,...h}},a=(e,t)=>{if(t)return t;var i;return Boolean(e.video.image?.every((e=>e.with_padding)))?void 0:e.video?.width&&e.video?.height?(i=e.video.width/e.video.height,Math.min(n.w.WIDER,Math.max(i,n.w.HIGH))):n.w.WIDER}},63441:(e,t,i)=>{function n(){return!!window.vk.id&&0!==window.vk.id}i.d(t,{m:()=>n})},634727:(e,t,i)=>{i.d(t,{X:()=>a,h:()=>r});var n=i(297520),o=i(399902),s=i(628839);const r=(e="",t,i,s,r)=>{let a=e;try{a=encodeURIComponent(encodeURI(decodeURI(e)))}catch{}return(0,o.G)((0,n.i3)(a,!0),{track_code:i??"",post:t,post_ad_data:s??"",el:r?"button":"snippet",hash:r??""},!1)};function a(e){return(0,s._N)(e,{allowAnySubdomainAsCurrent:!0})}},216951:(e,t,i)=>{i.d(t,{E:()=>r,P:()=>a});var n=i(799835),o=i(978350),s=i(9467);const r=e=>[(0,n.Xo)("global_wall_photo"),e].filter(Boolean).join(", "),a=(e,t,i)=>{const n=e/t;if(Math.abs(i-n)<.017){let e=parseFloat(n.toFixed(3));return(0,s.z2)("feed_attachemnts_fix_aspect_ratio")?Math.min(Math.max(e,o.w.HIGHER),o.w.WIDER):e<o.w.HIGH?o.w.HIGH:e}return i}},532046:(e,t,i)=>{i.d(t,{d:()=>n});const n=e=>`${e.is_board?"board_poll":"poll"}${e.owner_id}_${e.id}`},996241:(e,t,i)=>{i.d(t,{J:()=>a});var n=i(799835),o=i(928363),s=i(725308),r=i(931198);const a=(e,t,i,a,d,c,l)=>{if(!i&&!a)return;const{navigate:h,showDonutSubscribePopup:p}=c??{};let u,m;switch(i){case"banned":u="blocked";break;case"deleted":u="deleted";break;case"paid":case"protected":u="restricted";break;default:u=void 0}if(u){const g={type:u};if("protected"===i){let i;e&&s.z.isGroupId(e)?i={id:e,name:t}:e&&s.z.isUserId(e)&&(i={id:e,first_name:t});const o=e?(0,r.D)(i)??d:d;o&&(m=()=>{c?.navigate?c?.navigate(o):window.nav.go(o)},g.actionText=(0,n.Xo)("public_subscribe"))}if("paid"===i){let t;if(a?.is_donut&&"open_url"===a.placeholder?.button.action?.type){t=a.placeholder?.button.action?.url??d;const e=a.placeholder?.button.action?.away_params;if(t&&e){const i=(0,o.toQueryString)(e),n=t.includes("?")?"&":"?";t=`${t}${n}${i}`}}p&&e?m=t=>{p?.(t,e)}:h&&t?m=()=>{h(t)}:t&&(m=()=>{window.nav.go(t)}),g.actionText=a?.placeholder?.button.title}return g.text=(e=>{switch(e){case"protected":return(0,n.Xo)("pages_articles_snippet_protected");case"banned":return(0,n.Xo)("pages_articles_snippet_banned");case"paid":return(0,n.Xo)("pages_articles_donut_access_title");case"deleted":return(0,n.Xo)("pages_article_snippet_deleted_long");default:return}})(i),"paid"===i&&a?.placeholder?.text&&(g.text=a.placeholder.text),l&&"protected"===i&&(m=void 0,g.actionText=void 0),{restriction:g,onRestrictionClick:m}}}},942741:(e,t,i)=>{i.d(t,{DR:()=>m,MZ:()=>r,OF:()=>l,a:()=>_,ki:()=>g,qQ:()=>h,sb:()=>u,u5:()=>p});var n=i(9467),o=i(161933);const s="photo",r="video",a=()=>(0,n.z2)("web_posting_photo_doc_thumb_secondary");function d(e){const t=[s,r];return(0,o.HS)()&&t.push("album","market_album"),t.push("doc"),!!~t.indexOf(e.toString())}const c=([e,,t])=>"doc"===e?"editable"in t&&function(e){return e.editable&&("gif"!==e.ext&&!a()||"gif"===e.ext&&a())}(t):d(e),l=e=>e?.filter(c)??[],h=e=>0===e?.filter((e=>e[0]===s)).length;const p=(e,t,i)=>{const n=l(i),o=i.map((e=>d(e[0])?void 0:e)),s=n[e];return n.splice(e,1),n.splice(t,0,s),o.map((e=>e||n.shift()))},u=(e,t)=>l(t)[e],m=(e,t)=>{const i=u(e,t);return t.filter((e=>e!==i))},g=(e,t)=>{const[i,n]=e,o=t.findIndex((([e,t])=>e===i&&t===n));return o<0?t.push(e):t[o]=e,t},_=(e,t,i)=>{if(t)return{href:t,ariaLabel:e,isExternal:i}}},925005:(e,t,i)=>{i.d(t,{I:()=>s,N:()=>a});var n=i(209051),o=i(799835);function s(e){return"number"!=typeof e?null:a((0,n.O)(e))}const r="18+";function a(e){const t=[],{isExplicit:i,isForeignAgent:n}=e;return n?t.push(`${(0,o.Xo)("audio_legal_notice_line_foreign_agent")} ${r}`):i&&t.push(r),t.length?t:null}},692647:(e,t,i)=>{i.d(t,{o:()=>A});var n=i(221020),o=i(619483),s=i(584342),r=i(990999),a=i(518710),d=i(634164),c=i(292184),l=i(772812),h=i(370633),p=i(405697),u=i(187233),m=i(782536),g=i(409698),_=i(704399),v=i(46284);const f="HideReasonsSkeleton__reasonsWrap--nomoQ",w=({isMobile:e})=>{const t=e?24:20;return(0,n.FD)("div",{className:f,children:[(0,n.Y)(u.i,{spacing:8,children:(0,n.Y)(v.E,{height:t,width:"65%"})}),(0,n.Y)(u.i,{spacing:8,children:(0,n.Y)(v.E,{height:t,width:"45%"})}),(0,n.Y)(u.i,{spacing:8,children:(0,n.Y)(v.E,{height:t,width:"40%"})}),(0,n.Y)(u.i,{spacing:8,children:(0,n.Y)(v.E,{height:t,width:"85%"})})]})},y="FeedHideBlock__blockWrap--U8yjr",b="FeedHideBlock__resetMargin--uXn7U",C="FeedHideBlock__blockWrapMobile--NayMi",k="FeedHideBlock__actionsMaxHeight--uavT9",I="FeedHideBlock__placeholder--v64hS";var S=i(799835);const A=({title:e,subtitle:t,cancelTitle:i,onCancel:v,listActions:f,complainLabel:A,onComplainClick:P,activeBan:L,onDeleteBan:O,resetMargin:E,isMobile:x,isAd:Y,isReasonsLoading:M,isSuccessComplainSend:T,isNoIslandEnabled:R})=>{const D=M?(0,n.Y)(w,{isMobile:x}):f&&(0,n.Y)("div",{className:(0,d.$)(x&&!Y&&k),children:f.map((({Icon:e,label:t,onClick:i,testId:o})=>(0,n.Y)(c.T,{"data-testid":o,before:e?(0,n.Y)(e,{width:x?28:20,className:(0,l.I)("color_icon_secondary")}):null,multiline:!0,minHeight:x?48:void 0,onClick:i,children:t},t)))}),B=!x||R,F=Y&&x;return(0,n.Y)(h.Y,{mode:B?"plain":"card",separator:"hide",className:(0,d.$)(y,E&&b,x&&!Y&&C),"data-testid":"feed_hide_block",children:x?(0,n.FD)(h.Y.ExpandedContent,{direction:"vertical",children:[(0,n.Y)(p.O,{icon:(0,n.Y)(o.T,{className:(0,l.I)("color_icon_accent")}),header:e,noPadding:!0,className:I,children:t}),!L&&D,!L&&!!P&&(0,n.Y)(c.T,{"data-testid":"feed_hide_from_feed_complain",before:(0,n.Y)(s.k,{className:(0,l.I)("color_icon_negative")}),className:(0,l.I)("color_text_negative"),onClick:P,children:A}),(L&&O||v)&&(0,n.Y)(u.i,{mode:"horizontal",spacing:8,paddingTop:F?12:8,children:(0,n.FD)(m.e,{gap:"s",stretched:!0,children:[L&&!!P&&(0,n.Y)(g.$,{"data-testid":"feed_hide_from_feed_complain",appearance:"negative",mode:"secondary",size:"m",stretched:!0,onClick:P,children:A}),(0,n.Y)(g.$,{"data-testid":"feed_hide_from_feed_cancel",appearance:"neutral",size:"m",stretched:!0,onClick:L&&O?()=>O(L):v,children:i})]})})]}):(0,n.Y)(n.FK,{children:T?(0,n.Y)(c.T,{before:(0,n.Y)(r.a,{}),children:(0,S.Xo)("global_report_sent")}):(0,n.FD)(n.FK,{children:[(0,n.Y)(c.T,{before:(0,n.Y)(r.a,{}),subtitle:t,after:(L&&O||!!v)&&(0,n.Y)(g.$,{"data-testid":"feed_hide_from_feed_cancel",mode:"link",size:"s",onClick:L&&O?()=>O(L):v,children:i}),children:e}),(!!D||!!P)&&(0,n.Y)(_.F,{size:4}),!L&&D,!!P&&(0,n.Y)(c.T,{"data-testid":"feed_hide_from_feed_complain",before:(0,n.Y)(a.y,{className:(0,l.I)("color_icon_negative")}),className:(0,l.I)("color_text_negative"),onClick:P,children:A})]})})})}},853063:(e,t,i)=>{i.d(t,{B:()=>r});var n=i(815287),o=i(264454),s=i(126350);const r=({triggerOnce:e=!1,rootMargin:t,threshold:i=1,delay:r=200})=>{const[a,d]=(0,n.useState)(null),[c,l]=(0,n.useState)(!1),{top:h=0,bottom:p=0,left:u=0,right:m=0}=(0,n.useMemo)((()=>(e=>{if(!e)return{};if(!/^[-+]?\d+px [-+]?\d+px [-+]?\d+px [-+]?\d+px$/.test(e))throw new Error(`useIntersectionObserver: unsupported rootMargin format: ${e}`);const[t,i,n,o]=e.split(" ").map(parseFloat);return{top:t,right:i,bottom:n,left:o}})(t)),[t]);return(0,n.useEffect)((()=>{if(!(0,s.mc)()||!a)return;const t=new IntersectionObserver((([n])=>{const o=n.intersectionRatio>=i;l(o),e&&o&&t.disconnect()}),{threshold:i,rootMargin:`${h}px ${m}px ${p}px ${u}px`});return t.observe(a),()=>t.disconnect()}),[i,e,h,p,m,u,a]),(0,n.useEffect)((()=>{if(!(0,s.mc)()&&a&&(!c||!e)){const e=1-i,t=(0,o.n)((()=>{const t=a.getBoundingClientRect(),i=t.top+e*t.height>=-h&&t.bottom-e*t.height<=window.innerHeight+p&&t.left+e*t.width>=-u&&t.right-e*t.width<=window.innerWidth+m;l(i)}),r);return t(),document.addEventListener("scroll",t,{passive:!0,capture:!0}),()=>document.removeEventListener("scroll",t,{capture:!0})}}),[c,e,h,p,m,u,i,r,a]),[d,c]}},79447:(e,t,i)=>{function n(e,t=!0){return`${t?"data-":""}ad-stat-${e}`}i.d(t,{H:()=>n})},174928:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CY:()=>throttleLogPixelReachedValueEvent,bV:()=>logPixelEventUntyped,lO:()=>triggerAdHtmlEvent,xr:()=>sendPixelEvent});var _shared_lib_ls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(126607),_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(326107),_shared_utils_numberHashCode__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(10576),_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(976813),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(932216),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9467),_shared_feed_feed_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(554490),_attributes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(79447),_shared_pixels_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(629229),_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(831152),_shared_lib_throttle__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(264454);const SENSITIVITY_TRIGGER_EVENT_PLAYBACK_PROGRESS=.01,SENSITIVITY_TRIGGER_EVENT_REACHED_SECONDS=.3,THROTTLE_TRIGGER_EVENT_SECOND=250,LS_ADS_EVENTS="ads.events",uniqueEvents=[_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.render,_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.viewability_measurable,_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.viewability_unmeasurable,_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.viewin,_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.error],isUniqueEvent=e=>uniqueEvents.includes(e),triggerAdHtmlEvent=(el,event)=>{if(!el)return null;const statHtml=(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.WN)(el,`ad-stat-html-${event}`);if((0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.WO)(el,`ad-stat-html-${event}`),statHtml){const statElemWrap=document.createElement("div");let elem;for(statElemWrap.setAttribute("innerHTML",statHtml);elem=statElemWrap.firstChild;)if(el.appendChild(elem),"SCRIPT"===elem.tagName)try{eval(elem.innerHTML)}catch(e){(0,_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_2__.fY)(e)}}};function parsePixels(e,t){try{const t=JSON.parse(e);if(Array.isArray(t))return{pixels:t}}catch(i){if(!/^https?:\/\//.test(e))return{isInvalid:!0,pixels:[]};return{pixels:e.split("$$$").map((e=>({type:t,url:e})))}}return{pixels:[]}}const filterPixelReachedEvents=(e,t,i)=>{const n=i?.duration,o="number"==typeof i?.value&&i?.value>=0?i?.value+SENSITIVITY_TRIGGER_EVENT_REACHED_SECONDS:n&&"number"==typeof i?.pvalue&&i?.pvalue>=0?i?.pvalue*n:0,s="number"==typeof i?.pvalue&&i?.pvalue>=0?i?.pvalue+SENSITIVITY_TRIGGER_EVENT_PLAYBACK_PROGRESS:n&&o?100*o/n:0;if(o||s){const{pixelsFilter:i,pixelsRemainingFilter:n}=t.reduce(((e,t)=>(t?.pvalue&&"number"==typeof t?.pvalue&&s&&t?.pvalue<=s||t?.value&&"number"==typeof t?.value&&o&&t?.value<=o?e.pixelsFilter.push(t):e.pixelsRemainingFilter.push(t),e)),{pixelsFilter:[],pixelsRemainingFilter:[]}),r=(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.WN)(e,`ad-stat-disabled-${_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.playhead_reached_value}`);try{if(i.length>0){(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.Jn)(e,`ad-stat-${_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.playhead_reached_value}`,JSON.stringify(n));const t=r?JSON.parse(r):[];Array.isArray(t)&&Array.isArray(i)&&(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.Jn)(e,`ad-stat-disabled-${_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.playhead_reached_value}`,JSON.stringify([...t,...i]))}}catch(e){console.log(`throw Pixel event error: ${e.message}`)}return i}return[]},logPixelEvent=(e,t,i)=>{if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_3__.z2)("ads_pixels_track_new_events_web_mvk")&&(0,_shared_feed_feed_utils__WEBPACK_IMPORTED_MODULE_4__.Vb)())try{const n=(0,_shared_feed_feed_utils__WEBPACK_IMPORTED_MODULE_4__.h0)(e)??e;if(!(n instanceof HTMLElement))return;const o=(0,_attributes__WEBPACK_IMPORTED_MODULE_5__.H)(t,!1),s=(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.WN)(n,o),r=(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.WN)(n,"ad-block-uid");if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_3__.z2)("feed_ads_pixel_tracked_console_log")&&(0,_shared_pixels_utils__WEBPACK_IMPORTED_MODULE_6__.FQ)(n,t),!s)return;let{isInvalid:a,pixels:d}=parsePixels(s,t);if(a&&console.log("throw Pixel parse error"),isUniqueEvent(t)&&d.length&&((0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.Jn)(n,`ad-disabled-stat-${t}`,s),(0,_shared_feed_adblock_protection_attributes_hider__WEBPACK_IMPORTED_MODULE_1__.WO)(n,o)),r&&isUniqueEvent(t)&&d.length)try{const e=(0,_shared_utils_numberHashCode__WEBPACK_IMPORTED_MODULE_7__.J)(`${t}${r}`),i=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_8__.u.get(LS_ADS_EVENTS)||{};if(!i[e]){const t=(new Date).getTime()/1e3|0;i[e]=t,_shared_lib_ls__WEBPACK_IMPORTED_MODULE_8__.u.set(LS_ADS_EVENTS,i)}}catch(e){console.log(`throw Pixel event error: ${e.message}`)}t===_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.playhead_reached_value&&(d=filterPixelReachedEvents(n,d,i)),d.forEach((e=>{sendPixelEvent({pixel:e})})),triggerAdHtmlEvent(n,t)}catch(e){console.log(`throw Pixel event error: ${e.message}`)}},throttleLogPixelReachedValueEvent=(0,_shared_lib_throttle__WEBPACK_IMPORTED_MODULE_9__.n)(((e,t)=>{logPixelEvent(e,_shared_pixels_constants__WEBPACK_IMPORTED_MODULE_0__.d.playhead_reached_value,t)}),THROTTLE_TRIGGER_EVENT_SECOND);function sendPixelEvent({pixel:e,adEl:t}){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_3__.z2)("feed_ads_pixel_tracked_console_log")&&(0,_shared_pixels_utils__WEBPACK_IMPORTED_MODULE_6__.TF)(e.type,e,t),e.url){(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.tL)().src=e.url}}const logPixelEventUntyped=(e,...t)=>{if(e instanceof HTMLElement)return logPixelEvent(e,...t)}},629229:(e,t,i)=>{i.d(t,{FQ:()=>l,TF:()=>c});var n=i(976813),o=i(9467),s=i(831152),r=i(323018);const a=(e,t,i,n)=>{console.debug(`[ads pixels log][debug] Pixel "${e}" is touched${t?` with text "${t}"`:""}`,i,n)},d=(e,t,i)=>{a(e,"Pixel rich conditions and fired to track",t,i)},c=(e,t,i)=>{a(e,"Pixel sent",t,i)},l=(e,t,i)=>{if(i)return void d(t,void 0,e);const a=(0,o.z2)("post_adblock_protection_promo")?r.h.getInstance().lookupSelector(n.M):n.M;(e.classList.contains(a.replaceAll(".",""))||(0,s.t9)(e))&&d(t,void 0,e)}},210071:(e,t,i)=>{i.d(t,{z:()=>a});const n=(0,i(860656).b)("feed-audio-player-stats",(()=>({prevAudio:void 0})),{version:0});class o{playAudio(e,t,i,o){const{prevAudio:s}=n(),r=e.id!==s?.id;n().prevAudio=e,this.attachPlayerEventHandler({isAudioChanged:r,attachElement:this.rootElement}),this.audioPlayerAdapter.playAudio(e,t,i,o)}constructor(e,t,i){Object.getOwnPropertyNames(Object.getPrototypeOf(e)).filter((e=>!this[e])).forEach((t=>{const i=e[t];i&&(this[t]="function"==typeof i?i.bind(e):i)})),this.audioPlayerAdapter=e,this.rootElement=t,this.attachPlayerEventHandler=i}}var s=i(815287),r=i(9467);function a({getAudioPlayerAdapter:e,rootElement:t,attachPlayerEventHandler:i,loadAudioPlayer:n}){const a=()=>{const n=e();return n&&t&&(0,r.z2)("feed_open_audio_stats_for_react")?new o(n,t,i):n},[d,c]=(0,s.useState)(a);return(0,s.useEffect)((()=>{d||n((()=>c(a)))}),[]),d}},940127:(e,t,i)=>{i.d(t,{Y:()=>n});const n=e=>{const{first_name:t,last_name:i}=e;return`${t} ${i}`}},10576:(e,t,i)=>{function n(e){let t=0;if(0===e.length)return t;for(let i=0,n=e.length;i<n;i++){t=(t<<5)-t+e.charCodeAt(i),t|=0}return t}i.d(t,{J:()=>n})},234213:(e,t,i)=>{i.d(t,{U:()=>a});var n=i(964940),o=i(966675),s=i(2096),r=i(808911);const a=e=>{(0,o.u)()&&((0,s.a5)(),(window.BadgesObjectInfo?Promise.resolve():(0,r.p)((()=>Promise.all([i.e(70609),i.e(9306),i.e("langs/core_spa/BadgesObjectInfo")]).then(i.bind(i,342190)))).then((({BadgesObjectInfo:e})=>{i._dG("BadgesObjectInfo",e)}))).then((()=>window.BadgesObjectInfo.init(e))).catch((e=>{(0,n.p)("Error loading module BadgesObjectInfo",e)})).finally((()=>{(0,s.dk)()})))}},964940:(e,t,i)=>{i.d(t,{p:()=>o});var n=i(932216);const o=(e,t)=>{window.vk.dev&&console.log(t),(0,n.vV)(new Error(e),{environment:"badges"})}},966675:(e,t,i)=>{i.d(t,{u:()=>o});var n=i(9467);const o=()=>(0,n.z2)("awards")},953879:(e,t,i)=>{function n(e,t,i=null){e&&!window.vk?.isBanned&&window.stManager.add([window.jsc("web/article_layer.js"),"article.css"]).then((()=>{window.ArticleLayer.prepare(e,i,t)}))}i.d(t,{U:()=>n})},280131:(e,t,i)=>{function n(e,t,i){return t.contains(e)&&!i.contains(e)}function o(e,t){if(!t||!e)return;const i=window.cur.videoInlinePlayer;i&&n(i.el,t,e)&&(i.pause(),i.ads?.pause());const o=window.VideoYoutube?.cur?.player,s=o?.getIframe?.();o&&s&&n(s,t,e)&&o.pauseVideo()}i.d(t,{p4:()=>o})},430327:(e,t,i)=>{i.d(t,{h:()=>a,r:()=>r});var n=i(634727),o=i(953879),s=i(399902);const r=e=>{if(e.state&&"available"!==e.state||!e.view_url)return;let t=(0,s.G)(e.view_url,{subtype:"primary"});return{href:(0,n.X)(t),ariaLabel:e.title||""}},a=e=>{e.url&&(0,o.U)((0,n.X)(e.url),{})}},980333:(e,t,i)=>{i.d(t,{H:()=>o});var n=i(525423);const o=e=>{const t=e.content_restricted||Number(e.region_restrictions);t&&(0,n.U)({...e,restrictionStatus:t,actionHash:e.access_key})}},43979:(e,t,i)=>{i.d(t,{w:()=>s});var n=i(513530),o=i(452200);const s=(e,t)=>{const{ownerId:i}=(0,o.v)(t);(0,n.showVideo)(t,"",{autoplay:1,shortVideo:1,queue:1,.../^public|groups|profile$/.test(window.cur?.module)&&{spaQuery:{feedType:"ownerFeed",owner:i}},addParams:{t:e}})}},810921:(e,t,i)=>{i.d(t,{R:()=>p,w:()=>u});var n=i(328911),o=i(626853),s=i(602882),r=i(799835),a=i(422299),d=i(33556),c=i(917128),l=i(216951),h=i(9467);const p=({postId:e,photo:t,index:i,count:r,onPhotoOpen:c,onPhotoClose:p})=>{const u=(0,l.E)(t.text),m=(0,n.o)({ownerId:t.owner_id,itemId:t.id});let g="";return g=void 0!==i&&r&&1!==r?e?`wall${e}`:t.web_view_token??"":t.web_view_token??(e?`wall${e}`:""),{ariaLabel:u,href:`/photo${m}`,onClick:e=>{(0,o.T)(e),c?.();const i=(0,a.B)({photo:t})||{};window.cur&&e.target&&(window.cur.wallPostTrackCode=(0,s.J8)(e.target),window.cur.listId=g);const n=e.currentTarget,r=(0,s.h0)(n);(0,d.c)(m,g,{...i,onHide:e=>{p?.(e),(0,h.z2)("feed_redesign_v3_photoview_scroll_fix")||r&&r instanceof HTMLElement&&r.focus()},queue:1})}}},u=e=>{const t=e.restrictions;if(!t)return Promise.resolve(e);const{title:i,text:n}=t;return new Promise((t=>{let o=(0,c.NL)({title:i},n,(0,r.Xo)("photos_restriction_button_watch"),(function(){o.hide(),t(e)}),(0,r.Xo)("global_cancel"))}))}},543584:(e,t,i)=>{i.d(t,{f6:()=>u,gu:()=>l,m_:()=>h,z:()=>p});var n=i(532046),o=i(457735),s=i(296208),r=i(917128),a=i(2096),d=i(9467),c=i(575705);const l=e=>{const t=new URLSearchParams(window.location.search).get("w"),i=(0,c.j)()&&Boolean(t?.includes("wall"));i&&window.layerQueue?._layers.push(["wiki",t]),(0,o.u)({w:(0,n.d)(e)},!1,!1,{onHide:()=>{i&&window.layerQueue.pop()}})},h=e=>{(0,s.$)(null,{id:e.id,isBoard:e.is_board})},p=e=>{if((0,d.z2)("feed_spa_fix_get_poll_code")){if(e.id&&!1===e.is_board){const t={act:"export_box",is_board:e.is_board,voting_id:e.id};(0,r.rL)("al_voting.php",t,{onDone:function(){(0,a.kI)().setOptions({width:500,needShadow:!1})}})}}else window.Wall?.votingExport(null,{id:e.id,isBoard:e.is_board})};function u(){return Promise.resolve().then(i.bind(i,689998))}},398918:(e,t,i)=>{i.d(t,{DZ:()=>h,RG:()=>p,wE:()=>l});var n=i(626853),o=i(328911),s=i(809351),r=i(513530),a=i(595253),d=i(9467),c=i(932969);const l=({postId:e,video:t,restriction:i,trackCode:l})=>{const h=(0,a.X)().resolve(c.u);return{href:(0,s.f_)(t),ariaLabel:t.title,onClick:s=>{if((0,n.T)(s),!t.owner_id||!t.id)return;const a=(0,o.o)({ownerId:t.owner_id,itemId:t.id});let c=t.access_key;!c&&t.album_id&&(c=(0,o.o)({ownerId:t.owner_id,itemId:t.album_id}));const p="short_video"===t.type,u={queue:!0,addParams:{post_id:e,feed_track_code:l},hasRestriction:"restricted"===i?.type,autoplay:1,shortVideo:p?1:0};(0,d.z2)("frontend.vkcom_video_card_view_log")&&h.logClickEvent({track_code:t.track_code}),a&&(0,r.showVideo)(a,c??"",u)}}},h=({postId:e,video:t,restriction:i,trackCode:l})=>{let h=t.access_key,p=null;const u=(0,a.X)().resolve(c.u);t.owner_id&&t.id&&(p=(0,o.o)({ownerId:t.owner_id,itemId:t.id}),!h&&t.album_id&&(h=(0,o.o)({ownerId:t.owner_id,itemId:t.album_id})));const m="short_video"===t.type;return{href:(0,s.f_)(t),ariaLabel:t.title,onClick:o=>{(0,n.T)(o),p&&(h||m)&&((0,d.z2)("frontend.vkcom_video_card_view_log")&&u.logClickEvent({track_code:t.track_code}),(0,r.showInlineVideo)(p,h,{autoplay:1,hasRestriction:"restricted"===i?.type,shortVideo:m,module:window.cur&&window.cur.module||"other",addParams:{post_id:e,promo_post_hash:t?.promo_post_hash,feed_track_code:l}},o,o.currentTarget))}}},p=({clip:e})=>({onClick:()=>{if(!e.owner_id||!e.id)return;const t=(0,o.o)({ownerId:e.owner_id,itemId:e.id});(0,r.showVideo)(t,"",{autoplay:1,shortVideo:1,queue:1})}})},727341:(e,t,i)=>{i.d(t,{a:()=>S});var n=i(328911),o=i(399902),s=i(548893);var r=i(398918),a=i(379274),d=i(626853);var c=i(430327),l=i(85923),h=i(810921),p=i(701576),u=i(634727),m=function(e){return e[e.market=0]="market",e[e.uslugi=1]="uslugi",e}(m||{});var g=i(147764),_=i(928959);var v=i(873380);var f=i(9467);var w=i(347693);var y=i(543584);var b=i(97797),C=i(297520),k=i(575705);var I=i(947008);const S=e=>(t,i="grid")=>({attachment:S,index:A,count:P,onClose:L,isAds:O,trackCode:E,postAdData:x,adsLinkHash:Y})=>{const M=(0,p.Y1)(S);switch(S.type){case l.O.ALBUM:return(e=>{const t=(0,a.FD)(e);return{href:t,onClick:e=>{(0,d.T)(e),window.nav.change({z:t.replace("/","")})}}})(S.album);case l.O.ARTICLE:return(0,c.r)(S.article);case l.O.DOC:return(0,s.V$)(S.doc)?(e=>{const t=(0,s.Wz)(e),i=(0,s.jy)(e);return{href:(0,o.G)(`/doc${i}`,{hash:t}),isExternal:!0}})(S.doc):(({doc:e})=>{const t=(0,s.Wz)(e),i=(0,n.o)({ownerId:e.owner_id,itemId:e.id});return{href:(0,o.G)(`/doc${i}`,{hash:t}),isExternal:!0}})({postId:t,doc:S.doc});case l.O.PHOTO:return(0,h.R)({postId:t,photo:S.photo,index:A,count:P,onPhotoOpen:e,onPhotoClose:L});case l.O.VIDEO:return"grid"===i?(0,r.wE)({postId:t,restriction:M,video:S.video,trackCode:E}):(0,r.DZ)({postId:t,restriction:M,video:S.video,trackCode:E});case l.O.CLIP:return(0,r.RG)({clip:S.clip});case l.O.MARKET:return(e=>{const t=(0,w.d)({baseUrl:`/market${e.owner_id}`,ownerId:e.owner_id,itemId:e.id,seoSlug:e.seo_slug});return{href:t,onClick:e=>{(0,_.T)(e),window.nav.go(t)}}})(S.market);case l.O.MARKET_ALBUM:return(e=>{const t=`/${m[e.type??0]}${e.owner_id}?section=album_${e.id}`;return{href:(0,u.X)(t)}})(S.market_album);case l.O.MARKET_LINK:return{href:(F=S.market_link).url,onClick:e=>{(0,_.T)(e),window.nav.go(F.url)}};case l.O.PODCAST:{const e=S.podcast?.podcast_info?.is_donut,t=S.podcast?.podcast_info?.restriction_button?.action;return e&&t?(e=>{const t=e?.podcast_info?.restriction_button;if(t&&"open_url"===t.action?.type)return{href:t.action?.url,ariaLabel:t.title,isExternal:"internal"!==t.action?.target}})(S.podcast):(B=S.podcast,{onClick:e=>{e&&(0,_.T)(e),(0,g.I)(null,(0,n.o)({itemId:B.id,ownerId:B.owner_id}),e)}})}case l.O.AUDIO_PLAYLIST:return D=S.audio_playlist,{onClick:e=>{(0,_.T)(e),(0,v.showAudioPlaylist)(D.owner_id,D.id,D.access_key,"feed",e)}};case l.O.CURATOR:return{href:(R=S.curator).url??`/music/curator/${R.id}`};case l.O.ARTIST:return(e=>{if(e.domain||e.id)return{href:`/artist/${e.domain||e.id}`}})(S.artist);case l.O.POLL:return{onClick:e=>{(0,d.T)(e),(0,y.f6)().then((({showPollModal:e})=>{e(S.poll,{trackCode:E})}))}};case l.O.MINI_APP:return T=S.mini_app,{href:T.app?.share_url??`/app${T.app?.id}`,isExternal:!0};case l.O.DONUT_LINK:return{onClick:e=>{(0,d.T)(e),(0,b.m)(e,S.donut_link?.owner_id,window.nav?.objLoc?.source,{type:"subscribe",params:{act:"subscribe_popup"}})}};case l.O.LINK:{const e=(0,f.z2)("feed_csrf_hash_support_web")&&(0,I.Kg)(S.link.away_params?.csrf_hash)?S.link.away_params.csrf_hash:void 0;return(({link:e,postId:t,trackCode:i,postAdData:n,isAds:o=!1,adsLinkHash:s,restriction:a})=>{let d=e.url;const c=o||!(0,C.ER)(d);return n&&c&&(0,f.z2)("feed_redesign_2024_extract_links_from_promo_post_web")&&(d=function(e){return/(http(s?)):\/\//i.test(e)?e:`https://${e}`}(d)),e.video&&(0,k.y)()?{href:(0,u.h)(d,t,i,n,s),isExternal:c,onClick:(0,r.DZ)({video:e.video,trackCode:i,postId:t,restriction:a}).onClick}:{href:(0,u.h)(d,t,i,n,s),isExternal:c}})({link:S.link,postId:t,trackCode:E,isAds:O,postAdData:(0,f.z2)("feed_redesign_ad_data_secondary")?x:void 0,adsLinkHash:(0,f.z2)("feed_ads_cta_secondary_link_support_web")?Y||e:void 0,restriction:M})}case l.O.ONLINE_BOOKING:return(e=>({href:e.booking_app_url}))(S.online_booking);case l.O.MESSAGE_TO_BC:return{href:`/im?sel=${S.message_to_bc.owner_id}`};case l.O.ACTION_BUTTON:{const e=(0,f.z2)("feed_csrf_hash_support_web")&&(0,I.Kg)(S.action_button.action.away_params?.csrf_hash)?S.action_button.action.away_params.csrf_hash:void 0;return(({actionButton:e,postId:t,trackCode:i,postAdData:n,adsLinkHash:o})=>{switch(e.type){case"message_to_community":return{href:(0,u.h)(new URL(`/im?sel=${e.action.peer_id}`,location.href).href,t,i,n,o)};case"open_market":{const{action:s}=e;if(s.url)return{href:(0,u.h)(s.url,t,i,n,o)}}}})({actionButton:S.action_button,postId:t,trackCode:E,postAdData:(0,f.z2)("feed_redesign_ad_data_secondary")?x:void 0,adsLinkHash:(0,f.z2)("feed_ads_cta_secondary_link_support_web")?Y||e:void 0})}}var T,R,D,B,F}},134497:(e,t,i)=>{i.d(t,{Z:()=>s});var n=i(85923),o=i(996241);const s=e=>t=>{if(t.type===n.O.ARTICLE)return(0,o.J)(t.article.owner_id,t.article.owner_name,t.article.state,t.article.donut,t.article.url,e,!0)}},625916:(e,t,i)=>{i.d(t,{initOneTimeDonut:()=>d});var n=i(457735),o=i(993838),s=i(917128),r=i(799835);const a=51528700;function d(e,t=!0){const d=new URL(e),c=new URL(`${d.origin}${d.hash.substring(1)}`).search,l=window.boxLayerBG,h=window.boxLayerWrap;return(0,n.u)({w:`app${a}`,url_hash:c},!1,!1,{noLocChange:1,skipBoxesHide:1,queue:1,isCloseForwardPush:t,onLoaded:()=>{(0,o.OJ)((function e(){l&&h&&(l.style.visibility="visible",h.style.visibility="visible",h.style.opacity="1"),(0,o.vJ)(e)})),l&&h&&(l.style.visibility="hidden",h.style.visibility="hidden",h.style.opacity="0")},onFail:()=>{(0,s.NL)({title:(0,r.Xo)("global_error")},(0,r.Xo)("global_error_generic_reason"),(0,r.Xo)("global_close"))}}),new Promise(((e,t)=>{i._dG("VKWebAppCustomMessageExternalHandlersResolvePayment",e),i._dG("VKWebAppCustomMessageExternalHandlersRejectPayment",t)}))}i._dG("VKWebAppCustomMessageExternalHandlersResolvePayment",window.VKWebAppCustomMessageExternalHandlersResolvePayment||null),i._dG("VKWebAppCustomMessageExternalHandlersRejectPayment",window.VKWebAppCustomMessageExternalHandlersRejectPayment||null),i._dG("VKWebAppCustomMessageExternalHandlers",window.VKWebAppCustomMessageExternalHandlers||{}),window.VKWebAppCustomMessageExternalHandlers.VKWebAppDonutResult=e=>{const t=window.VKWebAppCustomMessageExternalHandlersResolvePayment,n=window.VKWebAppCustomMessageExternalHandlersRejectPayment;if(i._dG("VKWebAppCustomMessageExternalHandlersResolvePayment",null),i._dG("VKWebAppCustomMessageExternalHandlersRejectPayment",null),!t||!n)throw new Error("Payment resolver is undefined.");switch(e.status){case"success":t({requestData:e.request_data,data:e.data});break;case"processing":n();break;default:throw n(),new Error(`unexpected status: ${e.status}`)}}},347693:(e,t,i)=>{i.d(t,{d:()=>o});var n=i(946291);function o({screen:e,refSource:t,refScreen:i,itemId:o,ownerId:s,ref:r,type:a,withGroupHeader:d,seoSlug:c="",adsLabel:l}){const h=new URLSearchParams;return t&&h.set("ref_source",t),i&&h.set("ref_screen",i),r&&h.set("ref",r),e&&h.set("screen",e),l&&h.set("ads_label",l),a&&h.set("type",a),d&&h.set(n.Ln,"1"),`${window.location.origin}/market/product/${c??""}${s}-${o}${h.toString()?`?${h.toString()}`:""}`}},296208:(e,t,i)=>{i.d(t,{$:()=>d,m:()=>a});var n=i(214578),o=i(178009),s=i(405546),r=i(799835);const a=e=>{const t=(0,o.uk)("_media_voting"+e);let i=!1;return t.forEach((e=>{(0,o.nB)(e,"media_voting_locked")&&(i=!0)})),i},d=(e,t)=>{if((0,n.gW)(e))return;let d,c,l;const h=void 0!==t.id;if(h)d=t.id,c=t.isBoard;else{if(l=(0,o.Q3)("media_voting",e),null===l&&(0,s.cY)("Unable to show report voting form because there is no .media_voting element"),d=(0,o.r0)(l,"id"),a(d))return;c=(0,o.r0)(l,"board")}const p=c?"board_poll":"poll",u=()=>{if(!h&&null!==l){const e=l.querySelector("._report_voting_button");if(null==e)return void(0,s.cY)("Unable to disable report voting button, because it cannot be found");e.innerHTML=(0,r.Xo)("global_report_sent"),e.onclick=null}};Promise.resolve().then(i.bind(i,614614)).then((({showReportForm:e})=>{e(p,0,d,u)}))}},422299:(e,t,i)=>{i.d(t,{B:()=>o});const n=new Set(["w","x","y","z"]);function o({photo:e}){const t={},i=function(e){const t={};return e.sizes?.forEach((e=>{(e?.url??e?.src)&&e.type&&(t[e.type]=e)})),t}(e);Object.entries(i).forEach((([e,i])=>{i&&n.has(e)&&(t[e]=i.url,t[`${e}_`]=[i.url,i.width,i.height])}));const o=function(e){const t=function(e){return function(e){return"restrictions"in e&&!!e.restrictions}(e)?e.restrictions:void 0}(e);if(!t)return;const i={photoRaw:`${e.owner_id}_${e.id}`},n=function(e){return e.blur?{kind:"blur",is_permanent:!1,blur_restriction:e}:{kind:"geo",is_permanent:!0,geo_restriction:e}}(t);if("blur"===n.kind){const{blur_restriction:e}=n;return{...i,restrictionBlur:!0,restrictionTitle:e.title,restrictionText:e.text,restrictionButton:e.button?.title}}const{geo_restriction:o}=n;return{...i,restrictionGeo:!0,restrictionTitle:o.title,restrictionText:o.text,restrictionButton:o.button?.title}}(e);return{temp:{base:"",...t,...o}}}},74433:(e,t,i)=>{i.d(t,{RX:()=>h,Zk:()=>c,lG:()=>l});var n=i(97797),o=i(457735),s=i(1269),r=i(808911),a=i(799835),d=i(625916);const c={navigate:(e,t,i)=>{e&&(t||window.nav.go(e),(i||t)&&window.open(e,"_blank","noopener,noreferrer"))},showDonutSubscribePopup:(e,t,i)=>{(0,n.m)(e,t,i?.source||window.nav.objLoc.source,{type:"subscribe",params:{act:"subscribe_popup"},levelId:i?.levelId,sourceContentId:i?.sourceContentId,sourceContentType:i?.sourceContentType,screen:i?.screen,onSuccessPayment:i?.onSuccessPayment})},showWiki:o.u,onBlurredObsceneTextClick:(e,t)=>window.ObsceneTextAlertBox?.showBox(e.currentTarget,e,(0,a.Xo)("wall_obscene_box_alert_title"),(0,a.Xo)("wall_obscene_box_alert_content"),(0,a.Xo)("wall_obscene_box_alert_confirmation_button"),t),showOneTimeDonutLayer:e=>{(0,d.initOneTimeDonut)(e)}},l=e=>{const t=`${e.item.owner_id}_${e.item.id}`;window.cur.postContentContainerDataCopy?.[t]||(window.cur.postContentContainerDataCopy={...window.cur.postContentContainerDataCopy,[t]:e})},h=e=>{const t=document.getElementById(`post${e}`),n=t?.querySelector(".PostContentContainer");if(!n)return;const o=(0,s.X)((()=>(0,r.p)((()=>Promise.all([i.e(60229),i.e("langs/core_spa/PostContentContainer")]).then(i.bind(i,392945))),3).then((({PostContentContainerWeb:e})=>e))),n);window.cur.postContentContainerDataCopy?.[e]&&o.render(window.cur.postContentContainerDataCopy[e])}},982238:(e,t,i)=>{i.d(t,{E:()=>n});const n=e=>{e.match(/story/)&&(e=decodeURIComponent(e));const t=e.match(/^(?:story)?(?:(-?\d+)(?:_(\d+))?(?:&([a-z0-9]+))?|([a-z0-9]+))?(?:\/([a-z0-9_\-]+))?(?:\/([a-z0-9_:;\-\.]+))?$/i);if(!t)return[];const[,i,n,o,s,r,a]=t;return[i,n,o,s,r,a]}},986529:(e,t,i)=>{i.d(t,{B:()=>r});var n=i(221020),o=i(356035),s=i(755866);const r=(0,o.P)((function({action:e,icon:t,hasTitle:i,disableHint:o,onClick:r,...a}){const{hint:d,title:c,isDisabled:l,isPending:h,onExecute:p}=e,u=c??d??void 0,m=o?void 0:i?d:u,g=i?void 0:a["aria-label"]??u;return(0,n.Y)(s.T,{before:t,loading:h,disabled:l,hint:m,label:u,"aria-label":g,size:"m",onClick:e=>{p?.(),r?.(e)},...a,children:i&&c})}))},947034:(e,t,i)=>{i.d(t,{Q:()=>ne});var n=i(221020),o=i(815287),s=i(99265),r=i(409698),a=i(402816),d=i(962644),c=i(470704),l=i(617981),h=i(648179),p=i(191601),u=i(634164),m=i(772812),g=i(187233),_=i(638945),v=i(799649),f=i(516427),w=i(593355);const y=e=>`${Math.floor(100*e)}%`,b="vkitClipControlsLayout__controls--3cvK0",C="vkitClipControlsLayout__bottomControlsContainer--nrOXg",k="vkitClipControlsLayout__topControls--NB3Hb",I="vkitClipControlsLayout__topControlsGradient--yXTHl",S="vkitClipControlsLayout__titleShadow--qSbmq",A="vkitClipControlsLayout__gradient--sd7Yg",P="vkitClipControlsLayout__bottomControls--MyUq0",L="vkitClipControlsLayout__playActionButton--yTEUG",O="vkitClipControlsLayout__muteActionButton--gjDhC",E="vkitClipControlsLayout__bar--fiYNg",x="vkitClipControlsLayout__tappable--1fmj4",Y="vkitClipControlsLayout__isNotAvailable--TgxR4",M="vkitClipControlsLayout__fullGradient--DEVda",T=({title:e,className:t,onMuteButtonClick:i,volume:o,playing:s,togglePlay:r,onVolumeChange:a,centerComponent:T,unavailable:R,hasGradient:D,noControls:B,onClick:F})=>{const N=0===o?c.f:l.k;return(0,n.FD)(d.h,{className:(0,u.$)(b,t),children:[!B&&!R&&(0,n.FD)(n.FK,{children:[e&&(0,n.FD)(d.h,{className:k,children:[(0,n.Y)(d.h,{className:I}),(0,n.Y)(d.h,{children:(0,n.Y)(g.i,{children:(0,n.Y)(_.tW,{weight:"1",className:(0,u.$)((0,m.I)("color_text_contrast"),S),children:e})})})]}),(0,n.Y)(d.h,{onClick:F}),(0,n.FD)(d.h,{className:C,children:[(0,n.Y)(d.h,{className:A}),(0,n.FD)(d.h,{className:P,children:[(0,n.Y)("div",{className:L,role:"presentation","data-testid":"clipcontrolslayout-play-button",onClick:r,children:(0,n.Y)(v.K,{hoverMode:"opacity",activeMode:"opacity",className:(0,m.I)("color_icon_contrast"),children:s?(0,n.Y)(h.o,{}):(0,n.Y)(p.K,{})})}),(0,n.FD)("div",{className:O,children:[(0,n.Y)(v.K,{hoverMode:"opacity",activeMode:"opacity","data-testid":"clipcontrolslayout-mute-button",onClick:i,children:(0,n.Y)(N,{className:(0,m.I)("color_icon_contrast")})}),(0,n.Y)("div",{className:E,"data-testid":"clipcontrolslayout-volume-slider",children:(0,n.Y)(w.A,{value:o,min:0,max:1,size:"xl",hideHandle:!0,fillMode:"contrast",backMode:"contrast",formatHint:y,onChange:a})})]})]})]})]}),Boolean(T)&&(0,n.Y)(d.h,{centered:!0,className:(0,u.$)(R&&Y,D&&M),children:(0,n.Y)(f.SB4,{hasHover:!1,hasActive:!1,className:x,children:T})})]})};var R=i(982444),D=i(800687),B=i(356035),F=i(42107),N=i(504117),z=i(389829),j=i(946918),U=i(674980),W=i(460096),$=i(339672);const H="ClipForceMutedBanner__root--SvSW6",V=({text:e,buttonText:t,buttonClick:i})=>{const[s,a]=(0,o.useState)(!0),d=(0,o.useCallback)((()=>{i?.(),a(!1)}),[i]);return s?(0,n.Y)($.N,{className:H,before:null,header:(0,n.Y)(_.EY,{children:e}),after:(0,n.Y)(r.$,{mode:"secondary_transparent",onClick:d,children:t})}):null};var K=i(331635),q=i(327813),G=i(123339),J=i(645189);class Q{get activeVolume(){return this.videoIsMuted?0:this.playerVolume.volume}get videoIsEnded(){return this._videoIsEnded}get videoIsMuted(){return this._videoIsMuted}get currentTime(){return this._currentTime}constructor(e,t){this.props=e,this.playerVolume=t,this._currentTime=0,this._videoIsEnded=!1,this._videoIsMuted=!1,this.setVideoIsEnded=e=>{this._videoIsEnded=e},this.setVideoMuted=e=>{e!==this._videoIsMuted&&this.props.current.onMuteInteraction?.(e),this._videoIsMuted=e},this.muteButtonClick=()=>{this.setVideoMuted(!this._videoIsMuted),this._videoIsMuted||this.activeVolume||this.playerVolume.setVolume(1)},this.volumeChange=e=>{this.playerVolume.setVolume(e),this.setVideoMuted(0===e)},this.setCurrentTime=e=>{this._currentTime=e},(0,q.l_)(this),this._videoIsMuted=this.props.current.muted??!1}}var X=i(908508);class Z{[F.yo](){this.clipPlayer.setVideoMuted(Boolean(this.props.current.muted))}constructor(e,t,i,n){this.props=e,this.restriction=t,this.playerVolume=i,this.userEnv=n,this.clipPlayer=new Q(this.props,this.playerVolume),(0,q.l_)(this)}}Z=(0,K.Cg)([F.z8.transient(),(0,K.Sn)("design:type",Function),(0,K.Sn)("design:paramtypes",[void 0===F.Ji?Object:F.Ji,void 0===G.z?Object:G.z,void 0===X.O?Object:X.O,void 0===J.J?Object:J.J])],Z);const{useModel:ee,Provider:te}=(0,F.Qd)(Z,{initInEffect:!1}),ie=(0,B.P)((function(){const e=ee(),{title:t,video:i,cover:c,mode:l="contain",width:h,ratio:p,playing:u=!1,loop:g=!1,onVideoCurQualityChanged:v,onDurationChanged:f,onStalledChanged:w,onPositionChanged:y,onPlayingChanged:b,onPlaying:C,onPaused:k,onMutedChanged:I,onStarted:S,onLooped:A,onEnded:P,onVideoVolumeChanged:L,onVideoFormatChanged:O,onVideoBitrateChanged:E,onFirstBytes:x,onFirstFrame:Y,onError:M,isControls:B,isDeleted:F,isRestricted:$,hrefMore:H,onClick:K,togglePlay:q,onMuteChanged:G,module:J="clips",videoRawId:Q,borderRadius:X,forceMuted:Z}=e.props.current,{clipPlayer:te,restriction:ie}=e,{activeVolume:ne,videoIsEnded:oe,videoIsMuted:se,currentTime:re,setVideoIsEnded:ae,muteButtonClick:de,volumeChange:ce,setCurrentTime:le}=te,he=(0,j.B)(),pe=Boolean(Q&&i?.restriction?.blur&&!ie.isRestrictionDisabled(Q));(0,o.useEffect)((()=>{G?.(se)}),[se]);const ue=(0,o.useCallback)((e=>{ae(e),e&&u&&q()}),[oe]),me=()=>{Q&&(ie.disableRestriction(Q),!u&&q())},ge=(0,o.useCallback)((e=>{y?.(e),le(e)}),[y]);return!$&&!pe||ie.isRestrictionDisabled(Q)?(0,n.FD)(a.F,{width:h,ratio:p,mode:l,cover:c,borderRadius:X,children:[(0,n.Y)(d.h,{centered:!0,children:i&&(0,n.Y)(W.r,{loop:g,muted:Boolean(se||Z),volume:ne,onVideoCurQualityChanged:v,onLooped:A,onStarted:S,onPlayingChanged:b,onPlaying:C,onPaused:k,onMutedChanged:I,onPositionChanged:ge,onStalledChanged:w,onVideoEndedChanged:ue,onDurationChanged:f,onEnded:P,onVideoVolumeChanged:L,onVideoFormatChanged:O,onVideoBitrateChanged:E,onFirstBytes:x,onFirstFrame:Y,onError:M,playing:u,video:i,mode:l,module:J,platform:"web"})}),(0,n.Y)(T,{onClick:()=>K?.(re),noControls:!B||oe,title:t,playing:u,onMuteButtonClick:Z?void 0:de,onVolumeChange:Z?void 0:ce,volume:se||Z?0:ne,togglePlay:q,hasGradient:oe,unavailable:F||$,centerComponent:(F||$||oe)&&(0,n.FD)(n.FK,{children:[F&&(0,n.FD)(n.FK,{children:[(0,n.Y)(N.Y,{className:(0,m.I)("color_icon_secondary")}),(0,n.Y)(R.K,{size:8}),(0,n.Y)(_.hE,{level:"3",weight:"3",className:(0,m.I)("color_text_secondary"),children:(0,n.Y)(D.I,{children:he.getLang("video_feed_player_clip_deleted")})})]}),$&&(0,n.FD)(n.FK,{children:[(0,n.Y)(z.A,{className:(0,m.I)("color_icon_secondary")}),(0,n.Y)(R.K,{size:8}),(0,n.Y)(_.hE,{level:"3",weight:"3",className:(0,m.I)("color_text_secondary"),children:(0,n.Y)(D.I,{children:he.getLang("video_clip_restriction_user_access")})})]}),oe&&(0,n.FD)(n.FK,{children:[(0,n.Y)(r.$,{mode:"secondary",appearance:"overlay",size:"l",href:H,children:he.getLang("video_feed_player_clip_more")}),(0,n.Y)(R.K,{size:20}),(0,n.Y)(r.$,{mode:"link",appearance:"overlay",size:"l",onClick:()=>!u&&q(),children:he.getLang("video_feed_player_clip_repeat")})]})]})}),Z&&(0,n.Y)(V,{text:he.getLang("video_clip_sound_restriction_error"),buttonText:he.getLang("video_clips_banner_close_btn")})]}):(0,n.Y)(s.E,{width:h,ratio:p,cover:c,onClick:()=>K?.(re),text:i?.restriction?.text,icon:(0,U.U)(i?.restriction?.icon_name),blurred:pe,borderRadius:X,size:"l","data-testid":`clips-restricted-${Q}`,action:pe?(0,n.Y)(r.$,{size:"m",onClick:me,mode:"outline",appearance:"overlay","data-testid":"clips-carousel-placeholder-blur-button",children:i?.restriction?.button?.title}):void 0})})),ne=(0,F.jn)(te,ie)},429294:(e,t,i)=>{i.d(t,{b:()=>P});var n=i(221020),o=i(356035),s=i(42107),r=i(962644),a=i(103509),d=i(685564),c=i(331635),l=i(327813),h=i(452200),p=i(287932),u=i(675925),m=i(238055),g=i(836382),_=i(947008),v=i(300806);function f(e,t,i){const n=e.filter((e=>{return!(t=e,"with_padding"in t&&"url"in t&&"height"in t&&"width"in t&&Boolean(t.with_padding)||(e=>"padding"in e&&"url"in e&&"height"in e&&"width"in e&&Boolean(e.padding))(e));var t})),o=i&&(0,g.Q)()?2:1,s=((0,_.Et)(t)?t:t.width||0)*o,r=((0,_.Et)(t)?0:t.height||0)*o;return(0,v.q)(n.length?n:e,s,r)?.url}var w=i(237870),y=i(645189);class b{async[s.Ts](){this.postAuthorId=(0,h.v)(this.props.current.postId).ownerId,this.getAutoplaySettings(),this.fetchVideo()}async[s.zr](){this.switchConnection.emit("stop"),this.userEnv.partConfigEnabled("feed_account_info_service_refetch")||this.accountInfoService.reset()}get mode(){if(this.props.current.mode)return this.props.current.mode;if(!this.video)return"cover";const{width:e=0,height:t=0}=this.video.data;return t/e<=1?"contain":"cover"}async getAutoplaySettings(){try{const e=await this.accountInfoService.ensure({fields:["video_autoplay"]}),t=e?.settings?.find((e=>"video_autoplay"===e.name));this.autoplaySetting=Boolean(t?.value)}catch{}}async fetchVideo(){this.isLoading=!0;try{await this.shortVideoVideosProvider.fetch({videos:this.props.current.videoRawId},{})}catch(e){(0,l.h5)((()=>{this.error=e}))}finally{this.isLoading=!1}}get video(){return this.shortVideoVideosProvider.get(this.props.current.videoRawId)}get cover(){return this.video?.data.covers&&f(this.video.data.covers,this.props.current.coverWidth)}get isRestricted(){return Boolean(this.video?.isRestricted)}get isRestrictedWithBlur(){return Boolean(this.video?.data.restriction?.blur)}get forceMuted(){return Boolean(this.video?.data?.is_muted)}get onClick(){if(!this.isRestricted)return e=>{this.props.current.onClick&&(this.pause(),this.props.current.onClick(e))}}get autoplay(){return this.autoplaySetting&&!this.isRestricted&&!this.isRestrictedWithBlur&&this.autoplayClip}constructor(e,t,i,n,o){this.shortVideoVideosProvider=e,this.accountInfoService=t,this.stats=i,this.props=n,this.userEnv=o,this.autoplaySetting=!1,this.autoplayClip=!0,this.isLoading=!1,this.error=void 0,this.postAuthorId=0,this.playing=!1,this.muted=!0,this.getPlayer=(e,t)=>this.props.current.getPlayer({video:this.video?.data,isRestricted:this.isRestricted,cover:this.cover,onClick:this.onClick,muted:this.muted,onMuteChanged:this.onMuteChanged,playing:this.playing,togglePlay:this.togglePlay,ratio:e,mode:this.mode,isControls:!this.isRestricted,loop:!0,volume:1,videoRawId:this.props.current.videoRawId,forceMuted:this.forceMuted,...t}),this.play=()=>{this.playing||(this.playing=!0,this.switchConnection.emit("play",this.muted),this.props.current.pauseVideoPlayer?.())},this.pause=()=>{this.playing&&(this.playing=!1,this.switchConnection.emit("pause"))},this.togglePlay=()=>{this.playing?(this.pause(),this.autoplayClip=!1):this.play()},this.onMuteChanged=e=>{this.muted=e,this.switchConnection.emit(e?"mute":"unmute"),e||(this.autoplayClip=!1)},this.toggleMute=()=>{this.onMuteChanged(!this.muted)},(0,l.l_)(this),this.switchConnection=w.L2.ensure(s.oV).connect({resume:this.play,pause:this.pause,stop:this.pause})}}b=(0,c.Cg)([s.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===p.$?Object:p.$,void 0===u.T?Object:u.T,void 0===m.Y?Object:m.Y,void 0===s.Ji?Object:s.Ji,void 0===y.J?Object:y.J])],b);const{Provider:C,useModel:k}=(0,s.Qd)(b,{initInEffect:!1});var I=i(815287);var S=i(486526);const A=(0,o.P)((function(){const{getPlayer:e,video:t,stats:i,autoplay:o,props:{current:{ratio:s,headerHeight:c,feedTrackCode:l,dataRole:h,videoRawId:p}}}=k();(()=>{const{playing:e,toggleMute:t}=k();(0,I.useEffect)((()=>{const i=e=>{"KeyM"===e.code&&t()};return e&&document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}}),[e,t])})();const u=(0,d.p)({stats:i,statsRef:a.x.FEED,video:t,feedTrackCode:l,autoplay:o}),m=function(e){const t=(0,I.useRef)(null),{autoplay:i,play:n,pause:o}=k();return(0,I.useEffect)((()=>{const s=(0,S.s)((()=>{if(!t.current)return;const s=t.current.getBoundingClientRect(),r=s.height/3,a=s.top+r,d=s.bottom-r;a>=e&&d<=window.innerHeight?i&&n():o()}),30);return document.addEventListener("scroll",s,{passive:!0}),i&&s(),()=>document.removeEventListener("scroll",s)}),[i]),t}(c);return s?(0,n.Y)("div",{ref:m,"data-role":h,"data-testid":`clip-attachment-${p}`,children:e(s,u)}):(0,n.Y)(r.h,{children:(0,n.Y)("div",{ref:m,"data-role":h,"data-testid":`clip-attachment-${p}`,children:e("var(--primary-attachment-ratio, calc(9 / 16))",u)})})})),P=(0,s.jn)(C,A)},538163:(e,t,i)=>{i.d(t,{J:()=>h});var n=i(221020),o=i(370633),s=i(982444),r=i(405697),a=i(454882),d=i(409698),c=i(946918),l=i(516800);const h=({onButtonClick:e,message:t,mode:i,withoutAction:h})=>{const p=(0,c.B)(),{reload:u}=(0,l.Z)();return(0,n.FD)(o.Y,{mode:i,children:[(0,n.Y)(s.K,{size:"2xl"}),(0,n.FD)(r.O,{icon:(0,n.Y)(a.e,{}),action:!h&&(0,n.Y)(d.$,{onClick:e??u,size:"m",appearance:"accent",mode:"link",children:p.getLang("friends_try_reload")}),children:[p.getLang("wall_posts_loading_error"),(0,n.Y)("div",{children:t})]}),(0,n.Y)(s.K,{size:"4xl"})]})}},974076:(e,t,i)=>{i.d(t,{t:()=>k});var n=i(221020),o=i(300032),s=i(409698),r=i(187233),a=i(355812),d=i(235834),c=i(423654),l=i(638945);const h="PostActionButton__actionButton--ZL1VA";var p=i(815287),u=i(283996),m=i(914160),g=i(180329),_=i(165051),v=i(920603);const f=({testId:e,accessibilityTitle:t,actionTitle:i,title:o,separator:s,onClick:r})=>(0,n.Y)(l.LE,{weight:"3","data-testid":e,children:(0,n.Y)(c.N,{"aria-label":t||o,onClick:r,mode:"secondary",children:(0,n.Y)(g.s,{noWrap:!0,style:{whiteSpace:"nowrap"},children:(0,n.FD)(_.r,{separator:s,children:[(0,n.Y)(v.$,{children:o}),(0,n.Y)(n.FK,{children:i})]})})})});var w=i(9467),y=i(594756),b=i(634164);const C=e=>`feed_action_button_${e}`,k=({id:e,button:t,primary:i,openUrl:g,showDonutGoalModal:_,ownerId:v,showWiki:k,adsAnalyticsInfo:I,showSnackbar:S,onActionButtonClickEvent:A,onOpenDonutLayer:P,noPadding:L,screen:O})=>{const{title:E,type:x,action:Y,accessibility_title:M}=t,{type:T,url:R,peer_id:D,action_title:B}=Y,F=(0,p.useMemo)((()=>{let i,n="",o=!0;switch(T){case"open_url":["donut_goal","donut_level","donut_levels","donut_support"].includes(x)&&(n=C(x));const{url:s,source:r,isDonutPayment:a}=(0,y.p)(e,R,O);if("donut_goal"===x&&a&&P){const n=t.donut_goal?.goal_id;i=()=>{P({layerParams:{ownerId:`${v}`},query:{goalId:`${n}`,source:r??null,analytics_screen:O??null,source_content_type:"post",source_content_id:e?.toString()??null}}),A?.({action_button_type:x,action_button_goal_id:n?Number(n):void 0})};break}if("donut_goal"===x&&s&&_){i=()=>{_(s),A?.({action_button_type:"donut_goal"})};break}if("donut_level"===x&&P){const n=t.donut_level?.level_id;i=()=>{P({layerParams:{ownerId:`${v}`},query:{levelId:`${n}`,source:r??null,analytics_screen:O??null,source_content_type:"post",source_content_id:e?.toString()??null}}),A?.({action_button_type:x,action_button_level_id:n?Number(n):void 0})};break}if(("donut_support"===x||"donut_levels"===x)&&P){i=()=>{P({layerParams:{ownerId:`${v}`},query:{analyticsScreen:O??null,analytics_screen:O??null,source_content_type:"post",source_content_id:e?.toString()??null}}),A?.({action_button_type:x})};break}if("online_booking"===x)if(n=C("online_booking"),R?.includes("service-booking"))o=!1;else if(k&&R){i=()=>{k({w:new URL(R).pathname.replace("/",""),from:"groups"},!1,null,{noloader:!0,ads_params:(0,u.b)(I)}),A?.({action_button_type:"online_booking"})};break}n=C(T),i=()=>{g?.(R,o),A?.({action_button_type:x})};break;case"open_conversation":n=C("open_conversation"),i=()=>{g?.(`im?sel=${D}`,!0),A?.({action_button_type:"message_to_community"})};break;case"show_snackbar":const{message:d}=Y.show_snackbar??{};n=C(T),i=d?()=>S?.({text:d,type:"error"}):()=>{};break;default:i=()=>{}}return{onClick:i,dataTestId:n}}),[t,O,e]),N=e=>{e.preventDefault(),e.stopPropagation(),F.onClick()};return i?(0,n.Y)(o.T,{"data-testid":F.dataTestId,before:"donut_goal"===x&&void 0!==t.progress?.percentage?(0,n.Y)(m.y,{value:t.progress.percentage}):void 0,after:B?(0,n.Y)(s.$,{appearance:"overlay",children:B}):void 0,chevron:B?void 0:"always",onClick:N,children:E}):B?(0,n.Y)(r.i,{mode:"vertical",spacing:L?0:20,paddingBottom:6,paddingTop:L?6:0,children:(0,n.Y)(f,{title:E,accessibilityTitle:M,testId:F.dataTestId,actionTitle:B,separator:(0,n.Y)(a.O,{}),onClick:N})}):(0,n.Y)(n.FK,{children:(0,w.z2)("feed_post_action_button_with_underline")?(0,n.Y)(d.G,{className:(0,b.$)(!L&&h),noPadding:L,children:(0,n.Y)(c.N,{"data-testid":F.dataTestId,onClick:N,mode:"secondary",children:(0,n.Y)(l.LE,{weight:"3",children:E})})}):(0,n.Y)(d.G,{"data-testid":F.dataTestId,onClick:N,className:(0,b.$)(!L&&h),noPadding:L,children:E})})}},914160:(e,t,i)=>{i.d(t,{y:()=>r});var n=i(221020),o=i(427063),s=i(300032);const r=({min:e=0,max:t=100,value:i,...r})=>i===t?(0,n.Y)(o.w,{}):(0,n.Y)(s.T.Progress,{min:e,max:t,value:i,...r})},216131:(e,t,i)=>{i.d(t,{Z:()=>A});var n=i(221020),o=i(815287),s=i(300032),r=i(409698),a=i(946918),d=i(283996),c=i(9467),l=i(594756),h=i(140094),p=i(516427),u=i(187233),m=i(880414),g=i(638945),_=i(355812),v=i(956250),f=i(377803),w=i(325159),y=i(180329);const b=({monthText:e,dayText:t,isDark:i=!1})=>{const o={width:"32px",justifyContent:"center","--vkit_internal--content_badge_custom_fg":f.A.colorTextPrimary.normal.value,"--vkit_internal--content_badge_main_color":i?f.A.colorBackgroundContent.normal.value:f.A.colorBackgroundContrast.normal.value};return(0,n.Y)(w.R,{size:"m",mode:"primary",appearance:"neutral",style:o,children:(0,n.FD)(y.s,{align:"center",direction:"column",children:[(0,n.Y)(g.HL,{level:"3","data-testid":"ticket_date_month",children:e}),(0,n.Y)(g.HL,{level:"1","data-testid":"ticket_date_day",children:t})]})})},C=e=>`${(0,v.N)(e.getHours())}:${(0,v.N)(e.getMinutes())}`,k=({actionButton:e,testId:t,text:i,onClick:d})=>{const[c,l]=(0,o.useState)(!1),[v,f]=(0,h.Wx)({rootMargin:"-100px 0px -200px 0px"}),w=(0,p.UtZ)(),y=(0,a.B)(),k=w===p.zM2.DARK,I=e.vk_ticket?.seance,S=e.vk_ticket?.title;let A=I?.date,P="",L="";if(A){const e=y.getLang("months_sm_of",!0);A=y.compactDate(new Date(A),e,{onlyDate:!0,excludeTime:!0}),[L,P]=A.split(" ")}const O=k!==c?"neutral":"overlay";return(0,o.useEffect)((()=>{f?setTimeout((()=>{l(!0)}),500):l(!1)}),[f]),(0,n.Y)(s.T,{"data-testid":t,getRootRef:v,before:Boolean(A)&&(0,n.Y)(b,{monthText:P,dayText:L,isDark:k}),after:(0,n.Y)(p.SvD,{value:"light",children:(0,n.Y)(r.$,{"data-testid":"post_vk_ticket_buy_button",appearance:O,mode:"primary",size:"s",href:e.action?.url,onClick:d,children:i})}),children:(0,n.Y)(u.i,{mode:"vertical",spacing:I?.date?4:0,paddingTop:0,paddingBottom:0,children:(0,n.Y)(m.b,{lines:1,TypographyComponent:g.fz,children:void 0!==I?.date?(0,n.FD)(n.FK,{children:[(0,n.Y)("span",{"data-testid":"post_vk_ticket_city",children:I?.city}),(0,n.Y)(_.O,{}),(0,n.Y)("span",{"data-testid":"post_vk_ticket_time",children:C(new Date(I?.date))})]}):(0,n.Y)("span",{"data-testid":"post_vk_ticket_title",title:S,children:S})})})})};var I=i(914160);const S=e=>`feed_action_button_${e}`,A=({id:e,attachment:t,openUrl:i,showDonutGoalModal:h,ownerId:p,showWiki:u,adsAnalyticsInfo:m,showSnackbar:g,screen:_,onActionButtonClickEvent:v,onOpenDonutLayer:f})=>{const w=(0,a.B)(),y=(0,o.useMemo)((()=>{let n,o,s=!0,r="";if("action_button"===t.type){const{type:a,url:c,peer_id:w}=t.action_button?.action??{};o=t.action_button?.title;const{donut_goal:y,donut_level:b}=t.action_button??{},C=t.action_button?.type??"";switch(a){case"open_url":["donut_goal","donut_level","donut_levels","donut_support"].includes(C)&&(r=S(C));const{url:o,source:k,isDonutPayment:I}=(0,l.p)(e,c,_);if("donut_goal"===C&&I&&f){const t=y?.goal_id;n=()=>{f({layerParams:{ownerId:`${p}`},query:{goalId:`${t}`,source:k??null,analytics_screen:_??null,source_content_type:"post",source_content_id:e?.toString()??null}}),v?.({action_button_type:C,action_button_goal_id:t?Number(t):void 0})};break}if("donut_goal"===C&&o&&h){n=()=>{h(o),v?.({action_button_type:"donut_goal"})};break}if("donut_level"===C&&f){const t=b?.level_id;n=()=>{f({layerParams:{ownerId:`${p}`},query:{levelId:`${t}`,source:k??null,analytics_screen:_??null,source_content_type:"post",source_content_id:e?.toString()??null}}),v?.({action_button_type:C,action_button_level_id:t?Number(t):void 0})};break}if(("donut_support"===C||"donut_levels"===C)&&f){n=()=>{f({layerParams:{ownerId:`${p}`},query:{source:k??null,analytics_screen:_??null,source_content_type:"post",source_content_id:e?.toString()??null}}),v?.({action_button_type:C})};break}if("online_booking"===C)if(r=S("online_booking"),c?.includes("service-booking"))s=!1;else if(u&&c){n=()=>{u({w:new URL(c).pathname.replace("/",""),from:"groups"},!1,null,{noloader:!0,ads_params:(0,d.b)(m)}),v?.({action_button_type:"online_booking"})};break}r=S(a),n=()=>{i?.(c??"",s),v?.({action_button_type:C})};break;case"open_conversation":r=S(a),n=()=>{i?.(`im?sel=${w}`,s),v?.({action_button_type:"message_to_community"})};break;case"show_snackbar":const{message:A}=t.action_button?.action.show_snackbar??{};r=S(a),A&&(n=()=>g?.({text:A,type:"error"}))}}else switch(r=S(t.type),t.type){case"mini_app":n=()=>i?.(t.mini_app?.app?.share_url,s),o=t.mini_app?.description;break;case"situational_theme":n=()=>i?.(t.situational_theme?.link??"",s),o=t.situational_theme?.description;break;case"donut_link":n=p&&f?()=>f({layerParams:{ownerId:`${p}`}}):()=>i?.(t.donut_link?.button?.action?.url??"",s),o=t.donut_link?.text?t.donut_link?.text:t.donut_link?.button?.title;break;case"online_booking":n=()=>{i?.(t.online_booking?.booking_app_url,s)},o=w.getLang("wall_attachment_action_button_online_booking_title");break;case"message_to_bc":n=()=>{i?.(`im?sel=${t.message_to_bc?.owner_id}`,s)},o=w.getLang("wall_attachment_action_button_message_to_community_title");break;case"market_link":n=()=>{i?.(t.market_link?.url,s)},o=w.getLang("wall_attachment_action_button_open_market_title")}return{title:o,actionTitle:t.action_button?.action?.action_title,onClick:n,dataTestId:r}}),[t,_,e]);return y.title?(0,c.z2)("frontend.web_posts_vk_tickets")&&"action_button"===t.type&&"vk_ticket"===t?.action_button?.type?(0,n.Y)(k,{actionButton:t?.action_button,testId:y.dataTestId,text:y.title,onClick:e=>{e.preventDefault(),e.stopPropagation(),y.onClick?.(e)}}):(0,n.Y)(s.T,{"data-testid":y.dataTestId,before:"donut_goal"===t.action_button?.type&&void 0!==t.action_button?.progress?.percentage?(0,n.Y)(I.y,{value:t.action_button.progress.percentage}):void 0,maxHeight:44,after:y.actionTitle?(0,n.Y)(r.$,{appearance:"overlay",children:y.actionTitle}):void 0,chevron:y.actionTitle?void 0:"always",onClick:e=>{e.preventDefault(),e.stopPropagation(),y.onClick?.(e)},children:y.title}):null}},702441:(e,t,i)=>{i.d(t,{r:()=>s});class n{}var o=i(739991);class s extends n{sendStartPostAudio(e){const{trackCode:t,previousScreen:i,screen:n}=this.eventData;"track_code"in e||(e.track_code=t);const s={screen:n,type:"type_action",type_action:{previous_screen:i,type:`${o.y9}start_audio`,type_feed_post_start_audio:e}};this.productionStats.send(s)}sendStartPostPlaylist(e){const{trackCode:t,previousScreen:i,screen:n}=this.eventData;"track_code"in e||(e.track_code=t);const s={screen:n,type:"type_action",type_action:{previous_screen:i,type:`${o.y9}start_playlist`,type_feed_post_start_playlist:e}};this.productionStats.send(s)}sendProductTagShow(e){const{screen:t}=this.eventData,i={type:"type_action",type_action:{type:`${o.n0}show_product_pin`,type_feed_show_product_pin:e},screen:t};this.productionStats.send(i)}constructor(e,t){super(),this.eventData=e,this.productionStats=t}}},437260:(e,t,i)=>{i.d(t,{F:()=>r});class n{constructor(){this.onCarouselNextClick=this.createInteractionEventSender("click_next"),this.onCarouselPrevClick=this.createInteractionEventSender("click_previous"),this.onPhotoOpen=this.createInteractionEventSender("open_photo"),this.onOpenGeoFeed=this.createInteractionEventSender("open_geo_feed"),this.onOpenNearbyPhoto=this.createInteractionEventSender("open_nearby_photo"),this.onExtLinkClick=this.createInteractionEventSender("ext_link_click"),this.onIntLinkClick=this.createInteractionEventSender("int_link_click"),this.onExtLinkClickSnippet=this.createInteractionEventSender("ext_link_click_snippet"),this.onIntLinkClickSnippet=this.createInteractionEventSender("int_link_click_snippet"),this.onOpenGroup=this.createInteractionEventSender("open_group"),this.onOpenUser=this.createInteractionEventSender("open_user"),this.onPostHideWeek=this.createInteractionEventSender("hide","week"),this.onPostHideAlways=this.createInteractionEventSender("hide","always"),this.onPostUnHideWeek=this.createInteractionEventSender("unhide","week"),this.onPostUnHideAlways=this.createInteractionEventSender("unhide","always"),this.onSendDonut=this.createInteractionEventSender("send_donut"),this.onPostOpen=this.createInteractionEventSender("open"),this.onUnmuteAudio=this.createAudioClickEventSender("unmute_audio"),this.onMuteAudio=this.createAudioClickEventSender("mute_audio"),this.onPauseAudio=this.createAudioClickEventSender("pause_audio"),this.onOpenAudio=this.createAudioClickEventSender("open_audio"),this.onAddedAudio=this.createAudioClickEventSender("added_audio"),this.onRemovedAudio=this.createAudioClickEventSender("removed_audio"),this.onOpenPlaylist=this.createAudioPlaylistClickEventSender("open_playlist"),this.onAddedPlaylist=this.createAudioPlaylistClickEventSender("added_playlist"),this.onRemovedPlaylist=this.createAudioPlaylistClickEventSender("removed_playlist"),this.onClickBackgroundOnBlurredPost=this.createDonutPaymentClickEventSender("attachment_background"),this.onClickDonutButtonOnBlurredPost=this.createDonutPaymentClickEventSender("attachment_button"),this.onLikesBarOnBlurredPost=this.createDonutPaymentClickEventSender("likes_activity"),this.onClickFooterOnBlurredPost=this.createDonutPaymentClickEventSender("footer"),this.onActionButtonClickEvent=this.createActionButtonClickEvent()}}var o=i(739991),s=i(725308);class r extends n{createInteractionEventSender(e,t="wall_item"){return i=>{const{trackCode:n,screen:o="",ref:s=""}=this.eventData??{};n&&this.productionStats.send({type:"type_click",screen:o,type_click:{item:{type:e},type:"type_feed_interaction_item",type_feed_interaction_item:{ref:s,item:i??t,track_code:n}}})}}createAudioClickEventSender(e){return t=>{const{trackCode:i,screen:n=""}=this.eventData??{};if(!i)return;const o=`type_feed_post_${e}`;this.productionStats.send({type:"type_click",screen:n,type_click:{item:{track_code:i},type:o,[o]:t}})}}createAudioPlaylistClickEventSender(e){return t=>{const{trackCode:i,screen:n=""}=this.eventData??{};if(!i)return;const o=`type_feed_post_${e}`;this.productionStats.send({type:"type_click",screen:n,type_click:{item:{track_code:i},type:o,[o]:t}})}}createDonutPaymentClickEventSender(e){return t=>{const{trackCode:i,screen:n=""}=this.eventData??{};i&&(this.productionStats.send({type:"type_click",screen:t.screen,type_click:{item:{type:"post",id:t.content_id,owner_id:t.content_owner_id,track_code:i},type:"type_donut_support_author_click",type_donut_support_author_click:{item_type:t.item_type}}}),this.productionStats.send({type:"type_click",screen:n,type_click:{item:{type:"post",id:t.content_id,owner_id:t.content_owner_id,track_code:i},type:"type_feed_post_donut_payment_click",type_feed_post_donut_payment_click:{subtype:e}}}))}}createActionButtonClickEvent(){return e=>{const{trackCode:t,screen:i}=this.eventData,n={type:"type_click",type_click:{type:"type_action_button_click",type_action_button_click:e,item:{track_code:t}},screen:i};this.productionStats.send(n)}}sendProductTagsHide(e){const{trackCode:t,screen:i}=this.eventData,n={type:"type_click",type_click:{type:`${o.n0}hide_product_pin_click`,type_feed_hide_product_pin_click:e,item:{track_code:t}},screen:i};this.productionStats.send(n)}sendProductCardOpenClick(e){const{trackCode:t,screen:i}=this.eventData,n={type:"type_click",type_click:{type:`${o.n0}open_market_item_click`,type_feed_open_market_item_click:e,item:{track_code:t,id:e.item.id}},screen:i};this.productionStats.send(n)}get screen(){return this.eventData.screen}constructor(e,t){super(),this.eventData=e,this.productionStats=t,this.onPostExpandText=e=>{const{trackCode:t,screen:i}=this.eventData,{source:n}=e;t&&this.productionStats.send({type:"type_click",screen:i,type_click:{item:{track_code:t},type:"type_feed_post_expand_text",type_feed_post_expand_text:{source:n}}})},this.onPostCollapseText=()=>{const{trackCode:e,screen:t}=this.eventData;e&&this.productionStats.send({type:"type_click",screen:t,type_click:{item:{track_code:e},type:"type_feed_post_collapse_text",type_feed_post_collapse_text:{}}})},this.onOpenCommentsModalClick=e=>{const{trackCode:t,screen:i}=this.eventData,{entryPoint:n,commentId:o}=e;t&&this.productionStats.send({type:"type_click",screen:i,type_click:{type:"type_feed_open_comments_modal",type_feed_open_comments_modal:{entry_point:n,track_code:t,comment_id:o}}})},this.onOpenReactionsModalClick=e=>{const{trackCode:t,screen:i}=this.eventData,{entryPoint:n}=e;t&&this.productionStats.send({type:"type_click",screen:i,type_click:{item:{track_code:t},type:"type_feed_open_reactions_modal",type_feed_open_reactions_modal:{entry_point:n}}})},this.onInteractionClickEvent=(e,t)=>{const{trackCode:i,ref:n="",screen:o=""}=this.eventData;i&&this.productionStats.send({screen:o,type:"type_click",type_click:{type:"type_feed_interaction_item",item:{type:e},type_feed_interaction_item:{ref:n,track_code:i,...t}}})},this.openGroupUserClickEvent=(e,t,i=!1)=>{let n=i?"open_parent_user":"open_user";s.z.isGroupId(e)&&(n=i?"open_parent_group":"open_group"),this.onInteractionClickEvent(n,t)},this.onFollowClickEvent=(e,t)=>{const{trackCode:i,ref:n="",screen:o=""}=this.eventData;i&&this.productionStats.send({screen:o,type:"type_click",type_click:{type:"type_feed_follow_click",item:{ref:n,track_code:i,...e},type_feed_follow_click:t}})},this.onUnfollowClickEvent=(e,t)=>{const{trackCode:i,ref:n="",screen:o=""}=this.eventData;i&&this.productionStats.send({screen:o,type:"type_click",type_click:{type:"type_feed_unfollow_click",item:{ref:n,track_code:i,...e},type_feed_unfollow_click:t}})}}}},182255:(e,t,i)=>{i.d(t,{P:()=>L});var n=i(221020),o=i(356035),s=i(42107),r=i(331635),a=i(327813),d=i(645189),c=i(932216),l=i(297520),h=i(144819),p=i(830443),u=i(399902);const m="chipEnriched";class g{wrapAwayLink(e){if(!e)return e;if(!this.props.current.adsAnalyticsInfo?.isAdsPromoPost)return this.userEnv.partConfigEnabled("feed_redesign_wrap_away_chip_links")?(0,l.Xo)(e):e;let t;try{t=new URL(e,"https://www.example.com")}catch(t){return(0,c.vV)(t),e}if(!t||t.pathname.startsWith("/away.php"))return e;const i={to:decodeURIComponent(e),track_code:this.props.current.adsAnalyticsInfo.trackCode??"",post:this.props.current.adsAnalyticsInfo.postId??"",...this.props.current.adsAnalyticsInfo.adData?{post_ad_data:this.props.current.adsAnalyticsInfo.adData}:{}};return`/away.php?${new URLSearchParams(Object.entries(i)).toString()}`}enrichChipAttachments(e){if(!e)return[];const t=[];return e.forEach((e=>{switch(e.type){case"doc":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.doc?.url)}});break;case"poll":t.push({chip:e.chip,type:e.type,[m]:{onClick:()=>{e.poll&&this.handlePollClick(e.poll)}}});break;case"donut_link":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.donut_link?.button?.action?.url)}});break;case"artist":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(`/artist/${e.artist?.domain??e.artist?.id}`)}});break;case"curator":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.curator?.url)}});break;case"podcast":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.podcast?.url)}});break;case"sticker":t.push({chip:e.chip,type:e.type,[m]:{url:this.props.current.onStickerClick&&e.sticker?.sticker_id?void 0:this.wrapAwayLink(e.sticker?.pack_url),onClick:()=>{this.props.current.onStickerClick&&e.sticker?.sticker_id&&this.props.current.onStickerClick(e.sticker.sticker_id)}}});break;case"graffiti":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.graffiti?.url)}});break;case"event":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(`/event${e.event?.id}`)}});break;case"page":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.page?.view_url)}});break;case"article":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(this.transformArticleLink(e.article?.url))}});break;case"market":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.market?.url)}});break;case"album":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(`/album${(0,h.X4)({id:e.album?.id,ownerId:e.album?.owner_id})}`)}});break;case"market_album":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(`/market${e.market_album?.owner_id}?section=album_${e.market_album?.id}`)}});break;case"link":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.link?.url)}});break;case"note":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.note?.view_url)}});break;case"mini_app":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.mini_app?.app?.webview_url)}});break;case"textlive":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.textlive?.url)}});break;case"narrative":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(`/narrative${e.narrative?.owner_id}_${e.narrative?.id}`)}});break;case"situational_theme":t.push({chip:e.chip,type:e.type,[m]:{url:this.wrapAwayLink(e.situational_theme?.link)}})}})),t}handlePollClick(e){this.props.current.showPollModal?.(e)}transformArticleLink(e){try{if(!e)return;return(0,u.G)(e,{subtype:"chip_link"})}catch{return}}[s.zr](){this.reactions.destroy()}constructor(e,t){this.props=e,this.userEnv=t,this.reactions=new p.O,this.enrichedAttachments=[],this.reactions.reaction((()=>this.props.current.attachments),(e=>{this.enrichedAttachments=this.enrichChipAttachments(e)}),{fireImmediately:!0}),(0,a.l_)(this)}}g=(0,r.Cg)([s.z8.transient(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===s.Ji?Object:s.Ji,void 0===d.J?Object:d.J])],g);const{Provider:_,useModel:v}=(0,s.Qd)(g,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0});var f=i(638945),w=i(165051),y=i(423654),b=i(180329),C=i(920603);const k="vkitChipAttachment__nowrap--VjyqQ",I="vkitChipAttachment__root--wwGoU",S=({Component:e="div",TypographyComponent:t,openInNewTab:i,href:o,onClick:s,value:r,after:a,mode:d,...c})=>{const l="secondary"===d;return(0,n.Y)(t,{Component:e,weight:"3",className:I,"data-testid":"chip-attachment",children:(0,n.Y)(y.N,{href:o,target:Boolean(o&&i)?"_blank":void 0,onClick:s,mode:l?"secondary":"default",...c,children:(0,n.FD)(b.s,{noWrap:!0,children:[(0,n.Y)(C.$,{children:r}),!!a&&(0,n.FD)("span",{className:k,children:[".",a]})]})})})},A=({TypographyComponent:e=f.$j,attachments:t,separator:i,postClickAnalytics:o,dataRoleLink:s})=>{if(!t.length)return null;return(0,n.Y)(w.r,{separator:i,children:t.map(((i,r)=>{const{chip:a}=i;if(!a)return null;let d="secondary";return"chip"===a.style?d="primary":"link"===a.style&&(d="link"),(0,n.Y)(S,{"data-role":"link"===d?s:void 0,href:i.chipEnriched?.url,openInNewTab:!0,onClick:e=>{e.stopPropagation();const n=e.target,s=n?.closest("a");s&&((e,i)=>{const n=new URL(e.href),s=(0,l.V0)(n.href)&&!n.pathname.startsWith("/away.php");let r;const a=t[i].type;"doc"===a?r="wall_item:file":"link"===a?r="wall_item:post_link":"article"===a&&(r="chip_link"),s?o?.onIntLinkClick?.(r):o?.onExtLinkClick?.(r)})(s,r),i.chipEnriched?.onClick?.()},value:a.title[0].text,after:a.title[1]?.text,mode:d,TypographyComponent:e},r)}))})},P=(0,o.P)((function(){const{props:e,enrichedAttachments:t}=v(),{separator:i,TypographyComponent:o,postClickAnalytics:s,dataRoleLink:r}=e.current;return(0,n.Y)(A,{attachments:t,separator:i,TypographyComponent:o,postClickAnalytics:s,dataRoleLink:r})})),L=(0,s.jn)(_,P)},594756:(e,t,i)=>{i.d(t,{p:()=>n});const n=(e,t,i)=>{if(t){const[n,o]=t.split("?"),s=new URLSearchParams(o),r=s.get("source"),a=t.includes("w=donut_payment");if(!a){!s.has("screen")&&i&&s.append("screen",i);const t=s.get("sourceContentId");t&&!s.has("source_content_id")&&(s.delete("sourceContentId"),s.append("source_content_id",t)),!s.has("source_content_id")&&e&&s.append("source_content_id",e.toString());const n=s.get("sourceContentType");n&&!s.has("source_content_type")&&(s.delete("sourceContentType"),s.append("source_content_type",n)),s.has("source_content_type")||s.append("source_content_type","post")}return{source:r,url:`${n}?${s.toString()}`,isDonutPayment:a}}return{}}},615544:(e,t,i)=>{i.d(t,{y:()=>s});var n=i(22392),o=i(815287);function s(){const e=(0,n.z)();return(0,o.useMemo)((()=>{const t=new URLSearchParams(e.search);return null!==t.get("w")||null!==t.get("z")}),[e])}},885053:(e,t,i)=>{i.d(t,{c:()=>r});var n=i(331635),o=i(327813),s=i(42107);class r{get banner(){return this.bannerProps?.banner}get options(){return this.bannerProps?.options}openCollageModal({banner:e,options:t}){this.bannerProps={banner:e,options:t},this.isModalOpened=!0}constructor(){this.isModalOpened=!1,this.bannerProps=null,this.closeCollageModal=()=>{this.bannerProps=null,this.isModalOpened=!1},(0,o.l_)(this)}}r=(0,n.Cg)([s.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[])],r)},874719:(e,t,i)=>{i.d(t,{s:()=>r});var n=i(331635),o=i(42107),s=i(275860);class r{constructor(){this.emitter=new s.v}}r=(0,n.Cg)([o.z8.container()],r)},2810:(e,t,i)=>{i.d(t,{R:()=>r});var n=i(327813),o=i(400612),s=i(227210);class r{constructor(e,t,i,r){this.userEnv=e,this.storiesEventsService=t,this.externalEvents=i,this.ownerService=r,this.subscriptions=[],this.subscribeOnSeenEvent=e=>{if((0,s.vB)()||(0,s.hP)()){const t=t=>{t.some((t=>t===e))&&this.ownerService.markStoryAsSeen(e)};this.storiesEventsService.events.on(o.i.markSeenAuthor,t),this.subscriptions.push((()=>{this.storiesEventsService.events.off(o.i.markSeenAuthor,t)}))}else this.subscriptions.push(this.externalEvents.subscribeToAllStoriesSeen((t=>{t===e&&this.ownerService.markStoryAsSeen(e)})))},this.dispose=()=>{this.subscriptions.forEach((e=>e())),this.subscriptions=[]},(0,n.l_)(this)}}},82560:(e,t,i)=>{i.d(t,{O:()=>u});var n=i(331635),o=i(327813),s=i(42107),r=i(344550),a=i(99758),d=i(885053);class c{get status(){return this._status}get error(){return this._error}setStatus(e){this._status=e}setError(e){this._status="error",this._error=e}get isReady(){return"ready"===this._status}get isRestored(){return"restored"===this._status}get isError(){return"error"===this._status}get isClosed(){return"closed"===this._status}get isInit(){return"init"===this._status}constructor(e="init",t){this._status=e,this._error=t,(0,o.l_)(this)}}var l=i(375780),h=i(322809),p=i(645189);class u{showModalAttachments({banner:e,options:t}){this.collageModalService.openCollageModal({banner:e,options:t})}async load(e={}){const{branch:t="rev2025"}=e;if(!this.isReady&&!this.isLoading){this.isLoading=!0;try{const e=await i.e(9635).then(i.t.bind(i,309635,23)),{default:n}=e;this.motionKit=n,this.motionKit.init({branch:t,virtualization:!0,directContainer:!0,appApi:{extPlayer:a.ai,showModalAttachments:this.showModalAttachments.bind(this),extractColor:l.Dz}}),(0,o.h5)((()=>{this.isReady=!0,this.isLoading=!1}))}catch(e){(0,o.h5)((()=>{this.isError=!0,this.isLoading=!1,this.error=this.logMotionError("motion init error",e)}))}}}destroy(e){this.instances.get(e)?.destroy()}addConfig(e,t){if(!e||!t)return!1;if(!this.configs.get(e))try{let i;i="string"==typeof t?JSON.parse(t):t,this.configs.set(e,i)}catch(t){return this.errorLogger.log("parse config error",{error:t}),this.banners.set(e,new c("error",t)),!1}return!0}isValid(e){if(!e)return!1;const t=this.banners.get(e);return Boolean(this.configs.get(e))&&!t?.isClosed&&!t?.isError}get isLegacyCabSupported(){return this.motionKit&&"hasPreproc"in this.motionKit&&this.motionKit.hasPreproc?.("legacyCab")}get isExtLoggerEnabled(){return this.userEnv.partConfigEnabled("frontend.motion_ext_logger")}extLogger({type:e,source:t,adData:i},n){const o={event_type:"motion_kit",event_name:n.event,banner_type:e,banner_source:t,ad_data:i};this.adApi.registerAdEvents({events:JSON.stringify([{...o,...n.params}])})}attach({id:e,type:t,source:i,adData:n,target:o,refs:s}){const r=this.configs.get(e),a=this.banners.get(e)||new c;if(!r||!this.motionKit)return a.setError(new Error("not found "+(this.motionKit?"config":"motion"))),this.banners.set(e,a),a;try{const d=this.motionKit.create({container:o,banner:{...r,clickArea:1613},deletionDetector:!0,virtualization:!0,refs:s,onReady:()=>{this.instances.set(e,d),a.setStatus("ready")},onRestored:()=>{this.instances.set(e,d),a.setStatus("restored")},onError:e=>{this.logMotionError("motion lib runtime error",e),a.setError(e)},onClosed:()=>{this.instances.set(e,void 0),a.setStatus("closed")},extLogger:this.isExtLoggerEnabled?e=>this.extLogger({type:t,source:i,adData:n},e):void 0})}catch(e){this.isError=!0,this.isLoading=!1,this.logMotionError("motion lib attach error",e),a.setError(e)}finally{return this.banners.set(e,a),a}}watch({id:e,impressionId:t,type:i,source:n,adData:o,target:s,statistics:r}){return this.motionKit?this.motionKit.watch({target:s,asmName:"VKFeed",banner:{id:e,impression_id:t??e,statistics:r?.filter((e=>function(e){if("object"!=typeof e||null===e)return!1;const t=e;return"string"==typeof t.type&&"string"==typeof t.url}(e)))??[],clickArea:1613},extLogger:this.isExtLoggerEnabled?e=>this.extLogger({type:i,source:n,adData:o},e):void 0}):null}isBannerRendered(e){return this.banners.get(e)?.isReady}logMotionError(e,t){return(e=>!!e&&"object"==typeof e&&"event"in e&&"Error"===e.event)(t)?this.errorLogger.log(`${e} event`,{data:{code:t.code}}):this.errorLogger.log(e,{error:t})}constructor(e,t,i,n){this.errorLogger=e,this.collageModalService=t,this.adApi=i,this.userEnv=n,this.isReady=!1,this.isError=!1,this.isLoading=!1,this.error=void 0,this.configs=new Map,this.instances=new Map,this.banners=new Map,this.errorLogger.setConfig({scope:"MotionService"}),(0,o.Gn)(this,{isReady:o.sH,isLoading:o.sH,isError:o.sH,error:o.sH})}}u=(0,n.Cg)([s.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===r.X?Object:r.X,void 0===d.c?Object:d.c,void 0===h.c?Object:h.c,void 0===p.J?Object:p.J])],u)},628418:(e,t,i)=>{i.d(t,{S:()=>a});var n=i(331635),o=i(42107),s=i(275860),r=function(e){return e.UPDATE_POST="update_post",e.ADD_POST="add_post",e.ARCHIVE_POST="archive_post",e.REVEAL_POST="reveal_post",e}(r||{});class a{constructor(){this.events=r,this.emitter=new s.v}}a=(0,n.Cg)([o.z8.container()],a)},966417:(e,t,i)=>{i.d(t,{P:()=>n});const n="portrait"},933768:(e,t,i)=>{i.d(t,{F:()=>u});var n=i(221020),o=i(815287),s=i(634164),r=i(838565),a=i(475118),d=i(88515),c=i(946918),l=i(236238),h=i(997036);const p="Carousel__disableScroll--y5cUt",u=({children:e,isLoading:t,isShowAllCard:i,linkMore:u="",spacing:m,gridProps:g={},loadingCardProps:_={},showAllCardProps:v={},loadingCard:f,showAllCard:w,disableScroll:y,"data-testid":b,...C})=>{const{mode:k,cardViewType:I,withButton:S}=(0,l.l)(),A=(0,c.B)(),P={columns:"dynamic",rowSpacing:m??12,columnSpacing:m},L={padding:(0,r.D)()?16:"plain"===k?20:12,arrowSize:"s",disableArrowSizeBackwardСompatible:!0},O={size:(0,h.u)(I)?I:"square",cardProps:{withButton:S}};return(0,n.Y)(a.x,{...P,...g,children:(0,n.FD)(a.x.HorizontalScroll,{nextButtonTestId:b&&`${b}-carousel-next-button`,prevButtonTestId:b&&`${b}-carousel-prev-button`,...L,...C,className:(0,s.$)(C.className,y&&p),children:[o.Children.map(e,((e,t)=>{const i=(0,o.isValidElement)(e)&&e.key?e.key:t;return(0,n.Y)(a.x.Item,{children:e},i)})),t&&(0,n.Y)(a.x.Item,{children:f||(0,n.Y)(d.$.LoadingCard,{"data-testid":b,...O,..._})}),i&&(0,n.Y)(a.x.Item,{children:w||(0,n.Y)(d.$.ShowAllCard,{"data-testid":b,...O,...v,href:u,children:A.getLang("groups_feed_recommend_show_all")})})]})})}},17158:(e,t,i)=>{i.d(t,{_:()=>d});var n=i(221020),o=i(815287),s=i(612711),r=i(652097),a=i(933768);const d=({cardNode:e,count:t=5,photoSize:i="square",withButton:d,spacing:c=12,wrapperMode:l="plain",headerType:h="groupHeader",stretched:p,...u})=>{const m=e||(0,n.Y)(s.W.CardSkeleton,{photoSize:i,withoutButton:!d,stretched:p});return(0,n.Y)(s.W,{...u,wrapperMode:l,headerType:h,children:(0,n.Y)(a.F,{disableScroll:!0,linkMore:"",showArrows:!1,spacing:c,children:(0,r.Kz)(t).map(((e,t)=>(0,n.Y)(o.Fragment,{children:m},t)))})})}},236238:(e,t,i)=>{i.d(t,{_:()=>a,l:()=>r});var n=i(221020),o=i(815287);const s=(0,o.createContext)({mode:"plain",cardViewType:"square"}),r=()=>(0,o.useContext)(s),a=({children:e,...t})=>(0,n.Y)(s.Provider,{value:t,children:e})},997036:(e,t,i)=>{i.d(t,{u:()=>n});const n=e=>!["video"].includes(e)},688650:(e,t,i)=>{i.d(t,{T:()=>d,Z:()=>c});var n=i(221020),o=i(815287),s=i(439044),r=i(208182);const a=(0,o.createContext)(void 0);function d({feedConfig:e,children:t}){const i=(0,o.useMemo)((()=>{if(!e)return;const{observers:t,data:i,position:n,getItemUiState:o}=e;return{data:i,getItemUiState:o,observers:t?(0,s.$)([r.U.t35],t):void 0,position:n}}),[e?.observers,e?.data,e?.position,e?.getItemUiState]);return(0,n.Y)(a.Provider,{value:i,children:t})}const c=()=>(0,o.useContext)(a)},55660:(e,t,i)=>{i.d(t,{c:()=>l});var n=i(221020),o=i(612711),s=i(180329),r=i(516427),a=i(46284),d=i(292184);const c=()=>(0,n.FD)(s.s,{direction:"column",children:[(0,n.Y)(r.glH,{Component:a.E,width:"100%",ratio:16/9,borderRadius:0}),(0,n.Y)(d.T,{hasHover:!1,hasActive:!1,subtitle:(0,n.Y)(a.E,{width:100,height:8,borderRadius:3}),maxHeight:52,children:(0,n.Y)(a.E,{width:150,height:12,borderRadius:4})})]}),l=()=>(0,n.Y)(o.W,{wrapperMode:"plain",headerType:"groupHeader",bottomSpacing:!0,children:(0,n.Y)(c,{})})},482392:(e,t,i)=>{i.d(t,{r:()=>s});var n=i(327813),o=i(169151);class s{get pollVotesAvatars(){return this.poll?this.poll.friendsProfiles.length?this.poll.friendsProfiles:this.poll.friendsId.length?this.poll.friendsId?.map((e=>this.ownerService.getUserEntityById(e.id))).filter(Boolean):[]:[]}constructor(e,t,i,s,r,a){this.pollData=e,this.ownerService=t,this.feedItemAttachmentPollService=i,this.snackbar=s,this.langs=r,this.trackCode=a,this.isLoading=!1,this.handleVote=async e=>{this.isLoading||(this.isLoading=!0,await this.feedItemAttachmentPollService.handleVote(this.pollData,Array.isArray(e)?e:[e],this.trackCode??"",(()=>this.snackbar.show({type:"error",text:this.langs.getLang("voting_vote_failed"),duration:2e3}))),(0,n.h5)((()=>{this.isLoading=!1})))},this.handleDeleteVote=async()=>{this.isLoading||(this.isLoading=!0,await this.feedItemAttachmentPollService.deleteVote(this.pollData,this.trackCode??"",(()=>this.snackbar.show({type:"error",text:this.langs.getLang("voting_unvote_failed"),duration:2e3}))),(0,n.h5)((()=>{this.isLoading=!1})))},(0,n.l_)(this),this.poll=new o.s(e)}}},51759:(e,t,i)=>{i.d(t,{W:()=>f});var n=i(221020),o=i(815287),s=i(356035),r=i(651449),a=i(946918),d=i(799649),c=i(772812),l=i(187233),h=i(638945),p=i(423654),u=i(782536),m=i(409698),g=i(193861);const _=(0,s.P)((function({governmentPublicInfoLink:e,modalOpened:t,onClose:i,dismissButtonMode:o,modalComponent:s,modalCardComponent:r}){const d=(0,a.B)();if(!s||!r)return;const c="inside"===o?"l":"m",l=r,h=s;return(0,n.Y)(h,{id:"government-public-modal",isShown:t,type:"card",onClose:i,children:(0,n.Y)(l,{id:"government-public-modal",onClose:i,icon:(0,n.Y)(g.v,{}),title:d.getLang("wall_post_government_modal_title"),description:d.getLang("wall_post_government_modal_subtitle"),actions:e&&(0,n.Y)(u.e,{stretched:!0,align:"center",children:(0,n.Y)(m.$,{href:e,size:c,stretched:"l"===c,children:d.getLang("wall_post_government_modal_button")})}),dismissButtonMode:o})})}));var v=i(916982);const f=(0,s.P)((function({governmentPublicInfoLink:e,dismissButtonMode:t,modalComponent:i,modalCardComponent:s,noPopover:u}){const m=(0,a.B)(),[g,f]=(0,o.useState)(!1),w=()=>{f((e=>!e))};let y=(0,n.Y)(d.K,{hoverMode:"opacity",activeMode:"none",onClick:w,label:m.getLang("wall_post_header_post_government_title"),noPadding:!0,tabIndex:-1,"aria-hidden":!0,children:(0,n.Y)(r.$,{className:(0,c.I)("color_icon_accent")})});return u||(y=(0,n.Y)(v.E,{maxWidth:300,trigger:"hover",arrow:!0,"aria-labelledby":"title",content:(0,n.FD)(l.i,{paddingTop:8,paddingBottom:8,children:[(0,n.Y)(h.tW,{id:"title",children:m.getLang("wall_post_header_post_government_title")}),(0,n.Y)(p.N,{target:"_blank",href:e,children:(0,n.Y)(h.tW,{children:m.getLang("wall_post_header_post_government_action")})})]}),children:y})),(0,n.FD)(n.FK,{children:[y,(0,n.Y)(_,{dismissButtonMode:t,modalCardComponent:s,modalComponent:i,governmentPublicInfoLink:e,modalOpened:g,onClose:w})]})}))},386518:(e,t,i)=>{i.d(t,{l:()=>r});var n=i(221020),o=i(356035),s=i(237582);const r=(0,o.P)((function({entity:e,handleIconStatusClick:t}){const{imageStatusUrl:i,imageStatusAlt:o}=(e=>{const t="image_status"in e?e.image_status:void 0;return{imageStatusUrl:t?.images[0].url,imageStatusAlt:t?.name}})(e);if(i)return(0,n.Y)(s.v,{"aria-hidden":!0,tabIndex:-1,onClick:i=>t?.(e.id,i),size:16,src:i,alt:o,noBorder:!0,withTransparentBackground:!0})}))},575494:(e,t,i)=>{i.d(t,{A:()=>h});var n=i(221020),o=i(356035),s=i(386518),r=i(51759),a=i(789514),d=i(762364),c=i(590878),l=i(180329);const h=(0,o.P)((function({entity:e,currentUserId:t,config:i}){const{handleIconStatusClick:o,dismissButtonMode:h,governmentPublicInfoLink:p,verificationInfoLink:u,verificationInfoTitleLink:m,verificationByBusinessLink:g,verificationByOtherServiceInfoLink:_,ModalCardComponent:v,ModalComponent:f,noGovernmentPopover:w}=i,y=t===e.id,b=Boolean("image_status"in e&&e.image_status),C=Boolean("is_government_organization"in e&&e.is_government_organization&&p),k=Boolean(!C&&e.verified),I=!C&&!e.verified&&"trust_mark"in e&&(e.trust_mark||0)>=2,S=!C&&!e.verified&&"is_verified"in e&&e.is_verified;return(0,n.FD)(l.s,{onClick:e=>e.stopPropagation(),gap:"s",children:[b&&(0,n.Y)(s.l,{entity:e,handleIconStatusClick:o}),C&&(0,n.Y)(r.W,{dismissButtonMode:h,governmentPublicInfoLink:p,modalCardComponent:v,modalComponent:f,noPopover:Boolean(w)}),k&&(0,n.Y)(a.M,{entity:e,verificationInfoLink:u,verificationInfoTitleLink:m}),I&&(0,n.Y)(d.X,{isPremium:2===e.trust_mark,verificationByBusinessLink:g}),S&&(0,n.Y)(c.e,{entity:e,isCurrentOwnerProfile:y,verificationByOtherServiceInfoLink:_})]})}))},762364:(e,t,i)=>{i.d(t,{X:()=>g});var n=i(221020),o=i(356035),s=i(946918),r=i(532795),a=i(482199),d=i(772812),c=i(516427),l=i(187233),h=i(638945),p=i(423654),u=i(799649),m=i(916982);const g=(0,o.P)((function({isPremium:e,verificationByBusinessLink:t}){const i=(0,s.B)(),o=e?(0,n.Y)(r.e,{className:(0,d.I)("color_icon_accent")}):(0,n.Y)(a.T,{className:(0,d.I)("color_icon_secondary")});return t?(0,n.Y)(m.E,{maxWidth:300,trigger:"hover",arrow:!0,"aria-labelledby":"title",content:(0,n.FD)(l.i,{paddingTop:8,paddingBottom:8,children:[(0,n.Y)(h.tW,{id:"title",weight:"2",children:e?i.getLang("groups_main_premium_mark_tooltip_text"):i.getLang("groups_main_confirmed_mark_tooltip_text")}),(0,n.Y)(p.N,{target:"_blank",href:t,children:(0,n.Y)(h.tW,{children:i.getLang("groups_main_confirmed_mark_tooltip_link")})})]}),children:(0,n.Y)(u.K,{target:"_blank",href:t,hoverMode:"opacity",activeMode:"none",label:i.getLang("global_verified_business"),tabIndex:-1,"aria-hidden":!0,noPadding:!0,children:o})}):(0,n.FD)(n.FK,{children:[o,(0,n.Y)(c.s6o,{children:i.getLang("global_verified_business")})]})}))},590878:(e,t,i)=>{i.d(t,{e:()=>g});var n=i(221020),o=i(356035),s=i(482199),r=i(946918),a=i(8439),d=i(772812),c=i(516427),l=i(187233),h=i(638945),p=i(423654),u=i(799649),m=i(916982);const g=(0,o.P)((function({entity:e,isCurrentOwnerProfile:t,verificationByOtherServiceInfoLink:i}){const o=(0,r.B)(),g=(0,n.Y)(s.T,{className:(0,d.I)("color_icon_secondary")});if(!i)return(0,n.FD)(n.FK,{children:[g,(0,n.Y)(c.s6o,{children:o.getLang("global_verified_account")})]});const _=(0,a.H)(e,!1,"gen");let v=o.getLang("wall_post_header_post_verified_by_other_service_text");return t||(v=o.langReplace(o.getLang("wall_post_header_post_verified_by_other_service_not_current_user_text"),{user:_})),(0,n.Y)(m.E,{maxWidth:300,trigger:"hover",arrow:!0,"aria-labelledby":"title",content:(0,n.FD)(l.i,{paddingTop:8,paddingBottom:8,children:[(0,n.Y)(h.tW,{id:"title",weight:"2",children:o.getLang("wall_post_header_post_verified_by_other_service_title")}),(0,n.Y)(h.tW,{children:v}),!t&&(0,n.Y)(p.N,{target:"_blank",href:i,children:(0,n.Y)(h.tW,{children:o.getLang("wall_post_header_post_verified_by_other_service_action")})})]}),children:(0,n.Y)(u.K,{target:"_blank",href:i,hoverMode:"opacity",activeMode:"none",label:o.getLang("global_verified_account"),tabIndex:-1,"aria-hidden":!0,noPadding:!0,children:g})})}))},789514:(e,t,i)=>{i.d(t,{M:()=>_});var n=i(221020),o=i(356035),s=i(482199),r=i(946918),a=i(8439),d=i(772812),c=i(516427),l=i(187233),h=i(423654),p=i(638945),u=i(799649),m=i(118583),g=i(916982);const _=(0,o.P)((function({entity:e,verificationInfoLink:t,verificationInfoTitleLink:i}){const o=(0,r.B)(),_=(0,n.Y)(s.T,{className:(0,d.I)("color_icon_accent")});if(!t||!i)return(0,n.FD)(n.FK,{children:[_,(0,n.Y)(c.s6o,{children:o.getLang("global_verified")})]});const v=(0,m.P)(e),f=(0,a.H)(e,!1,"gen");let w=o.getLang("wall_post_header_post_verified_group_title"),y=o.getLang("wall_post_header_post_verified_group_text");return v||(w=o.getLang("wall_post_header_post_verified_profile_title"),y=o.langReplace(o.getLang("wall_post_header_post_verified_profile_text"),{user:f})),(0,n.Y)(g.E,{maxWidth:300,trigger:"hover",arrow:!0,"aria-labelledby":"title",content:(0,n.FD)(l.i,{paddingTop:8,paddingBottom:8,children:[(0,n.Y)(h.N,{id:"title",target:"_blank",href:i,children:w}),(0,n.Y)(p.tW,{children:y}),(0,n.Y)(h.N,{target:"_blank",href:t,children:(0,n.Y)(p.tW,{children:o.getLang("wall_post_header_post_verified_action")})})]}),children:(0,n.Y)(u.K,{target:"_blank",tabIndex:-1,href:t,hoverMode:"opacity",activeMode:"none",label:o.getLang("global_verified"),"aria-hidden":!0,noPadding:!0,children:_})})}))},89648:(e,t,i)=>{i.d(t,{J:()=>s,d:()=>o});var n=i(9467);const o=e=>{if(e?.length)return(0,n.z2)("feed_action_button_compact_style_fix")?e.find((({type:e,style:t})=>"action_button"===e&&"compact"!==t)):e.find((({type:e})=>"action_button"===e))},s=e=>{if(e?.length)return e.find((({style:e})=>"under_media"===e))}},283996:(e,t,i)=>{function n(e){if(e)return{post_ad_data:e.adData,ad_block_unique_id:e.adBlockUniqueId}}i.d(t,{b:()=>n})},852382:(e,t,i)=>{i.d(t,{G:()=>s,h:()=>o});var n=i(3218);const o=e=>Boolean(e&&e.is_level_supported),s=(e,t,i,o)=>{const s=e.paywall?.snippet.button??e.placeholder?.button;let r;if(e.is_donut&&"open_url"===s?.action?.type){r=s.action?.url;const e=s.action?.away_params;if(r&&e){const t=n.I.stringifyQuery(e),i=r.includes("?")?"&":"?";r=`${r}${i}${t}`}}const a=new URLSearchParams(r?.split("?")[1]),d=a.get("levelId")??e.donut_level_id?.toString()??void 0,c=a.get("source")??void 0,l=((e,t)=>"public"===e&&"post_paywall"===t?{screen:"donut_content_wall",source:"donut_banner_teaser"}:"wall"===e&&"post_paywall"===t||"wall_post"===e&&"post_paywall"===t?{screen:"donut_content_link",source:"donut_banner_teaser"}:"wall_donut"===e&&"post_paywall"===t?{screen:"donut_content_paywall",source:"donut_banner_teaser"}:void 0)(o,c)??{};return l.screen&&(r=`${r}&analytic_screen=${l.screen}`),l.source&&(r=`${r}&source=${l.source}`),t&&(r=`${r}&source_content_id=${t}`),i&&(r=`${r}&source_content_type=${i}`),{url:r,layerQuery:{levelId:d,source:c,sourceContentId:t,sourceContentType:i,...l}}}},202103:(e,t,i)=>{i.d(t,{m:()=>o});var n=i(790564);const o=e=>{const t=e?.filter((e=>"chip"===e.style&&e.chip));return t?(0,n.A)(t,(e=>!1===e.chip?.is_cuttable)):[[],[]]}},439044:(e,t,i)=>{function n(e,t){return e.reduce(((e,i)=>(t[i]&&(e[i]=t[i]),e)),{})}i.d(t,{$:()=>n})},637057:(e,t,i)=>{i.d(t,{K:()=>o});var n=i(144819);const o=e=>{const t=(0,n.WO)({ownerId:e.owner_id,id:e.id});return{pollRawId:t,pollRaw:`${e.is_board?"board_poll":"poll"}${t}`}}},118583:(e,t,i)=>{i.d(t,{P:()=>o,f:()=>n});const n=e=>!!e&&"first_name"in e&&"last_name"in e,o=e=>!!e&&"name"in e},937314:(e,t,i)=>{i.d(t,{G:()=>o});const n=e=>`/wall${e}?drafts=1`,o=({snackbar:e,langs:t,ownerId:i})=>e.show({type:"ok",text:t.getLang("wall_feed_draft_created_text"),bottomAction:{label:t.getLang("wall_feed_draft_created_action_text"),href:n(i),onClick:(t,i)=>{e.hide(i)}}})},674234:(e,t,i)=>{i.d(t,{y:()=>a});var n=i(815287),o=i(85923);const s=[o.O.AUDIO,o.O.AUDIO_PLAYLIST,o.O.PODCAST,o.O.LINK,o.O.PHOTO,o.O.VIDEO,o.O.CLIP,o.O.DOC,o.O.ALBUM,o.O.ARTICLE,o.O.POLL,o.O.MINI_APP,o.O.GRAFFITI,o.O.PRETTY_CARDS],r=[o.O.AUDIO_PLAYLIST],a=(e,t,i=!1)=>(0,n.useMemo)((()=>{const n=[],a=[],d=[],c=[];let l;return e?.forEach((e=>{switch(e.style){case"on_media":a.push(e);break;case"compact":n.push(e);break;case"full":if(e.type===o.O.PRETTY_CARDS)l=e;switch(t?.primary_mode){case"single":(e=>s.includes(e.type))(e)&&(l=e);break;case"carousel":c.push(e);break;case"grid":d.push(e);break;default:(e=>r.includes(e.type))(e)?l=e:d.push(e)}case"chip":i&&e.type===o.O.STICKER&&(l=e)}})),{secondary:n,primary:l,onMedia:a,grid:d,carousel:c}}),[e,t?.primary_mode,i])},861249:(e,t,i)=>{i.d(t,{R:()=>a});var n=i(815287),o=i(694828),s=i(903473),r=i(615544);function a({item:e,index:t,getObserverItem:i,setObserverItem:a,observers:d,onStartView:c,onEndView:l,onIntersecting:h}){const p=(0,n.useRef)(null),u=(0,r.y)(),m=(0,n.useCallback)((i=>{p.current=i,p.current&&d&&(u||Object.entries(d).forEach((([n,o])=>{if(!p.current)return;const r=new s.v({element:p.current,item:e,index:t});a?.(n,r),i&&o&&o.observe(i,e.id)})))}),[u]);return(0,n.useEffect)((()=>{u&&d&&Object.entries(d).forEach((t=>{const[n,o]=t,s=i?.(n,e.id);s&&s.element&&o&&(s&&s.isViewStarted&&(s.endView(),l?.(s,{observerName:n}),s.resetWithTimer()),o.unobserve(s.element))}))}),[u]),(0,n.useEffect)((()=>{if(u)return;let t;const n=n=>{if(!n.detail)return;const{observerName:o,isIntersecting:s}=n.detail,r=i?.(o,e.id);r&&(h?.(n.detail),s&&r.canStartTracking?(r.startView(),c?.(r,n.detail)):!s&&r.isViewStarted&&(r.endView(),l?.(r,n.detail),t=r.resetWithTimer()))};return window.addEventListener((0,o.a)(e.id),n),()=>{window.removeEventListener((0,o.a)(e.id),n),window.clearTimeout(t)}}),[e.id,i,l,c,h,u]),{setRef:m,postRef:p}}},350696:(e,t,i)=>{i.d(t,{I:()=>l});var n=i(815287),o=i(946918),s=i(43924),r=i(610648),a=i(550502),d=i(317764),c=i(461211);const l=({timeInSeconds:e,showFullDate:t})=>{const i=(0,o.B)();return(0,n.useMemo)((()=>{if(!e)return"";const n=Date.now(),o=1e3*e,l=new Date(o);if(o>n||t)return i.date(l,i.getLang("global_short_date_year_time",!0),i.getLang("months_sm_of",!0),{onlyDate:!0});if((0,s.O)(n,o)<60)return i.getLang("wall_post_just_now");const h=(0,r.o)(n,o);if(h<60)return i.numeric(h,i.getLang("wall_post_short_mins_ago",!0));const p=(0,a.M)(n,o);if(p<24)return i.numeric(p,i.getLang("wall_post_short_hours_ago",!0));const u=(0,d.c)(n,o);return u<8?i.numeric(u,i.getLang("wall_post_short_days_ago",!0)):u<365&&(0,c.s)(n,o)?i.date(l,i.getLang("global_short_date",!0),i.getLang("months_sm_of",!0),{onlyDate:!0}):i.date(l,i.getLang("global_date",!0),i.getLang("months_sm_of",!0),{onlyDate:!0})}),[e])}},738771:(e,t,i)=>{i.d(t,{z:()=>Y});var n=i(221020),o=i(187233),s=i(180329),r=i(880414),a=i(423654),d=i(799649),c=i(772812),l=i(237582);const h=({graffiti:e})=>{const{width:t,height:i,url:o}=e,s=((e,t,i)=>t>=i?{width:Math.min(t,e)}:{height:Math.min(i,e)})(350,t,i);return(0,n.Y)(l.v,{alt:"",src:o,loading:"lazy",draggable:"false",...s,keepAspectRatio:!0,noBorder:!0})};var p=i(815287),u=i(862824);const m="CommentCustomAttachments__wrapper--4YgCi";var g=i(42107),_=i(331635),v=i(327813),f=i(570440),w=i(8439),y=i(445426),b=i(273193);class C{get platformConfig(){return this.props.current.platformConfig}get type(){return"original_type"in this.props.current.attachment?this.props.current.attachment.original_type:null}get attachment(){return"custom"in this.props.current.attachment?this.props.current.attachment.custom:null}get postRawId(){return this.props.current.postRawId}get attachmentOwnerId(){if(!this.attachment||!this.type)return;const{ownerId:e}=(0,y.AJ)({type:this.type,[this.type]:this.attachment});return e}get attachments(){return this.props.current.attachments??[]}get onDeleteAudioClick(){return this.props.current.onDeleteAudioClick}get onDeleteLinkClick(){return this.props.current.onDeleteLinkClick}get secondaryAttachment(){if(!this.attachment||!this.type)return null;const{itemId:e,ownerId:t}=(0,y.AJ)({type:this.type,[this.type]:this.attachment}),i=this.attachments.find((0,y.tx)(this.type,e,t));if(i){let e={};return i.audio?e=this.getAudioCompact(i.audio):i.audio_playlist&&(e=this.getAudioPlaylistCompact(i.audio_playlist)),{...i,style:"compact",compact:e}}return null}constructor(e,t,i){this.props=e,this.ownerService=t,this.langs=i,this.getAudioCompact=e=>{let t=[{name:"song_outline"}];return e.album?.thumb&&(t=[{sizes:[{height:270,width:270,url:e.album.thumb.photo_270,type:"x"}]}]),{description:{text:{text:e.artist}},title:{text:{text:e.title}},icons:t}},this.getAudioPlaylistCompact=e=>{const t=e.album?.view??null;let i,n=[{name:"playlist_outline"}];if("main_only"===t){const t=e.main_artists?.map((e=>e.name))?.join(", ")??"";i=this.langs.langReplace(this.langs.getLang("wall_playlist_compact_description_album"),{artists:t})}else if("main_feat"===t||"collection"===t){const t=e.main_artists?.map((e=>e.name))?.join(", ")??"",n=e.featured_artists?.map((e=>e.name))?.join(", ")??"";i=this.langs.langReplace(this.langs.getLang("wall_playlist_compact_description_album"),{artists:n?`${t} feat. ${n}`:t})}else{const t=this.findOwner(e.original?.owner_id||e.owner_id);i=this.langs.langReplace(this.langs.getLang("wall_playlist_compact_description"),{user_name:(0,w.H)(t,!0,"gen")})}if(e.photo)n=[{sizes:[{height:270,width:270,url:e.photo.photo_270,type:"x"}]}];else{const t=e.audios;t&&t.forEach((e=>{e?.album?.thumb&&(n=[{sizes:[{height:270,width:270,url:e.album.thumb.photo_270,type:"x"}]}])}))}return{description:{text:{text:i}},title:{text:{text:e.title}},icons:n}},this.findOwner=e=>{if(e)return this.ownerService.provideUserGroupEntityById(e)},(0,v.l_)(this)}}C=(0,_.Cg)([g.z8.transient(),(0,_.Sn)("design:type",Function),(0,_.Sn)("design:paramtypes",[void 0===g.Ji?Object:g.Ji,void 0===f.v?Object:f.v,void 0===b.Y?Object:b.Y])],C);const{Provider:k,useModel:I}=(0,g.Qd)(C,{initInEffect:!1});var S=i(356035),A=i(523056),P=i(608069),L=i(224173),O=i(946918),E=i(210071),x=i(666843);const Y=(0,g.jn)(k,(0,S.P)((()=>{const e=(0,O.B)(),t=(0,p.useRef)(null),{attachment:i,type:l,postRawId:g,secondaryAttachment:_,onDeleteAudioClick:v,onDeleteLinkClick:f,platformConfig:w,attachmentOwnerId:y}=I(),b=(0,E.z)({getAudioPlayerAdapter:w.getAudioPlayerAdapter,rootElement:t.current,attachPlayerEventHandler:w.attachPlayerEventHandler,loadAudioPlayer:w.loadAudioPlayer});if(!i||!l)return null;if(["mini_app","link","article"].includes(l)){const t="url"in i&&i.url?i.url:"app"in i&&i.app?.share_url?i.app.share_url:"";if(!t)return;const l="description"in i&&i.description?i.description:"title"in i&&i.title?i.title:t,h=new A.o(t);return h.call(P.qO,(0,P.Z7)((({key:t,text:h,mentionId:p,...u})=>(0,n.Y)(o.i,{mode:"vertical",spacing:0,paddingTop:12,paddingBottom:12,className:m,children:(0,n.FD)(s.s,{direction:"row",justify:"space-between",noWrap:!0,align:"center",width:"100%",children:[(0,n.Y)(r.b,{lines:1,children:(0,n.Y)(a.N,{"data-testid":"link",target:"_blank",...u,children:l},t)}),!!f&&(0,n.Y)(d.K,{label:e.getLang("global_delete"),className:(0,c.I)("color_icon_secondary"),hoverMode:"opacity",activeMode:"opacity",noPadding:!0,onClick:()=>f(i),"data-testid":"comment_link_attachment_delete",children:(0,n.Y)(L.X,{})})]})})))),h.getComponent()}return"graffiti"===l?(0,n.Y)(h,{graffiti:i},`attachment-graffiti-${i.id}`):"audio_playlist"!==l&&"audio"!==l||!_?null:(0,n.Y)(x.V,{ownerId:y,platformAudioPlayer:b,children:(0,n.Y)("div",{ref:t,className:m,children:(0,n.Y)(u.C,{platformConfig:w.secondaryAttachmentList,rawId:g,attachments:[_],onDeleteClick:v})})})})))},137598:(e,t,i)=>{i.d(t,{l:()=>U,n:()=>$});var n=i(221020),o=i(523056),s=i(802404),r=i(423654),a=i(608069),d=i(281197),c=i(118583),l=i(8439),h=i(151884),p=i(356035),u=i(42107),m=i(187233),g=i(999051),_=i(401623),v=i(876126),f=i(638945),w=i(418356),y=i(782536),b=i(409698),C=i(180329),k=i(946918),I=i(331635),S=i(327813),A=i(916533),P=i(273193),L=i(837170),O=i(208712),E=i(819300),x=i(570440),Y=i(725308),M=i(7258);class T{get mentionedOwnerId(){return this.props.current.ownerId}get mentionedOwner(){return this.ownerService.provideUserGroupEntityById(this.mentionedOwnerId,!0)}get mentionedOwnerName(){return this.mentionedOwner?this.ownerService.getOwnerNameById(this.mentionedOwnerId):""}get mentionedOwnerPhoto(){if(this.mentionedOwner)return this.ownerService.getUserGroupPhotoSrc(this.mentionedOwnerId)}get isGroup(){return Y.z.isGroupId(this.mentionedOwnerId)}get config(){return this.props.current.config}get canOpenChat(){if(!this.config.openChat||!this.mentionedOwner)return!1;const e="can_message"in this.mentionedOwner&&this.mentionedOwner.can_message||"can_write_private_message"in this.mentionedOwner&&this.mentionedOwner.can_write_private_message;return Boolean(e&&!this.mentionedOwner?.deactivated)}get usersStackPhotos(){if(!this.mentionedOwner)return[];const e=[];if(this.isGroup&&"members_preview"in this.mentionedOwner){const t=this.mentionedOwner.members_preview?.friends_ids??[],i=this.mentionedOwner.members_preview?.members_ids??[];e.push(...t.slice(0,3),...i.slice(0,3))}else{if(!("mutual"in this.mentionedOwner))return[];{const t=this.mentionedOwner.mutual?.users??[];e.push(...t.slice(0,3))}}if(!e.length)return[];const t=e.slice(0,3);let i=Array.from(this.ownerService.getCachedUsers(t).values());return i.length<t.length&&this.fetchUsersInStack(t),i.length?i.map((e=>e.photo_50??"")):t.map((()=>""))}get usersStackText(){if(this.mentionedOwner){if(this.isGroup&&"members_preview"in this.mentionedOwner){const e=this.mentionedOwner.members_preview?.members_count;return e?this.langs.langReplace(this.langs.numeric(e,this.langs.getLang("wall_post_comment_mention_members",!0)),{count:(0,M.B)(e)}):void 0}if("mutual"in this.mentionedOwner){const e=this.mentionedOwner.mutual?.count;return e?this.langs.langReplace(this.langs.numeric(e,this.langs.getLang("wall_post_user_mention_mutual",!0)),{count:(0,M.B)(e)}):void 0}}}get isAnonymous(){return!this.authService.isAuthorized}get currentUserId(){return this.authService.userId??void 0}get subscribing(){return this.ownerService.isSubscribingOnOwnerById(this.mentionedOwnerId)}get subscribed(){return this.ownerService.isMemberOrMembershipRequested(this.mentionedOwnerId)}get canToggleSubscription(){return!this.isAnonymous||Boolean(this.config.openAnonymousBox)}get subtitle(){return this.isGroup?this.mentionedOwner?.status:void 0}get userLastSeenTime(){return this.mentionedOwner&&"last_seen"in this.mentionedOwner?this.mentionedOwner?.last_seen?.time:void 0}constructor(e,t,i,n,o,s){this.props=e,this.authService=t,this.userProvider=i,this.groupsProvider=n,this.ownerService=o,this.langs=s,this.ensure=async()=>{const e=this.ownerService.provideUserGroupEntityById(this.mentionedOwnerId,!0);if(Y.z.isUserId(this.mentionedOwnerId)&&!e){const e=await this.userProvider.ensure({user_ids:[this.mentionedOwnerId],fields:L.u.split(",")});(0,S.h5)((()=>{const t=e.get(this.mentionedOwnerId);t?.data&&this.ownerService.setUserGroupEntity([t.data])}))}Y.z.isGroupId(this.mentionedOwnerId)&&this.groupsProvider.ensureFetchGroupById({groupId:Math.abs(this.mentionedOwnerId),fields:L.u.split(",")})},this.fetchUsersInStack=async e=>{const t=await this.userProvider.ensure({user_ids:e,fields:L.u.split(",")});(0,S.h5)((()=>{const e=Array.from(t.values())?.map((e=>e.data));this.ownerService.setUserGroupEntity(e)}))},this.openChat=e=>this.config.openChat?.(e,this.mentionedOwnerId,"post-comment-user-mention"),this.onToggleSubscription=e=>{this.isAnonymous?this.config.openAnonymousBox?.(e,this.mentionedOwnerId,"post_comment_mention"):this.ownerService.toggleSubscriptionByOwnerId(this.mentionedOwnerId,{ref:"post_comment_mention"})},this.getExtraSubtitle=e=>{if(!this.mentionedOwner)return;if(this.isGroup)return this.mentionedOwner?.activity;if(!e)return;const t="sex"in this.mentionedOwner&&this.mentionedOwner?.sex?this.mentionedOwner?.sex:0;return this.langs.langReplace(this.langs.sex(t,this.langs.getLang("wall_post_user_mention_last_seen",!0)),{last_seen:e})},(0,S.l_)(this),this.ensure()}}T=(0,I.Cg)([u.z8.transient(),(0,I.Sn)("design:type",Function),(0,I.Sn)("design:paramtypes",[void 0===u.Ji?Object:u.Ji,void 0===A.u?Object:A.u,void 0===O.T?Object:O.T,void 0===E.s?Object:E.s,void 0===x.v?Object:x.v,void 0===P.Y?Object:P.Y])],T);const{Provider:R,useModel:D}=(0,u.Qd)(T,{initInEffect:!1});var B=i(350696),F=i(575494);const N=(0,p.P)((function(){const{currentUserId:e,mentionedOwner:t,mentionedOwnerName:i,mentionedOwnerPhoto:o,usersStackPhotos:s,usersStackText:r,canOpenChat:a,openChat:d,config:c,subscribing:l,subscribed:h,subtitle:p,userLastSeenTime:u,getExtraSubtitle:I,canToggleSubscription:S,onToggleSubscription:A}=D(),P=(0,k.B)(),L=(0,B.I)({timeInSeconds:u});return t?(0,n.Y)(m.i,{mode:"vertical",spacing:0,paddingTop:4,paddingBottom:4,onClick:e=>e.stopPropagation(),children:(0,n.Y)(_.z,{before:(0,n.Y)(v.g,{size:40,src:o,alt:i}),beforeAlign:"start",subtitle:p,extraSubtitle:(0,n.Y)(f.tW,{children:I(L)}),bottom:r?(0,n.Y)(w.f,{photos:s,children:r}):void 0,actions:(0,n.FD)(y.e,{mode:"horizontal",gap:"s",stretched:!0,children:[S&&(0,n.Y)(b.$,{size:"s",mode:h?"secondary":"primary",appearance:"accent",loading:l,onClick:A,children:h?P.getLang("wall_post_user_mention_followed"):P.getLang("wall_post_user_mention_follow")}),a&&(0,n.Y)(b.$,{size:"s",appearance:"accent",mode:"secondary",onClick:d,children:P.getLang("wall_post_user_mention_write_message")})]}),children:(0,n.FD)(C.s,{direction:"row",justify:"start",align:"center",gap:"s",children:[(0,n.Y)(C.s.Item,{children:i}),(0,n.Y)(F.A,{currentUserId:e,entity:t,config:c})]})})}):(0,n.Y)(m.i,{children:(0,n.Y)(g.y,{})})})),z=(0,u.jn)(R,N);var j=i(916982);function U(e,t){return e?e&&(0,c.f)(e)?(0,l.H)(e,!1,"dat"):t.getLang("wall_replied_to_group"):""}const W=e=>{const t=e.toLowerCase().trim(),i=t.match(/^id(\d+)$/),n=t.match(/^club(\d+)$/),o=i&&Number.parseInt(i[1]),s=n&&-Number.parseInt(n[1]);return o??s};function $(e,{onLinkClick:t,renderDisplayedText:i=e=>e,ownerMentionCardConfig:c}){const l=new o.o(e);return l.call(h.d,((e,i,o)=>{const s=i.split("@")[1]??"",a=s?`/${encodeURIComponent(s)}?q=${encodeURIComponent(o)}`:`/search/statuses?q=${encodeURIComponent(o)}`;return(0,n.Y)(r.N,{href:a,"data-testid":"hashtag",target:"_blank",onClick:e=>{e.stopPropagation(),t?.({type:"hashtag",value:i})},children:i},e)})),l.call(s.p,(0,s.g)((({key:e,text:o,href:s})=>(0,n.Y)(r.N,{href:s,onClick:e=>{e.stopPropagation(),t?.({type:"link",value:s})},"data-testid":"link",target:"_blank",children:i(o)},e)))),l.call(d.o,(0,d.g)((({key:e,text:o,mentionId:s,...a})=>{const d=W(s),l=d&&c,h=(0,n.Y)(r.N,{onClick:e=>{e.stopPropagation(),t?.({type:"mention",value:s})},target:"_blank","data-testid":"mention",...a,children:i(o)},l?void 0:e);return l?(0,n.Y)(j.E,{trigger:"hover",placement:"top",arrow:!0,content:(0,n.Y)(z,{ownerId:d,config:c}),children:h},e):h}))),l.call(a.qO,(0,a.Z7)((({key:e,text:o,mentionId:s,...a})=>{const d=s?W(s):null,l=d&&c,h=(0,n.Y)(r.N,{onClick:e=>{e.stopPropagation(),t?.({type:s?"mention":"link",value:s||a.href})},"data-testid":"link",target:"_blank",...a,children:i(o)},l?void 0:e);return l?(0,n.Y)(j.E,{trigger:"hover",placement:"top",arrow:!0,content:(0,n.Y)(z,{ownerId:d,config:c}),children:h},e):h}))),l.getComponent(i)}},587654:(e,t,i)=>{i.d(t,{G:()=>D,s:()=>B});var n=i(331635),o=i(327813),s=i(42107),r=i(989078),a=i(561412),d=i(127574),c=i(802872),l=i(222302),h=i(560527),p=i(582876),u=i(570440),m=i(400612),g=i(144819),_=i(137598),v=i(651253),f=i(916533),w=i(97929),y=i(273193),b=i(645189),C=i(946927),k=i(725308),I=i(160010),S=i(931198),A=i(978178),P=i(724567),L=i(928959),O=i(196497),E=i(124102),x=i(851417),Y=i(759076),M=i(2810),T=i(874719);class R{[s.Ts](){this.hasUnseenStories&&this.feedStoriesService.subscribeOnSeenEvent(this.comment.from_id)}get comment(){return this.props.current.comment}get kitComment(){const e=this.comment.donut_badge_info?.comment_text;return{...this.comment,text:this.hasDonutBadge?e??"":this.commentText,attachments:(0,P.w)(this.comment.attachments,this.langs)}}get commentText(){return this.commentTextParser?.getText()||this.comment?.text||""}get commentTextParser(){return this.comment?.text?new E.$(this.comment.text,!0):void 0}get config(){return this.props.current}get hasDonutBadge(){return Boolean(this.isBadgesEnabled&&38===this.comment.badge_id&&this.config.DonutBadge)}get isBadgesEnabled(){return this.userEnv.partConfigEnabled("awards")}get feedItemRawId(){return this.props.current.feedItemRawId}get replyCommentId(){return this._replyCommentId}get owner(){return this.commentsService.getOwner(this.comment.from_id)}get commentParentOwner(){return this.parentOwner?(0,x.U)(this.parentOwner,k.z.isUserId(Number(this.comment.reply_to_user))):void 0}get commentParentOwnerText(){return!(this.comment.parents_stack?.[0]===this.comment.reply_to_comment)&&this.parentOwner?(0,_.l)(this.parentOwner,this.langs):void 0}get postOwner(){return this.commentsService.getOwner(this.comment.owner_id)}get postAuthor(){return this.commentsService.getOwner(this.store.getCommentsMetaByPost(this.comment.postRawId)?.post_author_id)}get parentOwner(){return this.commentsService.getOwner(this.comment.reply_to_user,this.userEnv.partConfigEnabled("feed_fix_get_owner_console_error"))}get parentOwnerUrl(){return(0,S.D)(this.parentOwner)}get hideActionsInThreeDots(){return Boolean(this.props.current.hideActionsInThreeDots)}get isInThread(){return Boolean(this.comment.reply_to_comment||this.comment.parents_stack?.length)}get repliedComment(){if(!this.comment.reply_to_comment)return;const e=r.u.replyComment(this.comment),t=this.store.getComment(e);return t||this.fetchComment(this.comment.reply_to_comment),t}get repliedCommentTextParser(){return this.repliedComment?.text?new E.$(this.repliedComment.text,!0):void 0}get repliedCommentText(){return this.repliedCommentTextParser?.getText()||this.repliedComment?.text||""}get kitRepliedComment(){if(this.repliedComment)return{...this.repliedComment,text:this.repliedCommentText,attachments:(0,P.w)(this.repliedComment.attachments,this.langs)}}get isAuthor(){return!!this.comment?.is_from_post_author}get canEdit(){const e=this.comment.attachments?.some((e=>"sticker"===e.type));return Boolean(this.comment.can_edit&&!e)}get canReport(){const e=this.comment.from_id;let t=!1;if(e&&k.z.isGroupId(e)){const i=this.ownerService.provideUserGroupEntityById(e);t=!!(i&&"is_admin"in i&&i.is_admin)}return e!==this.currentUserId&&!t}get canShowLikesModal(){return void 0!==this.comment.likes?.count&&this.comment.likes?.count>0}get canDelete(){const e=this.comment.from_id===this.currentUserId||this.isCurrentUserAdmin;return Boolean(this.comment.can_delete||e)}get ownerUrl(){return(0,S.D)(this.owner)}get currentUserId(){return this.authService.userId??0}get isCurrentUserAdmin(){return this.postOwner&&"is_admin"in this.postOwner?Boolean(this.postOwner.is_admin&&this.postOwner.admin_level&&this.postOwner.admin_level>A.y.MODERATOR):!(!this.postOwner?.id||"is_member"in this.postOwner)&&this.postOwner.id===this.currentUserId}get hasUnseenStories(){return Boolean(this.owner?.has_unseen_stories)}get hideReplyButton(){return Boolean(this.config.hideReplyButton)}get firstThreadCommentAuthor(){return this.commentsService.getOwner(this.thread?.firstFromId)}get hasAuthorReplies(){return Boolean(this.thread&&"author_replied"in this.thread&&this.thread.author_replied||this.threadComments.find(((e,t)=>t>0&&e.is_from_post_author)))}get isRootWithoutThread(){return!this.isInThread&&!this.thread?.count}get hideShareButton(){return Boolean(this.config.hideShareButton||this.hasDonutBadge)}get hidePagination(){return Boolean(this.config.hidePagination)}get hasGroupOwnerPermsForLike(){return Boolean(this.comment.likes?.can_like_by_group)}get threadComments(){return this.store.getCommentsByIds(Array.from(this._threadCommentsIds))}get thread(){return this.store.getThreadMeta(this.comment.rawId)}get nextTreadsIsLoading(){return"loading"===this.requestNextCommentsState.status}get nextFrom(){return this.thread?.next_from||""}get canLoadNextThread(){return Boolean(this.nextFrom)}get prevTreadsIsLoading(){return"loading"===this.requestPrevCommentsState.status}get prevFrom(){return this.thread&&"prev_from"in this.thread&&this.thread.prev_from||""}get canLoadPrevThread(){return Boolean(this.prevFrom)}get hasLikeFromGroupOrAuthor(){return Boolean(this.comment.likes?.group_liked||this.comment.likes?.author_liked)}get authorLikeTooltipText(){return this.postOwner&&"is_admin"in this.postOwner&&this.postOwner.is_admin?this.comment.likes?.group_liked?this.langs.getLang("intro_hint_description_feed_author_like_delete"):this.langs.getLang("intro_hint_description_feed_author_like_add"):this.langs.getLang("intro_hint_description_feed_author_liked")}get isThreadDeleted(){return"deletedWithThread"===this.comment.state}get isReportSent(){return this._isReportSent}get obsceneTextAlertBoxOpened(){return this._obsceneTextAlertBoxOpened}get obsceneTextAlertBoxConfig(){return this.props.current.obsceneTextAlertBox}get commentTextObsceneWordsCount(){return this.commentTextParser?.obsceneWordsCount||0}get hasCommentClick(){return Boolean(this.props.current.onCommentClick)}get threadId(){if(this.comment.parents_stack?.length)return this.comment.parents_stack[0]}get trackCode(){return this.props.current.trackCode}get screen(){return this.props.current.screen}get commentUrl(){const{postRawId:e,id:t,parents_stack:i}=this.comment,n=new URLSearchParams;return void 0!==t&&n.append("reply",t.toString()),void 0!==i?.[0]&&n.append("thread",i[0].toString()),`/wall${e}?${n.toString()}`}[s.zr](){this.feedStoriesService.dispose()}constructor(e,t,i,n,s,d,c,l,h,p,u,m,_,v,f,w){this.props=e,this.commentsService=t,this.store=i,this.errorLogger=n,this.commentsLikesService=s,this.authService=d,this.mutationService=c,this.feedErrorService=l,this.snackbar=h,this.langs=p,this.userEnv=u,this.postHandlers=m,this.ownerService=_,this.storiesEventsService=v,this.externalEvents=f,this.commentActionsService=w,this.isEditMode=!1,this.isThreadCollapsed=!1,this._replyCommentId=null,this._obsceneTextAlertBoxOpened=!1,this._isReportSent=!1,this.feedStoriesService=new M.R(this.userEnv,this.storiesEventsService,this.externalEvents,this.ownerService),this.requestNextCommentsState=new a.X(this.commentsService.fetchThreadComments.bind(this.commentsService),this.errorLogger),this.requestPrevCommentsState=new a.X(this.commentsService.fetchThreadComments.bind(this.commentsService),this.errorLogger),this.getCommentTextFormatArray=e=>this.commentTextParser?.getTextFormatArray(e)||e,this.getRepliedCommentTextFormatArray=e=>this.repliedCommentTextParser?.getTextFormatArray(e)||e,this.toggleIsThreadCollapsed=()=>{!this.threadComments.length&&this.thread?.count&&this.isThreadCollapsed&&this.fetchNextThreadComments(),this.isThreadCollapsed=!this.isThreadCollapsed,this.isThreadCollapsed&&this.scrollToComment(r.u.comment(this.comment))},this.onReplyClick=e=>{this.config.onReplyClick?.(e,this.onCommentCreated),this._replyCommentId=e},this.fetchComment=async(e,t)=>{try{return await this.commentsService.fetchComment({owner_id:this.comment.owner_id,comment_id:e},!1,t)}catch(e){return void((0,I.d)(e)&&e.error.error_msg.includes("post was not found")||this.errorLogger.log(e))}},this.onCommentCreated=async({commentId:e,commentOwnerId:t,isPopupSticker:i,shouldResetReply:n})=>{if(i&&this.config.addIdToAutoplayStickerPopup?.(e),this.isThreadCollapsed=!1,this.canLoadNextThread)n&&this.resetReplyCommentId(),await this.fetchNextThreadComments(!0);else{const t=await this.fetchComment(e,this.comment.rawId);(0,o.h5)((()=>{if(t){const e=(0,g.WO)({id:t.id,ownerId:t.from_id});this._threadCommentsIds.add(e)}n&&this.resetReplyCommentId()}))}(0,o.h5)((()=>{this.scrollToComment((0,g.WO)({id:e,ownerId:t}))}))},this.onCommentEdited=()=>{this.setIsEditMode(!1)},this.resetReplyCommentId=()=>{this._replyCommentId=null},this.fetchNextThreadComments=async e=>{this.nextTreadsIsLoading||(await this.requestNextCommentsState.fetch({commentRawId:this.comment.rawId,count:e?100:this.props.current.threadCountForPagination,owner_id:this.comment.owner_id,post_id:this.comment.post_id,comment_id:this.comment.id,next_from:this.nextFrom},{onSuccess:e=>{e?.items?.forEach((e=>this._threadCommentsIds.add(r.u.comment(e))))},onError:()=>{this.showError(this.langs.getLang("wall_cannot_get_comments_error_text"))}}),e&&this.nextFrom&&await this.fetchNextThreadComments(!0))},this.fetchPrevThreadComments=async()=>{this.prevTreadsIsLoading||this.requestPrevCommentsState.fetch({commentRawId:this.comment.rawId,count:this.props.current.threadCountForPagination,owner_id:this.comment.owner_id,post_id:this.comment.post_id,comment_id:this.comment.id,prev_from:this.prevFrom},{onSuccess:e=>{if(!e?.items?.length)return;const t=e.items.map((e=>r.u.comment(e)));this._threadCommentsIds=new Set([...t,...this._threadCommentsIds])},onError:()=>{this.showError(this.langs.getLang("wall_cannot_get_comments_error_text"))}})},this.deleteComment=async()=>{try{await this.commentsService.deleteComment(this.comment,this.isInThread||this.isRootWithoutThread),(0,o.h5)((()=>{this.isRootWithoutThread&&this.props.current.onCommentDeleted?.()}))}catch(e){this.showError(this.langs.getLang("wall_cannot_delete_comment_error_text"),e)}},this.setIsEditMode=e=>{this.isEditMode=e,this.props.current.onEditClick?.(e?this.comment:null)},this.restoreComment=async()=>{try{await this.commentsService.restoreComment(this.comment,this.isInThread||this.isRootWithoutThread),(0,o.h5)((()=>{this.isRootWithoutThread&&this.props.current.onCommentRestored?.()}))}catch(e){this.showError(this.langs.getLang("wall_cannot_restore_comment_error_text"),e)}},this.deleteThread=async()=>{try{await this.commentsService.deleteThread(this.comment)}catch(e){this.showError(this.langs.getLang("wall_cannot_delete_thread_error_text"),e)}},this.restoreThread=async()=>{try{await this.commentsService.restoreThread(this.comment)}catch(e){this.showError(this.langs.getLang("wall_cannot_restore_thread_error_text"),e)}},this.reportComment=()=>{this.feedErrorService.canProceedOnClick()&&this.comment.owner_id&&this.comment.id&&this.props.current.onReport(this.comment.owner_id,this.comment.id,(()=>{(0,o.h5)((()=>{this._isReportSent=!0}))}))},this.shareComment=()=>{this.feedErrorService.canProceedOnClick()&&this.props.current.onShare(this.comment)},this.showError=(e,t)=>{t&&this.errorLogger.log(t),this.snackbar.show({type:"error",text:e,subtitle:this.langs.getLang("wall_comment_error_subtitle")})},this.showLikesList=()=>{this.feedErrorService.canProceedOnClick()&&(this.userEnv.partConfigEnabled("frontend.feed_post_reactions_modal")?this.props.current.onOpenReactions?.({rawId:this.comment.wallRawId,itemType:"comment"}):this.props.current.onShowLikesList?.({comment:this.comment,type:"wall_reply",reopenPostLayer:this.props.current.reopenPostLayerAfterLegacyLikesLayer,rawId:this.feedItemRawId}),this.comment.owner_id&&this.comment.post_id&&this.commentActionsService.emitter.emit("showCommentLikesModal",{postId:this.comment.post_id,postOwnerId:this.comment.owner_id,commentId:this.comment.id}))},this.toggleCommentLikes=async(e,t,i)=>{try{await this.commentsLikesService.toggleCommentLikes(this.comment,e,t,i)}catch(e){this.errorLogger.log(e)}},this.goToParentComment=()=>{this.comment.reply_to_comment&&this.comment.reply_to_user&&this.scrollToComment(r.u.replyComment(this.comment))},this.getFormatDateTime=e=>this.langs.date(new Date(1e3*e),this.langs.getLang("global_capital_date_year_time",!0),this.langs.getLang("months_sm_of",!0)),this.onPhotoClick=(e,t)=>this.config.onPhotoClick(this.comment.postRawId,e,t),this.onVideoClick=(e,t)=>this.config.onVideoClick(this.comment.postRawId,e,t),this.onStickerClick=(e,t)=>{this.config.onStickerClick?this.config.onStickerClick?.(e):this.commentActionsService.emitter.emit("openStickerKeyboard",{productId:t})},this.handleCloseObsceneTextAlertBox=()=>{this._obsceneTextAlertBoxOpened=!1},this.onBlurredObsceneTextClick=e=>{(0,L.T)(e),this._obsceneTextAlertBoxOpened=!0},this.handleCommentClick=e=>{this.props.current.onCommentClick?.(e,this.comment.id,this.threadId)},this.handleCommentDateClick=e=>{this.props.current.onCommentClick&&((0,L.T)(e),this.handleCommentClick(e))},this.scrollToComment=e=>{this.props.current.scrollToComment?.(e)},this.handleOwnerAvatarClick=async(e,t)=>{if(e)if(this.hasUnseenStories&&void 0!==e.id&&!(0,O.X)(t?.nativeEvent)){const t="group"===e.kind?k.z.convertGroupIdToOwnerId(e.id):e.id;if(this.postHandlers.click.onOpenStory({feedItemId:this.feedItemRawId,entryPoint:"comments_photo"}),this.props.current.openStoriesInNewTab){const e=await this.ownerService.getFirstStory(t);return void(e&&window.open(`/feed?w=story${e.owner_id}_${e.id}/owner_feed${e.owner_id}`,"_blank"))}this.props.current.onOpenStories&&this.props.current.onOpenStories({storyOwnerId:t,reopenPostLayer:this.props.current.reopenPostLayerAfterLegacyStoriesLayer,rawId:this.feedItemRawId})}else"user"===e.kind?this.postHandlers.click.onOpenUser({feedItemId:this.feedItemRawId}):"group"===e.kind&&this.postHandlers.click.onOpenGroup({feedItemId:this.feedItemRawId})},this.handleOwnerClick=e=>{e&&("user"===e.kind?this.postHandlers.click.onOpenUser({feedItemId:this.feedItemRawId}):"group"===e.kind&&this.postHandlers.click.onOpenGroup({feedItemId:this.feedItemRawId}))},this.isThreadCollapsed=Boolean(e.current.isThreadCollapsed),this._threadCommentsIds=new Set(this.props.current.initialCommentsIdsForThread),(0,o.l_)(this)}}R=(0,n.Cg)([s.z8.transient(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===s.Ji?Object:s.Ji,void 0===d.y?Object:d.y,void 0===c.g?Object:c.g,void 0===v.v?Object:v.v,void 0===l.g?Object:l.g,void 0===f.u?Object:f.u,void 0===h.z?Object:h.z,void 0===p.m?Object:p.m,void 0===w.q?Object:w.q,void 0===y.Y?Object:y.Y,void 0===b.J?Object:b.J,void 0===Y.i?Object:Y.i,void 0===u.v?Object:u.v,void 0===m.G?Object:m.G,void 0===C.r?Object:C.r,void 0===T.s?Object:T.s])],R);const{Provider:D,useModel:B}=(0,s.Qd)(R,{initInEffect:!1})},235677:(e,t,i)=>{i.d(t,{v:()=>a});var n=i(327813),o=i(437260),s=i(702441);const r="photo_market_tags_adult_confirm";class a{get trackCode(){return this.props.item.track_code??this.props.trackCode??""}get isPhotoMarketTagsEnabled(){return this.userEnv.partConfigEnabled("feed_photo_market_tags")}async init(){if(!this.isPhotoMarketTagsEnabled||!this.props.item.attachments)return;const e=this.props.item.attachments?.filter((e=>"photo"===e.type&&!!e.photo?.has_tags));if(e?.length){(0,n.h5)((()=>{this.hasAnyPhotoMarketTags=!0}));const t=await Promise.all(e.map((async e=>{const t=await this.tagsApi.getList({type:"photo",owner_id:e.photo?.owner_id||0,item_id:e.photo?.id||0,access_key:e.photo?.access_key});return{id:e.photo?.id,items:t.items}})));(0,n.h5)((()=>{for(const{id:e,items:i}of t)this.photoMarketTagsList.set(e||0,i),i.forEach((e=>{this.feedPostActionAnalytics.sendProductTagShow({entry_point:"timer",is_market:1,carousel_image_index:e.id,item:{track_code:this.trackCode,id:e.product_id}}),this.marketItemViewAnalytics.viewItem({itemId:e.product_id,ownerId:e.owner_id,itemIdx:e.id,screen:this.metaData.get().screen,refSource:"post"})}))}))}}hasAttachmentMarketTags(e){return!(!e.photo||!e.photo?.id)&&e.photo.has_tags}constructor(e,t,i,a,d,c,l,h){this.props=e,this.tagsApi=t,this.userEnv=i,this.marketItemViewAnalytics=a,this.productionStats=d,this.sessionStorage=c,this.feedErrorService=l,this.metaData=h,this.photoMarketTagsList=new Map,this.hasAnyPhotoMarketTags=!1,this.showAdultModal=!1,this.ageConfirmed=!1,this.confirmAge=()=>{this.sessionStorage.setItem(r,"true"),this.ageConfirmed=!0},this.setAdultModal=e=>{this.showAdultModal=e},this.getAttachmentMarketTags=e=>{if(this.hasAttachmentMarketTags(e)&&this.photoMarketTagsList.size&&e.photo?.id)return this.photoMarketTagsList.get(e.photo?.id)},this.getById=e=>this.photoMarketTagsList.get(e),this.logMarketProductCardOpen=(e,t)=>{this.feedPostClickAnalytics.sendProductCardOpenClick({entry_point:"pin",is_market:1,carousel_image_index:t,item:{id:e}})},this.logMarketTagsLabelChange=(e,t)=>{e&&t?t.forEach((e=>{this.feedPostActionAnalytics.sendProductTagShow({entry_point:"shopping_bag",is_market:1,carousel_image_index:e.id,item:{track_code:this.trackCode,id:e.product_id}})})):this.feedPostClickAnalytics.sendProductTagsHide({entry_point:"shopping_bag",is_market:1})},this.onGetMarketItemUrl=e=>e.is_adult&&!this.ageConfirmed?void 0:this.props.constructProductLink({refScreen:this.metaData.get().module,refSource:"post",adsLabel:e.link?.product?.ads_label,itemId:e.product_id,ownerId:e.owner_id}),this.onClickMarketItem=e=>{if(this.feedErrorService.canProceedOnClick())if(e.is_adult&&!this.ageConfirmed)this.setAdultModal(!0);else{const t=this.onGetMarketItemUrl(e);t&&(window.open(t,"_blank","noopener,noreferrer"),this.logMarketProductCardOpen(e.product_id,e.id))}};const p=this.metaData.get().screen;this.ageConfirmed=Boolean(this.sessionStorage.getItem(r))||!1,this.feedPostClickAnalytics=new o.F({trackCode:this.trackCode,screen:p,ref:p},this.productionStats),this.feedPostActionAnalytics=new s.r({trackCode:this.trackCode,screen:p},this.productionStats),this.init(),(0,n.l_)(this)}}},862824:(e,t,i)=>{i.d(t,{C:()=>ie});var n=i(221020),o=i(356035),s=i(42107),r=i(815287),a=i(637956),d=i(982444),c=i(223926),l=i(992999),h=i(898018),p=i(331635),u=i(327813),m=i(570440),g=i(759076);class _{get action(){return this.props.current.platformConfig.getAction((()=>this.postHandlers.click.onPhotoOpen({feedItemId:this.props.current.rawId})))}constructor(e,t,i){this.props=e,this.postHandlers=t,this.ownerService=i,this.findOwner=e=>{if(e)return this.ownerService.provideUserGroupEntityById(e)},(0,u.l_)(this)}}_=(0,p.Cg)([s.z8.transient(),(0,p.Sn)("design:type",Function),(0,p.Sn)("design:paramtypes",[void 0===s.Ji?Object:s.Ji,void 0===g.i?Object:g.i,void 0===m.v?Object:m.v])],_);const{Provider:v,useModel:f}=(0,s.Qd)(_,{initInEffect:!1});var w=i(946918),y=i(8439);const b="recent_outline",C="delete_outline",k="do_not_disturb_outline",I="lock_outline",S=1;var A=i(85923);const P="square",L=(e,t)=>{const i=e.icons;return i?i.map((e=>((e,t)=>{if(e.image_url)return{style:e.style?e.style:P,sizes:[{url:e.image_url,width:0,height:0}]};const i=e.source_id&&t[e.source_id]?t[e.source_id]:null,n=e.sizes?e.sizes:[],o=i?(e=>[{url:e.photo_400,size:400},{url:e.photo_200,size:200},{url:e.photo_100,size:100},{url:e.photo_50,size:50}].filter((e=>!!e.url)).map((({size:e,url:t})=>({url:t,width:e,height:e}))))(i):n;let s=null;return o.length&&(s={style:e.style?e.style:P,sizes:o.map((e=>{const t=e.url?e.url:e.src;return{...e,url:t||""}}))}),s})(e,t))).filter((e=>!!e)):[]},O=(e,t)=>{const{imageOwnerBySourceIdMap:i}=t,n=((e,t)=>{const{owner:i,descriptionOwner:n}=t,o=i?(0,y.H)(i,!0,void 0):e.title?.text?.text;let s=e.description?.text?.text;return!s&&n&&(s=(0,y.H)(n,!0,void 0)),{description:s,title:o||"",isVerified:!!i?.verified}})(e,t),o=e.icons?.[0]?.name,s=L(e,i),r=e.overlay_image?.image?.name;return{content:n,icon:o,image:s[0],badge:r}},E=e=>{switch(e){case b:return"recent_outline";case k:return"block_outline";case C:case I:return e;default:return"hide_outline"}},x=(e,t)=>e.button?{key:"button",kind:"button",text:e.button?.text?.text?e.button?.text?.text:"",...t}:{key:"chevron",kind:"chevron"};var Y=i(631012),M=i(298096),T=i(648179),R=i(191601),D=i(380977),B=i(136141),F=i(892515);const N={key:"audio_play_pause",kind:"icon_button",style:"circle",icon:void 0,ariaLabel:""},z={key:"audio_add_delete",kind:"icon_button",icon:void 0,ariaLabel:""};var j=i(928959),U=i(916533),W=i(582876),$=i(813655),H=i(714153);class V{get audio(){const{audio:e,audio_playlist:t,podcast:i}=this.props.current.originalAttachment;return e||t||i}get audioType(){return(0,H.Y)(this.props.current.originalAttachment)}get platformConfig(){return this.props.current.platformConfig}get isAudioAdded(){return this._isAudioAdded}get isRestricted(){return Boolean(this.props.current.attachment.restricted)}constructor(e,t,i,n,o){this.props=e,this.postHandlers=t,this.feedErrorService=i,this.attachmentService=n,this.authService=o,this.newAudioId=void 0,this._isAudioAdded=!1,this.handleAddDeleteClick=e=>{(0,j.T)(e),this.isAudioAdded?this.deleteAudioFromMyMusic():this.addAudioToMyMusic()},this.addAudioToMyMusic=async()=>{if(this.audioType&&this.audio)try{this.postHandlers.click.onAddedAudio({feedItemId:this.props.current.feedItemRawId,audio_item:{item_id:this.audio.id,item_owner_id:this.audio.owner_id,item_type:this.audioType}});const e=await this.attachmentService.addAudioToMyMusic({audio_id:this.audio.id,owner_id:this.audio.owner_id,access_key:this.audio.access_key,track_code:this.audio.track_code});(0,u.h5)((()=>{this.newAudioId=e.items?.[0]?.new_audio_id,this._isAudioAdded=!0}))}catch(e){this.feedErrorService.handleNetworkError(e)}},this.deleteAudioFromMyMusic=async()=>{if(this.audioType&&this.audio)try{const e=this.newAudioId||this.audio.id;this.postHandlers.click.onRemovedAudio({feedItemId:this.props.current.feedItemRawId,audio_item:{item_id:e,item_owner_id:this.audio.owner_id,item_type:this.audioType}}),await this.attachmentService.deleteAudioFromMyMusic({audio_id:e}),(0,u.h5)((()=>{this._isAudioAdded=!1}))}catch(e){this.feedErrorService.handleNetworkError(e)}},this.onAudioPlay=()=>{this.audioType&&this.audio&&this.postHandlers.action.sendStartAudioOrPlaylist(this.audio,"manual",this.audioType,this.props.current.feedItemRawId)},this.onAudioPause=()=>{this.audioType&&this.audio&&this.postHandlers.click.onPauseAudio({feedItemId:this.props.current.feedItemRawId,audio_item:{item_id:this.audio.id,item_owner_id:this.audio.owner_id,item_type:this.audioType}})},this._isAudioAdded=Boolean(this.audio&&(this.audio.owner_id===this.authService.userId||"like"in this.audio&&this.audio.like)),(0,u.l_)(this)}}V=(0,p.Cg)([s.z8.transient(),(0,p.Sn)("design:type",Function),(0,p.Sn)("design:paramtypes",[void 0===s.Ji?Object:s.Ji,void 0===g.i?Object:g.i,void 0===W.m?Object:W.m,void 0===$.V?Object:$.V,void 0===U.u?Object:U.u])],V);const{Provider:K,useModel:q}=(0,s.Qd)(V,{initInEffect:!1});var G=i(538163),J=i(233788);const Q=(0,o.P)((function(){const e=(0,w.B)(),t=(0,B.R)(),{onAudioPause:i,onAudioPlay:o,isAudioAdded:s,audio:a,platformConfig:d,handleAddDeleteClick:l,isRestricted:h,props:p}=q(),{originalAttachment:u,attachment:m,onDeleteClick:g,action:_,queue:v}=p.current,f=Boolean(a&&(0,F.df)(a,t)),y=Boolean(a&&(0,F.Fs)(a,t,f)),b=(0,r.useMemo)((()=>[y?e.getLang("mobile_audio_player_pause"):e.getLang("mobile_audio_player_play"),m.content.title,m.content.description].filter(Boolean).join(" ")),[y]),C=y?"equalizer_active":"equalizer_idle",k=(0,r.useMemo)((()=>{const r=[];return u.audio&&r.push({...z,ariaLabel:s?e.getLang("global_delete_audio"):e.getLang("global_add_to_audio"),icon:s?(0,n.Y)(Y.E,{}):(0,n.Y)(M.p,{}),onClick:h?void 0:l}),r.push({...N,ariaLabel:b,icon:y?(0,n.Y)(T.o,{}):(0,n.Y)(R.K,{}),onClick:u.audio||h?void 0:(0,F.lm)(u,y,t,void 0,o,i)}),g&&r.push({...N,tooltip:e.getLang("global_dont_attach"),ariaLabel:e.getLang("global_dont_attach"),icon:(0,n.Y)(D.Y,{"data-testid":"audio_remove"}),onClick:e=>{e.stopPropagation(),g(a)}}),r}),[a,s,h,l,y,b,u,t.platformAudioPlayer,t.audioPlayerContext,o,i]),I=(0,r.useMemo)((()=>{if(m.restricted&&!m.isDonut){const e=u.audio||u.podcast;if(!e)return;return{onClick:()=>d.onRestrictedAudio(e)}}return u.audio?{..._,ariaLabel:b,onClick:(0,F.lm)(u,y,t,v,o,i)}:_}),[m,_,u,y,t.platformAudioPlayer,t.audioPlayerContext,v,b,o,i]);return(0,n.Y)(c.y,{attachment:m,noHorizontalPadding:d.noHorizontalPaddingOnSecondary,action:I,after:k,showProgressBars:d.musicShowProgress&&f,overlay:f?C:void 0,verticalPaddingRedesign:!0,duration:t.currentAudio?.duration,progress:t?.currentAudioProgress,volume:t?.currentAudioVolume,onVolumeChange:e=>t?.platformAudioPlayer?.setVolume(e),onSeek:e=>t?.platformAudioPlayer?.setCurrentAudioProgress(e),bufferingProgress:t?.currentAudioProgress,loadingSliderLabel:"",playbackSliderLabel:"",previewPlaybackSliderLabel:"",volumeSliderLabel:""})})),X=(0,J.L)((0,s.jn)(K,Q),G.J,"SecondaryAttachmentAudio");var Z=i(925005);const ee=(e,t)=>{if(t)switch(e){case A.O.POLL:return t.poll;case A.O.LINK:case A.O.DONUT_LINK:case A.O.MARKET_LINK:return t.link;case A.O.APP:case A.O.MINI_APP:return t.appCategory;default:return t.click}};const te=(0,o.P)((function(){const{findOwner:e,props:t,action:i}=f(),{rawId:o,attachments:s,onDeleteClick:p,initialExpanded:u,maxAttachmentsBeforeCut:m,isAds:g,trackCode:_,postAdData:v,adsLinkHash:y,platformConfig:b,dataRoles:C}=t.current,k=(0,w.B)(),I=(0,r.useMemo)((()=>{const t=i(o);return s.map((i=>{const o=((e,t,i)=>{const n=e.compact,o=O(n,i);switch(e.type){case A.O.ALBUM:{const t=e.album?.thumb?.restrictions;return t?{...o,icon:t.blur?"hide_outline":"block_outline"}:o}case A.O.ARTICLE:return"available"===e.article?.state?o:{...o,restricted:!0};case A.O.VIDEO:case A.O.CLIP:{const t=e.video?.restriction;return t?{content:{title:t.title},icon:E(t.icon_name),restricted:!0,multiline:!0}:o}case A.O.PHOTO:{const t=e.photo?.restrictions;return t?{content:{title:t.title},icon:t.blur?"hide_outline":"block_outline",restricted:!0,multiline:!0}:o}case A.O.MINI_APP:return e.mini_app&&e.mini_app.app?.app_status!==S?{content:{title:e.mini_app.description},icon:"hide_outline",restricted:!0}:o;case A.O.PODCAST:case A.O.AUDIO:{const i=void 0!==e.podcast,n=e.audio?e.audio:e.podcast,s=+(n?.region_restrictions?n?.region_restrictions:0),r=!!(n?.content_restricted?n?.content_restricted:s),a=i&&n?.podcast_info?.is_donut;return{...o,content:{...o.content,titleAfterIcon:n?.is_explicit?t:void 0},restricted:r,isDonut:a}}case A.O.AUDIO_PLAYLIST:{const i=e.audio_playlist,n=!!i?.restriction;return{...o,content:{...o.content,titleAfterIcon:i?.is_explicit?t:void 0},restricted:n}}default:return o}})(i,function(e){switch(e.type){case A.O.PODCAST:case A.O.AUDIO:{const t=e.audio?e.audio:e.podcast,i=(0,Z.I)(t?.legal_notices_type);return i?.length?(0,n.Y)(h.X,{lines:i}):t?.is_explicit?(0,n.Y)(l.N,{}):null}case A.O.AUDIO_PLAYLIST:{const t=e.audio_playlist;if(!t?.is_explicit)return null;const i=(0,Z.N)({isExplicit:!0,isForeignAgent:!1});return i?.length?(0,n.Y)(h.X,{lines:i}):null}default:return null}}(i),((e,t)=>{const i={};e.icons?.forEach((({source_id:e})=>{e&&(i[e]=t(e))}));const n=t(e.title?.source_id),o=t(e.description?.source_id);return{owner:n,imageOwnerBySourceIdMap:i,descriptionOwner:o}})(i.compact,e)),s=t({attachment:i,isAds:g,trackCode:_,postAdData:v,adsLinkHash:y});return{dataRole:ee(i.type,C),original:i,secondary:o,after:s?x(i.compact,b.secondaryAction(i)):void 0,action:s}}))}),[s,e,o]),P=(0,r.useMemo)((()=>I.map((e=>e.original.audio)).filter((e=>Boolean(e)))),[I]);return(0,n.Y)(a.C,{formatCutText:e=>k.numeric(e,k.getLang("wall_attachment_secondary_show_more",!0)),initialExpanded:u,maxAttachmentsBeforeCut:m,feedV3Redesign:!0,children:I.map((({original:e,secondary:t,action:i,after:s,dataRole:r},a)=>{return h=e.type,![A.O.AUDIO,A.O.AUDIO_PLAYLIST,A.O.PODCAST].includes(h)||(l=e).type===A.O.PODCAST&&l.podcast?.podcast_info?.is_donut?(0,n.FD)("div",{"data-role":r,children:[a>0&&(0,n.Y)(d.K,{size:4}),(0,n.Y)(c.y,{attachment:t,action:i,after:s,noHorizontalPadding:b.noHorizontalPaddingOnSecondary,verticalPaddingRedesign:!0})]},a):(0,n.FD)("div",{"data-role":r,children:[a>0&&(0,n.Y)(d.K,{size:4}),(0,n.Y)(X,{feedItemRawId:o,platformConfig:b,originalAttachment:e,attachment:t,action:i,queue:e.audio?P:void 0,onDeleteClick:p})]},a);var l,h}))})})),ie=(0,s.jn)(v,te)},892515:(e,t,i)=>{i.d(t,{lm:()=>c,df:()=>a,Fs:()=>d});var n=i(626853);var o=i(197118);var s=i(925810),r=i(714153);const a=(e,t)=>{const{currentAudio:i,currentPlaylist:n}=t;return"podcast_info"in e&&e.podcast_info?i?.id===e.id:"count"in e?n?.id===e.id:i?.id===e.id},d=(e,t,i)=>{const{status:n}=t;return(i??a(e,t))&&n===s.w.PLAYING},c=(e,t,i,s,a,d)=>{if(!i.platformAudioPlayer)return;const c=(0,r.Y)(e);if(e.audio_playlist)return(({audio:e,isPlaying:t,context:i,player:o,type:s,onPlay:r,onPause:a})=>{const d=e.restriction;return c=>{(0,n.T)(c),d||(t?(o.pause(),a?.(e,s)):(o.playPlaylist(e,i,e.audios),r?.(e,s)))}})({audio:e.audio_playlist,player:i.platformAudioPlayer,context:i.audioPlayerContext,isPlaying:t,type:c,onPlay:a,onPause:d});const l=e.audio||e.podcast;return l?(({player:e,audio:t,context:i,isPlaying:s,queue:r,type:a,onPlay:d,onPause:c})=>l=>{(0,n.T)(l),s?(e.pause(),c?.(t,a)):(e.playAudio(t,r??[t],i,{type:o.P.WALL,ownerId:t.owner_id,albumId:t.album?t.album.id:t.album_id??0}),d?.(t,a))})({audio:l,player:i.platformAudioPlayer,context:i.audioPlayerContext,isPlaying:t,queue:s,type:c,onPlay:a,onPause:d}):void 0}},714153:(e,t,i)=>{function n(e){return e.audio_playlist?"album"===e.audio_playlist.type?"album":"playlist":e.podcast?"podcast":"audio"}i.d(t,{Y:()=>n})},900015:(e,t,i)=>{i.d(t,{_:()=>o});var n=i(9467);const o=()=>(0,n.z2)("spa_feed_web_clips_primary_attachment_force")},739242:(e,t,i)=>{i.d(t,{f:()=>o});var n=i(900015);const o=()=>{if((0,n._)())return"contain"}},159978:(e,t,i)=>{i.d(t,{n:()=>s});var n=i(978350),o=i(900015);const s=({canPlay:e,width:t,height:i,commonRatio:s=n.w.LOW})=>(0,o._)()?e?t&&i?Math.min(Math.max(t/i,s),n.w.WIDER):s:n.w.WIDER:e?s:n.w.WIDER},698853:(e,t,i)=>{i.d(t,{m:()=>o});var n=i(257581);const o=(e,t,i)=>{switch(t){case"wall":switch(e){case"postpone":return i?n.yH.GroupFeedEditPostponed:n.yH.ProfileFeedEditPostponed;case"suggest":if(!i)return;return n.yH.ClubFeedPrepareSuggested;case"draft":return i?n.yH.GroupFeedEditDraft:n.yH.ProfileFeedEditDraft}break;case"group":if(!i)return;switch(e){case"postpone":return n.yH.GroupWallEditPostponed;case"suggest":return n.yH.ClubWallPrepareSuggested;case"draft":return n.yH.GroupWallEditDraft}break;case"profile":if(i)return;switch(e){case"postpone":return n.yH.ProfileWallEditPostponed;case"draft":return n.yH.ProfileWallEditDraft}}}},851417:(e,t,i)=>{i.d(t,{U:()=>n});const n=(e,t,i)=>{let n={kind:t?"user":"group",href:i,...e};return"is_nft_photo"in e&&(n.is_nft=e.is_nft_photo),n}},299761:(e,t,i)=>{i.d(t,{$:()=>S});var n=i(221020),o=i(356035),s=i(298096),r=i(267952),a=i(217420),d=i(142633),c=i(191601),l=i(648179),h=i(870821),p=i(208329),u=i(848659),m=i(677251),g=i(726519),_=i(954647),v=i(327595),f=i(927841),w=i(705560),y=i(340615),b=i(386004),C=i(351435);const k=Object.freeze({[b.e.Open]:{idle:{16:null,20:null,24:null}},[b.e.ToggleFollowing]:{idle:{16:null,20:null,24:s.p},active:{16:null,20:null,24:r._}},[b.e.CreateOwningCopy]:{idle:{16:null,20:null,24:s.p},active:{16:null,20:null,24:r._}},[b.e.ToggleDiscoverable]:{idle:{16:null,20:a.a,24:null},active:{16:null,20:d.$,24:null}},[b.e.TogglePlaying]:{idle:{16:null,20:null,24:c.K},active:{16:null,20:null,24:l.o}},[b.e.ToggleShuffled]:{idle:{16:null,20:null,24:h.j},active:{16:null,20:null,24:h.j}},[b.e.Share]:{idle:{16:p.e,20:u.f,24:m.T}},[b.e.CopyPageURL]:{idle:{16:null,20:g.V,24:null}},[b.e.OpenEditing]:{idle:{16:null,20:_.Z,24:v.v}},[b.e.Delete]:{idle:{16:null,20:f.z,24:null}},[b.e.OpenUMA]:{idle:{16:null,20:null,24:y.r}},[b.e.OpenAddingToGroup]:{idle:{16:null,20:w.F,24:null}},[b.e.DeleteFromGroup]:{idle:{16:null,20:f.z,24:null}}}),I=[b.e.ToggleShuffled],S=(0,o.P)((function({size:e=24,...t}){return(0,n.Y)(C.k,{iconMap:k,getIconFromVariant:t=>t?t[e]??null:null,...t,activeAppearance:A(t),activeColorMode:P(t)})}));function A(e){return e.activeAppearance?e.activeAppearance:I.includes(e.action.type)?"light":void 0}function P(e){return e.activeColorMode?e.activeColorMode:I.includes(e.action.type)?"accent":void 0}},870541:(e,t,i)=>{i.d(t,{_:()=>y});var n=i(221020),o=i(356035),s=i(863238),r=i(937673),a=i(208329),d=i(848659),c=i(677251),l=i(786936),h=i(766216),p=i(568887),u=i(320767),m=i(954647),g=i(705560),_=i(927841),v=i(351435),f=i(506662);const w=Object.freeze({[f.D.Open]:{idle:{16:null,20:s.Q,24:null}},[f.D.OpenLayer]:{idle:{16:null,20:s.Q,24:null}},[f.D.OpenPodcast]:{idle:{16:null,20:null,24:null}},[f.D.OpenStats]:{idle:{16:r.R,20:null,24:null}},[f.D.Share]:{idle:{16:a.e,20:d.f,24:c.T}},[f.D.ToggleFavorites]:{idle:{16:null,20:l.U,24:h.O},active:{16:null,20:p.e,24:u.q}},[f.D.TogglePlaying]:{idle:{16:null,24:null}},[f.D.OpenEditing]:{idle:{16:null,20:m.Z,24:null}},[f.D.TogglePodcastOwning]:{idle:{16:null,20:g.F,24:null},active:{16:null,20:_.z,24:null}}}),y=(0,o.P)((function({size:e=24,...t}){return(0,n.Y)(v.k,{iconMap:w,getIconFromVariant:t=>t?t[e]??null:null,...t})}))},538781:(e,t,i)=>{i.d(t,{t:()=>s});var n=i(221020);const o=(0,i(891719).F)({loader:async()=>{const{LazyModalComponent:e}=await Promise.all([i.e(69818),i.e(68933),i.e("langs/core_spa/LazyModalComponent")]).then(i.bind(i,742274));return e},DefaultLoading:()=>null,name:"LazyModalComponent"}),s=({modalProps:e})=>(0,n.Y)(o,{...e})},459303:(e,t,i)=>{i.d(t,{J:()=>s});var n=i(221020);const o=(0,i(891719).F)({loader:async()=>{const{LazyModalOverlayComponent:e}=await Promise.all([i.e(69818),i.e(96757),i.e("langs/core_spa/LazyModalOverlayComponent")]).then(i.bind(i,545728));return e},DefaultLoading:()=>null,name:"LazyModalOverlayComponent"}),s=({modalProps:e})=>(0,n.Y)(o,{...e})},597593:(e,t,i)=>{i.d(t,{z:()=>_});var n=i(221020),o=i(815287),s=i(822551),r=i(946918),a=i(364517),d=i(516427),c=i(326977),l=i(395089),h=i(46644),p=i(47417),u=i(120125),m=i(311029),g=i(37390);const _=e=>{const t=(0,r.B)();(0,d.K$F)(e.isShown);const[i,_]=(0,o.useState)(0),v=(0,o.useCallback)((e=>{_(e?e.offsetHeight:0)}),[]),[f,w]=(0,o.useState)(0),y=(0,o.useCallback)((e=>{w(e?e.offsetHeight:0)}),[]),b=(0,a.K)(e.onClose);if((0,o.useEffect)((()=>{if(!e.isShown)return;const t=e=>{"Escape"===e.key&&(e.stopPropagation(),b())};return window.addEventListener("keydown",t,!0),()=>{window.removeEventListener("keydown",t,!0)}}),[e.isShown]),e.isShown)switch(e.type){case"card":{const{children:t,onClose:i}=e;return(0,s.createPortal)((0,n.Y)(c.z,{onClick:i,zIndex:e.zIndex,children:(0,n.Y)(l.s,{autoFocus:!0,children:t})}),document.body)}case"modal":{const{width:o,onClose:r,headerId:a,title:d,children:l,actions:_}=e;return(0,s.createPortal)((0,n.Y)(c.z,{onClick:r,zIndex:e.zIndex,children:(0,n.FD)(h.n,{width:o,"aria-labelledby":a,focusTrap:!0,children:[(0,n.Y)(p.r,{getRootRef:v,id:a,onClose:r,closeAriaLabel:t.getLang("global_close"),children:d}),(0,n.Y)(u._,{autoHideScrollbar:!0,maxHeight:`calc(100vh - 40px - ${i}px - ${f}px)`,children:(0,n.Y)(m.c,{insetLevel:1,children:l})}),_&&(0,n.Y)(g.j,{getRootRef:y,actions:_})]})}),document.body)}case"alert":return(0,s.createPortal)(e.children,document.body);default:return function(e){throw new Error("Unexpected object: ",e)}(e)}}},867937:(e,t,i)=>{i.d(t,{L:()=>sf});var n=i(221020),o=i(356035),s=i(187233),r=i(688650),a=i(42107),d=i(331635),c=i(327813),l=i(725308),h=i(452200),p=i(337951);const u=({type:e,value:t})=>{switch(e){case"post":return"post_ads"===t.post_type?"post_ads":"reply"===t.post_type?"comment":"post";case"video":case"market":case"photo":case"post_ads":return e;case"ads":return"post"===t.ads?.[0]?.type?"post_ads":void 0;default:return}};var m=i(529275),g=i(419692),_=i(651253),v=i(303134),f=i(195578),w=i(582876),y=i(20974),b=i(78023);class C{async toggleFeedItemReaction(e,t,i,n){if("number"!=typeof t.value.id)return void this.errorLogger.log("FeedLikesService: item id is missing");const o=Boolean(t.value.likes?.user_likes),s={type:e,owner_id:t.value.owner_id,item_id:t.value.id,track_code:t.value.track_code,ref:n};await this.feedEntitiesMutationService.doOptimisticMutation({key:`post:${t.id}:like`,mutateApi:(e,t)=>!o||o&&void 0!==i?this.likesApi.add({...e,reaction_id:i},{signal:t}):this.likesApi.delete(e,{signal:t}),updateUi:()=>this.feedEntitiesMutationService.mutateFeedItemReactionOptimistically(t.id,i),updateUiValue:s,onSuccess:e=>{const i=e.likes!==t.value.likes?.count;if((0,c.h5)((()=>{this.feedEntitiesMutationService.mutateFeedItemLikes(t.id,{likes:{count:e.likes},reactions:e.reactions,likesList:{count:e.likes}})})),i){const e=u(t);e&&this.refetchLikesList(t.id,{type:e,count:3,item_id:t.value.id,owner_id:t.value.owner_id})}},onError:e=>{this.feedErrorService.handleNetworkError(e)}})}async toggleMetaPostPhotoLikes(e,t,i,n){const o=Boolean(t.likes?.user_likes);this.feedEntitiesMutationService.mutateFeedMetaPostPhotoLikes(e,t.id,!o);try{const e={type:"photo",owner_id:t.owner_id,item_id:t.id,track_code:i,ref:n};o?await this.likesApi.delete(e):await this.likesApi.add(e)}catch(i){this.feedErrorService.handleNetworkError(i),this.feedEntitiesMutationService.mutateFeedMetaPostPhotoLikes(e,t.id,o)}}async fetchLikesList(e,t){return this.likesApi.getList({...y.N,...e},{signal:t?.signal})}async refetchLikesList(e,t,i){try{const n=await this.fetchLikesList(t,i);(0,c.h5)((()=>{this.feedEntitiesMutationService.mutateItem(e,{likesList:n,value:{likes:{count:n.count}}})}))}catch(e){throw this.errorLogger.log(e),e}}async fetchIsLiked(e,t){return this.likesApi.isLiked(e,{signal:t?.signal})}extractLikesActivity(e){if(e&&(0,v.Ei)(e))return e.likes}constructor(e,t,i,n,o,s){this.accountProfileInfoService=e,this.feedEntitiesStore=t,this.feedEntitiesMutationService=i,this.likesApi=n,this.errorLogger=o,this.feedErrorService=s,this.ensureFeedItemLikesList=async(e,t)=>{const i={data:void 0,onDone:()=>{}},n=this.feedEntitiesStore.getItem(e);if(!n||!(0,v.P4)(n)&&!(0,v.i4)(n)&&!(0,v.bQ)(n))return i;if(n.likesList&&(n.likesList.count<=2&&n.likesList.count===n.likesList.items.length||n.likesList.count>2&&n.likesList.items.length>2))return{data:n.likesList,onDone:()=>{}};const o=u(n);if(!o)return i;const{id:s,ownerId:r}=(0,h.v)(e),a={type:o,item_id:s,owner_id:r},[d,l]=await Promise.all([this.fetchLikesList({...a},t),this.fetchIsLiked({...a},t)]),p={likes:{count:d.count,user_likes:l.liked}};l.liked||(p.reactions={user_reaction:void 0});return{data:d,onDone:()=>(0,c.h5)((()=>{this.feedEntitiesMutationService.mutateItem(n.id,{likesList:d,value:p},{overrideUndefined:!0})}))}},this.accountProfileInfoService.ensureData(),(0,c.l_)(this)}}C=(0,d.Cg)([a.z8.container(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===b.W?Object:b.W,void 0===m.B?Object:m.B,void 0===f.K?Object:f.K,void 0===g.d?Object:g.d,void 0===_.v?Object:_.v,void 0===w.m?Object:w.m])],C);var k=i(578904),I=i(570440),S=i(208182),A=i(848158),P=i(832595),L=i(645189),O=i(849645),E=i(273193),x=i(852382),Y=i(89648),M=i(202103),T=i(759076),R=i(297520),D=i(356979);class B{getRepostItem(){if(!this.postData?.copy_history?.length)return;const e=this.feedEntitiesStore.createFeedItemFromApi(this.postData.copy_history[0],!1);if("post"===e?.type)return e;console.error("Something wrong with repost origin data. The repost origin couldn't be displayed.")}get config(){return this.props.current.config}get trackCode(){return this.props.current.data.value.track_code??this.props.current.trackCode}get handleOpenDonutPaymentLayer(){return this.props.current.handleOpenDonutPaymentLayer}get postItem(){return this.props.current.data}get maxNestingLevel(){return 1}get nestingLevel(){return this.props.current.nestingLevel??0}get postData(){return this.postItem.value}get postTypeIsReply(){return"reply"===this.postData.post_type}get rawId(){return this.postItem.id}get platformConfig(){return this.props.current.platformConfig}get commentsPlatformConfig(){return this.props.current.commentsPlatformConfig}get attachmentsPlatformConfig(){const{postAttachments:e,secondaryAttachmentList:t,carousel:i,mediaGrid:n,primaryAttachmentPoll:o,primaryAttachment:s}=this.props.current.platformConfig;return{postAttachments:e,secondaryAttachmentList:t,carousel:i,mediaGrid:n,primaryAttachmentPoll:o,primaryAttachment:s}}get nestedPost(){return this._nestedPost}get isNestedPost(){return this.nestingLevel>0}get isDeleted(){return Boolean(this.postData.is_deleted)}get postState(){return this.postItem.postState}get index(){return this.props.current.index}get attachmentsExpanded(){return this.props.current.attachmentsExpanded}get textAlwaysExpanded(){return this.props.current.textAlwaysExpanded??!1}get itemUiState(){return this.getItemUiState(this.postItem)}get isUnpublished(){return["suggest","postpone","draft"].some((e=>e===this.postData.post_type))}get showComments(){return!this.props.current.config?.hideComments&&!this.isNestedPost}get isDonutRestricted(){return this.postData.donut&&(0,x.h)(this.postData.donut)}get contentId(){const e=this.feedEntitiesStore.getItem(this.rawId)?.value;if(e)return"id"in e?e.id?.toString():void 0}get donutSubscriptionParams(){const e=this.metaData.get().screen;return this.postData.donut&&this.isDonutRestricted?(0,x.G)(this.postData.donut,this.contentId,"post",e):void 0}get underMediaAttachment(){return(0,Y.J)(this.postData.attachments)}get actionButtonAttachment(){return(0,Y.d)(this.postData.attachments)}get hasOnlyActionButtonChipAttachmentsAfterCut(){return!!this.chipAttachmentsAfterCut.length&&this.chipAttachmentsAfterCut.filter((({type:e})=>"action_button"===e)).length===this.chipAttachmentsAfterCut.length}get focusCommentInputOnCommentIconClick(){return Boolean(this.props.current.config?.focusCommentInputOnCommentIconClick??"fullInline"===this.config?.commentsContainerMode)}get postAuthor(){return{label:this.langs.langReplace(this.langs.getLang("news_post_squeeze_header_author_name_new"),{user_name:this.ownerService.getOwnerNameById(this.postData.signer_id,!0,"gen")}),url:this.ownerService.getOwnerHrefById(this.postData.signer_id)}}get postClickAnalytics(){return{onExtLinkClick:this.onExtLinkClick,onIntLinkClick:this.onIntLinkClick}}get screen(){return this.metaData.get().screen}get isPromoPost(){return this.props.current.isPromoPost}get customStateConfig(){return{hasExtraDeleteActions:this.config?.hasExtraDeleteActions}}constructor(e,t,i,n,o,s,r,a,d,m,g,_,v){this.props=e,this.feedEntitiesStore=t,this.feedLikesService=i,this.feedEntitiesMutationService=n,this.singlePostWallService=o,this.viewHandlers=s,this.feedPostViewStatsStore=r,this.userEnv=a,this.ownerService=d,this.postHandlers=m,this.metaData=g,this.langs=_,this.feedPostModal=v,this._nestedPost=void 0,this.chipAttachmentsAfterCut=[],this.chipAttachmentsUnderCut=[],this.hasAttachmentsBeforeText=!1,this.handleOpenPost=(e,t,i)=>{this.props.current.onOpenPost(e,this.postItem,t,i)},this.getItemUiState=this.props.current.getItemUiState,this.updatePostState=e=>{this.feedEntitiesMutationService.mutateFeedItemState(this.rawId,e)},this.updateAttachmentsInfo=e=>{if(this.postTypeIsReply&&"sticker"===e?.[0]?.type)return this.hasAttachmentsBeforeText=!0,this.chipAttachmentsAfterCut=[],void(this.chipAttachmentsUnderCut=[]);this.hasAttachmentsBeforeText=!!e?.some((e=>"full"===e.style));const[t,i]=(0,M.m)(e);this.chipAttachmentsAfterCut=t,this.chipAttachmentsUnderCut=i},this.onStartView=(e,t)=>{if(t.observerName===S.U.t35||this.isPromoPost&&t.observerName===S.U.t50&&!this.postItem.viewsCount){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.props.current.data.apiType};this.viewHandlers.onStartViewPost(i,{index:this.props.current.index,itemId:this.postItem.id})}},this.onEndView=(e,t)=>{if(t.observerName===S.U.t35){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.props.current.data.apiType},{width:n,height:o}=this.props.current.getItemUiState(this.postItem).size;this.viewHandlers.onEndViewPost({index:this.props.current.index,itemId:this.rawId,width:n,height:o,startTime:e.startTime,endTime:e.endTime,screen:e.screen},i),this.feedEntitiesMutationService.incrementFeedItemViewsCount(this.rawId)}else if(this.isPromoPost&&t.observerName===S.U.t50&&!this.postItem.viewsCount){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.props.current.data.apiType},{width:n,height:o}=this.props.current.getItemUiState(this.postItem).size;this.viewHandlers.onEndViewPostTrackEvents({index:this.props.current.index,itemId:this.rawId,width:n,height:o,startTime:e.startTime,endTime:e.endTime,screen:e.screen},i),this.feedEntitiesMutationService.incrementFeedItemViewsCount(this.rawId)}},this.sendImmediateView=(e,t,i)=>{e&&t&&this.config?.sendImmediateViewOnly&&this.viewHandlers.onSendPostImmediately({index:this.index,itemId:this.postItem.id,itemType:this.props.current.data.apiType},{postItem:this.postItem,element:e,isLayerOpened:i,postSize:t})},this.toggleReaction=async({reactionId:e})=>{const t="reply"===this.postData.post_type?"comment":this.postItem.type;await this.feedLikesService.toggleFeedItemReaction(t,this.postItem,e,(0,p.q)(this.screen,this.feedPostModal.isModalOpened))},this.refetchPost=async()=>{await this.singlePostWallService.refetchPost(this.rawId)},this.onOpenAuthor=e=>{if(this.postData.signer_id){try{if(e.target instanceof HTMLAnchorElement&&URL.canParse(e.target.href)){const t=new URL(e.target.href);(0,R.V0)(t.href)&&!t.pathname.startsWith("/away.php")?this.onIntLinkClick("wall_item:author"):this.onExtLinkClick("wall_item:author")}}catch{}l.z.isUserId(this.postData.signer_id)?this.postHandlers.click.onOpenUser({feedItemId:this.rawId}):this.postHandlers.click.onOpenGroup({feedItemId:this.rawId})}},this.onExtLinkClick=e=>{this.postHandlers.click.onExtLinkClick({feedItemId:this.rawId,eventSubtype:e})},this.onIntLinkClick=e=>{this.postHandlers.click?.onIntLinkClick({feedItemId:this.rawId,eventSubtype:e})},this.showLikes=({rawId:e,itemType:t,...i})=>{if(this.userEnv.partConfigEnabled("frontend.feed_post_reactions_modal")){const t=u(this.postItem);this.onOpenReactions({rawId:e,itemType:t})}else this.props.current.onOpenReactions?this.props.current.onOpenReactions():this.platformConfig.likes.showLikes?.({rawId:e,itemType:t,...i,reopenPostLayer:this.config?.reopenPostLayerAfterLegacyLikesLayer})},this.onOpenReactions=({rawId:e,itemType:t})=>{const i=(0,h.v)(e);this.props.current.onOpenReactions?.({layerParams:{ownerId:i.ownerId.toString(),itemId:i.id.toString()},layerQuery:{type:t||null}})},this._nestedPost=this.getRepostItem(),(0,c.mJ)((()=>this.postItem.value.attachments),(e=>this.updateAttachmentsInfo(e)),{fireImmediately:!0}),(0,c.l_)(this)}}B=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===m.B?Object:m.B,void 0===C?Object:C,void 0===f.K?Object:f.K,void 0===k.a?Object:k.a,void 0===P.S?Object:P.S,void 0===A.S?Object:A.S,void 0===L.J?Object:L.J,void 0===I.v?Object:I.v,void 0===T.i?Object:T.i,void 0===O.e?Object:O.e,void 0===E.Y?Object:E.Y,void 0===D.y?Object:D.y])],B);const{Provider:F,useModel:N}=(0,a.Qd)(B,{initInEffect:!1});var z=i(431941),j=i(516427),U=i(405697),W=i(867227);const $=({reason:e,details:t})=>{const i=(0,z.K)();return(0,n.Y)(s.i,{paddingTop:16,paddingBottom:0,mode:"vertical",spacing:12,children:(0,n.Y)(j.SvD,{value:i,children:(0,n.Y)(j.ZpM,{children:(0,n.Y)(U.O,{icon:(0,n.Y)(W.M,{}),header:e,children:t})})})})};var H=i(815287),V=i(325825),K=i(180329),q=i(638945),G=i(772812),J=i(409698);var Q=i(876126);var X=i(793861);var Z=i(237582);const ee="vkitPostHeaderActions__clearMargin--1SDdf",te="vkitPostHeaderActions__flexbox--9HzWx",ie=({children:e})=>(0,n.Y)(K.s.Item,{flex:"shrink",className:ee,children:(0,n.Y)(K.s,{noWrap:!0,align:"center",className:te,gap:12,children:e})});var ne=i(942735);const oe=(0,H.createContext)({overflowColor:[34,34,34],enableResizeObserver:!1}),se=oe.Provider,re="vkitTextOverflow__root--I8Dlh",ae="vkitTextOverflow__hider--FrPbS",de=({children:e,...t})=>{const{overflowColor:i}=(0,H.useContext)(oe),o=(0,H.useRef)(null),[s,r]=(0,H.useState)(!1),[a,d]=(0,H.useState)(!1);(0,H.useEffect)((()=>{const e=requestAnimationFrame((()=>{if(!o.current)return;const e=o.current.offsetWidth<o.current.scrollWidth;d((t=>t||e))}));return()=>{cancelAnimationFrame(e)}}),[]),(0,H.useEffect)((()=>{if(!o.current)return;const e=requestAnimationFrame((()=>{o.current&&r(o.current.offsetWidth<o.current.scrollWidth)}));return()=>{cancelAnimationFrame(e)}}),[a]);const c={"--gradient-start":(0,ne.P)(i,.4),"--gradient-end":(0,ne.P)(i,1)};return(0,n.FD)("div",{style:c,ref:o,className:re,...t,children:["function"==typeof e?e(a):e,s&&(0,n.Y)("div",{className:ae})]})},ce="vkitSubtitleDrum__window--RnLGq";var le=i(634164);const he="vkitSubtitleItem__text--55cRK",pe="vkitSubtitleItem__withUnderline--0bZWK",ue="vkitTitle__root--AoUNO",me="vkitTitle__shrink--6cGLU",ge="vkitTitle__noShrink--yylLX",_e="vkitPostHeader__container--rbvew",ve="vkitPostHeader__flexbox--LxZ9p",fe="vkitPostHeader__mainInfo--6bdlu",we=(0,H.memo)((function({avatar:e,title:t,afterTitle:i,subtitle:o,actions:s,onHeaderClick:r,titleId:a,mode:d="full",spacing:c=12}){const l="nested"===d,h={"--spacing-right":`${c}px`,"--spacing-left":`${c}px`};return(0,n.FD)(K.s,{onClick:r,style:h,noWrap:!0,className:_e,gap:c,align:"center",children:[l&&(0,n.Y)(K.s.Item,{flex:"shrink",children:(0,n.Y)(V.E,{className:(0,G.I)("color_icon_tertiary")})}),(0,n.Y)(K.s.Item,{flex:"shrink",children:e}),(0,n.FD)(K.s,{noWrap:!0,direction:"column",className:fe,children:[(0,n.Y)(K.s.Item,{children:(0,n.FD)(K.s,{id:a,noWrap:!0,align:"center",className:ve,gap:4,Component:e=>(0,n.Y)(q.$j,{...e,Component:l?"h4":"h3"}),children:[(0,n.Y)(K.s.Item,{className:ve,children:t}),!!i&&(0,n.Y)(K.s.Item,{children:(0,n.Y)(K.s,{noWrap:!0,align:"center",className:ve,gap:4,children:i})})]})}),o&&(0,n.Y)(K.s.Item,{children:o})]}),!!s&&(0,n.FD)(n.FK,{children:[(0,n.Y)(K.s.Item,{flex:"grow"}),(0,n.Y)(ie,{children:s})]})]})})),ye=Object.assign(we,{ImageStatus:({src:e,alt:t,...i})=>(0,n.Y)(Z.v,{noBorder:!0,size:16,src:e,alt:t,...i}),Avatar:({size:e,hasStories:t,href:i,onClick:o,alt:s="",...r})=>(t&&!e?e=38:e||(e=40),(0,n.Y)(Q.g,{onClick:o,size:e,href:i,alt:s,...r,children:t&&(0,n.Y)(Q.g.Outline,{appearance:"accent"})})),CoownersAvatar:({size:e=40,children:t,...i})=>(0,n.Y)(X.G,{tabIndex:-1,"aria-hidden":!0,size:e,direction:"bottom",hasHover:!1,hasActive:!1,stroke:!0,...i,children:t}),Title:({href:e,children:t,afterTitle:i,overflowHidden:o,Component:s="span",...r})=>{let a=(0,n.Y)(q.LE,{className:(0,le.$)(ue,(0,G.I)("color_text_primary")),href:e,weight:"2",Component:e?"a":s,...r,children:t});o&&(a=(0,n.Y)(de,{children:a}));const d=o?me:ge;return a=(0,n.Y)(K.s.Item,{className:d,children:a}),i?.length&&(a=(0,n.FD)(K.s,{className:d,noWrap:!0,align:"center",gap:4,children:[a,i.map(((e,t)=>(0,n.Y)(K.s.Item,{flex:"shrink",children:e},t)))]})),a},CoownersTitle:({renderPrimaryTitle:e,renderSecondaryTitle:t,delimiter:i,...o})=>(0,n.Y)(de,{...o,children:o=>(0,n.FD)(n.FK,{children:[e(o),i,t(o)]})}),Subtitle:({icon:e,colorToken:t,overflowHidden:i,withHoverUnderline:o,href:s,compact:r,...a})=>{const d=r?q.HL:q.tW,c=(0,n.FD)(K.s,{noWrap:!0,gap:4,align:"center",children:[!!e&&(0,n.Y)(K.s.Item,{children:e}),(0,n.Y)(K.s.Item,{children:(0,n.Y)(d,{className:(0,le.$)(he,o&&pe,(0,G.I)(t||"color_text_secondary")),href:s,Component:s?"a":"span",...a})})]});return i?(0,n.Y)(de,{children:c}):c},SubtitleDrum:({children:e,...t})=>{const i=H.Children.count(e),o=(0,H.useCallback)((e=>{if(!e)return;if(i<2)return;const t=i,n=1400*t,o=800/n,s=600/n;let r=0;const a=[{transform:"translateY(0)",offset:r}];r+=o,a.push({transform:"translateY(0)",offset:r});for(let e=1;e<t;e++)r+=s,a.push({transform:`translateY(${28*-e}px)`,offset:r}),r+=o,a.push({transform:`translateY(${28*-e}px)`,offset:r});a.push({transform:`translateY(-${28*t}px)`,offset:1}),e.animate(a,{duration:n,iterations:1/0,easing:"linear"}).play()}),[i]);return(0,n.Y)("div",{className:ce,...t,children:(0,n.Y)(K.s,{noWrap:!0,direction:"column",gap:14,getRootRef:o,children:H.Children.map(e,(e=>(0,n.Y)(de,{children:e})))})})},SubtitleList:({children:e,delimiter:t,...i})=>{const o=H.Children.count(e);return(0,n.Y)(de,{...i,children:(0,n.Y)(K.s,{noWrap:!0,gap:4,align:"center",children:H.Children.map(e,((e,i)=>{const s=[(0,n.Y)(K.s.Item,{children:e},i)];return t&&i+1<o&&s.push((0,n.Y)(K.s.Item,{children:t},`delimiter${i}`)),s}))})})},ActionButton:({...e})=>(0,n.Y)(J.$,{appearance:"neutral",size:"s",mode:"secondary",...e}),OverflowProvider:se});var be=i(300806),Ce=i(916533),ke=i(946927),Ie=i(400612),Se=i(998168),Ae=i(928959),Pe=i(196497);const Le=e=>!!e.closest('[role="button"], [role="select"], [role="checkbox"], [role="list"], [role="listbox"], datalist, a, button, input, select, textarea'),Oe=e=>{const{target:t,currentTarget:i}=e;return t instanceof Element&&i instanceof Element&&(!Le(i)&&Le(t))};var Ee=i(331503),xe=i(318976),Ye=i(2810),Me=i(118583);const Te=e=>{let t=e.id;return(0,Me.P)(e)&&(t=l.z.convertGroupIdToOwnerId(e.id)),t};class Re{async[a.Ts](){this.primaryHasStories&&this.primaryAvatarOwnerId&&this.feedStoriesService.subscribeOnSeenEvent(this.primaryAvatarOwnerId)}get isCoOwnerListModalOpened(){return this._isCoOwnerListModalOpened}get isActionIconModalOpened(){return this._isActionIconModalOpened}get contextMenu(){return this.props.current.contextMenu}get showPromoteButton(){return Boolean(this.onClickPromote&&!this.isSuggestSubscribeOnOwner&&this.adsEasyPromoteButtonText&&this.uiConfig?.allowPromoteBtn)}get isNested(){return!!this.props.current.isNested}get mode(){return this.isNested?"nested":"full"}get openPost(){return this.props.current.openPost}get config(){return this.props.current.config}get uiConfig(){return this.props.current.uiConfig}get compact(){return Boolean(this.config.compact)}get handleIconStatusClick(){return this.config.handleIconStatusClick}get verificationInfoTitleLink(){return this.config.verificationInfoTitleLink}get verificationByBusinessLink(){return this.config.verificationByBusinessLink}get verificationInfoLink(){return this.config.verificationInfoLink}get verificationByOtherServiceInfoLink(){return this.config.verificationByOtherServiceInfoLink}get governmentPublicInfoLink(){return this.config.governmentPublicInfoLink}get userGroupModalAvatarSize(){return this.config.userGroupModalAvatarSize}get actionIconMode(){return this.config.actionIconMode}get isCanUseDrum(){return this.config.isCanUseDrum}get geoFeedHrefPrefix(){return this.config.geoFeedHrefPrefix}get onClickPromote(){return this.config.onClickPromote}get modalComponent(){return this.config.ModalComponent}get modalCardComponent(){return this.config.ModalCardComponent}get dismissButtonMode(){return this.config.dismissButtonMode}get darkThemeFadeColor(){return this.config.darkThemeFadeColor}get lightThemeFadeColor(){return this.config.lightThemeFadeColor}get feedItem(){return this.props.current.feedItem}get feedItemData(){return this.feedItem.value}get feedItemVideoData(){if("video"===this.feedItem.type)return this.feedItem.value}get feedItemPostData(){if("post"===this.feedItem.type)return this.feedItem.value}get isReplyPost(){return"reply"===this.feedItemPostData?.post_type}get isPostponePost(){return"postpone"===this.feedItemPostData?.post_type}get isSuggestPost(){return"suggest"===this.feedItemPostData?.post_type}get isDraftPost(){return"draft"===this.feedItemPostData?.post_type}get allowShowDate(){return Boolean(this.date)&&(this.isSuggestPost||this.isPostponePost||this.isDraftPost)}get showFullDate(){return this.isDraftPost}get feedItemId(){return this.feedItem.id}get clipPost(){if("clip"===this.feedItemPostData?.post_type)return this.feedItemPostData.attachments?.[0]?.clip}get videoPost(){if("video"===this.feedItemPostData?.post_type)return this.feedItemPostData.attachments?.[0]?.video}get trackCode(){return this.feedItemData.track_code??this.props.current.trackCode}get isPinned(){return!this.uiConfig?.hidePinIcon&&Boolean("is_pinned"in this.feedItemData&&this.feedItemData.is_pinned)}get itemId(){return"id"in this.feedItemData?this.feedItemData.id:void 0}get ownerId(){return"owner_id"in this.feedItemData?this.feedItemData.owner_id:void 0}get fromId(){return"from_id"in this.feedItemData?this.feedItemData.from_id:void 0}get geo(){return"geo"in this.feedItemData?this.feedItemData.geo:void 0}get geoType(){return this.geo?.type}get isPlaceGeoType(){return"place"===this.geoType}get geoPlaceId(){return this.geo?.place?.id}get geoFeedHref(){if(this.geoFeedHrefPrefix&&this.geoPlaceId)return`${this.geoFeedHrefPrefix}${this.geoPlaceId}`}get coOwners(){return"coowners"in this.feedItemData?this.feedItemData.coowners:void 0}get coOwnerList(){if(this.feedItemVideoData?.clip?.items?.[0]?.short_video_info?.co_owners?.length){return[{owner_id:this.feedItemVideoData.source_id,status:"approved",can_set_status:!1}].concat(this.feedItemVideoData.clip.items[0].short_video_info.co_owners)}return this.coOwners?.list||[]}get isCanOpenCoOwnersModal(){return this.coOwnerList.length>1}get coOwnerUserGroupEntityList(){return this.coOwnerList.map((e=>this.ownerService.provideUserGroupEntityById(e.owner_id))).filter((e=>!!e))}get acceptedCoOwnersCountWithoutAuthor(){const e=this.coOwnerList.filter((e=>!e.status||"approved"===e.status)).length-1;return e<1?0:e}get header(){return this.clipPost?{title:{source_id:this.clipPost.owner_id},photo:{source_id:this.clipPost.owner_id}}:this.videoPost?{title:{source_id:this.videoPost.owner_id},photo:{source_id:this.videoPost.owner_id}}:"header"in this.feedItemData?this.feedItemData.header:this.ownerId?{title:{source_id:this.ownerId},photo:{source_id:this.ownerId}}:void 0}get actionIconData(){return this.header?.icon}get actionIconModalData(){return this.actionIconData?.action?.modal}get date(){return this.header?.date}get isSuggestSubscribeOnOwner(){return!this.uiConfig?.disallowSubscribeBtn&&(!this.acceptedCoOwnersCountWithoutAuthor&&(!this.isSuggestPost&&!this.isPostponePost&&((void 0===this.fromId||this.ownerId===this.fromId)&&Boolean("suggest_subscribe"in this.feedItemData&&this.feedItemData.suggest_subscribe))))}get feedItemOwnerEntity(){if(this.ownerId)return this.ownerService.provideUserGroupEntityById(this.ownerId)}get isSubscribedOnOwner(){return!!this.ownerId&&this.ownerService.isMemberOrMembershipRequested(this.ownerId)}get isSubscribingOnOwner(){return!!this.ownerId&&this.ownerService.isSubscribingOnOwnerById(this.ownerId)}get adsEasyPromote(){return"ads_easy_promote"in this.feedItemData?this.feedItemData.ads_easy_promote:void 0}get adsEasyPromoteType(){return this.adsEasyPromote?.type}get isAdNotFromAdsEasyPromote(){return this.adsEasyPromote?.is_ad_not_easy}get adsEasyPromoteAdId(){return this.adsEasyPromote?.ad_id}get adsEasyPromoteButtonText(){return this.adsEasyPromote?.button_text}get adsEasyPromoteButtonLabelText(){return this.adsEasyPromote?.label_text}get isSuggestPromote(){return 1===this.adsEasyPromoteType}get promotionLink(){return this.adsEasyPromoteAdId?this.config.getAlreadyPostPromotingLink?.(this.adsEasyPromoteAdId):this.config.getAdCreateLink?.(this.feedItemId)}getSourceOwnerIds(e){const t=this.header?.[e];if(t){const{source_ids:e,source_id:i}=t;if(e)return e;if(i)return[i]}return console.warn(`Post ${e} without source_id or source_ids`),[]}get titleOwnerIds(){return this.getSourceOwnerIds("title")}get primaryTitleOwnerId(){const[e]=this.titleOwnerIds;return e}get primaryTitleEntity(){if(this.primaryTitleOwnerId)return this.ownerService.provideUserGroupEntityById(this.primaryTitleOwnerId)}get secondaryTitleOwnerId(){const[,e]=this.titleOwnerIds;return e}get secondaryTitleEntity(){if(this.secondaryTitleOwnerId)return this.ownerService.provideUserGroupEntityById(this.secondaryTitleOwnerId)}get avatarSourceOwnerIds(){return this.getSourceOwnerIds("photo")}get primaryAvatarOwnerId(){const[e]=this.avatarSourceOwnerIds;return e}get primaryAvatarEntity(){if(this.primaryAvatarOwnerId)return this.ownerService.provideUserGroupEntityById(this.primaryAvatarOwnerId)}get secondaryAvatarOwnerId(){const[,e]=this.avatarSourceOwnerIds;return e}get titleId(){return this.props.current.titleId}get fallbackPrimaryTitleText(){if(this.feedItemVideoData?.video?.items?.length){const e=this.feedItemVideoData?.video?.items[0];return e.main_artists?.[0]?.name}}get primaryTitleText(){if(this.primaryTitleOwnerId)return this.ownerService.getOwnerNameById(this.primaryTitleOwnerId)||this.fallbackPrimaryTitleText}get secondaryTitleText(){if(!(this.acceptedCoOwnersCountWithoutAuthor>1)&&this.secondaryTitleOwnerId)return this.ownerService.getOwnerNameById(this.secondaryTitleOwnerId)}get fallbackPrimaryHref(){if(this.feedItemVideoData?.video?.items?.length){const e=this.feedItemVideoData?.video?.items[0];return`/artist/${e.main_artists?.[0]?.id}`}}get primaryTitleHref(){if(this.primaryTitleOwnerId)return this.ownerService.getOwnerHrefById(this.primaryTitleOwnerId)||this.fallbackPrimaryHref}get secondaryTitleHref(){if(this.secondaryTitleOwnerId)return this.ownerService.getOwnerHrefById(this.secondaryTitleOwnerId)}get delimiterText(){return this.langs.getLang("wall_coauthors_and_in_title")}get shortSecondaryTitleText(){const e=this.langs.numeric(this.acceptedCoOwnersCountWithoutAuthor,this.langs.getLang("wall_coauthors_more_authors_title",!0));return this.langs.langReplace(e,{count:this.acceptedCoOwnersCountWithoutAuthor.toString()})}get primaryAvatarHref(){if(this.primaryAvatarOwnerId)return this.ownerService.getOwnerHrefById(this.primaryAvatarOwnerId)||this.fallbackPrimaryHref}get fallbackPrimaryAvatarSrc(){if(this.feedItemVideoData?.video?.items?.length){const e=this.feedItemVideoData?.video?.items[0];return(0,be.q)(e.main_artists?.[0]?.photo??[],this.primaryAvatarSize*(0,Se.m)())?.url}}get primaryAvatarSrc(){if(this.primaryAvatarOwnerId)return this.ownerService.getUserGroupPhotoSrc(this.primaryAvatarOwnerId)||this.fallbackPrimaryAvatarSrc}get primaryAvatarSize(){return this.isNested?this.compact?24:32:this.compact?36:40}get primaryAvatarWithStorySize(){return this.compact?34:38}get primaryAvatarSizeProps(){return this.primaryHasStories?{hasStories:!0,size:this.primaryAvatarWithStorySize}:{hasStories:!1,size:this.primaryAvatarSize}}get coOwnerAvatarSize(){return this.isNested?this.compact?24:32:this.compact?36:40}get primaryHasStories(){return!this.isNested&&!this.isCanOpenCoOwnersModal&&Boolean(this.primaryAvatarEntity?.has_unseen_stories)}get secondaryAvatarSrc(){if(this.secondaryAvatarOwnerId)return this.ownerService.getUserGroupPhotoSrc(this.secondaryAvatarOwnerId)}get defaultAvatarAlt(){return""}get primaryAvatarAlt(){return this.primaryAvatarOwnerId&&this.ownerService.getOwnerNameById(this.primaryAvatarOwnerId)||this.defaultAvatarAlt}get secondaryAvatarAlt(){return this.secondaryAvatarOwnerId&&this.ownerService.getOwnerNameById(this.secondaryAvatarOwnerId)||this.defaultAvatarAlt}get descriptions(){return this.isNested?[]:this.deactivatedProfileDescription?[this.deactivatedProfileDescription]:this.header?.descriptions??[]}get nestedItemDescription(){if(this.isNested)return this.deactivatedProfileDescription}get deactivatedProfileDescription(){if(!this.feedItemPostData?.final_post)return;if(!this.feedItemOwnerEntity||!("sex"in this.feedItemOwnerEntity))return;let e=this.langs.sex(this.feedItemOwnerEntity.sex??xe.F.UNKNOWN,this.langs.getLang("profile_new_deact_void",!0));return this.feedItemPostData?.text&&(e=this.langs.sex(this.feedItemOwnerEntity.sex??xe.F.UNKNOWN,this.langs.getLang("profile_new_deact_status",!0))),{text:{text:e}}}get subtitleId(){return this.props.current.subtitleId}get subtitleParentComponentType(){return this.isCanUseDrum&&this.descriptions.some((e=>e.is_animable))?"drum":"list"}get copyright(){return"copyright"in this.feedItemData?this.feedItemData.copyright:void 0}get dataRoles(){return this.props.current.dataRoles}get adsPropsTitle(){return this.props.current.adLegacyData?{"data-post-click-type":this.props.current.adLegacyData?.title.clickType,"data-item-owner-id":this.primaryTitleOwnerId,"data-from-id":this.primaryTitleOwnerId,"data-post-id":this.feedItemId}:{}}get adsPropsAvatar(){return this.props.current.adLegacyData?{"data-post-click-type":this.props.current.adLegacyData?.avatar.clickType,"data-item-owner-id":this.primaryAvatarOwnerId,"data-from-id":this.primaryAvatarOwnerId,"data-post-id":this.feedItemId}:{}}[a.zr](){this.feedStoriesService.dispose()}constructor(e,t,i,n,o,s,r,a){this.langs=e,this.authService=t,this.ownerService=i,this.postHandlers=n,this.props=o,this.userEnv=s,this.storiesEventsService=r,this.externalEvents=a,this._isCoOwnerListModalOpened=!1,this._isActionIconModalOpened=!1,this.feedStoriesService=new Ye.R(this.userEnv,this.storiesEventsService,this.externalEvents,this.ownerService),this.getCoOwnerStatusByUserGroupEntity=e=>{const t=Te(e);return this.coOwnerList.find((e=>e.owner_id===t))?.status},this.userGroupIsPostOwner=e=>Te(e)===this.ownerId,this.checkIsCanSubscribeByUserGroupEntity=e=>{const t=Te(e),i=this.coOwnerList.find((e=>e.owner_id===t));return!(!i||!("can_subscribe"in i))&&!!i.can_subscribe},this.handleToggleOwnerSubscription=e=>{(0,Ae.T)(e),this.ownerId&&this.ownerService.toggleSubscriptionByOwnerId(this.ownerId,{track_code:this.trackCode,source:this.props.current.feedItemRef,event_subtype:"header_follow_text"})},this.handlePromote=e=>{(0,Pe.X)(e.nativeEvent)||!this.isSuggestPromote||this.isAdNotFromAdsEasyPromote||((0,Ae.T)(e),this.onClickPromote?.(this.feedItemId))},this.handleOpenCoOwnersModal=(e,t="from_header")=>{(0,Pe.X)(e.nativeEvent)||e.currentTarget instanceof Node&&e.target instanceof Node&&!e.currentTarget.contains(e.target)||Oe(e)||this.isCanOpenCoOwnersModal&&((0,Ae.T)(e),this._isCoOwnerListModalOpened=!0,this.postHandlers.click.onOpenCoOwnersModal({item_owner_id:this.isNested?this.ownerId:void 0,item_id:this.isNested?this.itemId:void 0},this.feedItemId,t,this.isNested))},this.handleTitleClick=(e,t)=>{if((0,Pe.X)(e.nativeEvent))return e.nativeEvent.stopPropagation(),void this.handleOpenGroupOrUser(t);this.isCanOpenCoOwnersModal?this.handleOpenCoOwnersModal(e):this.handleOpenGroupOrUser(t)},this.handlePrimaryTitleClick=e=>{this.primaryTitleOwnerId&&this.handleTitleClick(e,this.primaryTitleOwnerId)},this.handleSecondaryTitleClick=e=>{this.secondaryTitleOwnerId&&this.handleTitleClick(e,this.secondaryTitleOwnerId)},this.handleOpenGroupOrUser=e=>{e&&this.postHandlers.click.openGroupOrUser(e,{item_owner_id:e,item_id:this.isNested?this.itemId:void 0,event_subtype:"header_name",track_code:this.trackCode},this.feedItemId,this.isNested)},this.openStories=async(e,t)=>{if((0,Ae.T)(e),void 0!==t&&!(0,Pe.X)(e.nativeEvent)){if(this.postHandlers.click.onOpenStory({feedItemId:this.feedItemId,entryPoint:"header_photo"}),this.uiConfig?.openStoriesInNewTab){const e=await this.ownerService.getFirstStory(t);return void(e&&window.open(`/feed?w=story${e.owner_id}_${e.id}/owner_feed${e.owner_id}`,"_blank"))}this.props.current.config?.openStories&&this.props.current.config.openStories({storyOwnerId:t,rawId:this.feedItemId,source:"post_avatar",reopenPostLayer:this.uiConfig?.reopenPostLayerAfterLegacyStoriesLayer})}},this.handleCloseCoOwnerListModal=()=>{this._isCoOwnerListModalOpened=!1},this.handleOpenActionIconModal=()=>{this._isActionIconModalOpened=!0},this.handleCloseActionIconModal=()=>{this._isActionIconModalOpened=!1},this.handleModalLinkClick=e=>{const t=Te(e);this.postHandlers.click.openGroupOrUserInCoOwnerModal(t,{ref:"coowner_modal_card",item_owner_id:t,item_id:this.isNested?this.itemId:void 0},this.feedItemId,this.isNested)},this.handleToggleCoownersModalFollow=e=>{const t=!this.isMemberOrMembershipRequested(e);this.ownerService.toggleSubscriptionByOwnerId(e,{track_code:this.trackCode,event_subtype:"header_follow_text"}),this.postHandlers.click.toggleFollow({ref:"coowner_modal_card",id:this.itemId,owner_id:this.ownerId},{entry_point:{entry_point:"header_follow_text"},target_coowner_id:e},this.feedItemId,t)},this.isMemberOrMembershipRequested=e=>this.ownerService.isMemberOrMembershipRequested(e),this.isInProcessOfSubscribing=e=>this.ownerService.isSubscribingOnOwnerById(e),this.getSubtitleDataAttrsByAction=e=>{switch(e?.type){case"open_copyright":return{href:this.copyright?.link,target:"_blank"};case"open_geo_feed":return this.isPlaceGeoType?{...Ee.Lq,href:this.geoFeedHref,withHoverUnderline:!0,onClick:e=>{this.geoFeedHref&&(0,Pe.X)(e.nativeEvent)?this.postHandlers.click.onOpenGeoFeed({feedItemId:this.feedItemId}):this.handleOpenGeoFeed(e)}}:{};case"remote_action":return{target:"_blank",colorToken:"color_text_link",onClick:e.remote_action?.url?.includes("wall")?this.openPost:void 0,href:e.remote_action?.url};default:return{}}},this.handleOpenGeoFeed=e=>{this.geoPlaceId&&this.config?.handleOpenGeoFeed&&((0,Ae.T)(e),this.config.handleOpenGeoFeed(this.geoPlaceId),this.postHandlers.click.onOpenGeoFeed({feedItemId:this.feedItemId}))},this.getHeaderIconDataAttrsByAction=e=>"best_friend_posting"===e?.type?{onClick:()=>{this.authService.userId&&this.config.bestFriendTooltipOnClickActionButton?.(this.authService.userId)}}:{},(0,c.l_)(this)}}Re=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===E.Y?Object:E.Y,void 0===Ce.u?Object:Ce.u,void 0===I.v?Object:I.v,void 0===T.i?Object:T.i,void 0===a.Ji?Object:a.Ji,void 0===L.J?Object:L.J,void 0===Ie.G?Object:Ie.G,void 0===ke.r?Object:ke.r])],Re);const{Provider:De,useModel:Be}=(0,a.Qd)(Re,{initInEffect:!1});var Fe=i(946918);const Ne=(0,o.P)((function(){const{handleOpenCoOwnersModal:e,secondaryAvatarOwnerId:t,handleOpenGroupOrUser:i,primaryAvatarOwnerId:o,primaryAvatarHref:s,primaryAvatarSrc:r,primaryAvatarSizeProps:a,primaryHasStories:d,secondaryAvatarSrc:c,primaryAvatarAlt:l,secondaryAvatarAlt:h,coOwnerAvatarSize:p,openStories:u,dataRoles:m,isCanOpenCoOwnersModal:g,adsPropsAvatar:_}=Be(),v=(0,Fe.B)();return t?(0,n.FD)(ye.CoownersAvatar,{size:p,"data-testid":"post-header-avatar",onClick:t=>{e(t,"from_combo_avatar")},children:[(0,n.Y)(X.G.Item,{alt:l,src:r}),(0,n.Y)(X.G.Item,{alt:h,src:c})]}):(0,n.Y)(ye.Avatar,{...a,"data-role":m?.avatar,alt:l,href:s,src:r,tabIndex:g?0:-1,"aria-hidden":!g,"aria-label":g?v.getLang("wall_coauthors_open_author_modal"):"","data-testid":"post-header-avatar",onClick:t=>{(0,Pe.X)(t.nativeEvent)?i(o):g?e(t,"from_combo_avatar"):d?u(t,o):i(o)},..._,...Ee.Lq})}));var ze=i(386518),je=i(51759),Ue=i(789514),We=i(762364),$e=i(590878);const He=({entity:e,ignoreGovernmentOrganization:t,ignoreImageStatusUrl:i,ignoreVerified:o})=>{const{handleIconStatusClick:s,dismissButtonMode:r,governmentPublicInfoLink:a,verificationInfoLink:d,verificationInfoTitleLink:c,verificationByBusinessLink:l,verificationByOtherServiceInfoLink:h,modalCardComponent:p,modalComponent:u,authService:m,compact:g}=Be(),_=[];if(!e)return _;const v=m.userId===e.id;!i&&s&&"image_status"in e&&e.image_status&&_.push((0,n.Y)("div",{children:(0,n.Y)(ze.l,{entity:e,handleIconStatusClick:s})},"image-status-icon"));const f=!t&&"is_government_organization"in e&&e.is_government_organization&&a;return f&&_.push((0,n.Y)("div",{children:(0,n.Y)(je.W,{noPopover:g,dismissButtonMode:r,governmentPublicInfoLink:a,modalCardComponent:p,modalComponent:u})},"government-organization-status")),f||o||(e.verified?_.push((0,n.Y)("div",{children:(0,n.Y)(Ue.M,{entity:e,verificationInfoLink:d,verificationInfoTitleLink:c})},"verified-status")):"trust_mark"in e&&(e.trust_mark||0)>=2?_.push((0,n.Y)("div",{children:(0,n.Y)(We.X,{isPremium:2===e.trust_mark,verificationByBusinessLink:l})},"verified-status")):"is_verified"in e&&e.is_verified&&_.push((0,n.Y)("div",{children:(0,n.Y)($e.e,{entity:e,isCurrentOwnerProfile:v,verificationByOtherServiceInfoLink:h})},"verified-status"))),_},Ve=(0,o.P)((function(){const{primaryTitleEntity:e,secondaryTitleEntity:t,secondaryTitleOwnerId:i,shortSecondaryTitleText:o,delimiterText:s,primaryTitleHref:r,secondaryTitleHref:a,primaryTitleText:d,secondaryTitleText:c,handleOpenCoOwnersModal:l,dataRoles:h,adsPropsTitle:p,handlePrimaryTitleClick:u,handleSecondaryTitleClick:m}=Be(),g=He({entity:e}),_=He({entity:t});if(d&&i)return(0,n.Y)(ye.CoownersTitle,{renderPrimaryTitle:e=>(0,n.Y)(ye.Title,{overflowHidden:e,afterTitle:g,href:r,...p,onClick:u,title:d,"data-testid":"post-header-coowners-title","data-role":h?.title,children:d}),renderSecondaryTitle:e=>!e&&c?(0,n.Y)(ye.Title,{afterTitle:_,href:a,...p,onClick:m,title:c,"data-role":h?.title,"data-testid":"post-header-coowners-subtitle",children:c}):(0,n.Y)(j.SB4,{activeMode:"none",hoverMode:"none",onClick:l,children:(0,n.Y)(ye.Title,{"data-role":h?.title,"data-testid":"post-header-coowners-short-subtitle",children:o})}),delimiter:(0,n.Y)(ye.Title,{children:s})})})),Ke=(0,o.P)((function(){const{primaryTitleEntity:e,secondaryTitleOwnerId:t,primaryTitleHref:i,primaryTitleText:o,handlePrimaryTitleClick:s,dataRoles:r,adsPropsTitle:a}=Be(),d=He({entity:e});if(o)return t?(0,n.Y)(Ve,{}):(0,n.Y)(ye.Title,{overflowHidden:!0,afterTitle:d,href:i,onClick:s,"data-role":r?.title,"data-testid":"post-header-title",title:o,...a,...Ee.Lq,children:o})}));var qe=i(350696),Ge=i(235306);const Je=(0,o.P)((function(){const e=(0,Fe.B)(),{isPinned:t}=Be();return t?(0,n.FD)(n.FK,{children:[(0,n.Y)(Ge.O,{"data-testid":"post-header-subtitle-pin",className:(0,G.I)("color_icon_medium")}),(0,n.Y)(j.s6o,{children:e.getLang("wall_post_header_post_pinned")})]}):null})),Qe=(0,o.P)((function(){const{date:e,isPinned:t,allowShowDate:i,showFullDate:o,compact:s,nestedItemDescription:r}=Be(),a=(0,qe.I)({timeInSeconds:e,showFullDate:o}),d=[];return t&&d.push((0,n.Y)(Je,{},"pin")),i&&a&&d.push((0,n.Y)(ye.Subtitle,{"data-testid":"post-header-subtitle-date",compact:s,children:a},"date")),r&&d.push((0,n.Y)(ye.Subtitle,{compact:s,children:r.text?.text},"description")),d}));var Xe=i(144127),Ze=i(154159),et=i(876427),tt=i(799649),it=i(423654);const nt=({text:e,replacements:t})=>{let i=0;const o=[],s=Object.keys(t).map((e=>e.replace(/[\[\]\^\$\.\*\+\?|]/g,"\\$&"))).join("|");return Array.from(e.matchAll(new RegExp(s,"g"))).forEach((s=>{const{index:r}=s,a=s[0];i!==r&&o.push((0,n.Y)(H.Fragment,{children:e.substring(i,r)},`text-${r}`)),o.push((0,n.Y)(H.Fragment,{children:t[a]},`replacement-${r}`)),i=r+a.length})),i<e.length&&o.push((0,n.Y)(H.Fragment,{children:e.substring(i)},"end-of-text")),o},ot={accent:"color_text_accent",secondary:"color_text_secondary",primary:"color_text_primary",dynamic_blue:"color_accent_blue",dynamic_green:"color_accent_green",dynamic_purple:"color_accent_purple",dynamic_gray:"color_accent_gray",dynamic_red:"color_accent_red",dynamic_orange:"color_accent_orange",dynamic_violet:"color_accent_violet"},st=({text:e})=>{const t={};return Array.from(e.matchAll(RegExp("\\[(?<color_name>\\w+)\\|(?<colored_text>[^\\]]+)\\]","g"))).forEach((e=>{const{groups:i}=e;if(!i)return;const{color_name:o,colored_text:s}=i,r=ot[o]||"color_text_primary",a=e[0];t[a]=(0,n.Y)("span",{className:(0,G.I)(r),children:s})})),(0,n.Y)(nt,{replacements:t,text:e})};var rt=i(596911),at=i(590071),dt=i(171910);const ct={star_circle_fill_yellow:(0,n.Y)(rt.U,{}),users:(0,n.Y)(at.m,{className:(0,G.I)("color_icon_accent")}),favorite:(0,n.Y)(dt.p,{className:(0,G.I)("color_icon_positive")})},lt=(0,o.P)((function(){const{actionIconData:e,actionIconModalData:t,dismissButtonMode:i,modalComponent:o,modalCardComponent:s,isActionIconModalOpened:r,primaryAvatarAlt:a,primaryAvatarSrc:d,handleCloseActionIconModal:c}=Be();if(!e||!o||!s)return;const l=s,h=o,p=ct[e.name],u=t?.title,m=t?.text?.text;return(0,n.Y)(h,{id:"post-privacy-information-modal",isShown:r,type:"card",onClose:c,children:(0,n.Y)(l,{id:"post-privacy-information-modal",onClose:c,icon:(0,n.Y)(Q.g,{size:72,alt:a,src:d,children:p&&(0,n.Y)(Q.g.Badge,{children:p})}),title:u,description:m&&(0,n.Y)(st,{text:m}),dismissButtonMode:i})})}));var ht=i(916982);const pt={star_circle_fill_yellow:(0,n.Y)(Xe.W,{}),users:(0,n.Y)(Ze.B,{className:(0,G.I)("color_icon_accent")}),favorite:(0,n.Y)(et.x,{className:(0,G.I)("color_icon_positive")})},ut=(0,o.P)((function(){const{actionIconData:e,actionIconModalData:t,actionIconMode:i,handleOpenActionIconModal:o,getHeaderIconDataAttrsByAction:r}=Be();if(!e)return;const a=pt[e.name];if(!a)return;const d=t?.title,c=t?.text?.text,l=t?.button,h=r(l?.action);return"modal"===i?(0,n.FD)(n.FK,{children:[(0,n.Y)(tt.K,{label:e?.accessibility_text,noPadding:!0,onClick:o,children:a}),(0,n.Y)(lt,{})]}):(0,n.Y)(ht.E,{maxWidth:300,trigger:["hover","click"],arrow:!0,"aria-labelledby":"title",content:({onClose:e})=>(0,n.FD)(s.i,{paddingTop:8,paddingBottom:8,children:[d&&(0,n.Y)(q.tW,{id:"title",weight:"2",children:d}),c&&(0,n.Y)(q.tW,{role:"text",children:(0,n.Y)(st,{text:c})}),l?.text.text&&(0,n.Y)(it.N,{...h,onClick:()=>{e(),h.onClick?.()},children:(0,n.Y)(q.tW,{children:l.text.text})})]}),children:(0,n.Y)(tt.K,{hoverMode:"opacity",activeMode:"none",label:e?.accessibility_text,noPadding:!0,children:a})})})),mt=(0,o.P)((function(){const{promotionLink:e,handlePromote:t,adsEasyPromoteButtonText:i,adsEasyPromoteButtonLabelText:o}=Be();if(i)return(0,n.Y)(ye.ActionButton,{href:e,target:"_blank",onClick:t,label:o,"data-testid":"post-header-promo-button",children:i})})),gt=(0,o.P)((function(){const e=(0,Fe.B)(),{isSubscribedOnOwner:t,isSubscribingOnOwner:i,handleToggleOwnerSubscription:o}=Be();return(0,n.Y)(ye.ActionButton,{loading:i,onClick:o,"data-testid":"post-header-subscription-button",children:t?e.getLang("news_you_subscribed"):e.getLang("global_fan_subscribe")})})),_t=(0,o.P)((function(){const{actionIconData:e,isSuggestSubscribeOnOwner:t,contextMenu:i,isNested:o,showPromoteButton:s}=Be(),r=[];return e&&r.push((0,n.Y)("div",{"data-testid":"post-header-action-button",children:(0,n.Y)(ut,{})},"action-icon")),t&&r.push((0,n.Y)(gt,{},"subscription")),s&&r.push((0,n.Y)(mt,{},"promotion")),i&&!o&&r.push((0,n.Y)(H.Fragment,{children:i},"menu")),r}));var vt=i(382142),ft=i(998917),wt=i(56471);const yt={place:(0,n.Y)(vt.U,{className:(0,G.I)("color_icon_tertiary")}),flash_12:(0,n.Y)(ft.t,{className:(0,G.I)("color_icon_tertiary")})},bt={open_geo_feed:"post-header-subtitle-geo"},Ct=(0,o.P)((function(){const{isReplyPost:e,subtitleParentComponentType:t,descriptions:i,getSubtitleDataAttrsByAction:o,dataRoles:s,compact:r,subtitleId:a}=Be();if(!i.length)return;const d=i.map((({text:e,accessibility_text:t,tooltip:i,icon:a,action:d})=>{const c=e?.text,l=a?.name,h=t||c,p=o(d),u=c&&parseInt(c,10),m=!!u&&(c.endsWith("+")&&u>=0&&u<=19);let g=(0,n.Y)(ye.Subtitle,{compact:r,"data-role":m?s?.ageRestrictions:s?.subtitle,icon:l&&yt[l],"aria-label":h,"data-testid":d?.type?bt[d.type]:"post-header-subtitle",...p,children:c});return i?(0,n.Y)(wt.f,{maxWidth:300,description:(0,n.Y)(q.tW,{children:i.text}),children:g},c):(0,n.Y)(H.Fragment,{children:g},c)}));return"list"===t?(0,n.Y)(ye.SubtitleList,{id:a,delimiter:e?void 0:(0,n.Y)(ye.Subtitle,{children:"·"}),children:d}):(0,n.Y)(ye.SubtitleDrum,{id:a,children:d})}));var kt=i(370633),It=i(704620),St=i(982444),At=i(259029),Pt=i(8439),Lt=i(448264),Ot=i(266287),Et=i(292184);const xt=(0,H.memo)((function({isGovernmentOrganization:e,status:t,sex:i,ownerId:n}){const o=(0,Fe.B)();return"pending"===t?l.z.isGroupId(n)?o.getLang("wall_coowner_status_pending_by_group"):o.sex(i||0,o.getLang("wall_coowner_status_pending",!0)):e?o.getLang("groups_government_community"):null})),Yt=(0,o.P)((function({entity:e}){const t=(0,Fe.B)(),{userGroupModalAvatarSize:i,handleToggleCoownersModalFollow:o,getCoOwnerStatusByUserGroupEntity:s,userGroupIsPostOwner:r,handleModalLinkClick:a,isMemberOrMembershipRequested:d,isInProcessOfSubscribing:c,checkIsCanSubscribeByUserGroupEntity:l}=Be(),h=Te(e),p=(0,Pt.H)(e),u=(0,Lt.W)(e),m=(0,Ot.l)(e),g=s(e),_=r(e),v=l(e),f=c(h),w="is_government_organization"in e&&e.is_government_organization,y=He({entity:e,ignoreGovernmentOrganization:!0}),b=He({entity:e,ignoreImageStatusUrl:!0,ignoreVerified:!0});return(0,H.createElement)(Et.T,{href:u,...Ee.Lq,onClick:()=>{a(e)},key:h,badgeAfterTitle:(0,n.Y)(K.s,{align:"center",children:y}),subtitle:(0,n.Y)(xt,{sex:"sex"in e?e.sex:0,ownerId:h,isGovernmentOrganization:w,status:g}),badgeBeforeSubtitle:(0,n.Y)(K.s,{align:"center",children:b}),before:(0,n.Y)(Q.g,{size:i,src:m,alt:p,"aria-hidden":!0,children:_&&(0,n.Y)(Q.g.Badge,{children:(0,n.Y)(At.r,{})})}),after:v&&(0,n.Y)(J.$,{mode:"secondary",size:"s",appearance:"neutral",disabled:f,loading:f,"data-testid":d(h)?"authors-modal-coauthor-unsubscribe-button":"authors-modal-coauthor-subscribe-button",onClick:e=>{(0,Ae.T)(e),o(h)},children:d(h)?(0,n.Y)(q.LE,{weight:"2",className:(0,G.I)("color_text_subhead"),children:t.getLang("news_you_subscribed")}):t.getLang("global_public_join")})},p)})),Mt=(0,o.P)((function(){const e=(0,Fe.B)(),{modalComponent:t,isCoOwnerListModalOpened:i,handleCloseCoOwnerListModal:o,coOwnerUserGroupEntityList:s}=Be();if(!t)return;const r=t;return(0,n.Y)(r,{id:"user-group-list-modal",headerId:"user-group-list-header",type:"modal",isShown:i,onClose:o,title:e.getLang("wall_coauthors_modal_title"),width:450,children:(0,n.FD)(kt.Y,{mode:"plain","data-testid":"coownersmodal-list",children:[(0,n.Y)(It.f,{spacing:4,children:s.map((e=>(0,n.Y)(Yt,{entity:e},e.id)))}),(0,n.Y)(St.K,{size:"xl"})]})})})),Tt=(0,o.P)((function(){const e=(0,z.K)(),{titleId:t,mode:i,compact:o,handleOpenCoOwnersModal:s,lightThemeFadeColor:r,darkThemeFadeColor:a}=Be(),d=(0,H.useMemo)((()=>({overflowColor:"light"===e?r:a})),[e]);return(0,n.FD)(n.FK,{children:[(0,n.Y)(ye.OverflowProvider,{value:d,children:(0,n.Y)(ye,{titleId:t,spacing:o?8:12,onHeaderClick:s,mode:i,avatar:(0,n.Y)(Ne,{}),title:(0,n.Y)(Ke,{}),afterTitle:(0,n.Y)(Qe,{}),actions:(0,n.Y)(_t,{}),subtitle:(0,n.Y)(Ct,{})})}),(0,n.Y)(Mt,{})]})})),Rt=(0,a.jn)(De,Tt);var Dt=i(780482),Bt=i(782536),Ft=i(999051);class Nt{get modalComponent(){return this.props.current.ModalComponent}get actionsComponent(){return this.props.current.ActionsComponent}get handleDestroy(){return this.props.current.onDestroy}get isShown(){return this.props.current.isShown}get mode(){return this.props.current.mode}get handleUserGroupSelected(){return this.props.current.onUserGroupSelected}get userGroupEntities(){return this.props.current.userGroupEntities}get title(){return"accepting"===this.mode?this.langs.getLang("wall_coauthors_accepting_card_title"):this.langs.getLang("wall_coauthors_rejecting_card_title")}get subtitle(){return"accepting"===this.mode?this.langs.getLang("wall_coauthors_accepting_card_subtitle"):this.langs.getLang("wall_coauthors_rejecting_card_subtitle")}get actionText(){return"accepting"===this.mode?this.langs.getLang("wall_coauthors_accepting_card_action"):this.langs.getLang("wall_coauthors_rejecting_card_action")}get selectedEntityId(){return this._selectedEntityId}constructor(e,t){this.langs=e,this.props=t,this._selectedEntityId=null,this.handleChange=e=>()=>{this._selectedEntityId=e},this.handleConfirmSelection=()=>{if(!this.selectedEntityId)return;const e=this.userGroupEntities.find((e=>e.id===this.selectedEntityId));this.handleUserGroupSelected(e),this.handleDestroy()},(0,c.l_)(this)}}Nt=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===E.Y?Object:E.Y,void 0===a.Ji?Object:a.Ji])],Nt);const{Provider:zt,useModel:jt}=(0,a.Qd)(Nt,{initInEffect:!1});var Ut=i(93059);const Wt=(0,o.P)((function(){const{userGroupEntities:e,selectedEntityId:t,handleChange:i,subtitle:o}=jt();return(0,n.FD)(n.FK,{children:[(0,n.Y)(s.i,{role:"text",mode:"horizontal",children:(0,n.Y)(q.LE,{className:(0,G.I)("color_text_subhead"),children:o})}),(0,n.Y)(St.K,{}),e.map((e=>{const o=(0,Pt.H)(e);return(0,n.Y)(Ut.N,{before:(0,n.Y)(Q.g,{size:48,src:(0,Ot.l)(e),alt:o,"aria-hidden":!0}),selectable:!1,checked:t===e.id,onChange:i(e.id),children:o},o+e.id)}))]})})),$t=(0,o.P)((function(){const{isShown:e,modalComponent:t,handleDestroy:i,title:o,actionsComponent:s}=jt(),r=t,a=s;return(0,n.Y)(r,{onClose:i,isShown:e,id:"selecting-user-group-modal",headerId:"selecting-user-group-modal-header",type:"modal",title:o,actions:(0,n.Y)(a,{}),width:450,children:(0,n.Y)(Wt,{})})})),Ht=(0,a.jn)(zt,$t);var Vt=i(998286);class Kt{async acceptCoOwnership(e,t){try{await this.wallApi.acceptCoOwnership(t),(0,c.h5)((()=>{this.feedEntitiesMutationService.mutateFeedPostItemCoOwnerStatus(e,t.co_owner_id,"approved"),this.feedEntitiesMutationService.mutateFeedPostItemRemoveCoOwnershipRequests(e,t.co_owner_id),this.feedEntitiesMutationService.addFeedPostItemHeaderSource(e,t.co_owner_id)}))}catch{throw Error("CoOwnership accept request has been failed")}}async rejectCoOwnership(e,t){try{await this.wallApi.rejectCoOwnership(t),(0,c.h5)((()=>{this.feedEntitiesMutationService.mutateFeedPostItemCoOwnerStatus(e,t.co_owner_id,"rejected"),this.feedEntitiesMutationService.mutateFeedPostItemRemoveCoOwnershipRequests(e,t.co_owner_id)}))}catch{throw Error("CoOwnership reject request has been failed")}}async cancelCoOwnership(e,t){if(!this.postsCancelRequestLoading.get(e)){this.postsCancelRequestLoading.set(e,!0);try{await this.wallApi.delete({owner_id:t.id,post_id:t.slavePostId}),this.feedEntitiesMutationService.removeCoOwner(e,t.id),this.feedEntitiesMutationService.removeFeedPostItemHeaderSource(e,t.id),this.feedEntitiesMutationService.addAnyIdFeedPostItemHeaderSource(e)}catch(e){this.errorLogger.log(e)}finally{(0,c.h5)((()=>{this.postsCancelRequestLoading.delete(e)}))}}}markAllAsPended(e){this.feedEntitiesMutationService.markAllApprovedCoOwnersAsPended(e)}constructor(e,t,i){this.wallApi=e,this.feedEntitiesMutationService=t,this.errorLogger=i,this.postsCancelRequestLoading=new Map,(0,c.l_)(this)}}Kt=(0,d.Cg)([a.z8.container(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===Vt.t?Object:Vt.t,void 0===f.K?Object:f.K,void 0===_.v?Object:_.v])],Kt);class qt{get bannerViewState(){return this._bannerViewState}get isViewRequestsState(){return["view-requests","select-request-for-accepting","in-process-of-accepting","select-request-for-rejecting","in-process-of-rejecting"].includes(this.bannerViewState)}get isLoadingState(){return["in-process-of-rejecting","in-process-of-accepting"].includes(this.bannerViewState)}get selectingCoownersModalOpenedMode(){return"select-request-for-rejecting"===this.bannerViewState?"rejecting":"select-request-for-accepting"===this.bannerViewState?"accepting":void 0}get lastProcessedRequest(){return this._lastProcessedRequest}get coOwnershipSettingLink(){return this.lastProcessedRequest?.request_rejected_privacy_link}get config(){return this.props.current.config}get modalComponent(){return this.config.ModalComponent}get actionsComponent(){return this.config.ActionsComponent}get postItem(){return this.props.current.postItem}get rawId(){return this.postItem.id}get postItemData(){return this.postItem.value}get postId(){return this.postItemData.id}get ownerId(){return this.postItemData.owner_id}get coOwners(){return this.postItemData.coowners}get requests(){return this.coOwners?.requests||[]}get isSingleRequest(){return 1===this.requests.length}get hasAnyRequest(){return this.requests.length>0}get currentRequest(){const[e]=this.requests;return e}get requestEntities(){return this.requests.map((e=>this.ownerService.provideUserGroupEntityById(e.coowner_id))).filter((e=>void 0!==e))}get currentRequestForEntity(){const e=this.currentRequest;if(e)return this.ownerService.provideUserGroupEntityById(e.coowner_id)}get ownerEntity(){if(this.ownerId)return this.ownerService.provideUserGroupEntityById(this.ownerId)}get text(){return"accepted"===this.bannerViewState&&this.lastProcessedRequest?l.z.isGroupId(this.lastProcessedRequest.coowner_id)?this.langs.getLang("wall_coauthors_invite_card_accept_by_group_text"):this.langs.getLang("wall_coauthors_invite_card_accept_text"):""}constructor(e,t,i,n,o,s){this.langs=e,this.errorLogger=t,this.postHandlers=i,this.ownerService=n,this.wallCoOwnershipService=o,this.props=s,this._bannerElement=null,this._bannerViewState="hidden",this._lastProcessedRequest=null,this.handleAskBannerToHide=()=>{this._bannerViewState="hidden"},this.openSelectingRequestModalForAccepting=()=>{this._bannerViewState="select-request-for-accepting"},this.openSelectingRequestModalForRejecting=()=>{this._bannerViewState="select-request-for-rejecting"},this.handleCloseSelectingRequestsModal=()=>{["select-request-for-rejecting","select-request-for-accepting"].includes(this.bannerViewState)&&(this._bannerViewState="view-requests")},this.handleAcceptRequest=async e=>{if(!this.isSingleRequest&&!e)return void this.openSelectingRequestModalForAccepting();const t=e||this.currentRequest;if(!t||!this.postId||!this.rawId)return;let i=this.requests.length;try{this._bannerViewState="in-process-of-accepting",await this.wallCoOwnershipService.acceptCoOwnership(this.rawId,{post_id:this.postId,post_owner_id:t.owner_id,co_owner_id:t.coowner_id}),(0,c.h5)((()=>{this._lastProcessedRequest=t,i-=1,this._bannerViewState=0===i?"accepted":"view-requests"}))}catch(e){(0,c.h5)((()=>{this._bannerViewState="view-requests"})),this.errorLogger.log(e)}},this.handleRejectRequest=async e=>{if(!this.isSingleRequest&&!e)return void this.openSelectingRequestModalForRejecting();const t=e||this.currentRequest;if(!t||!this.postId||!this.rawId)return;let i=this.requests.length;try{this._bannerViewState="in-process-of-rejecting",await this.wallCoOwnershipService.rejectCoOwnership(this.rawId,{post_id:this.postId,post_owner_id:t.owner_id,co_owner_id:t.coowner_id}),(0,c.h5)((()=>{i-=1,0===i?(this._lastProcessedRequest=t,this._bannerViewState="rejected"):this._bannerViewState="view-requests"}))}catch(e){(0,c.h5)((()=>{this._bannerViewState="view-requests"})),this.errorLogger.log(e)}},this.handleProcessRequestByEntity=e=>{if(!e)return;const t=Te(e);if(!t)return;const i=this.requests.find((e=>e.coowner_id===t));i&&("select-request-for-accepting"!==this.bannerViewState?"select-request-for-rejecting"!==this.bannerViewState||this.handleRejectRequest(i):this.handleAcceptRequest(i))},this.handleClickCoownershipSettingLink=()=>{this.rawId&&this.lastProcessedRequest&&this.postHandlers.click.onClickSetUpInvitationsButton({feedItemId:this.rawId,itemOwnerId:this.lastProcessedRequest.coowner_id})},this.setBannerElement=e=>{this._bannerElement=e},this.tryMoveFocusInCloseButton=()=>{this._bannerElement?.querySelector("button")?.focus()},(0,c.l_)(this),this.hasAnyRequest&&(this._bannerViewState="view-requests")}}qt=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===E.Y?Object:E.Y,void 0===_.v?Object:_.v,void 0===T.i?Object:T.i,void 0===I.v?Object:I.v,void 0===Kt?Object:Kt,void 0===a.Ji?Object:a.Ji])],qt);const{Provider:Gt,useModel:Jt}=(0,a.Qd)(qt,{initInEffect:!1}),Qt=({entity:e})=>{if(!e)return"";let t=(0,Pt.H)(e);return t?((0,Me.P)(e)&&(t=`«${t}»`),(0,n.Y)("b",{children:t})):""},Xt=(0,o.P)((function(){const e=(0,Fe.B)(),{ownerEntity:t,currentRequestForEntity:i,bannerViewState:o,isViewRequestsState:s,isSingleRequest:r,lastProcessedRequest:a}=Jt(),d=(0,n.Y)(Qt,{entity:t}),c=(0,n.Y)(Qt,{entity:i});if(s&&d){if((0,Me.P)(i)&&r&&c){let i=e.getLang("wall_coauthors_invite_card_from_user_to_group_text");return(0,Me.P)(t)&&(i=e.getLang("wall_coauthors_invite_card_from_group_to_group_text")),(0,n.Y)(nt,{text:i,replacements:{"{from_name}":d,"{to_name}":c}})}let o=e.getLang("wall_coauthors_invite_card_from_user_to_user_text");return(0,Me.P)(t)&&(o=e.getLang("wall_coauthors_invite_card_from_group_to_user_text")),(0,n.Y)(nt,{text:o,replacements:{"{name}":d}})}return"rejected"===o?e.getLang("wall_coauthors_invite_card_reject_text"):"accepted"===o&&a?l.z.isGroupId(a.coowner_id)?e.getLang("wall_coauthors_invite_card_accept_by_group_title"):e.getLang("wall_coauthors_invite_card_accept_title"):""})),Zt=(0,o.P)((function(){const{text:e,coOwnershipSettingLink:t,handleClickCoownershipSettingLink:i,handleAskBannerToHide:o,isViewRequestsState:s,handleAcceptRequest:r,handleRejectRequest:a,handleCloseSelectingRequestsModal:d,handleProcessRequestByEntity:c,modalComponent:l,actionsComponent:h,requestEntities:p,selectingCoownersModalOpenedMode:u,bannerViewState:m,isLoadingState:g,setBannerElement:_,tryMoveFocusInCloseButton:v}=Jt();(0,H.useEffect)((()=>{s||v()}),[v,s]);const f=(0,Fe.B)();if("hidden"!==m)return(0,n.FD)(n.FK,{children:[(0,n.Y)(Dt.l,{getRootRef:_,"aria-busy":g,"aria-live":"polite",stretched:!0,after:s?void 0:"dismiss",onDismiss:o,title:(0,n.Y)(Xt,{}),extraSubtitle:e,"data-testid":"post_coowner_banner",actions:"accepted"!==m&&(0,n.FD)(Bt.e,{mode:"horizontal",gap:"m",stretched:!0,children:[s&&(0,n.FD)(n.FK,{children:[(0,n.Y)(J.$,{disabled:"in-process-of-rejecting"===m,"aria-disabled":"in-process-of-accepting"===m,mode:"primary",appearance:"accent",onClick:()=>{r()},"data-testid":"post_coowner_banner_actions_accept",children:"in-process-of-accepting"===m?(0,n.Y)(Ft.y,{size:"s",noColor:!0,stretched:!0}):f.getLang("wall_coauthors_invite_card_accept")}),(0,n.Y)(J.$,{disabled:"in-process-of-accepting"===m,"aria-disabled":"in-process-of-rejecting"===m,mode:"link",appearance:"accent",onClick:()=>{a()},"data-testid":"post_coowner_banner_actions_reject",children:"in-process-of-rejecting"===m?(0,n.Y)(Ft.y,{size:"s",noColor:!0,stretched:!0}):f.getLang("wall_coauthors_invite_card_reject")})]}),"rejected"===m&&(0,n.Y)(J.$,{mode:"link",target:"_blank",href:t,onClick:i,appearance:"accent","data-testid":"post_coowner_banner_actions_settings",children:f.getLang("wall_coauthors_invite_card_settings")})]})}),u&&(0,n.Y)(Ht,{mode:u,isShown:!0,onDestroy:d,onUserGroupSelected:c,userGroupEntities:p,ActionsComponent:h,ModalComponent:l})]})})),ei=(0,a.jn)(Gt,Zt);var ti=i(879093),ii=i(819300),ni=i(127574),oi=i(561412);class si{constructor(e,t,i){this.commentsService=e,this.feedEntitiesMutationService=t,this.errorLogger=i,this.requestState=new oi.X(this.commentsService.fetchComments.bind(this.commentsService),this.errorLogger),this.updatePostAfterDonut=async({ownerId:e,postId:t,data:i})=>{try{const{object_info:n,new_comment_id:o}=i;n&&this.feedEntitiesMutationService.mutateFeedPostItemBadges({ownerId:e,postId:t,badges:n}),o&&await this.commentsService.fetchComment({owner_id:e,comment_id:o},!0)}catch(e){this.errorLogger.log(e)}},(0,c.l_)(this)}}si=(0,d.Cg)([a.z8.container(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===ni.y?Object:ni.y,void 0===f.K?Object:f.K,void 0===_.v?Object:_.v])],si);const ri="is_in_bookmarks_toggle",ai="is_notifications_enabled_toggle",di="link_copy",ci="not_interested",li="cancel_coownership",hi="report",pi="donut",ui="stats",mi="pin",gi="edit",_i="comments_close",vi="archive",fi="delete",wi="to_original",yi="unsub_from_comments",bi="about_advertiser",Ci="recommendation_terms",ki="erid",Ii="donut_post_open_to_all",Si="publish_now",Ai="ad_stat";function Pi(e){return["photo","photo_tag"].includes(e)}const Li=e=>"coowners"in e&&(!!e.coowners?.list&&Boolean(e.coowners.list.filter((e=>!e.status||"approved"===e.status)).length-1)),Oi=e=>Li(e),Ei=e=>e.map((e=>e.filter((e=>null!==e)))).filter((e=>e.length>0));function xi(e,t){return"can_view_stats"in e&&e.can_view_stats&&t.platformConfig?.showStats&&(t.isPostFromMyPublic||t.isMyPost)?ui:null}function Yi(e){return"can_pin"in e&&e.can_pin?mi:null}function Mi(e,t){if("coowners"in e&&Oi(e)){const i=e.coowners?.coowner_post_id,n=e.coowners?.is_owner;if(i)return t.ignoreSlavePost&&n?gi:null}return"post_type"in e&&"suggest"===e.post_type?t.isPostFromMyPublic&&!t.isMyPost?null:gi:"can_edit"in e&&e.can_edit?gi:null}function Ti(e,t){return"post_type"in e&&"suggest"===e.post_type?null:"can_publish"in e&&e.can_publish||"isMyPost"in t&&t.isMyPost&&"post_type"in e&&void 0!==e.post_type&&["postpone","draft"].includes(e.post_type)?Si:null}function Ri(e,t){if("coowners"in e&&Oi(e)){const i=e.coowners?.coowner_post_id,n=e.coowners?.is_owner;if(i)return t.ignoreSlavePost&&n?_i:null}return"post_type"in e&&void 0!==e.post_type&&["suggest","draft"].includes(e.post_type)?null:"comments"in e&&(e.comments?.can_close||e.comments?.can_open)&&"post_type"in e&&"postpone"!==e.post_type?_i:null}function Di(e,t){return"post_type"in e&&void 0!==e.post_type&&["suggest","draft"].includes(e.post_type)?null:t.hasUnsubInMenuInCommentsFeed&&"post_type"in e&&"postpone"!==e.post_type?yi:null}function Bi(e){return"ads"in e&&"post"!==e.ads[0]?.type||"is_deleted"in e&&e.is_deleted||"post_type"in e&&void 0!==e.post_type&&["postpone","suggest","draft"].includes(e.post_type)?null:ri}function Fi(e){return"author_ad"in e&&e.author_ad?.advertiser_info_url||"advertiser_info_url"in e?bi:null}function Ni(e){return"author_ad"in e&&e.author_ad?.recommendation_info||"recommendation_info"in e?Ci:null}function zi(e){return"author_ad"in e&&e.author_ad?.ad_marker||"ad_marker"in e&&e.ad_marker?ki:null}function ji(e,t){return"donut"in e&&e.donut?.is_donut||"post_type"in e&&void 0!==e.post_type&&["suggest","draft"].includes(e.post_type)||"ad_marker"in e||Oi(e)||!t.hasNotificationsInMenu||t.isMyPost||t.isPostFromMyPublic?null:ai}function Ui(e){return"is_archived"in e&&e.is_archived||"ads"===e.type&&"ads"in e&&"web_sdk"===e.ads?.[0]?.type&&!e.ads?.[0]?.link_url?null:di}function Wi(e,t){return"post_type"in e&&void 0!==e.post_type&&["suggest","draft"].includes(e.post_type)?null:"donut_miniapp_url"in e&&e.donut_miniapp_url&&t.platformConfig?.openOneTimeDonutModal?pi:null}function $i(e){return"donut"in e&&e.donut?.can_publish_free_copy&&"draft"!==e.post_type?Ii:null}function Hi(e){return"copy_history"in e&&e.copy_history&&e.copy_history.length>0?wi:null}function Vi(e){return"can_archive"in e&&e.can_archive?vi:null}function Ki(e,t){if("is_deleted"in e&&e.is_deleted)return null;if("coowners"in e&&Oi(e)){const i=e.coowners?.coowner_post_id,n=e.coowners?.is_owner;if(i)return t.ignoreSlavePost&&n?fi:null}return"can_delete"in e&&e.can_delete||"post_type"in e&&"postpone"===e.post_type?fi:null}function qi(e,t){if(t.hasNoCoownershipDeclineInMenu)return null;if("coowners"in e&&Oi(e)){const t=e.coowners?.coowner_post_id;if(!t)return null;if(e.coowners?.list?.some((e=>e.owner_id===t.owner_id&&e.is_current_user)))return li}return null}function Gi(e,t){return t.disableNotInterestingInMenu||!("can_ignore"in e&&e.can_ignore||"ad_marker"in e)||t.isMyPost||t.isPostFromMyPublic?null:ci}function Ji(e,t){if("coowners"in e&&Oi(e)){const i=e.coowners?.coowner_post_id,n=e.coowners?.is_owner;if(!i&&!n)return hi;if(i&&t.ignoreSlavePost&&n)return null;const o=e.coowners?.list?.slice(1)||[];return o?.some((e=>e.owner_id===i?.owner_id&&e.is_current_user))||n&&!i?null:hi}return t.isMyPost?"is_archived"in e&&e.is_archived&&e.from_id!==e.owner_id?hi:null:t.isPostFromMyPublic?"post_type"in e&&"suggest"===e.post_type?hi:null:hi}function Qi(e){return"ads_easy_promote"in e&&e.ads_easy_promote?.ad_id&&!e.ads_easy_promote?.is_ad_not_easy?Ai:null}var Xi=i(97929),Zi=i(191196),en=i(698853),tn=i(69789),nn=i(628418);class on{get data(){return this.props.current.data.value}get menuConfig(){return this.props.current.platformConfig}get captionText(){if("caption"in this.data&&"fake_news"!==this.data.caption?.type)return this.data.caption?.text}get postRawId(){return this.props.current.data.id}get menuContext(){return{actions:{copyLink:()=>this.copyLink(),handleEridCopy:()=>this.handleEridCopy(),handleReport:()=>this.handleReport(),handleNotInterestingClick:()=>this.handleNotInterestingClick(),handleDonut:()=>this.handleDonut(),handleShowStats:()=>this.handleShowStats(),handleEdit:()=>this.handleEdit(),handleDelete:()=>this.handleDelete(),handleArchiveToggle:()=>this.handleArchiveToggle(),onSuccessUnsubscribeFromComments:()=>this.onSuccessUnsubscribeFromComments(),toggleBookmark:e=>this.toggleBookmark(e),toggleComments:e=>this.toggleComments(e),openDonutPost:()=>this.openDonutPost(),handlePin:()=>this.handlePin(),aboutAdvertiserClick:()=>this.aboutAdvertiserClick(),goToOriginalPostClick:()=>this.goToOriginalPostClick(),handleArchiveConfirmation:()=>new Promise((e=>{this.setActionCoOwnersModalType("archive"),this._actionModalExecutor=e})),handleDeleteConfirmation:()=>new Promise((e=>{this.setActionCoOwnersModalType("delete"),this._actionModalExecutor=e})),handleCancelConfirmation:()=>new Promise((e=>{this.setActionCoOwnersModalType("cancel"),this._actionModalExecutor=e})),removeFeedItem:()=>{},publishNow:()=>this.publishPostponedPost()},data:{advertiserUrl:this.advertiserUrl,repostUrl:"copy_history"in this.data&&this.data.copy_history?.length?this.menuConfig?.getRepostUrl({id:this.data.copy_history[0]?.id,ownerId:this.data.copy_history[0]?.owner_id||this.data.copy_history[0]?.source_id,type:this.data.copy_history[0]?.post_type}):"",adRecommendationTermsUrl:this.adRecommendationInfo,adStatUrl:"ads_easy_promote"in this.data?`/ads?act=office&union_id=${this.data.ads_easy_promote?.ad_id}&utm_source=vk_post_action_has_ad_id`:void 0,notInterestedSkipApi:Boolean(this.adData)}}}get isMyPost(){return this.ownerId===this.authService.userId||"created_by"in this.data&&this.data.created_by===this.authService.userId||"from_id"in this.data&&this.data.from_id===this.authService.userId}get isPostFromMyPublic(){if(this.ownerId&&l.z.isGroupId(this.ownerId)){const e=this.ownerService.provideUserGroupEntityById(this.ownerId);return!!e&&("is_admin"in e&&!!e.is_admin)}return!1}async copyLink(){const e=`${"clip"===this.props.current.data.apiType||"video"===this.props.current.data.apiType?this.props.current.data.apiType:"wall"}${this.postRawId}`,t=`https://${window.location.hostname}/${e}`,i=this.adUrl?this.adUrl:t;await(0,ti.e)(i),this.snackbar.show({text:this.langs.getLang("wall_post_link_copied")}),this.postHandlers.click.onContextMenuCopyLinkAction({feedItemId:this.postRawId})}async handleEridCopy(){const e=this.adMarker;e&&(await(0,ti.e)(e),this.snackbar.show({text:this.langs.getLang("global_ads_wall_post_advertiser_ad_id_copied")}),this.postHandlers.click.onContextMenuCopyEridAction({feedItemId:this.postRawId}))}handleReport(){this.feedErrorService.canProceedOnClick()&&("ad_data"in this.data||"ads"in this.data?this.updateItemState("adReport"):this.menuConfig?.openReportForm&&"owner_id"in this.data&&this.data.owner_id&&this.data.id&&this.menuConfig.openReportForm(this.data.owner_id,this.data.id,(()=>{this.updateItemState("reportFormSubmitted")}),this.data.track_code,"clip"===this.data.type||"video"===this.data.type?"clip":void 0))}handleNotInterestingClick(){this.updateItemState("notInterested")}async handleDonut(){if(!this.feedErrorService.canProceedOnClick())return;const e="donut_miniapp_url"in this.data&&this.data.donut_miniapp_url;if(e)if(this.props.current.openOneTimeDonutInNewTab)window.open(e,"_blank");else if(this.menuConfig?.openOneTimeDonutModal){const t=await this.menuConfig.openOneTimeDonutModal(e);if(this.postHandlers.click.onContextMenuSendDonutAction({feedItemId:this.postRawId}),void 0===this.data.id||void 0===this.data.owner_id)return;await this.feedDonutService.updatePostAfterDonut({ownerId:this.data.owner_id,postId:this.data.id,data:t})}}handleShowStats(){this.feedErrorService.canProceedOnClick()&&this.menuConfig?.showStats&&(this.menuConfig.showStats(this.postRawId),this.postHandlers.click.onContextMenuPostStatOpenAction({feedItemId:this.postRawId}))}get postType(){return"post_type"in this.data?this.data.post_type:void 0}handleEdit(){if(this.feedErrorService.canProceedOnClick()&&"owner_id"in this.data&&this.data.owner_id){const{navigate:e,refetchPost:t,redirectUrl:i}=this.props.current;this.menuConfig?.editPost?.({postRaw:this.postRawId,ownerId:this.data.owner_id,navigate:e,refetchPost:t,redirectUrl:i,creationEntryPoint:this.postType?(0,en.m)(this.postType,this.metaData.get().module,l.z.isGroupId(this.data.owner_id)):void 0}),this.postHandlers.click.onContextMenuEditPostAction({feedItemId:this.postRawId})}}handleDelete(){this.postHandlers.click.onContextMenuDeletePostAction({feedItemId:this.postRawId}),this.updateItemState("deleted")}handleArchiveToggle(){"is_archived"in this.data&&(this.data.is_archived?(this.updateItemState("restored"),this.feedEventBusService.emitter.emit(this.feedEventBusService.events.REVEAL_POST,{postId:this.postId})):(this.updateItemState("archived"),this.feedEventBusService.emitter.emit(this.feedEventBusService.events.ARCHIVE_POST,{postId:this.postId})))}onSuccessUnsubscribeFromComments(){this.postHandlers.click.onContextMenuUnsubscribeCommentsAction({feedItemId:this.postRawId}),this.updateItemState("unsubscribedFromComments")}toggleBookmark(e){e&&this.snackbar.show({text:this.langs.getLang("wall_post_add_to_bookmark"),action:{label:this.langs.getLang("wall_go_to_bookmarks"),href:"/bookmarks"}})}toggleComments(e){this.feedEntitiesMutationService.toggleComments(this.postRawId),e&&this.postHandlers.click.onContextMenuCloseCommentsAction({feedItemId:this.postRawId})}get areCommentsClosedInGlobalSettings(){return"comments"in this.data&&!this.data.comments?.can_close&&!this.data.comments?.can_open}async openDonutPost(){this.postHandlers.click.onContextMenuMakeDonutPostPublicAction({feedItemId:this.postRawId});if(!await this.dialogsService.fastMessage({title:this.langs.getLang("wall_publish_donut_as_free_confirmation_title"),text:this.langs.getLang("wall_publish_donut_as_free_confirmation_confirm"),yesButtonLabel:this.langs.getLang("global_action_confirmation"),noButtonLabel:this.langs.getLang("global_cancel")}))return;const e={owner_id:this.ownerId,post_id:this.postId};await this.wallApi.post(e),this.snackbar.show({text:this.langs.getLang("wall_donut_post_published")})}async publishPostponedPost(){const e=this.publishNowType;if(!await this.dialogsService.fastMessage({title:this.langs.getLang("wall_publish_postponed_btn"),text:"draft"===e?this.langs.getLang("wall_publish_draft_confirm"):this.langs.getLang("wall_publish_postponed_confirm"),yesButtonLabel:this.langs.getLang("global_action_confirmation"),noButtonLabel:this.langs.getLang("global_cancel")}))return;const t=this.postType&&this.ownerId?(0,en.m)(this.postType,this.metaData.get().module,l.z.isGroupId(this.ownerId)):void 0,i=this.metaData.get().screen,n=(e=>e in tn.iB)(i)?tn.iB[i]:void 0,o={owner_id:this.ownerId,post_id:this.postId,creation_entry_point:t};this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")&&(o.entry_point=t,o.ref=n),await this.wallApi.post(o),e&&!this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")&&this.postHandlers.click.onContextMenuPublishPostponedPostAction({postType:e,creationEntryPoint:t,navScreen:n}),this.feedEntitiesMutationService.mutateFeedItemState(this.postRawId,"justPosted")}handlePin(){this.feedEntitiesMutationService.togglePostPin(this.postRawId)}aboutAdvertiserClick(){this.postHandlers.click.onContextMenuOpenAdvertiserInfoAction({feedItemId:this.postRawId})}goToOriginalPostClick(){this.postHandlers.click.onContextMenuOpenOriginalAction({feedItemId:this.postRawId})}get adMarker(){return"author_ad"in this.data&&this.data.author_ad?this.data.author_ad.ad_marker:"ad_marker"in this.data&&this.data.ad_marker?this.data.ad_marker:void 0}get advertiserUrl(){return"author_ad"in this.data&&this.data.author_ad?this.data.author_ad.advertiser_info_url:"advertiser_info_url"in this.data?this.data.advertiser_info_url:void 0}get adRecommendationInfo(){return"author_ad"in this.data&&this.data.author_ad?this.data.author_ad.recommendation_info:"recommendation_info"in this.data?this.data.recommendation_info:void 0}get isInFaves(){return"is_favorite"in this.data?this.data?.is_favorite:"clip"in this.data?this.data.clip?.items?.[0].is_favorite:void 0}get adUrl(){return"ads"in this.data?this.data.ads?.[0]?.link_url:"author_ad"in this.data&&this.data.author_ad?.ad_url?this.data.author_ad?.ad_url:null}get adInfo(){return{marker:this.adMarker,advertiserUrl:this.advertiserUrl,recommendationInfo:this.adRecommendationInfo}}get postId(){return"id"in this.data?this.data.id:"ads"in this.data?this.data.ads[0]?.post?.id:"post_id"in this.data?this.data.post_id:void 0}get ownerId(){return"owner_id"in this.data?this.data.owner_id:"ads"in this.data?this.data.ads[0]?.post?.owner_id:"source_id"in this.data?this.data.source_id:void 0}get adData(){return"ads"in this.data?this.data.ads[0]?.ad_data:"ad_data"in this.data?this.data.ad_data:void 0}get publishNowType(){if("post_type"in this.data)return this.data.post_type}get hasAnyApprovedCoauthor(){return Li(this.data)}get coownershipRequestList(){return"coowners"in this.data&&this.data.coowners?.requests||[]}get requestEntities(){return this.coownershipRequestList.map((e=>this.ownerService.provideUserGroupEntityById(e.coowner_id))).filter((e=>void 0!==e))}get modalComponent(){return this.menuConfig?.ModalComponent}get actionConfirmationModalType(){return this.props.current.platformConfig?.actionConfirmationModalType}get coOwnersActionModalType(){return this._coOwnersActionModalType}get coOwnershipCancelConfirmationModalInfo(){return{title:this.langs.getLang("wall_coauthors_post_canceling_coownership_confirm_title"),subtitle:l.z.isGroupId(Number(this.ownerId))?this.langs.getLang("wall_coauthors_post_canceling_coownership_confirm_subtitle_for_group"):this.langs.getLang("wall_coauthors_post_canceling_coownership_confirm_subtitle"),actionText:this.langs.getLang("wall_coauthors_post_canceling_coownership_confirm_action")}}get coOwnershipArchiveConfirmationModalInfo(){return{title:this.langs.getLang("wall_coauthors_post_archiving_confirm_title"),subtitle:this.langs.getLang("wall_coauthors_post_archiving_confirm_subtitle"),actionText:this.langs.getLang("wall_coauthors_post_archiving_confirm_action")}}get coOwnershipDeleteConfirmationModalInfo(){return{title:this.langs.getLang("wall_coauthors_post_deleting_confirm_title"),subtitle:this.langs.getLang("wall_coauthors_post_deleting_confirm_subtitle"),actionText:this.langs.getLang("wall_coauthors_post_deleting_confirm_action")}}get actionModalInfoByType(){return this._coOwnersActionModalType?{cancel:this.coOwnershipCancelConfirmationModalInfo,archive:this.coOwnershipArchiveConfirmationModalInfo,delete:this.coOwnershipDeleteConfirmationModalInfo}[this._coOwnersActionModalType]:null}get coOwnersInfo(){return{requestEntities:this.requestEntities,actionModalInfoByType:this.actionModalInfoByType,resetCoOwnersActionModal:this.resetCoOwnersActionModal,confirmCoOwnersActionModal:this.confirmCoOwnersActionModal}}get menuScheme(){return((e,t)=>{if(t.menuNotSupported)return[];if(e.type&&Pi(e.type))return Ei([[Gi(e,t)]]);const i=[[xi(e,t)],[Yi(e),Mi(e,t),Ti(e,t),Ri(e,t),$i(e),Bi(e),ji(e,t),Ui(e),Fi(e),Ni(e),zi(e),Qi(e),Hi(e),Wi(e,t)],[Di(e,t)],[Vi(e),Ki(e,t)],[qi(e,t),Gi(e,t),Ji(e,t)]];return Ei(i)})(this.data,{isMyPost:this.isMyPost,isPostFromMyPublic:this.isPostFromMyPublic,platformConfig:this.props.current.platformConfig,menuNotSupported:"post_type"in this.data&&"reply"===this.data.post_type||"market"===this.data.type||!!this.props.current.shouldHideMenuForClipsAndVideos&&("clip"===this.data.type||"video"===this.data.type),hasUnsubInMenuInCommentsFeed:this.props.current.hasUnsubInMenuInCommentsFeed,hasNotificationsInMenu:this.props.current.hasNotificationsInMenu,hasNoCoownershipDeclineInMenu:this.props.current.hasNoCoownershipDeclineInMenu,disableNotInterestingInMenu:this.props.current.disableNotInterestingInMenu,ignoreSlavePost:this.props.current.ignoreSlavePost})}get scheme(){const e=(e=>{const{actions:t,data:i}=e;return{[ri]:{key:ri,onSuccess:t.toggleBookmark},[ai]:{key:ai,onSuccess:()=>{}},[ci]:{key:ci,onClick:t.handleNotInterestingClick,skipApi:i.notInterestedSkipApi},[di]:{key:di,onClick:t.copyLink},[hi]:{key:hi,onClick:t.handleReport},[pi]:{key:pi,onClick:t.handleDonut},[ui]:{key:ui,onClick:t.handleShowStats},[mi]:{key:mi,onSuccess:t.handlePin},[gi]:{key:gi,onClick:t.handleEdit},[wi]:{key:wi,href:i.repostUrl,onSuccess:t.goToOriginalPostClick},[_i]:{key:_i,onSuccess:t.toggleComments},[vi]:{key:vi,onSuccess:t.handleArchiveToggle,onShowConfirmationModal:t.handleArchiveConfirmation},[fi]:{key:fi,onSuccess:t.handleDelete,onShowConfirmationModal:t.handleDeleteConfirmation},[yi]:{key:yi,onSuccess:t.onSuccessUnsubscribeFromComments},[bi]:{key:bi,href:i.advertiserUrl,onClick:t.aboutAdvertiserClick},[Ci]:{key:Ci,href:i.adRecommendationTermsUrl},[ki]:{key:ki,onClick:t.handleEridCopy},[Ii]:{key:Ii,onClick:t.openDonutPost},[Si]:{key:Si,onClick:t.publishNow},[li]:{key:li,onSuccess:t.removeFeedItem,onShowModalForSelectingCoauthorsToCancel:()=>Promise.resolve(void 0),onShowConfirmationModal:t.handleCancelConfirmation},[Ai]:{key:Ai,href:i.adStatUrl}}})(this.menuContext),t=[];for(const i of this.menuScheme){const n=[];for(const t of i)n.push(e[t]);t.push(n)}return t}constructor(e,t,i,n,o,s,r,a,d,l,h,p,u,m,g){this.props=e,this.userEnv=t,this.langs=i,this.snackbar=n,this.postHandlers=o,this.authService=s,this.groupsProvider=r,this.feedErrorService=a,this.ownerService=d,this.feedEntitiesMutationService=l,this.feedDonutService=h,this.wallApi=p,this.dialogsService=u,this.feedEventBusService=m,this.metaData=g,this.updateItemState=e=>{this.props.current.updateItemState&&this.props.current.updateItemState(e)},this._coOwnersActionModalType=null,this.setActionCoOwnersModalType=e=>{this._coOwnersActionModalType=e},this._actionModalExecutor=null,this.runActionModalExecutor=e=>{this._actionModalExecutor&&this._actionModalExecutor(e)},this.resetCoOwnersActionModal=()=>{this.setActionCoOwnersModalType(null),this.runActionModalExecutor(!1)},this.confirmCoOwnersActionModal=()=>{this.setActionCoOwnersModalType(null),this.runActionModalExecutor(!0)},(0,c.l_)(this)}}on=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===L.J?Object:L.J,void 0===E.Y?Object:E.Y,void 0===Xi.q?Object:Xi.q,void 0===T.i?Object:T.i,void 0===Ce.u?Object:Ce.u,void 0===ii.s?Object:ii.s,void 0===w.m?Object:w.m,void 0===I.v?Object:I.v,void 0===f.K?Object:f.K,void 0===si?Object:si,void 0===Vt.t?Object:Vt.t,void 0===Zi.M?Object:Zi.M,void 0===nn.S?Object:nn.S,void 0===O.e?Object:O.e])],on);const{Provider:sn,useModel:rn}=(0,a.Qd)(on,{initInEffect:!1});var an=i(141575),dn=i(838565),cn=i(865940),ln=i(165051),hn=i(186742),pn=i(739838),un=i(820282);class mn extends un.S{get namespace(){return"board"}constructor(...e){super(...e),this.deleteTopic=this.makeMethod("deleteTopic")}}mn=(0,d.Cg)([a.z8.global()],mn);class gn extends un.S{get namespace(){return"notes"}constructor(...e){super(...e),this.delete=this.makeMethod("delete")}}gn=(0,d.Cg)([a.z8.global()],gn);var _n=i(581288),vn=i(150242);const fn=e=>"name"in e&&"src"in e,wn=e=>fn(e)&&"slavePostId"in e&&"status"in e&&("approved"===e.status||!e.status),yn=e=>(e=>"data"in e&&!!e.data&&fn(e.data))(e)&&wn(e.data);class bn{async fetchGroup(){const e=l.z.convertOwnerIdToGroupId(this.data.id);this.fetchGroupPromise=this.groupsProviderV2.ensureFetchGroupById({groupId:e}),await this.fetchGroupPromise,(0,c.h5)((()=>{this.fetchGroupPromise=null}))}get isGroup(){return l.z.isGroupId(this.data.id)}get isGroupFetching(){return Boolean(this.fetchGroupPromise)}get dataForAcceptCoOwnershipRequest(){return{post_id:this.data.masterPostId,post_owner_id:this.data.masterPostOwnerId,co_owner_id:this.data.id}}get dataForRejectCoOwnershipRequest(){return{post_id:this.data.masterPostId,post_owner_id:this.data.masterPostOwnerId,co_owner_id:this.data.id}}get dataForCancelCoOwnershipRequest(){if(!wn(this.data))throw new Error("coauthor is not isIAcceptedCoauthor");return{owner_id:this.data.id,post_id:this.data.slavePostId}}async subscribe(){return this.isGroup?(this.isGroupFetching&&await this.fetchGroupPromise,await this.groupsSubscribeService.join({group_id:l.z.convertGroupIdToOwnerId(this.data.id)})):await this.usersSubscribeService.subscribe({user_id:this.data.id})}async unsubscribe(){return this.isGroup?(this.isGroupFetching&&await this.fetchGroupPromise,await this.groupsSubscribeService.leave({group_id:l.z.convertGroupIdToOwnerId(this.data.id)})):await this.usersSubscribeService.unsubscribe({user_id:this.data.id})}get isSubscribed(){return this.isGroup?this.groupsSubscribeService.getIsMemberOrSentRequest(l.z.convertGroupIdToOwnerId(this.data.id)):this.usersSubscribeService.getIsSubscribed(this.data.id)}get canSubscribe(){return this.isGroup?this.data.memberStatus!==_n.I.MEMBER&&this.data.memberStatus!==_n.I.HAS_SENT_A_REQUEST:this.data.id!==this.authService.userId&&this.data.memberStatus!==vn.h.IS_FRIEND&&this.data.memberStatus!==vn.h.OUTCOMING_REQUEST}get isPendingSubscription(){return this.isGroup?this.groupsSubscribeService.getIsLoading(l.z.convertGroupIdToOwnerId(this.data.id)):this.usersSubscribeService.getIsLoading(this.data.id)}constructor(e,t,i,n,o){this.data=e,this.groupsProviderV2=t,this.groupsSubscribeService=i,this.usersSubscribeService=n,this.authService=o,this.fetchGroupPromise=null,(0,c.l_)(this);const{memberStatus:s,id:r}=this.data,a=this.isGroup?this.groupsSubscribeService.getMemberStatus(l.z.convertOwnerIdToGroupId(r)):this.usersSubscribeService.getSubscriptionStatus(r);void 0===a?this.isGroup?this.fetchGroup():this.usersSubscribeService.setSubscriptionStatus(r,s):(0,c.h5)((()=>{this.data.memberStatus=a}))}}var Cn=i(626692),kn=i(119872);class In{createCoauthorList(e){return e.map((e=>new bn(e,this.groupsProvider,this.groupsSubscribeService,this.usersSubscribeService,this.authService)))}addAuthor(e,t){this.authorList.set(e,t)}addCoauthors(e,t){t.length&&t[0]&&(this.addAuthor(e,Object.assign({},t[0])),this.coauthorsList.set(e,this.createCoauthorList(t)))}addCoauthorRequests(e,t){this.coauthorsRequestList.set(e,this.createCoauthorList(t))}getCoauthorRequests(e){return this.coauthorsRequestList.get(e)||[]}getAuthor(e){return this.authorList.get(e)}getCoauthors(e){return this.coauthorsList.get(e)||[]}removeCoauthor(e,t){const i=this.getCoauthors(e).filter((e=>e.data.id!==t));this.coauthorsList.set(e,i)}getCoauthorRequest(e,t){return this.getCoauthorRequests(e).find((e=>e.data.id===t))}getMyMainCoauthorRequest(e){const t=this.getCoauthorRequests(e);if(1===t.length)return t[0]}getAcceptedCoauthors(e){return this.getCoauthors(e).filter(yn)}getMyAcceptedCoauthors(e){return this.getAcceptedCoauthors(e).filter((e=>e.data.isCurrentUser))}getMyAcceptedCoauthor(e,t){return this.getMyAcceptedCoauthors(e).find((e=>e.data.id===t))}getOwnerFoCurrentSlavePost(e){return this.getMyAcceptedCoauthors(e).find((e=>e.data.isOwnerFoCurrentSlavePost))}async cancelCoOwnership(e,t){const i=this.getMyAcceptedCoauthor(e,t);if(!i)throw new Error(`coauthor not found postFullId-${e}, coauthorId-${t}`);if(this.postsCancelRequestLoading.get(e))throw new Error("cancelCoOwnership request has already been sent");(0,c.h5)((()=>{this.postsCancelRequestLoading.set(e,!0)}));try{await this.wallApi.delete(i.dataForCancelCoOwnershipRequest),this.removeCoauthor(e,i.data.id)}catch{throw(0,c.h5)((()=>{this.postsCancelRequestLoading.delete(e)})),new Error(`cancelCoOwnership request was rejected postFullId-${e}, coauthorId-${t}`)}}async rejectCoOwnership(e,t){const i=this.getCoauthorRequest(e,t);if(!i)throw new Error(`coauthor request not found postFullId-${e}, coauthorId-${t}`);if(this.postsRejectRequestLoading.get(e))throw new Error("rejectCoOwnership request has already been sent");(0,c.h5)((()=>{this.postsRejectRequestLoading.set(e,!0)}));try{await this.wallApi.rejectCoOwnership(i.dataForRejectCoOwnershipRequest)}catch(i){throw(0,c.h5)((()=>{this.postsRejectRequestLoading.delete(e)})),new Error(`rejectCoOwnership request was rejected postFullId-${e}, coauthorId-${t}`)}}async acceptCoOwnership(e,t){const i=this.getCoauthorRequest(e,t);if(!i)throw new Error(`coauthor request not found postFullId-${e}, coauthorId-${t}`);if(this.postsAcceptRequestLoading.get(e))throw new Error("acceptCoOwnership request has already been sent");(0,c.h5)((()=>{this.postsAcceptRequestLoading.set(e,!0)}));try{await this.wallApi.acceptCoOwnership(i.dataForAcceptCoOwnershipRequest)}catch(i){throw(0,c.h5)((()=>{this.postsAcceptRequestLoading.delete(e)})),new Error(`acceptCoOwnership request was rejected postFullId-${e}, coauthorId-${t}`)}}markAllAsPended(e){const t=this.getAuthor(e);if(!t)return;if(!t.isCurrentUser)return void this.coauthorsList.delete(e);const i=this.getCoauthors(e).map((e=>yn(e)?new bn({...e.data,status:"pending",rejectedPrivacyLink:""},this.groupsProvider,this.groupsSubscribeService,this.usersSubscribeService,this.authService):e));this.coauthorsList.set(e,i)}constructor(e,t,i,n,o){this.wallApi=e,this.groupsProvider=t,this.groupsSubscribeService=i,this.usersSubscribeService=n,this.authService=o,this.postsCancelRequestLoading=new Map,this.postsAcceptRequestLoading=new Map,this.postsRejectRequestLoading=new Map,this.coauthorsList=new Map,this.coauthorsRequestList=new Map,this.authorList=new Map,(0,c.l_)(this)}}In=(0,d.Cg)([a.z8.global(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===Vt.t?Object:Vt.t,void 0===ii.s?Object:ii.s,void 0===Cn.Y?Object:Cn.Y,void 0===kn.H?Object:kn.H,void 0===Ce.u?Object:Ce.u])],In);const Sn={enabled:!1,loading:!1};class An{setState(e,t,i){this.notifications={...this.notifications,[e]:{enabled:t??!1,loading:i??this.getState(e).loading??!1}}}setLoading(e,t){this.setState(e,this.getState(e).enabled,t)}getState(e){return this.notifications[e]||Sn}constructor(){this.notifications={},(0,c.l_)(this)}}An=(0,d.Cg)([a.z8.container(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[])],An);const Pn=["wall","tag","profilephoto","video","photo","audio","clip"],Ln={post:"wall",photo_tag:"tag",wall_photo:"profilephoto"},On=e=>{if(!e)return"wall";const t=Ln[e]||e;return Pn.includes(t)?t:"wall"};var En=i(173327),xn=i(830443);class Yn{get isNotificationsEnabled(){return this.notificationsStore.notifications[this.props.current.ownerId]?.enabled||!1}get coOwners(){return this.props.current.coowners}get isSpaFeedEnabled(){return this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web")||this.userEnv.partConfigEnabled("frontend.feed_spa_single_wall_and_post")||this.userEnv.isToggleEnabled("feed_spa_single_wall_and_post")||this.userEnv.partConfigEnabled("web_spa_feed_single_wall_and_post")||this.userEnv.isToggleEnabled("feed_posting_new_draft")}[a.Ts](){this.notificationsStore.setState(this.props.current.ownerId,this.props.current.isNotificationsEnabled),this.isInFavourites=this.props.current.isInFavourites,this.isPinned=this.props.current.isPinned,this.isCommentsClosed=this.props.current.isCommentsClosed,this.isCommentsClosedInSettings=this.props.current.isCommentsClosedInSettings,this.isArchived=this.props.current.isArchived,this.isOriginalLang=this.props.current.isOriginalLang,this.postFullId=`${this.props.current.ownerId}_${this.props.current.postId}`,this.reactions.reaction((()=>this.props.current.isCommentsClosed),(e=>{this.isCommentsClosed=e}),{fireImmediately:!0})}async toggleIsInFavourites(){if(this.isInFavouritesLoading)return;(0,c.h5)((()=>{this.isInFavouritesLoading=!0}));const e={owner_id:this.props.current.ownerId,id:this.props.current.postId,track_code:this.props.current.trackCode,ref:(0,p.q)(this.metaData.get().screen,this.feedPostModal.isModalOpened)};try{switch(this.props.current.type){case"market_comment":case"market":this.isInFavourites?await this.faveApi.removeProduct(e):await this.faveApi.addProduct(e);break;case"video_comment":case"video":this.isInFavourites?await this.faveApi.removeVideo(e):await this.faveApi.addVideo(e);break;case"clip_comment":case"clip":this.isInFavourites?await this.faveApi.removeClip(e):await this.faveApi.addClip(e);break;default:this.isInFavourites?await this.faveApi.removePost(e):await this.faveApi.addPost(e)}this.toggleIsInFavouritesState()}catch(e){210===e?.error?.error_code?this.feedErrorService.showMissingPostSnackbar():this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.isInFavouritesLoading=!1}))}}toggleIsInFavouritesState(){(0,c.h5)((()=>{this.isInFavourites=!this.isInFavourites}))}get isNotificationsEnabledLoading(){return this.notificationsStore.notifications[this.props.current.ownerId]?.loading||!1}async toggleIsNotificationsEnabled(){if(this.isNotificationsEnabledLoading)return;(0,c.h5)((()=>{this.notificationsStore.setLoading(this.props.current.ownerId,!0)}));const e={owner_id:this.props.current.ownerId,track_code:this.props.current.trackCode};try{this.isNotificationsEnabled?await this.wallApi.unsubscribe(e):await this.wallApi.subscribe(e),(0,c.h5)((()=>{this.notificationsStore.setState(this.props.current.ownerId,!this.isNotificationsEnabled,!1)}))}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.notificationsStore.setLoading(this.props.current.ownerId,!1)}))}}async unsubscribe(){(0,c.h5)((()=>{this.unsubscribeLoading=!0}));const e="wall_comment"===this.props.current.type?"post":this.props.current.type?.replace("_comment",""),t={owner_id:this.props.current.ownerId,item_id:this.props.current.postId,type:e};try{await this.feedApi.unsubscribe(t)}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.unsubscribeLoading=!1}))}}async hidePost(){(0,c.h5)((()=>{this.hidePostLoading=!0}));const e=On(this.props.current.type),t={owner_id:this.props.current.ownerId,item_id:this.props.current.postId,track_code:this.props.current.trackCode,type:e};try{await this.feedApi.ignoreItem(t)}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.hidePostLoading=!1}))}}async unhidePost(){await this.feedApi.unignoreItem({owner_id:this.props.current.ownerId,item_id:this.props.current.postId,track_code:this.props.current.trackCode,type:this.props.current.type})}setIsPinned(e){this.isPinned=e}async toggleIsPinned(){if(this.isPinnedLoading)return;(0,c.h5)((()=>{this.isPinnedLoading=!0}));const e={owner_id:this.ownerFoCurrentSlavePost?.data.id||this.props.current.ownerId,post_id:this.ownerFoCurrentSlavePost?.data.slavePostId||this.props.current.postId};try{this.isPinned?await this.wallApi.unpin(e):await this.wallApi.pin(e),(0,c.h5)((()=>{this.isPinned=!this.isPinned}))}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.isPinnedLoading=!1}))}}async toggleIsCommentsClosed(){if(this.isCommentsClosedLoading)return;(0,c.h5)((()=>{this.isCommentsClosedLoading=!0}));const e={owner_id:this.props.current.ownerId,post_id:this.props.current.postId};try{this.isCommentsClosed?await this.wallApi.openComments(e):await this.wallApi.closeComments(e),(0,c.h5)((()=>{this.isCommentsClosed=!this.isCommentsClosed}))}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.isCommentsClosedLoading=!1}))}}setIsArchived(e){this.isArchived=e}async toggleIsArchived(){if(this.isArchivedLoading)return;(0,c.h5)((()=>{this.isArchivedLoading=!0}));const e={post_id:this.props.current.postId};try{this.isArchived?await this.wallApi.reveal(e):await this.wallApi.archive(e),this.postFullId&&(this.coOwners?this.feedCoOwnershipService.markAllAsPended(this.postFullId):this.coauthorListService.markAllAsPended(this.postFullId)),(0,c.h5)((()=>{this.isArchived=!this.isArchived}))}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.isArchivedLoading=!1}))}}async delete(){if(!this.deleteLoading){(0,c.h5)((()=>{this.deleteLoading=!0}));try{if("topic"===this.props.current.type){const e={group_id:Math.abs(this.props.current.ownerId),topic_id:this.props.current.postId};await this.boardApi.deleteTopic(e)}else if("note"===this.props.current.type)await this.notesApi.delete({note_id:this.props.current.postId});else{const e=this.props.current.postType?(0,en.m)(this.props.current.postType,this.metaData.get().module,l.z.isGroupId(this.props.current.ownerId)):void 0,t={owner_id:this.props.current.ownerId,post_id:this.props.current.postId,creation_entry_point:e};await this.wallApi.delete(t)}this.postFullId&&(this.coOwners?this.feedCoOwnershipService.markAllAsPended(this.postFullId):this.coauthorListService.markAllAsPended(this.postFullId))}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,c.h5)((()=>{this.deleteLoading=!1}))}}}async restore(){const e={owner_id:this.props.current.ownerId,post_id:this.props.current.postId};try{await this.wallApi.restore(e)}catch(e){this.feedErrorService.handleNetworkError(e)}}openDonutPost(){(0,c.h5)((()=>{this.donutPostWasOpened=!0}))}get cancelCoOwnershipLoading(){return!!this.postFullId&&(this.coOwners?Boolean(this.feedCoOwnershipService.postsCancelRequestLoading.get(this.postFullId)):Boolean(this.coauthorListService.postsCancelRequestLoading.get(this.postFullId)))}get ownerFoCurrentSlavePost(){if(this.postFullId){if(this.coOwners&&this.coOwners?.coowner_post_id){const e=this.coOwners.list?.find((e=>e.is_current_user&&e.owner_id===this.coOwners?.coowner_post_id?.owner_id));if(!e)return;return{data:{id:this.coOwners.coowner_post_id.owner_id,slavePostId:this.coOwners.coowner_post_id.post_id}}}return this.coauthorListService.getOwnerFoCurrentSlavePost(this.postFullId)}}shownDotsSendToAnalytics(){this.postMenuStats.sendClickToDotsAction({feedItemId:this.postFullId,trackCode:this.props.current.trackCode})}[a.zr](){this.reactions.destroy()}constructor(e,t,i,n,o,s,r,a,d,l,h,p,u,m){this.props=e,this.faveApi=t,this.feedApi=i,this.wallApi=n,this.boardApi=o,this.notesApi=s,this.coauthorListService=r,this.userEnv=a,this.feedErrorService=d,this.notificationsStore=l,this.postMenuStats=h,this.feedCoOwnershipService=p,this.metaData=u,this.feedPostModal=m,this.postFullId=void 0,this.reactions=new xn.O,this.isInFavouritesLoading=!1,this.unsubscribeLoading=!1,this.hidePostLoading=!1,this.isPinnedLoading=!1,this.isCommentsClosedLoading=!1,this.isArchivedLoading=!1,this.deleteLoading=!1,this.donutPostWasOpened=!1,this.cancelCoOwnership=e=>{if(!this.postFullId)return;const t=this.postFullId;if(this.coOwners){if(!this.ownerFoCurrentSlavePost?.data)return;return this.feedCoOwnershipService.cancelCoOwnership(t,this.ownerFoCurrentSlavePost?.data)}return this.coauthorListService.cancelCoOwnership(t,e)},(0,c.l_)(this)}}Yn=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===hn.L?Object:hn.L,void 0===pn.x?Object:pn.x,void 0===Vt.t?Object:Vt.t,void 0===mn?Object:mn,void 0===gn?Object:gn,void 0===In?Object:In,void 0===L.J?Object:L.J,void 0===w.m?Object:w.m,void 0===An?Object:An,void 0===En.F?Object:En.F,void 0===Kt?Object:Kt,void 0===O.e?Object:O.e,void 0===D.y?Object:D.y])],Yn);const{Provider:Mn,useModel:Tn}=(0,a.Qd)(Yn,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0}),Rn="PostContextMenu__wrapper--Oir3G",Dn="PostContextMenu__postMenu--4hQ5K";var Bn=i(754694),Fn=i(657842),Nn=i(786936);const zn=(0,o.P)((function({onSuccess:e,skipApi:t}){const i=Tn(),o=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:i.isInFavourites?(0,n.Y)(Fn.Z,{}):(0,n.Y)(Nn.U,{}),onClick:async()=>{if(t)return e(i.isInFavourites),void i.toggleIsInFavouritesState();await i.toggleIsInFavourites(),e(i.isInFavourites)},disabled:i.isInFavouritesLoading,loading:i.isInFavouritesLoading,"data-testid":"post_context_menu_item_bookmark_toggle",children:i.isInFavourites?o.getLang("fave_delete"):o.getLang("global_add_to_bookmarks")},ri)}));var jn=i(726519);var Un=i(927841);const Wn=(0,o.P)((function({onSuccess:e,onBeforeClick:t,onShowConfirmationModal:i}){const o=Tn(),s=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(Un.z,{className:(0,G.I)("color_icon_negative")}),onClick:async()=>{if(!o.deleteLoading){if(o.props.current.coauthorsState?.isPostWithApprovedCoauthors){if(!await i())return}t?.(),await o.delete(),e(!1,(()=>o.restore()))}},disabled:!o.isSpaFeedEnabled&&o.deleteLoading,"aria-disabled":o.isSpaFeedEnabled&&o.deleteLoading,"aria-busy":o.isSpaFeedEnabled?o.deleteLoading:void 0,loading:o.deleteLoading,"data-testid":"post_context_menu_item_delete",children:s.getLang("wall_delete_post_short")},fi)}));var $n=i(607123),Hn=i(819172);const Vn=(0,o.P)((function({onSuccess:e,onBeforeClick:t,onShowConfirmationModal:i}){const o=Tn(),s=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:o.isArchived?(0,n.Y)($n.L,{}):(0,n.Y)(Hn.U,{}),onClick:async()=>{if(!o.isArchivedLoading){if(o.props.current.coauthorsState?.isPostWithApprovedCoauthors){if(!await i())return}t?.(),await o.toggleIsArchived(),e(o.isArchived,(()=>o.toggleIsArchived()))}},disabled:!o.isSpaFeedEnabled&&o.isArchivedLoading,"aria-disabled":o.isSpaFeedEnabled&&o.isArchivedLoading,"aria-busy":o.isSpaFeedEnabled?o.isArchivedLoading:void 0,loading:o.isArchivedLoading,"data-testid":"post_context_menu_item_archive",children:o.isArchived?s.getLang("wall_archive_restore_post"):s.getLang("wall_post_reveal_archive")},vi)}));var Kn=i(993421);const qn=(0,o.P)((function({onSuccess:e}){const t=Tn(),i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(Kn.O,{}),onClick:async()=>{await t.unsubscribe(),e()},disabled:t.unsubscribeLoading,loading:t.unsubscribeLoading,"data-testid":"post_context_menu_item_unsub_from_comments",children:i.getLang("news_unsubscribe_comments")},yi)}));var Gn=i(937673);var Jn=i(217420);const Qn=(0,o.P)((function({onClick:e,href:t}){const i=Tn(),o=(0,Fe.B)();return i.donutPostWasOpened?null:(0,n.Y)(cn.v.Item,{before:(0,n.Y)(Jn.a,{}),onClick:()=>{e?.(),i.openDonutPost()},href:t,"data-testid":"post_context_menu_item_donut_open",children:o.getLang("wall_publish_free_donut_copy")},Ii)}));var Xn=i(954647);const Zn=(0,o.P)((function({onClick:e,skipApi:t,href:i,isIgnoreOwner:o}){const s=Tn(),r=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(Kn.O,{}),onClick:async()=>{t||await s.hidePost(),e()},disabled:s.hidePostLoading,loading:s.hidePostLoading,href:i,"data-testid":"post_context_menu_item_not_interested",children:o?r.getLang("groups_ignore_news"):r.getLang("wall_not_interesting")},ci)}));var eo=i(971711),to=i(168325);const io=(0,o.P)((function({onSuccess:e}){const t=Tn(),i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:t.isNotificationsEnabled?(0,n.Y)(eo.u,{}):(0,n.Y)(to.z,{}),onClick:async()=>{await t.toggleIsNotificationsEnabled(),e(t.isNotificationsEnabled)},disabled:t.isNotificationsEnabledLoading,loading:t.isNotificationsEnabledLoading,"data-testid":"post_context_menu_item_notify",children:t.isNotificationsEnabled?i.getLang("wall_unsubscribe_from_posts"):i.getLang("wall_subscribe_to_posts")},ai)}));var no=i(141165),oo=i(330244);const so=(0,o.P)((function({onSuccess:e}){const t=Tn(),i=(0,Fe.B)();return t.isCommentsClosedInSettings?null:(0,n.Y)(cn.v.Item,{before:t.isCommentsClosed?(0,n.Y)(no.H,{}):(0,n.Y)(oo.F,{}),onClick:async()=>{await t.toggleIsCommentsClosed(),e(t.isCommentsClosed,(()=>t.toggleIsCommentsClosed()))},disabled:t.isCommentsClosedLoading,loading:t.isCommentsClosedLoading,"data-testid":"post_context_menu_item_comments_toggle",children:t.isCommentsClosed?i.getLang("wall_open_comments"):i.getLang("wall_close_comments")},_i)}));var ro=i(968637),ao=i(757295);const co=(0,o.P)((function({onSuccess:e}){const t=Tn(),i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:t.isPinned?(0,n.Y)(ro.A,{}):(0,n.Y)(ao.r,{}),onClick:async()=>{await t.toggleIsPinned(),e?.(t.isPinned)},disabled:t.isPinnedLoading,loading:t.isPinnedLoading,"data-testid":"post_context_menu_item_pin",children:t.isPinned?i.getLang("wall_unfix_post"):i.getLang("wall_fix_post")},ui)}));var lo=i(181401);var ho=i(518710);var po=i(389261);const uo=(0,o.P)((function({href:e,onSuccess:t}){const i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(po.J,{}),onClick:()=>{t?.()},href:e,"data-testid":"post_context_menu_item_to_original",children:i.getLang("wall_go_to_original")},wi)}));var mo=i(784113);const go=(0,o.P)((function({onClick:e,href:t}){const i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(mo.a,{}),href:t,target:"_blank",onClick:()=>{e()},"data-testid":"post_context_menu_item_about_advertiser",children:i.getLang("global_ads_wall_post_advertiser_details")},bi)}));var _o=i(352039);const vo=(0,o.P)((function({href:e}){const t=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(_o.R,{}),href:e,target:"_blank","data-testid":"post_context_menu_item_recommendation_terms",children:t.getLang("adslight_wall_post_recommendation_info")},Ci)}));var fo=i(660965);const wo=(0,o.P)((function({onClick:e}){const t=Tn();return(0,n.FD)(cn.v.Item,{before:(0,n.Y)(fo.G,{}),onClick:()=>{e()},"data-testid":"post_context_menu_item_erid",children:["ERID: ",t.props.current.erid]},ki)}));var yo=i(200757);const bo=(0,o.P)((function({onClick:e,href:t}){const i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(yo.k,{}),href:t,onClick:()=>{e?.()},"data-testid":"post_context_menu_item_publish_now",children:i.getLang("wall_publish_now")},Si)})),Co=(0,o.P)((function({onSuccess:e,onShowModalForSelectingCoauthorsToCancel:t,onShowConfirmationModal:i}){const o=(0,Fe.B)(),{cancelCoOwnership:s,cancelCoOwnershipLoading:r,ownerFoCurrentSlavePost:a}=Tn();return(0,n.Y)(cn.v.Item,{disabled:r,loading:r,before:(0,n.Y)(Un.z,{className:(0,G.I)("color_icon_negative")}),onClick:async()=>{let n=a?.data.id;if(n||(n=await t()),!n)return;await i(l.z.isGroupId(n))&&(await s(n),e())},children:o.getLang("wall_cancel_coownership")},li)}));var ko=i(495768);const Io={BookmarksToggleItem:zn,NotificationsToggleItem:io,NotInterestedItem:Zn,LinkCopyItem:({onClick:e})=>{const t=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(jn.V,{}),onClick:()=>{e()},"data-testid":"post_context_menu_item_copy",children:t.getLang("wall_post_copy_link")},di)},ReportItem:({onClick:e,href:t})=>{const i=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(ho.y,{className:(0,G.I)("color_icon_negative")}),onClick:()=>{e()},href:t,"data-testid":"post_context_menu_item_report",children:i.getLang("wall_report")},hi)},DonutItem:({onClick:e})=>{const t=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(lo.h,{}),onClick:()=>{e()},"data-testid":"post_context_menu_item_donut",children:t.getLang("wall_button_to_send_donate")},pi)},StatsItem:({onClick:e})=>{const t=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(Gn.R,{}),onClick:()=>{e()},"data-testid":"post_context_menu_item_stats",children:t.getLang("wall_post_stats_short")},ui)},PinItem:co,EditItem:({onClick:e})=>{const t=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(Xn.Z,{}),onClick:()=>{e()},"data-testid":"post_context_menu_item_edit",children:t.getLang("wall_edit_post")},gi)},CancelCoOwnershipItem:Co,CommentsCloseItem:so,ArchiveItem:Vn,DeleteItem:Wn,ToOriginalItem:uo,UnsubFromCommentsItem:qn,AboutAdvertiserItem:go,RecommendationTermsItem:vo,EridItem:wo,DonutPostOpenToAllItem:Qn,PublishNowItem:bo,AdStatItem:({href:e})=>{const t=(0,Fe.B)();return(0,n.Y)(cn.v.Item,{before:(0,n.Y)(ko.A,{}),href:e,target:"_blank","data-testid":"post_context_menu_ad_item_stats",children:t.getLang("global_ads_wall_post_promote_stats")},ui)}},So=({item:e})=>{switch(e.key){case ri:return(0,n.Y)(Io.BookmarksToggleItem,{...e});case ai:return(0,n.Y)(Io.NotificationsToggleItem,{...e});case ci:return(0,n.Y)(Io.NotInterestedItem,{...e});case di:return(0,n.Y)(Io.LinkCopyItem,{...e});case hi:return(0,n.Y)(Io.ReportItem,{...e});case pi:return(0,n.Y)(Io.DonutItem,{...e});case ui:return(0,n.Y)(Io.StatsItem,{...e});case mi:return(0,n.Y)(Io.PinItem,{...e});case gi:return(0,n.Y)(Io.EditItem,{...e});case wi:return(0,n.Y)(Io.ToOriginalItem,{...e});case _i:return(0,n.Y)(Io.CommentsCloseItem,{...e});case vi:return(0,n.Y)(Io.ArchiveItem,{...e});case fi:return(0,n.Y)(Io.DeleteItem,{...e});case yi:return(0,n.Y)(Io.UnsubFromCommentsItem,{...e});case bi:return(0,n.Y)(Io.AboutAdvertiserItem,{...e});case Ci:return(0,n.Y)(Io.RecommendationTermsItem,{...e});case ki:return(0,n.Y)(Io.EridItem,{...e});case Ii:return(0,n.Y)(Io.DonutPostOpenToAllItem,{...e});case Si:return(0,n.Y)(Io.PublishNowItem,{...e});case li:return(0,n.Y)(Io.CancelCoOwnershipItem,{...e});case Ai:return(0,n.Y)(Io.AdStatItem,{...e});default:return null}};var Ao=i(243989);const Po=({text:e})=>(0,n.Y)(s.i,{spacing:8,mode:"vertical",children:(0,n.Y)(q.tW,{weight:"2",inline:!0,className:(0,G.I)("color_text_subhead"),children:(0,n.Y)(Ao.E,{children:e})})}),Lo=(0,o.P)((()=>{const e=Tn(),t=(0,Fe.B)(),i=(0,dn.D)(),{props:{current:{scheme:o,captionText:s,className:r}}}=e,a=t=>{t&&e.shownDotsSendToAnalytics()};return o.length?e.isSpaFeedEnabled?(0,n.Y)(K.s,{className:(0,le.$)(r,Rn),align:"center",justify:"center",noWrap:!0,children:(0,n.Y)(ht.E,{Component:cn.v,trigger:["hover","click"],placement:"bottom-end",onShownChanged:a,offsetByMainAxis:i?-4:8,offsetByCrossAxis:i?-8:0,size:"s",content:(0,n.FD)(ln.r,{separator:(0,n.Y)(cn.v.Separator,{}),children:[!!s&&(0,n.Y)(Po,{text:s},"caption"),o.map(((e,t)=>(0,n.Y)(H.Fragment,{children:e.map((e=>(0,n.Y)(So,{item:e},e.key)))},t)))]}),"aria-label":t.getLang("global_actions_button"),"data-testid":"post_context_menu",className:Dn,children:(0,n.Y)(tt.K,{size:44,label:t.getLang("global_actions_button"),"data-testid":"post_context_menu_toggle",children:(0,n.Y)(an.z,{className:(0,G.I)("color_icon_tertiary")})})})}):(0,n.Y)(K.s,{className:(0,le.$)(r,Rn),align:"center",justify:"center",noWrap:!0,children:(0,n.Y)(cn.v,{restoreFocus:!1,trigger:["hover","click"],placement:"bottom-end",onShownChanged:a,offsetByMainAxis:i?-4:8,offsetByCrossAxis:i?-8:0,size:"s",content:(0,n.FD)(ln.r,{separator:(0,n.Y)(cn.v.Separator,{}),children:[!!s&&(0,n.Y)(Po,{text:s},"caption"),o.map(((e,t)=>(0,n.Y)(H.Fragment,{children:e.map((e=>(0,n.Y)(So,{item:e},e.key)))},t)))]}),"aria-label":t.getLang("global_actions_button"),"data-testid":"post_context_menu",className:Dn,children:(0,n.Y)(tt.K,{onClick:Bn.l,label:t.getLang("global_actions_button"),"data-testid":"post_context_menu_toggle",children:(0,n.Y)(an.z,{className:(0,G.I)("color_icon_tertiary")})})})}):null})),Oo=(0,a.jn)(Mn,Lo),Eo=({ModalComponent:e,title:t,description:i,confirmButtonText:o,handleConfirm:r,onClose:a,isShown:d,type:c})=>{const l=(0,Fe.B)(),h="modal"===c?{id:"confirmation-modal",isShown:d,onClose:a,type:"modal",title:t,headerId:"confirmation-modal-header",children:(0,n.Y)(s.i,{mode:"horizontal",children:(0,n.Y)(q.LE,{children:i})}),actions:(0,n.FD)(n.FK,{children:[(0,n.Y)(J.$,{onClick:a,size:"m",mode:"secondary",children:l.getLang("global_cancel")}),(0,n.Y)(J.$,{onClick:r,size:"m",children:o})]})}:{id:"confirmation-modal",isShown:d,onClose:a,type:"alert",children:i,title:t,actions:[{title:l.getLang("global_cancel"),mode:"cancel"},{title:o,mode:"destructive",action:r,autoCloseDisabled:!0}]};return(0,n.Y)(e,{...h})},xo="SpaPostContextMenu__root--OijJT",Yo=(0,o.P)((function(){const{data:e,scheme:t,captionText:i,adInfo:o,postId:s,ownerId:r,hasAnyApprovedCoauthor:a,coOwnersInfo:d,modalComponent:c,actionConfirmationModalType:l,areCommentsClosedInGlobalSettings:h,postType:p,isInFaves:u}=rn();return(0,n.FD)(n.FK,{children:[d.actionModalInfoByType&&c?(0,n.Y)(Eo,{ModalComponent:c,title:d.actionModalInfoByType.title,description:d.actionModalInfoByType.subtitle,onClose:d.resetCoOwnersActionModal,confirmButtonText:d.actionModalInfoByType.actionText,handleConfirm:d.confirmCoOwnersActionModal,type:l,isShown:!0}):null,(0,n.Y)(Oo,{className:xo,scheme:t,postId:Number(s),ownerId:Number(r),postHref:"",type:e?.type,isPinned:"is_pinned"in e&&Boolean(e?.is_pinned),isArchived:"is_archived"in e&&e?.is_archived,isCommentsClosed:"comments"in e&&Boolean(e.comments?.can_open),isCommentsClosedInSettings:h,isInFavourites:u,isNotificationsEnabled:"push_subscription"in e?e?.push_subscription?.is_subscribed:void 0,erid:o.marker,captionText:i,advertiserUrl:o.advertiserUrl,recommendationTerms:o.recommendationInfo,copyHref:"",lang:"",coauthorsState:{coauthors:"coowners"in e?e.coowners?.list??[]:[],isPostWithApprovedCoauthors:a,isCurrentUserHasAnyNotRejectedCoauthor:"coowners"in e&&!!e.coowners?.requests?.length||a},coowners:"coowners"in e?e.coowners:void 0,isOriginalLang:!0,trackCode:e?.track_code,postType:p})]})})),Mo=(0,a.jn)(sn,Yo);var To=i(983538),Ro=i(704399),Do=i(989078),Bo=i(40756),Fo=i(802872),No=i(560527),zo=i(746308),jo=i(144819),Uo=i(360864);function Wo(e,t,i,n=0){const o=e.querySelector(`[id="${t}"]`);if(o)o.scrollIntoView({block:"center",behavior:"smooth"}),i();else{if(n>2)return;requestAnimationFrame((()=>{Wo(e,t,i,n+1)}))}}const $o=(e,t,i,n=0)=>{const o=e.offsetHeight;if(o!==i)t.scrollBy(0,o-i);else{if(n>2)return;requestAnimationFrame((()=>{$o(e,t,i,n+1)}))}},Ho=e=>{const t=e.parentElement;if(null===t){const t=e.getRootNode();if(t instanceof ShadowRoot)return t.host}return t},Vo=e=>"visible"!==e&&"clip"!==e,Ko=e=>{if(e.clientWidth<e.scrollWidth){const t=getComputedStyle(e,null);return Vo(t.overflowX)}return!1},qo=e=>{if(e.clientHeight<e.scrollHeight){const t=getComputedStyle(e,null);return Vo(t.overflowY)}return!1},Go=(e,t)=>"y"===t?qo(e):"x"===t?Ko(e):qo(e)||Ko(e);var Jo=i(874719);class Qo{resetState(){this._replyCommentData=null,this._editingComment=null,this._nextFrom="",this._prevFrom="",this._sortedCommentsIds=[],this._commentsIdsToAutoplayStickerPopup=[],this._commentsIdsByThreadMap.clear(),this.initialFetch()}[a.Ts](){this.initialFetch(),this.initStickersSettings()}async initialFetch(){const{current:e}=this.props,{ownerId:t}=e;if(!(this.isInlineAnimated||!this.canViewComments&&this.post))if(void 0===this.store.replyMultiline&&(this.store.replyMultiline="true"===window.vk?.replyMultiline),this.subscribeToComments(),this.isFullInlineMode)this.initialFullInlineComments&&(this.fillLocalCommentsMap(this.initialFullInlineComments),this._nextFrom=this.store.getCommentsMetaByPost(this.postRawId)?.next_from??"",this._prevFrom=this.store.getCommentsMetaByPost(this.postRawId)?.prev_from??"");else if(this.isCompactInlineMode)this.initialCompactInlineComments.length&&(this.initialCompactInlineComments.forEach((({thread:e,...t})=>{this.store.addCommentToStore(t)})),this.fillLocalCommentsMap(this.initialCompactInlineComments));else{if(!this.startThreadId&&!this.startCommentId)return await this.fetchCommentsOrder(),await this.fetchComments(),void(0===this.startCommentId&&(this.commentActionsService.emitter.emit("focusCommentInput",{postId:this.props.current.postId,postOwnerId:this.props.current.ownerId}),this.scrollContainerIntoView()));if(this.startThreadId||!this.startCommentId)if(this.startThreadId&&this.startCommentId){this.fetchCommentsOrder();try{this.fetchCommentsFromThreadAndComment(this.startThreadId,this.startCommentId)}catch(e){this.fetchComments()}}else;else{this.fetchCommentsOrder();try{const e=await this.commentsService.fetchComment({owner_id:t,comment_id:this.startCommentId});e.parents_stack?.length?this.fetchCommentsFromThreadAndComment(e.parents_stack[0],this.startCommentId):this.fetchCommentsFromCommentId()}catch{this.fetchComments()}}}}get showInputByDefault(){return this._showInputByDefault}get isSingleFieldMode(){return"singleField"===this.props.current.mode}get isFullInlineMode(){return"fullInline"===this.props.current.mode}get isCompactInlineMode(){return"compactInline"===this.props.current.mode}get isFullMode(){return"full"===this.props.current.mode}get isInlineAnimated(){return"inlineAnimated"===this.props.current.mode}get initialFullInlineComments(){return this.store.getInitialCommentsByPost(this.postRawId)}get initialCompactInlineComments(){return this.post&&"activity"in this.post.value&&this.post.value.activity&&"reply"===this.post.value.activity.discriminator&&"comments"in this.post.value.activity&&this.post.value.activity.comments?.length?this.post.value.activity.comments:[]}get inlineAnimatedComment(){if(!this.initialCompactInlineComments.length)return;const{from_id:e,text:t,id:i}=this.initialCompactInlineComments[0],n=this.commentsService.getOwner(e);if(!n||!e)return;const o="first_name"in n?n.first_name:"name"in n?n.name:void 0;return o?{firstName:o,text:t,id:i}:void 0}subscribeToComments(){this._commentsNotifierServiceUnsubscribe?.(),this._commentsNotifierServiceUnsubscribe=this.commentsNotifierService.subscribe(this.postRawId,(e=>this.addNewComment({commentId:e.id,commentOwnerId:e.from_id,isReply:!!e.reply_to_comment})))}get post(){return this.feedEntitiesStore.getItem((0,jo.WO)({id:this.props.current.postId,ownerId:this.props.current.ownerId}))}get scrollableContainer(){return((e,t)=>{if(!e)return null;let i=e;const n=document.scrollingElement||document.documentElement;for(;i&&(i=Ho(i),i!==n)&&(null!=i&&i===document.body&&Go(i,t)&&!Go(document.documentElement,t)||null==i||!Go(i,t)););return i})(this._commentsListElement,"y")}get startCommentId(){if(!Number.isNaN(this.props.current.startCommentId)&&void 0!==this.props.current.startCommentId)return this.props.current.startCommentId}get startThreadId(){if(!Number.isNaN(this.props.current.startThreadId)&&void 0!==this.props.current.startThreadId)return this.props.current.startThreadId}get postRawId(){return(0,jo.WO)({id:this.props.current.postId,ownerId:this.props.current.ownerId})}get comments(){return this.store.getCommentsByIds(this._sortedCommentsIds)}get editingComment(){return this._editingComment}get donut(){const e=this.post?.value;return{...(e&&"comments"in e?e.comments?.donut:void 0)??{},donutMiniappUrl:e&&"donut_miniapp_url"in e?e.donut_miniapp_url:""}}get order(){const e=this.store.getCommentsOrderByPost(this.postRawId)?.order??"smart";if(this.orderItems.length)return this.orderItems.find((t=>t.id===e))??this.orderItems[0]}get orderItems(){return this.store.getCommentsOrderByPost(this.postRawId)?.items??[]}get platformConfig(){return this.props.current.platformConfig}async fetchCommentsFromThreadAndComment(e,t){const i=await this.commentsService.fetchComment({owner_id:this.props.current.ownerId,comment_id:e}),n=Do.u.comment(i),{data:o,onDone:s}=await this.commentsService.fetchThreadComments({commentRawId:n,count:this.platformConfig.threadCountForPagination,owner_id:this.props.current.ownerId,post_id:this.props.current.postId,comment_id:e,start_comment_id:t,offset:-this.platformConfig.threadCountForPagination/2});let r=null;(0,c.h5)((()=>{s(),o?.items?.length&&this._commentsIdsByThreadMap.set(n,o.items.map((e=>{const i=Do.u.comment(e);return e.id===t&&(r=i),i})))})),await this.fetchComments({start_comment_id:e,offset:1,sort:"asc"}),(0,c.h5)((()=>{this._sortedCommentsIds.unshift(Do.u.comment(i)),r&&this.scrollToComment(r)})),this.updatePrevFromOffset()}updatePrevFromOffset(){const e=this._prevFrom.split("/")||[];if(!e.length)return;let t=(Number(e[1])||0)-1;t>0?(e[1]=String(t),this._prevFrom=e.join("/")):this._prevFrom=""}async fetchCommentsFromCommentId(){await this.fetchComments({sort:"asc",start_comment_id:this.startCommentId}),this.scrollToStartComment()}get replyCommentId(){return this._replyCommentData?.id??null}get showReplyButton(){const e=this.store.getCommentsMetaByPost(this.postRawId);return Boolean(e?.can_post&&e?.show_reply_button)}get showInlineReplyButton(){const e=this.post?.value;return Boolean(e&&"comments"in e&&e.comments?.can_post&&(e.comments?.can_view&&!e.comments?.can_open||e.comments?.can_close))}get nextFrom(){return this._nextFrom}get nextCommentIsLoading(){return"loading"===this.requestNextCommentsState.status}get canShowNextPagination(){return Boolean(this.nextFrom)}get prevFrom(){return this._prevFrom}get prevCommentIsLoading(){return"loading"===this.requestPrevCommentsState.status}get canShowPrevPagination(){return Boolean(this.prevFrom)}get canViewComments(){return Boolean(this.post&&"comments"in this.post.value&&this.post.value.comments?.can_view&&!(0,x.h)(this.post.value.donut)&&!this.isPostHidden)}get isPostHidden(){return Boolean(this.post&&("postState"in this.post&&this.post.postState&&["archived","deleted"].includes(this.post.postState)||"is_deleted"in this.post.value&&this.post.value.is_deleted))}get needShowSkeleton(){return["initial","loading"].includes(this.requestState.status)&&!this.comments.length}get needShowInlineSkeleton(){return(0,Uo.L)(this.post)&&this.needShowSkeleton&&this.isFullInlineMode&&!this.initialFullInlineComments&&!this.userEnv.partConfigEnabled("frontend.web_wall_comments_loading_fix")}get isLoading(){return"loading"===this.requestState.status}get isInputFocused(){return this._isInputFocused}get showInlineNextButton(){return this.isFullInlineMode?this.canShowNextPagination:this.props.current.showInlineNextButton}get onOpenReactions(){return this.props.current.onOpenReactions}get withPopupStickerContainer(){return this.props.current.withPopupStickerContainer}[a.zr](){this._commentsNotifierServiceUnsubscribe?.(),this.commentActionsService.emitter.listenable.off("focusCommentInput",this.handleFocusInput),this.reactions.destroy()}constructor(e,t,i,n,o,s,r,a,d,l,h,p,u,m){this.props=e,this.commentsService=t,this.commentsNotifierService=i,this.store=n,this.feedEntitiesStore=o,this.errorLogger=s,this.feedDonutService=r,this.mutationService=a,this.snackbar=d,this.langs=l,this.postHandler=h,this.commentActionsService=p,this.stickersSettingsService=u,this.userEnv=m,this.reactions=new xn.O,this._commentsListElement=null,this._sortedCommentsIds=[],this._nextFrom="",this._prevFrom="",this._commentsIdsByThreadMap=new Map,this._commentsIdsToAutoplayStickerPopup=[],this._replyCommentData=null,this._commentsNotifierServiceUnsubscribe=null,this._editingComment=null,this._showInputByDefault=!1,this._isInputFocused=!1,this.requestState=new oi.X(this.commentsService.fetchComments.bind(this.commentsService),this.errorLogger),this.requestNextCommentsState=new oi.X(this.commentsService.fetchComments.bind(this.commentsService),this.errorLogger),this.requestPrevCommentsState=new oi.X(this.commentsService.fetchComments.bind(this.commentsService),this.errorLogger),this.initStickersSettings=async()=>{await this.stickersSettingsService.fetchSettings()},this.scrollToComment=e=>{this._commentsListElement&&Wo(this._commentsListElement,e,(()=>{this.mutationService.setTemporaryActive(e)}))},this.scrollContainerIntoView=()=>{this._commentsListElement&&this._commentsListElement.scrollIntoView({block:"start",behavior:"smooth"})},this.scrollToStartComment=()=>{this.startCommentId&&this.scrollToComment(this._sortedCommentsIds[0])},this.fetchComments=async(e={},t=this.requestState)=>(e.next_from||e.prev_from?this.abortMainRequest():this.abortPaginationRequests(),t.fetch({count:this.platformConfig.count,thread_items_count:this.platformConfig.threadCount,owner_id:this.props.current.ownerId,post_id:this.props.current.postId,sort:this.order?.id??"smart",...e},{onSuccess:t=>{this.fillLocalCommentsMap(t?.items,Boolean(e.prev_from)),this._nextFrom=t?.next_from??"",this._prevFrom=t?.prev_from??"",this.isFullInlineMode&&this._sortedCommentsIds.length&&this.store.setInitialCommentsIdsByPost(this.postRawId,this._sortedCommentsIds)},onError:()=>{this.snackbar.show({type:"error",text:this.langs.getLang("wall_cannot_get_comments_error_text"),subtitle:this.langs.getLang("wall_comment_error_subtitle")})}})),this.fillLocalCommentsMap=(e,t=!1)=>{if(!e)return;const i=this._commentsListElement?.offsetHeight,n=e.slice();if(t&&n.reverse(),n.forEach((e=>{const i=Do.u.comment(e),n=this._sortedCommentsIds.includes(i);t&&!n?this._sortedCommentsIds.unshift(i):n||this._sortedCommentsIds.push(i),e.thread?.items?.length&&this._commentsIdsByThreadMap.set(i,e.thread.items.map((e=>Do.u.comment(e))))})),t){if(!this._commentsListElement||void 0===i||!this.scrollableContainer)return;o=this._commentsListElement,s=this.scrollableContainer,r=i,requestAnimationFrame((()=>{$o(o,s,r)}))}var o,s,r},this.handleSuccessfulPostDonut=async e=>{this.props.current.postId&&this.props.current.ownerId&&await this.feedDonutService.updatePostAfterDonut({ownerId:this.props.current.ownerId,postId:this.props.current.postId,data:e})},this.addNewComment=async({commentId:e,commentOwnerId:t,isReply:i,isPopupSticker:n})=>{if(n&&this.addIdToAutoplayStickerPopup(e),i)this._replyCommentData?.onReplyCreated?.({commentId:e,commentOwnerId:t,isPopupSticker:n,shouldResetReply:!0}),this.resetReplyCommentData();else if("desc"!==this.order?.id)if(this.nextFrom)await this.changeOrder("desc");else{const t=await this.commentsService.fetchComment({owner_id:this.props.current.ownerId,comment_id:e});(0,c.h5)((()=>{if(t){const e=(0,jo.WO)({id:t.id,ownerId:t.from_id});this._sortedCommentsIds.push(e),this.isFullInlineMode&&this.store.setInitialCommentsIdsByPost(this.postRawId,this._sortedCommentsIds)}}))}else{const t=await this.commentsService.fetchComment({owner_id:this.props.current.ownerId,comment_id:e});(0,c.h5)((()=>{if(t){const e=(0,jo.WO)({id:t.id,ownerId:t.from_id});this._sortedCommentsIds.unshift(e),this.isFullInlineMode&&this.store.setInitialCommentsIdsByPost(this.postRawId,this._sortedCommentsIds)}const e=this.nextFrom.split("/");if(e?.[1]){const t=Number(e?.[1])||0;e[1]=String(t+1),this._nextFrom=e.join("/")}}))}(0,c.h5)((()=>{this.scrollToComment((0,jo.WO)({id:e,ownerId:t}))}))},this.addIdToAutoplayStickerPopup=e=>{this.stickersSettingsService?.popup.autoplayOnSend&&this._commentsIdsToAutoplayStickerPopup.push(e)},this.setReplyCommentData=(e,t)=>{this._replyCommentData={id:e,onReplyCreated:t}},this.resetReplyCommentData=()=>{this._replyCommentData=null},this.isCommentShouldAutoplayStickerPopup=e=>!!this._commentsIdsToAutoplayStickerPopup.includes(e)&&(this._commentsIdsToAutoplayStickerPopup=this._commentsIdsToAutoplayStickerPopup.filter((t=>t!==e)),!0),this.getInitialCommentsIdsForThread=e=>this._commentsIdsByThreadMap.get(e)??[],this.fetchCommentsOrder=async()=>{try{await this.commentsService.fetchCommentsOrder({owner_id:this.props.current.ownerId,post_id:this.props.current.postId})}catch(e){this.errorLogger.log(e)}},this.fetchNextComments=async()=>{this.nextFrom&&!this.nextCommentIsLoading&&await this.fetchComments({next_from:this.nextFrom,count:this.platformConfig.countForPagination},this.requestNextCommentsState)},this.fetchPrevComments=()=>{this.prevFrom&&!this.prevCommentIsLoading&&this.fetchComments({prev_from:this.prevFrom,count:this.platformConfig.countForPagination},this.requestPrevCommentsState)},this.changeOrder=async e=>{this._sortedCommentsIds=[],await this.fetchComments({sort:e})},this.deleteRootComment=()=>{const e=this.nextFrom.split("/");if(e?.[1]){const t=Number(e?.[1])||0;e[1]=String(Math.max(t-1,0)),this._nextFrom=e.join("/")}},this.restoreRootComment=()=>{const e=this.nextFrom.split("/");if(e?.[1]){const t=Number(e?.[1])||0;e[1]=String(t+1),this._nextFrom=e.join("/")}},this.abortPaginationRequests=()=>{this.requestNextCommentsState.reset(),this.requestPrevCommentsState.reset()},this.abortMainRequest=()=>{this.requestState.reset()},this.onPhotoClick=(e,t)=>this.platformConfig.onPhotoClick(this.postRawId,e,t),this.onVideoClick=(e,t)=>this.platformConfig.onVideoClick(this.postRawId,e,t),this.onCommentClick=(e,t)=>{this.props.current.openPost&&(this.postHandler.click.onPostOpen({feedItemId:this.postRawId,source:"inline_comment"}),this.props.current.openPost(e,t))},this.onShowNextClick=e=>{this.isFullInlineMode?this.fetchNextComments():(this.postHandler.click.onPostOpen({feedItemId:this.postRawId,source:"show_more_comments_button"}),this.props.current.openPost?.(e,0))},this.onCommentInputFocus=()=>{this.postHandler.click.onInlineCommentInputClick({feedItemId:this.postRawId})},this.setCommentsListElement=e=>{this._commentsListElement=e},this.setEditingComment=e=>{this._editingComment=e},this.handleFocusInput=({postId:e,postOwnerId:t})=>{this.isFullInlineMode&&e===this.props.current.postId&&t===this.props.current.ownerId&&(this._showInputByDefault=!0)},this.openCommentsInModal=e=>{this.commentActionsService.emitter.emit("showCommentsModal",{postId:this.props.current.postId,postOwnerId:this.props.current.ownerId,commentId:e})},(0,c.l_)(this),this.isFullInlineMode||this.isCompactInlineMode||(this._showInputByDefault=!0),this.commentActionsService.emitter.listenable.on("focusCommentInput",this.handleFocusInput),this.reactions.reaction((()=>this.postRawId),(()=>{this.resetState()})),this.reactions.reaction((()=>this._showInputByDefault),((e,t)=>{!t&&e&&(this._isInputFocused=!0)})),this.reactions.reaction((()=>this.initialFullInlineComments),((e,t)=>{e&&this.isFullInlineMode&&e.length!==t?.length&&(this._sortedCommentsIds.length||(this._nextFrom=this.store.getCommentsMetaByPost(this.postRawId)?.next_from??"",this._prevFrom=this.store.getCommentsMetaByPost(this.postRawId)?.prev_from??""),this.fillLocalCommentsMap(e))}),{fireImmediately:!0})}}Qo=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===ni.y?Object:ni.y,void 0===Bo.Q?Object:Bo.Q,void 0===Fo.g?Object:Fo.g,void 0===m.B?Object:m.B,void 0===_.v?Object:_.v,void 0===si?Object:si,void 0===No.z?Object:No.z,void 0===Xi.q?Object:Xi.q,void 0===E.Y?Object:E.Y,void 0===T.i?Object:T.i,void 0===Jo.s?Object:Jo.s,void 0===zo.D?Object:zo.D,void 0===L.J?Object:L.J])],Qo);const{Provider:Xo,useModel:Zo}=(0,a.Qd)(Qo,{initInEffect:!1});var es=i(540431),ts=i(404636),is=i(355812);const ns="vkitCommentLayoutAction__root--CuMda";var os=i(517016);const ss="vkitCommentLayoutHide__root--7j3Ub",rs="vkitCommentLayoutHide__icon--ZMlNT",as="vkitCommentLayout__root--Wjqbz",ds=Object.assign((({children:e,getRootRef:t,...i})=>{const{level:o}=(0,ts.Eu)(),s={"--comment-layout-level":`${o}`};return(0,n.Y)(ts.EZ,{value:o+1,children:(0,n.Y)("div",{className:as,style:s,ref:t,...i,children:e})})}),{Hide:({bottomOffset:e=0,...t})=>{const{isFirstLevel:i}=(0,ts.Eu)();return i?null:(0,n.Y)(j.SB4,{className:ss,...t,children:(0,n.Y)(os.G,{className:rs,style:{bottom:e}})})},Action:({before:e,src:t,children:i,...o})=>(0,n.Y)(j.SB4,{className:ns,hasHover:!1,hasActive:!1,...o,children:(0,n.Y)(K.s,{align:"center",noWrap:!0,gap:["xs",0],children:(0,n.FD)(ln.r,{separator:(0,n.Y)(is.O,{className:(0,G.I)("color_text_secondary")}),children:[!!e&&(0,n.Y)("span",{children:e}),(0,n.Y)(q.$j,{Component:"span",weight:"2",className:(0,G.I)("color_text_secondary"),children:i}),t&&(0,n.Y)(Q.g,{src:t,size:16})]})})})});var cs=i(210071),ls=i(666843),hs=i(587654),ps=i(367509),us=i(385007),ms=i(735079),gs=i(213220),_s=i(153125),vs=i(615691),fs=i(449623),ws=i(782460),ys=i(7939);const bs="vkitCommentAuthorLike__badge--XagRL",Cs="vkitCommentAuthorLike__icon--HlaK3",ks="vkitCommentAuthorLike__iconOutline--KCPNL",Is=({photo:e,onClick:t,liked:i,alt:o,...s})=>{const r=t?{}:s,a=(0,n.Y)(Q.g,{withTransparentBackground:!0,src:e,size:16,alt:o,...r,children:(0,n.FD)("div",{className:bs,children:[(0,n.Y)("div",{className:(0,le.$)(Cs,i?(0,G.I)("color_accent_red"):(0,G.I)("color_icon_secondary")),children:i?(0,n.Y)(ys.X,{}):(0,n.Y)(ys.X.PartOutline,{})}),(0,n.Y)("div",{className:ks,children:(0,n.Y)(ys.X.CutoutPart,{})})]})});return t?(0,n.Y)(j.SB4,{"data-testid":"comment-group-like",hoverMode:"opacity",activeMode:"opacity",onClick:t,alt:o,...s,children:a}):a};var Ss=i(284646),As=i(143764),Ps=i(856778),Ls=i(880414),Os=i(727391);const Es="vkitCommentBaseOwnerName__rootHighlighted--4HSan",xs="vkitCommentBaseOwnerName__ownerNameLink--8amUO",Ys="vkitCommentBaseOwnerName__separator--0axUB",Ms=({owner:e,highlighted:t,hasAuthorRights:i,authorText:o,onClick:s,icons:r,verificationAriaLabel:a,verificationTooltipProps:d})=>{const{href:c,verified:l}=e,h=(0,Ps.H)(e);return(0,n.Y)(K.s,{align:"center",noWrap:!0,children:(0,n.FD)(ln.r,{separator:(0,n.Y)(is.O,{spacing:4,className:Ys}),children:[(0,n.FD)(K.s,{Component:q.$j,align:"center",noWrap:!0,gap:["xs",0],children:[(0,n.Y)(it.N,{href:c,onClick:s,className:(0,le.$)(xs,t&&Es),noUnderline:!0,children:(0,n.Y)(Ls.b,{"data-testid":"comment-owner",TypographyComponent:q.$j,lines:1,weight:"2",mode:"primary",children:l?(0,n.Y)(Os.p,{iconLabel:a,tooltip:d,children:h}):h})}),r]}),i&&o&&(0,n.Y)(q.tW,{weight:"2",children:o})]})})},Ts="vkitCommentBase__root--2D4IF",Rs="vkitCommentBase__in--CZHNm",Ds="vkitCommentBase__title--SVZr8",Bs="vkitCommentBase__titleAfter--j55ta",Fs="vkitCommentBase__titleSeparator--UEOxN",Ns="vkitCommentBase__actions--efyRI",zs="vkitCommentBase__actionsVisible--C1TC3",js="vkitCommentBase__actionSpinner--Leos9",Us=({owner:e,actions:t,avatarBadge:i,afterOwnerName:o,hasActionsLoading:r,children:a,className:d,hasAuthorRights:c,authorText:l,onOwnerClick:h,onOwnerAvatarClick:p,avatarSize:u,avatarOutline:m,ownerNameIcons:g,actionsVisibilityMode:_="hover",...v})=>{const f=(0,As.R)(e);return u||(u=m?26:28),(0,n.FD)(s.i,{className:(0,le.$)(Ts,d),spacing:8,paddingTop:8,paddingBottom:8,...v,children:[(0,n.FD)(Q.g,{"data-testid":"comment-avatar",src:f,onClick:p??h,size:u,nft:e?.is_nft,href:e?.href,tabIndex:-1,alt:"","aria-hidden":!0,children:[m&&(0,n.Y)(Q.g.Outline,{appearance:"accent"}),!f&&(0,n.Y)(Ss.P,{className:(0,G.I)("color_icon_tertiary")}),i&&(0,n.Y)(Q.g.Badge,{children:i})]}),(0,n.FD)("div",{className:Rs,children:[e&&(0,n.FD)("div",{className:Ds,children:[(0,n.FD)(ln.r,{separator:(0,n.Y)(is.O,{className:Fs}),children:[(0,n.Y)(Ms,{owner:e,hasAuthorRights:c,authorText:l,onClick:h,icons:g}),!!o&&(0,n.Y)(q.$j,{className:Bs,children:o})]}),(t||r)&&(0,n.Y)("div",{className:(0,le.$)(Ns,(r||"always"===_)&&zs),children:r?(0,n.Y)(Ft.y,{className:js,size:"small"}):t})]}),a]})]})};var Ws=i(897466),$s=i(961625);const Hs="vkitCommentLike__like--fgOSF",Vs="vkitCommentLike__likeActive--c8nqM",Ks="vkitCommentLike__count--kTjNy",qs=({comment:e,onClick:t,...i})=>{const{likes:{user_likes:o,count:s,can_like:r}={}}=e;return t?(0,n.FD)(j.SB4,{"data-testid":"comment-like",className:(0,le.$)(Hs,Boolean(o)&&Vs),hoverMode:"opacity",activeMode:"opacity",disabled:!r&&!o,onClick:t,...i,children:[o?(0,n.Y)(Ws.S,{}):(0,n.Y)($s.y,{}),Boolean(s)&&(0,n.Y)(q.tW,{className:Ks,weight:"2",children:s})]}):null};function Gs({onClick:e,images:t,name:i,...o}){const s="undefined"!=typeof window?devicePixelRatio:1,r=(0,be.q)(t,16*s),a=r?.url;return a?(0,n.Y)(j.SB4,{activeMode:"opacity",hoverMode:"opacity",onClick:t=>{t.stopPropagation(),t.preventDefault(),e?.(t)},...o,children:(0,n.Y)(Z.v,{src:a,alt:i,size:16,noBorder:!0,withTransparentBackground:!0})}):null}const Js="vkitCommentParentOwner__parentOwner--zkrBO",Qs=({onClick:e,children:t,...i})=>(0,n.Y)(Ls.b,{TypographyComponent:it.N,"data-testid":"comment-reply-parent",mode:"secondary",lines:1,onClick:e,className:Js,...i,children:t}),Xs="vkitComment__root--fytd3",Zs="vkitComment__comment--cXona",er="vkitComment__selected--SU0ma",tr="vkitComment__disabled--oCsaV",ir="vkitComment__contentWrapper--eQ0Mn",nr="vkitComment__contentText--N6J3n",or="vkitComment__attachments--wxMHK",sr="vkitComment__info--PwMoq",rr="vkitComment__infoSmallSpacing--RiqwN",ar="vkitComment__infoLeft--ca7iE",dr="vkitComment__date--Dh285",cr="vkitComment__reply--4sQRU",lr="vkitComment__textWrapper--KcpP3",hr="vkitComment__more--J22Xm",pr="vkitComment__groupLike--Egvre",ur="vkitComment__likeShowOnHover--8XvP4",mr="vkitComment__likesModeAlways--1eahc",gr=Object.assign((({comment:e,owner:t,renderAttachments:i,parentOwner:o,parentOwnerText:s,onParentOwnerClick:r,onReplyClick:a,replyActionLabel:d,onShareClick:c,shareActionLabel:l,onMoreClick:h,moreActionLabel:p,onLikeClick:u,selected:m,withoutHover:g,expandActionLabel:_,formatText:v,formatDateTime:f,actions:w,avatarBadge:y,onShowImageStatusBox:b,authorText:C,avatarSize:k,hasAuthorRights:I,author:S,hasLikeFromGroup:A,hasLikeFromAuthor:P,hasGroupOwnerPermsForLike:L,onGroupLikeClick:O,verifiedIconName:E,disabled:x,like:Y,authorLike:M,afterOwnerName:T,ownerNameIcons:R,donutBadge:D,likesVisibilityMode:B="always",...F})=>{const{text:N,date:z,attachments:j}=e,U=void 0!==e.likes?.count&&e.likes.count>0,[W,$]=(0,H.useState)(!1),V=a?i=>a(i,e,t):null,K=c?i=>c(i,e,t):null,J=h?t=>h(t,e):null,Q=Number(j?.length)>0||!!e.attachments_placeholder;return R||(R=[],t?.image_status&&R.push((0,H.createElement)(Gs,{...t.image_status,onClick:b,key:"status_icon"})),E&&R.push((0,n.Y)(us.A,{className:(0,G.I)("color_icon_"+("verified"===E?"accent":"secondary"))},"verify_icon")),e.isDonut&&R.push((0,n.Y)(ms.u,{},"donut_icon"))),(0,n.Y)(Us,{"data-testid":"comment",className:(0,le.$)(Xs,!g&&Zs,m&&er,x&&tr),owner:t,actions:w,hasAuthorRights:I,authorText:C,avatarSize:k,afterOwnerName:T??(o&&s&&(0,n.Y)(Qs,{onClick:()=>{r?.(e)},children:s})),ownerNameIcons:R,avatarBadge:y,...F,children:(0,n.Y)("div",{className:ir,children:(0,n.FD)("div",{className:nr,children:[N&&(0,n.Y)("div",{className:lr,children:(0,n.Y)(q.$j,{Component:"span",children:(0,n.Y)(ws.u,{"data-testid":"comment-text",lines:6,mode:"inline",expanded:W,expandElement:(0,n.Y)(it.N,{"data-testid":"comment-expand",mode:"secondary",onClick:e=>{e.stopPropagation(),$(!0)},noUnderline:!0,children:_}),children:v?.(N)??N})})}),Q&&(0,n.Y)("div",{"data-testid":"comment-attachments",className:or,children:i(j)}),D,(0,n.FD)("div",{className:(0,le.$)(sr,Q&&rr),children:[(0,n.FD)("div",{className:ar,children:[(0,n.Y)(q.tW,{className:dr,children:f?.(z)??z}),V&&d&&(0,n.Y)(it.N,{className:cr,"data-testid":"comment-reply",mode:"secondary",onClick:V,noUnderline:!0,children:(0,n.Y)(q.tW,{weight:"2",children:d})}),K&&l&&(0,n.Y)(it.N,{className:cr,"data-testid":"comment-share",mode:"secondary",onClick:K,noUnderline:!0,children:(0,n.Y)(q.tW,{weight:"2",children:l})}),J&&p&&(0,n.Y)(it.N,{"data-testid":"comment-more",mode:"secondary",onClick:J,className:hr,children:(0,n.FD)(q.tW,{weight:"2",children:[p," ",(0,n.Y)(gs.k,{})]})}),M?(0,n.Y)("div",{className:pr,children:M}):S&&((A||P)&&!L||L&&O)&&(0,n.Y)("div",{className:pr,children:(0,n.Y)(Is,{photo:S.photo_50,liked:A,onClick:P?void 0:O})})]}),Y?(0,n.Y)("div",{className:(0,le.$)("hover"===B&&ur,("always"===B||U)&&mr),children:Y}):(0,n.Y)(qs,{comment:e,onClick:u})]})]})})})}),{Action:_s.r,Edit:vs.k,EditAttachmentAction:fs.h,Like:qs,AuthorLike:Is,OwnerStatusIcon:Gs,ParentOwner:Qs});var _r=i(851417),vr=i(275860);class fr{subscribe(e,t){return this.listeners.has(t)||(this.listeners.set(t,e),this.listenable.on("publicationTimeTick",e),1===this.listeners.size&&(this.timerId=window.setInterval((()=>{this.emitter.emit("publicationTimeTick")}),1e4),this.emitter.emit("publicationTimeTick"))),()=>this.unsubscribe(t)}unsubscribe(e){const t=this.listeners.get(e);t&&(this.listenable.off("publicationTimeTick",t),this.listeners.delete(e),0===this.listeners.size&&void 0!==this.timerId&&(clearInterval(this.timerId),this.timerId=void 0))}constructor(){this.emitter=new vr.v,this.listenable=this.emitter.listenable,this.listeners=new Map}}fr=(0,d.Cg)([a.z8.container()],fr);var wr=i(43924),yr=i(610648),br=i(550502),Cr=i(317764),kr=i(461211);class Ir{async[a.Ts](){this.updateText(),this.unsubscribe=this.ticker.subscribe(this.updateText,this.uniqId)}[a.zr](){this.unsubscribe?.()}get dataSec(){return this.props.current.dataSec}get hoursThreshold(){return this.props.current.hoursThreshold??24}get daysThreshold(){return this.props.current.daysThreshold??0}constructor(e,t,i){this.props=e,this.langs=t,this.ticker=i,this.text="",this.uniqId=Symbol(),this.updateText=()=>{this.props.current.computeCustomText?this.text=this.props.current.computeCustomText():void 0!==this.dataSec&&(this.text=((e,t,{hoursThreshold:i=24,daysThreshold:n=0})=>{const o=Date.now(),s=1e3*e,r=new Date(s),a=(0,wr.O)(o,s),d=(0,yr.o)(o,s),c=(0,br.M)(o,s),l=(0,Cr.c)(o,s);return a<5?t.getLang("global_just_now"):a<60?t.numeric(a,t.getLang("global_secs_ago",!0)):d<60?t.numeric(d,t.getLang("global_mins_ago",!0)):c<i?t.numeric(c,t.getLang("global_hours_ago",!0)):n>0&&l<n?t.numeric(l,t.getLang("wall_post_short_days_ago",!0)):l<365&&(0,kr.s)(o,s)?t.date(r,t.getLang("global_short_date_time",!0),t.getLang("months_sm_of",!0),{onlyDate:!0}):t.date(r,t.getLang("global_date",!0),t.getLang("months_sm_of",!0),{onlyDate:!0})})(this.dataSec,this.langs,{hoursThreshold:this.hoursThreshold,daysThreshold:this.daysThreshold}))},(0,c.l_)(this)}}Ir=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y,void 0===fr?Object:fr])],Ir);const{Provider:Sr,useModel:Ar}=(0,a.Qd)(Ir,{initInEffect:!1}),Pr=(0,a.jn)(Sr,(0,o.P)((function(){const e=Ar();return(0,n.Y)(n.FK,{children:e.text})})));var Lr=i(137598);const Or=(0,o.P)((function(){const e=(0,Fe.B)(),{deleteComment:t,reportComment:i,shareComment:o,setIsEditMode:s,hideActionsInThreeDots:r,canEdit:a,canDelete:d,canReport:c,canShowLikesModal:l,showLikesList:h,hideShareButton:p}=(0,hs.s)();if(r){if(p&&!a&&!l&&!c&&!d)return;return(0,n.Y)(cn.v,{content:(0,n.FD)(n.FK,{children:[!p&&(0,n.Y)(cn.v.Item,{"data-testid":"action_sheet_comment_action_share",onClick:o,children:e.getLang("mobile_wall_post_publish")}),a&&(0,n.Y)(cn.v.Item,{"data-testid":"action_sheet_comment_action_edit",onClick:()=>s(!0),children:e.getLang("mobile_edit")}),l&&(0,n.Y)(cn.v.Item,{"data-testid":"action_sheet_comment_action_likes",onClick:h,children:e.getLang("mobile_wall_reply_likes")}),c&&(0,n.Y)(cn.v.Item,{"data-testid":"action_sheet_comment_action_complain",onClick:i,children:e.getLang("mobile_comment_complain_action")}),d&&(0,n.Y)(cn.v.Item,{"data-testid":"action_sheet_comment_action_delete",onClick:t,children:e.getLang("mobile_comment_delete_action")})]}),children:(0,n.Y)(gr.Action,{icon:"more",ariaLabel:e.getLang("mobile_comment_actions_action"),"data-testid":"comment_action_more_button",disableTooltip:!0})})}return(0,n.FD)(n.FK,{children:[a&&(0,n.Y)(gr.Action,{icon:"edit",ariaLabel:e.getLang("global_edit"),onClick:e=>{e.stopPropagation(),s(!0)},"data-testid":"comment_action_edit",appearance:"neutral"},"edit"),c&&(0,n.Y)(gr.Action,{icon:"report",ariaLabel:e.getLang("global_report_spam"),onClick:e=>{e.stopPropagation(),i()},"data-testid":"comment_action_report",appearance:"neutral"},"report"),d&&(0,n.Y)(gr.Action,{icon:"delete",ariaLabel:e.getLang("global_delete"),onClick:e=>{e.stopPropagation(),t()},"data-testid":"comment_action_delete",appearance:"neutral"},"delete")]})}));var Er=i(516800),xr=i(229767),Yr=i(739991);const Mr=({getTextFormatArray:e,onFormattedDisplayedTextClick:t})=>{const i=(0,Fe.B)(),[o,s]=(0,H.useState)(!1);return{renderDisplayedText:(s,{accented:r}={})=>{const a=e(s);return"string"==typeof a?a:(0,n.Y)(n.FK,{children:a.map(((e,s)=>{if("string"==typeof e)return e;if("emoji"in e){const{emoji:t}=e;return(0,n.Y)("img",{className:"emoji",src:`/emoji/e/${t.code}${t.retina?"_2x":""}.png`,alt:t.alt},s)}if("obsceneBlur"in e){const{obsceneBlur:a}=e;return(0,n.Y)(xr.f,{dataId:Yr.ZE,"aria-label":i.getLang("wall_obscene_box_aria_label"),obscene:a.obscene,blur:a.blur,tooltipText:i.getLang("wall_obscene_box_alert_tooltip_hint"),onClick:o?void 0:e=>{t?.(e)},unblurred:o,accented:r},s)}return null}))})},onUnBlur:()=>{s(!0)}}};var Tr=i(712790);class Rr{get handleClose(){return this.props.current.onClose}get feedItemId(){return this.props.current.feedItemId}get obsceneWordsCount(){return this.props.current.obsceneWordsCount}get modalOpened(){return this.props.current.modalOpened}get modalCardComponent(){return this.props.current.config.ModalCardComponent}get modalComponent(){return this.props.current.config.ModalComponent}get dismissButtonMode(){return this.props.current.config.dismissButtonMode}get modalCardComponentWidth(){return this.props.current.config.width}constructor(e,t){this.props=e,this.postHandlers=t,this.handleModalHasOpened=()=>{this.postHandlers.click.obsceneTextAlertBoxOpened({feedItemId:this.feedItemId})},this.unBlurWholeParentElement=()=>{this.props.current.onConfirm(),this.postHandlers.click.onUnBlurText({feedItemId:this.feedItemId,count:this.obsceneWordsCount}),this.handleClose()},(0,c.l_)(this)}}Rr=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===T.i?Object:T.i])],Rr);const{Provider:Dr,useModel:Br}=(0,a.Qd)(Rr,{initInEffect:!1}),Fr=(0,a.jn)(Dr,(0,o.P)((function(){const{modalOpened:e,handleModalHasOpened:t,modalCardComponent:i,modalComponent:o,dismissButtonMode:s,modalCardComponentWidth:r,unBlurWholeParentElement:a,handleClose:d}=Br(),c=(0,Fe.B)();(0,H.useEffect)((()=>{e&&t()}),[e]);const l=o,h=i,p="inside"===s?"l":"m";return(0,n.Y)(l,{id:"obscene-text-modal",isShown:e,type:"card",onClose:d,children:(0,n.Y)(h,{id:"obscene-text-modal",onClose:d,size:r,icon:(0,n.Y)(Tr._,{}),title:c.getLang("wall_obscene_box_alert_title"),description:c.getLang("wall_obscene_box_alert_content"),actions:(0,n.Y)(Bt.e,{stretched:!0,align:"center",children:(0,n.Y)(J.$,{size:p,onClick:a,stretched:!0,children:c.getLang("wall_obscene_box_alert_confirmation_button")})}),dismissButtonMode:s})})})));var Nr=i(738771),zr=i(575494),jr=i(650135),Ur=i(216626),Wr=i(533520),$r=i(494492);const Hr=(0,o.P)((function(){const{parentOwner:e,commentParentOwner:t,repliedComment:i,kitRepliedComment:o,getRepliedCommentTextFormatArray:s,getFormatDateTime:r,currentUserId:a,parentOwnerUrl:d,config:c}=(0,hs.s)(),{navigate:l}=(0,Er.Z)(),h=(0,Fe.B)(),{renderDisplayedText:p}=Mr({getTextFormatArray:s});if(!o||!i)return null;const u=Boolean(i.from_id===i.owner_id),m=(0,$r.D)(i,h);return(0,n.Y)(gr,{id:i.rawId,"data-testid":"wall_comments_comment_reply",comment:o,ownerNameIcons:e&&c.ownerMentionCard&&[(0,n.Y)(zr.A,{config:c.ownerMentionCard,currentUserId:a,entity:e},"parent-owner-name-icons")],owner:t,formatText:e=>(0,Lr.n)(e,{renderDisplayedText:p,ownerMentionCardConfig:c.ownerMentionCard}),formatDateTime:r,renderAttachments:()=>m.attachments?(0,n.Y)(jr.w,{commentId:i.id,attachments:m.attachments,formatDateTime:Ur.r,formatSize:Wr.v,onCustomAttachmentRender:e=>(0,n.Y)(Nr.z,{attachment:e,postRawId:i.postRawId,attachments:i.attachments,platformConfig:c.customAttachmentsConfig},String("custom"in e?e.custom.id:e.type))}):null,onOwnerClick:()=>l(d),hasAuthorRights:u,authorText:u?h.getLang("global_reply_author"):void 0,avatarSize:28})})),Vr=(0,o.P)((function(){const{commentParentOwner:e,commentParentOwnerText:t,goToParentComment:i,owner:o,hasDonutBadge:s,config:r}=(0,hs.s)(),a=(0,Fe.B)();return s?a.sex(o&&"sex"in o&&o.sex?o.sex:xe.F.MALE,a.getLang("wall_reply_donut_badge",!0)):e&&t?r.hidePopovers?(0,n.Y)(gr.ParentOwner,{onClick:i,"aria-label":t,children:t}):(0,n.Y)(ht.E,{content:(0,n.Y)(Hr,{}),placement:"top",arrow:!0,trigger:"hover",maxWidth:500,"aria-label":t,children:(0,n.Y)(gr.ParentOwner,{onClick:i,"aria-label":t,children:t})}):null}));var Kr=i(222302),qr=i(758567);const Gr=e=>Boolean(e);let Jr,Qr;class Xr{get comment(){return this.props.current.comment}get loading(){return"loading"===this.requestState.status}get withScrollLockOnTouch(){return this.props.current.withScrollLockOnTouch}get likesList(){return this.comment.likesList}get likesCount(){return this.comment.likes?.count??0}get reactedUsers(){const e=this.likesCount;if(0===e)return{count:e,text:this.langs.getLang("wall_reactions_modal_empty_placeholder"),photos:[]};const t=this.langs.langReplace(this.langs.numeric(e,this.langs.getLang("wall_post_reactions_n",!0)),{count:e.toLocaleString(this.langs.locale)});return{count:e,text:t,photos:this.likesList?.items.map((e=>(0,qr.k)(e))).filter(Gr)??Array(Math.min(e,2)).fill("")}}constructor(e,t,i,n){this.props=e,this.commentsLikesService=t,this.langs=i,this.errorLogger=n,this[ta]=async()=>{this.requestState.fetch(this.comment.rawId)},this[ia]=()=>{this.requestState.reset()},this.requestState=new oi.X(this.commentsLikesService.ensureCommentItemLikesList.bind(this.commentsLikesService),this.errorLogger),this.showLikesList=()=>{this.props.current.onShowLikesList(this.comment,"wall_reply")},(0,c.l_)(this)}}Jr=ta=a.Ts,Qr=ia=a.zr,Xr=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===Kr.g?Object:Kr.g,void 0===E.Y?Object:E.Y,void 0===_.v?Object:_.v])],Xr);const{Provider:Zr,useModel:ea}=(0,a.Qd)(Xr,{initInEffect:!1});var ta,ia,na=i(418356);const oa=(0,o.P)((function(){const{reactedUsers:e,showLikesList:t,withScrollLockOnTouch:i}=ea(),o=window.matchMedia("(pointer: coarse)").matches&&i;return(0,j.K$F)(o),(0,n.Y)(j.SB4,{className:(0,G.I)("color_text_secondary"),onClick:e=>{e.stopPropagation(),t()},children:(0,n.Y)(s.i,{children:(0,n.Y)(na.f,{size:"s",photos:e.photos,visibleCount:2,children:(0,n.Y)(q.tW,{className:(0,G.I)("color_text_primary"),children:e.text})})})})})),sa=(0,a.jn)(Zr,oa),ra=(0,o.P)((function({comment:e}){const t=(0,Fe.B)(),{toggleCommentLikes:i,showLikesList:o,config:s}=(0,hs.s)(),r=e.likes?.count??0,a=e.likes?.user_likes?t.getLang("global_comment_dislike_aria_label"):t.getLang("global_comment_like_aria_label"),d=e=>{e.stopPropagation(),i(!1,s.trackCode,s.screen)};return!r||s.hidePopovers?(0,n.Y)(gr.Like,{comment:e,onClick:d,"aria-label":a}):(0,n.Y)(ht.E,{content:({onClose:e})=>(0,n.Y)(sa,{comment:s.comment,onShowLikesList:()=>{e(),o()},withScrollLockOnTouch:!0}),placement:"top",arrow:!0,trigger:"hover","aria-label":t.getLang("mobile_reactions_menu_aria_title"),children:(0,n.Y)(gr.Like,{comment:e,onClick:d,"aria-label":a})})}));var aa=i(694809);const da=(0,o.P)((function(){const{postOwner:e,comment:t,hasGroupOwnerPermsForLike:i,hasLikeFromGroupOrAuthor:o,authorLikeTooltipText:s,toggleCommentLikes:r,config:a}=(0,hs.s)();if(!e)return null;if(!(o&&!i||i))return null;const d=(0,_r.U)(e,l.z.isUserId(Number(t.owner_id)));let c;c=d.photo_base?d.photo_base+"&cs=50x0":d.photo_50??d.photo_100??"";const h=(0,n.Y)(gr.AuthorLike,{onClick:t.likes?.author_liked||!i?void 0:e=>{e.stopPropagation(),r(!0,a.trackCode,a.screen)},photo:c,alt:s,liked:o,"data-liked":o});return a.hidePopovers?h:(0,n.Y)(aa.m,{description:(0,n.Y)(q.tW,{inline:!0,children:s}),enableInteractive:!0,hideWhenReferenceHidden:!0,placement:"top",children:(0,n.Y)("div",{children:h})})}));var ca=i(977836),la=i(938321),ha=i(24417),pa=i(436043);const ua="PrimaryAttachmentPopupSticker__popupStickerIcon--vOtLJ",ma="PrimaryAttachmentPopupSticker__popupStickerIconRotated--P6iID",ga=(0,o.P)((function({needAutoplayOnInit:e,sticker:t,size:i}){const{popupStore:o}=(0,pa.bl)(),[s,r]=(0,H.useState)(!1),a=(0,H.useCallback)((t=>{t&&e&&t.click()}),[]);return(0,n.Y)(ha.g,{baseStickerProps:{sticker:t,size:i},wrapperProps:{icon:s?(0,n.Y)(ca.M,{}):(0,n.Y)(la.b,{}),contentClassName:(0,le.$)(ua,s&&ma),iconPosition:"rightRelative",iconWrapperRef:a,onContentClick:e=>{const i=t.popup?.layers;i&&o&&(e.stopPropagation(),o.prepareWithDestroyEvent({layers:i,stickerElement:e.currentTarget,onEndPrepare:e=>{e&&r(!0)},onEndPlay:()=>{r(!1)}}))}},popupProps:{isAnimationPlaying:s}})})),_a=(0,o.P)((function({sticker:e,size:t}){return(0,n.Y)(ha.g,{wrapperProps:{},baseStickerProps:{sticker:e,size:t}})})),va="PrimaryAttachmentSticker__stickerWrapper--QqCbu",fa=(0,o.P)((function({sticker:e,size:t=128,needAutoplayOnInit:i,onStickerClick:o,"data-testid":s="attachment-sticker",...r}){return(0,n.Y)("div",{role:"presentation",className:va,onClick:t=>{e.sticker_id&&(t.stopPropagation(),o(e.sticker_id,e.product_id))},"data-testid":s,"data-sticker-id":e.sticker_id,...r,children:e.popup?.layers.length?(0,n.Y)(ga,{needAutoplayOnInit:i,size:t,sticker:e}):(0,n.Y)(_a,{size:t,sticker:e})})})),wa=(0,o.P)((function(){const{comment:e}=(0,hs.s)(),{getLang:t,numeric:i}=(0,Fe.B)(),o=(0,H.useMemo)((()=>{if(e.attachments_placeholder)return e.attachments_placeholder;if(!e.attachments?.length)return"";if(new Set(e.attachments.map((e=>e.type))).size>1)return t("news_inline_comments_attachments");{const n=e.attachments[0]?.type;let o;switch(n){case"photo":o=t("mail_added_photos",!0);break;case"video":o=t("mail_added_videos",!0);break;case"audio":o=t("mail_added_audios",!0);break;case"video_playlist":o=t("mail_added_video_playlist",!0);break;case"audio_playlist":o=t("mail_added_audio_playlist",!0);break;case"doc":o=t("news_inline_comments_attachments_file",!0);break;case"link":o=t("mail_added_link",!0);break;case"sticker":o=t("mail_added_sticker",!0);break;case"graffiti":o=t("mail_added_graffiti",!0);break;case"article":o=t("mail_added_article",!0);break;case"donut_link":o=t("mail_added_donut_link",!0);break;case"clip":o=t("mail_added_clip",!0);break;default:o=t("news_inline_comments_attachments",!0)}return i(e.attachments.length,o)}}),[e.attachments]);if(o)return(0,n.Y)(q.$j,{Component:"span",className:(0,G.I)("color_text_accent"),children:o})})),ya=(0,o.P)((function(){const e=(0,Fe.B)(),{comment:t,onPhotoClick:i,onVideoClick:o,onStickerClick:s,config:r}=(0,hs.s)(),a=(0,$r.D)(t,e);if(!a.attachments?.length&&!t.attachments_placeholder)return null;const d=a.attachments?.[0];return!r.hideAttachments&&d&&"sticker"===d.type&&d.sticker?(0,n.Y)(fa,{"data-testid":"comment-attach-sticker",needAutoplayOnInit:r.isAutoplayStickerPopup?.(t.id),sticker:d.sticker,onStickerClick:s}):(0,n.Y)(jr.w,{commentId:t.id,attachments:a.attachments??[],formatDateTime:Ur.r,formatSize:Wr.v,hiddenAttach:!!r.hideAttachments&&(0,n.Y)(wa,{}),onCustomAttachmentRender:e=>(0,n.Y)(Nr.z,{attachment:e,postRawId:t.postRawId,attachments:t.attachments,platformConfig:r.customAttachmentsConfig},String("custom"in e?e.custom.id:e.type)),onPhotoClick:i,onVideoClick:o,photoLinkAriaLabel:e.getLang("global_wall_photo")})})),ba=(0,o.P)((function(){const e=(0,Fe.B)(),{navigate:t}=(0,Er.Z)(),{restoreComment:i,comment:o,commentParentOwner:s,commentParentOwnerText:r,kitComment:a,owner:d,isInThread:c,isAuthor:h,ownerUrl:p,onBlurredObsceneTextClick:u,onReplyClick:m,hideReplyButton:g,onCommentEdited:_,deleteComment:v,reportComment:f,setIsEditMode:w,isEditMode:y,onPhotoClick:b,onVideoClick:C,hideShareButton:k,shareComment:I,hasDonutBadge:S,config:A,currentUserId:P,handleCommentClick:L,handleCommentDateClick:O,hasCommentClick:E,obsceneTextAlertBoxOpened:x,handleCloseObsceneTextAlertBox:Y,obsceneTextAlertBoxConfig:M,commentTextObsceneWordsCount:T,hideActionsInThreeDots:R,getCommentTextFormatArray:D,feedItemRawId:B,deleteThread:F,restoreThread:N,thread:z,canDelete:j,canReport:U,isThreadDeleted:W,isCurrentUserAdmin:$,isReportSent:H,handleOwnerAvatarClick:V,handleOwnerClick:K,commentUrl:Q}=(0,hs.s)(),{renderDisplayedText:X,onUnBlur:Z}=Mr({getTextFormatArray:D,onFormattedDisplayedTextClick:u});if(["deleted","deletedWithThread","deletedWithoutRestore"].includes(o.state)){const t=W?e.getLang("wall_thread_deleted"):e.getLang("mobile_comment_deleted"),s=(d||$&&W)&&"deletedWithoutRestore"!==o.state?{restoreActionLabel:e.getLang("mobile_comment_restore_action"),onRestoreClick:W?N:i}:{actions:$&&z?.count&&!W?(0,n.Y)(gr.Action,{icon:"delete",ariaLabel:e.getLang("wall_delete_thread"),onClick:F,"data-testid":"comment_action_delete",appearance:"neutral"},"delete"):void 0};let r=[];return d&&$&&j&&z?.count&&!W&&r.push((0,n.Y)(J.$,{onClick:F,mode:"link",size:"s","data-testid":"commentdeleted-delete-thread",children:e.getLang("wall_delete_thread")})),d&&U&&(H?r.push((0,n.Y)(q.tW,{className:(0,G.I)("color_text_secondary"),children:e.getLang("wall_report_delivered")})):r.push((0,n.Y)(J.$,{onClick:f,mode:"link",size:"s","data-testid":"commentdeleted-report",children:e.getLang("global_report_spam")}))),(0,n.Y)(ps.z,{id:o.rawId,avatarSize:c?20:28,after:r.length?r:void 0,selected:"selected"===o.uiState,...s,children:t})}if(H)return(0,n.Y)(ps.z,{id:o.rawId,avatarSize:c?20:28,children:e.getLang("wall_report_delivered")});if(y&&A.CommentEditComponent&&o.post_id&&o.owner_id)return(0,n.Y)(A.CommentEditComponent,{postId:o.post_id,postOwnerId:o.owner_id,editingComment:o,onCommentEdited:_,deleteComment:v,resetEditMode:()=>w(!1),isInThread:c,onPhotoClick:b,onVideoClick:C,customAttachmentsConfig:A.customAttachmentsConfig});{const i=d?(0,_r.U)(d,l.z.isUserId(Number(o.from_id)),p):void 0,u=i?(({verified:e,...t})=>t)(i):void 0;return(0,n.FD)(n.FK,{children:[(0,n.Y)(Fr,{onClose:Y,onConfirm:Z,modalOpened:x,config:M,feedItemId:B,obsceneWordsCount:T}),(0,n.Y)(gr,{id:o.rawId,"data-testid":c?"wall_comments_comment_in_thread":"wall_comments_comment_root",comment:a,likesVisibilityMode:A.hidePopovers?"always":"hover",ownerNameIcons:i&&A.ownerMentionCard&&[(0,n.Y)(zr.A,{config:A.ownerMentionCard,currentUserId:P,entity:i},"owner-name-icons")],onClick:L,donutBadge:S&&!!A.DonutBadge&&(0,n.Y)(A.DonutBadge,{}),afterOwnerName:s&&r||S?(0,n.Y)(Vr,{}):void 0,disabled:"disabled"===o.uiState,selected:"selected"===o.uiState,withoutHover:!E,onOwnerClick:e=>{(0,Ae.T)(e),t(p),K(i)},onOwnerAvatarClick:e=>{(0,Ae.T)(e),i?.has_unseen_stories||t(p),V(i,e)},owner:u,onReplyClick:g?void 0:()=>m(o.rawId),onShareClick:k||R?void 0:I,replyActionLabel:e.getLang("mobile_comment_reply_action"),shareActionLabel:e.getLang("mobile_wall_post_publish"),moreActionLabel:e.getLang("mobile_comment_more_action"),expandActionLabel:e.getLang("mobile_comment_expand_action"),formatText:e=>(0,Lr.n)(e,{renderDisplayedText:X,ownerMentionCardConfig:A.ownerMentionCard}),actions:(0,n.Y)(Or,{}),actionsVisibilityMode:R?"always":"hover",formatDateTime:e=>(0,n.Y)(it.N,{target:"_blank","data-testid":"wall_comment_date",onClick:O,href:Q,className:(0,G.I)("color_text_secondary"),children:(0,n.Y)(Pr,{dataSec:e,hoursThreshold:4})}),hasAuthorRights:h,authorText:h?e.getLang("global_reply_author"):void 0,avatarSize:c?20:28,avatarOutline:Boolean(i?.has_unseen_stories),like:(0,n.Y)(ra,{comment:a}),authorLike:(0,n.Y)(da,{}),renderAttachments:()=>(0,n.Y)(ya,{})})]})}}));var Ca=i(800687);const ka=(0,o.P)((function(){const e=(0,Fe.B)(),{postAuthor:t,thread:i,toggleIsThreadCollapsed:o,firstThreadCommentAuthor:s,hasAuthorReplies:r}=(0,hs.s)();if(i?.count)return(0,n.FD)(n.FK,{children:[(0,n.Y)(St.K,{size:2}),(0,n.Y)(ds.Action,{onClick:o,"aria-label":`${e.getLang("wall_open_thread_label")}: ${i.count}`,src:r&&t?.photo_100?t.photo_100:void 0,before:s?(0,n.FD)(K.s,{align:"center",gap:8,noWrap:!0,children:[(0,n.Y)(Q.g,{src:s.photo_100,size:20,alt:""}),(0,n.Y)(Ls.b,{TypographyComponent:q.$j,lines:1,className:(0,G.I)("color_text_secondary"),weight:"2",children:(0,n.Y)(Ca.I,{values:{user:(0,Pt.H)(s,!0)},children:e.sex("sex"in s&&s.sex?s.sex:xe.F.MALE,e.getLang("global_replied_to_reply",!0))})})]}):void 0,children:e.numeric(i.count,e.getLang("global_replied_to_reply_count",!0))})]})})),Ia=(0,o.P)((function(){const e=(0,Fe.B)(),{canLoadNextThread:t,threadComments:i,nextTreadsIsLoading:o,toggleIsThreadCollapsed:s,isThreadCollapsed:r,config:a}=(0,hs.s)();if(i.length)if(a.hideThreadOnHover){if(i.length>1&&!r)return(0,n.Y)(ds.Hide,{onClick:s,"aria-label":e.getLang("wall_collapse_thread_label")})}else if(!t&&!o&&!r)return(0,n.Y)(ds.Action,{onClick:s,children:e.getLang("wall_collapse_thread_label")})})),Sa=(0,a.jn)(hs.G,(0,o.P)((()=>{const e=(0,Fe.B)(),{comment:t,isInThread:i,thread:o,threadComments:r,nextTreadsIsLoading:a,prevTreadsIsLoading:d,canLoadNextThread:c,canLoadPrevThread:l,fetchNextThreadComments:h,fetchPrevThreadComments:p,replyCommentId:u,onReplyClick:m,resetReplyCommentId:g,onCommentCreated:_,onPhotoClick:v,onVideoClick:f,isThreadCollapsed:w,hideReplyButton:y,config:b,isThreadDeleted:C,hidePagination:k}=(0,hs.s)(),I=Boolean(!i&&u),S=(0,H.useRef)(null),A=(0,cs.z)({getAudioPlayerAdapter:b.customAttachmentsConfig.getAudioPlayerAdapter,rootElement:S.current,attachPlayerEventHandler:b.customAttachmentsConfig.attachPlayerEventHandler,loadAudioPlayer:b.customAttachmentsConfig.loadAudioPlayer});return(0,n.FD)(n.FK,{children:[(0,n.Y)(ls.V,{ownerId:t.owner_id,platformAudioPlayer:A,children:(0,n.Y)("div",{ref:S,children:(0,n.Y)(ba,{})})},`attachment-custom-${t.id}`),Boolean((o?.count||I)&&!C)&&(0,n.FD)(ds,{"data-testid":"wall_comments_layout_thread",children:[d&&(0,n.Y)(s.i,{spacing:16,children:(0,n.Y)(Ft.y,{})}),Boolean(!k&&!w&&l&&!d)&&(0,n.Y)(ds.Action,{onClick:()=>p(),"data-testid":"show_prev_comments",children:e.getLang("wall_show_prev_comments")}),o?.count&&w?(0,n.Y)(ka,{}):r.map((e=>{const{comment:t,initialCommentsIdsForThread:i,...n}=b;return(0,H.createElement)(Sa,{...n,key:e.rawId,comment:e,hideReplyButton:y,onReplyClick:()=>m(e.rawId)})})),a&&(0,n.Y)(s.i,{spacing:16,children:(0,n.Y)(Ft.y,{})}),Boolean(!k&&!i&&!w&&c&&!a)&&(0,n.Y)(ds.Action,{onClick:()=>h(),"data-testid":"show_next_comments",children:e.getLang("wall_show_next_comments")}),I&&!!b.CommentFieldComponent&&!!t.post_id&&!!t.owner_id&&(0,n.Y)(b.CommentFieldComponent,{postId:t.post_id,postOwnerId:t.owner_id,onCommentCreated:_,replyCommentId:u,resetReplyCommentId:g,onPhotoClick:v,onVideoClick:f,trackCode:b.trackCode,screen:b.screen,scrollToComment:b.scrollToComment,isInThread:!0,customAttachmentsConfig:b.customAttachmentsConfig}),(0,n.Y)(Ia,{})]})]})})));var Aa=i(342804),Pa=i(824924);const La=({placeholder:e,noPadding:t})=>{const i=(0,Fe.B)();return e.button?(0,n.Y)(it.N,{href:"open_url"===e.button?.action?.type?e.button?.action?.url:void 0,noUnderline:!0,target:"_blank",children:(0,n.Y)(Dt.l,{before:(0,n.Y)(Pa.G,{}),after:"open_url"===e.button?.action?.type?"chevron":void 0,subtitle:i.getLang("wall_donut_restriction_banner_text"),noPadding:t})}):null};var Oa=i(46284);const Ea=()=>(0,n.Y)(s.i,{mode:"horizontal",spacing:8,children:(0,n.FD)(K.s,{direction:"row",children:[(0,n.Y)(Oa.E,{circle:!0,width:28,height:28}),(0,n.Y)(St.K,{mode:"vertical",size:8}),(0,n.Y)(K.s.Item,{flex:"grow",children:(0,n.FD)(K.s,{direction:"column",children:[(0,n.Y)(St.K,{mode:"horizontal",size:3}),(0,n.Y)(Oa.E,{width:147,height:12,borderRadius:4}),(0,n.Y)(St.K,{mode:"horizontal",size:10}),(0,n.Y)(Oa.E,{height:12,borderRadius:4,width:"90%"}),(0,n.Y)(St.K,{mode:"horizontal",size:6}),(0,n.Y)(Oa.E,{height:12,borderRadius:4,width:"70%"}),(0,n.Y)(St.K,{mode:"horizontal",size:8}),(0,n.FD)(K.s,{direction:"row",align:"center",justify:"space-between",children:[(0,n.Y)(Oa.E,{width:169,height:12,borderRadius:4}),(0,n.Y)(Oa.E,{circle:!0,width:16,height:16})]})]})})]})}),xa=({horizontalPadding:e,stickySorting:t})=>(0,n.Y)(s.i,{mode:"vertical",spacing:e,paddingTop:t?0:4,paddingBottom:4,children:(0,n.FD)(K.s,{direction:"column",children:[(0,n.Y)(Ro.F,{size:6,wide:t}),(0,n.FD)(s.i,{mode:"vertical",spacing:t?8:0,paddingTop:4,paddingBottom:0,children:[(0,n.Y)(s.i,{paddingTop:8,paddingBottom:0,children:(0,n.Y)(Oa.E,{width:98,height:12,borderRadius:4})}),(0,n.Y)(St.K,{size:5}),(0,n.Y)(Ea,{}),(0,n.Y)(Ea,{}),(0,n.Y)(Ea,{})]})]})}),Ya=()=>{const e=(0,Fe.B)();return(0,n.FD)(n.FK,{children:[(0,n.Y)(Ro.F,{size:6,wide:!0}),(0,n.Y)(s.i,{mode:"vertical",spacing:20,paddingBottom:8,children:(0,n.Y)(q.tW,{className:(0,G.I)("color_text_secondary"),weight:"2",children:e.getLang("wall_reply_forbidden")})})]})},Ma="vkitInlineAnimation__itemBase--u0s3A",Ta="vkitInlineAnimation__itemHidden--eZBkh",Ra="vkitInlineAnimation__itemVisible--zIoA3",Da=Object.assign((({children:e,active:t,baseDelay:i})=>(0,n.Y)(K.s,{direction:"column",gap:t?12:[0,0],"data-testid":"inline-animation",children:H.Children.toArray(e).map(((e,n)=>(0,H.isValidElement)(e)?(0,H.cloneElement)(e,{...e.props,active:t,baseDelay:i,index:n}):e))})),{Item:({children:e,delay:t,instant:i,index:o=0,active:s,baseDelay:r=1200,onAnimationStart:a})=>{const[d,c]=(0,H.useState)(!1),[l,h]=(0,H.useState)(9999),p=(0,H.useRef)(null);return(0,H.useEffect)((()=>{p.current&&h(p.current.scrollHeight)}),[e]),(0,H.useEffect)((()=>{if(!s)return;if(i)return c(!0);const e=setTimeout((()=>{a?.(),c(!0)}),"number"==typeof t?t:r*(o+1));return()=>clearTimeout(e)}),[s,t,r,o,i,a]),(0,n.Y)("div",{ref:p,className:(0,le.$)(Ma,d?Ra:Ta),"data-testid":`inline-animation-item-${o}`,style:{maxHeight:d?`${l}px`:"0"},children:e})}}),Ba="vkitInlineAnimatedCommentItem__firstName--HJrVg",Fa=({text:e,firstName:t,onClick:i})=>(0,n.FD)(K.s,{tabIndex:0,direction:"row",align:"center",justify:"start",noWrap:!0,gap:[8,0],onClick:i,onKeyDown:e=>{"Enter"!==e.key&&"Space"!==e.key||i?.()},children:[(0,n.Y)(K.s.Item,{flex:"fixed",className:Ba,children:(0,n.Y)(Ls.b,{Component:q.tW,weight:"2",lines:1,children:t})}),(0,n.Y)(K.s.Item,{children:(0,n.Y)(Ls.b,{Component:q.tW,weight:"3",lines:1,children:e})})]});var Na=i(853063);const za="InlineAnimatedComments__fakeInput--wAC6s",ja="InlineAnimatedComments__wrapper--yvRRy",Ua="inline-animated-comments",Wa=()=>{try{const e=localStorage.getItem(Ua);return e?JSON.parse(e):{}}catch{return{}}},$a=({onClick:e})=>{const t=(0,Fe.B)();return(0,n.Y)(s.i,{onClick:e,mode:"vertical",spacing:8,paddingTop:8,paddingBottom:8,className:za,children:(0,n.Y)(q.tW,{className:(0,G.I)("color_text_secondary"),weight:"3",children:t.getLang("wall_inline_animated_input")})})},Ha=(0,o.P)((()=>{const{openCommentsInModal:e,inlineAnimatedComment:t,postRawId:i}=Zo(),[o,r]=(0,Na.B)({triggerOnce:!0,delay:0}),[a,d]=(0,H.useState)({}),[c,l]=(0,H.useState)(!1);return(0,H.useEffect)((()=>d(Wa())),[]),(0,H.useEffect)((()=>{if(r&&i)try{const e=Wa();if(!e[i]){const t={...e,[i]:!0};(e=>{try{localStorage.setItem(Ua,JSON.stringify(e))}catch{}})(t),d(t)}}catch{}}),[r,i]),t&&t.firstName?(0,n.Y)(s.i,{getRootRef:o,paddingTop:c?4:0,paddingBottom:c?4:0,"data-testid":"inline-animated-comment",className:ja,children:(0,n.FD)(Da,{active:r||!!a[i],children:[(0,n.Y)(Da.Item,{onAnimationStart:()=>l(!0),children:(0,n.Y)(Fa,{text:t.text,firstName:t.firstName,onClick:()=>e(t.id)})}),(0,n.Y)(Da.Item,{children:(0,n.Y)($a,{onClick:()=>e()})})]})}):null})),Va="CommentsContainer__container--ed9O5",Ka="CommentsContainer__singleInputContainer--8LTRh",qa="CommentsContainer__wrapper--rAXye",Ga="CommentsContainer__stickySorting--kwRRq",Ja=({withPopupStickerContainer:e,children:t})=>e?(0,n.Y)(To.B,{id:"comments-container",children:t}):(0,n.Y)(n.FK,{children:t}),Qa=(0,o.P)((function(){const e=(0,Fe.B)(),{withPopupStickerContainer:t,comments:i,getInitialCommentsIdsForThread:o,order:r,orderItems:a,needShowSkeleton:d,isLoading:c,nextCommentIsLoading:l,canShowNextPagination:h,canShowPrevPagination:p,prevCommentIsLoading:u,nextFrom:m,platformConfig:g,changeOrder:_,fetchNextComments:v,fetchPrevComments:f,addNewComment:w,replyCommentId:y,setReplyCommentData:b,resetReplyCommentData:C,isCommentShouldAutoplayStickerPopup:k,addIdToAutoplayStickerPopup:I,onVideoClick:S,onPhotoClick:A,showReplyButton:P,donut:L,handleSuccessfulPostDonut:O,props:E,postRawId:x,canViewComments:Y,setCommentsListElement:M,scrollToComment:T,editingComment:R,post:D,setEditingComment:B,isSingleFieldMode:F,isCompactInlineMode:N,isFullInlineMode:z,isFullMode:j,onCommentClick:W,onCommentInputFocus:$,showInlineReplyButton:V,showInlineNextButton:q,deleteRootComment:G,restoreRootComment:Q,needShowInlineSkeleton:X,onShowNextClick:Z,isPostHidden:ee,onOpenReactions:te,showInputByDefault:ie,isInputFocused:ne,isInlineAnimated:oe}=Zo(),{CommentFieldComponent:se,showBanners:re,horizontalPadding:ae=8,...de}=g,ce=!!L?.placeholder&&!P,he=!!se&&(P||V)&&!ce&&(!!i.length||ie),pe=z||N,ue=Boolean(a.length&&!N&&(i.length||c)),me=Boolean(g.stickySorting),ge=(0,H.useCallback)((()=>B(null)),[]);return ee?null:oe?(0,n.Y)(Ha,{}):!pe||i.length||he||X?Y&&(ue||0!==i.length||he||d)||!D||pe?pe&&X?(0,n.Y)(Ft.y,{}):!pe&&d?(0,n.Y)(xa,{horizontalPadding:ae,stickySorting:me}):(0,n.FD)(n.FK,{children:[(0,n.Y)(s.i,{mode:"vertical",spacing:ae,paddingTop:me?0:4,paddingBottom:pe||F?0:4,className:(0,le.$)(Va,F&&he&&Ka),children:(0,n.FD)(K.s,{direction:"column",noWrap:!0,className:qa,children:[(0,n.FD)("div",{className:(0,le.$)(me&&Ga),children:[Boolean(!F||ue)&&(0,n.FD)(n.FK,{children:[(0,n.Y)(Ro.F,{size:6,wide:me}),(0,n.Y)(St.K,{size:4})]}),ue&&(0,n.FD)(s.i,{paddingTop:0,paddingBottom:0,children:[me&&(0,n.Y)(St.K,{size:8,mode:"vertical"}),(0,n.Y)(ht.E,{trigger:["click","hover"],Component:cn.v,content:(0,n.Y)(n.FK,{children:a.map((({id:e,name:t})=>(0,n.Y)(cn.v.Item,{onClick:()=>e&&_(e),children:t},e)))}),children:(0,n.Y)(J.$,{mode:"link",after:(0,n.Y)(es.w,{}),"data-testid":"wall_comments_sorting",children:r?.name})})]})]}),pe||i.length||!E.current.withPlaceholder?(0,n.Y)(K.s.Item,{flex:"grow",children:(0,n.Y)(Ja,{withPopupStickerContainer:t,children:(0,n.Y)(s.i,{mode:"vertical",spacing:me?8:0,paddingBottom:0,paddingTop:0,children:(0,n.FD)(ds,{"data-testid":"wall_comments_layout_root",getRootRef:M,children:[!pe&&u&&(0,n.Y)(s.i,{spacing:16,children:(0,n.Y)(Ft.y,{})}),!pe&&!u&&p&&(0,n.Y)(ds.Action,{onClick:f,"data-testid":"show_prev_comments",children:e.getLang("wall_show_prev_comments")}),i.map((e=>(0,H.createElement)(Sa,{...de,scrollToComment:T,key:e.rawId,feedItemRawId:x,comment:e,initialCommentsIdsForThread:N?void 0:o(e.rawId),isAutoplayStickerPopup:k,onReplyClick:F?b:void 0,onEditClick:F?B:void 0,CommentFieldComponent:(j||z)&&se?se:void 0,addIdToAutoplayStickerPopup:N?void 0:I,donutMiniappUrl:L.donutMiniappUrl,hideReplyButton:!P||N,handleSuccessfulPostDonut:O,trackCode:E.current.trackCode,screen:E.current.screen,onCommentClick:N?W:void 0,hideShareButton:N,hidePagination:N,hideAttachments:N,isThreadCollapsed:z,onCommentDeleted:G,onOpenReactions:te,onCommentRestored:Q}))),pe&&l&&(0,n.Y)(Ft.y,{}),pe&&!l&&q&&(0,n.Y)(ds.Action,{onClick:Z,"data-testid":"show_next_comments",children:e.getLang("wall_show_next_comments")}),!pe&&h&&(0,n.Y)(Aa.Y,{nextFrom:m,isLoading:l,fetchData:v})]})})})}):(0,n.FD)(n.FK,{children:[(0,n.Y)(Ro.F,{size:6,wide:!0}),(0,n.Y)(U.O,{"data-testid":"wall_comments_placeholder",stretched:!0,maxWidth:330,children:e.getLang("wall_comment_modal_empty_placeholder")})]}),he&&(0,n.Y)(se,{scrollToComment:T,postId:E.current.postId,postOwnerId:E.current.ownerId,isFocused:ne,onFocus:N?$:void 0,entryPoint:N?"inline_comment":void 0,trackCode:E.current.trackCode,screen:E.current.screen,noSticky:z||N,onHideInput:F?ge:void 0,onCommentCreated:w,onCommentEdited:F?B:void 0,replyCommentId:y,resetReplyCommentId:C,onPhotoClick:A,onVideoClick:S,editingComment:R,customAttachmentsConfig:de.customAttachmentsConfig,showErrorsInSnackbars:F}),!!L?.placeholder&&ce&&(0,n.Y)(s.i,{mode:"vertical",spacing:12,paddingTop:8,paddingBottom:8,children:(0,n.Y)(La,{placeholder:L.placeholder,noPadding:!0})})]})}),!pe&&!L?.placeholder&&!P&&(0,n.Y)(Ya,{})]}):L?.placeholder?(0,n.Y)(s.i,{mode:"vertical",spacing:ae,paddingTop:0,paddingBottom:4,children:(0,n.Y)(La,{placeholder:L?.placeholder})}):re?(0,n.Y)(Ya,{}):null:L?.placeholder?(0,n.Y)(s.i,{mode:"vertical",spacing:12,paddingTop:8,paddingBottom:8,children:(0,n.Y)(La,{placeholder:L.placeholder,noPadding:!0})}):null})),Xa=(0,a.jn)(Xo,Qa);var Za=i(486526);const ed="vkitPostTextV2__root--TuGcK",td="vkitPostTextV2__redesignEnabled--GFJkL",id=({TypographyComponent:e=q.EY,chunks:t,config:i,expanded:o,squareText:s,renderShowMoreButton:r,className:a,children:d,onTextClick:c,lineBreakSize:l=6,getRootRef:h,getTextRef:p,squareLines:u,renderChunk:m,...g})=>{const _=s?u:i.cutThreshold,v=(0,H.useMemo)((()=>t.map(((e,t)=>m(e,t)))),[t,m]);return(0,n.Y)(e,{className:(0,le.$)(ed,td,a),onClick:c,style:{"--post-text-line-break-size":`${l}px`},...g,children:(0,n.FD)(ws.u,{getRootRef:h,getRef:p,mode:"inline",lines:_,expanded:o,expandElement:r?.(),lineBreakSize:l,children:[v,d]})})},nd=(0,H.memo)(id);var od=i(124102),sd=i(556039);class rd{[a.zr](){this._textParserReactionDisposer()}get obsceneTextAlertBox(){return this.props.current.obsceneTextAlertBox}get underCut(){return this.props.current.underCut}get textTypographyComponent(){return this.props.current.textTypographyComponent}get rawId(){return this.props.current.rawId}get hasAttachmentsBeforeText(){return!!this.props.current.hasAttachmentsBeforeText}get textExpanded(){return!!this.props.current.alwaysExpanded||Boolean(this.props.current.expanded)}get isExpandShrinkTextEnabled(){return!!this.props.current.isExpandShrinkTextEnabled}get id(){return this.props.current.id}get chunks(){return this.textParser.getChunks()}get config(){return this.props.current.textConfig}get mentionOver(){return this.props.current.mentionOver}get currentUserId(){return this.authService.userId}get postAnchorName(){return`post${this.rawId}`}get obsceneTextAlertBoxOpened(){return this._obsceneTextAlertBoxOpened}get obsceneWordsCount(){return this.textParser.obsceneWordsCount}get dataRoles(){return this.props.current.dataRoles}constructor(e,t,i,n,o){this.props=e,this.authService=t,this.userEnv=i,this.langs=n,this.postHandlers=o,this.textParser=new od.$(this.props.current.text??"",!0),this._obsceneTextAlertBoxOpened=!1,this.toggleTextExpanded=e=>{const{expanded:t,setExpanded:i}=this.props.current;if(void 0===t||!i)return;const n=!t;window.dispatchEvent(new CustomEvent(sd.lU)),i?.(n),n&&e?this.onTextExpanded({source:e}):n||this.onTextCollapsed()},this.setTextExpanded=e=>{this.props.current.setExpanded?.(e)},this.openPost=e=>{this.props.current.uiConfig?.disallowOpenPost||this.props.current.openPost&&(this.props.current.openPost(e),this.onOpenPost())},this.onTextCollapsed=()=>{this.postHandlers.click.onPostCollapseText({feedItemId:this.rawId})},this.onTextExpanded=e=>{this.postHandlers.click.onPostExpandText({source:e.source,feedItemId:this.rawId})},this.onExtLinkClick=e=>{this.postHandlers?.click.onExtLinkClick({feedItemId:this.rawId,eventSubtype:e})},this.onIntLinkClick=e=>{this.postHandlers?.click?.onIntLinkClick({feedItemId:this.rawId,eventSubtype:e})},this.onOpenPost=()=>{this.postHandlers.click.onPostOpen({feedItemId:this.rawId,source:"news_item_click"})},this.getTextFormatArray=e=>this.textParser.getTextFormatArray(e),this.handleCloseObsceneTextAlertBox=()=>{this._obsceneTextAlertBoxOpened=!1},this.onBlurredObsceneTextClick=e=>{(0,Ae.T)(e),this._obsceneTextAlertBoxOpened=!0},this.checkIfLinkHasTrackCode=e=>{const t=e.searchParams.get("to");if(!t)return!1;try{return new URL(t).searchParams.has("track_code")}catch{return!1}},this._textParserReactionDisposer=(0,c.mJ)((()=>this.props.current.text),(e=>{this.textParser=new od.$(e??"",!0)})),(0,c.l_)(this)}}rd=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===Ce.u?Object:Ce.u,void 0===L.J?Object:L.J,void 0===E.Y?Object:E.Y,void 0===T.i?Object:T.i])],rd);const{Provider:ad,useModel:dd}=(0,a.Qd)(rd,{initInEffect:!1});function cd(){const{openPost:e,toggleTextExpanded:t,isExpandShrinkTextEnabled:i,postAnchorName:n,onIntLinkClick:o,onExtLinkClick:s,textExpanded:r,checkIfLinkHasTrackCode:a}=dd(),d=(0,H.useRef)(null);return{onTextClick:function(c){const l=c.target;if(l)if(Oe(c.nativeEvent)){if(l.closest('[data-testid="post-footer-author"]'))return;const e=l.closest("a");e&&function(e){const t=new URL(e.href);(0,R.V0)(t.href)&&!t.pathname.startsWith("/away.php")?o():a(t)||s()}(e)}else if(!("button"in c)||1!==c.button)return i&&function(e){if(!e)return;const t=e.getBoundingClientRect();return window.innerHeight<t.top||t.top<0}(d.current??null)&&r?(function(e,t){if(!e)return;const i=document.querySelector(`a[name="${t}"]`);i?i.scrollIntoView({block:"start",behavior:"smooth"}):e.scrollIntoView({block:"center",behavior:"smooth"})}(d.current??null,n),void setTimeout((()=>{t("text")}),100)):void(r&&!i?e(c):t("text"))},postRowRef:d}}const ld=(0,o.P)((function(){const{langs:e,textTypographyComponent:t,textExpanded:i,mentionOver:o,chunks:s,config:r,currentUserId:a,toggleTextExpanded:d,setTextExpanded:c,hasAttachmentsBeforeText:l,getTextFormatArray:h,obsceneWordsCount:p,rawId:u,onBlurredObsceneTextClick:m,handleCloseObsceneTextAlertBox:g,obsceneTextAlertBox:_,obsceneTextAlertBoxOpened:v,underCut:f,dataRoles:w,id:y,openPost:b}=dd(),{onTextClick:C,postRowRef:k}=cd(),{renderDisplayedText:I,onUnBlur:S}=Mr({getTextFormatArray:h,onFormattedDisplayedTextClick:m}),A=(0,H.useCallback)(((e,t)=>function(e,t,i){const{viewerId:o,onMentionHover:s,renderDisplayedText:r=e=>e,hashtagURL:a=e=>`/${e}`,hashtagMentionURL:d=(e,t)=>`/${t}@${e}`,lineBreakSize:c=6}=i;switch(e.kind){case"Text":return(0,n.Y)(H.Fragment,{children:r(e.text,{accented:!0})},t);case"Email":return(0,n.Y)(it.N,{href:`mailto:${e.email}`,target:"_blank",...e.additionalLinkProps,children:r(e.email)},t);case"Url":return e.isInternal?(0,n.Y)(it.N,{href:e.href,...e.additionalLinkProps,children:r(e.caption)},t):(0,n.Y)(it.N,{href:e.href,target:"_blank",rel:"nofollow noopener",...e.additionalLinkProps,children:r(e.caption)},t);case"Hashtag":{const i=e.screenName?`${e.tag}@${e.screenName}`:e.tag,o=e.screenName?d(encodeURIComponent(e.screenName),encodeURIComponent(e.tag)):a(encodeURIComponent(e.tag));return(0,n.Y)(it.N,{"data-testid":"post-text-hashtag",href:o,...e.additionalLinkProps,children:r(i)},t)}case"Mention":{const i=0===e.peerId?o:Math.abs(e.peerId);return(0,n.Y)(it.N,{"data-testid":"post-text-mention",href:`/${e.type}${i}`,mention_id:`${e.type}${i}`,onMouseOver:s,...e.additionalLinkProps,children:r(e.displayName)},t)}case"ScreenNameMention":return e.displayName?(0,n.Y)(it.N,{href:`/${e.screenName}`,...e.additionalLinkProps,children:r(e.displayName)},t):(0,n.FD)(H.Fragment,{children:["@",r(e.screenName)]},t);case"LineBreak":return"paragraph"===e.type?(0,n.FD)(St.K,{size:c,style:{width:0},children:[(0,n.Y)("br",{})," "]},t):(0,n.Y)("br",{},t);default:return null}}(e,t,{viewerId:a,onMentionHover:o,renderDisplayedText:I,hashtagURL:e=>`/search/statuses?q=${e}`,hashtagMentionURL:(e,t)=>`/${e}?q=${t}`,lineBreakSize:8})),[a,o,I]),P=(0,H.useRef)(null),{lines:L,squareLines:O}=((e,t,i)=>{const[n,o]=(0,H.useState)(0),[s,r]=(0,H.useState)(0);return(0,H.useEffect)((()=>{const n=t.current,s=e.current;if(!n||!s)return;let a=null;const d=()=>{const{parentElement:e,offsetHeight:t,offsetWidth:c}=n,l=e?.scrollHeight||t,h=0===l&&0===c;if(h&&null===a&&(a=new IntersectionObserver((([e])=>{e.isIntersecting&&(d(),a?.disconnect(),a=null)})),a.observe(s)),i&&h)return;const p=getComputedStyle(n);let u=parseFloat(p.lineHeight);u&&!isNaN(u)||(u=1.2*(parseFloat(p.fontSize)||14)),o(Math.ceil(l/u)),r(Math.ceil(c/u))},c=(0,Za.s)(d,100),l=requestAnimationFrame((()=>{d()}));return window.addEventListener("resize",c),()=>{c.cancel(),cancelAnimationFrame(l),window.removeEventListener("resize",c),a?.disconnect()}}),[e,t,i]),{lines:n,squareLines:s}})(k,P,!0),E=!l,x=L>0&&(L<r.cutThreshold+r.underCutThreshold||E&&L<O);return(0,H.useLayoutEffect)((()=>{x&&!i&&c(!0)}),[x,i]),(0,n.FD)(n.FK,{children:[(0,n.Y)(Fr,{onClose:g,onConfirm:S,modalOpened:v,config:_,feedItemId:u,obsceneWordsCount:p}),(0,n.Y)(nd,{"data-role":w?.text,id:y,getRootRef:k,getTextRef:P,chunks:s,config:r,onTextClick:C,TypographyComponent:t,expanded:i,squareText:E,squareLines:O,renderChunk:A,lineBreakSize:8,renderShowMoreButton:()=>(0,n.Y)(q.EY,{weight:"3","data-id":Yr.c4,Component:it.N,onClick:e=>{(0,Ae.T)(e),L<=r.fullPostThreshold?d("show_more_button"):b(e)},className:(0,G.I)("color_text_secondary"),children:e.getLang("wall_post_text_show_more")}),children:f})]})})),hd=(0,a.jn)(ad,ld);var pd=i(767147),ud=i(7258);let md;class gd{get reactionsMenuConfig(){return this.props.current.reactionsMenuConfig}get uiDonutBlockConfig(){return this.props.current.uiDonutBlockConfig}get uiReactionsMenuConfig(){return this.props.current.uiReactionsMenuConfig}get focusCommentInputOnCommentIconClick(){return Boolean(this.props.current.focusCommentInputOnCommentIconClick)}get openPost(){return this.props.current.openPost}handleOpenPost(e){this.props.current.uiConfig?.disallowOpenPost||(this.postHandlers.click.onPostOpen({feedItemId:this.rawId,source:"comments_button"}),this.openPost(e,0))}get postItem(){return this.props.current.postItem}get postData(){return this.postItem.value}get rawId(){return this.postItem.id}get likes(){return this.postData.likes}get activity(){return this.postData.activity}get likesActivity(){const e=this.feedLikesService.extractLikesActivity(this.activity);if(!e||!e.count)return;let t=[];return e.user_ids?.length?this.feedServiceAggregator.ownerService.getCachedUsers(e.user_ids.slice(0,2)).forEach((e=>{t.push((0,qr.k)(e)??"")})):t=Array(Math.min(e.count,2)).fill(""),{count:e.count,text:e.text,photos:t}}get postDateBlockConfig(){return this.props.current.postDateBlockConfig}get uiConfig(){return this.props.current.uiConfig}get reactionSet(){if(this.postData.reaction_set_id)return this.feedServiceAggregator.feedReactionSetsStore.getReactionSet(this.postData.reaction_set_id)}get commentsCount(){return this.postData.comments?.count}get commentsCountText(){return this.commentsCount?this.uiConfig?.showNonFormattedCounters?this.commentsCount.toLocaleString(this.langs.locale):(0,ud.B)(this.commentsCount):null}get repostsCount(){return this.postData.reposts?.count}get repostsCountText(){return this.repostsCount?this.uiConfig?.showNonFormattedCounters?this.repostsCount.toLocaleString(this.langs.locale):(0,ud.B)(this.repostsCount):null}get donutBlockConfig(){return this.props.current.donutBlockConfig}get uiDateConfig(){return this.props.current.uiDateConfig}get footerPlatformConfig(){return this.props.current.footerConfig}get showCommentsIcon(){return Boolean(!this.uiConfig?.hideCommentIcon&&!this.postData.is_archived&&(this.postData.comments?.can_view&&!this.postData.comments?.can_open||this.postData.comments?.can_close))}get isDonutRestricted(){return Boolean(this.props.current.isDonutRestricted)}get donutsCount(){return this.postData.badges?.counters?.find((({type:e})=>"total"===e))?.value}get canShowDonutsRow(){return Boolean(!this.uiConfig?.hideDonutsRow&&this.donutsCount&&this.donutsCount>0)}get canShowShare(){return Boolean(!this.postData.is_archived&&Boolean(!0!==this.likes?.repost_disabled))}constructor(e,t,i,n,o,s,r,a){this.props=e,this.feedLikesService=t,this.feedServiceAggregator=i,this.postHandlers=n,this.feedErrorService=o,this.errorLogger=s,this.commentActionsService=r,this.langs=a,this[fd]=()=>{this.uiConfig?.showReactedUsers&&"initial"===this.likesListRequestState.status&&this.likesListRequestState.fetch(this.postItem.id)},this.likesListRequestState=new oi.X(this.feedLikesService.ensureFeedItemLikesList.bind(this),this.errorLogger),this.handleClickOnCommentIcon=e=>{if(this.feedErrorService.canProceedOnClick()&&!this.onDonutRestrictedClick(!0)){if(this.props.current.openComments)return this.postHandlers.click.onOpenCommentsModal({entryPoint:"button",feedItemId:this.rawId}),void this.props.current.openComments();if(this.focusCommentInputOnCommentIconClick){const{id:e,ownerId:t}=(0,h.v)(this.rawId);this.commentActionsService.emitter.emit("focusCommentInput",{postId:e,postOwnerId:t})}else this.handleOpenPost(e)}},this._showLikes=(e="likes")=>{this.props.current.showLikes?.({rawId:this.rawId,likesType:e})},this.showLikes=()=>{this.onDonutRestrictedClick(!1)||this._showLikes("likes")},this.showFriendsLikes=()=>{this.onDonutRestrictedClick(!1)||this._showLikes("friendlikes")},this.sharePost=e=>{if(this.feedErrorService.canProceedOnClick()&&!this.onDonutRestrictedClick(!0))return this.postHandlers.click.onOpenSharingModal({feedItemId:this.postItem.id}),this.props.current.footerConfig.share("wall",this.rawId,{},e)},this.toggleReaction=async e=>{if(!this.onDonutRestrictedClick(!0))return this.props.current.toggleReaction(e)},this.onDonutRestrictedClick=(e=!1)=>(this.isDonutRestricted&&(e?this.postHandlers.click.onLikesBarOnBlurredPost({feedItemId:this.postItem.id}):this.postHandlers.click.onClickFooterOnBlurredPost({feedItemId:this.postItem.id}),this.props.current.onDonutRestrictedClick?.()),this.isDonutRestricted),this.onAddReaction=()=>{this.postHandlers.click.onAddReactionPost(this.postItem.id)},(0,c.l_)(this)}}md=fd=a.Ts,gd=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===C?Object:C,void 0===pd.f?Object:pd.f,void 0===T.i?Object:T.i,void 0===w.m?Object:w.m,void 0===_.v?Object:_.v,void 0===Jo.s?Object:Jo.s,void 0===E.Y?Object:E.Y])],gd);const{Provider:_d,useModel:vd}=(0,a.Qd)(gd,{initInEffect:!1});var fd;const wd="ReactedUsersStack__rootHover--y51Qz",yd=({children:e,photos:t=[],onClick:i,spacingHorizontal:o=12,spacingVertical:r=8,size:a="s",noUnderline:d})=>(0,n.Y)(j.SB4,{className:(0,G.I)("color_text_secondary"),hasActive:!1,hoverMode:"none",hoverClassName:(0,le.$)(Boolean(i)&&!d&&wd),onClick:i,"data-testid":"post_footer_reacted_users",children:(0,n.Y)(s.i,{mode:"vertical",spacing:o,paddingTop:r,paddingBottom:r,children:t.length>0?(0,n.Y)(na.f,{size:a,photos:t,visibleCount:2,count:0,"data-testid":"post_footer_reacted_users_photos",children:e}):(0,n.Y)(q.tW,{"data-testid":"post_footer_reacted_users_text",children:e})})});class bd{get uiReactionsMenuConfig(){return this.props.current.uiReactionsMenuConfig}get play(){return this._play}get postItem(){return this.props.current.postItem}get postData(){return this.postItem.value}get userLikes(){return Boolean(this.postData.likes?.user_likes)}get countText(){return this.props.current.showReactionTitleInCounter&&!this.props.current.isDonutRestricted?this.reaction?.title||this.langs.getLang("wall_like"):this.postData.likes?.count?(0,ud.B)(this.postData.likes?.count,{roundingMode:"floor"}):""}get userReaction(){if((0,v.gB)(this.postData))return this.postData.reactions?.user_reaction}get reactionSet(){return this.props.current.reactionSet}get reaction(){return this.reactionSet?.find((e=>e.id===this.userReaction))}get disablePopover(){return this.props.current.disablePopover}enableReactionAnimation(){this._play||(this._play=!0)}get likesListRequestState(){return this.props.current.likesListRequestState}get reactionsMenuConfig(){return this.props.current.reactionsMenuConfig}get foregroundColor(){const e=(e=>{if(e&&e.light&&e.dark)return{light:`#${e.light}`,dark:`#${e.dark}`}})(this.reaction?.asset?.title?.color?.foreground);if(this.userLikes)return e||"color_accent_red"}get ariaLabel(){return this.userLikes?this.langs.langReplace(this.langs.getLang("reactions_button_unset_reaction_title"),{reaction_name:this.reaction?.title||this.langs.getLang("wall_like")}):this.langs.langReplace(this.langs.getLang("reactions_button_set_reaction_with_name"),{reaction_name:this.langs.getLang("wall_like")})}constructor(e,t,i){this.props=e,this.langs=t,this.errorLogger=i,this._play=!1,this._requestState=new oi.X(this.props.current.toggleReaction.bind(this),this.errorLogger),this.doRequestStateRequest=async e=>{"loading"===this.likesListRequestState.status&&this.likesListRequestState.reset(),await this._requestState.fetch({reactionId:e}),"initial"===this.likesListRequestState.status&&"loading"!==this._requestState.status&&this.likesListRequestState.fetch(this.postItem.id)},this.toggleReaction=()=>{this.userLikes?this.deleteReaction():this.addReaction()},this.addReaction=async(e=0)=>{this.enableReactionAnimation(),this.doRequestStateRequest(e),this.props.current.onAddReaction?.()},this.deleteReaction=async()=>{this.doRequestStateRequest()},this.showLikes=(e,t)=>{this.props.current.showLikes?.({rawId:e,itemType:t})},(0,c.l_)(this)}}bd=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y,void 0===_.v?Object:_.v])],bd);const{Provider:Cd,useModel:kd}=(0,a.Qd)(bd,{initInEffect:!1}),Id="vkitPostFooterAction__action--EqXB6";const Sd="vkitPostFooterRow__root--Rbxg8",Ad=Object.assign((({children:e,spacingHorizontal:t=12,dataRole:i})=>(0,n.Y)(s.i,{mode:"vertical",spacing:t,paddingTop:0,paddingBottom:0,"data-role":i,children:(0,n.Y)(K.s,{direction:"column",children:e})})),{Action:function({children:e,icon:t,description:i,tooltipPlacement:o="top",disableTooltipTriggerOnFocus:s,foregroundColor:r,style:a,...d}){const c=(0,z.K)(),l="string"==typeof r,h={...a,"--vkit_internal--post_footer_action_foreground_color":!l&&r?.[c]||"inherit"},p=(0,n.Y)(j.SB4,{className:(0,le.$)(!l&&Id,l&&(0,G.I)(r)),style:h,hoverMode:"opacity",activeMode:"opacity",...d,children:(0,n.FD)(K.s,{align:"center",justify:"center",gap:[4,0],children:[(0,n.Y)("span",{children:t}),!!e&&(0,n.Y)(q.tW,{weight:"2",children:e})]})});return i?(0,n.Y)(aa.m,{description:i,placement:o,disableTriggerOnFocus:s,hideWhenReferenceHidden:!0,children:p}):p},Row:({children:e,after:t,gap:i,spacingVertical:o=4,spacingTop:r,spacingBottom:a})=>(0,n.FD)(s.i,{className:Sd,mode:"vertical",spacing:0,paddingTop:r??o,paddingBottom:a??o,children:[(0,n.Y)(K.s,{gap:i,children:e}),(0,n.Y)(K.s.Item,{children:t})]})});var Pd=i(31649);const Ld="vkitReactionsPopover__popoverRounded--V9H9F",Od=({compact:e,className:t,...i})=>(0,n.Y)(Pd.A,{className:(0,le.$)(t,e&&Ld),...i}),Ed=({compact:e,...t})=>(0,n.Y)(ht.E,{Component:Od,trigger:"hover",withLongTapOnTouchScreen:!0,autoFocus:!1,placement:"top-start",arrow:!e,compact:e,"data-testid":"reactions-popover",...t});var xd=i(754429),Yd=i(356154),Md=i(526537),Td=i(455356);const Rd=(0,H.createContext)({containerSize:36,fallbackImageSize:36,animationSize:36,hoveredContainerSize:48}),Dd=Rd.Provider,Bd=()=>(0,H.useContext)(Rd),Fd="vkitReactionImage__image--NduHc",Nd="vkitReactionImage__lottieContainer--cNUF7",zd="vkitReactionImage__lottieHidden--0LnpQ",jd="reaction_image";Md.LottieManager.observer.ignoreGroup(jd);var Ud=i(377803);const Wd="vkitReactionsBarItem__tappable--Rgiy9",$d="vkitReactionsBarItem__reactionItem--Sk15h",Hd="vkitReactionsBarItem__tappableHovered--VZsQT",Vd="vkitReactionsBar__root--fJbaP",Kd="vkitReactionsBar__compact--bMHmA",qd=Object.assign((({children:e,containerSize:t,animationSize:i,fallbackImageSize:o,hoveredContainerSize:s,compact:r,...a})=>(0,n.Y)(Dd,{value:{animationSize:i,fallbackImageSize:o,hoveredContainerSize:s,containerSize:t},children:(0,n.Y)(K.s,{noWrap:!0,className:(0,le.$)(Vd,r&&Kd),...a,children:e})})),{Item:({children:e,title:t,compact:i,getRootRef:o,hovered:s,onClick:r,"data-testid":a="reactions-bar-item"})=>{const{hoveredContainerSize:d,containerSize:c,animationSize:l}=Bd(),h=i?10:12,p=i?c:h-(d-c)/2,u={"--reaction-item-horizontal-padding":`${(l-c)/2*(i?.5:1)}px`,"--reaction-item-top-padding":`${h}px`,"--reaction-item-bottom-padding":i?Ud.A.spacingSizeL.value:Ud.A.spacingSize3Xl.value,"--reaction-item-hover-translate-y":-1*p+"px","--reaction-item-hover-scale":""+(d||c)/c};return(0,n.Y)(aa.m,{shown:s,placement:"top",disableArrow:i,appearance:"neutral",offsetByMainAxis:p+h,description:(0,n.Y)(q.tW,{weight:"2",children:t}),children:(0,n.Y)(j.SB4,{style:u,getRootRef:o,className:Wd,hovered:s,hoverMode:Hd,hasActive:!1,onClick:r,"data-testid":a,children:(0,n.Y)(K.s,{className:$d,children:e})})})},Image:({title:e,images:t=[],animationUrl:i,loop:o,play:s,className:r})=>{const{animationSize:a,containerSize:d,fallbackImageSize:c,hoveredContainerSize:l}=Bd(),h=(0,H.useMemo)((()=>(0,be.q)(t,d)),[t,d]),{lottieContainerRef:p,lottieRendered:u}=(0,Td.X)({animationUrl:i,loop:o,group:jd,width:a,height:a,scale:l/d,autoplay:s},{play:s}),m=u&&s,g={"--reaction-container-size":`${d}px`,"--reaction-fallback-image-size":`${c}px`,"--reaction-animation-container-offset":(a-d)/2*-1+"px"};return(0,n.FD)("div",{style:{backgroundImage:m?void 0:`url(${h?.url})`,...g},className:(0,le.$)(Fd,r),children:[(0,n.Y)(j.s6o,{children:e}),(0,n.Y)("div",{ref:p,className:(0,le.$)(Nd,!m&&zd)})]})},Provider:Dd}),Gd=(0,o.P)((function({reaction:e,userLikes:t,...i}){return t?e?(0,n.Y)(qd.Provider,{value:{containerSize:24,animationSize:29,hoveredContainerSize:29,fallbackImageSize:22},children:(0,n.Y)(qd.Image,{images:e.asset.images,animationUrl:e.asset.animation_url,title:e.title,...i})}):(0,n.Y)(Yd.F,{className:(0,G.I)("color_accent_red")}):(0,n.Y)(xd.D,{})}));class Jd{get config(){return this.props.current.config}get feedItem(){return this.props.current.feedItem}get feedItemData(){return this.feedItem.value}get withScrollLockOnTouch(){return this.props.current.withScrollLockOnTouch}get isDonutBadgeEnabled(){return Boolean(this.config?.openOneTimeDonutModal&&"donut_miniapp_url"in this.feedItemData&&this.feedItemData.donut_miniapp_url)}get donutBadgeTitle(){return this.langs.getLang("groups_send_donut_in_reactions")}constructor(e,t,i){this.props=e,this.feedDonutService=t,this.langs=i,this.handleDonut=async()=>{const e="donut_miniapp_url"in this.feedItemData&&this.feedItemData.donut_miniapp_url;if(e)if(this.props.current.uiConfig?.openOneTimeDonutInNewTab)window.open(e,"_blank");else if(this.config?.openOneTimeDonutModal){const t=await this.config.openOneTimeDonutModal(e);if(void 0===this.feedItemData.id||void 0===this.feedItemData.owner_id)return;await this.feedDonutService.updatePostAfterDonut({ownerId:this.feedItemData.owner_id,postId:this.feedItemData.id,data:t})}},(0,c.l_)(this)}}Jd=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===si?Object:si,void 0===E.Y?Object:E.Y])],Jd);const{Provider:Qd,useModel:Xd}=(0,a.Qd)(Jd,{initInEffect:!1});var Zd=i(225505);const ec=(e,{onEnter:t,onLeave:i,onFinish:n})=>{let o=!1;const s=e=>{n?.(o,e),o=!1},r=()=>{document.removeEventListener("touchend",s)},a=n=>{const a=n.touches[0];if(!a)return;const d=document.elementFromPoint(a.clientX,a.clientY);if(!d)return;const c=e?.contains(d);c?o||(o=!0,document.addEventListener("touchend",s,{passive:!0}),t?.(n)):o&&(o=!1,r(),i?.(n))};return document.addEventListener("touchmove",a,{passive:!0}),()=>{document.removeEventListener("touchmove",a),r()}};var tc=i(93944),ic=i(364517);function nc({children:e,title:t,compact:i,withLongTapOnTouchScreen:o,onClick:s,"data-testid":r}){const[a,d]=(0,H.useState)(!1),c=(0,H.useRef)(null),l=(0,ic.K)((()=>{s(),d(!1)})),h=(0,ic.K)((()=>{a&&l()}));return(({elementRef:e,...t},i=[])=>{(0,H.useEffect)((()=>{if(e.current){const i=ec(e.current,t);return()=>{i?.()}}}),i.concat(e.current))})({elementRef:c,onEnter:()=>d(!0),onLeave:()=>d(!1),onFinish:h}),(0,tc.H)({elementRef:c,onLongPress:(0,ic.K)((()=>d(!0))),onClick:l,cancelMoveDistance:!1,onFinish:h}),(0,n.Y)(qd.Item,{title:t,compact:i,hovered:o?a:void 0,getRootRef:c,onClick:Bn.l,"data-testid":r,children:e})}const oc=({reactionSet:e,size:t,hoveredSize:i,animationSize:o,isDonutBadgeEnabled:s,onReactionClick:r,onDonutClick:a,donutBadgeTitle:d,compact:c,afterClickHandler:l,label:h=""})=>{const p=window.matchMedia("(pointer: coarse)").matches;return(0,n.FD)(qd,{containerSize:t,animationSize:o,fallbackImageSize:t,hoveredContainerSize:i,compact:!!c,children:[e.map((e=>(0,n.Y)(nc,{compact:c,withLongTapOnTouchScreen:p,title:e.title,onClick:()=>{r(e.id),l?.()},"aria-label":h,"data-testid":`reaction-bar-item-${e.id}`,children:(0,n.Y)(qd.Image,{play:!0,loop:!0,images:e.asset.images,animationUrl:e.asset.animation_url,title:e.title})},e.id))),s&&(0,n.FD)(n.FK,{children:[(0,n.Y)(Zd.w,{appearance:"primary-alpha",direction:"vertical",align:"center",padding:!0}),(0,n.Y)(nc,{compact:c,withLongTapOnTouchScreen:p,title:d,"data-testid":"reaction-bar-item-donut",onClick:()=>{a?.(),l?.()},children:(0,n.Y)(Pa.G,{})})]})]})},sc=({reactionSet:e,size:t,hoveredSize:i,animationSize:o,onReactionClick:s,onDonutClick:r,isDonutBadgeEnabled:a,compact:d,donutBadgeTitle:c,afterClickHandler:l,reactedUsers:h})=>{const p=(0,Fe.B)();return(0,n.FD)("div",{children:[e&&(0,n.Y)(oc,{reactionSet:e,hoveredSize:i,size:t,animationSize:o,compact:d,isDonutBadgeEnabled:a,onReactionClick:s,onDonutClick:r,donutBadgeTitle:c,afterClickHandler:l,label:p.getLang("reactions_button_title")}),Boolean(h)&&!d&&(0,n.FD)(n.FK,{children:[e&&(0,n.Y)(Zd.w,{}),!e&&(0,n.Y)(St.K,{size:4}),h,(0,n.Y)(St.K,{size:4})]})]})},rc=(0,o.P)((function(){const{props:e,handleDonut:t,config:i,isDonutBadgeEnabled:o,donutBadgeTitle:s,withScrollLockOnTouch:r}=Xd(),a=window.matchMedia("(pointer: coarse)").matches&&r;return(0,j.K$F)(a),(0,n.Y)(sc,{hoveredSize:e.current.hoveredSize,size:e.current.size,animationSize:e.current.animationSize,reactionSet:e.current.reactionSet,compact:i.compact,isDonutBadgeEnabled:o,donutBadgeTitle:s,onDonutClick:t,onReactionClick:e.current.onReactionClick,afterClickHandler:e.current.afterClickHandler,reactedUsers:e.current.reactedUsers})})),ac=(0,a.jn)(Qd,rc);let dc;class cc{get likesListRequestState(){return this.props.current.likesListRequestState}get feedItem(){return this.props.current.feedItem}get loading(){return["loading","initial"].includes(this.likesListRequestState.status)}get isExtendedLabel(){return this.props.current.extendedLabel}get likesList(){return"likesList"in this.feedItem?this.feedItem.likesList:void 0}get likes(){return"likes"in this.feedItem.value?this.feedItem.value.likes:void 0}get noReactedUsersText(){return this.isExtendedLabel?this.langs.getLang("wall_reactions_modal_empty_placeholder"):this.langs.getLang("news_feed_reactions_menu_reacted_users_none")}getReactedUsersText(e){const t=this.props.current.showNonFormattedCounters?e.toLocaleString(this.langs.locale):(0,ud.B)(e);return this.isExtendedLabel?this.langs.langReplace(this.langs.numeric(e,this.langs.getLang("wall_post_reactions_n",!0)),{count:t}):this.langs.langReplace(this.langs.numeric(e,this.langs.getLang("news_feed_reactions_menu_reacted_users",!0)),{count:e.toLocaleString(this.langs.locale)})}get after(){return this.props.current.after}get reactedUsers(){const e=this.likesList?.count??this.likes?.count??0;if(0===e)return{count:e,text:this.noReactedUsersText,photos:[]};if(this.likesList){const t=this.likesList.items.map((e=>(0,qr.k)(e)??""));return{count:e,text:this.getReactedUsersText(e),photos:t}}return{count:e,text:this.getReactedUsersText(e),photos:[]}}get reactedUsersStackProps(){return{size:this.props.current.size||"m",spacingHorizontal:this.props.current.spacingHorizontal,spacingVertical:this.props.current.spacingVertical,noUnderline:this.props.current.noUnderline}}get hasDetailedRepostsInfo(){if("reposts"in this.feedItem.value){const{reposts:e}=this.feedItem.value;return Boolean(e?.mail_count||e?.wall_count)}return!1}get canOpenReactionsLayer(){return Boolean(this.reactedUsers?.count)||this.hasDetailedRepostsInfo}constructor(e,t){this.props=e,this.langs=t,this[pc]=()=>{"initial"===this.props.current.likesListRequestState.status&&this.likesListRequestState.fetch(this.feedItem.id)},this.showLikes=()=>{this.props.current.showLikes?.(this.feedItem.id,(e=>{const{type:t,value:i}=e;switch(t){case"post":return"reply"===i.post_type?"wall_reply":"wall";case"video":return i.type;default:return t}})(this.feedItem))},(0,c.l_)(this)}}dc=pc=a.Ts,cc=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y])],cc);const{Provider:lc,useModel:hc}=(0,a.Qd)(cc,{initInEffect:!1});var pc;const uc={m:24,s:16,l:32},mc=({spacingHorizontal:e=12,spacingVertical:t=8,size:i="s",children:o})=>{const r=new Array(2).fill({src:"",renderWrapper:()=>(0,n.Y)(Oa.E,{width:uc[i],height:uc[i],circle:!0})});return(0,n.Y)(s.i,{mode:"vertical",spacing:e,paddingTop:t,paddingBottom:t,children:(0,n.Y)(na.f,{size:i,photos:r,visibleCount:2,count:0,children:(0,n.Y)(Oa.E,{height:13,width:"100%",children:o})})})},gc=(0,o.P)((function(){const{reactedUsersStackProps:e,langs:t,loading:i,reactedUsers:o,canOpenReactionsLayer:s,showLikes:r,after:a}=hc();return i?(0,n.Y)(mc,{...e,children:t.getLang("wall_show_reactions_list")}):(0,n.FD)(yd,{photos:o?.photos,onClick:s?r:void 0,...e,children:[o?.text,Boolean(a)&&(0,n.FD)(n.FK,{children:[(0,n.Y)(is.O,{spacing:4}),a]})]})})),_c=(0,a.jn)(lc,gc),vc=(0,o.P)((()=>{const{play:e,userLikes:t,userReaction:i,countText:o,reaction:s,postItem:r,reactionSet:a,reactionsMenuConfig:d,toggleReaction:c,addReaction:l,ariaLabel:h,disablePopover:p,foregroundColor:u,likesListRequestState:m,showLikes:g,uiReactionsMenuConfig:_}=kd(),v=(0,H.useRef)(null),f=(0,H.useRef)(null),w=(0,H.useRef)(null),y=(0,Fe.B)();return(0,n.Y)(Ed,{arrowedElementRef:f,compact:d.compact,offsetByCrossAxis:d.compact?-4:0,disabled:p,ariaLabelPopover:y.getLang("mobile_reactions_menu_aria_title"),ariaLabelPopoverTriggerButton:y.getLang("mobile_reactions_menu_aria_title"),content:({onClose:e})=>(w.current=e,(0,n.Y)(ac,{uiConfig:_,feedItem:r,reactionSet:a,size:36,animationSize:48,hoveredSize:48,onReactionClick:l,afterClickHandler:e,config:d,withScrollLockOnTouch:!0,reactedUsers:(0,n.Y)(_c,{feedItem:r,showLikes:(t,i)=>{g(t,i),e()},likesListRequestState:m})})),children:(0,n.Y)(Ad.Action,{getRootRef:v,icon:(0,n.Y)("div",{ref:f,tabIndex:-1,style:{pointerEvents:"none"},children:(0,n.Y)(Gd,{userLikes:t,play:e,loop:1,reaction:s})}),foregroundColor:u,onClick:()=>{w.current?.(),c()},hasActive:!1,"aria-label":h,"data-testid":"post_footer_action_like","data-user-likes":t,"data-user-reaction":i,children:o})})})),fc=(0,a.jn)(Cd,vc);var wc=i(645964);const yc=e=>{const{id:t,type:i,value:n}=e;switch(i){case"post":return(e=>{const{id:t,value:i}=e;if("reply"===i.post_type){const{post_id:e,owner_id:t,id:n,parents_stack:o}=i,s=new URLSearchParams;return void 0!==n&&s.append("reply",n.toString()),void 0!==o?.[0]&&s.append("thread",o[0].toString()),`/wall${t}_${e}?${s.toString()}`}return`/wall${t}`})(e);case"video":return`/${n.type}${t}`;case"ads":return"post"===n.ads?.[0]?.type?`/wall${t}`:"";default:return""}};var bc=i(800288);class Cc{get isFloorRoundingEnabled(){return this.userEnv.partConfigEnabled("frontend.post_date_views_floor_rounding_COM-28400")}get rawId(){return this.props.current.postItem.id}get feedItem(){return this.props.current.postItem}get postData(){return this.feedItem.value}get feedItemHref(){return yc(this.feedItem)}get date(){return"date"in this.postData?this.postData.date:void 0}get postedDateText(){return"date"in this.postData?this.transformDateToText(this.postData.date,!0):""}get editedDateText(){return"edited"in this.postData?this.transformDateToText(this.postData.edited):""}get postAuthorData(){return"post_author_data"in this.postData?this.postData.post_author_data:void 0}get author(){return this.getUserInfo(this.postAuthorData?.author)}get publisher(){return this.getUserInfo(this.postAuthorData?.publisher)}get editor(){return this.getUserInfo(this.postAuthorData?.editor)}get config(){return this.props.current.config}get hasAdminInfo(){return!!this.config.showAdminInfo&&Boolean(this.author||this.editor||this.publisher)}get views(){return"views"in this.postData?this.postData.views:void 0}get viewsCountText(){const e=this.views?.count;if(e)return e<1e3?this.langs.numeric(e,this.langs.getLang("like_N_people_viewed",!0)):this.langs.langReplace(this.langs.getLang("like_people_viewed_formatted"),{count:(0,ud.B)(e,this.isFloorRoundingEnabled?{roundingMode:"floor"}:void 0)})}transformDateToText(e,t=!1){if(!e)return"";const i=Date.now(),n=1e3*e,o=new Date(n);return(0,Cr.c)(i,n)<365&&(0,kr.s)(i,n)?this.langs.date(o,this.langs.getLang("global_short_date_time",!0),this.langs.getLang("months_sm_of",!0),{onlyDate:t}):this.langs.date(o,this.langs.getLang("global_short_date_year_time",!0),this.langs.getLang("months_sm_of",!0),{onlyDate:t})}constructor(e,t,i,n,o){this.props=e,this.ownerService=t,this.langs=i,this.userEnv=n,this.postHandlers=o,this.handleOnClick=e=>{this.props.current.uiConfig?.disallowOpenPost||bc.y?(0,Ae.T)(e):(this.postHandlers.click.onPostOpen({feedItemId:this.rawId,source:"date_link"}),(0,Pe.X)(e.nativeEvent)||((0,Ae.T)(e),this.props.current.openPost(e)))},this.computeTextTimeSincePublication=()=>void 0!==this.date?((e,t)=>{const i=Date.now(),n=1e3*e,o=new Date(n),s=(0,wr.O)(i,n),r=(0,yr.o)(i,n),a=(0,br.M)(i,n),d=(0,Cr.c)(i,n);return s<60?t.getLang("wall_post_just_now"):r<60?t.numeric(r,t.getLang("wall_post_short_mins_ago",!0)):a<24?t.numeric(a,t.getLang("wall_post_short_hours_ago",!0)):d<8?t.numeric(d,t.getLang("wall_post_short_days_ago",!0)):d<365&&(0,kr.s)(i,n)?t.date(o,t.getLang("global_short_date",!0),t.getLang("months_sm_of",!0),{onlyDate:!0}):t.date(o,t.getLang("global_date",!0),t.getLang("months_sm_of",!0),{onlyDate:!0})})(this.date,this.langs):"",this.getUserInfo=e=>{if(e){return(e=>{if(e)return{fullName:(0,wc.Cg)(e),url:(0,wc.dh)(e),sex:e.sex??0}})(this.ownerService.provideUserEntityById(e,this.userEnv.partConfigEnabled("feed_fix_get_owner_console_error")))}},(0,c.l_)(this)}}Cc=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===I.v?Object:I.v,void 0===E.Y?Object:E.Y,void 0===L.J?Object:L.J,void 0===T.i?Object:T.i])],Cc);const{Provider:kc,useModel:Ic}=(0,a.Qd)(Cc,{initInEffect:!1}),Sc=(0,o.P)((function(){const{viewsCountText:e,postedDateText:t,editedDateText:i,author:o,publisher:s,editor:r,hasAdminInfo:a,langs:d}=Ic();return(0,n.FD)(n.FK,{children:[(0,n.FD)("div",{children:[(0,n.Y)(q.EY,{"data-testid":"post_date_block_date",weight:"2",children:t}),(0,n.Y)(q.EY,{"data-testid":"post_date_block_viewers_count",children:e})]}),a&&(0,n.FD)(n.FK,{children:[(0,n.Y)(St.K,{size:10}),(0,n.Y)(Ro.F,{size:4,wide:!0}),!!o&&(0,n.FD)(n.FK,{children:[(0,n.Y)(St.K,{size:10}),(0,n.FD)("div",{children:[(0,n.Y)(q.EY,{weight:"2",children:d.getLang("wall_post_author_data_author_title")}),(0,n.Y)(q.EY,{"data-testid":"post_date_block_author",children:(0,n.Y)(it.N,{href:o.url,target:"_blank",children:o.fullName})})]})]}),!!s&&(0,n.FD)(n.FK,{children:[(0,n.Y)(St.K,{size:10}),(0,n.FD)("div",{children:[(0,n.Y)(q.EY,{weight:"2",children:d.sex(Number(s.sex),d.getLang("wall_post_author_data_published_by_title",!0))}),(0,n.Y)(q.EY,{"data-testid":"post_date_block_publisher",children:(0,n.Y)(it.N,{href:s.url,target:"_blank",children:s.fullName})})]})]}),!!r&&(0,n.FD)(n.FK,{children:[(0,n.Y)(St.K,{size:10}),(0,n.FD)("div",{children:[(0,n.Y)(q.EY,{weight:"2",children:d.getLang("wall_post_author_data_editor_title")}),(0,n.FD)(q.EY,{"data-testid":"post_date_block_edit_info",children:[(0,n.Y)(it.N,{href:r.url,target:"_blank",children:r.fullName}),i&&` ${i}`]})]})]})]})]})}));var Ac=i(91720);const Pc=(0,o.P)((function(){const{date:e,feedItemHref:t,hasAdminInfo:i,handleOnClick:o,computeTextTimeSincePublication:s}=Ic();return(0,n.Y)(aa.m,{description:(0,n.Y)(Sc,{}),placement:"top",enableInteractive:i,hideWhenReferenceHidden:!0,disableTriggerOnFocus:!bc.y,children:(0,n.Y)(j.azJ,{children:(0,n.Y)(it.N,{target:"_blank","data-testid":"post_date_block_preview",onClick:o,href:t,className:(0,G.I)("color_text_secondary"),children:!!e&&(0,n.Y)(Pr,{computeCustomText:s})})})})}));Pc.displayName="PostDateBlock";const Lc=(0,Ac.N)(kc,Pc);var Oc=i(743541),Ec=i(677251);class xc{get item(){return this.props.current.item}get config(){return this.props.current.config}get hideBlockWithoutDonuts(){return this.props.current.hideBlockWithoutDonuts}get badges(){return this.item.badges}get hidden(){return!this.badges||!this.config.showBlock||this.hideBlockWithoutDonuts&&!this.donutCount||!("donut_miniapp_url"in this.item&&this.item.donut_miniapp_url)}get totalDonuts(){const e=this.badges?.counters;if(e)return e.find((({type:e})=>"total"===e))}get donutCount(){return this.totalDonuts?.value??0}get donutLabel(){return this.donutCount?this.props.current.extendedLabel?this.langs.numeric(this.donutCount,this.langs.getLang("groups_have_donuts_total",!0)):this.langs.numeric(this.donutCount,this.langs.getLang("groups_wkview_donuts_total",!0)):this.langs.getLang("wall_button_to_send_donate")}get donutMiniappUrl(){return"donut_miniapp_url"in this.item?this.item.donut_miniapp_url:void 0}get uiConfig(){return this.props.current.uiConfig}constructor(e,t,i){this.props=e,this.langs=t,this.feedDonutService=i,this.handleSuccessfulPostDonut=async e=>{void 0!==this.item.id&&void 0!==this.item.owner_id&&await this.feedDonutService.updatePostAfterDonut({ownerId:this.item.owner_id,postId:this.item.id,data:e})},this.showDonutsModal=e=>{if((0,Ae.T)(e),!this.badges)return;const{owner_id:t,id:i,type:n}=this.badges;t&&i&&n&&this.config.showDonuts?.({owner_id:t,id:i,type:n,donut_miniapp_url:this.donutMiniappUrl,openMiniAppInNewTab:this.uiConfig?.showMiniAppInNewTab,handleSuccessfulPostDonut:e=>{this.handleSuccessfulPostDonut(e)}})},this.showOneTimeDonutModal=async e=>{if((0,Ae.T)(e),!this.donutMiniappUrl||!this.config.openOneTimeDonutModal)return;if(this.uiConfig?.showMiniAppInNewTab)return void window.open(this.donutMiniappUrl,"_blank");const t=await this.config.openOneTimeDonutModal(this.donutMiniappUrl);await this.handleSuccessfulPostDonut(t)},(0,c.l_)(this)}}xc=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y,void 0===si?Object:si])],xc);const{Provider:Yc,useModel:Mc}=(0,a.Qd)(xc,{initInEffect:!1});var Tc=i(935740),Rc=i(997793);const Dc=(0,o.P)((()=>{const{donutCount:e,donutLabel:t,hidden:i,showDonutsModal:o,showOneTimeDonutModal:s}=Mc();return i?null:(0,n.Y)(j.SB4,{className:(0,G.I)("color_text_secondary"),hasActive:!1,hoverMode:"none",onClick:e?o:s,"data-testid":"post_footer_donut_block",children:(0,n.FD)(K.s,{children:[e?(0,n.Y)(Tc.s,{}):(0,n.Y)(Rc.S,{}),(0,n.Y)(St.K,{mode:"vertical",size:4}),(0,n.Y)(q.EY,{"data-testid":"post_footer_donut_block_text",children:t})]})})})),Bc=(0,a.jn)(Yc,Dc),Fc=(0,o.P)((()=>{const{props:e,postItem:t,postData:i,postDateBlockConfig:o,reactionSet:s,likesActivity:r,handleClickOnCommentIcon:a,openPost:d,showLikes:c,showFriendsLikes:l,toggleReaction:h,commentsCount:p,commentsCountText:u,repostsCount:m,repostsCountText:g,langs:_,sharePost:v,reactionsMenuConfig:f,donutBlockConfig:w,uiDateConfig:y,footerPlatformConfig:b,isDonutRestricted:C,uiConfig:k,showCommentsIcon:I,canShowDonutsRow:S,likesListRequestState:A,uiDonutBlockConfig:P,uiReactionsMenuConfig:L,canShowShare:O,onAddReaction:E}=vd(),{hasPointer:x}=(0,j.wmp)(),Y=(0,H.useRef)(null),{dataRole:M}=e.current;return(0,n.FD)(Ad,{spacingHorizontal:b.spacingHorizontal,dataRole:M,children:[k?.showReactedUsers&&!C&&(0,n.Y)(Ad.Row,{spacingVertical:0,after:k?.showDonutsBadge&&(0,n.Y)(Bc,{uiConfig:P,config:w,item:i}),children:(0,n.Y)(_c,{feedItem:t,showLikes:c,likesListRequestState:A,spacingHorizontal:0,size:"s",extendedLabel:!0,showNonFormattedCounters:!0})}),!i.hide_likes&&(0,n.FD)(Ad.Row,{gap:[16,8],after:!k?.hideDateBlock&&(0,n.Y)(Lc,{uiConfig:y,openPost:d,postItem:t,config:o}),children:[(0,n.Y)(fc,{uiReactionsMenuConfig:L,postItem:t,reactionSet:s,toggleReaction:h,showLikes:e.current.showLikes,reactionsMenuConfig:f,disablePopover:C,isDonutRestricted:C,showReactionTitleInCounter:k?.showReactionTitleInCounter,likesListRequestState:A,onAddReaction:E}),I&&(0,n.Y)(Ad.Action,{"aria-label":_.numeric(p??0,_.getLang("mobile_wall_post_comments",!0)),description:!C&&x&&_.getLang("wall_comment_tooltip_description"),icon:(0,n.Y)(Oc.J,{}),onClick:a,"data-testid":"post_footer_action_comment",disableTooltipTriggerOnFocus:!0,children:u}),O&&(0,n.Y)(Ad.Action,{getRootRef:Y,"aria-label":`${m??0} ${_.getLang("mobile_like_publish_title")}`,description:!C&&_.getLang("wall_share_post"),icon:(0,n.Y)(Ec.T,{}),onClick:()=>{Y.current&&v(Y.current)},"data-testid":"post_footer_action_share",disableTooltipTriggerOnFocus:!0,children:g})]}),r&&!C&&k?.showReactedFriends&&(0,n.Y)(Ad.Row,{spacingVertical:0,children:(0,n.Y)(yd,{photos:r.photos,onClick:l,spacingHorizontal:0,children:r.text})}),S&&(0,n.Y)(Ad.Row,{spacingTop:8,children:(0,n.Y)(Bc,{uiConfig:P,config:w,item:i,extendedLabel:!0})})]})})),Nc=(0,a.jn)(_d,Fc);var zc=i(861249),jc=i(289375),Uc=i(366161),Wc=i(844141),$c=i(813655),Hc=i(264643),Vc=i(437260),Kc=i(702441),qc=i(235677);class Gc{get feedAttachmentOnmediaAudiosListEnabled(){return this.userEnv.partConfigEnabled("feed_attachment_onmedia_audios_list")}get feedImageAttachmentsLoadingEagerEnabled(){return this.userEnv.partConfigEnabled("feed_image_attachments_loading_eager")}get feedRemoveDispatchGlobalResizeEnabled(){return this.userEnv.partConfigEnabled("feed_remove_dispatch_global_resize")}get postItem(){return this.props.current.feedItemPost.value}get rawId(){return this.props.current.feedItemPost.id}get carouselSlideIndex(){return this.props.current.itemUiState.carouselSlideIndex}get setCarouselSlideIndex(){return this.props.current.itemUiState.setCarouselSlideIndex}get dataRoles(){return this.props.current.dataRoles}get trackCode(){return this.postItem.track_code??""}get screen(){return this.metaData.get().screen??""}get rawIdParts(){return(0,h.v)(this.rawId)}get primaryAttachmentPlatformConfig(){const{primaryAttachment:e,primaryAttachmentPoll:t}=this.props.current.platformConfig;return{primaryAttachment:e,primaryAttachmentPoll:t}}onRestrictedClick({owner_id:e,photo_id:t}){this.attachmentService.agreeBlurRestriction({owner_id:e,photo_id:t})}get constructProductLink(){return this.props.current.platformConfig.postAttachments.constructProductLink}get postTypeIsReply(){return"reply"===this.postItem.post_type}get audioSnippetEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_audio_snippet")||this.userEnv.partConfigEnabled("feed_audio_snippet_abt")}constructor(e,t,i,n,o,s,r,a,d,l){this.props=e,this.userEnv=t,this.feedEntitiesMutationService=i,this.metaData=n,this.productionStats=o,this.attachmentService=s,this.feedErrorService=r,this.tagsApi=a,this.marketItemViewAnalytics=d,this.sessionStorage=l,this.photoMarketTagsModel=new qc.v({item:this.postItem,constructProductLink:this.constructProductLink},this.tagsApi,this.userEnv,this.marketItemViewAnalytics,this.productionStats,this.sessionStorage,this.feedErrorService,this.metaData),this.deprecatedPostClickAnalytics=new Vc.F({trackCode:this.trackCode,screen:this.screen,ref:this.screen},this.productionStats),this.deprecatedPostActionAnalytics=new Kc.r({trackCode:this.trackCode,screen:this.screen},this.productionStats),(0,c.l_)(this)}}Gc=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===L.J?Object:L.J,void 0===f.K?Object:f.K,void 0===O.e?Object:O.e,void 0===jc.X?Object:jc.X,void 0===$c.V?Object:$c.V,void 0===w.m?Object:w.m,void 0===Uc.q?Object:Uc.q,void 0===Hc.L?Object:Hc.L,void 0===Wc.u?Object:Wc.u])],Gc);const{Provider:Jc,useModel:Qc}=(0,a.Qd)(Gc,{initInEffect:!1});var Xc=i(862824),Zc=i(751447),tl=i(701576),il=i(451465),nl=i(466968);class ol{get switchAllAlbumPhotoToBaseUrlEnabled(){return this.userEnv.partConfigEnabled("switch_all_album_photo_to_base_url")}get isVideoCardClickLoggerEnabled(){return this.userEnv.partConfigEnabled("frontend.vkcom_video_card_view_log")}get action(){return this.props.current.platformConfig.getAction((()=>this.postHandlers.click.onPhotoOpen({feedItemId:this.props.current.rawId})))}constructor(e,t,i){this.props=e,this.userEnv=t,this.postHandlers=i,this.config=new nl.D(this.props.current.platformConfig.getBackdropBlur,this.userEnv),(0,c.l_)(this)}}ol=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===L.J?Object:L.J,void 0===T.i?Object:T.i])],ol);const{Provider:sl,useModel:rl}=(0,a.Qd)(ol,{initInEffect:!1});var al=i(12027);const dl=(0,o.P)((function(){const{switchAllAlbumPhotoToBaseUrlEnabled:e,config:t,props:i,action:o,isVideoCardClickLoggerEnabled:s}=rl(),{rawId:r,attachments:a,platformConfig:d,onRestrictedClick:c,isImageLoadingEagerEnabled:l,hasPhotoMarketTags:h,dataRole:p}=i.current,{ref:u}=(0,al.L)({videos:a.map((e=>{if("video"===e.type)return e.video}))}),[m,g]=(0,H.useState)([]),_=l?"eager":"lazy",v=(0,H.useMemo)((()=>a.filter((e=>"full"===e.style&&(0,tl.TM)(e)))),[a]),f=Boolean(1===v.length&&v[0].photo),w=(0,H.useCallback)((async()=>{const e=v[0];if(1===v.length&&e.photo){const t=await d.onRestrictedPhoto(e.photo);c({owner_id:t.owner_id,photo_id:t.id}),g((e=>[{...e[0],restriction:void 0}]))}}),[v,c,d.onRestrictedPhoto]);(0,H.useEffect)((()=>{const e=o(r);g(v.map(((t,i)=>({...(0,tl.Qq)(t,h),action:e({attachment:t,index:i,count:v.length}),restriction:(0,tl.Y1)(t)}))))}),[v,o]);const y=(0,n.Y)(Zc.h,{innerBorderRadius:0,wrapperBorderRadius:0,useMaskImage:il.T.safari,maxImageWidth:d.maxImageWidth,maxImageHeight:d.maxImageHeight,features:t.mediaGridFeatures,attachments:m,maxContainerWidth:d.maxContainerWidth,background:"gray_fields",onRestrictedClick:f?w:void 0,loading:_,useBaseImageSize:e,dataRole:p});return s?(0,n.Y)("div",{ref:u,children:y}):y})),cl=(0,a.jn)(sl,dl);var ll=i(674234),hl=i(798980),pl=i(978350),ul=i(592008),ml=i(41914),gl=i(508461),_l=i(161933);function vl(){return{isHeightLimitEnabled:!1,isFullWidthEnabled:(0,_l.HS)(),isBrowserGlitchesFixEnabled:!1}}class fl{async[a.Ts](){const e=await this.accountInfoService.ensure({fields:["video_autoplay"],shouldSyncCachedData:!0}),t=e?.settings?.find((e=>"video_autoplay"===e.name));this._isVideoAutoplayEnabled=Boolean(t?.value)}get isAutoplayEnabled(){return this._isVideoAutoplayEnabled}get userId(){return this.authService.userId}get feedOnmediaAudioRedesignFixEnabled(){return this.userEnv.partConfigEnabled("feed_onmedia_audio_redesign_fix")}get trackCode(){return this.props.current.trackCode}get primaryAttachmentFeatures(){return vl()}get platformConfig(){return this.props.current.platformConfig.primaryAttachment}get pollPlatformConfig(){return this.props.current.platformConfig.primaryAttachmentPoll}get pollSPAEnabled(){return this.userEnv.partConfigEnabled("polls_spa")}async addDoc(e){const{owner_id:t,id:i,access_key:n}=e;try{await this.docsListsProvider.addDocToAuthedUserList({owner_id:t,id:i,accessKey:n}),this.showSnackbar({text:this.langs.getLang("wall_docs_added_snacbar_text"),action:{label:this.langs.getLang("wall_docs_added_snacbar_action"),href:"/docs"}})}catch(e){this.errorLogger.log(new Error(`Doc add request has been down owner_id=${t}, id=${i}, access_key${n}`,{cause:e}))}}deleteDoc(e){this.docsListsProvider.deleteDocFromAddedAuthedUserList(e)}get articleOwnerFullNameGen(){return this.props.current.attachment.article?.owner_id?this.ownerService.getOwnerNameById(this.props.current.attachment.article.owner_id,!0,"gen"):""}get musicPlaylistOwners(){const e=this.props.current.attachment.audio_playlist;let t,i;return e?(l.z.isUserId(e.owner_id)&&(t=this.ownerService.getUserEntityById(e.owner_id)),l.z.isGroupId(e.owner_id)&&(i=this.ownerService.getGroupEntityByOwnerId(e.owner_id)),{user:t,group:i}):null}get dataRoles(){return this.props.current.dataRoles}get audioSnippetEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_audio_snippet")||this.userEnv.partConfigEnabled("feed_audio_snippet_abt")}get added(){return Boolean(this.newAudioId)}get isForceAutoplayEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_force_autoplay")}constructor(e,t,i,n,o,s,r,a,d,l,h,p){this.props=e,this.accountInfoService=t,this.userEnv=i,this.authService=n,this.postHandlers=o,this.snackbar=s,this.langs=r,this.errorLogger=a,this.attachmentService=d,this.docsListsProvider=l,this.feedErrorService=h,this.ownerService=p,this._isVideoAutoplayEnabled=!1,this.newAudioId=void 0,this.getPrimaryAttachmentBackgroundType=(e=j.zM2.LIGHT)=>this.userEnv.partConfigEnabled("photos_ears_enabled")?e===j.zM2.DARK?"black_fields":"white_fields":this.userEnv.partConfigEnabled("single_photo_background_blur_enabled")?"blur":this.platformConfig.getBackdropBlur(),this.onStickerClick=e=>{this.props.current.platformConfig.primaryAttachment.onStickerClick?.(e)},this.getAction=this.platformConfig.getAction((()=>this.postHandlers.click.onPhotoOpen({feedItemId:this.props.current.rawId}))),this.showSnackbar=e=>{this.snackbar.show(e)},this.addAudioToMyMusic=(e,t)=>(this.postHandlers.click.onAddedAudio({feedItemId:this.props.current.rawId,audio_item:{item_id:e.audio_id,item_owner_id:e.owner_id,item_type:t}}),this.attachmentService.addAudioToMyMusic(e)),this.deleteAudioFromMyMusic=({audio_id:e,owner_id:t},i)=>(this.postHandlers.click.onRemovedAudio({feedItemId:this.props.current.rawId,audio_item:{item_id:e,item_owner_id:t,item_type:i}}),this.attachmentService.deleteAudioFromMyMusic({audio_id:e})),this.onAudioPlay=(e,t)=>{this.postHandlers.action.sendStartAudioOrPlaylist(e,"manual",t,this.props.current.rawId)},this.onAudioPause=(e,t)=>{this.postHandlers.click.onPauseAudio({feedItemId:this.props.current.rawId,audio_item:{item_id:e.id,item_owner_id:e.owner_id,item_type:t}})},this.docIsAdded=e=>{const t=(0,ul.E)(e);return this.docsListsProvider.isAddedToAuthedUserList(t)},this.docIsProcessing=e=>{const t=(0,ul.E)(e);return this.docsListsProvider.isDeletingDoc(t)||this.docsListsProvider.isAddingToAuthedUserList(t)},this.toggleDoc=e=>{this.docIsProcessing(e)||(this.docIsAdded(e)?this.deleteDoc(e):this.addDoc(e))},this.handleNetworkError=e=>{this.feedErrorService.handleNetworkError(e)},this.addOrDeleteAudio=async(e,t)=>{if(e&&t)try{if(this.newAudioId)await this.deleteAudioFromMyMusic({audio_id:this.newAudioId,owner_id:e.owner_id},t),(0,c.h5)((()=>{this.newAudioId=void 0}));else{const i=await this.addAudioToMyMusic({audio_id:e.id,owner_id:e.owner_id,access_key:e.access_key,track_code:e.track_code},t);(0,c.h5)((()=>{this.newAudioId=i.items?.[0]?.new_audio_id}))}}catch(e){this.handleNetworkError(e)}},(0,c.l_)(this)}}fl=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===ml.m?Object:ml.m,void 0===L.J?Object:L.J,void 0===Ce.u?Object:Ce.u,void 0===T.i?Object:T.i,void 0===Xi.q?Object:Xi.q,void 0===E.Y?Object:E.Y,void 0===_.v?Object:_.v,void 0===$c.V?Object:$c.V,void 0===gl.O?Object:gl.O,void 0===w.m?Object:w.m,void 0===I.v?Object:I.v])],fl);const{Provider:wl,useModel:yl}=(0,a.Qd)(fl,{initInEffect:!1});class bl{get imageOptimizationEnabled(){return this.userEnv.partConfigEnabled("feed_web_image_optimization")}get imageEagerLoadingEnabled(){return this.userEnv.partConfigEnabled("feed_image_attachments_loading_eager")}get platformConfig(){return this.props.current.platformConfig}get jsonPoll(){return(0,c.HO)(this.props.current.poll)}constructor(e,t,i){this.props=e,this.ownerService=t,this.userEnv=i,this.findOwner=e=>{if(e)return this.ownerService.provideUserGroupEntityById(e)},this.rawFindOwner=e=>(0,c.HO)(this.findOwner(e)),(0,c.l_)(this)}}bl=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===I.v?Object:I.v,void 0===L.J?Object:L.J])],bl);const{Provider:Cl,useModel:kl}=(0,a.Qd)(bl,{initInEffect:!1});var Il=i(293721),Sl=i(365053);function Al(e,t){const i=new IntersectionObserver(((e,i)=>{e.some((e=>e.isIntersecting))&&(t(),i.disconnect())}),{threshold:0});return i.observe(e),()=>i.disconnect()}var Pl=i(32489),Ll=i(949849),Ol=i(679005);const El=(0,i(860656).b)("shared/effector",(()=>Pl),{version:1})().createDomain("POLLS"),xl=El.createEvent(),Yl=El.createStore({});Yl.on([xl],((e,[t,i])=>(0,Ol.jM)(e,(e=>{e[t]=i||[]}))));const Ml=(0,Ll.oi)({domain:El}),Tl=(0,Ll.ML)({domain:El}),Rl=El.createEffect((e=>e)),Dl=El.createStore({}),Bl=El.createStore({});Dl.on([Ml.done,Tl.done],((e,{params:{query:{poll_id:t}},result:{poll:i}})=>(0,Ol.jM)(e,(e=>{i&&(e[t]=i)})))),(0,Pl.sample)({clock:[Ml.done,Tl.done],fn:({result:{poll:e}})=>[e.id,e.profiles??[]],target:xl}),Dl.on([Rl.doneData],((e,t)=>(0,Ol.jM)(e,(e=>{e[t.id]=t})))),Bl.on([Ml,Tl],((e,{query:{poll_id:t}})=>(0,Ol.jM)(e,(e=>{e[t]=!0})))),Bl.on([Ml.finally,Tl.finally],((e,{params:{query:{poll_id:t}}})=>(0,Ol.jM)(e,(e=>{e[t]=!1}))));const Fl=(0,o.P)((function({pollId:e,trackCode:t,onShowFullVoting:i,onShare:o,onReport:s,onShowStats:r,onGetCode:a,imageOptimizationEnabled:d,imageEagerLoadingEnabled:c,dataRole:l,...h}){const p=(0,Il.zN)({store:Dl,keys:[e],fn:(e,[t])=>e[t]}),u=(0,Il.zN)({store:Yl,keys:[e],fn:(e,[t])=>e[t]}),m=(0,Il.zN)({store:Bl,keys:[e],fn:(e,[t])=>e[t]}),g=(0,Fe.B)(),_=(0,H.useMemo)((()=>{if(!p)return"";const e=p.end_date&&1e3*p.end_date<=Date.now();return 0===p.votes?e?g.getLang("voting_no_voted"):g.getLang("voting_vote_first"):g.numeric(p.votes,g.getLang("voting_N_voted",!0))}),[p]),v=(0,H.useMemo)((()=>{const e=[p.anonymous?g.getLang("voting_anonymous"):g.getLang("voting_public")],t=p.end_date,i=1e3*t;return p.disable_unvote&&e.push(g.getLang("voting_unvote_disabled")),p.closed?e.push(g.getLang("voting_closed")):t&&i<Date.now()?e.push(g.getLang("voting_ended")):t&&e.push(g.date(new Date(i),g.getLang("voting_time_until",!0),g.getLang("months_of",!0))),e.join(" · ")}),[p]),f=(0,H.useMemo)((()=>({footerText:_,voteText:g.getLang("voting_vote"),headerText:v,revoteText:g.getLang("voting_revote"),reportText:g.getLang("voting_report"),shareText:g.getLang("voting_share"),exportText:g.getLang("voting_export"),actionsButtonText:g.getLang("global_actions_button"),answersCountTexts:p.answers.map((e=>g.numeric(e.votes||0,g.getLang("mobile_voting_answers",!0)))),showVariantsText:g.getLang("voting_show_variants"),showResultsText:g.getLang("voting_show_results")})),[p]);if(!p||!u)return null;let w,y;return"gradient"===p.background?.type?w="gradient":"tile"===p.background?.type?w="tile":p.photo&&(w="photo"),w&&["gradient","tile"].includes(w)?y=p.background:"photo"===w&&(y=p.photo),(0,n.Y)(Sl.B,{onShowFullVoting:i,onShare:o,onReport:s,onGetCode:a,onShowStats:r,poll:p,profiles:u,getProfileHref:e=>(0,wc.dh)(e),loading:!!m,onVote:async e=>{p&&await Ml({query:{owner_id:p.owner_id,poll_id:p.id,answer_ids:e.join(","),track_code:t}})},onDeleteVote:async()=>{await Tl({query:{poll_id:p.id,owner_id:p.owner_id,track_code:t}})},runOnceInViewport:Al,hasCustomBackground:!!p.background?.type||!!p.photo?.images,backgroundType:w,background:y,actionSheetTestId:`poll-action-sheet_${p.owner_id}_${p.id}`,backgroundImageLoading:d&&!c?"lazy":void 0,"data-role":l,...h,...f})})),Nl=(0,o.P)((function(e){const{imageOptimizationEnabled:t,imageEagerLoadingEnabled:i}=kl();return(0,n.Y)(Fl,{...e,imageOptimizationEnabled:t,imageEagerLoadingEnabled:i,dataRole:e.dataRole})})),zl=(0,o.P)((function({pollId:e,trackCode:t,isActive:i,onClose:o,onShare:r,onReport:a}){const{platformConfig:d}=kl(),{ModalComponent:c}=d,l=(0,Fe.B)();return c?(0,n.Y)(c,{isShown:i,type:"modal",id:"main",width:550,onClose:o,title:l.getLang("voting_voting"),headerId:l.getLang("voting_voting"),children:(0,n.Y)(s.i,{spacing:8,children:(0,n.Y)(Nl,{pollId:e,short:!1,trackCode:t,onShare:r,onReport:a,"data-testid":`poll-modal-${e}`})})}):null})),jl=(0,o.P)((function({pollId:e,trackCode:t,onShare:i,onReport:o,onShowStats:s,onGetCode:r,onShowFullVoting:a}){const[d,c]=(0,H.useState)(!1);return(0,n.Y)(Nl,{short:!0,pollId:e,trackCode:t,onShowFullVoting:a||(()=>{c(!0)}),onShare:i,onReport:o,onShowStats:s,onGetCode:r,"data-testid":`poll-main-${e}`,modal:(0,n.Y)(zl,{pollId:e,trackCode:t,isActive:d,onClose:()=>{c(!1)},onShare:i,onReport:o})})}));var Ul=i(637057);const Wl=function({poll:e,trackCode:t,findOwner:i,platformConfig:o}){const{share:s,onPollReport:r,onShowPollStats:a,onGetCode:d,onShowFullVoting:c}=o,l=(0,Il.zN)({store:Dl,keys:[e.id],fn:(e,[t])=>e[t]}),h=((e,t)=>{if(!e||!t)return!1;if(e.question!==t.question)return!1;const i=e.answers||[],n=t.answers||[];if(i.length!==n.length)return!1;for(let e=0;e<i.length;e++)if(i[e].id!==n[e].id||i[e].text!==n[e].text)return!1;return!0})(l,e),p=h?((e,t)=>{if(!e)return t;const i=t.answers.map((t=>{const i=e.answers.find((e=>e.id===t.id));return{...t,...i}}));return{...e,...t,answers:i}})(l,e):e,{pollRaw:u,pollRawId:m}=(0,Ul.K)(p);(0,H.useEffect)((()=>{h||Rl(p)}),[p,h]),(0,H.useEffect)((()=>{xl([e.id,(e.friends||[]).map((e=>i(e.id))).filter(Boolean)])}),[e,i]);return l?(0,n.Y)(jl,{pollId:e.id,trackCode:t,onShare:()=>{s({objectId:m,object:u})},onReport:()=>{r(e)},onShowStats:()=>{a(e)},onGetCode:()=>{d(e)},onShowFullVoting:c&&(()=>{c&&c(e)})}):null},$l=(0,o.P)((function(){const{props:e,platformConfig:t,jsonPoll:i,rawFindOwner:o}=kl(),{trackCode:s,dataRole:r}=e.current;return(0,n.Y)(Wl,{poll:i,trackCode:s,findOwner:o,platformConfig:t,dataRole:r})})),Hl=(0,a.jn)(Cl,$l);var Vl=i(381270),Kl=i(898018),ql=i(136141),Gl=i(892515),Jl=i(925810),Ql=i(925005),Xl=i(63441),Zl=i(197118),eh=i(714153);const th=(0,o.P)((function({audio:e}){const{primaryAttachmentFeatures:t,platformConfig:i,onAudioPause:o,onAudioPlay:s,props:r,addOrDeleteAudio:a,added:d,dataRoles:c}=yl(),{onRestrictedAudio:l}=i,h=(0,Fe.B)(),p=(0,ql.R)(),{viewWidth:u}=(0,j.wmp)(),m=(0,H.useCallback)((()=>a(e,(0,eh.Y)(r.current.attachment))),[r.current.attachment,e]),g=(0,Gl.df)(e,p),_=Boolean(e.content_restricted||Number(e.region_restrictions)),[v,f]=(0,H.useState)(_?"restricted":"stopped"),w=(0,H.useMemo)((()=>{const t=(0,Ql.I)(e.legal_notices_type),i=!!t?.length&&(0,n.Y)(Kl.X,{lines:t});return{coverUrl:e?.album?.thumb?.photo_300,title:e.title,artist:e.artist,isExplicit:Boolean(e.is_explicit),noticeIcon:i}}),[e]);return(0,H.useEffect)((()=>{_||(g&&p.status!==Jl.w.NO&&p.status!==Jl.w.INIT&&f(p.status),g||f(Jl.w.STOPPED))}),[_,g,p.status]),(0,n.Y)(Vl.yF,{audio:w,toggleAudio:()=>{const t=(0,Gl.Fs)(e,p,g),i=p.platformAudioPlayer;t?(i?.pause(),o(e,(0,eh.Y)(r.current.attachment))):(i?.playAudio(e,[e],p.audioPlayerContext,{type:Zl.P.WALL,ownerId:e.owner_id,albumId:e.album?e.album.id:e.album_id??0}),s(e,(0,eh.Y)(r.current.attachment)))},addAudio:m,status:v,addIconKind:d?"done":"add",onRestricted:()=>{l(e)},canAddOrDeleteAudio:(0,Xl.m)(),textListen:h.getLang("audio_primary_attachment_audio_listen"),ariaLabelAdd:h.getLang("audio_add_to_audio"),ariaLabelDone:h.getLang("audio_delete_audio"),imageLoading:"eager",blurType:il.T.chrome?"svg":"backdrop",size:u<j.Gcd.TABLET?"s":"m",features:t,dataRole:c?.audio})})),ih=(0,o.P)((function({attachment:e,imageLoading:t,label:i="",dataRole:o}){const{photo_586:s,photo_200:r}=e.graffiti;return(0,n.Y)(j.glH,{ratio:2,children:(0,n.Y)(Z.v,{alt:i,src:s||r||"",loading:t,width:"100%",draggable:"false",keepAspectRatio:!0,noBorder:!0,"data-role":o})})}));var nh=i(665888),oh=i(309889),sh=i(601079),rh=i(353014),ah=i(85923),dh=i(216951),ch=i(178491);const lh=(0,o.P)((function({index:e,count:t,ratio:i,postId:o,attachment:s,onMediaAttachments:r,onRestrictedClick:a,onClose:d,imageLoading:c,photoMarketTags:l,hasPhotoMarketTags:h,onClickMarketItem:p,onGetMarketItemUrl:u,onToggleMarketLabel:m,hasMarketTagsLabelShift:g,hideAdultMarketTags:_,isSpa:v,audioSnippetEnabled:f,dataRole:w}){const{getPrimaryAttachmentBackgroundType:y,primaryAttachmentFeatures:b,feedOnmediaAudioRedesignFixEnabled:C,platformConfig:k,getAction:I,props:S}=yl(),{maxImageWidth:A,maxImageHeight:P,maxContainerWidth:L,onRestrictedPhoto:O,onRestrictedAudio:E,onOpenAttachmentAudioListModal:x,onMediaAttachmentMode:Y}=k,{deprecatedPostClickAnalytics:M,deprecatedPostActionAnalytics:T}=S.current,R=(e=>{switch(e.type){case ah.O.PHOTO:case ah.O.GRAFFITI:return nh.y;case ah.O.DOC:return oh.j}})(s),D=y((0,sh.A)()),[B,F]=(0,H.useState)((()=>(0,tl.Y1)(s))),{height:N,width:z}=s?.photo?.orig_photo??{};let j;j="photo"===s.type&&i&&z&&N?(0,dh.P)(z,N,i):i;const U=(0,H.useCallback)((async()=>{if(s.photo){const e=await O(s.photo);F(void 0),a({owner_id:e.owner_id,photo_id:e.id})}}),[s,a]),{sizes:W,overlay:$}=(0,H.useMemo)((()=>({sizes:(0,tl.O6)(s),overlay:(0,tl._f)({attachment:s,onMediaAttachments:{attachments:r??[],mode:Y,postActionAnalytics:T,postClickAnalytics:M,postId:o},photoMarketTags:l,hasPhotoMarketTags:h,hasMarketTagsLabelShift:g,hideAdultMarketTags:_,onClickMarketItem:p,onGetMarketItemUrl:u,onToggleMarketLabel:m,onRestrictedAudio:E,onOpenAttachmentAudioListModal:x,isSpa:v,audioSnippetEnabled:f})})),[s,l,h,g,_,p,u]),V=(0,H.useMemo)((()=>I(o)({attachment:s,index:e,count:t,onClose:d})),[o,s,e,t]),K=i||pl.w.SQUARE,q=K<1?"portrait":K>1?"landscape":"square",G=s.photo?.orig_photo?.width,J=s.photo?.orig_photo?.height,Q=(0,rh._R)(G,J),X=(0,ch.qT)(G,J),Z=q===Q&&X;return R?(0,n.Y)(R,{noBorderRadius:!0,noBoxShadow:!0,ratio:j||i,sizes:W,action:V,overlay:$,background:D,restriction:B,useMaskImage:il.T.safari,maxImageWidth:A,maxImageHeight:P,maxContainerWidth:L,features:b,onRestrictedClick:s.photo?U:void 0,maxImageAvailableRatio:s.photo?pl.w.WIDER:void 0,loading:c,photoOverlaySize:C?"big":"small","data-role":w,imageAutoCrop:Z}):null}));var hh=i(877248),ph=i(155811),uh=i(240557),mh=i(919559),gh=i(548893);const _h=(0,o.P)((function({index:e,count:t,ratio:i,postId:o,attachment:s,imageLoading:r,dataRole:a}){const d=(0,Fe.B)(),{docIsProcessing:c,docIsAdded:l,toggleDoc:h,getPrimaryAttachmentBackgroundType:p,primaryAttachmentFeatures:u,platformConfig:m,getAction:g}=yl(),{maxImageWidth:_,maxContainerWidth:v,gifActions:f,maxImageHeight:w}=m,{show:y,share:b}=f,C=p((0,sh.A)()),k=(0,gh.Wz)(s.doc),I=(0,ul.E)(s.doc),{sizes:S,overlay:A}=(0,H.useMemo)((()=>({sizes:(0,tl.O6)(s),overlay:(0,tl._f)({attachment:s})})),[s]),P=(0,H.useMemo)((()=>(0,hh.f)({sizes:S},{maxImageWidth:_,maxImageHeight:w,isHeightLimitEnabled:u.isHeightLimitEnabled})),[S,_]),L=(0,H.useMemo)((()=>g(o)({attachment:s,index:e,count:t})),[o,s,e,t]),O=(0,H.useCallback)((e=>{y(e.currentTarget,e)}),[y]),E=(0,H.useCallback)((e=>b?.(e.currentTarget,I,k,e)),[b]);return(0,n.Y)("div",{className:"PrimaryAttachmentGif",children:(0,n.Y)(ph.w,{noBorderRadius:!0,ratio:i,sizes:S,action:{...L,onClick:O},overlay:A,background:C,useMaskImage:il.T.safari,maxImageWidth:_,maxContainerWidth:v,features:u,overlayClassName:"page_gif_autoplay",loading:r,"data-thumb":P?.thumb?.url??"","data-preview":+Boolean(s.doc?.preview?.video),"data-role":a,children:(0,n.FD)(ph.w.Actions,{children:[b&&(0,n.Y)(aa.m,{text:d.getLang("wall_doc_share"),children:(0,n.Y)(ph.w.Action,{onClick:E,label:d.getLang("wall_doc_share"),icon:(0,n.Y)(Ec.T,{})})}),(0,n.Y)(aa.m,{text:d.getLang("wall_doc_add"),children:(0,n.Y)(ph.w.Action,{onClick:()=>h(s.doc),label:d.getLang("wall_doc_add"),state:c(s.doc)?"pending":"initial",icon:l(s.doc)?(0,n.Y)(uh.O,{}):(0,n.Y)(mh.T,{})})})]})})})}));var vh=i(68912),fh=i(328911),wh=i(9467);const yh=(e,t)=>{if(t)return t;var i;return Boolean(e.video.image?.every((e=>e.with_padding)))?void 0:e.video?.width&&e.video?.height?(i=e.video.width/e.video.height,Math.min(pl.w.WIDER,Math.max(i,pl.w.HIGH))):pl.w.WIDER};var bh=i(962514);const Ch=(0,o.P)((function({index:e,count:t,ratio:i,postId:o,attachment:s,adData:r,imageLoading:a,trackCode:d,dataRole:c,mode:l="primary"}){const{isAutoplayEnabled:h,primaryAttachmentFeatures:p,platformConfig:u,getAction:m,isForceAutoplayEnabled:g}=yl(),{maxImageWidth:_,maxContainerWidth:v,destroyInlineVideoPlayer:f,forceAutoplay:w}=u,y=(0,H.useRef)(null),{ref:b}=(0,al.L)({videos:[s.video]}),C=(0,bh.Z)(y,b);(0,H.useEffect)((()=>()=>{C.current&&f?.(C.current)}),[]),(0,H.useEffect)((()=>{h&&g&&w?.()}),[h]);const{sizes:k,overlay:I}=(0,H.useMemo)((()=>({sizes:(0,tl.O6)(s),overlay:(0,tl._f)({attachment:s})})),[s]),S=(0,H.useMemo)((()=>m(o,l)({attachment:s,index:e,count:t,trackCode:d})),[o,s,e,t,d]),A=(0,H.useMemo)((()=>(0,tl.Y1)(s)),[]),P=yh(s,i),L=(0,H.useMemo)((()=>((e,t=!1,i,n)=>{const o=e.video;let s="";t&&(s+=" page_video_autoplayable"),o.restriction&&(s+=" VideoRestriction"),i&&i!==pl.w.SQUARE&&(s+=" page_video_croppable");let r=o.access_key,a=null;o.owner_id&&o.id&&(a=(0,fh.o)({ownerId:o.owner_id,itemId:o.id}),!r&&o.album_id&&(r=(0,fh.o)({ownerId:o.owner_id,itemId:o.album_id})));const d={};return(0,wh.z2)("post_adblock_protection_promo")&&(d["data-post-locator"]='"'),o?.promo_post_hash&&(d["data-promo-post-hash"]=o.promo_post_hash),o?.should_stretch&&(d["data-stretch-vertical"]="1"),a&&(d["data-video"]=a),o.duration&&(d["data-duration"]=`${o.duration}`),o.track_code&&(d["data-track-code"]=o.track_code),n&&(d["data-ad-data"]=n),{"data-list":r,wrapperClassName:s,...d}})(s,h,P,r)),[P,s,r,h]);return(0,n.Y)(vh.P,{...L,noBorderRadius:!0,noBoxShadow:!0,ratio:P,sizes:k,action:S,getRootRef:C,overlay:I,maxImageAvailableRatio:pl.w.WIDER,background:"black_fields",onRestrictedClick:S?.onClick,restriction:A,useMaskImage:il.T.safari,maxImageWidth:_,maxContainerWidth:v,features:p,loading:a,dataRole:c})}));var kh=i(429294),Ih=i(947034),Sh=i(812742),Ah=i(159978),Ph=i(739242);const Lh=(0,o.P)((function({postId:e,attachment:t,dataRole:i}){const{platformConfig:o,trackCode:s}=yl(),{maxContainerWidth:r,onClipClick:a,pauseInlineVideoPlayer:d}=o,c=(0,Sh.g)(),l=(0,jo.WO)({id:t.clip.id??0,ownerId:t.clip.owner_id??0}),h=!t.clip.restriction||Boolean(t.clip.restriction?.can_play),p=(0,Ah.n)({canPlay:h,height:t.clip.height,width:t.clip.width});return(0,n.Y)(kh.b,{videoRawId:l,postId:e,coverWidth:r,ratio:p,headerHeight:c,onClick:e=>a(e,l),getPlayer:e=>(0,n.Y)(Ih.Q,{...e,borderRadius:"none"}),pauseVideoPlayer:d,feedTrackCode:s,mode:(0,Ph.f)(),dataRole:i})}));var Oh=i(300032);const Eh=(0,o.P)((function({attachment:e,postId:t,imageLoading:i,dataRoles:o}){const{platformConfig:s,getAction:r}=yl(),{maxImageWidth:a,maxContainerWidth:d}=s,c=(0,H.useMemo)((()=>(0,tl.O6)(e)),[e]),l=(0,H.useMemo)((()=>r(t)({attachment:e})),[t,e]);return(0,n.FD)(n.FK,{children:[(0,n.Y)(nh.y,{noBorderRadius:!0,noBoxShadow:!0,background:"gray_fields",action:l,ratio:c[0]?.width/c[0]?.height,maxContainerWidth:d,maxImageWidth:a,sizes:c,loading:i,dataRole:o?.photo}),Boolean(e.mini_app?.description&&l?.href)&&(0,n.Y)(it.N,{href:l?.href,target:l?.isExternal?"_blank":"","data-role":o?.button,children:(0,n.Y)(Oh.T,{expandable:"always",maxHeight:44,children:e.mini_app?.description})})]})}));var xh=i(681772),Yh=i(233536);const Mh=(0,o.P)((function({url:e="",album:t,onClick:i,dataRole:o}){const s=(0,Fe.B)(),{title:r,thumb:a,size:d}=t,{hasBlur:c,disclaimer:l,disclaimerType:h}=function(e){let t,i,n=!1;if(e?.restrictions){const{restrictions:o}=e;n=1===o.blur,t=3===o.disclaimer_type?"sensitive":"blocked",i=o.title}return{hasBlur:n,disclaimer:i,disclaimerType:t}}(a),p=s.langReplace(s.numeric(Number(d),s.getLang("pages_albums_label_long",!0)),{size:String(d)}),u=function(e,t){return!e?.sizes||t&&"sensitive"!==t?void 0:(0,be.q)(e?.sizes,1/0)?.url}(a,h);return(0,n.Y)(xh.B,{onClick:i,url:e,title:(0,Yh.Lt)(r),hasBlur:c,hiddenAlbumLabel:"",disclaimer:l,disclaimerType:h,cover:u,albumInfoLabel:p,borderRadius:0,dataRole:o})}));var Th=i(108852),Rh=i(675492),Dh=i(649474);const Bh=(0,o.P)((function({video:e,adData:t,imageLoading:i,ratio:o,sizes:s,overlay:r,action:a,features:d,restriction:c,onDestroy:l,isAutoplayEnabled:h,maxImageWidth:p,maxContainerWidth:u,button:m,dataRole:g,dataRoleButton:_,videoAction:v,forceAutoplay:f}){const w=(0,H.useRef)(null);(0,H.useEffect)((()=>()=>{w.current&&l?.(w.current)}),[]),(0,H.useEffect)((()=>{h&&f?.()}),[h]);const y=(0,H.useMemo)((()=>(0,Dh.m9)({type:ah.O.VIDEO,video:e},{isAutoplayEnabled:h},o,t)),[o,e,t,h]);return(0,n.FD)(n.FK,{children:[(0,n.Y)(vh.P,{...y,noBorderRadius:!0,noBoxShadow:!0,ratio:o,sizes:s,action:v??a,getRootRef:w,overlay:r,maxImageAvailableRatio:pl.w.WIDER,background:"black_fields",onRestrictedClick:a?.onClick,restriction:c,useMaskImage:il.T.safari,maxImageWidth:p,maxContainerWidth:u,features:d,loading:i,dataRole:g,"data-link-attr":v?.href}),(0,n.Y)(Th.k,{"data-role":_,action:a,children:m})]})})),Fh=e=>"video"in e&&"button"in e,Nh=e=>"button"in e;var zh=i(375780),jh=i(942741);class Uh{async[a.Ts](){const e=await this.accountInfoService.ensure({fields:["video_autoplay"],shouldSyncCachedData:!0}),t=e?.settings?.find((e=>"video_autoplay"===e.name));(0,c.h5)((()=>{this._isVideoAutoplayEnabled=Boolean(t?.value)}))}get data(){return{sizes:this._sizes,videoOverlay:this._videoOverlay,ratio:this._ratio,imageAriaLabel:this.props.current.snippet.title,imageLoading:this.props.current.imageLoading,action:this._action,buttonColor:this._buttonColor,title:this.title,caption:this.caption,dataTestId:"snippet-attachment-button",adData:this.props.current.adData,restriction:this._restriction,video:this.video,features:this.primaryAttachmentFeatures}}get title(){return Nh(this.props.current.snippet)?this.props.current.snippet.button.title:this.props.current.snippet.title}get caption(){return Nh(this.props.current.snippet)?void 0:this.props.current.snippet.caption}get video(){return Fh(this.props.current.snippet)?this.props.current.snippet.video:void 0}get isButton(){return Nh(this.props.current.snippet)}get isVideo(){return Fh(this.props.current.snippet)}get isAutoplayEnabled(){return this._isVideoAutoplayEnabled}get filterPhotosSizesByRatioEnabled(){return!(0,_l.HS)()}get primaryAttachmentFeatures(){return vl()}get platformConfig(){return this.props.current.platformConfig}get dataRoles(){return this.props.current.dataRoles}get videoAction(){return this._action}get isForceAutoplayEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_force_autoplay")}get linkAction(){if(!this._action||!this.isVideo)return this._action;const{onClick:e,...t}=this._action;return t}async extractColor(){const e=(this._sizes??[]).toSorted(((e,t)=>e.width-t.width))[0];if(!e)return;const t=await(0,zh.uM)(e.url);t&&(0,c.h5)((()=>{this._buttonColor=t}))}constructor(e,t,i){this.props=e,this.accountInfoService=t,this.userEnv=i,this._isVideoAutoplayEnabled=!1,this._buttonColor=void 0,this._sizes=void 0,this._videoOverlay=void 0,this._ratio=void 0,this._restriction=void 0,this._action=void 0,(0,c.l_)(this);const n=this.props.current.ratio,o=this.props.current.snippet,s=Fh(r=o)?r.video?.image??[]:r.photo?.sizes?.map((e=>({...e,url:e.url??""})))??[];var r;const a=!("target"in o)||"external"===o.target;if(this._action=this.props.current.action??(0,jh.a)(this.title??"",this.props.current.url,a),this._action&&!this._action.ariaLabel&&(this._action.ariaLabel=""),this._sizes=this.filterPhotosSizesByRatioEnabled&&n?((e,t)=>{const i=e.filter((e=>Number((e.width/e.height).toFixed(2))===t));return i.length?i:e})(s,n):s,this._ratio=n,Fh(o)&&o.video){const e={type:ah.O.VIDEO,video:o.video};this._ratio=yh(e,n),this._videoOverlay=(0,tl.ZT)(e),this._restriction=(0,tl.Y1)(e)}this.isButton&&this.extractColor()}}Uh=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===ml.m?Object:ml.m,void 0===L.J?Object:L.J])],Uh);const{Provider:Wh,useModel:$h}=(0,a.Qd)(Uh,{initInEffect:!1}),Hh=(0,o.P)((function(){const{platformConfig:e,isVideo:t,isButton:i,isAutoplayEnabled:o,data:s,dataRoles:r,linkAction:a,videoAction:d,isForceAutoplayEnabled:c}=$h(),{maxImageWidth:l,maxContainerWidth:h,destroyInlineVideoPlayer:p,forceAutoplay:u}=e,m=i?(0,n.Y)(Oh.T,{backgroundColor:s.buttonColor,"data-testid":s.dataTestId,chevron:"always",children:s.title}):null;return s.sizes?t?s.video?(0,n.Y)(Bh,{video:s.video,sizes:s.sizes,overlay:s.videoOverlay,ratio:s.ratio,action:a,videoAction:d,adData:s.adData,features:s.features,restriction:s.restriction,imageLoading:s.imageLoading,isAutoplayEnabled:o,onDestroy:p,maxImageWidth:l,maxContainerWidth:h,dataRole:s.restriction?r?.restriction:r?.video,dataRoleButton:s.restriction?r?.restriction:r?.button,button:m,forceAutoplay:c?u:void 0}):null:(0,n.FD)(n.FK,{children:[(0,n.Y)(Rh.p,{mode:"feed",maxImageWidth:l,maxContainerWidth:h,action:s.action,sizes:s.sizes,ratio:s.ratio,loading:s.imageLoading,imageAriaLabel:s.imageAriaLabel,dataRoles:r,title:s.title,caption:s.caption,disableButton:!!m}),!!m&&(0,n.Y)(Th.k,{"data-role":r?.button,action:s.action,children:m})]}):null})),Vh=(0,a.jn)(Wh,Hh);var Kh=i(996241);const qh=(0,o.P)((function({article:e,url:t="",ratio:i,action:o,imageLoading:s,dataRoles:r}){const{platformConfig:a,articleOwnerFullNameGen:d}=yl(),{onArticleHover:c,restrictions:l}=a,h=l?.({type:"article",article:e}),p=(0,Fe.B)(),{title:u=""}=e;let m=d&&p.langReplace(p.getLang("pages_articles_label_long"),{author:d});m||(m=e.owner_name?p.langReplace(p.getLang("pages_articles_label_long"),{author:e.owner_name}):p.getLang("pages_articles_label"));const g=h??(0,Kh.J)(e.owner_id,e.owner_name,e.state,e.donut,e.url,void 0,!0),_=o??(0,jh.a)(u,t,!0);_&&!_.ariaLabel&&(_.ariaLabel="");const v={mode:"feed",title:u||"",sizes:e.photo?.sizes,caption:m,maxImageWidth:550,maxContainerWidth:550,restriction:g?.restriction,onMouseEnter:()=>c?.(e),onRestrictedClick:g?.onRestrictionClick,action:_,ratio:i,loading:s,renderRestrictionText:e=>(0,n.Y)(Ca.I,{allowedHTML:{br:!0},children:e}),dataRoles:r};return(0,n.Y)(Rh.p,{...v})}));var Gh=i(399902);const Jh=(e="",t,i,n,o)=>{let s=e;try{s=encodeURIComponent(encodeURI(decodeURI(e)))}catch{}return(0,Gh.G)(function(e,t=!1){let i=e;try{i=encodeURIComponent(decodeURIComponent(e))}catch{}return"/away.php?to="+i+(t?"&utf=1":"")}(s,!0),{track_code:i??"",post:t,post_ad_data:n??"",el:o?"button":"snippet",hash:o??""},!1)};var Qh=i(88515),Xh=i(933768);const Zh=(e,t=200)=>e?e.find((e=>e.width===t))?.url||e[0].url:"",ep=({attachment:e,postId:t,adData:i})=>{const{platformConfig:o,postHandlers:s,dataRoles:r}=yl();return(0,n.Y)(Xh.F,{spacing:12,getScrollToLeft:e=>(s.click.onClickPrettyCardsNext(t),e-444),getScrollToRight:e=>(s.click.onClickPrettyCardsPrev(t),e+444),children:e.pretty_cards.cards.map((({button:e,button_text:a,link_url:d,images:c=[],title:l,card_id:h,price:p,price_old:u,card_data:m,away_params:g})=>{const _=((e,t,i={})=>(0,Gh.G)(Jh(e,t.postId,"",t.adData),{pretty_card_data:t.prettyCardData??"",...i,el:""},!1))(d,{postId:t,adData:i,prettyCardData:m},g),v=a||("string"!=typeof e?e?.title:void 0);return(0,n.Y)(Qh.$.Card,{image:Zh(c,o.prettyCardImageSize),photoSize:"square",target:"_blank",rel:"nofollow noopener",href:_,title:l,subtitle:p??"",strikethroughSubtitle:u,buttonLabel:v,buttonAppearance:"accent",hideButtonIcon:!0,onClick:()=>s.click.onOpenPrettyCard(t),"data-role":r?.prettyCards},h)}))})};var tp=i(529088),ip=i(434518),np=i(763812),op=i(945215),sp=i(937717),rp=i(768319),ap=i(36794);class dp{get ref(){switch(this.meta.get().module){case"feed":return"feed";case"profile":return"user_wall";case"groups":return"group_wall";default:return null}}constructor(e){this.meta=e,(0,c.Gn)(this)}}(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],dp.prototype,"ref",null),dp=(0,d.Cg)([a.z8.global(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===O.e?Object:O.e])],dp);var cp=i(249018),lp=i(321171),hp=i(309266),pp=(0,np._)("_playlist"),up=(0,np._)("_postHandlers"),mp=(0,np._)("_postRawId");class gp{logOpen(){const e=this.getClickEvent();(0,ip._)(this,up)[up].click.onOpenPlaylist(e)}logToggleFollowing(e){const t=this.getClickEvent();e?(0,ip._)(this,up)[up].click.onAddedPlaylist(t):(0,ip._)(this,up)[up].click.onRemovedPlaylist(t)}logTogglePlaying(){const e={audio_item:this.playlistItem,feedItemId:(0,ip._)(this,mp)[mp],autoplay_mode:"manual"};(0,ip._)(this,up)[up].action.sendStartPostPlaylist(e)}logTrackTogglePlaying(e,t){const i={audio_item:this.getTrackItem(e.identity),track_code:e.context.trackCode,subtype:t?"manual":"pause",feedItemId:(0,ip._)(this,mp)[mp]};(0,ip._)(this,up)[up].action.sendStartPostAudio(i)}logTrackToggleOwning(e,t){const i=(0,ip._)(this,mp)[mp],n=this.getTrackItem(e.identity);t?(0,ip._)(this,up)[up].click.onAddedAudio({audio_item:n,feedItemId:i}):(0,ip._)(this,up)[up].click.onRemovedAudio({audio_item:n,feedItemId:i})}get playlistItem(){const{id:e,ownerId:t}=(0,ip._)(this,pp)[pp].identity;return{item_id:e,item_owner_id:t,item_type:_p((0,ip._)(this,pp)[pp])}}getTrackItem(e){return{item_id:e.id,item_owner_id:e.ownerId,item_type:"audio"}}getClickEvent(){return{audio_item:this.playlistItem,autoplay_mode:"manual",feedItemId:(0,ip._)(this,mp)[mp]}}constructor(e){Object.defineProperty(this,pp,{writable:!0,value:void 0}),Object.defineProperty(this,up,{writable:!0,value:void 0}),Object.defineProperty(this,mp,{writable:!0,value:void 0}),(0,ip._)(this,pp)[pp]=e.playlist,(0,ip._)(this,up)[up]=e.postHandlers,(0,ip._)(this,mp)[mp]=e.postRawId,(0,c.Gn)(this)}}function _p(e){return(0,cp._)(e,lp.b.MusicAlbumPlaylist)?e.subtype===hp.h.Single?"single":"album":"playlist"}(0,d.Cg)([c.EW,(0,d.Sn)("design:type","undefined"==typeof PostAudioItem?Object:PostAudioItem),(0,d.Sn)("design:paramtypes",[])],gp.prototype,"playlistItem",null);var vp=i(320366),fp=(0,np._)("_analytics"),wp=(0,np._)("_langs");class yp{get isNotComplete(){return this.fullCount>this.tracks.length}get expandLabel(){return(0,ip._)(this,wp)[wp].langReplace((0,ip._)(this,wp)[wp].getLang("wall_primary_music_playlist_attachment_tracks_expand_label"),{count:this.fullCount.toString()})}get fullCount(){return this.playlist.audiosCount}constructor(e){Object.defineProperty(this,fp,{writable:!0,value:void 0}),Object.defineProperty(this,wp,{writable:!0,value:void 0}),(0,ip._)(this,fp)[fp]=e.analytics,(0,ip._)(this,wp)[wp]=e.langs,this.playlist=e.playlist,this.tracks=e.tracks.map((t=>e.trackModelFactory.createFromEntity({entities:{audio:t,list:this.playlist.entity},onTogglePlaying:e=>{(0,ip._)(this,fp)[fp].logTrackTogglePlaying(t,e.isActive)},actionsCallbacks:{onToggleOwning:e=>{(0,ip._)(this,fp)[fp].logTrackToggleOwning(t,e.isActive)}}}))),(0,c.Gn)(this)}}(0,d.Cg)([c.EW,(0,d.Sn)("design:type",void 0),(0,d.Sn)("design:paramtypes",[])],yp.prototype,"isNotComplete",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",void 0),(0,d.Sn)("design:paramtypes",[])],yp.prototype,"expandLabel",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",void 0),(0,d.Sn)("design:paramtypes",[])],yp.prototype,"fullCount",null);var bp=(0,np._)("_analytics"),Cp=(0,np._)("_langs"),kp=(0,np._)("_trackModelFactory"),Ip=(0,np._)("_dataRole");class Sp{get previewTracks(){let e;return this.playlist.audiosCount<1||!this.previewTrackList||this.previewTrackList.head.length<1?null:(e=this.previewTrackList.head.slice(0,4).filter((e=>e.type===vp.h.MusicTrack)),new yp({trackModelFactory:(0,ip._)(this,kp)[kp],langs:(0,ip._)(this,Cp)[Cp],playlist:this.playlist,tracks:e,analytics:(0,ip._)(this,bp)[bp]}))}get extraLines(){const e=this.playlist;let t,i;switch(e.type){case"album":i=e.album?.genreLabels??[],t=[e.typeLabel,...i,e.album?.releaseYear?.toString()];break;case"ugc":t=[e.typeLabel,this.updateDateLabel];break;case"chat":t=[e.typeLabel];break;default:t=[e.data.subtitle]}return Ap(t)}get actions(){const e=this.playlist.actions;return Ap([e.togglePlaying,e.toggleShuffled,e.toggleFollowing])}get updateDateLabel(){const{updatedAt:e}=this.playlist.data;let t,i,n;return e?(t=(0,ip._)(this,Cp)[Cp].getLang("audio_music_playlist_updatable_subtitle"),i=(0,ip._)(this,Cp)[Cp].getLang("months_of",!0),n=(0,ip._)(this,Cp)[Cp].compactDate(e,i,{excludeTime:!0}),`${t} ${n}`):null}get dataRole(){return(0,ip._)(this,Ip)[Ip]}constructor(e){Object.defineProperty(this,bp,{writable:!0,value:void 0}),Object.defineProperty(this,Cp,{writable:!0,value:void 0}),Object.defineProperty(this,kp,{writable:!0,value:void 0}),Object.defineProperty(this,Ip,{writable:!0,value:void 0}),this.previewTrackList=null,(0,ip._)(this,bp)[bp]=e.analytics,(0,ip._)(this,Cp)[Cp]=e.langs,(0,ip._)(this,kp)[kp]=e.trackModelFactory,(0,ip._)(this,Ip)[Ip]=e.dataRole,this.playlist=e.playlist,e.previewTrackList&&(this.previewTrackList=e.previewTrackList),(0,c.Gn)(this)}}function Ap(e){return e.filter((e=>!!e))}(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Sp.prototype,"previewTracks",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Array),(0,d.Sn)("design:paramtypes",[])],Sp.prototype,"extraLines",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Sp.prototype,"actions",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Sp.prototype,"updateDateLabel",null);var Pp=(0,np._)("_handlePlaylistOpen"),Lp=(0,np._)("_handlePlaylistToggleFollowing"),Op=(0,np._)("_handlePlaylistTogglePlaying");class Ep{get layout(){return new Sp({trackModelFactory:this.trackModelFactory,playlist:this.playlist,langs:this.langs,previewTrackList:this.previewTrackList??void 0,analytics:this.analytics,dataRole:this.props.current.dataRole})}get playlist(){const e=this.playlistEntity,{owners:t}=this.props.current;return this.playlistModelFactory.create({entity:e,owners:t,actionsCallbacks:{onOpen:(0,ip._)(this,Pp)[Pp],onToggleFollowing:(0,ip._)(this,Lp)[Lp],onTogglePlaying:(0,ip._)(this,Op)[Op]}})}get playlistEntity(){const e=this.props.current.playlist,t=this.playlistMeta.ref;return this.playlistProvider.provideFromAPI(e,{ref:t})}get previewTrackList(){const e=this.props.current.playlist.audios,t=this.props.current.postRawId;return e&&0!==this.playlistEntity.count?this.postAttachmentAudioListProvider.getEnsured(t,e):null}get analytics(){return new gp({postHandlers:this.props.current.postHandlers,postRawId:this.props.current.postRawId,playlist:this.playlistEntity})}constructor(e,t,i,n,o,s,r){Object.defineProperty(this,Pp,{writable:!0,value:void 0}),Object.defineProperty(this,Lp,{writable:!0,value:void 0}),Object.defineProperty(this,Op,{writable:!0,value:void 0}),this.props=e,this.langs=t,this.playlistProvider=i,this.playlistModelFactory=n,this.playlistMeta=o,this.postAttachmentAudioListProvider=s,this.trackModelFactory=r,(0,ip._)(this,Pp)[Pp]=()=>{this.analytics.logOpen()},(0,ip._)(this,Lp)[Lp]=e=>{this.analytics.logToggleFollowing(e.isActive)},(0,ip._)(this,Op)[Op]=()=>{this.analytics.logTogglePlaying()},(0,c.Gn)(this)}}(0,d.Cg)([c.EW,(0,d.Sn)("design:type","undefined"==typeof IMusicPlaylistAttachmentLayoutViewModel?Object:IMusicPlaylistAttachmentLayoutViewModel),(0,d.Sn)("design:paramtypes",[])],Ep.prototype,"layout",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type","undefined"==typeof IMusicPlaylistModel?Object:IMusicPlaylistModel),(0,d.Sn)("design:paramtypes",[])],Ep.prototype,"playlist",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",void 0),(0,d.Sn)("design:paramtypes",[])],Ep.prototype,"playlistEntity",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Ep.prototype,"previewTrackList",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type","undefined"==typeof IMusicPlaylistAttachmentAnalytics?Object:IMusicPlaylistAttachmentAnalytics),(0,d.Sn)("design:paramtypes",[])],Ep.prototype,"analytics",null),Ep=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y,void 0===op.X?Object:op.X,void 0===rp.b?Object:rp.b,void 0===dp?Object:dp,void 0===sp.h?Object:sp.h,void 0===ap.u?Object:ap.u])],Ep);const{Provider:xp,useModel:Yp}=(0,a.Qd)(Ep,{initInEffect:!1}),Mp=(0,o.P)((function(){const{layout:e,props:t}=Yp(),i=t.current.Layout;return(0,n.Y)(i,{model:e})})),Tp=(0,tp.T)((0,a.jn)(xp,Mp),{onError:(e,{logger:t,uiDegradationLogger:i})=>{t.log(e),i.log({elementName:"primary_music_playlist_attachment"})}});function Rp({playlist:e,postRawId:t,postHandlers:i,owners:o,Layout:s,dataRole:r}){return s?(0,n.Y)(Tp,{playlist:e,postRawId:t,postHandlers:i,owners:o,Layout:s,dataRole:r}):null}var Dp=i(524706),Bp=(0,np._)("_list"),Fp=(0,np._)("_postRawId"),Np=(0,np._)("_postHandlers");class zp{logOpenLayer(){const{episodeItem:e}=this;let t;e&&(t={audio_item:e,feedItemId:(0,ip._)(this,Fp)[Fp]},(0,ip._)(this,Np)[Np].click.onOpenAudio(t))}logTogglePlaying(e){const{episode:t,episodeItem:i}=this;let n;t&&i&&(n={audio_item:i,feedItemId:(0,ip._)(this,Fp)[Fp],track_code:t.context.trackCode,subtype:e?"manual":"pause"},(0,ip._)(this,Np)[Np].action.sendStartPostAudio(n))}get episodeItem(){const e=this.episode;return e?{item_id:e.identity.id,item_owner_id:e.identity.ownerId,item_type:"episode"}:null}get episode(){return(0,ip._)(this,Bp)[Bp].audioAt(0)??null}constructor(e){Object.defineProperty(this,Bp,{writable:!0,value:void 0}),Object.defineProperty(this,Fp,{writable:!0,value:void 0}),Object.defineProperty(this,Np,{writable:!0,value:void 0}),(0,ip._)(this,Bp)[Bp]=e.list,(0,ip._)(this,Fp)[Fp]=e.postRawId,(0,ip._)(this,Np)[Np]=e.postHandlers,(0,c.Gn)(this)}}(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],zp.prototype,"episodeItem",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],zp.prototype,"episode",null);var jp=(0,np._)("_langs");class Up{get extraLines(){return[this.durationLabel,this.playsLabel].filter((e=>!!e))}get playsLabel(){let e;const t=this.episode.entity.plays;return"number"!=typeof t?null:(e=(0,ip._)(this,jp)[jp].getLang("audio_attach_episode_listen_count"),(0,ip._)(this,jp)[jp].langReplace(e,{plays:(0,ud.B)(t)}))}get durationLabel(){const e=this.episode.data.duration;return(0,ip._)(this,jp)[jp].formatTime(e)}constructor(e){Object.defineProperty(this,jp,{writable:!0,value:void 0}),(0,c.Gn)(this),this.episode=e.episode,(0,ip._)(this,jp)[jp]=e.langs}}(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Array),(0,d.Sn)("design:paramtypes",[])],Up.prototype,"extraLines",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Up.prototype,"playsLabel",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",String),(0,d.Sn)("design:paramtypes",[])],Up.prototype,"durationLabel",null);var Wp=(0,np._)("_logError"),$p=(0,np._)("_handleEpisodeOpenLayer"),Hp=(0,np._)("_handleEpisodeTogglePlaying");class Vp{get layout(){const e=this.episode;return e?new Up({episode:e,langs:this.langs}):null}get episode(){const e=this.episodeEntity,t=this.episodeList;return e&&t?this.modelFactory.createEpisodeFromEntity({entities:{audio:e,list:t},actionsCallbacks:{onOpenLayer:(0,ip._)(this,$p)[$p],onTogglePlaying:(0,ip._)(this,Hp)[Hp]}}):null}get episodeEntity(){const e=this.episodeList;let t;return e?(t=e.audioAt(0),t||((0,ip._)(this,Wp)[Wp]("Missing required episode in attachment podcast episode list",{listFullId:e.identity.fullId}),null)):null}get episodeList(){const e=this.props.current.postRawId,t=[this.props.current.episode];return this.episodeListProvider.getEnsured(e,t)}get analytics(){const{episodeList:e}=this;return e?new zp({list:e,postRawId:this.props.current.postRawId,postHandlers:this.props.current.postHandlers}):null}constructor(e,t,i,n,o){Object.defineProperty(this,Wp,{value:Kp}),Object.defineProperty(this,$p,{writable:!0,value:void 0}),Object.defineProperty(this,Hp,{writable:!0,value:void 0}),this.props=e,this.langs=t,this.errorLogger=i,this.episodeListProvider=n,this.modelFactory=o,(0,ip._)(this,$p)[$p]=()=>{this.analytics?.logOpenLayer()},(0,ip._)(this,Hp)[Hp]=e=>{this.analytics?.logTogglePlaying(!e.isActive)},(0,c.Gn)(this)}}function Kp(e,t){const i=new Error(e);this.errorLogger.log(i,{metaData:{breadcrumb:{data:t}}})}(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Vp.prototype,"layout",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Vp.prototype,"episode",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Vp.prototype,"episodeEntity",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Vp.prototype,"episodeList",null),(0,d.Cg)([c.EW,(0,d.Sn)("design:type",Object),(0,d.Sn)("design:paramtypes",[])],Vp.prototype,"analytics",null),Vp=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y,void 0===_.v?Object:_.v,void 0===sp.h?Object:sp.h,void 0===Dp.O?Object:Dp.O])],Vp);const{Provider:qp,useModel:Gp}=(0,a.Qd)(Vp,{initInEffect:!1}),Jp=(0,o.P)((function(){const{layout:e,props:t}=Gp(),i=t.current.Layout;return e?(0,n.Y)(i,{model:e}):null})),Qp=(0,tp.T)((0,a.jn)(qp,Jp),{onError:(e,{logger:t,uiDegradationLogger:i})=>{t.log(e),i.log({elementName:"primary_podcast_episode_attachment"})}});function Xp({episode:e,postRawId:t,postHandlers:i,Layout:o}){return o?(0,n.Y)(Qp,{postRawId:t,episode:e,postHandlers:i,Layout:o}):null}var Zp=i(321831),eu=i(482392);class tu{get poll(){return this.pollModel.poll}get pollVotesText(){return this.poll?0===this.poll.votes?this.poll.isFinished?this.langs.getLang("voting_no_voted"):this.langs.getLang("voting_vote_first"):this.langs.numeric(this.poll.votes,this.langs.getLang("voting_N_voted",!0)):""}get headerText(){if(!this.poll)return"";const e=[this.poll.isAnonymous?this.langs.getLang("voting_anonymous"):this.langs.getLang("voting_public")];return this.poll.unvoteDisabled&&e.push(this.langs.getLang("voting_unvote_disabled")),this.poll.closed?e.push(this.langs.getLang("voting_closed")):this.poll.isFinished?e.push(this.langs.getLang("voting_ended")):this.poll.endDate&&e.push(this.langs.date(new Date(1e3*this.poll.endDate),this.langs.getLang("voting_time_until",!0),this.langs.getLang("months_of",!0))),e.join(" · ")}get labels(){return{footerText:this.pollVotesText,voteText:this.langs.getLang("voting_vote"),headerText:this.headerText,revoteText:this.langs.getLang("voting_revote"),reportText:this.langs.getLang("voting_report"),shareText:this.langs.getLang("voting_share"),exportText:this.langs.getLang("voting_export"),actionsButtonText:this.langs.getLang("global_actions_button"),answersCountTexts:this.poll?.answers.map((e=>this.langs.numeric(e.votes||0,this.langs.getLang("mobile_voting_answers",!0))))??[],showVariantsText:this.langs.getLang("voting_show_variants"),showResultsText:this.langs.getLang("voting_show_results")}}get modalTitle(){return this.langs.getLang("voting_voting")}get ModalComponent(){return this.props.current.ModalComponent}get backgroundImageLoading(){return this.imageOptimizationEnabled&&!this.imageEagerLoadingEnabled?"lazy":void 0}get imageOptimizationEnabled(){return this.userEnv.partConfigEnabled("feed_web_image_optimization")}get imageEagerLoadingEnabled(){return this.userEnv.partConfigEnabled("feed_image_attachments_loading_eager")}get dataRole(){return this.props.current.dataRole}constructor(e,t,i,n,o,s){this.langs=e,this.userEnv=t,this.props=i,this.snackbar=n,this.ownerService=o,this.feedItemAttachmentPollService=s,this.isModalActive=!1,this.closeModal=()=>{this.isModalActive=!1},this.openModal=()=>{this.isModalActive=!0},this.handleShowFullVoting=()=>{this.poll&&(this.props.current.onShowFullVoting?.(this.poll.data)??this.openModal())},this.handleShowResults=()=>{this.poll&&this.props.current.onShowStats?.(this.poll.data)},this.handleShowReport=()=>{this.poll&&this.props.current.onReport?.(this.poll.data)},this.handleGetCode=()=>{this.poll&&this.props.current.onGetCode?.(this.poll.data)},this.handleShare=()=>{if(!this.poll)return;const{pollRawId:e,pollRaw:t}=(0,Ul.K)(this.poll.data);this.props.current.onShare?.({objectId:e,object:t})},this.getProfileHref=e=>(0,wc.dh)(e),this.pollModel=new eu.r(this.props.current.poll,this.ownerService,this.feedItemAttachmentPollService,this.snackbar,this.langs,this.props.current.trackCode),(0,c.l_)(this)}}tu=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===E.Y?Object:E.Y,void 0===L.J?Object:L.J,void 0===a.Ji?Object:a.Ji,void 0===Xi.q?Object:Xi.q,void 0===I.v?Object:I.v,void 0===Zp.h?Object:Zp.h])],tu);const{Provider:iu,useModel:nu}=(0,a.Qd)(tu,{initInEffect:!1}),ou=(0,a.jn)(iu,(0,o.P)((function(){const{labels:e,handleShowFullVoting:t,handleShowReport:i,handleShowResults:o,handleGetCode:r,handleShare:a,ModalComponent:d,getProfileHref:l,modalTitle:h,isModalActive:p,closeModal:u,backgroundImageLoading:m,pollModel:g,dataRole:_}=nu(),{poll:v,pollVotesAvatars:f,handleVote:w,handleDeleteVote:y}=g;if(!v)return null;const b={onShowFullVoting:t,onShare:a,onReport:i,onGetCode:r,onShowStats:o,poll:(0,c.HO)(v.data),profiles:f,getProfileHref:l,loading:!1,onVote:w,onDeleteVote:y,runOnceInViewport:Al,hasCustomBackground:Boolean(v.backgroundType),backgroundType:v.backgroundType,background:v.background,actionSheetTestId:`poll-action-sheet_${v.rawId}`,backgroundImageLoading:m,...e};return(0,n.Y)(Sl.B,{short:!0,"data-role":_,...b,modal:(0,n.Y)(d,{isShown:p,type:"modal",id:"main",onClose:u,title:h,headerId:h,width:450,children:(0,n.Y)(s.i,{spacing:8,children:(0,n.Y)(Sl.B,{"data-role":_,...b})})})})}))),su=(0,o.P)((function(){const{props:e,platformConfig:t,pollPlatformConfig:i,onStickerClick:o,postHandlers:r,musicPlaylistOwners:a,getAction:d,pollSPAEnabled:c,audioSnippetEnabled:l}=yl(),{index:h,count:p,ratio:u,rawId:m,trackCode:g,attachment:_,onMediaAttachments:v,onRestrictedClick:f,mode:w="primary",adData:y,onClose:b,isImageLoadingEagerEnabled:C=!1,photoMarketTags:k,hasPhotoMarketTags:I,onClickMarketItem:S,onGetMarketItemUrl:A,hasMarketTagsLabelShift:P,hideAdultMarketTags:L,onToggleMarketLabel:O,dataRoles:E}=e.current,x=(0,Fe.B)(),Y=d(m,w)({attachment:_,trackCode:g,postAdData:y}),M=C?"eager":"lazy";return _.audio_playlist?(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:16,children:(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:4,children:(0,n.Y)(Rp,{playlist:_.audio_playlist,postRawId:m,postHandlers:r,owners:a??void 0,Layout:t.MusicPlaylistLayout,dataRole:E?.audioPlaylist})})}):_.podcast?(0,n.Y)(Xp,{episode:_.podcast,postRawId:m,postHandlers:r,Layout:t.PodcastEpisodeLayout}):_.audio?(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:16,children:(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:4,children:(0,n.Y)(j.glH,{ratio:u??pl.w.SQUARE,children:(0,n.Y)(th,{audio:_.audio})})})}):_.link?(0,n.Y)(Vh,{url:Jh(_.link.url,m,g),snippet:_.link,ratio:u,action:Y,imageLoading:M,adData:y,platformConfig:t,dataRoles:E}):"type"in(T=_)&&"graffiti"===T.type&&"graffiti"in T&&"object"==typeof T.graffiti&&!Array.isArray(T.graffiti)?(({width:e,height:t,photo_586:i,photo_200:n})=>!(e&&t)&&Boolean(i||n))(_.graffiti)?(0,n.Y)(ih,{attachment:_,imageLoading:M,label:x.getLang("wall_graffiti_compact_title"),dataRole:E?.graffiti}):(0,n.Y)(lh,{index:h,count:p,ratio:u,postId:m,attachment:_,onMediaAttachments:v,onRestrictedClick:f,onClose:b,imageLoading:M,isSpa:!0,audioSnippetEnabled:!1,dataRole:E?.graffitiDoc}):_.photo||_.doc?(e=>"type"in e&&"doc"===e.type&&"doc"in e&&"object"==typeof e.doc&&!Array.isArray(e.doc))(_)&&(0,gh.V$)(_.doc)?(0,n.Y)(_h,{index:h,count:p,ratio:u,postId:m,attachment:_,imageLoading:M,dataRole:E?.gif}):(0,n.Y)(lh,{index:h,count:p,ratio:u,postId:m,attachment:_,onMediaAttachments:v,onRestrictedClick:f,onClose:b,imageLoading:M,hasPhotoMarketTags:I,photoMarketTags:k,hasMarketTagsLabelShift:P,onClickMarketItem:S,onToggleMarketLabel:O,onGetMarketItemUrl:A,hideAdultMarketTags:L,isSpa:!0,audioSnippetEnabled:l,dataRole:E?.gifPhotoDoc}):(e=>"type"in e&&"video"===e.type&&"video"in e&&"object"==typeof e.video&&!Array.isArray(e.video))(_)?(0,n.Y)(Ch,{index:h,count:p,ratio:u,postId:m,attachment:_,mode:w,adData:y,imageLoading:M,trackCode:g,dataRole:E?.video}):(e=>"type"in e&&"clip"===e.type&&"clip"in e&&"object"==typeof e.clip&&!Array.isArray(e.clip))(_)?(0,n.Y)(Lh,{postId:m,attachment:_,trackCode:g,dataRole:E?.clip}):(e=>"type"in e&&"pretty_cards"===e.type&&"pretty_cards"in e&&"object"==typeof e.pretty_cards&&!Array.isArray(e.pretty_cards))(_)?(0,n.Y)(ep,{postId:m,attachment:_,adData:y}):_.album?Y?.href?(0,n.Y)(j.glH,{ratio:u??pl.w.SQUARE,children:(0,n.Y)(Mh,{album:_.album,url:Y.href,onClick:Y?.onClick,dataRole:E?.album})}):(console.error("Error: The URL for the album attachment was not specified."),null):_.article?(0,n.Y)(qh,{article:_.article,url:Y?.href,ratio:u,action:Y,imageLoading:M,dataRoles:E}):_.poll?(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:16,children:(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:4,children:c?(0,n.Y)(ou,{poll:_.poll,trackCode:g,onShowFullVoting:i.onShowFullVoting,onShowStats:i.onShowPollStats,onReport:i.onPollReport,onGetCode:i.onGetCode,onShare:i.share,ModalComponent:i.ModalComponent,dataRole:E?.poll}):(0,n.Y)(Hl,{poll:_.poll,trackCode:g,platformConfig:i,dataRole:E?.poll})})}):_.sticker?(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:16,children:(0,n.Y)(fa,{onStickerClick:o,sticker:_.sticker})}):(e=>"type"in e&&"mini_app"===e.type&&"mini_app"in e&&"object"==typeof e.mini_app&&!Array.isArray(e.mini_app))(_)?(0,n.Y)(Eh,{attachment:_,postId:m,imageLoading:M,dataRoles:E}):null;var T})),ru=(0,a.jn)(wl,su);class au{get currentSlideIndex(){return this.props.current.currentSlideIndex}get setCurrentSlideIndex(){return this.props.current.setCurrentSlideIndex}constructor(e,t){this.props=e,this.postHandlers=t,this.onCarouselNextClick=()=>{this.postHandlers.click.onCarouselNextClick({feedItemId:this.props.current.itemId,postType:this.props.current.postType,contentType:"photo_carousel",photoRawId:this.props.current.currentPhotoId,createdTimestamp:this.props.current.postCreatedTimestamp})},this.onCarouselPrevClick=()=>{this.postHandlers.click.onCarouselPrevClick({feedItemId:this.props.current.itemId,postType:this.props.current.postType,contentType:"photo_carousel",photoRawId:this.props.current.currentPhotoId,createdTimestamp:this.props.current.postCreatedTimestamp})},(0,c.l_)(this)}}au=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===T.i?Object:T.i])],au);const{Provider:du,useModel:cu}=(0,a.Qd)(au,{initInEffect:!1}),lu=(0,o.P)((function({children:e}){const{currentSlideIndex:t,setCurrentSlideIndex:i,props:o,onCarouselNextClick:s,onCarouselPrevClick:r}=cu(),{platformConfig:a,onChange:d,className:c,...l}=o.current,h=(0,H.useRef)(null),{viewWidth:p}=(0,j.wmp)(),u=p<j.Gcd.TABLET;(0,H.useEffect)((()=>a.subscribeOnCarouselModalClose?.((()=>i(t)))),[]);return(0,n.Y)(hl.F,{dragDisabled:a.attachmentSharedLegacyState?.().videoControlsCurrentlyHandling,getRootRef:h,slideIndex:t,onChange:e=>{const n=e-t;i(e),u&&(1===n&&s?.(),-1===n&&r?.());const o=h.current,c=o?.querySelectorAll(".attachmentCarousel__slide")?.[e];d?.(e),a.onCarouselSlideChange?.(o,c)},onNextClick:()=>{u||s?.()},onPrevClick:()=>{u||r?.()},className:(0,le.$)(c,"attachmentCarousel"),...l,children:e})})),hu=(0,a.jn)(du,lu);var pu=i(187131),uu=i(231770);function mu({children:e}){return(0,n.Y)(s.i,{mode:"vertical",spacing:0,paddingTop:0,paddingBottom:0,children:e})}var gu=i(315271),_u=i(631309);const vu=(0,o.P)((function({ModalComponent:e,ModalCardComponent:t,onClose:i,confirmAge:o}){const s=(0,Fe.B)();return(0,n.Y)(e,{id:"PhotoMarketTagsAdultModal",isShown:!0,type:"card",onClose:i,children:(0,n.Y)(t,{id:"PhotoMarketTagsAdultModall",onClose:i,icon:(0,n.Y)(_u.U,{className:(0,G.I)("color_icon_secondary")}),header:s.getLang("market_adult_check_modal_check_title"),headerComponent:"h2",subheader:s.getLang("market_adult_check_modal_check_description"),subheaderComponent:"span",actions:(0,n.FD)(gu.N,{mode:"vertical",children:[(0,n.Y)(J.$,{onClick:()=>{o(),i()},size:"m",mode:"primary",appearance:"accent",children:s.getLang("market_adult_check_modal_agree_button_title")}),(0,n.Y)(J.$,{onClick:i,size:"m",mode:"secondary",appearance:"accent",children:s.getLang("market_adult_check_modal_disagree_button_title")})]})})})}));var fu=i(233788);const wu=(0,o.P)((function({children:e}){const{feedAttachmentOnmediaAudiosListEnabled:t,feedImageAttachmentsLoadingEagerEnabled:i,feedRemoveDispatchGlobalResizeEnabled:o,props:s,postItem:r,rawId:a,rawIdParts:{ownerId:d},deprecatedPostActionAnalytics:c,deprecatedPostClickAnalytics:l,primaryAttachmentPlatformConfig:h,onRestrictedClick:p,trackCode:u,photoMarketTagsModel:m,carouselSlideIndex:g,setCarouselSlideIndex:_,postTypeIsReply:v,dataRoles:f,audioSnippetEnabled:w}=Qc(),{platformConfig:y,attachmentsExpanded:b,adsLinkHash:C}=s.current,k=(0,H.useRef)(null),I=(0,cs.z)({getAudioPlayerAdapter:y.postAttachments.getAudioPlayerAdapter,rootElement:k.current,attachPlayerEventHandler:y.postAttachments.attachPlayerEventHandler,loadAudioPlayer:y.postAttachments.loadAudioPlayer}),{attachments:S,attachments_meta:A,compact_attachments_before_cut:P,marked_as_ads:L}=r,{primary:O,secondary:E,onMedia:x,grid:Y,carousel:M}=(0,ll.y)(S,A,v),T=!!M.length,R=i,D=o,B=!O||"photo"!==O.type&&"link"!==O.type&&"article"!==O.type?void 0:A?.ratio,{hasAnyPhotoMarketTags:F}=m;let N=null;T&&(N=(0,uu.c)({onMediaAttachments:x,mode:y.postAttachments.onMediaAttachmentMode,postId:a,onRestrictedAudio:y.postAttachments.onRestrictedAudio,onOpenAttachmentAudioListModal:y.postAttachments.onOpenAttachmentAudioListModal,trackCode:u,feedAttachmentOnmediaAudiosListEnabled:t,isSpa:!0,audioSnippetEnabled:w}));const z=O||Boolean(Y.length)||T?(0,n.FD)(n.FK,{children:[O&&(0,n.Y)(mu,{children:(0,n.Y)(ru,{rawId:a,platformConfig:h,adData:"ad_data"in r?r?.ad_data:void 0,attachment:O,onMediaAttachments:T?void 0:x,trackCode:u,onRestrictedClick:p,ratio:B,isImageLoadingEagerEnabled:R,photoMarketTags:m.getAttachmentMarketTags(O),hasPhotoMarketTags:m.hasAttachmentMarketTags(O),onClickMarketItem:m.onClickMarketItem,onGetMarketItemUrl:m.onGetMarketItemUrl,onToggleMarketLabel:m.logMarketTagsLabelChange,hideAdultMarketTags:!m.ageConfirmed,deprecatedPostClickAnalytics:l,deprecatedPostActionAnalytics:c,dataRoles:f})}),Boolean(Y.length)&&(0,n.Y)(mu,{children:(0,n.Y)(cl,{rawId:a,attachments:Y,onRestrictedClick:p,platformConfig:y.mediaGrid,hasPhotoMarketTags:m.hasAttachmentMarketTags,dataRole:f?.mediaGrid})}),T&&(0,n.Y)(mu,{children:(0,n.Y)(pu.N,{attachment:N,children:(0,n.Y)(hu,{itemId:a,platformConfig:y.carousel,gap:.1,spacing:0,showCounter:!0,showArrows:!0,arrowAreaHeight:x.length||M[g]?.video||F?"fit":"stretch",resizeSource:D?"element":"window",currentSlideIndex:g,setCurrentSlideIndex:_,dataRoles:f,children:M.map(((e,t)=>(0,n.Y)(hl.F.Item,{className:"attachmentCarousel__slide",noVerticalPadding:!0,children:(0,n.Y)(ru,{index:t,count:M.length,mode:"carousel",platformConfig:h,rawId:a,adData:r?.ad_data,attachment:e,trackCode:u,ratio:A?.carousel_ratio||pl.w.SQUARE,onRestrictedClick:p,onClose:_,isImageLoadingEagerEnabled:R,photoMarketTags:m.getAttachmentMarketTags(e),hasPhotoMarketTags:m.hasAttachmentMarketTags(e),onClickMarketItem:m.onClickMarketItem,onGetMarketItemUrl:m.onGetMarketItemUrl,onToggleMarketLabel:m.logMarketTagsLabelChange,hasMarketTagsLabelShift:F&&!!N,hideAdultMarketTags:!m.ageConfirmed,deprecatedPostClickAnalytics:l,deprecatedPostActionAnalytics:c,dataRoles:f})},(0,tl.dP)(e))))})})})]}):null,j=Boolean(E.length)?(0,n.Y)(n.FK,{children:Boolean(E.length)&&(0,n.Y)(Xc.C,{rawId:a,platformConfig:y.secondaryAttachmentList,attachments:E,initialExpanded:b,maxAttachmentsBeforeCut:P,isAds:Boolean(L),trackCode:u,postAdData:r?.ad_data,adsLinkHash:C,dataRoles:f})}):null,U=m.showAdultModal&&(0,n.Y)(vu,{ModalComponent:y.postAttachments.ModalComponent,ModalCardComponent:y.postAttachments.ModalCardComponent,onClose:()=>m.setAdultModal(!1),confirmAge:m.confirmAge});return(0,n.Y)(ls.V,{ownerId:d,platformAudioPlayer:I,children:(0,n.Y)("div",{ref:k,children:e({primary:z,secondary:j})??(0,n.FD)(n.FK,{children:[z,j,U]})})})})),yu=(0,fu.L)((function({children:e,...t}){return(0,n.Y)(Jc,{...t,children:(0,n.Y)(wu,{children:e})})}));class bu{get feedItemId(){return this.props.current.feedItemId}get donut(){return this.props.current.donut}get screen(){return this.props.current.screen}get platformConfig(){return this.props.current.platformConfig}get feedImageAttachmentsLoadingEagerEnabled(){return this.userEnv.partConfigEnabled("feed_image_attachments_loading_eager")}get imageLoading(){return this.feedImageAttachmentsLoadingEagerEnabled?"eager":"lazy"}get sizes(){return(0,tl.a4)(this.donut)}get restriction(){const e=this.donut.paywall?.snippet.button??this.donut.placeholder?.button;return{type:"restricted",actionText:e?.title,text:this.donut.paywall?.snippet.title??this.donut.placeholder?.text}}get action(){return{onClick:this.handleBackgroundClick,ariaLabel:this.restriction.text??""}}constructor(e,t,i,n){this.props=e,this.langs=t,this.postHandlers=i,this.userEnv=n,this.handleRestrictedClick=()=>{this.postHandlers.click.onClickDonutButtonOnBlurredPost({feedItemId:this.feedItemId,item_type:"teaser_post",screen:this.screen}),this.props.current.onDonutRestrictedClick?.()},this.handleBackgroundClick=()=>{this.postHandlers.click.onClickBackgroundOnBlurredPost({feedItemId:this.feedItemId,item_type:"teaser_post",screen:this.screen}),this.props.current.onDonutRestrictedClick?.()},(0,c.l_)(this)}}bu=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===E.Y?Object:E.Y,void 0===T.i?Object:T.i,void 0===L.J?Object:L.J])],bu);const{Provider:Cu,useModel:ku}=(0,a.Qd)(bu,{initInEffect:!1});var Iu=i(775828);const Su=(0,o.P)((function(){const{platformConfig:e,imageLoading:t,restriction:i,handleRestrictedClick:o,sizes:r,action:a}=ku(),{maxImageWidth:d,maxContainerWidth:c}=e;return(0,n.Y)(mu,{children:(0,n.Y)(s.i,{mode:"vertical",paddingTop:e.paddingTop,paddingBottom:8,spacing:0,children:(0,n.Y)(Iu.M,{sizes:r,restriction:i,maxImageWidth:d,maxContainerWidth:c,onRestrictedClick:o,loading:t,action:a,maxImageAvailableRatio:pl.w.WIDER})})})})),Au=(0,a.jn)(Cu,Su);var Pu=function(e){return e.FakeNews="fake_news",e}({}),Lu=i(235834),Ou=i(282624),Eu=i(569597),xu=i(347820),Yu=i(326977),Mu=i(395089),Tu=i(944033);const Ru={[Pu.FakeNews]:({onClose:e,postId:t,source:i})=>{const o=(0,Fe.B)();(e=>{(0,j.K$F)(!0);const t=(0,ic.K)(e);(0,H.useEffect)((()=>{const e=e=>{"Escape"===e.key&&(e.stopPropagation(),t())};return window.addEventListener("keydown",e,!0),()=>{window.removeEventListener("keydown",e,!0)}}),[])})(e);const s=`/safety?section=misinformation&source=${i}&post_id=${t}`;return(0,n.Y)(Yu.z,{onClick:e,children:(0,n.Y)(Mu.s,{autoFocus:!0,children:(0,n.Y)(Tu.x,{id:"FakeNewsModal",size:480,onClose:e,dismissButtonMode:"inside",dismissLabel:o.getLang("wall_warning_notification_fake_news_ok_button_text"),icon:(0,n.Y)(xu.L,{className:(0,G.I)("color_icon_secondary")}),title:o.getLang("wall_warning_notification_fake_news_title"),description:o.getLang("wall_warning_notification_fake_news_description"),actions:(0,n.FD)(Bt.e,{mode:"vertical",align:"center",stretched:!0,children:[(0,n.Y)(J.$,{mode:"link",appearance:"accent",size:"l",href:s,target:"_blank",children:o.getLang("wall_warning_notification_fake_news_more_button_text")}),(0,n.Y)(J.$,{mode:"primary",appearance:"accent",size:"l",stretched:!0,onClick:e,children:o.getLang("wall_warning_notification_fake_news_ok_button_text")})]})})})})}};class Du{constructor(e,t){this.props=e,this.postHandlers=t,this.modalController=new Eu.o(Ru),this.onRender=()=>{const{caption:e}=this.props.current,{type:t}=e;t!==Pu.FakeNews||this.postHandlers.action.onRenderFakeNewsCaption()},this.handleCaptionClick=e=>{e.stopPropagation();const{type:t}=this.props.current.caption;if(t)return t===Pu.FakeNews?(this.postHandlers.click.onClickFakeNewsCaption(),void this.modalController.open({type:t,props:{source:"feed_post",postId:this.props.current.postId,onClose:this.modalController.close}})):void 0},(0,c.l_)(this)}}Du=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===T.i?Object:T.i])],Du);const{Provider:Bu,useModel:Fu}=(0,a.Qd)(Du,{initInEffect:!1}),Nu=({iconName:e})=>"info"===e?(0,n.Y)(fo.G,{}):null,zu=(0,o.P)((function(){const e=Fu(),{caption:t}=e.props.current;return(0,H.useEffect)((()=>{e.onRender()}),[]),(0,n.FD)(n.FK,{children:[(0,n.Y)(Lu.G,{before:t.icon&&(0,n.Y)(Nu,{iconName:t.icon}),onClick:e.handleCaptionClick,children:t.text}),(0,n.Y)(Ou.H,{controller:e.modalController})]})})),ju=(0,a.jn)(Bu,zu);class Uu{get item(){return this.props.current.item}get id(){return this.props.current.id}get actionButton(){if("title"in(e=this.item)&&void 0!==e.title)return this.item;var e}get screen(){return this.props.current.screen}get underMedia(){if(!this.item.hasOwnProperty("title"))return this.item}get ownerId(){return this.props.current.ownerId}get config(){return this.props.current.config}get type(){return this.props.current.type}get isPrimary(){return this.props.current.primary}get noPadding(){return this.props.current.noPaddings}get snackbarModule(){return this.snackbar}get canShowMiniAppLayer(){return Boolean(this.config.showOneTimeDonutLayer)}get canShowDonutLayer(){return Boolean(this.props.current.onOpenDonutLayer)}constructor(e,t,i){this.props=e,this.snackbar=t,this.postHandlers=i,this.onActionButtonClickEvent=e=>{this.postHandlers.click.onActionButtonClick(this.props.current.rawId,e)},this.handleShowDonutGoalModal=e=>{this.props.current.uiConfig?.showDonutThingsInNewTab?window.open(e,"_blank"):this.config.showOneTimeDonutLayer?.(e)},this.handleOpenDonutLayer=e=>{if(this.props.current.uiConfig?.showDonutThingsInNewTab){const e=this.actionButton?.action.url||this.underMedia?.action_button?.action.url||this.underMedia?.donut_link?.button?.action?.url;window.open(e,"_blank")}else this.props.current.onOpenDonutLayer?.(e)},(0,c.l_)(this)}}Uu=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===Xi.q?Object:Xi.q,void 0===T.i?Object:T.i])],Uu);const{Provider:Wu,useModel:$u}=(0,a.Qd)(Uu,{initInEffect:!1});var Hu=i(974076),Vu=i(216131);const Ku=(0,o.P)((()=>{const{id:e,config:t,type:i,isPrimary:o,noPadding:s,snackbarModule:r,ownerId:a,actionButton:d,underMedia:c,screen:l,onActionButtonClickEvent:h,canShowMiniAppLayer:p,handleShowDonutGoalModal:u,canShowDonutLayer:m,handleOpenDonutLayer:g}=$u();return"action_button"===i&&a&&d?(0,n.Y)(Hu.t,{button:d,primary:o,screen:l,id:e,openUrl:t.navigate,showDonutGoalModal:p?u:void 0,onOpenDonutLayer:m?g:void 0,ownerId:a,showWiki:t.showWiki,showSnackbar:r?.show,onActionButtonClickEvent:h,noPadding:s}):"under_media"===i&&c?(0,n.Y)(Vu.Z,{attachment:c,screen:l,id:e,openUrl:t.navigate,ownerId:a,showDonutGoalModal:p?u:void 0,onOpenDonutLayer:m?g:void 0,showWiki:t.showWiki,showSnackbar:r?.show,onActionButtonClickEvent:h}):null})),qu=(0,a.jn)(Wu,Ku);var Gu=i(182255);const Ju=({spacingSize:e,typographyComponent:t,showPollModal:i,attachments:o,postClickAnalytics:s,adsAnalyticsInfo:r,onStickerClick:a,dataRoleLink:d})=>(0,n.Y)(Gu.P,{attachments:o,separator:(0,n.Y)(St.K,{size:e,style:{width:0}}),TypographyComponent:t,showPollModal:i,onStickerClick:a,postClickAnalytics:s,adsAnalyticsInfo:r,dataRoleLink:d}),Qu=({url:e,label:t,onOpenAuthor:i,dataRoleOwner:o})=>e&&t?(0,n.Y)(Ls.b,{"data-testid":"post-footer-author","data-role":o,TypographyComponent:q.tW,Component:"a",href:e,className:(0,G.I)("color_text_secondary"),lines:1,onClick:i,...Ee.Lq,children:t}):null;var Xu=i(874167),Zu=i(11830),em=i(527652),tm=i(615544);var im=i(640290),nm=i(340310);class om{get data(){return this.props.current.item.value}get state(){return this.props.current.state}get platformConfig(){return this.props.current.platformConfig}get adData(){return"ads"in this.data?this.data.ads[0]?.ad_data:"ad_data"in this.data?this.data.ad_data??"":""}get ownerId(){return"owner_id"in this.data?this.data.owner_id:"ads"in this.data?this.data.ads[0]?.post?.owner_id:"source_id"in this.data?this.data.source_id:void 0}get postId(){return"id"in this.data?this.data.id:"ads"in this.data?this.data.ads[0]?.post?.id:"post_id"in this.data?this.data.post_id:void 0}get containerSpace(){const{padding:e}=this.props.current;return{spacing:e,paddingTop:e,paddingBottom:e}}get extraDeleteActions(){if("ban"===this.banState)return[{title:this.langs.getLang("global_blacklisted")},{title:this.langs.getLang("global_cancel"),onClick:this.unban}];if(this.props.current.config?.hasExtraDeleteActions&&("post_type"in this.data&&"suggest"===this.data.post_type||this.forceBanState)){const e=[{title:this.langs.getLang("groups_ban_for_week"),onClick:this.banForWeek}];return this.platformConfig?.openBlockSettings&&e.push({title:this.langs.getLang("global_head_settings"),onClick:this.openBlockSettings}),e}return this.props.current.config?.hasExtraDeleteActions?[{title:this.langs.sex(this.itemOwnerSex,this.langs.getLang("wall_delete_all",!0)),onClick:this.deleteAll}]:void 0}get itemOwnerSex(){const e=this.ownerService.provideUserGroupEntityById(this.ownerId);return e&&"sex"in e?e.sex??0:0}constructor(e,t,i,n,o,s){this.props=e,this.wallService=t,this.errorLogger=i,this.ownerService=n,this.groupsApi=o,this.langs=s,this.banState="default",this.forceBanState=!1,this.loadingBanModule=!1,this.updateItemState=e=>{this.props.current.updateItemState(e)},this.onComplainClick=()=>{this.platformConfig&&"post"===this.data.type&&"owner_id"in this.data&&this.data.owner_id&&this.data.id&&this.platformConfig.postContextMenu.openReportForm(this.data.owner_id,this.data.id,(()=>{this.updateItemState("reportFormSubmitted")}),this.data.track_code)},this.revealPost=async()=>{if("id"in this.data&&this.data.id)try{await this.wallService.revealWallPost({post_id:this.data.id}),this.updateItemState("default")}catch(e){this.errorLogger.log(e)}},this.archivePost=async()=>{if("id"in this.data&&this.data.id)try{await this.wallService.archiveWallPost({post_id:this.data.id}),this.updateItemState("default")}catch(e){this.errorLogger.log(e)}},this.restorePost=async()=>{if("id"in this.data&&this.data.owner_id&&this.data.id)try{await this.wallService.restoreWallPost({owner_id:this.data.owner_id,post_id:this.data.id}),this.updateItemState("default")}catch(e){this.errorLogger.log(e)}},this.deleteAll=async()=>{this.ownerId&&this.postId?(await this.wallService.deleteAllWallItems({owner_id:this.ownerId,post_id:this.postId}),(0,c.h5)((()=>{this.forceBanState=!0}))):this.errorLogger.log("[FeeditemCustomStateModel] Empty from_id or owner_id in deleteAll")},this.banForWeek=async()=>{const e=Math.floor(Date.now()/1e3)+604800;"from_id"in this.data&&this.data.from_id&&this.ownerId?(await this.groupsApi.ban({group_id:l.z.convertOwnerIdToGroupId(this.ownerId),owner_id:this.data.from_id,end_date:e}),(0,c.h5)((()=>{this.banState="ban"}))):this.errorLogger.log("[FeeditemCustomStateModel] Empty from_id in suggests banForWeek")},this.unban=async()=>{"from_id"in this.data&&this.data.from_id&&this.ownerId?(await this.groupsApi.unban({group_id:l.z.convertOwnerIdToGroupId(this.ownerId),owner_id:this.data.from_id}),(0,c.h5)((()=>{this.banState="default"}))):this.errorLogger.log("[FeeditemCustomStateModel] Empty from_id in suggests unban")},this.openBlockSettings=async()=>{if("from_id"in this.data&&this.data.from_id&&this.ownerId)try{this.loadingBanModule=!0,await(this.platformConfig?.openBlockSettings?.(l.z.convertOwnerIdToGroupId(this.ownerId),this.data.from_id))}finally{(0,c.h5)((()=>{this.loadingBanModule=!1}))}else this.errorLogger.log("[FeeditemCustomStateModel] Empty from_id in suggests openBlockSettings")},(0,c.l_)(this)}}om=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===im.C?Object:im.C,void 0===_.v?Object:_.v,void 0===I.v?Object:I.v,void 0===nm.D?Object:nm.D,void 0===E.Y?Object:E.Y])],om);const{Provider:sm,useModel:rm}=(0,a.Qd)(om,{initInEffect:!1});var am=i(322809);class dm{async loadReasons(){const{reasons:e}=await this.adApi.getHideAdReasons({});return e}async hideBlock(e){await this.adApi.hideAdBlock(e)}constructor(e){this.adApi=e}}dm=(0,d.Cg)([a.z8.container(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===am.c?Object:am.c])],dm);class cm{[a.Ts](e){this[a.yo](e),this.getHideAdReasons()}[a.yo](e){this.props=e}get reasons(){return this._reasons}get isReasonsLoading(){return this._isReasonsLoading}get isReasonSent(){return this._isReasonSent}async getHideAdReasons(){this._isReasonsLoading=!0;try{const e=await this.adService.loadReasons();(0,c.h5)((()=>{this._reasons=e,this._isReasonsLoading=!1}))}catch(e){this._isReasonsLoading=!1}}constructor(e){this.adService=e,this._reasons=[],this._isReasonsLoading=!1,this._isReasonSent=!1,this.hideAdBlock=async e=>{try{await this.adService.hideBlock(e),this._isReasonSent=!0}catch(e){this._isReasonSent=!0}},(0,c.l_)(this)}}cm=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===dm?Object:dm])],cm);const{Provider:lm,useModel:hm}=(0,a.JD)(cm,{initInEffect:!1});var pm=i(692647),um=i(174928),mm=i(831152),gm=i(976813);const _m=(0,o.P)((function(){const{props:e,reasons:t,isReasonsLoading:i,isReasonSent:o,hideAdBlock:s}=hm(),{onCancel:r,isMobile:a,adData:d,wallPostElement:c,onComplainClick:l}=e,h=(0,Fe.B)(),p=t.length&&!o?t.reduce(((e,{id:t,text:i})=>t&&i?[...e,{label:i,onClick:()=>{var e;s({reason_id:e=t,object_type:"ad",ad_data:d}).then((()=>{const t=(0,mm.WN)(c,`ad-stat-${gm.d.hide}`);if(t){const i=new URL(t);i.searchParams.set("reason",`${e}`),(0,um.xr)({pixel:{type:gm.d.hide,url:i.toString()}})}}))}}]:e),[]):[],u=l?{complainLabel:h.getLang("global_report_spam"),onComplainClick:l}:{};return(0,n.Y)(pm.o,{...u,isAd:!0,title:h.getLang("news_publication_is_hidden"),subtitle:h.getLang("news_entry_will_not_be_shown_in_feed"),cancelTitle:h.getLang("global_cancel"),isMobile:a,listActions:p,onCancel:o?void 0:r,isReasonsLoading:i})}));_m.displayName="FeedHideAdPost";const vm=(0,Ac.N)(lm,_m);var fm=i(9443);const wm="always",ym="week";class bm{onUnignoreItem(){return this.newsfeedApi.unignoreItem({type:this.props.current.blockType,item_id:this.props.current.itemId,owner_id:this.props.current.ownerId,track_code:this.props.current.trackCode})}onAddBan(e){e===ym&&this.feedPostClickAnalytics.onPostHideWeek(),e===wm&&this.feedPostClickAnalytics.onPostHideAlways();const t={...this.ids,ref:this.props.current.analyticRef,track_code:this.props.current.trackCode,type:e};return this.newsfeedApi.addBan(t)}onDeleteBan(e){return e===ym&&this.feedPostClickAnalytics.onPostUnHideWeek(),e===wm&&this.feedPostClickAnalytics.onPostUnHideAlways(),this.newsfeedApi.deleteBan(this.ids)}constructor(e,t,i,n){this.props=e,this.productionStats=t,this.userEnv=i,this.newsfeedApi=n,this.feedPostClickAnalytics=new Vc.F(this.props.current.analytics,this.productionStats);const o=l.z.isUserId(this.props.current.ownerId);this.ids=o?{user_ids:String(this.props.current.ownerId)}:{group_ids:String(l.z.convertOwnerIdToGroupId(this.props.current.ownerId))}}}bm=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===jc.X?Object:jc.X,void 0===L.J?Object:L.J,void 0===fm.a?Object:fm.a])],bm);var Cm=i(604972),km=i(764001),Im=i(799835);const Sm=({isMobile:e,onCancel:t,onComplainClick:i,onComplainSend:o,ownerId:s,customListActions:r,onAddBan:a,onDeleteBan:d})=>{const[c,h]=(0,H.useState)(!1),[p,u]=(0,H.useState)(!1),m=(0,H.useCallback)((()=>{u(!0)}),[]);(0,H.useEffect)((()=>{!e&&o&&o(m)}),[]);const g=async e=>{await a(e)&&!c&&h(e)},_=l.z.isUserId(s),v=r||[{testId:"feed_hide_from_feed_for_week",Icon:Cm.u,label:_?(0,Im.Xo)("news_hide_from_feed_for_week_user"):(0,Im.Xo)("news_hide_from_feed_for_week"),onClick:()=>g(ym)},{testId:"feed_hide_from_feed_for_all",Icon:km.D,label:_?(0,Im.Xo)("news_hide_from_feed_for_all_user"):(0,Im.Xo)("news_hide_from_feed_for_all"),onClick:()=>g(wm)}],f=i?{complainLabel:(0,Im.Xo)("global_report_spam"),onComplainClick:i}:{};return(0,n.Y)(pm.o,{...f,title:(0,Im.Xo)("news_publication_is_hidden"),subtitle:(0,Im.Xo)("news_entry_will_not_be_shown_in_feed"),cancelTitle:(0,Im.Xo)("global_cancel"),isMobile:e,activeBan:c,isSuccessComplainSend:p,listActions:v,onCancel:t,onDeleteBan:async e=>{await d(e)&&c&&h(!1)}})},{Provider:Am,useModel:Pm}=(0,a.Qd)(bm,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0}),Lm=(0,Ac.N)(Am,(function(){const e=Pm(),{analytics:t,onCancel:i,...o}=e.props.current;return(0,n.Y)(Sm,{...o,onAddBan:e.onAddBan.bind(e),onDeleteBan:e.onDeleteBan.bind(e),onCancel:()=>{e.onUnignoreItem(),i?.()}})})),Om=()=>{const e=(0,Fe.B)(),t=(0,z.K)();return(0,n.Y)(s.i,{paddingTop:20,paddingBottom:20,mode:"vertical",spacing:12,children:(0,n.Y)(j.SvD,{value:t,children:(0,n.Y)(K.s,{align:"start",children:(0,n.Y)(q.EY,{color:(0,G.I)("color_text_tertiary"),children:e.getLang("wall_feed_post_created")})})})})};var Em=i(104137);class xm{getReasonsBySource(e){return this.data.reasonsBySource.get(e)}async ensureFetchReasonsBySource(e){return this.getReasonsBySource(e)??this.fetchReasonsBySource(e)}async fetchReasonsBySource(e){const{reasons:t}=await this.reportsApi.getReasons({source:e});return this.data.reasonsBySource.set(e,t),t}async addReport(e,t,i,n,o,s,r,a){const d={type:e,reason:t,owner_id:n,item_id:o,comment:i,platform_id:r,extra_data:a};return this.reportsApi.add(d)}constructor(e){this.reportsApi=e,this.data={reasonsBySource:new Map},(0,c.l_)(this)}}xm=(0,d.Cg)([a.z8.container(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===Em.S?Object:Em.S])],xm);class Ym{async[a.Ts](){try{this._blockState="loadingReasons";const e=await this.wallReportsService.ensureFetchReasonsBySource("ad");e?.length&&(0,c.h5)((()=>{this._selectedReason=e[0]?.id,this._blockState="showReasons"}))}catch(e){this.errorLogger.log(e),this._blockState="error"}}get blockState(){return this._blockState}get data(){return this.props.current.data}get adData(){return"ads"in this.data?this.data.ads[0]?.ad_data:"ad_data"in this.data?this.data.ad_data??"":""}get reportReasons(){return this.wallReportsService.getReasonsBySource("ad")}get selectedReason(){return this._selectedReason}get isReporting(){return this._isReporting}constructor(e,t,i,n){this.props=e,this.wallReportsService=t,this.metaData=i,this.errorLogger=n,this._selectedReason=0,this._blockState="idle",this._isReporting=!1,this.sendReport=async()=>{try{this._isReporting=!0;await this.wallReportsService.addReport("ad",this._selectedReason,"","owner_id"in this.data?this.data.owner_id:void 0,"id"in this.data?this.data.id:void 0,void 0,this.metaData.get().platformId,this.adData)&&(this._blockState="reported")}catch(e){this.errorLogger.log(e)}finally{this._isReporting=!1}},this.changeReason=e=>{this._selectedReason=e},(0,c.l_)(this)}}Ym=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===xm?Object:xm,void 0===O.e?Object:O.e,void 0===_.v?Object:_.v])],Ym);const{Provider:Mm,useModel:Tm}=(0,a.Qd)(Ym,{initInEffect:!1});var Rm=i(489445),Dm=i(541687),Bm=i(978325);const Fm=()=>{const e=(0,Fe.B)();return Array.from({length:6}).map(((t,i)=>(0,n.Y)(Rm.s,{name:"radio",disabled:!0,children:(0,n.Y)(Oa.E.Text,{children:e.getLang("reports_ad_reason_ad_age_unappropriate")})},i)))},Nm=(0,o.P)((function(){const{reportReasons:e,sendReport:t,changeReason:i,selectedReason:o,isReporting:r,blockState:a}=Tm(),d=(0,Fe.B)();if("reported"===a)return(0,n.Y)(s.i,{children:d.getLang("reports_warning_sent")});const c=e??[],l="loadingReasons"===a;return(0,n.FD)(Dm.H,{onSubmit:e=>{e.preventDefault(),t()},disabled:r,children:[(0,n.Y)(Bm.e,{top:d.getLang("wall_choose_reason"),children:(0,n.Y)(j.z6M,{children:l?(0,n.Y)(Fm,{}):c.map((e=>(0,n.Y)(Rm.s,{name:"radio",value:e.id,description:e.description,checked:o===e.id,onChange:()=>{i(e.id)},disabled:r,children:e.label},e.id)))})}),(0,n.Y)(Bm.e,{children:(0,n.Y)(J.$,{size:"m",mode:"primary",appearance:"accent",type:"submit",disabled:r||l,loading:r,children:d.getLang("wall_report_spam")})})]})}));Nm.displayName="PostAdReportBlock";const zm=(0,Ac.N)(Mm,Nm),jm=({blockText:e,linkText:t,onLinkClick:i,extraDeleteActions:o})=>(0,n.FD)(s.i,{mode:"vertical",spacing:12,"data-testid":"feed-item-custom-state-block",children:[(0,n.FD)(K.s,{direction:"row",gap:2,align:"center",children:[(0,n.Y)(q.LE,{className:(0,G.I)("color_text_secondary"),inline:!0,children:e}),(0,n.Y)(it.N,{"data-testid":"feed-item-custom-state-block-link",onClick:i,children:t})]}),o&&o.map(((e,t)=>(0,n.FD)(H.Fragment,{children:[0!==t&&(0,n.Y)("span",{children:" · "}),e.onClick?(0,n.Y)(it.N,{onClick:e.onClick,href:e.href,children:e.title}):(0,n.Y)("span",{children:e.title})]},e.title)))]});var Um=i(609217);const Wm=(0,o.P)((function(){const{data:e,state:t,adData:i,updateItemState:o,onComplainClick:r,revealPost:a,archivePost:d,restorePost:c,extraDeleteActions:l,ownerId:h,postId:p,loadingBanModule:u,containerSpace:m}=rm(),g=(0,Fe.B)();let _=null;switch(t){case"archived":_=(0,n.Y)(jm,{blockText:g.getLang("wall_post_archived"),linkText:g.getLang("wall_post_archive_reveal"),onLinkClick:a});break;case"restored":_=(0,n.Y)(jm,{blockText:g.getLang("wall_post_revealed"),linkText:g.getLang("wall_post_reveal_archive"),onLinkClick:d});break;case"deleted":_=(0,n.FD)(H.Fragment,{children:[u&&(0,n.Y)(Um.W,{}),(0,n.Y)(jm,{blockText:g.getLang("wall_msgdeleted"),linkText:g.getLang("wall_restoremsg"),onLinkClick:c,extraDeleteActions:l})]});break;case"adReport":(e=>"post"===e.type||"ads"===e.type)(e)&&(_=(0,n.Y)(zm,{data:e}));break;case"reportFormSubmitted":_=g.getLang("global_report_sent");break;case"unsubscribedFromComments":_=g.getLang("wall_post_unsubscribed_from_comments");break;case"notInterested":i?_=(0,n.Y)(vm,{name:"hide_ad_post",onCancel:()=>{o("default")},adData:i,onComplainClick:()=>{o("adReport")},wallPostElement:null}):h&&p&&(_=(0,n.Y)(Lm,{blockType:On(e.type),analytics:{trackCode:e.track_code??"",ref:"feed_news",screen:"feed_news"},analyticRef:"",trackCode:e.track_code||"",ownerId:h,itemId:p,onCancel:()=>{o("default")},onComplainClick:"post"===e.type?r:void 0}));break;case"justPosted":_=(0,n.Y)(Om,{})}return _?(0,n.Y)(s.i,{mode:"vertical",...m,children:_}):null})),$m=(0,a.jn)(sm,Wm),Hm=({padding:e=8,...t})=>(0,n.Y)($m,{...t,padding:e}),Vm=(0,a.jn)(F,(0,o.P)((()=>{let e;const{showComments:t,isNestedPost:i,isDeleted:o,config:r,postItem:a,nestedPost:d,platformConfig:c,attachmentsPlatformConfig:l,commentsPlatformConfig:h,postData:p,postState:u,updatePostState:m,toggleReaction:g,refetchPost:_,rawId:v,props:f,onEndView:w,onStartView:y,feedPostViewStatsStore:b,attachmentsExpanded:C,textAlwaysExpanded:k,maxNestingLevel:I,nestingLevel:S,getItemUiState:A,itemUiState:P,handleOpenDonutPaymentLayer:L,isDonutRestricted:O,donutSubscriptionParams:E,handleOpenPost:x,underMediaAttachment:Y,actionButtonAttachment:M,chipAttachmentsAfterCut:T,chipAttachmentsUnderCut:R,hasAttachmentsBeforeText:D,hasOnlyActionButtonChipAttachmentsAfterCut:B,postAuthor:F,onOpenAuthor:z,postClickAnalytics:j,trackCode:U,screen:W,showLikes:V,onOpenReactions:K,focusCommentInputOnCommentIconClick:q,customStateConfig:G,sendImmediateView:J,isUnpublished:Q}=N(),{dataRole:X,dataRoles:Z,imageDisclaimer:ee,textDisclaimer:te,motionRef:ie,startCommentId:ne,startThreadId:oe}=f.current,{navigate:se}=(0,Er.Z)(),re=()=>{if(!E)return;const{url:e,layerQuery:t}=E;if(r?.showDonutRestrictedInNewTab)window.open(e,"_blank");else if(L&&p.owner_id){const e=new URLSearchParams(location.search),i={...Object.fromEntries(e.entries()),...t};L({layerParams:{ownerId:p.owner_id.toString()},query:i})}else e&&se(e)},{setRef:ae}=(0,zc.R)({item:a,observers:f.current.observers,index:f.current.index,onEndView:w,onStartView:y,getObserverItem:b.getObserverItem,setObserverItem:b.setObserverItem}),{setAnalyticsRef:de}=function({onSendView:e}){const t=(0,H.useRef)(null),i=(0,tm.y)(),n=(0,H.useCallback)((n=>{n&&(t.current=n,requestAnimationFrame((()=>{if(!n)return;const t=n.getBoundingClientRect()??new DOMRect,o={width:t.width,height:t.height};e(n,o,i)})))}),[i]);return{setAnalyticsRef:n,postRef:t}}({onSendView:J}),ce=(0,bh.Z)(ie,ae,de),le=Boolean(p.text||F.url||R?.length||T?.length);if(p.is_deleted)e=(0,n.Y)($,{reason:p.deleted_reason,details:p.deleted_details});else if(O)e=p.donut?(0,n.Y)(Au,{feedItemId:v,donut:p.donut,screen:E?.layerQuery?.screen,platformConfig:c.donutRestriction,onDonutRestrictedClick:re}):null;else{const t=p?.caption&&p.caption.type===Pu.FakeNews;e=(0,n.FD)(n.FK,{children:[t&&p?.caption&&(0,n.FD)(n.FK,{children:[i&&(0,n.Y)(St.K,{size:8}),(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:8,children:(0,n.Y)(ju,{caption:p.caption,postId:v})})]}),(0,n.Y)(yu,{platformConfig:l,feedItemPost:a,attachmentsExpanded:C,itemUiState:P,dataRoles:Z,children:({primary:e,secondary:o})=>{const a=Boolean(e);return a||Boolean(o)||le?(0,n.FD)(s.i,{mode:"vertical",spacing:0,paddingTop:a?8:0,paddingBottom:0,children:[i&&a&&!t&&(0,n.Y)(St.K,{size:4}),i&&!a&&!t&&(0,n.Y)(St.K,{size:8}),e,a&&M?.action_button&&!Y&&(0,n.Y)(qu,{config:c.underMediaOrActionButton,type:"action_button",screen:W,id:p.id,ownerId:p.owner_id,item:M?.action_button,rawId:v,uiConfig:r?.underMedia,onOpenDonutLayer:L,primary:!0}),a&&Y&&(0,n.Y)(qu,{config:c.underMediaOrActionButton,type:"under_media",screen:W,id:p.id,ownerId:p.owner_id,item:Y,onOpenDonutLayer:L,uiConfig:r?.underMedia,rawId:v}),ee,le&&a&&(0,n.Y)(St.K,{size:c.spacingBetweenPrimaryAndTextBlock}),(0,n.FD)(s.i,{paddingTop:le?c.paddingContentTop:0,paddingBottom:c.paddingContentBottom,mode:"vertical",spacing:c.paddingContentSpacing,children:[le&&(0,n.Y)(hd,{...c.postText,uiConfig:r?.textBlock,id:(0,Xu.l)(f.current.index),dataRoles:Z,hasAttachmentsBeforeText:D,text:p.text,rawId:v,alwaysExpanded:k,expanded:k?void 0:P.textExpanded,setExpanded:k?void 0:P.setTextExpanded,openPost:x,obsceneTextAlertBox:c.obsceneTextAlertBox,underCut:(0,n.FD)(n.FK,{children:[!!R?.length&&(0,n.FD)(n.FK,{children:[Boolean(p.text)&&(0,n.Y)(St.K,{size:c.spacingContentSize,style:{width:0}}),(0,n.Y)(Ju,{attachments:R,typographyComponent:c.chipTypographyComponent,spacingSize:c.spacingContentSize,showPollModal:c.postText.showPollModal,onStickerClick:c.postText.onStickerClick,postClickAnalytics:j,dataRoleLink:Z?.link})]}),Boolean(F.url)&&(0,n.FD)(n.FK,{children:[(Boolean(p.text)||Boolean(R.length))&&(0,n.Y)(St.K,{style:{width:0}}),(0,n.Y)(Qu,{url:F.url,label:F.label,onOpenAuthor:z,dataRoleOwner:Z?.owner})]})]})}),!!T?.length&&!B&&(0,n.FD)(n.FK,{children:[Boolean(p.text||F.url||R?.length)&&(0,n.Y)(St.K,{size:c.spacingContentSize,style:{width:0}}),(0,n.Y)(Ju,{attachments:T,typographyComponent:c.chipTypographyComponent,spacingSize:c.spacingContentSize,showPollModal:c.postText.showPollModal,postClickAnalytics:j,dataRoleLink:Z?.link})]}),o,M?.action_button&&!a&&(0,n.Y)(qu,{config:c.underMediaOrActionButton,type:"action_button",screen:W,id:p.id,ownerId:p.owner_id,item:M?.action_button,rawId:v,onOpenDonutLayer:L,uiConfig:r?.underMedia,noPaddings:!0}),te]})]}):null}}),d&&S<I&&(0,n.FD)(n.FK,{children:[le&&(0,n.Y)(St.K,{size:4}),(0,n.Y)(Vm,{config:r,nestingLevel:S+1,data:d,platformConfig:c,index:f.current.index,attachmentsExpanded:C,textAlwaysExpanded:k,getItemUiState:A,onOpenPost:f.current.onOpenPost,newsfeedType:f.current.newsfeedType,trackCode:U,dataRole:Z?.repost})]})]})}if(u&&"default"!==u)return(0,n.FD)("div",{children:[(0,n.Y)(Hm,{item:a,state:u,updateItemState:m,platformConfig:c,config:G}),(0,n.Y)("div",{})]});const he=f.current.adLegacyData?{"data-ad":f.current.adLegacyData.post.adData,"data-promopost-ad-selector":"1"}:{};return(0,n.FD)("div",{ref:ce,"data-post-track-code":U,"data-spa-post-legacy-selector":"1","data-testid":"post","data-post-id":v,"data-post-nesting-lvl":S,"data-role":X,...he,children:[!i&&!o&&f.current.config?.allowShowCoOwnerBanner&&(0,n.Y)(ei,{postItem:a,config:c.coOwnershipRequestBanner}),(0,n.Y)(s.i,{paddingTop:i?4:8,paddingBottom:i?0:8,mode:"vertical",spacing:8,children:(0,n.Y)(Rt,{titleId:(0,Zu._)(f.current.index),subtitleId:(0,em.y)(f.current.index),openPost:x,feedItem:a,isNested:i,config:c.postHeader,dataRoles:Z,uiConfig:r?.header,adLegacyData:f.current.adLegacyData,trackCode:U,contextMenu:(0,n.Y)(Mo,{data:a,refetchPost:_,updateItemState:m,platformConfig:c.postContextMenu,navigate:se,hasNoCoownershipDeclineInMenu:r?.hasNoCoownershipDeclineInMenu,hasNotificationsInMenu:r?.hasNotificationsInMenu,hasUnsubInMenuInCommentsFeed:r?.hasUnsubInMenuInCommentsFeed,disableNotInterestingInMenu:r?.disableNotInterestingInMenu,openOneTimeDonutInNewTab:r?.openOneTimeDonutInNewTab,ignoreSlavePost:r?.ignoreSlavePost})})}),(0,n.Y)("div",{"data-testid":"post-content-container",children:e}),Q&&f.current.postAuthorActions,!i&&!p.is_deleted&&!Q&&(0,n.FD)(n.FK,{children:[(0,n.Y)(s.i,{mode:"vertical",spacing:8,paddingTop:0,paddingBottom:0,children:(0,n.Y)(Nc,{openPost:x,openComments:f.current.onOpenComments,postItem:a,postDateBlockConfig:c.postDateBlock,donutBlockConfig:c.donutBlock,reactionsMenuConfig:c.reactionsMenu,footerConfig:c.footer,toggleReaction:g,navigate:se,focusCommentInputOnCommentIconClick:q,isDonutRestricted:O,onDonutRestrictedClick:re,showLikes:V,uiConfig:r?.footer,uiReactionsMenuConfig:r?.reactionsMenu,uiDonutBlockConfig:r?.donutBlock,uiDateConfig:r?.date,dataRole:Z?.noclick})}),t&&!!h&&!!p.id&&!!p.owner_id&&(0,n.Y)(Xa,{openPost:x,platformConfig:h,postId:p.id,ownerId:p.owner_id,showInlineNextButton:Boolean(p.comments?.count&&p.comments.count>1),mode:r?.commentsContainerMode??"compactInline",trackCode:a.value.track_code,screen:W,onOpenReactions:K,startCommentId:ne,startThreadId:oe})]})]})})));var Km=i(642532);const qm=(e,t)=>(i,n,o,s)=>{if((0,Pe.X)(i.nativeEvent))return;if((0,Ae.T)(i),t)return void window.open(`${yc(n)}${void 0!==o?`?reply=${o}`:""}${void 0!==s?`&thread=${s}`:""}`,"_blank");let{ownerId:r,id:a}=(0,h.v)(n.id);"reply"===n.value.post_type&&n.value.owner_id&&n.value.post_id&&(r=n.value.owner_id,a=n.value.post_id,o=n.value.id),e("postModal",{layerParams:{ownerId:r?.toString(),itemId:a?.toString(),replyId:void 0!==o?`r${o}`:void 0}})};var Gm=i(727341),Jm=i(402247),Qm=i(266249),Xm=i(280131),Zm=i(810921),eg=i(980333),tg=i(430327),ig=i(543584),ng=i(43979),og=i(618728),sg=i(134497),rg=i(989442),ag=i(74433),dg=i(940506),cg=i(508584),lg=i(457735),hg=i(625916),pg=i(836382),ug=i(952048),mg=i(597593);const gg=(0,o.P)((function(){const e=(0,Fe.B)(),{handleDestroy:t,actionText:i,selectedEntityId:o,handleConfirmSelection:s}=jt();return(0,n.FD)(n.FK,{children:[(0,n.Y)(J.$,{onClick:t,size:"m",mode:"secondary",children:e.getLang("global_cancel")},"cancel"),(0,n.Y)(J.$,{disabled:!o,onClick:s,size:"m",children:i},"action")]})}));var _g=i(663138),vg=i(234213),fg=i(33556),wg=i(557961),yg=i(689998),bg=i(40822),Cg=i(863363);const kg={textConfig:{cutThreshold:5,underCutThreshold:3,fullPostThreshold:1/0},label:"wall_obscene_box_aria_label",tooltipText:"wall_obscene_box_alert_tooltip_hint",textTypographyComponent:q.LE,mentionOver:e=>(0,bg.tp)(e.target),showPollModal:yg.showPollModal,onStickerClick:e=>{(0,Cg.J)({sticker_id:e})}},Ig=({type:e,source_id:t,date:i})=>{switch(e){case"photo":return`feed1_${t}_${i}`;case"photo_tag":return`feed3_${t}_${i}`;case"wall_photo":return`feed16_${t}_${i}`}};var Sg=i(142184);const Ag=({id:e,owner_id:t,type:i,source_id:n,date:o,sizes:s},r)=>{(0,fg.c)(`${t}_${e}`,Ig({type:i,date:o,source_id:n}),{queue:1,commentFocusInit:Boolean(r),temp:s?(0,wg.H)({sizes:s,filter:["x","y","z","w"]}):void 0})},Pg={postText:kg,maxImageWidth:510,maxImageHeight:824,maxContainerWidth:510,showPhoto:e=>{Ag(e)},openComment:e=>{Ag(e,!0)},share:({id:e,owner_id:t,type:i,source_id:n,date:o})=>{const s=(0,jo.WO)({id:e,ownerId:t});(0,Sg.A)("photo",s,{list:Ig({type:i,date:o,source_id:n})})},obsceneTextAlertBox:{ModalComponent:mg.z,ModalCardComponent:Tu.x,dismissButtonMode:"outside"},overlayData:{showButtons:!0,showFriendLikes:!0}};var Lg=i(724182),Og=i(995157),Eg=i(781396),xg=i(137363),Yg=i(601869),Mg=i(917716),Tg=i(870541);const Rg=(0,o.P)((function({model:e}){const{episode:t,extraLines:i}=e,{actions:o,legalNoticeLines:r}=t,{playback:a}=t,d=function(e){const{playback:t}=e;if(t.isPlaying)return"plays";if(t.isPaused)return"paused";return"idle"}(t),c=Dg(o.togglePlaying,!0),l=Dg(o.openPodcast);return(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:16,children:(0,n.Y)(s.i,{mode:"vertical",paddingTop:0,paddingBottom:0,spacing:4,children:(0,n.Y)(j.SB4,{label:o.openLayer?.title,onClick:o.openLayer?.onExecute,"data-testid":"PodcastEpisodeAttachment_Action_OpenLayer",children:(0,n.Y)(Lg.O,{backgroundMode:"blurred",cover:t.cover?.pickByWidth(150)?.src??"",actions:(0,n.Y)(Og.b,{progress:a.progress??0,duration:t.data.duration,minWidth:119,appearance:"overlay",state:d,loading:o.togglePlaying.isPending,disabled:o.togglePlaying.isDisabled,label:o.togglePlaying.title,onClick:c,"data-testid":"PodcastEpisodeAttachment_Action_TogglePlaying",children:o.togglePlaying.title}),after:(0,n.Y)(Mg.M,{size:"m",activeMode:"background",hoverMode:"background",noPadding:!0,action:o.share,icon:(0,n.Y)(Tg._,{colorMode:"contrast",action:o.share,size:16}),onClick:Bg(!0)}),"data-testid":"PodcastEpisodeAttachment",children:(0,n.Y)(Eg.O,{extra:(0,n.Y)(ln.r,{separator:(0,n.Y)(is.O,{}),children:i}),owner:(0,n.Y)(xg.O,{mode:"contrast",src:t.cover?.pickByWidth(16)?.src,href:o.openPodcast.href??void 0,target:o.openPodcast.target,label:o.openPodcast.title,onClick:l,"data-testid":"PodcastEpisodeAttachment_Author",children:t.author.title}),children:(0,n.Y)(Yg.R,{lines:3,appearance:"contrast",noticeIcon:!!r?.length&&(0,n.Y)(Kl.X,{lines:r}),"data-testid":"PodcastEpisodeAttachment_Title",children:t.data.title})})})})})})}));function Dg(e,t){const i=Bg(t);return t=>{i(t),e.onExecute?.()}}function Bg(e){return t=>{t.stopPropagation(),e&&t.preventDefault()}}var Fg=i(774505),Ng=i(640171),zg=i(350333),jg=i(875730),Ug=i(299761),Wg=i(896749),$g=i(986529);const Hg=(0,o.P)((function({actions:e,makeActionClickHandler:t}){if(e.length<1)return null;const i=e.length<=1,o=i?133:72;return(0,n.Y)(n.FK,{children:e.map((e=>(0,n.Y)($g.B,{minWidth:o,stretched:!0,action:e,icon:(0,n.Y)(Ug.$,{action:e,size:24}),mode:"primary",appearance:"overlay",hintAppearance:"neutral",hasTitle:i,onClick:t?.(e)??void 0,"data-testid":`PrimaryAttachment_MusicPlaylist_Action_${e.type}`},e.key)))})}));function Vg(e){if(e.length<1)return null;const t=function(e){if(e.length<=4)return e;return e.slice(0,4)}(e);return function(e){const t=Math.max(Math.floor(e.length/2),1);return{main:e.slice(0,t),additional:e.slice(t,4)}}(t)}const Kg=(0,o.P)((function({actions:e,makeActionClickHandler:t}){const i=Vg(e);if(!i)return null;const o=e.length>1;return(0,n.FD)(Bt.e,{stretched:o,gap:"s",children:[(0,n.Y)(Hg,{actions:i.main,makeActionClickHandler:t}),(0,n.Y)(Hg,{actions:i.additional,makeActionClickHandler:t})]})}));var qg=i(794135),Gg=i(918606);const Jg=(0,o.P)((function({model:e,dataRole:t}){const{playlist:i,tracks:o,isNotComplete:r,expandLabel:a}=e,d=i.actions.open;return(0,n.FD)(s.i,{mode:"vertical",spacing:0,paddingTop:8,paddingBottom:12,children:[(0,n.Y)(It.f,{spacing:8,"data-testid":"PrimaryAttachment_MusicPlaylist_Tracks","data-role":t,children:o.map((e=>(0,n.Y)(Gg.z,{size:"m",track:e,"data-testid":"PrimaryAttachment_MusicPlaylist_MusicTrackRow"},e.identity.fullId)))}),r&&(0,n.Y)(s.i,{mode:"vertical",spacing:16,paddingTop:4,paddingBottom:0,children:(0,n.Y)(qg.D,{centered:!0,onClick:d.onExecute,label:a,"data-testid":"PrimaryAttachment_MusicPlaylist_Tracks_Action_Expand",children:(0,n.Y)(q.LE,{weight:"2",className:(0,G.I)("color_text_accent_themed"),children:a})})})]})}));var Qg=i(398001);const Xg=(0,o.P)((function(){const e=(0,Fe.B)().getLang("audio_music_playlist_tracks_empty_placeholder_message");return(0,n.Y)(K.s,{align:"center",children:(0,n.Y)(U.O,{icon:(0,n.Y)(Qg.S,{className:(0,G.I)("color_icon_tertiary")}),children:e})})})),Zg=(0,o.P)((function({model:e}){const{playlist:t,previewTracks:i,actions:o,extraLines:s,dataRole:r}=e,{authors:a,cover:d,curatorLabel:c,legalNoticeLines:l}=t,{isExclusive:h}=t.data,p=t.actions.open,u=t.actions.share,m=i_();return(0,n.FD)(kt.Y,{mode:"card",separator:"hide",padding:"none",children:[(0,n.FD)(j.SB4,{label:p.title,onClick:p.onExecute,"data-testid":"PrimaryAttachment_MusicPlaylist_Action_OpenLayer","data-role":r,children:[(0,n.Y)(Ng.j,{mode:"centered",cover:d?.pickByWidth(156)?.src??"",color:d?.mainColor??void 0,actions:(0,n.Y)(Kg,{actions:o,makeActionClickHandler:t_}),after:!!u&&(0,n.Y)(Mg.M,{size:"m",activeMode:"background",hoverMode:"background",noPadding:!0,action:u,icon:(0,n.Y)(Ug.$,{colorMode:"contrast",size:16,action:u}),onClick:t_(u)}),coverLabel:c??void 0,CoverFallbackIcon:jg.b,noBottomRounded:!0,"data-testid":"PrimaryAttachment_MusicPlaylist_Header",children:(0,n.Y)(zg.Q,{title:(0,n.Y)(Yg.R,{lines:3,appearance:"contrast",noticeIcon:!!l?.length&&(0,n.Y)(Kl.X,{lines:l}),label:p.title,onClick:e_(p),"data-testid":"PrimaryAttachment_MusicPlaylist_Title",children:t.data.title}),subtitle:(0,n.Y)(ln.r,{separator:(0,n.Y)(is.O,{}),children:s}),exclusive:h,author:a&&(0,n.Y)(xg.O,{mode:"contrast",src:a.single?.avatar?.pickByWidth(16)?.src,href:a.single?.href??void 0,"data-testid":"PrimaryAttachment_MusicPlaylist_Authors",onClick:m,children:(0,n.Y)(Wg.l,{model:a,mode:"contrast",onClick:m,"data-testid":"PrimaryAttachment_MusicPlaylist_AuthorsLink"})})})}),t.isEmpty&&(0,n.Y)(Xg,{})]}),!!i&&(0,n.Y)(Jg,{model:i,dataRole:r})]})}));function e_(e){const t=t_(e);return i=>{t(i),e.onExecute?.()}}function t_(e){return i_(!e.href)}function i_(e){return t=>{t.stopPropagation(),e&&t.preventDefault()}}var n_=i(579400),o_=i(734785),s_=i(439384),r_=i(150949),a_=i(936655),d_=i(162774),c_=i(623422),l_=i(989391);const h_={add:(...e)=>{dg.default.addGif(...e)},show:(...e)=>{dg.default.showGif(...e)},share:(...e)=>{dg.default.shareGif(...e)}},p_=async e=>{const{data:t}=await(0,hg.initOneTimeDonut)(e,!1);return t},u_={postText:kg,coOwnershipRequestBanner:{ActionsComponent:gg,ModalComponent:mg.z},postHeader:{...l_.y,bestFriendTooltipOnClickActionButton:e=>{(0,ug.n)({ownerId:String(e),initData:{owner_id:e,best_friends_only:!0},isEdit:!1,modalDefaultOpened:!0,postingTimelineStartTimeMs:1e3*Date.now()})},handleIconStatusClick:(e,t)=>{(0,_g.iB)(t.nativeEvent,{user_id:e})},ModalComponent:mg.z,ModalCardComponent:Tu.x,dismissButtonMode:"outside",handleOpenGeoFeed:e=>{(0,lg.u)({w:`place${e}`})},actionIconMode:"tooltip",isCanUseDrum:!1,userGroupModalAvatarSize:40,onClickPromote:e=>{(0,lg.u)({w:`ads_easy_promote${e}`})},getAdCreateLink:e=>`/adscreate?post_id=${e}&last=1&utm_source=vk_post_header_promote`,getAlreadyPostPromotingLink:e=>`/ads?act=office&union_id=${e}`,openStories:s_.Y,compact:!1,darkThemeFadeColor:[34,34,34],lightThemeFadeColor:[255,255,255]},obsceneTextAlertBox:{ModalComponent:mg.z,ModalCardComponent:Tu.x,dismissButtonMode:"outside",width:450},openBlockSettings:async(e,t)=>{(await Promise.all([i.e(69171),i.e(94285),i.e(29977),i.e("langs/core_spa/WallModuleOpenBlockSettings")]).then(i.bind(i,94285))).default.blockEx(e,t)},postContextMenu:{ModalComponent:mg.z,actionConfirmationModalType:"modal",showStats:e=>(0,lg.u)({w:`posts_reach_wall${e}`},!1),openOneTimeDonutModal:p_,openReportForm:(...e)=>(0,r_.R)("post",...e),editPost:({postRaw:e,ownerId:t,refetchPost:i,creationEntryPoint:n})=>{(0,ug.n)({postRaw:e,ownerId:String(t),isEdit:!0,modalDefaultOpened:!0,postingTimelineStartTimeMs:1e3*Date.now(),creationEntryPoint:n,afterEditSuccess:()=>(i?.(),Promise.resolve())})},getRepostUrl:({id:e,ownerId:t,type:i})=>"video"===i||"clip"===i?`/${i}${t}_${e}`:`/wall${t}_${e}`},likes:{showLikes:({rawId:e,itemType:t="wall",likesType:i="likes",reopenPostLayer:n})=>{n&&window.layerQueue?._layers.push(["wiki",`${t}${e}`]),(0,lg.u)({w:`${i}/${t}${e}`},!1,!1,{queue:1})}},postDateBlock:{showAdminInfo:!0},reactionsMenu:{compact:!1,openOneTimeDonutModal:p_},donutBlock:{showBlock:!0,openOneTimeDonutModal:p_,showDonuts:({owner_id:e,id:t,type:i,donut_miniapp_url:n,openMiniAppInNewTab:o,handleSuccessfulPostDonut:s})=>(0,vg.U)({objectId:{ownerId:e,id:t,type:i},eventRef:"post_btn",donutMiniappUrl:n,openMiniAppInNewTab:o,handleSuccessfulPostDonut:s})},underMediaOrActionButton:{navigate:(e,t,i)=>{e&&(t||window.nav.go(e),(i||t)&&window.open(e,"_blank","noopener,noreferrer"))},showWiki:lg.u,showOneTimeDonutLayer:e=>{(0,hg.initOneTimeDonut)(e,!1)}},footer:{share:Sg.A},postAttachments:{ModalComponent:mg.z,ModalCardComponent:Tu.x,onRestrictedAudio:eg.H,onMediaAttachmentMode:"clamped",onOpenAttachmentAudioListModal:rg.K,getAudioPlayerAdapter:a_.f,attachPlayerEventHandler:cg.fV,loadAudioPlayer:d_.e,constructProductLink:o_.d},secondaryAttachmentList:c_.I,carousel:{onCarouselSlideChange:(e,t)=>{(0,Xm.p4)(t,e),setTimeout((()=>{window.dispatchEvent(new CustomEvent("scroll"))}),250)},subscribeOnCarouselModalClose:og.Ih,attachmentSharedLegacyState:n_.T},mediaGrid:{maxImageWidth:550,maxImageHeight:824,maxContainerWidth:550,getAction:Gm.a,onRestrictedPhoto:Zm.w,getBackdropBlur:Fg.CE},primaryAttachmentPoll:{share:({object:e})=>(0,Sg.A)("",e),onGetCode:ig.z,onPollReport:ig.m_,onShowPollStats:ig.gu,ModalComponent:mg.z},primaryAttachment:{getBackdropBlur:Fg.CE,onMediaAttachmentMode:"clamped",getAction:Gm.a,destroyInlineVideoPlayer:e=>{e&&(0,Jm.D)(e)},forceAutoplay:()=>{window.cur.videoAutoplayScrollHandler&&window.cur.videoAutoplayScrollHandler()},pauseInlineVideoPlayer:Qm.j,onRestrictedPhoto:Zm.w,onRestrictedAudio:eg.H,maxImageWidth:550,maxImageHeight:824,maxContainerWidth:550,ModalComponent:mg.z,onArticleHover:tg.h,onClipClick:ng.w,restrictions:(0,sg.Z)(ag.Zk),gifActions:h_,onOpenAttachmentAudioListModal:rg.K,prettyCardImageSize:(0,pg.Q)()?400:200,MusicPlaylistLayout:Zg,PodcastEpisodeLayout:Rg,onStickerClick:e=>{(0,Cg.J)({sticker_id:e})}},metaPost:Pg,donutRestriction:{maxImageWidth:550,maxImageHeight:824,maxContainerWidth:550,paddingTop:4},videoClip:{getOverlayUrl:(e,t)=>`${location.href}&z=${e}${t}`},spacingBetweenPrimaryAndTextBlock:8,spacingContentSize:8,paddingContentTop:4,paddingContentBottom:4,paddingContentSpacing:20};var m_=i(857431);class g_{get isFeedPostReactionsModalEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_post_reactions_modal")}constructor(e,t,i){this.props=e,this.webLayers=t,this.userEnv=i,this.handleOpenLayer=(...e)=>{this.webLayers.open(...e)},this.handleOpenDonutPaymentLayer=e=>{this.webLayers.open("donutPaymentModal",{...e,layerQuery:{...e.layerQuery,isCloseForwardPush:"false"}})},this.handleOpenReactionsLayer=e=>{e&&this.webLayers.open("reactionsModal",e)},(0,c.l_)(this)}}g_=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===m_.h?Object:m_.h,void 0===L.J?Object:L.J])],g_);const{Provider:__,useModel:v_}=(0,a.Qd)(g_,{initInEffect:!1}),f_=(0,a.jn)(__,(0,o.P)((function(){const{props:e,handleOpenLayer:t,handleOpenDonutPaymentLayer:i,handleOpenReactionsLayer:o,isFeedPostReactionsModalEnabled:s}=v_(),{item:r,commentsPlatformConfig:a={},...d}=e.current,c=(0,H.useMemo)((()=>({...Km.n,...a})),[a]);return(0,n.Y)(Vm,{...d,data:r,onOpenPost:(...i)=>{qm(t,Boolean(e.current.config?.disallowOpenFeedItemModal))(...i)},handleOpenDonutPaymentLayer:i,onOpenReactions:s?o:void 0,platformConfig:u_,commentsPlatformConfig:c})})));class w_{get metaPost(){return this.props.current.data}get userId(){return this.authService.userId}get isMetaPostMenuEnabled(){return this.props.current.isMetaPostMenuEnabled}get platformConfig(){return this.props.current.platformConfig}get postState(){return this.metaPost.postState}get photos(){return"photo_tag"===this.props.current.data.type?this.props.current.data.value.photo_tags?.items??[]:this.props.current.data.value.photos?.items??[]}get attachmentsData(){return this.photos.map((e=>{const{orig_photo:t={},likes:i,comments:n}=e,{width:o,height:s,url:r}=t,a=0===i?.count?void 0:i?.count,d=Boolean(i?.user_likes),c=i?.friend_ids?.length??0;let l,h="";if(i?.friend_ids?.length){const e=i.friend_ids[0];l=Array.from(this.ownerService.getCachedUsers([e]).values())[0],l&&(h=(0,qr.k)(l)??"")}if(o&&s&&r)return{photo:e,width:o,height:s,url:r,likesCount:a,commentsCount:0===n?.count?void 0:n?.count,liked:d,friendsLikesCount:c,friendWhoLike:l,friendWhoLikePhoto:h};this.errorLogger.log(new Error(`missing one of fields: "width","height","url" in "orig_photo" for attachment in feed_id:${this.props.current.data.id}`))})).filter((e=>void 0!==e))}get ratio(){const e=this.attachmentsData[0];return e&&e.height&&e.width?(0,dh.P)(e.width,e.height,e.width/e.height):pl.w.SQUARE}get rawId(){return this.props.current.data.id}get config(){return this.props.current.config}get index(){return this.props.current.index}get carouselConfig(){return this.props.current.carouselConfig}get carouselSlideIndex(){return this.itemUiState.carouselSlideIndex}get setCarouselSlideIndex(){return this.itemUiState.setCarouselSlideIndex}get postHeaderConfig(){return this.props.current.postHeaderConfig}get postContextMenuConfig(){return this.props.current.postContextMenuConfig}get textAlwaysExpanded(){return this.props.current.textAlwaysExpanded??!1}get text(){if(1===this.photos.length)return this.photos[0]?.text}get features(){return vl()}get currentPhoto(){return this.photos[this.carouselSlideIndex]}get currentPhotoId(){if(this.currentPhoto)return(0,jo.X4)({id:this.currentPhoto.id,ownerId:this.currentPhoto.owner_id})}get itemUiState(){return this.props.current.getItemUiState(this.metaPost)}constructor(e,t,i,n,o,s,r,a,d,l,h){this.props=e,this.userEnv=t,this.feedLikesService=i,this.errorLogger=n,this.feedErrorService=o,this.authService=s,this.postHandlers=r,this.ownerService=a,this.feedEntitiesMutationService=d,this.viewHandlers=l,this.feedPostViewStatsStore=h,this.updatePostState=e=>{this.feedEntitiesMutationService.mutateFeedItemState(this.rawId,e)},this.toggleLikePhoto=e=>{this.feedLikesService.toggleMetaPostPhotoLikes(this.rawId,e,this.metaPost.value.track_code)},this.getBackgroundType=(e=j.zM2.LIGHT)=>this.userEnv.partConfigEnabled("photos_ears_enabled")?e===j.zM2.DARK?"black_fields":"white_fields":this.userEnv.partConfigEnabled("single_photo_background_blur_enabled")?"blur":this.platformConfig.primaryAttachment.getBackdropBlur(),this.makeAttachmentProps=e=>{const{id:t,owner_id:i,sizes:n}=e.photo,{date:o,source_id:s}=this.metaPost.value,{type:r}=this.metaPost;return{features:this.features,loading:"lazy",ratio:this.ratio,maxImageWidth:this.config.maxImageWidth,maxImageHeight:this.config.maxImageHeight,maxContainerWidth:this.config.maxContainerWidth,showOverlayButtons:Boolean(this.config.overlayData?.showButtons),showFriendLikes:Boolean(this.config.overlayData?.showFriendLikes),toggleLike:()=>{this.toggleLikePhoto(e.photo)},action:{onClick:e=>{e.ctrlKey||e.metaKey||this.feedErrorService.canProceedOnClick()&&(this.config.showPhoto({id:t,owner_id:i,date:o,source_id:s,type:r,sizes:n}),this.postHandlers.click.onPhotoOpen({feedItemId:this.rawId,photoRawId:this.currentPhotoId,contentType:"photo_carousel",createdTimestamp:this.metaPost.value.date}))}},openComment:()=>{this.feedErrorService.canProceedOnClick()&&(this.config.openComment({id:t,owner_id:i,date:o,source_id:s,type:r,sizes:n}),this.postHandlers.click.onCommentButtonClick({feedItemId:this.rawId,photoRawId:this.currentPhotoId,contentType:"photo_carousel",createdTimestamp:this.metaPost.value.date}))},share:()=>{this.feedErrorService.canProceedOnClick()&&(this.config.share({id:t,owner_id:i,date:o,source_id:s,type:r}),this.postHandlers.click.onSharingButtonClick({feedItemId:this.rawId,photoRawId:this.currentPhotoId,contentType:"photo_carousel",createdTimestamp:this.metaPost.value.date}))},...e}},this.onStartView=(e,t)=>{if(t.observerName===S.U.t35){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.props.current.data.type};this.viewHandlers.onStartViewPost(i)}},this.onEndView=(e,t)=>{if(t.observerName===S.U.t35){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.props.current.data.type},{width:n,height:o}=this.props.current.getItemUiState(this.metaPost).size;this.viewHandlers.onEndViewPost({index:this.props.current.index,itemId:this.rawId,width:n,height:o,startTime:e.startTime,endTime:e.endTime,screen:e.screen},i),this.feedEntitiesMutationService.incrementFeedItemViewsCount(this.rawId)}},(0,c.l_)(this)}}w_=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===L.J?Object:L.J,void 0===C?Object:C,void 0===_.v?Object:_.v,void 0===w.m?Object:w.m,void 0===Ce.u?Object:Ce.u,void 0===T.i?Object:T.i,void 0===I.v?Object:I.v,void 0===f.K?Object:f.K,void 0===P.S?Object:P.S,void 0===A.S?Object:A.S])],w_);const{Provider:y_,useModel:b_}=(0,a.Qd)(w_,{initInEffect:!1});var C_=i(989671);const k_=(0,o.P)((function({likesCount:e,commentsCount:t,liked:i,toggleLike:o,openComment:s,share:r}){const a=(0,Fe.B)();return(0,n.Y)(j.ZAh,{sizeY:"regular",children:(0,n.Y)(j.SvD,{value:"dark",children:(0,n.FD)(K.s,{direction:"row",gap:"s",noWrap:!0,children:[(0,n.Y)(K.s.Item,{flex:"fixed",children:(0,n.Y)(C_.T,{"data-testid":"meta_post_overlay_action_like","data-user-likes":i,"aria-label":i?a.getLang("global_dislike"):a.getLang("global_like"),onClick:e=>{e.stopPropagation(),o()},appearance:"neutral",mode:"secondary",direction:"row",IconRegular:i?()=>(0,n.Y)(Yd.F,{className:(0,G.I)("color_accent_red")}):()=>(0,n.Y)(xd.D,{className:(0,G.I)("color_icon_contrast")}),IconCompact:()=>null,children:!!e&&(0,n.Y)(q.LE,{weight:"2",className:i?(0,G.I)("color_accent_red"):(0,G.I)("color_text_contrast"),children:e})})}),(0,n.Y)(K.s.Item,{flex:"fixed",children:(0,n.Y)(C_.T,{"data-testid":"meta_post_overlay_action_comment","aria-label":a.getLang("global_comment"),onClick:e=>{e.stopPropagation(),s()},appearance:"neutral",mode:"secondary",direction:"row",IconRegular:()=>(0,n.Y)(Oc.J,{className:(0,G.I)("color_icon_contrast")}),IconCompact:()=>null,children:!!t&&(0,n.Y)(q.LE,{weight:"2",className:(0,G.I)("color_text_contrast"),children:t})})}),(0,n.Y)(K.s.Item,{flex:"fixed",children:(0,n.Y)(C_.T,{"data-testid":"meta_post_overlay_action_share","aria-label":a.getLang("global_share"),onClick:e=>{e.stopPropagation(),r()},appearance:"neutral",mode:"secondary",direction:"row",IconRegular:()=>(0,n.Y)(Ec.T,{className:(0,G.I)("color_icon_contrast")}),IconCompact:()=>null})})]})})})}));const I_=({friendsLikesCount:e,friend:t,getLang:i,langNumeric:n})=>{if(!e)return"";const o=function(e,t=16){let i=(e.first_name_dat||"").replace(/<[^>]+>/g,"");return i.length>t&&(i=i.substring(t-2)+".."),i}(t);return 1===e?i("mobile_wall_you_liked_with_x_friends").replace("{users}",o):(({count:e,lang:t,langNumeric:i})=>{if(e<=1e3)return i(e,t);let n=1;const o=e>1e6?"M":"K",s=e>1e6?1e6:1e3,r=e/s;r.toFixed(n).endsWith("0")&&(n=0);const a=(r.toFixed(n)+o).replace(".",","),d=Math.trunc(r)*s;return i(d,t).replace(d.toString(),a)})({count:e,lang:i("wall_activity_likes_friends",!0),langNumeric:n}).replace("{user_name}",o)},S_=(0,o.P)((function({width:e,height:t,url:i,likesCount:o,commentsCount:r,action:a,features:d,loading:c,ratio:l,maxImageWidth:h,maxImageHeight:p,maxContainerWidth:u,liked:m,toggleLike:g,openComment:_,share:v,friendsLikesCount:f,friendWhoLike:w,friendWhoLikePhoto:y,background:b,photo:C,showOverlayButtons:k,showFriendLikes:I}){const{getLang:S,numeric:A}=(0,Fe.B)(),P=(0,H.useRef)(null),L=(0,H.useRef)(null),O=(0,H.useRef)(null);(0,H.useLayoutEffect)((()=>{P.current&&L.current&&O.current&&(L.current.style.width=`${P.current.offsetWidth}px`,L.current.style.height=2*O.current.offsetHeight+"px")}));const E=I&&w&&f,x=E?I_({friendsLikesCount:f,friend:w,getLang:S,langNumeric:A}):"",Y=(0,tl.Y1)({type:"photo",photo:C});return(0,n.FD)(nh.y,{getRootRef:P,noBorderRadius:!0,noBoxShadow:!0,ratio:l,sizes:[{url:i,width:e,height:t}],action:a,background:b,features:d,maxImageAvailableRatio:pl.w.WIDER,photoOverlaySize:"big",loading:c,useMaskImage:il.T.safari,maxImageWidth:h,maxImageHeight:p,maxContainerWidth:u,restriction:Y,children:[Boolean(E)&&(0,n.FD)(n.FK,{children:[(0,n.Y)(Z.v.OverlayItem,{placement:"bottom-left",visibility:"always",children:(0,n.Y)(j.HfP,{mode:"overlay",to:"top",children:(0,n.Y)("div",{ref:L})})}),(0,n.Y)(Z.v.OverlayItem,{placement:"bottom-left",visibility:"always",padding:8,children:(0,n.Y)(s.i,{mode:"vertical",spacing:12,paddingTop:8,paddingBottom:8,getRootRef:O,children:(0,n.Y)(na.f,{photos:[y],className:(0,G.I)("color_text_contrast"),children:x})})})]}),k&&(0,n.Y)(Z.v.OverlayItem,{placement:"bottom-right",visibility:"on-hover",padding:10,children:(0,n.Y)(k_,{toggleLike:g,openComment:_,share:v,liked:m,likesCount:o,commentsCount:r})})]})})),A_=({carouselRef:e,metaPostRef:t})=>{const[i,n]=(0,H.useState)(null);return(0,H.useLayoutEffect)((()=>{if(t.current&&!i){const i=new ResizeObserver((t=>{t[0]?.contentRect?.height&&(n((()=>{const t=e.current?.getBoundingClientRect();return t?.height?Math.min(Math.trunc(.8*t.height),t.height-100):null})()),i.disconnect())}));return i.observe(t.current),()=>i.disconnect()}}),[t]),i||"fit"},P_=(0,o.P)((function({likesCount:e,commentsCount:t,liked:i,toggleLike:o,openComment:s,share:r}){const a=(0,Fe.B)();return(0,n.Y)(Ad,{spacingHorizontal:16,children:(0,n.FD)(Ad.Row,{gap:[16,8],spacingTop:4,spacingBottom:0,children:[(0,n.Y)(Ad.Action,{"aria-label":i?a.getLang("global_dislike"):a.getLang("global_like"),icon:i?(0,n.Y)(Yd.F,{className:(0,G.I)("color_accent_red")}):(0,n.Y)(xd.D,{}),onClick:e=>{(0,Ae.T)(e),o()},"data-testid":"post_footer_action_like",disableTooltipTriggerOnFocus:!0,children:e}),(0,n.Y)(Ad.Action,{"aria-label":a.numeric(t??0,a.getLang("mobile_wall_post_comments",!0)),description:a.getLang("wall_comment_tooltip_description"),icon:(0,n.Y)(Oc.J,{}),onClick:e=>{(0,Ae.T)(e),s()},"data-testid":"post_footer_action_comment",disableTooltipTriggerOnFocus:!0,children:t}),(0,n.Y)(Ad.Action,{"aria-label":a.getLang("mobile_like_publish_title"),description:a.getLang("wall_share_post"),icon:(0,n.Y)(Ec.T,{}),onClick:e=>{(0,Ae.T)(e),r()},"data-testid":"post_footer_action_share",disableTooltipTriggerOnFocus:!0})]})})})),L_=(0,o.P)((function(){const{attachmentsData:e,rawId:t,text:i,config:o,carouselConfig:r,postHeaderConfig:a,postContextMenuConfig:d,metaPost:c,makeAttachmentProps:l,carouselSlideIndex:h,setCarouselSlideIndex:p,currentPhotoId:u,isMetaPostMenuEnabled:m,postState:g,updatePostState:_,platformConfig:v,itemUiState:f,textAlwaysExpanded:w,getBackgroundType:y,index:b,props:C,onStartView:k,onEndView:I,feedPostViewStatsStore:S}=b_(),{navigate:A}=(0,Er.Z)(),P=y((0,sh.A)()),{setRef:L,postRef:O}=(0,zc.R)({item:c,observers:C.current.observers,index:C.current.index,onEndView:I,onStartView:k,getObserverItem:S.getObserverItem,setObserverItem:S.setObserverItem}),E=(0,H.useRef)(null),x=A_({metaPostRef:O,carouselRef:E});if(Pi(c.type)&&g&&"default"!==g)return(0,n.Y)($m,{item:c,state:g,updateItemState:_,platformConfig:v});if(!e.length)return null;if(1===e.length){const r=l(e[0]);return(0,n.FD)("div",{ref:L,"data-testid":"post","data-post-id":t,"data-pseudopost-type":"photo_carousel",children:[(0,n.Y)(s.i,{mode:"vertical",spacing:8,paddingTop:8,paddingBottom:16,children:(0,n.Y)(Rt,{titleId:(0,Zu._)(b),subtitleId:(0,em.y)(b),feedItem:c,config:a,contextMenu:m?(0,n.Y)(Mo,{data:c,platformConfig:d,navigate:A,updateItemState:_}):null})}),(0,n.Y)(S_,{...r,background:P}),i&&(0,n.Y)(s.i,{mode:"vertical",spacing:v.paddingContentSpacing,paddingTop:v.paddingContentTop,paddingBottom:v.paddingContentBottom,children:(0,n.Y)(hd,{...v.postText,text:i,id:(0,Xu.l)(b),rawId:t,obsceneTextAlertBox:o.obsceneTextAlertBox,alwaysExpanded:w,expanded:w?void 0:f.textExpanded,setExpanded:w?void 0:f.setTextExpanded})}),Boolean(o.showFooter)&&!i&&(0,n.Y)(St.K,{size:4}),Boolean(o.showFooter)&&(0,n.Y)(P_,{toggleLike:r.toggleLike,openComment:r.openComment,share:r.share,liked:r.liked,likesCount:r.likesCount,commentsCount:r.commentsCount})]})}return(0,n.FD)("div",{ref:L,"data-testid":"post","data-post-id":t,"data-pseudopost-type":"photo_carousel",children:[(0,n.Y)(s.i,{mode:"vertical",spacing:8,paddingTop:8,paddingBottom:16,children:(0,n.Y)(Rt,{titleId:(0,Zu._)(b),subtitleId:(0,em.y)(b),feedItem:c,config:a,contextMenu:m?(0,n.Y)(Mo,{data:c,platformConfig:d,navigate:A,updateItemState:_}):null})}),(0,n.Y)(hu,{getRef:E,itemId:t,platformConfig:r,gap:.1,spacing:0,borderRadius:0,showCounter:!0,showArrows:!0,arrowAreaHeight:x,resizeSource:"element",currentSlideIndex:h,setCurrentSlideIndex:p,postType:c.type,currentPhotoId:u,postCreatedTimestamp:c.value.date,children:e.map((e=>(0,n.Y)(hl.F.Item,{noVerticalPadding:!0,children:(0,n.Y)(S_,{...l(e),background:P})},e.photo.id)))})]})})),O_=(0,a.jn)(y_,L_),E_=(0,o.P)((function({item:e,index:t,getItemUiState:i,isMetaPostMenuEnabled:o,observers:s}){return(0,n.Y)(O_,{data:e,index:t,config:Pg,postHeaderConfig:u_.postHeader,postContextMenuConfig:u_.postContextMenu,carouselConfig:u_.carousel,isMetaPostMenuEnabled:o,platformConfig:u_,getItemUiState:i,observers:s})}));var x_=i(891719),Y_=i(17158),M_=i(55660),T_=i(966417);const R_={loader:async()=>{const{FeedRecommendedGamesCarouselBlock:e}=await Promise.all([i.e(69036),i.e(18342),i.e("langs/core_spa/FeedRecommendedGamesCarouselBlock")]).then(i.bind(i,641051));return e},name:"FeedRecommendedGamesCarouselBlock",DefaultLoading:()=>(0,n.Y)(Y_._,{photoSize:"square"})},D_={loader:async()=>{const{FeedRecommendedGameBlock:e}=await Promise.all([i.e(69036),i.e(7369),i.e("langs/core_spa/FeedRecommendedGameBlock")]).then(i.bind(i,562225));return e},name:"FeedRecommendedGameBlock",DefaultLoading:M_.c},B_={loader:async()=>{const{FeedRecommendedGroups:e}=await Promise.all([i.e(69036),i.e(18620),i.e("langs/core_spa/FeedRecommendedGroups")]).then(i.bind(i,665078));return e},name:"FeedRecommendedGroups",DefaultLoading:()=>(0,n.Y)(Y_._,{photoSize:"square"})},F_={loader:async()=>{const{FeedRecommendedChannels:e}=await Promise.all([i.e(69036),i.e(8908),i.e("langs/core_spa/FeedRecommendedChannels")]).then(i.bind(i,849160));return e},name:"FeedRecommendedChannels",DefaultLoading:()=>(0,n.Y)(Y_._,{photoSize:"square"})},N_={loader:async()=>{const{FeedMarketRecommendationsBlock:e}=await Promise.all([i.e(69036),i.e(93628),i.e("langs/core_spa/FeedMarketRecommendationsBlock")]).then(i.bind(i,484056));return e},name:"FeedMarketRecommendationsBlock",DefaultLoading:()=>(0,n.Y)(Y_._,{photoSize:"portrait"})},z_={loader:async()=>{const{FeedMiniAppsCarouselBlock:e}=await Promise.all([i.e(69036),i.e(58067),i.e("langs/core_spa/FeedMiniAppsCarouselBlock")]).then(i.bind(i,988827));return e},name:"FeedMiniAppsCarouselBlock",DefaultLoading:()=>(0,n.Y)(Y_._,{photoSize:"square"})},j_={loader:async()=>{const{SpaFeedUsersRecomBlock:e}=await Promise.all([i.e(69036),i.e(61756),i.e("langs/core_spa/SpaFeedUsersRecomBlock")]).then(i.bind(i,880513));return e},name:"SpaFeedUsersRecomBlock",DefaultLoading:({title:e})=>(0,n.Y)(Y_._,{header:e,photoSize:T_.P})};var U_=i(759275),W_=i(217500),$_=i(344550),H_=i(35531);class V_{constructor(e,t,i){this.errorLogger=e,this.uiDegradationLogger=t,this.metadata=i,this.logLoadError=(e,t)=>{this.errorLogger.log("module loading failed",{error:e}),this.uiDegradationLogger.log({screen:this.metadata.get().screen,elementName:t})},this.logBoundaryError=(e,t)=>{this.errorLogger.log(`module ${t} crashed`,{error:e}),this.uiDegradationLogger.log({screen:this.metadata.get().screen,elementName:t})},e.setConfig({scope:"FeedWidgetErrorBoundary",percentage:100})}}V_=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===$_.X?Object:$_.X,void 0===H_.j?Object:H_.j,void 0===O.e?Object:O.e])],V_);const{Provider:K_,useModel:q_}=(0,a.Qd)(V_,{initInEffect:!1});function G_({loader:e,params:t,children:i}){const{logLoadError:n,logBoundaryError:o}=q_();return i((0,H.useMemo)((()=>e({...t,options:{...t.options??{},hasError:t.options?.hasError??!1,logError:e=>{n(e,t.name),t.options?.logError(e)},onDidCatch:e=>{o(e,t.name),t.options?.onDidCatch?.(e)}}})),[]))}const J_={DefaultLoadingError:()=>(0,n.Y)(n.FK,{})};function Q_(e,t=W_.f){const i={...J_,...e};function o(e){return(0,n.Y)(K_,{children:(0,n.Y)(G_,{loader:t,params:i,children:t=>(0,n.Y)(t,{...e})})})}return o.displayName=`lazyFeedModule(${e.name})`,o.preload=e.loader,o}const X_=Q_(R_,x_.F),Z_=Q_(D_,x_.F),ev=Q_(B_,x_.F),tv=Q_(F_,x_.F),iv=Q_(N_,x_.F),nv=Q_(z_,x_.F),ov=Q_(j_,x_.F),sv=Q_({loader:async()=>{const{FeedVideoRecommendationsBlock:e}=await Promise.all([i.e(49849),i.e(51384),i.e(69171),i.e(44499),i.e(22683),i.e(69036),i.e(26383),i.e("langs/core_spa/FeedVideoRecommendationsBlock")]).then(i.bind(i,118135));return e},name:"FeedVideoRecommendationsBlock",DefaultLoading:U_.M},x_.F),rv=e=>`/friends?act=find&from_ref=${e}`,av=e=>(0,n.Y)(ov,{...e,linkMore:rv});var dv=i(439044);class cv{async[a.Ts](){if(Boolean(this.playableItem?.no_autoplay))return;const e="video_autoplay",t=await this.accountInfoProvider.ensure({fields:[e]}),i=t?.settings?.find((t=>t.name===e));(0,c.h5)((()=>{this.autoplayEnabled=Boolean(i?.value)}))}get postItem(){return this.props.current.data}get postData(){return this.postItem.value}get platformConfig(){return this.props.current.platformConfig}get index(){return this.props.current.index}get itemUiState(){return this.props.current.getItemUiState(this.postItem)}get postState(){return this.postItem.postState}get playableItem(){return"video"===this.postData.type?this.postData.video?.items?.at(0):"clip"===this.postData.type?this.postData.clip?.items?.at(0):void 0}get videoRestriction(){if(!this.playableItem)return;const{restriction:e}=this.playableItem;if(!e)return;if(e&&0===e.disclaimer_type&&!e.icon_name)return;let t="blocked";return 1===e.blur?t="restricted":"delete_outline"===e.icon_name?t="deleted":"lock_outline"===e.icon_name&&(t="blocked"),{type:t,text:e.title,shortText:e.title,actionText:e.button?.title,canPlay:Boolean(e.can_play),canPreview:Boolean(e.can_preview)}}get videoAction(){if(!this.playableItem)return;return this.props.current.platformConfig.primaryAttachment.getAction()(this.postItem.id,"carousel")({attachment:{type:"video",video:{...this.playableItem,access_key:this.playableItem.access_key||this.postItem.id}}})}get clipCanPlay(){return!this.playableItem?.restriction||Boolean(this.playableItem.restriction?.can_play)}get rawId(){return(0,jo.WO)({id:this.playableItem?.id??0,ownerId:this.playableItem?.owner_id??0})}get videoRatio(){const e=16/9;return this.videoRestriction?.canPreview&&this.playableItem?.width&&this.playableItem?.height?this.playableItem?.width/this.playableItem?.height:e}get clipRatio(){return(0,Ah.n)({canPlay:this.clipCanPlay,width:this.playableItem?.width,height:this.playableItem?.height})}get videSizes(){return this.playableItem?.image||[]}get videoAttrs(){const{maxImageWidth:e,maxContainerWidth:t}=this.platformConfig.primaryAttachment;return{rawId:this.rawId,autoplay:this.autoplayEnabled,sizes:this.videSizes,ratio:this.videoRatio,action:this.videoAction,restriction:this.videoRestriction,maxImageWidth:e,maxContainerWidth:t}}get clipAttrs(){const{maxContainerWidth:e,onClipClick:t,pauseInlineVideoPlayer:i}=this.platformConfig.primaryAttachment;return{rawId:this.rawId,canPlay:this.clipCanPlay,ratio:this.clipRatio,mode:(0,Ph.f)(),maxContainerWidth:e,onClipClick:t,pauseInlineVideoPlayer:i}}constructor(e,t,i,n,o,s,r,a,d){this.props=e,this.accountInfoProvider=t,this.userEnv=i,this.feedLikesService=n,this.viewHandlers=o,this.feedEntitiesMutationService=s,this.feedPostViewStatsStore=r,this.metaData=a,this.feedPostModal=d,this.autoplayEnabled=!1,this.updatePostState=e=>{this.feedEntitiesMutationService.mutateFeedItemState(this.rawId,e)},this.toggleReaction=async({reactionId:e})=>{await this.feedLikesService.toggleFeedItemReaction("video",this.postItem,e,(0,p.q)(this.metaData.get().screen,this.feedPostModal.isModalOpened))},this.showLikes=({rawId:e,itemType:t,...i})=>{if(this.userEnv.partConfigEnabled("frontend.feed_post_reactions_modal")){const t=(0,h.v)(e),i=u(this.postItem);this.props.current.onOpenReactions?.({layerParams:{ownerId:t.ownerId.toString(),itemId:t.id.toString()},layerQuery:{type:i||null}})}else this.platformConfig.likes?.showLikes?.({rawId:e,itemType:t,...i})},this.onStartView=(e,t)=>{if(t.observerName===S.U.t35){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.postData.type};this.viewHandlers.onStartViewPost(i)}},this.onEndView=(e,t)=>{if(t.observerName===S.U.t35){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.postData.type},{width:n,height:o}=this.props.current.getItemUiState(this.postItem).size;this.viewHandlers.onEndViewPost({index:this.props.current.index,itemId:this.rawId,width:n,height:o,startTime:e.startTime,endTime:e.endTime,screen:e.screen,itemType:this.postData.type},i),this.feedEntitiesMutationService.incrementFeedItemViewsCount(this.rawId)}},(0,c.l_)(this)}}cv=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===ml.m?Object:ml.m,void 0===L.J?Object:L.J,void 0===C?Object:C,void 0===P.S?Object:P.S,void 0===f.K?Object:f.K,void 0===A.S?Object:A.S,void 0===O.e?Object:O.e,void 0===D.y?Object:D.y])],cv);const{Provider:lv,useModel:hv}=(0,a.Qd)(cv,{initInEffect:!1});class pv{get playableItem(){return"video"===this.postData.type?this.postData.video?.items?.at(0):"clip"===this.postData.type?this.postData.clip?.items?.at(0):void 0}get reactionsMenuConfig(){return this.props.current.reactionsMenuConfig}get focusCommentInputOnCommentIconClick(){return Boolean(this.props.current.focusCommentInputOnCommentIconClick)}get openPost(){return this.props.current.openPost}get postItem(){return this.props.current.postItem}get postData(){return this.postItem.value}get rawId(){return this.postItem.id}get likes(){return this.postData.likes}get postDateBlockConfig(){return this.props.current.postDateBlockConfig}get uiConfig(){return this.props.current.uiConfig}get toggleReaction(){return this.props.current.toggleReaction}get commentsCount(){return this.playableItem?.comments}get repostsCount(){return this.playableItem?.reposts?.count}get commentsCountText(){return this.commentsCount?this.uiConfig?.showNonFormattedCounters?this.commentsCount.toLocaleString(this.langs.locale):(0,ud.B)(this.commentsCount):null}get repostsCountText(){return this.repostsCount?this.uiConfig?.showNonFormattedCounters?this.repostsCount.toLocaleString(this.langs.locale):(0,ud.B)(this.repostsCount):null}get showCommentsIcon(){return Boolean(!this.uiConfig?.hideCommentIcon&&this.playableItem?.can_comment)}get showRepostIcon(){return Boolean(this.playableItem?.can_repost)}get showLikes(){return this.props.current.showLikes}constructor(e,t,i,n,o,s){this.props=e,this.feedLikesService=t,this.feedServiceAggregator=i,this.postHandlers=n,this.errorLogger=o,this.langs=s,this.likesListRequestState=new oi.X(this.feedLikesService.ensureFeedItemLikesList.bind(this),this.errorLogger),this.handleClickOnCommentIcon=e=>{this.openPost(e)},this.sharePost=()=>(this.postHandlers.click.onOpenSharingModal({feedItemId:this.postItem.id}),this.props.current.footerConfig.share("video",this.rawId)),(0,c.l_)(this)}}pv=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===C?Object:C,void 0===pd.f?Object:pd.f,void 0===T.i?Object:T.i,void 0===_.v?Object:_.v,void 0===E.Y?Object:E.Y])],pv);const{Provider:uv,useModel:mv}=(0,a.Qd)(pv,{initInEffect:!1}),gv=(0,o.P)((()=>{const{postItem:e,postDateBlockConfig:t,handleClickOnCommentIcon:i,openPost:o,toggleReaction:s,commentsCount:r,repostsCount:a,commentsCountText:d,repostsCountText:c,langs:l,sharePost:h,reactionsMenuConfig:p,uiConfig:u,showCommentsIcon:m,showRepostIcon:g,likesListRequestState:_,showLikes:v}=mv();return(0,n.Y)(Ad,{children:(0,n.FD)(Ad.Row,{gap:[16,8],after:(0,n.Y)(Lc,{openPost:o,postItem:e,config:t}),children:[(0,n.Y)(fc,{postItem:e,toggleReaction:s,showLikes:v,reactionsMenuConfig:p,showReactionTitleInCounter:u?.showReactionTitleInCounter,likesListRequestState:_}),m&&(0,n.Y)(Ad.Action,{"aria-label":l.numeric(r??0,l.getLang("mobile_wall_post_comments",!0)),description:l.getLang("wall_comment_tooltip_description"),icon:(0,n.Y)(Oc.J,{}),onClick:i,disableTooltipTriggerOnFocus:!0,children:d}),g&&(0,n.Y)(Ad.Action,{"aria-label":`${a??0} ${l.getLang("mobile_like_publish_title")}`,description:l.getLang("wall_share_post"),icon:(0,n.Y)(Ec.T,{}),onClick:h,disableTooltipTriggerOnFocus:!0,children:c})]})})})),_v=(0,a.jn)(uv,gv),vv=(0,a.jn)(lv,(0,o.P)((()=>{const{rawId:e,postItem:t,postData:i,platformConfig:o,playableItem:r,index:a,toggleReaction:d,clipAttrs:c,videoAttrs:l,showLikes:h,props:p,onStartView:u,onEndView:m,itemUiState:g,feedPostViewStatsStore:_,postState:v,updatePostState:f}=hv(),w=(0,H.useRef)(null),y=(0,Sh.g)(),{navigate:b}=(0,Er.Z)(),C=(0,H.useMemo)((()=>{if(r)return(0,Dh.m9)({video:r,type:"video"},{isAutoplayEnabled:Boolean(l.autoplay)},l.ratio)}),[r,l]),{setRef:k}=(0,zc.R)({item:t,observers:p.current.observers,index:p.current.index,onEndView:m,onStartView:u,getObserverItem:_.getObserverItem,setObserverItem:_.setObserverItem});return r?v&&"default"!==v?(0,n.FD)("div",{children:[(0,n.Y)(Hm,{item:t,state:v,updateItemState:f,platformConfig:o}),(0,n.Y)("div",{})]}):(0,n.FD)("div",{ref:k,"data-testid":"post","data-post-id":t.id,children:[(0,n.Y)(s.i,{mode:"vertical",spacing:8,paddingTop:8,paddingBottom:16,children:(0,n.Y)(Rt,{titleId:(0,Zu._)(a),subtitleId:(0,em.y)(a),feedItem:t,config:o.postHeader,contextMenu:(0,n.Y)(Mo,{data:t,platformConfig:o.postContextMenu,navigate:b,updateItemState:f,shouldHideMenuForClipsAndVideos:p.current.config?.shouldHideMenuForClipsAndVideos})})}),(0,n.FD)("div",{"data-testid":"post-content-container",children:["video"===i.type&&(0,n.FD)(n.FK,{children:[(0,n.Y)(vh.P,{...C,noBorderRadius:!0,noBoxShadow:!0,ratio:l.ratio,sizes:l.sizes,action:l.action,getRootRef:w,overlay:(0,tl.ZT)(r),maxImageAvailableRatio:pl.w.WIDER,onRestrictedClick:l.action?.onClick,background:"black_fields",useMaskImage:il.T.safari,restriction:l.restriction,maxImageWidth:l.maxImageWidth,maxContainerWidth:l.maxContainerWidth}),(!l.restriction||l.restriction?.canPreview)&&(0,n.Y)(s.i,{paddingBottom:4,mode:"vertical",spacing:20,children:(0,n.Y)(it.N,{href:o.videoClip.getOverlayUrl(i.type,l.rawId,r),children:r.title})})]}),"clip"===i.type&&(0,n.FD)(n.FK,{children:[(0,n.Y)(kh.b,{videoRawId:c.rawId,postId:t.id,coverWidth:c.maxContainerWidth,ratio:c.ratio,headerHeight:y,onClick:e=>c.onClipClick(e,c.rawId,r,b),getPlayer:e=>(0,n.Y)(Ih.Q,{...e,borderRadius:"none"}),pauseVideoPlayer:c.pauseInlineVideoPlayer,mode:c.mode,feedTrackCode:t.value?.track_code}),c.canPlay&&(0,n.Y)(s.i,{paddingBottom:4,mode:"vertical",spacing:20,children:(0,n.Y)(hd,{...o.postText,hasAttachmentsBeforeText:!0,text:r.description,id:(0,Xu.l)(a),rawId:e,obsceneTextAlertBox:o.obsceneTextAlertBox,alwaysExpanded:!1,expanded:g.textExpanded,setExpanded:g.setTextExpanded})})]})]}),(0,n.Y)(s.i,{mode:"vertical",spacing:8,paddingTop:0,paddingBottom:0,children:(0,n.Y)(_v,{postItem:t,showLikes:h,postDateBlockConfig:o.postDateBlock,reactionsMenuConfig:o.reactionsMenu,footerConfig:o.footer,toggleReaction:d,navigate:b,donutBlockConfig:o.donutBlock,openPost:()=>b(o.videoClip.getOverlayUrl("video"===i.type?"video":"clip",l.rawId))})})]}):null})));class fv{constructor(e,t){this.props=e,this.webLayers=t,this.handleOpenReactionsLayer=e=>{e&&this.webLayers.open("reactionsModal",e)},(0,c.l_)(this)}}fv=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===m_.h?Object:m_.h])],fv);const{Provider:wv,useModel:yv}=(0,a.Qd)(fv,{initInEffect:!1}),bv={...u_,postText:{...kg,textConfig:{cutThreshold:1,underCutThreshold:0,fullPostThreshold:1/0}}},Cv=(0,o.P)((function(){const{props:e,handleOpenReactionsLayer:t}=yv(),{item:i,...o}=e.current;return(0,n.Y)(vv,{...o,data:i,platformConfig:bv,onOpenReactions:t})}));Cv.displayName="WebVideoClip";const kv=(0,Ac.N)(wv,Cv);var Iv=i(908222),Sv=i(225093),Av=i(82560),Pv=i(309910);class Lv{[a.Ts](){this.isLegacyAd&&!this.isLegacyOldCubSupportEnabled&&this.errorLogger.log("get legacy ads, but motion did not support it"),this.motionConfig&&this.motionService.addConfig(this.item.id,this.motionConfig)}[a.zr](){this.unsubscribeReaction()}get feedShowDebugLogsEnabled(){return this.userEnv.partConfigEnabled("feed_show_debug_logs")}get debugConsole(){return(0,Pv.R)((()=>this.feedShowDebugLogsEnabled))}get newsfeedType(){return this.mainFeedService.newsfeedType}get item(){return this.props.current.item}get data(){return this.item.value}get adState(){return this.item.adState}get adItem(){return this.data.ads[0]}get isLegacyOldCubSupportEnabled(){return(this.userEnv.partConfigEnabled("frontend.feed_spa_old_cub_support")||this.userEnv.partConfigEnabled("feed_spa_old_cub_support"))&&this.motionService.isLegacyCabSupported}get isMotionReadyAndValid(){return!this.motionService.isError&&this.motionService.isReady&&this.motionService.isValid(this.item.id)}get isLoading(){return!(this.isMotionReadyAndValid&&this.isLegacyAd&&!this.isLegacyOldCubSupportEnabled)&&(!this.bannerState||this.bannerState.isInit)}get isLegacyAd(){return"site"===this.adItem.type}get motionConfig(){return this.isLegacyAd&&this.isLegacyOldCubSupportEnabled?this.data:this.adItem.sdk_source}constructor(e,t,i,n,o,s,r,a){this.props=e,this.feedEntitiesMutationService=t,this.motionService=i,this.viewHandlers=n,this.mainFeedService=o,this.errorLogger=s,this.feedPostViewStatsStore=r,this.userEnv=a,this.bannerState=null,this.updateItemState=e=>{this.feedEntitiesMutationService.mutateFeedItemState(this.item.id,e)},this.attachMotionBanner=(e,t)=>{this.bannerState=this.motionService.attach({id:this.item.id,source:this.item.value.ad_source,type:this.adItem.type,adData:this.adItem.ad_data,target:e,refs:t})},this.onStartView=(e,t)=>{if(t.observerName===S.U.t50&&!this.item.viewsCount){const i={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.item.apiType};this.viewHandlers.onStartViewPost(i,{index:this.props.current.index,itemId:this.item.id})}},this.onEndView=(e,t)=>{if(t.observerName===S.U.t50&&!this.item.viewsCount){const{width:i,height:n}=this.props.current.getItemUiState(this.item).size,o={element:e.element,itemIntersectingData:t,viewTimePost:e,type:this.item.apiType};this.viewHandlers.onEndViewPostTrackEvents({index:this.props.current.index,itemId:this.item.id,width:i,height:n,startTime:e.startTime,endTime:e.endTime,screen:e.screen},o),this.feedEntitiesMutationService.incrementFeedItemViewsCount(this.item.id)}},this.errorLogger.setConfig({scope:"AdsModel"});const{scheduleAdsInvalidation:d,uniqueItemId:l}=this.props.current;this.unsubscribeReaction=(0,c.mJ)((()=>this.isMotionReadyAndValid),(()=>{d&&l&&d(l,(()=>{this.debugConsole.warn("Implement ads invalidation!")}))})),(0,c.l_)(this)}}Lv=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===f.K?Object:f.K,void 0===Av.O?Object:Av.O,void 0===P.S?Object:P.S,void 0===Sv.B?Object:Sv.B,void 0===$_.X?Object:$_.X,void 0===A.S?Object:A.S,void 0===L.J?Object:L.J])],Lv);const{Provider:Ov,useModel:Ev}=(0,a.Qd)(Lv,{initInEffect:!1});var xv=i(822551);const Yv=(0,fu.L)((({children:e,name:t,registerName:i,onRefReady:n})=>{const o=(0,H.useMemo)((()=>{if(void 0!==document.body){const e=document.createElement("div");return document.body.appendChild(e),e}return null}),[]);return(0,H.useLayoutEffect)((()=>{i(t),o&&n(t,o)}),[i,n]),o?(0,xv.createPortal)(e,o):null}),void 0,"MotionComponentView");var Mv=i(328738);const Tv=(0,o.P)((function({item:e,updateItemState:t,attachMotionBanner:i,isMotionReadyAndValid:o,isLoading:s,setObserverRef:r}){const a=(0,H.useRef)({}),d=(0,H.useRef)(new Set),c=(0,H.useRef)(new Set),l=(0,H.useRef)(!1),h=(0,bh.Z)(r),p=(0,H.useCallback)((e=>{d.current&&d.current.add(e)}),[]),u=(0,H.useCallback)(((e,t)=>{a.current[e]&&a.current[e]===t||(a.current={...a.current,[e]:t},c.current.add(e))}),[]);return(0,H.useLayoutEffect)((()=>{h.current&&!l.current&&o&&Array.from(d.current).every((e=>c.current.has(e)))&&(l.current=!0,i(h.current,a.current))}),[o]),(0,n.FD)(n.FK,{children:[(0,n.Y)(Yv,{name:"menu",registerName:p,onRefReady:u,children:(0,n.Y)(ie,{children:(0,n.Y)(Mo,{data:e,updateItemState:t})})}),s&&(0,n.Y)(Mv.K,{}),(0,n.Y)("div",{style:{display:s?"none":"block"},children:(0,n.Y)("div",{ref:h})})]})})),Rv=(0,o.P)((function(){const{item:e,updateItemState:t,isMotionReadyAndValid:i,isLoading:o,attachMotionBanner:s,onEndView:r,onStartView:a,props:d,feedPostViewStatsStore:c,adState:l}=Ev(),{observers:h,index:p}=d.current,{setRef:u}=(0,zc.R)({item:e,observers:h,index:p,onEndView:r,onStartView:a,getObserverItem:c.getObserverItem,setObserverItem:c.setObserverItem});return l&&"default"!==l?(0,n.Y)(Hm,{item:e,state:l,updateItemState:t}):(0,n.Y)(Tv,{item:e,attachMotionBanner:s,updateItemState:t,isMotionReadyAndValid:i,isLoading:o,setObserverRef:u})}));Rv.displayName="Ads";const Dv=(0,Ac.N)(Ov,Rv);class Bv{get config(){return{...this.props.current.config,footer:{...this.props.current.config?.footer,hideDateBlock:!0}}}get isFeedPostReactionsModalEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_post_reactions_modal")}constructor(e,t,i){this.props=e,this.webLayers=t,this.userEnv=i,this.handleOpenLayer=(...e)=>{this.webLayers.open(...e)},this.handleOpenReactionsLayer=e=>{e&&this.webLayers.open("reactionsModal",e)},(0,c.l_)(this)}}Bv=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===m_.h?Object:m_.h,void 0===L.J?Object:L.J])],Bv);const{Provider:Fv,useModel:Nv}=(0,a.Qd)(Bv,{initInEffect:!1});var zv=function(e){return e.Medical="medical",e.Supplements="supplements",e.Specialist="specialist",e.Credits="credits",e.Finance="finance",e}({});const jv={mediaGrid:"image",audioPlaylist:"image",podcast:"image",audio:"image",graffiti:"image",graffitiDoc:"image",gif:"image",gifPhotoDoc:"image",video:"image",clip:"image",prettyCards:"clickPrettyCard",album:"image",article:"image",poll:"image",sticker:"image",miniApp:"image",photo:"image",click:"click",noclick:"noclick",link:"click",title:"title",text:"description",avatar:"icon",ageRestrictions:"agerestrictions",subtitle:"label",domain:"domain",disclaimer:"disclaimer",appCategory:"appcategory",button:"ctabutton",image:"image",owner:"click",carouselCounter:"noclick",gallery:"noclick",repost:"noclick",restriction:"noclick",snippetAttachment:"image"};var Uv=i(821713);class Wv{watch(e){const t=this.motionService.watch(e);return t?this.appendWatcherFromPromise(e.id,t):t}async appendWatcherFromPromise(e,t){const i=await t;return this.motionWatchersState.addWatcher(e,i),i}constructor(e,t){this.motionService=e,this.motionWatchersState=t}}Wv=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===Av.O?Object:Av.O,void 0===Uv.f?Object:Uv.f])],Wv);class $v{get postItem(){return this.adaptedPost}get adItem(){return this.props.current.item}get ads(){return this.adItem.value.ads[0]}get postData(){const{ads:e,...t}=this.adItem.value,i=e[0].post;return{...t,...i,type:i?.type||"post",inner_type:i?.inner_type||"wall_wallpost"}}get adaptedPost(){return{...this.adItem,type:"post",postState:this.adItem.adState||"default",value:this.postData}}get promoPostConfig(){const{promoPostConfig:e}=this.props.current;return{...e||{},motionWatcher:{...e?.motionWatcher||{},isMotionReady:this.motionService.isReady,onWatcherStart:this.startMotionWatch}}}get adLegacyData(){return{post:{adData:this.postItem.value.ad_data},avatar:{clickType:"post_owner_img"},title:{clickType:"post_owner_link"}}}get adsDisclaimerType(){switch(this.ads.disclaimer_type){case"medical":return zv.Medical;case"supplements":return zv.Supplements;case"credits":return zv.Credits;case"specialist":return zv.Specialist;case"finance":return zv.Finance;default:return}}get adsDisclaimerText(){return this.ads.disclaimer}get hasDisclaimer(){return!!this.ads.disclaimer}get isImageDisclaimer(){return this.hasDisclaimer&&this.adsDisclaimerType&&[zv.Medical,zv.Supplements,zv.Credits].includes(this.adsDisclaimerType)}get dataRoles(){return this.promoPostConfig?.useRoles?jv:void 0}constructor(e,t,i){this.props=e,this.motionService=t,this.motionWatcherService=i,this.startMotionWatch=e=>this.motionWatcherService.watch({target:e,id:this.adItem.id,impressionId:this.adItem.value.impression_id,type:this.ads.type,source:this.adItem.value.ad_source,statistics:this.ads.statistics,adData:this.ads.ad_data}),this.getItemUiState=this.props.current.getItemUiState,(0,c.l_)(this)}}$v=(0,d.Cg)([a.z8.transient(),(0,d.Sn)("design:type",Function),(0,d.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===Av.O?Object:Av.O,void 0===Wv?Object:Wv])],$v);const{Provider:Hv,useModel:Vv}=(0,a.Qd)($v,{initInEffect:!1});var Kv=i(663160),qv=i(372242),Gv=i(913424);const Jv="PostAdDisclaimer__iconSecondary--JXuRj",Qv=({type:e,text:t})=>{const{getLang:i}=(0,Fe.B)();switch(e){case zv.Medical:return(0,n.Y)(Kv.y,{className:(0,le.$)((0,G.I)("color_icon_secondary"),Jv)});case zv.Supplements:return(0,n.Y)(qv.P,{className:(0,le.$)((0,G.I)("color_icon_secondary"),Jv)});case zv.Credits:return(0,n.Y)(Gv.O,{className:(0,le.$)((0,G.I)("color_icon_secondary"),Jv)});case zv.Specialist:return(0,n.Y)(Ls.b,{className:(0,G.I)("color_text_secondary"),lines:1,TypographyComponent:q.$j,children:i("global_ad_disclaimer_specialist")});case zv.Finance:default:return(0,n.Y)(Ls.b,{className:(0,G.I)("color_text_secondary"),lines:1,TypographyComponent:q.$j,children:t})}},Xv=({type:e,spacing:t=20,dataRole:i,text:o,...r})=>(0,n.Y)(s.i,{mode:"vertical",spacing:t,paddingTop:0,paddingBottom:0,"data-role":i,...r,children:(0,n.Y)(Qv,{type:e,text:o})}),Zv=(0,a.jn)(Hv,(0,o.P)((function(){const{postItem:e,props:t,promoPostConfig:i,getItemUiState:o,adLegacyData:s,hasDisclaimer:r,adsDisclaimerType:a,adsDisclaimerText:d,isImageDisclaimer:c,dataRoles:l}=Vv(),{index:h,observers:p,textAlwaysExpanded:u,attachmentsExpanded:m,newsfeedType:g,config:_,platformConfig:v,onOpenPost:f,onOpenReactions:w}=t.current,y=(({onWatcherStart:e,isMotionReady:t})=>{const i=(0,H.useRef)(null),n=(0,H.useRef)(null),o=(0,H.useCallback)((async()=>{n.current&&e&&(i.current||(i.current=await e(n.current)))}),[e,n.current,i.current]);return(0,H.useLayoutEffect)((()=>{n.current&&t&&o?.()}),[n.current,t]),n})({onWatcherStart:i?.motionWatcher.onWatcherStart,isMotionReady:i?.motionWatcher.isMotionReady}),b=r&&!c&&(0,n.Y)(Xv,{type:a,text:d,spacing:0,paddingTop:8,dataRole:l?.disclaimer}),C=r&&c&&(0,n.Y)(Xv,{type:a,paddingTop:16,dataRole:l?.disclaimer});return(0,n.Y)(Vm,{data:e,platformConfig:v,index:h,observers:p,attachmentsExpanded:m,textAlwaysExpanded:u,config:_,onOpenPost:f,newsfeedType:g,getItemUiState:o,adLegacyData:s,motionRef:y,dataRoles:l,imageDisclaimer:C,textDisclaimer:b,onOpenReactions:w,isPromoPost:!0})}))),ef={useRoles:!0},tf=u_,nf=(0,o.P)((function(){const{props:e,config:t,handleOpenLayer:i,handleOpenReactionsLayer:o,isFeedPostReactionsModalEnabled:s}=Nv(),{item:r,...a}=e.current;return(0,n.Y)(Zv,{...a,item:r,onOpenPost:(...t)=>{qm(i,Boolean(e.current.config?.disallowOpenFeedItemModal))(...t)},platformConfig:tf,promoPostConfig:ef,config:t,onOpenReactions:s?o:void 0})}));nf.displayName="WebPromoPost";const of=(0,Ac.N)(Fv,nf),sf=(0,o.P)((function({item:e,index:t,attachmentsExpanded:i=!1,textAlwaysExpanded:o=!1,observers:a,scheduleAdsInvalidation:d,uniqueItemId:c,config:l,getItemUiState:h,newsfeedType:p,handleCreatePostponeAndSuggest:u,commentsConfig:m,startCommentId:g,startThreadId:_}){if(!e)return null;const{type:f}=e;switch(e.type){case"post":return(0,n.Y)(f_,{item:e,index:t,attachmentsExpanded:i,textAlwaysExpanded:o,getItemUiState:h,observers:a?(0,dv.$)([S.U.t35],a):void 0,config:l,commentsPlatformConfig:m,startCommentId:g,startThreadId:_,newsfeedType:p,postAuthorActions:(0,v.i4)(e)?(0,n.Y)(Iv.Z,{postItem:e,handleCreatePostponeAndSuggest:u}):null});case"video":return(0,n.Y)(kv,{item:e,index:t,getItemUiState:h,config:l,observers:a?(0,dv.$)([S.U.t35],a):void 0});case"ads":return(0,n.Y)(Dv,{item:e,index:t,scheduleAdsInvalidation:d,uniqueItemId:c,getItemUiState:h,observers:a?(0,dv.$)([S.U.t50],a):void 0});case"post_ads":return(0,n.Y)(of,{item:e,index:t,attachmentsExpanded:i,textAlwaysExpanded:o,observers:a?(0,dv.$)([S.U.t50],a):void 0,config:l,newsfeedType:p,getItemUiState:h});case"wall_photo":case"photo":case"photo_tag":return(0,n.Y)(E_,{item:e,index:t,getItemUiState:h,isMetaPostMenuEnabled:l?.isMetaPostMenuEnabled,observers:a?(0,dv.$)([S.U.t35],a):void 0});case"animated_block":case"market":return(0,n.Y)("div",{children:f});case"friends_recomm":case"user_rec":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(av,{data:e})});case"recommended_games_carousel":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(X_,{data:e,isMobile:!1})});case"recommended_game":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(Z_,{trackCode:e.value.track_code,blockType:e.type,isMobile:!1})});case"recommended_groups":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(ev,{item:e})});case"recommended_channels":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(tv,{item:e})});case"videos_for_you":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(sv,{position:t,data:e})});case"market_carousel":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(iv,{blockType:e.type,trackCode:e.value.track_code,position:t})});case"mini_apps_carousel":return(0,n.Y)(r.T,{feedConfig:{observers:a,data:e,position:t,getItemUiState:h},children:(0,n.Y)(nv,{trackCode:e.value.track_code,blockType:e.type,isMobile:!1})})}return(0,n.FD)(s.i,{children:[f,"- unsupported - placeholder"]})}))},759275:(e,t,i)=>{i.d(t,{M:()=>_});var n=i(221020),o=i(17158),s=i(180329),r=i(982444),a=i(370633),d=i(962644),c=i(516427),l=i(413621),h=i(46284);const p="SkeletonCard__skeleton--O4LJ4",u=({children:e})=>(0,n.FD)(s.s,{children:[(0,n.Y)(r.K,{size:12,mode:"vertical"}),e]}),m=()=>(0,n.Y)(a.Y,{className:p,padding:"none",children:(0,n.FD)(s.s,{direction:"column",children:[(0,n.Y)(d.h,{placement:"top-left",zIndex:1,children:(0,n.Y)(c.glH,{ratio:16/9,children:(0,n.Y)(l._,{objectFit:"contain",borderRadius:"l",widthSize:470,heightSize:264})})}),(0,n.Y)(d.h,{Component:s.s,placement:"bottom",zIndex:0,children:(0,n.FD)(h.E,{width:470,height:115,borderRadius:8,children:[(0,n.Y)(r.K,{size:30,mode:"horizontal"}),(0,n.Y)(u,{children:(0,n.Y)(h.E,{height:12,width:150,borderRadius:4})}),(0,n.Y)(r.K,{size:"s",mode:"horizontal"}),(0,n.Y)(u,{children:(0,n.Y)(h.E,{height:8,width:100,borderRadius:2})}),(0,n.Y)(r.K,{size:"s",mode:"horizontal"}),(0,n.Y)(u,{children:(0,n.Y)(h.E,{height:8,width:100,borderRadius:2})})]})})]})});var g=i(574229);const _=({header:e})=>(0,n.Y)(o._,{count:g.Mg,cardNode:(0,n.Y)(m,{}),header:e})},574229:(e,t,i)=>{i.d(t,{Aj:()=>d,J8:()=>a,Mg:()=>n,UO:()=>l,X0:()=>c,aW:()=>h,fK:()=>o,iq:()=>s,uj:()=>r});const n=2,o=!1,s=!1,r=300,a=2,d=12,c=471+d,l=533,h="videos_for_you_block"},689998:(e,t,i)=>{i.r(t),i.d(t,{isValidOpenResultsCase:()=>Pe,showPollModal:()=>Le});var n=i(221020),o=i(595253),s=i(432317),r=i(614614),a=i(457735),d=i(532046),c=i(356035),l=i(946918),h=i(42107),p=i(409698),u=i(46644),m=i(47417),g=i(865940),_=i(704399),v=i(377803),f=i(311029),w=i(37390),y=i(141575),b=i(331635),C=i(327813),k=i(273193),I=i(434178),S=i(97929),A=i(725308),P=i(940127);const L=2e3;class O{async[h.Ts](){await this.fetchPoll(),this.isFetching=!1}get canVote(){return 0===this.poll.answer_ids?.length&&!this.poll.closed&&!this.isPollFinished&&this.poll.can_vote}get canUnvote(){return!this.poll.disable_unvote&&this.isRevotingAvailable}get isPollFinished(){return Boolean(this.poll.end_date&&1e3*this.poll.end_date<=Date.now())}get isVotingAvailable(){return!(this.poll.answer_ids?.length||!this.poll.can_vote||this.isPollFinished)}get isShowResultsButtonDisabled(){return!!this.canVote}get isRevotingAvailable(){return!!this.poll.answer_ids?.length&&!this.isPollFinished&&!this.poll.disable_unvote&&this.poll.can_vote}get hasSelectedAnswers(){return this.selectedAnswers.size>0}get actionSheetText(){const e=this.poll.owner_id;if(A.z.isGroupId(e)){const t=A.z.convertOwnerIdToGroupId(e),i=this.poll.groups?.find((e=>e.id===t));if(i)return this.langs.langReplace(this.langs.getLang("wall_poll_actionsheet_group_title"),{community_name:i.name})}else{const t=this.poll.profiles?.find((t=>t.id===e));if(t)return this.langs.langReplace(this.langs.getLang("wall_poll_actionsheet_user_title"),{author:(0,P.Y)(t)})}return""}get pollTypeText(){return this.poll.anonymous?this.langs.getLang("voting_anonymous"):this.langs.getLang("voting_public")}get pollVotesText(){return 0===this.poll.votes?this.isPollFinished?this.langs.getLang("voting_no_voted"):this.langs.getLang("voting_vote_first"):this.langs.numeric(this.poll.votes,this.langs.getLang("voting_N_voted",!0))}get pollVotesAvatars(){return this.poll.anonymous?[]:this.poll.profiles?.filter((e=>this.poll.friends?.some((t=>t.id===e.id))))??[]}get pollSubtitle(){if(this.isPollFinished)return this.langs.getLang("voting_ended");let e=[];return this.poll?.disable_unvote&&e.push(this.langs.getLang("voting_unvote_disabled")),this.poll.end_date&&e.push(this.langs.date(new Date(1e3*this.poll.end_date),this.langs.getLang("voting_time_until",!0),this.langs.getLang("months_of",!0),{onlyDate:!0,offset:0})),e.join(" · ")}constructor(e,t,i,n){this.langs=e,this.pollsApi=t,this.snackbar=i,this.props=n,this.isFetching=!0,this.loading=!1,this.selectedAnswers=new Set,this.fetchPoll=async()=>{try{const e=await this.pollsApi.getById({owner_id:this.poll?.owner_id,poll_id:this.poll?.id,is_board:this.poll?.is_board?1:0,extended:1});(0,C.h5)((()=>{this.poll=e}))}catch(e){this.snackbar.show({type:"error",text:this.langs.getLang("voting_fetch_poll_failed"),duration:L})}},this.handleVote=async e=>{this.loading=!0;const t=Array.isArray(e);try{await this.pollsApi.addVote({owner_id:this.poll.owner_id,poll_id:this.poll.id,is_board:this.poll?.is_board?1:0,answer_ids:t?e.join(","):String(e),track_code:this.props.current.trackCode}),await this.fetchPoll()}catch(e){this.snackbar.show({type:"error",text:this.langs.getLang("voting_vote_failed"),duration:L})}finally{(0,C.h5)((()=>{this.loading=!1}))}this.handleShowResults()},this.handleSetMultipleAnswer=e=>{this.selectedAnswers.has(e)?this.selectedAnswers.delete(e):this.selectedAnswers.add(e),this.selectedAnswers=new Set(this.selectedAnswers)},this.handleVoteMultiple=async()=>{const e=[...this.selectedAnswers];await this.handleVote(e),this.selectedAnswers=new Set},this.handleDeleteVote=async()=>{this.loading=!0;try{await this.pollsApi.deleteVote({owner_id:this.poll.owner_id,poll_id:this.poll.id,is_board:this.poll?.is_board?1:0,track_code:this.props.current.trackCode}),await this.fetchPoll()}catch(e){this.snackbar.show({type:"error",text:this.langs.getLang("voting_unvote_failed"),duration:L})}finally{(0,C.h5)((()=>{this.loading=!1}))}},this.handleShowResults=()=>{this.props.current.pollShowStatsAction(this.poll)},this.handleShowReport=()=>{this.props.current.pollReportAction(this.poll)},this.handleGetCode=()=>{this.props.current.pollGetCodeAction()},this.handleShare=()=>{this.props.current.pollShareAction()},this.poll=n.current.poll,(0,C.l_)(this)}}O=(0,b.Cg)([h.z8.transient(),(0,b.Sn)("design:type",Function),(0,b.Sn)("design:paramtypes",[void 0===k.Y?Object:k.Y,void 0===I.F?Object:I.F,void 0===S.q?Object:S.q,void 0===h.Ji?Object:h.Ji])],O);const{Provider:E,useModel:x}=(0,h.Qd)(O,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0});var Y=i(925228),M=i(500001),T=i(410725),R=i(634164),D=i(180329),B=i(516427),F=i(638945),N=i(355812),z=i(165051),j=i(772812);const U="vkitPollOptions__votingOptionsWrapper--BydIL",W="vkitPollOptions__votingOptionsOverflowWrapper--ulA7g",$="vkitPollOptions__votingOptions--kkdU8",H="vkitPollOptions__votingOptionWrapper--1fOoS",V="vkitPollOptions__votingOption--mmFU2",K="vkitPollOptions__votingOptionFill--NXUVn",q="vkitPollOptions__votingOptionRow--hDsGn",G="vkitPollOptions__votingOptionLeft--2GdvM",J="vkitPollOptions__votingOptionRight--OfzMp",Q="vkitPollOptions__votingOptionSeparator--DH7wq",X="vkitPollOptions__votingMyVoteIcon--lM8iM",Z="vkitPollOptions__votingOptionCheckboxIcon--DYPaq",ee="vkitPollOptions__checkboxIcon--7OrS1",te="vkitPollOptions__checkboxCheckedIcon--Ldjlj",ie="vkitPollOptions__votingOptionsVoted--vc77t",ne="vkitPollOptions__votingOptionsLoading--ig8JS",oe=({hasVoting:e,loading:t,answers:i,answerIds:o,multiple:s,setSelectedAnswers:r,selectedAnswers:a,handleVoteSingle:d})=>{const c=e,l=s?"poll-option-checkbox":"poll-option";return(0,n.Y)(D.s,{direction:"column",className:U,children:(0,n.Y)(D.s,{direction:"column",className:W,children:(0,n.Y)("div",{className:(0,R.$)($,!e&&ie,t&&ne),children:i.map((i=>(0,n.Y)("div",{className:H,children:(0,n.Y)(B.SB4,{"data-testid":o.includes(i.id)?"poll-option-voted":l,hasHover:c,hasActive:c,onClick:()=>c&&(s?r(i.id):d(i.id)),children:(0,n.FD)(D.s,{align:"center",justify:"space-between",className:V,children:[(0,n.Y)("div",{className:K,style:{width:`${e||t?0:i.rate}%`}}),(0,n.FD)(D.s,{align:"start",justify:"space-between",noWrap:!0,className:q,children:[(0,n.Y)(D.s,{align:"center",className:G,children:(0,n.Y)(z.r,{separator:(0,n.Y)("div",{className:Q,children:(0,n.Y)(N.O,{})}),children:(0,n.Y)(F.LE,{weight:"2",Component:"span","data-testid":"poll-option-text",children:i.text})})}),(0,n.FD)(D.s,{align:"center",noWrap:!0,children:[(0,n.FD)(D.s,{align:"center",justify:"end",className:J,children:[o.includes(i.id)&&(0,n.Y)(Y.X,{className:X,"data-testid":"poll-option-voted-icon"}),(0,n.FD)(F.fz,{className:(0,j.I)("color_text_secondary"),weight:"2","data-testid":"poll-option-percent",children:[i.rate," %"]})]}),(0,n.Y)(D.s,{justify:"center",align:"center",margin:"auto",className:Z,children:e&&s&&(a.has(i.id)?(0,n.Y)(M.s,{className:te}):(0,n.Y)(T.u,{className:ee}))})]})]})]})})},i.id)))})})})};var se=i(418356),re=i(56471),ae=i(423654),de=i(880414),ce=i(982444),le=i(645964);const he=(0,c.P)((function({title:e,pollType:t,votesAvatars:i,votesText:o,subtitle:s}){const r=i?.length?(0,n.Y)(se.f,{size:"s",photos:i.map((e=>({src:String(e.photo_50),renderWrapper:t=>(0,n.Y)(re.f,{text:(0,le.Cg)(e),children:(0,n.Y)(ae.N,{href:(0,le.dh)(e),target:"_blank",rel:"noreferrer",...t})})})))}):null;return(0,n.FD)(n.FK,{children:[(0,n.Y)(de.b,{lines:10,Component:F.hE,level:"3",className:(0,j.I)("color_text_primary"),children:e}),(0,n.Y)(ce.K,{size:4}),(0,n.FD)("div",{className:(0,j.I)("color_text_secondary"),children:[(0,n.FD)(D.s,{align:"center",children:[t,(0,n.Y)(ce.K,{mode:"vertical"}),"·",(0,n.Y)(ce.K,{mode:"vertical"}),r,(0,n.Y)(ce.K,{mode:"vertical"}),o]}),(0,n.Y)(D.s,{children:s})]}),(0,n.Y)(ce.K,{size:20})]})})),pe=(0,c.P)((function(){const e=(0,l.B)(),{props:{current:{onClose:t,refreshCoordinates:i}},poll:o,selectedAnswers:r,handleVote:a,loading:d,isFetching:c,handleSetMultipleAnswer:h,handleDeleteVote:b,handleShowResults:C,handleShowReport:k,handleGetCode:I,handleShare:S,handleVoteMultiple:A,actionSheetText:P,canVote:L,canUnvote:O,hasSelectedAnswers:E,pollTypeText:Y,pollVotesText:M,pollSubtitle:T,pollVotesAvatars:R,isShowResultsButtonDisabled:D}=x();if(c)return(0,n.Y)(s.Fo,{refreshCoordinates:i});const B=[(0,n.Y)(p.$,{mode:"tertiary",appearance:"accent",disabled:D,onClick:C,children:e.getLang("wall_posting_poll_show_results")},1)];return o.multiple&&L&&B.push((0,n.Y)(p.$,{mode:"primary",appearance:"accent",disabled:!E||d,onClick:A,children:e.getLang("voting_vote")},2)),(0,n.FD)(u.n,{children:[(0,n.Y)(m.r,{onClose:t,closeAriaLabel:e.getLang("global_close"),after:(0,n.Y)(g.v,{width:210,content:(0,n.FD)(n.FK,{children:[(0,n.Y)(g.v.Item,{type:"header",multiline:!0,children:P}),(0,n.Y)(_.F,{wide:!0}),O&&(0,n.Y)(g.v.Item,{onClick:b,children:e.getLang("voting_revote")}),o.can_share&&(0,n.Y)(g.v.Item,{onClick:S,children:e.getLang("voting_share")}),o.can_report&&(0,n.Y)(g.v.Item,{onClick:k,children:e.getLang("voting_report")}),(0,n.Y)(g.v.Item,{onClick:I,children:e.getLang("voting_export")})]}),children:(0,n.Y)(y.z,{fill:v.A.colorIconSecondary.normal.value})}),children:e.getLang("wall_posting_poll_header_text")}),(0,n.FD)(f.c,{insetLevel:2,children:[(0,n.Y)(he,{title:o?.question,pollType:Y,votesAvatars:R,votesText:M,subtitle:T}),(0,n.Y)(oe,{hasVoting:L,multiple:o.multiple,answers:o.answers,answerIds:o.answer_ids??[],loading:d,handleVoteSingle:a,selectedAnswers:r,setSelectedAnswers:h})]}),(0,n.Y)(w.j,{actions:B})]})})),ue=(0,h.jn)(E,pe);var me=i(543584),ge=i(9467),_e=i(815287),ve=i(637057),fe=i(570440),we=i(321831),ye=i(482392);class be{get poll(){return this.pollModel.poll}get actionSheetText(){if(!this.poll)return"";const e=this.ownerService.getOwnerNameById(this.poll.data.owner_id);return A.z.isUserId(this.poll.data.owner_id)?this.langs.langReplace(this.langs.getLang("wall_poll_actionsheet_user_title"),{author:e}):this.langs.langReplace(this.langs.getLang("wall_poll_actionsheet_group_title"),{community_name:e})}get pollTypeText(){return this.poll?this.poll.isAnonymous?this.langs.getLang("voting_anonymous"):this.langs.getLang("voting_public"):""}get pollVotesText(){return this.poll?0===this.poll.votes?this.poll.isFinished?this.langs.getLang("voting_no_voted"):this.langs.getLang("voting_vote_first"):this.langs.numeric(this.poll.votes,this.langs.getLang("voting_N_voted",!0)):""}get pollSubtitle(){if(!this.poll)return;if(this.poll.isFinished)return this.langs.getLang("voting_ended");let e=[];return this.poll.unvoteDisabled&&e.push(this.langs.getLang("voting_unvote_disabled")),this.poll.endDate&&e.push(this.langs.date(new Date(1e3*this.poll.endDate),this.langs.getLang("voting_time_until",!0),this.langs.getLang("months_of",!0),{onlyDate:!0,offset:0})),e.join(" · ")}get labels(){return{voteText:this.langs.getLang("voting_vote"),headerText:this.langs.getLang("wall_posting_poll_header_text"),revoteText:this.langs.getLang("voting_revote"),reportText:this.langs.getLang("voting_report"),shareText:this.langs.getLang("voting_share"),exportText:this.langs.getLang("voting_export"),showResultsText:this.langs.getLang("voting_show_results"),close:this.langs.getLang("global_close")}}get LoaderComponent(){return this.props.current.LoaderComponent}get refreshCoordinates(){return this.props.current.refreshCoordinates}get onClose(){return this.props.current.onClose}constructor(e,t,i,n,o){this.langs=e,this.props=t,this.snackbar=i,this.ownerService=n,this.feedItemAttachmentPollService=o,this.selectedAnswers=new Set,this.handleSetMultipleAnswer=e=>{this.selectedAnswers.has(e)?this.selectedAnswers.delete(e):this.selectedAnswers.add(e)},this.handleVoteMultiple=async()=>{const e=[...this.selectedAnswers];await this.pollModel.handleVote(e),this.selectedAnswers.clear()},this.handleShowResults=()=>{this.poll&&this.props.current.onShowStats?.(this.poll.data)},this.handleShowReport=()=>{this.poll&&this.props.current.onReport?.(this.poll.data)},this.handleGetCode=()=>{this.poll&&this.props.current.onGetCode?.(this.poll.data)},this.handleShare=()=>{if(!this.poll)return;const{pollRawId:e,pollRaw:t}=(0,ve.K)(this.poll.data);this.props.current.onShare?.({objectId:e,object:t})},this.pollModel=new ye.r(this.props.current.poll,this.ownerService,this.feedItemAttachmentPollService,this.snackbar,this.langs,this.props.current.trackCode),(0,C.l_)(this)}}be=(0,b.Cg)([h.z8.transient(),(0,b.Sn)("design:type",Function),(0,b.Sn)("design:paramtypes",[void 0===k.Y?Object:k.Y,void 0===h.Ji?Object:h.Ji,void 0===S.q?Object:S.q,void 0===fe.v?Object:fe.v,void 0===we.h?Object:we.h])],be);const{Provider:Ce,useModel:ke}=(0,h.Qd)(be,{initInEffect:!1}),Ie=(0,c.P)((function({title:e,pollType:t,votesAvatars:i,votesText:o,subtitle:s}){const r=i?.length?(0,n.Y)(se.f,{size:"s",photos:i.map((e=>({src:e.photo_50??e.photo_100??"",renderWrapper:t=>(0,n.Y)(re.f,{description:(0,le.Cg)(e),children:(0,n.Y)(ae.N,{href:(0,le.dh)(e),target:"_blank",rel:"noreferrer",...t})},e.id)})))}):null;return(0,n.FD)(n.FK,{children:[(0,n.Y)(F.hE,{level:"3",className:(0,j.I)("color_text_primary"),children:e}),(0,n.Y)(ce.K,{size:4}),(0,n.FD)("div",{className:(0,j.I)("color_text_secondary"),children:[(0,n.FD)(D.s,{align:"center",children:[t,(0,n.Y)(N.O,{}),Boolean(r)&&(0,n.FD)(n.FK,{children:[r,(0,n.Y)(ce.K,{mode:"vertical"})]}),o]}),(0,n.Y)(D.s,{children:s})]}),(0,n.Y)(ce.K,{size:20})]})})),Se=(0,h.jn)(Ce,(0,c.P)((function(){const{pollModel:e,selectedAnswers:t,handleVoteMultiple:i,handleSetMultipleAnswer:o,handleShowResults:s,handleShowReport:r,handleGetCode:a,handleShare:d,actionSheetText:c,pollTypeText:l,pollVotesText:h,pollSubtitle:v,labels:b,LoaderComponent:k,onClose:I,refreshCoordinates:S}=ke(),{poll:A,pollVotesAvatars:P,isLoading:L,handleVote:O,handleDeleteVote:E}=e;if((0,_e.useEffect)((()=>{S()}),[A]),!A)return k;const x=[(0,n.Y)(p.$,{mode:"tertiary",appearance:"accent",disabled:A.canVote||L,onClick:s,children:b.showResultsText},1)];return A.multiple&&A.canVote&&x.push((0,n.Y)(p.$,{mode:"primary",appearance:"accent",disabled:0===t.size||L,onClick:i,children:b.voteText},2)),(0,n.FD)(u.n,{"aria-label":b.headerText,children:[(0,n.Y)(m.r,{onClose:I,closeAriaLabel:b.close,after:(0,n.Y)(g.v,{width:210,content:(0,n.FD)(n.FK,{children:[(0,n.Y)(g.v.Item,{type:"header",multiline:!0,children:c}),(0,n.Y)(_.F,{wide:!0}),A.canUnvote&&(0,n.Y)(g.v.Item,{disabled:L,onClick:E,children:b.revoteText}),A.canShare&&(0,n.Y)(g.v.Item,{onClick:d,children:b.shareText}),A.canReport&&(0,n.Y)(g.v.Item,{onClick:r,children:b.reportText}),(0,n.Y)(g.v.Item,{onClick:a,children:b.exportText})]}),children:(0,n.Y)(y.z,{className:(0,j.I)("color_icon_secondary")})}),children:b.headerText}),(0,n.FD)(f.c,{insetLevel:2,children:[(0,n.Y)(Ie,{title:A.question,pollType:l,votesAvatars:P,votesText:h,subtitle:v}),(0,n.Y)(oe,{hasVoting:A.canVote,multiple:A.multiple,answers:(0,C.HO)(A.answers),answerIds:(0,C.HO)(A.answersIds??[]),loading:!1,handleVoteSingle:O,selectedAnswers:t,setSelectedAnswers:o})]}),(0,n.Y)(w.j,{actions:x})]})})));var Ae=i(575705);const Pe=e=>{const t=e.end_date&&1e3*e.end_date<=Date.now(),i=e.closed;return t||i},Le=(e,t={})=>{const i=(0,d.d)(e),c=new URLSearchParams(window.location.search).get("w"),l=(0,Ae.j)()&&Boolean(c?.includes("wall")),h=()=>{(0,me.z)(e)},p=async()=>{window.Likes?.share(i)},u=()=>{l&&window.layerQueue?._layers.push(["wiki",c]),(0,a.u)({w:i})},m=()=>{const t=e.is_board?"board_poll":"poll";(0,r.showReportForm)(t,0,e.id)};Pe(e)?u():(0,s.Ny)((i=>(0,n.Y)(o.R,{children:(0,ge.z2)("polls_spa")?(0,n.Y)(Se,{...i,poll:e,onShowStats:u,onReport:m,onGetCode:h,onShare:p,trackCode:t.trackCode,LoaderComponent:(0,n.Y)(s.Fo,{refreshCoordinates:i.refreshCoordinates})}):(0,n.Y)(ue,{...i,poll:e,pollShowStatsAction:u,pollReportAction:m,pollGetCodeAction:h,pollShareAction:p,trackCode:t.trackCode})})),{width:510,onDestroy:()=>{l&&window.layerQueue.pop()}})}},908222:(e,t,i)=>{i.d(t,{Z:()=>B});var n=i(221020),o=i(356035),s=i(42107),r=i(180329),a=i(982444),d=i(225505),c=i(782536),l=i(409698),h=i(783661),p=i(331635),u=i(327813),m=i(582876),g=i(195578),_=i(578904),v=i(998286),f=i(97929),w=i(273193),y=i(849645),b=i(937314),C=i(725308),k=i(698853);class I{get postItemType(){return this.props.current.postItem.value.post_type}get actionButtons(){switch(this.postItemType){case"postpone":return[{key:"publish-now",label:this.langsService.getLang("wall_publish_now"),loading:this.postNowLoading,onClick:this.postItemNow,mode:"primary",appearance:"accent"}];case"suggest":return[{key:"publish-prepare",label:this.langsService.getLang("wall_suggest_publish_prepare"),loading:!1,onClick:this.openModal,mode:"primary",appearance:"accent"},{key:"no-publish",label:this.langsService.getLang("wall_suggest_nopublish"),loading:this.isDeleteInProgress,onClick:this.deleteItem,mode:"tertiary",appearance:"accent"}];case"draft":return[{key:"draft-edit",label:this.langsService.getLang("wall_drafts_edit_button"),loading:!1,onClick:this.openModal,mode:"primary",appearance:"accent"},{key:"draft-delete",label:this.langsService.getLang("wall_drafts_delete_button"),loading:this.isDeleteInProgress,onClick:this.deleteItem,mode:"secondary",appearance:"negative"}];default:return[]}}createUserConfirmationModalPromise(){null===this._userConfirmationModalDeffered&&(this._userConfirmationModalDeffered=Promise.withResolvers())}get rawId(){return this.props.current.postItem.id}get ownerId(){return String(this.props.current.postItem.value.owner_id)}get screen(){return this.metaData.get().screen}get module(){return this.metaData.get().module}get isGroup(){const{owner_id:e}=this.props.current.postItem.value;return void 0!==e&&C.z.isGroupId(e)}get creationEntryPoint(){return this.postItemType?(0,k.m)(this.postItemType,this.module,this.isGroup):void 0}constructor(e,t,i,n,o,s,r,a){this.props=e,this.wallApi=t,this.feedErrorService=i,this.feedEntitiesMutationService=n,this.singlePostWallService=o,this.snackbar=s,this.langsService=r,this.metaData=a,this.isModalOpen=!1,this.isDeleteInProgress=!1,this.postNowLoading=!1,this.isPostNowConfirmationModalShow=!1,this._userConfirmationModalDeffered=null,this.deleteItem=async()=>{if(!this.isDeleteInProgress){this.isDeleteInProgress=!0;try{const e={owner_id:this.props.current.postItem.value.owner_id,post_id:this.props.current.postItem.value.id,creation_entry_point:this.creationEntryPoint};await this.wallApi.delete(e),this.updatePostState("deleted")}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,u.h5)((()=>{this.isDeleteInProgress=!1}))}}},this.postItemNow=async()=>{if(this.postNowLoading)return;this.isPostNowConfirmationModalShow=!0,this.createUserConfirmationModalPromise();if(await(this._userConfirmationModalDeffered?.promise)){(0,u.h5)((()=>{this.isPostNowConfirmationModalShow=!1,this.postNowLoading=!0}));try{const e={owner_id:this.props.current.postItem.value.owner_id,post_id:this.props.current.postItem.value.id,creation_entry_point:this.creationEntryPoint};await this.wallApi.post(e),this.updatePostState("justPosted"),this.snackbar.show({type:"ok",text:this.langsService.getLang("wall_postponed_post_published")})}catch(e){this.feedErrorService.handleNetworkError(e)}finally{(0,u.h5)((()=>{this.postNowLoading=!1}))}}else(0,u.h5)((()=>{this.isPostNowConfirmationModalShow=!1,this.postNowLoading=!1}))},this.resolveUserConfirmationModalPromise=e=>{this._userConfirmationModalDeffered?.resolve?.(e),this._userConfirmationModalDeffered=null},this.onCreateDraft=(e,t)=>(0,b.G)({snackbar:this.snackbar,langs:this.langsService,ownerId:t}),this.onCreatePost=()=>{this.closeModal(),this.updatePostState("justPosted")},this.onEditPost=()=>(this.closeModal(),this.singlePostWallService.refetchPost(this.rawId)),this.closeModal=()=>{this.isModalOpen=!1},this.openModal=()=>{this.isModalOpen=!0},this.updatePostState=e=>{this.props.current?.handleCreatePostponeAndSuggest?.(),this.feedEntitiesMutationService.mutateFeedItemState(this.props.current.postItem.id,e)},(0,u.l_)(this)}}I=(0,p.Cg)([s.z8.transient(),(0,p.Sn)("design:type",Function),(0,p.Sn)("design:paramtypes",[void 0===s.Ji?Object:s.Ji,void 0===v.t?Object:v.t,void 0===m.m?Object:m.m,void 0===g.K?Object:g.K,void 0===_.a?Object:_.a,void 0===f.q?Object:f.q,void 0===w.Y?Object:w.Y,void 0===y.e?Object:y.e])],I);const{Provider:S,useModel:A}=(0,s.Qd)(I,{initInEffect:!1});var P=i(516427),L=i(326977),O=i(46644),E=i(47417),x=i(311029),Y=i(37390),M=i(822551),T=i(946918);const R=(0,o.P)((function(){const{getLang:e}=(0,T.B)(),{resolveUserConfirmationModalPromise:t}=A();return(0,P.K$F)(),(0,M.createPortal)((0,n.Y)(L.z,{children:(0,n.FD)(O.n,{"aria-labelledby":"groups_user_confirmation_modal_title",children:[(0,n.Y)(E.r,{id:"groups_user_confirmation_modal_title",onClose:()=>t(!1),closeAriaLabel:"Закрыть",children:e("vkui_platform_confirmation_title")}),(0,n.Y)(x.c,{insetLevel:2,children:e("wall_publish_postponed_confirm")}),(0,n.Y)(Y.j,{actions:(0,n.FD)(n.FK,{children:[(0,n.Y)(l.$,{mode:"tertiary",size:"m",onClick:()=>t(!1),children:e("groups_delete_modal_cancel")}),(0,n.Y)(l.$,{onClick:()=>t(!0),size:"m",children:e("wall_posting_publish_button_label")})]})})]})}),document.body)})),D=(0,o.P)((function(){const{isModalOpen:e,closeModal:t,onCreatePost:i,onEditPost:o,ownerId:s,rawId:p,actionButtons:u,isPostNowConfirmationModalShow:m,screen:g,creationEntryPoint:_}=A();return 0===u.length?null:(0,n.FD)(n.FK,{children:[(0,n.FD)(r.s,{direction:"column",children:[(0,n.Y)(a.K,{size:"2xl"}),(0,n.Y)(d.w,{wide:!0}),(0,n.Y)(a.K,{size:"xl"}),(0,n.Y)(c.e,{align:"center",stretched:!0,children:u.map((e=>(0,n.Y)(l.$,{"data-testid":`post-action-${e.key}-button`,loading:e.loading,onClick:e.onClick,mode:e.mode,appearance:e.appearance,children:e.label},e.key)))}),(0,n.Y)(a.K,{size:"xl"})]}),e&&(0,n.Y)(h.s,{afterEditSuccess:o,onCreate:i,postRaw:p,closeModal:t,ownerId:s,creationEntryPoint:_,screen:g}),m&&(0,n.Y)(R,{})]})})),B=(0,s.jn)(S,D)},573503:(e,t,i)=>{i.d(t,{p:()=>d});var n=i(221020),o=i(946918),s=i(187233),r=i(405697),a=i(819377);const d=()=>{const e=(0,o.B)(),t=e.getLang("audio_music_playlist_crash_placeholder_header"),i=e.getLang("audio_music_playlist_crash_placeholder_description");return(0,n.Y)(a.l,{children:(0,n.Y)(s.i,{paddingTop:16,paddingBottom:16,spacing:8,children:(0,n.Y)(r.O,{header:t,children:i})})})}},819377:(e,t,i)=>{i.d(t,{l:()=>p});var n=i(221020),o=i(46644),s=i(516427),r=i(47417),a=i(311029),d=i(946918),c=i(815287),l=i(356035),h=i(677740);const p=(0,l.P)((function({header:e,children:t,onClose:i,refreshCoordinates:l=()=>{}}){const p=(0,c.useRef)(null),u=(0,d.B)();return(0,h.D)(p,l),(0,n.FD)(o.n,{width:542,getRef:p,"aria-labelledby":"attachment-audio-list-modal-header-title","data-testid":"attachment-audio-list-modal",children:[(0,n.Y)(s.wyA,{onClick:i,"data-testid":"attachment-audio-list-modal-dismiss-button",children:u.getLang("global_close")}),!!e&&(0,n.Y)(r.r,{children:e}),(0,n.Y)(a.c,{insetLevel:1,children:t})]})}))},699685:(e,t,i)=>{i.d(t,{G:()=>d});var n=i(221020),o=i(652097),s=i(187233),r=i(180329),a=i(871048);const d=({count:e=5})=>{const t=(0,o.Kz)(e);return(0,n.Y)(n.FK,{children:(0,n.Y)(s.i,{mode:"vertical",spacing:16,paddingTop:16,paddingBottom:16,children:(0,n.Y)(s.i,{mode:"vertical",spacing:4,paddingTop:4,paddingBottom:4,children:(0,n.Y)(r.s,{direction:"column",gap:8,children:t.map((e=>(0,n.Y)(a.k,{contentWidth:316,size:"m"},e)))})})})})}},110970:(e,t,i)=>{i.d(t,{L:()=>r});var n=i(221020),o=i(187233),s=i(46284);const r=()=>(0,n.Y)(o.i,{children:(0,n.Y)(s.E,{width:120})})},989442:(e,t,i)=>{i.d(t,{K:()=>p});var n=i(221020),o=i(891719),s=i(432317),r=i(595253),a=i(699685),d=i(110970),c=i(819377);var l=i(573503);const h=(0,o.F)({loader:async()=>{const{AttachmentAudioListModal:e}=await Promise.all([i.e(27255),i.e(97708),i.e(61308),i.e(46344),i.e(86602),i.e(62044),i.e(69094),i.e(8785),i.e(30392),i.e(35162),i.e("langs/core_spa/audio_modals_AudioListModal")]).then(i.bind(i,181576));return e},name:"AttachmentAudioListModal",DefaultLoading:()=>(0,n.Y)(c.l,{header:(0,n.Y)(d.L,{}),children:(0,n.Y)(a.G,{})}),DefaultLoadingError:l.p});function p(e,t={}){return(0,s.Ny)((({onClose:t,refreshCoordinates:i})=>(0,n.Y)(r.R,{children:(0,n.Y)(h,{...e,refreshCoordinates:i,onClose:t})})),{...t,width:542,hideOnBGClick:!0,fullscreen:!1,zLayer:u(e.postId)})}function u(e){return`attachment_audio_list${e}`}},642532:(e,t,i)=>{i.d(t,{n:()=>Ct});var n=i(221020),o=i(356035),s=i(754694),r=i(486526),a=i(634164),d=i(339672),c=i(799649),l=i(772812),h=i(265231),p=i(638945),u=i(440779),m=i(982444),g=i(946918),_=i(556067),v=i(101214),f=i(908709),w=i(331635),y=i(42107),b=i(327813),C=i(802872),k=i(127574),I=i(443660),S=i(650433),A=i(916533),P=i(273193),L=i(97929),O=i(144819),E=i(725308),x=i(452200),Y=i(978178),M=i(874719),T=i(383483),R=i(407072),D=i(946333),B=i(69789),F=i(445426),N=i(684574),z=i(819048),j=i(533293),U=i(967747);class W{get videosLimit(){const e=this._attachments.filter((e=>"video"===e.type)),t=e.filter((e=>!(0,z.mn)(e.video)));return U.sr-(this._attachments.length-e.length+t.length)}get photosLimit(){const e=this._attachments.filter((e=>"photo"===e.type)),t=e.filter((e=>!(0,D.XI)(e.photo)));return U.sr-(this._attachments.length-e.length+t.length)}get audiosLimit(){const e=this._attachments.filter((e=>"audio"===e.type));return U.sr-(this._attachments.length-e.length)}get filesLimit(){const e=this._attachments.filter((e=>"doc"===e.type));return U.sr-(this._attachments.length-e.length)}get attachments(){return this._attachments}get files(){return this._attachments.filter((e=>"doc"===e.type)).map((e=>e.doc))??[]}get videos(){return this._attachments.filter((e=>"video"===e.type&&(0,z.mn)(e.video))).map((e=>e.video))??[]}get photos(){return this._attachments.filter((e=>"photo"===e.type&&(0,D.XI)(e.photo))).map((e=>e.photo))??[]}get audios(){return this._attachments.filter((e=>"audio"===e.type&&e.audio)).map((e=>e.audio))??[]}get canAttachMore(){return this._attachments.length<U.sr}get apiAttachments(){return this._attachments.map((e=>this.makeStringAttachment(e))).join(",")}get isUploadingAttachments(){return this._progressUploadingAttachments.size>0}get progressUploadingAttachmentsArray(){return[...this._progressUploadingAttachments.values()]}get isEmptyAttachments(){return 0===this._attachments.length}get currentPicker(){return this._currentPicker}get uploaderCallbacks(){return{maxAttachmentsCount:U.sr-this._attachments.length,updatePhoto:(e,t)=>{this.removeProgressUploadingAttachment(t),Number(e.orig_photo?.height)<B.Bf||Number(e.orig_photo?.width)<B.Bf?this.onShowError(this.langs.getLang("wall_posting_file_size_below_minimum_text"),this.langs.getLang("wall_posting_file_size_below_minimum_subtitle")):this.setAttachment({type:"photo",photo:e})},updateVideo:(e,t,i)=>{t===R.q.Encoded?(i&&this.removeProgressUploadingAttachment(i),this.setAttachment({type:"video",video:e})):i&&this.updateProgressUploadingAttachments(i,{id:e.id??Number(i)})},errorVideo:(e,t,i)=>{i?.error?.error_text?this.onShowError(i.error.error_text):i?.error?.error_msg?this.onShowError(i?.error?.error_msg):this.onShowError(this.langs.getLang("wall_posting_video_general_upload_error_text")),this.removeAttachment("video",e,t),this.removeProgressUploadingAttachment(String(e)),this.uploadManager.videoUploadService.removeVideo(e,t)},errorPhoto:({id:e,ownerId:t,temporaryId:i,errorCode:n})=>{n===B.GJ?this.onShowError(this.langs.getLang("wall_posting_photo_wrong_size_error_text")):this.onShowError(this.langs.getLang("wall_posting_photo_general_upload_error_text")),this.removeAttachment("photo",e,t),this.removeProgressUploadingAttachment(i),this.uploadManager.photoUploadService.removePhoto(i)},setFilteredFiles:async e=>{for(const t of e)this._ownerId&&t.name&&this.setProgressUploadingAttachments(t.id,{id:Number(t.id),ownerId:this._ownerId,name:t.name,fileId:t.id})},getAttachmentsLength:()=>this.attachments.length,onUnsupportedFileFormatError:()=>{this.onShowError(this.langs.getLang("wall_posting_file_unsupported_format_text"),this.langs.getLang("wall_posting_file_unsupported_format_subtitle"))},onUnsupportedVideoFormatError:()=>{this.onShowError(this.langs.getLang("wall_posting_video_unsupported_format_text"),this.langs.getLang("wall_posting_video_unsupported_format_subtitle"))},onUnsupportedPhotoFormatError:()=>{this.onShowError(this.langs.getLang("wall_posting_photo_unsupported_format_text"),this.langs.getLang("wall_posting_photo_unsupported_format_subtitle"))},onLimitExceededError:()=>{this.onShowError(this.langs.getLang("wall_posting_attachment_limit_exceeded_text"),this.langs.numeric(U.sr,this.langs.getLang("wall_attachments_limit_exceeded_subtitle",!0)))},onSizeExceedsLimitError:()=>{this.onShowError(this.langs.getLang("wall_posting_file_size_exceeds_limit_text"),this.langs.getLang("wall_posting_file_size_exceeds_limit_subtitle"))},onBlockedVideoError:(e,t)=>{this.onShowError(this.langs.getLang("wall_posting_video_blocked_upload_text"),this.langs.getLang("wall_posting_video_blocked_upload_subtitle")),this.removeProgressUploadingAttachment(String(e)),this.removeAttachment("video",e,t),this.uploadManager.videoUploadService.removeVideo(e,t)}}}constructor(e,t,i,n){this.authService=e,this.snackbar=t,this.langs=i,this.uploadManager=n,this._currentPicker=null,this._attachments=[],this._progressUploadingAttachments=new Map,this.setInitialAttachments=e=>{this._attachments=[...e]},this.resetAttachments=()=>{this._attachments.forEach((e=>{const{type:t,itemId:i,ownerId:n}=(0,F.AJ)(e);this.uploadManager.removeAttachment(t,i,n)})),this._attachments=[]},this.setAttachment=e=>{const{itemId:t,ownerId:i}=(0,F.AJ)(e),n=this._attachments.findIndex((0,F.tx)(e.type,t,i));-1!==n?this._attachments[n]=e:this.canAttachMore&&this._attachments.push(e)},this.setAttachments=e=>{e.forEach((e=>this.setAttachment(e)))},this.onSelectVideos=e=>{e.forEach((e=>{this.setAttachment({type:"video",video:e})})),this.onClosePicker()},this.onSelectPhotos=e=>{e.forEach((e=>{this.setAttachment({type:"photo",photo:e})})),this.onClosePicker()},this.onSelectFile=e=>{e.forEach((e=>{this.setAttachment({type:"doc",doc:e.data})})),this.onClosePicker()},this.onSelectAudios=e=>{e.forEach((e=>{this.setAttachment({type:"audio",audio:e})})),this.onClosePicker()},this.onSelectAudioPlaylist=e=>{this.setAttachment({type:"audio_playlist",audio_playlist:e}),this.onClosePicker()},this.removeAttachment=(e,t,i)=>{const n=this._attachments.findIndex((0,F.tx)(e,t,i));return!(!(0,N.E)(n)||-1===n)&&(this.uploadManager.removeAttachment(e,t,i),this._attachments.splice(n,1)?.[0])},this.makeStringAttachment=e=>{if(!e)return"";const{itemId:t,ownerId:i}=(0,F.AJ)(e);return`${e.type}${i}_${t}`},this.removeProgressUploadingAttachment=e=>{this._progressUploadingAttachments.delete(e)},this.setProgressUploadingAttachments=(e,t)=>{this._progressUploadingAttachments.set(e,t)},this.updateProgressUploadingAttachments=(e,t)=>{const i=this._progressUploadingAttachments.get(e);i&&this._progressUploadingAttachments.set(e,{...i,...t})},this.onCancelUpload=e=>{this.uploadManager.cancelUpload(e.fileId),this.removeProgressUploadingAttachment(e.fileId),this.uploadManager.removeAttachment("video",e.id,e.ownerId)},this.onOpenPicker=e=>{this._currentPicker=e},this.onClosePicker=()=>{this._currentPicker=null},this.onDeletePhotoClick=(e,t)=>{t.stopPropagation(),this.removeAttachment("photo",e.id,e.owner_id)},this.onDeleteVideoClick=(e,t)=>{t.stopPropagation(),this.removeAttachment("video",e.id,e.owner_id)},this.onDeleteAudioClick=e=>{e&&("artist"in e?this.removeAttachment("audio",e.id,e.owner_id):this.removeAttachment("audio_playlist",e.id,e.owner_id))},this.onDeleteLinkClick=e=>{if(!e)return;let t=-1;"app"in e?t=this._attachments.findIndex((t=>"mini_app"===t.type&&"mini_app"in t&&t.mini_app?.app?.id===e.app?.id)):"url"in e&&(t=this._attachments.findIndex((t=>["link","article"].includes(t.type)&&("link"in t&&t.link?.url===e.url||"article"in t&&t.article?.url===e.url)))),(0,N.E)(t)&&-1!==t&&this._attachments.splice(t,1)},this.onDeleteDocClick=e=>{this.removeAttachment("doc",e.id,e.owner_id)},this.onShowError=(e,t)=>{this.snackbar.show({type:"error",text:e,subtitle:t})},(0,b.l_)(this),this._ownerId=this.authService.userId,this._ownerId&&this.uploadManager.setOwnerId(this._ownerId),this.uploadManager.setMaxAttachmentsCount(U.sr),this.uploadManager.setCallbacks(this.uploaderCallbacks)}}W=(0,w.Cg)([y.z8.transient(),(0,w.Sn)("design:type",Function),(0,w.Sn)("design:paramtypes",[void 0===A.u?Object:A.u,void 0===L.q?Object:L.q,void 0===P.Y?Object:P.Y,void 0===j.B?Object:j.B])],W);var $=i(830443),H=i(160010);class V{get config(){return this.props.current}get error(){return this._error}get maxTextLimit(){return this.config.maxTextLimit??U.x6}get postRawId(){return(0,O.WO)({id:this.config.postId,ownerId:this.config.postOwnerId})}get communityGroupId(){return E.z.convertOwnerIdToGroupId(Number(this.config.postOwnerId))}get editingComment(){return this.config.editingComment}get inputValue(){return this._inputValue}get inputState(){const e=this._inputValue?.trim();return e||0!==this.commentsAttachmentsService.attachments.length?this._inputState:"empty"}get inputValueWithReply(){return`${this._inputReplyName}${this._inputValue}`}get inputValueLengthWarning(){return(0,S.C)({value:this.inputValueWithReply,maxLength:this.maxTextLimit,getExceededLengthLabel:e=>this.langs.numeric(e,this.langs.getLang("global_recommended_exceeded",!0)),getRemainingLengthLabel:e=>this.langs.numeric(e,this.langs.getLang("text_N_symbols_remain",!0))})}get commentOwnerId(){return this._commentOwnerId}get commentOwner(){return this.commentOwnerId?this.commentsService.getOwner(this.commentOwnerId):void 0}get isAdmin(){if(this.commentOwner&&"admin_level"in this.commentOwner&&"is_admin"in this.commentOwner){const e=this.commentOwner.admin_level===Y.y.EDITOR,t=this.commentOwner.admin_level===Y.y.ADMINISTRATOR;return Boolean(this.commentOwner.is_admin&&(e||t))}return!1}get isEditingMode(){return Boolean(this.editingComment)}get groupsCanPost(){return Boolean(this.store.getCommentsMetaByPost(this.postRawId)?.groups_can_post)}get replyCommentId(){return this.config.replyCommentId}get replyComment(){if(this.replyCommentId)return this.store.getComment(this.replyCommentId)}get replyCommentOwner(){if(this.replyComment)return this.commentsService.getOwner(this.replyComment?.from_id)}get replyCommentOwnerNameDat(){return this.replyCommentOwner?(0,I.H)(this.replyCommentOwner,!1,"dat"):""}get currentUserId(){return this.authService.userId}get isInputLoading(){return"saving"===this.inputState||"deleting"===this.inputState}get isInputSaving(){return"saving"===this.inputState}get isInputDeleting(){return"deleting"===this.inputState}get isEmptyInputValue(){return"empty"===this.inputState}get isSendDisabled(){return this.isInputLoading||this.commentsAttachmentsService.isUploadingAttachments||this.config.disabled||this.commentsAttachmentsService.isEmptyAttachments&&this.isEmptyInputValue}get replyMultiline(){return Boolean(this.store.replyMultiline)}get isFocused(){return this.props.current.isFocused}[y.Ts](){this.props.current.isInThread||this.commentActionsService.emitter.listenable.on("focusCommentInput",this.handleFocusRequest)}[y.zr](){this.commentActionsService.emitter.listenable.off("focusCommentInput",this.handleFocusRequest),this.reactions.destroy()}constructor(e,t,i,n,o,s,r,a,d){this.props=e,this.store=t,this.commentsService=i,this.authService=n,this.langs=o,this.linkParsingManager=s,this.commentsAttachmentsService=r,this.commentActionsService=a,this.snackbar=d,this.reactions=new $.O,this._inputValue="",this._inputReplyName="",this._inputState="default",this._commentOwnerId=null,this._error=null,this._inputElement=null,this.initEditingData=e=>{this.resetField(),e?(e.attachments&&this.commentsAttachmentsService.setInitialAttachments(e.attachments),this._commentOwnerId=e.from_id,this._inputValue=e.text.replace(/\[\s*#blur\|([^|\]]+)\|[^\]]*]/g,((e,t)=>t)),this.linkParsingManager.parseText(e.text)):this._commentOwnerId=this.authService.userId},this.updateInputReplyName=()=>{if(!this.replyCommentOwner)return void(this._inputReplyName="");const e=(0,I.H)(this.replyCommentOwner,!1);this._inputReplyName=`${e}, `},this.setError=e=>{this._error=e,this.props.current.showErrorsInSnackbars&&e&&this.snackbar.show({type:"error",text:e})},this.setInputValue=e=>{if(this.linkParsingManager.parseText(e),this._inputReplyName&&e.startsWith(this._inputReplyName))this._inputValue=e.slice(this._inputReplyName.length);else{if(this._inputReplyName&&this._inputReplyName.startsWith(e))return this._inputReplyName=e,void(this._inputValue="");this._inputReplyName="",this._inputValue=e}},this.setInputState=e=>{this._inputState=e},this.resetInputValue=()=>{this._inputValue=""},this.resetInputState=()=>{this._inputState="default"},this.setCommentOwnerId=e=>{this._commentOwnerId=e},this.createComment=async(e,t)=>{if(this.isInputLoading)return;this.setInputState("saving"),this._inputElement&&!this._inputElement.textContent&&!this._inputElement.innerHTML&&this.inputValue&&this.setInputValue("");const i=E.z.isGroupId(Number(this.commentOwnerId)),n=E.z.convertOwnerIdToGroupId(Number(this.commentOwnerId));try{const{comment_id:o}=await this.commentsService.createComment({message:this.inputValueWithReply.trim()??"",attachments:this.commentsAttachmentsService.apiAttachments,reply_to_comment:this.replyCommentId?(0,x.v)(this.replyCommentId).id:void 0,post_id:this.config.postId,owner_id:this.config.postOwnerId,sticker_id:e,from_group:i&&n?n:0,entry_point:this.props.current.entryPoint,track_code:this.props.current.trackCode,ref:this.props.current.screen});(0,b.h5)((()=>{const i=void 0===e||!this.inputValue;o&&this.config.onCommentCreated?.({commentId:o,commentOwnerId:this.commentOwnerId??0,isReply:Boolean(this.replyCommentId),isPopupSticker:t,shouldResetReply:i}),i?this.resetField():this.setInputState("default")}))}catch{this.setInputState("default"),this.setError(this.langs.getLang("wall_cannot_create_comment_error_text"))}},this.editComment=async()=>{if(this.editingComment&&!this.isInputLoading){this.setInputState("saving");try{await this.commentsService.editComment({message:this.inputValueWithReply??"",attachments:this.commentsAttachmentsService.apiAttachments,post_id:this.config.postId,owner_id:this.config.postOwnerId,comment_id:this.editingComment.id},{commentRawId:this.editingComment.rawId,attachmentsData:[...this.commentsAttachmentsService.attachments]}),(0,b.h5)((()=>{if(this.editingComment){const e=this.store.getComment(this.editingComment.rawId);e&&this.config.onCommentEdited&&this.config.onCommentEdited(e)}this.setInputState("default")})),await this.commentsService.fetchComment({owner_id:this.config.postOwnerId,comment_id:this.editingComment.id}),this.config.onHideInput?.()}catch(e){(0,b.h5)((()=>{(0,H.d)(e)&&"Access denied: post or comment deleted"===e.error.error_msg?(this.snackbar.show({type:"error",text:this.langs.getLang("wall_msgalreadydeleted")}),this.deleteComment()):(this.setInputState("default"),this.setError(this.langs.getLang("wall_cannot_edit_comment_error_text")))}))}}},this.resetReplyCommentId=()=>{this.config.resetReplyCommentId?.()},this.deleteComment=()=>{this.setInputState("deleting"),this.config.deleteComment?.()},this.resetEditMode=()=>{this.config.resetEditMode?.()},this.onSendClick=()=>{this.isEditingMode?this.editComment():this.createComment()},this.setReplyMultiline=e=>{this.store.replyMultiline=e},this.onHideInput=()=>{this.config.onHideInput?.()},this.onFocusInput=e=>{this.config.onFocus?.(e)},this.resetField=()=>{this.setInputState("default"),this.resetInputState(),this.resetInputValue(),this.linkParsingManager.clearParsedUrls(),this.commentsAttachmentsService.resetAttachments()},this.scrollToReplyComment=()=>{this.replyCommentId&&this.props.current.scrollToComment?.(this.replyCommentId)},this.handleFocusRequest=({postId:e,postOwnerId:t})=>{e===this.props.current.postId&&t===this.props.current.postOwnerId&&this._inputElement?.focus({preventScroll:!this.props.current.noSticky})},this.setInputElement=e=>{this._inputElement=e},this.stickerPickerOpenEventSubscribe=e=>(this.commentActionsService.emitter.listenable.on("openStickerKeyboard",e),()=>{this.commentActionsService.emitter.listenable.off("openStickerKeyboard",e)}),this.linkParsingManager.setCallbacks({getAttachmentsLength:e=>e?this.commentsAttachmentsService.attachments.filter((({parsed:e})=>!e)).length:this.commentsAttachmentsService.attachments.length,getAttachments:()=>this.commentsAttachmentsService.attachments,onAddAttachments:e=>{["saving","empty"].includes(this.inputState)||this.commentsAttachmentsService.setAttachments(e.filter((e=>["photo","video"].includes(e.type))).map((e=>({...e,parsed:!0}))))}}),this.linkParsingManager.setMaxAttachmentsCount(U.sr),this.initEditingData(this.editingComment),this.replyCommentId&&this.updateInputReplyName(),this.reactions.reaction((()=>this.replyCommentId),this.updateInputReplyName),this.reactions.reaction((()=>this.editingComment),this.initEditingData),(0,b.l_)(this)}}V=(0,w.Cg)([y.z8.transient(),(0,w.Sn)("design:type",Function),(0,w.Sn)("design:paramtypes",[void 0===y.Ji?Object:y.Ji,void 0===C.g?Object:C.g,void 0===k.y?Object:k.y,void 0===A.u?Object:A.u,void 0===P.Y?Object:P.Y,void 0===T.M?Object:T.M,void 0===W?Object:W,void 0===M.s?Object:M.s,void 0===L.q?Object:L.q])],V);const{Provider:K,useModel:q}=(0,y.Qd)(V,{initInEffect:!1});var G=i(815287),J=i(671502),Q=i(685860),X=i(798865),Z=i(57596);var ee=i(90447),te=i(207037),ie=i(842514),ne=i(12584),oe=i(46644),se=i(597593);const re=550,ae=(0,o.P)((function({ownerId:e,currentUserId:t,isAdmin:i,commentsAttachmentsService:o}){const{onClosePicker:s,currentPicker:r,videos:a,photos:d,files:c,audios:l,filesLimit:h,photosLimit:p,videosLimit:u,audiosLimit:m,onSelectVideos:g,onSelectPhotos:_,onSelectFile:v,onSelectAudios:f,onSelectAudioPlaylist:w,onShowError:y}=o;if(e&&t)return(0,n.FD)(n.FK,{children:[(0,n.Y)(se.z,{id:"photo_picker_modal",type:"card",onClose:s,isShown:"photo"===r,children:(0,n.Y)(oe.n,{"aria-labelledby":"photo_picker_header",width:re,children:(0,n.Y)(ee.f,{onCloseModal:s,ownerId:String(e),currentUserId:t,photosLimit:p,totalLimit:U.sr,selectedPhotos:d,isAdmin:i,onPhotoSelect:_,sourceSelectorEnabled:!0,onError:y})})}),(0,n.Y)(se.z,{id:"video_picker_modal",type:"card",onClose:s,isShown:"video"===r,children:(0,n.Y)(oe.n,{"aria-labelledby":"video_picker_header",width:re,children:(0,n.Y)(te.G,{currentUserId:t,isAdmin:i,ownerId:String(e),closeModal:s,onVideoSelect:g,videosLimit:u,totalLimit:U.sr,selectedVideos:a,sourceSelectorEnabled:!0,onError:y})})}),(0,n.Y)(se.z,{id:"file_picker_modal",type:"card",onClose:s,isShown:"doc"===r,zIndex:999,children:(0,n.Y)(oe.n,{"aria-labelledby":"file_picker_header",width:re,children:(0,n.Y)(ie.N,{ownerId:String(e),closeModal:s,onAttach:v,selectedDocs:c,filesLimit:h,onError:y})})}),(0,n.Y)(se.z,{id:"audio_picker_modal",type:"card",onClose:s,isShown:"audio"===r,children:(0,n.Y)(oe.n,{"aria-labelledby":"audio_picker_header",width:re,children:(0,n.Y)(ne.l,{onSelect:f,onPlaylistSelect:w,onClose:s,selectedAudios:l,ownerId:i?e:t,currentUserId:t,isAdmin:i,audiosLimit:m,sourceSelectorEnabled:!0,multipleAudioSelectEnabled:!0,onError:y})})})]})}));var de=i(449522),ce=i(432729);const le=({disabled:e})=>{const t=(0,g.B)();return(0,n.Y)(ce.v,{children:({ref:i,...o})=>(0,n.Y)(h.g.IconButton,{disabled:e,"data-testid":"emoji-smile",getRootRef:i,hoverMode:"opacity",activeMode:"none",label:t.getLang("wall_reply_field_smile"),...o,children:(0,n.Y)(de._,{role:"presentation"})})})};var he=i(650135),pe=i(956250);const ue=1024,me=Math.pow(ue,2),ge=Math.pow(ue,3),_e=Math.pow(ue,4);class ve{constructor(e){this.langs=e,this.getFormatFileSize=e=>{let t=0,i="";if(e>_e)t=Math.round(e/_e*1e3)/1e3,i=this.langs.getLang("global_tb");else if(e>ge)t=Math.round(e/ge*100)/100,i=this.langs.getLang("global_gb");else if(e>me)t=Math.round(e/me*10)/10,i=this.langs.getLang("global_mb");else{if(!(e>ue))return this.langs.numeric(e,this.langs.getLang("global_bytes",!0));t=Math.round(e/ue),i=this.langs.getLang("global_kb")}return`${(0,pe.Z)(t)} ${i}`}}}ve=(0,w.Cg)([y.z8.global(),(0,w.Sn)("design:type",Function),(0,w.Sn)("design:paramtypes",[void 0===P.Y?Object:P.Y])],ve);var fe=i(847324);var we=i(167879),ye=i(436043),be=i(724567),Ce=i(738771);const ke=(0,o.P)((function({onPhotoClick:e,onVideoClick:t,postRawId:i,commentsAttachmentsService:o,platformConfig:s}){const{popupStore:r}=(0,ye.bl)(),a=(0,g.B)(),d=(0,y.NF)().resolve(ve),c=(0,y.NF)().resolve(fe.p),{attachments:l,onDeletePhotoClick:h,onDeleteVideoClick:p,onDeleteAudioClick:u,onDeleteDocClick:m,onDeleteLinkClick:_}=o,v=(0,be.w)(l,a)??[];if(v.length)return(0,n.Y)(he.w,{commentId:0,gap:"xl",formatDateTime:c.getFormatDateTime,formatSize:d.getFormatFileSize,attachments:v,deleteAriaLabel:a.getLang("global_delete"),onDeletePhotoClick:h,onDeleteVideoClick:p,onDeleteDocClick:m,onPhotoClick:e,onVideoClick:t,onCustomAttachmentRender:e=>(0,n.Y)(Ce.z,{attachment:e,postRawId:i,attachments:l,onDeleteAudioClick:u,onDeleteLinkClick:_,platformConfig:s},String("custom"in e?e.custom.id:e.type)),stickerAttachmentProps:(0,we.e)({attachment:(0,b.HO)(l[0]),popupStore:r})})})),Ie=(0,o.P)((function({progressAttachments:e,getPercents:t,onCancelUpload:i}){const o=(0,g.B)();if(e.length)return(0,n.Y)(n.FK,{children:e.map(((e,s)=>(0,n.Y)(h.g.UploadingAttachmentProgress,{index:s,name:e.name,progress:t(e.id,e.ownerId)??0,onCancel:()=>i?.(e),cancelLabel:o.getLang("global_cancel")},e.id)))})})),Se=({onPaste:e})=>{const t=(0,G.useRef)(null);return(0,G.useEffect)((()=>{const i=i=>{const n=t.current;n&&document.activeElement===n&&e(i)};return window.addEventListener("paste",i),()=>{window.removeEventListener("paste",i)}}),[e]),(0,G.useEffect)((()=>{const e=t.current;if(!e)return;const i=e=>{e.preventDefault()};return e.addEventListener("dragover",i,!0),e.addEventListener("drop",i,!0),()=>{e.removeEventListener("dragover",i,!0),e.removeEventListener("drop",i,!0)}}),[]),t};var Ae=i(516427),Pe=i(865940),Le=i(222304),Oe=i(749820),Ee=i(563063),xe=i(352039),Ye=i(916982);const Me=({disabled:e,onOpenPicker:t,onUploadFiles:i,inputAccept:o})=>{const s=(0,g.B)(),r=(0,G.useRef)(null);return(0,n.FD)(n.FK,{children:[(0,n.Y)(Ae.s6o,{Component:"input",type:"file",multiple:!0,accept:o,onChange:e=>{i(Array.from(e.target.files??[])),r.current&&(r.current.value="")},getRootRef:r}),(0,n.Y)(Ye.E,{Component:Pe.v,trigger:["hover","click"],content:(0,n.FD)(n.FK,{children:[(0,n.Y)(Pe.v.Item,{before:(0,n.Y)(Le.b,{role:"presentation"}),onClick:()=>r.current?.click?.(),"data-testid":"comment_upload_from_device",children:s.getLang("wall_posting_download_from_device")}),(0,n.Y)(Pe.v.Item,{before:(0,n.Y)(f.$,{role:"presentation"}),onClick:()=>t("photo"),"data-testid":"comment_upload_photo",children:s.getLang("global_wall_photo")}),(0,n.Y)(Pe.v.Item,{before:(0,n.Y)(Oe.J,{role:"presentation"}),onClick:()=>t("video"),"data-testid":"comment_upload_video",children:s.getLang("global_video")}),(0,n.Y)(Pe.v.Item,{onClick:()=>t("audio"),before:(0,n.Y)(Ee.F,{}),"data-testid":"comment_upload_audio",children:s.getLang("profile_wall_audio")}),(0,n.Y)(Pe.v.Item,{onClick:()=>t("doc"),before:(0,n.Y)(xe.R,{}),"data-testid":"comment_upload_doc",children:s.getLang("wall_post_attach_doc")})]}),children:(0,n.Y)(h.g.IconButton,{disabled:e,hoverMode:"opacity",activeMode:"none","data-testid":"show-attach-dropdown",label:s.getLang("global_add_media"),children:(0,n.Y)(Le.b,{})})})]})};var Te=i(489445),Re=i(800687),De=i(877791);const Be=({replyMultiline:e,setReplyMultiline:t})=>{const i=(0,g.B)(),o=i=>{const n=Number(i.target.value);if(isNaN(n))return;const o=e;De.R.post("al_wall.php",{act:"a_save_ctrl_submit",value:n,hash:window.vk?.pollHash??""},{onFail:()=>{t(o)}}),t(Boolean(n)),window.Notifier&&window.Notifier.lcSend("wall_reply_multiline",{value:n})};return(0,n.FD)(Ae.z6M,{children:[(0,n.Y)(Te.s,{name:"submit_settings_1",value:0,checked:!e,onChange:o,children:(0,n.Y)(Re.I,{children:i.getLang("wall_reply_submit_settings_1")})},"submit_settings_1"),(0,n.Y)(Te.s,{name:"submit_settings_2",value:1,checked:e,onChange:o,children:(0,n.Y)(Re.I,{children:i.getLang("wall_reply_submit_settings_2")})},"submit_settings_2")]})},Fe="CommentField__wrapper--sgl6t",Ne=(0,o.P)((function(){const e=(0,g.B)(),t=q(),{commentOwnerId:i,resetReplyCommentId:o,replyCommentOwnerNameDat:w,inputValueWithReply:y,setInputValue:b,setInputElement:C,inputValueLengthWarning:k,commentsAttachmentsService:I,replyCommentId:S,isInputLoading:A,isFocused:P,createComment:L,onSendClick:O,onFocusInput:E,isSendDisabled:x,setCommentOwnerId:Y,isAdmin:M,currentUserId:T,postRawId:R,communityGroupId:D,error:B,setError:F,config:N,setReplyMultiline:z,replyMultiline:j,groupsCanPost:U,scrollToReplyComment:W}=t,{isUploadingAttachments:$,onCancelUpload:H,canAttachMore:V,progressUploadingAttachmentsArray:K,onOpenPicker:ee,uploadManager:te}=I,[ie,ne]=(0,G.useState)((0,J.M)()),oe=(0,G.useRef)(null),se=Se({onPaste:te.pasteFilesFromClipboard}),{handleInput:re}=(0,_.k)({inputValue:y,inputRef:se,onChangeInput:b,emojiOpts:{onUGCStickerSend:s.l,emojiLoadMore:s.l,ref:"wall_comment",global:!1,pickerBottomMargin:12,pickerHeight:450,noEnterSend:!0,noCancelEventWhenImagePaste:!0,onShowPicker:e=>{const t=e.closest("[data-index]");if(t){const e=t.previousElementSibling instanceof HTMLElement?t.previousElementSibling:null,i=t.nextElementSibling instanceof HTMLElement?t.nextElementSibling:null;requestAnimationFrame((()=>{t.style.zIndex="2",e&&(e.style.zIndex="1"),i&&(i.style.zIndex="1")}))}},onStickerSend:(e,t,i,n={})=>{L(e,Boolean(n.layers?.length))}},delayInit:!0});(0,G.useEffect)((()=>{C(se.current)}),[]),(0,G.useEffect)((()=>{const e=(0,r.s)((()=>ne((0,J.M)())),300);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,G.useEffect)((()=>{P&&se.current?.focus({preventScroll:!0})}),[P]),(0,G.useEffect)((()=>{S&&(se.current?.focus({preventScroll:!0}),oe.current&&!(0,Q.Y)(oe.current,50,null,{...ie,height:ie.height-61})&&oe.current.scrollIntoView({block:"center",behavior:"smooth"}))}),[S]);const de=(0,G.useCallback)((e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey||e.altKey;if(!x&&"Enter"===e.key&&(!j&&!t||j&&(e.ctrlKey||e.metaKey)))return e.preventDefault(),void O()}),[j,S,x]);return(0,G.useEffect)((()=>{const e=se.current;if(e)return e.addEventListener("keydown",de,!0),()=>{e.removeEventListener("keydown",de,!0)}}),[de]),(0,n.FD)(n.FK,{children:[(0,n.FD)("div",{className:(0,a.$)("_emoji_field_wrap",!S&&!N.noSticky&&Fe),children:[!!B&&(0,n.Y)(d.N,{header:B,text:e.getLang("wall_comment_error_subtitle"),mode:"negative",after:(0,n.Y)(c.K,{label:e.getLang("global_close"),onClick:()=>F(null),children:(0,n.Y)(v.u,{className:(0,l.I)("color_icon_secondary")})})}),(0,n.Y)(Z.M,{onChangeText:b,containerRef:oe,inputRef:se}),(0,n.Y)(h.g,{getRootRef:oe,getRef:se,maxLines:20,onInput:re,onSendClick:O,onFocus:E,placeholder:e.getLang("wall_comment_placeholder"),"aria-label":e.getLang("wall_comment_placeholder"),sendActionLabel:e.getLang("wall_send"),beforeAvatarSize:N.isInThread?20:28,marginRight:42,sendTooltip:{title:e.getLang("wall_reply_submit_settings"),description:(0,n.Y)(Be,{replyMultiline:j,setReplyMultiline:z})},top:!!w&&(0,n.Y)(p.LE,{children:(0,n.Y)(u.D,{before:e.getLang("wall_comment_reply_to"),onClearReply:o,onClick:W,clearLabel:e.getLang("global_close"),children:w})}),before:(0,n.FD)(n.FK,{children:[(0,n.Y)(m.K,{size:N.isInThread?8:4}),(0,n.Y)(X.v,{userByDefault:!0,communityGroupId:D,avatarSize:N.isInThread?20:28,disabled:A,onSelectAuthorId:Y,hasOtherGroups:U})]}),disabled:A,bottom:k&&(0,n.Y)(p.EY,{children:k}),sendDisabled:x,inlineAfter:(0,n.FD)(n.FK,{children:[V&&(0,n.FD)(n.FK,{children:[(0,n.Y)(Me,{disabled:A||$,onOpenPicker:ee,inputAccept:te.inputAccept,onUploadFiles:te.uploadFiles}),(0,n.Y)(h.g.IconButton,{disabled:A||$,"data-testid":"comment_upload_photo",hoverMode:"opacity",activeMode:"none",onClick:()=>ee("photo"),label:e.getLang("global_wall_photo"),children:(0,n.Y)(f.$,{role:"presentation"})})]}),(0,n.Y)(le,{disabled:A})]}),attachments:(0,n.Y)(ke,{onPhotoClick:N.onPhotoClick,onVideoClick:N.onVideoClick,postRawId:R,commentsAttachmentsService:I,platformConfig:N.customAttachmentsConfig}),uploadingAttachments:(0,n.Y)(Ie,{progressAttachments:K,getPercents:te.getPercents,onCancelUpload:H})})]}),(0,n.Y)(ae,{commentsAttachmentsService:I,ownerId:i,currentUserId:T,isAdmin:M})]})})),ze=(0,y.jn)(K,Ne);var je=i(771263),Ue=i(851417),We=i(56471);const $e=({disabled:e,onOpenPicker:t,inputAccept:i,onUploadFiles:o})=>{const s=(0,g.B)(),r=(0,G.useRef)(null);return(0,n.FD)(n.FK,{children:[(0,n.Y)(Ae.s6o,{Component:"input",type:"file",multiple:!0,accept:i,onChange:e=>o(Array.from(e.target.files||[])),getRootRef:r}),(0,n.Y)(We.f,{placement:"top",text:s.getLang("wall_posting_download_from_device"),children:(0,n.Y)(c.K,{noPadding:!0,label:s.getLang("wall_posting_download_from_device"),"data-testid":"comment_upload_from_device",disabled:e,onClick:()=>r.current?.click?.(),children:(0,n.Y)(Le.b,{})})}),(0,n.Y)(je.M.EditAttachmentAction,{"data-testid":"comment_upload_photo",ariaLabel:s.getLang("global_wall_photo"),type:"photo",disabled:e,onClick:()=>t("photo")}),(0,n.Y)(je.M.EditAttachmentAction,{"data-testid":"comment_upload_video",ariaLabel:s.getLang("global_video"),type:"video",disabled:e,onClick:()=>t("video")}),(0,n.Y)(je.M.EditAttachmentAction,{"data-testid":"comment_upload_audio",ariaLabel:s.getLang("profile_wall_audio"),type:"audio",disabled:e,onClick:()=>t("audio")}),(0,n.Y)(je.M.EditAttachmentAction,{"data-testid":"comment_upload_doc",ariaLabel:s.getLang("wall_post_attach_doc"),type:"doc",disabled:e,onClick:()=>t("doc")})]})},He=(0,o.P)((function(){const e=(0,g.B)(),t=q(),{inputValueWithReply:i,setInputValue:o,inputValueLengthWarning:r,commentsAttachmentsService:a,isInputLoading:u,isInputSaving:m,isInputDeleting:f,resetEditMode:w,deleteComment:y,editingComment:b,onSendClick:C,isSendDisabled:k,commentOwner:I,commentOwnerId:S,currentUserId:A,isAdmin:P,postRawId:L,error:O,setError:x,config:Y}=t,{isUploadingAttachments:M,canAttachMore:T,progressUploadingAttachmentsArray:R,uploadManager:D,onOpenPicker:B}=a,F=Se({onPaste:D.pasteFilesFromClipboard}),{handleInput:N}=(0,_.k)({inputValue:i,inputRef:F,onChangeInput:o,emojiOpts:{onUGCStickerSend:s.l,emojiLoadMore:s.l,ref:"wall_comment",global:!1,pickerBottomMargin:12,noEnterSend:!0,noStickers:!0,noStickersStore:!0,noCancelEventWhenImagePaste:!0}});if(!b||!I)return;return(0,n.FD)(n.FK,{children:[(0,n.Y)("div",{className:"_emoji_field_wrap",children:(0,n.Y)(je.M.Edit,{owner:(0,Ue.U)(I,E.z.isUserId(Number(b.from_id))),cancelActionLabel:e.getLang("global_cancel"),deleteActionLabel:e.getLang("global_delete"),sendActionLabel:e.getLang("wall_send"),deleting:f,onDeleteClick:y,onSendClick:C,onCancelClick:w,afterOwnerName:e.getLang("wall_editing_reply"),saving:m,sendDisabled:k,avatarSize:Y.isInThread?20:28,field:(0,n.FD)(n.FK,{children:[!!O&&(0,n.Y)(d.N,{header:O,text:e.getLang("wall_comment_error_subtitle"),mode:"negative",after:(0,n.Y)(c.K,{label:e.getLang("global_close"),onClick:()=>x(null),children:(0,n.Y)(v.u,{className:(0,l.I)("color_icon_secondary")})})}),(0,n.Y)(h.g.ContentEditable,{disabled:u,getRef:F,onInput:N,onKeyDown:e=>{if(!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)&&"Enter"===e.key&&!k)return e.preventDefault(),void C()},"aria-label":e.getLang("wall_comment_placeholder"),placeholder:e.getLang("wall_comment_placeholder"),inlineAfter:(0,n.Y)(le,{disabled:u})})]}),bottom:r&&(0,n.Y)(p.EY,{children:r}),attachmentActions:T&&(0,n.Y)($e,{disabled:u||M,onOpenPicker:B,inputAccept:D.inputAccept,onUploadFiles:D.uploadFiles}),attachments:(0,n.Y)(ke,{onPhotoClick:Y.onPhotoClick,onVideoClick:Y.onVideoClick,postRawId:L,commentsAttachmentsService:a,platformConfig:Y.customAttachmentsConfig}),uploadingAttachments:(0,n.Y)(Ie,{progressAttachments:R,getPercents:D.getPercents})})}),(0,n.Y)(ae,{commentsAttachmentsService:a,ownerId:S,currentUserId:A,isAdmin:P})]})})),Ve=(0,y.jn)(K,He);var Ke=i(187233),qe=i(180329),Ge=i(505174),Je=i(836382),Qe=i(347600),Xe=i(432317),Ze=i(799835);const et=(0,Qe.E)((()=>Promise.all([i.e(76475),i.e("langs/core_spa/BadgesRestrictedModal")]).then(i.bind(i,293840))),(({BadgesRestrictedModal:e})=>e));var tt=i(234213),it=i(587654);const nt="DonutBadge__wrapper--nRqvE",ot="DonutBadge__smallWrapper--ECBuy",st=(0,o.P)((function(){const{comment:e,isBadgesEnabled:t,config:i}=(0,it.s)();if(!e.donut_badge_info)return;const o=e.donut_badge_info.comment_text;return(0,n.FD)(n.FK,{children:[(0,n.Y)(m.K,{mode:"horizontal",size:8}),(0,n.Y)(Ke.i,{mode:"horizontal",spacing:o?6:12,onClick:()=>{t&&e.owner_id&&e.post_id?(0,tt.U)({objectId:{type:11,ownerId:e.owner_id,id:e.post_id},badgeId:e.badge_id,eventRef:"comment_img",donutMiniappUrl:i.donutMiniappUrl,handleSuccessfulPostDonut:i.handleSuccessfulPostDonut}):(0,Xe.tM)((e=>(0,n.Y)(et,{title:(0,Ze.Xo)("awards_not_available_tittle"),subtitle:(0,Ze.Xo)("awards_not_available_subheader"),buttonText:(0,Ze.Xo)("awards_not_available_button"),...e})))},className:(0,a.$)(nt,o&&ot),style:{backgroundColor:(s=e.donut_badge_info.background_color,4===(s=s.startsWith("#")?s.slice(1):s).length?"#"+s.substring(1,4)+s[0]:8===s.length?"#"+s.substring(2,8)+s.substring(0,2):"")},children:(0,n.FD)(qe.s,{direction:o?"row":"column",justify:o?"start":"center",align:"center",children:[(0,n.Y)(Ge.e,{src:`/images/donate/vk_donate_64_${(0,Je.Q)()?4:2}x.png`,alt:"",size:o?20:72}),(0,n.Y)(m.K,{mode:o?"vertical":"horizontal",size:4}),(0,n.Y)(p.EY,{className:(0,l.I)("color_text_contrast"),children:e.donut_badge_info.amount})]})}),(0,n.Y)(m.K,{mode:"horizontal",size:8})]});var s}));var rt=i(810921),at=i(398918),dt=i(508584),ct=i(863363),lt=i(457735),ht=i(48544),pt=i(663138),ut=i(989645),mt=i(439384),gt=i(150949),_t=i(936655),vt=i(162774),ft=i(142184),wt=i(623422),yt=i(989391),bt=i(944033);const Ct={count:20,countForPagination:20,threadCount:10,threadCountForPagination:20,CommentFieldComponent:ze,CommentEditComponent:Ve,hideThreadOnHover:!0,horizontalPadding:8,DonutBadge:st,withPopupStickers:!0,onPhotoClick:(e,t,i)=>{i.stopPropagation(),(0,rt.R)({postId:e,photo:t}).onClick?.(i)},onVideoClick:(e,t,i)=>{i.stopPropagation(),(0,at.wE)({postId:e,video:t}).onClick?.(i)},onStickerClick:e=>{(0,ct.J)({sticker_id:e})},obsceneTextAlertBox:{ModalComponent:se.z,ModalCardComponent:bt.x,dismissButtonMode:"outside",width:450},onReport:(...e)=>(0,gt.R)("wall_comment",...e),onShare:(e,t="")=>{if(!e.owner_id)return;const i=(0,O.WO)({id:e.id,ownerId:e.owner_id});(0,ft.A)("wall_reply",i,{trackCode:t,is_new:1,list:""})},onShowLikesList:({comment:e,type:t,reopenPostLayer:i,rawId:n})=>{e.owner_id&&(i&&n&&window.layerQueue?._layers.push(["wiki",`wall${n}`]),(0,lt.u)({w:`likes/${t}${e.owner_id}_${e.id}`},!1,!1,{queue:1}))},customAttachmentsConfig:{getAudioPlayerAdapter:_t.f,attachPlayerEventHandler:dt.fV,loadAudioPlayer:vt.e,secondaryAttachmentList:wt.I},onOpenStories:mt.Y,ownerMentionCard:{...yt.y,handleIconStatusClick:(e,t)=>{(0,pt.iB)(t.nativeEvent,{user_id:e})},ModalComponent:se.z,ModalCardComponent:bt.x,dismissButtonMode:"outside",openAnonymousBox:(e,t,i)=>ht.Unauthorized.showMoreBox(e?.nativeEvent??null,t,i),openChat:(e,t,i)=>(0,ut.z)(e,t,{params:{from:i}})}}},936655:(e,t,i)=>{i.d(t,{f:()=>s});var n=i(547214),o=i(111153);const s=()=>{const e=(0,n.MW)();return e?new o.F(e):void 0}},989391:(e,t,i)=>{i.d(t,{y:()=>n});const n={verificationInfoLink:"https://vk.com/blog/verification",verificationInfoTitleLink:"https://vk.com/verify",verificationByBusinessLink:"https://vk.com/@business-otmetky-dlya-biznesa",verificationByOtherServiceInfoLink:"https://id.vk.com/account/#/verifications",governmentPublicInfoLink:"https://vk.com/safety/10/32?article=22224"}},162774:(e,t,i)=>{i.d(t,{e:()=>n});const n=async e=>{window.stManager.add([window.jsc("web/audio.js")],e)}},150949:(e,t,i)=>{i.d(t,{R:()=>o});var n=i(614614);const o=(e,t,i,o,s,r)=>{(0,n.showReportForm)(r??e,t,i,(()=>{o?.()}),void 0,void 0,void 0,void 0,s)}},142184:(e,t,i)=>{i.d(t,{A:()=>o});var n=i(874394);const o=(e,t,i={},o)=>{n.P&&n.P.share(`${e}${t}`,i,o)}},439384:(e,t,i)=>{i.d(t,{Y:()=>o});var n=i(890172);const o=({storyOwnerId:e,source:t,rawId:i,reopenPostLayer:o})=>{o&&i&&window.layerQueue?._layers.push(["wiki",`wall${i}`]),(0,n.showStory)(`/owner_feed${e}`,{source:t,isCloseForwardPush:!1})}},623422:(e,t,i)=>{i.d(t,{I:()=>s});var n=i(980333),o=i(727341);const s={onRestrictedAudio:n.H,noHorizontalPaddingOnSecondary:!0,musicShowProgress:!0,getAction:o.a,secondaryAction:()=>({})}},734785:(e,t,i)=>{i.d(t,{d:()=>o});var n=i(20246);const o=e=>(0,n.d)({...e,platform:"web"})},321831:(e,t,i)=>{i.d(t,{h:()=>c});var n=i(331635),o=i(327813),s=i(42107),r=i(916533),a=i(434178),d=i(195578);class c{getUpdatedPoll(e,t){const i={votes:e.votes,answer_ids:e.answer_ids,friends:e.friends,answers:e.answers},n=structuredClone(i),o=i;return t?(o.votes=e.votes+1,o.answer_ids=[...e.answer_ids??[],...t],o.friends=[...e.friends??[],{id:this.authService.ensureUserId()}],t.forEach((e=>{const t=o.answers.find((({id:t})=>t===e));t&&t.votes++}))):(o.votes=e.votes-1,o.answer_ids=[],o.friends=e.friends?.filter((e=>e.id!==this.authService.ensureUserId())),e.answer_ids?.forEach((e=>{const t=o.answers.find((({id:t})=>t===e));t&&t.votes--}))),o.answers.forEach((e=>{e.rate=e.votes&&o.votes?+(e.votes/o.votes*100).toFixed(2):0})),{newState:o,oldState:n}}updatePoll(e,t){const{newState:i,oldState:n}=this.getUpdatedPoll(e,t);return Object.assign(e,i),()=>{(0,o.h5)((()=>Object.assign(e,n)))}}handleVote(e,t,i,n){if(e&&this.authService.userId){const o={owner_id:e.owner_id,poll_id:e.id,answer_ids:t.join(","),is_board:e.is_board?1:0,track_code:i};return this.feedEntitiesMutationService.doOptimisticMutation({key:`poll:${e.id}:addVote`,mutateApi:(e,t)=>this.pollsApi.addVote(e,{signal:t}),updateUi:()=>this.updatePoll(e,t),updateUiValue:o,onError:n})}}deleteVote(e,t,i){if(e&&this.authService.userId){const n={owner_id:e.owner_id,poll_id:e.id,is_board:e.is_board?1:0,track_code:t};return this.feedEntitiesMutationService.doOptimisticMutation({key:`poll:${e.id}:deleteVote`,mutateApi:(e,t)=>this.pollsApi.deleteVote(e,{signal:t}),updateUi:()=>this.updatePoll(e),updateUiValue:n,onError:i})}}constructor(e,t,i){this.authService=e,this.pollsApi=t,this.feedEntitiesMutationService=i,(0,o.l_)(this)}}c=(0,n.Cg)([s.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===r.u?Object:r.u,void 0===a.F?Object:a.F,void 0===d.K?Object:d.K])],c)},222302:(e,t,i)=>{i.d(t,{g:()=>u});var n=i(331635),o=i(327813),s=i(419692),r=i(651253),a=i(42107),d=i(802872),c=i(560527),l=i(20974),h=i(582876),p=i(848549);class u{async toggleCommentLikes(e,t,i,n){const o=Boolean(t?e.likes?.group_liked:e.likes?.user_likes),s={type:"comment",owner_id:e.owner_id,item_id:e.id,from_group:t?1:0,track_code:i,ref:n};return this.commentsMutationService.doOptimisticMutation({key:`comment:${e.id}:like`,mutateApi:(e,t)=>o?this.likesApi.delete(e,{signal:t}):this.likesApi.add(e,{signal:t}),updateUi:()=>this.commentsMutationService.updateCommentLikes(e.rawId,t),updateUiValue:s,onError:e=>{this.feedErrorService.handleNetworkError(e)}})}async fetchLikesList(e,t,i){try{const n=await this.likesApi.getList({...l.N,...t},{signal:i?.signal});(0,o.h5)((()=>{this.commentsMutationService.updateComment(e,{likesList:n,likes:{count:n.count}})}))}catch(e){(0,p.z)(e)||this.errorLogger.log(e)}}async ensureCommentItemLikesList(e,t){const i=this.commentsStore.getComment(e);if(i)return i.likesList?i.likesList:void await this.fetchLikesList(e,{type:"comment",count:3,item_id:i.id,owner_id:i.owner_id},t)}constructor(e,t,i,n,s){this.commentsStore=e,this.commentsMutationService=t,this.likesApi=i,this.feedErrorService=n,this.errorLogger=s,(0,o.l_)(this)}}u=(0,n.Cg)([a.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===d.g?Object:d.g,void 0===c.z?Object:c.z,void 0===s.d?Object:s.d,void 0===h.m?Object:h.m,void 0===r.v?Object:r.v])],u)},225093:(e,t,i)=>{i.d(t,{B:()=>u});var n=i(331635),o=i(42107),s=i(794345),r=i(327813),a=i(398035),d=i(739838),c=i(645189),l=i(767147);class h extends a.D{get feedType(){return`news:${s._6}`}getRequestPromise(e,t){return this.feedApi.getNewsFeedByTypeWithPrefetch({count:e.count,filters:s.ZL,fields:s.V7,start_from:e.start_from,feed_type:"top",forced_blocks:e.forced_blocks},{signal:t.signal,maxRetries:this.userEnv.getConfigValue("feed_requests_retries_count")?.["newsfeed.getByType"]})}constructor(e,t,i){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.userEnv=i,(0,r.Gn)(this,{feedType:r.EW})}}h=(0,n.Cg)([o.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===d.x?Object:d.x,void 0===l.f?Object:l.f,void 0===c.J?Object:c.J])],h);class p extends a.D{get feedType(){return`news:${s.ey}`}getRequestPromise(e,t){return this.feedApi.getNewsFeedWithPrefetch({count:e.count,filters:s.ZL,fields:s.V7,start_from:e.start_from,section:s.vu.news,forced_blocks:e.forced_blocks},{signal:t.signal,maxRetries:this.userEnv.getConfigValue("feed_requests_retries_count")?.["newsfeed.get"]})}constructor(e,t,i){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.userEnv=i,(0,r.Gn)(this,{feedType:r.EW})}}p=(0,n.Cg)([o.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===d.x?Object:d.x,void 0===l.f?Object:l.f,void 0===c.J?Object:c.J])],p);class u{get instance(){return this._newsfeedType===s._6?this.mainSmartFeedService:this.mainChronoFeedService}get newsfeedType(){return this._newsfeedType}setNewsFeedType(e){this._newsfeedType=e}constructor(e,t){this.mainChronoFeedService=e,this.mainSmartFeedService=t,this._newsfeedType=void 0,(0,r.l_)(this)}}u=(0,n.Cg)([o.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===p?Object:p,void 0===h?Object:h])],u)},20974:(e,t,i)=>{i.d(t,{N:()=>n});const n={extended:1,filter:"likes",fields:"photo_base,photo_50,photo_100,first_name_dat,last_name_dat,sex,is_friend",friends_only:3}},813655:(e,t,i)=>{i.d(t,{V:()=>l});var n=i(331635),o=i(327813),s=i(42107),r=i(99201),a=i(186742),d=i(414618),c=i(916533);class l{agreeBlurRestriction(e){return this.photosApi.agreeBlurRestriction(e)}addAudioToMyMusic(e){return this.audioApi.add(e)}async deleteAudioFromMyMusic({audio_id:e}){if(this.authService.userId)return this.audioApi.delete({audio_id:e,owner_id:this.authService.userId})}constructor(e,t,i,n){this.photosApi=e,this.faveApi=t,this.audioApi=i,this.authService=n,(0,o.l_)(this)}}l=(0,n.Cg)([s.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===r.U?Object:r.U,void 0===a.L?Object:a.L,void 0===d.B?Object:d.B,void 0===c.u?Object:c.u])],l)},746308:(e,t,i)=>{i.d(t,{D:()=>l});var n=i(331635),o=i(56670),s=i(327813),r=i(527110),a=i(42107),d=i(611891);const c=(0,i(860656).b)("StickersSettingsServiceInstance",(()=>({instance:null})),{version:1});class l{static ensure(){const e=c();return e.instance||(e.instance=new l),e.instance}async fetchSettings(){if((0,d.Kf)()){(0,d.qH)(),this.isGetSettingsLoading=!0;try{const{settings:e}=await this.api.getSettings({}),t=this.mapSettings(e);this.setSettingsData(t),(0,d.FA)({animationAutoplay:t.autoplay,popupAutoplayOnGet:t.popup.autoplayOnGet,popupAutoplayOnSend:t.popup.autoplayOnSend,popupDisabledPeerIds:t.popup.disabledPeerIds})}finally{this.isGetSettingsLoading=!1}}}get settings(){return{autoplay:this.isAutoplayAnimation,popup:this.popup}}async setSettings(e){this.isSetSettingsLoading=!0;try{const{settings:t}=await this.api.setSettings(e),i=this.mapSettings(t);return this.setSettingsData(i),(0,d.FA)({animationAutoplay:i.autoplay,popupAutoplayOnGet:i.popup.autoplayOnGet,popupAutoplayOnSend:i.popup.autoplayOnSend,popupDisabledPeerIds:i.popup.disabledPeerIds}),i}finally{this.isSetSettingsLoading=!1}}async setPopupSettings(e){this.isSetPopupSettingsLoading=!0;try{const t=await this.api.setPopupSettings(e),i=this.mapPopupSettings(t.popup);return this.popup=i,(0,d.YB)(t),i}finally{this.isSetPopupSettingsLoading=!1}}isPopupAnimationDisabledForUser(e){return this.popup.disabledPeerIds.includes(e)}enablePopupAnimationForUser(e){return this.setPopupSettings({name:"autoplay_disabled_peer_ids",value:1,chat_id:e})}disablePopupAnimationForUser(e){return this.setPopupSettings({name:"autoplay_disabled_peer_ids",value:0,chat_id:e})}mapSettings(e){return{autoplay:Boolean(e?.animation_autoplay),popup:this.mapPopupSettings(e?.popup)}}mapPopupSettings(e){return{autoplayOnGet:Boolean(e?.autoplay.on_get),autoplayOnSend:Boolean(e?.autoplay.on_send),disabledPeerIds:e?.autoplay?.disabled_peer_ids??[],isAutoplaySettingEnabled:Boolean(e?.flags?.disable_peer_ids),isInterruptCounterEnabled:Boolean(e?.flags?.animation_interrupter)}}setSettingsData(e){(0,s.h5)((()=>{this.isAutoplayAnimation=e.autoplay,this.popup=e.popup}))}constructor(){this.api=new r.l(new o.b),this.isGetSettingsLoading=!1,this.isSetSettingsLoading=!1,this.isSetPopupSettingsLoading=!1,this.isAutoplayAnimation=!1,this.popup={autoplayOnGet:!1,autoplayOnSend:!1,disabledPeerIds:[],isAutoplaySettingEnabled:!1,isInterruptCounterEnabled:!1},(0,s.l_)(this)}}l=(0,n.Cg)([a.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[])],l)},25313:(e,t,i)=>{i.d(t,{F:()=>a});var n=i(331635),o=i(327813),s=i(42107),r=i(337574);class a{update({modalId:e,data:t,force:i,type:n,actions:o,appearance:s}){const r=this.modalStore[e];r?this.modalStore[e].data=i?t:{...r?.data,...t}:this.modalStore[e]={data:t,actions:o,type:n,appearance:s}}reset(e){delete this.modalStore[e],e===this.currentModalId?this.modalsStack.pop():this.modalsStack=this.modalsStack.filter((t=>t!==e))}get currentModal(){return this.currentModalId&&this.modalStore[this.currentModalId]?this.modalStore[this.currentModalId]:null}get currentModalId(){const e=this.modalsStack.length;return 0===e?null:this.modalsStack[e-1]}get isCurrentModalOverlay(){return this.currentModal?.appearance===r.b.OVERLAY}get isLastModal(){return this.modalsStack.length<=1}show(e){const{type:t,data:i,actions:n,appearance:o=r.b.MODAL}=e,s=`${t}${Date.now()}`;return this.modalsStack.push(s),this.update({data:i??{},actions:n??{},appearance:o??r.b.MODAL,modalId:s,type:t,force:!0}),e=>{let i=e;if(i.data){const e=i.data;i={...i,...e},delete i.data}const n={data:i??{},type:t,appearance:o,modalId:s};this.update.call(this,n)}}constructor(){this.modalStore={},this.modalsStack=[],(0,o.l_)(this)}}a=(0,n.Cg)([s.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[])],a)},722934:(e,t,i)=>{i.d(t,{V:()=>c});var n=i(331635),o=i(42107),s=i(820282),r=i(645189),a=i(685431),d=i(174701);class c extends s.S{get namespace(){return"apps"}constructor(e,t,i){super(t,i),this.userEnv=e,this._apiClient=t,this._apiPrefetch=i,this.appsServiceMethods=new Map([["get","getMiniApp"],["getEmbeddedUrl","getMiniAppEmbeddedUrl"],["resolveScreenName","resolveMiniAppScreenName"],["getLaunchSecondaryParams","getMiniAppLaunchSecondaryParams"],["joinAndGet","joinAndGetMiniApps"]]),this.appsServiceEnabled=e=>this.userEnv.partConfigEnabled("frontend.spa_apps_api_service")&&!(this.userEnv.getConfigValue("spa_apps_api_service_exceptions")??[]).includes(e.app_id),this.makeAppsServiceMethod=(e,t)=>{const i=this.appsServiceMethods.get(e);return i?async(t,n,o)=>{const s={app_id:o,...t};if(!s.app_id)throw new Error(`app id must be provided for apps service method ${i}`);return this.makeMethod(this.appsServiceEnabled(s)?i:e)(t,n)}:this.makeMethod(e,t)},this.sendRequest=this.makeAppsServiceMethod("sendRequest"),this.getGenres=this.makeAppsServiceMethod("getGenres"),this.getApp=this.makeAppsServiceMethod("get"),this.getLaunchSecondaryParams=this.makeAppsServiceMethod("getLaunchSecondaryParams"),this.checkRequestFriend=this.makeAppsServiceMethod("checkRequestFriend"),this.checkInviteFriend=this.makeAppsServiceMethod("checkInviteFriend"),this.inviteFriend=this.makeAppsServiceMethod("inviteFriend"),this.getEmbeddedUrl=this.makeAppsServiceMethod("getEmbeddedUrl"),this.getMiniAppsCatalogWithPrefetch=this.makeAppsServiceMethod("getMiniAppsCatalog",!0),this.getMiniAppsCatalog=this.makeAppsServiceMethod("getMiniAppsCatalog"),this.getGamesCatalog=this.makeAppsServiceMethod("getGamesCatalog"),this.getGamesCatalogWithPrefetch=this.makeAppsServiceMethod("getGamesCatalog",!0),this.getWebGamesCatalog=this.makeAppsServiceMethod("getWebGamesCatalog"),this.getWebGamesCatalogWithPrefetch=this.makeAppsServiceMethod("getWebGamesCatalog",!0),this.getMVKGamesCatalog=this.makeAppsServiceMethod("getMVKGamesCatalog"),this.getMVKGamesCatalogWithPrefetch=this.makeAppsServiceMethod("getMVKGamesCatalog",!0),this.addToGroup=this.makeAppsServiceMethod("addToGroup"),this.getWebCatalog=this.makeAppsServiceMethod("getWebCatalog"),this.getWebCatalogWithPrefetch=this.makeAppsServiceMethod("getWebCatalog",!0),this.removeGame=this.makeAppsServiceMethod("removeGame"),this.install=this.makeAppsServiceMethod("install"),this.sendInstallRequest=this.makeAppsServiceMethod("sendInstallRequest"),this.downloadedGameRedirect=this.makeAppsServiceMethod("downloadedGameRedirect"),this.join=this.makeAppsServiceMethod("join"),this.joinAndGet=this.makeAppsServiceMethod("joinAndGet"),this.getGamesFeed=this.makeAppsServiceMethod("getGamesFeed"),this.deleteNotifications=this.makeAppsServiceMethod("deleteNotifications"),this.banRequest=this.makeAppsServiceMethod("banRequest"),this.restoreRequest=this.makeAppsServiceMethod("restoreRequest"),this.readAllNotifications=this.makeAppsServiceMethod("readAllNotifications"),this.allowNotifications=this.makeAppsServiceMethod("allowNotifications"),this.denyNotifications=this.makeAppsServiceMethod("denyNotifications"),this.deleteRequest=this.makeAppsServiceMethod("deleteRequest"),this.getCatalog=this.makeAppsServiceMethod("getCatalog"),this.getCatalogWithPrefetch=this.makeAppsServiceMethod("getCatalog",!0),this.getCollectionApps=this.makeAppsServiceMethod("getCollectionApps"),this.getCollectionAppsWithPrefetch=this.makeAppsServiceMethod("getCollectionApps",!0),this.getRecommendations=this.makeAppsServiceMethod("getRecommendations"),this.addToMenu=this.makeAppsServiceMethod("addToMenu"),this.removeFromMenu=this.makeAppsServiceMethod("removeFromMenu"),this.getFeedRecommendedGameBlock=this.makeAppsServiceMethod("getFeedRecommendedGameBlock"),this.onClickFeedRecommendedGameBlock=this.makeAppsServiceMethod("onClickFeedRecommendedGameBlock"),this.getStickerAchievements=this.makeAppsServiceMethod("getStickerAchievements"),this.getFriendsWithStickerAchievements=this.makeAppsServiceMethod("getFriendsWithStickerAchievements"),this.getActivity=this.makeAppsServiceMethod("getActivity"),this.getActivityWithPrefetch=this.makeAppsServiceMethod("getActivity",!0),this.getFeedRecommendedGamesCarousel=this.makeAppsServiceMethod("getFeedRecommendedGamesCarousel"),this.addAppToFeedBlackList=this.makeAppsServiceMethod("addAppToFeedBlackList"),this.getSettingsInfo=this.makeAppsServiceMethod("getSettingsInfo"),this.showAppFriends=this.makeAppsServiceMethod("showAppFriends"),this.getGroupsList=this.makeAppsServiceMethod("getGroupsList"),this.remove=this.makeAppsServiceMethod("remove"),this.uninstall=this.makeAppsServiceMethod("uninstall"),this.needToShowAction=this.makeAppsServiceMethod("needToShowAction"),this.setActionShown=this.makeAppsServiceMethod("setActionShown"),this.getActionMenuApps=this.makeAppsServiceMethod("getActionMenuApps"),this.getFriendsList=this.makeAppsServiceMethod("getFriendsList"),this.inviteMultipleFriend=this.makeAppsServiceMethod("inviteMultipleFriend"),this.recommend=this.makeAppsServiceMethod("recommend"),this.changeAppBadgeStatus=this.makeAppsServiceMethod("changeAppBadgeStatus"),this.getMiniAppsFeedCarousel=this.makeAppsServiceMethod("getMiniAppsFeedCarousel"),this.sendRecommendsCarouselLogs=this.makeAppsServiceMethod("sendRecommendsCarouselLogs"),this.getActionMenuBanner=this.makeAppsServiceMethod("getActionMenuBanner"),this.removeAppFromProfile=this.makeAppsServiceMethod("removeAppFromProfile"),this.addAppToProfile=this.makeAppsServiceMethod("addAppToProfile"),this.getMiniAppCategories=this.makeAppsServiceMethod("getMiniAppCategories"),this.getMiniAppCategoriesWithPrefetch=this.makeAppsServiceMethod("getMiniAppCategories",!0),this.replaceButtonInProfile=this.makeAppsServiceMethod("replaceButtonInProfile"),this.getAddToProfileModalCard=this.makeAppsServiceMethod("getAddToProfileModalCard"),this.getSimilarAppsList=this.makeAppsServiceMethod("getSimilarAppsList"),this.onCatalogOpen=this.makeAppsServiceMethod("onCatalogOpen"),this.onGamesCatalogOpen=this.makeAppsServiceMethod("onGamesCatalogOpen"),this.getGamesVideo=this.makeAppsServiceMethod("getGamesVideo"),this.getOpenPayFormUrl=this.makeAppsServiceMethod("getOpenPayFormUrl"),this.convertScopes=this.makeAppsServiceMethod("convertScopes"),this.saveAppSettings=this.makeAppsServiceMethod("saveApplicationSettings"),this.saveGroupSettings=this.makeAppsServiceMethod("saveGroupSettings"),this.getInfoAnonym=this.makeAppsServiceMethod("getInfoAnonym"),this.getLeaderboardByApp=this.makeAppsServiceMethod("getLeaderboardByApp"),this.startCall=this.makeAppsServiceMethod("startCall"),this.getBannedUsers=this.makeAppsServiceMethod("getBannedUsers"),this.banUser=this.makeAppsServiceMethod("banUser"),this.unbanUser=this.makeAppsServiceMethod("unbanUser"),this.clearRecents=this.makeAppsServiceMethod("clearRecents")}}c=(0,n.Cg)([o.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===r.J?Object:r.J,void 0===a.Q?Object:a.Q,void 0===d.C?Object:d.C])],c)},9443:(e,t,i)=>{i.d(t,{a:()=>r});var n=i(331635),o=i(820282),s=i(42107);class r extends o.S{get namespace(){return"newsfeed"}constructor(...e){super(...e),this.addBan=this.makeMethod("addBan"),this.deleteBan=this.makeMethod("deleteBan"),this.ignoreItem=this.makeMethod("ignoreItem"),this.unignoreItem=this.makeMethod("unignoreItem"),this.getLists=this.makeMethod("getLists")}}r=(0,n.Cg)([s.z8.global()],r)},104137:(e,t,i)=>{i.d(t,{S:()=>r});var n=i(331635),o=i(42107),s=i(820282);class r extends s.S{get namespace(){return"reports"}constructor(...e){super(...e),this.getReportFormData=this.makeMethod("getReportFormData"),this.add=this.makeMethod("add"),this.getReportSourcesFormData=this.makeMethod("getReportSourcesFormData"),this.getReasons=this.makeMethod("getReasons")}}r=(0,n.Cg)([o.z8.global()],r)},527110:(e,t,i)=>{i.d(t,{l:()=>r});var n=i(331635),o=i(42107),s=i(820282);class r extends s.S{get namespace(){return"stickers"}constructor(...e){super(...e),this.getSettings=this.makeMethod("getSettings"),this.setSettings=this.makeMethod("setSettings"),this.setPopupSettings=this.makeMethod("setPopupSettings"),this.getCollectiblePacks=this.makeMethod("getCollectiblePacks"),this.addPackToWishlist=this.makeMethod("addPackToWishlist"),this.removePackFromWishlist=this.makeMethod("removePackFromWishlist"),this.subscribePackAuthor=this.makeMethod("subscribePackAuthor"),this.unSubscribePackAuthor=this.makeMethod("unSubscribePackAuthor")}}r=(0,n.Cg)([o.z8.global()],r)},917818:(e,t,i)=>{i.d(t,{d:()=>r});var n=i(815287),o=i(888817),s=i(364517);function r(e,t){const i=(0,s.K)(e),r=(0,n.useMemo)((()=>(0,o.n)(i,t)),[i,t]);return(0,n.useEffect)((()=>()=>{r.cancel()}),[r]),r}},949849:(e,t,i)=>{i.d(t,{ML:()=>s,oi:()=>o});var n=i(722007);const o=({domain:e})=>e.createEffect((({query:e,controller:t,config:i,options:o})=>{const s=e.track_code?`,\n  track_code: '${e.track_code}'`:"",r=`\nvar addVoteResult = API.polls.addVote({\n  owner_id: ${e.owner_id},\n  poll_id: ${e.poll_id},\n  is_board: ${!!e.is_board},\n  answer_ids: '${e.answer_ids}'${s}\n});\n\nvar poll = API.polls.getById({\n  owner_id: ${e.owner_id},\n  poll_id: ${e.poll_id},\n  is_board: ${!!e.is_board},\n  extended: 1\n});\n\nreturn {\n  add_vote_result: addVoteResult,\n  poll: poll\n};`,a=t?.signal;return(0,n.FH)("execute",{code:r},i,{signal:a,...o})})),s=({domain:e})=>e.createEffect((({query:e,controller:t,config:i,options:o})=>{const s=e.track_code?`,\n  track_code: '${e.track_code}'`:"",r=`\nvar deleteVoteResult = API.polls.deleteVote({\n  owner_id: ${e.owner_id},\n  poll_id: ${e.poll_id},\n  is_board: ${!!e.is_board}${s}\n});\n\nvar poll = API.polls.getById({\n  owner_id: ${e.owner_id},\n  poll_id: ${e.poll_id},\n  is_board: ${!!e.is_board},\n  extended: 1\n});\n\nreturn {\n  delete_vote_result: deleteVoteResult,\n  poll: poll\n};`,a=t?.signal;return(0,n.FH)("execute",{code:r},i,{signal:a,...o})}))},758567:(e,t,i)=>{i.d(t,{k:()=>n});const n=e=>e.photo_base||e.photo_400||e.photo_200||e.photo_100||e.photo_50},800288:(e,t,i)=>{i.d(t,{y:()=>n});const n=window&&("ontouchstart"in window||"DocumentTouch"in window)},989671:(e,t,i)=>{i.d(t,{T:()=>s});var n=i(221020),o=i(516427);const s=({appearance:e,mode:t,...i})=>{const s=void 0===t&&"neutral"===e?"secondary":t,r=void 0===e&&"secondary"===t?"neutral":e;return(0,n.Y)(o.T0e,{...i,mode:s,appearance:r})}},289369:(e,t,i)=>{i.d(t,{x:()=>g});var n=i(221020),o=i(634164),s=i(772812),r=i(638945),a=i(880414),d=i(418356);const c="vkitRecommendationBadge__badge--hidLQ",l="vkitRecommendationBadge__badgeStyleOverlay--j23Ir",h="vkitRecommendationBadge__mediumBadgeWithPhoto--mNm83",p="vkitRecommendationBadge__smallBadgeWithPhoto--HA0Gg",u="vkitRecommendationBadge__usersStack--bTmxO",m={s:"vkitRecommendationBadge__smallBadge--A5vK8",m:"vkitRecommendationBadge__mediumBadge--24OrV"},g=({photos:e,text:t,size:i="m","data-testid":g})=>{const _="m"===i,v="s"===i,f=v?r.HL:r.tW,w=(0,o.$)(c,m[i],l,_&&Boolean(e)&&h,v&&Boolean(e)&&p);return e?(0,n.Y)("div",{className:w,"data-testid":g,children:(0,n.Y)(d.f,{className:u,photos:e,size:"s",children:(0,n.Y)(a.b,{TypographyComponent:f,Component:"span",className:(0,s.I)("color_text_contrast"),lines:1,children:t})})}):(0,n.Y)("div",{className:w,"data-testid":g,children:(0,n.Y)(a.b,{TypographyComponent:f,className:(0,s.I)("color_text_contrast"),lines:1,children:t})})}},88515:(e,t,i)=>{i.d(t,{$:()=>V});var n=i(221020),o=i(634164),s=i(838565),r=i(370633),a=i(187233),d=i(982444),c=i(289369),l=i(574857),h=i(560265),p=i(721126),u=i(799649),m=i(685441),g=i(685789),_=i(938950),v=i(993499);const f=({mode:e,closeAriaLabel:t,onClose:i,children:r})=>{const a=(0,s.D)();let c;switch(e){case"caption":c=(0,n.Y)(_.L,{aside:(0,n.Y)(_.R,{onClick:i,closeAriaLabel:t}),children:r});break;case"groupHeader":c=(0,n.FD)("div",{className:(0,o.$)(a&&v.A.headerDecreasedMargin),children:[(0,n.Y)(g.Q,{aside:(0,n.Y)("div",{className:(0,o.$)(v.A.iconButton,a&&v.A.iconButtonMobile),children:(0,n.Y)(u.K,{label:t,"data-testid":"recommendationblockheader-hide-button",onClick:i,noPadding:!0,hoverMode:"opacity",children:a?(0,n.Y)(l.u,{}):(0,n.Y)(h.S,{})})}),children:(0,n.Y)(m.Y,{mode:"primary",className:(0,o.$)(v.A.title,a&&v.A.titleIncreasedMargin),"data-testid":"recommendationblockheader-title",children:r})}),(0,n.Y)(d.K,{size:4})]});break;default:(0,p.S)(e)}return(0,n.Y)("div",{className:v.A.header,children:c})};var w=i(912812),y=i(584133),b=i(405697),C=i(409698),k=i(225505);const I=({withButton:e,...t})=>(0,n.Y)(w.K,{...t,buttonLabel:e?"placeholder":void 0,title:"t",subtitle:"s",tabIndex:-1,ariaHidden:!0,buttonTabIndex:-1,buttonAriaHidden:!0});var S=i(652097),A=i(815287),P=i(890486);const L=(0,S.Kz)(34).join(""),O=({hasDateHidden:e,...t})=>{const i=(0,A.useMemo)((()=>({title:L,owner:{name:"s",href:""},views:"0",date:e?void 0:"c"})),[e]);return(0,n.Y)(P.s,{...t,video:i})},E="vkitRecommendationPlaceholder__invisible--4IEhB",x=({size:e,cardProps:t})=>(0,n.Y)("div",{className:E,children:"video"===e?(0,n.Y)(O,{...t}):(0,n.Y)(I,{photoSize:e,...t})}),Y="vkitRecommendationContentError__root--YoApn",M="vkitRecommendationContentError__content--tPiMg",T="vkitRecommendationContentError__separator--IjbTb";var R=i(999051),D=i(151023);var B=i(728498),F=i(772812),N=i(516427),z=i(638945);const j="vkitRecommendationShowAllCard__card--M6IQm",U="vkitRecommendationShowAllCard__content--Es7yr",W="vkitRecommendationShowAllCard__icon--NWHsW",$={square:"vkitRecommendationShowAllCard__contentSizeSquare--G9Q0K",portrait:"vkitRecommendationShowAllCard__contentSizePortrait--SGVOy",video:"vkitRecommendationShowAllCard__contentSizeVideo--UCq4y"};var H=i(961636);const V=Object.assign((({mode:e,headerType:t,children:i,onClose:c,header:l,closeAriaLabel:h,bottomSpacing:p,wrapperMode:u,...m})=>{const g=(0,s.D)(),_=u??(g?"plain":"card");return(0,n.FD)(r.Y,{separator:"hide",mode:_,className:(0,o.$)("plain"===_&&H.A.blockWrapResetPadding),header:(0,n.Y)(a.i,{paddingTop:0,paddingBottom:0,spacing:g||"plain"!==_?0:8,mode:"vertical",children:(0,n.Y)(f,{mode:t??e,onClose:c,closeAriaLabel:h,children:l})}),...m,children:[(0,n.Y)(r.Y.ExpandedContent,{children:i}),p&&(0,n.Y)(d.K,{size:g?4:12})]})}),{ShowAllCard:({size:e,children:t,href:i,cardProps:s,"data-testid":r,...a})=>(0,n.FD)(N.SB4,{...a,href:i,className:j,hasActive:!1,hoverMode:"opacity",borderRadiusMode:"inherit","data-testid":r&&`${r}-rec-card-show-all`,children:[(0,n.FD)("div",{className:(0,o.$)(U,$[e]),children:[(0,n.Y)("div",{className:(0,o.$)(W,(0,F.I)("color_icon_medium")),children:(0,n.Y)(B.t,{})}),(0,n.Y)(z.LE,{weight:"2",className:(0,F.I)("color_icon_secondary"),children:t})]}),(0,n.Y)(x,{size:e,cardProps:s})]}),ContentError:({size:e,children:t,buttonLabel:i,hasSeparator:o,onButtonClick:s,cardProps:r})=>(0,n.FD)("div",{className:Y,children:[(0,n.Y)("div",{className:M,children:(0,n.Y)(b.O,{action:(0,n.Y)(C.$,{mode:"link",size:"m",onClick:s,children:i}),noPadding:!0,children:t})}),o&&(0,n.Y)(k.w,{className:T,appearance:"primary",wide:!0}),(0,n.Y)(x,{size:e,cardProps:r})]}),Card:w.K,LoadingCard:({size:e,cardProps:t,...i})=>(0,n.FD)("div",{...i,className:(0,o.$)(D.A.root,D.A.rootLoading,t&&"stretched"in t&&t.stretched&&D.A.stretchedRoot),children:[(0,n.Y)("div",{className:D.A.spinner,children:(0,n.Y)(R.y,{size:"regular"})}),(0,n.Y)(x,{size:e,cardProps:t})]}),Badge:c.x,CardSkeleton:y.F})},938950:(e,t,i)=>{i.d(t,{L:()=>v,R:()=>_});var n=i(221020),o=i(380977),s=i(634164),r=i(772812),a=i(799649),d=i(638945);const c="vkitPostCaption__container--budym",l="vkitPostCaption__content--ukfcR",h="vkitPostCaption__main--WfrQG",p="vkitPostCaption__aside--WfxOU",u="vkitPostCaption__iconButtonHoverArea--Wbrn3",m="vkitPostCaption__separator--YL22j",g="vkitPostCaption__separatorInIslands--hO8As",_=({onClick:e,closeAriaLabel:t})=>(0,n.Y)(a.K,{onClick:e,label:t,className:u,size:20,hoverMode:"opacity",activeMode:"opacity",noPadding:!0,style:{"--vkit_internal--post_caption_icon_button_hover_area_icon_size":"20px"},children:(0,n.Y)(o.Y,{className:(0,r.I)("color_icon_secondary")})}),v=({aside:e,children:t})=>(0,n.FD)("div",{className:c,children:[(0,n.FD)("div",{className:l,children:[(0,n.Y)("div",{className:h,children:(0,n.Y)(d.tW,{className:(0,r.I)("color_text_secondary"),children:t})}),!!e&&(0,n.Y)("div",{className:p,children:e})]}),(0,n.Y)("div",{className:(0,s.$)(m,g)})]})},612711:(e,t,i)=>{i.d(t,{W:()=>f});var n=i(221020),o=i(634164),s=i(838565),r=i(370633),a=i(187233),d=i(982444),c=i(961636),l=i(721126),h=i(685441),p=i(685789),u=i(46284),m=i(938950),g=i(993499);const _=({mode:e,children:t})=>{const i=(0,s.D)();let r;switch(e){case"caption":r=(0,n.Y)(m.L,{aside:(0,n.Y)(u.E,{width:20,height:20,circle:!0}),children:t||(0,n.Y)(u.E,{height:16,width:180})});break;case"groupHeader":const s=i?24:28;r=(0,n.FD)("div",{className:(0,o.$)(i&&g.A.headerDecreasedMargin),children:[(0,n.Y)(p.Q,{aside:(0,n.Y)("div",{className:(0,o.$)(g.A.iconButton,i&&g.A.iconButtonMobile),children:(0,n.Y)(u.E,{width:s,height:s,circle:!0})}),children:(0,n.Y)(h.Y,{mode:"primary",className:(0,o.$)(g.A.title,i&&g.A.titleIncreasedMargin),children:t||(0,n.Y)(u.E,{height:16,width:180})})}),(0,n.Y)(d.K,{size:4})]});break;default:(0,l.S)(e)}return(0,n.Y)("div",{className:g.A.header,children:r})};var v=i(584133);const f=Object.assign((({headerType:e,header:t,children:i,bottomSpacing:l,wrapperMode:h,...p})=>{const u=(0,s.D)(),m=h??(u?"plain":"card");return(0,n.FD)(r.Y,{separator:"hide",mode:m,className:(0,o.$)("plain"===m&&c.A.blockWrapResetPadding),header:(0,n.Y)(a.i,{paddingTop:0,paddingBottom:0,spacing:u||"plain"!==m?0:8,mode:"vertical",children:(0,n.Y)(_,{mode:e,children:t})}),...p,children:[(0,n.Y)(r.Y.ExpandedContent,{children:i}),l&&(0,n.Y)(d.K,{size:u?4:12})]})}),{CardSkeleton:v.F})},912812:(e,t,i)=>{i.d(t,{Eg:()=>C,K:()=>I,NZ:()=>k});var n=i(221020),o=i(925228),s=i(694346),r=i(637068),a=i(482199),d=i(634164),c=i(836085),l=i(978350),h=i(755659),p=i(999051),u=i(516427),m=i(799649),g=i(638945),_=i(180329),v=i(409698),f=i(800687),w=i(880414),y=i(289369),b=i(151023);const C={square:l.w.SQUARE,portrait:l.w.HIGH},k={square:{width:212,height:212/l.w.SQUARE},portrait:{width:212,height:212/l.w.HIGH}},I=({stretched:e,title:t,strikethroughTitle:i,strikethroughSubtitle:l,titleWeight:I="3",subtitle:S,spacing:A=0,image:P,imagePosition:L,badge:O,photoSize:E="square",badgeSize:x="m",buttonLabel:Y,buttonAriaHidden:M,buttonTabIndex:T,buttonAppearance:R="overlay",hideButtonIcon:D,hasButtonDisabled:B,hasButtonDone:F,hasButtonLoading:N,onButtonClick:z,closeAriaLabel:j,onClose:U,hide:W,onHide:$,verified:H,className:V,ariaHidden:K,"data-testid":q,...G})=>{const J=(0,c.a)(),Q={marginRight:W?0:`${A}px`,width:W?0:e?"100%":`${k[E].width}px`},X=(0,h.n)(P,L);return(0,n.Y)(u.SB4,{...G,activeMode:"background",hasHover:!0,className:(0,d.$)(b.A.root,W&&b.A.rootHidden,e&&b.A.stretchedRoot,V),style:Q,onTransitionEnd:e=>{W&&"opacity"===e.propertyName&&"0"===window.getComputedStyle(e.target).getPropertyValue("opacity")&&J()&&$?.(e)},"aria-hidden":K,"data-testid":q,children:(0,n.Y)("div",{className:b.A.in,children:(0,n.FD)("div",{className:(0,d.$)(b.A.card,b.A.cardBackgroundSecondary),children:[(0,n.FD)("div",{className:b.A.cover,children:[(0,n.Y)(u.glH,{ratio:C[E],children:(0,n.Y)("div",{className:b.A.img,style:X,"data-testid":q&&`${q}-rec-card-avatar`})}),U&&(0,n.Y)(m.K,{className:b.A.closeButton,noPadding:!0,activeMode:"opacity",label:j,onClick:U,"data-testid":q&&`${q}-rec-card-hide-button`,children:(0,n.Y)(r.M,{})}),O?(0,n.Y)(y.x,{text:O.text,photos:O.photos,size:x,"data-testid":q&&`${q}-rec-card-badge`}):null]}),(0,n.FD)("div",{className:b.A.caption,children:[(0,n.FD)("div",{className:b.A.title,children:[(0,n.Y)(w.b,{TypographyComponent:g.$j,lines:1,level:"1",weight:I,"aria-hidden":K,"data-testid":q&&`${q}-rec-card-title`,children:t}),H&&(0,n.Y)(a.T,{className:b.A.verify}),i&&(0,n.Y)(w.b,{lines:1,Component:g.tW,className:b.A.strikethroughTitle,"data-testid":q&&`${q}-rec-card-strikethrough-title`,children:(0,n.Y)(f.I,{children:i})})]}),(0,n.FD)(_.s,{align:"center",className:b.A.subtitle,children:[(0,n.Y)(w.b,{TypographyComponent:g.tW,weight:"3",lines:1,"aria-hidden":K,"data-testid":q&&`${q}-rec-card-description`,children:S.trim()?S:(0,n.Y)(n.FK,{children:" "})}),l&&(0,n.Y)(w.b,{lines:1,Component:g.tW,className:b.A.strikethroughTitle,"data-testid":q&&`${q}-rec-card-strikethrough-subtitle`,children:(0,n.Y)(f.I,{children:l})})]})]}),Y&&(0,n.Y)("div",{className:(0,d.$)(b.A.button,b.A.lagePadding),"aria-busy":N,"aria-live":"polite",children:(0,n.Y)(v.$,{className:(0,d.$)(N&&b.A.buttonLoading,B&&b.A.buttonDisabled,F&&b.A.buttonDone),appearance:R,before:D?null:N?(0,n.Y)(p.y,{size:"small"}):B?(0,n.Y)(o.X,{}):(0,n.Y)(s.w,{}),stretched:!0,size:"s",mode:"primary",disabled:B||N,onClick:z,tabIndex:T,"aria-hidden":M,"data-testid":q&&`${q}-rec-card-action-button-${F?"":"not-"}done`,children:Y})})]})})})};I.SIZE=Object.freeze(k)},584133:(e,t,i)=>{i.d(t,{F:()=>l});var n=i(221020),o=i(634164),s=i(516427),r=i(180329),a=i(46284),d=i(912812),c=i(151023);const l=({className:e,spacing:t,stretched:i,photoSize:l="square",withoutButton:h})=>{const p={marginRight:t?`${t}px`:void 0,width:i?"100%":`${d.NZ[l].width}px`};return(0,n.Y)("div",{className:(0,o.$)(c.A.root,e,i&&c.A.stretchedRoot),style:p,children:(0,n.Y)("div",{className:c.A.in,children:(0,n.FD)("div",{className:(0,o.$)(c.A.card,c.A.skeleton),children:[(0,n.Y)("div",{className:c.A.cover,children:(0,n.Y)(s.glH,{ratio:d.Eg[l],style:{width:"100%"},children:(0,n.Y)(a.E.Overlay,{borderRadius:"12px 12px 0 0",className:c.A.img,style:{position:"absolute"}})})}),(0,n.FD)("div",{className:c.A.caption,children:[(0,n.Y)("div",{className:c.A.title,children:(0,n.Y)(a.E,{height:18,width:"100%"})}),(0,n.Y)(r.s,{className:c.A.subtitle,children:(0,n.Y)(a.E,{height:16,width:"55%"})})]}),!h&&(0,n.Y)(r.s,{className:(0,o.$)(c.A.button,c.A.lagePadding),children:(0,n.Y)(a.E,{height:28,width:"100%"})})]})})})}},890486:(e,t,i)=>{i.d(t,{s:()=>C});var n=i(221020),o=i(634164);const s=e=>{(e=>{const{target:t,key:i}=e,n=t,{tagName:o}=n,s=n.getAttribute("role");return!(!0===n.isContentEditable||"INPUT"===o||"TEXTAREA"===o||"button"!==s&&"link"!==s||(" "!==i&&"Spacebar"!==i||"button"!==s)&&("A"===o&&n.hasAttribute("href")||"Enter"!==i))})(e)&&(e.preventDefault(),e.target.click?.())};var r=i(516427),a=i(423654),d=i(638945),c=i(355812),l=i(962644),h=i(880414),p=i(660223),u=i(877318),m=i(940485);const g="vkitSimpleVideoCard__card--Jt6pE",_="vkitSimpleVideoCard__videoContainer--lVKu6",v="vkitSimpleVideoCard__info--qXOJh",f="vkitSimpleVideoCard__owner--rKmZ4",w="vkitSimpleVideoCard__additional--v8eOV",y="vkitSimpleVideoCard__views--pmYWm",b=16/9,C=({className:e,video:t,ariaLabel:i=t.title,titleLines:C=1,hasViewsVisible:k,onVideoPreviewClick:I,onVideoTitleClick:S,onAuthorClick:A,onRestrictionButtonClick:P,getRef:L,videoCardPreviewLabel:O})=>{const{title:E,href:x,owner:Y,views:M,date:T,restriction:R}=t;return(0,n.FD)("div",{className:(0,o.$)(g,e),role:"button","aria-label":i,tabIndex:0,onKeyDown:s,children:[(0,n.Y)(l.h,{Component:r.glH,className:_,mode:"after",getRootRef:L,ratio:b,children:(0,n.FD)(m.Q,{onClick:I,href:x,children:["hidden"!==R?.mode&&(0,n.Y)(p.e,{...t,blurred:"blurred"===R?.mode,muted:"muted"===R?.mode,videoCardPreviewLabel:O}),R&&"muted"!==R.mode&&(0,n.Y)(u.U,{...R,onRestrictionButtonClick:P})]})}),(0,n.FD)("div",{className:v,children:[(0,n.Y)(h.b,{Component:a.N,TypographyComponent:d.$j,lines:C,mode:"primary",href:x,level:"2",noUnderline:!0,onClick:S,children:E}),(0,n.FD)(d.tW,{className:f,children:[(0,n.Y)(h.b,{Component:a.N,lines:1,mode:"secondary",href:Y.href,noUnderline:!0,onClick:A,children:Y.name}),M&&!k&&(0,n.FD)(n.FK,{children:[(0,n.Y)(c.O,{spacing:4}),(0,n.Y)("span",{className:y,children:M})]})]}),(M&&k||T)&&(0,n.FD)(d.tW,{className:w,children:[k&&M,k&&M&&T&&(0,n.Y)(c.O,{spacing:4}),T]})]})]})}},681772:(e,t,i)=>{i.d(t,{B:()=>P});var n=i(221020),o=i(455548),s=i(867227),r=i(126537),a=i(634164),d=i(196497),c=i(928959),l=i(772812),h=i(867129),p=i(982444),u=i(638945),m=i(962644);const g="vkitPrimaryAttachmentAlbum__container--MdwPb",_="vkitPrimaryAttachmentAlbum__alternate--pebZa",v="vkitPrimaryAttachmentAlbum__gradientShiftTop--b9UlI",f="vkitPrimaryAttachmentAlbum__backgroundCover--9lT6f",w="vkitPrimaryAttachmentAlbum__blur--uPlsg",y="vkitPrimaryAttachmentAlbum__disclaimer--s1OWT",b="vkitPrimaryAttachmentAlbum__labelIcon--lsbSk",C="vkitPrimaryAttachmentAlbum__info--bqtXn",k="vkitPrimaryAttachmentAlbum__description--ecYfo",I="blocked",S="hidden",A={hidden:o.V,sensitive:o.V,blocked:s.M},P=({url:e,cover:t,title:i,disclaimerType:o,disclaimer:s,hasBlur:P,albumInfoLabel:L,hiddenAlbumLabel:O,onClick:E,borderRadius:x,dataRole:Y})=>{let M;const T={"--primary-attachment-album-border-radius":(0,h.j)(x)},R=Boolean(t);let D;R&&(M={backgroundImage:`url(${t})`}),o&&s&&(D=A[o]);const B=o===S,F=o===I,N=B?O:i,z=(0,l.I)(R?"color_icon_contrast":"color_icon_secondary"),j=(0,l.I)(B||F?"color_text_secondary":"color_text_contrast");return(0,n.FD)(m.h,{style:T,Component:"a",href:e,className:(0,a.$)(g,!R&&_),onClick:E?e=>{(0,d.X)(e.nativeEvent)||(e.preventDefault(),(0,c.T)(e.nativeEvent),E?.(e))}:void 0,"data-role":Y,children:[R&&(0,n.Y)(m.h,{className:(0,a.$)(f,P&&w),style:M,children:(0,n.Y)(m.h,{className:v})}),o&&s&&(0,n.FD)(m.h,{className:y,children:[D&&(0,n.Y)(D,{className:z}),(0,n.Y)(p.K,{size:8}),(0,n.Y)(u.$j,{level:"1",children:s})]}),(0,n.FD)(m.h,{className:C,children:[(0,n.FD)("div",{className:k,children:[(0,n.Y)(r.k,{className:(0,a.$)(b,z)}),(0,n.Y)(u.tW,{weight:"2",children:L})]}),(0,n.Y)(u.hE,{className:j,level:"2",children:N})]})]})}},381270:(e,t,i)=>{i.d(t,{yF:()=>ee});var n=i(221020),o=i(562223),s=i(634164),r=i(451465),a=i(638945),d=i(782536),c=i(154767),l=i(409698),h=i(962644),p=i(880414),u=i(298096),m=i(631012),g=i(721126);const _="vkitAddOrDeleteButton__button--gzJJv",v="vkitAddOrDeleteButton__buttonWithShadow--lSvSq",f=({addIconKind:e})=>{switch(e){case"add":return(0,n.Y)(u.p,{});case"done":return(0,n.Y)(m.E,{});default:(0,g.S)(e)}return null},w=({addAudio:e,addIconKind:t,ariaLabel:i,withShadow:o})=>(0,n.Y)(l.$,{className:(0,s.$)(_,o&&v),onClick:e,size:"l",appearance:"overlay",align:"center",after:(0,n.Y)(f,{addIconKind:t}),stretched:!0,"aria-label":i}),y=({artist:e,size:t,className:i})=>"s"===t?(0,n.Y)(p.b,{TypographyComponent:a.$j,className:i,weight:"2",level:"1",lines:1,children:e}):(0,n.Y)(p.b,{TypographyComponent:a.hE,className:i,weight:"2",level:"3",lines:1,children:e});var b=i(474847);const C="vkitCoverImage__image--0heUb",k="vkitCoverImage__withoutCover--HPOt3",I=({status:e,coverUrl:t,loading:i="eager"})=>t&&"restricted"!==e?(0,n.Y)("img",{className:C,src:t,loading:i,alt:"",width:300,height:300}):(0,n.Y)("div",{className:k,children:(0,n.Y)(b.U,{})});var S=i(741509);const A="vkitEqualizerPrimaryAudio__overlay--OB26u",P="vkitEqualizerPrimaryAudio__container--NKGdZ",L=({status:e})=>"playing"===e?(0,n.Y)(h.h,{className:A,children:(0,n.Y)("div",{className:P,"data-testid":"primary-attachment-audio-equalizer",children:(0,n.Y)(S.r,{playing:!0,size:"stretched"})})}):null;var O=i(191601),E=i(648179);const x=({status:e})=>"playing"!==e?(0,n.Y)(O.K,{}):(0,n.Y)(E.o,{});var Y=i(648992),M=i(815287);var T=i(942735);const R=({coverUrl:e,isRestricted:t})=>{const[i,n]=(0,M.useState)({backgroundColorState:"token",backgroundColor:void 0,textColorState:"noCover"});return(0,M.useEffect)((()=>{if(e&&!t){(async()=>{const t=function(e){const t=document.createElement("canvas").getContext("2d");if(!t)return[0,0,0];t.imageSmoothingEnabled=!0,t.drawImage(e,0,0,1,1);const i=t.getImageData(0,0,1,1).data.slice(0,3);return[i[0],i[1],i[2]]}(await(0,Y.y)(e)),i={textColorState:function(e){const[t,i,n]=e;return(299*t+587*i+114*n)/1e3>=150?"light":"dark"}(o=t),backgroundColor:o};var o;n({backgroundColorState:"color",backgroundColor:(0,T.P)(i.backgroundColor,.12),textColorState:i.textColorState})})()}else n({backgroundColorState:"token",backgroundColor:void 0,textColorState:"noCover"})}),[e,t]),i},D="vkitPrimaryAttachmentAudio__container--QpkX0",B="vkitPrimaryAttachmentAudio__content--DlvGr",F="vkitPrimaryAttachmentAudio__imageContainer--6A0xS",N="vkitPrimaryAttachmentAudio__imageContainerForIcon--KGh0y",z="vkitPrimaryAttachmentAudio__textTitleContainer--Sd8kw",j="vkitPrimaryAttachmentAudio__textTitle--Uu3Bt",U="vkitPrimaryAttachmentAudio__textArtist--YZeKs",W="vkitPrimaryAttachmentAudio__titleIcon--RzHt9",$="vkitPrimaryAttachmentAudio__textContent--knO2S",H="vkitPrimaryAttachmentAudio__buttonGroup--EenBz",V="vkitPrimaryAttachmentAudio__buttonWithShadow--MtKxn",K="vkitPrimaryAttachmentAudio__imageBackground--GHsZZ",q="vkitPrimaryAttachmentAudio__imageBackgroundBlur--eionL",G="vkitPrimaryAttachmentAudio__browserGlitchesFix--slRD2",J={light:"vkitPrimaryAttachmentAudio__textDark--VN3zo",dark:"vkitPrimaryAttachmentAudio__textLight--KTPDE",noCover:"vkitPrimaryAttachmentAudio__textNoCover--C1K6a"},Q={playing:void 0,loading:void 0,paused:void 0,ended:void 0,stopped:void 0,restricted:"vkitPrimaryAttachmentAudio__textRestricted--Y6aKH"},X={color:"vkitPrimaryAttachmentAudio__imageBackgroundBlurGradient--LEskt",token:void 0},Z={backdrop:void 0,svg:"vkitPrimaryAttachmentAudio__withSvgBlur--M2hvp"},ee=({addAudio:e,addIconKind:t,ariaLabelAdd:i,ariaLabelDone:u,audio:m,blurType:g="backdrop",canAddOrDeleteAudio:_,imageLoading:v="eager",onRestricted:f,size:b,status:C,textListen:k,toggleAudio:S,features:A,dataRole:P})=>{const{textColorState:O,backgroundColor:E,backgroundColorState:Y}=R({coverUrl:m.coverUrl,isRestricted:"restricted"===C}),M={add:i,done:u},T="color"===Y&&E?{"--audio-primary-background-gradient-color":E}:void 0,{isExplicit:ee,noticeIcon:te}=m;return(0,n.FD)("div",{className:(0,s.$)(D,Z[g],A?.isBrowserGlitchesFixEnabled&&(r.T.ios||r.T.safari||r.T.mozilla)&&G),"data-testid":"primary-attachment-audio","data-role":P,children:[(0,n.FD)("div",{className:B,children:[(0,n.FD)("div",{className:(0,s.$)(F,(!m.coverUrl||"restricted"===C)&&N),children:[(0,n.Y)(I,{status:C,coverUrl:m.coverUrl,loading:v}),(0,n.Y)(L,{status:C})]}),(0,n.FD)("div",{className:$,children:[(0,n.FD)("div",{className:(0,s.$)(z,Q[C]),children:[(0,n.Y)(p.b,{TypographyComponent:a.hE,className:(0,s.$)(j,J[O]),weight:"1",level:"s"===b?"2":"1",lines:1,children:m.title}),!(!ee&&!te)&&(0,n.Y)("span",{className:(0,s.$)(W,J[O]),children:te||(0,n.Y)(o._,{})})]}),(0,n.Y)(y,{artist:m.artist,size:b,className:(0,s.$)(U,J[O])}),(0,n.Y)("div",{className:H,children:(0,n.Y)(d.e,{gap:"s",children:(0,n.FD)(c.Q,{value:"light",children:[(0,n.Y)(l.$,{className:V,onClick:()=>{"restricted"!==C?S():f()},before:(0,n.Y)(x,{status:C}),size:"l",appearance:"overlay","data-testid":"primary-attachment-audio-play-button",children:k}),Boolean(_)&&t&&(0,n.Y)(w,{addAudio:()=>{"restricted"!==C?e():f()},addIconKind:t,ariaLabel:M[t],withShadow:!0})]})})})]})]}),m.coverUrl&&(0,n.Y)(h.h,{children:(0,n.Y)("img",{className:K,src:m.coverUrl,alt:"",width:300,height:300})}),(0,n.Y)(h.h,{children:(0,n.Y)("div",{className:(0,s.$)(q,X[Y]),style:T})})]})}},309889:(e,t,i)=>{i.d(t,{j:()=>r});var n=i(221020),o=i(494013),s=i(476230);const r=Object.assign((e=>(0,n.Y)(o.K,{...e})),{Crop:e=>(0,n.Y)(s.Q,{...e})})},155811:(e,t,i)=>{i.d(t,{w:()=>p});var n=i(221020),o=i(494013),s=i(409698);const r="vkitPrimaryAttachmentGifAction__root--es37d";var a=i(634164),d=i(154767),c=i(782536);const l="vkitPrimaryAttachmentGifActionsGroup__root--SYY0r",h="vkitPrimaryAttachmentGif__root--ijbxK",p=Object.assign((({children:e,...t})=>(0,n.FD)("div",{className:h,children:[(0,n.Y)(o.K,{...t}),e]})),{Actions:e=>(0,n.Y)(d.Q,{value:"dark",children:(0,n.Y)(c.e,{gap:"s",className:(0,a.$)(l,"vkitInternalPrimaryAttachmentGifActionsGroup"),...e})}),Action:({onClick:e,icon:t,label:i,state:o="initial",disabled:a=!1,...d})=>(0,n.Y)(s.$,{mode:"secondary_transparent",size:"l","aria-label":i,before:t,className:r,loading:"pending"===o,onClick:e,disabled:a,...d})})},365053:(e,t,i)=>{i.d(t,{B:()=>ce});var n=i(221020),o=i(634164),s=i(917818),r=i(962514),a=i(815287),d=i(772812),c=i(516427),l=i(409698),h=i(638945),p=i(962644),u=i(418356),m=i(34897),g=i(799649),_=i(865940);const v=({onClose:e,className:t,canShare:i,canUnvote:o,canReport:s,actionSheetTestId:r,onShare:a,onReport:d,onGetCode:c,onDeleteVote:l,revoteText:h,reportText:p,shareText:u,exportText:v,actionsButtonText:f})=>(0,n.Y)("div",{className:t,children:(0,n.Y)(_.v,{"data-testid":r,trigger:"hover",restoreFocus:!1,content:(0,n.FD)(n.FK,{children:[o&&(0,n.Y)(_.v.Item,{onClick:()=>(e(),l()),"data-testid":"poll-action-retract",children:h}),s&&(0,n.Y)(_.v.Item,{onClick:()=>{d()},"data-testid":"poll-action-report",children:p}),i&&(0,n.Y)(_.v.Item,{onClick:a,"data-testid":"poll-action-share",children:u}),c&&(0,n.Y)(_.v.Item,{onClick:()=>{c&&c()},"data-testid":"poll-action-code",children:v})]}),children:(0,n.Y)(g.K,{label:f,"data-testid":"poll-actions-dots",children:(0,n.Y)(m.Z,{})})})}),f="vkitPollBackground__background--axb6h",w="vkitPollBackground__backgroundWithPhoto--fNZCZ",y="vkitPollBackground__photoWrapper--qulbm",b="vkitPollBackground__photo--Q996e",C="vkitPollBackground__photoGradient--pnNxN",k=({poll:e,pollRef:t,backgroundType:i,background:s,loading:r})=>{const[d,c]=(0,a.useState)(),l=(0,a.useMemo)((()=>{if(s)switch(i){case"gradient":return(e=>{if(!e.points||!e.angle)return{};const t=e.points.map((e=>`#${e.color} ${100*e.position}%`));return{border:"none",background:`linear-gradient(${e.angle-90}deg, ${t.join(", ")})`}})(s);case"tile":return(e=>({border:"none",backgroundPosition:"top center",backgroundSize:`${e.width}px ${e.height}px`}))(s);case"photo":return{border:"none",backgroundColor:`#${s.color}`}}}),[s,i]);(0,a.useEffect)((()=>{if(!t.current)return;const i=t.current.offsetWidth*window.devicePixelRatio,n=t.current.offsetHeight*window.devicePixelRatio;let o,s=1/0,r=1/0;if(e.photo?.images){for(const t of e.photo.images){const e=Math.abs(t.width-i),a=Math.abs(t.height-n);e<s&&(s=e,r=a,o=t.url),e===s&&a<r&&(r=a,o=t.url)}c(o)}}),[e,t]);const h="photo"===i;return(0,n.Y)(p.h,{"data-testid":`poll-${i||"default"}-background`,zIndex:-1,className:(0,o.$)(f,h&&w),style:l,children:!!e.photo&&(0,n.FD)("div",{className:y,children:[(0,n.Y)("img",{className:b,src:d,alt:"",loading:r}),(0,n.Y)("div",{className:C,style:(u=e.photo,{background:`linear-gradient(0, #${u.color} 0, transparent 50%)`})})]})});var u};var I=i(982444);const S="vkitPollHeader__votingHeader--HdJqY",A=({white:e,title:t,label:i})=>(0,n.FD)("header",{className:S,children:[(0,n.Y)(I.K,{size:12}),(0,n.Y)(h.hE,{level:"2",weight:"1",className:(0,d.I)(e?"color_text_contrast":"color_text_muted"),"data-testid":"poll-title",children:t}),(0,n.Y)(I.K,{size:8}),(0,n.Y)(h.$j,{className:(0,d.I)(e?"color_text_contrast":"color_text_subhead"),"data-testid":"poll-subtitle",children:i}),(0,n.Y)(I.K,{size:24})]});var P=i(925228),L=i(500001),O=i(410725),E=i(364517),x=i(355812),Y=i(165051);const M="vkitPollOptions__votingOptionsWrapper--vAPJD",T="vkitPollOptions__votingOptionsOverflowWrapper--fqBxQ",R="vkitPollOptions__votingOptions--s1KoU",D="vkitPollOptions__votingOptionsOverflowAbbreviated--22Cad",B="vkitPollOptions__votingOptionWrapper--gdNk3",F="vkitPollOptions__votingOption--uu7oz",N="vkitPollOptions__votingOptionFill--4HMb3",z="vkitPollOptions__votingOptionLeft--CN4rl",j="vkitPollOptions__votingOptionRight--Dq9q2",U="vkitPollOptions__votingOptionVotes--fa61a",W="vkitPollOptions__votingOptionSeparator--JGVJ1",$="vkitPollOptions__votingMyVoteIcon--tjLvY",H="vkitPollOptions__votingOptionCheckboxIcon--jt04Q",V="vkitPollOptions__checkboxIcon--nYBs4",K="vkitPollOptions__checkboxCheckedIcon--LvND9",q="vkitPollOptions__buttonWrapper--nsLfU",G="vkitPollOptions__votingOptionsVoted--Q1qhQ",J="vkitPollOptions__votingOptionsDark--SklSy",Q="vkitPollOptions__votingOptionsLoading--6tPuI",X=({poll:e,handleVoteSingle:t,setSelectedAnswers:i,selectedAnswers:s,hasCustomBackground:r,loading:p,onShowMoreButtonClick:u,hasVoting:m,abbreviated:g,setIsAbbreviated:_,pollRef:v,runOnceInViewport:f,answersCountTexts:w,showVariantsText:y,showResultsText:b})=>{const C=(0,a.useRef)(null),k=(0,a.useRef)(null),S=(0,E.K)((()=>{if(!k.current||!C.current||!v.current)return;const e=k.current.offsetHeight-C.current.offsetHeight;_(e>0)})),A=(0,E.K)(f);(0,a.useEffect)((()=>{if(S(),window.addEventListener("resize",S),!C.current)return;const e=A(C.current,S);return()=>{window.removeEventListener("resize",S),e()}}),[S,A]);const X=!g&&m,Z=e.multiple?"poll-option-checkbox":"poll-option";return(0,n.FD)("div",{ref:C,className:M,children:[(0,n.Y)("div",{className:(0,o.$)(T,g&&D),children:(0,n.Y)("div",{ref:k,className:(0,o.$)(R,r&&J,!m&&G,p&&Q),children:e.answers.map(((o,a)=>(0,n.Y)("div",{className:B,children:(0,n.Y)(c.SB4,{"data-testid":e.answer_ids?.includes(o.id)?"poll-option-voted":Z,hasHover:X,hasActive:X,onClick:()=>{return X&&(e.multiple?(n=o.id,void i((e=>{const t=new Set(e);return t.has(n)?t.delete(n):t.add(n),t}))):t(o.id));var n},children:(0,n.FD)("div",{className:F,children:[(0,n.Y)("div",{className:N,style:{width:`${m||p?0:o.rate}%`}}),(0,n.Y)("div",{className:z,children:(0,n.FD)(Y.r,{separator:(0,n.Y)("div",{className:W,children:(0,n.Y)(x.O,{})}),children:[(0,n.Y)(h.fz,{weight:"3","data-testid":"poll-option-text",children:o.text}),(0,n.Y)("div",{className:U,children:(0,n.Y)(h.HL,{level:"1",weight:"3",className:(0,d.I)(r?"color_text_contrast":"color_text_secondary"),"aria-label":w[a],children:o.votes})})]})}),(0,n.FD)("div",{className:j,children:[e.answer_ids?.includes(o.id)&&(0,n.Y)(P.X,{className:$,"data-testid":"poll-option-voted-icon"}),(0,n.FD)(h.fz,{weight:"2","data-testid":"poll-option-percent",children:[o.rate," %"]})]}),(0,n.Y)("div",{className:H,children:m&&e.multiple&&(s.has(o.id)?(0,n.Y)(L.s,{className:K}):(0,n.Y)(O.u,{className:V}))})]})})},o.id)))})}),g&&(0,n.FD)("div",{className:q,children:[(0,n.Y)(I.K,{}),(0,n.Y)(l.$,{size:"l",onClick:u,appearance:r?"overlay":void 0,"data-testid":"poll-show-all-options",children:m?y:b})]})]})};var Z=i(56471),ee=i(423654);const te=({photo:e,children:t,...i})=>{const o=(0,a.useRef)(null),s=`${e?.first_name} ${e?.last_name}`;return(0,n.Y)(Z.f,{text:s,children:(0,n.Y)(ee.N,{getRootRef:o,"data-testid":"poll-footer-voter-link",...i,children:t})})},ie="vkitPrimaryAttachmentPoll__voting--6Worv",ne="vkitPrimaryAttachmentPoll__votingMask--FiVhg",oe="vkitPrimaryAttachmentPoll__votingDots--BOphQ",se="vkitPrimaryAttachmentPoll__votingFooter--mA4AG",re="vkitPrimaryAttachmentPoll__footerUsersStackWrapper--dcU0O",ae="vkitPrimaryAttachmentPoll__votingDark--MHOI9",de="vkitPrimaryAttachmentPoll__votingLoading--aiRey",ce=({getRootRef:e,short:t,modal:i,onShowFullVoting:m,onShare:g,onReport:_,onShowStats:f,onGetCode:w,poll:y,profiles:b,getProfileHref:C,loading:I,onVote:S,onDeleteVote:P,runOnceInViewport:L,hasCustomBackground:O,footerText:E,actionsButtonText:x,answersCountTexts:Y,showVariantsText:M,exportText:T,showResultsText:R,reportText:D,revoteText:B,shareText:F,headerText:N,voteText:z,backgroundType:j,background:U,backgroundImageLoading:W,actionSheetTestId:$,...H})=>{const[V,K]=(0,a.useState)(),[q,G]=(0,a.useState)(new Set),[J,Q]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)(void 0),ce=(0,a.useRef)(null),le=y.end_date&&1e3*y.end_date<=Date.now(),he=(0,a.useMemo)((()=>!(y.answer_ids?.length||!y.can_vote||le)),[y,le]),pe=!!y.answer_ids?.length&&!le&&!y.disable_unvote&&y.can_vote,ue=(0,a.useMemo)((()=>b.filter((e=>y.friends?.some((t=>t.id===e.id)))).map((e=>({photo:e.photo_100,...e})))),[b,y]);(0,a.useEffect)((()=>{G(new Set)}),[y]);const me=(0,s.d)((()=>{ce.current?.offsetWidth&&ee(ce.current.offsetWidth)}),100);(0,a.useEffect)((()=>{if(t)return me(),window.addEventListener("resize",me),()=>{window.removeEventListener("resize",me)}}),[t,me]);const ge=(0,r.Z)(ce,e);return(0,n.Y)(c.n1F,{popout:V,modal:i,children:(0,n.Y)(c.L2f,{children:(0,n.FD)("div",{ref:ge,className:(0,o.$)(ie,O&&ae,I&&de),style:{maxHeight:Z},...H,children:[!he&&f&&(0,n.Y)(p.h,{className:ne,zIndex:1,onClick:f,"aria-label":R}),(0,n.Y)(v,{className:oe,onClose:()=>{K(void 0)},canUnvote:!y.disable_unvote&&pe,canShare:y.can_share,canReport:y.can_report,onShare:g,onReport:_,onGetCode:w,onDeleteVote:P,actionsButtonText:x,exportText:T,reportText:D,shareText:F,revoteText:B,actionSheetTestId:$}),(0,n.Y)(A,{title:y.question,white:O,label:N}),(0,n.Y)(k,{poll:y,pollRef:ce,backgroundType:j,background:U,loading:W}),(0,n.Y)(X,{poll:y,handleVoteSingle:e=>S([e]),selectedAnswers:q,setSelectedAnswers:G,hasCustomBackground:O,loading:I,hasVoting:he,onShowMoreButtonClick:he?m:f,abbreviated:J,setIsAbbreviated:Q,pollRef:ce,runOnceInViewport:L,answersCountTexts:Y,showResultsText:R,showVariantsText:M}),(0,n.Y)("footer",{className:se,children:he&&!J&&q.size?(0,n.Y)(l.$,{stretched:!0,size:"l",onClick:()=>S([...q]),loading:I,appearance:O?"overlay":void 0,"data-testid":"poll-vote-button",children:z}):(0,n.Y)("div",{className:re,"data-testid":"poll-footer",children:(0,n.Y)(u.f,{photos:ue.map((e=>({src:e.photo,renderWrapper:t=>(0,n.Y)(te,{href:C(e),photo:e,...t})}))),"data-testid":"poll-footer-voters",children:(0,n.Y)(c.SB4,{hasHover:!he,hasActive:!he,hoverMode:"opacity",activeMode:"opacity",onClick:he?void 0:f,children:(0,n.Y)(h.EY,{className:(0,d.I)(O?"color_text_contrast":"color_text_secondary"),"data-testid":"poll-footer-text",children:E})})})})})]})})})}},637956:(e,t,i)=>{i.d(t,{C:()=>_});var n=i(221020),o=i(141575),s=i(634164),r=i(815287),a=i(516427),d=i(638945);const c="vkitSecondaryAttachmentList__root--2ArSq",l="vkitSecondaryAttachmentList__rootRedesign--4OLU3",h="vkitSecondaryAttachmentList__more--T08gW",p="vkitSecondaryAttachmentList__moreRedesign--eCREr",u="vkitSecondaryAttachmentList__icon--bXHWb",m="vkitSecondaryAttachmentList__title--JOvyK",g="vkitSecondaryAttachmentList__titleGray--ziIyp",_=({children:e,formatCutText:t,initialExpanded:i,onShowMoreClick:_,maxAttachmentsBeforeCut:v=10,feedV3Redesign:f})=>{const w=e.length-v,y=w>0,[b,C]=(0,r.useState)(i??!1);return(0,n.FD)("div",{className:(0,s.$)(c,f&&l),children:[b?e:e.slice(0,v),!b&&y&&(0,n.FD)(a.SB4,{className:(0,s.$)(h,f&&p),onClick:e=>{C(!0),_?.(e)},hoverMode:f?"opacity":void 0,children:[!f&&(0,n.Y)(o.z,{className:u}),(0,n.Y)(d.$j,{level:"1",weight:f?"3":"2",className:f?g:m,children:t(w)})]})]})}},137363:(e,t,i)=>{i.d(t,{O:()=>u});var n=i(221020),o=i(634164),s=i(772812),r=i(516427),a=i(180329),d=i(505174),c=i(880414);const l="vkitAudioListAuthor__rootHover--emFgZ",h="vkitAudioListAuthor__dimmed--jE9gL",p={primary:(0,s.I)("color_text_primary"),contrast:(0,s.I)("color_text_contrast")},u=({children:e,src:t,mode:i="primary",FallbackIcon:u,dimmed:m,...g})=>{const _=u&&(0,n.Y)(u,{className:(0,s.I)("color_icon_tertiary")}),v=t||_;return(0,n.Y)(r.SB4,{hoverMode:"opacity",activeMode:"opacity",className:(0,o.$)(p[i],m&&h),hoverClassName:l,...g,children:(0,n.FD)(a.s,{direction:"row",align:"center",gap:6,noWrap:!0,children:[v&&(0,n.Y)(d.e,{size:16,src:t,fallbackIcon:_}),(0,n.Y)(c.b,{lines:1,children:e})]})})}},640171:(e,t,i)=>{i.d(t,{j:()=>I});var n=i(221020),o=i(875730),s=i(634164),r=i(815287),a=i(180329),d=i(982444),c=i(782536),l=i(962644),h=i(182409);const p="vkitAudioListBoxHeader__root--qbb2M",u="vkitAudioListBoxHeader__rootColored--flsxS",m="vkitAudioListBoxHeader__rootNoTopRounded--PvBbG",g="vkitAudioListBoxHeader__rootNoBottomRounded--KKcOe",_="vkitAudioListBoxHeader__overlay--ftO55",v="vkitAudioListBoxHeader__cover--eykUW",f="vkitAudioListBoxHeader__content--BS4wv",w="vkitAudioListBoxHeader__info--JAN9V",y="vkitAudioListBoxHeader__after--Zuhj7",b="vkitAudioListBoxHeader__actions--gPiv5",C="vkitAudioListBoxHeader__centeredInfo--TXFs6",k={stretched:"vkitAudioListBoxHeader__contentStretched--A8oqt",centered:"vkitAudioListBoxHeader__contentCentered--ylBTZ",column:"vkitAudioListBoxHeader__contentColumn--7ydXC"},I=({children:e,cover:t,CoverFallbackIcon:i=o.b,coverLabel:I,actions:S,after:A,color:P,mode:L="stretched",backgroundMode:O="colored",noTopRounded:E,noBottomRounded:x,"data-testid":Y})=>{const M=(0,r.useRef)(null),[T,R]=(0,r.useState)(0),D=Array.isArray(t)?t[0]:t,B="colored"===O||!D,F=B&&D?P:void 0,N="column"===L,z="blurred"===O&&Boolean(D),j={"--audio-list-box-header-image-url":z?`url(${D})`:void 0},U={"--audio-list-box-header-after-width":`${T}px`},W=(0,s.$)(p,B&&u,E&&m,x&&g);return(0,r.useLayoutEffect)((()=>{M.current&&R(M.current.offsetWidth)}),[A]),(0,n.FD)(a.s,{style:{backgroundColor:F},className:W,direction:N?"column":"row",align:N?"center":void 0,noWrap:!0,"data-testid":Y,children:[z&&(0,n.Y)(l.h,{style:j,className:_}),(0,n.Y)(a.s.Item,{className:v,children:(0,n.Y)(h.W,{src:t,size:"s",label:I,FallbackIcon:i,"data-testid":"audiolistboxheader-cover"})}),(0,n.FD)(a.s.Item,{style:U,className:(0,s.$)(f,k[L]),flex:"content",children:[(0,n.FD)("div",{className:(0,s.$)(w,N&&C),"data-testid":"audiolistboxheader-info",children:[N&&(0,n.Y)(d.K,{size:16}),e]}),!!A&&(0,n.FD)("div",{ref:M,className:y,"data-testid":"audiolistboxheader-after",children:[(0,n.Y)(d.K,{size:12,mode:"vertical"}),(0,n.Y)(c.e,{gap:"s",children:A})]}),!!S&&(0,n.FD)("div",{className:b,"data-testid":"audiolistboxheader-actions",children:[("centered"===L||N)&&(0,n.Y)(d.K,{size:16}),S,N&&(0,n.Y)(d.K,{size:8})]})]})]})}},182409:(e,t,i)=>{i.d(t,{W:()=>_});var n=i(221020),o=i(875730),s=i(634164),r=i(772812),a=i(638945),d=i(154767),c=i(407587),l=i(880414);const h="vkitAudioListCover__root--yAy0w",p="vkitAudioListCover__label--4yZUp",u={s:"vkitAudioListCover__sSizeRoot--YweJ4",m:"vkitAudioListCover__mSizeRoot--QLTck"},m={s:156,m:200},g={s:a.HL,m:a.EY},_=({src:e,size:t="m",label:i,FallbackIcon:a=o.b,"data-testid":_})=>{const v=function(e){if("string"==typeof e)return[e];if(Array.isArray(e))return e;return[]}(e);return(0,n.FD)("div",{className:(0,s.$)(h,u[t]),children:[(0,n.Y)(c.q,{src:v,noBorder:!0,size:m[t],draggable:!1,fallbackIcon:(0,n.Y)(a,{className:(0,r.I)("color_icon_tertiary")}),"data-testid":_}),i&&(0,n.Y)(d.Q,{value:"light",children:(0,n.Y)("div",{className:(0,s.$)(p,(0,r.I)("color_icon_accent")),children:(0,n.Y)(l.b,{lines:1,TypographyComponent:g[t],className:(0,r.I)("color_text_contrast"),level:"2",weight:"2",children:i})})})]})}},601869:(e,t,i)=>{i.d(t,{R:()=>b});var n=i(221020),o=i(992999),s=i(634164),r=i(815287),a=i(772812),d=i(674585),c=i(638945),l=i(982444),h=i(423654),p=i(56471),u=i(880414);const m="vkitAudioListTitle__explicitIcon--S8RVa",g="vkitAudioListTitle__noticeIcon--fkg9x",_={primary:(0,a.I)("color_text_primary"),contrast:(0,a.I)("color_text_contrast")},v={primary:(0,a.I)("color_icon_primary"),contrast:(0,a.I)("color_icon_contrast")},f={l:"2",m:"3",s:void 0},w={l:"2",m:"1",s:"2"},y={l:c.hE,m:c.hE,s:c.fz},b=({children:e,size:t="m",lines:i=2,appearance:a="primary",explicit:c,noticeIcon:b,"data-testid":C,...k})=>{const I=(0,r.useRef)(null),[S,A]=(0,r.useState)(void 0);(0,r.useEffect)((()=>{I.current&&A(I.current.scrollHeight>I.current.clientHeight&&void 0)}),[]);const P=(0,n.FD)(u.b,{lines:i,getRootRef:I,className:_[a],multiple:!0,level:f[t],weight:w[t],TypographyComponent:y[t],"data-testid":C,children:[c&&(0,n.FD)(n.FK,{children:[(0,n.Y)(o.N,{className:(0,s.$)(m,v[a])}),(0,n.Y)(l.K,{size:4,mode:"vertical"})]}),e,!!b&&(0,n.FD)(n.FK,{children:[(0,n.Y)(l.K,{size:4,mode:"vertical"}),(0,n.Y)("div",{className:g,children:b})]})]}),L=(0,d.b)(k)?(0,n.Y)(h.N,{...k,mode:a,children:P}):P;return(0,n.Y)(p.f,{text:e,appearance:"neutral",maxWidth:305,shown:S,children:L})}},350333:(e,t,i)=>{i.d(t,{Q:()=>p});var n=i(221020),o=i(634164),s=i(162760),r=i(772812),a=i(982444),d=i(638945),c=i(165051),l=i(880414);const h={subtitleContainer:"vkitMusicPlaylistModalHeaderInfo__subtitleContainer--BpGuX",subtitle:"vkitMusicPlaylistModalHeaderInfo__subtitle--kQTqS"};function p({title:e,subtitle:t,author:i,exclusive:p}){return i||t?(0,n.FD)(c.r,{separator:(0,n.Y)(a.K,{size:4}),children:[e,i,(0,n.FD)("div",{className:h.subtitleContainer,"data-testid":"musicplaylistmodalheaderinfo-subtitle",children:[p&&(0,n.Y)(s.X,{}),(0,n.Y)(l.b,{multiple:!0,lines:i?1:2,TypographyComponent:d.tW,weight:"3",className:(0,o.$)(h.subtitle,(0,r.I)("color_text_contrast")),children:t})]})]}):e}},724182:(e,t,i)=>{i.d(t,{O:()=>a});var n=i(221020),o=i(593177),s=i(982444),r=i(640171);const a=({cover:e,children:t,...i})=>(0,n.FD)(r.j,{...i,mode:"stretched",cover:e,CoverFallbackIcon:o.U,children:[(0,n.Y)(s.K,{size:6}),t]})},781396:(e,t,i)=>{i.d(t,{O:()=>c});var n=i(221020),o=i(772812),s=i(982444),r=i(638945),a=i(165051);const d="vkitPodcastEpisodeInfo__extra--57qfr",c=({children:e,subhead:t,owner:i,extra:c})=>(0,n.FD)(a.r,{separator:(0,n.Y)(s.K,{size:4}),children:[!!t&&(0,n.Y)(r.EY,{className:(0,o.I)("color_text_contrast"),children:t}),e,!!c&&(0,n.Y)(r.EY,{className:d,children:c}),(0,n.Y)(r.EY,{children:i})]})},995157:(e,t,i)=>{i.d(t,{b:()=>k});var n=i(221020),o=i(191601),s=i(845958),r=i(648179),a=i(284146),d=i(634164),c=i(409698),l=i(154767),h=i(593355);const p="vkitPodcastEpisodePlaybackButton__content--zLtWk",u="vkitPodcastEpisodePlaybackButton__progressBar--qcvNC",m="vkitPodcastEpisodePlaybackButton__text--TxicT",g="vkitPodcastEpisodePlaybackButton__textContainerSizeXs--xG2C3",_="vkitPodcastEpisodePlaybackButton__textContainerSizeS--6Xlqk",v="vkitPodcastEpisodePlaybackButton__textContainerSizeM--167nQ",f="vkitPodcastEpisodePlaybackButton__textContainerSizeL--F55Hb",w="vkitPodcastEpisodePlaybackButton__textContainerSizeXl--zLlnH",y={idle:(0,n.Y)(o.K,{}),listened:(0,n.Y)(s.H,{})},b={plays:(0,n.Y)(r.o,{}),paused:(0,n.Y)(o.K,{})},C={xs:g,s:_,m:v,l:f,xl:w},k=({state:e,progress:t=0,duration:i=0,children:o,sliderLabel:s,...r})=>{const g="plays"===e||"paused"===e,_=g?(0,a.a)(Math.round(i*t)):"",v=C[function(e){return 0===e?"xs":e<600?"s":e<3600?"m":e<36e3?"l":"xl"}(i)];return(0,n.Y)(c.$,{...r,size:"m",before:!g&&y[e],children:(0,n.FD)("div",{className:p,children:[g&&(0,n.FD)(n.FK,{children:[b[e],(0,n.Y)(l.Q,{value:"light",children:(0,n.Y)("div",{className:u,children:(0,n.Y)(h.A,{value:t,"aria-label":s,backMode:"tertiary",fillMode:"primary",min:0,max:1,size:"l",readOnly:!0,hideHandle:!0,inheritCursor:!0})})})]}),(0,n.Y)("div",{className:(0,d.$)(m,g&&v),children:g?_:o})]})})}},300032:(e,t,i)=>{i.d(t,{T:()=>y});var n=i(221020),o=i(634164),s=i(815287),r=i(838565);var a=i(942735),d=i(638945),c=i(292184);const l=(0,s.createContext)(void 0),h=l.Provider;var p=i(601079),u=i(154767),m=i(287718);const g="vkitFeedActionCellProgress__root--tEcsx",_="vkitFeedActionCell__root--TsBOd",v="vkitFeedActionCell__rootCompact--4K5LG",f="vkitFeedActionCell__rootMultiline--cuPXk",w={light:"vkitFeedActionCell__rootLight--oktLj",dark:"vkitFeedActionCell__rootDark--82Bpz"},y=Object.assign((({backgroundColor:e,style:t,className:i,children:l,...p})=>{const{multiline:u}=p,m=(0,r.D)(),g=m?d.fz:s.Fragment,y=e?(b=e,Math.round((299*b[0]+587*b[1]+114*b[2])/1e3)>125?"light":"dark"):void 0;var b;return(0,n.Y)(h,{value:y,children:(0,n.Y)(c.T,{className:(0,o.$)(_,m&&v,u&&f,y&&w[y],i),style:{...t,backgroundColor:e?(0,a.P)(e):t?.backgroundColor},...p,minHeight:40,children:!!l&&(0,n.Y)(g,{children:l})})})}),{Progress:({className:e,...t})=>{const i=(0,s.useContext)(l),r=(0,p.A)(),a=i??r;return(0,n.Y)(u.Q,{value:"light",children:(0,n.Y)(m.q,{className:(0,o.$)(g,e),size:24,strokeSize:3.5,appearance:"dark"===a?"contrast":"primary",disableAnimation:!0,...t})})}})},775828:(e,t,i)=>{i.d(t,{M:()=>_});var n=i(221020),o=i(300806),s=i(815287),r=i(516427),a=i(962644),d=i(372286),c=i(108852),l=i(317708),h=i(838565),p=i(425522);const u="vkitAttachmentDonutTeaser__root--gh2N3",m="vkitAttachmentDonutTeaser__imageWrapper--gowVW",g=550/309,_=({sizes:e,maxImageWidth:t,maxContainerWidth:i,getRootRef:_,restriction:v,onRestrictedClick:f,maxImageAvailableRatio:w,imageAriaLabel:y,"data-testid":b="attachment-donut-teaser",onMouseEnter:C,loading:k,action:I,renderRestrictionText:S,...A})=>{const P=(0,h.D)(),L=(0,s.useMemo)((()=>e&&(0,o.q)(e,t)),[e,t]),O=(0,s.useMemo)((()=>L?(0,l.QT)(L,!1,w):P?1.8:g),[L,P,w]);return(0,n.Y)("div",{className:u,...A,ref:_,"data-testid":b,children:(0,n.Y)(c.k,{action:I,onMouseEnter:C,children:(0,n.Y)(r.glH,{ratio:O,children:(0,n.FD)(a.h,{Component:"div",className:m,centered:!0,children:[L?.url&&(0,n.Y)(d.C,{overlay:!0,fit:"cover",src:L.url,restrictionType:v.type,width:L.width||i,height:L.height||i,loading:k,"aria-label":y,"data-testid":"attachment-donut-teaser-image"}),(0,n.Y)(p.c,{restriction:v,onRestrictedClick:f,hasPhotoBackground:Boolean(L?.url),renderRestrictionText:S})]})})})})}},755659:(e,t,i)=>{i.d(t,{n:()=>n});const n=(e,t)=>({backgroundImage:e?`url(${e})`:void 0,backgroundSize:t&&void 0!==t.sizeWidth&&void 0!==t.sizeHeight?`${t.sizeWidth}px ${t.sizeHeight}px`:"cover",backgroundPosition:t&&void 0!==t.positionX&&void 0!==t.positionY?`-${t.positionX}px -${t.positionY}px`:"center"})},942735:(e,t,i)=>{function n(e,t=1){return`rgba(${e.join(", ")}, ${t})`}i.d(t,{P:()=>n})},961636:(e,t,i)=>{i.d(t,{A:()=>n});const n={blockWrapResetPadding:"vkitRecommendationBlock__blockWrapResetPadding--fON4R"}},993499:(e,t,i)=>{i.d(t,{A:()=>n});const n={header:"vkitRecommendationBlockHeader__header--OKmV8",headerDecreasedMargin:"vkitRecommendationBlockHeader__headerDecreasedMargin--Lc5nn",iconButton:"vkitRecommendationBlockHeader__iconButton--Cw7DX",iconButtonMobile:"vkitRecommendationBlockHeader__iconButtonMobile--hcfBp",title:"vkitRecommendationBlockHeader__title--H5qoF",titleIncreasedMargin:"vkitRecommendationBlockHeader__titleIncreasedMargin--uY2IZ"}},151023:(e,t,i)=>{i.d(t,{A:()=>n});const n={root:"vkitRecommendationCard__root--KJmVQ",stretchedRoot:"vkitRecommendationCard__stretchedRoot--ymTTE",rootHasStatus:"vkitRecommendationCard__rootHasStatus--VmQvy",rootHidden:"vkitRecommendationCard__rootHidden--oAcKs",rootLoading:"vkitRecommendationCard__rootLoading--vgGYQ",spinner:"vkitRecommendationCard__spinner--KZKPL",in:"vkitRecommendationCard__in--txOpy",card:"vkitRecommendationCard__card--i7Fy1",cardBackgroundSecondary:"vkitRecommendationCard__cardBackgroundSecondary--4UMvn",skeleton:"vkitRecommendationCard__skeleton--YhcIF",closeButton:"vkitRecommendationCard__closeButton--pX5sz",cover:"vkitRecommendationCard__cover--AMacE",img:"vkitRecommendationCard__img--UjzxA",badge:"vkitRecommendationCard__badge--60S5k",badgeStyleOverlay:"vkitRecommendationCard__badgeStyleOverlay--awlFq",mediumBadge:"vkitRecommendationCard__mediumBadge--TXF0m",smallBadge:"vkitRecommendationCard__smallBadge--nyf7Y",smallBadgeWithPhoto:"vkitRecommendationCard__smallBadgeWithPhoto--ocFlo",usersStack:"vkitRecommendationCard__usersStack--BnFBP",caption:"vkitRecommendationCard__caption--IPot0",title:"vkitRecommendationCard__title--YhnWW",verify:"vkitRecommendationCard__verify--Q1S3d",subtitle:"vkitRecommendationCard__subtitle--x58Hg",button:"vkitRecommendationCard__button--CnK6p",lagePadding:"vkitRecommendationCard__lagePadding--pz3Fc",withoutSidePadding:"vkitRecommendationCard__withoutSidePadding--xTbsc",buttonDisabled:"vkitRecommendationCard__buttonDisabled--YnXNN",buttonDone:"vkitRecommendationCard__buttonDone--ClaHV",buttonLoading:"vkitRecommendationCard__buttonLoading--c9UiZ",photos:"vkitRecommendationCard__photos--m06cI",after:"vkitRecommendationCard__after--GZES5",strikethroughTitle:"vkitRecommendationCard__strikethroughTitle--G6rWe"}}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/53789.4423e092.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/53789.4423e092.js",e),e}