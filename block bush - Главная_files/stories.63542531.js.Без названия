(()=>{"use strict";var __webpack_modules__={526708:(e,t,s)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="12" fill="currentColor" viewBox="0 0 8 12"><path fill-rule="evenodd" d="M5.85 5.55c.2.27.2.63 0 .9l-1.3 1.7-.04.05-1.16 1.5a.75.75 0 0 1-1.2-.9 94.04 94.04 0 0 1 1.17-1.52l.04-.05L4.31 6l-.95-1.22-.04-.05A93.21 93.21 0 0 1 2.15 3.2a.75.75 0 1 1 1.2-.9c.4.54.77 1.01 1.16 1.5l.04.06c.4.5.81 1.04 1.3 1.7Z" clip-rule="evenodd"/></svg>',name:"chevron_right_12"}}s.d(t,{getIcon12ChevronRight:()=>i})},855723:(e,t,s)=>{function i(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M12 5.54C12 2.48 9.32 0 6.01 0 2.71 0 .02 2.48.02 5.54c0 1.09.34 2.1.93 2.95 0 .95-.41 1.91-.78 2.78l-.15.35c-.07.18.06.39.24.38 1.56-.07 2.74-.53 3.35-1.39.74.3 1.55.47 2.4.47 3.3 0 5.99-2.48 5.99-5.54zM6 3.25a.5.5 0 0 0-.49.39.75.75 0 0 1-1.46-.35A2 2 0 0 1 6 1.75c1.14 0 1.97.94 1.97 2.04a2 2 0 0 1-.28 1.06c-.16.27-.38.47-.52.6-.28.26-.39.36-.43.65a.75.75 0 0 1-1.48-.2c.1-.83.57-1.26.86-1.52l.04-.04c.14-.13.2-.2.24-.26a.52.52 0 0 0 .07-.29c0-.36-.24-.54-.47-.54zm.9 5.26a.9.9 0 1 1-1.8 0 .9.9 0 0 1 1.8 0z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"question_12"}}s.d(t,{getIcon12Question:()=>i})},705600:(e,t,s)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M12 7a.9.9 0 0 1 .9.9v3.2h3.2a.9.9 0 0 1 .9.9.9.9 0 0 1-.9.9h-3.2v3.2a.9.9 0 0 1-.9.9.9.9 0 0 1-.9-.9v-3.2H7.9A.9.9 0 0 1 7 12a.9.9 0 0 1 .9-.9h3.2V7.9A.9.9 0 0 1 12 7ZM9.46 3h5.08c.95 0 1.71 0 2.33.05.64.05 1.2.16 1.73.43a4.4 4.4 0 0 1 1.92 1.92c.27.52.38 1.09.43 1.73.05.62.05 1.38.05 2.33v5.08c0 .95 0 1.71-.05 2.33-.05.64-.16 1.2-.43 1.73a4.4 4.4 0 0 1-1.92 1.92 4.5 4.5 0 0 1-1.73.43c-.62.05-1.38.05-2.33.05H9.46c-.95 0-1.71 0-2.33-.05a4.5 4.5 0 0 1-1.73-.43 4.4 4.4 0 0 1-1.92-1.92 4.5 4.5 0 0 1-.43-1.73C3 16.25 3 15.5 3 14.54V9.46c0-.95 0-1.71.05-2.33.05-.64.16-1.2.43-1.73A4.4 4.4 0 0 1 5.4 3.48a4.51 4.51 0 0 1 1.73-.43C7.75 3 8.5 3 9.46 3ZM7.27 4.84c-.52.05-.82.13-1.05.24a2.6 2.6 0 0 0-1.14 1.14c-.11.23-.2.53-.24 1.05-.04.54-.04 1.24-.04 2.23v5c0 1 0 1.69.04 2.23.05.52.13.82.24 1.05a2.6 2.6 0 0 0 1.14 1.14c.23.11.53.2 1.05.24.54.04 1.24.04 2.23.04h5c1 0 1.69 0 2.23-.04.52-.05.82-.13 1.05-.24a2.6 2.6 0 0 0 1.14-1.14c.11-.23.2-.53.24-1.05.04-.54.04-1.24.04-2.23v-5c0-1 0-1.69-.04-2.23a2.77 2.77 0 0 0-.24-1.05 2.6 2.6 0 0 0-1.14-1.14c-.23-.11-.53-.2-1.05-.24-.54-.04-1.24-.04-2.23-.04h-5c-1 0-1.69 0-2.23.04Z" clip-rule="evenodd"/></svg>',name:"add_square_outline_24"}}s.d(t,{getIcon24AddSquareOutline:()=>i})},441413:(e,t,s)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M7.9 11.1a.9.9 0 1 0 0 1.8h8.2a.9.9 0 0 0 0-1.8H7.9Z"/><path fill-rule="evenodd" d="M9.46 3c-.95 0-1.71 0-2.33.05-.64.05-1.2.16-1.73.43A4.4 4.4 0 0 0 3.48 5.4a4.52 4.52 0 0 0-.43 1.73C3 7.75 3 8.5 3 9.46v5.08c0 .95 0 1.71.05 2.33.05.64.16 1.2.43 1.73a4.4 4.4 0 0 0 1.92 1.92c.52.27 1.09.38 1.73.43.62.05 1.38.05 2.33.05h5.08c.95 0 1.71 0 2.33-.05.64-.05 1.2-.16 1.73-.43a4.4 4.4 0 0 0 1.92-1.92c.27-.53.38-1.09.43-1.73.05-.62.05-1.38.05-2.33V9.46c0-.95 0-1.71-.05-2.33a4.51 4.51 0 0 0-.43-1.73 4.4 4.4 0 0 0-1.92-1.92 4.52 4.52 0 0 0-1.73-.43C16.25 3 15.5 3 14.54 3H9.46ZM6.22 5.08c.23-.11.53-.2 1.05-.23.54-.05 1.24-.05 2.23-.05h5c1 0 1.69 0 2.23.04.52.05.82.13 1.05.24a2.6 2.6 0 0 1 1.14 1.14c.11.23.2.53.23 1.05.05.54.05 1.24.05 2.23v5c0 1 0 1.69-.04 2.23-.05.52-.13.82-.24 1.05a2.6 2.6 0 0 1-1.14 1.14c-.23.11-.53.2-1.06.23-.53.05-1.23.05-2.22.05h-5c-1 0-1.69 0-2.23-.04a2.77 2.77 0 0 1-1.05-.24 2.6 2.6 0 0 1-1.14-1.14c-.11-.23-.2-.53-.24-1.06a30.3 30.3 0 0 1-.04-2.22v-5c0-1 0-1.69.04-2.23.05-.52.13-.82.24-1.05a2.6 2.6 0 0 1 1.14-1.14Z" clip-rule="evenodd"/></svg>',name:"minus_square_outline_24"}}s.d(t,{getIcon24MinusSquareOutline:()=>i})},334206:(e,t,s)=>{function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_add_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_add_outline_24__user_add_outline_24"><path id="user_add_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 1 0-5.7 0 2.85 2.85 0 0 0 5.7 0Zm1.8 0a4.65 4.65 0 1 1-9.3 0 4.65 4.65 0 0 1 9.3 0ZM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-4-8.33h2.7a.9.9 0 1 1 0 1.8H5.9v2.7a.9.9 0 1 1-1.8 0v-2.7H1.4a.9.9 0 1 1 0-1.8h2.7V7.4a.9.9 0 1 1 1.8 0v2.7Zm2.2 8.33c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47Z" id="user_add_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_add_outline_24"}}s.d(t,{getIcon24UserAddOutline:()=>i})},29821:(e,t,s)=>{function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_added_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_added_outline_24__user_added_outline_24"><path id="user_added_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 1 0-5.7 0 2.85 2.85 0 0 0 5.7 0Zm1.8 0a4.65 4.65 0 1 1-9.3 0 4.65 4.65 0 0 1 9.3 0ZM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-1.8 0c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47Zm.26-9.57a.9.9 0 1 1 1.28 1.28l-5 5a.9.9 0 0 1-1.28 0l-2.5-2.5a.9.9 0 1 1 1.28-1.28L4 13.23l4.36-4.37Z" id="user_added_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_added_outline_24"}}s.d(t,{getIcon24UserAddedOutline:()=>i})},540696:(e,t,s)=>{function i(){return{icon:'<svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 32a1.5 1.5 0 0 1 0-3 13 13 0 1 0-12.2-8.5 1.5 1.5 0 1 1-2.81 1.04A15.97 15.97 0 0 1 0 16a16 16 0 1 1 16 16Z" fill="currentColor"/></svg>',name:"spinner_32"}}s.d(t,{getIcon32Spinner:()=>i})},52905:(e,t,s)=>{s.d(t,{API_VERSION:()=>i,BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH:()=>w,CLOSE_STATUS:()=>d,ERROR_CODES:()=>a,ERROR_REASONS:()=>n,ERROR_TYPES:()=>c,GIFTS_CATALOG_APP_ID:()=>g,MAX_COUNT_OF_APP_INIT:()=>b,NFT_APP_ID:()=>u,ONE_TIME_DONUT_APP_ID:()=>v,ORD_APP_ID:()=>_,OZON_APP_ID:()=>f,PLATFORM:()=>o,SITPOSTING_APP_ID:()=>p,TEXTLIVE_APPS:()=>h,VKPAY_APPS:()=>l,VKPAY_TRANSACTION_EVENT:()=>r,VK_CONNECT_EVENTS:()=>y,VK_CONNECT_SUPERAPPKIT_EVENT_TYPE:()=>S,VMOJI_CONSTRUCTOR_APP_ID:()=>m});const i="5.95",r="VKWebAppActionDone",o={WEB:"web",MOBILE_WEB:"mobile-web"},a={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,UNSUPPORTED_PLATFORM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11,CUSTOM:13,NO_ADS:20},n={ACCESS_DENIED:"Access denied",UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",CONNECTION_LOST:"Connection lost",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params",NO_ADS:"No ads",ADS_ALREADY_PLAYED:"Ads already played",VK_PAY_DISABLED:"This app can't use VK Pay",SCROLL_SUBSCRIBER_ALREADY_EXIST:"Scroll subscriber already exist",SUBSCRIPTION_IS_ALREADY_CANCELLED:"Subscription is in invalid status: subscription is already cancelled",SURVEY_INIT_IN_PROGRESS:"Survey init in progress",SURVEY_ALREADY_INIT:"Survey already init",SURVEY_NO_MATCH:"Survey no match",SURVEY_USER_CANCEL:"Survey user cancel",ALREADY_IN_PROGRESS:"Already in progress",USER_IS_NOT_GROUP_ADMIN:"Only group admins have access to group tokens",DEVICE_CANT_GET_GEODATA:"Device can't get geodata",USER_DIDNT_ALLOWED_ACTION:"User didn't allowed"},c={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},d=["success","failed"],l=[6217559,7131443],h=[7512376],_=51707812,u=51459963,p=7644481,m=7929683,v=51528700,g=53670660,f=51903384,y={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_preload_settings",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppOpenApp:"open_app",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowSubscriptionBox:"subscription",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowLinkCardBox:"show_link_card",VKWebAppShowNftPaymentBox:"show_nft_pay_box",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppClose:"close",VKWebAppGetSilentToken:"get_silent_token",VKWebAppOpenPayForm:"open_pay_form",VKWebAppAddToChat:"add_to_chat",VKWebAppTrackEvent:"track_event",VKWebAppCallStart:"call_start",VKWebAppCallJoin:"call_join",VKWebAppCallLeft:"call_left",VKWebAppCallFinished:"call_finished",VKWebAppCallGetStatus:"call_get_status",VKWebAppCallStartSharing:"call_start_sharing",VKWebAppCallStopSharing:"call_stop_sharing"},S="vk-sak-sdk",w=256,b=1},21830:(e,t,s)=>{s.d(t,{random:()=>o});var i=s(898848);const r=2147483647;function o(){try{if(window.crypto){let e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,i.intval)((0,i.rand)(0,r).toFixed(0))}},541756:(e,t,s)=>{s.d(t,{saveNavigationStatEvent:()=>n,saveViewerStartTime:()=>d});s(351118);var i=s(809152),r=s(601686);function o(){const{connection:e}=navigator;if(!e)return"";const{effectiveType:t,downlink:s}=e;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return s>8?"wi-fi":"LTE"}return""}let a=[];function n({storyRawId:e,source:t,action:s}){let o=0,n=0;e&&([o,n]=(0,r.splitStoryRawId)(e)),"reply"===t&&(t="replies_list");const c={e:i.STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION,owner_id:o,story_id:n,source:t,action:s};a.push(c)}let c=[];function d({storyRawId:e,source:t,time:s}){const[a,n]=(0,r.splitStoryRawId)(e),d={e:i.STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME,owner_id:a,story_id:n,source:t,time:s,internet_type:o()};c.push(d)}},402096:(e,t,s)=>{s.d(t,{ON_BOARDING_BG_RECT_ID:()=>c,default:()=>h});var i=s(754866),r=s(972332),o=s(672277),a=s(287470),n=s(250598);const c="onboarding_bg_rect",d="page_header_cont",l="onboarding";class h{initOnboardingBG(){if(!window.onboardingBG){let e='\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ',t=(0,i.se)(e);(0,i.domInsertBefore)(t,window.layerBG),s._dG("onboardingBGHeader",(0,i.ge)("onboarding_bg_header")),s._dG("onboardingBG",(0,i.ge)("onboarding_bg")),s._dG("onboardingBGRect",(0,i.ge)(c)),s._dG("onboardingBGClip",(0,i.ge)("onboarding_bg_clip")),window.cur.destroy.push((()=>{(0,i.hide)(window.onboardingBG),(0,i.hide)(window.onboardingBGHeader),(0,i.removeClass)((0,i.ge)(d),l),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&(0,r.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick)}))}this.opts.onBGClick&&(0,r.addEvent)(window.onboardingBG,"click",this.opts.onBGClick)}showTT(){const[,e]=(0,i.getXY)(this.el);this.tt=new n.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();const t=this.tt.getContent();(0,a.isElementInViewport)(this.el)&&(0,a.isElementInViewport)(t)||(0,o.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&((0,r.removeEvent)(window,"scroll"),(0,r.removeEvent)(window,"resize")),this.opts.onBGClick&&window.onboardingBG&&(0,r.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick),this.opts.onHide&&this.opts.onHide())}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),(0,r.addEvent)(window,"scroll",this.onScrollTT.bind(this)),(0,r.addEvent)(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){let e=this.el.offsetWidth,t=this.el.offsetHeight,s=(0,i.getXY)(this.el);(0,i.attr)(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),(0,i.attr)(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),(0,i.attr)(window.onboardingBGClip,"x",s[0]-this.border[1]),(0,i.attr)(window.onboardingBGClip,"y",s[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){let e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){(0,i.attr)(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){(0,i.attr)(window.onboardingBG,"width",this.getPageWidth()),(0,i.attr)(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,i.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),(0,i.show)(window.onboardingBG),(0,i.isVisible)(window.onboardingBGHeader)||((0,i.show)(window.onboardingBGHeader),(0,i.addClass)((0,i.ge)(d),l)))}removeDarkens(){this.hideDarkness&&((0,i.hide)(window.onboardingBG),(0,i.hide)(window.onboardingBGHeader),(0,i.removeClass)((0,i.ge)(d),l))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){const e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){const e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}constructor(e,t,s={}){this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;let i={autoShow:!1,noAutoHideOnWindowClick:s.noAutoHideOnWindowClick??!0,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${(()=>{const e=s.class??"";return s.tooltipWhite?e:e+" feature_intro_blue_tt"})()}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:s.scrollOffset||0,align:s.align||n.ElementTooltip.ALIGN_CENTER};s.side&&(i.forceSide=s.side),s.offset&&(i.offset=s.offset),s.width&&(i.width=s.width),s.shift&&(i.centerShift=s.shift),s.border?this.border=s.border:this.border=[10,10,10,10],s.ttOnHide&&(i.onHide=s.ttOnHide),s.withCloseButton&&(i.withCloseButton=s.withCloseButton,i.onCloseButtonClick=s.onCloseButtonClick),s.align&&(i.align=s.align),this.ttParams=i,this.opts=s,this.initOnboardingBG()}}},257168:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(754866),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(749284),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(478752),_web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(250598),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(972332),_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(693488),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(330882),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(237625),_web_lib_scroll_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(692543);const SEARCH_FOCUSED_CLASS="search_focused",uiSearch={destroy:function(e){const t=uiSearch.getFieldEl(e);uiSearch.stopEvents(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeData)(t)},getWrapEl:function(e){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("_wrap",e)},getFieldEl:function(e){return e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)("_field",e)?e:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domByClass)(uiSearch.getWrapEl(e),"_field")},stopEvents:function(e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(t,(function(e,t){t.stop()}))},startEvents:function(e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(t,(function(e,t){t.stop(),t.start()}))},init:function(el,options){if(!el)return;if(el=uiSearch.getFieldEl(el),!el)return;const wrapEl=uiSearch.getWrapEl(el),delayedInitOptions=!options&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(wrapEl,"init-options");if(delayedInitOptions){const evalScript="(function() { return "+delayedInitOptions+" })()";try{const initOptions=eval(evalScript);initOptions?.suggester?.useCatalogSuggest?setTimeout((()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(wrapEl,"init-options",null)),0):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(wrapEl,"init-options",null),uiSearch.init(el,initOptions)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_7__.logEvalError)(e,evalScript)}return}if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"inited"))return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"inited",1);const onKeyDown=uiSearch.onKeyDown.pbind(el),onBuffer=function(e){if("input"===e.type&&_shared_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(el);if(e===((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(el,"prev-value")||""))return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(el,"prev-value",e)}setTimeout(uiSearch.onChanged.pbind(el,!1,e),0)};(0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_1__.placeholderInit)(el),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"opts",options);const onFocus=e=>{if(options.focusedModifierTargetSelector){const e=document.querySelector(options.focusedModifierTargetSelector);e?.classList.add(SEARCH_FOCUSED_CLASS)}options.onFocus?.(e)},onBlur=e=>{if(options.focusedModifierTargetSelector){const e=document.querySelector(options.focusedModifierTargetSelector);e?.classList.remove(SEARCH_FOCUSED_CLASS)}options.onBlur?.(e)};let mainHandler;if(options.suggester)options.suggester.useCatalogSuggest=!!options?.suggester?.useCatalogSuggest,options.suggester.useCatalogSuggest||(options.suggester.instance=new Suggester(el,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.extend)(options.suggester,{type:options.suggester.type,historyItems:!!options.suggester.history&&options.suggester.historyItems,onSearch:function(e,t,s,i,r){e||(options.allowFiltersForEmpty||uiSearch.removeAllFilters(el),uiSearch.hideProgress(el)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(wrapEl,"ui_search_field_empty",!e),uiSearch.handleAriaAttributes(wrapEl,e),options.onChange&&options.onChange.call(el,e,t,s,i,r)}}))),mainHandler={start:function(){onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"focus",onFocus)},stop:function(){onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"focus",onFocus)}};else{const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_ui_search_button_search",wrapEl);options?.searchButtonTestId&&e.setAttribute("data-testid",options.searchButtonTestId);const t=function(e){uiSearch.onEnter(el,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(el)};mainHandler={start:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"keydown",onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"paste cut input",onBuffer),onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"focus",onFocus),e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(e,"click",t)},stop:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"keydown",onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"paste cut input",onBuffer),onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"focus",onFocus),e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(e,"click",t)}}}if(mainHandler.start(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"eventHandlers",[mainHandler]),options.params){const content=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(options.params.html)),newOptions=options?.suggester?.useCatalogSuggest?{forceSide:"bottom",setPos:()=>({left:"auto",top:"52px"})}:{};options.paramsTooltip=new _web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_3__.ElementTooltip((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_ui_search_params_button",wrapEl),{appendTo:wrapEl,content,autoShow:!1,customShow:!0,shift:options.params.shift?options.params.shift:0,offset:[0,-2],...newOptions}),options.paramsTooltip.build(),options?.suggester?.useCatalogSuggest&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(options.paramsTooltip._ttel,{right:0}),setTimeout((function(){(function initScript(){try{eval(options.params.script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_7__.logEvalError)(e,options.params.script)}}).call(el)}))}options.fixed&&uiSearch.setFixed(el),options.noAutoDestroy||cur.destroy.push(uiSearch.stopEvents.pbind(el)),uiSearch.initFilters(el,options),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.isFunction)(options.onInit)&&options.onInit(el,options)},getOptions:function(e){let t;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(e,"_field"))t=e;else{const s=uiSearch.getWrapEl(e);t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_field",s)}return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(t,"opts")||{}},toggleParameters:function(e){const t=uiSearch.getOptions(e);t.paramsTooltip&&t.paramsTooltip.toggle()},hideParameters:function(e){const t=uiSearch.getOptions(e);t&&t.paramsTooltip&&t.paramsTooltip.hide()},saveHistorySearch:function(e,t,s,i,r,o){t||(t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e));const a=uiSearch.getOptions(e);a.suggester&&a.suggester.instance&&a.suggester.instance.saveHistoryItem(t,s,i,r,o)},onEnter:function(e,t){e=uiSearch.getFieldEl(e);const s=uiSearch.getOptions(e),i=e.getValue?e.getValue():e.value;return s.onEnter&&s.onEnter(e,i,t),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t)},onKeyDown:function(e,t){if(cur.preventInputActions&&-1!=[_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.RETURN,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.ESC,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.DOWN,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.UP].indexOf(t.keyCode))return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t);if(t.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.RETURN)return uiSearch.onEnter(e,t);if(t.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.ESC){const s=!!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e);return uiSearch.reset(e,!1,t),!s||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t)}setTimeout.pbind(uiSearch.onChanged.pbind(e,!1,t),0)},onChanged:function(e,t,s){e=uiSearch.getFieldEl(e);const i=uiSearch.getOptions(e),r=uiSearch.getWrapEl(e),o=e.getValue?e.getValue():e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(r,"ui_search_field_empty",!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(o)),uiSearch.handleAriaAttributes(r,o),o||i.allowFiltersForEmpty||uiSearch.removeAllFilters(e),t||i.onChange&&i.onChange.call(e,o,s)},focus:function(e){e=uiSearch.getFieldEl(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(e)},reset:function(e,t,s){e=uiSearch.getFieldEl(e);const i=uiSearch.getOptions(e),r=uiSearch.getWrapEl(e);(e.getValue?e.getValue():e.value)?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e,""),uiSearch.onChanged(e,t,s),t||i.onEnter&&i.onEnter(e,""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(e)):i.in_tabs&&_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_5__.default.hideSearch(r),window.tooltips&&tooltips.destroyAll()},showProgress:function(e){e=uiSearch.getFieldEl(e);const t=uiSearch.getWrapEl(e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(t,"ui_search_loading");const s=e.getValue?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(e.getValue()):e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(t,"ui_search_field_empty",!s),uiSearch.handleAriaAttributes(t,s)},hideProgress:function(e){e=uiSearch.getFieldEl(e);const t=uiSearch.getWrapEl(e);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"ui_search_loading"),e){const s=e.getValue?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(e.getValue()):e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(t,"ui_search_field_empty",!s),uiSearch.handleAriaAttributes(t,s)}},handleAriaAttributes:function(e,t){const s=e.querySelector(".ui_search_controls"),i=!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(t);s?.setAttribute("aria-hidden",i)},scrollResize:function(e){if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mobile)return;e=uiSearch.getFieldEl(e);const t=uiSearch.getWrapEl(e),s=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(t),i=t&&t.classList.contains("ui_search_fixed"),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(cur.uiSearchPageBlock)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("page_block",e),o=vk.staticheader?Math.max(0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_header"))[1]-scrollNode.scrollTop):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_header"))[1];let a;const n=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isAncestor)(t,boxLayerWrap);if(!t||!s||!n&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("scroll_fix",t)||e.ignoreFixed&&!i||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isVisible)(s))return;if(n?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(s,!0)[1]<0:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(s,!0)[1]<o){const n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getStyle)(t.classList.contains("ui_search_new")?t:e,"width"));!i&&n&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(s,"height",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)(t)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,"width",n),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(t,"ui_search_fixed"));const c=Math.min(0,Math.max(-document.body.scrollLeft,document.body.clientWidth-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_layout"))[0]));if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{marginLeft:c}),r){const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(r)[1]+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)(r)[1]-(0,_web_lib_scroll_utils__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)()-e.offsetHeight;a=Math.min(o,Math.max(-e.offsetHeight,s)),a!==cur.lastUISearchPos&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,"top",a),cur.lastUISearchPos=a)}}else i&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(s,"height",""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"ui_search_fixed"))},setStatic:function(e){e.ignoreFixed=!0;const t=uiSearch.getWrapEl(e),s=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(t);t&&s&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(s,"height",""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"ui_search_fixed"))},setFixed:function(e){if(e.ignoreFixed=!1,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"resizeEventHandler")){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isAncestor)(e,boxLayerWrap)?boxLayerWrap:window,s=uiSearch.scrollResize.pbind(e),i={stop:_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent.pbind(t,"scroll",s),start:_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent.pbind(t,"scroll",s)};(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers",((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[]).concat([i])),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"resizeEventHandler",!0),i.start()}uiSearch.scrollResize(e)},initFilters:function(e,t){if(!e)return;const s=uiSearch.getWrapEl(e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ui_search_fltr_control",s),r={start:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(i,"click",(function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(i,"shown")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(e.target,"ui_search_fltr_control")||o(i)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(i,"mouseover",(function(){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(i,"shown"))return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"hidetimer");e&&(clearTimeout(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"hidetimer",0)),o(i,!0)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(i,"mouseout",(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"hidetimer")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"hidetimer",setTimeout((function(){o(i,!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"hidetimer",0)}),200))}))},stop:_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent.pbind(i,"click mouseover mouseout")};function o(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(e,"shown",t)}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers",((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[]).concat([r])),r.start();const a=uiSearch._getFiltersPane(e);(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(a,"click",(function(t){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(t.target,"token_title")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(t.target,"token_del")){const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("token",t.target),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(s,"id");uiSearch.removeFilter(e,i)}}))},removeAllFilters:function(e){const t=uiSearch._getFiltersPane(e),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(t,"cur_filters");(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.extend)({},s),(function(t){uiSearch.removeFilter(e,t,!0)}))},toggleFilter:function(e,t,s,i){i?uiSearch.addFilter(e,t,s):uiSearch.removeFilter(e,t)},addFilter:function(e,t,s){if(!t||!s)return;const i=uiSearch._getFiltersPane(e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"cur_filters")||{};r[t]=s,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"cur_filters",r);const o=uiSearch.getOptions(e);o.onFiltersChanged&&o.onFiltersChanged(r),uiSearch._renderFilters(e)},removeFilter:function(e,t,s){const i=uiSearch._getFiltersPane(e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"cur_filters")||{};if(r[t]){delete r[t],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"cur_filters",r);const o=uiSearch.getOptions(e);o.onFilterRemoved&&o.onFilterRemoved(t,e,s),o.onFiltersChanged&&o.onFiltersChanged(r),uiSearch._renderFilters(e)}},_getFiltersPane:function(e){const t=uiSearch.getWrapEl(e)||e;return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ui_search_filters_pane",t)},_renderFilters:function(e){clearTimeout((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"renderFiltersTO")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"renderFiltersTO",setTimeout(uiSearch._doRenderFilters.pbind(e)))},_doRenderFilters:function(e){const t=uiSearch._getFiltersPane(e),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(t,"cur_filters")||{},i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ui_search_filters",t);if(i)if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(s))(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"expanded"),setTimeout((function(){i.innerHTML="",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(t)}),200);else{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClassDelayed)(t,"expanded");const e=[],r={};let o=0;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(s,(function(t,s){let i=!1,a=!1,n=t.match(/(.*?)_([^_]+)$/);const c=n&&n[2]||!1;n=n&&n[1]||!1,n&&(void 0!==r[n]&&"from"===c?a=r[n]:void 0!==r[n]&&(i=r[n]+1),r[n]=o);const d=`<div class="token" id="token${t}" data-id="${t}">\n                         <div class="token_title">${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.replaceEntities)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clean)(s))}</div>\n                         <div class="token_del"></div>\n                       </div>`;!1!==a?e.splice(a,0,d):!1!==i?e.splice(i,0,d):e.push(d),o++})),i.innerHTML=e.join("")}}},__WEBPACK_DEFAULT_EXPORT__=uiSearch},586520:(e,t,s)=>{s.d(t,{EVENT_REPLY_FIELD_IS_NFT_INDEX:()=>c,EVENT_REPLY_FIELD_IS_POST_AUTHOR_INDEX:()=>d,MIN_NFT_IMAGE_SIZE:()=>r,REPLY_IMAGE_DEFAULT_SIZE:()=>o,REPLY_IMAGE_REDESIGN_V3_SIZE:()=>n,REPLY_IMAGE_SMALL_SIZE:()=>a,VISIBILITY_ACCESS_OPTIONS:()=>i});const i={PUBLIC:0,ONLY_FRIENDS:1,ONLY_BEST_FRIENDS:2},r=29,o=34,a=24,n=28,c=16,d=17},168066:(e,t,s)=>{s.d(t,{initApi:()=>a});var i=s(367375),r=s(865322),o=s(277495);const a=()=>{window.vkApi||s._dG("vkApi",{api:r.api,login:o.login,setLoginConfig:o.setLoginConfig,setApiConfig:r.setApiConfig,removeLoginCache:i.removeLoginCache})}},592423:(e,t,s)=>{s.d(t,{createCaptchaPopupService:()=>d});var i=s(32489),r=s(293721),o=s(418562),a=s(311606),n=s(621745),c=s(423921);const d=()=>{const e=(0,r.createGate)(),t=(0,i.createEvent)(),s=(0,i.createEvent)(),d=(0,i.createEvent)(),l=(0,i.createEvent)(),h=(0,i.createEvent)(),_=(0,i.createEvent)(),u=(0,i.createEvent)(),p=(0,i.createEvent)(),m=(0,i.createEvent)(),v=(0,i.createEvent)(),g=(0,i.createEvent)();(0,i.forward)({from:e.close,to:g});const f=(0,i.createStore)("");f.on(e.open,((e,{captchaImage:t})=>t));const y=(0,i.createStore)("");y.on(e.open,((e,{captchaTrack:t})=>t));const S=(0,i.createStore)("");S.on(e.open,((e,{deviceId:t})=>t));const w=(0,i.createStore)(null);w.on(e.open,(()=>c.CaptchaModalActive)),w.on(v,(()=>null));const b=(0,i.createStore)(null);b.on(e.open,((e,t)=>t.platform));const k=(0,i.createStore)("");k.reset(e.close),k.on(e.open,((e,{sid:t})=>t));const E=(0,i.createStore)("");E.reset(e.close),E.on([u,p],(()=>(0,o.default)()));const C=(0,i.createStore)(0);C.on(_,(e=>e+1)),C.reset(e.close);const I=(0,i.createStore)("");I.reset(e.close),I.on(t,((e,t)=>t));const T=(0,i.createStore)(!0);T.reset([e.close,_,u]),T.on(l,(()=>!0)),T.on(u,(()=>!0)),T.on(h,(()=>!1)),T.on(m,(()=>!1));const L=(0,i.createStore)(c.CaptchaType.IMAGE);L.on(_,(e=>e===c.CaptchaType.IMAGE?c.CaptchaType.AUDIO:c.CaptchaType.IMAGE));const M=(0,i.createStore)(!1);M.reset(e.close),M.on(s,(()=>!0)),M.on(d,(()=>!1));const A=(0,i.createStore)(!1);A.reset([e.close,_,u,p]),A.on(m,(()=>!0));const x=(0,i.createStore)("");x.reset([e.close,u]);const P=(0,i.createStore)(0);P.reset([e.close,g]),P.on([u,_],(()=>5));const{tick:R,isRunning:O}=(0,a.interval)({timeout:1e3,start:(0,i.merge)([u,_]),stop:g});P.on(R,(e=>e-1));const N=(0,i.createStore)(!1);N.reset(e.close);const B=(0,i.createStore)(!1);B.reset(e.close);const D=(0,i.createStore)(!0);D.reset(e.close),D.on(t,((e,t)=>""===t.trim()));const F=(0,i.createStore)(!0);return F.reset(e.close),F.on(_,(()=>!1)),(0,i.sample)({source:P,filter:e=>0===e,target:g}),(0,i.sample)({source:{isAudioPlaying:M,refreshCountdownRunning:O},fn:({isAudioPlaying:e,refreshCountdownRunning:t})=>e||t,target:[N,B]}),(0,i.sample)({clock:[e.open,p,_],source:{sid:k,hash:E,type:L,swapCount:C,platform:b,captchaImage:f,captchaTrack:y,deviceId:S,isFirst:F},fn:e=>(0,n.getCaptchaLink)(e),target:x}),(0,i.sample)({clock:u,source:{sid:k,hash:E,type:L,swapCount:C,platform:b,captchaImage:f,captchaTrack:y,deviceId:S},fn:e=>(0,n.getCaptchaLink)({...e,isRefresh:!0}),target:x}),{Gate:e,answerChanged:t,audioPlaying:s,audioPaused:d,captchaLoadingStarts:l,captchaLoadingEnds:h,captchaTypeToggled:_,captchaRefreshed:u,captchaReloaded:p,captchaLoadingErrorSet:m,closeCaptcha:v,$answer:I,$captchaLoading:T,$captchaType:L,$isAudioPlaying:M,$hasLoadCaptchaError:A,$captchaSrc:x,$refreshCountdown:P,$isRefreshButtonDisabled:N,$isCaptchaTypeToggleDisabled:B,$isSubmitButtonDisabled:D,$isCaptchaModalActive:w}}},423921:(e,t,s)=>{s.d(t,{CaptchaModalActive:()=>r,CaptchaType:()=>i});var i=function(e){return e[e.IMAGE=0]="IMAGE",e[e.AUDIO=1]="AUDIO",e}({});const r="CAPTCHA_MODAL_ACTIVE"},972980:(e,t,s)=>{s.d(t,{CaptchaType:()=>o.CaptchaType,Platform:()=>r.Platform,createCaptchaPopupService:()=>i.createCaptchaPopupService});var i=s(592423),r=s(621745),o=s(423921)},621745:(e,t,s)=>{s.d(t,{Platform:()=>o,getCaptchaLink:()=>a});var i=s(423921),r=s(586138),o=function(e){return e[e.VK_WEB=0]="VK_WEB",e[e.VK_M_WEB=1]="VK_M_WEB",e}({});const a=({sid:e,hash:t,type:s,isRefresh:o,swapCount:a,platform:n,isFirst:c,captchaImage:d,captchaTrack:l,deviceId:h})=>{const _=t?`&v=${t}`:"",u=o?"&refresh=1":"",p=!o&&a>0?"&swap_type=1":"",m=c?"&first=1":"";let v;switch(n){case 0:default:v=r.VK_WEB_APP_ID;break;case 1:v=r.VK_MVK_APP_ID}switch(s){case i.CaptchaType.IMAGE:{let t="";if(d){const e=new URLSearchParams(d);t=e.has("device_id")?e.has("device_id")&&e.get("device_id")?`${d}&s=1&width=400&resized=1`:`${d.replace("device_id=",`device_id=${h}`)}&s=1&width=400&resized=1`:`${d}&resized=1&width=400&app_id=${v}&device_id=${h}`}else t=`/captcha.php?sid=${e}&s=1&resized=1&width=400&app_id=${v}&device_id=${h}`;return`${t}${_}${u}${p}${m}`}case i.CaptchaType.AUDIO:{let t="";if(l){const e=new URLSearchParams(l);t=e.has("device_id")?e.has("device_id")&&e.get("device_id")?`${l}`:`${l.replace("device_id=",`device_id=${h}`)}`:`${l}&app_id=${v}&device_id=${h}`}else t=`/sound_captcha.php?act=get&captcha_sid=${e}&app_id=${v}&device_id=${h}`;return`${t}${_}${u}${p}${m}`}default:return""}}},51921:(e,t,s)=>{s.d(t,{connectTrackTmrGroupsJoin:()=>d,groupsJoinAction:()=>l,trackTmrGroupsJoin:()=>n});var i=s(251703),r=s(957994),o=s(32489),a=s(540462);const n=()=>(0,i.tmrSendTimespentEvent)(i.MY_TRACKER_COUNT_EVENT_IDS.COMMUNITY_SUBSCRIBE),c=(0,o.createEffect)({name:"fx/track_group_join",handler:n}),d=e=>(0,o.sample)({clock:e.done,target:c}),l=(e,t,s)=>(0,r.api)("groups.join",e,{...t,...(0,a.partConfigEnabled)("frontend.api_groups_join_disable_grouping")?{grouping:!1}:{}},s).then((e=>(n(),e)))},869071:(e,t,s)=>{s.d(t,{connectTrackTmrGroupsJoin:()=>i.connectTrackTmrGroupsJoin,groupsJoinAction:()=>i.groupsJoinAction,trackTmrGroupsJoin:()=>i.trackTmrGroupsJoin});var i=s(51921)},44755:(e,t,s)=>{s.d(t,{HASHTAG_ENTITIES_ALL:()=>c,HASHTAG_ENTITIES_NEW:()=>d,RE_HASHTAG_EXTRACTION_PATTERN:()=>n,RE_HASHTAG_EXTRACTION_PATTERN_NEW:()=>h});var i=s(175819);const r="a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’",o="(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?)",a=`(?:[${r}_\\d]|${o})`,n=`(^|[s.,:'";>)(]?)(${`(#${a}{0,100}${`(?:[${r}]|${o})`}${a}{0,100})`})(@${i.RE_DOMAIN_PATTERN})?(?=$|[s.,:'"&;?<)(]?)`,c="&#(\\d{3,5});",d="(?:&#\\d{3,5};)",l=`(?:[${r}_\\d]|${d})`,h=`(^|[s.,:'";>)(]?)(${`(#${l}{0,100}${`(?:[${r}]|${d})`}${l}{0,100})`})(@${i.RE_DOMAIN_PATTERN})?(?=$|[s.,:'"&;?<)(]?)`},371906:(e,t,s)=>{s.d(t,{ABUSE_MODULE:()=>a,GROUP_INFO_MODULE:()=>r,SPAMFEED_MODULE:()=>o,USER_INFO_MODULE:()=>i});const i="user_personal_card",r="group_personal_card",o="sf",a="abuse"},910364:(e,t,s)=>{s.d(t,{createCacheService:()=>r});var i=s(746573);const r=e=>{const t=(0,i.getEffectorServiceDomain)(e),s=Object.create(null),r=t.createStore(Object.create(null)),o=t.createEvent("add"),a=t.createEvent("delete");return r.on(o,((e,{key:t,data:s})=>(e[t]=s,e))).on(a,((e,t)=>(delete e[t],e))),{$cache:r,add:o,delete:a,get:e=>r.getState()[e]||null,isWaited:e=>void 0!==s[e],getWaited:e=>s[e],setWaited:(e,t)=>{s[e]=t},deleteWaited:e=>{delete s[e]}}}},136335:(e,t,s)=>{s.d(t,{createOwnerService:()=>r.createOwnerService,createUserService:()=>i.createUserService});var i=s(277594),r=s(43188)},43188:(e,t,s)=>{s.d(t,{createOwnerService:()=>l});var i=s(32489),r=s(805658),o=s(468073),a=s(910364),n=s(746573),c=s(33305);const d=(0,a.createCacheService)(),l=e=>{const t=e.fields||[],s=(0,n.getEffectorServiceDomain)(e),a=s.createStore({id:0}),l=s.createEvent("initialize"),h=s.createEvent("reload"),_=s.createEffect({name:"initializeFx"}),u=_.pending,p=_.doneData;return _.use((({ownerId:e,useCache:s})=>{if(s){const s=d.get(e);if(s){if(t.every((e=>s.hasOwnProperty(e))))return Promise.resolve(s)}}if(d.isWaited(e)){const s=d.getWaited(e).find((e=>t.every((t=>Boolean(e.fields[t])))));if(s)return s.promise.finally((()=>{d.deleteWaited(e)})),s.promise}let i=o.Ranges.isGroupId(e)?(0,r.apiWithPrefetch)("groups.getById",{group_ids:String(e),fields:t.join(",")}).then((t=>t.groups?.[0]||{id:e})):(0,r.apiWithPrefetch)("users.get",{user_ids:String(e),fields:t.join(",")}).then((e=>e[0]));const a={fields:t.reduce(((e,t)=>(e[t]=!0,e)),{}),promise:i},n=d.isWaited(e)?[...d.getWaited(e),a]:[a];return d.setWaited(e,n),i})),(0,i.sample)({clock:l,source:a,filter:(e,t)=>e.id!==t,fn:(t,s)=>({ownerId:s,useCache:Boolean(e?.useCache)}),target:_}),(0,i.sample)({clock:h,source:a,fn:e=>({ownerId:e.id}),target:_}),(0,i.sample)({clock:_.doneData,target:a}),(0,i.sample)({clock:_.doneData,filter:()=>Boolean(e?.useCache),fn:e=>{const t=d.get(e.id);if(t){if((0,c.isOwnerUser)(t)&&(0,c.isOwnerUser)(e))return{key:e.id,data:{...t,...e}};if((0,c.isOwnerGroup)(t)&&(0,c.isOwnerGroup)(e))return{key:e.id,data:{...t,...e}}}return{key:e.id,data:e}},target:d.add}),{$isInitializing:u,$owner:a,initialize:l,onInitialized:p,reload:h}}},277594:(e,t,s)=>{s.d(t,{createUserService:()=>a});var i=s(32489),r=s(957994),o=s(805658);const a=({domain:e})=>{const t=(e,t)=>!(!e||e.id!==t.userId),s=e.createStore(null),a=e.createEffect((({params:e})=>(0,o.apiWithPrefetch)("users.get",e))),n=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,r.api)("wall.subscribe",e.params)}))),c=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,r.api)("wall.unsubscribe",e.params)}))),d=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,r.api)("video.liveSubscribe",e.params)}))),l=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,r.api)("video.liveUnsubscribe",e.params)}))),h=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,r.api)("fave.addUser",e.params)}))),_=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,r.api)("fave.removeUser",e.params)}))),u=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,r.api)("account.ban",e.params)}))),p=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,r.api)("account.unban",e.params)}))),m=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,r.api)("bestFriends.add",e.params)}))),v=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,r.api)("bestFriends.delete",e.params)})));return(0,i.sample)({clock:a.doneData,fn:e=>e[0]||null,target:s}),(0,i.sample)({clock:n.doneData,source:s,filter:t,fn:e=>({...e,is_subscribed:1}),target:s}),(0,i.sample)({clock:c.doneData,source:s,filter:t,fn:e=>({...e,is_subscribed:0}),target:s}),(0,i.sample)({clock:d.doneData,source:s,filter:t,fn:e=>({...e,video_live:e.video_live?{...e.video_live,is_notifications_blocked:0}:void 0}),target:s}),(0,i.sample)({clock:l.doneData,source:s,filter:t,fn:e=>({...e,video_live:e.video_live?{...e.video_live,is_notifications_blocked:1}:void 0}),target:s}),(0,i.sample)({clock:h.doneData,source:s,filter:t,fn:e=>({...e,is_favorite:1}),target:s}),(0,i.sample)({clock:_.doneData,source:s,filter:t,fn:e=>({...e,is_favorite:0}),target:s}),(0,i.sample)({clock:u.doneData,source:s,filter:t,fn:e=>({...e,blacklisted_by_me:1}),target:s}),(0,i.sample)({clock:p.doneData,source:s,filter:t,fn:e=>({...e,blacklisted_by_me:0}),target:s}),(0,i.sample)({clock:m.doneData,source:s,filter:t,fn:e=>({...e,is_best_friend:!0}),target:s}),(0,i.sample)({clock:v.doneData,source:s,filter:t,fn:e=>({...e,is_best_friend:!1}),target:s}),{fetchUserFx:a,subscribeToPostsFx:n,unsubscribeFromPostsFx:c,subscribeToVideoLiveFx:d,unsubscribeFromVideoLiveFx:l,faveAddUserFx:h,faveRemoveUserFx:_,accountBanFx:u,accountUnbanFx:p,bestFriendAddFx:m,bestFriendDeleteFx:v,$user:s,domain:e}}},393465:(e,t,s)=>{s.d(t,{AddToCartEventType:()=>r,EventName:()=>n,EventType:()=>i,RemoveFromCartEventType:()=>o,Screen:()=>a});var i=function(e){return e.TYPE_CLICK="type_market_click",e.TYPE_VIEW="type_market_view",e.TYPE_ACTION="type_market_action",e}({}),r=function(e){return e.ADD_ITEM="add_item",e.SET_ITEM_AMOUNT="set_item_amount",e}({}),o=function(e){return e.ALL="all",e.SET_ITEM_AMOUNT="set_item_amount",e}({}),a=function(e){return e.MARKETPLACE_SEARCH="marketplace_search",e.MARKETPLACE_MAIN="marketplace_main",e.MARKETPLACE_SECTION="marketplace_section",e.MARKETPLACE_MY_ORDERS="marketplace_my_orders",e.MARKET_CART="market_cart",e.MARKET_ITEM="market_item",e.MARKET="market",e.GROUP_MENU="group_menu",e.FAVE_PRODUCTS="fave_products",e.MARKET_IM_CHAT="im_chat",e}({}),n=function(e){return e.TRANSITION_TO_CARTS_LIST="type_marketplace_transition_to_carts_list_click",e.TRANSITION_TO_CHECKOUT="type_marketplace_transition_to_checkout_click_item",e.TRANSITION_TO_CART="type_marketplace_transition_to_cart_click",e.VIEW_ITEM="type_market_view_item",e.ADD_ITEM_TO_BOOKMARKS="type_market_add_item_to_bookmarks",e.ADD_ITEM_TO_CART="type_add_item_to_cart",e.REMOVE_ITEM_FROM_CART="type_remove_item_from_cart_item",e.REMOVE_ITEM_FROM_BOOKMARKS="type_market_remove_item_from_bookmark",e}({})},826008:(e,t,s)=>{s.d(t,{AdminsClickAnalytics:()=>a});var i=s(468073),r=s(971150),o=s(433071);class a{logControlClick({screen:e,params:t}){this.collector.logEvent({params:{type:r.EventName.TYPE_MARKET_ITEMS_CONTROL_CLICK,screen:e,id:t.id,itemType:t.itemType}})}logEditItemClick({screen:e,params:t}){this.collector.logEvent({params:{type:r.EventName.TYPE_MARKET_END_EDIT_ITEM,screen:e,ownerId:t.ownerId,id:t.id,itemType:t.itemType,difference:t.difference,status:t.status,attachedPhotoCount:t.attachedPhotoCount}})}logModerationEditItemClick({screen:e,params:t}){this.collector.logEvent({params:{type:r.EventName.TYPE_MARKET_MODERATION_EDIT_ITEM_CLICK,screen:e,id:t.id,ownerId:t.ownerId,itemType:"market_item"}})}logModerationDeleteItemClick({screen:e,params:t}){this.collector.logEvent({params:{type:r.EventName.TYPE_MARKET_MODERATION_DELETE_ITEM_CLICK,screen:e,id:t.id,ownerId:t.ownerId,itemType:"market_item"}})}logImportsGoodsEvent({ownerId:e,eventName:t}){this.collector.logEvent({params:{type:t,screen:r.CustomScreen.MARKET_ITEMS,id:i.Ranges.convertOwnerIdToGroupId(e),ownerId:e,itemType:"market_item"}})}logAddItemGoodsEvent({id:e,eventName:t,screen:s}){this.collector.logEvent({params:{screen:s,type:t,id:i.Ranges.convertOwnerIdToGroupId(e),itemType:"market_item"}})}constructor(e=new o.ClickEventCollector){this.collector=e}}},433071:(e,t,s)=>{s.d(t,{ClickEventCollector:()=>a});var i=s(314309),r=s(452223),o=s(971150);class a{logEvent({params:e}){const t=this.constructEvent({params:e});this.statCollector.logEvent(t),this.lastNavEventId=t.id}constructEvent({params:e}){const t=this.statCollector.getBaseEvent();return{id:t.id,timestamp:t.timestamp,type:r.ProductionStatEventTypes.TYPE_CLICK,prev_nav_id:this.lastNavEventId,prev_event_id:t.prev_id||0,screen:e.screen,[r.ProductionStatEventTypes.TYPE_CLICK]:{item:{type:e.itemType,id:e.id,owner_id:e.ownerId,community_id:e.ownerId},type:o.EventType.TYPE_CLICK,[o.EventType.TYPE_CLICK]:{type:e.type,[e.type]:{changed_parameters:e.difference,attached_photo_count:e.attachedPhotoCount,status:e.status}}}}}constructor(e=new i.ProductionStatCollector){this.statCollector=e,this.lastNavEventId=0}}},971150:(e,t,s)=>{s.d(t,{CustomScreen:()=>r,EventName:()=>c,EventType:()=>n,ItemTypes:()=>o,Section:()=>i,Statuses:()=>a});var i=function(e){return e.AUTO="auto",e.SEARCH="search",e.MARKET="market",e.GROUP="group",e.MAIN="main",e}({}),r=function(e){return e.MARKET_ITEM="market_item",e.MARKET_ITEMS="market_items",e.MARKET_ALBUMS="market_albums",e}({}),o=function(e){return e.GROUP="group",e.MARKET_ITEM="market_item",e}({}),a=function(e){return e.CANCEL_EDIT_ITEM="cancel_edit_item",e.CANCEL_CREATE_ITEM="cancel_create_item",e}({}),n=function(e){return e.TYPE_CLICK="type_market_click",e}({}),c=function(e){return e.TYPE_MARKET_ITEMS_CONTROL_CLICK="type_market_items_control_click",e.TYPE_MARKET_END_EDIT_ITEM="type_market_end_edit_item",e.TYPE_MARKET_MODERATION_EDIT_ITEM_CLICK="type_market_items_moderation_edit_click",e.TYPE_MARKET_MODERATION_DELETE_ITEM_CLICK="type_market_items_moderation_delete_click",e.TYPE_MARKET_IMPORT_GOODS="type_market_import_goods",e.TYPE_MARKET_IMPORT_GOODS_START="type_market_import_goods_start",e.TYPE_MARKET_IMPORT_GOODS_FAIL="type_market_import_goods_fail",e.TYPE_MARKET_TRANSITION_TO_IMPORT_GOODS="type_market_transition_to_import_goods",e.TYPE_MARKET_TRANSITION_TO_ADD_GOODS="type_market_transition_to_add_goods",e.TYPE_MARKET_TRANSITION_TO_MANUAL_ADD_GOODS="type_market_transition_to_manual_add_goods",e}({})},511241:(e,t,s)=>{s.d(t,{ClickAnalytics:()=>a});var i=s(393465),r=s(30259),o=s(198694);class a{logAddToBookmarksClick({screen:e,params:t,refSource:s,previousScreen:i,sourceUrl:o,trackCode:a}){this.collector.logEvent({params:{type:r.EventName.ADD_ITEM_TO_BOOKMARKS,screen:e,previous_screen:i,ref_source:s,item:{track_code:a},source_url:o,[r.EventName.ADD_ITEM_TO_BOOKMARKS]:t}})}logRemoveFromBookmarksClick({screen:e,params:t,refSource:s,previousScreen:i,sourceUrl:o,trackCode:a}){this.collector.logEvent({params:{type:r.EventName.REMOVE_ITEM_FROM_BOOKMARKS,screen:e,previous_screen:i,ref_source:s,source_url:o,item:{track_code:a},[r.EventName.REMOVE_ITEM_FROM_BOOKMARKS]:t}})}logTransitionToItemClick({screen:e,params:t,refSource:s}){const{source_url:i="",previous_screen:o,track_code:a,...n}=t;this.collector.logEvent({params:{type:r.EventName.TRANSITION_TO_ITEM,previous_screen:o,ref_source:s,source_url:i,screen:e,item:{track_code:a},[r.EventName.TRANSITION_TO_ITEM]:n}})}logTransitionToSimilarClick({screen:e,previousScreen:t,sourceUrl:s="",refSource:i,params:o}){this.collector.logEvent({params:{type:r.EventName.TRANSITION_TO_SIMILARS,previous_screen:t,screen:e,source_url:s,ref_source:i,[r.EventName.TRANSITION_TO_SIMILARS]:o||{}}})}logSendMessageToOwnerClick({screen:e,params:t,refSource:s,previousScreen:i}){this.collector.logEvent({params:{type:r.EventName.SEND_MESSAGE_TO_OWNER,ref_source:s,screen:e,previous_screen:i,[r.EventName.SEND_MESSAGE_TO_OWNER]:t}})}logTransitionToMarketClick({ownerId:e,screen:t,refSource:s,previousScreen:i}){this.collector.logEvent({params:{type:r.EventName.TRANSITION_TO_MARKET,screen:t,previous_screen:i,ref_source:s,item:{owner_id:e}}})}logMarketCtaButtonClick({itemId:e,ownerId:t,screen:s,refSource:i,previousScreen:o,params:a}){this.collector.logEvent({params:{type:r.EventName.CLICK_MARKET_CTA_BUTTON,screen:s,previous_screen:o,ref_source:i,item:{id:e,owner_id:t},[r.EventName.CLICK_MARKET_CTA_BUTTON]:a}})}logImagePaginationClick({item:e,item_media_idx:t,screen:s,traffic_source:i,ref_source:o,previous_screen:a}){this.collector.logEvent({params:{type:r.EventName.IMAGE_PAGINATION_CLICK,item:e,screen:s,previous_screen:a,ref_source:o,[r.EventName.IMAGE_PAGINATION_CLICK]:{item_media_idx:t,traffic_source:i}}})}logHideMarketItemClick({itemId:e,ownerId:t,screen:s,refSource:i,itemIdx:o,trackCode:a}){this.collector.logEvent({params:{type:r.EventName.HIDE_ITEM,screen:s,ref_source:i,item:{id:e,owner_id:t,track_code:a},[r.EventName.HIDE_ITEM]:{item_idx:o}}})}logOpenMarketplaceClick({screen:e,previousScreen:t,refSource:s}){this.collector.logEvent({params:{type:r.EventName.CLICK_OPEN_MARKETPLACE,screen:e,previous_screen:t,ref_source:s}})}logTransitionToCartsListClick({screen:e,previousScreen:t,refSource:s}){this.collector.logEvent({params:{type:r.EventName.TRANSITION_TO_CARTS_LIST,screen:e,previous_screen:t,ref_source:s,ref_screen:e}})}addItemToCart({screen:e,previousScreen:t,params:s}){this.collector.logEvent({params:{type:r.EventName.ADD_ITEM_TO_CART,screen:e,previous_screen:t,ref_screen:e,ref_source:r.RefSource.BOOKMARKS,[r.EventName.ADD_ITEM_TO_CART]:{event_type:i.AddToCartEventType.ADD_ITEM,...s}}})}constructor(e=new o.ClickEventCollector){this.collector=e}}},198694:(e,t,s)=>{s.d(t,{ClickEventCollector:()=>n});var i=s(314309),r=s(452223),o=s(30259),a=s(883347);class n{logEvent({params:e}){const t=this.constructEvent({params:e});this.statCollector.logEvent(t),this.lastNavEventId=t.id}constructEvent({params:e}){const t=this.statCollector.getBaseEvent();return{id:t.id,timestamp:t.timestamp,type:r.ProductionStatEventTypes.TYPE_CLICK,prev_nav_id:this.lastNavEventId,prev_event_id:t.prev_id||0,screen:e.screen,[r.ProductionStatEventTypes.TYPE_CLICK]:{item:{type:"market_item",..."item"in e?e.item:{}},type:o.EventType.TYPE_CLICK,[o.EventType.TYPE_CLICK]:(0,a.getValidatedParams)({...e,analytics_version:1})}}}constructor(e=new i.ProductionStatCollector){this.statCollector=e,this.lastNavEventId=0}}},170722:(e,t,s)=>{s.d(t,{adminsClickAnalytics:()=>n,clickAnalytics:()=>a,viewAnalytics:()=>c});var i=s(511241),r=s(826008),o=s(905042);const a=new i.ClickAnalytics,n=new r.AdminsClickAnalytics,c=new o.ViewAnalytics},30259:(e,t,s)=>{s.d(t,{CustomScreen:()=>r,EventName:()=>n,EventType:()=>a,RefSource:()=>o,Section:()=>i});var i=function(e){return e.AUTO="auto",e.SEARCH="search",e.MARKET="market",e.GROUP="group",e}({}),r=function(e){return e.MARKET_ITEM="market_item",e.MARKET_CARTS_LIST="market_carts_list",e.MARKET_CHECKOUT="market_checkout",e.FAVE_PRODUCTS="fave_products",e}({}),o=function(e){return e.COMMUNITY_GOODS="community_goods",e.COMMUNITY_GROUP_GOODS="community_group_goods",e.COMMUNITY_SHOWCASE="community_showcase",e.SEARCH_GLOBAL="search_global",e.SEARCH_GOODS="search_goods",e.SEARCH_RECOMMENDATIONS="search_recommendations",e.SEARCH_RECOMMENDATIONS_WITH_GOODS="search_communities_with_goods",e.GLUBS="messages",e.POST="post",e.PHOTO="photo",e.VIDEO="video",e.STORIES="stories",e.CLIPS="clips",e.CART="cart",e.BOOKMARKS="bookmarks",e.MARKETPLACE="marketplace",e.VIDEO_CAROUSEL_ITEMS="video_carousel_items",e.ARTIST_GOODS="artist_goods",e.FEED_PORTLET_GOODS="feed_portlet_goods",e.OTHER="other",e.LINK="link",e.PRIMARY_BLOCK_MARKET="community_priority_block_market",e.PRIMARY_BLOCK_SERVICES="community_priority_block_services",e}({}),a=function(e){return e.TYPE_CLICK="type_market_click",e.TYPE_VIEW="type_market_view",e}({}),n=function(e){return e.ADD_ITEM_TO_BOOKMARKS="type_market_add_item_to_bookmarks",e.REMOVE_ITEM_FROM_BOOKMARKS="type_market_remove_item_from_bookmark",e.VIEW_ITEM="type_market_view_item",e.TRANSITION_TO_ITEM="type_market_transition_to_item",e.SEND_MESSAGE_TO_OWNER="type_market_send_message_to_owner_click",e.TRANSITION_TO_SIMILARS="type_market_transition_to_similars",e.TRANSITION_TO_MARKET="type_market_transition_to_market",e.CLICK_MARKET_CTA_BUTTON="type_market_cta_button_click",e.HIDE_ITEM="type_market_hide_item",e.CLICK_OPEN_MARKETPLACE="type_market_open_marketplace",e.TRANSITION_TO_CARTS_LIST="type_market_transition_to_carts_list",e.IMAGE_PAGINATION_CLICK="type_market_pagination_in_product_tile",e.ADD_ITEM_TO_CART="type_add_item_to_cart",e}({})},905042:(e,t,s)=>{s.d(t,{ViewAnalytics:()=>o});var i=s(30259),r=s(373145);class o{logMarketItemView({screen:e,previous_screen:t,params:s,view:r,ref_source:o,source_url:a,track_code:n}){this.collector.logEvent({screen:e,view:r,params:{type:i.EventName.VIEW_ITEM,previous_screen:t,ref_source:o,source_url:a,track_code:n,[i.EventName.VIEW_ITEM]:s}})}constructor(e=new r.ViewEventCollector){this.collector=e}}},373145:(e,t,s)=>{s.d(t,{ViewEventCollector:()=>n});var i=s(314309),r=s(452223),o=s(883347),a=s(30259);class n{logEvent(e){const t=this.constructEvent(e);this.statCollector.logEvent(t),this.lastNavEventId=t.id}constructEvent({screen:e,view:t,params:s}){const i=this.statCollector.getBaseEvent();return{id:i.id,timestamp:i.timestamp,type:r.ProductionStatEventTypes.TYPE_VIEW,prev_nav_id:this.lastNavEventId,prev_event_id:i.prev_id||0,screen:e,[r.ProductionStatEventTypes.TYPE_VIEW]:{item:{type:"market_item"},start_view:t.start_view,end_view:t.end_view,type:a.EventType.TYPE_VIEW,[a.EventType.TYPE_VIEW]:{...(0,o.getValidatedParams)(s),analytics_version:1}}}}constructor(e=new i.ProductionStatCollector){this.statCollector=e,this.lastNavEventId=0}}},758302:(e,t,s)=>{s.d(t,{clone:()=>i});const i=e=>{let t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&("object"==typeof e[s]&&(t[s]=i(e[s])),t[s]=e[s]);return t}},883347:(e,t,s)=>{s.d(t,{getValidatedParams:()=>o});var i=s(758302),r=s(468073);const o=e=>{const t=(0,i.clone)(e);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){if("autofill_info"===e&&Array.isArray(t[e]))continue;"object"!=typeof t[e]||Object.is(null,t[e])||(t[e]=o(t[e])),"owner_id"===e&&"number"==typeof t[e]&&r.Ranges.isUserId(t[e])&&(t[e]=-t[e]),"search_query_id"===e&&"number"!=typeof t[e]&&(t[e]=Number(t[e]??""))}return delete t.screen,t}},145697:(e,t,s)=>{s.d(t,{classNames:()=>i.classNames});var i=s(351118)},653422:(e,t,s)=>{s.d(t,{apiFaveAddNarrative:()=>r,apiFaveRemoveNarrative:()=>o});var i=s(957994);function r(e){return(0,i.api)("fave.addNarrative",e)}function o(e){return(0,i.api)("fave.removeNarrative",e)}},373237:(e,t,s)=>{s.d(t,{createFaveService:()=>o});var i=s(32489),r=s(653422);const o=({domain:e})=>{const t=e.createEvent("fire/faveAddNarrative"),s=e.createEvent("fire/faveRemoveNarrative"),o=e.createEffect("fx/faveAddNarrative"),a=e.createEffect("fx/faveRemoveNarrative");return o.use(r.apiFaveAddNarrative),a.use(r.apiFaveRemoveNarrative),(0,i.sample)({clock:t,target:o}),(0,i.sample)({clock:s,target:a}),{fireAddNarrative:t,fireRemoveNarrative:s,addNarrativeFx:o,removeNarrativeFx:a}}},620846:(e,t,s)=>{s.d(t,{swapObject:()=>i});const i=e=>{const t={};return Object.keys(e).forEach((s=>{t[e[s]]=s})),t}},507838:(e,t,s)=>{s.d(t,{findOwnerById:()=>o,isGroup:()=>r});var i=s(468073);function r(e){return i.Ranges.isGroupId(e.id)}const o=(e=0,t=[],s=[])=>{if(e)return i.Ranges.isUserId(e)?t.find((t=>t?.id===e)):s.find((t=>t?.id===Math.abs(e)))}},693080:(e,t,s)=>{s.d(t,{StoryStatsEvent:()=>i});var i=function(e){return e.MarkAdvertiser="mark_advertiser",e.EditAdvertiserMark="edit_advertiser_mark",e.OpenAdvertiser="open_advertiser_information",e.CopyERID="copy_ERID",e.OpenNarrativeStories="narrative_open_stories",e.OpenNarrative="narrative_open",e.NarrativeOther="narrative_other",e.GoToAuthor="go_to_author",e.MusicAdded="music_added",e.MusicDeleted="music_deleted",e.PlayNext="play_next",e.ClickToUnlike="click_to_unlike",e.ClickToLike="click_to_like",e.ClickToMetaAvatar="click_to_meta_avatar",e.ClickToMetaMemories="click_to_meta_memories",e.GoToNextAuthor="go_to_next_author",e.GoToPreviousAuthor="go_to_previous_author",e.CloseAutoByTime="close_auto_by_time",e.GoToNextStoryAuto="go_to_next_story_auto_by_time",e.OpenEmptyFeedback="open_empty_feedback",e.OpenRepliesList="open_replies_list",e.OpenAdvancedStatistic="open_advanced_statistic",e.CommentTap="comment_tap",e.Delete="delete",e.PauseLongTap="pause_long_tap",e.ResumeRelease="resume_release",e.ClickOnClickableSticker="click_on_clickable_sticker",e.CloseSwipeDown="close_swipe_down",e.GoToPreviouseStory="go_to_previous_story",e.GoToNextStoryTap="go_to_next_story_tap",e.LinkClick="link_click",e.CommentSend="comment_send",e.MarkNotInterested="mark_not_interested",e.OpenParentStory="open_parent_story",e.CloseTap="close_tap",e.ClickOnBadge="click_on_badge",e.OpenViewer="open_viewer",e.QuestionReplyPublish="question_reply_publish",e.QuestionReply="question_reply",e.QuestionReplyAnonymous="question_reply_anonymous",e.QuestionDelete="question_delete",e.QuestionSendMesage="question_send_message",e.QuestionShowAll="question_show_all",e}({})},33270:(e,t,s)=>{s.d(t,{apiLikesAdd:()=>r,apiLikesDelete:()=>o});var i=s(957994);function r(e){return(0,i.api)("likes.add",e)}function o(e){return(0,i.api)("likes.delete",e)}},208579:(e,t,s)=>{},733498:(e,t,s)=>{s.d(t,{createLikesService:()=>i.createLikesService});var i=s(921245);s(208579)},921245:(e,t,s)=>{s.d(t,{createLikesService:()=>o});var i=s(32489),r=s(33270);const o=({domain:e})=>{const t=e.createEvent("fire/likesAdd"),s=e.createEvent("fire/likesDelete"),o=e.createEffect("fx/likesAdd"),a=e.createEffect("fx/likesDelete");return o.use(r.apiLikesAdd),a.use(r.apiLikesDelete),(0,i.sample)({clock:t,target:o}),(0,i.sample)({clock:s,target:a}),{fireAdd:t,fireDelete:s,addFx:o,deleteFx:a}}},436185:(e,t,s)=>{s.d(t,{deleteStatDataKey:()=>n,deleteStatDataKeys:()=>c,getStatCity:()=>l,getStatData:()=>o,getStatScreen:()=>d,setStatData:()=>a});var i=s(553608);const r="market_stat_data";function o(){const e=i.vkSessionStorage.getItem(r);return e?JSON.parse(e):{}}function a(e){const t=o();i.vkSessionStorage.setItem(r,JSON.stringify({...t,...e}))}function n(e){const t=o();delete t[e],i.vkSessionStorage.setItem(r,JSON.stringify(t))}function c(e){const t=o();e.forEach((e=>{delete t[e]})),i.vkSessionStorage.setItem(r,JSON.stringify(t))}function d(){const{screen:e}=o();return e||window.cur.module}function l(){const{city:e}=o();return e}},928410:(e,t,s)=>{s.d(t,{apiMessagesSend:()=>r});var i=s(957994);function r(e){return(0,i.api)("messages.send",e)}},455673:(e,t,s)=>{s.d(t,{createMessagesService:()=>o});var i=s(32489),r=s(928410);const o=({domain:e})=>{const t=e.createEvent("fire/messageSend"),s=e.createEffect("fx/messageSend");return s.use(r.apiMessagesSend),(0,i.sample)({clock:t,target:s}),{fireMessagesSend:t,sendFx:s}}},429735:(e,t,s)=>{s.d(t,{AuxiliaryPerformanceStatsEventName:()=>i.AuxiliaryPerformanceStatsEventName,LeavingFeedEventName:()=>r.LeavingFeedEventName,PerformanceStatsEventName:()=>i.PerformanceStatsEventName,ReactPostPerformanceStatsEventName:()=>i.ReactPostPerformanceStatsEventName,SHARED_STATE_KEY:()=>o});var i=s(998143),r=s(992204);const o="performance-stats"},992204:(e,t,s)=>{s.d(t,{LeavingFeedEventName:()=>i});var i=function(e){return e.navigation_from_feed="navigation_from_feed",e.navigation_from_feed_skeleton_off="navigation_from_feed_skeleton_off",e.navigation_from_feed_skeleton_on="navigation_from_feed_skeleton_on",e.navigation_from_feed_before_page_load="navigation_from_feed_before_page_load",e.navigation_from_feed_after_page_load="navigation_from_feed_after_page_load",e.stay_in_feed="stay_in_feed",e}({})},998143:(e,t,s)=>{s.d(t,{AuxiliaryPerformanceStatsEventName:()=>o,PerformanceStatsEventName:()=>i,ReactPostPerformanceStatsEventName:()=>r});var i=function(e){return e.render="render",e.render_without_ttfb="render_without_ttfb",e.render_content="render_content",e.render_content_without_ttfb="render_content_without_ttfb",e.render_content_after_skeleton="render_content_after_skeleton",e.render_content_after_skeleton_without_ttfb="render_content_after_skeleton_without_ttfb",e.render_skeleton="render_skeleton",e.render_skeleton_without_ttfb="render_skeleton_without_ttfb",e.render_content_after_skeleton_without_skeleton="render_content_after_skeleton_without_skeleton",e.paint_content_html="paint_content_html",e.paint_content_html_without_ttfb="paint_content_html_without_ttfb",e.paint_skeleton_html="paint_skeleton_html",e.paint_skeleton_html_without_ttfb="paint_skeleton_html_without_ttfb",e.render_content_after_skeleton_without_paint_content_html="render_content_after_skeleton_without_paint_content_html",e.render_skeleton_without_paint_skeleton_html="render_skeleton_without_paint_skeleton_html",e.load_performance_stats_chunk="load_performance_stats_chunk",e.request_content_after_skeleton="request_content_after_skeleton",e.waiting_for_content_1sec="waiting_for_content_1sec",e.waiting_for_content_3sec="waiting_for_content_3sec",e.waiting_for_content_6sec="waiting_for_content_6sec",e.init_react_content="init_react_content",e.render_react_content="render_react_content",e.render_react_content_without_init_react_content="render_react_content_without_init_react_content",e.render_react_content_without_skeleton="render_react_content_without_skeleton",e.render_react_content_without_ttfb="render_react_content_without_ttfb",e}({}),r=function(e){return e.init_react_post="init_react_post",e.render_react_post="render_react_post",e.render_react_post_without_init_react_post="render_react_post_without_init_react_post",e}({}),o=function(e){return e.TTFB="TTFB",e}({})},340408:(e,t,s)=>{function i(){let e=Date.now();if("ajax"in window&&"navStart"in window.ajax&&window.ajax.navStart)return{elapsed:e-Number(window.ajax.navStart),isAjaxNav:!0};const t="vkTabLoaded"in window&&void 0!==window.vkTabLoaded?Number(window.vkTabLoaded):Date.now(),s="vkLastNav"in window&&void 0!==window.vkLastNav?Number(window.vkLastNav):Date.now();return e<s&&(e=t+Math.floor(performance.now())),{elapsed:e-s,isAjaxNav:s!==t}}s.d(t,{getTimeSinceNavigation:()=>i})},239599:(e,t,s)=>{s.d(t,{initializeSharedState:()=>r});var i=s(558137);function r(e,t,s){return(0,i.makeSharedState)(e,(()=>"function"==typeof s?s():s),{version:t})()}},633177:(e,t,s)=>{s.d(t,{generateUniqueNonce:()=>n,getLatestFeedBlockNonce:()=>a,storeLatestFeedBlockNonce:()=>o});var i=s(429735);const r=(0,s(239599).initializeSharedState)(`${i.SHARED_STATE_KEY}`,0,{latestFeedBlockPreloadNonce:null});function o(e){r.latestFeedBlockPreloadNonce=e}function a(){return r.latestFeedBlockPreloadNonce}function n(){return`${Math.floor(performance.now()).toString(36)}:${Math.random().toString(36).slice(2)}`}},365601:(e,t,s)=>{s.d(t,{trackStoryBlockChunkLoadingEnd:()=>a,trackStoryBlockChunkLoadingError:()=>l,trackStoryBlockDataLoadingEnd:()=>n,trackStoryBlockDataLoadingError:()=>h,trackStoryBlockLoadingStart:()=>o,trackStoryBlockPerfFeedRendered:()=>c,trackStoryBlockStoryBlockRendered:()=>d});var i=s(895509);const r=(0,i.makeWrappedImporter)((()=>Promise.all([s.e(64007),s.e(12334),s.e("langs/web/stories-perf-metrics")]).then(s.bind(s,964856)))),o=e=>{r(((t,s)=>{t.trackStoryBlockLoadingStart((0,i.injectTimestampIntoParamsObj)(e,s))}))},a=e=>{r(((t,s)=>{t.trackStoryBlockChunkLoadingEnd((0,i.injectTimestampIntoParamsObj)(e,s))}))},n=e=>{r(((t,s)=>{t.trackStoryBlockDataLoadingEnd((0,i.injectTimestampIntoParamsObj)(e,s))}))},c=e=>{r(((t,s)=>{t.trackStoryBlockPerfFeedRendered((0,i.injectTimestampIntoParamsObj)(e,s))}))},d=e=>{r(((t,s)=>{t.trackStoryBlockStoryBlockRendered((0,i.injectTimestampIntoParamsObj)(e,s))}))},l=e=>{r(((t,s)=>{t.trackStoryBlockChunkLoadingError((0,i.injectTimestampIntoParamsObj)(e,s))}))},h=e=>{r(((t,s)=>{t.trackStoryBlockDataLoadingError((0,i.injectTimestampIntoParamsObj)(e,s))}))}},828561:(e,t,s)=>{s.d(t,{trackStoryUpload:()=>a,trackStoryUploadFailure:()=>o});var i=s(895509);const r=(0,i.makeWrappedImporter)((()=>Promise.all([s.e(64007),s.e(12334),s.e("langs/web/stories-perf-metrics")]).then(s.bind(s,461850)))),o=e=>{r(((t,s)=>{t.trackStoryUploadFailure((0,i.injectTimestampIntoParamsObj)(e,s))}))},a=e=>{r((t=>{t.trackStoryUpload(e)}))}},505067:(e,t,s)=>{s.d(t,{trackStoryVideoError:()=>r});const i=(0,s(895509).makeWrappedImporter)((()=>Promise.all([s.e(64007),s.e(12334),s.e("langs/web/stories-perf-metrics")]).then(s.bind(s,557652)))),r=e=>{i((t=>t.trackStoryVideoError(e)))}},869397:(e,t,s)=>{s.d(t,{apiNarrativesBatchEdit:()=>a,apiNarrativesCreate:()=>r,apiNarrativesDelete:()=>n,apiNarrativesEdit:()=>o,apiNarrativesGetById:()=>c,apiNarrativesGetCustomCoverUploadServer:()=>u,apiNarrativesGetFeedBlock:()=>d,apiNarrativesGetFromOwner:()=>l,apiNarrativesReorder:()=>_,apiNarrativesSaveCustomCover:()=>h});var i=s(957994);function r(e){return(0,i.api)("narratives.create",e)}function o(e){return(0,i.api)("narratives.edit",e)}function a(e){return(0,i.api)("narratives.batchEdit",e)}function n(e){return(0,i.api)("narratives.delete",e)}function c(e){return(0,i.api)("narratives.getById",e)}function d(e={}){return(0,i.api)("narratives.getFeedBlock",e)}function l(e){return(0,i.api)("narratives.getFromOwner",e)}function h(e){return(0,i.api)("narratives.saveCustomCover",e)}function _(e){return(0,i.api)("narratives.reorder",e)}function u(e){return(0,i.api)("narratives.getCustomCoverUploadServer",e)}},942838:(e,t,s)=>{s.d(t,{createNarrativesService:()=>o});var i=s(32489),r=s(869397);const o=({domain:e})=>{const t=e.createEvent("fire/narrativesGetById"),s=e.createEvent("fire/narrativesGetFromOwner"),o=e.createEvent("fire/narrativesGetFeedBlock"),a=e.createEvent("fire/narrativesCreate"),n=e.createEvent("fire/narrativesEdit"),c=e.createEvent("fire/narrativesBatchEdit"),d=e.createEvent("fire/narrativesDelete"),l=e.createEvent("fire/narrativesSaveCustomCover"),h=e.createEvent("fire/narrativesReorder"),_=e.createEffect("fx/narrativesGetById"),u=e.createEffect("fx/narrativesGetFromOwner"),p=e.createEffect("fx/narrativesGetFeedBlock"),m=e.createEffect("fx/narrativesCreate"),v=e.createEffect("fx/narrativesEdit"),g=e.createEffect("fx/narrativesBatchEdit"),f=e.createEffect("fx/narrativesDelete"),y=e.createEffect("fx/narrativesSaveCustomCover"),S=e.createEffect("fx/narrativesReorder");return _.use(r.apiNarrativesGetById),u.use(r.apiNarrativesGetFromOwner),p.use(r.apiNarrativesGetFeedBlock),m.use(r.apiNarrativesCreate),v.use(r.apiNarrativesEdit),g.use(r.apiNarrativesBatchEdit),f.use(r.apiNarrativesDelete),y.use(r.apiNarrativesSaveCustomCover),S.use(r.apiNarrativesReorder),(0,i.sample)({clock:t,target:_}),(0,i.sample)({clock:s,target:u}),(0,i.sample)({clock:o,target:p}),(0,i.sample)({clock:a,target:m}),(0,i.sample)({clock:n,target:v}),(0,i.sample)({clock:c,target:g}),(0,i.sample)({clock:d,target:f}),(0,i.sample)({clock:l,target:y}),(0,i.sample)({clock:h,target:S}),{fireGetById:t,fireGetFromOwner:s,fireGetFeedBlock:o,fireCreate:a,fireEdit:n,fireBatchEdit:c,fireDelete:d,fireSaveCustomCover:l,fireReorder:h,getByIdFx:_,getFromOwnerFx:u,getFeedBlockFx:p,createFx:m,editFx:v,batchEditFx:g,deleteFx:f,saveCustomCoverFx:y,reorderFx:S}}},567072:(e,t,s)=>{function i(e,t=","){return e&&e.length?e.reduce(((e,s)=>{const i="rawId"in s?s.rawId:`${s.owner_id}_${s.id}`;return i&&(e+=`${e.length?t:""}${i}`),e}),""):""}s.d(t,{joinNarrativeRawIds:()=>i})},593614:(e,t,s)=>{s.d(t,{getAudienceResearchService:()=>r});var i=s(113326);const r=e=>e.resolve(i.AudienceResearchService)},616220:(e,t,s)=>{s.d(t,{apiPollsCreate:()=>o,apiPollsGetById:()=>r});var i=s(957994);function r(e){return(0,i.api)("polls.getById",e)}function o(e){return(0,i.api)("polls.create",e)}},49819:(e,t,s)=>{s.d(t,{createPollsService:()=>o});var i=s(32489),r=s(616220);const o=({domain:e})=>{const t=e.createEvent("fire/pollsGetById"),s=e.createEvent("fire/pollsCreate"),o=e.createEffect("fx/pollsGetById"),a=e.createEffect("fx/pollsCreate");return o.use(r.apiPollsGetById),a.use(r.apiPollsCreate),(0,i.sample)({clock:t,target:o}),(0,i.sample)({clock:s,target:a}),{fireGetById:t,fireCreate:s,getByIdFx:o,createFx:a}}},646482:(e,t,s)=>{s.d(t,{getAddUserButtonType:()=>l,getOnboadingIconSrc:()=>c,isFollowerBlockActive:()=>n,isNftMarketSearchTokensResponse:()=>_,isNftMarketToken:()=>h,isProfileWebSpaEnabled:()=>u,replaceHashTagsInfo:()=>d});var i=s(903413),r=s(540462),o=s(485910),a=s(105330);function n(e,t,s,i=!1){if(!e.can_send_friend_request||e.is_followers_mode_on&&i)return!0;if(e.id===t.id&&s){const e=s.settings.find((e=>"friends_requests"===e.key)),t=e?.value;if(t&&"category"in t)return"all"!==t.category}return!1}function c(e){const{icons_dark:t}=e;if(!t)return"";const[s,i]=t;return 1===window.devicePixelRatio?s.url:i.url}function d(e){if(e)try{return(0,o.replaceHashtags)(e,(e=>`<a href="/feed?section=search&q=${encodeURIComponent(e)}">${e}</a>`))}catch(t){return console.log(t),e}}function l({owner:e}){return e.friend_status===i.FriendsFriendStatusStatusEnumNames.NOT_A_FRIEND?!e.is_followers_mode_on&&e.is_closed?"send_request":e.can_send_friend_request&&"follow"!==e.social_button_type?"add_friend":"folllow":e.friend_status===i.FriendsFriendStatusStatusEnumNames.OUTCOMING_REQUEST?!e.is_followers_mode_on&&e.is_closed?"request_sended":"you_followed":e.friend_status===i.FriendsFriendStatusStatusEnumNames.INCOMING_REQUEST?!e.is_followers_mode_on&&e.is_closed?"request_sended_to_you":"following_you":null}function h(e){return"public_id"in e&&"owner_profile_id"in e}function _(e){return void 0!==e&&"models"in e}function u(){return(0,r.partConfigEnabled)("profile_web_spa_enabled")&&!window.vk?.isSearchBot&&!(0,a.isMvk)()}},554731:(e,t,s)=>{s.d(t,{HIDE_TOOLTIP_TIMEOUT:()=>i,OPENED_REACTED_USERS_DEFAULT_REACTION_ID:()=>l,REACTION_ID_DEFAULT:()=>o,REACTION_ID_MAX:()=>a,REACTION_ID_MIN:()=>n,REACTION_ID_UNSET:()=>c,REACTION_SET_ITEMS_MIN_COUNT:()=>d,SHOW_TOOLTIP_TIMEOUT:()=>r});const i=600,r=140,o=0,a=7,n=0,c=void 0,d=2,l=o},888065:(e,t,s)=>{s.d(t,{reactionCountsBrandUnwrap:()=>r,reactionCountsBrandWrap:()=>o});var i=s(672330);const r=e=>(0,i.unwrap)(e),o=e=>(0,i.wrap)(e)},369296:(e,t,s)=>{s.d(t,{areCountersEqual:()=>E,calcCounters:()=>S,calcCountersSum:()=>w,calcCountersWeightedSum:()=>b,getDefaultReaction:()=>d,getDefaultReactionTitle:()=>l,getReaction:()=>c,hasReactionsForCounts:()=>k,isReactionIdSet:()=>u,isReactionIdUnset:()=>p,isUnknownObject:()=>n,isValidReactionId:()=>m,parseReactionId:()=>v,parseReactionIdOrUnset:()=>g,parseReactionMenuConfig:()=>y,prepareReactionMenuSet:()=>_,validateReactionSetPayloaditems:()=>f});var i=s(554731),r=s(888065),o=s(351118);const a=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e),n=e=>null!==e&&"object"==typeof e,c=(e,t)=>e.itemsById[t],d=e=>c(e,i.REACTION_ID_DEFAULT),l=e=>d(e)?.title,h=(e,t)=>0===e.length?"":((e,t,s=!0)=>e.reduce(((e,i)=>{const r=t(i),o=t(e);return o===r?s?e:i:o<r?e:i})))(e,(e=>(t.width-e.width)**2+(t.height-e.height)**2),!1).url,_=(e,t,s)=>{const i=t.map((({asset:e,color_sets:t,id:i,score:r,title:o})=>({animationURL:e.animation_url||void 0,backgroundColor:t?.background,id:i,imageMenuURL:h(e.images,s.imageMenuSize),imagePreviewURL:"imagePreviewSize"in s?h(e.images,s.imagePreviewSize):void 0,imageStoryPanelURL:"imageStoryPanelSize"in s?h(e.images,s.imageStoryPanelSize):void 0,imageStoryPreviewURL:"imageStoryPreviewSize"in s?h(e.images,s.imageStoryPreviewSize):void 0,score:r,title:o,titleColor:t?.foreground}))),r={};return i.forEach((e=>{r[e.id]=e})),{id:e,items:i,itemsById:r}},u=e=>e!==i.REACTION_ID_UNSET,p=e=>e===i.REACTION_ID_UNSET,m=e=>a(e)&&e>=i.REACTION_ID_MIN&&e<=i.REACTION_ID_MAX,v=e=>{const t=parseInt(e,10);return m(t)?{isValid:!0,value:t}:{isValid:!1}},g=e=>{const t=v(e);return t.isValid?t.value:i.REACTION_ID_UNSET},f=(e,t)=>{if(e.length<i.REACTION_SET_ITEMS_MIN_COUNT)return{error:new Error(`Invalid reactions items count in set '${t}': ${e.length}`)}},y=e=>{if(!n(e))return;const t={},{animationShowStaticAfterEnd:s,menuShowDelay:r,openedDefaultReactionId:o,reportJsErrors:a}=e;return"number"!=typeof r&&void 0!==r||(t.menuShowDelay=r),"boolean"==typeof s&&(t.animationShowStaticAfterEnd=s),"boolean"==typeof a&&(t.reportJsErrors=a),"number"==typeof o||null===o?null===o?t.openedDefaultReactionId=void 0:m(o)&&(t.openedDefaultReactionId=o):t.openedDefaultReactionId=i.OPENED_REACTED_USERS_DEFAULT_REACTION_ID,t},S=(e,t)=>{const s=(0,r.reactionCountsBrandWrap)({});return Object.entries((0,r.reactionCountsBrandUnwrap)(e)).forEach((([e,i])=>{const r=e,o=t?.itemsById?.[r]?.score??1;s[r]=o*(i||0)})),s},w=e=>Object.values((0,r.reactionCountsBrandUnwrap)(e)).reduce(((e,t)=>e+(t||0)),0),b=e=>w((0,r.reactionCountsBrandWrap)(e)),k=e=>w(e)>0,E=(e,t)=>e&&t?(0,o.isEqual)(e,t):e===t},672330:(e,t,s)=>{s.d(t,{unwrap:()=>i,wrap:()=>r});const i=e=>e,r=e=>e},913885:(e,t,s)=>{s.d(t,{apiStatsTrackEvents:()=>r});var i=s(957994);function r(e){return(0,i.api)("stats.trackEvents",e)}},809152:(e,t,s)=>{s.d(t,{STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION:()=>i,STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME:()=>r,STATS_EVENT_TYPE_STORY_LINK_VIEW:()=>o,STATS_EVENT_TYPE_VIDEO_ONBOARDING:()=>a});const i="stories_viewer_navigation",r="stories_viewing_start_time",o="story_link_view",a="video_onboarding"},744030:(e,t,s)=>{s.d(t,{createStatsService:()=>o});var i=s(32489),r=s(913885);const o=({domain:e})=>{const t=e.createEvent("fire/statsTrackEvents"),s=e.createEffect("fx/statsTrackEvents");return s.use(r.apiStatsTrackEvents),(0,i.sample)({clock:t,target:s}),{fireTrackEvents:t,trackEventsFx:s}}},565703:(e,t,s)=>{s.d(t,{STICKERS_CONFDATA_KEY:()=>i,isNewStickerPicker:()=>r,isUGCStickersEnabled:()=>o});var i=function(e){return e.UGC="stickers.ugc",e.PROMO_VMOJI_COUNTER="vmoji.promo.avatar_suggestion.promo_counter",e.NEW_STICKER_PICKER="new_sticker_picker",e}({});function r(){return!0}function o(){return!0}},968351:(e,t,s)=>{s.d(t,{InitOptionsProvider:()=>o,useInitOptions:()=>a});var i=s(296540);const r=(0,i.createContext)({}),o=r.Provider;function a(){const{payload:e,...t}=(0,i.useContext)(r);return{...e,...t}}},636843:(e,t,s)=>{s.d(t,{stickers:()=>i});const i=(0,s(32489).createDomain)()},553560:(e,t,s)=>{s.d(t,{hideSnackbar:()=>o,showSnackbar:()=>r});var i=s(32489);const r=(0,i.createEvent)(),o=(0,i.createEvent)()},141324:(e,t,s)=>{s.d(t,{openProductModal:()=>i});const i=s(636843).stickers.createEvent()},604226:(e,t,s)=>{s.d(t,{StoriesPreloadManager:()=>c});var i=s(646938),r=s(645043),o=s(182807),a=s(702736),n=s(362570);class c{getVkVideoPlayer(e,t,s){let i=this.vkVideoPlayers.get(String(e));return i&&i.videoContainer||(i=new a.StoriesVkVideoPlayer({unitedVideoId:e,sources:t,vkVideoConfig:this.vkVideoConfig},this.userEnv,this.metaData),this.params?.place&&i.setPlace(this.params.place),this.vkVideoPlayers.set(e,i)),s&&i.setPlace(s),i}async preloadVideoStory(e){e.type===i.StoryType.VIDEO&&(this.vkVideoConfig&&!this.params?.withoutVkVideoPlayer&&e.vkVideoConfig?.unitedVideoId&&e.vkVideoConfig?.sources?await this.getVkVideoPlayer(String(e.vkVideoConfig?.unitedVideoId),e.vkVideoConfig?.sources).preload():e.video_url&&await this.videoElementManager.preloadVideo(e.video_url))}preloadImage(e){return(0,r.loadImageAsDataUrl)(e)}async preloadStory(e){switch(e.type){case i.StoryType.PHOTO:return void await this.preloadImage(e.photo_url);case i.StoryType.VIDEO:await this.preloadVideoStory(e)}}constructor(e,t,s,i){this.vkVideoConfig=e,this.params=t,this.userEnv=s,this.metaData=i,this.vkVideoPlayers=new o.default({maxSize:3,onEviction:(e,t)=>{t.destroy()}}),this.videoElementManager=new n.VideoElementManager(5,this.params?.legacyVideoPreloadEvent??"canplay")}}},288191:(e,t,s)=>{s.d(t,{apiStoriesAskQuestion:()=>b,apiStoriesBanOwner:()=>M,apiStoriesBanQuestionAuthor:()=>E,apiStoriesDelete:()=>w,apiStoriesDeleteQuestion:()=>k,apiStoriesGet:()=>o,apiStoriesGetArchive:()=>d,apiStoriesGetById:()=>n,apiStoriesGetDetailedStats:()=>m,apiStoriesGetDiscover:()=>c,apiStoriesGetPhotoUploadServer:()=>I,apiStoriesGetQuestions:()=>u,apiStoriesGetReplies:()=>h,apiStoriesGetStats:()=>p,apiStoriesGetVideoUploadServer:()=>T,apiStoriesGetViewers:()=>l,apiStoriesGetWithPrefetch:()=>a,apiStoriesHideAllReplies:()=>R,apiStoriesHidePrivacyBlock:()=>S,apiStoriesHideReply:()=>P,apiStoriesMarkNotInterested:()=>g,apiStoriesMarkSeen:()=>y,apiStoriesMarkSkipped:()=>v,apiStoriesSave:()=>L,apiStoriesSearch:()=>f,apiStoriesSeenReplies:()=>_,apiStoriesSetDiscoverVisible:()=>x,apiStoriesUnbanOwner:()=>A,apiStoriesUnbanQuestionAuthor:()=>C});var i=s(957994),r=s(805658);function o(e){return(0,i.api)("stories.get",e)}function a(e){return(0,r.apiWithPrefetch)("stories.get",e)}function n(e){return(0,i.api)("stories.getById",e)}function c(e){return(0,i.api)("stories.getDiscover",e)}function d(e){return(0,i.api)("stories.getArchive",e)}function l(e){return(0,i.api)("stories.getViewers",e)}function h(e){return(0,i.api)("stories.getReplies",e)}function _(e){return(0,i.api)("stories.seenReplies",e)}function u(e){return(0,i.api)("stories.getQuestions",e)}function p(e){return(0,i.api)("stories.getStats",e)}function m(e){return(0,i.api)("stories.getDetailedStats",e)}function v(e){return(0,i.api)("stories.markSkipped",e)}function g(e){return(0,i.api)("stories.markNotInterested",e)}function f(e){return(0,i.api)("stories.search",e)}function y(e){return(0,i.api)("stories.markSeen",e)}function S(e){return(0,i.api)("stories.hidePrivacyBlock",e)}function w(e){return(0,i.api)("stories.delete",e)}function b(e){return(0,i.api)("stories.askQuestion",e)}function k(e){return(0,i.api)("stories.deleteQuestion",e)}function E(e){return(0,i.api)("stories.banQuestionAuthor",e)}function C(e){return(0,i.api)("stories.unbanQuestionAuthor",e)}function I(e){return(0,i.api)("stories.getPhotoUploadServer",e)}function T(e){return(0,i.api)("stories.getVideoUploadServer",e)}function L(e){return(0,i.api)("stories.save",e)}function M(e){return(0,i.api)("stories.banOwner",e)}function A(e){return(0,i.api)("stories.unbanOwner",e)}function x(e){return(0,i.api)("stories.setDiscoverVisible",e)}function P(e){return(0,i.api)("stories.hideReply",e)}function R(e){return(0,i.api)("stories.hideAllReplies",e)}},837066:(e,t,s)=>{s.d(t,{STORIES_ARCHIVE_START_TIME:()=>i,STORIES_MAX_COUNT_REPLIES:()=>r});const i=1559032200,r=250},828912:(e,t,s)=>{s.d(t,{StoryFeedbackLoadMethods:()=>o,fetchFeedbackFx:()=>n,getStoryFeedbackLoadParams:()=>a});var i=s(564586),r=s(594496),o=function(e){return e[e.getViewers=0]="getViewers",e[e.getReplies=1]="getReplies",e[e.seenReplies=2]="seenReplies",e[e.getQuestions=3]="getQuestions",e[e.getDetailedStats=4]="getDetailedStats",e}({});const a=(e,t)=>({0:{owner_id:e,story_id:t,extended:1,count:100,fields:(0,r.makeOwnerFields)(["photo_100","photo_50"])},1:{owner_id:e,story_id:t,extended:1,fields:(0,r.getStoryOwnerFields)()},2:{owner_id:e,story_id:t},3:{owner_id:e,story_id:t,extended:1,fields:(0,r.makeOwnerFields)(["domain","first_name_dat","first_name_ins","last_name_ins","last_name_dat","first_name_gen","last_name_gen"]),count:100},4:{owner_id:e,story_id:t}}),n=i.storiesDomain.createEffect({name:"fire/storiesGetFeedback",handler:({ownerId:e,storyId:t,pollId:s})=>{const r=a(e,t);return Promise.allSettled([i.storiesService.getViewersFx(r[0]),i.storiesService.getRepliesFx(r[1]),i.storiesService.getQuestionsFx(r[3]),s?i.pollsService.getByIdFx({owner_id:e,poll_id:s}):Promise.resolve(null),i.storiesService.getDetailedStatsFx(r[4])]).then((e=>e.map((e=>"fulfilled"===e.status?e?.value:null)))).finally((()=>{i.storiesService.seenRepliesFx(r[2])}))}})},41903:(e,t,s)=>{s.d(t,{STORIES_ARCHIVE_START_TIME:()=>d.STORIES_ARCHIVE_START_TIME,STORIES_MAX_COUNT_REPLIES:()=>d.STORIES_MAX_COUNT_REPLIES,StoryFeedbackLoadMethods:()=>c.StoryFeedbackLoadMethods,apiStoriesGet:()=>a.apiStoriesGet,apiStoriesGetArchive:()=>a.apiStoriesGetArchive,apiStoriesGetById:()=>a.apiStoriesGetById,apiStoriesGetDiscover:()=>a.apiStoriesGetDiscover,apiStoriesGetReplies:()=>a.apiStoriesGetReplies,apiStoriesGetWithPrefetch:()=>a.apiStoriesGetWithPrefetch,apiStoriesSearch:()=>a.apiStoriesSearch,createStoriesService:()=>i.createStoriesService,decodeBase64:()=>r.decodeBase64,faveService:()=>n.faveService,fetchFeedbackFx:()=>c.fetchFeedbackFx,getStoryFeedbackLoadParams:()=>c.getStoryFeedbackLoadParams,narrativesService:()=>n.narrativesService,saveNavigationStatEvent:()=>o.saveNavigationStatEvent,saveViewerStartTime:()=>o.saveViewerStartTime,splitStoryRawId:()=>r.splitStoryRawId,statsService:()=>n.statsService,storiesService:()=>n.storiesService,userService:()=>n.userService});var i=s(898368),r=s(601686),o=s(541756),a=s(288191),n=s(564586),c=s(828912),d=s(837066)},927966:(e,t,s)=>{s.d(t,{FEED_STORIES_BLOCK_OWNER_FIELDS:()=>r,FEED_STORIES_BLOCK_OWNER_MINIMIZED_FIELDS:()=>i});const i=["photo_100"],r=["first_name","last_name","first_name_gen","last_name_gen","first_name_ins","last_name_ins","screen_name","name","is_member","is_closed","photo_50","photo_100","photo_200","friend_status","verified","sex"]},210816:(e,t,s)=>{s.d(t,{logStoriesError:()=>o});var i=s(339328),r=s(636576);const o=(0,i.createSentryLogger)({debugPrefix:"[Stories]",catchNetworkError:()=>((0,r.statlogsValueEvent)("stories_api_web_errors","network error"),!0)})},122442:(e,t,s)=>{s.d(t,{fetchList:()=>w,parseExtra:()=>k});var i=s(591024),r=s(41903),o=s(869397),a=s(594496),n=s(105330),c=s(567072),d=s(957994);const l=/^feed$/,h=/^discover$/,_=/^(-?\d+)_(\d+)/,u=/^owner_feed(-?\d+)/,p=/^replies(-?\d+)_(\d+)/,m=/^narrative(-?\d+)_(\d+)$/,v=/^narratives(-?\d+)$/,g=/^archive(?:(-?\d+)_)?([0-9]+)/,f=/^ads_preview(\d+)$/,y=/^search_([\w|-]+)/,S=/^place(\d+)/;function w(e,t){let s=e.match(l);if(s)return(0,r.apiStoriesGetWithPrefetch)({fields:(0,a.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)()),nextFrom:t?.next_from||"",response:t})));if(s=e.match(h),s)return(0,r.apiStoriesGetDiscover)({count:t?.count,track_code:t?.trackCode,start_from:t?.startFrom,fields:(0,a.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)()),nextFrom:t?.next_from||""})));if(s=e.match(u),s){const t=Number(s[1]);return t?(0,r.apiStoriesGet)({owner_id:t,fields:(0,a.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)()),nextFrom:t?.next_from||""}))):Promise.reject("empty ownerId")}if(s=e.match(p),s){const t=Number(s[1]),o=Number(s[2]);return t&&o?(0,r.apiStoriesGetReplies)({owner_id:t,story_id:o,fields:(0,a.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)()),nextFrom:t?.next_from||""}))):Promise.reject("ownerId or storyId is empty")}if(s=e.match(f),s){const r=Number(s[1]),o=t?.ads_preview_hash;return r&&o?(0,d.api)("stories.getByAds",{ad_id:r,hash:o,extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)())}))):Promise.reject("ownerId or hash is empty")}if(s=e.match(m),s){const i=Number(s[1]),r=Number(s[2]);if(!i||!r)return Promise.reject("ownerId or narrativeId is empty");return b(e,`${i}_${r}`,t?.access_hash)}if(s=e.match(v),s){const i=Number(s[1]);if(!i)return Promise.reject("ownerId is empty");let r=t?.narrativeRawIds;return r?.length?b(e,r):(0,o.apiNarrativesGetFromOwner)({owner_id:i,with_empty:0,limit:15}).then((t=>(r=(0,c.joinNarrativeRawIds)(t?.items),r?.length?b(e,r):Promise.reject("narrativeRawIds is empty"))))}if(s=e.match(g),s){const t=Number(s[1]),o=Number(s[2]);return t?(0,r.apiStoriesGetArchive)({date:o,fields:(0,a.getStoryOwnerFields)(),extended:1,owner_id:t}).then((t=>({list:(0,i.transformStoriesToLegacy)(t,e,(0,n.isMvk)())}))):Promise.reject("ownerId is empty")}if(s=e.match(_),s){const o=Number(s[1]),c=Number(s[2]);if(!o||!c)return Promise.reject("ownerId or storyId is empty");const d=t?.context;if("all"===d||"new"===d)return(0,r.apiStoriesGet)({fields:(0,a.getStoryOwnerFields)(),extended:1,first_owner_id:o}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)())})));{const s={stories:`${o}_${c}`,with_context:"owner"===d?1:0,fields:(0,a.getStoryOwnerFields)(),extended:1};return t?.access_hash&&(s.access_hash=t?.access_hash),(0,r.apiStoriesGetById)(s).then((t=>({list:(0,i.transformStoriesToLegacy)(t,e,(0,n.isMvk)())})))}}if(s=e.match(y),s){const o=s[1],c=t?.situationalSuggestId;if(!o&&void 0===c)return Promise.reject("rawQuery or suggest id is empty");let d="";if(o){const e=o.replaceAll("-","+").replaceAll("_","/");d=(0,r.decodeBase64)(e)}return(0,r.apiStoriesSearch)({q:d,count:100,situational_suggest_id:c,fields:(0,a.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)())})))}if(s=e.match(S),s){const t=Number(s[1]);return t?(0,r.apiStoriesSearch)({place_id:t,count:100,fields:(0,a.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)())}))):Promise.reject("place id is empty")}return Promise.reject("unknown list")}function b(e="",t="",s){const r={narratives:t,fields:(0,a.getStoryOwnerFields)(),extended:1};return s&&(r.access_hash=s),(0,o.apiNarrativesGetById)(r).then((t=>({list:(0,i.transformNarrativeGetApiResponseToLegacyFormat)(t,e,(0,n.isMvk)())})))}function k(e){const t={},s=String(e).split(";");for(let e of s){const[s,i]=e.split(":");s&&i&&(t[s]=i)}return t}},594496:(e,t,s)=>{s.d(t,{getStoryOwnerFields:()=>r,makeOwnerFields:()=>o});var i=s(927966);function r(e=!1){return o(e?i.FEED_STORIES_BLOCK_OWNER_MINIMIZED_FIELDS:i.FEED_STORIES_BLOCK_OWNER_FIELDS)}function o(e){return e.join(",")}},117295:(e,t,s)=>{s.d(t,{transformClickableStickers:()=>m});var i=s(351118),r=s(33305),o=s(52905),a=s(356812),n=s(866467),c=s(507838),d=s(34231),l=s(646938);const h={hashtag:l.StickerTypes.hashtag,mention:l.StickerTypes.mention,question:l.StickerTypes.question,place:l.StickerTypes.place,music:l.StickerTypes.music,story_reply:l.StickerTypes.storyReply,owner:l.StickerTypes.owner,link:l.StickerTypes.link,market_item:l.StickerTypes.marketItem,post:l.StickerTypes.post,poll:l.StickerTypes.poll,sticker:l.StickerTypes.sticker,app:l.StickerTypes.app,situational_theme:l.StickerTypes.situationalTheme,playlist:l.StickerTypes.playlist,clip:l.StickerTypes.videoButton,vk_video:l.StickerTypes.videoButton,situational_template:l.StickerTypes.situationalTemplate,spoiler:l.StickerTypes.spoiler,service_yc_item:l.StickerTypes.service_yc_item,photo:l.StickerTypes.photo,album:l.StickerTypes.album},_={transparent:1,blue_gradient:2,red_gradient:3,underline:4,blue:5,green:6,white:7,question_reply:8,light:9,impressive:10,dark:11,accent_background:12,accent_text:13,dark_unique:14,light_unique:15,light_text:18,dark_text:19,black:20,dark_without_bg:21,light_without_bg:22,rectangle:23,circle:24,poop:25,heart:26,star:27,album:28,horizontal:29,equalizer:30,header_meta:31,preview:32,miniature:33,fullview:34,cta:35,sticker:36,sticker_and_cta:37,accent:38},u=(e,t=6)=>isNaN(e)?NaN:Number(e.toFixed(t)),p=/^\[(id|club)(\d+)\|(.*)]$/;function m(e,t=[],s=[],m){const v=e?.clickable_stickers;if(!(v&&Object.values(v).length&&v.original_width&&v.original_height))return{original_width:0,original_height:0,stickers:[]};let g=v.original_width,f=v.original_height;Number((f/g).toFixed(2))>1.78&&(f=1.78*g);const y=(v.original_height-f)/2,S=g/100,w=f/100;return{original_width:g,original_height:f,stickers:v?.clickable_stickers?.length?v.clickable_stickers.reduce(((e,v)=>{if(!v)return e;const{clickable_area:g=[]}=v;if(g.length<4)return e;const f=Math.sqrt(Math.pow(g[1].x-g[0].x,2)+Math.pow(g[1].y-g[0].y,2)),b=Math.sqrt(Math.pow(g[1].x-g[2].x,2)+Math.pow(g[1].y-g[2].y,2));if(!f||!b)return e;const k=g[1].x-g[0].x;let E=180*Math.acos(k/f)/Math.PI;isNaN(E)&&(E=0),g[1].y<g[0].y&&(E=-E);const C=h[v.type],I={id:v.id,type:C,top:u((g[0].y-y)/w/100),left:u(g[0].x/S/100),width:u(f/S/100),height:u(b/w/100),rotate:u(E)};v.style&&(I.style=_[v.style],I.stickerStyle=v.style);let T=!1;switch(C){case l.StickerTypes.hashtag:v.hashtag?I.hashtag=v.hashtag:T=!0;break;case l.StickerTypes.mention:{const e=v.mention?.match(p),i=e?.[1],o=Number(e?.[2]);if(!o||isNaN(o)){T=!0;break}const a="id"===i&&t.find((({id:e})=>e===o)),n=!a&&"club"===i&&s.find((({id:e})=>e===o));a?(I.mentionedPhotoUrl=a.photo_100||a.photo_50||"",I.mentionedOwnerHref=(0,r.getOwnerHref)(a),I.mentionedText=(0,r.getOwnerFullName)(a)):n?(I.mentionedText=n.name||"",I.mentionedPhotoUrl=n.photo_100||n.photo_50||"",I.mentionedOwnerHref=(0,r.getOwnerHref)(n)):T=!0;break}case l.StickerTypes.question:I.question=v.question||"";break;case l.StickerTypes.place:v.place_id?I.placeId=v.place_id:T=!0;break;case l.StickerTypes.music:if(!v.audio){T=!0;break}I.audioId=`${v.audio.owner_id}_${v.audio.id}`,I.audioData=JSON.stringify((0,a.apiAudioToAudioTuple)(v.audio)),v.audio_restrictions&&(I.audioRestriction={code:v.audio_restrictions.id,title:v.audio_restrictions.title,buttonText:v.audio_restrictions.button?.title||"",buttonUrl:v.audio_restrictions.button?.action?.url||""}),I.audio=v.audio;break;case l.StickerTypes.playlist:if(!v.playlist){T=!0;break}I.playlistOwnerId=v.playlist.owner_id,I.playlistId=v.playlist.id,I.playlistAccessHash=v.playlist.followed?.access_key||v.playlist.access_key||"",I.playlistFollowed=Boolean(v.playlist.followed),I.playlistFollowedId=v.playlist.followed?.playlist_id,I.playlistFollowedOwnerId=v.playlist.followed?.owner_id,I.audioPlaylist=v.playlist;break;case l.StickerTypes.storyReply:v.owner_id&&(I.ownerId=v.owner_id),I.link=(0,r.getOwnerHref)((0,c.findOwnerById)(v.owner_id,t,s)),v.story_id?I.storyId=v.story_id:I.isExpired=!0;break;case l.StickerTypes.owner:v.owner_id&&(I.ownerId=v.owner_id),I.link=(0,r.getOwnerHref)((0,c.findOwnerById)(v.owner_id,t,s));break;case l.StickerTypes.link:v.link_object?(I.link=v.link_object.url?(0,d.wrapAwayIfExternal)(v.link_object.url,!0):"",I.tooltipText=v.tooltip_text||""):T=!0;break;case l.StickerTypes.marketItem:if(v.market_item)if(I.photoUrl=v.market_item.thumb&&(0,i.getPhotoSize)(v.market_item.thumb,50*devicePixelRatio)?.url||"",I.isRestricted=!1,m)I.link=`/product${v.market_item.owner_id}_${v.market_item.id}`;else{const e=(0,r.getOwnerHref)((0,c.findOwnerById)(v.market_item.owner_id,t,s));I.link=`${e}?w=product${v.market_item.owner_id}_${v.market_item.id}`,I.seoSlug=v.market_item.seo_slug}else T=!0;break;case l.StickerTypes.service_yc_item:const e=window.location;try{if(!v.link_object?.title||!v.link_object?.url){T=!0;break}const t=new URL(v.link_object.url);I.link=e.origin+t.pathname+t.search,I.tooltipText=v.link_object.title}catch{T=!0}break;case l.StickerTypes.photo:v.photo_id&&v.photo_owner_id?(I.photoId=v.photo_id,I.photoOwnerId=v.photo_owner_id):T=!0;break;case l.StickerTypes.post:v.post_owner_id&&(I.postOwnerId=v.post_owner_id),v.post_id?I.postId=v.post_id:T=!0;break;case l.StickerTypes.poll:v.poll?(I.pollId=v.poll.id,I.pollOwnerId=v.poll.owner_id):T=!0;break;case l.StickerTypes.sticker:v.sticker_pack_id?(I.stickerPackId=v.sticker_pack_id,v.sticker_id&&(I.stickerId=v.sticker_id),I.tooltipText=(0,n.getLang)("stories_view_sticker_pack")):T=!0;break;case l.StickerTypes.situationalTheme:v.situational_theme_id?(I.situationalAppId=o.SITPOSTING_APP_ID,I.situationalThemeId=v.situational_theme_id):T=!0;break;case l.StickerTypes.videoButton:v.clip_id||v.video_id?(v.owner_id&&(I.videoOwnerId=v.owner_id),I.videoId=v.clip_id||v.video_id||0,I.videoType=v.clip_id?"clip":"video",I.tooltipText=v.clip_id?(0,n.getLang)("stories_link_attach_clip"):(0,n.getLang)("stories_link_attach_video")):T=!0;break;case l.StickerTypes.situationalTemplate:v.situational_theme_id?(I.situationalAppId=o.SITPOSTING_APP_ID,I.situationalThemeId=v.situational_theme_id,v.situational_replied_users&&(I.situationalRepliedUsers=v.situational_replied_users,I.situationalRepliedAvatars=v.situational_replied_users?.items?.map((e=>{const{photo_100:i}=t.find((t=>t.id===e))||{},{photo_100:r}=s.find((t=>t.id===e))||{},o=i||r;if(o)return{photo_100:o}})).filter((e=>Boolean(e)))||[])):T=!0;break;default:T=!0}return T||e.push(I),e}),[]):[]}}},937625:(e,t,s)=>{s.d(t,{transformDetailedStatsData:()=>_,transformPoll:()=>h,transformStoryQuestions:()=>l});var i=s(866467),r=s(351118),o=s(468073),a=s(33305),n=s(646938);const c=(e="",t="")=>e&&t?`${e} ${t}`:e||t,d=(e,t=32)=>(0,r.getPhotoSize)(e??[],t*window.devicePixelRatio),l=(e,t,s=0,i=0)=>(0,r.isArray)(e)&&(0,r.isArray)(t)?e.map((({id:e,is_anonymous:r,question:n,is_owner_blocked:d,is_published:l,owner_id:h})=>{const _=!r&&window.vk.id!=h&&!o.Ranges.isGroupId(s),u=!r&&window.vk.id!=h,p=t?.find((e=>e?.id===h));return{author:p?{link:(0,a.getOwnerHref)(p),name:(0,a.getOwnerFullName)(p),nameDat:c(p?.first_name_dat,p?.last_name_dat),nameGen:c(p?.first_name_gen,p?.last_name_gen),nameIns:c(p?.first_name_ins,p?.last_name_ins)}:{},canAnswer:_,canBlocked:u,id:e,isAnonymous:r,isOwnerBlocked:d,isPublished:l,ownerId:h,storyId:i,storyOwnerId:s,text:n}})):[],h=e=>{if(!e)return null;const{votes:t,id:s,owner_id:r,question:o,photo:a,background:c,can_vote:l}=e;return{ownerId:r,pollId:s,question:o,votersCountText:t?(0,i.getLang)("voting_N_voted",t):(0,i.getLang)("voting_nobody_voted"),background:a?{type:n.StoryPollBackgroundType.photo,photoUrl:d(a?.images)?.url||"",backgroundColor:a?.color||""}:"gradient"===c?.type?{type:n.StoryPollBackgroundType.gradient,angle:c.angle||0,color:c.color||"",points:c.points||[]}:{type:n.StoryPollBackgroundType.default},needShowResults:!l}},_=e=>e?{preview:e.preview||"",achievement:e.achievement||"",achievementSubtitle:e.achievement_subtitle||"",categories:e.categories?.map((e=>({title:e.header,type:e.type,lines:e.lines.map((e=>({name:e.name||"",type:e.type,counter:e.is_unavailable?(0,i.getLang)("stories_stat_off"):String(e.counter??""),unavailable:e.is_unavailable})))})))||[]}:null},591024:(e,t,s)=>{s.d(t,{transformDetailedStatsData:()=>a.transformDetailedStatsData,transformGetNarrativesResponseToLegacy:()=>i.transformGetNarrativesResponseToLegacy,transformNarrative:()=>i.transformNarrative,transformNarrativeGetApiResponseToLegacyFormat:()=>o.transformNarrativeGetApiResponseToLegacyFormat,transformPoll:()=>a.transformPoll,transformStoriesToLegacy:()=>o.transformStoriesToLegacy,transformStoryArchiveResponse:()=>r.transformStoryArchiveResponse,transformStoryGetApiResponseToLegacyFormat:()=>o.transformStoryGetApiResponseToLegacyFormat,transformStoryQuestions:()=>a.transformStoryQuestions});s(117295);var i=s(715614),r=s(506492),o=s(529371),a=s(937625)},529371:(e,t,s)=>{s.d(t,{transformNarrativeGetApiResponseToLegacyFormat:()=>S,transformStoriesToLegacy:()=>k,transformStoryGetApiResponseToLegacyFormat:()=>y});var i=s(903413),r=s(418562),o=s(309205),a=s(33305),n=s(908671),c=s(646938),d=s(866467),l=s(351118),h=s(898848),_=s(507838),u=s(117295),p=s(715614),m=s(369296),v=s(897976),g=s(190438),f=s(536490);function y(e,t,s){const{items:i,profiles:o=[],groups:a=[],reaction_sets:n}=e;return i.map((e=>{const i=e.owner_id||e.stories?.[0]?.owner_id||0,d=(0,_.findOwnerById)(i,o,a)||{id:i},l="feed"===t&&"discover"===e.type?[]:e.stories?.filter(Boolean)||[],h=t===c.StoryListName.feed||t===c.StoryListName.discover,u={id:e.id||(0,r.default)(),author:w(d,o,l[0]?.also_subscribed),has_unseen:e.has_unseen,items:l.map((e=>b(e,d,o,a,s,t))),track_code:e.track_code,can_blacklist:h,app:e.app&&(p=e.app,{url:`/app${p.id}`,name:p.title,photoUrl:p.icon_139||p.icon_150||p.icon_75||""}),type:e.type,send_mask_hash:"",remove_from_blacklist_hash:"",is_narrative:!1,next_from:""};var p;return e.grouped?.length&&(u.grouped=y({items:e.grouped,profiles:o,groups:a},t,s)),n&&(u.reaction_set=E(n)),u}))}function S(e,t,s){const{items:i,profiles:o=[],groups:a=[]}=e;return i.map((e=>{const i=e.owner_id||e.stories?.[0]?.owner_id||0,n=(0,_.findOwnerById)(i,o,a)||{id:i},d=e.stories?.filter(Boolean)||[];return{id:(0,r.default)(),author:w(n,o,d[0]?.also_subscribed),items:d.map((e=>b(e,n,o,a,s,t))),can_blacklist:!1,type:c.StoryBlockType.stories,send_mask_hash:"",remove_from_blacklist_hash:"",next_from:"",is_narrative:!0,narrative:(0,p.transformNarrative)(e,n)}}))}function w(e,t=[],s){const i=e.verified?'<div class="page_verified"></div>':"",r=function(e,t=[]){if(!e)return;const s=[],i=e.user_ids||[];return i.forEach((e=>{const i=t.find((t=>t.id===e));i&&s.push({photo_url:i.photo_50||i.photo_100||"",href:(0,a.getOwnerHref)(i),name:i.first_name||"",sex:i.sex||0})})),{total_count:e.count||0,owners:s}}(s,t);if((0,a.isOwnerUser)(e)){const t=e.id,s=e.first_name||"",o=e.last_name||"",n=e.first_name_gen||"",c=e.last_name_gen||"",d=e.first_name_ins||"",h=(0,a.getOwnerFullName)(e),_=o?`${n} ${c}`:n;return{id:t,name:(0,l.escape)(h),name_get:(0,l.escape)(_),firstName:(0,l.escape)(s),first_name_gen:(0,l.escape)(n),first_name_ins:(0,l.escape)(d),photo:e.photo_100||e.photo_50||"",href:(0,a.getOwnerHref)(e),verify:i,gender:e.sex||0,can_follow:I(e),also_subscribed:r}}const o=-e.id,n=(0,l.escape)(e.name||"");return{id:o,name:n,name_get:n,firstName:n,first_name_gen:n,first_name_ins:n,photo:e.photo_100||e.photo_50||"",href:(0,a.getOwnerHref)(e),verify:i,gender:0,can_follow:I(e),also_subscribed:r}}function b(e,t,s,i,r,p){let m,y,S,w,b;if(e.mask?.owner_id){const t=(0,_.findOwnerById)(e.mask?.owner_id,s,i);t&&(m=t.screen_name,(0,a.isOwnerUser)(t)&&(y=t.sex))}const k=(0,f.canViewerManageStory)(t,e,window.vk.id),E=!k&&(p===c.StoryListName.feed||p===c.StoryListName.discover);return S=(0,u.transformClickableStickers)(e,s,i,r),w=(0,g.toStoryLink)(e,S),b=!!w&&"audio"===w.object_type,{owner_id:e.owner_id,raw_id:`${e.owner_id}_${e.id}`,date:(0,d.getSmDate)(e.date||0),time:e.date||0,type:M(e),unread:!e.seen,canLike:Boolean(e.can_like),can_comment:T(e),can_share:Boolean(e.can_share),can_remove:L(e,t),can_delete_with_reason:Boolean(e.can_delete_with_reason),can_manage:k,can_ask:Boolean(e.can_ask),can_ask_anonymous:Boolean(e.can_ask_anonymous),canAddToNarrative:e.can_use_in_narrative,stats:{follow:{event_type:"subscribe",rhash:""},url_view:{event_type:"url_view",rhash:""}},isLiked:Boolean(e.is_liked),likesCount:e.likes_count||0,reaction_set_id:e.reaction_set_id||"",user_reaction_id:e.user_reaction_id||0,preview_url:e.blurred_preview||"",preview_thumb_hash:e.photo?.thumb_hash||e.video?.thumb_hash,needMute:Boolean(e.need_mute),muteReply:Boolean(e.mute_reply),isPromo:Boolean(e.is_promo),isProfileQuestion:Boolean(e.is_profile_question),promoCaption:e.is_promo&&e.caption||"",track_code:e.track_code||"",video:{owner_id:e.owner_id,video_id:e.video?.id||0,duration:e.video?.duration||0},vkVideoConfig:e.video?.ov_id?(0,v.constructVideoData)(e.video):void 0,link:w??void 0,isPartOfNarrative:Boolean(e.narratives_count),report_hash:"",maskOwnerDomain:m,maskOwnerSex:y,memory_type:e.memory_type,memory_date:e.memory_date,can_hide_reply:(0,f.canViewerHideReply)(e,s,i,window.vk.id),noSound:Boolean(e.no_sound),isNewQuestions:k&&Boolean(e.questions?.new),views:Boolean(e.views)?(0,n.formatCount)(e.views||0):"",is_expired:Boolean(e.is_expired),is_deleted:Boolean(e.is_deleted),is_private:!Boolean(e.can_see),isAds:Boolean(e.is_ads),isOneTime:Boolean(e.is_one_time),isOneTimeSeen:Boolean(e.is_one_time)&&!Boolean(e.can_see),seenProgress:0,replies:e.replies?.count?(0,n.formatCount)(e.replies.count):"",replies_new_counter:e.replies?.new||0,clickable_stickers:S,canMarkNotInterested:E,photo_url:e.photo?.sizes&&(0,l.getPhotoSize)(e.photo.sizes,(0,h.isRetina)()?1200:600)?.url||"",small_preview:C(e,r),smallest_preview:C(e,r,!0),video_url:e.video?.files?(0,o.getVideoBestQualityUrl)(e.video.files):"",first_frame:e.video?.first_frame&&(0,l.getPhotoSize)(e.video?.first_frame,800)?.url||"",repliesCountText:"",authorId:0,isMusicCover:b,is_authors_ads:e.is_authors_ads,advertiser_info_url:e.advertiser_info_url,ad_marker:e.ad_marker,caption:e.caption,is_best_friends_privacy:e.is_best_friends_privacy,parent_story:e.parent_story,research:e.research||void 0}}function k(e,t,s){const{items:i,profiles:o,groups:a,reaction_sets:n}=e,d=i[0]?.owner_id||0,l=(0,_.findOwnerById)(d,o,a)||{id:d},h=t===c.StoryListName.feed||t===c.StoryListName.discover,u=i.some((e=>!e.seen)),p={id:(0,r.default)(),author:w(l,o,i[0]?.also_subscribed),has_unseen:u,items:i.map((e=>b(e,l,o,a,s,t))),track_code:"",can_blacklist:h,type:c.StoryBlockType.stories,send_mask_hash:"",remove_from_blacklist_hash:"",is_narrative:!1,next_from:""};return n&&(p.reaction_set=E(n)),[p]}function E(e){return e.map((({id:e,items:t})=>(0,m.prepareReactionMenuSet)(e,t.map((e=>({...e,id:e.id}))),{imageMenuSize:{width:96,height:96},imagePreviewSize:{width:32,height:32},imageStoryPanelSize:{width:128,height:128},imageStoryPreviewSize:{width:40,height:40}})))}function C(e,t=!1,s=!1){const i=e.photo?.sizes;if(i)return(0,l.getPhotoSize)(i,t||s?10:(0,h.isRetina)()?600:300)?.url||"";const r=e.video?.first_frame;return r&&(0,l.getPhotoSize)(r,t||s?10:320)?.url||""}function I(e){return(0,a.isOwnerUser)(e)?window.vk.id!==e.id&&(e.friend_status===i.FriendsFriendStatusStatusEnumNames.NOT_A_FRIEND||e.friend_status===i.FriendsFriendStatusStatusEnumNames.INCOMING_REQUEST):!e.is_member&&!e.is_closed}function T(e){return e.can_comment?Boolean(e.can_comment):"live_active"===e.type&&Boolean(e.video?.can_comment)}function L(e,t){return!e.is_deleted&&(!e.can_delete_with_reason&&(!!e.can_delete||(0,f.canViewerManageStory)(t,e,window.vk.id)&&("photo"===e.type||"video"===e.type)))}function M(e){return"photo"===e.type?c.StoryType.PHOTO:"video"===e.type?c.StoryType.VIDEO:"live_active"===e.type||"live_finished"===e.type?c.StoryType.LIVE:c.StoryType.PHOTO}},715614:(e,t,s)=>{s.d(t,{transformGetNarrativesResponseToLegacy:()=>d,transformNarrative:()=>c});var i=s(351118),r=s(33305),o=s(507838),a=s(506492),n=s(75670);function c(e,t){const s=`${e.owner_id}_${e.id}`,o=(0,r.isOwnerGroup)(t),c=o&&Boolean(t.is_closed),d={id:e.id,rawId:s,ownerId:e.owner_id,ownerName:(0,i.escape)((o?t.name:(0,r.getOwnerFullName)(t))||""),ownerShortName:(0,i.escape)((o?t.name:(0,r.getOwnerShortName)(t))||""),ownerUrl:(0,r.getOwnerHref)(t),ownerPath:`${o?"club":"id"}${e.owner_id}`,ownerAvatarUrl:t.photo_100||t.photo_50||"",title:(0,i.escape)(e.title),isBookmarked:e.is_favorite,bookmarkHash:"",reportHash:"",canEdit:(0,n.canViewerEditNarrative)(e,t,window.vk.id),editHash:"",canView:e.can_see,storiesCount:e.story_ids?.length||0,isOwnerClosedGroup:c,isGroupEditor:c&&Boolean(t.is_admin),url:`${window.location.origin}/narrative${s}`,storyIds:e.story_ids||[],stories:e.stories?.map(a.transformStoryArchive)||[],isDeleted:e.is_delete,date:"",coverUrl:""};if(e.cover){Object.assign(d,{coverUrl:e.cover.cropped_sizes&&(0,i.getPhotoSize)(e.cover.cropped_sizes,300)?.url||"",coverCrop:{x:e.cover.crop_x||0,y:e.cover.crop_y||0,width:e.cover.crop_width||0,height:e.cover.crop_height||0}}),e.cover.custom_photo&&(d.customCover=function(e,t=[]){if(!e)return;return{photoId:e.id,originalPhotoUrl:e.orig_photo?.url||e.sizes&&(0,i.getPhotoSize)(e.sizes,600)?.url||"",previewUrl:t&&(0,i.getPhotoSize)(t,300)?.url||e.sizes&&(0,i.getPhotoSize)(e.sizes,300)?.url||""}}(e.cover.custom_photo,e.cover.cropped_sizes));const t=e.cover.cover_story_id;if(t){Object.assign(d,{coverStoryId:t,coverStoryRawId:`${e.owner_id}_${t}`});const s=e.stories?.find((e=>e?.id===t));s&&(d.coverStory=(0,a.transformStoryArchive)(s))}}return d}function d(e){const{items:t,profiles:s=[],groups:i=[]}=e;return t?.length?t.reduce(((e=[],t)=>{if(!t)return e;const r=(0,o.findOwnerById)(t.owner_id,s,i)||{id:t.owner_id};if(!r)return e;const a=c(t,r);return a?e.concat(a):e}),[]):[]}},506492:(e,t,s)=>{s.d(t,{transformStoryArchive:()=>n,transformStoryArchiveResponse:()=>c});var i=s(309205),r=s(351118),o=s(41903),a=s(34231);function n(e){const t=Math.max(e.date?Math.ceil(new Date(1e3*e.date).setUTCHours(0,0,0,0)/1e3):0,o.STORIES_ARCHIVE_START_TIME),s=e.photo?.sizes||e.video?.image,n={id:e.id,rawId:`${e.owner_id}_${e.id}`,listId:`archive${e.owner_id}_${t}`,time:Number(e.date),preview:s&&(0,r.getPhotoSize)(s,350)?.url||"",originalPreviewUrl:s&&(0,r.getPhotoSize)(s,600)?.url||""};return"video"===e.type&&e.video&&Object.assign(n,{videoUrl:e.video.files&&(0,i.getVideoBestQualityUrl)(e.video.files)||"",duration:e.video.duration}),e.link&&Object.assign(n,{linkUrl:(0,a.wrapAwayIfExternal)(e.link.url)||"",linkText:e.link.text||"",linkType:""}),n}function c(e){const{items:t=[]}=e;return t.filter(Boolean).map(n)}},190438:(e,t,s)=>{s.d(t,{toStoryLink:()=>l});var i=s(724913),r=s(70148),o=s(768035),a=s(187966),n=s(884921),c=s(298077);const d=RegExp(`^\\/?audio${i.ANY_RAW_ID_INCLUDABLE_PATTERN}\\/?$`);function l(e,t){let s,l=e.link;return l?(s=function(e,t){let s,l;const h=function(e){let t,s;const a=URL.parse(e.url);if(!a||!n.VK_URL_REGEX.test(a.host))return null;if(t=a.pathname,!d.test(t))return null;if(s=t.match(i.ANY_RAW_ID_INCLUDABLE_REGEXP)?.[0],!s)return null;try{return new r.OwnedIdentity((0,o.parseRawId)(s))}catch(e){return(0,c.logError)(e),null}}(e);if(!h)return null;if(l=function(e,t){return e?.stickers?.find((({audioId:e,audioData:s})=>!!s&&(!!(0,a.isAnyRawId)(e)&&[t.rawId,t.accessRawId].includes(e))))}(t,h),!l)return null;try{return s=JSON.parse(l.audioData),{url:e.url,text:e.text,object_type:"audio",object:s}}catch(e){return(0,c.logError)(e),null}}(l,t),s||{url:l.url,text:l.text}):null}},898368:(e,t,s)=>{s.d(t,{createStoriesService:()=>c});var i=s(32489),r=s(288191),o=s(80963),a=s(755812),n=s(869071);const c=({domain:e})=>{const t=e.createEvent("fire/storiesGet"),s=e.createEvent("fire/storiesGetById"),c=e.createEvent("fire/storiesGetArchive"),d=e.createEvent("fire/storiesGetViewers"),l=e.createEvent("fire/storiesGetReplies"),h=e.createEvent("fire/storiesSeenReplies"),_=e.createEvent("fire/storiesGetQuestions"),u=e.createEvent("fire/storiesGetStats"),p=e.createEvent("fire/storiesGetDetailedStats"),m=e.createEvent("fire/storiesMarkSkipped"),v=e.createEvent("fire/storiesMarkNotInterested"),g=e.createEvent("fire/storiesMarkSeen"),f=e.createEvent("fire/storiesHidePrivacyBlock"),y=e.createEvent("fire/storiesDelete"),S=e.createEvent("fire/storiesAskQuestion"),w=e.createEvent("fire/storiesDeleteQuestion"),b=e.createEvent("fire/storiesBanQuestionAuthor"),k=e.createEvent("fire/storiesUnbanQuestionAuthor"),E=e.createEvent("fire/storiesGetPhotoUploadServer"),C=e.createEvent("fire/storiesGetVideoUploadServer"),I=e.createEvent("fire/storiesSave"),T=e.createEvent("fire/storiesSearch"),L=e.createEvent("fire/storiesUnbanOwner"),M=e.createEvent("fire/storiesBanOwner"),A=e.createEvent("fire/storiesSetDiscoverVisible"),x=e.createEvent("fire/storiesHideReply"),P=e.createEvent("fire/storieHideAllReplies"),R=e.createEffect("fx/storiesGet"),O=e.createEffect("fx/storiesGetById"),N=e.createEffect("fx/storiesGetArchive"),B=e.createEffect("fx/storiesGetViewers"),D=e.createEffect("fx/storiesGetReplies"),F=e.createEffect("fx/storiesSeenReplies"),j=e.createEffect("fx/storiesGetQuestions"),U=e.createEffect("fx/storiesGetStats"),V=e.createEffect("fx/storiesGetDetailedStats"),H=e.createEffect("fx/storiesMarkSkipped"),W=e.createEffect("fx/storiesMarkNotInterested"),K=e.createEffect("fx/storiesMarkSeen"),G=e.createEffect("fx/storiesHidePrivacyBlock"),$=e.createEffect("fx/storiesDelete"),q=e.createEffect("fx/storiesAskQuestion"),z=e.createEffect("fx/storiesDeleteQuestion"),Q=e.createEffect("fx/storiesBanQuestionAuthor"),Y=e.createEffect("fx/storiesUnbanQuestionAuthor"),X=e.createEffect("fx/storiesGetPhotoUploadServer"),J=e.createEffect("fx/storiesGetVideoUploadServer"),Z=e.createEffect("fx/storiesSave"),ee=e.createEffect("fx/storiesSearch"),te=e.createEffect("fx/storiesUnbanOwner"),se=e.createEffect("fx/storiesBanOwner"),ie=e.createEffect("fx/storiesSetDiscoverVisible"),re=e.createEffect("fx/storiesHideReply"),oe=e.createEffect("fx/storiesHideAllReplies"),ae=(0,o.createFriendsAddFx)({domain:e}),ne=(0,o.createFriendsDeleteFx)({domain:e}),ce=(0,a.createGroupsJoinFx)({domain:e}),de=(0,a.createGroupsLeaveFx)({domain:e});return R.use(r.apiStoriesGet),O.use(r.apiStoriesGetById),N.use(r.apiStoriesGetArchive),B.use(r.apiStoriesGetViewers),D.use(r.apiStoriesGetReplies),F.use(r.apiStoriesSeenReplies),j.use(r.apiStoriesGetQuestions),U.use(r.apiStoriesGetStats),V.use(r.apiStoriesGetDetailedStats),H.use(r.apiStoriesMarkSkipped),W.use(r.apiStoriesMarkNotInterested),K.use(r.apiStoriesMarkSeen),G.use(r.apiStoriesHidePrivacyBlock),$.use(r.apiStoriesDelete),q.use(r.apiStoriesAskQuestion),z.use(r.apiStoriesDeleteQuestion),Q.use(r.apiStoriesBanQuestionAuthor),Y.use(r.apiStoriesUnbanQuestionAuthor),X.use(r.apiStoriesGetPhotoUploadServer),J.use(r.apiStoriesGetVideoUploadServer),Z.use(r.apiStoriesSave),ee.use(r.apiStoriesSearch),se.use(r.apiStoriesBanOwner),te.use(r.apiStoriesUnbanOwner),ie.use(r.apiStoriesSetDiscoverVisible),re.use(r.apiStoriesHideReply),oe.use(r.apiStoriesHideAllReplies),(0,n.connectTrackTmrGroupsJoin)(ce),(0,i.sample)({clock:t,target:R}),(0,i.sample)({clock:s,target:O}),(0,i.sample)({clock:c,target:N}),(0,i.sample)({clock:d,target:B}),(0,i.sample)({clock:l,target:D}),(0,i.sample)({clock:h,target:F}),(0,i.sample)({clock:_,target:j}),(0,i.sample)({clock:u,target:U}),(0,i.sample)({clock:p,target:V}),(0,i.sample)({clock:m,target:H}),(0,i.sample)({clock:v,target:W}),(0,i.sample)({clock:g,target:K}),(0,i.sample)({clock:f,target:G}),(0,i.sample)({clock:y,target:$}),(0,i.sample)({clock:S,target:q}),(0,i.sample)({clock:w,target:z}),(0,i.sample)({clock:b,target:Q}),(0,i.sample)({clock:k,target:Y}),(0,i.sample)({clock:E,target:X}),(0,i.sample)({clock:C,target:J}),(0,i.sample)({clock:I,target:Z}),(0,i.sample)({clock:T,target:ee}),(0,i.sample)({clock:L,target:te}),(0,i.sample)({clock:M,target:se}),(0,i.sample)({clock:A,target:ie}),(0,i.sample)({clock:x,target:re}),(0,i.sample)({clock:P,target:oe}),{fireGet:t,fireGetById:s,fireGetArchive:c,fireGetViewers:d,fireGetReplies:l,fireSeenReplies:h,fireGetQuestions:_,fireGetStats:u,fireGetDetailedStats:p,fireMarkSkipped:m,fireMarkNotInterested:v,fireMarkSeen:g,fireHidePrivacyBlock:f,fireDelete:y,fireAskQuestion:S,fireDeleteQuestion:w,fireBanQuestionAuthor:b,fireUnbanQuestionAuthor:k,fireGetPhotoUploadServer:E,fireGetVideoUploadServer:C,fireSave:I,fireSearch:T,fireUnbanOwner:L,fireBanOwner:M,fireSetDiscoverVisible:A,fireHideReply:x,fireHideAllReplies:P,getFx:R,getByIdFx:O,getArchiveFx:N,getViewersFx:B,getRepliesFx:D,seenRepliesFx:F,getQuestionsFx:j,getStatsFx:U,getDetailedStatsFx:V,markSkippedFx:H,markNotInterestedFx:W,markSeenFx:K,hidePrivacyBlockFx:G,deleteFx:$,askQuestionFx:q,deleteQuestionFx:z,banQuestionAuthorFx:Q,unbanQuestionAuthorFx:Y,getPhotoUploadServerFx:X,getVideoUploadServerFx:J,saveFx:Z,searchFx:ee,unbanOwnerFx:te,banOwnerFx:se,setDiscoverVisibleFx:ie,hideReplyFx:re,hideAllRepliesFx:oe,friendsAddFx:ae,friendsDeleteFx:ne,groupsJoinFx:ce,groupsLeaveFx:de}}},391475:(e,t,s)=>{function i(e){if(e?.parent_story)return{is_reply_to_story:1,reply_to_story_id:e.parent_story.id,reply_to_story_owner_id:e.parent_story.owner_id,clickable_sticker:{type:"story_reply",style:"preview"}};const t=e?.clickable_stickers?.stickers??[];for(const e of t){if(e.postId&&e.postOwnerId)return{is_reply_to_story:0,clickable_sticker:{type:"post",style:"preview",text_value:`${e.postOwnerId}_${e.postId}`}};if("clip"===e.videoType&&e.videoOwnerId&&e.videoId)return{is_reply_to_story:0,clickable_sticker:{type:"clip",style:"preview",text_value:`${e.videoOwnerId}_${e.videoId}`}};if("video"===e.videoType&&e.videoOwnerId&&e.videoId)return{is_reply_to_story:0,clickable_sticker:{type:"vk_video",style:"preview",text_value:`${e.videoOwnerId}_${e.videoId}`}}}return{is_reply_to_story:0}}s.d(t,{storyViewClickableToStoryStat:()=>i})},564586:(e,t,s)=>{s.d(t,{faveService:()=>v,narrativesService:()=>m,pollsService:()=>g,statsService:()=>p,storiesDomain:()=>_,storiesService:()=>u,userService:()=>f});var i=s(32489),r=s(41903),o=s(744030),a=s(942838),n=s(733498),c=s(455673),d=s(373237),l=s(49819),h=s(136335);const _=(0,i.createDomain)("stories"),u=(0,r.createStoriesService)({domain:_}),p=(0,o.createStatsService)({domain:_}),m=(0,a.createNarrativesService)({domain:_}),v=((0,n.createLikesService)({domain:_}),(0,c.createMessagesService)({domain:_}),(0,d.createFaveService)({domain:_})),g=(0,l.createPollsService)({domain:_}),f=(0,h.createUserService)({domain:_})},405972:(e,t,s)=>{s.d(t,{UploadPhoto:()=>i.UploadPhoto});var i=s(451696)},271781:(e,t,s)=>{s.d(t,{OwnerAvatarEditorModes:()=>o,OwnerAvatarEditorPhotoTypes:()=>r,UploadPhotoErrorCodes:()=>i});var i=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.UPLOAD=1]="UPLOAD",e[e.NOT_ALLOWED_EXTENSION=2]="NOT_ALLOWED_EXTENSION",e[e.IMAGE_TOO_SMALL=3]="IMAGE_TOO_SMALL",e[e.IMAGE_TOO_BIG=4]="IMAGE_TOO_BIG",e[e.BAD_ASPECT_RATIO=5]="BAD_ASPECT_RATIO",e}({}),r=function(e){return e.UPLOADED="uploaded",e.EXISTED="existed",e}({}),o=function(e){return e[e.UPLOAD=1]="UPLOAD",e[e.SELECT=2]="SELECT",e[e.EDIT=3]="EDIT",e[e.NFT=4]="NFT",e[e.NFT_EDIT=5]="NFT_EDIT",e}({})},451696:(e,t,s)=>{s.d(t,{UploadPhoto:()=>o});var i=s(271781),r=s(84689);class o{validateSizes(e){const{lang:t,constraints:s}=this.config;if(s){const{maxWidth:r,minWidth:o,maxHeight:a,minHeight:n,maxAspectRatio:c,minAspectRatio:d}=s,[l,h]=e,_=l/h;if(l>r||h>a){const e=(t[`error_${i.UploadPhotoErrorCodes.IMAGE_TOO_BIG}`]||"").replace("{width}",String(r)).replace("{height}",String(a));return{code:i.UploadPhotoErrorCodes.IMAGE_TOO_BIG,text:e}}if(l<o||h<n){const e=(t[`error_${i.UploadPhotoErrorCodes.IMAGE_TOO_SMALL}`]||"").replace("{width}",String(o)).replace("{height}",String(n));return{code:i.UploadPhotoErrorCodes.IMAGE_TOO_SMALL,text:e}}if(d&&d>_)return{code:i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:t[`error_${i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO}`]};if(c&&_>c)return{code:i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:t[`error_${i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO}`]}}return null}validate(e,t=!0){const{constraints:s,allowedTypes:o=[],lang:a}=this.config;let n=o.some((t=>"*"===t||t===e.type));return n||e.type||t||(n=!0),n?s&&t?(0,r.getImageSizeByBlob)(e).then((e=>{const t=this.validateSizes(e);return t?Promise.reject(t):Promise.resolve(null)})).catch((function(e){return e&&e.text&&e.code?Promise.reject(e):Promise.reject({code:i.UploadPhotoErrorCodes.UNKNOWN,text:a[`error_${i.UploadPhotoErrorCodes.UNKNOWN}`]})})):Promise.resolve(null):Promise.reject({code:i.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION,text:a[`error_${i.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION}`]})}upload({file:e,uploadURL:t=this.config.url,fieldName:s="file1",validateSizes:r=!0}){return this.validate(e,r).then((()=>new Promise(((r,o)=>{const a=new XMLHttpRequest,n=new FormData;n.append(s,e),a.open("POST",t,!0),a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE&&200===a.status){let e;try{a.responseText&&(e=JSON.parse(a.responseText))}catch(e){o({code:i.UploadPhotoErrorCodes.UNKNOWN,text:this.config.lang[`error_${i.UploadPhotoErrorCodes.UNKNOWN}`]})}r(e)}},a.onerror=()=>{o({code:i.UploadPhotoErrorCodes.UPLOAD,text:this.config.lang[`error_${i.UploadPhotoErrorCodes.UPLOAD}`]})},a.upload.onprogress=e=>{this.progressCallback&&this.progressCallback(e.loaded,e.total)},a.send(n)}))))}constructor(e,t){this.config={allowedTypes:["*"],...e},this.progressCallback=t}}},84689:(e,t,s)=>{function i(e){return t=URL.createObjectURL(e),new Promise((function(e,s){const i=new Image;i.onload=function(){const t=Number(i.height),s=Number(i.width);e([s,t])},i.onerror=function(){s()},i.onabort=function(){s()},i.src=t}));var t}s.d(t,{getImageSizeByBlob:()=>i})},664331:(e,t,s)=>{s.d(t,{getAPIErrorMessage:()=>r,isRequestAbortError:()=>o});var i=s(866467);const r=e=>e.error_text||e.error_msg||(0,i.getLang)("global_unknown_error"),o=e=>e instanceof DOMException&&(20===e.code||"AbortError"===e.name)},332303:(e,t,s)=>{s.d(t,{createDebugConsole:()=>r,createDebugConsoleInfoWithTimestamp:()=>o});const i=(0,s(558137).makeSharedState)("debug-console-flags",(()=>({})),{version:0}),r=e=>new Proxy(console,{get(t,s,r){switch(s){case"debug":case"dir":case"error":case"info":case"log":case"table":case"trace":case"warn":{const r=t[s],o=window.nav?.objLoc?.[e]??i()[e];return o!==i()[e]&&(i()[e]=o),(...e)=>{o&&r.call(t,...e)}}default:return Reflect.get(t,s,r)}}});function o(e,t=""){const s=r(e);return(e,...i)=>{const r=t?`[${t}]`:"",o=new Intl.DateTimeFormat("ru-RU",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hour12:!1,timeZone:"Europe/Moscow"}).format(new Date);s.info(`%c[${o}]${r}%c | %c${e}`,"color: hsl(0, 0%, 0%); background-color: hsla(201, 64%, 95%, 0.9); padding: 2px","color: inherit; background-color: inherit; padding: 2px","color: hsl(120, 18%, 12%); background-color: hsl(119, 51%, 95%, 0.9); padding: 2px",...i)}}},559802:(e,t,s)=>{function i(e){const t=null!=e&&"object"==typeof e,s=t&&"code"in e&&"CSS_CHUNK_LOAD_FAILED"===e.code;return t&&e instanceof Error&&("ChunkLoadError"===e.name||s)&&"type"in e&&"request"in e}function r(e){if(!i(e))return;const{message:t,type:s,request:r}=e,o=t.split("\n",1)[0],a=/^Loading (hot update |CSS )?chunk (.+) failed\.$/.exec(o);return{type:s,chunkId:a&&a[2],url:r,chunkType:`${a&&a[1]||""}chunk`}}s.d(t,{extractWebpackChunkLoadErrorDetails:()=>r,isWebpackChunkLoadError:()=>i})},485910:(e,t,s)=>{s.d(t,{replaceHashtags:()=>c});var i=s(44755),r=s(540462);let o;const a=[[192,1399],[12352,12543],[19968,40959],[44032,55215]];function n(e){const t=e.match(i.HASHTAG_ENTITIES_ALL)?.[1];if(!t)return!1;const s=parseInt(t);for(const e of a)if(s>=e[0]&&s<=e[1])return!0;return!1}function c(e,t){return e.replace((o||(o=(0,r.partConfigEnabled)("new_hashtags_parser")?new RegExp(i.RE_HASHTAG_EXTRACTION_PATTERN_NEW,"ig"):new RegExp(i.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),o),((e,s,o,a,c)=>{let d="";if((0,r.partConfigEnabled)("new_hashtags_parser")){const e=o.matchAll(new RegExp(i.HASHTAG_ENTITIES_NEW,"ig"));for(const t of e){const[e]=t;if(!n(e)){d=o.slice(t.index),o=o.slice(0,t.index);break}}}return"#"===o?(s||"")+o+(c||"")+d:(s||"")+t(o+(c||""),o)+d}))}},385174:(e,t,s)=>{s.d(t,{stringifyUnknown:()=>o});var i=s(540462),r=s(559802);const o=e=>{if("object"!=typeof e)return String(e);if(e&&e instanceof Error){let{name:t,message:s}=e;if((0,i.partConfigEnabled)("sentry_errors_fix")){let{cause:t}=e;if(t)return o(t)}const a=e instanceof DOMException?e.code:null,n=null!=a?` code #${a}`:"";if((0,r.isWebpackChunkLoadError)(e)){const i=(0,r.extractWebpackChunkLoadErrorDetails)(e);t="ChunkLoadError",s=`Loading ${i?.chunkType||"chunk"} failed (${e.type})`}return`${t}${n}: ${s}`}try{return JSON.stringify(e)}catch{return"got a non-serializable error object"}}},346568:(e,t,s)=>{s.d(t,{Skeleton:()=>n});var i=s(474848),r=(s(296540),s(145697));const o={default:"SkeletonIso--borderRadiusDefault",paper:"SkeletonIso--borderRadiusPaper",promo:"SkeletonIso--borderRadiusPromo"};function a(e){return"string"==typeof e&&Object.keys(o).includes(e)}const n=({className:e,width:t,height:s,children:n,borderRadius:c,circle:d,colorFrom:l,colorTo:h,noAnimation:_=!1,duration:u,fontSize:p,noShrink:m})=>{const v={},g=n;t&&(v.width=t),s&&(v.height=s),p&&(v.fontSize=p),void 0===c||a(c)||(v.borderRadius=c),d&&(v.borderRadius="50%",v.width&&!v.height&&(v.height=v.width),v.height&&!v.width&&(v.width=v.height)),l&&(v["--skeleton-from"]=l),h&&(v["--skeleton-to"]=h),u&&(v["--animation-duration"]=`${u}s`);const f=!!n||!v.height||!v.width;return(0,i.jsx)("span",{className:(0,r.classNames)("SkeletonIso",_&&"SkeletonIso--noAnimation",m&&"SkeletonIso--noShrink",a(c)&&o[c],e),"data-testid":"loading-skeleton","aria-live":"polite","aria-busy":!_,style:v,children:f&&(0,i.jsx)("span",{className:"SkeletonIso__in",children:g})})}},749201:(e,t,s)=>{s.d(t,{StrikeForbidObjectForm:()=>E});var i=s(474848),r=s(296540),o=s(866467),a=s(454919),n=s(454154),c=s(524378),d=s(44544),l=s(387960),h=s(220208),_=s(945206),u=s(944048),p=s(957994),m=s(501397),v=s(873900),g=s(469004),f=s(246429),y=s(540462),S=s(47505),w=s(399237);const b="strike_system.php",k="https://vk.com/helpdesk?act=show&id=";class E extends r.Component{async submit(){if(10===this.state.selectedReason){if(""===this.state.comment)return void this.setState({for_copyright_holders_empty:!0});const e=(0,v.getIdentityRawId)({ownerId:this.props.objectOwnerId,id:this.props.objectId});try{const t=await(0,p.api)("video.existsInClaimWhitelist",{video_ids:e});if(t.find((t=>t.video_id===e))?.is_whitelisted)return void(0,f.showDoneBox)((0,o.getLang)("video_protected_cannot_seizure"))}catch(e){return(0,m.logError)(e),void(0,f.showDoneBox)((0,o.getLang)("video_unkown_error"))}}if(""!==this.state.link_to_ticket||!(0,y.partConfigEnabled)("strike_system_delete_with_reason_support")||(0,y.partConfigEnabled)("strike_system_delete_with_reason"))if(0!=this.state.selectedReason){if(this.setState({isLoading:!0}),!this.state.for_copyright_holders_empty){const e={act:"object_delete",owner_id:this.props.objectOwnerId,object_id:this.props.objectId,object_type:this.props.objectType,reason_id:this.state.selectedReason,claim_id:10===this.state.selectedReason?this.state.claimId:0,link_to_ticket:this.state.link_to_ticket,dmca_comment:this.state.comment,only_withdrawal:10===this.state.selectedReason&&0!==this.state.claimId&&this.state.only_withdrawal_checked?1:0,strike:this.state.strike_community_checked?1:0};switch(this.props.objectType){case S.ObjectType.CommentVideo:const e=document.getElementById("post"+this.props.objectOwnerId+"video_"+this.props.objectId+"mv");e&&e.setAttribute("data-action","delete");break;case S.ObjectType.CommentTopic:const t=document.getElementById("post"+this.props.objectOwnerId+"_"+this.props.objectId);window.cur.topicMyDeleted[this.props.objectOwnerId+"_"+this.props.objectId]=1,t&&t.classList.add("bp_loading")}window.ajax.post(b,e,{onDone:(e,t,s)=>{if(e){""!==s&&(0,f.showDoneBox)(s),(0,f.showDoneBox)(this.state.successText);(this.props.onSubmit||(0,w.getSubmitHandler)(this.props,t))(),this.props.onClose()}else switch(t){case"error_not_owner_for_ticket":this.setState({not_owner_for_ticket:!0});break;case"error_incorrect_link":this.setState({error_incorrect_link:!0});break;case"error_null_reason":(0,f.showDoneBox)((0,o.getLang)("reports_strike_system_error_null_reason"))}},onFail:()=>((0,f.showDoneBox)((0,o.getLang)("global_error")),!1),showProgress:()=>this.setState({isLoading:!0}),hideProgress:()=>this.setState({isLoading:!1})})}}else(0,f.showDoneBox)("error");else this.setState({link_to_ticket_empty:!0})}close(){this.props.onClose()}changeReason(e){g.ls.set("strike_del_reason",e),this.setState({selectedReason:e})}getDmcaTitle(){const e={act:"get_dmca_title",claim_id:this.state.claimId};window.ajax.post(b,e,{onDone:e=>{this.setState({comment:e})},onFail:()=>((0,f.showDoneBox)((0,o.getLang)("global_error")),!1),showProgress:()=>this.setState({isLoading:!0}),hideProgress:()=>this.setState({isLoading:!1})})}componentDidMount(){0!==this.state.claimId&&(this.getDmcaTitle(),this.setState({link_to_ticket:k+this.state.claimId}));window.ajax.post(b,{act:"get_reasons"},{onDone:e=>{this.setState({reasons:e.reasons});const t=g.ls.get("strike_del_reason"),s=g.ls.get("strike_system_only_withdrawal");this.setState({only_withdrawal_checked:s}),0===this.state.claimId&&window.nav?.objLoc?.claim&&(this.setState({claimId:window.nav.objLoc.claim,link_to_ticket:k+window.nav.objLoc.claim}),this.getDmcaTitle()),0!==this.state.claimId&&-1!==this.state.reasons.findIndex((e=>10===e.key))?this.setState({selectedReason:10}):this.setState({selectedReason:t})},onFail:()=>((0,f.showDoneBox)("error"),!1),showProgress:()=>this.setState({isLoading:!0}),hideProgress:()=>this.setState({isLoading:!1})})}render(){const e=this.state.reasons,t=0!==this.state.claimId&&10===this.state.selectedReason&&1===this.props.objectType,s=10===this.state.selectedReason,r=(0,y.partConfigEnabled)("strike_system_delete_with_reason_support");return(0,i.jsx)(a.ModalBoxFast,{header:(0,o.getLang)("reports_strike_system_delete_with_reason"),onClose:this.props.onClose,closeAriaLabel:"Закрыть",actions:[(0,i.jsx)(n.Button,{size:"m",mode:"secondary",onClick:this.close,loading:this.state.isLoading,children:(0,o.getLang)("reports_strike_system_button_cancel")},"0"),(0,i.jsx)(n.Button,{size:"m",mode:"primary",onClick:this.submit,loading:this.state.isLoading,children:(0,o.getLang)("reports_strike_system_button_delete")},"1")],children:(0,i.jsxs)(c.FormLayout,{children:[(0,i.jsx)(d.FormItem,{top:(0,o.getLang)("reports_strike_system_label_select_reason"),children:e.map((e=>(0,i.jsx)(l.Radio,{checked:this.state.selectedReason===e.key,name:"reason",value:e.key,onChange:()=>{this.changeReason(e.key)},children:e.label},e.key)))}),r&&(0,i.jsx)(d.FormItem,{top:(0,o.getLang)("reports_strike_system_for_support_agent_label"),id:"for_support_agent",status:this.state.link_to_ticket_empty||this.state.not_owner_for_ticket||this.state.error_incorrect_link?"error":"default",bottom:this.state.link_to_ticket_empty?(0,o.getLang)("reports_strike_system_for_support_agent_error"):this.state.not_owner_for_ticket?(0,o.getLang)("reports_strike_system_for_support_agent_not_owner_error"):this.state.error_incorrect_link?(0,o.getLang)("reports_strike_system_error_incorrect_link"):"",children:(0,i.jsx)(h.Input,{id:"link_to_ticket",type:"text",placeholder:"https://vk.com/helpdesk?act=show&id=XXXXXXX",value:this.state.link_to_ticket,onChange:e=>{this.setState({link_to_ticket:e.target.value}),this.state.link_to_ticket_empty&&this.setState({link_to_ticket_empty:!1}),this.state.not_owner_for_ticket&&this.setState({not_owner_for_ticket:!1})}})}),s&&(0,i.jsx)(d.FormItem,{top:(0,o.getLang)("reports_strike_system_strike_textarea_label"),id:"for_copyright_holders",status:this.state.for_copyright_holders_empty?"error":"default",bottom:this.state.for_copyright_holders_empty?(0,o.getLang)("reports_strike_system_strike_textarea_error"):"",children:(0,i.jsx)(_.Textarea,{id:"txt_for_copyright_holders",value:this.state.comment,onChange:e=>{this.setState({comment:e.target.value}),this.state.for_copyright_holders_empty&&this.setState({for_copyright_holders_empty:!1})}})}),(0,i.jsxs)(d.FormItem,{bottom:(0,o.getLang)("reports_strike_system_strike_checkbox_desc"),children:[t&&(0,i.jsx)(u.Checkbox,{name:"only_withdrawal",defaultChecked:this.state.only_withdrawal_checked,onChange:e=>{this.setState({only_withdrawal_checked:e.target.checked}),g.ls.set("strike_system_only_withdrawal",e.target.checked)},children:"Только изьятие"}),(0,i.jsx)(u.Checkbox,{name:"strike_community",defaultChecked:this.state.strike_community_checked,onChange:e=>{this.setState({strike_community_checked:e.target.checked}),g.ls.set("strike_system_strike_community",e.target.checked)},children:(0,o.getLang)("reports_strike_system_strike_checkbox")})]})]})})}constructor(e){super(e),this.props=e;const t=g.ls.get("strike_system_strike_community");this.state={successText:"Успешно",reasons:[],selectedReason:0,claimId:this.props.claimId?this.props.claimId:0,comment:"",isLoading:!1,for_copyright_holders_empty:!1,link_to_ticket:document.referrer.includes("vk.com/helpdesk?act=show&id=")?document.referrer:"",link_to_ticket_empty:!1,error_incorrect_link:!1,not_owner_for_ticket:!1,only_withdrawal_checked:!1,strike_community_checked:null!==t&&t},this.submit=this.submit.bind(this),this.close=this.close.bind(this),this.changeReason=this.changeReason.bind(this),this.getDmcaTitle=this.getDmcaTitle.bind(this)}}},667440:(e,t,s)=>{s.d(t,{StrikeForbidObjectForm:()=>c});var i=s(474848),r=s(540462),o=s(749201),a=s(863926),n=s(399237);const c=e=>(0,r.partConfigEnabled)("reports_delete_with_reason")?(0,i.jsx)(a.StrikeForbidObject,{...e,onSubmit:t=>{(e.onSubmit||(0,n.getSubmitHandler)(e,t))()}}):(0,i.jsx)(o.StrikeForbidObjectForm,{...e})},47505:(e,t,s)=>{s.d(t,{ObjectType:()=>i});var i=function(e){return e[e.Video=1]="Video",e[e.Photo=2]="Photo",e[e.Wall=3]="Wall",e[e.Market=4]="Market",e[e.Doc=5]="Doc",e[e.CommentPhoto=6]="CommentPhoto",e[e.CommentVideo=7]="CommentVideo",e[e.CommentWall=8]="CommentWall",e[e.CommentMarket=9]="CommentMarket",e[e.CommentTopic=10]="CommentTopic",e[e.Story=11]="Story",e[e.VideoShort=12]="VideoShort",e[e.VideoLive=13]="VideoLive",e}({})},399237:(e,t,s)=>{s.d(t,{getSubmitHandler:()=>l});var i=s(246429),r=s(717433),o=s(683234),a=s(538522),n=s(866467),c=s(47505);function d(e,t=""){return void 0===e?t:e}function l(e,t){return()=>{const l=`<div class="dld"><span class="dld_inner">${(0,n.getLang)("video_comm_deleted")}</span></div>`;switch(e.objectType){case c.ObjectType.VideoShort:case c.ObjectType.VideoLive:case c.ObjectType.Video:const h={videoId:e.objectId,ownerId:e.objectOwnerId};window.dispatchEvent(new CustomEvent("video_deleted",{detail:h}));const _=document.getElementById("mv_info");if(!_)break;Promise.all([s.e(73538),s.e("langs/web/video_restore_button")]).then(s.bind(s,69727)).then((({initVideoRestoreButton:t})=>{const{objectId:s,objectOwnerId:i}=e,r=(0,a.joinRawId)({itemId:s,ownerId:i}),n=document.getElementById(`video-restore-button-widget-${r}-videoviewer`),c=window.Videoview;t(n,{videoId:s,ownerId:i,onClick:()=>{const e=document.getElementById("mv_warning");e&&(e.innerHTML="",(0,o.showProgress)(e,"","pr_medium"))},onRestore:()=>c?.onRestoreVideo(s,i,"videoviewer"),isVideoModal:!0})})),_.classList.contains("mv_info_invisible")||_.classList.add("mv_info_invisible");const u=document.getElementById("mv_warning");null!=u&&(u.innerHTML=d(t,'<div class="mv_deleted_message">Видео удалено.</div>'),u.style.display="block");const p=document.getElementById("mv_publish");null!=p&&(p.style.display="none");break;case c.ObjectType.Wall:if(window.Wall){const s=window.Wall,i=e.objectOwnerId+"_"+e.objectId;s.postShowDeletedMessage(i,d(t,(0,n.getLang)("wall_post_deleted")))}break;case c.ObjectType.Market:window.WkView?.hide?.(),(0,r.dispatchItemDeleteEvent)(),(0,i.showDoneBox)((0,n.getLang)("market_item_deleted"));break;case c.ObjectType.CommentPhoto:const m=window.Photoview,v=document.getElementById("post"+e.objectOwnerId+"photo_"+e.objectId);m.commDone(v,d(t,l),!0,"");break;case c.ObjectType.CommentWall:if(window.Wall){const s=window.Wall,i=e.objectOwnerId+"_"+e.objectId;s.postShowDeletedMessage(i,d(t,(0,n.getLang)("wall_comment_deleted")))}break;case c.ObjectType.CommentVideo:window.Videoview.commActionDone(e.objectOwnerId+"_"+e.objectId,"mv",d(t,l),!0,"");break;case c.ObjectType.CommentMarket:const g=window.Market,f=document.getElementById("post"+e.objectOwnerId+"market_"+e.objectId);g.commDone({node:f,text:d(t,l),del:!0,script:""});break;case c.ObjectType.CommentTopic:const y=document.getElementById("post"+e.objectOwnerId+"_"+e.objectId);if(y){y.classList.remove("bp_loading"),y.classList.add("bp_deleted");const e=y.querySelector(".bp_deleted_text");e&&(e.innerHTML=d(t,(0,n.getLang)("board_post_deleted")))}break;case c.ObjectType.Story:const S=e.story;S?.removeStoryWithReason()}}}},303279:(e,t,s)=>{s.d(t,{handleCaptcha:()=>o});var i=s(657472),r=s(345601);const o=e=>new Promise((async(t,o)=>{const a=e.redirect_uri;if(a)try{const{showCaptchaSDK:i}=await Promise.all([s.e(91498),s.e(89631),s.e(50560),s.e(62791),s.e(21529),s.e(89887),s.e(22081),s.e(51915),s.e(18624),s.e(76573),s.e(51490),s.e("langs/web/showCaptchaSDK")]).then(s.bind(s,265668)),r=await i(a);return void t({captcha_key:"",captcha_sid:e.captcha_sid,is_sound_captcha:0,success_token:r})}catch(e){if(e===i.CaptchaSDKEvents.CLOSE||e===i.CaptchaSDKEvents.OPENED)return void o(e)}(0,r.showCaptchaPopup)({sid:e.captcha_sid,isRefreshEnabled:e.is_refresh_enabled,isSoundCaptchaAvailable:e.is_sound_captcha_available,captcha_track:e.captcha_track,captcha_img:e.captcha_img,onSubmit:(s,i)=>{t({captcha_sid:e.captcha_sid,captcha_key:s,is_sound_captcha:i})},onClose:()=>{o("close")}})}))},345601:(e,t,s)=>{s.d(t,{showCaptchaPopup:()=>i.showCaptchaPopup});var i=s(630988)},236087:(e,t,s)=>{s.d(t,{CaptchaType:()=>i.CaptchaType,Platform:()=>i.Platform,captchaPopupService:()=>r});var i=s(972980);const r=(0,i.createCaptchaPopupService)()},630988:(e,t,s)=>{s.d(t,{showCaptchaPopup:()=>a});var i=s(474848),r=s(211413),o=s(98341);function a(e){(0,r.showMessageBoxModal)((t=>(0,i.jsx)(o.CaptchaPopup,{...t,...e,onClose:()=>{e.onClose&&e.onClose(),t.onClose()},onSubmit:(s,i)=>{e.onSubmit&&(e.onSubmit(s,i),t.onClose())}})),{width:300,onDestroy:()=>{e.onClose&&e.onClose()}})}},681735:(e,t,s)=>{s.d(t,{CaptchaAnswerField:()=>l});var i=s(474848),r=s(296540),o=s(44544),a=s(220208),n=s(236087),c=s(866467),d=s(293721);const l=(0,r.forwardRef)((({disabled:e,captchaType:t},s)=>{const l=(0,r.useRef)(null),h=(0,r.useRef)(null),_=(0,d.useStore)(n.captchaPopupService.$answer),u=(0,d.useEvent)(n.captchaPopupService.answerChanged);return(0,r.useImperativeHandle)(s,(()=>({inputFieldRef:l,inputLabelRef:h}))),(0,i.jsx)(o.FormItem,{mode:"vertical",noPadding:!0,top:t===n.CaptchaType.AUDIO?(0,i.jsx)("div",{tabIndex:0,ref:h,children:(0,c.getLang)("vkconnect_auth_audio_captcha_title")}):"",children:(0,i.jsx)(a.Input,{getRef:l,tabIndex:0,value:_,placeholder:t===n.CaptchaType.IMAGE?(0,c.getLang)("vkconnect_auth_label_captcha"):(0,c.getLang)("vkconnect_auth_label_captcha_audio_new_ux"),disabled:e,onChange:e=>u(e.target.value)})})}))},766969:(e,t,s)=>{s.d(t,{CaptchaAnswerField:()=>i.CaptchaAnswerField});var i=s(681735)},200831:(e,t,s)=>{s.d(t,{CaptchaError:()=>d});var i=s(474848),r=s(866467),o=s(293721),a=s(236087),n=s(220208),c=s(279734);const d=(0,s(296540).forwardRef)((({captchaType:e},t)=>{const s=(0,o.useEvent)(a.captchaPopupService.captchaReloaded);return(0,i.jsxs)(n.Footer,{children:[(0,i.jsx)(i.Fragment,{children:e===a.CaptchaType.IMAGE?(0,r.getLang)("vkconnect_auth_captcha_loading_error_caption"):(0,r.getLang)("vkconnect_auth_audio_captcha_loading_error_caption")}),(0,i.jsx)(c.Link,{onClick:s,getRootRef:t,role:"button","aria-label":e===a.CaptchaType.IMAGE?(0,r.getLang)("vkconnect_auth_captcha_image_loading_error_retry_aria_label"):(0,r.getLang)("vkconnect_auth_captcha_sound_loading_error_retry_aria_label"),children:(0,r.getLang)("vkconnect_auth_captcha_loading_error_refresh_text")})]})}))},165317:(e,t,s)=>{s.d(t,{CaptchaError:()=>i.CaptchaError});var i=s(200831)},932829:(e,t,s)=>{s.d(t,{CaptchaInfoButton:()=>d});var i=s(474848),r=s(296540),o=s(684797),a=s(454154),n=s(723723),c=s(866467);const d=(0,r.forwardRef)((({onClick:e},t)=>(0,i.jsx)(a.Button,{getRootRef:t,tabIndex:0,appearance:"neutral",mode:"tertiary",size:"m",before:(0,i.jsx)(o.Icon24InfoCircleOutline,{className:(0,n.getColorClass)("color_icon_secondary")}),"aria-label":(0,c.getLang)("vkconnect_auth_audio_captcha_info_text"),onClick:e})))},438105:(e,t,s)=>{s.d(t,{CaptchaInfoButton:()=>i.CaptchaInfoButton});var i=s(932829)},132015:(e,t,s)=>{s.d(t,{CaptchaPopup:()=>C});var i=s(474848),r=s(296540),o=s(293721),a=s(694244),n=s(220208),c=s(63614),d=s(303800),l=s(293116),h=s(700272),_=s(194528),u=s(175400),p=s(454154),m=s(866467),v=s(836410),g=s(165317),f=s(740557),y=s(318029),S=s(766969),w=s(246407),b=s(438105),k=s(24343),E=s(236087);const C=({sid:e,isRefreshEnabled:t,isSoundCaptchaAvailable:s,captcha_track:C,captcha_img:I,onSubmit:T,onClose:L})=>{(0,o.useGate)(E.captchaPopupService.Gate,{sid:e,platform:E.Platform.VK_WEB,captchaTrack:C,captchaImage:I,deviceId:(0,w.getDeviceId)(E.Platform.VK_WEB)});const M=(0,o.useEvent)(E.captchaPopupService.captchaLoadingEnds),A=(0,o.useStore)(E.captchaPopupService.$hasLoadCaptchaError),x=(0,o.useStore)(E.captchaPopupService.$captchaLoading),P=(0,o.useEvent)(E.captchaPopupService.captchaLoadingErrorSet),R=(0,o.useStore)(E.captchaPopupService.$captchaType),O=(0,o.useStore)(E.captchaPopupService.$answer),N=(0,o.useStore)(E.captchaPopupService.$captchaSrc),B=(0,o.useStore)(E.captchaPopupService.$isSubmitButtonDisabled),D=(0,o.useStore)(E.captchaPopupService.$isCaptchaTypeToggleDisabled),F=(0,o.useEvent)(E.captchaPopupService.captchaTypeToggled),j=(0,o.useStore)(E.captchaPopupService.$isRefreshButtonDisabled),U=(0,o.useEvent)(E.captchaPopupService.captchaRefreshed),V=(0,o.useStore)(E.captchaPopupService.$refreshCountdown),H=(0,r.useRef)(null),W=(0,r.useRef)(null),K=(0,r.useRef)(null),G=(0,r.useRef)(null),$=(0,r.useRef)(null),q=(0,r.useRef)(null),z=(0,r.useRef)(null),Q=(0,r.useRef)(null),Y=R===E.CaptchaType.AUDIO,[X,J]=(0,r.useState)(!1),Z=(0,o.useStore)(E.captchaPopupService.$isAudioPlaying),ee=e=>{e.preventDefault(),T&&T(O,Number(Y))},te=(0,r.useCallback)((e=>{const t=Q.current||z.current||W.current,i=K.current,r=G.current,o=$.current,a=H?.current?.inputFieldRef.current,n=H?.current?.inputLabelRef.current,c=q.current,{activeElement:d}=document,l=[t,i,r,o,a,n,c].includes(d)?d:t;if("Space"===e.code&&[i,r,o,c,t].some((e=>l===e))){e.preventDefault();l.click()}function h(){Y&&!r?.disabled?r?.focus():_()}function _(){o?.disabled?u():o?.focus()}function u(){Y&&n?n?.focus():p()}function p(){a?.disabled?m():a?.focus()}function m(){c?.disabled?v():c?.focus()}function v(){t?.focus()}if(s&&"Tab"===e.key&&!e.shiftKey&&l)switch(e.preventDefault(),l){case t:i?.disabled?h():i?.focus();break;case i:h();break;case r:_();break;case o:u();break;case n:p();break;case a:m();break;case c:v()}function g(){a?.disabled?f():a?.focus()}function f(){Y?n?.focus():y()}function y(){o?.disabled?S():o?.focus()}function S(){Y?r?.focus():w()}function w(){i?.disabled?b():i?.focus()}function b(){t?.focus()}if(s&&"Tab"===e.key&&e.shiftKey&&l)switch(e.preventDefault(),l){case t:c?.disabled?g():c?.focus();break;case c:g();break;case a:f();break;case n:y();break;case o:S();break;case r:w();break;case i:b()}}),[s,Y]);(0,r.useEffect)((()=>(document.removeEventListener("keydown",te),document.addEventListener("keydown",te),()=>{document.removeEventListener("keydown",te)})),[te]),(0,r.useEffect)((()=>{if(Y){const e=e=>{e.ctrlKey&&!Z&&Q?.current?.click()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}}),[Y,Z]),(0,r.useEffect)((()=>{const e=W.current;!x&&R===E.CaptchaType.IMAGE&&e&&(e.tabIndex=0,e.ariaLabel=(0,m.getLang)("vkconnect_auth_captcha_image_aria_label"),e.focus()),x||R!==E.CaptchaType.AUDIO||Q.current?.focus()}),[x,R]),(0,r.useEffect)((()=>{const e=z.current;A&&e&&e.focus()}),[A]);return(0,i.jsxs)(a.ModalBox,{children:[(0,i.jsx)(n.ModalDismissButton,{onClick:L}),(0,i.jsx)(c.ModalBody,{insetLevel:1,children:(0,i.jsxs)(d.Div,{mode:"vertical",spacing:4,paddingTop:8,paddingBottom:8,children:[(0,i.jsxs)(l.Image,{getRef:W,alt:(0,m.getLang)("vkconnect_auth_captcha_image_aria_label"),src:R===E.CaptchaType.IMAGE?N:"",onLoad:M,onError:P,widthSize:268,heightSize:102,children:[x&&(0,i.jsx)(h.Spinner,{}),!x&&A&&(0,i.jsx)(g.CaptchaError,{ref:z,captchaType:R}),!A&&Y&&(0,i.jsx)(v.SoundCaptcha,{ref:Q,src:N,disabled:Z})]}),(0,i.jsx)(_.Spacing,{size:6}),(0,i.jsxs)(u.ButtonGroup,{mode:"horizontal",stretched:!0,gap:"s",style:{justifyContent:"space-between"},children:[t&&(0,i.jsx)(f.CaptchaRefreshButton,{ref:K,disabled:j||Y&&(x||A),countdownValue:V,captchaType:R,onRefresh:()=>{U()}}),(Y||s)&&(0,i.jsxs)(u.ButtonGroup,{mode:"horizontal",gap:"s",children:[Y&&(0,i.jsx)(b.CaptchaInfoButton,{ref:G,onClick:()=>{J((e=>!e))}}),s&&(0,i.jsx)(y.CaptchaTypeButton,{ref:$,disabled:D,captchaType:R,onToggle:()=>{F()}})]})]}),Y&&X&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.Spacing,{size:8}),(0,i.jsx)(k.InfoBanner,{})]}),(0,i.jsx)(_.Spacing,{size:16}),(0,i.jsxs)("form",{onSubmit:ee,children:[(0,i.jsx)(S.CaptchaAnswerField,{ref:H,disabled:Y&&(x||A),captchaType:R}),(0,i.jsx)(_.Spacing,{size:12}),(0,i.jsx)(u.ButtonGroup,{mode:"vertical",align:"center",stretched:!0,children:(0,i.jsx)(p.Button,{getRootRef:q,size:"l",stretched:!0,disabled:B||Y&&(x||A),onClick:ee,tabIndex:0,children:(0,m.getLang)("vkconnect_auth_captcha_submit_button")})})]})]})})]})}},98341:(e,t,s)=>{s.d(t,{CaptchaPopup:()=>i.CaptchaPopup});var i=s(132015)},740557:(e,t,s)=>{s.d(t,{CaptchaRefreshButton:()=>l});var i=s(474848),r=s(296540),o=s(399440),a=s(454154),n=s(723723),c=s(236087),d=s(866467);const l=(0,r.forwardRef)((({disabled:e,countdownValue:t,captchaType:s,onRefresh:r},l)=>(0,i.jsx)(a.Button,{getRootRef:l,disabled:e,size:"m",appearance:"neutral",mode:"tertiary",before:(0,i.jsx)(o.Icon24Refresh,{className:(0,n.getColorClass)("color_icon_secondary")}),"aria-label":s===c.CaptchaType.IMAGE?(0,d.getLang)("vkconnect_auth_captcha_refresh_button_aria_label"):(0,d.getLang)("vkconnect_auth_captcha_refresh_audio_button_aria_label_new_ux"),tabIndex:0,onClick:r,children:t?(0,d.langReplace)((0,d.getLang)("vkconnect_refresh_captcha_via"),{time:String(t)}):(0,d.getLang)("vkconnect_refresh_captcha")})))},298161:(e,t,s)=>{s.d(t,{CaptchaTypeButton:()=>h});var i=s(474848),r=s(296540),o=s(236087),a=s(784298),n=s(655733),c=s(454154),d=s(723723),l=s(866467);const h=(0,r.forwardRef)((({disabled:e,captchaType:t,onToggle:s},r)=>(0,i.jsx)(c.Button,{getRootRef:r,disabled:e,size:"m",appearance:"neutral",mode:"tertiary",before:t===o.CaptchaType.IMAGE?(0,i.jsx)(a.Icon24Headphones,{className:(0,d.getColorClass)("color_icon_secondary")}):(0,i.jsx)(n.Icon24TextOutline,{className:(0,d.getColorClass)("color_icon_secondary")}),onClick:s,"aria-label":t===o.CaptchaType.IMAGE?(0,l.getLang)("vkconnect_auth_captcha_enable_audio_aria_label"):(0,l.getLang)("vkconnect_auth_captcha_enable_image_aria_label"),tabIndex:0})))},318029:(e,t,s)=>{s.d(t,{CaptchaTypeButton:()=>i.CaptchaTypeButton});var i=s(298161)},772243:(e,t,s)=>{s.d(t,{InfoBanner:()=>n});var i=s(474848),r=s(327626),o=s(866467),a=s(428937);const n=()=>(0,i.jsx)(r.Banner,{noPadding:!0,size:"s",subheader:(0,o.getLang)("vkconnect_auth_audio_captcha_info_text"),mode:"image",imageTheme:"light",background:(0,i.jsx)("div",{className:a.default.background})})},24343:(e,t,s)=>{s.d(t,{InfoBanner:()=>i.InfoBanner});var i=s(772243)},104413:(e,t,s)=>{s.d(t,{SoundCaptcha:()=>u});var i=s(474848),r=s(296540),o=s(589066),a=s(384081),n=s(723723),c=s(271036),d=s(866467),l=s(366176),h=s(293721),_=s(236087);const u=(0,r.forwardRef)((({src:e,disabled:t},s)=>{const u=(0,r.useRef)(null),p=(0,h.useEvent)(_.captchaPopupService.audioPlaying),m=(0,h.useEvent)(_.captchaPopupService.audioPaused),v=(0,h.useEvent)(_.captchaPopupService.captchaLoadingErrorSet),g=(0,h.useEvent)(_.captchaPopupService.captchaLoadingStarts),f=(0,h.useEvent)(_.captchaPopupService.captchaLoadingEnds),y=(0,h.useStore)(_.captchaPopupService.$isAudioPlaying),S=(0,h.useStore)(_.captchaPopupService.$captchaLoading);return(0,r.useEffect)((()=>{const t=u.current;e&&t&&t.load()}),[e]),(0,i.jsxs)(i.Fragment,{children:[e&&(0,i.jsx)("audio",{ref:u,preload:"none",src:e,onLoadStart:g,onCanPlay:f,onPlay:p,onPause:m,onError:v}),!S&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.IconIllustrationSoundWaveLeft36h,{className:(0,n.getColorClass)(y?"color_icon_accent_themed":"color_icon_tertiary")}),(0,i.jsx)(c.IconButton,{getRootRef:s,size:52,disabled:t,"aria-label":(0,d.getLang)("vkconnect_auth_captcha_play_audio_button_aria_label_new_ux"),className:(0,n.getColorClass)("color_text_accent_themed"),tabIndex:0,onClick:()=>{const e=u.current;e?.readyState||e?.load(),e?.play().catch((()=>{v()}))},children:(0,i.jsx)(l.Icon40PlayCircle,{})}),(0,i.jsx)(a.IconIllustrationSoundWaveRight36h,{className:(0,n.getColorClass)(y?"color_icon_accent_themed":"color_icon_tertiary")})]})]})}))},836410:(e,t,s)=>{s.d(t,{SoundCaptcha:()=>i.SoundCaptcha});var i=s(104413)},246407:(e,t,s)=>{s.d(t,{getDeviceId:()=>n});var i=s(553608),r=s(418562),o=s(236087);const a="vk_web_captcha_device_id",n=e=>{let t;switch(e){case o.Platform.VK_WEB:t=a;break;case o.Platform.VK_M_WEB:t="vk_m_web_captcha_device_id";break;default:t=a}let s=i.vkLocalStorage.getItem(t);return s||(s=(0,r.default)(),i.vkLocalStorage.setItem(t,s)),s}},541864:(e,t,s)=>{s.d(t,{MARKET_ITEM_CREATE_EVENT:()=>r,MARKET_ITEM_DELETE_EVENT:()=>i,MARKET_ITEM_UPDATE_EVENT:()=>o,MARKET_SERVICE_UPDATE_EVENT:()=>a,RUSSIA_ID:()=>n});const i="MarketItemDelete",r="MarketItemCreate",o="MarketItemUpdate",a="MarketServiceUpdate",n=1},717433:(e,t,s)=>{s.d(t,{dispatchItemDeleteEvent:()=>r});var i=s(541864);const r=e=>{window.dispatchEvent(new CustomEvent(i.MARKET_ITEM_DELETE_EVENT,{detail:e}))}},18967:(e,t,s)=>{s.d(t,{logViewMarketItemInStories:()=>a});var i=s(170722),r=s(436185),o=s(30259);function a(e){const t=new URL(`${document.location.origin}${e}`).searchParams.get("w");if(t){const[e,s]=t.slice(8).split("_");i.viewAnalytics.logMarketItemView({view:{start_view:"0",end_view:"0"},screen:(0,r.getStatScreen)(),ref_source:o.RefSource.STORIES,params:{item_id:Number(s),owner_id:Number(e),search_query_id:0,item_idx:0}})}}},805102:(e,t,s)=>{s.d(t,{constructProductLink:()=>r});var i=s(831762);function r({screen:e,refSource:t,refScreen:s,itemId:r,ownerId:o,ref:a,type:n,withGroupHeader:c,seoSlug:d="",adsLabel:l}){const h=new URLSearchParams;return t&&h.set("ref_source",t),s&&h.set("ref_screen",s),a&&h.set("ref",a),e&&h.set("screen",e),l&&h.set("ads_label",l),n&&h.set("type",n),c&&h.set(i.GROUP_HEADER_QUERY_PARAM,"1"),`${window.location.origin}/market/product/${d??""}${o}-${r}${h.toString()?`?${h.toString()}`:""}`}},727968:(e,t,s)=>{try{var i=s(636576),r=s(450629);window.vk?.stDomain&&(s.p=window.vk.stDomain+"/dist/"),s._dG("Stories",r.Stories),(o=window.requestIdleCallback)||(o=e=>setTimeout((()=>e()),1)),o((()=>{try{(0,i.statlogsValueEvent)("entries_requests",1,"stories","web")}catch{}}),{timeout:5e3}),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/stories.63542531.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/web/stories.63542531.js",e),e}var o},472439:(e,t,s)=>{s.d(t,{AVATAR_SIZES:()=>_,COMMON_FRIENDS_IMAGE_STATUS_INDEX:()=>n,FOLLOWERS_SECTION_NAME:()=>h,FRIENDS_IMAGE_STATUS_INDEX:()=>a,FRIENDS_LIMIT_PER_PAGE:()=>u,FRIENDS_LIST_FRIEND_IS_NFT_INDEX:()=>c,FRIENDS_LIST_FRIEND_OPTIONS_INDEX:()=>i,FRIENDS_REQUESTS_FRIEND_IS_NFT_INDEX:()=>d,FRIENDS_REQUESTS_TO_SUBSCRIBERS_CLASSES:()=>p,FRIENDS_SECTIONS:()=>m,FRIENDS_STATUS_NOT_FRIENDS:()=>r,FRIENDS_STATUS_REQUEST_FROM_USER:()=>o,PHONEBOOK_SECTION_NAME:()=>l});const i=13,r=0,o=1,a=9,n=8,c=14,d=11,l="phonebook",h="followers",_={normal:80,small:48},u=2e3,p={ROOT:"friends_requests_to_subscribers",DESCRIPTION_STEP:"friends_requests_to_subscribers_description_step",DONE_STEP:"friends_requests_to_subscribers_done_step"};var m=function(e){return e.ALL="all",e.ALL_REQUESTS="all_requests",e.OUT_REQUESTS="out_requests",e.REQUESTS="requests",e.CLEANUP="cleanup",e}({})},326017:(e,t,s)=>{s.d(t,{FRIENDS_LIST_LOADING_MARK_START:()=>r,FRIENDS_LIST_LOADING_STATLOG:()=>n,FRIENDS_LOAD_MORE_MARK_START:()=>a,FRIENDS_OUT_REQUESTS_LOADING_MARK_START:()=>o,FriendsListLoadingType:()=>l,sendLoadingStats:()=>_,trackEndWithMarkName:()=>d,trackStartWithMarkName:()=>c});var i=s(636576);const r="FRIENDS_LIST_LOADING_MARK_START",o="FRIENDS_OUT_REQUESTS_LOADING_MARK_START",a="FRIENDS_LOAD_MORE_MARK_START",n="friends_list_loading";function c(e){window.cur.friendsPerformanceMarks||(window.cur.friendsPerformanceMarks={}),window.cur.friendsPerformanceMarks[e]=performance.now()}function d(e){return{duration:performance.now()-+window.cur.friendsPerformanceMarks[e]}}var l=function(e){return e.INIT_BLOCKING="init_blocking",e.INIT_PARALLEL="init_parallel",e.OUT_REQUESTS_BLOCKING="out_requests_blocking",e.LOAD_MORE="load_more",e}({});const h=()=>({isSameUser:window.vk?.id===window.cur?.oid?"true":"false"});function _(e,t,s){const r={...s,...h()};(0,i.statlogsValueEvent)(e,t,r)}},345939:(e,t,s)=>{s.d(t,{fillFriendsListWithDataFromServer:()=>m,isFriendsLoadingBugfixEnabled:()=>u,removeUnseenStories:()=>_});var i=s(783759),r=s(581197),o=s(540696),a=s(472439),n=s(478752),c=s(761520),d=s(326017),l=s(531205),h=s(827169);function _(e){window.cur&&window.cur.hasUnseenStories&&delete window.cur.hasUnseenStories[e];const t=document.querySelectorAll(".friends_photo_stories_unseen"+e);for(const s of t)s.classList.remove("friends_photo_stories_unseen","friends_photo_stories_unseen"+e),s.closest(".friends_photo")?.removeAttribute("onclick");(0,l.sharedSeenStories)().addSeenStories(e),(0,i.removeRichAvatarOutlineAtNode)(document.body,String(e),"stories_unseen")}function u(e=!1){return e}function p(e){return(t=0,s=e,Array.from(Array(s).keys()).map((e=>e+t))).map((e=>{return t={queryParams:{id:window.cur.oid??0,gid:window.cur.gid??0,sort:window.nav.objLoc.sort,platform_id:window.nav.objLoc.platform_id,section:window.cur.section,chunk_index:e,chunk_size:a.FRIENDS_LIMIT_PER_PAGE}},new Promise(((e,s)=>{c.ajax.post("al_friends.php",{act:"load_friends_silent",...t.queryParams},{onDone:(t,s,i)=>{e({friendsData:t,occupations:s,filters:i})},onFail:(e,t)=>{s({error:e,status:t})},local:1})}));var t}));var t,s}function m(e){const{showMore:t,filter:s,indexAll:i}=e.friendsMethods,c=function(e){const{icon:t}=(0,o.getIcon32Spinner)(),s=document.createElement("div");s.classList.add("friends_wide_loading");const i=(0,r.createElementFromHTML)(t);return i&&(s.append(i),e?.append(s)),()=>{s.remove()}}(document.querySelector("#list_content"));var l,_;let u=p((l=[window.cur.allFriendsCount,window.cur.allRequestsCount,window.cur.requestsCount,window.cur.followersCount],_=a.FRIENDS_LIMIT_PER_PAGE,Math.ceil(Math.max(...l)/_)));!function(){for(let e in window.cur.friendsList)window.cur.friendsList.hasOwnProperty(e)&&(window.cur.friendsList[e]=[])}(),Promise.allSettled(u).then((e=>{c(),window.cur.silent=!1;const r=[];let o=200,a="",l="false";for(let c of e){if("rejected"===c.status){o=c.reason?.status??"unknown",a=c.reason?.error?.message??"",l="true";continue}const{friendsData:e,occupations:d,filters:h}=c.value;if(e){window.cur.occupations=(0,n.extend)(window.cur.occupations||{},d);for(let t in e)e.hasOwnProperty(t)&&(window.cur.friendsList[t]=Array.isArray(window.cur.friendsList[t])?window.cur.friendsList[t].concat(e[t]):e[t]);i((function(){"list"==window.cur.section.substr(0,4)&&(window.cur.friendsList[window.cur.section]=Array.isArray(window.cur.friendsList[window.cur.section])?window.cur.friendsList[window.cur.section].concat(s(window.cur.friendsList.all,window.cur.section)):s(window.cur.friendsList.all,window.cur.section)),(window.cur.onSilentLoad||t)()})),h.cities&&r.push(h.cities)}}const _=r.flat().reduce(((e,t)=>{const s=function(e){if("string"==typeof e)return e;return`${e[0]}_${e[1]}`}(t);return e[s]||(e[s]=t),e}),{});!function(e){window.stManager.add(["ui_controls.js","ui_controls.css"],(function(){if(window.cur.cityFilter.setData(e),window.cur.cityFilterOpened){const e=document.getElementById("friends_fltr_progress");e&&(e.style.display="none"),window.cur.cityFilter.showDefaultList()}}))}(Object.values(_));const u=(0,d.trackEndWithMarkName)(d.FRIENDS_LIST_LOADING_MARK_START);(0,d.sendLoadingStats)(d.FRIENDS_LIST_LOADING_STATLOG,u.duration,{allFriendsListCount:window.cur.allFriendsCount,fansCount:window.cur.allRequestsCount,requestsCount:window.cur.requestsCount,followersCount:window.cur.followersCount,outRequestsCount:window.cur.outRequestsCount,mode:h.FriendsListLoadingMode.SILENT,httpStatus:o,section:window.cur.curList,errorMessage:a,loadingType:d.FriendsListLoadingType.INIT_PARALLEL,userId:window.vk.id,hasError:l})}))}},531205:(e,t,s)=>{s.d(t,{sharedSeenStories:()=>n});var i=s(558137),r=s(32489);const o=(0,r.createEvent)(),a=(0,r.createStore)(new Set).on(o,((e,t)=>{const s=new Set(e);return s.add(t),s})),n=(0,i.makeSharedState)("seen-stories",(()=>({addSeenStories:o,$seenStories:a})),{version:0})},827169:(e,t,s)=>{s.d(t,{FriendsListLoadingMode:()=>i});var i=function(e){return e.SILENT="silent",e.DEFAULT="default",e}({})},694876:(e,t,s)=>{s.d(t,{showGiftsCatalogModalLazy:()=>r});var i=s(351118);function r(e,t=!0){(0,i.asyncImportLoader)((()=>Promise.all([s.e(91498),s.e(89631),s.e(50560),s.e(62791),s.e(89887),s.e(76573),s.e(82365),s.e("langs/web/gifts-open-gifts-catalog")]).then(s.bind(s,719298))),3).then((({showGiftsCatalogModal:s})=>{s(e,t)})).catch((e=>{console.error("Module load failed",e)}))}},391944:(e,t,s)=>{s.d(t,{getAudienceResearchServiceWeb:()=>o});var i=s(593614),r=s(319756);const o=()=>(0,i.getAudienceResearchService)((0,r.ensureDIRootWebContainer)())},345235:(e,t,s)=>{s.d(t,{highlightModule:()=>l});var i=s(402096),r=s(137771),o=s(672277),a=s(754866),n=s(342018);let c,d;function l(e){const t=document.getElementById(e.module);if(!t||!t.classList.contains("module"))return;window.cur.__narrowBarForceNotFixed=!0;const s=e.speed?e.speed:300;(0,o.scrollToY)((0,a.getXY)(t)[1]-100,s);const l=()=>{c&&(c.hideTT(),(0,o.enableBodyScroll)(),delete window.cur.__narrowBarForceNotFixed,(0,r.updateNarrow)(),e.onClose&&e.onClose())};c=new i.default(t,e.text,{highlight:!0,width:250,offset:[0,-17],side:"bottom",withCloseButton:!0,onBGClick:l,onCloseButtonClick:l}),c.show(),(0,o.disableBodyScroll)(),e.autoCancelDelay&&(d=setTimeout((()=>{l(),d=null}),e.autoCancelDelay),(0,n.pushNavDestroy)((()=>{d&&clearTimeout(d)})))}},614320:(e,t,s)=>{s.d(t,{checkPostLen:()=>u,getPostAvatarString:()=>p,removeUnseenStories:()=>h,showPostponePostWithVideoInfo:()=>m});var i=s(754866),r=s(478752),o=s(952661),a=s(866467),n=s(15874),c=s(783759),d=s(43899),l=s(586520);function h(e){if(_(document,e),window.wkcur?.pageReplaced)for(let t of window.wkcur.pageReplaced)_(t[0],e)}function _(e,t){const s=e.querySelectorAll(".reply_image_stories_unseen"+t);for(const e of s)e.classList.remove("reply_image_stories_unseen","reply_image_stories_unseen"+t),(0,n.replyUserImageLinkClosest)(e)?.removeAttribute("onclick");(0,c.removeRichAvatarOutlineAtNode)(e,String(t),"stories_unseen");const i=e.querySelectorAll(".post_image_stories_unseen"+t);for(const e of i)e.classList.remove("post_image_stories_unseen","post_image_stories_unseen"+t),e.closest(".post_image, ._post_image")?.removeAttribute("onclick")}function u(e,t,s,n){if(!e)return;const c=window.cur.options?.max_post_full_length;if(!c)return!0;const d=(0,i.ge)(e);if(!d)return;let l=(0,r.trim)(window.Emoji.val(d)).replace(/\n\n\n+/g,"\n\n");if(d.lastLen===l.length&&!n)return d.lastLen<=c;const h=d.lastLen=l.length;if(t=(0,i.ge)(t),h>c-100){const e=h>c;if(t&&(e?(s&&(o.FlatButton.isFlatButton(s)?o.FlatButton.setDisabled(s,!0):(0,i.toggleClass)(s,"button_disabled",!0)),t.innerHTML=(0,a.getLang)("text_exceeds_symbol_limit",h-c),(0,i.toggleClass)(t,"post_field_warning_red",!0)):t.innerHTML=(0,a.getLang)("text_N_symbols_remain",c-h),(0,i.show)(t)),e)return!1}else t&&(0,i.hide)(t);return t&&(0,i.toggleClass)(t,"post_field_warning_red",!1),s&&(o.FlatButton.isFlatButton(s)?o.FlatButton.setDisabled(s,!1):(0,i.toggleClass)(s,"button_disabled",!1)),!0}const p=(e,t,s=l.REPLY_IMAGE_DEFAULT_SIZE,i=!1,r,o="")=>{const a=[t,"_post_field_image"];return r&&a.push(r),(0,d.renderAvatarToString)(e,s,null,a,null,void 0,!1,void 0,o,!(s<l.MIN_NFT_IMAGE_SIZE)&&i)},m=(e,t,s)=>{const i=document.querySelector(`#${e}`);if(!i)return;let r="",o="";const n=s.filter((e=>"video"===e[0])),c=Number(n.reduceRight(((e,t)=>t[t.length-1]?.publish_date||e),0));if(c)if(t){if(1===n.length&&t===c||0===n.length)return void(i.innerHTML="");n.length>1?(r=(0,a.getLang)("wall_post_with_video_different_dates_title"),o=(0,a.getLang)("wall_post_with_video_different_dates_info")):t>c?(r=(0,a.getLang)("wall_post_with_video_later_title"),o=(0,a.langDate)(1e3*c,(0,a.getLang)("wall_post_with_video_later_info"),0,(0,a.getLang)("months_of"))):t<c&&(r=(0,a.getLang)("wall_post_with_video_earlier_title"),o=(0,a.langDate)(1e3*t,(0,a.getLang)("wall_post_with_video_earlier_info"),0,(0,a.getLang)("months_of")))}else n.length>1?(r=(0,a.getLang)("wall_post_with_video_different_dates_title"),o=(0,a.getLang)("wall_post_with_video_different_dates_info")):1===n.length&&(r=(0,a.getLang)("wall_post_with_video_publish_together_title"));i.innerHTML=r?`\n      <div class="BannerInfo BannerInfo--warn BannerInfo--hasIcon BannerInfo--noHorizontalMargin BannerInfo--noTopMargin">\n        <div class="media_info_title">${r}</div>\n        ${o?`<div class="media_info_desc">${o}</div>`:""}\n      </div>`:""}},120101:(e,t,s)=>{s.d(t,{callIfCurReady:()=>f,callOnCurReady:()=>g,markLiveInStoriesFinished:()=>p,markSeenStoriesInProfile:()=>u,showFansBox:()=>_,showSilentModeBox:()=>m});var i=s(474848),r=s(270959),o=s(725669),a=s(866467),n=s(540462),c=s(792242),d=s(281356),l=s(677508),h=s(646482);function _(e,t,s,i={},o=""){return window.cur.viewAsBox?window.cur.viewAsBox():!(0,r.showBox)("al_fans.php",{act:"box",tab:t||"fans",oid:e,from:o},{cache:1,stat:["page_help.css",window.jsc("web/fansbox.js")],params:{...i}},s)}function u(e){"profile"===window.cur.module&&window.Profile?.markSeenStories&&window.Profile.markSeenStories(e)}function p(e){"profile"===window.cur.module&&window.Profile?.markLiveInStoriesFinished&&window.Profile.markLiveInStoriesFinished(e)}function m(e,t,r,l){if((0,n.partConfigEnabled)("reports_silent-mode-miniapp")){const e=(0,o.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(96851),s.e(5375),s.e(44484),s.e(29e3),s.e(60712),s.e(37310),s.e(94220),s.e(59933),s.e("langs/web/ReportMiniApp")]).then(s.bind(s,379787))),(({ReportMiniAppModalContent:e})=>e));(0,d.showMessageBoxModalSuspense)((t=>(0,i.jsx)(e,{...t,mode:"silent",ariaLabel:(0,a.getLang)("settings_silent_mode_modal_aria_label"),onChange:l})),{width:420})}else(0,c.showSilentModeEnabledFormBox)({csrf:r,endDate:e,callsMailSend:t,redirectOnClose:!1,redirectOnSubmit:!1,onSubmit:l})}let v=null;function g(e){!(0,h.isProfileWebSpaEnabled)()||(0,l.isCurReady)()?e():(v||(0,l.onCurReady)((()=>{v?.()})),v=e)}function f(e){(0,l.isCurReady)()&&e()}},792242:(e,t,s)=>{s.d(t,{showSilentModeEnabledFormBox:()=>n,showSilentModeEndFormBox:()=>c,showSilentModeFormBox:()=>a});var i=s(474848),r=s(725669),o=s(281356);function a(e){const t=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(73214),s.e("langs/web/SilentModeForms")]).then(s.bind(s,544993))),(({SilentModeForm:e})=>e));(0,o.showMessageBoxModalSuspense)((s=>(0,i.jsx)(t,{...s,...e})),{width:400})}function n(e){const t=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(73214),s.e("langs/web/SilentModeForms")]).then(s.bind(s,828186))),(({SilentModeEnabledForm:e})=>e));(0,o.showMessageBoxModalSuspense)((s=>(0,i.jsx)(t,{...s,...e})),{width:400})}function c(e,t){const a=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(73214),s.e("langs/web/SilentModeForms")]).then(s.bind(s,734350))),(({SilentModeEndForm:e})=>e));(0,o.showMessageBoxModalSuspense)((t=>(0,i.jsx)(a,{...t,...e})),{width:400,onDestroy:t})}},65759:(e,t,s)=>{s.d(t,{ReportReasonIds:()=>l,afterCommentReportSubmit:()=>h,showReportForm:()=>c.showReportForm});var i=s(237625),r=s(866467),o=s(168066),a=s(957994),n=s(303279),c=s(415033),d=s(416368);if(!(0,s(540462).partConfigEnabled)("frontend.api_client_login_instance")){(0,o.initApi)();const e=window.vk;(0,a.setLoginConfig)({onCaptcha:n.handleCaptcha,domain:e?.apiConfigDomains?.loginDomain}),(0,a.setApiConfig)({onCaptcha:n.handleCaptcha,domain:e?.apiConfigDomains?.apiDomain,challenge:d.processFetchChallenge})}var l=function(e){return e[e.NotOriginalContent=28]="NotOriginalContent",e}({});function h(e,t,s){const o=function(e,t,s){switch(e){case"photo":return`#post${t}photo_${s}`;case"video":return`#post${t}video_${s}mv`;case"market":return`#post${t}market_${s}`}}(e,t,s);if("photo"===e){const e=document.querySelector(`${o} .dld`);null!==e&&(e.outerHTML="")}const a=document.querySelector(`${o} .reply_wrap`);null!==a?(a.style.display="none",a.outerHTML+=`<div class="dld">${(0,r.getLang)("global_report_sent")}</div>`):(0,i.debugLog)(`Unable to hide report button for ${e} comment`)}},415033:(e,t,s)=>{s.r(t),s.d(t,{showReportForm:()=>l});var i=s(474848),r=s(725669),o=s(211413),a=s(540462),n=s(319756),c=s(866467),d=s(792242);function l(e,t,l,h,_,u,p,m,v){if((0,a.partConfigEnabled)("reports_miniapp")){const a=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(96851),s.e(5375),s.e(44484),s.e(29e3),s.e(60712),s.e(37310),s.e(94220),s.e(59933),s.e("langs/web/ReportMiniApp")]).then(s.bind(s,379787))),(({ReportMiniAppModalContent:e})=>e));(0,o.showMessageBoxModalSuspense)((s=>(0,i.jsx)(a,{...s,width:450,onSubmit:h,onReportCategorySelection:u?.onReportCategorySelection,ariaLabel:(0,c.getLang)("reports_form_aria"),mode:"report",query:{from:p,adData:m,trackCode:v,type:e,sourceOwnerId:t,sourceId:l}})),{onDestroy:_,width:450})}else if("user"===e){const e=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(66434),s.e("langs/web/ReportsProfileModal")]).then(s.bind(s,863927))),(({ReportsProfileModal:e})=>e)),a=e=>{window.location.assign(e)};(0,o.showMessageBoxModalSuspense)((s=>(0,i.jsx)(n.DIRootWebProvider,{children:(0,i.jsx)(e,{userId:t,onRedirect:a,onSilentModalShow:d.showSilentModeFormBox,...s})})),{onDestroy:_})}else{const a=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(99595),s.e("langs/web/ReportForm")]).then(s.bind(s,716729))),(({ReportForm:e})=>e));(0,o.showMessageBoxModalSuspense)((s=>(0,i.jsx)(a,{...s,trackCode:v||void 0,reportSource:e,reportSourceOwnerId:t,reportSourceId:l,onSubmit:h,messengerAdditionalData:u,from:p,adData:m})),{onDestroy:_})}}},862566:(e,t,s)=>{async function i(e){const{showMenuSettingsBox:t}=await Promise.all([s.e(91498),s.e(89631),s.e(89887),s.e(6694),s.e("langs/web/menu_settings")]).then(s.bind(s,641921));t(e)}s.d(t,{loadMenuSettingsBox:()=>i})},325094:(e,t,s)=>{s.d(t,{createLeftMenuInitiator:()=>M,initLeftMenu:()=>L});var i=s(474848),r=s(440961),o=s(33371),a=s(384483),n=s(865708),c=s(401447),d=s(296540),l=s(458840),h=s(547603),_=s(363046),u=s(523417),p=s(707491),m=s(664441),v=s(636576),g=s(554912),f=s(127609),y=s(866467),S=s(101272),w=s(862566),b=s(540462),k=s(205338),E=s(245426);const C=Date.now(),I=(0,o.default)((()=>(0,b.partConfigEnabled)("web_mourning")));function T(e,t){window.vk.statsMeta.st&&(0,S.saveStatlogEvents)({name:"left_menu_interactions",value:1,keys:[e,window.vk.id,C,...t??[]]})}function L(e){(0,h.setLeftMenu)(e),requestAnimationFrame((()=>{M(document).render()}))}function M(e){const t=e.querySelector("#"+(0,a.getReactRootElId)("LeftMenuRoot"));let s;return{render(){t&&((0,b.partConfigEnabled)("enable_create_root")?(s||(s=(0,k.createRoot)(t)),s.render((0,i.jsx)(N,{}))):r.render((0,i.jsx)(N,{}),t))},unmount(){(0,b.partConfigEnabled)("enable_create_root")?s?.unmount():t&&r.unmountComponentAtNode(t)}}}const A=()=>document.body.classList.contains("body_narrow_sidebar"),x=(e,t,{icon:s,...i})=>{T("nav_go",[e.currentTarget.tagName,JSON.stringify(i),JSON.stringify(t)]),window.vk.statsMeta.st&&(t.debugLog=(e,...t)=>T(e,t));const r=(0,f.navGo)(e.currentTarget,e.nativeEvent,t);!1===r&&(0,_.cancelEvent)(e),T("nav_go_result",[void 0===r?"undefined":JSON.stringify(r)])},P=(e,t)=>{e.counter_href&&(t.stopPropagation(),x(t,{},e))},R=(e,t)=>{T("item_click",[e?.id,e?.href,e?.action?.type]),(e=>{e.id&&(0,p.unPrefixId)(e.id)===m.PAGE_ID_CLIPS&&(0,v.statlogsValueEvent)("clips_sections_open",1,"clips")})(e);const s=t.nativeEvent,{action:i}=e;if(i){const r=i.type;switch(r){case"nav_go":return void x(t,JSON.parse(i.options_serialized),e);case"open_app":return T("show_app",[i.app_id,i.ref]),void(0,l.showApp)(s,i.app_id,i.need_install,i.ref);case"custom":T("custom_action",[i.handler]);try{Function("event",i.handler)(s)}catch(e){console.error(e),T("custom_failure",e?.message?[e.message]:[])}return;case"external_link":return}T("unknown_action"),(0,u.expectNever)(r)}e.href&&x(t,{},e)},O=e=>(0,h.closeTooltip)(e);function N(){T("render");const{sections:e,footerSections:t}=(0,h.useLeftMenuStore)(),[s,r]=(0,d.useState)(A);return(0,d.useEffect)((()=>{const e=new MutationObserver((e=>{e.forEach((e=>{"attributes"===e.type&&"class"===e.attributeName&&r(A())}))}));return e.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>{e.disconnect()}}),[]),(0,d.useEffect)((()=>{e.forEach((e=>{e.items.forEach((e=>{e.add_static&&window.stManager.add(e.add_static)}))}))}),[e.length]),e.length?(0,i.jsx)(n.AppRootProvider,{children:(0,i.jsx)(c.LeftMenuOld,{sections:e,narrow:s,settingsAriaLabel:(0,y.getLang)("settings_menu_box"),bottom:(0,i.jsx)(c.LeftMenuOld.Footer,{sections:t,onSelect:R}),onSelect:R,onCounterClick:P,onSettingsClick:e=>{(0,w.loadMenuSettingsBox)(e.settings_type)},className:I()?E.default.mourning:void 0,onTooltipClose:O})}):(0,i.jsx)(g.LeftMenuLegacySkeleton,{})}},966369:(e,t,s)=>{s.d(t,{leftMenu:()=>o});var i=s(547603),r=s(707491);const o={showItem(e){(0,i.setItemHidden)({id:e,isHidden:!1});const t=(0,r.getLegacyLeftMenuItemEl)(e);t&&(t.style.display="")},setBadge(e,t){(0,i.setBadge)({id:e,badge:t});const s=(0,r.getLegacyLeftMenuItemEl)(e);s&&(s.classList.toggle("LeftMenu__item--withRedDot","prominent"===t),s.classList.toggle("LeftMenu__item--withBlueDot","accent"===t))},removeBadge(e){this.setBadge(e,void 0)}}},554912:(e,t,s)=>{s.d(t,{LeftMenuLegacySkeleton:()=>o});var i=s(474848),r=(s(296540),s(346568));const o=()=>(0,i.jsx)("div",{className:"LeftMenuLegacySkeleton",children:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18].map((e=>(0,i.jsxs)("div",{className:"LeftMenuLegacySkeleton__item",children:[(0,i.jsx)(r.Skeleton,{className:"LeftMenuLegacySkeleton__icon",width:20,height:20,colorFrom:"var(--vkui--color_skeleton_to)",noAnimation:!0,circle:!0}),(0,i.jsx)(r.Skeleton,{className:"LeftMenuLegacySkeleton__label",height:12,colorFrom:"var(--vkui--color_skeleton_to)",noAnimation:!0})]},e)))})},274222:(e,t,s)=>{s.d(t,{createLeftMenuInitiator:()=>o.createLeftMenuInitiator,initLeftMenu:()=>o.initLeftMenu,leftMenu:()=>i.leftMenu,setLeftMenu:()=>r.setLeftMenu,updateItemCount:()=>r.updateItemCount});var i=s(966369),r=s(547603),o=s(325094)},547603:(e,t,s)=>{s.d(t,{closeTooltip:()=>k,setBadge:()=>w,setItemHidden:()=>b,setLeftMenu:()=>y,updateItemCount:()=>S,useLeftMenuStore:()=>E});var i=s(558137),r=s(32489),o=s(679005),a=s(707491),n=s(293721),c=s(70921),d=s(351118),l=s(766770),h=s(319756);function _(e){return t=>t.id===e||t.id===(0,a.prefixId)(e)}function u(e,t,s){return(0,o.produce)(e,(e=>{e.some((({items:e})=>e.some((e=>{if(t(e))return s(e),!0}))))}))}const p=e=>"footer"===e.id||"legal"===e.id,m=e=>"internal.getWebLeftMenu"===e.method&&void 0!==e.response?.sections;const v=(0,i.makeSharedState)("left-menu-store",(()=>function(){const e=(0,r.createStore)([]),t=(0,r.createStore)([]),s=(0,r.combine)({sections:e,footerSections:t}),i=(0,r.createEvent)("setLeftMenu"),o=(0,r.createEvent)("setLeftMenuFooter"),n=(0,r.createEvent)("updateItemCount"),l=(0,r.createEvent)("setBadge"),h=(0,r.createEvent)("setHidden"),v=(0,r.createEvent)("closeTooltip");e.on(i,((e,t)=>m(t)?(0,d.decodeHTMLEntitiesDeep)(t.response.sections).filter((e=>!p(e))):[])).on(n,((e,{id:t,count:s,href:i})=>u(e,_(t),(e=>{e.count=Math.max(s,0),e.is_hidden=s<0,i&&(e.href=i),t===c.PAGE_ID_MARKET_ORDERS&&(e.is_hidden=!1)})))).on(l,((e,{id:t,badge:s})=>u(e,_(t),(e=>{e.badge=s})))).on(h,((e,{id:t,isHidden:s})=>u(e,_(t),(e=>{e.is_hidden=s})))).on(v,((e,{hint_id:t})=>{return u(e,(s=t,e=>e.tooltip?.hint_id===s),(e=>{delete e.tooltip}));var s})),t.on(o,((e,t)=>t));const g=(0,r.createEffect)((({hint_id:e,hint_hash:t})=>{(0,a.turnOffTooltip)(e,t)}));return(0,r.sample)({source:v,target:g}),(0,r.sample)({clock:i,source:e,filter:(e,t)=>m(t),fn:(e,t)=>(0,d.decodeHTMLEntitiesDeep)(t.response.sections).filter(p),target:o}),{$leftMenu:s,setLeftMenu:i,updateItemCount:n,setBadge:l,setItemHidden:h,closeTooltip:v}}()),{version:0}),g=v(),f=(0,h.ensureDIRootWebContainer)().resolve(l.LeftMenuService),y=e=>{g.setLeftMenu(e),f.setSections(e.response)},S=e=>{g.updateItemCount(e),f.updateItem(e.id,{count:e.count,href:e.href})},w=e=>{g.setBadge(e),f.updateItem(e.id,{badge:e.badge})},b=e=>{g.setItemHidden(e),f.updateItem(e.id,{is_hidden:e.isHidden})},k=e=>{g.closeTooltip(e),f.closeTooltip(e.hint_id)},E=()=>(0,n.useStore)(g.$leftMenu)},444091:(e,t,s)=>{s.d(t,{ViewId:()=>r,views:()=>l});var i=s(296540),r=(s(517101),function(e){return e.LAYER="layer",e.LAYER_PURCHASE_DETAILS="layer_purchase_details",e.RANDOM_SELECTOR="random_selector",e.RANDOM_SELECTOR_PACKS="RANDOM_SELECTOR_packs",e.RANDOM_SELECTOR_RESULT="RANDOM_SELECTOR_result",e}({}));const o=(0,i.lazy)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(21529),s.e(22081),s.e(51915),s.e(18624),s.e(81652),s.e(21904),s.e(52731),s.e("langs/web/stickers-layer-view")]).then(s.bind(s,568327)).then((({Layer:e})=>({default:e}))))),a=(0,i.lazy)((()=>Promise.all([s.e(91498),s.e(89631),s.e(16846),s.e("langs/web/stickers-layer-purchase-details-view")]).then(s.bind(s,491893)).then((({PurchaseDetails:e})=>({default:e}))))),n=(0,i.lazy)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(81652),s.e(64273),s.e("langs/web/stickers-random-selector-view")]).then(s.bind(s,786622)).then((({Main:e})=>({default:e}))))),c=(0,i.lazy)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(12318),s.e("langs/web/stickers-random-selector-packs-view")]).then(s.bind(s,935102)).then((({Packs:e})=>({default:e}))))),d=(0,i.lazy)((()=>Promise.all([s.e(91498),s.e(89631),s.e(762),s.e(71409),s.e("langs/web/stickers-random-selector-result-view")]).then(s.bind(s,10466)).then((({Result:e})=>({default:e}))))),l=new Map([["layer",{Component:o,width:640}],["layer_purchase_details",{Component:a}],["random_selector",{Component:n}],["RANDOM_SELECTOR_packs",{Component:c}],["RANDOM_SELECTOR_result",{Component:d}]])},517101:(e,t,s)=>{s(239866)},239866:(e,t,s)=>{var i=s(32489),r=s(432465),o=s(553560);const a=(0,i.createEffect)((({title:e,subtitle:t,action:s,timeout:i,onClose:o})=>{(0,r.showSnackbar)({text:e,subtitle:t,timeout:i,action:s,onClose:o})}));(0,i.sample)({clock:o.showSnackbar,target:a});const n=(0,i.createEffect)((e=>{(0,r.hideSnackbar)(e)}));(0,i.sample)({clock:o.hideSnackbar,target:n})},574061:(e,t,s)=>{s.d(t,{openView:()=>n});var i=s(474848),r=s(444091),o=s(968351),a=s(211413);async function n(e){const{view:t,modalBoxOptions:s}=e,{width:n,Component:c}=r.views.get(t)||{};if(c)return(0,a.showMessageBoxModalSuspense)((({onClose:t,refreshCoordinates:s})=>(0,i.jsx)(o.InitOptionsProvider,{value:{payload:{},...e,init:s,destroy:t},children:(0,i.jsx)(c,{})})),{width:n,...s})}},878769:(e,t,s)=>{s.d(t,{openLayerPurchaseDetails:()=>o});var i=s(444091),r=s(574061);function o(e){return(0,r.openView)({payload:e,view:i.ViewId.LAYER_PURCHASE_DETAILS})}},1497:(e,t,s)=>{s.d(t,{openStickersLayerView:()=>d});var i=s(32489),r=s(444091),o=s(574061),a=s(878769),n=s(636843),c=s(141324);async function d(e){const{modalBoxOptions:t}=e;return(0,o.openView)({payload:{...e,onPurchaseDetailsOpen:e=>(0,a.openLayerPurchaseDetails)({details:e})},modalBoxOptions:t,view:r.ViewId.LAYER})}const l=n.stickers.createEffect(d);(0,i.sample)({clock:c.openProductModal,target:l})},755248:(e,t,s)=>{s.d(t,{situationalSuggestsGetById:()=>r});var i=s(957994);const r=e=>(0,i.api)("situationalSuggests.getById",{theme_ids:`${e.join(",")}`})},295577:(e,t,s)=>{s.d(t,{StoryCardSkeleton:()=>a});var i=s(474848),r=(s(296540),s(346568)),o=s(145697);const a=({className:e,withoutCardAnimation:t=!1,withRedesignV3Enabled:s=!1,borderRadius:a=8})=>{const n=s?40:36,c=s?40:56,d=s?12:8,l=(0,i.jsxs)("div",{className:"StoryCardSkeleton__content",children:[(0,i.jsx)(r.Skeleton,{className:"StoryCardSkeleton__circle",width:n,height:n,circle:!0}),(0,i.jsx)(r.Skeleton,{className:"StoryCardSkeleton__name",width:c,height:d,borderRadius:4})]}),h={height:167,width:94,borderRadius:a};return t?(0,i.jsx)("div",{className:(0,o.classNames)("StoryCardSkeleton","StoryCardSkeleton--withoutAnimation",e),style:h,children:l}):(0,i.jsx)(r.Skeleton,{className:(0,o.classNames)("StoryCardSkeleton",e),...h,children:l})}},280218:(e,t,s)=>{s.d(t,{StoryNotIslandBlockSkeleton:()=>a});var i=s(474848),r=(s(296540),s(145697)),o=s(295577);const a=({className:e,withRedesignV3Enabled:t=!1})=>(0,i.jsxs)("div",{className:(0,r.classNames)("StoryNotIslandBlockSkeleton",e),children:[(0,i.jsx)(o.StoryCardSkeleton,{className:"StoryNotIslandBlockSkeleton__story",withRedesignV3Enabled:t,withoutCardAnimation:!0,borderRadius:12}),(0,i.jsx)(o.StoryCardSkeleton,{className:"StoryNotIslandBlockSkeleton__story",withRedesignV3Enabled:t,withoutCardAnimation:!0,borderRadius:12}),(0,i.jsx)(o.StoryCardSkeleton,{className:"StoryNotIslandBlockSkeleton__story",withRedesignV3Enabled:t,withoutCardAnimation:!0,borderRadius:12}),(0,i.jsx)(o.StoryCardSkeleton,{className:"StoryNotIslandBlockSkeleton__story",withRedesignV3Enabled:t,withoutCardAnimation:!0,borderRadius:12}),(0,i.jsx)(o.StoryCardSkeleton,{className:"StoryNotIslandBlockSkeleton__story",withRedesignV3Enabled:t,withoutCardAnimation:!0,borderRadius:12}),(0,i.jsx)(o.StoryCardSkeleton,{className:"StoryNotIslandBlockSkeleton__story",withRedesignV3Enabled:t,withoutCardAnimation:!0,borderRadius:12})]})},5297:(e,t,s)=>{s.d(t,{StoryBlockCustomEvent:()=>i});var i=function(e){return e.BLOCK_SCROLL_TO_CENTER="block_scroll_to_center",e.BLOCK_RESET_SCROLL="block_reset_scroll",e}({})},278153:(e,t,s)=>{s.d(t,{StoryFeedBlockController:()=>p});var i=s(474848),r=s(205338),o=s(865708),a=s(319756),n=s(280218),c=s(454110),d=s(527750),l=s(798596),h=s(856771),_=s(894675),u=s(608814);class p{unmountBlock(){this.reactRoot?.unmount(),this.reactRoot=void 0}deinitialize(){this.dataManager.reset(),this.removeCustomEvents(),this.unmountBlock(),this.initiated=!1}destroy(){this.deinitialize(),this.destroySkeleton(),this.externalOnReadyCallback=void 0}renderSkeletonElement(){return(0,i.jsx)(n.StoryNotIslandBlockSkeleton,{withRedesignV3Enabled:!0})}render(){this.dataManager.isListEmpty()&&this.dataManager.isSearchFeedListLoading()||(this.reactRoot=this.reactRoot??(0,r.createRoot)(this.container),this.reactRoot.render((0,i.jsx)(o.AppRootProvider,{children:(0,i.jsx)(a.DIRootWebProvider,{children:(0,i.jsx)(c.StoriesBlock,{skeleton:this.renderSkeletonElement(),dataManager:this.dataManager,onReadyCallback:this.onReadyCb,onCreateStoryClick:()=>{(0,a.ensureDIRootWebContainer)().resolve(u.WebLayers).open("storiesCreatorModal",{layerParams:{},layerQuery:{entrypoint:"stories_feed"}})},onStoryClick:({getStoryCardElement:e,item:t,fromEl:s})=>{const i="discover"===t.type?"discover":this.dataManager.listName;(0,h.showStory)(`${t.id}/${i}`,{fromEl:s,getStoryElement:e})},onStoriesSettingsClick:()=>{(0,_.showStoryBlackList)(),(0,d.ensureStoryViewStats)().send({event_type:"go_to_settings",story_id:0,story_owner_id:0,view_entry_point:"feed",nav_screen:"feed",story_type:"",time:Number(new Date)})}})})})))}isContainerEmpty(){return!this.container.childNodes.length}onFeedListFetchEnded(){this.dataManager.isFeedModeActive&&this.render()}onSearchFeedFetchEnded(){this.dataManager.isSearchFeedModeActive&&this.render()}removeCustomEvents(){for(;this.unsubscribeListeners.length;)this.unsubscribeListeners.pop()?.()}addCustomEvents(){const e=[[l.StoryRequestCustomEventName.SEARCH_FEED_FAILED,this.onSearchFeedFetchEnded.bind(this)],[l.StoryRequestCustomEventName.SEARCH_FEED_LOADED,this.onSearchFeedFetchEnded.bind(this)],[l.StoryRequestCustomEventName.FEED_FAILED,this.onFeedListFetchEnded.bind(this)],[l.StoryRequestCustomEventName.FEED_LOADED,this.onFeedListFetchEnded.bind(this)]];this.removeCustomEvents(),this.unsubscribeListeners=e.map((([e,t])=>this.dataManager.storiesEvents.subscribe(String(e),t)))}init(){this.initiated||(this.dataManager.isInitiated()||this.dataManager.init(),this.initiated=!0,this.addCustomEvents(),this.dataManager.isListLoaded()?this.render():this.dataManager.isListLoading()?this.dataManager.getFetchingPromise().then((()=>{this.render()})):(this.dataManager.loadList(),this.isContainerEmpty()&&this.render()))}setQuery(e){this.dataManager.setQuery(e)}isInitiated(){return this.initiated}getSkeleton(){if(this._cachedSkeleton)return this._cachedSkeleton.node;const e=document.createElement("div"),t=(0,r.createRoot)(e);return t.render(this.renderSkeletonElement()),this._cachedSkeleton={node:e,root:t},e}destroySkeleton(){this._cachedSkeleton&&(this._cachedSkeleton.root.unmount(),this._cachedSkeleton=null)}constructor(e,t){this.dataManager=(0,d.ensureStoryDataManager)(),this.initiated=!1,this.onReadyCallbackCalled=!1,this.unsubscribeListeners=[],this._cachedSkeleton=null,this.onReadyCb=()=>{this.externalOnReadyCallback&&!this.onReadyCallbackCalled&&this.externalOnReadyCallback(),this.onReadyCallbackCalled=!0},this.container=e,this.externalOnReadyCallback=t}}},452757:(e,t,s)=>{s.d(t,{StoryFeedBlockController:()=>i.StoryFeedBlockController});var i=s(278153)},537362:(e,t,s)=>{s.d(t,{preloadStoryImagesFromDataManager:()=>r});var i=s(253132);function r(e){const t=e.getList(),s=e.getViewer(),r=e=>{0};i.storyFeedBlockImagePreloader.preloadFeedBlockImages(e.storiesCache,s).catch(r),i.storyFeedBlockImagePreloader.preloadFeedBlockImages(t,s).catch(r)}},774459:(e,t,s)=>{s.r(t),s.d(t,{StoryFeedBlockController:()=>i.StoryFeedBlockController,cleanStoryFeedStore:()=>r.cleanStoryFeedStore,ensureStoryDataManager:()=>r.ensureStoryDataManager,ensureStoryViewStats:()=>r.ensureStoryViewStats,getStoryDiscoverDataManager:()=>r.getStoryDiscoverDataManager,getStoryFeedDataManager:()=>r.getStoryFeedDataManager,loadDiscover:()=>o.loadDiscover,preloadStoryImagesFromDataManager:()=>a.preloadStoryImagesFromDataManager});var i=s(452757),r=s(527750),o=s(869319),a=s(537362)},869319:(e,t,s)=>{s.d(t,{loadDiscover:()=>r});var i=s(774459);function r(e,t){return(0,i.getStoryDiscoverDataManager)().fetch(e,t)}},410159:(e,t,s)=>{s.d(t,{BaseStoryRequestStore:()=>r});var i=s(664331);class r{fetch(e){return this.promise||(this.status="loading",this.controller=new AbortController,this.promise=this.request({params:e,fetchOptions:{signal:this.controller.signal}}),this.promise.then((e=>this.onSuccess(e)),(e=>this.onFail(e))).finally((()=>{delete this.promise}))),this.promise}onSuccess(e){return this.whenLoadedPromise&&(this.whenLoadedPromise.resolve(),delete this.whenLoadedPromise),this.data=e,this.status="loaded",e}onFail(e){this.whenLoadedPromise&&(this.whenLoadedPromise.reject(e),delete this.whenLoadedPromise),e?.error&&(0,i.isRequestAbortError)(e.error)||(this.status="failed")}isLoading(){return"loading"===this.status}isLoaded(){return"loaded"===this.status}isFailed(){return"failed"===this.status}abort(){this.controller&&(this.controller.abort(),this.status=this.data?"loaded":"initial",delete this.promise)}reset(){this.abort(),this.data=null,this.status="initial"}nextLoad(){return this.whenLoadedPromise||(this.whenLoadedPromise=Promise.withResolvers()),this.whenLoadedPromise.promise}}},112583:(e,t,s)=>{s(410159)},663136:(e,t,s)=>{s(957994);var i=s(410159);i.BaseStoryRequestStore},816260:(e,t,s)=>{s(957994);var i=s(410159);s(594496);i.BaseStoryRequestStore},548003:(e,t,s)=>{s(805658);var i=s(410159);s(594496);i.BaseStoryRequestStore},552687:(e,t,s)=>{s(957994);var i=s(410159);s(594496);i.BaseStoryRequestStore},326298:(e,t,s)=>{s(805658);var i=s(410159);i.BaseStoryRequestStore},321193:(e,t,s)=>{s.d(t,{StoryRequestCustomEventName:()=>r,dispatchDiscoverLoadedEvent:()=>c,dispatchFeedFailedEvent:()=>n,dispatchFeedLoadedEvent:()=>a,dispatchSearchFeedLoadedEvent:()=>d});var i=s(540462),r=function(e){return e.FEED_LOADED="stories_feed_loaded",e.FEED_FAILED="stories_feed_failed",e.GROUPS_LOADED="stories_groups_loaded",e.DISCOVER_LOADED="stories_discover_loaded",e.SEARCH_FEED_LOADED="stories_search_feed_loaded",e.SEARCH_FEED_FAILED="stories_search_feed_failed",e}({});function o(){return(0,i.partConfigEnabled)("stories_web_dispatch_events_from_microtasks")?queueMicrotask:setTimeout}function a(){o()((()=>{window.dispatchEvent(new CustomEvent("stories_feed_loaded"))}))}function n(){o()((()=>{window.dispatchEvent(new CustomEvent("stories_feed_failed"))}))}function c(){o()((()=>{window.dispatchEvent(new CustomEvent("stories_discover_loaded"))}))}function d(){o()((()=>{window.dispatchEvent(new CustomEvent("stories_search_feed_loaded"))}))}},798596:(e,t,s)=>{s.d(t,{StoryRequestCustomEventName:()=>i.StoryRequestCustomEventName});s(112583),s(548003),s(326298),s(816260),s(552687),s(663136);var i=s(321193)},527750:(e,t,s)=>{s.d(t,{cleanStoryFeedStore:()=>l,ensureStoryDataManager:()=>d,ensureStoryViewStats:()=>n,getStoryDiscoverDataManager:()=>_,getStoryFeedDataManager:()=>h});var i=s(558137),r=s(454110),o=s(319756),a=s(262897);const n=()=>(0,o.ensureDIRootWebContainer)().resolve(a.StoryViewStats),c=(0,i.makeSharedState)("story_feed_store_new_architecture",(()=>{const e=(0,o.ensureDIRootWebContainer)().resolve(r.StoriesBlockManager);return{data:e,clear:()=>{e.reset()}}}),{version:1}),d=()=>c().data;function l(){c().clear()}function h(){return d().feed}function _(){return d().discover}},871610:(e,t,s)=>{s.d(t,{ActionsButton:()=>m});var i=s(474848),r=s(296540),o=s(866467),a=s(740342),n=s(693080),c=s(669563),d=s(478752),l=s(471984),h=s(246429),_=s(141575),u=s(646938),p=s(351118);const m=({story:e})=>{if(!e.getCurStoryData())return null;const t=function(e){const t=e.getCurStoryData(),s=e.getCurrentNarrative(),i=e.layer.listName,r=[];if(!t)return r;const{raw_id:c,can_hide_reply:_,report_hash:m,can_remove:v,can_delete_with_reason:g,isAds:f,canMarkNotInterested:y,can_manage:S}=t,{can_blacklist:w}=e.data,[b,k]=c.split("_").map((e=>(0,d.intval)(e)));let E=Boolean(s?.canEdit);s?.canEdit&&r.push({label:(0,o.getLang)("stories_narrative_edit_button"),onClick:()=>e.sendNarrativeEditButtonDidPress(),dataTestId:"story_header_menu_action_edit_narrative"});b===window.vk.id||!w||s||f||r.push({label:(0,o.getLang)("stories_add_blacklist_button"),onClick:()=>e.addToBlacklist(),dataTestId:"story_header_menu_action_add_blacklist"});y&&r.push({label:(0,o.getLang)("stories_mark_not_interested"),onClick:t=>{const s=new MouseEvent("mouseout",{bubbles:!0});t.nativeEvent.target?.dispatchEvent(s),e.markNotInterested()},dataTestId:"story_header_menu_action_mark_not_interested"});_&&r.push({label:(0,o.getLang)("stories_hide_reply_button"),onClick:()=>e.hideReply(),dataTestId:"story_header_menu_action_hide_reply"});s&&(r.push({label:s.isBookmarked?(0,o.getLang)("stories_narrative_remove_bookmark_button"):(0,o.getLang)("stories_narrative_add_bookmark_button"),onClick:()=>e.sendNarrativeBookmarkButtonDidPress(),dataTestId:"story_header_menu_action_bookmark"}),r.push({label:(0,o.getLang)("stories_narrative_copy_link"),onClick:()=>{const e=`${location.protocol}//${location.host}/narrative${b}_${s.id}_${k}`;(0,l.copyToClipboard)(e),(0,h.showDoneBox)((0,o.getLang)("stories_narrative_copy_link_done"))},dataTestId:"story_header_menu_action_copy_link"}));!m&&S||r.push({label:(0,o.getLang)("stories_report"),onClick:()=>e.report(),dataTestId:"story_header_menu_action_report"});b===window.vk.id||s||r.push({label:(0,o.getLang)("stories_settings"),onClick:()=>window.Stories.showBlackList(),dataTestId:"story_header_menu_action_open_settings"});if(t.is_authors_ads&&(t.advertiser_info_url&&r.push({label:(0,o.getLang)("global_ads_wall_post_advertiser_details"),onClick:()=>{e.layer.sendProductAnalyticEvents(n.StoryStatsEvent.OpenAdvertiser),window.open(t.advertiser_info_url,"_blank")}}),t.ad_marker)){const s=(0,p.decodeHTMLEntities)(t.ad_marker||""),i=`ERID: ${s}`;r.push({label:i,onClick:(0,a.debounce)((t=>{const r=t.target;r&&(e.layer.sendProductAnalyticEvents(n.StoryStatsEvent.CopyERID),s&&navigator.clipboard.writeText(s).then((()=>{r.textContent=(0,o.getLang)("global_ads_wall_post_ord_erid_copied"),setTimeout((()=>{r.textContent=i}),1e3)})))}),1e3,!0)})}E&&r.push({red:!0,label:(0,o.getLang)("stories_remove_from_narrative"),onClick:()=>e.removeStoryFromNarrative(),dataTestId:"story_header_menu_action_remove_from_narrative"});v&&r.push({red:!0,label:s?(0,o.getLang)("global_narrative_delete"):(0,o.getLang)("global_delete"),onClick:()=>s?e.removeNarrativeBox():e.removeStoryBox(),dataTestId:"story_header_menu_action_delete"});g&&r.push({red:!0,label:(0,o.getLang)("reports_strike_system_delete_with_reason"),onClick:()=>e.removeStoryWithReasonBox()});i===u.StoryListName.discover&&r.push({red:!0,label:(0,o.getLang)("stories_hide_discover"),onClick:()=>e.hideDiscover(),dataTestId:"story_header_menu_action_hide_discover"});return r}(e);if(0===t.length)return null;let s,m=(0,r.createRef)();return(0,i.jsxs)("div",{className:"ui_actions_menu_wrap _ui_menu_wrap ui_actions_menu_bottom",onMouseEnter:t=>{clearTimeout(s),e.pauseStory(),c.default.show(m.current,t)},onMouseLeave:()=>{c.default.hide(m.current),clearTimeout(s),s=setTimeout((()=>e.autoResumeStory()),300)},ref:m,children:[(0,i.jsx)("div",{className:"ui_actions_menu _ui_menu",children:t.map((({label:e,onClick:t,red:s,disable:r,dataTestId:o})=>(0,i.jsx)("div",{className:(0,p.classNames)("StoryMenuItem ui_actions_menu_item",{"StoryMenuItem--red":s,"StoryMenuItem--disable":r}),onClick:t,"data-testid":o,children:e},e)))}),(0,i.jsx)(_.Icon24MoreHorizontal,{})]})}},818874:(e,t,s)=>{s.d(t,{DynamicStickerItem:()=>h});var i=s(474848),r=s(646938),o=s(246429),a=s(755248),n=s(351118),c=s(530451),d=s(979554),l=s(79612);const h=({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:h,heightViewBox:_,onMouseDownHandle:u,onMouseUpHandle:p,sendNavigationStatEvents:m})=>{const v=()=>{if(e.type===r.DynamicStickersTypes.situationalTemplate)m("click_on_clickable_sticker",!0,{clickable_sticker:{id:e.id,id_value:e.situationalThemeId,type:"situational_template"}}),(async e=>{const t=(e,t)=>{console.error(e,t),(0,o.hideBoxLoader)()};if((0,n.isFunction)(window.layers?.fullhide)){window.layers.fullhide({noLoc:!0}),(0,o.showBoxLoader)(),(0,o.boxRefreshCoords)(window.boxLoader);try{const s=await(0,a.situationalSuggestsGetById)([e.situationalThemeId]),i=s?.items?.[0]?.story_box;if((0,n.isString)(i))try{const s=JSON.parse(i);if((0,n.isArray)(s?.stickers)&&(0,c.stickerContainerTypeGuard)(s.stickers)){const i=s.stickers.map((t=>"native"===t?.sticker_type&&"situational_template"===t?.sticker?.action_type?{...t,sticker:{...t.sticker,action:{count:e.situationalRepliedUsers?.count||0,users:e.situationalRepliedAvatars}}}:t));try{const t={entrypoint:l.navigationStat.getModule(),...s,photoUrl:s.url,stickers:i,serviceInfo:{situational_suggest_id:e.situationalThemeId}};await window.stManager.add([window.jsc("web/story_publisher.js")]),window.StoryPublisher.init(t,(()=>{}),(()=>{window.Stories.initializeLastSeenStories()})),(0,o.hideBoxLoader)()}catch(e){t("story.tsx publisher init error",e)}}}catch(e){t("story.tsx could not parse storybox",e)}else t("story.tsx storyBox is undefined")}catch(e){t("story.tsx data error",e)}}else console.error("story.tsx layers is broken")})(e)},g=e=>{p(e,(()=>v()))};return e.type===r.DynamicStickersTypes.situationalTemplate?(0,i.jsx)(d.TemplateSticker,{sticker:e,originalWidth:t,originalHeight:s,widthViewBox:h,heightViewBox:_,onMouseUpHandle:g,onMouseDownHandle:u}):null}},603709:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(474848),r=s(351118),o=s(702085);const a=({title:e,additionalTitle:t,needSeparator:s=!0,className:a,children:n,...c})=>(0,i.jsxs)("div",{"data-testid":c["data-testid"],className:(0,r.classNames)("FeedbackBaseBlock",a,{"FeedbackSeparator FeedbackSeparator--top":s}),children:[(0,i.jsx)(o.default,{title:e,additionalTitle:t}),n]})},335853:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(474848),r=s(55097),o=s(603709);const a=({poll:e})=>(0,i.jsx)(o.default,{className:"FeedbackPollBlock",title:e.title,children:(0,i.jsx)("div",{className:"FeedbackPollBlock__poll",children:(0,i.jsx)(r.default,{poll:e.data})})})},347061:(e,t,s)=>{s.d(t,{default:()=>l});var i=s(474848),r=s(296540),o=s(866467),a=s(771997),n=s(603709),c=s(754866),d=s(41903);class l extends r.Component{render(){const{questions:e}=this.props,{scrollBlockPosition:t}=this.state,{items:s=[],count:r}=e,c=(0,o.getLang)("stories_questions_title_N",r);return(0,i.jsx)(n.default,{className:"FeedbackQuestionsBlock",title:c,children:(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__questions",children:(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__wrapper",ref:this.scrollElement,children:(0,i.jsxs)("div",{className:"FeedbackQuestionsBlock__items",style:{transform:`translateX(-${t}px)`},ref:this.positionElement,children:[(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__gap"}),s.map(((e,t)=>(0,i.jsx)(a.default,{question:e,storyUrl:this.props.storyUrl,showMessage:this.props.showMessage,removeQuestion:this.removeQuestion},t))),(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__gap"})]})})})})}constructor(e){super(e),this.componentDidMount=()=>{const{current:e}=this.scrollElement;e&&e.addEventListener("wheel",this.questionsMouseWheel)},this.componentWillUnmount=()=>{const{current:e}=this.positionElement;e&&e.removeEventListener("wheel",this.questionsMouseWheel)},this.questionsMouseWheel=e=>{e.preventDefault(),this.props.questions.items.length<=1||this.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},this.setPosition=e=>{const{current:t}=this.positionElement;if(!t)return;const{scrollBlockPosition:s}=this.state,[i]=(0,c.getSize)(t),r=Math.max(0,Math.min(s+e,t.scrollWidth-i));this.setState({scrollBlockPosition:r})},this.removeQuestion=e=>{const{storyOwnerId:t,storyId:s,id:i}=e;d.storiesService.deleteQuestionFx({story_id:s,question_id:i,owner_id:t}).then((()=>{this.props.sendNavigationStatEvents("question_delete",!0,{question_id:i}),this.props.onQuestionRemove(i),this.props.questions.items.length&&this.setPosition(0)}))},this.state={scrollBlockPosition:0},this.scrollElement=(0,r.createRef)(),this.positionElement=(0,r.createRef)()}}},471143:(e,t,s)=>{s.d(t,{default:()=>c});var i=s(474848),r=s(603709),o=s(334977),a=s(454154),n=s(866467);const c=({replies:e,showMore:t})=>{const{list:s}=e,c=Boolean(e.moreRepliesCount);return(0,i.jsxs)(r.default,{className:"FeedbackRepliesBlock",title:e.title,additionalTitle:e.additionalTitle,children:[(0,i.jsx)("div",{className:"FeedbackRepliesBlock__replies",children:s?.map((t=>(0,i.jsx)(o.default,{storyPack:t,listName:e.listName,source:e.source},t.author?.id)))}),c&&(0,i.jsx)("div",{className:"FeedbackRepliesBlock__showMore",children:(0,i.jsx)(a.Button,{size:"m",mode:"tertiary",onClick:t,children:(0,n.langNumeric)(e.moreRepliesCount||0,(0,n.getLang)("stories_replies_more_button","raw"))})})]})}},789361:(e,t,s)=>{s.d(t,{default:()=>c});var i=s(474848),r=s(179745),o=s(603709),a=s(866467),n=s(216549);const c=({stats:e,onExtendedStatsPreviewClick:t})=>{const s=e.extendedStats;return s?(0,i.jsx)(o.default,{className:"FeedbackStatsBlock",title:e.title,children:(0,i.jsxs)("div",{className:"FeedbackStatsBlock__extendedStatsPreview FeedbackSeparator FeedbackSeparator--top",onClick:t,role:"button",children:[(0,i.jsx)(r.default,{appearance:"preview",title:(0,a.getLang)("stories_detailed_stats"),subtitle:s.preview}),(0,i.jsx)("div",{className:"FeedbackStatsBlock__chevron",children:(0,i.jsx)(n.Icon24ChevronCompactRight,{})})]})}):null}},702085:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(474848),r=s(373080);const o=({title:e,additionalTitle:t})=>(0,i.jsxs)("div",{className:"FeedbackTitle",children:[(0,i.jsx)(r.InnerHTML,{children:e}),t&&(0,i.jsx)(r.InnerHTML,{children:" "+t})]})},392094:(e,t,s)=>{s.d(t,{default:()=>C});var i=s(474848),r=s(296540),o=s(700272),a=s(179745),n=s(347061),c=s(603709),d=s(789361),l=s(471143),h=s(335853),_=s(363081),u=s(740342),p=s(270959),m=s(866467),v=s(351118),g=s(560265),f=s(604862),y=s(41903),S=s(210816),w=s(254756),b=s(361121),k=s(246429);class E extends r.Component{render(){const{feedback:e,showMessage:t,sendNavigationStatEvents:s,storyImageUrl:u,showMoreReplies:p,className:y,reactionSet:S}=this.props,{isViewersLoading:w,extendedStatsActive:b}=this.state,k=e?.stats,E=k?.extendedStats,C=e?.replies,I=e?.poll,T=e?.questions,L=e?.viewers;return(0,i.jsx)("div",{className:(0,v.classNames)("FeedbackTooltip",y),onClick:e=>e.stopPropagation(),children:(0,i.jsxs)("div",{className:"FeedbackTooltip__wrapper",children:[(0,i.jsx)("div",{className:"FeedbackTooltip__close",onClick:this.close,children:(0,i.jsx)(g.Icon24Cancel,{})}),!e&&(0,i.jsx)("div",{className:"FeedbackTooltip__spinner",children:(0,i.jsx)(o.Spinner,{size:"medium"})}),e&&(0,i.jsxs)(r.Fragment,{children:[!b&&(0,i.jsx)("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef,children:(0,i.jsxs)("div",{className:"FeedbackTooltip__content",children:[k&&(0,i.jsx)(d.default,{stats:k,onExtendedStatsPreviewClick:this.onExtendedStatsPreviewClick}),C&&(0,i.jsx)(l.default,{replies:C,showMore:p}),I&&(0,i.jsx)(h.default,{poll:I}),T&&(0,i.jsx)(n.default,{showMessage:t,storyUrl:u,questions:T,sendNavigationStatEvents:s,onQuestionRemove:this.onQuestionRemove}),L&&(0,i.jsx)(_.default,{viewers:L,reactionSet:S,isLoading:w,needSeparator:!e.questions}),Boolean(L?.nextFrom)&&(0,i.jsx)("div",{className:"FeedbackTooltip__sentinel",ref:this.viewsSentinelRef})]})}),E&&b&&(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("div",{className:"FeedbackTooltip__header FeedbackSeparator FeedbackSeparator--bottom",children:[(0,i.jsxs)("div",{className:"FeedbackTooltip__back",onClick:this.onBackBtnClick,children:[(0,i.jsx)("div",{className:"FeedbackTooltip__backIcon",children:(0,i.jsx)(f.Icon24ChevronCompactLeft,{})}),(0,m.getLang)("global_back")]}),(0,m.getLang)("stories_detailed_stats")]}),(0,i.jsx)("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef,children:(0,i.jsxs)("div",{className:"FeedbackTooltip__content",children:[E.achievement&&(0,i.jsx)("div",{className:"FeedbackTooltip__achievement",children:(0,i.jsx)(a.default,{appearance:"achievement",title:E.achievement,subtitle:E.achievementSubtitle})}),E.categories.map(((e,t)=>(0,i.jsx)(c.default,{title:e.title,"data-testid":e.type,children:(0,i.jsx)("div",{className:"FeedbackTooltip__lines",children:e.lines.map(((e,t)=>(0,i.jsxs)("div",{"data-testid":e.type,className:"FeedbackTooltip__line",children:[(0,i.jsx)("div",{className:"FeedbackStatName",children:(0,v.decodeHTMLEntities)(e.name)}),(0,i.jsx)("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}})]},t)))})},t)))]})})]})]})]})})}componentDidMount(){const{feedback:e,storyRawId:t,pollId:s,onFetchFeedbackData:i,likesCount:r}=this.props,{ownerId:o,itemId:a}=(0,b.splitRawId)(t);if(this.mounted=!0,e)return this.observeTitleChanges(),void this.observeViewerScrollIfNeeded();(0,y.fetchFeedbackFx)({ownerId:o,storyId:a,pollId:s}).then((e=>{if(this.mounted)try{const s=(0,w.transformFeedback)(e,t,r);i(s)}catch(e){console.error(e),(0,S.logStoriesError)({error:e,additionalText:"could not transform feedback data",extra:{ownerId:o,storyId:a}})}})).catch((e=>{console.error(e),(0,S.logStoriesError)({error:e,additionalText:"could not load feedback data",extra:{ownerId:o,storyId:a}}),(0,p.showFastBox)((0,m.getLang)("global_error"),(0,m.getLang)("global_unknown_error")),this.close()}))}componentDidUpdate(e,t){!e.feedback&&this.props.feedback&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded()),!t.extendedStatsActive&&this.state.extendedStatsActive?this.observeTitleChanges():t.extendedStatsActive&&!this.state.extendedStatsActive&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded())}componentWillUnmount(){this.unObserveTitleChanges(),this.unObserveViewerScroll(),this.mounted=!1}loadViewers(){const{storyRawId:e,feedback:t,onFetchViewers:s}=this.props,{isViewersLoading:i}=this.state,{ownerId:r,itemId:o}=(0,b.splitRawId)(e);if(!i&&t?.viewers?.nextFrom){this.setState({isViewersLoading:!0});const e=(0,y.getStoryFeedbackLoadParams)(r,o);y.storiesService.getViewersFx({...e[y.StoryFeedbackLoadMethods.getViewers],start_from:t.viewers.nextFrom}).then((e=>{const t=(0,w.transformViewersResponse)(e);t&&s(t),this.setState({isViewersLoading:!1})})).catch((e=>{console.error(e),(0,S.logStoriesError)({error:e,additionalText:"could not load feedback data",extra:{ownerId:r,storyId:o}}),(0,k.showDoneBox)((0,m.getLang)("global_unknown_error")),this.setState({isViewersLoading:!1})}))}}observeViewerScrollIfNeeded(){const{feedback:e}=this.props;if(e?.viewers?.nextFrom){const e=this.scrollContainerRef.current,t=this.viewsSentinelRef.current;if(!t)return;this.viewsObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&this.loadViewers()}))}),{threshold:[0,1],root:e,rootMargin:"0px 0px 336px 0px"}),this.viewsObserver.observe(t)}}unObserveViewerScroll(){this.viewsObserver&&this.viewsObserver.disconnect()}observeTitleChanges(){const e=this.scrollContainerRef.current;e&&(this.updateTitles(),this.onScrollHandler=(0,u.debounce)((()=>{!this.titles.some(((e,t)=>{if(e.offsetTop)return e===this.activeHeader||this.setActiveHeader(e),!0;if(this.titles[t+1]){const s=this.titles[t+1],i=this.titles[t+1].parentElement,r=i&&i.offsetHeight;return!!r&&(s.offsetTop+s.offsetHeight===r&&(e===this.activeHeader||this.setActiveHeader(e),!0))}return!1}))&&this.activeHeader&&(this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=null)}),5),e.addEventListener("scroll",this.onScrollHandler))}updateTitles(){const e=this.scrollContainerRef.current;e&&(this.titles=Array.from(e.querySelectorAll(".FeedbackTitle")),this.titles.reverse())}unObserveTitleChanges(){this.scrollContainerRef.current&&this.onScrollHandler&&this.scrollContainerRef.current.removeEventListener("scroll",this.onScrollHandler),this.onScrollHandler=null,this.titles=[]}setActiveHeader(e){this.activeHeader&&this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=e,e.classList.add("FeedbackTitle--active")}constructor(e){super(e),this.onQuestionRemove=e=>{this.props.onQuestionRemove(e)},this.close=()=>{this.props.toggleFeedbackTooltip(!1)},this.onExtendedStatsPreviewClick=()=>{const{sendNavigationStatEvents:e}=this.props;this.unObserveViewerScroll(),this.unObserveTitleChanges(),this.setState({extendedStatsActive:!0}),e("open_advanced_statistic")},this.onBackBtnClick=()=>{this.unObserveTitleChanges(),this.setState({extendedStatsActive:!1})},this.state={isViewersLoading:!1,extendedStatsActive:!1},this.mounted=!1,this.scrollContainerRef=(0,r.createRef)(),this.viewsSentinelRef=(0,r.createRef)(),this.titles=[],this.viewsObserver=null,this.activeHeader=null,this.onScrollHandler=null}}const C=E},363081:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(474848),r=s(550947),o=s(700272),a=s(603709);const n=({viewers:e,isLoading:t=!1,needSeparator:s=!0,reactionSet:n})=>(0,i.jsxs)(a.default,{className:"FeedbackViewersBlock",title:e.title,needSeparator:s,children:[e.hiddenReason&&(0,i.jsx)("span",{className:"FeedbackViewersBlock__hiddenReason",children:e.hiddenReason}),(0,i.jsx)("div",{className:"FeedbackViewersBlock__items",children:e.items.map(((e,t)=>(0,i.jsx)(r.default,{user:e,reactionSet:n},t)))}),t&&(0,i.jsx)("div",{className:"FeedbackViewersBlock__spinner",children:(0,i.jsx)(o.Spinner,{size:"small"})})]})},179745:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(474848),r=s(351118);const o=({title:e,subtitle:t,appearance:s="preview"})=>(0,i.jsxs)("div",{className:`InfoAside InfoAside--${s}`,children:[(0,i.jsx)("div",{className:"InfoAside__image"}),(0,i.jsxs)("div",{className:"InfoAside__description",children:[(0,i.jsx)("span",{className:"InfoAside__title",children:(0,r.decodeHTMLEntities)(e)}),(0,i.jsx)("span",{className:"InfoAside__subtitle",children:(0,r.decodeHTMLEntities)(t)})]})]})},55097:(e,t,s)=>{s.d(t,{default:()=>h});var i=s(474848),r=s(866467),o=s(788789),a=s(458840),n=s(351118),c=s(646938);function d(e){let t="";if(e.type===c.StoryPollBackgroundType.photo)t=`#${e.backgroundColor}`;else if(e.type===c.StoryPollBackgroundType.gradient){t=`linear-gradient(${e.angle-90}deg, ${e.points.map((e=>`#${e.color} ${Math.round(100*e.position)}%`)).join(", ")})`}return t}function l(e){const{ownerId:t,pollId:s,needShowResults:i}=e;i?(0,a.showWiki)({w:`poll${t}_${s}`},!1,void 0,{customRef:"story"}):(0,o.showPollBox)(s,{ref:"story",className:"story_poll"})}const h=({poll:e})=>{const t=function(e){const{background:t}=e;return(0,i.jsx)("div",{className:"PollSnippet__background",style:{background:d(t)},children:t.type===c.StoryPollBackgroundType.photo&&(0,i.jsx)("div",{className:"PollSnippet__photo",style:{backgroundImage:`url(${t.photoUrl})`}})})}(e);return(0,i.jsxs)("div",{className:(0,n.classNames)("PollSnippet",{"PollSnippet--default":e.background.type===c.StoryPollBackgroundType.default}),children:[t,(0,i.jsx)("div",{className:"PollSnippet__question",children:(0,n.decodeHTMLEntities)(e.question)}),(0,i.jsx)("div",{className:"PollSnippet__countVoters",children:(0,n.decodeHTMLEntities)(e.votersCountText)}),(0,i.jsx)("div",{className:"PollSnippet__showResult",onClick:l.bind(null,e),children:(0,r.getLang)("stories_voting_show_result")})]})}},771997:(e,t,s)=>{s.d(t,{default:()=>E});var i=s(474848),r=s(296540),o=s(454154),a=s(694244),n=s(782174),c=s(63614),d=s(724648),l=s(293116),h=s(908242),_=s(507852),u=s(866467),p=s(351118),m=s(478752),v=s(972332),g=s(65759),f=s(414108),y=s(41903),S=s(928410),w=s(21830),b=s(468073),k=s(211413);class E extends r.Component{constructor(e){super(e),this.componentDidMount=()=>{const e=this.questionTextEl.current;e&&this.adjustQuestionTextSize(e)},this.componentDidUpdate=()=>{this.replyTextareaEl.current&&this.replyTextareaEl.current.focus()},this.render=()=>{const{isOpenReplyModal:e,replyText:t}=this.state,{question:s,storyUrl:r}=this.props,{author:_,canAnswer:m,text:v}=s,g=(0,p.decodeHTMLEntities)(v),f=(0,p.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!m});return(0,i.jsxs)("div",{className:"StoryQuestion","data-testid":"story_question",children:[(0,i.jsxs)("div",{className:"StoryQuestion__content",children:[this.renderAuthor(),(0,i.jsx)("span",{className:f,title:g,ref:this.questionTextEl,"data-testid":"story_question_text",children:g})]}),(0,i.jsx)("div",{className:"StoryQuestion__controls",children:m&&(0,i.jsx)(o.Button,{"data-testid":"story_question_reply",mode:s.isPublished?"secondary":"primary",size:"s",stretched:!0,onClick:this.openReplyModal,children:(0,u.getLang)("stories_question_reply")})}),e&&(0,i.jsx)(k.MessageBoxModal,{onDestroy:this.closeReplyModal,width:360,children:({onClose:e})=>(0,i.jsxs)(a.ModalBox,{"data-testid":"stories_question_ask_box",children:[(0,i.jsx)(n.ModalHeader,{closeAriaLabel:(0,u.getLang)("global_close"),onClose:e,children:(0,u.getLang)("stories_question_reply_box_title").replace("{name}",(0,p.decodeHTMLEntities)(_.nameDat))}),(0,i.jsx)(c.ModalBody,{insetLevel:2,children:(0,i.jsxs)(d.Flex,{justify:"space-between",align:"start",noWrap:!0,children:[(0,i.jsx)("textarea",{ref:this.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:(0,u.getLang)("stories_question_reply_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:t,"data-testid":"story-question-textarea"}),(0,i.jsx)(l.Image,{srcSet:r,widthSize:52,heightSize:87,alt:"","data-testid":"story-question-image"})]})}),(0,i.jsx)(h.ModalFooter,{actions:this.getReplyModalActions()})]})})]})},this.renderAuthor=()=>{const{id:e,isAnonymous:t,author:s}=this.props.question,r="StoryQuestion__author",o=this.getActions().map((({text:e,onClick:t})=>(0,i.jsx)(_.DropdownActionSheet.Item,{onClick:t,children:e},e)));return(0,i.jsxs)("div",{className:"StoryQuestion__header",children:[t&&(0,i.jsx)("span",{className:r,children:(0,u.getLang)("stories_anon_viewer_name")}),!t&&(0,i.jsx)("a",{"data-testid":"story_question_author",href:s.link,className:r,onClick:()=>window.cur.storyLayer.sendNavigationStatEvents("question_go_to_author",!0,{questionId:e}),children:(0,p.decodeHTMLEntities)(s.name)}),(0,i.jsx)(_.DropdownActionSheet,{mode:"primary",placement:"bottom-end",trigger:"hover",content:o,children:(0,i.jsx)("span",{className:"StoryQuestion__actions",children:(0,i.jsx)(f.Icon20Dropdown,{})})})]})},this.getActions=()=>{const{question:e}=this.props,{isAuthorBan:t}=this.state,s=[{text:(0,u.getLang)("stories_question_delete"),onClick:()=>this.props.removeQuestion(e)}];return e.canBlocked&&(t?s.push({text:(0,u.getLang)("stories_question_author_unban"),onClick:this.unbanAuthor}):s.push({text:(0,u.getLang)("stories_question_author_ban"),onClick:this.banAuthor}),s.push({text:(0,u.getLang)("stories_question_author_report"),onClick:this.showReportForm})),s},this.adjustQuestionTextSize=e=>{if(e.scrollHeight>e.offsetHeight){const t=getComputedStyle(e),s=parseInt(t.fontSize)-.5,i=s+2.5,r=Math.floor(parseInt(t.height)/i);s>10&&(e.setAttribute("style",`font-size: ${s}px; line-height: ${i}px; -webkit-line-clamp: ${r};`),setTimeout((()=>{this.adjustQuestionTextSize(e)}),0))}},this.getReplyModalActions=()=>{const{isReplyButtonLoading:e,replyText:t}=this.state;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Button,{size:"m",mode:"tertiary",onClick:this.closeReplyModal,"data-testid":"story-question-cancel",children:(0,u.getLang)("global_cancel")}),(0,i.jsx)(o.Button,{size:"m",mode:"primary",loading:e,disabled:!(0,m.trim)(t),onClick:this.sendReply,"data-testid":"story-question-save",children:(0,u.getLang)("stories_question_reply_send")})]})},this.openReplyModal=()=>{this.setState({isOpenReplyModal:!0})},this.closeReplyModal=()=>{this.setState({isOpenReplyModal:!1})},this.handleChange=e=>{this.setState({replyText:e.target.value})},this.handleKeyDown=e=>{const{replyText:t}=this.state;(0,m.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==v.KEY.RETURN&&this.sendReply()},this.resetReplyText=()=>{this.setState({replyText:""})},this.sendReply=()=>{const{replyText:e}=this.state,{question:t,showMessage:s}=this.props,{text:i,id:r,ownerId:o,storyOwnerId:a,storyId:n}=t,c=`${e}\n\n🗣 ${(0,m.unclean)(i)}`,d=`story${a}_${n}`,l=b.Ranges.isGroupId(a);this.setState({isReplyButtonLoading:!0}),(0,S.apiMessagesSend)({peer_id:o,...l&&{group_id:b.Ranges.convertOwnerIdToGroupId(a)},entrypoint:"stories_comment",attachment:d,random_id:(0,w.random)(),message:c}).then((()=>{this.closeReplyModal(),this.resetReplyText(),s((0,u.getLang)("stories_answer_sent")),window.cur.storyLayer.sendNavigationStatEvents("question_send_message",!0,{questionId:r})})).catch((e=>{this.closeReplyModal(),this.resetReplyText(),s(e?.error?.error_text||e?.error?.error_msg||(0,u.getLang)("global_error"))})).finally((()=>{this.setState({isReplyButtonLoading:!1})}))},this.banAuthor=()=>{const{question:e,showMessage:t}=this.props,{storyOwnerId:s,storyId:i,id:r,isAnonymous:o}=e;y.storiesService.banQuestionAuthorFx({owner_id:s,story_id:i,question_id:r}).then((()=>{this.setState({isAuthorBan:!0}),t((0,u.getLang)("stories_question_author_blocked"));let e="question_ban_author";o&&(e="question_ban_anonymous_author"),window.cur.storyLayer.sendNavigationStatEvents(e,!0,{questionId:r})})).catch((e=>{t(e?.error?.error_text||e?.error?.error_msg||(0,u.getLang)("global_error"))}))},this.unbanAuthor=()=>{const{question:e,showMessage:t}=this.props,{storyOwnerId:s,storyId:i,id:r}=e;y.storiesService.unbanQuestionAuthorFx({owner_id:s,story_id:i,question_id:r}).then((()=>{this.setState({isAuthorBan:!1}),t((0,u.getLang)("stories_question_author_unblocked"))})).catch((e=>{t(e?.error?.error_text||e?.error?.error_msg||(0,u.getLang)("global_error"))}))},this.showReportForm=()=>{(0,g.showReportForm)("story_question",this.props.question.ownerId,this.props.question.id,(()=>this.props.showMessage((0,u.getLang)("stories_report_sent"))))},this.state={isAuthorBan:e.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isReportButtonLoading:!1,selectReasons:0},this.replyTextareaEl=(0,r.createRef)(),this.questionTextEl=(0,r.createRef)()}}},334977:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(474848),r=s(856771),o=s(351118);function a(e){return e.items.some((e=>e.unread))}const n=({storyPack:e,listName:t,source:s})=>(0,i.jsxs)("a",{href:e.author.href,className:(0,o.classNames)("StoryReply",{"StoryReply--new":a(e)}),onClick:i=>{i.metaKey||i.ctrlKey||((0,r.showStory)(`${e.author.id}/${t}`,{fromEl:i.target,source:s}),i.preventDefault())},role:"button",children:[(0,i.jsx)("div",{className:"StoryReply__avatar",children:(0,i.jsx)("div",{className:"StoryReply__image",style:{backgroundImage:`url(${e.author.photo})`}})}),(0,i.jsx)("div",{className:"StoryReply__caption",children:(0,o.decodeHTMLEntities)(e.author.firstName)})]})},550947:(e,t,s)=>{s.d(t,{default:()=>u});var i=s(474848),r=s(351118),o=s(369296),a=s(540462),n=s(751268),c=s(412888),d=s(194528),l=s(119071),h=s(723723),_=s(235722);const u=({user:e,reactionSet:t})=>{const s=(0,r.decodeHTMLEntities)(e.name),u=(0,a.partConfigEnabled)("avatar_component_refactor_web");let p;return t&&null!=e.reaction_id&&(p=(0,o.getReaction)(t,e.reaction_id)?.imageStoryPreviewURL),(0,i.jsxs)("a",{href:e.url,className:"Viewer",role:"button",children:[u&&(0,i.jsxs)(n.RichAvatar,{src:e.photoUrl,size:40,children:[Boolean(p)&&(0,i.jsx)(n.RichAvatar.Badge,{children:(0,i.jsx)("div",{className:"Viewer__reaction",style:{backgroundImage:`url(${p})`}})}),e.isLiked&&!p&&(0,i.jsx)(n.RichAvatar.Badge,{children:(0,i.jsx)("span",{className:"Viewer__like",children:(0,i.jsx)(_.Icon12Like,{})})})]}),!u&&(0,i.jsxs)("div",{className:(0,r.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":e.isLiked&&!p}),title:s,children:[(0,i.jsx)("img",{className:"Viewer__img",src:e.photoUrl,alt:s}),Boolean(p)&&(0,i.jsx)("div",{className:"Viewer__reaction",style:{backgroundImage:`url(${p})`}})]}),(0,i.jsxs)("div",{className:"Viewer__name",children:[(0,i.jsx)(c.TextClamp,{lines:1,children:s}),e.isVerified&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Spacing,{mode:"vertical",size:8}),(0,i.jsx)(l.VerifiedIcon,{"aria-label":s,className:(0,h.getColorClass)("color_text_link")})]})]})]})}},10746:(e,t,s)=>{s.d(t,{MetaStory:()=>u});var i=s(474848),r=s(296540),o=s(898848),a=s(348453),n=s(351118),c=s(783856),d=s(303800),l=s(700272),h=s(240469),_=s(206129);class u extends r.Component{render(){const{metaStoryInfo:e,list:t,listName:s,source:r}=this.props,{isScrolling:o}=this.state,a=!t||!t.length;return(0,i.jsxs)("div",{className:"MetaStory",children:[(0,i.jsx)("div",{className:"MetaStory__infoWrapper",style:{paddingBottom:"286px"},ref:this.infoRef,children:(0,i.jsx)("div",{className:"MetaStory__info",children:e})}),(0,i.jsx)("div",{className:(0,n.classNames)("MetaStory__pane",o&&"MetaStory__pane--scrolling"),children:(0,i.jsxs)("div",{className:(0,n.classNames)("MetaStory__container",a&&"MetaStory__container--isEmpty"),onScroll:this.onScroll,children:[(0,i.jsxs)("div",{className:"MetaStory__navigation",onMouseDown:this.onClickableAreaMouseDown,onMouseUp:this.onClickableAreaMouseUp,onContextMenu:this.onClickableAreaMouseUp,children:[(0,i.jsx)(c.Overlay,{placement:"left",stretch:!0,className:"MetaStory__navigationArea--back"}),(0,i.jsx)(c.Overlay,{placement:"right",stretch:!0,className:"MetaStory__navigationArea--next"})]}),(0,i.jsxs)("div",{className:"MetaStory__grid",style:{minHeight:"calc(100% - 286px"},children:[t?.map((e=>(0,i.jsx)(h.MetaStoryItemPreview,{block:e,list:t,listName:s,source:r},e.id))),a&&[...Array(9)].map(((e,t)=>(0,i.jsx)(_.MetaStoryItemPreviewSkeleton,{},t))),this.state.isLoading&&(0,i.jsx)(d.Div,{spacing:16,children:(0,i.jsx)(l.Spinner,{})})]})]})})]})}componentWillUnmount(){clearTimeout(this.longTapTimer)}hasMore(){return!!this.props.hasMore&&this.props.hasMore()}constructor(e){super(e),this.infoRef=(0,r.createRef)(),this.onScroll=e=>{const t=e.currentTarget,{scrollTop:s,scrollHeight:i,clientHeight:r}=t;if(i-s-r<500&&this.hasMore()&&!this.state.isLoading&&(this.setState({isLoading:!0}),this.loadMore().finally((()=>this.setState({isLoading:!1})))),this.infoRef.current){const e=Boolean(s),t=e?Math.min(s/286,1):0;this.props.onTopScrolled?.(t>=1),this.props.onScroll(e),this.setState({isScrolling:e}),e?this.props.pause():this.props.play();const i=.6,r=e?Math.max(i-t,0):1;this.infoRef.current.style.opacity=`${r}`}},this.onClickableAreaMouseDown=()=>{this.downTs=(0,o.vkNow)(),this.longTapTimer=setTimeout(this.props.onLongTap,a.LONG_PRESS_DELAY_MS)},this.onClickableAreaMouseUp=e=>{clearTimeout(this.longTapTimer);const t=e.target,s=!((0,o.vkNow)()-this.downTs<a.LONG_PRESS_DELAY_MS);if(t.classList.contains("MetaStory__navigationArea--back")&&!s)return this.props.playPrevStory();s?this.props.isPaused()&&this.props.play(!1,!!this.downTs):this.props.playNextStory()},this.loadMore=()=>this.props.loadMore?this.props.loadMore():Promise.resolve(),this.state={isScrolling:!1,isLoading:!1}}}},407853:(e,t,s)=>{s.d(t,{MetaStoryInfo:()=>a});var i=s(474848),r=s(351118),o=s(724648);const a=({header:e,subheader:t,url:s,urlText:a,icon:n})=>{const c=(0,i.jsxs)(i.Fragment,{children:[!!n&&"string"==typeof n&&(0,i.jsx)(o.Flex,{noWrap:!0,justify:"center",align:"center",className:"MetaStoryInfo__icon",style:{backgroundImage:`url(${n})`}}),!!n&&"object"==typeof n&&(0,i.jsx)(o.Flex,{noWrap:!0,justify:"center",align:"center",className:"MetaStoryInfo__icon MetaStoryInfo__icon--inline",children:n}),(0,i.jsx)("div",{className:"MetaStoryInfo__header",children:(0,r.decodeHTMLEntities)(e)}),t&&(0,i.jsx)("div",{className:"MetaStoryInfo__subheader",children:(0,r.decodeHTMLEntities)(t)}),s&&a&&(0,i.jsx)("div",{className:"MetaStoryInfo__pseudoLink",children:a})]});return s?(0,i.jsx)("a",{href:s,className:"MetaStoryInfo",target:"_blank",children:c}):(0,i.jsx)("div",{className:"MetaStoryInfo",children:c})}},240469:(e,t,s)=>{s.d(t,{MetaStoryItemPreview:()=>p});var i=s(474848),r=s(296540),o=s(351118),a=s(504035),n=s(646938),c=s(540462),d=s(783856),l=s(787744),h=s(751268),_=s(279734),u=s(856771);class p extends r.Component{render(){const{block:e,className:t}=this.props,{isFullImageLoadedMap:s}=this.state;let r=this.getCurrentStory(),a=r.unread,u="",p=r.type===n.StoryType.LIVE;const m=(0,c.partConfigEnabled)("avatar_component_refactor_web");let v;return p?v="negative":a&&(v="accent"),u=s[r.raw_id]||!r.preview_url?r.small_preview:r.preview_url,(0,i.jsx)("span",{className:(0,o.classNames)("MetaStoryItemPreview",p&&"MetaStoryItemPreview--live","MetaStoryItemPreviewLayout",t),onClick:this.onClick,children:e.author&&(0,i.jsxs)("div",{className:"MetaStoryItemPreview__inner",children:[(0,i.jsx)(d.Overlay,{placement:"top-left",Component:l.ImageBase,src:u,noBorder:!0,alt:"",loading:"lazy",widthSize:"100%",heightSize:"100%"}),m&&(0,i.jsx)(h.RichAvatar,{className:"MetaStoryItemPreview__avatar",src:e.author.photo,href:e.author.href,target:"_blank",size:28,children:v&&(0,i.jsx)(h.RichAvatar.Outline,{appearance:v})}),!m&&(0,i.jsx)(_.Link,{href:e.author.href,className:(0,o.classNames)("MetaStoryItemPreview__author",a&&"MetaStoryItemPreview__author--unread"),style:{backgroundImage:`url('${e.author.photo}')`}}),(0,i.jsx)("span",{className:"MetaStoryItemPreview__title",children:(0,o.decodeHTMLEntities)(e.author.name)})]})})}componentDidMount(){this.isMount=!0,this.loadCurrentStoryPreviewIfNeeded()}componentDidUpdate(){this.loadCurrentStoryPreviewIfNeeded()}loadCurrentStoryPreviewIfNeeded(){const e=this.getCurrentStory();if(e.raw_id===this.currentStoryRawId)return;if(this.currentStoryRawId=e.raw_id,this.state.isFullImageLoadedMap[e.raw_id])return;const t=new Image;t.src=e.small_preview,t.onload=()=>this.onImageLoad(e.raw_id)}getCurrentStory(){const{block:e}=this.props;let t=e.items.find((e=>e.unread));return t||(t=e.items[0]),t}constructor(e){super(e),this.isMount=!1,this.currentStoryRawId="",this.onClick=e=>{const{source:t}=this.props;(0,u.showStory)(`${(0,a.getStoryBlockKey)(this.props.block)}/${this.props.listName}`,{fromEl:e.target,source:t},this.props.list)},this.onImageLoad=e=>{const{isFullImageLoadedMap:t}=this.state;this.isMount&&(t[e]||this.setState({isFullImageLoadedMap:{...t,[e]:!0}}))},this.state={isFullImageLoadedMap:{}}}}},206129:(e,t,s)=>{s.d(t,{MetaStoryItemPreviewSkeleton:()=>r});var i=s(474848);const r=()=>(0,i.jsx)("div",{className:"MetaStoryItemPreviewSkeleton MetaStoryItemPreviewLayout",children:(0,i.jsxs)("div",{className:"MetaStoryItemPreviewSkeleton__inner",children:[(0,i.jsx)("div",{className:"MetaStoryItemPreviewSkeleton__author"}),(0,i.jsx)("div",{className:"MetaStoryItemPreviewSkeleton__title"})]})})},103872:(e,t,s)=>{s.d(t,{ReactionsPanel:()=>a});var i=s(474848),r=s(351118),o=s(791233);const a=({className:e,stickers:t,onStickerClick:s,title:a})=>{const n=e=>{o.StickersAnimation.loadAndPlaySticker(e.currentTarget)};return(0,i.jsx)("div",{className:(0,r.classNames)("ReactionsPanel",e),children:(0,i.jsxs)("div",{className:"ReactionsPanel__container",children:[Boolean(a)&&(0,i.jsx)("div",{className:"ReactionsPanel__title",children:a}),(0,i.jsx)("div",{className:"ReactionsPanel__items",children:t.map(((e,t)=>((e,t)=>{const o=e.animationUrl?"sticker_img":"";return(0,i.jsx)("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,"data-animation-class":"ReactionsPanel__itemAnimation",onMouseDown:()=>s(e.id,t),onMouseEnter:n,children:(0,i.jsx)("div",{className:(0,r.classNames)("ReactionsPanel__itemImage",o),style:{backgroundImage:`url(${e.imageUrl})`}})},e.id)})(e,t)))})]})})}},820926:(e,t,s)=>{s.d(t,{StickerItem:()=>P});var i=s(474848),r=s(296540),o=s(40176),a=s(646938),n=s(786858),c=s(351118),d=s(866467),l=s(417360),h=s(319756),_=s(856771),u=s(983567),p=s(458840),m=s(183900),v=s(716129),g=s(667147),f=s(759170),y=s(423015),S=s(392358),w=s(270959),b=s(620846),k=s(469004),E=s(18967),C=s(468073),I=s(361121),T=s(876409),L=s(805102),M=s(30259),A=s(539140),x=s(873900);class P extends r.Component{constructor(e){super(e),this.myMusicService=(0,T.ensureMyMusicService)(),this.componentDidMount=()=>{const{sticker:e,story:t}=this.props;if(e.audioRestriction&&t.data.needMute&&t instanceof n.VideoStory&&t.mute(),this.playlist.on(this,S.events.ADDED,(()=>{this.props.showMessage((0,d.getLang)("stories_audio_added")),this.props.playStory()})),this.playlist.on(this,S.events.REMOVED,(()=>{this.props.showMessage((0,d.getLang)("stories_audio_deleted")),this.props.playStory()})),e.type===a.StickerTypes.marketItem&&(0,E.logViewMarketItemInStories)(e.link),e.type===a.StickerTypes.playlist&&e.audioPlaylist){(0,h.ensureDIRootWebContainer)().resolve(l.MusicPlaylistProvider).provideFromAPI(e.audioPlaylist,{ref:null})}this.myMusicService.$identitiesMap.watch((e=>{this.myMusicIdentitiesMap=e}))},this.componentWillUnmount=()=>{this.playlist.off(this)},this.render=()=>{const{story:e,sticker:t,originalWidth:s,originalHeight:o,widthViewBox:n,heightViewBox:d}=this.props,{needMute:l}=e.data,{audioRestriction:h}=t,_=(0,b.swapObject)(a.StickerTypes),u=k.ls.get("story_show_clickable_zones"),p=(0,c.classNames)("StorySticker",{"StorySticker--clickableZones":u}),m=e=>this.props.onMouseUpHandle(e,(()=>this.handleClick(e))),v=(0,A.getStickerStyle)({sticker:t,originalWidth:s,originalHeight:o,widthViewBox:n,heightViewBox:d});return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsx)("div",{ref:this.stickerRef,"data-type":_[t.type],className:p,style:v,onMouseDown:e=>this.props.onMouseDownHandle(e),onMouseUp:m,onContextMenu:m}),h&&l&&this.renderRestriction()]})},this.renderRestriction=()=>{const{audioRestriction:e}=this.props.sticker;return e?(0,i.jsx)("div",{className:"StoryRestriction",children:(0,i.jsxs)("div",{className:"StoryRestriction__inner",children:[(0,i.jsx)("span",{className:"StoryRestriction__title",children:e.title}),e.buttonUrl&&(0,i.jsx)("a",{className:"StoryRestriction__link",href:e.buttonUrl,children:e.buttonText})]})}):null},this.getStickerStyle=()=>{const{sticker:e,originalWidth:t,originalHeight:s,widthViewBox:i,heightViewBox:r}=this.props,{top:o,left:a,width:n,height:c,rotate:d}=e;let l=i,h=r;return r/i>1.77?l=t*r/s:h=s*i/t,{top:o*h-(h-r)/2,left:a*l-(l-i)/2,width:n*l,height:c*h,transform:`rotate(${d}deg)`}},this.handleClick=e=>{const{sticker:t}=this.props;switch(t.type){case a.StickerTypes.hashtag:this.handleClickHashtag(e);break;case a.StickerTypes.mention:this.handleClickMention(e);break;case a.StickerTypes.question:this.handleClickQuestion();break;case a.StickerTypes.place:this.handleClickPlace(e);break;case a.StickerTypes.music:this.handleClickMusic(e);break;case a.StickerTypes.marketItem:this.handleClickMarketItem(e);break;case a.StickerTypes.storyReply:this.handleClickStoryReply(e);break;case a.StickerTypes.owner:this.handleClickOwner(e);break;case a.StickerTypes.link:this.handleClickLink(e);break;case a.StickerTypes.photo:this.handleClickPhoto(e);break;case a.StickerTypes.post:this.handleClickPost(e);break;case a.StickerTypes.poll:this.handleClickPoll();break;case a.StickerTypes.service_yc_item:this.handleClickServiceYc(e);break;case a.StickerTypes.sticker:this.handleClickSticker(e);break;case a.StickerTypes.situationalTheme:this.handleClickStickerSituationalTheme();break;case a.StickerTypes.playlist:this.handleClickPlaylist(e);break;case a.StickerTypes.videoButton:this.handleClickVideo(e)}},this.handleClickHashtag=e=>{const{hashtag:t}=this.props.sticker,s=(0,d.getLang)("stories_show_hashtag_link"),r="hashtag",o=(0,i.jsx)("a",{href:`/feed?q=${encodeURIComponent(t)}&section=search`,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,o),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickMention=e=>{const{mentionedOwnerHref:t,mentionedText:s,mentionedPhotoUrl:r}=this.props.sticker,o="mention",a=(0,i.jsx)("a",{href:t,onClick:()=>this.onClickToTooltip(o),target:"_blank",className:"StoriesTooltip__link StoriesTooltip__link--mention",children:(0,i.jsxs)("div",{className:"StoriesTooltipMention",children:[(0,i.jsx)("div",{className:"StoriesTooltipMention__avatar",style:{backgroundImage:`url(${r})`}}),(0,i.jsx)("span",{className:"StoriesTooltipMention__text",children:(0,c.decodeHTMLEntities)(s)})]})});this.props.toggleTooltip(e,a),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:o}})},this.handleClickQuestion=()=>{this.props.showQuestionModal(),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"question"}})},this.handleClickPlace=e=>{const{sticker:t,list:s}=this.props,{placeId:r}=t,o=(0,d.getLang)("stories_go_to_place"),a="place";if(window.layerQueue.count()||s.includes("archive")){const t="/feed?section=search&w=place"+r,s=(0,i.jsx)("a",{href:`${t}`,onClick:()=>this.onClickToTooltip(a),target:"_blank",className:"StoriesTooltip__link",children:o});this.props.toggleTooltip(e,s)}else{const t=()=>{this.onClickToTooltip(a),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),(0,p.showWiki)({w:"place"+r})},s=(0,i.jsx)("div",{className:"StoriesTooltip__link",onClick:t,children:o});this.props.toggleTooltip(e,s)}this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:a}})},this.handleClickMusic=e=>{const{story:t,sticker:s}=this.props,{needMute:r}=t.data,{audioId:o,audioData:a,audioRestriction:n}=s;if(n)return void(r||(0,m.showAudioRestriction)(JSON.parse(a),{onShow:()=>{this.props.pauseStory()},onHide:()=>{this.props.playStory()}}));const c=o in this.myMusicIdentitiesMap?(0,d.getLang)("stories_audio_delete"):(0,d.getLang)("stories_audio_add"),l=(0,i.jsxs)("ul",{className:"StoriesTooltipActions _audio_row","data-audio":a,children:[(0,i.jsx)("li",{className:"StoriesTooltipActions__item","data-testid":"stories-viewer-audio-add-to-my",onClick:this.addAudio,children:c}),(0,i.jsx)("li",{className:"StoriesTooltipActions__item","data-testid":"stories-viewer-audio-set-next",onClick:this.setNext,children:(0,d.getLang)("stories_audio_next_audio")})]});this.props.toggleTooltip(e,l,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:s.id,type:"music"}})},this.handleClickPlaylist=e=>{const{playlistOwnerId:t,playlistId:s,playlistCreatorId:r,playlistFollowed:o}=this.props.sticker,a=window.vk.id===r,n=`${t}_${s}`,c=(0,v.getPlaylistAddRestoreInfo)()[n]||{},l=c.state?"followed"===c.state:o,h=l?(0,d.getLang)("stories_playlist_unfollow"):(0,d.getLang)("stories_playlist_follow"),_=l?this.unfollowPlaylist:this.followPlaylist,u=(0,i.jsxs)("ul",{className:"StoriesTooltipActions",children:[!a&&(0,i.jsx)("li",{className:"StoriesTooltipActions__item",onClick:_,children:h}),(0,i.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.setNextPlaylist,children:(0,d.getLang)("stories_playlist_next")})]});this.props.toggleTooltip(e,u,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.handleClickMarketItem=e=>{const{photoUrl:t,link:s,isRestricted:r,seoSlug:a}=this.props.sticker,n="market_item",c=new URL(`${document.location.origin}${s}`).searchParams,l=c.get("w")?"&ref=stories":"",h=c.get("w")?"&refScreen=stories":"",{ownerId:_,itemId:u}=(0,I.splitRawId)(c.get("w")?.replace("product","")??"");let p=`${s}${l}${h}`;_&&u&&(p=(0,L.constructProductLink)({itemId:u,seoSlug:a,ownerId:_,refSource:M.RefSource.STORIES,ref:"stories"}));const m=r?{onClick:()=>{(0,w.showFastBox)((0,d.getLang)("stories_market_access_error_title"),(0,d.getLang)("stories_market_access_error_text")),this.onClickToTooltip(n)}}:{onClick:()=>this.onClickToTooltip(n),href:p},v=(0,i.jsxs)("a",{...m,target:"_blank",className:"StoriesTooltip__link",children:[t&&!r?(0,i.jsx)("img",{className:"StoriesTooltip__marketItemThumb",src:t,alt:""}):(0,i.jsx)("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub",children:(0,i.jsx)(o.Icon20MarketOutline,{})}),(0,i.jsx)("span",{className:"StoriesTooltip__marketItemText",children:(0,d.getLang)("stories_go_to_market_item")})]});this.props.toggleTooltip(e,v),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:n}})},this.handleClickStoryReply=e=>{const{sticker:t}=this.props,{ownerId:s,storyId:r,isExpired:o}=t,a="story_reply";if(o)return void this.handleClickOwner(e);const n=(0,i.jsx)("a",{className:"StoriesTooltip__link",onClick:()=>{const e=`${s}_${r}`;(0,_.showStory)(`story${e}/${e}/context:owner`),this.onClickToTooltip(a)},children:(0,d.getLang)("stories_go_to_story")});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:a}})},this.handleClickOwner=e=>{const{ownerId:t,link:s}=this.props.sticker,r=C.Ranges.isUserIdTransitional(t)?(0,d.getLang)("stories_go_to_profile"):(0,d.getLang)("stories_go_to_group"),o=(0,i.jsx)("a",{href:s,target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,o)},this.handleClickLink=e=>{const{link:t,tooltipText:s}=this.props.sticker,r="link",o=(0,i.jsx)("a",{href:t,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,o),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickPhoto=e=>{const{photoId:t,photoOwnerId:s}=this.props.sticker,r=(0,d.getLang)("stories_go_to_photo"),o="photo",a=(0,i.jsx)("a",{href:`/photo${(0,x.getIdentityRawId)({id:t,ownerId:s})}`,onClick:()=>this.onClickToTooltip(o),target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,a),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:o}})},this.handleClickPost=e=>{const{postOwnerId:t,postId:s}=this.props.sticker,r=(0,d.getLang)("stories_go_to_post"),o="post",a=(0,i.jsx)("a",{href:`/wall${t}_${s}`,onClick:()=>this.onClickToTooltip(o),target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,a),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:o}})},this.handleClickPoll=()=>{const{pollId:e}=this.props.sticker;this.props.pauseStory();let t={act:"get_layout",voting_id:e,ref:"story",for_box:!0},s={containerClass:"story_poll",params:{hideButtons:!0,width:510,onDestroy:()=>{this.props.playStory()}}};(0,w.showBox)("al_voting.php",t,s),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"poll"}})},this.handleClickStickerSituationalTheme=()=>{const{situationalAppId:e,situationalThemeId:t}=this.props.sticker;window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),this.props.pauseStory(),(0,p.showWiki)({w:`app${e}#${t}`}),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"situational_theme"}})},this.addAudio=e=>{const t=e.target;(0,f.toggleAddAudio)(t,null,(()=>{this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})})),this.props.hideTooltip()},this.followPlaylist=async e=>{const{playlistOwnerId:t,playlistId:s}=this.props.sticker,i=`${t}_${s}`;(0,v.getPlaylistAddRestoreInfo)()[i]={state:"followed"},this.props.playStory(),this.props.hideTooltip(),this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}});try{await(0,g.followPlaylist)(e.target,t,s),this.props.showMessage((0,d.getLang)("stories_follow_playlist_done"))}catch(e){this.props.showMessage((0,d.getLang)("stories_follow_playlist_error"))}},this.unfollowPlaylist=async e=>{const{playlistOwnerId:t,playlistId:s}=this.props.sticker,i=`${t}_${s}`;(0,v.getPlaylistAddRestoreInfo)()[i]={state:"unfollowed"},this.props.playStory(),this.props.hideTooltip();try{await(0,g.followPlaylist)(e.target,t,s),this.props.showMessage((0,d.getLang)("stories_unfollow_playlist_done"))}catch(e){this.props.showMessage((0,d.getLang)("stories_unfollow_playlist_error"))}},this.handleClickSticker=e=>{const{stickerPackId:t,tooltipText:s}=this.props.sticker,r=(0,i.jsx)("span",{onClick:this.onClickToStickerTooltip.bind(this,t),className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,r),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"sticker"}})},this.onClickToStickerTooltip=(e,t)=>{window.Emoji.previewSticker(e,this,!1,t),this.onClickToTooltip("sticker")},this.setNext=e=>{const t=JSON.parse(this.props.sticker.audioData||"{}"),s=(0,y.audioTupleToAudioObject)(t);this.playlist.setNext(e.currentTarget.parentNode,s,t),this.props.story.data.isMusicCover||this.playlist.pause(),this.props.hideTooltip(),this.props.playStory(),this.props.sendNavigationStatEvents("play_next",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})},this.setNextPlaylist=()=>{const{playlistOwnerId:e,playlistId:t,playlistAccessHash:s}=this.props.sticker;this.playlist.setNextPlaylist(e,t,s),!this.props.story.data.isMusicCover&&this.playlist._currentAudio&&this.playlist.pause(),this.props.hideTooltip(),this.props.playStory(),this.props.sendNavigationStatEvents("play_next",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.onClickToTooltip=(e,t={})=>{this.props.sendNavigationStatEvents("click_to_tooltip",!0,{clickable_sticker:{id:this.props.sticker.id,type:e,...t}})},this.handleClickVideo=e=>{const{videoOwnerId:t,videoId:s,videoType:r,tooltipText:o}=this.props.sticker,a=`/${r}${t}_${s}`,n="video"===r?"vk_video":r,c=(0,i.jsx)("a",{href:a,onClick:()=>this.onClickToTooltip(n),target:"_blank",className:"StoriesTooltip__link",children:o});this.props.toggleTooltip(e,c),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:n}})},this.handleClickServiceYc=e=>{const t="service_yc_item",{link:s,tooltipText:r,stickerStyle:o}=this.props.sticker,a=(0,i.jsx)("a",{target:"_blank",href:s,onClick:()=>this.onClickToTooltip(t,{text_value:s,style:o}),className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,a,"t",!1),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:t,text_value:s,style:o}})},this.stickerRef=(0,r.createRef)(),this.playlist=(0,u.getAudioPlayer)()}}},47172:(e,t,s)=>{s.d(t,{StickerTooltip:()=>n});var i=s(474848),r=s(296540),o=s(351118),a=s(440961);const n=({clientX:e=0,clientY:t=0,position:s="t",layerEl:n,children:c})=>{const d=(0,o.classNames)("StoriesTooltip",`StoriesTooltip--${s}`);return(0,i.jsx)(r.Fragment,{children:a.createPortal((0,i.jsx)("div",{className:d,style:{top:t,left:e},children:c}),n)})}},938130:(e,t,s)=>{s.d(t,{StoryBottom:()=>B});var i=s(474848),r=s(983567),o=s(646938),a=s(296540),n=s(724648),c=s(783856),d=s(578392),l=s(916130),h=s(103872),_=s(348453),u=s(261347),p=s(992826),m=s(749284),v=s(856771),g=s(754866),f=s(972332),y=s(866467),S=s(478752),w=s(298077),b=s(351118),k=s(356037),E=s(677251),C=s(619379),I=s(592204),T=s(786570),L=s(852621),M=s(638679),A=s(215402),x=s(25917),P=s(573510),R=s(392094),O=s(565703),N=s(34231);class B extends a.Component{componentDidMount(){this.emojiInit(),this.isMount=!0,requestAnimationFrame((()=>{this.startLinkArrowAnimation()}))}componentWillUnmount(){this.isMount=!1,this.isEmojiIdSet()&&(window.Emoji.destroy(this.emojiId),delete this.emojiId)}componentDidUpdate(e,t){const{isMessageFormExpanded:s,isMessageFormFocused:i}=this.state;this.emojiInit(),!t.isMessageFormExpanded&&s?(window.Emoji.focus(this.messageInputRef.current),this.pauseLinkArrowAnimation()):t.isMessageFormExpanded&&!s&&this.startLinkArrowAnimation(),t.isMessageFormFocused!==i&&this.setState({isMessageFormFocusAnimating:!0})}render(){const{story:e}=this.props,t=this.props.story.getCurStoryData(),{isMessageFormExpanded:s}=this.state;if(!e.story||!t)return"";const{isFeedbackTooltipShow:r,toggleFeedbackTooltip:a,onFetchFeedbackData:d,onFetchViewers:h,onQuestionRemove:_,feedback:u,showMoreReplies:p}=e,{small_preview:m,canLike:v,canAddToNarrative:g,reaction_set_id:f,likesCount:y=0}=t,S=e.getRawId(),w=e.showMessage.bind(e),k=e.layer.sendNavigationStatEvents.bind(e.layer),E=e.getSticker(o.StickerTypes.poll);let C;return null!=f&&(C=e.data.reaction_set?.find((e=>e.id===f))),(0,i.jsxs)(n.Flex,{noWrap:!0,className:"StoryBottom",children:[(0,i.jsx)(P.default,{in:!s,classNames:{enter:"StoryBottom__panels--enter",enterActive:"StoryBottom__panels--enterActive",exitActive:"StoryBottom__panels--exitActive",exit:"StoryBottom__panels--exit"},addEndListener:(e,t)=>{e.addEventListener("transitionend",(e=>{e.target===e.currentTarget&&t()}),!1)},unmountOnExit:!0,children:(0,i.jsxs)(n.Flex,{noWrap:!0,className:"StoryBottom__panels",children:[v&&(0,i.jsx)(n.Flex,{noWrap:!0,className:"StoryBottom__floor StoryBottom__floor--2",children:this.renderLike()}),(0,i.jsxs)(n.Flex,{noWrap:!0,justify:"end",className:"StoryBottom__floor StoryBottom__floor--1",children:[(0,i.jsx)(l.ViewsButton,{className:"StoryViewerBottomControl StoryViewerBottomControl--feedback",story:e}),this.renderLink(),this.renderMessageButton(),g&&this.renderAddToNarrativeBtn(),this.renderShare()]})]})}),this.renderMessageForm(),(0,i.jsx)(P.default,{in:r,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0,children:(0,i.jsx)(R.default,{className:"StoryBottom__feedback",feedback:u,pollId:E?.pollId,reactionSet:C,storyRawId:S,likesCount:y,storyImageUrl:m,toggleFeedbackTooltip:a,onFetchFeedbackData:d,onFetchViewers:h,showMessage:w,sendNavigationStatEvents:k,onQuestionRemove:_,showMoreReplies:p})}),!this.isActiveLive()&&(0,i.jsx)(c.Overlay,{className:(0,b.classNames)("StoryBottom__overlay",this.needShowOverlay()&&"StoryBottom__overlay--shown"),onTransitionEnd:this.onOverlayTransitionEnd})]})}needRenderMessageFormAsFocused(){return this.state.isMessageFormFocused||this.state.isMessageFormFocusAnimating}needShowOverlay(){return this.state.isMessageFormFocused}renderLink(){const e=this.props.story,t=this.props.story.getCurStoryData();if(!t){return void(e.isActiveMetaStory()||(0,w.logError)(new Error("Fail: _renderLink"),{environment:"stories"}))}const{linkArrowAnimationStep:s}=this.state,{link:r}=t;if(!(0,S.isObject)(r))return;let o=(0,b.decodeHTMLEntities)(r.url),a="stories_link";if(r.object_type&&(a+=` story_link_object_${r.object_type}`),this.state.linkObjectAudioPlaying&&(a+=" story_link_object_audio_playing"),t.isProfileQuestion){const e=new URL(o);e.searchParams.set("ref","story"),o=e.toString()}return(0,i.jsx)("div",{className:"StoryLinkButton stories_link_wrap StoryViewerBottomControl StoryViewerButton StoryViewerButton--wide StoryViewerButton--dark StoryViewerButton--link",onMouseEnter:this.pauseLinkArrowAnimation,onMouseLeave:this.onLinkArrowMouseLeave,children:(0,i.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",className:a,href:(0,N.wrapAwayIfExternal)(o,!0),title:r.text,onClick:e=>{this.linkDidPress(e,r)},onTransitionEnd:this.onLinkArrowTransitionEnd,"data-testid":"story_link_button",children:[(0,i.jsx)("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:r.text}}),!this.state.linkObjectAudioPlaying&&(0,i.jsx)(k.Icon16ChevronOutline,{className:(0,b.classNames)("StoryLinkButton__icon",1===s&&"StoryLinkButton__icon--right")})]})})}renderShare(){const{story:e}=this.props,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,w.logError)(new Error("Fail: _renderShare"),{environment:"stories"}),""}const{can_share:s}=t;return s?(0,i.jsx)(d.TextTooltip,{text:(0,y.getLang)("stories_share"),placement:"top",hoverDelay:100,children:(0,i.jsx)("div",{className:"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl",onClick:this._shareButtonDidPress.bind(this),"data-testid":"story_share_button",children:(0,i.jsx)(E.Icon24ShareOutline,{className:"StoryViewerButton__icon"})})}):""}renderAddToNarrativeBtn(){const e=this.props.story,t=this.props.story.getCurStoryData(),s=this.props.story.getCurrentNarrative();if(!t){return e.isActiveMetaStory()||(0,w.logError)(new Error("Fail: renderAddToNarrativeBtn"),{environment:"stories"}),null}return s?null:(0,i.jsx)(d.TextTooltip,{text:(0,y.getLang)("stories_add_to_narrative"),placement:"top",hoverDelay:100,children:(0,i.jsxs)("div",{className:"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl",onClick:this.addToNarrativePress,ref:this.addToNarrativeRef,"data-testid":t.isPartOfNarrative?"story_part_of_narrative":"story_add_to_narrative",children:[t.isPartOfNarrative&&(0,i.jsx)(C.Icon24NarrativeActiveOutline,{className:"StoryViewerButton__icon"}),!t.isPartOfNarrative&&(0,i.jsx)(I.Icon24NarrativeOutline,{className:"StoryViewerButton__icon"})]})})}renderLike(){const e=this.props.story,t=this.props.story.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,w.logError)(new Error("Fail: _renderLike"),{environment:"stories"}),""}const{isLiked:s}=t,{isMessageFormExpanded:r,needAnimateLikeButton:o,isStickerPanelShow:a}=this.state,n=!(a||this._canMessage()&&r);return(0,i.jsx)(P.default,{in:n,timeout:200,classNames:{enter:"StoryButtonLike--enter",enterActive:"StoryButtonLike--enterActive",exitActive:"StoryButtonLike--exitActive",exit:"StoryButtonLike--exit"},unmountOnExit:!0,children:(0,i.jsx)(d.TextTooltip,{text:(0,y.getLang)("stories_like"),placement:"top",hoverDelay:180,children:(0,i.jsxs)("div",{className:(0,b.classNames)("StoryButtonLike StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl",s&&"StoryButtonLike--liked",o&&"StoryButtonLike--animation","StoryViewerButton--big"),onClick:this._likeButtonDidPress.bind(this),onAnimationEnd:this.onLikeAnimationEnd,"data-testid":"story_like_button",children:[s&&(0,i.jsx)(T.Icon28Like,{className:"StoryButtonLike__icon"}),!s&&(0,i.jsx)(L.Icon28LikeOutline,{className:"StoryButtonLike__icon"})]})})})}_canMessage(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,w.logError)(new Error("Fail: _canMessage"),{environment:"stories"}),!1}const{can_comment:s}=t;return s&&!e.isLiveEnded()}hasLink(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,w.logError)(new Error("Fail: hasLink"),{environment:"stories"}),!1}return(0,S.isObject)(t.link)}renderMessageButton(){if(this._canMessage())return this.hasLink()?(0,i.jsx)(d.TextTooltip,{text:(0,y.getLang)("stories_write_message"),placement:"top",children:(0,i.jsx)("button",{className:"StoryViewerBottomControl StoryViewerButton StoryViewerButton--dark StoryViewerButton--round",onClick:this.onMessageButtonClick,"data-testid":"story_message_link_button",children:(0,i.jsx)("div",{className:"StoryViewerButton__icon",children:(0,i.jsx)(M.Icon24MessageOutline,{})})})}):(0,i.jsx)("button",{className:"StoryViewerBottomControl StoryViewerButton StoryViewerButton--message StoryViewerButton--wide StoryViewerButton--dark",onClick:this.onMessageButtonClick,"data-testid":"story_message_button",children:(0,i.jsx)("span",{className:"StoryViewerButton__text",children:(0,y.getLang)("stories_answer_placeholder")})})}renderMessageForm(){const{isMessageFormFocused:e,isMessageFormExpanded:t,panelStickers:s}=this.state,r=this.needRenderMessageFormAsFocused();if(!this._canMessage())return;let o=(0,i.jsx)("div",{className:(0,b.classNames)("StorySendForm stories_send_form _emoji_field_wrap emoji_rpointer",e&&"StorySendForm--focus",t&&"StorySendForm--expanded"),ref:this.sendFormElementRef,"data-testid":"story_send_form",children:(0,i.jsxs)("div",{className:"StorySendForm__wrapper",children:[(0,i.jsx)("div",{className:"StorySendForm__background"}),(0,i.jsxs)("div",{className:"StorySendForm__in",children:[(0,i.jsx)("div",{className:"stories_send_form_text_wrap",children:(0,i.jsx)("div",{contentEditable:!0,ref:this.messageInputRef,className:"stories_send_form_text",placeholder:(0,y.getLang)("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this)})}),(0,i.jsx)("div",{className:"stories_send_form_helper",ref:this.smileWrapperRef,onMouseDown:this.onSendFormButtonsMouseDown,children:(0,i.jsxs)("div",{className:(0,b.classNames)("stories_send_form_buttons _emoji_wrap",(this.state.isMessageFormFocused||this.state.messageFormHasText)&&"shown"),children:[(0,i.jsx)("div",{"data-testid":"story-bottom-emoji-smile",ref:this.smileButtonRef,className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:e=>{window.Emoji.clearSizeCached(this.smileButtonRef.current),window.Emoji.show(this.smileButtonRef.current,e.nativeEvent)},onMouseLeave:e=>window.Emoji.hide(this.smileButtonRef.current,e.nativeEvent),onMouseDown:e=>(0,f.cancelEvent)(e.nativeEvent),children:(0,i.jsx)(A.Icon24SmileOutline,{})}),(0,i.jsx)("div",{className:(0,b.classNames)("stories_send_form_button send",this.state.messageFormHasText&&"active"),onClick:this._onSendMessageButtonCLick.bind(this),"data-testid":"story_message_send",children:(0,i.jsx)(x.Icon24Send,{})})]})})]})]})});const a=(0,y.getLang)("stories_fast_answer"),n=(0,i.jsx)(P.default,{in:this.state.isStickerPanelShow&&s.length>0,timeout:200,classNames:{enter:"StoryBottom__stickerPanel--enter",enterActive:"StoryBottom__stickerPanel--enterActive",exitActive:"StoryBottom__stickerPanel--exitActive",exit:"StoryBottom__stickerPanel--exit"},unmountOnExit:!0,children:(0,i.jsx)(h.ReactionsPanel,{className:"StoryBottom__stickerPanel",stickers:s,title:a,onStickerClick:this.onPanelStickerClick})});return(0,i.jsx)(P.default,{in:t,classNames:{enter:"StoryBottom__messageForm--enter",enterActive:"StoryBottom__messageForm--enterActive",exitActive:"StoryBottom__messageForm--exitActive",exit:"StoryBottom__messageForm--exit"},onExited:this.onSendFormExited,addEndListener:(e,t)=>{e.addEventListener("transitionend",(e=>{e.target===e.currentTarget&&t()}),!1)},unmountOnExit:!0,children:(0,i.jsxs)("div",{className:(0,b.classNames)("StoryBottom__messageForm",r&&"StoryBottom__messageForm--focused"),children:[n,o]})})}isActiveLive(){return this.props.story.isActiveLive()}isStickerPanelAvailable(){return!this.isActiveLive()}onChangeStickerPanelVisibility(e=!1){this.isStickerPanelAvailable()&&this.setState({isStickerPanelShow:e})}isEmojiIdSet(){return"number"==typeof this.emojiId}_checkLoadedStickers(){return this.getPanelStickers().length>=_.EMOJI_REACTIONS_ARR.length}_sendFormDidFocus(){const{story:e}=this.props;this.setState({isMessageFormFocused:!0}),this.isStickerPanelAvailable()&&this._checkReactionsPanel(),e.onSendFormFocus(),e.layer.sendNavigationStatEvents("comment_tap")}_sendFormDidBlur(){this.props.story.onSendFormBlur(),this.setState({isMessageFormFocused:!1}),this.isStickerPanelAvailable()&&this._hideReactionPanel(),!this.getMessageText()&&this._canMessage()&&this.toggleMessageForm(!1),this._emojiDidKeyAction()}_emojiDidKeyAction(){const e=this.getMessageText();this.setState({messageFormHasText:e.length>0}),this.messageInputRef.current?.check()}getMessageText(){return(0,S.trim)(window.Emoji.editableVal(this.messageInputRef.current))}_hideReactionPanel(){this.onChangeStickerPanelVisibility(!1)}_showReactionPanel(){this.onChangeStickerPanelVisibility(!0)}_checkReactionsPanel(){if(!this.isStickerPanelAvailable())return;this.props.story.getSendText().length?this._hideReactionPanel():this._showReactionPanel()}_shareButtonDidPress(){this.props.story.shareBox()}_likeButtonDidPress(){this.setState({needAnimateLikeButton:!0}),this.props.story.toggleLikeStory()}updatePanelStickers(){this.isMount&&(this.setState({panelStickers:this.getPanelStickers()}),this.preloadStickerImages())}preloadStickers(e){const t=(0,S.isRetina)()?"256b":"128b";window.Emoji.emojiPreloadMore({sizes:{[t]:!0}},e)}preloadStickerImages(){const{panelStickers:e}=this.state;e.forEach((e=>{(new Image).src=e.imageUrl}))}getPanelStickers(){const e=[];if(window.stickersKeywords&&window.Emoji.stickersById){const t=window.Emoji.stickersById,s=(0,S.isRetina)()?"256b":"128b",i={};_.EMOJI_REACTIONS_ARR.forEach((r=>{const o=window.stickersKeywords[(0,u.emojiRemoveSkinToneModifiers)(window.Emoji.codeToChr(r.code))],a=o&&window.Emoji.sortStickersHints(o);let n={};a&&a.every((e=>!(e>0&&t[e]&&t[e].sticker&&!i[e])||(n=t[e].sticker,!1))),n[6]&&n[6][s]&&(e.push({id:n[0],packId:0,uniqId:(0,S.irand)(0,1e5),imageUrl:n[6][s],animationUrl:n[3]}),i[n[0]]=!0)}))}return e}_hideStickerHints(){const e=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(this.messageInputRef.current));e&&"number"==typeof this.emojiId&&window.Emoji.stickersHintsHide(e,window.Emoji.opts[this.emojiId],100)}_onSendMessageButtonCLick(){this._sendMessage()}_sendMessage(e=[],t={},s={}){const i=e.length;this._hideStickerHints(),this.props.story.onAnswerSend((()=>{this._emojiDidKeyAction(),i&&this.updatePanelStickers(),this._canMessage()&&this.state.isMessageFormExpanded&&this.toggleMessageForm(!1)}),e,t,s)}constructor(e){super(e),this.isMount=!1,this.onOverlayTransitionEnd=e=>{e.target===e.currentTarget&&this.state.isMessageFormFocusAnimating&&this.setState({isMessageFormFocusAnimating:!1})},this.onMessageButtonClick=()=>{this.toggleMessageForm(!0)},this.onSendFormButtonsMouseDown=e=>{this._canMessage()&&!this.getMessageText()&&e.preventDefault()},this.onPanelStickerClick=(e,t)=>{this._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:_.EMOJI_REACTIONS_ARR[t].name})},this.emojiInit=()=>{if(!this.isEmojiIdSet()&&this.messageInputRef.current){const e=this.isStickerPanelAvailable();if(this.emojiId=window.Emoji.init(this.messageInputRef.current,{ttDiff:29,ref:"stories",ttWrap:this.smileWrapperRef.current,checkEditable:()=>{this.props.story.isActiveLive()&&p.VideoChat.checkTextLen(this.messageInputRef.current)},noStickers:!e,noStickersStore:!e,onSend:()=>this._sendMessage(),onStickerSend:(e,t,s)=>{this._sendMessage([["sticker",e,s]],{sticker_referrer:t}),this._canMessage()&&this.state.isMessageFormExpanded&&this.toggleMessageForm(!1)},forceUp:!0,controlsCont:this.sendFormElementRef.current,onKeyAction:()=>this._emojiDidKeyAction(),onEmojiAdded:()=>this._emojiDidKeyAction(),onStoreHide:()=>{this.updatePanelStickers(),this.props.story.autoResumeStory()}}),(0,f.addEvent)(this.smileButtonRef.current,"click",f.cancelEvent),(0,m.placeholderInit)(this.messageInputRef.current,{editable:!0}),this._checkLoadedStickers())this.preloadStickerImages();else{const e=(0,S.isRetina)()?"256b":"128b";window.Emoji.emojiLoadMore(this.emojiId,{sizes:{[e]:!0}},(()=>{this.updatePanelStickers()}))}this._canMessage()&&window.Emoji&&!window.stickersKeywords&&(window.Emoji.onStickersLoad=()=>{this.updatePanelStickers()},window.Emoji.updateTabs(void 0,void 0,void 0))}else this.isEmojiIdSet()&&!this.messageInputRef.current&&this.destroyEmoji();this._canMessage()&&!this._checkLoadedStickers()&&this.preloadStickers((()=>{this.updatePanelStickers()}))},this.onSendFormExited=()=>{this.destroyEmoji()},this.destroyEmoji=()=>{(0,f.removeEvent)(this.smileButtonRef.current,"click",f.cancelEvent),this.isEmojiIdSet()&&(window.Emoji.destroy(this.emojiId),delete this.emojiId)},this.toggleMessageForm=(e=!0)=>{this.state.isMessageFormExpanded!==e&&((0,O.isNewStickerPicker)()&&!e&&window.StickerPickerViewer?.destroy(),this.setState({isMessageFormExpanded:e}))},this.addToNarrativePress=()=>{this.props.story.onAddToNarrativeBtnClick()},this.onLikeAnimationEnd=()=>{this.setState({needAnimateLikeButton:!1})},this.linkDidPress=(e,t)=>{if(!t)return;const{story:s}=this.props,i=t.object_type,o=t.object,a=t.url.match(/\/narrative(-?\d+)_(\d+)/);if(a){e.preventDefault();const[,t,i]=a;t&&i&&(s.pauseStory(),(0,v.showNarrative)(t,i,0,"",{fromEl:s.wrapEl,source:"narrative_story"}))}else s.layer.sendNavigationStatEvents("link_click"),s.sendStoryLinkViewStatEvent();if("audio"===i)this.state.linkObjectAudioPlaying?((0,r.getAudioPlayer)().pause(),this.setState({story:{...this.state.story,audioPlaying:!1}}),window.cur.storyLayer.resumeLayer()):((0,r.getAudioPlayer)().playAudio(o),this.setState({story:{...this.state.story,audioPlaying:!0}}),window.cur.storyLayer.pauseLayer()),this.setState({linkObjectAudioPlaying:!this.state.linkObjectAudioPlaying}),e.preventDefault()},this.startLinkArrowAnimation=()=>{this.isMount&&this.setState({linkArrowAnimationStep:1})},this.pauseLinkArrowAnimation=()=>{this.setState({linkArrowAnimationStep:2})},this.onLinkArrowTransitionEnd=()=>{const{linkArrowAnimationStep:e}=this.state;1!==e?0!==e||this.setState({linkArrowAnimationStep:1}):this.setState({linkArrowAnimationStep:0})},this.onLinkArrowMouseLeave=()=>{const{isMessageFormExpanded:e}=this.state;e||this.startLinkArrowAnimation()},this.emojiId=!1,this.sendFormElementRef=(0,a.createRef)(),this.messageInputRef=(0,a.createRef)(),this.smileWrapperRef=(0,a.createRef)(),this.smileButtonRef=(0,a.createRef)(),this.state={story:e.story,messageFormHasText:!1,isMessageFormFocused:!1,linkObjectAudioPlaying:!1,isStickerPanelShow:!1,panelStickers:this.getPanelStickers(),isMessageFormExpanded:!1,needAnimateLikeButton:!1,linkArrowAnimationStep:0},this.addToNarrativeRef=(0,a.createRef)()}}},357794:(e,t,s)=>{s.d(t,{StoryStickers:()=>I});var i=s(474848),r=s(646938),o=s(296540),a=s(694244),n=s(782174),c=s(63614),d=s(578392),l=s(373080),h=s(507852),_=s(908242),u=s(454154),p=s(820926),m=s(47172),v=s(348453),g=s(754866),f=s(866467),y=s(478752),S=s(351118),w=s(972332),b=s(468073),k=s(41903),E=s(818874),C=s(211413);class I extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{window.addEventListener("resize",this.handleResize)},this.componentWillUnmount=()=>{window.removeEventListener("resize",this.handleResize)},this.componentDidUpdate=()=>{this.askTextarea.current&&this.askTextarea.current.focus()},this.onDisableAreaMouseDown=e=>{this.props.onMouseDownHandle(e.target)},this.onDisableAreaMouseUp=(e,t=()=>{})=>{this.props.onMouseUpHandle(e.target,t)},this.render=()=>{const{story:e,storyData:t,author:s,layerEl:o,showMessage:d,playStory:l,pauseStory:h,list:_,sendNavigationStatEvents:u}=this.props,{clickable_stickers:v}=t,{stickers:g,original_width:y,original_height:w}=v,{widthViewBox:b,heightViewBox:k,showTooltip:I,position:T,tooltipContent:L,showQuestionModal:M,clientX:A,clientY:x}=this.state,P=g.filter((e=>r.dynamicStickerIds.includes(e.type)))||[],R=g?.filter((e=>r.staticStickerIds.includes(e.type)))||[];return(0,i.jsxs)("div",{className:"StoryStickers",children:[(0,i.jsx)("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp,onContextMenu:this.onDisableAreaMouseUp}),(0,i.jsx)("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp,onContextMenu:this.onDisableAreaMouseUp}),!!R.length&&R.map(((t,s)=>(0,i.jsx)(p.StickerItem,{story:e,sticker:t,originalWidth:y,originalHeight:w,widthViewBox:b,heightViewBox:k,toggleTooltip:this.toggleTooltip,sendNavigationStatEvents:u,hideTooltip:this.hideTooltip,showQuestionModal:this.showQuestionModal,showMessage:d,playStory:l,pauseStory:h,list:_,onMouseDownHandle:this.onDisableAreaMouseDown,onMouseUpHandle:this.onDisableAreaMouseUp},s))),!!P.length&&P.map(((e,t)=>(0,i.jsx)(E.DynamicStickerItem,{sticker:e,originalWidth:y,originalHeight:w,widthViewBox:b,heightViewBox:k,onMouseDownHandle:this.onDisableAreaMouseDown,onMouseUpHandle:this.onDisableAreaMouseUp,sendNavigationStatEvents:u},t))),I&&(0,i.jsx)(m.StickerTooltip,{clientX:A,clientY:x,layerEl:o,position:T,children:L}),M&&(0,i.jsx)(C.MessageBoxModal,{onDestroy:this.closeQuestionModal,width:420,children:({onClose:e})=>(0,i.jsxs)(a.ModalBox,{"data-testid":"stories_question_ask_box",children:[(0,i.jsx)(n.ModalHeader,{closeAriaLabel:(0,f.getLang)("global_close"),onClose:e,children:(0,f.getLang)("stories_question_ask_box_title").replace("{name}",(0,S.decodeHTMLEntities)(s.name_get))}),(0,i.jsx)(c.ModalBody,{insetLevel:2,children:(0,i.jsx)("textarea",{"data-testid":"story-question-textarea",ref:this.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:80,placeholder:(0,f.getLang)("stories_question_ask_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown})}),this.getQuestionModalFooter()]})})]})},this.handleResize=()=>{const[e,t]=(0,g.getSize)(this.props.el);this.setState({widthViewBox:e,heightViewBox:t,showTooltip:!1})},this.toggleTooltip=(e,t,s="t",i=!0)=>{e.preventDefault(),e.stopPropagation();const{clientX:r,clientY:o}=e,{pauseStory:a,playStory:n,hideFeedbackTooltip:c,sendNavigationStatEvents:d}=this.props;c(),this.setState({showTooltip:!this.state.showTooltip,tooltipContent:t,clientX:r,clientY:o,position:s}),setTimeout((()=>{this.state.showTooltip?(i&&d("click_on_clickable_sticker"),a()):n()}),0)},this.hideTooltip=()=>{this.setState({showTooltip:!1})},this.isShownTooltip=()=>this.state.showTooltip||this.state.showQuestionModal,this.showQuestionModal=()=>{const{storyData:e,showMessage:t,pauseStory:s,onModalShownChange:i}=this.props,{can_ask:r}=e;if(!r)return t((0,f.getLang)("stories_question_forbidden"));this.setState({showQuestionModal:!0}),this.hideTooltip(),i(!0),s()},this.closeQuestionModal=()=>{const{playStory:e,onModalShownChange:t}=this.props;this.setState({showQuestionModal:!1}),t(!1),e()},this.handleChange=e=>{this.setState({questionText:e.target.value})},this.handleKeyDown=e=>{const{questionText:t}=this.state;(0,y.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==w.KEY.RETURN&&this.sendQuestion()},this.resetAskText=()=>{this.setState({questionText:""})},this.getQuestionModalFooter=()=>{const{storyData:e,author:t}=this.props,{can_ask_anonymous:s}=e,{isQuestionButtonLoading:r,questionText:o}=this.state,a=[{value:v.QUESTION_SELECT_MODE.AUTHOR_ONLY,label:(0,f.getLang)("stories_question_select_author_only"),testId:"story-question-privacy_author_only"},{value:v.QUESTION_SELECT_MODE.PUBLIC,label:(0,f.getLang)("stories_question_select_public"),testId:"story-question-privacy_public"}];s&&a.splice(1,0,{value:v.QUESTION_SELECT_MODE.ANONYMOUS,label:(0,f.getLang)("stories_question_select_anonymous"),testId:"story-question-privacy_anonymous"});const n=s?(0,f.getLang)("stories_question_about_user_tooltip"):(0,f.getLang)("stories_question_about_user_tooltip_without_anon"),c=s?(0,f.getLang)("stories_question_about_group_tooltip"):(0,f.getLang)("stories_question_about_group_tooltip_without_anon"),p=b.Ranges.isUserId(t.id)?n.replace(/{name}/g,(0,S.decodeHTMLEntities)(t.firstName)):c,m=(0,i.jsx)(d.TextTooltip,{appearance:"neutral",maxWidth:350,text:(0,i.jsx)(l.InnerHTML,{children:p}),placement:"right",hoverDelay:[0,1e3],children:(0,i.jsx)("div",{children:a.map((({value:e,label:t,testId:s})=>(0,i.jsx)(h.DropdownActionSheet.Item,{"data-testid":s,onClick:()=>this.setState({selected:e}),children:t},e)))})});return(0,i.jsx)(_.ModalFooter,{before:(0,i.jsx)(h.DropdownActionSheet,{offsetByCrossAxis:-8,trigger:"click",content:m,children:(0,i.jsx)(u.Button,{"data-testid":"story-question-privacy",mode:"link",children:a.find((({value:e})=>e===this.state.selected))?.label??this.state.selected})}),actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Button,{size:"m",mode:"tertiary",onClick:this.closeQuestionModal,"data-testid":"story-question-cancel",children:(0,f.getLang)("global_cancel")}),(0,i.jsx)(u.Button,{size:"m",mode:"primary",loading:r,disabled:!(0,y.trim)(o),onClick:this.sendQuestion,"data-testid":"story-question-save",children:(0,f.getLang)("stories_question_reply_send")})]})})},this.sendQuestion=()=>{const{questionText:e}=this.state,{showMessage:t,storyData:s,author:i,sendNavigationStatEvents:r}=this.props,{raw_id:o}=s,[a,n]=o.split("_");let c=!1,d=!1;this.state.selected===v.QUESTION_SELECT_MODE.PUBLIC?c=!0:this.state.selected===v.QUESTION_SELECT_MODE.ANONYMOUS&&(d=!0),this.setState({isQuestionButtonLoading:!0}),k.storiesService.askQuestionFx({owner_id:Number(a),story_id:Number(n),question:e,is_anonymous:d?1:0,with_mention:c?1:0}).then((()=>{switch(this.closeQuestionModal(),this.resetAskText(),t((0,f.getLang)("stories_question_sent").replace("{name}",i.first_name_ins)),this.state.selected){case v.QUESTION_SELECT_MODE.PUBLIC:r("question_reply_publish");break;case v.QUESTION_SELECT_MODE.AUTHOR_ONLY:r("question_reply");break;case v.QUESTION_SELECT_MODE.ANONYMOUS:r("question_reply_anonymous")}})).catch((e=>{this.closeQuestionModal(),this.resetAskText(),t(e)})).finally((()=>{this.setState({isQuestionButtonLoading:!1})}))};const[t,s]=(0,g.getSize)(this.props.el);this.askTextarea=(0,o.createRef)(),this.state={widthViewBox:t,heightViewBox:s,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:v.QUESTION_SELECT_MODE.AUTHOR_ONLY,questionText:""}}}},979554:(e,t,s)=>{s.d(t,{StickerTemplateSelectorStory:()=>h,TemplateSticker:()=>_});var i=s(474848),r=s(539140),o=s(511694),a=s(740196),n=s(866467),c=s(296540),d=s(351118),l=s(205338);const h="StickerTemplateSelectorStory",_=({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:_,heightViewBox:u,onMouseUpHandle:p,onMouseDownHandle:m})=>{const{top:v}=(0,r.getStickerStyle)({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:_,heightViewBox:u}),g=(0,c.useRef)(null),[f,y]=(0,c.useState)(null),S=e.situationalRepliedAvatars?.map((e=>e.photo_100))||void 0,w=(0,i.jsx)(a.UsersStackWithCaption,{count:e.situationalRepliedUsers?.count,photos:S,caption:(0,n.getLang)("stories_sticker_template"),stopButtonPropagation:!1});return(0,c.useEffect)((()=>{if(g.current instanceof HTMLDivElement){const e=(0,l.createRoot)(g.current);e.render(w),y(e)}return()=>{f&&f.unmount(),y(null)}}),[g]),(0,i.jsx)("div",{ref:g,className:(0,d.classNames)(o.default.root,h),style:{top:v},onMouseDown:m,onMouseUp:p,onContextMenu:p})}},916130:(e,t,s)=>{s.d(t,{ViewsButton:()=>n});var i=s(474848),r=s(405057),o=s(460643),a=s(351118);const n=({story:e,className:t=""})=>{const s=e.getReplies(),n=e.getViews()||"",c=e.getCurStoryData();if(!c)return null;const{can_manage:d,isNewQuestions:l,replies_new_counter:h}=c,_=Boolean(d&&n),u=Boolean(!d&&s),p=l||Boolean(d&&h),m=e.isActiveLive(),{isFeedbackTooltipShow:v,toggleFeedbackTooltip:g}=e;if(m||!n&&!s)return null;let f="StoryViewerButton StoryViewerButton--feedback StoryViewerButton--dark";return v&&(f+=" StoryViewerButton--hover"),(0,i.jsx)("div",{className:(0,a.classNames)("StoryViewerButtonWrapper",t),children:(0,i.jsxs)("div",{className:f,onClick:e=>{g(),e.stopPropagation()},"data-testid":"story_viewers_button",children:[u&&(0,i.jsxs)("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--replies",children:[(0,i.jsx)(r.Icon24StoryOutline,{}),(0,i.jsx)("span",{className:"StoryButtonFeedbackLabel__text",children:s})]}),_&&(0,i.jsxs)("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--views",children:[(0,i.jsx)(o.Icon24ViewOutline,{}),Boolean(n)&&(0,i.jsx)("span",{className:"StoryButtonFeedbackLabel__text",children:n})]}),p&&(0,i.jsx)("span",{className:"StoryButtonBadge StoryButtonBadge--blue"})]})})}},539140:(e,t,s)=>{s.d(t,{getStickerStyle:()=>i});const i=({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:i,heightViewBox:r})=>{const{top:o,left:a,width:n,height:c,rotate:d}=e;let l=i,h=r;return r/i>1.77?l=t*r/s:h=s*i/t,{top:o*h-(h-r)/2,left:a*l-(l-i)/2,width:n*l,height:c*h,transform:`rotate(${d}deg)`}}},348453:(e,t,s)=>{s.d(t,{ADMIN_STORY_VIEW_MODULE:()=>r,BOX_ITEM_DRAGGABLE_CLASS:()=>h,EMOJI_REACTIONS_ARR:()=>o,INIT_MAX_FEEDBACK_STORIES_COUNT:()=>c,LONG_PRESS_DELAY_MS:()=>i,MAX_FEEDBACK_STORIES_SLICE_COUNT:()=>n,MAX_NARRATIVE_STORIES:()=>d,NARRATIVE_MAX_TITLE_LENGTH:()=>l,QUESTION_SELECT_MODE:()=>a,SCROLL_LOADING_MORE_GAP:()=>u,SCROLL_THROTTLE_DELAY:()=>_});const i=200,r="admin_story_view",o=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],a={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},n=50,c=10,d=100,l=23,h="NarrativeBox__draggable",_=34,u=400},128645:(e,t,s)=>{s.d(t,{StoryCustomEventName:()=>i,dispatchCloseLayerEvent:()=>n,dispatchListModifiedEvent:()=>a,dispatchStoriesRemoveEvent:()=>o,dispatchStoriesSeenEvent:()=>r});var i=function(e){return e.STORIES_SEEN="stories_seen",e.STORIES_REMOVE="stories_remove",e.CLOSE_LAYER="close_layer",e.LIST_MODIFIED="list_modified",e}({});function r(e){setTimeout((()=>{window.dispatchEvent(new CustomEvent("stories_seen",{detail:e}))}))}function o(e){setTimeout((()=>{window.dispatchEvent(new CustomEvent("stories_remove",{detail:e}))}))}function a(e){setTimeout((()=>{window.dispatchEvent(new CustomEvent("list_modified",{detail:e}))}))}function n(e,t=!1){const s=()=>{window.dispatchEvent(new CustomEvent("close_layer",{detail:e}))};t?setTimeout(s):s()}},100101:(e,t,s)=>{s.d(t,{StoryLayer:()=>$});var i=s(646938),r=s(246429),o=s(101148),a=s(335851),n=s(547754),c=s(73575),d=s(504035),l=s(101272),h=s(540462),_=s(693080),u=s(371906),p=s(348453),m=s(633009),v=s(41903),g=s(636576),f=s(628459),y=s(983567),S=s(478752),w=s(866467),b=s(972332),k=s(672277),E=s(692543),C=s(237625),I=s(754866),T=s(385174),L=s(298077),M=s(511944),A=s(24516),x=s(809424),P=s(209761),R=s(319756),O=s(122442),N=s(128645),B=s(530888),D=s(511356),F=s(954585),j=s(362570),U=s(604226),V=s(873900),H=s(487864),W=s(391475),K=s(28233),G=s(391944);class ${_init(e,t,s,r,o,a,n){if(r||(r=e?s?`${e}${s}`:a.find((t=>t?.author?.id===e))?.id||"":a[0]?.id||""),!r)throw this.destroy(),new Error("blockKey is undefined");this.blockKey=r,e&&t&&(this.startStoryRaw=`${e}_${t}`),this.listName=o,this.renderedStoryList=a,this.storyList=a,this.extra=(0,O.parseExtra)(n),this.extraRaw=n||"",this.hasUnloadedDiscover=Boolean(a.find((e=>e&&e.type===i.StoryBlockType.discover&&!e.grouped?.length)));try{this.initStories()}catch(e){const t=new Error("Failed to init layer, error in initStories()");t.cause=e,(0,L.logError)(t,{environment:"stories"})}}initStories(){this.renderedStoryBlockKeys=this.renderedStoryList.map((e=>this.getBlockKey(e)));let e=!1;const t=this.renderedStoryBlockKeys.indexOf(this.blockKey);if(-1!==t){const s=this.renderedStoryList[t];e=this.isBlockUnread(s)}if(this.extra)switch(this.extra.context){case"new":e=!0;break;case"all":e=!1}if(e&&"replies"===this.listName.substr(0,7)&&(e=!1),e){const e=[];for(let t=0;t<this.renderedStoryList.length;t++){const s=this.renderedStoryList[t];(s&&this.isBlockUnread(s)||0===t&&this._hasContext("new"))&&e.push(s)}e.length&&(this.renderedStoryList=e,this.renderedStoryBlockKeys=this.renderedStoryList.map((e=>this.getBlockKey(e))))}this.renderedStories={};const{activeStory:s}=this._renderStories();null!=s&&(this.scrollToStory(s,!0),1===this.renderedStoryList.length&&(0,I.addClass)(this.stories,"one_story"),this._startFirstStory(s,this.extra.story_id)),(0,I.addClass)(this.stories,"inited")}getBlockKey(e){return e?.author?.id&&e?.narrative?.id?`${e.author.id}narrative${e.narrative?.id}`:`${e.id}`}isBlockUnread(e){let t=!1;return e.items[e.items.length-1]&&(t=e.items[e.items.length-1]?.unread),e.grouped?.length?t||(t=e.grouped.some((e=>e.items[e.items.length-1]?.unread))):e.type===i.StoryBlockType.discover&&(t=!0),t}_renderStories(){const e=this.renderedStoryList.filter(Boolean),t=this._getScreenStoriesCount(),s=this._getCurStoryPos(e.map((e=>this.getBlockKey(e)))),i=Math.floor(t/2),r=e.slice(Math.max(0,s-i)).slice(0,t),o=r.map((e=>this.getBlockKey(e)));for(const[e,t]of Object.entries(this.renderedStories))o.includes(e)||(t.story.destroy(),delete this.renderedStories[e]);let n=null;return r.map(((e,t)=>{const s=this.getBlockKey(e);if(this.renderedStories[s])return void(s===this.blockKey&&(n=this.renderedStories[s].story));const r=this.renderedStoryBlockKeys.indexOf(s),o=new a.Story(e,{id:t,layer:this,onSelect:this._handleStorySelect.bind(this),onStoriesEnd:this._onStoriesEnd.bind(this,r),playPrevOwner:this._playPrevOwner.bind(this,r),onPlayStory:this._onPlayStory.bind(this,r),onStoryLoadError:this._onStoryLoadError.bind(this),onSeen:this._readStories.bind(this),onVideoPlay:this._onVideoPlay.bind(this),restoreAudioPlay:this._restoreAudioPlay.bind(this),onStartStory:this._onStartStory.bind(this),removeCurrentList:()=>window.Stories.removeList(this.listName),onStoryBlockRemoved:(e,t)=>{this.onStoryBlockRemoved(r,e,t)},afterNarrativeRemoved:this.options?.afterNarrativeRemoved,afterNarrativeEdited:this.options?.afterNarrativeEdited,navScreen:this.options?.nav_screen});t<=i&&this.stories.children[t]?this.stories.insertBefore(o.render(),this.stories.children[t]):this.stories.appendChild(o.render()),this.renderedStories[s]={story:o,index:r},s!==this.blockKey&&null!=n||(n=o)})),{activeStory:n}}_sendOpeningEvents(){const e=this._getSource();if(!e)return;let t;switch(e){case"narrative_story":t=_.StoryStatsEvent.OpenNarrativeStories;break;case"narrative_snippet":case"narrative_link":t=_.StoryStatsEvent.OpenNarrative;break;case"narrative_recommendations":t=_.StoryStatsEvent.NarrativeOther}if(t&&this.sendNavigationStatEvents(t,!1),"narrative_fave"===e){const e=this.activeStory.getCurrentNarrative();if(e){const{ownerId:t,id:s}=e;(0,g.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:t,item_id:s,time:(0,o.getServerTime)()})}}this.sendNavigationStatEvents("open_viewer",!0)}_destroyStories(){for(const e in this.renderedStories){if(!this.renderedStories.hasOwnProperty(e))continue;this.renderedStories[e].story.destroy()}}destroy(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),null!=this.videoLoader&&this.videoLoader.destroy(),(0,b.removeEvent)(this.volumeControl),(0,b.removeEvent)(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&document.body.removeChild(this.layerEl)}catch(e){}delete window.cur.storyLayer}getList(){return this.getStoryRaw()||(0,L.logError)(new Error("Fail: cannot gnerate correct list string because story raw id is not available"),{environment:"stories"}),`story${this.activeStory.getRawId()}/${this.listName}${this.extraRaw?`/${this.extraRaw}`:""}`}getStoryRaw(){const e=this.activeStory?.getRawId();return e||!1}initDOM(){this.layerEl=(0,I.ce)("div",{className:"stories_layer"});const e=(0,I.ce)("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=(0,I.ce)("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild((0,I.ce)("div",{className:"stories_layer_close"})),(0,b.addEvent)(this.layerEl,"click",this._onLayerClick.bind(this)),document.body.appendChild(this.layerEl)}show(){window.onBodyResize()}hide(e){(0,I.addClass)(this.layerEl,"stories_layer_hiding"),this.hideAllLayers||n.layerHide(),this._source&&this._source.startsWith("narrative")&&this.sendNavigationStatEvents("narrative_close",!1),this.activeStory&&!this.activeStory.isEmpty()&&(this.activeStory.pauseStory(),this.activeStory.hideTooltip(),this.activeStory.isActiveLive()&&this.sendNavigationStatEvents("live_player_close",!1),this._readStoriesIfNeeded(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.listName)),(0,N.dispatchCloseLayerEvent)({currentBlockId:this.getBlockKey(this.activeStory.data)}),!0!==e&&this.activeStory?this.animateStory("minimize").then((()=>{try{this.doHide()}catch(e){const t=new Error("Error hiding story after animation end");t.cause=e,(0,L.logError)(t,{environment:"stories",breadcrumb:{message:"original error details in case `err.cause` is not supported",data:{message:(0,T.stringifyUnknown)(e),stack:e instanceof Error?e.stack:null}}})}})).catch((()=>{(0,C.debugLog)("error animate story")})):this.doHide(e),(0,I.removeClass)(this.layerEl,"shown")}doHide(e){this.onHideCallback?.(),this.destroy(),e||n.removeLayer(),window.wkcur&&window.wkcur.shown&&window.WkView.restoreLayer({}),"group_stories"===this.listName&&window.Stories.groupStoriesBlockUpdate(),(0,f.clear)()}back(){this.hideAllLayers=!1,this.hide(!1)}_getStoryBlockSize(){const{STORY_MIN_WIDTH:e,STORY_MAX_WIDTH:t,STORY_HORIZONTAL_RATIO:s,STORY_VERTICAL_RATIO:i}=c,r=window.innerHeight,o=(a=r*s,n=e,d=t,Math.max(n,Math.min(a,d)));var a,n,d;return{width:o,height:o*i}}_getScreenStoriesCount(){const e=this._getStoryBlockSize().width+c.STORY_BLOCK_SPACING,t=(window.innerWidth-e)/2,s=2*Math.ceil(t/e);return Math.max(1+2*s,3)}_getCurStoryPos(e){return(e||this.renderedStoryBlockKeys).indexOf(this.blockKey)}_startFirstStory(e,t){this.activeStory=e,(0,I.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.startStoryRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout((()=>{(0,I.addClass)(this.stories,"animated"),this.inited=!0,"open"===this.extra.replies&&this.activeStory.showFeedbackTooltip()}))}_markReadRestStories(e){e.hasMetaStory()?this.onMetaStoryViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.getFullItemsLength()),this._updateBadge(e))}onMetaStoryViewEnd(e){if(!e.data.grouped)return;const t=[],s=[];for(let t of e.data.items)t.unread=!1,s.push(t.raw_id);const i=this.getBlockKey(e.data),r=(0,I.ge)("feed_story_"+i);t.push({blockId:i,storyRawIdSet:new Set(s)});let o=[];for(let s of e.data.grouped)if(s){for(let e of s.items)e.unread=!1,o.push(e.raw_id);t.push({blockId:this.getBlockKey(s),storyRawIdSet:new Set(o)}),s.author&&(0,H.markSeenInModules)(s.author.id)}this.markStoriesSkipped(o),e.data.has_unseen=!1,this.updateMetaStoryItems(),(0,I.removeClass)(r,"story_feed_new_item"),(0,N.dispatchStoriesSeenEvent)(t)}markStoriesSkipped(e){const t=e.map((e=>{const[t,s]=(0,v.splitStoryRawId)(e);return{owner_id:t,story_id:s}}));v.storiesService.fireMarkSkipped({stories:JSON.stringify(t)})}_selectStory(e,t){let s;this.activeStory&&(s=this.activeStory.getWrap(),this.activeStory.stop()),e.id>this.activeStory.id&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e.data),clearTimeout(this.timer),t?.onTransitionStart?.call(null),(0,I.addClass)(this.stories,"animated"),this.timer=setTimeout((()=>{(0,I.removeClass)(s,"active"),(0,I.addClass)(e.getWrap(),"active"),this.scrollToStory(),this.timer=setTimeout((()=>{this.activeStory&&e.id!==this.activeStory.id||!this.activeStory||(e.indexToUnread(),this._renderStories(),this._startActiveStory(),this.scrollToStory(e,!0),t?.onTransitionEnd?.call(null))}),200)}),0)}_startActiveStory(){const{activeStory:e}=this;e.markAsActive(),e.playStory(!0)}_onStartStory(){this.updateLocation()}updateLocation(){const{activeStory:e,listName:t}=this;if(!e)return;const s=this.getStoryRaw(),i=e.getCurStoryData(),r=e.getCurrentNarrative(),o=e.isActiveMetaStory();if(!i&&!o)return void(0,L.logError)(new Error("Fail: _onStartStory"),{environment:"stories"});const a=window.nav.objLoc;if(i&&s){if(a.w=`story${s}`,t.match(/^-?(\d+)_(\d+)$/)||(a.w+="/"+t),t.match(/^narrative[s]?-?\d+(_\d+)?/)){const{raw_id:e}=i,[,t]=e.split("_");a.w=`narrative${r?.rawId}_${t}`}}else delete a.w;window.nav.setLoc(window.nav.toStr(a))}scrollToStory(e,t){const s=this._getScrollLeft(e);t?((0,I.removeClass)(this.stories,"animated"),this._setScrollLeft(s)):this.inited&&(0,I.addClass)(this.stories,"animated"),setTimeout((()=>{this._setScrollLeft(s)}))}_setScrollLeft(e){(0,I.setStyle)(this.stories,"transform",`translateX(${Math.round(e)}px) translateZ(0)`)}_getScrollLeft(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()}_onStoriesEnd(e,t){const s=this.findNextStoryIndex(e),i=this._getStoryBlockByIndex(s);if(this.activeStory.isActiveMetaStory()&&this.onMetaStoryViewEnd(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.listName),s>-1&&i){t&&this.sendNavigationStatEvents("go_to_next_story_auto_by_time");const e=!1,s=performance.now();this._selectStory(i,{onTransitionStart:()=>{this.notifyStoryNavigationStart({storyRawId:i.getRawId(!0),timeAtNavigationStart:s,direction:"forward",withAnimation:!e,isWithinTheSameBlock:e})},onTransitionEnd:()=>{this.notifyStoryNavigationEnd({storyRawId:i.getRawId(!0),isWithinSameBlock:e})}})}else(0,m.cancelStackPop)({byTimer:t})}preloadDiscoverIfNeeded(){if(!this.hasUnloadedDiscover)return;if(d.isDiscoverLoading())return;if(!this.activeStory)return;const e=this.getBlockKey(this.activeStory.data);if(!this.renderedStories[e])return;let t=this.renderedStories[e].index,s=Math.min(t+3,this.renderedStoryBlockKeys.length-1);for(let e=t+1;e<=s;e++)if(this.renderedStoryList[e]?.type===i.StoryBlockType.discover)return this.renderedStoryList[e].grouped?.length?void(this.hasUnloadedDiscover=!1):void d.preloadDiscoverList().then((()=>{this.hasUnloadedDiscover=!1})).catch((e=>{console.error(e),(0,L.logError)(new Error("Error with getDiscoverList in preloadDiscoverIfNeeded"+(e?`: ${e}`:"")))}))}_getStoryIndex(e){if(null==e)return-1;const t=this.getBlockKey(e.data);return this.renderedStoryList.findIndex((e=>Boolean(e)&&this.getBlockKey(e)===t))}_handleStorySelect(e){const t=!1,s=performance.now(),i=this._getStoryIndex(e),r=this._getStoryIndex(this.activeStory);this._selectStory(e,{onTransitionStart:()=>{this.notifyStoryNavigationStart({storyRawId:e.getRawId(!0),timeAtNavigationStart:s,direction:i>=r?"forward":"backwards",withAnimation:!0,isWithinTheSameBlock:t})},onTransitionEnd:()=>{this.notifyStoryNavigationEnd({storyRawId:e.getRawId(!0),isWithinSameBlock:t})}})}_playPrevOwner(e){const t=this.findPrevStoryIndex(e),s=this._getStoryBlockByIndex(t);if(t>-1&&s){const e=!1,t=performance.now();this._selectStory(s,{onTransitionStart:()=>{this.notifyStoryNavigationStart({storyRawId:s.getRawId(!0),timeAtNavigationStart:t,direction:"backwards",withAnimation:!e,isWithinTheSameBlock:e})},onTransitionEnd:()=>{this.notifyStoryNavigationEnd({storyRawId:s.getRawId(!0),isWithinSameBlock:e})}})}else(0,m.cancelStackPop)()}_markReadStoriesInRange(e,t,s){const i=e.data.items,r=[],o=new Set;for(let e=t;e<s;e++){const t=i[e];!t.unread||(0,h.partConfigEnabled)("frontend.stories_unread_check")&&(0,K.needNotShowStory)(t)||(t.unread=!1,o.add(t.raw_id))}r.push({blockId:this.getBlockKey(e.data),storyRawIdSet:o}),e.data.grouped?.length&&s>=e.getFullItemsLength()&&(e.data.grouped.forEach((e=>{const t=new Set;e.items.forEach((e=>{e.unread=!1,t.add(e.raw_id)})),r.push({blockId:this.getBlockKey(e),storyRawIdSet:t})})),e.data.has_unseen=!1),(0,N.dispatchStoriesSeenEvent)(r)}_markReadPrevStories(e){this._markReadStoriesInRange(e,0,e.index)}_updateBadge(e){const t=(0,I.ge)("feed_story_"+this.getBlockKey(e.data)),s=(0,I.geByClass1)("_stories_feed_item_replies",t),i=e.data.items||[],r=i[e.index]||{};if(e.hasUnloadedMetaStory()||(0,h.partConfigEnabled)("frontend.stories_unread_check")&&(0,K.needNotShowStory)(i[e.index]))return;r.unread=!1;const o=new Set;r.raw_id&&o.add(r.raw_id);let a=!0;i.forEach((e=>{e.unread&&(a=!1)})),a&&e.data.grouped?.length&&(a=e.data.grouped.every((e=>e&&e.items.every((e=>!e?.unread))))),(0,I.val)(s,""),a&&((0,I.removeClass)(t,"story_feed_new_item"),(0,I.removeClass)(t,"story_feed_new_item_promo"),e.data.author&&(0,H.markSeenInModules)(e.data.author.id)),(0,N.dispatchStoriesSeenEvent)([{blockId:this.getBlockKey(e.data),storyRawIdSet:o}])}_updateAnimateFromElem(){const e=this.getBlockKey(this.activeStory.data);if((0,I.hasClass)(this.animateFromEl,"stories_feed_reply_item")){const t=(0,I.domQuery)("#feed_story_"+e,(0,I.domPN)(this.animateFromEl))[0];t&&(this.animateFromEl=t)}else if("feed"===window.cur.module&&!(0,I.isVisible)(this.backButton)){if(this.options.getStoryElement){const t=this.options.getStoryElement(e);t&&(this.animateFromEl=t)}const t=(0,I.ge)("feed_story_"+e);t&&(this.animateFromEl=t)}}_onPlayStory(e){const t=this._getStoryBlockByIndex(e),s=t?t.getRawId():"",i=Boolean(s)&&this.lastPlayedStoryId===s;if(this.lastPlayedStoryId=s,i)return;t&&(this.storiesReadHash=t.getReadHash(),t.isActiveMetaStory()||t.isActiveStoryOneTime()||(this._readStories(t),this._markReadPrevStories(t)),this._updateBadge(t),this._trackStoryDownloadEnd(s));const r=this._getStoryBlockByIndex(e+1);r&&(t&&0===t.getIndex()&&this.preloadDiscoverIfNeeded(),r.preloadNextStory(r.getIndex()))}_onStoryLoadError(e,t){(0,D.trackStoryDownloadFailure)({nonce:e,error:t})}_getStoryBlockByIndex(e){const t=this.renderedStoryList[e];if(!t)return!1;const s=this.getBlockKey(t),i=this.renderedStories[s];return!!i&&i.story}findNextStoryIndex(e){for(let t=e+1;t<this.renderedStoryList.length;t++)if(null!=this.renderedStoryList[t])return t;return-1}findPrevStoryIndex(e){for(let t=e-1;t>=0;t--)if(null!=this.renderedStoryList[t])return t;return-1}findClosestStoryIndex(e){const t=this.findNextStoryIndex(e);return t>-1?t:this.findPrevStoryIndex(e)}onStoryBlockRemoved(e,t,s){const i=this.renderedStoryList[e];if(i){const s=this.getBlockKey(i),r=this.storyList.findIndex((e=>null!=e&&this.getBlockKey(e)===s));delete this.renderedStoryList[e],delete this.storyList[r];const o=this.findClosestStoryIndex(e);t||(o<0||o>e?this._onStoriesEnd(e):this._playPrevOwner(e))}else(0,L.logError)(new Error("Got bad bound index in onStoryBlockRemoved() callback. Item already removed?"),{breadcrumb:{message:"onStoryBlockRemoved() call details:",data:{index:e,storyBlocksLength:this.renderedStoryList.length,renderedStoryListShape:Array.from(this.renderedStoryList).map((e=>e?1:0))}}});window.Stories.updateFeedStories(),s?.()}onVisibilityChange(){"visible"===document.visibilityState?window.cur.storyLayer&&window.cur.storyLayer.playStory():window.cur.storyLayer&&window.cur.storyLayer.pauseStory()}onResize(){this.activeStory&&window.cur.storyLayer.scrollToStory(this.activeStory,!0)}pauseStory(e){this.activeStory&&this.activeStory.pauseStory(e)}playStory(e=!1){this.activeStory&&this.activeStory.autoResumeStory(e)}_onLayerClick(e){const t=(0,I.hasClass)(e.target,"stories_layer_close");if((0,I.hasClass)(e.target,"stories_layer_cont")||t){if(this.renderedStoryBlockKeys.length-1===this._getCurStoryPos()&&!t){const e=[];for(let t of this.activeStory.data.items)e.push(t.raw_id),t.unread=!1;(0,N.dispatchStoriesSeenEvent)([{blockId:this.getBlockKey(this.activeStory.data),storyRawIdSet:new Set(e)}]),this.markStoriesSkipped(e),this._markReadRestStories(this.activeStory)}(0,m.cancelStackPop)({isCloseBtnClick:t})}}_checkKeyEvents(e){return!((0,I.attr)(e.target,"contenteditable")||(0,S.inArray)(e.target.tagName,["INPUT","TEXTAREA"])||(0,r.curBox)())}onKeyDown(e){if(window.cur.storiesKeyDown)window.cur.storyLayer&&window.cur.storyLayer._checkKeyEvents(e)&&(0,b.cancelEvent)(e);else if(window.cur.storiesKeyDown=e.keyCode!==b.KEY.ESC,[b.KEY.PAGEDOWN,b.KEY.PAGEUP].includes(e.keyCode))(0,b.cancelEvent)(e);else if(window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case b.KEY.LEFT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.prevStory();break;case b.KEY.RIGHT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory();break;case b.KEY.SPACE:(0,b.cancelEvent)(e);const t=window.cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(window.cur.storiesKeyDownLong=setTimeout(t.longTapHandle.bind(t),p.LONG_PRESS_DELAY_MS))}window.cur.storiesKeyDownTs=(0,S.vkNow)()}}onKeyUp(e){window.cur.storiesKeyDown=!1,clearTimeout(window.cur.storiesKeyDownLong),window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)&&e.keyCode===b.KEY.SPACE&&((0,b.cancelEvent)(e),(0,S.vkNow)()-window.cur.storiesKeyDownTs>p.LONG_PRESS_DELAY_MS?window.cur.storyLayer.playStory(!0):(this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory()))}nextStory(){this.activeStory&&this.activeStory.nextStory()}prevStory(){this.activeStory&&this.activeStory.prevStory()}changeStory(e){this.activeStory&&this.activeStory.changeStory(e)}_readStoriesIfNeeded(e){e.isActiveStoryOneTime()&&this._readStories(e)}_readStories(e){if(!e)return;const t=e.getOwnerId(),s=e.getStoryId(),i=e.getRawId(),r=e.getCurrentNarrative();if(!i||!e.isLoaded())return;let o=e.getTrackCode(),a=0;e.isActiveStoryOneTime()&&(a=Math.max(Math.round(e.getStoryProgressPercent()),1)),o||(o=""),this.sendAudienceResearchData(e),v.storiesService.markSeenFx({owner_id:t,story_id:s,track_code:o,source:this._getSource(),narrative_id:r?.id,progress:a,all:0}).catch((e=>{(0,L.logError)(new Error(`error mark seen story: ${e?.error?.error_msg}`))}))}sendAudienceResearchData(e){if(!(0,h.isToggleEnabled)("st_audience_research"))return;const t=e.getResearchData();t&&(0,G.getAudienceResearchServiceWeb)().send({urls:t.urls||[],events:t.events||[],surface:P.AUDIENCE_RESEARCH_SURFACE.story_sticker})}_getSource(){return[u.USER_INFO_MODULE,u.GROUP_INFO_MODULE,u.SPAMFEED_MODULE,u.ABUSE_MODULE,p.ADMIN_STORY_VIEW_MODULE].includes(window.cur.module)?window.cur.module:this._source?this._source:"list"}notifyStoryNavigationStart(e){if(""===e.storyRawId)return;const t=e.storyRawId,s="backwards"===e.direction,i=e.timeAtNavigationStart??performance.now(),r=e.withAnimation??!1,o=e.isWithinTheSameBlock??!1;let a;a=o?s?B.StoryTypeNext.PREV_STORY:B.StoryTypeNext.NEXT_STORY:s?B.StoryTypeNext.PREV_CONTAINER_STORY:B.StoryTypeNext.NEXT_CONTAINER_STORY,(0,D.trackStoryOpeningStart)({nonce:t,time:i,isColdStart:!1,isAnimated:r,isLocalWithinViewer:!0,isLocalWithinSameAuthor:o,viewSource:this.viewerSource,navigationSource:B.StoryTypeOpen.NEXT_OPEN_STORY,navigationNextSpecifier:a})}notifyStoryNavigationEnd({storyRawId:e,isWithinSameBlock:t}){t||""===e||(0,D.trackStoryOpened)({nonce:e,storyDetails:this.getStoryDetailsForPerfMetrics(e)})}notifyStoryTeardown(e){""!==e&&(0,D.trackStoryClosed)({nonce:e})}getStoryDetailsForPerfMetrics(e){function t(t,s){const i=t.split("_")[0],r=s.items[0]?.raw_id.split("_")[0];if(r===i||""===i)return s.items.find((t=>t.raw_id===e))}let s=this.activeStory?.data?t(e,this.activeStory.data):void 0;for(const i of this.storyList){if(void 0!==s)break;i!==this.activeStory?.data&&(s=t(e,i))}if(s)try{const[t,i]=(0,v.splitStoryRawId)(e),r=this.activeStory?.story;let o=s.video?.duration||0;"video"===s.type&&null==s.video&&s.video_url&&null!=r&&r instanceof F.MediaStory&&r.data.raw_id===e&&(o=Math.round(r.getDuration()/1e3));return{owner_id:t,content_id:i,content_type:"photo"===s.type?"photo":"video",content_subtype:s.type,width:s.clickable_stickers?.original_width||0,height:s.clickable_stickers?.original_height||0,duration:o}}catch(e){return}}sendNavigationStatEvents(e,t=!0,s={}){const i=this.activeStory;if(!i||i.isEmpty())return void this._updateLastStoryOpenAction(e);const r=this.getStoryRaw()||i.getRawId(!0),o=this._getSource();t&&this.sendProductAnalyticEvents(e,s),this._updateLastStoryOpenAction(e),(0,v.saveNavigationStatEvent)({storyRawId:r,source:o,action:e})}sendProductAnalyticEvents(e,t={}){const s=this.activeStory;if(!s||s.isEmpty())return;const i=s.isActiveMetaStory(),r=this.getStoryRaw()||s.getRawId(!0);if(!r&&!i)return void(0,L.logError)(new Error("sendProductAnalyticEvents: storyRawId is undefined"),{environment:"stories"});let o=0,a=0;if(r){const e=r.split("_");o=Number(e[0]),a=Number(e[1])}const n=s.getIndex(),c=s.getFullItemsLength()-n,{story:_}=s,u=this._getSource(),p=s.getCurrentNarrative();if(!e||!s)return;if(!(i||_&&o&&a))return;const m={event_type:e,story_owner_id:o,story_id:a,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),volume:100*d.getVolume(),view_entry_point:u,stories_author_before:n,stories_author_after:c,nav_screen:this.options.nav_screen??window.cur.module,view_event_timeline_position:_?_.getCurrentTime():0,story_type:i?"group_feed":_.data?.type??"",track_code:s.getTrackCode(),...(0,W.storyViewClickableToStoryStat)(_.data)};if("discover"===this.listName&&"view_story"===e){const e=this.storyList.findIndex((e=>e&&e.id===this.blockKey));Object.assign(m,{story_index:e})}p&&Object.assign(m,{narrative_id:p.id,narrative_owner_id:p.ownerId}),Object.assign(m,t),(0,h.partConfigEnabled)("web_stats_transport_story_view")?(0,l.saveStoryViewStats)(m):(0,g.statlogsValueEvent)("story_product_analytics",m)}_updateLastStoryOpenAction(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}}_initViewerSource(){const e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.section;break;default:this.viewerSource=e}}sendViewerStartTime(e,t){const s=this.viewerSource;(0,v.saveViewerStartTime)({storyRawId:e,source:s,time:t})}_trackStoryDownloadEnd(e){if(!e)return;let t=e;e===this.firstActiveStoryRawId&&!this.startingStoryDownloadEventSent&&this.initialListNameRaw&&(t=this.initialListNameRaw,this.startingStoryDownloadEventSent=!0),(0,D.trackStoryDownloadEnd)({nonce:t,viewSource:this.viewerSource,storyDetails:this.getStoryDetailsForPerfMetrics(e)})}_onVideoPlay(){const e=this.activeStory.getCurStoryData();if(!e)return void(0,L.logError)(new Error("Fail: _onVideoPlay"),{environment:"stories"});const{noSound:t}=e;t||(window.Notifier.lcSend("stories_video_start"),(0,y.getAudioPlayer)().isPlaying()&&((0,y.getAudioPlayer)().pauseByChangeChannel(),this.needAudioReset=!0))}_onVideoEnd(){this._restoreAudioPlay()}_restoreAudioPlay(){window.Notifier.lcSend("stories_video_end"),this.needAudioReset&&((0,y.getAudioPlayer)().play(),delete this.needAudioReset)}_renderBackButton(){return this.backButton=(0,I.se)(`<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">${(0,w.getLang)("global_back")}</div>\n  </div>\n</div>`),(0,b.addEvent)(this.backButton,"click",(()=>{(0,m.cancelStackPop)()})),this.backButton}showBackButton(){(0,I.show)(this.backButton),this.hideAllLayers=!0,(0,I.addClass)(this.layerEl,"with_back_button")}getAnimateFromElem(){if((0,h.partConfigEnabled)("stories_fix_story_close_animation_web"))this._updateAnimateFromElem();else if(!(0,h.partConfigEnabled)("stories_fix_story_close_animation_web")&&!this.hideAllLayers){const e=this.getBlockKey(this.activeStory.data);if((0,I.hasClass)(this.animateFromEl,"stories_feed_reply_item")){const t=(0,I.domQuery)("#feed_story_"+e,(0,I.domPN)(this.animateFromEl))[0];if(t)return t}else if("feed"===window.cur.module&&!(0,I.isVisible)(this.backButton)){if(this.options.getStoryElement){const t=this.options.getStoryElement(e);if(t)return t}const t=(0,I.ge)("feed_story_"+e);if(t)return t}}return this.animateFromEl}animateStory(e,t){return new Promise((s=>{if("expand"===e&&!t||"minimize"===e&&(!this.animateFromEl||!document.body.contains(this.animateFromEl)))return(0,I.setStyle)("stories_layers_background","opacity",1),s();this.pauseStory(),(0,I.addClass)(this.layerEl,"animation"),(0,I.removeClass)(this.stories,"animated");let i="expand"===e?t:this.getAnimateFromElem();if(this.hideAllLayers&&"minimize"===e){const e=n.getFirstLayer();i=e.getAnimateFromElem(),n.slicePrevLayers(),n.layerHide()}(0,I.removeClass)(i,"stories_feed_item_ava_animate");let[r,o]=(0,I.getXY)(i);const a=(0,I.getSize)(i),c=window.innerHeight,{width:d,height:l}=this._getStoryBlockSize(),h=Math.max(0,(c-l)/2),_=Math.max(0,(window.innerWidth-d)/2);r=_-r+d/2-a[0]/2+Number((0,k.scrollGetX)()),o=h-o+l/2-a[1]/2+Number((0,E.scrollGetY)()),r=-r,o=-o;let u={};"expand"===e&&(u.transform=`translate(${r}px, ${o}px) scale(0)`,this.animateFromEl=t),(0,I.setStyle)(this.activeStory.wrapEl,u),"minimize"===e&&(0,I.setStyle)(i,"transform","scale(0)"),this.animationTimer=setTimeout((()=>{(0,I.addClass)(this.stories,"animated"),(0,I.addClass)(i,"stories_feed_item_ava_animate"),this.animationTimer=setTimeout((()=>{"expand"===e?((0,I.setStyle)("stories_layers_background","opacity",1),(0,I.setStyle)(this.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):((0,I.setStyle)(this.activeStory.wrapEl,"transform",`translate(${r}px, ${o}px) scale(0.01)`),(0,I.setStyle)(i,"transform","scale(1)")),this.animationTimer=setTimeout((()=>{s(),"expand"===e?((0,I.setStyle)(this.activeStory.wrapEl,"transform",""),(0,I.removeClass)(this.layerEl,"animation"),(0,I.removeClass)(this.stories,"animated"),this.playStory(),n.layerShown()):((0,I.removeClass)(i,"stories_feed_item_ava_animate"),(0,I.setStyle)(i,"transform",""))}),330)}),30)}),30)}))}pauseLayer(){this.pauseStory(),(0,I.addClass)(this.layerEl,"paused")}resumeLayer(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&(this.updateLocation(),window.cur.storyLayer.activeStory.isActiveMetaStory()&&this.updateMetaStoryItems(),this.activeStory.isFeedbackTooltipShow&&this.activeStory.updateBottom(),this.playStory(),(0,I.removeClass)(this.layerEl,"paused"))}updateMetaStoryItems(){if(!window.cur.storyLayer?.activeStory?.isActiveMetaStory())return;if(!(this.activeStory.story&&this.activeStory.story instanceof M.MetaStory))return;const e=this.activeStory.story.getList();if(!e||e.every((e=>!e)))return window.cur.storyLayer.activeStory.remove(),this.hideAllLayers=!0,void this.hide();this.activeStory.updateMetaStory()}setLayerVisibility(e){(0,I.toggle)(this.layerEl,e)}_renderVolumeControl(){return this.volumeControl=(0,I.se)('<div class="stories_volume_control" data-testid="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),(0,b.addEvent)((0,I.geByClass1)("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),(0,b.addEvent)(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=(0,I.ce)("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer}setVolume(e){const t=this.volumeControl.querySelector(".stories_volume_control_slide .stories_volume_control_slide_indicator");t&&(t.style.width=`${e}%`,d.setVolume(e/100),this._updateVolumeButton(),this.activeStory.volumeUpdate())}_volumeControlOnMouseDown(e){(0,I.addClass)(this.volumeControlContainer,"changing");const t=(0,I.geByClass1)("stories_volume_control_slide",this.volumeControl),s=(0,I.geByClass1)("stories_volume_control_slide_indicator",t),[i]=(0,I.getXY)(t),[r]=(0,I.getSize)(t),o=e=>{const t=Math.max(0,Math.min(e.pageX-i,r))/r*100;(0,I.setStyle)(s,"width",`${t}%`),d.setVolume(t/100),this.activeStory.volumeUpdate()},a=()=>{(0,b.removeEvent)(window,"mousemove",o),(0,b.removeEvent)(window,"mouseup",a),this._updateVolumeButton(),(0,I.removeClass)(this.volumeControlContainer,"changing")};(0,b.addEvent)(window,"mousemove",o),(0,b.addEvent)(window,"mouseup",a),o(e)}_updateVolumeButton(){let e=100*d.getVolume();(0,I.toggleClass)(this.volumeControl,"low",e>0&&e<50),(0,I.toggleClass)(this.volumeControl,"high",e>=50);const t=(0,I.geByClass1)("stories_volume_control_slide_indicator",this.volumeControl);(0,I.setStyle)(t,"width",`${e}%`)}_volumeControlOnClick(e){if((0,I.hasClass)(e.target,"stories_volume_control_slide_wrap")||(0,I.hasClass)(this.volumeControlContainer,"changing"))return;let t=d.getVolume();t=t?0:1,d.setVolume(t),this._updateVolumeButton(),this.activeStory.volumeUpdate()}onReplyDeleted(e){this.activeStory&&this.activeStory.onReplyDeleted(e)}_hasContext(e){return this.extra&&this.extra.context&&this.extra.context===e}moveToStory(e,t){const s=(0,V.getIdentityRawId)({ownerId:e,id:t}),i=this.renderedStoryList.findIndex((e=>e.items.find((e=>e.raw_id===s)))),r=this._getStoryBlockByIndex(i);return!(-1==i||!r)&&(this.activeStory&&(this.activeStory.getWrap().classList.remove("active"),this.activeStory.stop()),this._startFirstStory(r,s),!0)}constructor(e=0,t=0,s="",i="",r,o,a,n,c){this.renderedStories={},this.hasUnloadedDiscover=!1,this.startingStoryDownloadEventSent=!1,this.lastPlayedStoryId="",this.options={},this.videoLoader=new j.VideoElementManager(5,"canplay",b.removeEvent),this.options=n;const d=(0,R.ensureDIRootWebContainer)();this.storiesPreloader=new U.StoriesPreloadManager(n.vkVideoPlayerConfig,{withoutVkVideoPlayer:!0},d.resolve(A.UserEnv),d.resolve(x.MetaData)),c&&(this.initialListNameRaw=c.initialRawListName,this.onHideCallback=c.onHidden);try{window.Videoview&&window.Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,s,i,r,o,a),(0,I.addClass)(this.layerEl,"shown"),this.activeStory?this.firstActiveStoryRawId=this.activeStory.getRawId(!0):(0,L.logError)(new Error("Fail: new StoryLayer(): activeStory is null"),{environment:"stories"}),this._source=n.source,this._initViewerSource(),this._sendOpeningEvents()}}},901089:(e,t,s)=>{s.d(t,{getStoryList:()=>o,removeStoryList:()=>a,setStoryList:()=>r,transformApiStoryList:()=>n});var i=s(591024);function r(e,t){window.cur[`stories_list_${e}`]=t}function o(e){return window.cur[`stories_list_${e}`]}function a(e){delete window.cur[`stories_list_${e}`]}function n(e,t){return(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,!1)}},270457:(e,t,s)=>{s.d(t,{loadMediaToBrowserCache:()=>c,preloadImage:()=>a});var i=s(754866),r=s(182807),o=s(645043);new r.default({maxSize:50});const a=e=>(0,o.loadImageAsDataUrl)(e);let n;function c(e,t){return n||function(){const e=function(e){try{if(e.contentDocument)return e.contentDocument;if(e.contentWindow&&e.contentWindow.document)return e.contentWindow.document}catch(e){}return!1}(window.utilsNode.appendChild(document.createElement("iframe")));n=e&&e.body?e.body:window.utilsNode.appendChild((0,i.ce)("div",{},{display:"none"}))}(),null==t&&(t=(0,o.getFileType)(e)),"video"===t?function(e){return new Promise(((t,s)=>{const r=(0,i.ce)("video",{});r.oncanplay=()=>{t(),(0,i.re)(r)},r.onerror=()=>{s(),(0,i.re)(r)},n.appendChild(r),r.preload="auto",r.src=e}))}(e):function(e){return new Promise(((t,s)=>{const r=new Image;r.onload=()=>{t(),(0,i.re)(r)},r.onerror=()=>{s(),(0,i.re)(r)},n.appendChild(r),r.src=e}))}(e)}},254756:(e,t,s)=>{s.d(t,{transformFeedback:()=>d,transformViewersResponse:()=>_});var i=s(41903),r=s(591024),o=s(866467),a=s(361121),n=s(33305),c=s(908671);function d([e,t,s,i,r],o,a){return{stats:l(r),replies:h(t,o),viewers:_(e,a),questions:u(s,o),poll:p(i)}}function l(e){if(!e)return;const t=(0,r.transformDetailedStatsData)(e);return t?{title:(0,o.getLang)("stories_feedback_stats_title"),extendedStats:t}:void 0}function h(e,t){if(!e?.count)return;const s=`replies${t}`,a=e.items.length,n=e.items.reduce(((e,t)=>e+(t.stories?.length||0)),0);let c="",d="";n>=i.STORIES_MAX_COUNT_REPLIES?c=(0,o.getLang)("stories_replies_count_title",i.STORIES_MAX_COUNT_REPLIES):(c=(0,o.getLang)("stories_replies_title",n),a!==n&&(d=(0,o.getLang)("stories_replies_title_authors",a)));const l={title:c,list:(0,r.transformStoryGetApiResponseToLegacyFormat)(e,s,!1),listName:s,source:"replies_list"};return d&&(l.additionalTitle=d),l}function _(e,t=0){if(!e?.count)return;const s=e.count;let i=(0,o.getLang)("stories_views_title",s,!0);if(t){i=`${(0,o.getLang)("stories_feedback_reactions_title",t,!0)} · ${i}`}return{title:i,nextFrom:e.next_from,hiddenReason:e.hidden_reason,viewsTotalCountText:(0,c.formatCount)(s),items:(r=e,r.items.map((e=>({name:(0,n.getOwnerFullName)(e.user),url:(0,n.getOwnerHref)(e.user),photoUrl:e.user?.photo_100||e.user?.photo_200||e.user?.photo_50||"",isLiked:e.is_liked,reaction_id:e.reaction_id??void 0,isVerified:Boolean(e.user?.verified)}))))};var r}function u(e,t){if(!e?.count)return;const{ownerId:s,itemId:i}=(0,a.splitRawId)(t);return{title:(0,o.getLang)("stories_questions_title"),items:(0,r.transformStoryQuestions)(e.items,e.profiles,s,i),count:e.count}}function p(e){if(!e)return;const t=(0,r.transformPoll)(e);return t?{title:(0,o.getLang)("voting_voting"),data:t}:void 0}},376235:(e,t,s)=>{s.d(t,{narrativeBoxEmitter:()=>l,showNarrativeBoxAsync:()=>_,showNarrativeChooseBoxAsync:()=>u,showNarrativeEditorBoxAsync:()=>h});var i=s(351118),r=s(298077),o=s(246429),a=s(558137),n=s(584053),c=s(319756),d=s(540462);const l=(0,a.makeSharedState)("NarrativeBoxEmitter",(()=>new n.Emitter),{version:1}),h=async(e,t={})=>{(0,o.showBoxLoader)();try{const{showNarrativeEditorBox:r}=await(0,i.asyncImportLoader)((()=>Promise.all([s.e(91498),s.e(89631),s.e(89887),s.e(35285),s.e(96050),s.e(2163),s.e(25700),s.e("langs/web/narratives_boxes")]).then(s.bind(s,914152))),3);r(e,t)}catch(e){(0,r.logError)(e)}finally{(0,o.hideBoxLoader)()}},_=async e=>{(0,o.showBoxLoader)();try{if((0,d.partConfigEnabled)("web_stories_narratives_redesign")){const{NarrativesListModelOpenService:t}=await(0,i.asyncImportLoader)((()=>Promise.all([s.e(74558),s.e("langs/web/NarrativesListModelOpenService")]).then(s.bind(s,360562))),3);(0,c.ensureDIRootWebContainer)().resolve(t).openModal(e)}else{const{showNarrativeBox:t}=await(0,i.asyncImportLoader)((()=>Promise.all([s.e(91498),s.e(89631),s.e(89887),s.e(35285),s.e(96050),s.e(2163),s.e(25700),s.e("langs/web/narratives_boxes")]).then(s.bind(s,914152))),3);t(e)}}catch(e){(0,r.logError)(e)}finally{(0,o.hideBoxLoader)()}},u=async e=>{(0,o.showBoxLoader)();try{const{showNarrativeChooseBox:t}=await(0,i.asyncImportLoader)((()=>Promise.all([s.e(91498),s.e(89631),s.e(89887),s.e(35285),s.e(96050),s.e(2163),s.e(25700),s.e("langs/web/narratives_boxes")]).then(s.bind(s,914152))),3);t(e)}catch(e){(0,r.logError)(e)}finally{(0,o.hideBoxLoader)()}}},420371:(e,t,s)=>{s.d(t,{highlightNarrativeBlock:()=>p,prepareStoriesForPublishing:()=>_,updateNarrativeBlock:()=>u,updateNarrativeSnippetsFromQueueByPost:()=>l.updateNarrativeSnippetsFromQueueByPost});var i=s(754866),r=s(246429),o=s(345235),a=s(866467),n=s(898848),c=s(468073),d=s(901089),l=s(777282);const h="update_narrative_block";function _(e){return e.map((e=>e.id)).join(",")}function u(e=!1){window.dispatchEvent(new CustomEvent(h));const t=(0,n.intval)(window.cur.oid);if(!c.Ranges.isUserId(t)||"profile"!==window.cur.module)if(window.cur.narrativeBlock){const e=document.getElementById(`narratives_module${t}_wrapper`);if(e)window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t},{onDone:t=>{const s=(0,n.intval)(window.cur.oid);if(t)(0,i.domReplaceEl)(e,t),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new window.NarrativeBlock);else{const t=e.parentElement;t?.children.length&&t?.children.length>1?e.remove():t?.remove(),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),delete window.cur.narrativeBlock}(0,d.removeStoryList)(`narratives${s}`)}});else if(window.cur.narrativeBlock.gallery){const e=document.querySelector('#group_tabs_content .group-tab-content[data-tab="narratives"]');e&&window.ajax.post("al_stories.php",{act:"get_narratives_tab",owner_id:t},{onDone:t=>{e.innerHTML=t}})}}else e&&function(e){window.boxQueue.hideAll();const t=document.querySelector("#box_layer_wrap"),s=document.querySelector("#box_loader");window.nav.reload({onDone:()=>{e&&e()},showProgress:()=>{(0,i.show)(t),(0,i.show)(s),(0,r.refreshBoxLoaderCoords)()},hideProgress:()=>{(0,i.hide)(t),(0,i.hide)(s)}})}((()=>{window.cur.needNarrativeOnboard=!0}))}function p(e){if(!e)return;const t=`narratives_module${window.vk.id}`;(0,o.highlightModule)({module:t,text:(0,a.getLang)("stories_narrative_block_onboarding_text"),onClose:()=>{delete window.cur.needNarrativeOnboard,window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"profile_narrative"})},autoCancelDelay:1e4,speed:600})}},777282:(e,t,s)=>{s.d(t,{updateNarrativeSnippetsFromQueueByPost:()=>a});var i=s(540462),r=s(298077);const o="NarrativeSnippet";function a(e){if(!window.vk.id)return;if(!(0,i.partConfigEnabled)("update_private_snippets_by_queue"))return;const t=Array.from(e.querySelectorAll(`.${o}`));if(!t.length)return;const s=[];t.forEach((e=>{if(!window.vk.id||!e.dataset.needUpdate)return;const t=e.dataset.narrativeRawId;t&&s.push({narrative_raw_id:t,from:e.dataset.from})})),s.length&&window.ajax.post("al_stories.php",{act:"get_narrative_snippets",narrative_snippets:JSON.stringify(s)},{onDone:e=>{t.forEach((t=>{t.dataset.narrativeRawId&&e[t.dataset.narrativeRawId]&&(t.outerHTML=e[t.dataset.narrativeRawId])}))},onFail:()=>((0,r.logError)(new Error("Fail: updateNarrativeSnippetFromQueueByPost")),!0)})}},386088:(e,t,s)=>{s.d(t,{BaseStory:()=>o});var i=s(298077),r=s(816469);class o{play(){if(this.paused=!1,this.isDestroyed()){if((0,r.isStoryViewerDebugLogEnabled)()){const e=new Error("BaseStory.play() method called on destroyed story class");(0,i.logError)(e,{environment:"stories"})}}else this.isLoaded()&&this.options.onPlay()}pause(){if(this.paused=!0,this.isDestroyed()){if((0,r.isStoryViewerDebugLogEnabled)()){const e=new Error("BaseStory.pause() method called on destroyed story class");(0,i.logError)(e,{environment:"stories"})}}else this.options.onPause()}isPaused(){return this.paused}isLoaded(){return this.loaded}isDestroyed(){return this._isDestroyed}getContainer(){if(this.isDestroyed()){const e="Received call to getContainer() on a destroyed story view instance";return(0,i.logError)(new Error(e),{environment:"stories"}),console.warn(`${e}, returning dummy element`),document.createElement("div")}const e=this._renderedElement||this.render();return this._renderedElement=e,e}onStartLoading(){this.isDestroyed()||this.options.onLoadingStart?.()}canPlay(){this.isLoaded()||this.isDestroyed()||(this.loaded=!0,this.startTs=Date.now(),this.options.onLoadingEnd?.(),this.isPaused()||"visible"!==document.visibilityState||this.play())}destroy(){this._renderedElement&&this._renderedElement.remove(),this._renderedElement=null,this._isDestroyed=!0}constructor(e){this.startTs=0,this.paused=!0,this.loaded=!1,this._isDestroyed=!1,this._renderedElement=null,this.options=e}}},128340:(e,t,s)=>{s.d(t,{DiscoverMetaStory:()=>g});var i=s(474848),r=s(440961),o=s(10746),a=s(407853),n=s(866467),c=s(646938),d=s(511944),l=s(576544),h=s(504035),_=s(298077),u=s(774459),p=s(724648),m=s(205338),v=s(540462);class g extends d.MetaStory{update(){if(this.isDestroyed())return;this.isFirstRender&&(this.isFirstRender=!1,(0,h.preloadDiscoverList)().then((()=>{this.update()})).catch((e=>{console.error(e),(0,_.logError)(new Error("Error with getDiscoverList in DiscoverMetaStory"+(e?`: ${e}`:"")))})));const e=(0,i.jsx)(o.MetaStory,{metaStoryInfo:(0,i.jsx)(a.MetaStoryInfo,{icon:(0,i.jsx)(p.Flex,{noWrap:!0,justify:"center",align:"center",className:"MetaStoryInfo__discoverIcon",children:(0,i.jsx)(l.Icon56CompassOutline,{})}),header:(0,n.getLang)("stories_interesting_stories"),subheader:(0,n.getLang)("stories_interesting_stories_description")}),list:this.block.grouped,listName:c.StoryListName.discover,source:c.StorySource.DISCOVER,isPaused:this.isPaused.bind(this),onLongTap:this.options.onLongTap,onScroll:this.onScroll,hasMore:this.hasMore,loadMore:this.loadMore,pause:this.options.pause,play:this.options.play,playNextStory:this.options.playNextStory,playPrevStory:this.options.playPrevStory,onTopScrolled:this.options.toggleMetaStoryTitle});(0,v.partConfigEnabled)("enable_create_root")&&this.wrapper?(this.root||(this.root=(0,m.createRoot)(this.wrapper)),this.root.render(e)):r.render(e,this.wrapper)}constructor(...e){super(...e),this.viewEventType="discover_feed_view",this.isFirstRender=!0,this.hasMore=()=>Boolean(this.block.next_from),this.loadMore=()=>this.hasMore()?(0,u.loadDiscover)(this.block.track_code,this.block.next_from).then((()=>{this.update()})):Promise.resolve()}}},567047:(e,t,s)=>{s.d(t,{LiveStory:()=>w});var i=s(954585),r=s(504035),o=s(538522),a=s(24516),n=s(809424),c=s(319756),d=s(432081),l=s(866467),h=s(754866),_=s(120101),u=s(468073),p=s(957994),m=s(702736),v=s(773439),g=s(41903),f=s(897976),y=s(270959),S=s(540462);class w extends i.MediaStory{async fetchVkVideoData(){const e=this.data.owner_id,t=this.data.video.video_id,i=new Promise(((i,r)=>{window.ajax.post("al_video.php?act=video_box",{al:1,module:"story",video:(0,o.joinRawId)({ownerId:e,itemId:t})},{onDone:(e,t,r,o)=>{this.mvData=o?.mvData,s._dG("mvcur",{chatMode:!0,maxChatReplyLength:this.mvData?.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData?.queue_params.key,qversion:this.mvData?.qversion}),i(void 0)},onFail:e=>((0,y.showFastBox)((0,l.getLang)("global_error"),e||(0,l.getLang)("global_error_occured")),r(e),!0)})}));try{const e=(await Promise.all([(0,g.apiStoriesGetById)({stories:this.data.raw_id}),i]).then((([e])=>e))).items[0].video,t=e?(0,f.constructVideoData)(e):void 0;if(t&&t.sources&&t.unitedVideoId){this.vkVideoPlayer?.destroy(),this.subscriptions.unsubscribe();const e=(0,c.ensureDIRootWebContainer)();this.vkVideoPlayer=new m.StoriesVkVideoPlayer({sources:t.sources,unitedVideoId:String(t.unitedVideoId),vkVideoConfig:this.vkVideoPlayerConfig},e.resolve(a.UserEnv),e.resolve(n.MetaData)),this.vkVideoPlayer.addContainerClass("stories_live_vkvideo"),this.vkVideoPlayer.addVideoClass("stories_live_vkvideo"),this.subscriptions.add(this.vkVideoPlayer.player.events.autoplaySoundProhibited$.subscribe((()=>{window.cur.storyLayer.setVolume(0)}))),await this.vkVideoPlayer.preload()}}catch{}}render(){this.onStartLoading(),this.el=(0,h.ce)("div",{className:"stories_live"});const e=(0,h.ce)("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(e),(0,S.partConfigEnabled)("stories_viewer_fix_lives_chat")?(this.el.appendChild((0,h.se)('<div id="react_rootVideoChatHideButton"></div>')),this.chatEl=(0,h.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages">\n            <div class="mv_chat_messages_list" id="react_rootVideoChat"></div>\n          </div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    ')):this.chatEl=(0,h.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&window.Videoview.hide(!1,!0),setTimeout((()=>{(0,d.showInlineVideo)(this.videoRaw,"",{autoplay:1,module:"story",onLoaded:()=>{this._onPlayerInited()}},!1,e)})),this.el}destroy(){super.destroy(),this._resetTimer(),s._dG("mvcur",{}),this.vkVideoPlayer?.destroy(),this.playerLive?.destroy(),this.subscriptions.unsubscribe(),this.player&&(this.player.destroy(),window.VideoChat?.destroy()),window.cur.storyLayer.sendNavigationStatEvents("live_player_close",!1),delete this.el}onLiveEnded(){this.liveEnded=!0,(0,h.hide)((0,h.geByClass1)("_error_msg",(0,h.geByClass1)("videoplayer_error")));let e=u.Ranges.isGroupId(this.mvData.oid)?(0,l.getLang)("stories_live_ended_desc_club"):(0,l.langSex)(this.mvData.author_sex,(0,l.getLang)("stories_live_ended_desc_user","raw"));e=e.replace("{name}",this.mvData.md_author);const t=u.Ranges.isGroupId(this.mvData.oid)?(0,l.getLang)("stories_live_ended_open_club"):(0,l.getLang)("stories_live_ended_open_user");(0,h.hide)(this.chatEl),this.vkVideoPlayer||(0,h.hide)((0,h.domByClass)(this.player.ui.thumb,"videoplayer_big_play_btn"));const s=window.cur.storyLayer.renderedStoryBlockKeys.length>1;this.el.appendChild((0,h.se)(`\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url(${this.mvData.author_photo})"></div>\n      <div class="stories_live_end_title">${(0,l.getLang)("stories_live_ended_title")}</div>\n      <div class="stories_live_end_desc">${e}</div>\n      <a href="${this.mvData.author_href}" class="stories_live_end_open_owner">${t}</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="${s?"":"display: none;"}">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">${(0,l.getLang)("stories_live_ended_watch_next")}</div>\n      </div>\n    </div>\n    `)),s&&setTimeout((()=>{this._startTimer()})),(0,_.markLiveInStoriesFinished)(this.data.owner_id)}pause(){}play(){!this.player&&!this.vkVideoPlayer||this.liveEnded||(super.play(),this.vkVideoPlayer?this.vkVideoPlayer.player.play():this.player&&this.player.play())}sendMessage(e,t){e.length>window.mvcur.maxChatReplyLength||((0,p.api)("video.createComment",{owner_id:this.data.video.owner_id,video_id:this.data.video.video_id,message:e}).catch((e=>{console.error(e)})),window.cur.storyLayer.activeStory.onAnswerSent(t))}volumeUpdate(){this.vkVideoPlayer?this.vkVideoPlayer.player.setVolume(r.getVolume()):this.player.setVolume(r.getVolume())}canPlay(){super.canPlay(),(0,h.setStyle)(this.el,"opacity",1)}async _onPlayerInited(){if(this.canPlay(),this.vkVideoPlayer||(this.player=window.cur.videoInlinePlayer),this.play(),window.cur.storyLayer.sendNavigationStatEvents("live_player_show",!1),!this.vkVideoPlayer&&window.browser.safari&&this.player.toggleMute(!0,!1),this.vkVideoPlayer||(this.mvData=window.Videoview.getMvData(),s._dG("mvcur",{chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion})),window.VideoChat)window.VideoChat.init(this.chatEl,{scrollHidden:!0});else{const{VideoChat:e}=await Promise.resolve().then(s.bind(s,992826));s._dG("VideoChat",e),e.init(this.chatEl,{scrollHidden:!0})}window.Videoview.queueCheckUpdates(this.mvData.queue_params)}_startTimer(){if(!window.CanvasRenderingContext2D)return;const e=(0,h.domByClass)(this.el,"_timer_canvas"),t=e.getContext("2d");t.lineWidth=6,t.lineCap="round",t.strokeStyle="#fff";const s=Date.now(),i=()=>{const e=(Date.now()-s)/5e3;e<1?(t.clearRect(0,0,100,100),t.beginPath(),t.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*e),t.stroke(),this._nextTO=setTimeout(i,16)):window.cur.storyLayer.nextStory()};(0,h.show)(e),this.timerInProgress=!0,i()}_resetTimer(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,(0,h.hide)((0,h.domByClass)(this.el,"_timer_canvas")))}setCurrentTime(){}getCurrentTime(){return 0}getDuration(){return 0}constructor(e,{vkVideoPlayerConfig:t,...s},i){super(e,s),this.subscriptions=new v.Subscription,this.wrapEl=i,this.videoRaw=`${this.data.video.owner_id}_${this.data.video.video_id}`,this.vkVideoPlayerConfig=t}}},954585:(e,t,s)=>{s.d(t,{MediaStory:()=>r});var i=s(386088);class r extends i.BaseStory{destroy(){clearTimeout(this.longLoadingTimer),this.longLoadingTimer=void 0,super.destroy()}getId(){return this.data.raw_id}getTrackCode(){return this.data.track_code}getDate(){return this.data.date}getViews(){return this.data.views}getReplies(){return this.data.replies}setViews(e){this.data.views=e}setReplies(e){this.data.repliesCountText=e}isOneTime(){return this.data.isOneTime&&this.data.authorId!==window.vk.id}getResearchData(){return this.data.research||null}onStartLoading(){this.isDestroyed()||(this.cancelLongLoadingCallbackTimer(),this.longLoadingTimer=setTimeout((()=>{this.isLoaded()||this.isDestroyed()||this.options.onLongLoading?.()}),1e3),super.onStartLoading())}cancelLongLoadingCallbackTimer(){clearTimeout(this.longLoadingTimer),this.longLoadingTimer=void 0}canPlay(){this.cancelLongLoadingCallbackTimer(),this.data.seenProgress&&this.isOneTime()&&this.setCurrentTime(+(this.data.seenProgress*this.getDuration()/100).toFixed(1)),super.canPlay()}_loadingError(){this._error("load")}_error(e){this.cancelLongLoadingCallbackTimer(),this.isDestroyed()||this.options.onError?.(e)}constructor(e,t,s){super(t),this.shouldDisplay=!0,this.longTapInfoWrapper=()=>{window.cur.storyLayer?.activeStory&&window.cur.storyLayer.activeStory.longTapHandle()},this.data=e;const{is_expired:i,is_deleted:r,is_private:o,isOneTimeSeen:a}=e;i?(this._error("expired"),this.shouldDisplay=!1):r?(this._error(s?"deleted-narrative":"deleted"),this.shouldDisplay=!1):a?(this._error("isOneTimeSeen"),this.shouldDisplay=!1):o&&(this._error(s?"private-narrative":"private"),this.shouldDisplay=!1)}}},511944:(e,t,s)=>{s.d(t,{MetaStory:()=>c});var i=s(46963),r=s(386088),o=s(440961),a=s(205338),n=s(540462);class c extends r.BaseStory{getCurrentTime(){return Date.now()-this.startTs}getDuration(){return i.STORY_DURATION}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(e=0){this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)}render(){return setTimeout((()=>{super.canPlay()})),null==this.wrapper&&(this.wrapper=document.createElement("div"),this.wrapper.classList.add("MetaStoryWrapper"),(0,n.partConfigEnabled)("enable_create_root")&&(this.root=(0,a.createRoot)(this.wrapper))),this.update(),this.wrapper}canPlay(){super.canPlay(),window.cur.storyLayer&&window.cur.storyLayer.sendNavigationStatEvents(this.viewEventType,!0)}getList(){return this.block.grouped}destroy(){super.destroy(),this.wrapper&&((0,n.partConfigEnabled)("enable_create_root")?(this.root?.unmount(),this.root=null):o.unmountComponentAtNode(this.wrapper),this.wrapper.remove(),this.wrapper=null)}constructor(e,t){super(t),this.pauseTime=0,this.wrapper=null,this.root=null,this.viewEventType="group_feed_view",this.isPausedByMetaScroll=!1,this.onScroll=e=>{this.isPausedByMetaScroll=e},this.block=e}}},878721:(e,t,s)=>{s.d(t,{PhotoStory:()=>n});var i=s(46963),r=s(270457),o=s(954585),a=s(754866);class n extends o.MediaStory{render(){this.onStartLoading();const{photo_url:e}=this.data;return this.photo=document.createElement("div"),this.photo.setAttribute("class","stories_photo"),this.shouldDisplay?((0,r.preloadImage)(e).then((e=>{this.photo&&!this.isDestroyed()&&((0,a.setStyle)(this.photo,"backgroundImage",`url('${e}')`),this.canPlay())})).catch((()=>{this._loadingError()})),this.photo):this.photo}destroy(){super.destroy(),this.photo=null}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(e=0){this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)}getCurrentTime(){return Date.now()-this.startTs}getDuration(){return i.STORY_DURATION}canPlay(){super.canPlay(),window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0}),(0,a.setStyle)(this.photo,"opacity",1)}constructor(e,t,s){super(e,t,s),this.photo=null,this.pauseTime=0}}},786858:(e,t,s)=>{s.d(t,{VideoStory:()=>l});var i=s(954585),r=s(504035),o=s(754866),a=s(983567),n=s(972332),c=s(505067),d=s(540462);class l extends i.MediaStory{render(){this.onStartLoading();const{video_url:e}=this.data;return this.video=this.videoLoader?this.videoLoader.getVideoElement(e):document.createElement("video"),this.video.setAttribute("class","stories_video"),this.video.setAttribute("autoplay","false"),this.video.setAttribute("volume",(0,a.getAudioPlayer)().getVolume()),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),(0,n.addEvent)(this.video,"error",(()=>{this.isLoaded()?this._trackVideoErrorEvent():this._loadingError()})),this.shouldDisplay?(this.volumeUpdate(),this.videoLoader&&this.videoLoader.canPlay(e)?(this.video.currentTime=0,this.canPlay()):(0,n.addEvent)(this.video,"canplay",this.canPlay.bind(this)),this.video.src||(this.video.src=e),this.video):this.video}destroy(){super.destroy(),this.video&&((0,n.removeEvent)(this.video),this.video.remove(),this.videoLoader?this.videoLoader.detachAndMarkForDisposal(this.data.video_url):(this.video.src="",this.video.load()),this.video=null)}play(){if(super.play(),this.isLoaded()&&this.video){const e=this.video.play();void 0!==e&&e.catch((()=>{this.isDestroyed()||this.options.onAutoPlayFail?.()}))}}pause(){super.pause(),this.video&&this.video.pause()}mute(){this.video&&(this.video.muted=!0)}setCurrentTime(e=0){e=+(e/1e3).toFixed(1),this.isLoaded()&&this.video&&this.video.currentTime<e&&(this.video.currentTime=e)}getCurrentTime(){return this.video?1e3*this.video.currentTime:0}getDuration(){let e=this.video?1e3*this.video.duration:0;return e===1/0&&(0,d.partConfigEnabled)("story_viewer_get_duration_from_api_web_mvk")&&this.data.video?.duration&&(e=1e3*this.data.video.duration),e}volumeUpdate(){this.video&&(this.video.volume=r.getVolume())}canPlay(){super.canPlay(),!this.isFirstChunkLoaded&&window.cur.storyLayer&&(this.isFirstChunkLoaded=!0,window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0})),(0,o.setStyle)(this.video,"opacity",1),(0,n.removeEvent)(this.video,"canplay")}_trackVideoErrorEvent(){const e=this.video?.error;null!=e&&this.isFirstChunkLoaded&&(0,c.trackStoryVideoError)({error:e})}constructor(e,t,s,i){super(e,t,s),this.video=null,this.isFirstChunkLoaded=!1,this.videoLoader=null,this.videoLoader=i}}},450629:(e,t,s)=>{s.d(t,{Stories:()=>P});var i=s(646938),r=s(100101),o=s(270457),a=s(547754),n=s(856771),c=s(754866),d=s(257168),l=s(972332),h=s(542789),_=s(866467),u=s(478752),p=s(246429),m=s(270959),v=s(683234),g=s(298077),f=s(504035),y=s(122442),S=s(210816),w=s(41903),b=s(128645),k=s(894675),E=s(901089),C=s(511356),I=s(319756),T=s(262897),L=s(540462),M=s(762673),A=s(633009),x=s(873900);const P={fetchVideoPlayerConfig:()=>Promise.resolve(void 0),setVideoPlayerConfigLoader(e){this.fetchVideoPlayerConfig=e},show(e,t={},s){if(P._setLastShownStoryRaw(e),(0,L.partConfigEnabled)("stories_move_to_story_add_web")&&t.fromUrl&&window.cur.storyLayer){let[t,s]=this.parseList(e);if(t&&s&&window.cur.storyLayer.renderedStoryList){if(window.cur.storyLayer.moveToStory(t,s))return}if(a.getCount()>1){if(a.getPrevLayer().getStoryRaw()===(0,x.getIdentityRawId)({ownerId:t,id:s}))return void(0,A.cancelStackPop)()}}P.getPreparedList(e,s,t).then((({ownerId:s,storyId:i,uniqKey:o,blockKey:n,listName:c,list:d,extra:l,vkVideoPlayerConfig:h})=>{if(a.isOpeningLocked())return;a.checkAndPrepareBoxQueue(t);const _=new r.StoryLayer(s,i,o,n,c,d,l,t?{...t,vkVideoPlayerConfig:h}:{vkVideoPlayerConfig:h},{initialRawListName:e,onHidden:()=>{(0,C.trackStoryViewerClosed)({nonce:e})}});a.addLayer(_,t,(()=>{_.initialListNameRaw&&_.firstActiveStoryRawId&&(0,C.trackStoryOpened)({nonce:_.initialListNameRaw,storyDetails:_.getStoryDetailsForPerfMetrics(_.firstActiveStoryRawId)})}))})).catch((e=>{console.error(e),(0,g.logError)(e),(0,m.showFastBox)((0,_.getLang)("global_error"),(0,_.getLang)("global_unknown_error"))}))},initializeLastSeenStories(){P._lastShownStoryRaw&&(0,n.showStory)(P._lastShownStoryRaw)},_lastShownStoryRaw:"",_setLastShownStoryRaw(e){P._lastShownStoryRaw=e},_getUnreadStory(e,t){e=(0,u.intval)(e);let s=!1;for(let i=0;i<t.length;i++)if(t[i].author.id===e){const e=t[i].items;for(let t=0;t<e.length;t++)if(e[t].unread){s=e[t];break}s||(s=e[0]);break}return s},getPreparedList(e,t,s){return this.getPreparedListWithoutVideoPlayerConfig(e,t,s)},getPreparedListWithoutVideoPlayerConfig(e,t,s){return new Promise(((r,o)=>{let[a,n,c,d,l,h]=this.parseList(e);if(!l&&a&&n&&(l=`${a}_${n}`),!a&&!d&&!l)return void o(`Can not find a correct block key or list name in: ${e}`);let _={ownerId:(0,u.intval)(a),storyId:(0,u.intval)(n),uniqKey:c||"",blockKey:d||"",listName:l,extra:h,list:[]};if(!t)switch(l){case i.StoryListName.feed:t=(0,E.getStoryList)(l);break;case i.StoryListName.discover:if(!(t=(0,E.getStoryList)(l))){let e;const s=(0,E.getStoryList)(i.StoryListName.feed);if(s&&(e=s.find((e=>e.type===i.StoryBlockType.discover)),e?.grouped&&(t=e.grouped)),!t)return void(0,f.preloadDiscoverList)(!0).then((e=>{_.list=e,r(_)})).catch(o)}break;default:t=(0,E.getStoryList)(l)}const p=e=>(0,L.partConfigEnabled)("stories_open_web_add_check_author")&&a&&n&&l!==`${a}_${n}`&&e&&!e.find((e=>e.author?.id===(0,u.intval)(a))),m=()=>{P.fetchList(l,a,h,s).then((e=>{e&&(p(e)?(l=`${a}_${n}`,m()):(_.list=e,r(_)))})).catch(o)};p(t)&&(t=void 0,l=`${a}_${n}`),t?(_.list=t,r(_)):m()}))},setList(e,t){window.cur[`stories_list_${e}`]=t},fetchList(e,t,s,i){const r=i?.trackCode,o=s?(0,y.parseExtra)(s):{};return r&&(o.trackCode=r),i?.narrativeRawIds&&(o.narrativeRawIds=i.narrativeRawIds),(0,p.showBoxLoader)(),(0,y.fetchList)(e,o).then((({list:t})=>(P.setList(e,t),t))).catch((t=>{console.error(t),(0,S.logStoriesError)({error:t,additionalText:"could not fetch list",extra:{listName:e}})})).finally((()=>{(0,p.hideBoxLoader)()}))},removeList(e){delete window.cur[`stories_list_${e}`]},parseList:e=>(0,M.parseList)(e),updateFeedStories(){(0,b.dispatchListModifiedEvent)({listName:i.StoryListName.feed})},showBlackList(){(0,k.showStoryBlackList)()},blackListItemClick(e,t){(0,l.cancelEvent)(t);const s=(0,u.intval)((0,c.attr)(e,"data-id"));window.cur.storiesBlackListShown[s]?(delete window.cur.storiesBlackListShown[s],(0,c.removeClass)(e,"olist_item_wrap_on")):(window.cur.storiesBlackListShown[s]=1,(0,c.addClass)(e,"olist_item_wrap_on"))},saveBlackList(e){const t=Object.keys(window.cur.storiesBlackListShown);0!==t.length?((0,v.lockButton)(e),w.storiesService.unbanOwnerFx({owners_ids:t.join(",")}).then((()=>{P.updateFeedStories(),(0,p.curBox)()?.hide()})).finally((()=>{(0,v.unlockButton)(e)}))):(0,p.curBox)()?.hide()},blacklistUpdateUsers(e){const t=e;if(e=(0,u.trim)(e).toLowerCase(),window.cur.storiesBlacklistLastQ===e)return;window.cur.storiesBlacklistLastQ=e;const s=e?window.cur.storiesIndexer.search(e):window.cur.storiesBlackList.users,i=[];if(e)for(let t=0;t<e.length;t++)i.push(e.substr(t,1));const r=new RegExp(i.join(".*?"),"i");let o="";for(let t=0;t<s.length;t++){const i=s[t],a=e?i.name.replace(r,(e=>`<em>${e}</em>`)):i.name;o+=window.cur.storiesBlackList.tpl.replace(/\{id\}/g,i.id).replace("{photo}",i.photo).replace("{name}",a).replace("{href}",i.href).replace("{class_name}",window.cur.storiesBlackListShown[i.id]?" olist_item_wrap_on":"")}o||(o=`<div class="no_rows">${(0,_.getLang)("global_search_not_found").replace("{search}",(0,u.clean)(t))}</div>`),(0,c.val)((0,c.geByClass1)("olist","stories_black_list_result"),o)},blackListInit(e){window.cur.storiesBlackListShown={},window.cur.storiesBlackList=e;let t=!1;(0,p.curBox)()?.setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),window.cur.storiesBlackListScroll&&window.cur.storiesBlackListScroll.destroy(),(0,I.ensureDIRootWebContainer)().resolve(T.StoryViewStats).send({event_type:t?"save_hide_list":"cancel_hide_list",story_id:0,story_owner_id:0,view_entry_point:"feed",nav_screen:"feed",story_type:"",time:Number(new Date)})}}).removeButtons(),window.cur.storiesBlackList.users.length?(window.cur.storiesBlacklistLastQ=!1,window.cur.storiesIndexer=new h.vkIndexer(window.cur.storiesBlackList.users,(e=>e.name),(()=>{P.blacklistUpdateUsers("")})),d.default.init("stories_blacklist"),d.default.focus("stories_blacklist"),(0,p.curBox)()?.addButton((0,_.getLang)("global_save"),(()=>{t=!0,this.saveBlackList()})).addButton((0,_.getLang)("global_cancel"),void 0,"no")):(0,p.curBox)()?.addButton((0,_.getLang)("global_close"))},preloadUrl(e){(0,o.preloadImage)(e).catch((e=>{(0,g.logError)(e)}))},groupStoriesBlockUpdate(){const e=(0,E.getStoryList)("group_stories"),t=e&&e[0]&&e[0].items;if(!t)return;let s=0;for(let e=0;e<t.length;e++){t[e].unread&&s++}const i=(0,c.geByClass1)("stories_groups_block_stories_wrap"),r=(0,c.geByClass1)("stories_groups_block_stories_button",i);(0,c.toggleClass)(i,"has_unread",s>0),(0,c.toggleClass)(i,"has_stories",t.length>0),(0,c.toggleClass)(r,"has_stories",t.length>0);const o=(0,u.clone)(window.cur.storiesPreviews);let a=o.splice(o.length-s,3);a.length<3&&(a=a.concat(o.slice(0,3-a.length))),a.reverse();let n="";for(let e=a.length-1;e>=0;e--)n+=window.cur.storiesPreviewsRowHtml.replace("{url}",a[e]);(0,c.val)((0,c.geByClass1)("stories_groups_block_stories_rows",i),n)},isLiveShown(e){if(!window.cur.storyLayer||!window.cur.storyLayer.activeStory||!window.cur.storyLayer.activeStory.isActiveLive())return!1;return window.cur.storyLayer.activeStory.story.videoRaw===e},activeLiveEnded(e){window.cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount(e){const t=e?(0,_.getLang)("stories_live_N_watching",e,!0):"";window.cur.storyLayer.activeStory.updateLiveViewersCount(t)}}},73575:(e,t,s)=>{s.d(t,{STORY_BLOCK_SPACING:()=>o,STORY_HORIZONTAL_RATIO:()=>i,STORY_MAX_WIDTH:()=>a,STORY_MIN_WIDTH:()=>n,STORY_VERTICAL_RATIO:()=>r});const i=.563,r=1/i,o=40,a=540,n=320},504035:(e,t,s)=>{s.d(t,{createUserStackMaskIfNeeded:()=>p,getStoryBlockKey:()=>u,getVolume:()=>d,isDiscoverLoading:()=>_,preloadDiscoverList:()=>h,setVolume:()=>l});var i=s(646938),r=s(754866),o=s(342018),a=s(246429),n=s(774459),c=s(901089);function d(){const e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function l(e){window.ls.set("video_volume",e)}function h(e=!1){if(window.cur.storiesDiscoverFetchingPromise)return window.cur.storiesDiscoverFetchingPromise;let t,s;const r=(0,c.getStoryList)(i.StoryListName.feed);return r&&(s=r.find((e=>e.type===i.StoryBlockType.discover)),s&&(t=s.track_code)),e&&(0,a.showBoxLoader)(),window.cur.storiesDiscoverFetchingPromise=(0,n.loadDiscover)(t).then((()=>{let e;const t=(0,c.getStoryList)(i.StoryListName.feed);if(t){const s=t.find((e=>e.type===i.StoryBlockType.discover));s?.grouped&&(e=s?.grouped)}return e||Promise.reject(new Error("empty discover list"))})).finally((()=>{e&&(0,a.hideBoxLoader)(),delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise}function _(){return Boolean(window.cur.storiesDiscoverFetchingPromise)}function u(e){return e?.author?.id&&e?.narrative?.id?`${e.author.id}narrative${e.narrative?.id}`:`${e.id}`}function p(){const e="users_stack_stories_mask";let t=document.getElementById(e);t||(t=(0,r.se)(`\n        <svg width="0" height="0">\n          <defs>\n            <clipPath id="${e}">\n              <path transform="translate(1.5 0)" d="M1.20772 8C1.20772 6.32671 0.768742 4.75626 0 3.39821C1.44342 1.34278 3.8277 0 6.52463 0C10.9293 0 14.5 3.58172 14.5 8C14.5 12.4183 10.9293 16 6.52463 16C3.8277 16 1.44342 14.6572 0 12.6018C0.768742 11.2437 1.20772 9.6733 1.20772 8Z"></path>\n            </clipPath>\n          </defs>  \n        </svg>  \n      `),t&&(document.body.appendChild(t),(0,o.pushNavDestroy)((()=>{t?.remove()}))))}},335851:(e,t,s)=>{s.d(t,{Story:()=>ke});var i=s(474848),r=s(646938),o=s(296540),a=s(440961),n=s(270457),c=s(547754),d=s(205338),l=s(357794),h=s(938130),_=s(954585),u=s(511944),p=s(128340),m=s(567047),v=s(878721),g=s(786858),f=s(628459),y=s(869071),S=s(673801),w=s(348453),b=s(754866),k=s(489245),E=s(250598),C=s(633009),I=s(683234),T=s(972332),L=s(478752),M=s(102088),A=s(270959),x=s(246429),P=s(342879),R=s(226220),O=s(298077),N=s(540462),B=s(420371),D=s(194025),F=s(65759),j=s(526708),U=s(855723),V=s(334206),H=s(705600),W=s(29821),K=s(441413),G=s(871610),$=s(504035),q=s(957994),z=s(216497),Q=s(578392),Y=s(731860),X=s(723723),J=s(751268),Z=s(865708),ee=s(716279),te=s(468073),se=s(54170),ie=s(866467),re=s(41903),oe=s(928410),ae=s(21830),ne=s(809152),ce=s(128645),de=s(667440),le=s(211413),he=s(901089),_e=s(979554),ue=s(376235),pe=s(182807),me=s(166878),ve=s(319756),ge=s(97650),fe=s(873900),ye=s(28233),Se=s(536490),we=s(693080);const be=new pe.default({maxSize:3});class ke{destroy(){this._destroyStory();const e=this.wrapEl.querySelector(".stories_author_avatar");this._unmount(e),(0,T.removeEvent)((0,b.geByClass1)("stories_item_cont",this.contWrap)),(0,T.removeEvent)(this.shareButton),delete this.shareButton,(0,T.removeEvent)(this.followBtn),delete this.followBtn,(0,T.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);const t=(0,b.geByClass)("stories_time_line",this.timeLineEl);for(let e=0;e<t.length;e++)(0,T.removeEvent)(t[e]);(0,T.removeEvent)(this.viewsButton),(0,T.removeEvent)((0,b.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.descEl,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl,(0,f.clear)()}_destroyTimeLine(){const e=(0,b.geByClass)("stories_time_line",this.timeLineEl);for(let t=0;t<e.length;t++)(0,T.removeEvent)(e[t])}getOwnerId(){return this.data?.author?.id}getIndex(){return this.index}getRawId(e=!1){if(this.story&&this.story instanceof _.MediaStory)return this.story.getId();if(e){const e=this.data.items[this.index];if(e&&e.raw_id)return e.raw_id}return""}getStoryId(){const e=this.getRawId();return Number(e?.split("_")?.[1])||0}getTrackCode(){if(this.story instanceof _.MediaStory)return this.story.getTrackCode()}getResearchData(){return this.story instanceof _.MediaStory?this.story.getResearchData():null}getReadHash(){return this.data.read_hash}getItems(){return this.data.items}getItemsLength(){return this.getItems().length}getFullItemsLength(){return this.getItems().length+(this.hasMetaStory()?1:0)}isEmpty(){return 0===this.getFullItemsLength()}getStoryAtIndex(e){const t=this.data.items[e];return t||null}render(){this.wrapEl=(0,b.ce)("div",{className:"stories_item"}),this.contWrap=(0,b.ce)("div",{className:"stories_item_cont_wrap"}),this.contStickers=(0,b.ce)("div",{className:"stories_item_cont_sticker"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);const e=(0,b.ce)("div",{className:"stories_item_cont"});return(0,T.addEvent)(e,"mousedown",(e=>{0===e.button&&this._onMouseDownHandle(e.target)})),(0,T.addEvent)(e,"mouseup",(e=>{0===e.button&&this._onMouseUpHandle(e.target)})),(0,T.addEvent)(e,"contextmenu",(e=>{(0,T.cancelEvent)(e),this._onMouseCancelHandle()})),this.contWrap.appendChild(e),this.contWrap.appendChild(this.renderHeader()),this.storySendFormOverlay=(0,b.ce)("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild((0,b.ce)("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),window.cur.noStoriesBack||(this.backButton=(0,b.ce)("div",{className:"stories_item_back"}),e.appendChild(this.backButton)),this.inlineLoader=e.appendChild((0,b.ce)("div",{className:"stories_inline_loader",innerHTML:(0,R.getProgressHtml)()})),this.contWrap.appendChild((0,b.ce)("div",{className:"stories_play_button video_thumb_play",onclick:()=>{this.story&&this.story.play()}})),this.isActiveLive()?(0,b.addClass)(this.wrapEl,"live"):this.data.type!==r.StoryBlockType.discover&&this._initTimeLine(),(0,b.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl}updateMetaStory(){this.isActiveMetaStory()&&this.story instanceof u.MetaStory&&this.story.update()}resetNewRepliesCounterIfNeeded(){if(this.feedback?.replies?.listName){const e=this.getCurStoryData();if(e?.replies_new_counter){const t=(0,he.getStoryList)(this.feedback.replies.listName);if(t){Boolean(t.find((e=>e.items.find((e=>e.unread)))))||(e.replies_new_counter=0)}}}}_canForceDeleteStories(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted}_initTimeLine(){this.timeLineEl&&(this._destroyTimeLine(),(0,b.re)(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())}_isActionsShown(){const e=(0,b.domClosest)("_ui_menu_wrap",this.wrapEl);return(0,b.hasClass)(e,"shown")}_renderPreview(){return(0,b.se)('<div class="stories_preview"></div>')}_renderMessage(e){return(0,b.se)(`<div class="stories_message">\n  <div class="stories_message_text">${e}</div>\n</div>`)}showMessage(e){(0,b.re)((0,b.geByClass1)("stories_message",this.contWrap));const t=this._renderMessage(e);return this.contWrap.appendChild(t),clearTimeout(this.showMessageTimer),new Promise((e=>{this.showMessageTimer=setTimeout((()=>{this.contWrap.removeChild(t),e()}),3e3)}))}_setPreview(e,t){const{index:s}=this,i=this.data.items[s];if(!i)return;function r(e,s,i){(0,b.setStyle)(e,"backgroundImage",`url(${s})`),(0,b.setStyle)(e,"backgroundSize","stretch"===i?"100% 100%":i),(0,b.setStyle)(e,"opacity",1),t&&setTimeout(t,0)}if(this.renderAvatar(),!(e=e||(0,b.geByClass1)("stories_preview",this.contWrap)))return;const o=i.preview_url||null,a=i.preview_thumb_hash||null;if(a){const t=this.curPreviewThumbhash===a;if(this.curPreviewThumbhash=a,this.curPreviewUrl=null,!t){const t=be.get(a)||(0,ee.decodeThumbhash)(a);this.isActive&&be.set(a,t),r(e,t,"stretch")}}else{const t=this.curPreviewUrl===o;if(this.curPreviewThumbhash=null,this.curPreviewUrl=o,t)return;(0,b.setStyle)(e,"backgroundImage","");const s=e;o&&(0,n.preloadImage)(o).then((e=>{this.curPreviewUrl===o&&r(s,e,"cover")})).catch((e=>(0,O.logError)(e)))}}renderHeader(){if(this.storiesHeader=document.createElement("div"),this.storiesHeader.classList.add("stories_header"),this.storiesHeaderContent=document.createElement("div"),this.storiesHeaderContent.classList.add("stories_header_content"),this.storiesHeader.appendChild(this.storiesHeaderContent),this.data.type===r.StoryBlockType.discover){const e=(0,b.se)(`<span class="MetaStoryBlockTitle">${(0,ie.getLang)("stories_block_discover")}</span>`);this.storiesHeaderContent.appendChild(e)}if(!this.data.author)return this.storiesHeader;const{href:e,name:t,verify:s}=this.data.author,i=this.getCurStoryData(),o=this.getCurrentNarrative();let a,n,c="_self",d="";this.layer.listName.includes("place")&&(c="_blank"),a=this.data.is_narrative?o?.coverUrl:this.data.author.photo;let l=`<a href="${e}" target="${c}" class="stories_author_avatar" data-testid="story_author_avatar"></a>`;d=o&&i?`<div class="StoryInfo__title"><span>${o.title}</span></div>`:`<a class="StoryInfo__title StoryInfo__title--author" href="${e}" target="${c}">${t}${s||""}</a>`,n=this.getHeaderBottomHtml();const h=`\n      <div class="stories_author_cont">\n        ${l}\n        <div class="StoryInfo">\n          <div class="StoryInfo__top">\n            ${d}\n          </div>\n          <div class="StoryInfo__subtitle">${n}</div>\n        </div>\n      </div>`,_=(0,b.se)(`\n      <div class="stories_author_cont_wrap">\n        <div class="stories_author_inner">${h}</div>\n        <div class="stories_author_buttons"></div>\n       </div>\n    `);return this.avatarWrap=_.querySelector(".stories_author_avatar"),this.avatarPhoto=a,(0,T.addEvent)(_,"click",(e=>{(0,b.domClosestByTag)("a",e.target)&&this.layer.sendNavigationStatEvents("go_to_author")})),this.descEl=(0,b.geByClass1)("StoryInfo__subtitle",_),this.authorButtons=(0,b.geByClass1)("stories_author_buttons",_),this.storiesHeaderContent.appendChild(_),this.authorImg=_.querySelector(".stories_author_avatar"),this.storiesHeader}getHeaderBottomHtml(){if(!this.data.author)return;const{href:e,also_subscribed:t}=this.data.author,i=this.getCurStoryData(),o=this.getCurrentNarrative();let a="",n="_self";this.layer.listName.includes("place")&&(n="_blank");let c="";const d="StoryInfoLink";if(i){if(a=i.date,i.maskOwnerDomain){const e=i.maskOwnerDomain,t=`<a href='/${e}' target='${n}' class="StoryInfo__maskLink ${d}">@${e}</a>`;c=`<span class="StoryInfo__maskInfo">${(0,M.langSex)(i.maskOwnerSex||z.BaseSexEnumNames.UNKNOWN,(0,ie.getLang)("stories_mask_from","raw")).replace("{domain}",t)}</span><span class='dvd'></span>`}if(i.isPromo)a=i.promoCaption;else if(o)a=`<span class='dvd'></span><span>${a}</span>`,a=`${c}<a href='${e}' target='${n}' class='StoryInfo__narrativeOwnerName ${d}'>${o.ownerName}</a>${a}`;else if(i.isAds)a=(0,ie.getLang)("stories_is_ad");else if(t){(0,$.createUserStackMaskIfNeeded)();let e="",s="",i="";t.owners.forEach((e=>{s+=`\n            <a href="${e.href}" class="StorySubscribedUsersStack__photo ${d}" title="${e.name}">\n              <img src="${e.photo_url}" class="StorySubscribedUsersStack__img" alt="">\n            </a>\n          `})),e=`<div class="StorySubscribedUsersStack__photos">${s}</div>`;const r=t.owners[0],o=`<a href="${r.href}" class="StorySubscribedUsersStack__link ${d}">${r.name}</a>`,n=t.total_count;i=1===n?(0,M.langStr)((0,M.langSex)(r.sex,(0,ie.getLang)("stories_also_subscribed_one_person","raw")),"name",o):(0,M.langStr)((0,ie.getLang)("stories_also_subscribed_multiple_persons"),"name",o,"total_count",n-1),i=`<div class="StorySubscribedUsersStack__label">${i}</div>`,a=`<div class="StorySubscribedUsersStack">${e}${i}</div>`}else if(c)a=`${c}<span>${a}</span>`;else if(i.memory_type)if("avatar"===i.memory_type){const e=i.clickable_stickers?.stickers?.find((e=>e.type===r.StickerTypes.photo)),t=(0,fe.getIdentityRawId)({ownerId:e?.photoOwnerId??0,id:e?.photoId??0});s._dG("onNewProfilePhotoMetaLabelClick",(()=>{this.layer.sendProductAnalyticEvents(we.StoryStatsEvent.ClickToMetaAvatar)})),a=`<a href="/photo${t}" class="StoryInfo__newProfilePhoto" target="_blank" onclick="window.onNewProfilePhotoMetaLabelClick()">${(0,ie.getLang)("stories_viewer_new_profile_photo")}</a>`}else{let e=[(0,ie.getLang)("stories_viewer_memories_label"),(0,Se.getStoryMemoryDate)(i.memory_date)].join(" · ");e+=(0,j.getIcon12ChevronRight)().icon,s._dG("onMemoriesMetaLabelClick",(()=>{this.layer.sendProductAnalyticEvents(we.StoryStatsEvent.ClickToMetaMemories)})),a=`<a href="/memories" class="StoryInfo__memoriesLabel" target="_blank" onclick="window.onMemoriesMetaLabelClick()">${e}</a>`}if(i.is_authors_ads&&i.caption&&(a=`${a}<span class='dvd'></span><span data-testid="story-is_ads">${i.caption}</span>`),i.isProfileQuestion){const{icon:e}=(0,U.getIcon12Question)(),t=`<span class="StoryInfo__icon">${e}</span>${(0,ie.getLang)("stories_profile_question_label")}`;a=`${`<a href="/question?ref=story" class="StoryProfileQuestionLink ${d}" target="_blank">${t}</a>`}<span class='dvd'></span>${a}`}}return a}_renderFollowButton(){const e=this.data.author;if(!e)return;let t;return t=te.Ranges.isUserId(e.id)?(0,V.getIcon24UserAddOutline)():(0,H.getIcon24AddSquareOutline)(),this.followBtn=(0,b.ce)("div",{className:"StoryViewerHeaderButton"}),this.followBtn.setAttribute("data-testid",e.can_follow?"story_header_follow":"story_header_unfollow"),this.followBtn.innerHTML=t.icon,(0,T.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),(0,T.addEvent)(this.followBtn,"mouseover",(()=>{if(!e)return;const t=e.can_follow?(0,ie.getLang)("stories_follow"):(0,ie.getLang)("stories_unfollow");(0,P.showTooltip)(this.followBtn,{black:1,center:1,forcetodown:!0,shift:[0,13,6],text:t,appendEl:this.contWrap})})),this.followBtn}renderActionButtons(){return this.actionButtons=document.createElement("div"),this.actionButtons.classList.add("StoryViewerHeaderButton"),this.actionButtons.setAttribute("data-testid","story_header_menu_button"),this._render((0,i.jsx)("div",{className:"StoryViewerHeaderButtonInner",children:(0,i.jsx)(G.ActionsButton,{story:this})}),this.actionButtons),this.actionButtons}updateActionButtons(){this.actionButtons&&this._render((0,i.jsx)("div",{className:"StoryViewerHeaderButtonInner",children:(0,i.jsx)(G.ActionsButton,{story:this})}),this.actionButtons)}destroyActionButton(){this.actionButtons&&(this._unmount(this.actionButtons),delete this.actionButtons)}_renderTimeLine(){this.timeLineEl=(0,b.ce)("div",{className:"stories_time_line"+(this.data.items.length>50?" stories_time_line_many_items":"")}),this.timeLineEl.setAttribute("data-testid","story_time_line");const e=this.data?.author?.id,t=this.data.items[0]?.isOneTime,s=s=>{const i=(0,b.ce)("div",{className:"stories_time_line_item"});i.setAttribute("data-testid","story_time_line_item");(0,T.addEvent)(i,"click",(()=>{this.layer.sendNavigationStatEvents("go_to_story_click"),this.changeStory(s)}));const r=(0,b.ce)("div",{className:"stories_time_line_item_cont"});r.appendChild((0,b.ce)("div",{className:"stories_time_line_item_cont_active"})),i.appendChild(r),t&&window.vk.id!==e&&(i.appendChild((0,b.ce)("div",{className:"stories_time_line_item_wick"})),(0,b.addClass)(i,"stories_time_line_item_is_one_time")),this.timeLineEl.appendChild(i)};return this.data.items.forEach(((e,t)=>s(t))),this.hasMetaStory()&&s(this.data.items.length),this.timeLineEl}isPaused(){return!this.story||this.story.isPaused()}isLoaded(){return!this.story||this.story.isLoaded()}_onMouseDownHandle(e){this.pressedStory=e,this.isActive&&(this.isLocked()||((0,b.hasClass)(e,"stories_item_cont")||(0,b.hasClass)(e,"stories_item_back")||(0,b.hasClass)(e,"StoryStickers__disableArea")||e.closest(`.${_e.StickerTemplateSelectorStory}`)||(0,b.hasClass)(e,"StorySticker"))&&!this.downTs&&(this.downTs=(0,L.vkNow)(),this.longTapTimer=setTimeout(this.longTapHandle.bind(this),w.LONG_PRESS_DELAY_MS)))}_onMouseCancelHandle(){clearTimeout(this.longTapTimer),this.downTs=null}_onMouseUpHandle(e,t=()=>{}){clearTimeout(this.longTapTimer);const{downTs:s}=this;if(this.downTs=null,e!==this.pressedStory)return void(this.isPaused()&&this.layer.playStory());this.pressedStory=null;const i=null==s||(0,L.vkNow)()-s>=w.LONG_PRESS_DELAY_MS,r=i||this.isSendFormFocused||(0,b.hasClass)(this.wrapEl,"autoplay_failed");if(this.isActive&&((0,b.hasClass)(e,"stories_item_back")||(0,b.hasClass)(e,"StoryStickers__disableArea--left"))&&!r&&!this.isTooltipOpened())return this.prevStory();if(i||!(0,b.hasClass)(e,"StorySticker")&&!e.closest(`.${_e.StickerTemplateSelectorStory}`)){if((0,b.hasClass)(e,"stories_item_cont")||(0,b.hasClass)(e,"stories_item_back")||(0,b.hasClass)(e,"StoryStickers__disableArea")||(0,b.hasClass)(e,"StorySticker"))if(this.isFeedbackTooltipShow)this.hideFeedbackTooltip();else if((0,b.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this.hideTooltip();else{if(!this.isActive){if(this.id>=this.layer.activeStory.id){let e=[];for(let t of this.layer.activeStory.data.items)(0,N.partConfigEnabled)("frontend.stories_unread_check")&&(0,ye.needNotShowStory)(t)||(e.push(t.raw_id),t.unread=!1);e.length&&((0,ce.dispatchStoriesSeenEvent)([{blockId:this.layer.getBlockKey(this.layer.activeStory.data),storyRawIdSet:new Set(e)}]),this.layer.markStoriesSkipped(e))}const e=this.layer.renderedStoryBlockKeys;return e.indexOf(this.layer.getBlockKey(this.data))>e.indexOf(this.layer.blockKey)?this.layer.sendNavigationStatEvents("go_to_next_author"):this.layer.sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}r?this.isPaused()&&this.playStory(!1,!!s):this._onPlayEnd()}}else t()}_markSeenIfNeeded(){this.isActiveStoryOneTime()&&this._markSeenCurrentStory()}_markSeenCurrentStory(){this.opts.onSeen(this.layer.activeStory)}isLocked(){return!!(this.getSendText()||!this.isActive||this.isSendFormFocused||this.isModalShown||this.isFeedbackTooltipShow||this.isFooterPanelsActive||document.hidden||this._isActionsShown()||(0,b.isVisible)(this.inlineLoader)||(0,b.hasClass)(this.wrapEl,"hiding_reply")||(0,x.curBox)()||this.isPausedByMetaScroll())}isSpaceLongTabAvailable(){return!this.isPaused()}isPausedByMetaScroll(){return this.story instanceof u.MetaStory&&this.story.isPausedByMetaScroll}isPausedByFooterScroll(){return this.story instanceof u.MetaStory&&this.story.isPausedByMetaScroll}autoResumeStory(e=!1){this.audioPlaying||this.isTooltipOpened()||!this.isActive||this.playStory(!1,e)}changeStory(e){if(e=Math.max(0,Math.min(e,this.getFullItemsLength()-1)),this.isSendFormFocused)return;if(this.index===e&&null!=this.story)return;const t=this.getStoryAtIndex(e)?.raw_id||"";this.layer.notifyStoryNavigationStart({storyRawId:t,direction:e>=this.index?"forward":"backwards",withAnimation:!1,isWithinTheSameBlock:!0}),this._destroyStory(),this.index=e,this.hideTooltip(),this._setPreview(),this.playStory(),this.layer.notifyStoryNavigationEnd({storyRawId:t,isWithinSameBlock:!0})}getWrap(){return this.wrapEl}stop(){this.isActive=!1,this._destroyFeedBackTT(),this._destroyStory(),this._resetErrors(),this._stopLoader(),(0,b.val)((0,b.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),(0,b.removeClass)(this.wrapEl,"autoplay_failed")}getCurStoryData(){const e=this.data.items[this.index],t=this.isActiveMetaStory();return e||t||(0,O.logError)(new Error("getCurStoryData: data is undefined"),{environment:"stories"}),e}isActiveMetaStory(){return!!this.hasMetaStory()&&(!(!this.hasUnloadedMetaStory()||this.data.items.length)||Boolean(this.data.grouped?.length)&&this.getFullItemsLength()-1===this.index)}hasMetaStory(){return this.data.type===r.StoryBlockType.discover}hasUnloadedMetaStory(){return this.hasMetaStory()&&!this.data.grouped?.length}getCurrentNarrative(){return this.data.narrative}isActiveLive(){return!this.isEmpty()&&"live"===this.getCurStoryData()?.type}isBestFriends(){return this.getCurStoryData()?.is_best_friends_privacy}isLiveEnded(){return!!this.story&&(this.isActiveLive()&&this.story.liveEnded)}_initStory(){const e=this.getCurStoryData(),t=this.getCurrentNarrative(),s=this.isActiveMetaStory();if(!e&&!s)return void(0,O.logError)(new Error("Fail: _initStory"),{environment:"stories"});let o=null;const a=e=>(...t)=>{const s=null!=o;!(this.story===o)&&s||e(...t)},n={onLoadingStart:a(this._onLoadingStart.bind(this)),onLoadingEnd:a(this._onLoadingEnd.bind(this)),onPlay:a(this._onPlay.bind(this)),onPause:a(this._onPause.bind(this)),onError:a(this._showError.bind(this)),toggleMetaStoryTitle:this.toggleMetaStoryTitle,onLongLoading:a(this._showLoader.bind(this)),onAutoPlayFail:a(this._onAutoPlayFail.bind(this)),play:this.playStory,pause:this.pauseStory,playPrevStory:this.prevStory,playNextStory:this.nextStory,onLongTap:a(this.longTapHandle)};if(this.story&&this._destroyStory(),e){const{type:s,noSound:a}=e;let c;if((0,S.onPlayerChange)(this),Object.assign(e,{authorId:this.getOwnerId()}),"live"===s?c=new m.LiveStory(e,{...n,vkVideoPlayerConfig:this.layer?.options?.vkVideoPlayerConfig},this.wrapEl):("video"===s?(c=new g.VideoStory(e,n,t,(this.layer.storiesPreloader?.videoElementManager||this.layer.videoLoader)??null),a&&this.opts.restoreAudioPlay(),(0,b.addClass)(this.wrapEl,"video")):(c=new v.PhotoStory(e,n,t),this.opts.restoreAudioPlay(),(0,b.removeClass)(this.wrapEl,"video")),this.descEl&&(this.descEl.innerHTML=this.getHeaderBottomHtml()||"",this.initProfileQuestionTooltipIfNeeded()),this.fillTimeLine()),o=c,this.story=c,"live"===s||"video"===s){(0,$.getVolume)()>0&&this.opts.onVideoPlay()}if((0,b.toggleClass)(this.wrapEl,"stories_can_comment",e.can_comment),this.data?.author?.can_follow&&!this.isActiveLive()){const e=this._renderFollowButton();e&&this.authorButtons?.appendChild(e)}const d=this.renderActionButtons();if(this.authorButtons?.appendChild(d),this._destroyFeedBackTT(),this.updateBottom(),e.clickable_stickers&&this.data.author){const t=e.clickable_stickers?.stickers||[],s=t.filter((e=>r.dynamicStickerIds.includes(e.type)))||[],o=t?.filter((e=>r.staticStickerIds.includes(e.type)))||[];(s.length||o.length)&&this._render((0,i.jsx)(l.StoryStickers,{ref:e=>{e&&(this.stickerLayers=e)},story:c,storyData:e,author:this.data.author,showMessage:this.showMessage.bind(this),playStory:this.playStory,pauseStory:this.pauseStory,hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer.sendNavigationStatEvents.bind(this.layer),list:this.layer.listName,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)}}else if(this.hasMetaStory()){this._destroyFeedBackTT();let e="";this.data.type===r.StoryBlockType.discover&&(this.story=new p.DiscoverMetaStory(this.data,n),e=(0,ie.getLang)("stories_interesting_stories")),e&&(this.metaStoryTitle=(0,b.ce)("div",{className:"MetaStoryTitle MetaStoryTitle--hide",innerHTML:e}),this.storiesHeaderContent.appendChild(this.metaStoryTitle)),(0,b.re)((0,b.geByClass1)("stories_photo",this.contWrap)),(0,b.re)((0,b.geByClass1)("stories_video",this.contWrap)),this.fillTimeLine()}o=this.story,this.opts.onStartStory(),this.story&&this.contWrap.appendChild(this.story.getContainer())}hasSticker(e){const t=this.getCurStoryData();if(!t||!t.clickable_stickers)return!1;const{stickers:s}=t.clickable_stickers;return!!Array.isArray(s)&&s.some((t=>t.type===e))}getSticker(e){const t=this.getCurStoryData();if(!t||!t.clickable_stickers)return;const{stickers:s}=t.clickable_stickers;return Array.isArray(s)?s.find((t=>t.type===e)):void 0}isTooltipOpened(){return this.stickerLayers&&this.stickerLayers.isShownTooltip()}hideTooltip(e=!1){this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),e||this.playStory())}getReplies(){if(this.story instanceof _.MediaStory)return this.story&&this.story.getReplies()}getViews(){if(this.story instanceof _.MediaStory)return this.story&&this.story.getViews()}setReplies(e){if(this.story instanceof _.MediaStory)return this.story&&this.story.setReplies(e)}setViews(e){if(this.story instanceof _.MediaStory)return this.story&&this.story.setViews(e)}getFirstUnreadIndex(){const{items:e}=this.data;let t=null;for(let s in e)if(e[s].unread&&!this.layer._hasContext("all")){t=Number(s);break}return null==t&&this.data.grouped?.some((e=>e.items.some((e=>e.unread))))&&(t=this.getFullItemsLength()-1),null==t&&(t=0),t}indexToUnread(){this.index=this.getFirstUnreadIndex(),this._setPreview()}indexToStoryById(e){const{items:t}=this.data;let s=-1;for(let i in t)if(t[i].raw_id===e){s=Number(i);break}this.layer._hasContext("all")&&(s=0),s>-1?(this.index=s,this._setPreview()):this.indexToUnread()}fillTimeLine(){const{timeLineEl:e}=this;if(e&&this.data.type!==r.StoryBlockType.discover)for(let t=0;t<e.children.length;t++){const s=(0,b.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this._currentTimeLineEl=s,this._currentTimeLineAdditionalEl=(0,b.geByClass1)("stories_time_line_item_wick",e.children[t]));const i=t<this.index?100:0;(0,b.setStyle)(s,"transform",`translateX(${i}%)`)}}_destroyStory(){if(!this.story)return;const e=this.getCurStoryData();this.isFooterPanelsActive=!1,this.needHideSentReactions&&(this.needHideSentReactions=!1,e?.new_reactions&&delete e.new_reactions),this.updateBottom(!0),window.tooltips&&window.tooltips.hideAll(),this.hideTooltip(!0),this.destroyProfileQuestionTooltipIfNeeded(),this._resetErrors(),this._destroyFeedBackTT(),this.story.pause(),e&&e.clickable_stickers&&this._unmount(this.contStickers),cancelAnimationFrame(this.timeLineAnim);try{this.story.destroy()}catch(e){(0,O.logError)(e,{environment:"stories"})}this._replyHideEnd(),this.story=null,(0,T.removeEvent)(this.followBtn),this.authorButtons&&(this.authorButtons.innerHTML=""),this.metaStoryTitle?.remove(),(0,T.removeEvent)(this.answersEl),this.hideInlineLoader(),this.destroyActionButton(),e&&this.layer.notifyStoryTeardown(e.raw_id)}_timeLineUpdate(){const{story:e}=this;if(!e||e.isPaused()||this.isActiveLive()||this.data.type===r.StoryBlockType.discover)return;const t=this.getStoryProgressPercent(),s=t/100;if((0,b.setStyle)(this._currentTimeLineEl,"transform",`translateX(${t}%) translateZ(0)`),this._currentTimeLineAdditionalEl&&this._currentTimeLineEl){const e=this._currentTimeLineEl.clientWidth*s;(0,b.setStyle)(this._currentTimeLineAdditionalEl,"transform",`translateX(${e}px) translateZ(0)`)}t<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}getStoryProgressPercent(){if(!this.story)return 0;const e=this.story.getCurrentTime(),t=this.story.getDuration();return Math.max(0,Math.min(100,e/t*100))}_onLoadingStart(){this._loadingStartTime=performance.now()}_onLoadingEnd(){const e=this.getRawId();e&&this._loadingStartTime&&(this.loadingTime=Math.round(performance.now()-this._loadingStartTime),this.layer.sendViewerStartTime(e,this.loadingTime),this._loadingStartTime=0)}_onPlay(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),(0,b.removeClass)(this.wrapEl,"animate_story"),(0,b.removeClass)(this.wrapEl,"autoplay_failed");const e=this.data.items[this.getIndex()];e&&(e.unread=!1,(0,ce.dispatchStoriesSeenEvent)([{blockId:this.layer.getBlockKey(this.data),storyRawIdSet:new Set([e.raw_id])}])),this._updateFeedStoryPreview(),(0,S.onPlayerChange)(this)}_onPause(){cancelAnimationFrame(this.timeLineAnim),(0,S.onPlayerChange)(this)}_onPlayEnd(e=!1){this._markSeenIfNeeded(),this.nextStory(e)}getOffsetLeft(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2}getWidth(){return this.wrapEl.offsetWidth}removeStoryBox(){const e=this.getCurStoryData();if(!e)return void(0,O.logError)(new Error("Fail: removeStoryBox"),{environment:"stories"});const t=e.isPartOfNarrative?(0,ie.getLang)("stories_remove_from_narrative_warning"):(0,ie.getLang)("stories_remove_warning");this.hideFeedbackTooltip(),this.pauseStory();const s=(0,A.showFastBox)({title:(0,ie.getLang)("global_warning")},t,(0,ie.getLang)("stories_remove_confirm"),this.removeStory.bind(this),(0,ie.getLang)("global_cancel"),(()=>{s.hide(),this.playStory()}))}removeStoryFromNarrative(){const e=this.getCurStoryData();if(!e)return void(0,O.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"});const t=(0,ie.getLang)("stories_remove_only_from_narrative_warning");this.hideFeedbackTooltip(),this.pauseStory();const s=(0,A.showFastBox)({title:(0,ie.getLang)("global_warning")},t,(0,ie.getLang)("stories_remove_confirm"),(t=>{const s=this.getCurrentNarrative();if(!s)return;const i=this.getIndex();s.stories=s.stories.filter((t=>t.rawId!==e.raw_id)),(0,I.lockButton)(t),this.editNarrativeRequest(s).then((()=>{const e=(0,x.curBox)();e&&e.hide(),s.storiesCount=s.stories.length,this._popStoryAndClearList(i),(0,B.updateNarrativeBlock)(),this.opts.afterNarrativeEdited?.(),this.layer.sendNavigationStatEvents("delete_from_narrative")})).catch((()=>{const e=(0,x.curBox)();e&&e.hide(),(0,O.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"})}))}),(0,ie.getLang)("global_cancel"),(()=>{s.hide(),this.playStory()}))}removeStory(e){this.pauseStory();const t=this.getIndex(),s=this.getRawId(),i=()=>{this.layer.sendNavigationStatEvents("delete"),(0,x.curBox)()?.hide(),this._popStoryAndClearList(t),1!==this.layer.renderedStoryList.length||this.layer.renderedStoryList[0]||this.opts.removeCurrentList(),(0,B.updateNarrativeBlock)(),"profile"===window.cur.module&&window.Profile?.updateStories(),(0,ce.dispatchStoriesRemoveEvent)([{rawId:s}])};(0,I.lockButton)(e),re.storiesService.deleteFx({owner_id:this.getOwnerId(),story_id:this.getStoryId()}).then((()=>{i()}),(()=>((0,x.curBox)()?.hide(),(0,A.showFastBox)({title:(0,ie.getLang)("global_error"),onHide:()=>{this.playStory()}},(0,ie.getLang)("global_unknown_error")),!0))).finally((()=>{(0,I.unlockButton)(e)}))}removeNarrativeBox(){this.hideFeedbackTooltip(),this.pauseStory();const e=(0,A.showFastBox)({title:(0,ie.getLang)("global_warning")},(0,ie.getLang)("stories_narrative_remove_warning"),(0,ie.getLang)("stories_remove_confirm"),this.removeNarrative.bind(this),(0,ie.getLang)("global_cancel"),(()=>{e.hide(),this.playStory()}))}removeNarrative(e){this.pauseStory();const t=this.getCurrentNarrative();if(!t)return void(0,O.logError)(new Error("Fail: removeNarrative"),{environment:"stories"});const{ownerId:s,id:i}=t,r=()=>{(0,x.curBox)()?.hide(),this.opts.removeCurrentList(),this.remove(),(0,B.updateNarrativeBlock)(),this.opts.afterNarrativeRemoved?.()};(0,I.lockButton)(e),re.narrativesService.deleteFx({owner_id:s,narrative_id:i}).then((()=>{r()}),(()=>((0,x.curBox)()?.hide(),(0,A.showFastBox)({title:(0,ie.getLang)("global_error"),onHide:()=>{this.playStory()}},(0,ie.getLang)("global_unknown_error")),!0))).finally((()=>{(0,I.unlockButton)(e)}))}removeStoryWithReason(){const e=this.getIndex(),t=this.getRawId();this.layer.sendNavigationStatEvents("delete"),(0,x.curBox)()?.hide(),this._popStoryAndClearList(e),1!==this.layer.renderedStoryList.length||this.layer.renderedStoryList[0]||this.opts.removeCurrentList(),(0,B.updateNarrativeBlock)(),"profile"===window.cur.module&&window.Profile?.updateStories(),(0,ce.dispatchStoriesRemoveEvent)([{rawId:t}])}removeStoryWithReasonBox(){const e=this.getOwnerId(),t=this.getStoryId();e&&t&&(0,le.showMessageBoxModal)((s=>(0,i.jsx)(de.StrikeForbidObjectForm,{...s,objectOwnerId:e,objectId:t,objectType:11,story:this})))}hideDiscover(){this.pauseStory(),(0,A.showFastBox)({title:(0,ie.getLang)("stories_discover_hiding_title"),onHide:()=>{this.playStory()}},(0,ie.getLang)("stories_discover_hiding_warning").replace("{link}",'<a href="/settings" target="_blank">').replace("{/link}","</a>"),(0,ie.getLang)("stories_add_blacklist_button"),(e=>{(0,I.lockButton)(e),re.storiesService.setDiscoverVisibleFx({is_discover_visible:0}).then((()=>{const e=(0,x.curBox)();e&&e.hide(),this.layer.sendNavigationStatEvents("hide_discover");const t=c.getPrevLayer();t?.activeStory?.data?.type===r.StoryBlockType.discover&&t?.activeStory?.remove(!0,(()=>{(0,x.showDoneBox)((0,ie.getLang)("stories_discover_hidden_text"))})),c.hideAllLayers(!0)})).finally((()=>{(0,I.unlockButton)(e)}))}),(0,ie.getLang)("global_cancel"))}sendNarrativeBookmarkButtonDidPress(){const e=this.getCurrentNarrative();if(!e)return void(0,O.logError)(new Error("Fail: sendNarrativeBookmarkButtonDidPress"),{environment:"stories"});(e.isBookmarked?re.faveService.removeNarrativeFx({owner_id:e.ownerId,narrative_id:e.id}):re.faveService.addNarrativeFx({owner_id:e.ownerId,narrative_id:e.id,ref:window.cur.module})).then((()=>{(0,x.showDoneBox)(e.isBookmarked?(0,ie.getLang)("stories_narrative_bookmark_deleted"):(0,ie.langTag)('<a href="/bookmarks">',"</a>",(0,ie.getLang)("stories_narrative_bookmark_added"),"link"),{className:"stories_done_msg"}),e.isBookmarked||(0,D.sendNarrativeAnalytic)(D.NarrativeAnalyticEventType.addToBookmarks,e,D.NarrativeAnalyticNavScreen.storyViewer),e.isBookmarked=!e.isBookmarked,this.updateBottom(),this.updateActionButtons()}))}showSpaNarrativesEditor(){const e=this.getCurrentNarrative();(0,le.showMessageBoxModal)((({onClose:t})=>(0,i.jsx)(ve.DIRootWebProvider,{children:(0,i.jsx)(me.NarrativesEditorWidget,{onClose:()=>{t(),this.autoResumeStory()},ownerId:e?.ownerId,narrativeId:e?.id})})))}sendNarrativeEditButtonDidPress(){const e=this.getCurrentNarrative();if(e)return(0,D.sendNarrativeAnalytic)(D.NarrativeAnalyticEventType.clickToEditNarrative,e,D.NarrativeAnalyticNavScreen.storyViewer),(0,N.partConfigEnabled)("web_stories_narratives_editor_redesign")?this.showSpaNarrativesEditor():this.editCurrentNarrative();(0,O.logError)(new Error("Fail: sendNarrativeEditButtonDidPress"),{environment:"stories"})}editNarrativeRequest(e){const{id:t,ownerId:s,title:i,stories:r,coverStoryRawId:o,customCover:a}=e;let n;return o&&([,n]=o?.split("_")),new Promise(((e,o)=>{re.narrativesService.editFx({owner_id:s,narrative_id:t,title:i,story_ids:(0,B.prepareStoriesForPublishing)(r),cover_story_id:Number(n)||0,custom_cover_photo_id:a?.photoId}).then((()=>{e()})).catch((e=>{(0,x.curBox)()?.hide(),(0,A.showFastBox)({title:(0,ie.getLang)("global_error"),onHide:()=>{o(),this.playStory()}},e||(0,ie.getLang)("global_unknown_error"))}))}))}_popStoryAndClearList(e){if(this._removeStoryFromMemoryByIndex(e),0===this.data.items.length){const e=this.getOwnerId();e&&c.onReplyDeleted(e)}}_removeStoryFromMemoryByIndex(e,t=!1){const s=e===this.index;if(!this.data.items[e])return;s&&this._destroyStory(),this.data.items.splice(e,1),this.preloadedStories={};const i=this.getFullItemsLength();i?(this._initTimeLine(),this.isActive&&s&&(this.changeStory(Math.min(e,i-1)),this.preloadNextStory())):(this._setPreview(),this.remove(t))}remove(e,t){this.opts.onStoryBlockRemoved?.(e,t)}shareBox(){if(!(this.story instanceof _.MediaStory))return;if(!this.getCurStoryData())return void(0,O.logError)(new Error("Fail: shareBox"),{environment:"stories"});const e=this.getCurrentNarrative();let t;t=e?`narrative${e.rawId}`:`story${this.story.getId()}`,this.pauseStory();const s="story_archive"===this.opts.navScreen;(0,A.showBox)("like.php",{act:"publish_box",object:t,from:"wkview",ref:s?"story_archive":""},{onDone:()=>{this.autoResumeStory()},params:{onHide:()=>{this.autoResumeStory()}}})}toggleLikeStory(){if(!(this.story instanceof _.MediaStory))return;const{data:e}=this.story,{isLiked:t,owner_id:s}=e;e.isLiked=!t,this.updateBottom();const i={type:"story",owner_id:s,item_id:this.getStoryId()};(t?(0,q.api)("likes.delete",i):(0,q.api)("likes.add",i)).then((()=>{this.layer.sendNavigationStatEvents(t?"click_to_unlike":"click_to_like")})).catch((()=>{e.isLiked=t,this.updateBottom()}))}onAnswerSend(e,t=[],s={},i={}){const r=this.getSendText();if(!(this.story&&this.story instanceof _.MediaStory))return;if(!r&&!t.length)return;if(this.isActiveLive())return void this.story.sendMessage(r,e);const o=this.getCurrentNarrative(),a=s.sticker_referrer??void 0;let n=t.find((e=>"sticker"===e[0]))?.[1],c="";c=o?`narrative${o.ownerId}_${o.id}`:`story${this.getRawId()}`,null!=n&&(n=Number(n)),this.sendFormButton&&(this.sendFormButton.innerHTML=this._getLoaderHtml(),this.sendFormButton.classList.add("sending")),(0,oe.apiMessagesSend)({entrypoint:"stories_comment",attachment:c,random_id:(0,ae.random)(),peer_id:this.getOwnerId(),message:r,sticker_id:n??void 0,sticker_referrer:a}).then((()=>{this.onAnswerSent(e,s,i)}),(()=>{this.showMessage((0,ie.getLang)("global_unknown_error")).catch((e=>{(0,O.logError)(e)}))})).finally((()=>{this.sendFormButton&&(this.sendFormButton.innerHTML="",this.sendFormButton.classList.remove("sending"))}))}onAnswerSent(e=()=>{},t={},s={}){if(!this.isActiveLive()){this.showMessage((0,ie.getLang)("stories_answer_sent")).then((()=>{this.playStory()})).catch((e=>{(0,O.logError)(e)}));const e=t.sticker_referrer||"",i={};let r="";"story_keyboard"===e?r="sticker_keyboard_send":e.startsWith("story_suggestion_")?r="sticker_suggestion_send":"story_reaction"===e?(r="sticker_reaction_send",i.reaction_name=s.reactionName):r="comment_send",this.layer.sendNavigationStatEvents(r,!0,i)}(0,b.val)((0,b.geByClass1)("stories_send_form_text",this.wrapEl),""),this.resetSendForm(),this._blurSendForm(),this.pauseStory(),e&&e()}onSendFormFocus(){this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this.hideTooltip(!0),this.hideFeedbackTooltip()}_toggleSendFormOverlay(e=!1){this.isSendFormFocused=e}toggleFooterPanelsActive(e){this.isFooterPanelsActive=e,e&&this.toggleFeedbackTooltip(!1),e&&this.pauseStory(),e||this.playStory()}_blurSendForm(){const e=(0,b.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()}getSendText(){const e=k.Emoji.editableVal((0,b.geByClass1)("stories_send_form_text",this.wrapEl));return(0,L.trim)(e)}onSendFormBlur(){const e=this.getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this.resetSendForm()}_unlockSendForm(){this.isSendFormFocused&&(this.isSendFormFocused=!1)}resetSendForm(){(0,b.val)((0,b.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),this.playStory()}_getLoaderHtml(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'}preloadNextStory(e=this.index+1){if(this.preloadedStories[e])return;const t=this.data.items[e];if(!t)return;if(this.layer.storiesPreloader)return void this.layer.storiesPreloader.preloadStory(t).catch((e=>{"Cancelled"!==e?.message&&(0,O.logError)(e)}));this.preloadedStories[e]=!0;const s="video"===t.type?t.video_url:t.photo_url;s&&("video"===t.type?null!==this.layer.videoLoader?this.layer.videoLoader.preloadVideo(s).catch((e=>{"Cancelled"!==e?.message&&(0,O.logError)(e)})):(0,n.loadMediaToBrowserCache)(s,"video").catch((e=>(0,O.logError)(e))):"photo"===t.type&&(0,n.preloadImage)(s).catch((e=>(0,O.logError)(e))))}addToBlacklist(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory();const e=this.getOwnerId();e&&(0,A.showFastBox)({title:(0,ie.getLang)("stories_add_blacklist_title"),onHide:()=>{window.cur.storyLayer&&window.cur.storyLayer.playStory()}},te.Ranges.isGroupId(e)?(0,ie.getLang)("stories_add_blacklist_message_group"):(0,ie.getLang)("stories_add_blacklist_message"),(0,ie.getLang)("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),(0,ie.getLang)("global_cancel"))}_doAddToBlacklist(e){(0,I.lockButton)(e),re.storiesService.banOwnerFx({owners_ids:String(this.getOwnerId()),track_code:this.getTrackCode()}).then((()=>{this.data.can_blacklist=!1,this.layer.sendNavigationStatEvents("hide_from_stories"),(0,x.curBox)()?.hide(),this.opts.removeCurrentList(),this.remove()})).finally((()=>{(0,I.unlockButton)(e)}))}markNotInterested(){const e=this.getCurStoryData();if(e)if(e.isAds){let t="";const s=e.track_code,i=(0,A.showBox)("reports.php",{act:"hide_ad_box",track_code:s,type:"story"},{onDone(){const e=(0,b.geByClass)("radiobtn","ad_hide");window.radioBtns.ad_hide={val:0,els:e};const s=(0,b.ge)("ad_csrf");t=s?s.value:t},params:{onClean:()=>{delete window.radioBtns.ad_hide,this.playStory()}},stat:["reports.css"]});i.removeButtons(),i.addButton((0,ie.getLang)("box_send"),(r=>{(0,I.lockButton)(r),window.ajax.post("reports.php",{act:"hide_ad",track_code:s,reason_id:window.radioBtns.ad_hide.val,hash:t},{onDone:()=>{(0,I.unlockButton)(r),i.hide(),this._markNotInterested(e.track_code)}})})),i.addButton((0,ie.getLang)("global_cancel"),!1,"no")}else this._markNotInterested(e.track_code);else(0,O.logError)(new Error("Fail: markNotInterested"),{environment:"stories"})}_markNotInterested(e){this.showMessage((0,ie.getLang)("stories_thanks_feedback")).catch((e=>{(0,O.logError)(e)})),re.storiesService.markNotInterestedFx({owner_id:this.getOwnerId(),story_id:this.getStoryId(),track_code:e}).then((()=>{this.layer.sendNavigationStatEvents("mark_not_interested")}))}_resetErrors(){const e=(0,b.geByClass1)("stories_error_wrap",this.contWrap);e&&((0,T.removeEvent)((0,b.geByClass1)("stories_error_button",e)),(0,b.re)(e)),(0,b.removeClass)(this.wrapEl,"failed"),(0,b.removeClass)(this.wrapEl,"fatal_error")}_showError(e){if(!this.contWrap||!this.isActive)return;const t=this.getRawId(!0),s=e,i=e=>{t&&this.opts.onStoryLoadError?.(t,e)};let r,o;switch(e){case"load":r=(0,ie.getLang)("stories_error_cant_load"),o=(0,b.ce)("div",{className:"stories_error_button",innerHTML:(0,ie.getLang)("stories_try_again")}),(0,T.addEvent)(o,"click",(()=>{this._destroyStory(),this.playStory()})),i("Error loading media resource");break;case"expired":r=(0,ie.getLang)("stories_error_expired");break;case"deleted":r=(0,ie.getLang)("stories_error_deleted");break;case"private":r=(0,ie.getLang)("stories_error_private");break;case"deleted-narrative":r=(0,ie.getLang)("stories_error_deleted_narrative");break;case"private-narrative":r=(0,ie.getLang)("stories_error_private_narrative");break;case"isOneTimeSeen":r=(0,ie.getLang)("stories_error_one_time_seen");break;default:r=(0,ie.getLang)("global_unknown_error"),i(`Unknown error - ${e}`)}this._resetErrors(),this._stopLoader(),this.hideTooltip(!0);const a=(0,b.ce)("div",{className:"stories_error_wrap"});a.setAttribute("data-testid","story_content_load_error");const n=(0,b.ce)("div",{className:"stories_error"}),c=(0,b.ce)("div",{className:"stories_error_cont"});n.appendChild(c),c.appendChild((0,b.ce)("div",{className:"stories_error_icon "+s})),c.appendChild((0,b.ce)("div",{className:"stories_error_caption",innerHTML:r})),o&&c.appendChild(o),a.appendChild(n),this.contWrap.appendChild(a),(0,b.addClass)(this.wrapEl,"failed"),(0,L.inArray)(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&(0,b.addClass)(this.wrapEl,"fatal_error")}_stopLoader(){setTimeout((()=>{(0,b.re)((0,b.geByClass1)("stories_loader",this.contWrap))}),0)}_showLoader(){if(this._stopLoader(),!this.isActive||this.isLoaded()&&!this.isPaused()||!this.contWrap)return;const e=(0,b.ce)("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}_onFollowBtnClick(){if(this.pauseStory(),this.followBtnLock)return;if(this.followBtnLock=!0,!this.data.author)return;const e=this.data.author.id,t=te.Ranges.isUserIdTransitional(e);this.showInlineLoader();(()=>te.Ranges.isUserIdTransitional(e)?this.data.author?.can_follow?re.storiesService.friendsAddFx({query:{user_id:e,source:"stories",track_code:this.getTrackCode()}}):re.storiesService.friendsDeleteFx({query:{user_id:e}}):this.data.author?.can_follow?re.storiesService.groupsJoinFx({query:{group_id:-e,source:"stories",track_code:this.getTrackCode()}}):re.storiesService.groupsLeaveFx({query:{group_id:-e}}))().then((()=>{if(this.data.author){if(this.data.author.can_follow&&(t||(0,y.trackTmrGroupsJoin)()),this.data.author.can_follow=!this.data.author.can_follow,this.data.author.can_follow){const e=t?(0,V.getIcon24UserAddOutline)():(0,H.getIcon24AddSquareOutline)();this.followBtn.innerHTML=e.icon,this.followBtn.setAttribute("data-testid","story_header_follow")}else{const e=t?(0,W.getIcon24UserAddedOutline)():(0,K.getIcon24MinusSquareOutline)();this.followBtn.innerHTML=e.icon,this.followBtn.setAttribute("data-testid","story_header_unfollow"),this.layer.listName===r.StoryListName.discover&&this.layer.sendNavigationStatEvents("add_to_friends")}this.showMessage(this.data.author.can_follow?(0,ie.getLang)("stories_unfollowed"):(0,ie.getLang)("stories_followed")).then((()=>this.playStory())).catch((e=>{(0,O.logError)(e)})),window.tooltips&&window.tooltips.destroy(this.followBtn),(0,T.triggerEvent)(this.followBtn,"mouseover")}})).finally((()=>{this.hideInlineLoader(),this.followBtnLock=!1}))}markAsActive(){this.isActive=!0,(0,b.addClass)(this.wrapEl,"animate_story")}_destroyFeedBackTT(){delete this.feedback,this.hideFeedbackTooltip()}hideFeedbackTooltip(e=!0){this.isFeedbackTooltipShow&&(this.isFeedbackTooltipShow=!1,this.autoResumeStory(),this.updateBottom(),e&&(0,C.cancelStackPop)())}showFeedbackTooltip(){const e=this.getCurStoryData();e?this.isFeedbackTooltipShow||(this.needHideSentReactions=Boolean(e.new_reactions),this.hideTooltip(),this.pauseStory(),this.isFeedbackTooltipShow=!0,this.updateBottom(),this.layer.sendNavigationStatEvents("open_replies_list"),(0,C.cancelStackPush)("stories_feedback_tt",(e=>{this.hideFeedbackTooltip(!1),e?.isCloseBtnClick&&(0,C.cancelStackPop)(e)}))):(0,O.logError)(new Error("Fail: showFeedbackTooltip"),{environment:"stories"})}initProfileQuestionTooltipIfNeeded(){if(this.descEl){const e=this.getCurStoryData();if(e?.isProfileQuestion){const e=this.descEl.querySelector(".StoryProfileQuestionLink"),t=e?.querySelector(".StoryInfo__icon");if(!e||!t)return;this.profileQuestionTooltipContent=(0,b.se)(`\n          <div class="StoryProfileQuestionTooltip__inner">\n            <div class="StoryProfileQuestionTooltip__title">${(0,ie.getLang)("global_ask_feature")}</div>\n            <div class="StoryProfileQuestionTooltip__text">${(0,ie.getLang)("stories_profile_question_tooltip_description")}</div>\n            <a href="/question?ref=story" class="StoryProfileQuestionTooltip__btn" target="_blank">${(0,ie.getLang)("stories_profile_question_tooltip_btn")}</a>\n          </div>\n        `);let s=!1;this.profileQuestionTooltip=new E.ElementTooltip(t,{appendTo:this.wrapEl,forceSide:"bottom",align:"left",centerShift:(0,b.getXY)(this.authorImg)[0]-(0,b.getXY)(t)[0],cls:"StoryProfileQuestionTooltip",noHideOnClick:!0,width:291,content:this.profileQuestionTooltipContent,onShow:()=>{this.isPaused()?s=!0:this.pauseStory()},onHide:()=>{s||this.playStory()}}),e?.addEventListener("mouseenter",this.showMyProfileQuestionsTooltip)}}}destroyProfileQuestionTooltipIfNeeded(){if(!this.profileQuestionTooltip)return;const e=this.descEl?.querySelector(".StoryProfileQuestionLink");e?.removeEventListener("mouseenter",this.showMyProfileQuestionsTooltip),this.profileQuestionTooltip.destroy()}_onModalsShownChange(e=!1){this.isModalShown=e}showInlineLoader(){(0,b.show)(this.inlineLoader)}hideInlineLoader(){(0,b.hide)(this.inlineLoader)}volumeUpdate(){this.story&&"volumeUpdate"in this.story&&this.story.volumeUpdate()}_onAutoPlayFail(){(0,b.addClass)(this.wrapEl,"autoplay_failed")}hideReply(){(0,A.showFastBox)({title:(0,ie.getLang)("global_warning"),onHide:()=>{this.autoResumeStory()}},(0,ie.getLang)("stories_hide_reply_warning"),(0,ie.getLang)("global_continue"),this._doHideReply.bind(this),(0,ie.getLang)("global_cancel"))}_doHideReply(){if(!this.data.author)return;this.pauseStory(),(0,b.addClass)(this.wrapEl,"hiding_reply"),(0,x.curBox)()?.hide();const e=this.getIndex(),t=this.data.author.gender,s=(0,b.se)(`<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">${(0,R.getProgressHtml)()}</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">${(0,ie.getLang)("stories_reply_hidden")}</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">${(0,ie.getLang)("stories_hide_reply_continue")}</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">${(0,M.langSex)(t,(0,ie.getLang)("stories_hide_all_replies"))}</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">${(0,ie.getLang)("stories_reply_add_to_blacklist")}</div>\n  </div>\n</div>`);(0,T.addEvent)((0,b.geByClass1)("_stories_reply_continue",s),"click",(()=>this._replyHideEnd(e))),(0,T.addEvent)((0,b.geByClass1)("_stories_hide_replies",s),"click",this._hideAllReplies.bind(this)),(0,T.addEvent)((0,b.geByClass1)("_stories_reply_ban",s),"click",this._ban.bind(this)),this.contWrap.appendChild(s),re.storiesService.hideReplyFx({owner_id:Number(this.getOwnerId()),story_id:this.getStoryId()}).then((()=>{this.opts.removeCurrentList(),window.cur.needUpdateFeedStories=!0})).catch((()=>{this._resetReplyHide(),this.playStory()})).finally((()=>{(0,b.removeClass)(s,"loading")}))}_resetReplyHide(){(0,b.re)((0,b.geByClass1)("stories_hide_reply_wrap",this.contWrap)),(0,b.removeClass)(this.wrapEl,"hiding_reply")}_hideAllReplies(){if(!this.data.author)return;const e=this.data.author.first_name_gen;(0,A.showFastBox)({title:(0,ie.getLang)("global_warning")},(0,ie.getLang)("stories_delete_all_replies_confirm").replace("{name}",e),(0,ie.getLang)("global_continue"),this._doHideAllReplies.bind(this),(0,ie.getLang)("global_cancel"))}_doHideAllReplies(e){(0,I.lockButton)(e),re.storiesService.hideAllRepliesFx({owner_id:Number(this.getOwnerId())}).then((()=>{(0,x.curBox)()?.hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,b.geByClass1)("_stories_hide_replies",this.contWrap);(0,b.val)(e,(0,ie.getLang)("stories_all_replies_hidden")),(0,b.addClass)(e,"disabled")})).finally((()=>{(0,I.unlockButton)(e)}))}_ban(){if(!this.data.author)return;const e=this.data.author.first_name_gen;(0,A.showFastBox)({title:(0,ie.getLang)("global_warning")},(0,ie.getLang)("stories_ban_confirm").replace("{name}",e),(0,ie.getLang)("global_continue"),this._doBan.bind(this),(0,ie.getLang)("global_cancel"))}_doBan(e){(0,I.lockButton)(e),re.userService.accountBanFx({params:{owner_id:Number(this.getOwnerId())}}).then((()=>{(0,x.curBox)()?.hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,b.geByClass1)("_stories_reply_ban",this.contWrap);(0,b.val)(e,(0,ie.getLang)("stories_banned")),(0,b.addClass)(e,"disabled")})).finally((()=>{(0,I.unlockButton)(e)}))}_replyHideEnd(e){if((0,b.geByClass1)("stories_hide_reply_wrap",this.contWrap)){if(this.data.items.length<=1){const e=this.getOwnerId();e&&c.onReplyDeleted(e)}this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!(0,L.isNumeric)(e))}}_feedbackRemoveReplyFromDom(e){const t=(0,b.geByClass1)("stories_feedback_content",this.wrapEl);if(!t)return;const s=t.querySelector(`#feed_story_${e}`);s&&(0,b.addClass)(s,"removed")}onReplyDeleted(e){this._feedbackRemoveReplyFromDom(e)}_updateFeedStoryPreview(){let e=(0,b.ge)(`feed_story_${this.layer.getBlockKey(this.data)}`);if(!e||e.classList.contains("stories_feed_reply_item")||!e.classList.contains("stories_feed_preview_item"))return;let t=this.getFirstUnreadIndex();if(t){let s=this.data.items[t];!s&&this.getFullItemsLength()-1===t&&this.data.grouped?.length&&this.data.grouped.some((e=>e.items.some((e=>{if(e.unread)return s=e,!0})))),s&&s.small_preview&&(0,b.setStyle)(e,"background-image",`url(${s.small_preview})`)}}sendStoryLinkViewStatEvent(){re.statsService.trackEventsFx({events:JSON.stringify([{e:ne.STATS_EVENT_TYPE_STORY_LINK_VIEW,owner_id:this.getOwnerId(),story_id:this.getStoryId(),track_code:this.getTrackCode()}])}).catch((e=>{console.error("story view link click stat has failed",e)}))}report(){const e=this.getCurStoryData(),t=this.getCurrentNarrative();if(e)if(e.isAds){const s=e.track_code;let i="";const r=(0,A.showBox)("/reports.php",{act:"report_ad_box",track_code:s,type:"story"},{onDone(){const e=(0,b.geByClass)("radiobtn","ad_report");window.radioBtns.ad_report={val:0,els:e};const t=(0,b.ge)("ad_csrf");i=t?t.value:i},params:{onClean:()=>{delete window.radioBtns.ad_report,this.playStory()}},stat:["reports.css"]});r.removeButtons(),r.addButton((0,ie.getLang)("box_send"),(e=>{window.ajax.post("reports.php",{act:"report_ad_common",track_code:s,reason:window.radioBtns.ad_report.val,hash:i},{onDone:()=>{const e=this.index;r.hide(),this.layer.sendNavigationStatEvents("claim"),t||this._popStoryAndClearList(e),(0,x.showDoneBox)((0,ie.getLang)("stories_report_sent"),{className:"stories_done_msg"}),(0,B.updateNarrativeBlock)()},showProgress:()=>(0,I.lockButton)(e),hideProgress:()=>(0,I.unlockButton)(e)})})),r.addButton((0,ie.getLang)("global_cancel"),!1,"no")}else{const e=()=>this.playStory();if(t)(0,F.showReportForm)("narrative",t.ownerId,t.id,void 0,e);else{const[t,s]=this.getRawId().split("_"),i=parseInt(t),r=parseInt(s);(0,F.showReportForm)("story",i,r,void 0,e)}}else(0,O.logError)(new Error("Fail: report"),{environment:"stories"})}onLiveEnded(e=!1){if(!this.isActiveLive())return;const t=this.getCurStoryData();t&&(t.can_share=!e),this.story&&this.story.onLiveEnded(),this.updateBottom()}updateLiveViewersCount(e){this.descEl&&(this.descEl.innerHTML=e)}isActiveStoryOneTime(){return this.story instanceof _.MediaStory&&(this.story&&this.story.isOneTime())}buildStoryArchiveByActive(){const e=this.getRawId(),t=this.getCurStoryData();if(!e||!t)return;const[,s]=e.split("_");return{id:Number(s),rawId:e,listId:this.layer.listName,preview:t.small_preview,originalPreviewUrl:t.small_preview,time:t.time}}editCurrentNarrative(){const e=this.getCurStoryData(),t=this.getCurrentNarrative(),s=this.getOwnerId();if(!e||!s)return;if(this.pauseStory(),this.isModalShown=!0,!t)return;let i=[];t?.stories.length&&(i=[...t.stories]);const r={selectedStories:i,narrative:t,onSave:()=>{this.opts.afterNarrativeEdited?.()},onClose:e=>{this.isModalShown=!1,this.updateBottom(),this.playStory(),e&&((0,B.updateNarrativeBlock)(),this.opts.removeCurrentList(),this.remove(!1))},navScreen:D.NarrativeAnalyticNavScreen.storyViewer};(0,ue.showNarrativeEditorBoxAsync)(s,r)}renderAvatar(){this.avatarWrap&&this.avatarPhoto&&this.data.author&&this._render((0,i.jsx)(i.Fragment,{children:this.isBestFriends()?(0,i.jsx)(Q.TextTooltip,{enableInteractive:!0,maxWidth:360,placement:"bottom-start",text:(0,i.jsx)(Y.LangTag,{className:(0,X.getColorClass)("color_text_positive"),tag:"tag",enableInnerHTML:!0,children:(0,ie.langReplace)((0,ie.getLang)("stories_tooltip_best_friends_web"),{name:(0,ge.unclean)(this.data.author.name_get)})}),onShownChange:e=>{e?(this.pauseStory(),this.layer.sendNavigationStatEvents("click_on_badge")):this.playStory()},children:(0,i.jsx)(J.RichAvatar,{src:this.avatarPhoto,size:36,children:(0,i.jsx)(J.RichAvatar.Badge,{children:(0,i.jsx)(se.Icon20FavoriteCircleFillGreen,{})})})}):(0,i.jsx)(J.RichAvatar,{src:this.avatarPhoto,size:36,children:this.isActiveLive()&&(0,i.jsx)(J.RichAvatar.BadgeWithPreset,{preset:"live"})})}),this.avatarWrap)}_render(e,t){const s=(0,i.jsx)(Z.AppRootProvider,{children:e});if((0,N.partConfigEnabled)("enable_create_root")){let e=this.rootMap.get(t);e||(e=(0,d.createRoot)(t),this.rootMap.set(t,e)),e.render(s)}else a.render(s,t)}_unmount(e){e&&((0,N.partConfigEnabled)("enable_create_root")?(this.rootMap.get(e)?.unmount(),this.rootMap.delete(e)):a.unmountComponentAtNode(e))}constructor(e,t){this.curPreviewUrl=null,this.curPreviewThumbhash=null,this.downTs=null,this.rootMap=new WeakMap,this.storyBottomRef=(0,o.createRef)(),this.updateBottom=e=>{const t=(0,b.geByClass1)("stories_bottom_wrap",this.wrapEl);this.isActive&&!e&&this.story&&!this.isActiveMetaStory()?(this.resetNewRepliesCounterIfNeeded(),this._render((0,i.jsx)(h.StoryBottom,{story:this,ref:this.storyBottomRef}),t)):(this._unmount(t),(0,b.val)(t,""))},this.longTapHandle=()=>{this.isActiveStoryOneTime()||(this.story&&this.story.pause(),(0,b.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer.sendNavigationStatEvents("pause_long_tap"))},this.playStory=(e=!1,t=!1)=>{this.isLocked()||((0,b.removeClass)(this.wrapEl,"paused"),this.story&&!e||this._initStory(),this.story&&this.story.play(),t&&this.layer.sendNavigationStatEvents("resume_release"),this.downTs=null)},this.pauseStory=e=>{this.story&&(this.isPaused()||(e&&(0,b.addClass)(this.wrapEl,"paused"),this.story.pause()))},this.toggleMetaStoryTitle=e=>{this.metaStoryTitle&&this.metaStoryTitle.classList.toggle("MetaStoryTitle--hide",!e)},this.nextStory=(e=!1)=>{if(this.isLocked())return;e||this.layer.sendNavigationStatEvents("go_to_next_story_tap");const t=this.index+1;t<this.getFullItemsLength()?(e&&this.layer.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(t)):(this.opts.onStoriesEnd(e),this._destroyStory())},this.prevStory=()=>{if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),this.isLocked())return;this.layer.sendNavigationStatEvents("go_to_previous_story");const e=this.index-1;e>=0?this.changeStory(e):(this.opts.playPrevOwner(),this._destroyStory())},this.showMyProfileQuestionsTooltip=()=>{this.profileQuestionTooltip?.show()},this.toggleFeedbackTooltip=(e=!this.isFeedbackTooltipShow)=>{e?this.showFeedbackTooltip():this.hideFeedbackTooltip()},this.onFetchFeedbackData=e=>{this.feedback=e;const t=e?.replies?.repliesTotalCountText,i=e?.viewers?.viewsTotalCountText,r=e?.replies,o=r?.listName,a=r?.list;t&&this.setReplies(t),i&&this.setViews(i),r&&a&&(s._dG("cur",(0,L.extend)(window.cur,{[`stories_list_${o}`]:a})),r.list=a.length>w.INIT_MAX_FEEDBACK_STORIES_COUNT?a.slice(0,w.INIT_MAX_FEEDBACK_STORIES_COUNT):a,r.moreRepliesCount=a.length-r.list.length),this.updateBottom()},this.showMoreReplies=()=>{const e=this.feedback?.replies,t=e?.listName,s=e?.list;if(t&&e&&s){const s=(0,he.getStoryList)(t);if(!s)return;e.list=s.slice(0,e.list.length+w.MAX_FEEDBACK_STORIES_SLICE_COUNT),e.moreRepliesCount=s.length-e.list.length,this.updateBottom()}},this.onFetchViewers=e=>{this.feedback?.viewers?.items&&e.items&&(this.feedback.viewers.items=this.feedback.viewers.items.concat(e.items),this.feedback.viewers.nextFrom=e.nextFrom,this.updateBottom())},this.onQuestionRemove=e=>{this.feedback?.questions?.items&&(this.feedback.questions.items=this.feedback.questions.items.filter((t=>t.id!==e)),this.feedback.questions.count-=1,this.feedback.questions.items.length||delete this.feedback.questions,this.updateBottom())},this.onAddToNarrativeBtnClick=()=>{const e=this.getCurStoryData();if(!e)return;this.pauseStory(),this.isModalShown=!0;const t=this.getOwnerId(),s=this.buildStoryArchiveByActive();if(!s||!t)return;const i={ownerId:t,story:s,onClose:e=>{this.isModalShown=!1,this.updateBottom(),this.playStory(),e&&(0,B.updateNarrativeBlock)()},onSave:t=>{e.isPartOfNarrative=t.length>0},navScreen:D.NarrativeAnalyticNavScreen.storyViewer,isOwner:e.can_manage};(0,ue.showNarrativeChooseBoxAsync)(i),(0,D.sendNarrativeAnalytic)(D.NarrativeAnalyticEventType.clickToAddToNarrative,{ownerId:t},D.NarrativeAnalyticNavScreen.storyViewer)},this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormFocused=!1,this.isModalShown=!1,this.isFeedbackTooltipShow=!1,this.story=null,this.pressedStory=null,this.index=0,this._currentTimeLineAdditionalEl=null,this._currentTimeLineEl=null,this.preloadedStories={},this.layer=t.layer}}},673801:(e,t,s)=>{s.d(t,{onPlayerChange:()=>c});var i=s(628459),r=s(636576),o=s(351118),a=s(298077);let n;function c(e){if(!i.HAS_MEDIA_SESSION)return;n=e;const t=n.getCurStoryData(),s=n.isActiveMetaStory();if(!t)return void(s||(0,a.logError)(new Error("Fail story media session"),{environment:"stories"}));if(!["video"].includes(t.type)||t.noSound)return void(0,i.clear)();const r=n.data.author?(0,o.decodeHTMLEntities)(n.data.author.name):"",c=(0,o.decodeHTMLEntities)(t.date),u=t.small_preview||t.photo_url||t.first_frame||t.preview_url,p=u?[{sizes:"800x1497",src:u}]:[];!function(){if(!i.HAS_MEDIA_SESSION)return;navigator.mediaSession.setActionHandler("play",d),navigator.mediaSession.setActionHandler("pause",l),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",h),navigator.mediaSession.setActionHandler("nexttrack",_)}(),(0,i.updateMediaSessionMetadata)({title:r,artist:c,album:"",artwork:p})}function d(){n.playStory(),(0,r.statlogsValueEvent)("global_media_controls","story_player","play")}function l(){n.pauseStory(),(0,r.statlogsValueEvent)("global_media_controls","story_player","pause")}function h(){n.prevStory(),(0,r.statlogsValueEvent)("global_media_controls","story_player","previous_track")}function _(){n.nextStory(),(0,r.statlogsValueEvent)("global_media_controls","story_player","next_track")}},816469:(e,t,s)=>{s.d(t,{isStoryViewerDebugLogEnabled:()=>r});var i=s(540462);function r(){return(0,i.partConfigEnabled)("stories_web_enable_debug_logs_in_viewer")}},46963:(e,t,s)=>{s.d(t,{STORY_DURATION:()=>i});const i=5e3},487864:(e,t,s)=>{s.d(t,{markSeenInModules:()=>n});var i=s(120101),r=s(614320),o=s(345939),a=s(245117);const n=e=>{(0,i.markSeenStoriesInProfile)(e),(0,r.removeUnseenStories)(e),(0,o.removeUnseenStories)(e),(0,a.removeUnseenStories)(e)}},28233:(e,t,s)=>{s.d(t,{needNotShowStory:()=>i});const i=e=>{if(e)return e.is_expired||e.is_private||e.is_deleted}},187903:(e,t,s)=>{s.d(t,{isVmojiShareEnabled:()=>i});const i=()=>!0},990787:(e,t,s)=>{s.d(t,{createVmojiAvatar:()=>h,isValidVmojiAvatarUrlPath:()=>d,parseVmojiAvatarUrlPath:()=>c,showVmojiAvatar:()=>_,showVmojiConstructor:()=>u});var i=s(246429),r=s(458840),o=s(187903);const a=7929683,n=RegExp("^vmoji(?<ownerId>[0-9]+)_(?<characterId>[A-Za-z0-9_-]+?)(_(?<packId>[0-9]+))?$");function c(e){const t=e.replace(/^\//,"").match(n);return t?.groups?{ownerId:Number(t.groups.ownerId),characterId:String(t.groups.characterId),packId:void 0===t.groups.packId?void 0:Number(t.groups.packId)}:null}function d(e){return null!==c(e)}function l(){const e=(0,i.showBoxLoader)();return window.stManager.add([window.jsc("web/vmoji.js")]).then((()=>{if((0,i.isBoxLoadingCancelled)(e))throw new Error("loading cancelled");(0,i.hideBoxLoader)()}))}function h(e,t,s){l().then((()=>{window.Vmoji.createAvatar(e,s,t)})).catch((()=>{}))}function _(e,t,s){l().then((()=>{window.Vmoji.showAvatar(e,t,s)})).catch((()=>{}))}function u(e,t,s,i){const n={layer:!0,onHide:()=>{s?.()},...i};t={...t};(0,o.isVmojiShareEnabled)()||(t.disableshare=""),n.urlHash=new URLSearchParams(Object.entries(t)).toString().replace(/=(?=&|$)/gm,""),(0,r.showApp)(e,a,!1,null,null,n)}},70992:(e,t,s)=>{s.d(t,{LocalModalsController:()=>o});var i=s(331635),r=s(327813);class o{get descriptor(){return this.currentModalDescriptor?{Component:this.modals[this.currentModalDescriptor.type],props:this.currentModalDescriptor.props}:null}get isOpen(){return!!this.currentModalDescriptor}open(e){return this.setCurrentModalDescriptor(e),{close:()=>{this.closeSpecific(e)}}}close(){this.resetCurrentModalDescriptor()}closeSpecific(e){this.currentModalDescriptor&&this.currentModalDescriptor.type===e.type&&this.resetCurrentModalDescriptor()}setCurrentModalDescriptor(e){this.currentModalDescriptor=e}resetCurrentModalDescriptor(){this.currentModalDescriptor=null}constructor(e){this.modals=e,this.currentModalDescriptor=null,(0,r.makeObservable)(this)}}(0,i.__decorate)([r.observable,(0,i.__metadata)("design:type",Object)],o.prototype,"currentModalDescriptor",void 0),(0,i.__decorate)([r.computed,(0,i.__metadata)("design:type",void 0),(0,i.__metadata)("design:paramtypes",[])],o.prototype,"descriptor",null),(0,i.__decorate)([r.computed,(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[])],o.prototype,"isOpen",null),(0,i.__decorate)([r.action.bound,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof UnionizeComponentsMap?Object:UnionizeComponentsMap]),(0,i.__metadata)("design:returntype","undefined"==typeof LocalModalsControllerOpenResult?Object:LocalModalsControllerOpenResult)],o.prototype,"open",null),(0,i.__decorate)([r.action.bound,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[]),(0,i.__metadata)("design:returntype",void 0)],o.prototype,"close",null),(0,i.__decorate)([r.action,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof UnionizeComponentsMap?Object:UnionizeComponentsMap]),(0,i.__metadata)("design:returntype",void 0)],o.prototype,"closeSpecific",null),(0,i.__decorate)([r.action,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof UnionizeComponentsMap?Object:UnionizeComponentsMap]),(0,i.__metadata)("design:returntype",void 0)],o.prototype,"setCurrentModalDescriptor",null),(0,i.__decorate)([r.action,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[]),(0,i.__metadata)("design:returntype",void 0)],o.prototype,"resetCurrentModalDescriptor",null)},657921:(e,t,s)=>{s.d(t,{LocalModalsSwitcher:()=>r});var i=s(474848);const r=(0,s(456921).observer)((function({controller:e}){if(e.descriptor){const{Component:t,props:s}=e.descriptor;return(0,i.jsx)(t,{...s})}return null}))},888553:(e,t,s)=>{s.d(t,{StrikeForbidObjectSlot:()=>l});var i=s(474848),r=s(132028),o=s(61875),a=s(456921),n=s(514524),c=s(296540);const d=(0,a.observer)((()=>{const e=(0,n.useStrikeForbidObjectModel)();return(0,c.useEffect)((()=>{setTimeout((()=>e.props.current.refreshCoordinates()))}),[e.height]),(0,i.jsx)(o.ModeratorSlot,{width:506,height:e.height,hash:"B1PHmrkTxIDkjHS3T4VS",style:{overflow:"hidden"},iframeStyle:{width:525},queryParams:e.queryParams})})),l=(0,r.createWidget)(n.StrikeForbidObjectModelProvider,d)},863926:(e,t,s)=>{s.d(t,{StrikeForbidObject:()=>a});var i=s(474848),r=s(888553),o=s(319756);const a=e=>(0,i.jsx)(o.DIRootWebProvider,{children:(0,i.jsx)(r.StrikeForbidObjectSlot,{...e})})},514524:(e,t,s)=>{s.d(t,{StrikeForbidObjectModelProvider:()=>d,useStrikeForbidObjectModel:()=>l});var i=s(331635),r=s(327813),o=s(132028),a=s(24516),n=s(670252);class c{get queryParams(){const e=Object.fromEntries(new URLSearchParams(window.location.search)).claim||0;return{contentId:String(this.props.current.objectId),contentOwnerId:String(this.props.current.objectOwnerId),contentSource:String(this.props.current.objectType),claimId:String(this.props.current.claimId||e),ticketId:document.referrer.includes(this.HELPDESK_TICKET_URL)?document.referrer.split(this.HELPDESK_TICKET_URL)[1]:"",isTicketLinkVisible:this.userEnv.partConfigEnabled("strike_system_delete_with_reason_support")?"1":"",isTicketLinkRequired:this.userEnv.partConfigEnabled("strike_system_delete_with_reason_support")&&!this.userEnv.partConfigEnabled("strike_system_delete_with_reason")?"1":""}}[o.init](){window.addEventListener("slot:B1PHmrkTxIDkjHS3T4VS",this.onMessage)}[o.destroy](){window.removeEventListener("slot:B1PHmrkTxIDkjHS3T4VS",this.onMessage)}constructor(e,t,s){this.props=e,this.userEnv=t,this.snackbar=s,this.HELPDESK_TICKET_URL="vk.com/helpdesk?act=show&id=",this.height=151,this.onMessage=e=>{switch(e.detail.type){case"size":e.detail.payload.height&&(this.height=e.detail.payload.height);break;case"close":this.props.current.onClose();break;case"error":this.snackbar.show({text:"Error: "+e.detail.payload}),this.props.current.onClose();break;case"delete-content-with-reason":this.snackbar.show({text:e.detail.payload.text}),this.props.current.onSubmit?.(e.detail.payload.placeholder),this.props.current.onClose()}},(0,r.makeAutoObservable)(this)}}c=(0,i.__decorate)([o.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.Props?Object:o.Props,void 0===a.UserEnv?Object:a.UserEnv,void 0===n.Snackbar?Object:n.Snackbar])],c);const{Provider:d,useModel:l}=(0,o.createProvider)(c,{initInEffect:!1})},650464:(e,t,s)=>{var i=s(474848),r=s(456921),o=s(132028),a=s(172656),n=s(724648),c=s(582192),d=s(73535),l=s(340575);const h=(0,r.observer)((function(){const e=(0,d.useModeratorDemoSlotsModel)();if(!e.isEnable)return null;return(0,i.jsxs)(a.Group,{children:[(0,i.jsxs)(n.Flex,{gap:4,direction:"column",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(l.ModeratorSlot,{hash:"_Dpr6VOIUdfibaFfUOnR",height:150,width:"100%"}),(0,i.jsx)("div",{children:e.modalLog})]}),(0,i.jsx)(c.Separator,{}),(0,i.jsx)(l.ModeratorSlot,{hash:"Bx7KcaacjYvuuvCv0gl9",queryParams:{q:"Hello"}}),(0,i.jsx)(c.Separator,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)(l.ModeratorSlot,{hash:"xtsFFD8iuR9WY6l8N4hN",onSlotEvent:e.onFruitRecieved}),(0,i.jsx)("div",{children:e.fruit?e.fruit:"Empty"})]}),(0,i.jsx)(c.Separator,{}),(0,i.jsx)(l.ModeratorSlot,{hash:"dFLPGV_1pQv_tNWk_SqI",width:250})]}),(0,i.jsx)(l.ModeratorSlotFullScreen,{hash:"cb87TwIB252A5bJdHkbo",onSlotEvent:e.onShowEvent})]})}));(0,o.createWidget)(d.ModeratorDemoSlotsModelProvider,h)},550313:(e,t,s)=>{s(650464)},167309:(e,t,s)=>{s.d(t,{ModeratorDemoSlotsModelProvider:()=>c,useModeratorDemoSlotsModel:()=>d});var i=s(331635),r=s(327813),o=s(132028),a=s(24516);class n{get isEnable(){return this.userEnv.partConfigEnabled("frontend.moderator_demo_slots")}get fruit(){return this.fruitInfo}get modalLog(){return this.openModalLog}constructor(e){this.userEnv=e,this.fruitInfo="",this.openModalLog="No events",this.onFruitRecieved=e=>{this.fruitInfo=`${e.fruit}: ${e.weight}.`},this.onShowEvent=e=>{e._show?this.openModalLog=`Open modal by "${e.hash}", with params: "?type=${e.slotParams.type}" hash=${e.redirectHash}`:e.submitted?this.openModalLog=`Submitted modal "${e.hash}", with inputValue=${e.inputValue}, modalType=${e.modalType}`:this.openModalLog=`Close modal "${e.hash}", with inputValue=${e.inputValue}, modalType=${e.modalType}`},(0,r.makeAutoObservable)(this)}}n=(0,i.__decorate)([o.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.UserEnv?Object:a.UserEnv])],n);const{Provider:c,useModel:d}=(0,o.createProvider)(n,{initInEffect:!1})},73535:(e,t,s)=>{s.d(t,{ModeratorDemoSlotsModelProvider:()=>i.ModeratorDemoSlotsModelProvider,useModeratorDemoSlotsModel:()=>i.useModeratorDemoSlotsModel});var i=s(167309)},224764:(e,t,s)=>{s.d(t,{ModeratorSlot:()=>_,ModeratorSlotFullScreen:()=>u});var i=s(474848),r=s(456921),o=s(296540),a=s(440961),n=s(132028),c=s(783856),d=s(162573),l=s(129348);const h=(0,r.observer)((function(){const e=(0,d.useModeratorSlotModel)(),t=(0,o.useCallback)((t=>{var s;e.lockBodyScroll&&"_show"in t.detail&&"boolean"==typeof t.detail._show&&(s=t.detail._show,document.body.style.overflow=s?"hidden":"auto"),e.onSlotEvent(t)}),[]);if((0,o.useEffect)((()=>(e.isEnable&&window.addEventListener(`slot:${e.slotHash}`,t),()=>{e.isEnable&&window.removeEventListener(`slot:${e.slotHash}`,t)})),[]),!e.isEnable)return null;const s=e.urlByHash;if(!s)return null;if(!e.show)return null;const r=(0,i.jsx)("div",{style:{...e.iframeSize,...e.props.current.style},className:e.props.current.className,children:(0,i.jsx)("iframe",{allow:"clipboard-write",className:l.default.iframe,style:e.props.current.iframeStyle,src:s.toString(),loading:"lazy",title:e.iframeTitle,"data-slot-id":e.dataSlotId,"data-slot-hash":e.slotHash})});return e.props.current.fullscreen?(0,a.createPortal)((0,i.jsx)(c.Overlay,{fixed:!0,zIndex:999,children:r}),document.body):r})),_=(0,n.createWidget)(d.ModeratorSlotModelProvider,h),u=e=>(0,i.jsx)(_,{fullscreen:!0,lockBodyScroll:!0,...e})},340575:(e,t,s)=>{s.d(t,{ModeratorSlot:()=>i.ModeratorSlot,ModeratorSlotFullScreen:()=>i.ModeratorSlotFullScreen});var i=s(224764)},864933:(e,t,s)=>{s.d(t,{ModeratorSlotModelProvider:()=>c,useModeratorSlotModel:()=>d});var i=s(331635),r=s(132028),o=s(327813),a=s(24516);class n{[r.destroy](){this.queryParamsReactionDisposer()}get moderatorSlotConfig(){return this.userEnv.getConfigValue("slot")}get hashes(){return this.moderatorSlotConfig?.hashes}get baseUrl(){const e=this.moderatorSlotConfig;return e?.base_url}get dataSlotId(){return this.props.current.dataSlotId}get slotHash(){return this.props.current.hash}get isEnable(){return!!this.userEnv.partConfigEnabled("frontend.spa_moderator_embedded")&&(!!this.baseUrl&&!(!this.hashes||!this.hashes[this.slotHash]))}get urlByHash(){if(!this.hashes)return;const e=this.baseUrl;if(!e)return;const t=this.hashes[this.slotHash];if(!t)return;const s=new URLSearchParams;s.append("domain",window.vk.apiConfigDomains.domain),s.append("apiDomain",window.vk.apiConfigDomains.apiDomain),s.append("connectDomain",window.vk.apiConfigDomains.connectDomain),s.append("loginDomain",window.vk.apiConfigDomains.loginDomain),s.append("hash",this.slotHash);for(const[e,t]of Object.entries(this.queryParams))t&&s.append(e,t);return new URL(e+t+"?"+s.toString())}get iframeSize(){const e=this.props.current;let t=e.fullscreen?"100%":"180px",s=e.fullscreen?"100%":"30px";return e.width&&(t="number"==typeof e.width?`${e.width}px`:e.width),e.height&&(s="number"==typeof e.height?`${e.height}px`:e.height),{width:t,height:s}}get iframeTitle(){return`moderation-slot-${this.slotHash}`}constructor(e,t){this.props=e,this.userEnv=t,this.queryParams={},this.onSlotEvent=e=>{"_show"in e.detail&&"boolean"==typeof e.detail._show&&(0,o.runInAction)((()=>{this.show=e.detail._show,this.queryParams={...this.queryParams,...e.detail.slotParams??{}}})),this.props.current.onSlotEvent?.(e.detail)},this.show=!e.current.fullscreen&&(e.current.show??!0),this.queryParams=e.current.queryParams??{},this.lockBodyScroll=Boolean(e.current.fullscreen&&e.current.lockBodyScroll),this.queryParamsReactionDisposer=(0,o.reaction)((()=>this.props.current.queryParams),(e=>{this.queryParams={...this.queryParams,...e}})),(0,o.makeAutoObservable)(this)}}n=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===r.Props?Object:r.Props,void 0===a.UserEnv?Object:a.UserEnv])],n);const{Provider:c,useModel:d}=(0,r.createProvider)(n,{initInEffect:!1})},162573:(e,t,s)=>{s.d(t,{ModeratorSlotModelProvider:()=>i.ModeratorSlotModelProvider,useModeratorSlotModel:()=>i.useModeratorSlotModel});var i=s(864933)},61875:(e,t,s)=>{s.d(t,{ModeratorSlot:()=>i.ModeratorSlot,ModeratorSlotFullScreen:()=>i.ModeratorSlotFullScreen});s(550313);var i=s(340575)},662069:(e,t,s)=>{s.d(t,{CommonDialogsService:()=>n});var i=s(331635),r=s(132028),o=s(70992);const a={};class n{createDialogsController(e){this.controller=new o.LocalModalsController({...a,...e})}get isOpen(){return this.controller?.isOpen||!1}constructor(){this.controller=null,this.closeModal=()=>{this.controller?.close()},this.fastMessage=e=>new Promise((t=>{this.controller?.open({type:"fastMessage",props:{...e,onYesButtonClick:()=>{t(!0)},onClose:()=>{this.closeModal(),t(!1)}}})}))}}n=(0,i.__decorate)([r.scope.global()],n)},692482:(e,t,s)=>{s.d(t,{CommonDialogsService:()=>i.CommonDialogsService});var i=s(662069)},831762:(e,t,s)=>{s.d(t,{DeliveryMethodType:()=>m,EMOJI_REG_EXP:()=>p,EMPTY_PRICE:()=>n,FILTER_MAX_PRICE:()=>i,GROUP_HEADER_QUERY_PARAM:()=>r,MARKET_BASE_URL:()=>o,MARKET_ROOT_CATEGORY_ID:()=>a,MAX_PRICE:()=>d,MIN_ORDER_PRICE_LIMIT:()=>l,MIN_PRICE:()=>c,REVIEW_CREATED_EVENT:()=>h,REVIEW_UPDATED_EVENT:()=>_,STORAGE_ITEMS_FOR_REVIEW_DELAY_COMMUNITY_KEY:()=>u});const i=5e9,r="with_group_header",o="/market",a="9000",n="",c=0,d=999999999999,l=999999,h="MARKET_ITEM_REVIEW_CREATED",_="MARKET_ITEM_REVIEW_UPDATED",u="ecomm_market_items_for_review_delay_community",p=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;var m=function(e){return e[e.Self=1]="Self",e[e.CDEK=2]="CDEK",e[e.Boxberry=3]="Boxberry",e[e.DomesticPost=4]="DomesticPost",e[e.Courier=7]="Courier",e[e.OzonConfig=8]="OzonConfig",e}({})},761448:(e,t,s)=>{s.d(t,{TrackStoryCardVisibility:()=>o});var i=s(474848),r=s(570441);const o=({children:e,onVisible:t})=>{const[s]=(0,r.useIntersectionObserver)({triggerOnce:!0,threshold:.6,minVisibleTime:600,onIntersecting:t});return(0,i.jsx)("div",{ref:s,children:e})}},861808:(e,t,s)=>{s.d(t,{TrackStoryCardVisibility:()=>i.TrackStoryCardVisibility});var i=s(761448)},393891:(e,t,s)=>{s.d(t,{StoryTypeNext:()=>d.StoryTypeNext,StoryTypeOpen:()=>d.StoryTypeOpen,generateUniqueNonce:()=>c.generateUniqueNonce,getLatestFeedBlockNonce:()=>c.getLatestFeedBlockNonce,getTimeSinceNavigation:()=>a.getTimeSinceNavigation,initializeSharedState:()=>n.initializeSharedState,storeLatestFeedBlockNonce:()=>c.storeLatestFeedBlockNonce,trackHideViewerLoader:()=>o.trackHideViewerLoader,trackShowViewerLoader:()=>o.trackShowViewerLoader,trackStoryBlockChunkLoadingEnd:()=>i.trackStoryBlockChunkLoadingEnd,trackStoryBlockChunkLoadingError:()=>i.trackStoryBlockChunkLoadingError,trackStoryBlockDataLoadingEnd:()=>i.trackStoryBlockDataLoadingEnd,trackStoryBlockDataLoadingError:()=>i.trackStoryBlockDataLoadingError,trackStoryBlockLoadingStart:()=>i.trackStoryBlockLoadingStart,trackStoryBlockPerfFeedRendered:()=>i.trackStoryBlockPerfFeedRendered,trackStoryBlockStoryBlockRendered:()=>i.trackStoryBlockStoryBlockRendered,trackStoryDownloadEnd:()=>o.trackStoryDownloadEnd,trackStoryDownloadFailure:()=>o.trackStoryDownloadFailure,trackStoryOpeningStart:()=>o.trackStoryOpeningStart,trackStoryUpload:()=>r.trackStoryUpload,trackStoryUploadFailure:()=>r.trackStoryUploadFailure});var i=s(365601),r=s(828561),o=s(511356),a=s(340408),n=s(239599),c=s(633177),d=s(530888)},747169:(e,t,s)=>{s.d(t,{StoriesHiddenUsersProvider:()=>_,useStoriesHiddenUsersModel:()=>h});var i=s(331635),r=s(132028),o=s(327813),a=s(712600),n=s(746310),c=s(24516),d=s(670252);class l{async[r.init](){this.setListLoading(!0),this.filteredUsers=this.users=await this.getHiddenUsers(),this.setListLoading(!1)}filterUsersByName(e){if(this.currentFilterQuery=e.replace(/^\s+|\s+$/g,""),!this.users)return;if(!this.currentFilterQuery)return void(this.filteredUsers=this.users);const t=new RegExp(this.currentFilterQuery.toLowerCase());this.filteredUsers=this.users.filter((e=>!!e.name&&t.test(e.name.toLowerCase())))}mapHiddenUsersResponse(e){const{groups:t=[],profiles:s=[]}=e;return[...t.map((e=>({...e,id:-e.id}))),...s].map((e=>{const t="name"in e?e.name:"first_name"in e?`${e.first_name} ${e.last_name}`.trim():void 0;return{id:e.id,name:t,photo:e.photo_100,marked:!1}}))}async getHiddenUsers(){const e=await this.storiesApi.getBanned({extended:1,fields:"photo_100"});return this.mapHiddenUsersResponse(e)}async markUser(e){this.users&&(this.users=this.users.map((t=>t.id===e?{...t,marked:!t.marked}:t)),this.filterUsersByName(this.currentFilterQuery))}async submit(){if(!this.users)return;const e=this.users.filter((e=>e.marked)).map((e=>e.id)).join(",");if(e){this.setSubmitLoading(!0);try{await this.storiesApi.unbanOwner({owners_ids:`${e}`})}catch(e){throw this.snackbar.show({type:"error",text:this.langs.getLang("global_unexpected_error_try_later")}),e}finally{this.setSubmitLoading(!1)}}}setListLoading(e){this.listLoading=e}setSubmitLoading(e){this.submitLoading=e}constructor(e,t,s,i,r){this.langs=e,this.storiesApi=t,this.props=s,this.userEnv=i,this.snackbar=r,this.users=null,this.filteredUsers=null,this.listLoading=!0,this.submitLoading=!1,this.currentFilterQuery="",(0,o.makeAutoObservable)(this)}}l=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.Langs?Object:a.Langs,void 0===n.StoriesApi?Object:n.StoriesApi,void 0===r.Props?Object:r.Props,void 0===c.UserEnv?Object:c.UserEnv,void 0===d.Snackbar?Object:d.Snackbar])],l);const{useModel:h,Provider:_}=(0,r.createProvider)(l,{initInEffect:!1})},832480:(e,t,s)=>{s.d(t,{StoriesHiddenUsersProvider:()=>i.StoriesHiddenUsersProvider,useStoriesHiddenUsersModel:()=>i.useStoriesHiddenUsersModel});var i=s(747169)},211883:(e,t,s)=>{s.d(t,{StoriesHiddenUsersProvider:()=>i.StoriesHiddenUsersProvider,useStoriesHiddenUsersModel:()=>i.useStoriesHiddenUsersModel});var i=s(832480)},923545:(e,t,s)=>{s.d(t,{StoryBlockAnalytics:()=>n});var i=s(331635),r=s(132028),o=s(54490),a=s(24516);class n{constructor(e,t){this.productionStats=e,this.userEnv=t,this.handledStoryFeedViewItemEvents=new Set,this.sendStoryFeedViewItemEvent=(e,t)=>{this.handledStoryFeedViewItemEvents.has(e)||(this.productionStats.send({type:"type_view",type_view:{item:{owner_id:e,type:"story_feed_item"},type:"type_story_feed_view_item",type_story_feed_view_item:{circle_owner_id:e,common_track_code:t}}}),this.handledStoryFeedViewItemEvents.add(e))}}}n=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.ProductionStats?Object:o.ProductionStats,void 0===a.UserEnv?Object:a.UserEnv])],n)},766770:(e,t,s)=>{s.d(t,{LeftMenuService:()=>u});var i=s(331635),r=s(327813),o=s(132028),a=s(551494),n=s(351118),c=s(90933),d=s(558137),l=s(70921);const h=e=>"footer"===e.id||"legal"===e.id;class _{constructor(){this.sections=[],(0,r.makeAutoObservable)(this)}}class u{get sections(){return u.ensureSectionsState().sections}set sections(e){u.ensureSectionsState().sections=e}setSections(e){const t=e?.sections;if(t){this.sections=[],this.footerSections=[];for(const e of(0,n.decodeHTMLEntitiesDeep)(t))h(e)?this.footerSections.push(e):(this.sections.push(e),e.items.forEach((e=>{e.add_static&&window.stManager.add(e.add_static)})))}}async loadSections(){const e=await this.internalApi.getWebLeftMenu({});this.setSections(e)}constructor(e,t){this.internalApi=e,this.helpHints=t,this.footerSections=[],this.isNarrow=!1,this.setIsNarrow=e=>{this.isNarrow=e},this.findItem=e=>{for(const{items:t}of this.sections){const s=t.find(e);if(s)return s}},this.updateItem=(e,t)=>{const s=this.findItem((e=>t=>t.id===e||t.id===(e=>`l_${e}`)(e))(e));if(!s)return;const i={...t};i.href||delete i.href,"number"==typeof i.count&&(i.is_hidden=i.count<0,i.count=Math.max(i.count,0),e!==l.PAGE_ID_MARKET_ORDERS&&(i.is_hidden=!1)),Object.assign(s,i)},this.closeTooltip=e=>{const t=this.findItem((e=>t=>t.tooltip?.hint_id===e)(e));t&&(delete t.tooltip,this.helpHints.hide(e))},(0,r.makeAutoObservable)(this)}}u.ensureSectionsState=(0,d.makeSharedState)("spa/vk/web/infrastructure/layout/services/LeftMenuService/SectionsState",(()=>new _),{version:1}),u=(0,i.__decorate)([o.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.InternalApi?Object:a.InternalApi,void 0===c.HelpHints?Object:c.HelpHints])],u)},332384:(e,t,s)=>{s.d(t,{GIFT_MODAL_WIDTH:()=>i});const i=456},190929:(e,t,s)=>{s.d(t,{isNewGiftModalEnabled:()=>i.isNewGiftModalEnabled,isSendGiftUrl:()=>r.isSendGiftUrl,parseSendGiftUrl:()=>r.parseSendGiftUrl,showGiftModal:()=>i.showGiftModal});var i=s(168091),r=s(672734)},672734:(e,t,s)=>{function i(e){const t=e.match(RegExp("^send_gift(?<giftId>\\d+)(?:_(?<recipientIds>\\d+(?:\\,\\d+)*))?(?:_(?<referrer>[a-zA-Z\\d_-]+))?$","i"));if(!t)return;const s=Number(t.groups?.giftId),i=t.groups?.recipientIds?t.groups?.recipientIds.split(",").map((e=>Number(e))):[],r=t.groups?.referrer;return{giftId:s,recipientIds:i,referrer:r}}function r(e){return Boolean(i(e))}function o({giftId:e,recipientIds:t,referrer:s}){let i=`send_gift${e}`;return t&&t.length&&(i+=`_${t.join(",")}`),s&&(i+=`_${s}`),i}s.d(t,{createLegacyUrlWParam:()=>o,isSendGiftUrl:()=>r,parseSendGiftUrl:()=>i})},168091:(e,t,s)=>{s.d(t,{isNewGiftModalEnabled:()=>_,showGiftModal:()=>h});var i=s(474848),r=s(725669),o=s(540462),a=s(211413),n=s(694876),c=s(672734),d=s(332384);const l=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(21529),s.e(96851),s.e(89887),s.e(22081),s.e(51915),s.e(18624),s.e(64007),s.e(19822),s.e(52007),s.e("langs/web/gift-modal-legacy")]).then(s.bind(s,150447))),(({GiftModalLegacy:e})=>e));function h(e,t=!1,s=!0){if((0,o.isToggleEnabled)("vas_web_new_gifts_send"))return void(0,n.showGiftsCatalogModalLazy)({layerParams:{giftId:String(e.giftId)},layerQuery:{...e.recipientIds?{recipient_ids:e.recipientIds.join(",")}:{},...e.referrer?{ref:e.referrer}:{}}});const r=t?void 0:window.nav?.objLoc?.w;t||s&&window.nav.setLoc({...window.nav.objLoc,w:(0,c.createLegacyUrlWParam)(e)});(0,a.showMessageBoxModalSuspense)((t=>(0,i.jsx)(l,{...e,...t,onClose:()=>{t?.onClose(),s&&window.nav.setLoc({...window.nav.objLoc,w:r})}})),{width:d.GIFT_MODAL_WIDTH})}function _(){return!0}},689116:(e,t,s)=>{s.d(t,{STICKERS_GIFT_MODAL_WIDTH:()=>i});const i=456},25261:(e,t,s)=>{s.d(t,{convertStickerIdToGiftId:()=>r.convertStickerIdToGiftId,isNewStickersGiftModalEnabled:()=>i.isNewStickersGiftModalEnabled,isSendStickersGiftUrl:()=>o.isSendStickersGiftUrl,parseSendStickersGiftUrl:()=>o.parseSendStickersGiftUrl,showStickersGiftModal:()=>i.showStickersGiftModal});var i=s(308983),r=s(744656),o=s(229474)},229474:(e,t,s)=>{function i(e){const t=e.match(RegExp("^send_sticker_gift(?<giftIds>-\\d+(?:,-?\\d+)*)(?:_(?<recipientIds>\\d+(?:\\,\\d+)*))?(?:_(?<referrer>[a-zA-Z\\d_]+))?$","i"));if(!t)return;const s=t.groups?.giftIds?.split(",").map((e=>Number(e)))??[],i=t.groups?.recipientIds?.split(",").map((e=>Number(e)))??[],r=t.groups?.referrer;return{giftIds:s,recipientIds:i,referrer:r}}function r(e){return Boolean(i(e))}s.d(t,{isSendStickersGiftUrl:()=>r,parseSendStickersGiftUrl:()=>i})},308983:(e,t,s)=>{s.d(t,{isNewStickersGiftModalEnabled:()=>h,showStickersGiftModal:()=>l});var i=s(474848),r=s(725669),o=s(211413),a=s(540462),n=s(689116),c=s(694876);const d=(0,r.asyncComponent)((()=>Promise.all([s.e(91498),s.e(89631),s.e(21529),s.e(96851),s.e(89887),s.e(22081),s.e(51915),s.e(18624),s.e(64007),s.e(10190),s.e(68425),s.e("langs/web/sticker-gift-modal-legacy")]).then(s.bind(s,84871))),(({StickersGiftModalLegacy:e})=>e));function l(e){(0,a.isToggleEnabled)("vas_web_new_gifts_send")?(0,c.showGiftsCatalogModalLazy)({layerQuery:{gift_ids:e.giftIds.join(","),...e.recipientIds?{recipient_ids:e.recipientIds.join(",")}:{},...e.referrer?{ref:e.referrer}:{}}}):(0,o.showMessageBoxModalSuspense)((t=>(0,i.jsx)(d,{...e,...t})),{width:n.STICKERS_GIFT_MODAL_WIDTH})}function h(){return!0}},744656:(e,t,s)=>{function i(e){return-e}function r(e){return-e}s.d(t,{convertGiftIdToStickerId:()=>r,convertStickerIdToGiftId:()=>i})},166878:(e,t,s)=>{s.r(t),s.d(t,{NarrativesEditorWidget:()=>b});var i=s(474848),r=s(132028),o=s(149333),a=s(220208),n=s(613104),c=s(694244),d=s(782174),l=s(582192),h=s(908242),_=s(454154),u=s(456921),p=s(971398),m=s(802931),v=s(527325),g=s(700158),f=s(853512),y=s(944561),S=s(625215);const w=(0,u.observer)((function(){const e=(0,v.useNarrativesEditorModel)(),t=(0,o.useLangs)();(0,a.useScrollLock)();const s=e.narrativeId&&e.ownerId?t.getLang("stories_creating_narrative"):t.getLang("stories_editing_narrative");return(0,i.jsx)(n.PopoutWrapper,{zIndex:m.NARRATIVES_EDITOR_ZINDEX,onClick:e.close,children:(0,i.jsxs)(c.ModalBox,{height:"cover_cropper"!==e.screen?"calc(100vh - 80px)":void 0,width:636,"aria-label":t.getLang("profile_stories_archive"),children:[(0,i.jsx)(d.ModalHeader,{backLabel:"main"!==e.screen?t.getLang("global_back"):void 0,onBack:"main"!==e.screen?()=>e.setScreen("main"):void 0,closeAriaLabel:t.getLang("global_close"),onClose:e.close,children:"cover_cropper"===e.screen?t.getLang("stories_cover_cropper_title"):s}),"main"===e.screen&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.NarrativesEditorHeader,{}),(0,i.jsx)(l.Separator,{padding:!1}),(0,i.jsx)(f.NarrativesEditorContent,{ownerId:e.ownerId,narrativeId:e.narrativeId})]}),"cover_select"===e.screen&&(0,i.jsx)(y.StoriesCoverSelect,{ownerId:e.ownerId}),"cover_cropper"===e.screen&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(S.NarrativesEditorCoverCropper,{coverUrl:e.getCoverInfo().url,coverWidth:e.getCoverInfo().width,coverHeight:e.getCoverInfo().height,save:e.saveCroppedPhoto,back:()=>e.setScreen("cover_select")})}),"cover_cropper"!==e.screen&&(0,i.jsx)(h.ModalFooter,{actions:[(0,i.jsx)(_.Button,{onClick:()=>"cover_select"===e.screen?e.setScreen("main"):e.close(),mode:"secondary",children:t.getLang("global_cancel")},"cancel"),(0,i.jsx)(p.ActionButton,{screen:e.screen,onSave:e.save,onClick:()=>"cover_select"===e.screen?e.setScreen("cover_cropper"):void 0},"action")]})]})})})),b=(0,r.createWidget)(v.NarrativesEditorProvider,w)},971398:(e,t,s)=>{s.d(t,{ActionButton:()=>a});var i=s(474848),r=s(454154),o=s(149333);const a=({screen:e,onClick:t,onSave:s})=>{const a=(0,o.useLangs)();return"cover_select"===e?(0,i.jsx)(r.Button,{onClick:t,children:a.getLang("global_next")},"next"):"main"===e?(0,i.jsx)(r.Button,{onClick:s,children:a.getLang("global_save")},"save"):null}},802931:(e,t,s)=>{s.d(t,{NARRATIVES_EDITOR_ZINDEX:()=>i});const i=999},527325:(e,t,s)=>{s.d(t,{NarrativesEditorProvider:()=>p,useNarrativesEditorModel:()=>u});var i=s(331635),r=s(132028),o=s(327813),a=s(909209),n=s(608814),c=s(670252),d=s(951652),l=s(285218),h=s(250503);class _{get screen(){return this.narrativesEditorService.screen}setScreen(e){return this.narrativesEditorService.setScreen(e)}get ownerId(){return this.props.current.ownerId||this.authService.userId||0}get narrativeId(){return this.props.current.narrativeId}[r.destroy](){this.setScreen("main")}constructor(e,t,s,i,r,a,n,c){this.storiesArchiveService=e,this.narrativesListModelService=t,this.narrativesEditorService=s,this.narrativeCoverUploadService=i,this.webLayers=r,this.snackbar=a,this.props=n,this.authService=c,this.getCoverInfo=()=>{if(this.narrativeCoverUploadService.checkedCoverId===l.CustomCoverId)return{url:this.narrativeCoverUploadService.customCoverUrl,width:this.narrativeCoverUploadService.customCoverSizes.width,height:this.narrativeCoverUploadService.customCoverSizes.height};const e=parseInt(this.narrativeCoverUploadService.checkedCoverId.split("_")[1])||0;if(this.narrativesEditorService.selectedStoriesArray.find((t=>t.id===e))){const t=this.narrativesEditorService.storyCoverSizes.get(e);return{url:t?.url||"",width:t?.width||0,height:t?.height||0}}return{url:this.narrativeCoverUploadService.customCoverUrl,width:this.narrativeCoverUploadService.customCoverSizes.width,height:this.narrativeCoverUploadService.customCoverSizes.height}},this.close=()=>{if(this.narrativesEditorService.clearSelectedStories(),this.props.current.onClose)return this.props.current.onClose();this.storiesArchiveService.needReturnToArchiveModal||this.narrativesListModelService.needReturnToNarrativeListModal?this.props.current.back?.():this.webLayers.close({isCloseForwardPush:!0})},this.saveCroppedPhoto=async(e,t)=>{this.narrativesEditorService.crop=e,this.narrativesEditorService.narrativeCoverUrl=t;try{this.narrativeCoverUploadService.customCoverUrl&&await this.narrativeCoverUploadService.saveCustomCover(),this.setScreen("main")}catch(e){this.snackbar.show({text:(0,h.getAPIErrorMessage)(e.error)})}},this.save=async()=>{const e=!!this.narrativeId,t=this.ownerId,s=this.narrativesEditorService.selectedStoriesArray.map((e=>e.id));if(this.narrativesEditorService.narrativeCoverUrl&&this.narrativeCoverUploadService.checkedCoverId===l.CustomCoverId){const i={owner_id:t,story_ids:s.join(","),custom_cover_photo_id:this.narrativeCoverUploadService.customCoverPhoto?.id||0,crop_width:this.narrativesEditorService.crop.width,crop_height:this.narrativesEditorService.crop.height,crop_x:this.narrativesEditorService.crop.x,title:this.narrativesEditorService.title||"",crop_y:this.narrativesEditorService.crop.y};try{e?(await this.narrativesEditorService.editNarrative({...i,narrative_id:this.narrativeId}),this.narrativesListModelService.needReturnToNarrativeListModal&&await this.narrativesListModelService.updateData()):(await this.narrativesEditorService.createNarrative(i),this.narrativesListModelService.needReturnToNarrativeListModal&&await this.narrativesListModelService.updateData(!0)),this.close()}catch(e){this.snackbar.show({text:(0,h.getAPIErrorMessage)(e.error)})}return}const i=parseInt(this.narrativeCoverUploadService.checkedCoverId.split("_")[1])||0;if(this.narrativesEditorService.selectedStoriesArray.find((e=>e.id===i))){const r={owner_id:t,story_ids:s.join(","),cover_story_id:i,crop_width:this.narrativesEditorService.crop.width,crop_height:this.narrativesEditorService.crop.height,title:this.narrativesEditorService.title||"",crop_x:this.narrativesEditorService.crop.x,crop_y:this.narrativesEditorService.crop.y};try{e?(await this.narrativesEditorService.editNarrative({...r,narrative_id:this.narrativeId}),this.narrativesListModelService.needReturnToNarrativeListModal&&await this.narrativesListModelService.updateData()):(await this.narrativesEditorService.createNarrative(r),this.narrativesListModelService.needReturnToNarrativeListModal&&await this.narrativesListModelService.updateData(!0)),this.close()}catch(e){this.snackbar.show({text:(0,h.getAPIErrorMessage)(e.error)})}return}const r={owner_id:t,title:this.narrativesEditorService.title||"",story_ids:s.join(","),cover_story_id:this.narrativesEditorService.selectedStoriesArray[0]?.id||0};try{e?(await this.narrativesEditorService.editNarrative({...r,narrative_id:this.narrativeId}),this.narrativesListModelService.needReturnToNarrativeListModal&&await this.narrativesListModelService.updateData()):(await this.narrativesEditorService.createNarrative(r),this.narrativesListModelService.needReturnToNarrativeListModal&&await this.narrativesListModelService.updateData(!0)),this.close(),this.narrativeCoverUploadService.reset(),this.narrativesEditorService.reset()}catch(e){this.snackbar.show({text:(0,h.getAPIErrorMessage)(e.error)})}},(0,o.makeAutoObservable)(this)}}_=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.StoriesArchiveService?Object:a.StoriesArchiveService,void 0===a.NarrativeListModalService?Object:a.NarrativeListModalService,void 0===a.NarrativesEditorService?Object:a.NarrativesEditorService,void 0===a.NarrativeCoverUploadService?Object:a.NarrativeCoverUploadService,void 0===n.WebLayers?Object:n.WebLayers,void 0===c.Snackbar?Object:c.Snackbar,void 0===r.Props?Object:r.Props,void 0===d.AuthService?Object:d.AuthService])],_);const{useModel:u,Provider:p}=(0,r.createProvider)(_,{initInEffect:!1})},244481:(e,t,s)=>{s.d(t,{NarrativesEditorContent:()=>m});var i=s(474848),r=s(132028),o=s(194528),a=s(303800),n=s(774038),c=s(502656),d=s(456921),l=s(708648),h=s(694942),_=s(742988),u=s(149333);const p=(0,d.observer)((function(){const e=(0,l.useNarrativesEditorContentModel)(),t=(0,u.useLangs)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Spacing,{size:3}),(0,i.jsx)(a.Div,{mode:"vertical",spacing:20,paddingTop:0,paddingBottom:0,children:(0,i.jsxs)(n.Tabs,{mode:"accent",children:[(0,i.jsx)(c.TabsItem,{disabled:!e.selectedStoriesArray.length,selected:"selected"===e.section,onClick:()=>e.setSection("selected"),children:t.getLang("stories_narrative_editor_selected_tab")}),(0,i.jsx)(c.TabsItem,{selected:"all"===e.section,onClick:()=>e.setSection("all"),children:t.getLang("stories_narrative_editor_all_tab")})]})}),"selected"===e.section&&(0,i.jsx)(h.StoriesSelectedList,{}),"all"===e.section&&(0,i.jsx)(_.StoriesAllList,{})]})})),m=(0,r.createWidget)(l.narrativesEditorContentProvider,p)},742988:(e,t,s)=>{s.d(t,{StoriesAllList:()=>g});var i=s(474848),r=s(456921),o=s(720836),a=s(454154),n=s(803012),c=s(303800),d=s(700272),l=s(591378),h=s(570886),_=s(586594),u=s(708648),p=s(507392),m=s(351118),v=s(149333);const g=(0,r.observer)((function(){const e=(0,u.useNarrativesEditorContentModel)(),t=(0,v.useLangs)();return e.isEmpty?(0,i.jsx)(o.Placeholder,{stretched:!0,children:t.getLang("archive_stories_empty")}):e.isError?(0,i.jsx)(o.Placeholder,{stretched:!0,icon:(0,i.jsx)(_.Icon56ErrorOutline,{}),action:(0,i.jsx)(a.Button,{size:"m",onClick:e.ensure,children:t.getLang("global_retry")}),children:t.getLang("global_unexpected_error_try_later")}):(0,i.jsx)(n.VirtualizedList,{Component:c.Div,mode:"vertical",spacing:20,paddingTop:16,paddingBottom:16,height:"100%",gap:8,overscan:10,onChange:e.handleChange,after:e.isLoading&&(0,i.jsx)(c.Div,{spacing:16,children:(0,i.jsx)(d.Spinner,{})}),count:e.virtualizedListCount,estimateSize:290,noOverscroll:!0,children:({index:s})=>(0,i.jsx)(r.Observer,{children:()=>{const r=e.getChunkByIndex(s);return(0,i.jsx)(l.Grid,{stretched:!0,rowSpacing:0,columnSpacing:8,columns:p.ITEMS_PER_ROW,children:e.isFirstLoading?(0,m.createArray)(p.ITEMS_PER_ROW).map((e=>(0,i.jsx)(l.Grid.Item,{children:(0,i.jsx)(h.StoryPreview,{aspectRatio:9/16,imageAlt:"",src:""})},e))):r.map((({data:s,date:r})=>{const o=e.getStoryPreview(s),a=e.isStorySelected(s.id);return(0,i.jsx)(l.Grid.Item,{"data-testid":"story_archive_grid_item",children:(0,i.jsx)(h.StoryPreview,{aspectRatio:9/16,imageAlt:"",src:o,selectable:!0,selected:a,onClick:()=>e.toggleStorySelection(s,{removeOnUnselect:!0}),before:r?(0,i.jsx)(h.StoryPreview.DateBadge,{day:String(new Date(1e3*r).getDate()),month:e.getFormattedMonth(r,t)}):void 0})},s.id)}))},s)}})})}))},694942:(e,t,s)=>{s.d(t,{StoriesSelectedList:()=>m});var i=s(474848),r=s(456921),o=s(299494),a=s(303800),n=s(680118),c=s(591378),d=s(570886),l=s(723723),h=s(240069),_=s(708648),u=s(536490),p=s(320180);const m=(0,r.observer)((function(){const e=(0,_.useNarrativesEditorContentModel)(),t=e.selectedStoriesArray,s=t=>{const s=new Map;t.forEach((t=>{const i=parseInt(t.id,10),r=e.getStory(i);r&&s.set(i,r)})),e.setSelectedStories(s)};return(0,i.jsx)(o.ModalScrollView,{height:`calc(100% - ${h.MODAL_NO_LIST_CONTENT_HEIGHT}px - ${h.FOOTER_HEIGHT}px)`,children:(0,i.jsx)(a.Div,{mode:"vertical",spacing:20,paddingTop:16,paddingBottom:16,children:(0,i.jsx)(r.Observer,{children:()=>(0,i.jsx)(n.Sortable,{items:t.map((e=>({id:String(e.id),label:`Story ${e.id}`}))),onSortChange:s,children:(0,i.jsx)(c.Grid,{columns:4,spacing:8,children:t.map((t=>{const s=(0,u.getStoryPreview)(t,200),r=e.isStorySelected(t.id);return(0,i.jsx)(n.Sortable.Item,{id:String(t.id),label:`Story ${t.id}`,children:(0,i.jsx)(c.Grid.Item,{children:(0,i.jsx)(d.StoryPreview,{selectable:!0,before:(0,i.jsx)(p.Icon24Reorder,{className:(0,l.getColorClass)("color_icon_contrast")}),selected:r,aspectRatio:9/16,imageAlt:`Story ${t.id}`,src:s,onClick:()=>(t=>{e.toggleStorySelection(t)})(t)})})},t.id)}))})})})})})}))},240069:(e,t,s)=>{s.d(t,{FOOTER_HEIGHT:()=>r,HEADER_HEIGHT:()=>o,MODAL_NO_LIST_CONTENT_HEIGHT:()=>i});const i=224,r=62,o=54},853512:(e,t,s)=>{s.d(t,{NarrativesEditorContent:()=>i.NarrativesEditorContent});var i=s(244481)},708648:(e,t,s)=>{s.d(t,{narrativesEditorContentProvider:()=>u,useNarrativesEditorContentModel:()=>_});var i=s(331635),r=s(132028),o=s(327813),a=s(951652),n=s(351118),c=s(507392),d=s(536490),l=s(669928);class h{setSection(e){this.section=e}get myId(){return this.props.current.ownerId}get archive(){return this.narrativesEditorService.getStories()}get chunkedArchive(){const e=new Set,t=(this.archive??[]).map((t=>{const s=(0,d.getStoryZeroTime)(t.date??0);return e.has(s)?{data:t,date:void 0}:(e.add(s),{data:t,date:s})}));return(0,n.chunkArray)(t,c.ITEMS_PER_ROW)}get virtualizedListCount(){return this.isFirstLoading?10*c.ITEMS_PER_ROW:this.chunkedArchive.length}getChunkByIndex(e){return this.chunkedArchive[e]}getStoryPreview(e){return(0,d.getStoryPreview)(e,200)}getFormattedMonth(e,t){return t.date(new Date(1e3*e),"{month}",t.getLang("months_sm_of",!0))}get isFirstLoading(){return this.narrativesEditorService.isFirstLoading}get isLoading(){return this.narrativesEditorService.isLoading}get hasMore(){return this.narrativesEditorService.hasMore}get isEmpty(){return!this.hasMore&&0===this.archive.length}get isError(){return this.narrativesEditorService.isError}getStory(e){return this.narrativesEditorService.getStory(e)}get selectedStoriesArray(){return this.narrativesEditorService.selectedStoriesArray}isStorySelected(e){return this.narrativesEditorService.isStorySelected(e)}toggleStorySelection(e,t){this.narrativesEditorService.toggleStorySelection(e,t)}removeStoryFromSelected(e){this.narrativesEditorService.removeStoryFromSelected(e)}clearSelectedStories(){this.narrativesEditorService.clearSelectedStories()}setSelectedStories(e){this.narrativesEditorService.setSelectedStories(e)}async fetchMore(){await this.narrativesEditorService.fetchNextStories()}async[r.init](){this.props.current.narrativeId&&await this.narrativesEditorService.fetchNarratives(this.props.current.ownerId,this.props.current.narrativeId),this.narrativesEditorService.selectedStoriesArray.length||this.setSection("all"),this.archive.length||await this.ensure()}constructor(e,t,s){this.authService=e,this.narrativesEditorService=t,this.props=s,this.section="selected",this.handleChange=e=>{if(!e.range)return;const{endIndex:t}=e.range;if(!e.range||this.isLoading||!this.hasMore||this.isFirstLoading)return;(t-c.ROW_GAP_FOR_FETCH)*c.ITEMS_PER_ROW>=this.archive.length-c.PRE_FETCH_ROWS*c.ITEMS_PER_ROW&&this.fetchMore()},this.ensure=async()=>{try{await this.narrativesEditorService.fetchStories({owner_id:this.myId})}catch(e){console.error("Failed to fetch stories archive:",e)}},(0,o.makeAutoObservable)(this)}}h=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.AuthService?Object:a.AuthService,void 0===l.NarrativesEditorService?Object:l.NarrativesEditorService,void 0===r.Props?Object:r.Props])],h);const{useModel:_,Provider:u}=(0,r.createProvider)(h,{initInEffect:!1})},625215:(e,t,s)=>{s.d(t,{NarrativesEditorCoverCropper:()=>v});var i=s(474848),r=s(132028),o=s(63614),a=s(724648),n=s(220208),c=s(958188),d=s(194528),l=s(908242),h=s(454154),_=s(456921),u=s(177114),p=s(149333);const m=(0,_.observer)((function(){const e=(0,u.useNarrativesEditorCoverCropperModel)(),{coverUrl:t,coverWidth:s,coverHeight:r,crop:_}=e.props.current,{getLang:m}=(0,p.useLangs)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.ModalBody,{insetLevel:0,children:(0,i.jsxs)(a.Flex,{direction:"column",align:"center",children:[(0,i.jsxs)(n.Footer,{Component:"div",children:[(0,i.jsx)("div",{children:m("stories_cover_cropper_info_1")}),(0,i.jsx)("div",{children:m("stories_cover_cropper_info_2")})]}),(0,i.jsx)(c.PhotoAreaSelector,{cropAreaSquared:!0,showPreview:!0,mode:"circle",imgSrc:t,imageLabel:m("profile_cover_photo_area_selector_image_label"),previewLabel:m("profile_cover_photo_area_selector_preview_label"),imgWidth:s,imgHeight:r,thumbWidth:e.thumbCoverWidth,thumbHeight:e.thumbCoverHeight,cropAreaMinWidth:75,cropAreaMinHeight:75,cropArea:e.getCropArea(_),onCropAreaUpdated:e.onCropUpdate}),(0,i.jsx)(d.Spacing,{size:24})]})}),(0,i.jsx)(l.ModalFooter,{actions:[(0,i.jsx)(h.Button,{onClick:e.props.current.back,mode:"secondary",children:m("global_cancel")},"cancel"),(0,i.jsx)(h.Button,{onClick:e.onCropSave,children:m("global_next")},"next")]})]})})),v=(0,r.createWidget)(u.NarrativesEditorCoverCropperProvider,m)},566690:(e,t,s)=>{s.d(t,{MAX_THUMB_HEIGHT:()=>i,MAX_THUMB_WIDTH:()=>r});const i=540,r=468},177114:(e,t,s)=>{s.d(t,{NarrativesEditorCoverCropperProvider:()=>p,useNarrativesEditorCoverCropperModel:()=>u});var i=s(331635),r=s(132028),o=s(327813),a=s(909209),n=s(566690),c=s(421334),d=s(501397),l=s(712600),h=s(670252);class _{async[r.init](){this.calcThumbSizes()}getCropArea(e){const{coverWidth:t,coverHeight:s}=this.props.current;let i;if(e){let r=Math.round(e.width*t),o=Math.round(e.height*s);if(Math.abs(o-r)>1)return i;o=r,i={top:Math.round(e.y*s),left:Math.round(e.x*t),width:r,height:o}}return i}calcThumbSizes(){const e=this.props.current.coverWidth,t=this.props.current.coverHeight;if(!e||!t)return;const s=e/t;let i,r;e>=t?(i=Math.min(e,n.MAX_THUMB_WIDTH),r=Math.floor(i/s),r>n.MAX_THUMB_HEIGHT&&(r=n.MAX_THUMB_HEIGHT,i=Math.floor(r*s))):(r=Math.min(t,n.MAX_THUMB_HEIGHT),i=Math.floor(r*s),i>n.MAX_THUMB_WIDTH&&(i=n.MAX_THUMB_WIDTH,r=Math.floor(i/s))),this.thumbCoverHeight=r,this.thumbCoverWidth=i}getCropForSaving(e){const{coverWidth:t,coverHeight:s}=this.props.current;return{y:e.top/s,x:e.left/t,width:e.width/t,height:e.height/s}}constructor(e,t,s,i){this.langs=e,this.snackbar=t,this.narrativesEditorService=s,this.props=i,this.thumbCoverWidth=0,this.thumbCoverHeight=0,this.isCropping=!1,this.resultCrop=null,this.onCropUpdate=e=>{this.resultCrop=e},this.onCropSave=async()=>{const{coverUrl:e}=this.props.current,t=this.resultCrop;if(t)try{const s=await(0,c.getCroppedImage)(e,t.left,t.top,t.width,t.height);this.props.current.save(this.getCropForSaving(t),s.src)}catch(e){this.snackbar.show({type:"error",text:e||this.langs.getLang("global_unknown_error")}),console.error(e),(0,d.logError)(new Error("error with onSaveCrop"+(e?`: ${e}`:"")))}finally{this.isCropping=!1}},(0,o.makeAutoObservable)(this)}}_=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===l.Langs?Object:l.Langs,void 0===h.Snackbar?Object:h.Snackbar,void 0===a.NarrativesEditorService?Object:a.NarrativesEditorService,void 0===r.Props?Object:r.Props])],_);const{useModel:u,Provider:p}=(0,r.createProvider)(_,{initInEffect:!1})},353813:(e,t,s)=>{s.d(t,{NarrativesEditorHeader:()=>k});var i=s(474848),r=s(132028),o=s(303800),a=s(724648),n=s(213338),c=s(285056),d=s(546642),l=s(723723),h=s(612196),_=s(44544),u=s(134896),p=s(220208),m=s(456921),v=s(490732),g=s(277951),f=s(584023),y=s(149333),S=s(327595),w=s(536490);const b=(0,m.observer)((function(){const e=(0,v.useNarrativesEditorHeaderModel)(),t=(0,y.useLangs)(),s=e.narrativesEditorService.selectedStoriesArray,r=!!s.length;return(0,i.jsx)(o.Div,{mode:"vertical",spacing:16,paddingTop:12,paddingBottom:12,children:(0,i.jsxs)(a.Flex,{direction:"row",gap:"s",children:[(0,i.jsx)(a.Flex.Item,{flex:"fixed",flexBasis:74,children:(0,i.jsx)(n.HorizontalCell,{title:(0,i.jsx)(c.Caption,{className:g.default.title,children:(0,i.jsx)(d.EllipsisText,{className:(0,l.getColorClass)("color_text_secondary"),maxLines:2,children:e.title||t.getLang("stories_narrative_name_full")})}),children:(0,i.jsx)(h.Avatar,{src:r?e.coverUrl||(0,w.getStoryPreview)(s[0]):void 0,alt:"",onClick:()=>r&&e.setScreen("cover_select"),size:56,children:r&&(0,i.jsx)(h.Avatar.Overlay,{visibility:"on-hover",children:(0,i.jsx)(S.Icon24PenOutline,{})})})})}),(0,i.jsx)(a.Flex.Item,{flex:"fixed",flexBasis:360,children:(0,i.jsx)(_.FormItem,{top:(0,i.jsx)(u.FormItemLabel,{aside:(0,i.jsxs)(c.Footnote,{children:[e.title.length," / ",f.MAX_TITLE_SYMBOLS]}),children:(0,i.jsx)(c.Footnote,{children:t.getLang("stories_narrative_name")})}),children:(0,i.jsx)(p.Input,{maxLength:f.MAX_TITLE_SYMBOLS,placeholder:t.getLang("stories_enter_name"),value:e.title,onChange:t=>e.setTitle(t.target.value)})})})]})})})),k=(0,r.createWidget)(v.narrativesEditorHeaderProvider,b)},584023:(e,t,s)=>{s.d(t,{MAX_TITLE_SYMBOLS:()=>i});const i=23},700158:(e,t,s)=>{s.d(t,{NarrativesEditorHeader:()=>i.NarrativesEditorHeader});var i=s(353813)},490732:(e,t,s)=>{s.d(t,{narrativesEditorHeaderProvider:()=>d,useNarrativesEditorHeaderModel:()=>c});var i=s(331635),r=s(132028),o=s(327813),a=s(909209);class n{get screen(){return this.narrativesEditorService.screen}get coverUrl(){return this.narrativesEditorService.narrativeCoverUrl}setScreen(e){return this.narrativesEditorService.setScreen(e)}get title(){return this.narrativesEditorService.title}setTitle(e){this.narrativesEditorService.title=e}constructor(e){this.narrativesEditorService=e,(0,o.makeAutoObservable)(this)}}n=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.NarrativesEditorService?Object:a.NarrativesEditorService])],n);const{useModel:c,Provider:d}=(0,r.createProvider)(n,{initInEffect:!1})},351435:(e,t,s)=>{s.d(t,{StoriesCoverSelect:()=>T});var i=s(474848),r=s(132028),o=s(63614),a=s(122914),n=s(720836),c=s(299494),d=s(194528),l=s(285056),h=s(303800),_=s(591378),u=s(293116),p=s(390292),m=s(723723),v=s(570886),g=s(456921),f=s(296540),y=s(637770),S=s(240069),w=s(507392),b=s(304105),k=s(285218),E=s(447552),C=s(149333);const I=(0,g.observer)((function(){const e=(0,y.useStoriesCoverSelectModel)(),[t,s]=(0,f.useState)(!1),r=(0,C.useLangs)(),g=(0,f.useRef)(),I=e=>{("file"===e?.dataTransfer?.items[0]?.kind||e?.dataTransfer?.types?.includes("Files"))&&(clearTimeout(g.current),g.current=void 0,s(!0)),e.preventDefault()},T=e=>{clearTimeout(g.current),g.current=setTimeout((()=>{g.current=void 0,s(!1)}),100),e.preventDefault()},L=t=>{T(t),t?.dataTransfer?.files?.length&&(e.onFilesLoad(Array.from(t.dataTransfer.files)),s(!1)),t.preventDefault()};return(0,f.useEffect)((()=>{const e=document.body;return e.addEventListener("drop",L),e.addEventListener("dragenter",I),e.addEventListener("dragover",I),e.addEventListener("dragleave",T),()=>{e.removeEventListener("drop",L),e.removeEventListener("dragenter",I),e.removeEventListener("dragover",I),e.removeEventListener("dragleave",T),g.current&&clearTimeout(g.current)}}),[]),t?(0,i.jsx)(o.ModalBody,{className:b.default.modalBody,insetLevel:2,children:(0,i.jsx)(a.DragAndDropInput,{accept:k.ALLOWED_TYPES,onChange:t=>{e.onFilesLoad(t),s(!1)},stretched:!0,children:(0,i.jsx)(n.Placeholder,{stretched:!0,children:r.getLang("stories_narrative_cover_drop_hint")})})}):(0,i.jsxs)(c.ModalScrollView,{height:`calc(100% - ${S.HEADER_HEIGHT}px - ${S.FOOTER_HEIGHT}px)`,children:[(0,i.jsxs)(n.Placeholder,{maxWidth:380,noPadding:!0,children:[(0,i.jsx)(d.Spacing,{size:36}),(0,i.jsx)(l.Footnote,{children:r.getLang("stories_choose_cover_hint")}),(0,i.jsx)(d.Spacing,{size:14})]}),(0,i.jsx)(h.Div,{mode:"vertical",spacing:20,children:(0,i.jsxs)(_.Grid,{rowSpacing:8,columnSpacing:8,columns:w.ITEMS_PER_ROW,children:[(0,i.jsx)(_.Grid.Item,{children:(0,i.jsx)(a.DragAndDropInput,{accept:k.ALLOWED_TYPES,onChange:t=>{e.onFilesLoad(t)},stretched:!0,enableInteractive:!0,children:(0,i.jsx)(n.Placeholder,{icon:(0,i.jsx)(E.Icon28PictureOutline,{}),stretched:!0,children:r.getLang("stories_upload_narrative_cover")})})}),e.customCover&&"uploading"===e.customCover.status&&(0,i.jsx)(_.Grid.Item,{children:(0,i.jsx)(u.Image,{widthSize:"100%",heightSize:"100%",children:(0,i.jsx)(p.CircleProgress,{size:24,strokeSize:2,value:e.customCover.percent||0,max:100,min:10,className:(0,m.getColorClass)("color_icon_medium")})})}),e.customCover&&"uploading"!==e.customCover.status&&(0,i.jsx)(_.Grid.Item,{children:(0,i.jsx)(v.StoryPreview,{selectable:!0,src:e.customCover.url,onClick:()=>{e.selectCustomCover()},selected:e.narrativeCoverUploadService.checkedCoverId===e.customCover.id,aspectRatio:9/16,imageAlt:""})}),e.storiesCovers.map((t=>(0,i.jsx)(_.Grid.Item,{children:(0,i.jsx)(v.StoryPreview,{selectable:!0,aspectRatio:9/16,imageAlt:"",src:t.url||"",onClick:()=>e.toggleStoryCover(t.coverStoryId||0),selected:e.narrativeCoverUploadService.checkedCoverId===t.id})},t.id)))]})})]})})),T=(0,r.createWidget)(y.storiesCoverSelectProvider,I)},944561:(e,t,s)=>{s.d(t,{StoriesCoverSelect:()=>i.StoriesCoverSelect});var i=s(351435)},637770:(e,t,s)=>{s.d(t,{storiesCoverSelectProvider:()=>g,useStoriesCoverSelectModel:()=>v});var i=s(331635),r=s(132028),o=s(327813),a=s(909209),n=s(712600),c=s(285218),d=s(536490),l=s(994846),h=s(405972),_=s(137745),u=s(677587),p=s(873900);class m{get customCover(){if("idle"!==this.narrativeCoverUploadService.customCoverStatus)return{id:c.CustomCoverId,url:this.narrativeCoverUploadService.customCoverUrl,customPhotoOriginalUrl:this.narrativeCoverUploadService.customCoverOriginalUrl,percent:this.narrativeCoverUploadService.customCoverPercent,status:this.narrativeCoverUploadService.customCoverStatus,uploadResponse:this.narrativeCoverUploadService.customCoverUploadResponse}}get selectedStories(){return this.narrativesEditorService.selectedStoriesArray}get storiesCovers(){return this.selectedStories.map((e=>({id:(0,p.getIdentityRawId)({ownerId:e.owner_id,id:e.id}),url:(0,d.getStoryPreview)(e,200)||"",coverStoryId:e.id})))}async uploadCustomCover(e,t){if(!this.narrativeCoverUploadService.isUploadingCover&&this.narrativeCoverUploadService.file){this.narrativeCoverUploadService.startUploading();try{const s=await this.narrativeCoverUploadService.getCustomCoverUploadUrl(e||0),i=(0,d.createCoverUploadConfig)(s.upload_url||"",t),r=new h.UploadPhoto(i,((e,t)=>{(0,o.runInAction)((()=>this.narrativeCoverUploadService.setProgress(e,t)))})),a=(0,_.isHeicFile)(this.narrativeCoverUploadService.file),n=await r.upload({file:this.narrativeCoverUploadService.file,validateSizes:!a});if(n?.error_code)throw n;const c=JSON.stringify(n),p=this.narrativeCoverUploadService.file;if(!p)return;let m="";if(a){const[t,s,i]=await(0,l.getImageDataFromStorageResponse)(e,c),o=r.validateSizes([s,i]);if(o)throw new Error(o.text);m=t}else m=URL.createObjectURL(p);const v=await(0,u.loadImage)(m);this.narrativeCoverUploadService.finishUploading(m,c,v.width,v.height)}catch(e){throw console.error("Failed to upload custom cover:",e),e}finally{this.narrativeCoverUploadService.resetUploadState(),this.narrativeCoverUploadService.file=null}}}async uploadCover(){if(this.narrativeCoverUploadService.file&&!this.narrativeCoverUploadService.isUploadingCover)try{await this.uploadCustomCover(this.props.current.ownerId||0,this.langs),this.narrativeCoverUploadService.checkedCoverId=c.CustomCoverId}catch(e){this.handleUploadError(e)}}handleUploadError(e){const t=(0,l.getUploadErrorMessage)(e,this.langs);(0,l.showUploadError)(t,this.langs),this.narrativeCoverUploadService.handleUploadError()}async[r.init](){if(!this.narrativeCoverUploadService.checkedCoverId){const e=this.storiesCovers;e.length>0&&!this.narrativeCoverUploadService.checkedCoverId&&(this.narrativeCoverUploadService.checkedCoverId=e[0].id)}}constructor(e,t,s,i){this.langs=e,this.narrativesEditorService=t,this.narrativeCoverUploadService=s,this.props=i,this.onFilesLoad=e=>{const t=e?.[0];t&&!this.narrativeCoverUploadService.isUploadingCover&&(this.narrativeCoverUploadService.file=t,this.uploadCover())},this.selectCustomCover=()=>{this.narrativeCoverUploadService.checkedCoverId=c.CustomCoverId},this.toggleStoryCover=e=>{this.narrativeCoverUploadService.checkedCoverId=(0,p.getIdentityRawId)({ownerId:this.props.current.ownerId,id:e})},(0,o.makeAutoObservable)(this)}}m=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===n.Langs?Object:n.Langs,void 0===a.NarrativesEditorService?Object:a.NarrativesEditorService,void 0===a.NarrativeCoverUploadService?Object:a.NarrativeCoverUploadService,void 0===r.Props?Object:r.Props])],m);const{useModel:v,Provider:g}=(0,r.createProvider)(m,{initInEffect:!1})},285218:(e,t,s)=>{s.d(t,{ALLOWED_TYPES:()=>r,CustomCoverId:()=>i});const i="custom",r=["image/jpeg","image/png","image/gif","image/heic","image/heif","image/webp"]},994846:(e,t,s)=>{s.d(t,{getImageDataFromStorageResponse:()=>n,getUploadErrorMessage:()=>o,showUploadError:()=>a});var i=s(270959),r=(s(285218),s(761520));function o(e,t){return e?.error_code&&t.getLang("global_update_photo_error_upload")||e?.error_text||String(e||"")}function a(e,t){(0,i.showFastBox)(t.getLang("global_error"),e)}function n(e,t){return new Promise(((s,i)=>{r.ajax.post("al_page.php",{act:"get_photo_url",oid:e,photo:t},{onDone:(e,t,i)=>{s([e,t,i])},onFail:()=>(i(),!0)})}))}},507392:(e,t,s)=>{s.d(t,{DATE_BADGE_TOP_OFFSET:()=>c,ITEMS_PER_ROW:()=>i,MAX_NARRATIVES_COUNT:()=>n,PRE_FETCH_ROWS:()=>o,ROW_GAP_FOR_FETCH:()=>r,STORIES_ARCHIVE_ZINDEX:()=>a});const i=4,r=2,o=5,a=500,n=100,c=56},715246:(e,t,s)=>{s.d(t,{StoriesBlock:()=>p});var i=s(474848),r=s(132028),o=s(456921),a=s(120710),n=s(672765),c=s(152517),d=s(784536),l=s(149333),h=s(657921),_=s(75385);const u=(0,o.observer)((function(){const e=(0,n.useStoriesBlockViewModel)(),t=e.props.current.dataManager,s=(0,l.useLangs)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.StoryBlock,{listName:t.listName,viewer:t.feed.viewer,groups:t.feed.groups,onCacheShown:t.onCacheDataShown,forceShowingCache:t.forceShowingCache,list:t.list,cacheList:t.cacheList,onCreateStoryClick:e.props.current.onCreateStoryClick,onShow:e.onShow,onStoryClick:e.props.current.onStoryClick,aside:(0,i.jsx)(d.Tooltip,{placement:"top",text:s.getLang("stories_settings"),hideWhenReferenceHidden:!0,children:(0,i.jsx)(c.Icon20GearOutline,{onClick:()=>{(0,_.isSPAStoriesViewerEnabledWeb)()?e.openSettingsModal():e.props.current.onStoriesSettingsClick()}})}),sendStoryFeedViewItemEvent:e.analytics.sendStoryFeedViewItemEvent,withCreateButton:e.needShowCreateButton,withSkeleton:e.needShowSkeleton,skeleton:e.props.current.skeleton,renderOnFailedDataList:e.renderOnFailedDataList}),(0,i.jsx)(h.LocalModalsSwitcher,{controller:e.controller})]})})),p=(0,r.createWidget)(n.StoriesBlockViewModelProvider,u)},616782:(e,t,s)=>{s.d(t,{StoryBlock:()=>k});var i=s(474848),r=s(568022),o=s(149333),a=s(632731),n=s(219769),c=s(984745),d=s(887326),l=s(15978),h=s(325968),_=s(344356),u=s(591378),p=s(519540),m=s(456921),v=s(296540),g=s(119181),f=s(536490),y=s(634444),S=s(332303),w=s(122402),b=s(861808);(0,S.createDebugConsole)("__stories_block_cache_debug_logs");const k=(0,m.observer)((function({list:e,cacheList:t,forceShowingCache:s,onCacheShown:m,listName:S,viewer:k,aside:E,withSkeleton:C=!0,withCreateButton:I=!1,onShow:T,onCreateStoryClick:L,onStoryClick:M,skeleton:A,renderOnFailedDataList:x,groups:P,sendStoryFeedViewItemEvent:R}){const O=a.AvailableHelpHints.ACCOUNT_HINT_STORIES_CREATOR_FEED_WEB,N=(0,n.useIsHelpHintActive)(O)&&(P?.data?.items||[]).filter((e=>!e.deactivated)).length>0,[B,D]=(0,v.useState)(!0),F=(0,v.useRef)(!1),j=(0,v.useRef)(null),U=e=>`${S}_${e}`,V=(0,d.useAppearanceDetector)(),H=Boolean(I&&k?.data),W=H?5:6,K=e=>document.getElementById(U(e));(0,g.useScrollStoryToCenter)({containerRef:j,getStoryElement:K}),(0,g.useResetScroll)({containerRef:j});const G=t?.data&&(s||!e.data),$=G?t?.data:e.data,q=($?.items||[]).map((e=>{const t="discover"===e.type,s=(0,f.getFirstStoryForRendering)(e),i=(0,f.getPreviewForStoryItem)(e,s,!0),r=(0,f.getThumbhashFromStoryItem)(e,s,!0),o=t?-1:s?.owner_id||e.owner_id,a=(0,f.findOwnerById)(o,$?.profiles,$?.groups),n=(0,f.getStoryAvatar)(e,a);return{item:e,href:(0,f.getStoryHref)(s,a),avatar:n,preview:i,thumbhash:r,ownerId:o,trackCode:t?e.track_code:s?.track_code||null}})),z=(0,o.useLangs)(),Q={component:E,label:z.getLang("stories_settings")},Y=()=>{B&&(D(!1),(0,c.ensureAccountHelpHintsService)().hideHelpHint({hintId:O}))},X=((e.isLoading()||e.isInitial?.())&&!t?.data||k?.isLoading())&&C;let J;J=x?!I&&!q.length:!I&&!q.length||e.isFailed()&&!t?.data;const Z=!X&&!J,ee=(0,v.useRef)(!1);(0,v.useEffect)((()=>{T&&!ee.current&&Z&&(T(),ee.current=!0)}));const te=(0,y.useStableCallback)((()=>{m?.()})),se=!X&&!J,ie=se&&Boolean(!e?.data&&t?.data);(0,v.useEffect)((()=>{ie&&te()}),[ie]);const re=se?G:void 0;if((0,v.useEffect)((()=>{}),[re]),X)return A;if(J)return null;const oe=()=>{L?.()},ae=!N&&B||F.current?void 0:e=>(0,i.jsx)(l.AppearanceProvider,{value:V,children:(0,i.jsx)(h.OnboardingMarkedTooltip,{shown:B,tipPosition:"bottom-right",content:(0,i.jsx)(_.Interpolate,{allowedHTML:{br:!0},children:z.getLang("stories_add_onbording")}),disableFlipMiddleware:!0,size:64,onClick:()=>Y(),onMarkerClick:()=>{Y(),oe()},maxWidth:250,onClose:()=>Y(),mode:"3",zIndex:1,onShowStart:()=>{setTimeout((()=>Y()),5e3),j.current?.addEventListener("scroll",(()=>{F.current=!0,Y()}),{once:!0})},children:e})});return(0,i.jsx)("div",{className:w.default.noIslandsContainer,children:(0,i.jsx)(u.Grid,{columns:"dynamic",spacing:8,children:(0,i.jsxs)(u.Grid.HorizontalScroll,{arrowSize:"m",scrollOnAnyWheel:!0,getRef:j,children:[H&&k?.data&&(0,i.jsx)(u.Grid.Item,{"data-testid":"story-create",children:(0,i.jsx)(p.StoryCard,{onClick:oe,preview:k.data.photo_200_orig,loading:"eager",name:z.getLang("stories_add_title"),hasIncreasedBorderRadius:!0,aside:Q,type:"create",avatarWrapper:ae})},"create"),q.map((({item:e,avatar:t,preview:s,href:o,thumbhash:a,ownerId:n,trackCode:c},d)=>{const l=String(e.id||d),{borderStyle:h="",textStyle:_=""}=e.decoration_config?(0,f.mapDecorationConfigToProps)(e.decoration_config):{},m=U(l);return(0,i.jsx)(u.Grid.Item,{children:(0,i.jsx)(b.TrackStoryCardVisibility,{onVisible:()=>{n&&c&&R(n,c)},children:(0,i.jsx)(p.StoryCard,{id:m,thumbhash:d<W?a:void 0,preview:s,loading:d<W?"eager":"lazy",avatar:t,name:e.name,"data-type":`story_card_${e.type}`,"data-testid":`story_card_${e.type}`,type:(0,f.getStoryCardType)(e.type),seen:!(0,f.isBlockItemHasUnseenStories)(e),outlineColor:h,textColor:_,onClick:async t=>{await(0,r.preventLinkOpening)(t.nativeEvent),e.id&&M?.({fromEl:t.target,getStoryCardElement:K,item:e})},hasIncreasedBorderRadius:!0,href:o})})},l)}))]})})})}))},120710:(e,t,s)=>{s.d(t,{StoryBlock:()=>i.StoryBlock});var i=s(616782)},633015:(e,t,s)=>{s.d(t,{FEED_STORIES_BLOCK_NUMBER_OF_STORIES_TO_PRELOAD:()=>i});const i=6},874488:(e,t,s)=>{s.d(t,{StoriesCacheLegacy:()=>d});var i=s(331635),r=s(591024),o=s(901089),a=s(646938),n=s(132028),c=s(327813);class d{hasStoryList(e){return Boolean((0,o.getStoryList)(e))}setApiStoryList(e,t){(0,o.setStoryList)(e,(0,r.transformStoryGetApiResponseToLegacyFormat)(t,e,!1))}saveDiscover(e){const t=(0,o.getStoryList)(a.StoryListName.feed);if(t){const s=t.find((e=>e.type===a.StoryBlockType.discover));if(s){const t=(0,o.transformApiStoryList)(a.StoryListName.discover,e);s.grouped=[...s.grouped||[],...t],s.next_from=e?.next_from||""}(0,o.setStoryList)(a.StoryListName.feed,t)}}constructor(){(0,c.makeAutoObservable)(this)}}d=(0,i.__decorate)([n.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[])],d)},602760:(e,t,s)=>{s.d(t,{StoriesEvents:()=>d});var i=s(331635),r=s(321193),o=s(5297),a=s(132028),n=s(327813),c=s(509319);class d{dispatchDiscoverLoadedEvent(){(0,r.dispatchDiscoverLoadedEvent)()}dispatchFeedLoadedEvent(){(0,r.dispatchFeedLoadedEvent)()}dispatchFeedFailedEvent(){(0,r.dispatchFeedFailedEvent)()}dispatchSearchFeedLoadedEvent(){(0,r.dispatchSearchFeedLoadedEvent)()}subscribe(e,t){return window.addEventListener(e,t),()=>window.removeEventListener(e,t)}dispatchStoryBlockScrollToCenterEvent(e){window.dispatchEvent(new CustomEvent(o.StoryBlockCustomEvent.BLOCK_SCROLL_TO_CENTER,{detail:e}))}dispatchStoryBlockResetScrollEvent(){window.dispatchEvent(new CustomEvent(o.StoryBlockCustomEvent.BLOCK_RESET_SCROLL))}dispatchFeedListModifiedEvent(e){window.dispatchEvent(new CustomEvent(c.StoryCustomEventName.LIST_MODIFIED,{detail:e}))}constructor(){(0,n.makeAutoObservable)(this)}}d=(0,i.__decorate)([a.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[])],d)},278591:(e,t,s)=>{s.d(t,{StoriesPreloader:()=>u});var i=s(331635),r=s(901089),o=s(646938),a=s(246429),n=s(210816),c=s(392324),d=s(132028),l=s(327813),h=s(24516),_=s(393891);class u{preloadDiscoverList(e,t){if(window.cur.storiesDiscoverFetchingPromise)return window.cur.storiesDiscoverFetchingPromise;let s,i;const n=(0,r.getStoryList)(o.StoryListName.feed);return n&&(i=n.find((e=>e.type===o.StoryBlockType.discover)),i&&(s=i.track_code)),t&&(0,a.showBoxLoader)(),window.cur.storiesDiscoverFetchingPromise=e.fetch(s).then((()=>{let e;const t=(0,r.getStoryList)(o.StoryListName.feed);if(t){const s=t.find((e=>e.type===o.StoryBlockType.discover));s?.grouped&&(e=s?.grouped)}return e||Promise.reject(new Error("empty discover list"))})).finally((()=>{t&&(0,a.hideBoxLoader)(),delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise}async preloadList(e,t,s){const i=(0,_.getLatestFeedBlockNonce)(),r=(0,_.getTimeSinceNavigation)().isAjaxNav?0:1;try{s?await t.fetch(s):await e.fetch(),(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web"))&&i&&(0,_.trackStoryBlockDataLoadingEnd)({nonce:i,isFullPageLoad:Boolean(r)})}catch(e){(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web"))&&i&&(0,_.trackStoryBlockDataLoadingError)({error:e,nonce:i,isFullPageLoad:Boolean(r)}),console.error(e);const t=e.error?.error_code;if(t===c.API_ERROR_SECTION_DISABLED||t===c.API_ERROR_RATE_LIMIT||0===t)return;(0,n.logStoriesError)({error:e,additionalText:s?"could not fetch search list":"could not fetch feed list",extra:s?{query:s}:void 0})}}constructor(e){this.userEnv=e,(0,l.makeAutoObservable)(this)}}u=(0,i.__decorate)([d.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===h.UserEnv?Object:h.UserEnv])],u)},13652:(e,t,s)=>{s.d(t,{StoriesCacheLegacy:()=>i.StoriesCacheLegacy,StoriesEvents:()=>r.StoriesEvents,StoriesPreloader:()=>o.StoriesPreloader});var i=s(874488),r=s(602760),o=s(278591)},119181:(e,t,s)=>{s.d(t,{useResetScroll:()=>i.useResetScroll,useScrollStoryToCenter:()=>r.useScrollStoryToCenter});s(421041);var i=s(188658),r=s(964438)},421041:(e,t,s)=>{s(296540),s(996361),s(253132)},188658:(e,t,s)=>{s.d(t,{useResetScroll:()=>o});var i=s(296540),r=s(509319);const o=({containerRef:e})=>{(0,i.useEffect)((()=>{const t=()=>{const t=e.current;t&&(t.scrollLeft=0)};return window.addEventListener(r.StoryBlockCustomEvent.BLOCK_RESET_SCROLL,t),()=>{window.removeEventListener(r.StoryBlockCustomEvent.BLOCK_RESET_SCROLL,t)}}),[])}},964438:(e,t,s)=>{s.d(t,{useScrollStoryToCenter:()=>n});var i=s(552252),r=s(634444),o=s(296540),a=s(509319);const n=({containerRef:e,getStoryElement:t})=>{const s=(0,r.useStableCallback)(t),n=(0,o.useCallback)((t=>{const{blockItemId:i}=t.detail,r=s(i),o=e.current;o&&r&&(o.scrollLeft=r.offsetLeft+r.offsetWidth/2-o.offsetWidth/2)}),[]);(0,i.useWindowEventListener)(a.StoryBlockCustomEvent.BLOCK_SCROLL_TO_CENTER,n)}},454110:(e,t,s)=>{s.d(t,{StoriesBlock:()=>i.StoriesBlock,StoriesBlockManager:()=>r.StoriesBlockManager});var i=s(715246),r=s(482852)},529898:(e,t,s)=>{s.d(t,{GroupsService:()=>c});var i=s(331635),r=s(132028),o=s(678627),a=s(507380),n=s(327813);class c{async fetch(){if(this.promise)return this.promise;this.status="loading",this.controller=new AbortController,this.promise=this.fetchGroups();try{const e=await this.promise;return this.onSuccess(e)}catch(e){return this.onFail(e),null}finally{delete this.promise}}isLoading(){return"loading"===this.status}isLoaded(){return"loaded"===this.status}isFailed(){return"failed"===this.status}abort(){this.controller&&(this.controller.abort(),this.status=this.data?"loaded":"initial",delete this.promise)}reset(){this.abort(),this.data=null,this.status="initial"}onSuccess(e){return this.data=e,this.status="loaded",e}onFail(e){e?.error&&(0,a.isRequestAbortError)(e.error)||(this.status="failed")}async fetchGroups(){return await this.groupsProvider.fetchGroupsExtended({filter:"editor"},{controller:this.controller})??null}constructor(e){this.groupsProvider=e,this.data=null,this.status="initial",(0,n.makeAutoObservable)(this)}}c=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.GroupsProviderV2?Object:o.GroupsProviderV2])],c)},482852:(e,t,s)=>{s.d(t,{StoriesBlockManager:()=>v});var i=s(331635),r=s(132028),o=s(24516),a=s(873900),n=s(327813),c=s(652469),d=s(509319),l=s(536490),h=s(909209),_=s(670404),u=s(40125),p=s(821161),m=s(13652);class v{get storiesEvents(){if(!this.events)throw new Error("storiesEvents not initialized");return this.events}get storiesCache(){if(!this.cache)throw new Error("storiesCache not initialized");return this.cache}get preloaderService(){if(!this.preloader)throw new Error("preloader not initialized");return this.preloader}init(){this.initiated=!0,this.addCustomEvents(),this.processList()}buildBlockMap(){this.listData&&(this.blocksById={},this.listData.items.forEach(((e,t)=>{this.blocksById[e.id||t]={block:e},e.grouped?.forEach((s=>{this.blocksById[s.id||t]={block:s,parentBlock:e}}))})))}applyCacheSeenEvents(){this.storiesSeenEventsFromCache.forEach((e=>{this.onStoriesSeen(e)})),this.storiesSeenEventsFromCache.clear()}onStoriesSeen(e){this.isFeedModeActive&&!this.feed.getList().data&&this.storiesSeenEventsFromCache.add(e);e.detail.forEach((e=>{const t=e.storyRawIdSet,s=this.blocksById[e.blockId]?.block,i=this.blocksById[e.blockId]?.parentBlock;if(s&&(0,l.isBlockItemHasUnseenStories)(s)){let e=!1;if(s.stories?.forEach((s=>{s.seen||(t.has((0,a.getIdentityRawId)({ownerId:s.owner_id,id:s.id}))?s.seen=1:e=!0)})),s.grouped?.forEach((t=>{(0,l.isBlockItemHasUnseenStories)(t)&&(e=!0)})),e!==s.has_unseen&&(s.has_unseen=e,i)){let e=!1;i.grouped?.forEach((t=>{(0,l.isBlockItemHasUnseenStories)(t)&&(e=!0)})),e!==i.has_unseen&&(i.has_unseen=e)}}}))}onListModifiedOutside(e){e.detail.listName===this.listName&&this.loadList()}onStoryViewerLayerClose(e){this.storiesEvents.dispatchStoryBlockScrollToCenterEvent({blockItemId:e.detail.currentBlockId})}get isSearchFeedModeActive(){return this.isCurrentListSearchList}get isFeedModeActive(){return!this.isSearchFeedModeActive}isSearchFeedListLoading(){return this.searchFeed.isLoading()}isListLoaded(){return this.isFeedModeActive?this.feed.isLoaded():this.searchFeed.isLoaded()}isListLoading(){return this.isFeedModeActive?this.feed.isLoading():(this.feed.fetch(),this.searchFeed.isLoading())}getFetchingPromise(){return this.isFeedModeActive?this.feed.getFetchingPromise():this.searchFeed.getFetchingPromise()}isListEmpty(){return!this.listData}isFeedListEmpty(){return!this.feed.getList().data}addCustomEvents(){const e=[[d.StoryCustomEventName.STORIES_SEEN,this.onStoriesSeen.bind(this)],[d.StoryCustomEventName.CLOSE_LAYER,this.onStoryViewerLayerClose.bind(this)],[d.StoryCustomEventName.LIST_MODIFIED,this.onListModifiedOutside.bind(this)],[d.StoryRequestCustomEventName.FEED_LOADED,this.onFeedListLoaded.bind(this)],[d.StoryRequestCustomEventName.SEARCH_FEED_LOADED,this.onSearchFeedListLoaded.bind(this)],[d.StoryRequestCustomEventName.DISCOVER_LOADED,this.onDiscoverListLoaded.bind(this)]];this.removeCustomEvents(),this.unsubscribeListeners=e.map((([e,t])=>this.storiesEvents.subscribe(String(e),t)))}removeCustomEvents(){for(;this.unsubscribeListeners.length;)this.unsubscribeListeners.pop()?.()}setList(e){e!==this.list&&(this.list=e,this.isCurrentListSearchList=e===this.searchFeed.getList(),this.onListChanged(),this.resetScroll())}processList(){this.buildBlockMap(),this.listData&&(this.hasEmptyDiscover=Boolean(this.listData.items.find((e=>"discover"===e.type)))),this.isListLoaded()&&this.isStoryViewerListEmpty()&&(this.isFeedModeActive?this.feed.prepareListForStoryViewer():this.searchFeed.prepareListForStoryViewer())}isStoryViewerListEmpty(){return!this.storiesCache.hasStoryList(this.listName)}onFeedListLoaded(){this.isFeedModeActive&&(this.setList(this.feed.getList()),this.applyCacheSeenEvents(),(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web"))&&this.processList())}onSearchFeedListLoaded(){this.query&&(this.setList(this.searchFeed.getList()),(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web"))&&this.processList())}onDiscoverListLoaded(){const e=this.discover.getList();if(e.data&&this.listData){const t=this.listData.items.find((e=>"discover"===e.type));if(t){t.grouped=e.data.items;let s=t.has_unseen;s||t.grouped?.forEach((e=>{(0,l.isBlockItemHasUnseenStories)(e)&&(s=!0)})),t.has_unseen=s,this.onListChanged()}}}async preloadDiscoverList(){try{await this.preloaderService.preloadDiscoverList(this.discover),this.hasEmptyDiscover=!1}catch(e){}finally{this.isDiscoverPending=!1}}loadList(){this.cancelLoadSearchFeedRequest(),this.preloaderService.preloadList(this.feed,this.searchFeed,this.query)}prepareListForViewer(){this.feed.prepareListForStoryViewer()}get onCacheDataShown(){if(this.isFeedModeActive)return this.feed.onCacheDataShown}get cacheList(){if(this.isFeedModeActive)return this.feed.storiesCache}get forceShowingCache(){return!!this.isFeedModeActive&&this.feed.forceShowingCache}get listData(){return this.list.data??this.cacheList?.data}setQuery(e){e!==this.query&&(this.query=e,(this.isInitiated()||(this.setList(this.query?this.searchFeed.getList():this.feed.getList()),this.query))&&(this.query?this.loadList():(this.isFeedListEmpty()?this.loadList():this.prepareListForViewer(),this.setList(this.feed.getList()))))}cancelLoadSearchFeedRequest(){this.searchFeed.abort()}cancelLoadFeedRequest(){this.feed.abort()}resetScroll(){this.storiesEvents.dispatchStoryBlockResetScrollEvent()}onListChanged(){this.processList()}isInitiated(){return this.initiated}reset(){this.initiated&&(this.query="",this.setList(this.feed.getList()),this.cancelLoadFeedRequest(),this.cancelLoadSearchFeedRequest(),this.initiated=!1)}[r.destroy](){this.removeCustomEvents(),this.storiesViewerDataService.resetListData({listName:"discover"})}constructor(e,t,s,i,r,o,a,d){this.feed=e,this.searchFeed=t,this.discover=s,this.userEnv=i,this.storiesViewerDataService=r,this.events=o,this.cache=a,this.preloader=d,this.isCurrentListSearchList=!1,this.storiesSeenEventsFromCache=new Set,this.blocksById={},this.unsubscribeListeners=[],this.initiated=!1,this.listName=c.StoryListName.feed,this.list=this.feed.getList(),this.isDiscoverPending=!1,this.hasEmptyDiscover=!1,this.query="",this.list=this.feed.getList(),(0,n.makeAutoObservable)(this)}}v=(0,i.__decorate)([r.scope.container(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===u.StoryFeedDataManager?Object:u.StoryFeedDataManager,void 0===p.StorySearchFeedDataManager?Object:p.StorySearchFeedDataManager,void 0===_.StoryDiscoverDataManager?Object:_.StoryDiscoverDataManager,void 0===o.UserEnv?Object:o.UserEnv,void 0===h.StoriesViewerDataService?Object:h.StoriesViewerDataService,void 0===m.StoriesEvents?Object:m.StoriesEvents,void 0===m.StoriesCacheLegacy?Object:m.StoriesCacheLegacy,void 0===m.StoriesPreloader?Object:m.StoriesPreloader])],v)},672765:(e,t,s)=>{s.d(t,{StoriesBlockViewModelProvider:()=>m,useStoriesBlockViewModel:()=>p});var i=s(331635),r=s(132028),o=s(24516),a=s(351118),n=s(327813),c=s(852487),d=s(923545),l=s(238908),h=s(70992);const _={STORIES_SETTINGS:l.StoriesHiddenUsersWidget};class u{get needShowCreateButton(){return this.props.current.dataManager.isFeedModeActive}get needShowSkeleton(){return!this.props.current.dataManager.list.data}[r.init](){if(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web")){if(!this.props.current.section)return this.props.current.dataManager.setQuery(""),void this.props.current.dataManager.loadList();if("search"===this.props.current.section)return this.props.current.dataManager.setQuery(this.props.current.query||""),void(!this.props.current.query&&this.props.current.dataManager.isListEmpty()&&this.props.current.dataManager.loadList())}}[r.update](){(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web"))&&this.setQueryDebounced(this.props.current.query||"")}[r.destroy](){(this.userEnv.partConfigEnabled("web_spa_feed_reversed")||this.userEnv.isToggleEnabled("feed_spa_web"))&&this.setQueryDebounced.cancel()}get renderOnFailedDataList(){return this.userEnv.partConfigEnabled("web_show_stories_creator_button_with_failed_stories_list")}constructor(e,t,s,i){this.props=e,this.userEnv=t,this.analytics=s,this.videoPlayerConfigProvider=i,this.onRenderNotified=!1,this.unsubscribeListeners=[],this.controller=new h.LocalModalsController(_),this.setQueryDebounced=(0,a.debounce)((e=>{this.props.current.dataManager.setQuery(e)}),500),this.onShow=()=>{this.props.current.onReadyCallback&&!this.onRenderNotified&&(this.props.current.onReadyCallback(),this.onRenderNotified=!0)},this.openSettingsModal=()=>{this.controller.open({type:"STORIES_SETTINGS",props:{onClose:()=>this.controller.close()}})},(0,n.makeAutoObservable)(this,{setQueryDebounced:!1})}}u=(0,i.__decorate)([r.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===r.Props?Object:r.Props,void 0===o.UserEnv?Object:o.UserEnv,void 0===d.StoryBlockAnalytics?Object:d.StoryBlockAnalytics,void 0===c.VideoPlayerConfigProvider?Object:c.VideoPlayerConfigProvider])],u);const{useModel:p,Provider:m}=(0,r.createProvider)(u,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0})},106281:(e,t,s)=>{s.d(t,{StoriesCacheService:()=>c});var i=s(331635),r=s(132028),o=s(62315),a=s(627876),n=s(327813);class c{getCacheData(){return this.dataPromise||(this.dataPromise=this.storiesCacheStore.get("storiesFeedList")),this.dataPromise}getActualData(e){if(e?.items?.length){const t=Number(new Date),s=e.items.reduce(((e,s)=>{const i=s.stories?.filter((e=>e.expires_at&&1e3*e.expires_at>t))??[];return i.length&&e.push({...s,stories:i}),e}),[]);if(s.length)return{...e,items:s}}return null}isLoading(){return this.loading}isLoaded(){return Boolean(!this.isLoading()&&this.data)}isFailed(){return this.failed}async getData(){if(this.failed=!1,!this.data)try{this.loading=!0;const e=await this.getCacheData();this.data=this.getActualData(e),this.loading=!1}catch(e){throw this.failed=!0,this.loading=!1,this.statLog.send({name:"stories_cache_error",value:e}),e}return this.data}async nextLoad(){await this.getData()}async setData(e){await this.storiesCacheStore.set("storiesFeedList",e),this.data=this.getActualData(e)}constructor(e,t){this.storiesCacheStore=e,this.statLog=t,this.data=null,this.loading=!1,this.failed=!1,this.dataPromise=void 0,(0,n.makeAutoObservable)(this)}}c=(0,i.__decorate)([r.scope.container(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.StoriesCache?Object:o.StoriesCache,void 0===a.Statlog?Object:a.Statlog])],c)},670404:(e,t,s)=>{s.d(t,{StoryDiscoverDataManager:()=>h});var i=s(331635),r=s(132028),o=s(4171),a=s(327813),n=s(858628),c=s(24516),d=s(13652),l=s(75385);class h{get storiesEvents(){if(!this.events)throw new Error("storiesEvents not initialized");return this.events}get storiesCache(){if(!this.cache)throw new Error("storiesCache not initialized");return this.cache}get discoverList(){return(0,l.isSPAStoriesViewerEnabledWeb)()?{discover:this.storiesProvider.discover}:this.discoverListProvider.list}get discover(){return this.discoverList.discover}async getThisPromise(e,t,s){try{const s=await this.discover.fetch({start_from:t,track_code:e});return this.prepareResponseForStoryViewer(s),this.storiesEvents.dispatchDiscoverLoadedEvent(),s}catch(e){throw e}finally{s?.()}}fetch(e,t){return this.promise||(this.promise=this.getThisPromise(e,t,(()=>{delete this.promise}))),this.promise}prepareResponseForStoryViewer(e){this.storiesCache.saveDiscover(e)}getList(){return this.discover}isLoading(){return this.discover.isLoading()}isLoaded(){return this.discover.isLoaded()}abort(){this.discover.isLoading()&&this.discover.abort()}reset(){this.discover.reset()}constructor(e,t,s,i,r){this.discoverListProvider=e,this.storiesProvider=t,this.userEnv=s,this.cache=i,this.events=r,(0,a.makeAutoObservable)(this)}}h=(0,i.__decorate)([r.scope.container(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.StoriesDiscoverListService?Object:o.StoriesDiscoverListService,void 0===n.StoriesListSharedProvider?Object:n.StoriesListSharedProvider,void 0===c.UserEnv?Object:c.UserEnv,void 0===d.StoriesCacheLegacy?Object:d.StoriesCacheLegacy,void 0===d.StoriesEvents?Object:d.StoriesEvents])],h)},40125:(e,t,s)=>{s.d(t,{StoryFeedDataManager:()=>g});var i=s(331635),r=s(132028),o=s(422992),a=s(24516),n=s(507380),c=s(996361),d=s(327813),l=s(652469),h=s(774200),_=s(529898),u=s(106281),p=s(858628),m=s(13652),v=s(75385);class g{getFeedList(){return this.feedList=(0,v.isSPAStoriesViewerEnabledWeb)()?this.storiesProvider.feed.ensure({}):this.feedListProvider.ensureList({})}get storiesEvents(){if(!this.events)throw new Error("storiesEvents not initialized");return this.events}get storiesCacheLegacy(){if(!this.cacheLegacy)throw new Error("StoriesCacheLegacy not initialized");return this.cacheLegacy}async getDataFromCache(){return await Promise.all([this.storiesCache.getData(),this.viewer.preloadUser()]),this.prepareListForStoryViewer(),(0,v.isSPAStoriesViewerEnabledWeb)()&&this.userEnv.partConfigEnabled("frontend.web_stories_viewer_index_db")&&!this.feedList.feed.data&&this.storiesCache.data&&this.feedList.feed.addData(this.storiesCache.data,!1),this.storiesCache.data}saveDataToCache(){this.feedList?.feed?.data&&this.storiesCache.setData((0,d.toJS)(this.feedList.feed.data))}async tryFetchViewer(){try{return await this.viewer.fetch()}catch(e){return console.log("Viewer fetch failed",e),null}}preloadData(e=!0,t){return new Promise(((s,i)=>{let r,o=0;const a=e=>{const t=e?.error&&(0,n.isRequestAbortError)(e.error);o++,(o>1||t)&&i(e??r),r=e};this.fetch(e).then(s).catch(a),this.getDataFromCache().then((e=>{const i=!t||e?.items?.some((e=>e.stories?.some((e=>String(e.id)===t))));e&&i?s(e):a()})).catch(a)}))}fetch(e=!0){return this.storiesCache.data||this.getDataFromCache(),this.promise||(this.promise=this.getThisPromise(e,(()=>{delete this.promise})),this.groups.fetch()),this.promise}isDataLoading(){return this.feedList.feed.isLoading()&&this.storiesCache.isLoading()}isDataLoaded(){return this.feedList.feed.isLoaded()||this.storiesCache.isLoaded()}isLoading(){return this.isDataLoading()||this.viewer.isLoading()}async getFetchingPromise(){this.promise&&await this.promise}prepareListForStoryViewer(){const e=this.feedList.feed.data??this.storiesCache.data;e&&!(0,v.isSPAStoriesViewerEnabledWeb)()&&this.storiesCacheLegacy.setApiStoryList(this.listName,e)}getList(){return this.feedList.feed}getViewer(){return this.viewer}isLoaded(){return this.isDataLoaded()&&this.viewer.isLoaded()}async getThisPromise(e,t){try{const t=await Promise.all([this.feedList.feed.fetch(void 0,void 0,!0),this.tryFetchViewer()]);if(this.cacheDataShownTime){const e=performance.now()-this.cacheDataShownTime;e<300&&(this.forceShowingCache=!0,await(0,c.sleep)(300-e),this.forceShowingCache=!1)}return e&&this.prepareListForStoryViewer(),this.storiesEvents.dispatchFeedLoadedEvent(),this.saveDataToCache(),t}catch(e){throw e?.error&&(0,n.isRequestAbortError)(e.error)||this.storiesEvents.dispatchFeedFailedEvent(),e}finally{t()}}abort(){this.feedList.feed.isLoading()&&this.feedList.feed.abort(),this.viewer.isLoading()&&this.viewer.abort(),delete this.promise}reset(){this.viewer.reset(),this.feedList.feed.reset()}constructor(e,t,s,i,r,o,a,n){this.viewer=e,this.groups=t,this.storiesCache=s,this.feedListProvider=i,this.storiesProvider=r,this.userEnv=o,this.events=a,this.cacheLegacy=n,this.listName=l.StoryListName.feed,this.feedList=this.getFeedList(),this.cacheDataShownTime=void 0,this.forceShowingCache=!1,this.onCacheDataShown=()=>{this.cacheDataShownTime=performance.now()},(0,d.makeAutoObservable)(this)}}g=(0,i.__decorate)([r.scope.container(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===h.ViewerService?Object:h.ViewerService,void 0===_.GroupsService?Object:_.GroupsService,void 0===u.StoriesCacheService?Object:u.StoriesCacheService,void 0===o.StoriesFeedListProvider?Object:o.StoriesFeedListProvider,void 0===p.StoriesListSharedProvider?Object:p.StoriesListSharedProvider,void 0===a.UserEnv?Object:a.UserEnv,void 0===m.StoriesEvents?Object:m.StoriesEvents,void 0===m.StoriesCacheLegacy?Object:m.StoriesCacheLegacy])],g)},821161:(e,t,s)=>{s.d(t,{StorySearchFeedDataManager:()=>_});var i=s(331635),r=s(132028),o=s(465472),a=s(858628),n=s(507380),c=s(327813),d=s(652469),l=s(13652),h=s(75385);class _{get storiesEvents(){if(!this.events)throw new Error("storiesEvents not initialized");return this.events}get storiesCache(){if(!this.cache)throw new Error("storiesCache not initialized");return this.cache}async getThisPromise(e,t){try{this.searchFeed.isLoading()&&this.searchFeed.abort(),this.searchFeed=this.getSearchFeed(e);const t=await this.searchFeed.fetch();return this.prepareListForStoryViewer(),this.storiesEvents.dispatchSearchFeedLoadedEvent(),t}catch(e){throw e?.error&&(0,n.isRequestAbortError)(e.error)||this.storiesEvents.dispatchFeedFailedEvent(),e}finally{t()}}fetch(e){return this.promise||(this.promise=this.getThisPromise(e,(()=>{delete this.promise}))),this.promise}async getFetchingPromise(){this.promise&&await this.promise}prepareListForStoryViewer(){const e=this.searchFeed.data;e&&this.storiesCache.setApiStoryList(this.listName,e)}getList(){return this.searchFeed}isLoading(){return this.searchFeed.isLoading()}isLoaded(){return this.searchFeed.isLoaded()}isFailed(){return this.searchFeed.isFailed()}abort(){this.searchFeed.isLoading()&&this.searchFeed.abort()}reset(){this.searchFeed.reset()}constructor(e,t,s,i){this.searchListProvider=e,this.events=t,this.cache=s,this.searchListSharedProvider=i,this.getSearchFeed=e=>(0,h.isSPAStoriesViewerEnabledWeb)()?this.searchListSharedProvider.search.ensure({query:e}):this.searchListProvider.ensureList({query:e}),this.listName=d.StoryListName.feed,this.searchFeed=this.getSearchFeed(""),this.searchFeed=this.getSearchFeed(""),(0,c.makeAutoObservable)(this)}}_=(0,i.__decorate)([r.scope.container(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.StoriesSearchListProvider?Object:o.StoriesSearchListProvider,void 0===l.StoriesEvents?Object:l.StoriesEvents,void 0===l.StoriesCacheLegacy?Object:l.StoriesCacheLegacy,void 0===a.StoriesListSharedProvider?Object:a.StoriesListSharedProvider])],_)},774200:(e,t,s)=>{s.d(t,{ViewerService:()=>h});var i=s(331635),r=s(132028),o=s(891999),a=s(62315),n=s(951652),c=s(24516),d=s(507380),l=s(327813);class h{async fetchUser(){return(await this.userProvider.fetchUsersByIds({userIds:this.authService.userId?[this.authService.userId]:[],fields:["photo_50","photo_100","photo_200","photo_200_orig"]},{signal:this.controller?.signal},!0))[0]??null}preloadUser(){return new Promise(((e,t)=>{let s=0;const i=()=>{s++,s>1&&t()};this.fetch().then(e).catch(i),this.storiesCache.get("storiesViewer").then((t=>{t?(this.onSuccess(t),e(t)):i()})).catch(i)}))}async fetch(){if(this.promise)return this.promise;this.data||(this.status="loading"),this.controller=new AbortController,this.promise=this.fetchUser();try{const e=await this.promise;return this.saveDataToCache(e),this.onSuccess(e)}catch(e){return this.data||this.onFail(e),null}finally{delete this.promise}}onSuccess(e){return this.data=e,this.status="loaded",e}onFail(e){e?.error&&(0,d.isRequestAbortError)(e.error)||(this.status="failed")}isLoading(){return"loading"===this.status}isLoaded(){return"loaded"===this.status}isFailed(){return"failed"===this.status}abort(){this.controller&&(this.controller.abort(),this.status=this.data?"loaded":"initial",delete this.promise)}async saveDataToCache(e){e&&await this.storiesCache.set("storiesViewer",(0,l.toJS)(e))}reset(){this.abort(),this.data=null,this.status="initial"}constructor(e,t,s,i){this.userProvider=e,this.authService=t,this.storiesCache=s,this.userEnv=i,this.data=null,this.status="initial",(0,l.makeAutoObservable)(this)}}h=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.UsersProvider?Object:o.UsersProvider,void 0===n.AuthService?Object:n.AuthService,void 0===a.StoriesCache?Object:a.StoriesCache,void 0===c.UserEnv?Object:c.UserEnv])],h)},509319:(e,t,s)=>{s.d(t,{StoryBlockCustomEvent:()=>o,StoryCustomEventName:()=>r,StoryRequestCustomEventName:()=>i});var i=function(e){return e.FEED_LOADED="stories_feed_loaded",e.FEED_FAILED="stories_feed_failed",e.GROUPS_LOADED="stories_groups_loaded",e.DISCOVER_LOADED="stories_discover_loaded",e.SEARCH_FEED_LOADED="stories_search_feed_loaded",e.SEARCH_FEED_FAILED="stories_search_feed_failed",e}({}),r=function(e){return e.STORIES_SEEN="stories_seen",e.CLOSE_LAYER="close_layer",e.LIST_MODIFIED="list_modified",e.BLOCK_SCROLL_TO_CENTER="block_scroll_to_center",e.STORIES_REMOVE="stories_remove",e.STORIES_LIVE_ENDED="stories_live_ended",e.STORIES_LIVE_VIEWERS_COUNT_CHANGE="stories_live_viewers_count_change",e}({}),o=function(e){return e.BLOCK_SCROLL_TO_CENTER="block_scroll_to_center",e.BLOCK_RESET_SCROLL="block_reset_scroll",e}({})},190023:(e,t,s)=>{s.d(t,{storyFeedBlockImagePreloader:()=>n});var i=s(393891),r=s(536490),o=s(633015);class a{static getInstance(){return this.instance||(this.instance=(0,i.initializeSharedState)("file:///mnt/cache/teamcity-agent/work/508a9c1a8ce3b9f6/repo/static/js/spa/vk/web/widgets/stories/StoriesBlock/utils/StoryFeedBlockImagePreloader.tsx:singleton",0,(()=>new a))),this.instance}pickImagesToPreload(e,t,s=!1){const i=e.data?.items,a=e.data?.profiles,n=e.data?.groups,c=[],d=t?.data;if(d&&d.photo_200_orig&&c.push(d.photo_200_orig),i&&i.length>0)for(const[e,t]of i.entries()){if(e>=o.FEED_STORIES_BLOCK_NUMBER_OF_STORIES_TO_PRELOAD)break;const i=(0,r.getFirstStoryForRendering)(t),d=(0,r.findOwnerById)(i?.owner_id||t.owner_id,a,n),l=(0,r.getStoryAvatar)(t,d,s);let h=(0,r.getStoryPreview)(i);!h&&t.preview&&(h=(0,r.getStoryFallbackPreview)(t.preview.sizes)),l&&c.push(l),h&&c.push(h)}return c}async newPreloadJob(e,t,s=!1){if(!e.data){if(!e.nextLoad)return null;try{await e.nextLoad()}catch(e){return null}}const i=e.data,r=this.pickImagesToPreload(e,t,s);if(!r.length)return i;const o=r.map((e=>this.resourceLoader(e,{as:"image",fetchPriority:"high"})));return await Promise.allSettled(o),i}isSameListFromLastTime(e){const t=this.preloadingStatus;return!!t&&(t.list===e&&(t.listData===e.data||void 0===t.listData))}isImagesPreloaded(e){return!(!this.preloadingStatus||!this.isSameListFromLastTime(e))&&this.preloadingStatus.ready}hasImagesToPreload(e,t){const s=t?.data,i=Boolean(s&&s.photo_200_orig),r=(e.data?.items.length||0)>0;return i||r}preloadFeedBlockImages(e,t,s=!1){if(this.preloadingStatus&&this.isSameListFromLastTime(e))return this.preloadingStatus.promise;const i=this.newPreloadJob(e,t,s).then((e=>{this.preloadingStatus?.promise===i&&(this.preloadingStatus.ready=!0,this.preloadingStatus.listData=e)}),(()=>{this.preloadingStatus?.promise===i&&(this.preloadingStatus=null)}));return this.preloadingStatus={list:e,listData:void 0,promise:i,ready:!1},i}constructor(){this.resourceLoader=(0,r.makeCachedPreloadResource)({maxSize:4*(o.FEED_STORIES_BLOCK_NUMBER_OF_STORIES_TO_PRELOAD+1)}),this.preloadingStatus=null}}a.instance=null;const n=a.getInstance()},253132:(e,t,s)=>{s.d(t,{storyFeedBlockImagePreloader:()=>i.storyFeedBlockImagePreloader});var i=s(190023)},238908:(e,t,s)=>{s.d(t,{StoriesHiddenUsersWidget:()=>A});var i=s(474848),r=s(220208),o=s(454154),a=s(783856),n=s(703844),c=s(613104),d=s(694244),l=s(782174),h=s(63614),_=s(264458),u=s(582192),p=s(299494),m=s(720836),v=s(700272),g=s(260546),f=s(612196),y=s(194528),S=s(285056),w=s(723723),b=s(908242),k=s(296540),E=s(456921),C=s(211883),I=s(132028),T=s(562196),L=s(351118);const M=(0,E.observer)((()=>{(0,r.useScrollLock)();const e=(0,C.useStoriesHiddenUsersModel)(),t=e.users,s=e.filteredUsers,[E,I]=(0,k.useState)(""),M=t?.length?[(0,i.jsx)(o.Button,{mode:"secondary",appearance:"accent",onClick:e.props.current.onClose,children:e.langs.getLang("global_cancel")},"stories-hidden-users-modal-web-cancel"),(0,i.jsx)(o.Button,{mode:"primary",appearance:"accent",loading:e.submitLoading,onClick:async()=>{try{await e.submit(),e.props.current.onClose()}catch(e){console.error("Submit failed:",e)}},children:e.langs.getLang("global_save")},"stories-hidden-users-modal-web-submit")]:[(0,i.jsx)(o.Button,{mode:"primary",appearance:"accent",onClick:e.props.current.onClose,children:e.langs.getLang("global_close")},"stories-hidden-users-modal-web-close")];return(0,i.jsx)(a.Overlay,{children:(0,i.jsx)(n.FocusTrap,{autoFocus:!0,children:(0,i.jsx)(c.PopoutWrapper,{"data-focus-first":!0,onClick:e.props.current.onClose,zIndex:999,onKeyUp:t=>{"Escape"===t.key&&e.props.current.onClose()},children:(0,i.jsx)(r.ColorSchemeProvider,{value:"dark",children:(0,i.jsxs)(d.ModalBox,{width:420,"aria-label":e.langs.getLang("stories_hidden_users_header"),children:[(0,i.jsx)(l.ModalHeader,{onClose:e.props.current.onClose,closeAriaLabel:e.langs.getLang("stories_hidden_users_header_close"),children:e.langs.getLang("stories_hidden_users_header")}),(0,i.jsxs)(h.ModalBody,{insetLevel:1,children:[!!t?.length&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.Search,{disabled:e.listLoading,value:E,onChange:t=>{const s=t.target.value;e.filterUsersByName(s),I(s)}}),(0,i.jsx)(u.Separator,{size:"4xl"})]}),(0,i.jsxs)(p.ModalScrollView,{height:t?.length?212:260,children:[e.listLoading&&(0,i.jsx)(m.Placeholder,{stretched:!0,children:(0,i.jsx)(v.Spinner,{})}),!e.listLoading&&!!s?.length&&s?.map(((t,r)=>(0,i.jsxs)(k.Fragment,{children:[(0,i.jsx)(g.SimpleCell,{onClick:()=>e.markUser(t.id),before:(0,i.jsx)("div",{className:t.marked&&T.default.hiddenAvatar||"",children:(0,i.jsx)(f.Avatar,{src:t.photo,alt:e.langs.getLang("stories_hidden_users_avatar")})}),after:(0,i.jsx)(o.Button,{mode:"link",appearance:"accent",children:t.marked?e.langs.getLang("stories_hidden_users_hide"):e.langs.getLang("stories_hidden_users_cancel_hide")}),children:t.name}),r!==s.length-1&&(0,i.jsx)(y.Spacing,{mode:"vertical"})]},`${r}-hidden-user`))),!e.listLoading&&!t?.length&&(0,i.jsxs)(m.Placeholder,{stretched:!0,children:[(0,i.jsx)(S.Title,{level:"2",children:e.langs.getLang("stories_hidden_users_empty_title")}),(0,i.jsx)(y.Spacing,{mode:"vertical"}),(0,i.jsx)(S.Headline,{level:"1",className:(0,w.getColorClass)("color_text_secondary"),children:e.langs.getLang("stories_hidden_users_empty_subtitle")})]}),!e.listLoading&&0===s?.length&&e.currentFilterQuery&&(0,i.jsx)(m.Placeholder,{stretched:!0,children:(0,i.jsx)(S.Headline,{level:"1",className:(0,L.classNames)((0,w.getColorClass)("color_text_secondary"),e.userEnv.partConfigEnabled("stories_breaking_hidden_community_name_line")&&T.default.textBreak),children:e.langs.langReplace(e.langs.getLang("stories_hidden_users_search_empty"),{search_query:e.currentFilterQuery})})})]})]}),(0,i.jsx)(b.ModalFooter,{actions:M})]})})})})})})),A=(0,I.createWidget)(C.StoriesHiddenUsersProvider,M)},838221:(e,t,s)=>{s.d(t,{AsyncAtom:()=>o});var i=s(77783),r=s(879168);class o extends r.Atom{async get(){const e=this.getKey();try{return await(0,i.get)(e,this.base.store)||this.cache||null}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}async set(e,t){const s=this.getKey();try{await(0,i.set)(s,e,this.base.store)}catch(t){console.log(`${s}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}async delete(){const e=this.getKey();delete this.cache;try{await(0,i.del)(e,this.base.store),this.base.notify(this.key)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}constructor(e){super(e);const{base:t}=e;this.base=t}}},955326:(e,t,s)=>{s.d(t,{createAsyncStore:()=>n});var i=s(77783),r=s(98184),o=s(838221);class a extends r.Store{createAtom(e){return new o.AsyncAtom({key:e,base:this})}async clear(){await(0,i.clear)(this.store),this.notify()}constructor(e){super(e);const{dbName:t,version:s}=e;try{this.store=(0,i.createStore)(`${t}-v${s}`,t)}catch{}}}function n(e){return new a(e)}},879168:(e,t,s)=>{s.d(t,{Atom:()=>i});class i{set(e,{notify:t=!0}={}){t&&this.base.notify(this.key)}getKey(){return`${this.base.options.storeName}-${this.key}`}constructor({key:e,base:t}){this.key=e,this.base=t}}},98184:(e,t,s)=>{s.d(t,{Store:()=>i});class i{subscribe(e,t){const s=this.getListeners(t);return s.add(e),()=>{s.delete(e)}}notify(e,t){this.getListeners(t).forEach((t=>{t(e)}))}refresh(){try{localStorage.setItem(this.key,""),localStorage.removeItem(this.key)}catch{}}destroy(){this.listeners.clear(),this.syncListeners.clear(),i.instances.delete(this.key)}get key(){const{dbName:e,storeName:t,version:s}=this.options;return`${e}-v${s}-${t}`}getListeners(e){return e?this.syncListeners:this.listeners}constructor(e){this.listeners=new Set,this.syncListeners=new Set,this.options=e,i.instances.set(this.key,this)}}i.instances=new Map,window.addEventListener("storage",(({key:e,newValue:t})=>{if(!e||null===t)return;const s=i.instances.get(e);s?.notify()}))},100596:(e,t,s)=>{s.d(t,{SyncAtom:()=>o,SyncAtomType:()=>r});var i=s(879168),r=function(e){return e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number",e}({});class o extends i.Atom{get(){const e=this.getKey();try{let t=localStorage.getItem(e);if(!t)return null;switch(this.type){case"object":try{t=JSON.parse(t)}catch{return null}break;case"number":t=Number(t)||0;break;case"string_number":t=Number(t)||t;break;case"boolean":t=Boolean(Number(t))}return t}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}set(e,t){const s=this.getKey();let i;switch(this.type){case"object":i=JSON.stringify(e);break;case"boolean":i=String(Number(e));break;default:i=String(e)}try{localStorage.setItem(s,i)}catch(t){console.log(`${s}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}delete(){const e=this.getKey();try{delete this.cache,localStorage.removeItem(e)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}getKey(){return`${this.base.key}-${this.key}`}constructor(e){super(e);const{base:t,type:s}=e;this.base=t,this.type=s}}},724361:(e,t,s)=>{s.d(t,{createSyncStore:()=>a});var i=s(98184),r=s(100596);class o extends i.Store{createAtom(e,t){return new r.SyncAtom({key:e,type:t,base:this})}constructor(e){super(e)}}function a(e){return new o(e)}},353034:(e,t,s)=>{s.d(t,{browser:()=>r});const i=navigator.userAgent.toLowerCase(),r={version:(i.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],opera:/opera/i.test(i)||/opr/i.test(i),vivaldi:/vivaldi/i.test(i),amigo:/amigo.*mrchrome soc/i.test(i),msie:/msie/i.test(i)&&!/opera/i.test(i)||/trident\//i.test(i)||/edge/i.test(i),msie6:/msie 6/i.test(i)&&!/opera/i.test(i),msie7:/msie 7/i.test(i)&&!/opera/i.test(i),msie8:/msie 8/i.test(i)&&!/opera/i.test(i),msie9:/msie 9/i.test(i)&&!/opera/i.test(i),msie_edge:/edge/i.test(i)&&!/opera/i.test(i),mozilla:/firefox/i.test(i),yabrowser:/yabrowser/i.test(i),whale:/whale/i.test(i),chrome:/chrome/i.test(i)&&!/edge/i.test(i),safari:!/chrome/i.test(i)&&/webkit|safari|khtml/i.test(i),iphone:/iphone/i.test(i),ipod:/ipod/i.test(i),iphone4:/iphone.*OS 4/i.test(i),ipod4:/ipod.*OS 4/i.test(i),ipad:/ipad/i.test(i),ios:/.+(ipod|ipad|iphone.*os)/i.test(i),android:/android/i.test(i),bada:/bada/i.test(i),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(i),msie_mobile:/iemobile/i.test(i),safari_mobile:/iphone|ipod|ipad/i.test(i),opera_mobile:/opera mini|opera mobi/i.test(i),opera_mini:/opera mini/i.test(i),mac:/mac/i.test(i),windows7:/windows nt 6.1/i.test(i),windowsVista:/windows nt 6.0/i.test(i),windowsXp:/windows nt (5.2|5.1)/i.test(i),search_bot:/(yandex|google|stackrambler|aport|slurp|msnbot|bingbot|twitterbot|ia_archiver|facebookexternalhit)/i.test(i),smart_tv:/smart-tv|smarttv/i.test(i)}},896412:(e,t,s)=>{function i(e){e.preventDefault(),e.stopPropagation()}s.d(t,{cancelEvent:()=>i})},421334:(e,t,s)=>{s.d(t,{getCroppedImage:()=>r});var i=s(677587);async function r(e,t,s,r,o,a=0,n={type:"image/jpeg",quality:1}){const c="string"==typeof e?await(0,i.loadImage)(e):e,d=document.createElement("canvas");d.width=90===a||270===a?c.naturalHeight:c.naturalWidth,d.height=90===a||270===a?c.naturalWidth:c.naturalHeight;const l=d.getContext("2d");if(!l)return c;l.fillStyle="#fff",l.fillRect(0,0,l.canvas.width,l.canvas.height),a?(l.translate(d.width/2,d.height/2),l.rotate(a*Math.PI/180),l.drawImage(c,-c.naturalWidth/2,-c.naturalHeight/2)):l.drawImage(c,0,0);const h=l.getImageData(t,s,r,o),_=document.createElement("canvas");_.width=r,_.height=o;const u=_.getContext("2d");if(!u)return c;u.putImageData(h,0,0);const p=_.toDataURL(n.type,n.quality);return(0,i.loadImage)(p)}},236132:(e,t,s)=>{s.d(t,{getElementCrossOrigin:()=>i});const i=e=>"string"!=typeof e||e.startsWith("data:")||e.startsWith("blob:")||function(e){const t=location.origin,s=new URL(e,t).origin;return s===t}(e)?null:"Anonymous"},871379:(e,t,s)=>{function i(e){const t=e.name.split(".");return t.length<=1?"":t.pop()?.toLowerCase()||""}s.d(t,{getFileExtension:()=>i})},325932:(e,t,s)=>{s.d(t,{getFileMimeType:()=>r});var i=s(871379);const r=e=>{if(e.type)return e.type.toLowerCase();return{heic:"image/heic",heif:"image/heif"}[(0,i.getFileExtension)(e)]||""}},570441:(e,t,s)=>{s.d(t,{useIntersectionObserver:()=>o});var i=s(296540),r=s(351118);function o({triggerOnce:e=!1,root:t=document,rootMargin:s,threshold:o=1,scrollFallbackDelay:c=200,onIntersecting:d,minVisibleTime:l=0}={}){const[h,_]=(0,i.useState)(null),[u,p]=(0,i.useState)(!1),{top:m=0,bottom:v=0,left:g=0,right:f=0}=(0,i.useMemo)((()=>function(e){if(!e)return{};if(!/^[-+]?\d+px [-+]?\d+px [-+]?\d+px [-+]?\d+px$/.test(e))throw new Error(`useIntersectionObserver: unsupported rootMargin format: ${e}`);const[t,s,i,r]=e.split(" ").map(parseFloat);return{top:t,right:s,bottom:i,left:r}}(s)),[s]),y=(0,i.useRef)(null),S=(0,i.useRef)((()=>{}));return(0,i.useEffect)((()=>(u?l?y.current||(y.current=setTimeout((()=>{d?.(),e&&S.current(),y.current=null}),l)):d?.():(y.current&&clearTimeout(y.current),y.current=null),()=>{y.current&&clearTimeout(y.current)})),[u]),(0,i.useEffect)((()=>{if(a()&&h){const e=new IntersectionObserver((([e])=>{p(e.isIntersecting),e.isIntersecting||y.current&&clearTimeout(y.current)}),{root:t instanceof Document?null:t,threshold:o,rootMargin:`${m}px ${f}px ${v}px ${g}px`});return S.current=()=>e.disconnect(),e.observe(h),()=>e.disconnect()}}),[o,e,d,m,v,f,g,h,t]),(0,i.useEffect)((()=>{if(!a()&&h&&(!u||!e)){const e=()=>t instanceof Element?t.getBoundingClientRect():new DOMRect(0,0,window.innerWidth,window.innerHeight),s=(0,r.throttle)((()=>{const t=h.getBoundingClientRect(),s=function(e,t,s){const i={top:t.top+(s.top??0),right:t.right-(s.right??0),bottom:t.bottom-(s.bottom??0),left:t.left+(s.left??0)},r=Math.min(e.right,i.right)-Math.max(e.left,i.left),o=Math.min(e.bottom,i.bottom)-Math.max(e.top,i.top);return{width:r,height:o,isVisible:r>0&&o>0}}(t,e(),{top:m,right:f,bottom:v,left:g});if(!s.isVisible)return void p(!1);const i=function(e,t,s){const i=n(e.width,e.height),r=n(t,s);return i?r/i:0}(t,s.width,s.height);p(i>=o)}),c);s();const i=function(e,t){const s={passive:!0,capture:e instanceof Element};if(e.addEventListener("scroll",t,s),e instanceof Document)return window.addEventListener("resize",t,s),()=>{e.removeEventListener("scroll",t,s),window.removeEventListener("resize",t,s)};{let i;return"undefined"!=typeof ResizeObserver&&(i=new ResizeObserver((()=>t())),i.observe(e)),()=>{e.removeEventListener("scroll",t,s),i?.disconnect()}}}(t,s);return()=>{s.cancel(),i()}}}),[u,e,m,v,f,g,o,c,h,t]),[_,u]}function a(){return"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype}function n(e,t){return Math.max(0,e)*Math.max(0,t)}},552252:(e,t,s)=>{s.d(t,{useWindowEventListener:()=>r});var i=s(296540);function r(e,t,s){(0,i.useEffect)((()=>{if(e&&t)return window.addEventListener(e,t,s),()=>window.removeEventListener(e,t,s)}),[e,t,s])}},62596:(e,t,s)=>{s.d(t,{isHeicBlob:()=>i});const i=(e,t)=>(t=t||e.type.toLowerCase(),["image/heic","image/heif"].includes(t))},137745:(e,t,s)=>{s.d(t,{isHeicFile:()=>o});var i=s(325932),r=s(62596);const o=e=>{const t=(0,i.getFileMimeType)(e);return(0,r.isHeicBlob)(e,t)}},596597:(e,t,s)=>{function i(e){return!("click"!==e.type&&"mousedown"!==e.type&&"mouseup"!==e.type||0!==e.button||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)}s.d(t,{isMainClick:()=>i})},677587:(e,t,s)=>{s.d(t,{loadImage:()=>r});var i=s(236132);const r=(e,t)=>new Promise(((s,r)=>{const o=new Image;o.crossOrigin=(0,i.getElementCrossOrigin)(e),t&&(o.dataset.name=t),o.onerror=()=>{const t=e?.startsWith("data:")?"<dataURL>":e;r(new Error(`Failed to load image's URL: ${t}`))},o.onload=()=>{s(o)},o.src=e}))},568022:(e,t,s)=>{s.d(t,{preventLinkOpening:()=>r});var i=s(596597);const r=e=>new Promise((t=>{(0,i.isMainClick)(e)&&(e.stopPropagation(),e.preventDefault(),t())}))},90933:(e,t,s)=>{s.d(t,{HelpHints:()=>c});var i=s(331635),r=s(132028),o=s(21632),a=s(24516),n=s(327813);class c{async fetchHints(){try{const e=this.accountApi.getHelpHintsWithPrefetch({}),t=await e;(0,n.runInAction)((()=>{t.items.forEach((e=>this.helpHints.set(e.id,e)))}))}catch(e){throw new Error("Fetching hints fetching failed",{cause:e})}finally{this.fetchPromise=null}}async hide(e,t){t&&this.helpHints.delete(e);try{const s=await this.accountApi.hideHelpHint({hint_id:e});!t&&s&&this.helpHints.delete(e)}catch(e){throw new Error("Hiding hint failed",{cause:e})}}get(e){return this.helpHints.get(e)}async ensureAll(){if(0===this.helpHints.size)return this.fetchPromise=this.fetchPromise??this.fetchHints(),this.fetchPromise}async ensure(e){return await this.ensureAll(),this.helpHints.get(e)}clearHints(){this.helpHints.clear()}constructor(e,t){this.accountApi=e,this.userEnv=t,this.fetchPromise=null,this.helpHints=new Map,(0,n.makeAutoObservable)(this)}}c=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.AccountApi?Object:o.AccountApi,void 0===a.UserEnv?Object:a.UserEnv])],c)},209005:(e,t,s)=>{s.d(t,{AudienceResearchAnalytics:()=>n});var i=s(331635),r=s(327813),o=s(132028),a=s(730770);class n{constructor(e){this.customStats=e,this.logEvent=e=>{const{item_id:t,source_id:s}=e,i={key:"audience_research",value_str:s?String(s):void 0,value_str2:t};this.customStats.send({type:"type_dev_null_item",type_dev_null_item:i})},this.logEvents=e=>{e.forEach((e=>this.logEvent(e)))},(0,r.makeAutoObservable)(this)}}n=(0,i.__decorate)([o.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.CustomStats?Object:a.CustomStats])],n)},113326:(e,t,s)=>{s.d(t,{AudienceResearchService:()=>l});var i=s(331635),r=s(327813),o=s(132028),a=s(569002),n=s(209005),c=s(939724),d=s(209761);class l{send({urls:e,events:t,surface:s}){if(e?.length){const t=e.map((e=>(0,c.getAudienceResearchUrl)(e,{surface:s??d.AUDIENCE_RESEARCH_SURFACE.other})));this.pixelTracker.send(t)}t?.length&&this.audienceResearchAnalytics.logEvents(t)}constructor(e,t){this.audienceResearchAnalytics=e,this.pixelTracker=t,(0,r.makeAutoObservable)(this)}}l=(0,i.__decorate)([o.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===n.AudienceResearchAnalytics?Object:n.AudienceResearchAnalytics,void 0===a.PixelTracker?Object:a.PixelTracker])],l)},209761:(e,t,s)=>{s.d(t,{AUDIENCE_RESEARCH_SURFACE:()=>i});const i={feed_post:111,wall_post:112,single_post:113,search_post:114,article:311,story_sticker:411,channel_repost:511,channel_post:512,bookmarks_post:611,bookmarks_article:612,other:711}},939724:(e,t,s)=>{s.d(t,{getAudienceResearchUrl:()=>i});const i=(e,{surface:t})=>e.replace("{surface}",String(t))},831197:(e,t,s)=>{s.d(t,{GroupsStore:()=>a});var i=s(331635),r=s(132028),o=s(327813);class a{getGroup(e){return this.data.groupsMap.get(e)}setGroup(e){this.data.groupsMap.set(e.id,e)}mergeGroup(e){const t=this.getGroup(e.id);t?Object.assign(t,e):this.setGroup(e)}constructor(){this.data={groupsMap:new Map},(0,o.makeAutoObservable)(this)}}a=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[])],a)},662518:(e,t,s)=>{function i(e){const{is_member:t,is_favorite:s,is_subscribed:i,...r}=e;return{...r,is_member:!!t,...void 0!==s&&{is_favorite:Boolean(s)},...void 0!==i&&{is_subscribed:Boolean(i)}}}s.d(t,{mapApiGroupToEntity:()=>i})},62315:(e,t,s)=>{s.d(t,{StoriesCache:()=>a});var i=s(331635),r=s(132028),o=s(289723);class a extends o.DataCacheStore{constructor(...e){super(...e),this.schema={version:1,name:"storiesCache"}}}a=(0,i.__decorate)([r.scope.global()],a)},4171:(e,t,s)=>{s.d(t,{StoriesDiscoverListService:()=>d});var i=s(331635),r=s(132028),o=s(327813),a=s(539356),n=s(746310),c=s(627876);class d{constructor(e,t){this.storiesApi=e,this.statLog=t,(0,o.makeAutoObservable)(this),this.list=new a.StoriesDiscoverList(this.storiesApi,this.statLog)}}d=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===n.StoriesApi?Object:n.StoriesApi,void 0===c.Statlog?Object:c.Statlog])],d)},422992:(e,t,s)=>{s.d(t,{StoriesFeedListProvider:()=>h});var i=s(331635),r=s(132028),o=s(327813),a=s(693059),n=s(746310),c=s(627876),d=s(877897),l=s(83833);class h{getKeyByParams(e){return(0,d.getKeyByParams)(e)}ensureList(e){const t=(0,d.getKeyByParams)(e);this.searchLists[t]||(this.searchLists[t]=new a.StoriesFeedList(this.storiesApi,this.statLog,e));const s=Object.keys(this.searchLists);if(s.length>l.MAX_CACHE_LENGTH){const e=s.find((e=>e!==t));e&&this.searchLists.hasOwnProperty(e)&&delete this.searchLists[e]}return this.searchLists[t]}constructor(e,t){this.storiesApi=e,this.statLog=t,this.searchLists={},(0,o.makeAutoObservable)(this)}}h=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===n.StoriesApi?Object:n.StoriesApi,void 0===c.Statlog?Object:c.Statlog])],h)},891999:(e,t,s)=>{s.d(t,{UsersProvider:()=>n});var i=s(331635),r=s(132028),o=s(488709),a=s(327813);class n{createUserFromAPI(e){return(0,a.observable)(e)}async fetchUsersByIds(e,t,s=!1){return(await(s?this.usersApi.getWithPrefetch:this.usersApi.get)({user_ids:e.userIds.join(","),fields:e.fields?.join(",")},t)).map((e=>this.createUserFromAPI(e)))}constructor(e){this.usersApi=e,(0,a.makeAutoObservable)(this)}}n=(0,i.__decorate)([r.scope.container(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.UsersApi?Object:o.UsersApi])],n)},289723:(e,t,s)=>{s.d(t,{DataCacheStore:()=>a});var i=s(331635),r=s(18992),o=s(132028);class a{get(e){return this.dataCache.get(this.schema,e)}set(e,t){return this.dataCache.set(this.schema,e,t)}clearStore(){return this.dataCache.clearStore(this.schema)}constructor(e){this.dataCache=e}}a=(0,i.__decorate)([o.scope.global({abstract:!0}),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===r.DataCache?Object:r.DataCache])],a)},730770:(e,t,s)=>{s.d(t,{CustomStats:()=>a});var i=s(331635),r=s(132028),o=s(422057);class a extends o.AnalyticsStats{send(e){const t={...e,id:this.getIntId(),timestamp:this.getCurrentTime()};this.analytics.sendCustomStats(t)}}a=(0,i.__decorate)([r.scope.global()],a)},262897:(e,t,s)=>{s.d(t,{StoryViewStats:()=>a});var i=s(331635),r=s(132028),o=s(422057);class a extends o.AnalyticsStats{send(e){this.analytics.sendStoryViewStats(e)}}a=(0,i.__decorate)([r.scope.global()],a)},668965:(e,t,s)=>{s.d(t,{AnalyticsStats:()=>a});var i=s(331635),r=s(132028),o=s(71892);class a{getIntId(){return Math.floor(Math.random()*this.MAX_INT32)}getCurrentTime(){return(1e3*Date.now()).toString(10)}constructor(e){this.analytics=e,this.MAX_INT32=2147483647}}a=(0,i.__decorate)([r.scope.global(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===o.Analytics?Object:o.Analytics])],a)},54490:(e,t,s)=>{s.d(t,{ProductionStats:()=>a});var i=s(331635),r=s(132028),o=s(668965);class a extends o.AnalyticsStats{getLastEvent(){return this.lastEvent}send(e,t){const s={...e,id:this.getIntId(),prev_id:this.getLastEvent()?.id,timestamp:this.getCurrentTime(),url:window.location.href};this.analytics.sendProductionStats(s,t),this.lastEvent=s}}a=(0,i.__decorate)([r.scope.global()],a)},208214:(e,t,s)=>{s.d(t,{FriendsApi:()=>a});var i=s(331635),r=s(132028),o=s(641569);class a extends o.ApiNamespace{get namespace(){return"friends"}constructor(...e){super(...e),this.get=this.makeMethod("get"),this.getIds=this.makeMethod("get"),this.getUsers=(e,t)=>this.makeMethod("get")(e.fields?e:{...e,fields:"first_name"},t),this.getUsersWithPrefetch=(e,t)=>this.makeMethod("get",!0)(e.fields?e:{...e,fields:"first_name"},t),this.search=this.makeMethod("search"),this.getLists=this.makeMethod("getLists"),this.getListsWithPrefetch=this.makeMethod("getLists",!0),this.getFriendsDeletionSuggestions=this.makeMethod("getFriendsDeletionSuggestions"),this.getFriendsDeletionSuggestionsWithPrefetch=this.makeMethod("getFriendsDeletionSuggestions",!0),this.getOnlineExtended=(e,t)=>this.makeMethod("getOnline")({...e,extended:1},t),this.getOnlineExtendedWithPrefetch=(e,t)=>this.makeMethod("getOnline",!0)({...e,extended:1},t),this.getMutualTotalCount=(e,t)=>this.makeMethod("getMutual")({...e,need_common_count:1},t),this.getMutualTotalCountWithPrefetch=(e,t)=>this.makeMethod("getMutual",!0)({...e,need_common_count:1},t),this.getRequestsExtended=this.makeMethod("getRequests"),this.getRequestsExtendedWithPrefetch=this.makeMethod("getRequests",!0),this.getCounters=this.makeMethod("getCounters"),this.getCountersWithPrefetch=this.makeMethod("getCounters",!0),this.add=this.makeMethod("add"),this.delete=this.makeMethod("delete"),this.deleteBulk=this.makeMethod("deleteBulk"),this.getRecommendations=this.makeMethod("getRecommendations"),this.getRecommendationsWithPrefetch=this.makeMethod("getRecommendations",!0),this.getFollowers=this.makeMethod("getFollowers"),this.getFollowersWithPrefetch=this.makeMethod("getFollowers",!0),this.hideSuggestion=this.makeMethod("hideSuggestion"),this.requestsToSubscribers=this.makeMethod("requestsToSubscribers"),this.deleteSubscriber=this.makeMethod("deleteSubscriber")}}a=(0,i.__decorate)([r.scope.global()],a)},962005:(e,t,s)=>{s.d(t,{GroupsApi:()=>a});var i=s(331635),r=s(641569),o=s(132028);class a extends r.ApiNamespace{get namespace(){return"groups"}constructor(...e){super(...e),this.getById=this.makeMethod("getById",!0),this.getSettings=this.makeMethod("getSettings"),this.getMembers=this.makeMethod("getMembers",!0),this.getEditSettings=this.makeMethod("getEditSettings"),this.join=this.makeMethod("join"),this.leave=this.makeMethod("leave"),this.getManageMenu=this.makeMethod("getManageMenu"),this.get=this.makeMethod("get"),this.getWithPrefetch=this.makeMethod("get",!0),this.edit=this.makeMethod("edit"),this.editManager=this.makeMethod("editManager"),this.getWebCatalogMenu=this.makeMethod("getWebCatalogMenu",!0),this.removeRecents=this.makeMethod("removeRecents"),this.getRecommendedTipsList=this.makeMethod("getRecommendedTipsList"),this.getSuggestions=this.makeMethod("getSuggestions"),this.getGroupSettingsMenu=this.makeMethod("getGroupSettingsMenu"),this.getCategories=this.makeMethod("getCategories"),this.addAddress=this.makeMethod("addAddress"),this.create=this.makeMethod("create"),this.editAddress=this.makeMethod("editAddress"),this.invite=this.makeMethod("invite"),this.removeUser=this.makeMethod("removeUser"),this.setOnboardingState=this.makeMethod("setOnboardingState"),this.validateCreation=this.makeMethod("validateCreation"),this.getMonetizationRules=this.makeMethod("getMonetizationRules"),this.registerAdblogger=this.makeMethod("registerAdblogger"),this.rollbackUserAction=this.makeMethod("rollbackUserAction"),this.sendGptRequest=this.makeMethod("sendGptRequest"),this.getGptResult=this.makeMethod("getGptResult"),this.addChat=this.makeMethod("addChat"),this.getAddresses=this.makeMethod("getAddresses"),this.getGroupSettings=this.makeMethod("getGroupSettings"),this.getBidOrganizationList=this.makeMethod("getBidOrganizationList"),this.setBidLink=this.makeMethod("setBidLink"),this.savePodcastCover=this.makeMethod("savePodcastCover"),this.getPodcastCoverPreview=this.makeMethod("getPodcastCoverPreview"),this.getPodcastCoverUploadUrl=this.makeMethod("getPodcastCoverUploadUrl"),this.getBusinessProfile=this.makeMethod("getBusinessProfile"),this.setGroupSettings=this.makeMethod("setGroupSettings"),this.getContentForTabs=this.makeMethod("getContentForTabs"),this.getContentTabs=this.makeMethod("getContentTabs"),this.setTabOrder=this.makeMethod("setTabOrder"),this.setTabsSettings=this.makeMethod("setTabsSettings"),this.applyAuthorsFundMembership=this.makeMethod("applyAuthorsFundMembership"),this.removeAuthorsFundMembership=this.makeMethod("removeAuthorsFundMembership"),this.getAuthorsFundMembershipStatus=this.makeMethod("getAuthorsFundMembershipStatus"),this.hideRecommendedGroup=this.makeMethod("hideRecommendedGroup"),this.deleteBidLink=this.makeMethod("deleteBidLink"),this.getRecommendedGroups=this.makeMethod("getRecommendedGroups"),this.deleteInactiveMembers=this.makeMethod("deleteInactiveMembers"),this.hideWarning=this.makeMethod("hideWarning"),this.getInviteLinkPreview=this.makeMethod("getInviteLinkPreview"),this.getLegacyModalsHashes=this.makeMethod("getLegacyModalsHashes"),this.toggleAdminTipsSection=this.makeMethod("toggleAdminTipsSection"),this.getFriendsInvitationList=this.makeMethod("getFriendsInvitationList"),this.getUserAgeConfirmationStatus=this.makeMethod("getUserAgeConfirmationStatus"),this.setUserAgeConfirm=this.makeMethod("setUserAgeConfirm"),this.addRecentGroup=this.makeMethod("addRecent"),this.ban=this.makeMethod("ban"),this.unban=this.makeMethod("unban"),this.getBanner=this.makeMethod("getBanner"),this.hideBanner=this.makeMethod("hideBanner"),this.getNameHistory=this.makeMethod("getNameHistory"),this.addContact=this.makeMethod("addContact"),this.deleteContact=this.makeMethod("deleteContact"),this.reorderContact=this.makeMethod("reorderContact"),this.getWallTabsWithPrefetch=this.makeMethod("getWallTabs",!0),this.unblock=this.makeMethod("unblock"),this.getBlockedInfo=this.makeMethod("getBlockedInfo"),this.getCreationOnboarding=this.makeMethod("getCreationOnboarding"),this.updateCreationOnboarding=this.makeMethod("updateCreationOnboarding"),this.getTopWarnings=this.makeMethod("getTopWarnings"),this.clearOwnerDocs=this.makeMethod("clearOwnerDocs"),this.rollbackOwnerDocs=this.makeMethod("rollbackOwnerDocs"),this.getEditManagerInfo=this.makeMethod("getEditManagerInfo")}}a=(0,i.__decorate)([o.scope.global()],a)},551494:(e,t,s)=>{s.d(t,{InternalApi:()=>a});var i=s(331635),r=s(132028),o=s(641569);class a extends o.ApiNamespace{get namespace(){return"internal"}constructor(...e){super(...e),this.getYaGeocoderString=this.makeMethod("getYaGeocoderString"),this.getWebLeftMenu=this.makeMethod("getWebLeftMenu"),this.getMvkLeftMenu=this.makeMethod("getMvkLeftMenu"),this.getClientUpdateInfo=this.makeMethod("getClientUpdateInfo"),this.getVideoModerationActions=this.makeMethod("getVideoModerationActions"),this.getVideoRights=this.makeMethod("getVideoRights")}}a=(0,i.__decorate)([r.scope.global()],a)},488709:(e,t,s)=>{s.d(t,{UsersApi:()=>a});var i=s(331635),r=s(641569),o=s(132028);class a extends r.ApiNamespace{get namespace(){return"users"}constructor(...e){super(...e),this.getWithPrefetch=this.makeMethod("get",!0),this.get=this.makeMethod("get"),this.getFollowers=this.makeMethod("getFollowers"),this.search=this.makeMethod("search"),this.getSubscriptions=this.makeMethod("getSubscriptions"),this.getWallTabsWithPrefetch=this.makeMethod("getWallTabs",!0)}}a=(0,i.__decorate)([o.scope.global()],a)},50790:(e,t,s)=>{s.d(t,{useIsMounted:()=>r});var i=s(296540);const r=()=>{const e=(0,i.useRef)(!1);return(0,i.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),(0,i.useCallback)((()=>e.current),[])}},342954:(e,t,s)=>{s.d(t,{useStateRef:()=>r});var i=s(296540);function r(e){const[t,s]=(0,i.useState)(e),r=(0,i.useRef)(t);return[t,(0,i.useCallback)((e=>{const t=e instanceof Function?e(r.current):e;r.current=t,s(t)}),[]),r]}},516387:(e,t,s)=>{s.d(t,{useSyncUpdateEffect:()=>o});var i=s(296540),r=s(615955);function o(e,t){const[s,o]=(0,i.useState)(t);(0,r.shallowEqual)(s,t)||(o(t),e())}},51497:(e,t,s)=>{s.d(t,{useThrottledCallback:()=>a});var i=s(296540),r=s(351118),o=s(634444);function a(e,t){const s=(0,o.useStableCallback)(e),a=(0,i.useMemo)((()=>(0,r.throttle)(s,t)),[s,t]);return(0,i.useEffect)((()=>()=>{a.cancel()}),[a]),a}},515438:(e,t,s)=>{s.d(t,{useValueRef:()=>r});var i=s(296540);function r(e){const t=(0,i.useRef)(e);return t.current=e,t}},80963:(e,t,s)=>{s.d(t,{createFriendsAddFx:()=>l,createFriendsAddListFx:()=>m,createFriendsDeleteBulkFx:()=>_,createFriendsDeleteFx:()=>h,createFriendsDeleteListFx:()=>v,createFriendsDeleteSubscriberFx:()=>y,createFriendsEditListFx:()=>g,createFriendsGetFriendsDeletionSuggestionsFx:()=>c,createFriendsGetFx:()=>a,createFriendsGetListsFx:()=>r,createFriendsGetRecentFx:()=>k,createFriendsHideSuggestion:()=>C,createFriendsPrefetchCountersFx:()=>b,createFriendsPrefetchFollowersFx:()=>S,createFriendsPrefetchFx:()=>n,createFriendsPrefetchListsFx:()=>o,createFriendsPrefetchMutualFx:()=>E,createFriendsPrefetchOnlineFx:()=>p,createFriendsPrefetchRecommendationsFx:()=>d,createFriendsPrefetchRequestsFx:()=>u,createFriendsRequestsToSubscribersFx:()=>w,createFriendsSearchFx:()=>f});var i=s(412554);const r=e=>(0,i.createApiEffect)("friends.getLists",e),o=e=>(0,i.createPrefetchEffect)("friends.getLists",e),a=e=>(0,i.createApiEffect)("friends.get",e),n=e=>(0,i.createPrefetchEffect)("friends.get",e),c=e=>(0,i.createApiEffect)("friends.getFriendsDeletionSuggestions",e),d=e=>(0,i.createPrefetchEffect)("friends.getRecommendations",e),l=e=>(0,i.createApiEffect)("friends.add",e),h=e=>(0,i.createApiEffect)("friends.delete",e),_=e=>(0,i.createApiEffect)("friends.deleteBulk",e),u=e=>(0,i.createPrefetchEffect)("friends.getRequests",e),p=e=>(0,i.createPrefetchEffect)("friends.getOnline",e),m=e=>(0,i.createApiEffect)("friends.addList",e),v=e=>(0,i.createApiEffect)("friends.deleteList",e),g=e=>(0,i.createApiEffect)("friends.editList",e),f=e=>(0,i.createApiEffect)("friends.search",e),y=e=>(0,i.createApiEffect)("friends.deleteSubscriber",e),S=e=>(0,i.createPrefetchEffect)("friends.getFollowers",e),w=e=>(0,i.createApiEffect)("friends.requestsToSubscribers",e),b=e=>(0,i.createPrefetchEffect)("friends.getCounters",e),k=e=>(0,i.createApiEffect)("friends.getRecent",e),E=e=>(0,i.createPrefetchEffect)("friends.getMutual",e),C=e=>(0,i.createApiEffect)("friends.hideSuggestion",e)},314799:(e,t,s)=>{s.d(t,{useHelpHint:()=>o});var i=s(984745),r=s(335797);const o=e=>(0,r.useEntitiesStore)((0,i.ensureAccountHelpHintsService)().$helpHints,e)},219769:(e,t,s)=>{s.d(t,{useIsHelpHintActive:()=>r});var i=s(314799);const r=e=>Boolean((0,i.useHelpHint)(e))},363046:(e,t,s)=>{function i(e){e.preventDefault(),e.stopPropagation()}s.d(t,{cancelEvent:()=>i})},250503:(e,t,s)=>{s.d(t,{getAPIErrorMessage:()=>i});const i=e=>e.error_text||e.error_msg},348385:(e,t,s)=>{s.d(t,{$api:()=>c,APIGate:()=>d,changeAPIOptions:()=>n});var i=s(32489),r=s(293721),o=s(175325),a=s(990490);const n=o.stickersEmojiKeyboard.createEvent(),c=o.stickersEmojiKeyboard.createStore(new a.API({})).on(n,((e,{api:t})=>t)),d=(0,r.createGate)();(0,i.forward)({from:d.state,to:n})},270634:(e,t,s)=>{s.d(t,{$context:()=>c,CONTEXT:()=>a,ContextGate:()=>d});var i=s(32489),r=s(293721),o=s(175325),a=function(e){return e.PHOTO_EDITOR="photoEditor",e}({});const n=o.stickersEmojiKeyboard.createEvent(),c=o.stickersEmojiKeyboard.createStore(null).on(n,((e,{context:t})=>t??null)),d=(0,r.createGate)();(0,i.forward)({from:d.state,to:n})},895380:(e,t,s)=>{s.d(t,{AtomNameByHelpHintId:()=>n,AtomNameByPromoId:()=>d,AvatarSuggestionAtomName:()=>o,HelpHintAtomNames:()=>a,HelpHintIdTypes:()=>i,HelpHintPromoTypes:()=>r});var i=function(e){return e.VMOJI_AVATAR_SUGGESTION="keyboard:stickers_vmoji_avatar_suggestion",e}({}),r=function(e){return e.VMOJI_AVATAR_SUGGESTION="vmoji_avatar_suggestion_stickers_keyboard_hint",e}({});const o="avatarSuggestion",a=[o],n={"keyboard:stickers_vmoji_avatar_suggestion":o},c="newAvatarSuggestionCounter",d={vmoji_avatar_suggestion_stickers_keyboard_hint:c}},175325:(e,t,s)=>{s.d(t,{stickersEmojiKeyboard:()=>i});const i=(0,s(32489).createDomain)()},528079:(e,t,s)=>{s.d(t,{$userEnv:()=>o,setUserEnv:()=>r});var i=s(175325);const r=i.stickersEmojiKeyboard.createEvent(),o=i.stickersEmojiKeyboard.createStore({}).on(r,((e,t)=>t))},990490:(e,t,s)=>{s.d(t,{API:()=>c});var i=s(767396),r=s(719628),o=s(764891),a=s(285627),n=s(869343);class c extends i.API{constructor({onAPIRequest:e,language:t,context:s,logError:c,...d}){super({requestMethod:e,language:t,logError:c},(0,n.isStaticUpdatesManagerEnabled)()?void 0:{userId:d?.userId,source:"stickers"}),this.cache=new r.Cache({api:this,context:s,...d}),(0,n.isStaticUpdatesManagerEnabled)()||(this.updates.addEventListener(i.StickersQueueEventType.UGC_OWNER_UPDATE,o.stickersUGCOwnerUpdateHandler.bind(this)),this.updates.addEventListener(i.StickersQueueEventType.UGC_STICKER_UPDATE,a.stickersUGCStickerUpdateHandler.bind(this)))}}},764891:(e,t,s)=>{function i({detail:{owner_global_id:e}}){this.cache.reloadUGC(e)}s.d(t,{stickersUGCOwnerUpdateHandler:()=>i})},285627:(e,t,s)=>{s.d(t,{stickersUGCStickerUpdateHandler:()=>o});const i=new Map,r=new Set;async function o({detail:{stickers:e}}){const{peerId:t}=this.cache.options;e.forEach((e=>{if(e.owner_id!==t)return;let s=i.get(t);s||(s=[],i.set(t,s));const r=s.findIndex((t=>t.id===e.id&&t.pack_id===e.pack_id&&t.owner_id===e.owner_id));-1!==r?s[r]=e:s.push(e)})),a.call(this)}async function a(){const{peerId:e}=this.cache.options;if(!e||r.has(e))return;const t=i.get(e);if(!t?.length)return;r.add(e),i.delete(e);const s=await this.cache.ugcPacks.get();if(!s?.length)return;const o=new Map(s.map((e=>[e.id,e])));t.forEach((e=>{const{id:t,pack_id:s}=e;if(void 0===s)return;const i=o.get(s);if(!i)return;const r=i.stickers.findIndex((e=>e.id===t));-1!==r&&(i.stickers[r]=e)}));try{await this.cache.ugcPacks.set(s)}catch{}r.delete(e),a.call(this)}},140143:(e,t,s)=>{async function i(){let e=null;try{e=(await this.options.api.store.getFavoriteStickers()).items}catch{}return!!e&&(await this.favoriteStickers.set(e),!0)}s.d(t,{reloadFavoriteStickers:()=>i})},310622:(e,t,s)=>{s.d(t,{reloadGlobal:()=>r});var i=s(270634);async function r(e){var t;if(this.reloading)return!0;this.setReloading(!0);const s=await this.global.get();let[r,o,a]=await Promise.all([this.options.api.store.hasNewItems({type:"stickers",version_hash:String(s?.stickers_version_hash)}).catch((()=>null)),this.stockItems.get(),this.imageConfigs.get()]);if(!r)return this.setReloading(!1),!1;(t=r).sticker_packs_version_hashes||(t.sticker_packs_version_hashes=s?.sticker_packs_version_hashes);const{stickers_version_hash:n,sticker_packs_version_hashes:c,favorite_stickers_version_hash:d,image_configs_version_hash:l,sticker_packs_chunk_size_limit:h,vmoji_promotion:_}=r;(n!==s?.stickers_version_hash||e)&&(o=null,await this.stickers.set(new Map));const u=[this.reloadStockItems({cachedStockItems:e?null:o,actualPacksHashes:e?void 0:c,chunkSize:h}),this.reloadUGC(),this.reloadVmoji(),this.reloadRecentStickers()];this.options.context===i.CONTEXT.PHOTO_EDITOR&&u.push(this.reloadPhotoEditorStickers()),(d!==s?.favorite_stickers_version_hash||e)&&u.push(this.reloadFavoriteStickers()),a&&l===s?.image_configs_version_hash&&!e||u.push(this.reloadImageConfigs());const p=!_?.avatar_suggestion?.character_id;!p&&_?.avatar_suggestion?.character_id!==s?.vmoji_promotion?.avatar_suggestion?.character_id?u.push(this.reloadHelpHint()):p&&this.clearAllHelpHint();const m=await Promise.all(u);this.setReloading(!1);const v=-1===m.findIndex((e=>!e));return v&&r&&(this.global.set(r),this.stickersSync.notify(void 0,!0)),v}},187791:(e,t,s)=>{s.d(t,{clearAllHelpHint:()=>o,clearHelpHintById:()=>r});var i=s(895380);function r(e){this[i.AtomNameByHelpHintId[e]]?.delete()}function o(){i.HelpHintAtomNames.forEach((e=>this[e].delete()))}},599024:(e,t,s)=>{async function i(e){this.clearHelpHintById(e);try{const t=await this.options.api.account.hideHelpHint({hint_id:e});return Boolean(t)}catch(e){return!1}}s.d(t,{hideHelpHint:()=>i})},520729:(e,t,s)=>{s.d(t,{reloadHelpHint:()=>r});var i=s(895380);async function r(){let e=i.HelpHintAtomNames.slice(),t=null;try{t=await this.options.api.account.getHelpHints({categories:"vmoji_promo"})}catch{}return t?.items?(t.items.forEach((t=>{const s=t.id,r=i.AtomNameByHelpHintId[s];r in this&&(this[r]?.set(t,{notify:!0}),e=e.filter((e=>e!==r)))})),e.forEach((e=>{this[e].delete()})),!0):(this.clearAllHelpHint(),!0)}},540468:(e,t,s)=>{s.d(t,{markHelpHintAsViewed:()=>o});var i=s(895380);const r=(0,s(351118).throttle)((function(e,t,s){e.options.api.stickers.markPromoAsViewed({promo_id:t,count:s}).then((s=>{if(s){e[i.AtomNameByPromoId[t]].set(0)}}))}),3e4);function o(e){const t=this[i.AtomNameByPromoId[e]],s=(t?.get()||0)+1;t.set(s),r(this,e,s)}},741707:(e,t,s)=>{async function i(){let e=null;try{e=await this.options.api.store.getStickersImageConfigs()}catch{}return!!e&&(this.imageConfigs.set(e),!0)}s.d(t,{reloadImageConfigs:()=>i})},318680:(e,t,s)=>{async function i(){try{const e=await this.options.api.photos.getEditorStickers();this.photoEditorStickers.set(e.items)}catch{}return!0}s.d(t,{reloadPhotoEditorStickers:()=>i})},456690:(e,t,s)=>{async function i(){let e=null;try{e=(await this.options.api.messages.getRecentStickers()).items}catch{}return e&&this.recentStickers.set(e),!0}s.d(t,{reloadRecentStickers:()=>i})},598284:(e,t,s)=>{async function i(e){if(!e.length)return[];const t=await this.stickers.get()??new Map,s=[];let i=[];for(const r of e){const e=t.get(r);e?i.push(e):s.push(r)}if(!s.length)return i;const r=await this.options.api.store.getStickers({sticker_ids:String(s.join(","))});for(const e of r)e.sticker_id&&t.set(e.sticker_id,e);this.stickers.set(t),i=[];for(const s of e){const e=t.get(s);e&&i.push(e)}return i}s.d(t,{getStickers:()=>i})},514658:(e,t,s)=>{async function i({active:e}){let t=await this.stockItems.get();return t&&(t=t.sort((({product:{vmoji_avatar:e}},{product:{vmoji_avatar:t}})=>Number(Boolean(t))-Number(Boolean(e)))),e&&(t=t.filter((({product:e})=>e.active)))),t}s.d(t,{getStockItems:()=>i})},432924:(e,t,s)=>{async function i({productId:e,stickerId:t}){const s=await this.stockItems.get();let i;if(s&&(e&&(i=s.find((({product:{id:t}})=>t===e))),t&&!i&&(i=s.find((({product:{stickers:e}})=>e&&-1!==e.findIndex((({sticker_id:e})=>e===t)))))),i)return i;if(e)try{i=await this.options.api.store.getStockItemByProductId({type:"stickers",product_id:String(e)})}catch(e){i=void 0}if(i)return this.updateStockItems([i]),i;if(t)try{i=await this.options.api.store.getStockItemByStickerId({sticker_id:t})}catch(e){i=void 0}return i&&this.updateStockItems([i]),i}s.d(t,{loadStockItems:()=>i})},74737:(e,t,s)=>{s.d(t,{reloadStockItems:()=>o});var i=s(351118);const r=new Map;async function o({chunkSize:e=25,cachedStockItems:t,actualPacksHashes:s}){let o=r.get(this.stickersSync.key);o||(o=new Map,r.set(this.stickersSync.key,o));let a=t?.reduce(((e,{product:{id:t},version_hash:i})=>{const r=s?.find((({pack_id:e})=>e===t));if(!r)return e;return r.hash!==i&&e.push(t),e}),[]);const n=!a;if(n)try{const{items:e}=await this.options.api.store.getProducts({type:"stickers",filters:"purchased"});a=e.map((({id:e})=>e))}catch(e){a=void 0}if(!a?.length)return!0;await this.stickers.set(new Map);let c=await Promise.all((0,i.chunkArray)(a,e).map((e=>{const t=String(e);return o?.get(t)||this.options.api.store.getStockItems({type:"stickers",product_ids:t}).then((e=>(o?.set(t,e),e)))}))).then((e=>e.reduce(((e,{items:t})=>(e.push(...t),e)),[]).filter((e=>!Array.isArray(e))))).catch((()=>null));if(!c)return!1;if(t?.length){const e=new Map(c.map((e=>[e.product.id,e])));c=t=t.map((t=>e.get(t.product.id)||t))}return c&&a&&n&&(c=c.sort((({product:{id:e}},{product:{id:t}})=>Number(a?.indexOf(e))-Number(a?.indexOf(t))))),await this.stockItems.set(c),r.delete(this.stickersSync.key),!0}},261657:(e,t,s)=>{async function i(e,t){let s=await this.stockItems.get();if(s){const t=new Map(s.map((e=>{const{product:{id:t}}=e;return[t,e]})));e.forEach((e=>{const{product:{id:s}}=e;t.set(s,e)})),s=[...t.values()]}return this.stockItems.set(s||e,t)}s.d(t,{updateStockItems:()=>i})},892816:(e,t,s)=>{function i(){this.ugcInfo.delete(),this.ugcPacks.delete()}s.d(t,{clearUGC:()=>i})},843356:(e,t,s)=>{async function i(){const e=await this.ugcInfo.get();if(!e?.show_keyboard_onboarding)return!1;const{owner_id:t}=e;e.show_keyboard_onboarding=!1,this.ugcInfo.set(e);try{const e=await this.options.api.stickers.hideUGCKeyboardOnboarding({owner_id:t});return Boolean(e)}catch(e){return!1}}s.d(t,{hideUGCOnboarding:()=>i})},593920:(e,t,s)=>{s.d(t,{reloadUGC:()=>o});var i=s(468073),r=s(869343);async function o(e){if(!(0,r.isUgcStickersEnabled)())return this.clearUGC(),!0;const{peerId:t}=this.options;if(!t||!i.Ranges.isChatOrChannelPeer(t))return!0;const s=await this.ugcPacks.get();let o;try{o=(await this.options.api.stickers.getUGCPackLists({owner_ids:String(t),owner_global_ids:e})).lists[0]}catch{}if(!o)return this.ugcInfo.delete(),this.ugcPacks.delete(),!0;this.ugcInfo.set(o);const{items:a}=o;if(!a.length)return this.ugcPacks.delete(),!0;const n=s?new Map(s.map((({id:e,hash:t})=>[e,t]))):void 0,c=a.reduce(((e,{pack_id:t,hash:s})=>{const i=n?.get(t);return i!==s&&e.push(t),e}),[]);if(!c.length)return!0;let d;try{d=(await this.options.api.stickers.getUGCPacks({owner_id:t,pack_ids:String(c)})).packs}catch{}return!d||(this.ugcPacks.set(d),!0)}},938690:(e,t,s)=>{async function i(){const e=await this.global.get();e?.vmoji_promotion&&(e.vmoji_promotion.dot_color=void 0,this.global.set(e,{notify:!1}))}s.d(t,{clearVmojiPromotionDot:()=>i})},163034:(e,t,s)=>{async function i(){if(this.hasAvatar.get())return!0;try{const e=await this.options.api.vmoji.getAvatar();this.hasAvatar.set(Boolean(e.characters?.length))}catch{}return!0}s.d(t,{reloadVmoji:()=>i})},719628:(e,t,s)=>{s.d(t,{Cache:()=>C});var i=s(724361),r=s(955326),o=s(100596),a=s(892816),n=s(593920),c=s(163034),d=s(598284),l=s(599024),h=s(310622),_=s(514658),u=s(520729),p=s(432924),m=s(74737),v=s(261657),g=s(540468),f=s(843356),y=s(741707),S=s(456690),w=s(318680),b=s(938690),k=s(140143),E=s(187791);class C{subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}get reloading(){return this.isReloading}setReloading(e){this.isReloading=e}destroy(){this.stickersSync.destroy(),this.stickersAsync.destroy()}constructor(e){this.isReloading=!1,this.listeners=new Set,this.reload=h.reloadGlobal.bind(this),this.reloadVmoji=c.reloadVmoji.bind(this),this.clearVmojiPromotionDot=b.clearVmojiPromotionDot.bind(this),this.getStockItem=p.loadStockItems.bind(this),this.getStockItems=_.getStockItems.bind(this),this.updateStockItems=v.updateStockItems.bind(this),this.reloadStockItems=m.reloadStockItems.bind(this),this.reloadUGC=n.reloadUGC.bind(this),this.clearUGC=a.clearUGC.bind(this),this.hideUGCOnboarding=f.hideUGCOnboarding.bind(this),this.reloadRecentStickers=S.reloadRecentStickers.bind(this),this.reloadPhotoEditorStickers=w.reloadPhotoEditorStickers.bind(this),this.reloadFavoriteStickers=k.reloadFavoriteStickers.bind(this),this.reloadImageConfigs=y.reloadImageConfigs.bind(this),this.getStickers=d.getStickers.bind(this),this.reloadHelpHint=u.reloadHelpHint.bind(this),this.clearHelpHintById=E.clearHelpHintById.bind(this),this.clearAllHelpHint=E.clearAllHelpHint.bind(this),this.hideHelpHint=l.hideHelpHint.bind(this),this.markHelpHintAsViewed=g.markHelpHintAsViewed.bind(this);const{userId:t,peerId:s}=e;this.options=e;const C=(0,i.createSyncStore)({dbName:"stickers",storeName:String(t),version:1}),I=(0,r.createAsyncStore)({dbName:"stickers",storeName:String(t),version:1});this.stickersSync=C,this.stickersAsync=I,this.global=I.createAtom("global"),this.stockItems=I.createAtom("stockItems"),this.imageConfigs=I.createAtom("imageConfigs"),this.recentStickers=I.createAtom("recentStickers"),this.photoEditorStickers=I.createAtom("photoEditorStickers"),this.favoriteStickers=I.createAtom("favoriteStickers"),this.avatarSuggestion=I.createAtom("avatarSuggestion"),this.stickers=I.createAtom("stickers"),this.hasAvatar=C.createAtom("hasAvatar",o.SyncAtomType.BOOLEAN),this.recentEmoji=C.createAtom("recentEmoji",o.SyncAtomType.OBJECT),this.tabbarActiveTab=C.createAtom("tabbarActiveTab",o.SyncAtomType.STRING),this.stickersActiveTab=C.createAtom("stickersActiveTab",o.SyncAtomType.NUMBER),this.newAvatarSuggestionCounter=C.createAtom("newAvatarSuggestionCounter",o.SyncAtomType.NUMBER);const T=(0,r.createAsyncStore)({dbName:"stickers-ugc",storeName:`${t}-${s}`,version:1});this.ugcAsync=T,this.ugcInfo=T.createAtom("ugcInfo"),this.ugcPacks=T.createAtom("ugcPacks"),this.getStickersImageConfigs=this.imageConfigs.get.bind(this.imageConfigs)}}},869343:(e,t,s)=>{s.d(t,{isPopUpStickersEnabled:()=>n,isPromoVmojiCounterEnabled:()=>a,isStaticUpdatesManagerEnabled:()=>c,isStickersPickerFastSelectPackEnabled:()=>d,isUgcStickersEnabled:()=>o});var i=s(528079);function r(e){return Boolean(i.$userEnv.getState()[e])}const o=()=>r("stickers.ugc"),a=()=>r("vmoji.promo.avatar_suggestion.promo_counter"),n=()=>r("stickers.popup"),c=()=>r("static_updates_manager_in_sticker_picker"),d=()=>r("sticker_picker_fast_select_pack")},100460:(e,t,s)=>{s.d(t,{moveArrayElement:()=>r});const i=(e,t)=>e>=0?e:t+e,r=({items:e,from:t,to:s})=>{const r=[...e];return(({items:e,from:t,to:s})=>{if(!e.length)return;const r=i(t,e.length),o=i(s,e.length);r!==o&&e.splice(o,0,...e.splice(t,1))})({items:r,from:t,to:s}),r}},716279:(e,t,s)=>{s.d(t,{decodeThumbhash:()=>r});var i=s(203080);function r(e){let t="";try{t=atob(e)}catch(e){}if(!t||String(e)!==e)throw new TypeError("The string to be decoded does not appear to be valid Base64 string");const s=Uint8Array.from(t,(e=>e.charCodeAt(0)));return(0,i.thumbHashToDataURL)(s)}},523417:(e,t,s)=>{s.d(t,{expectNever:()=>i});const i=e=>{throw new TypeError(`Unexpected value: ${e}`)}},908671:(e,t,s)=>{s.d(t,{formatCount:()=>i});const i=(e,t)=>{const s=t?.separator||".",i=t?.maximumFractionDigits??1,r=t?.roundingMode||void 0,o=t?.kLimit||1e3,a=t?.mLimit||1e6,n=t?.bLimit||1e9,c=globalThis.langConfig?.locale||"ru",d=(e,t)=>{"floor"===r&&(e=Math.floor(e*Math.pow(10,i))/Math.pow(10,i));let o=e.toFixed(i);return Number(o).toLocaleString(c).replace(/\./,s)+t};if(e>-o&&e<o)return e.toLocaleString(c);const l=e/n;if(l>=1||l<=-1)return d(e/1e9,"B");const h=e/a;if(h>=1||h<=-1)return d(e/1e6,"M");const _=e/o;return _>=1||_<=-1?d(e/1e3,"K"):String(e)}},470922:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(94243);function r(e,t){e.classList?e.classList.add(t):(0,i.default)(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}},94243:(e,t,s)=>{function i(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}s.d(t,{default:()=>i})},878995:(e,t,s)=>{function i(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function r(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=i(e.className,t):e.setAttribute("class",i(e.className&&e.className.baseVal||"",t))}s.d(t,{default:()=>r})},428937:(e,t,s)=>{s.d(t,{default:()=>i});const i={background:"InfoBanner__background--84RCg"}},245426:(e,t,s)=>{s.d(t,{default:()=>i});const i={mourning:"LeftMenu__mourning--YPIM1"}},511694:(e,t,s)=>{s.d(t,{default:()=>i});const i={root:"TemplateSticker__root--nNfzL"}},129348:(e,t,s)=>{s.d(t,{default:()=>i});const i={iframe:"ModeratorSlot__iframe--iD4OU"}},277951:(e,t,s)=>{s.d(t,{default:()=>i});const i={title:"NarrativesEditorHeader__title--1Lrls"}},304105:(e,t,s)=>{s.d(t,{default:()=>i});const i={modalBody:"StoriesCoverSelect__modalBody--dzsU9"}},122402:(e,t,s)=>{s.d(t,{default:()=>i});const i={noIslandsContainer:"StoryBlock__noIslandsContainer--NnPqt"}},562196:(e,t,s)=>{s.d(t,{default:()=>i});const i={hiddenAvatar:"StoriesHiddenUsersWidget__hiddenAvatar--DU5I6",textBreak:"StoriesHiddenUsersWidget__textBreak--L0HLn"}},573510:(e,t,s)=>{s.d(t,{default:()=>u});var i=s(58168),r=s(198587),o=s(777387),a=s(470922),n=s(878995),c=s(296540),d=s(475067),l=s(792403),h=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return(0,n.default)(e,t)}))},_=function(e){function t(){for(var t,s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,s){var i=t.resolveArguments(e,s),r=i[0],o=i[1];t.removeClasses(r,"exit"),t.addClass(r,o?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,s)},t.onEntering=function(e,s){var i=t.resolveArguments(e,s),r=i[0],o=i[1]?"appear":"enter";t.addClass(r,o,"active"),t.props.onEntering&&t.props.onEntering(e,s)},t.onEntered=function(e,s){var i=t.resolveArguments(e,s),r=i[0],o=i[1]?"appear":"enter";t.removeClasses(r,o),t.addClass(r,o,"done"),t.props.onEntered&&t.props.onEntered(e,s)},t.onExit=function(e){var s=t.resolveArguments(e)[0];t.removeClasses(s,"appear"),t.removeClasses(s,"enter"),t.addClass(s,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var s=t.resolveArguments(e)[0];t.addClass(s,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var s=t.resolveArguments(e)[0];t.removeClasses(s,"exit"),t.addClass(s,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,s){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,s]},t.getClassNames=function(e){var s=t.props.classNames,i="string"==typeof s,r=i?""+(i&&s?s+"-":"")+e:s[e];return{baseClassName:r,activeClassName:i?r+"-active":s[e+"Active"],doneClassName:i?r+"-done":s[e+"Done"]}},t}(0,o.default)(t,e);var s=t.prototype;return s.addClass=function(e,t,s){var i=this.getClassNames(t)[s+"ClassName"],r=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===s&&r&&(i+=" "+r),"active"===s&&e&&(0,l.forceReflow)(e),i&&(this.appliedClasses[t][s]=i,function(e,t){e&&t&&t.split(" ").forEach((function(t){return(0,a.default)(e,t)}))}(e,i))},s.removeClasses=function(e,t){var s=this.appliedClasses[t],i=s.base,r=s.active,o=s.done;this.appliedClasses[t]={},i&&h(e,i),r&&h(e,r),o&&h(e,o)},s.render=function(){var e=this.props,t=(e.classNames,(0,r.default)(e,["classNames"]));return c.createElement(d.default,(0,i.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(c.Component);_.defaultProps={classNames:""},_.propTypes={};const u=_},475067:(e,t,s)=>{s.d(t,{default:()=>g});var i=s(198587),r=s(777387),o=s(296540),a=s(440961),n=s(113642),c=s(17241),d=s(792403),l="unmounted",h="exited",_="entering",u="entered",p="exiting",m=function(e){function t(t,s){var i;i=e.call(this,t,s)||this;var r,o=s&&!s.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?o?(r=h,i.appearStatus=_):r=u:r=t.unmountOnExit||t.mountOnEnter?l:h,i.state={status:r},i.nextCallback=null,i}(0,r.default)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===l?{status:h}:null};var s=t.prototype;return s.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},s.componentDidUpdate=function(e){var t=null;if(e!==this.props){var s=this.state.status;this.props.in?s!==_&&s!==u&&(t=_):s!==_&&s!==u||(t=p)}this.updateStatus(!1,t)},s.componentWillUnmount=function(){this.cancelNextCallback()},s.getTimeouts=function(){var e,t,s,i=this.props.timeout;return e=t=s=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,s=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:s}},s.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===_){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:a.findDOMNode(this);s&&(0,d.forceReflow)(s)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===h&&this.setState({status:l})},s.performEnter=function(e){var t=this,s=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[a.findDOMNode(this),i],o=r[0],c=r[1],d=this.getTimeouts(),l=i?d.appear:d.enter;!e&&!s||n.default.disabled?this.safeSetState({status:u},(function(){t.props.onEntered(o)})):(this.props.onEnter(o,c),this.safeSetState({status:_},(function(){t.props.onEntering(o,c),t.onTransitionEnd(l,(function(){t.safeSetState({status:u},(function(){t.props.onEntered(o,c)}))}))})))},s.performExit=function(){var e=this,t=this.props.exit,s=this.getTimeouts(),i=this.props.nodeRef?void 0:a.findDOMNode(this);t&&!n.default.disabled?(this.props.onExit(i),this.safeSetState({status:p},(function(){e.props.onExiting(i),e.onTransitionEnd(s.exit,(function(){e.safeSetState({status:h},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:h},(function(){e.props.onExited(i)}))},s.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},s.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},s.setNextCallback=function(e){var t=this,s=!0;return this.nextCallback=function(i){s&&(s=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},s.onTransitionEnd=function(e,t){this.setNextCallback(t);var s=this.props.nodeRef?this.props.nodeRef.current:a.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(s&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],o=r[0],n=r[1];this.props.addEndListener(o,n)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},s.render=function(){var e=this.state.status;if(e===l)return null;var t=this.props,s=t.children,r=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,i.default)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return o.createElement(c.default.Provider,{value:null},"function"==typeof s?s(e,r):o.cloneElement(o.Children.only(s),r))},t}(o.Component);function v(){}m.contextType=c.default,m.propTypes={},m.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:v,onEntering:v,onEntered:v,onExit:v,onExiting:v,onExited:v},m.UNMOUNTED=l,m.EXITED=h,m.ENTERING=_,m.ENTERED=u,m.EXITING=p;const g=m},17241:(e,t,s)=>{s.d(t,{default:()=>i});const i=s(296540).createContext(null)},113642:(e,t,s)=>{s.d(t,{default:()=>i});const i={disabled:!1}},792403:(e,t,s)=>{s.d(t,{forceReflow:()=>i});var i=function(e){return e.scrollTop}},777387:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(363662);function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,i.default)(e,t)}},198587:(e,t,s)=>{function i(e,t){if(null==e)return{};var s={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;s[i]=e[i]}return s}s.d(t,{default:()=>i})},363662:(e,t,s)=>{function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}s.d(t,{default:()=>i})},651220:(e,t,s)=>{s.d(t,{useVirtualizer:()=>c,useWindowVirtualizer:()=>d});var i=s(296540),r=s(440961),o=s(842468);const a="undefined"!=typeof document?i.useLayoutEffect:i.useEffect;function n(e){const t=i.useReducer((()=>({})),{})[1],s={...e,onChange:(s,i)=>{var o;i?(0,r.flushSync)(t):t(),null==(o=e.onChange)||o.call(e,s,i)}},[n]=i.useState((()=>new o.Virtualizer(s)));return n.setOptions(s),a((()=>n._didMount()),[]),a((()=>n._willUpdate())),n}function c(e){return n({observeElementRect:o.observeElementRect,observeElementOffset:o.observeElementOffset,scrollToFn:o.elementScroll,...e})}function d(e){return n({getScrollElement:()=>"undefined"!=typeof document?window:null,observeElementRect:o.observeWindowRect,observeElementOffset:o.observeWindowOffset,scrollToFn:o.windowScroll,initialOffset:()=>"undefined"!=typeof document?window.scrollY:0,...e})}},842468:(e,t,s)=>{s.d(t,{Virtualizer:()=>v,defaultRangeExtractor:()=>a,elementScroll:()=>m,observeElementOffset:()=>h,observeElementRect:()=>n,observeWindowOffset:()=>_,observeWindowRect:()=>d,windowScroll:()=>p});var i=s(580621);const r=e=>{const{offsetWidth:t,offsetHeight:s}=e;return{width:t,height:s}},o=e=>e,a=e=>{const t=Math.max(e.startIndex-e.overscan,0),s=Math.min(e.endIndex+e.overscan,e.count-1),i=[];for(let e=t;e<=s;e++)i.push(e);return i},n=(e,t)=>{const s=e.scrollElement;if(!s)return;const i=e.targetWindow;if(!i)return;const o=e=>{const{width:s,height:i}=e;t({width:Math.round(s),height:Math.round(i)})};if(o(r(s)),!i.ResizeObserver)return()=>{};const a=new i.ResizeObserver((t=>{const i=()=>{const e=t[0];if(null==e?void 0:e.borderBoxSize){const t=e.borderBoxSize[0];if(t)return void o({width:t.inlineSize,height:t.blockSize})}o(r(s))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()}));return a.observe(s,{box:"border-box"}),()=>{a.unobserve(s)}},c={passive:!0},d=(e,t)=>{const s=e.scrollElement;if(!s)return;const i=()=>{t({width:s.innerWidth,height:s.innerHeight})};return i(),s.addEventListener("resize",i,c),()=>{s.removeEventListener("resize",i)}},l="undefined"==typeof window||"onscrollend"in window,h=(e,t)=>{const s=e.scrollElement;if(!s)return;const r=e.targetWindow;if(!r)return;let o=0;const a=e.options.useScrollendEvent&&l?()=>{}:(0,i.debounce)(r,(()=>{t(o,!1)}),e.options.isScrollingResetDelay),n=i=>()=>{const{horizontal:r,isRtl:n}=e.options;o=r?s.scrollLeft*(n?-1:1):s.scrollTop,a(),t(o,i)},d=n(!0),h=n(!1);h(),s.addEventListener("scroll",d,c);const _=e.options.useScrollendEvent&&l;return _&&s.addEventListener("scrollend",h,c),()=>{s.removeEventListener("scroll",d),_&&s.removeEventListener("scrollend",h)}},_=(e,t)=>{const s=e.scrollElement;if(!s)return;const r=e.targetWindow;if(!r)return;let o=0;const a=e.options.useScrollendEvent&&l?()=>{}:(0,i.debounce)(r,(()=>{t(o,!1)}),e.options.isScrollingResetDelay),n=i=>()=>{o=s[e.options.horizontal?"scrollX":"scrollY"],a(),t(o,i)},d=n(!0),h=n(!1);h(),s.addEventListener("scroll",d,c);const _=e.options.useScrollendEvent&&l;return _&&s.addEventListener("scrollend",h,c),()=>{s.removeEventListener("scroll",d),_&&s.removeEventListener("scrollend",h)}},u=(e,t,s)=>{if(null==t?void 0:t.borderBoxSize){const e=t.borderBoxSize[0];if(e){return Math.round(e[s.options.horizontal?"inlineSize":"blockSize"])}}return e[s.options.horizontal?"offsetWidth":"offsetHeight"]},p=(e,{adjustments:t=0,behavior:s},i)=>{var r,o;const a=e+t;null==(o=null==(r=i.scrollElement)?void 0:r.scrollTo)||o.call(r,{[i.options.horizontal?"left":"top"]:a,behavior:s})},m=(e,{adjustments:t=0,behavior:s},i)=>{var r,o;const a=e+t;null==(o=null==(r=i.scrollElement)?void 0:r.scrollTo)||o.call(r,{[i.options.horizontal?"left":"top"]:a,behavior:s})};class v{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver((e=>{e.forEach((e=>{const t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()}))})):null);return{disconnect:()=>{var s;null==(s=t())||s.disconnect(),e=null},observe:e=>{var s;return null==(s=t())?void 0:s.observe(e,{box:"border-box"})},unobserve:e=>{var s;return null==(s=t())?void 0:s.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach((([t,s])=>{void 0===s&&delete e[t]})),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:o,rangeExtractor:a,onChange:()=>{},measureElement:u,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,s;null==(s=(t=this.options).onChange)||s.call(t,this,e)},this.maybeNotify=(0,i.memo)((()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null])),(e=>{this.notify(e)}),{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach((e=>e())),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach((e=>{this.observer.observe(e)})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,(e=>{this.scrollRect=e,this.maybeNotify()}))),this.unsubs.push(this.options.observeElementOffset(this,((e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()})))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{const s=new Map,i=new Map;for(let r=t-1;r>=0;r--){const t=e[r];if(s.has(t.lane))continue;const o=i.get(t.lane);if(null==o||t.end>o.end?i.set(t.lane,t):t.end<o.end&&s.set(t.lane,!0),s.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort(((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end))[0]:void 0},this.getMeasurementOptions=(0,i.memo)((()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled]),((e,t,s,i,r)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:s,getItemKey:i,enabled:r})),{key:!1}),this.getMeasurements=(0,i.memo)((()=>[this.getMeasurementOptions(),this.itemSizeCache]),(({count:e,paddingStart:t,scrollMargin:s,getItemKey:i,enabled:r},o)=>{if(!r)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach((e=>{this.itemSizeCache.set(e.key,e.size)})));const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const n=this.measurementsCache.slice(0,a);for(let r=a;r<e;r++){const e=i(r),a=1===this.options.lanes?n[r-1]:this.getFurthestMeasurement(n,r),c=a?a.end+this.options.gap:t+s,d=o.get(e),l="number"==typeof d?d:this.options.estimateSize(r),h=c+l,_=a?a.lane:r%this.options.lanes;n[r]={index:r,start:c,size:l,end:h,key:e,lane:_}}return this.measurementsCache=n,n}),{key:!1,debug:()=>this.options.debug}),this.calculateRange=(0,i.memo)((()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes]),((e,t,s,i)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:s,lanes:i}){const r=e.length-1,o=t=>e[t].start;if(e.length<=i)return{startIndex:0,endIndex:r};let a=g(0,r,o,s),n=a;if(1===i)for(;n<r&&e[n].end<s+t;)n++;else if(i>1){const o=Array(i).fill(0);for(;n<r&&o.some((e=>e<s+t));){const t=e[n];o[t.lane]=t.end,n++}const c=Array(i).fill(s+t);for(;a>=0&&c.some((e=>e>=s));){const t=e[a];c[t.lane]=t.start,a--}a=Math.max(0,a-a%i),n=Math.min(r,n+(i-1-n%i))}return{startIndex:a,endIndex:n}}({measurements:e,outerSize:t,scrollOffset:s,lanes:i}):null),{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=(0,i.memo)((()=>{let e=null,t=null;const s=this.calculateRange();return s&&(e=s.startIndex,t=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]}),((e,t,s,i,r)=>null===i||null===r?[]:e({startIndex:i,endIndex:r,overscan:t,count:s})),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,s=e.getAttribute(t);return s?parseInt(s,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const s=this.indexFromElement(e),i=this.measurementsCache[s];if(!i)return;const r=i.key,o=this.elementsCache.get(r);o!==e&&(o&&this.observer.unobserve(o),this.observer.observe(e),this.elementsCache.set(r,e)),e.isConnected&&this.resizeItem(s,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{const s=this.measurementsCache[e];if(!s)return;const i=t-(this.itemSizeCache.get(s.key)??s.size);0!==i&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(s,i,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach(((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))}))},this.getVirtualItems=(0,i.memo)((()=>[this.getVirtualIndexes(),this.getMeasurements()]),((e,t)=>{const s=[];for(let i=0,r=e.length;i<r;i++){const r=t[e[i]];s.push(r)}return s}),{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const t=this.getMeasurements();if(0!==t.length)return(0,i.notUndefined)(t[g(0,t.length-1,(e=>(0,i.notUndefined)(t[e]).start),e)])},this.getOffsetForAlignment=(e,t,s=0)=>{const i=this.getSize(),r=this.getScrollOffset();"auto"===t&&(t=e>=r+i?"end":"start"),"center"===t?e+=(s-i)/2:"end"===t&&(e-=i);const o=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(o,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const s=this.measurementsCache[e];if(!s)return;const i=this.getSize(),r=this.getScrollOffset();if("auto"===t)if(s.end>=r+i-this.options.scrollPaddingEnd)t="end";else{if(!(s.start<=r+this.options.scrollPaddingStart))return[r,t];t="start"}const o="end"===t?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(o,t,s.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:s}={})=>{"smooth"===s&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:s})},this.scrollToIndex=(e,{align:t="auto",behavior:s}={})=>{"smooth"===s&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let r=0;const o=t=>{if(!this.targetWindow)return;const r=this.getOffsetForIndex(e,t);if(!r)return void console.warn("Failed to get offset for index:",e);const[o,n]=r;this._scrollToOffset(o,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame((()=>{const t=this.getScrollOffset(),s=this.getOffsetForIndex(e,n);s?(0,i.approxEqual)(s[0],t)||a(n):console.warn("Failed to get offset for index:",e)}))},a=t=>{this.targetWindow&&(r++,r<10?this.targetWindow.requestAnimationFrame((()=>o(t))):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};o(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;const t=this.getMeasurements();let s;if(0===t.length)s=this.options.paddingStart;else if(1===this.options.lanes)s=(null==(e=t[t.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let i=t.length-1;for(;i>=0&&e.some((e=>null===e));){const s=t[i];null===e[s.lane]&&(e[s.lane]=s.end),i--}s=Math.max(...e.filter((e=>null!==e)))}return Math.max(s-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:s})=>{this.options.scrollToFn(e,{behavior:s,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const g=(e,t,s,i)=>{for(;e<=t;){const r=(e+t)/2|0,o=s(r);if(o<i)e=r+1;else{if(!(o>i))return r;t=r-1}}return e>0?e-1:0}},580621:(e,t,s)=>{function i(e,t,s){let i,r=s.initialDeps??[];function o(){var o,a,n,c;let d;s.key&&(null==(o=s.debug)?void 0:o.call(s))&&(d=Date.now());const l=e();if(!(l.length!==r.length||l.some(((e,t)=>r[t]!==e))))return i;let h;if(r=l,s.key&&(null==(a=s.debug)?void 0:a.call(s))&&(h=Date.now()),i=t(...l),s.key&&(null==(n=s.debug)?void 0:n.call(s))){const e=Math.round(100*(Date.now()-d))/100,t=Math.round(100*(Date.now()-h))/100,i=t/16,r=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${r(t,5)} /${r(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*i,120))}deg 100% 31%);`,null==s?void 0:s.key)}return null==(c=null==s?void 0:s.onChange)||c.call(s,i),i}return o.updateDeps=e=>{r=e},o}function r(e,t){if(void 0===e)throw new Error("Unexpected undefined"+(t?`: ${t}`:""));return e}s.d(t,{approxEqual:()=>o,debounce:()=>a,memo:()=>i,notUndefined:()=>r});const o=(e,t)=>Math.abs(e-t)<1.01,a=(e,t,s)=>{let i;return function(...r){e.clearTimeout(i),i=e.setTimeout((()=>t.apply(this,r)),s)}}},589066:(e,t,s)=>{s.d(t,{IconIllustrationSoundWaveLeft36h:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 72 36",width:72,height:36,vkuiIconId:"illustration_sound_wave_left_36h",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{d:"M59.693 5.25a1.25 1.25 0 0 0-2.5 0v25.788a1.25 1.25 0 1 0 2.5 0zm-8.595 6.446a1.25 1.25 0 0 0-2.5 0V24.59a1.25 1.25 0 0 0 2.5 0zm15.942-1.25c.69 0 1.25.56 1.25 1.25V24.59a1.25 1.25 0 0 1-2.5 0V11.696c0-.69.56-1.25 1.25-1.25M42.5 14.275a1.25 1.25 0 0 0-2.5 0v7.737a1.25 1.25 0 0 0 2.5 0zM23.693 5.25a1.25 1.25 0 0 0-2.5 0v25.788a1.25 1.25 0 1 0 2.5 0zm-8.595 6.446a1.25 1.25 0 0 0-2.5 0V24.59a1.25 1.25 0 0 0 2.5 0zm15.942-1.25c.69 0 1.25.56 1.25 1.25V24.59a1.25 1.25 0 0 1-2.5 0V11.696c0-.69.56-1.25 1.25-1.25M6.5 14.275a1.25 1.25 0 0 0-2.5 0v7.737a1.25 1.25 0 0 0 2.5 0z"})})},384081:(e,t,s)=>{s.d(t,{IconIllustrationSoundWaveRight36h:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 72 36",width:72,height:36,vkuiIconId:"illustration_sound_wave_right_36h",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{d:"M12.307 5.25a1.25 1.25 0 0 1 2.5 0v25.788a1.25 1.25 0 1 1-2.5 0zm8.595 6.446a1.25 1.25 0 0 1 2.5 0V24.59a1.25 1.25 0 0 1-2.5 0zM4.96 10.446c-.69 0-1.25.56-1.25 1.25V24.59a1.25 1.25 0 0 0 2.5 0V11.696c0-.69-.56-1.25-1.25-1.25m24.54 3.829a1.25 1.25 0 0 1 2.5 0v7.737a1.25 1.25 0 0 1-2.5 0zM48.307 5.25a1.25 1.25 0 0 1 2.5 0v25.788a1.25 1.25 0 1 1-2.5 0zm8.595 6.446a1.25 1.25 0 0 1 2.5 0V24.59a1.25 1.25 0 0 1-2.5 0zm-15.942-1.25c-.69 0-1.25.56-1.25 1.25V24.59a1.25 1.25 0 0 0 2.5 0V11.696c0-.69-.56-1.25-1.25-1.25m24.54 3.829a1.25 1.25 0 0 1 2.5 0v7.737a1.25 1.25 0 0 1-2.5 0z"})})},235722:(e,t,s)=>{s.d(t,{Icon12Like:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 12 12",width:12,height:12,vkuiIconId:"like_12",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M6.003 2.47a4 4 0 0 0-.15-.145c-.438-.399-1.126-.827-2.053-.827C2.104 1.498.752 2.9.752 4.601c0 .842.166 1.486.682 2.19.509.694 1.354 1.443 2.692 2.507l1.231.979c.379.301.913.301 1.291 0l1.231-.979c1.338-1.064 2.184-1.813 2.693-2.507.516-.704.682-1.348.682-2.19 0-1.701-1.352-3.103-3.048-3.103-.926 0-1.615.428-2.053.827a4 4 0 0 0-.15.145",clipRule:"evenodd"})})},356037:(e,t,s)=>{s.d(t,{Icon16ChevronOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 12 16",width:12,height:16,vkuiIconId:"chevron_outline_16",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.22 3.47a.75.75 0 0 1 1.06 0l4 4a.75.75 0 0 1 0 1.06l-4 4a.75.75 0 0 1-1.06-1.06L7.69 8 4.22 4.53a.75.75 0 0 1 0-1.06",clipRule:"evenodd"})})},40176:(e,t,s)=>{s.d(t,{Icon20MarketOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 20 20",width:20,height:20,vkuiIconId:"market_outline_20",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M7.25 5.75a2.75 2.75 0 0 1 5.5 0V6h-5.5zm-1.5.254V5.75a4.25 4.25 0 0 1 8.5 0v.254c1.013.014 1.62.073 2.112.323a3 3 0 0 1 1.311 1.311C18 8.28 18 9.12 18 10.8v.5c0 2.52 0 3.78-.49 4.743a4.5 4.5 0 0 1-1.967 1.967c-.963.49-2.223.49-4.743.49H9.2c-2.52 0-3.78 0-4.743-.49a4.5 4.5 0 0 1-1.967-1.967C2 15.08 2 13.82 2 11.3v-.5c0-1.68 0-2.52.327-3.162a3 3 0 0 1 1.311-1.311c.492-.25 1.1-.31 2.112-.323m-.798 1.532C5.377 7.5 5.935 7.5 6.8 7.5h6.4c.865 0 1.423.001 1.848.036.408.033.559.09.633.127a1.5 1.5 0 0 1 .656.656c.037.074.094.225.127.633.035.425.036.983.036 1.848v.5c0 1.285-.001 2.158-.056 2.833-.054.658-.151.994-.271 1.229a3 3 0 0 1-1.311 1.311c-.235.12-.57.217-1.229.27C12.958 17 12.085 17 10.8 17H9.2c-1.285 0-2.158-.001-2.833-.056-.658-.054-.994-.151-1.229-.271a3 3 0 0 1-1.311-1.311c-.12-.235-.217-.57-.27-1.229C3.5 13.458 3.5 12.585 3.5 11.3v-.5c0-.865.001-1.423.036-1.848.033-.408.09-.559.127-.633a1.5 1.5 0 0 1 .656-.656c.074-.037.225-.094.633-.127m.798 2.339a.875.875 0 1 1 1.75 0 .875.875 0 0 1-1.75 0M13.375 9a.875.875 0 1 0 0 1.75.875.875 0 0 0 0-1.75",clipRule:"evenodd"})})},56188:(e,t,s)=>{s.d(t,{Icon20More:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 20 20",width:20,height:20,vkuiIconId:"more_20",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",d:"M15 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3m-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3m-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3"})})},319204:(e,t,s)=>{s.d(t,{Icon2418CircleOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsxs)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"18_circle_outline_24",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:[(0,i.jsx)("path",{fillRule:"evenodd",d:"M12 2.1c5.467 0 9.9 4.433 9.9 9.9s-4.433 9.9-9.9 9.9-9.9-4.433-9.9-9.9S6.533 2.1 12 2.1m0 1.8A8.1 8.1 0 0 0 3.9 12a8.1 8.1 0 0 0 8.1 8.1 8.1 8.1 0 0 0 8.1-8.1A8.1 8.1 0 0 0 12 3.9",clipRule:"evenodd"}),(0,i.jsx)("path",{d:"M9.137 15.998c.585 0 .977-.382.977-.973V9.101C10.114 8.424 9.701 8 8.992 8c-.387 0-.72.043-1.134.322l-1.466 1c-.28.193-.392.413-.392.698 0 .397.285.682.666.682.188 0 .306-.043.483-.167l.967-.671h.038v5.161c0 .591.397.973.983.973m5.11.002c1.921 0 3.253-.908 3.253-2.25 0-1.03-.774-1.753-1.842-1.938v-.036c.92-.206 1.563-.866 1.563-1.695 0-1.21-1.21-2.081-2.974-2.081-1.758 0-2.973.871-2.973 2.075 0 .845.647 1.495 1.573 1.7v.037c-1.068.185-1.847.904-1.847 1.933C11 15.092 12.321 16 14.247 16m0-4.774c-.62 0-1.063-.39-1.063-.95 0-.565.448-.95 1.063-.95.621 0 1.074.385 1.074.95 0 .56-.447.95-1.074.95m0 3.443c-.72 0-1.22-.449-1.22-1.066 0-.608.5-1.046 1.22-1.046.727 0 1.227.438 1.227 1.046 0 .617-.5 1.066-1.227 1.066"})]})},784298:(e,t,s)=>{s.d(t,{Icon24Headphones:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"headphones_24",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{d:"M12 2.25a9 9 0 0 0-9 9V18a3 3 0 0 0 3 3h1.5A1.5 1.5 0 0 0 9 19.5v-5A1.5 1.5 0 0 0 7.5 13H5v-1.75c0-3.87 3.13-7 7-7s7 3.13 7 7V13h-2.5a1.5 1.5 0 0 0-1.5 1.5v5a1.5 1.5 0 0 0 1.5 1.5H18a3 3 0 0 0 3-3v-6.75a9 9 0 0 0-9-9"})})},619379:(e,t,s)=>{s.d(t,{Icon24NarrativeActiveOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"narrative_active_outline_24",vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",d:"M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.73 1.73 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119q-.39.365-.512.886c-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302q.366.39.887.512c.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.73 3.73 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.7 3.7 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22M18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.2 4.2 0 0 1 2.036-.653z"})})},592204:(e,t,s)=>{s.d(t,{Icon24NarrativeOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"narrative_outline_24",vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",d:"M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.73 1.73 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119q-.39.365-.512.886c-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302q.366.39.887.512c.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.73 3.73 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.7 3.7 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22M18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.2 4.2 0 0 1 2.036-.653zm0 2c-.63 0-1.17.228-1.67.716l-.349.34a.5.5 0 0 1-.698 0l-.35-.34c-.5-.488-1.04-.716-1.67-.716-.906 0-1.631.707-1.631 1.567 0 .993.4 1.546 2.524 3.185L16 18.875l1.012-.767c2.45-1.859 2.957-2.442 2.988-3.44l.001-.1c0-.86-.725-1.568-1.632-1.568"})})},399440:(e,t,s)=>{s.d(t,{Icon24Refresh:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"refresh_24",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{d:"M12 9.096a.4.4 0 0 0 .67.296l4.287-3.899a.667.667 0 0 0 0-.987L12.67.609a.4.4 0 0 0-.67.295V4a8 8 0 1 0 8 8 1 1 0 1 0-2 0 6 6 0 1 1-6-6z"})})},215402:(e,t,s)=>{s.d(t,{Icon24SmileOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"smile_outline_24",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{d:"M8.438 14.297a.9.9 0 0 1 1.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 0 0 1.773-.488c.191-.12.382-.26.53-.432a.9.9 0 0 1 1.4 1.132 4 4 0 0 1-.976.826A5.1 5.1 0 0 1 12 17.15a5.1 5.1 0 0 1-2.727-.762 4 4 0 0 1-.976-.826.9.9 0 0 1 .14-1.265Zm1.812-4.047a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0M15 11.5A1.25 1.25 0 1 0 15 9a1.25 1.25 0 0 0 0 2.5m-3-9.4c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9M3.9 12a8.1 8.1 0 1 1 16.2 0 8.1 8.1 0 0 1-16.2 0",clipRule:"evenodd"})})},405057:(e,t,s)=>{s.d(t,{Icon24StoryOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"story_outline_24",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M10.3 3h-.039C9.174 3 8.303 3 7.6 3.058c-.723.059-1.349.183-1.924.476a4.9 4.9 0 0 0-2.142 2.141c-.293.576-.418 1.202-.477 1.924C3 8.304 3 9.175 3 10.262v3.478c0 1.087 0 1.958.058 2.661.059.723.183 1.349.476 1.925a4.9 4.9 0 0 0 2.141 2.14c.576.294 1.202.419 1.924.478.704.057 1.575.057 2.662.057h3.478c1.087 0 1.958 0 2.661-.057.723-.06 1.349-.184 1.925-.477a4.9 4.9 0 0 0 2.14-2.141c.294-.576.419-1.202.478-1.925.057-.703.057-1.574.057-2.661v-3.478c0-1.087 0-1.958-.057-2.661-.06-.723-.184-1.349-.477-1.924a4.9 4.9 0 0 0-2.141-2.142c-.576-.293-1.202-.417-1.925-.476C15.697 3 14.826 3 13.74 3zM6.493 5.138c.28-.143.642-.236 1.253-.286C8.368 4.8 9.166 4.8 10.3 4.8h3.4c1.135 0 1.932 0 2.554.052.611.05.974.143 1.253.286a3.1 3.1 0 0 1 1.355 1.355c.143.28.237.642.287 1.253.05.622.051 1.42.051 2.554v3.4c0 1.135 0 1.932-.051 2.554-.05.611-.144.974-.287 1.253a3.1 3.1 0 0 1-1.355 1.355c-.28.143-.642.237-1.253.287-.622.05-1.419.051-2.554.051h-3.4c-1.135 0-1.932 0-2.554-.051-.611-.05-.974-.144-1.253-.287a3.1 3.1 0 0 1-1.355-1.355c-.143-.28-.236-.642-.286-1.253C4.8 15.632 4.8 14.835 4.8 13.7v-3.4c0-1.135 0-1.932.052-2.554.05-.611.143-.974.286-1.253a3.1 3.1 0 0 1 1.355-1.355M9.8 12a2.199 2.199 0 1 1 4.398 0A2.199 2.199 0 0 1 9.8 12M12 8.001a3.999 3.999 0 1 0 0 7.998 3.999 3.999 0 0 0 0-7.998",clipRule:"evenodd"})})},460643:(e,t,s)=>{s.d(t,{Icon24ViewOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"view_outline_24",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{d:"M12 4.6c5.2 0 10.4 4.237 10.4 7.4s-5.2 7.4-10.4 7.4S1.6 15.163 1.6 12 6.8 4.6 12 4.6m0 1.8c-4.278 0-8.6 3.522-8.6 5.6s4.322 5.6 8.6 5.6 8.6-3.522 8.6-5.6-4.322-5.6-8.6-5.6m0 2.2a3.4 3.4 0 1 1 0 6.8 3.4 3.4 0 0 1 0-6.8m0 1.8a1.6 1.6 0 1 0 0 3.2 1.6 1.6 0 0 0 0-3.2"})})},786570:(e,t,s)=>{s.d(t,{Icon28Like:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 28 28",width:28,height:28,vkuiIconId:"like_28",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",d:"M9.026 4.88A6.526 6.526 0 0 0 2.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 0 0 2.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 0 0-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88"})})},852621:(e,t,s)=>{s.d(t,{Icon28LikeOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 28 28",width:28,height:28,vkuiIconId:"like_outline_28",vkuiProps:e,children:(0,i.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,i.jsx)("path",{d:"M0 0h28v28H0z"}),(0,i.jsx)("path",{fill:"currentColor",fillRule:"nonzero",d:"M9.026 4.88A6.526 6.526 0 0 0 2.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 0 0 2.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 0 0-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88m0 2c1.52 0 2.889.858 4.152 2.683l.205.298a.75.75 0 0 0 1.234 0l.205-.298c1.263-1.825 2.633-2.683 4.152-2.683 2.5 0 4.526 2.027 4.526 4.526 0 2.78-1.137 4.204-6.721 8.547L14 22.114l-2.779-2.161C5.637 15.61 4.5 14.187 4.5 11.406c0-2.5 2.027-4.526 4.526-4.526"})]})})},366176:(e,t,s)=>{s.d(t,{Icon40PlayCircle:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 40 40",width:40,height:40,vkuiIconId:"play_circle_40",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M40 20c0 11.046-8.954 20-20 20S0 31.046 0 20 8.954 0 20 0s20 8.954 20 20m-14.329 1.077a1.25 1.25 0 0 0 0-2.154l-8.787-5.175A1.25 1.25 0 0 0 15 14.826v10.348a1.25 1.25 0 0 0 1.884 1.078z",clipRule:"evenodd"})})},576544:(e,t,s)=>{s.d(t,{Icon56CompassOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 56 56",width:56,height:56,vkuiIconId:"compass_outline_56",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsxs)("g",{fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd",children:[(0,i.jsx)("path",{d:"M36.92 21.208c.406-1.307-.82-2.534-2.127-2.128l-11.036 3.425a1.9 1.9 0 0 0-1.252 1.252L19.08 34.792c-.406 1.307.82 2.534 2.128 2.128l11.036-3.425a1.9 1.9 0 0 0 1.251-1.251zm-11.721 3.99 8.124-2.52L30.8 30.8l-8.124 2.522z"}),(0,i.jsx)("path",{d:"M52 28c0 13.255-10.745 24-24 24S4 41.255 4 28 14.745 4 28 4s24 10.745 24 24m-3 0c0 11.598-9.402 21-21 21S7 39.598 7 28 16.402 7 28 7s21 9.402 21 21"})]})})},586594:(e,t,s)=>{s.d(t,{Icon56ErrorOutline:()=>o});var i=s(474848),r=(s(296540),s(506447));const o=e=>(0,i.jsx)(r.SvgIconRootV2,{viewBox:"0 0 56 56",width:56,height:56,vkuiIconId:"error_outline_56",vkuiProps:e,children:(0,i.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,i.jsx)("path",{d:"M0 0h56v56H0z"}),(0,i.jsx)("path",{fill:"currentColor",fillRule:"nonzero",d:"M28 4c13.255 0 24 10.745 24 24S41.255 52 28 52 4 41.255 4 28 14.745 4 28 4m0 3C16.402 7 7 16.402 7 28s9.402 21 21 21 21-9.402 21-21S39.598 7 28 7m0 27a2 2 0 1 1 0 4 2 2 0 0 1 0-4m0-17.5a1.5 1.5 0 0 1 1.5 1.5v11l-.007.144A1.5 1.5 0 0 1 26.5 29V18l.007-.144A1.5 1.5 0 0 1 28 16.5"})]})})},77783:(e,t,s)=>{function i(e){return new Promise(((t,s)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>s(e.error)}))}function r(e,t){const s=indexedDB.open(e);s.onupgradeneeded=()=>s.result.createObjectStore(t);const r=i(s);return(e,s)=>r.then((i=>s(i.transaction(t,e).objectStore(t))))}let o;function a(){return o||(o=r("keyval-store","keyval")),o}function n(e,t=a()){return t("readonly",(t=>i(t.get(e))))}function c(e,t,s=a()){return s("readwrite",(s=>(s.put(t,e),i(s.transaction))))}function d(e,t,s=a()){return s("readwrite",(s=>new Promise(((r,o)=>{s.get(e).onsuccess=function(){try{s.put(t(this.result),e),r(i(s.transaction))}catch(e){o(e)}}}))))}function l(e,t=a()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function h(e=a()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}s.d(t,{clear:()=>h,createStore:()=>r,del:()=>l,get:()=>n,set:()=>c,update:()=>d})},202732:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(280702),r=s(41917);const o=(0,i.default)(r.default,"DataView")},965373:(e,t,s)=>{s.d(t,{default:()=>d});var i=s(962944),r=s(349190),o=s(178417),a=s(18813),n=s(463957);function c(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i.default,c.prototype.delete=r.default,c.prototype.get=o.default,c.prototype.has=a.default,c.prototype.set=n.default;const d=c},277919:(e,t,s)=>{s.d(t,{default:()=>d});var i=s(36838),r=s(362384),o=s(104787),a=s(898207),n=s(451031);function c(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i.default,c.prototype.delete=r.default,c.prototype.get=o.default,c.prototype.has=a.default,c.prototype.set=n.default;const d=c},168335:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(280702),r=s(41917);const o=(0,i.default)(r.default,"Map")},935917:(e,t,s)=>{s.d(t,{default:()=>d});var i=s(95088),r=s(829846),o=s(831521),a=s(782509),n=s(549);function c(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i.default,c.prototype.delete=r.default,c.prototype.get=o.default,c.prototype.has=a.default,c.prototype.set=n.default;const d=c},20180:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(280702),r=s(41917);const o=(0,i.default)(r.default,"Promise")},439857:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(280702),r=s(41917);const o=(0,i.default)(r.default,"Set")},93265:(e,t,s)=>{s.d(t,{default:()=>l});var i=s(277919),r=s(591532),o=s(42),a=s(173061),n=s(144105),c=s(487681);function d(e){var t=this.__data__=new i.default(e);this.size=t.size}d.prototype.clear=r.default,d.prototype.delete=o.default,d.prototype.get=a.default,d.prototype.has=n.default,d.prototype.set=c.default;const l=d},243988:(e,t,s)=>{s.d(t,{default:()=>i});const i=s(41917).default.Uint8Array},753631:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(280702),r=s(41917);const o=(0,i.default)(r.default,"WeakMap")},102634:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){for(var s=-1,i=null==e?0:e.length,r=0,o=[];++s<i;){var a=e[s];t(a,s,e)&&(o[r++]=a)}return o}},550423:(e,t,s)=>{s.d(t,{default:()=>l});var i=s(159520),r=s(241788),o=s(292049),a=s(74616),n=s(925353),c=s(118719),d=Object.prototype.hasOwnProperty;const l=function(e,t){var s=(0,o.default)(e),l=!s&&(0,r.default)(e),h=!s&&!l&&(0,a.default)(e),_=!s&&!l&&!h&&(0,c.default)(e),u=s||l||h||_,p=u?(0,i.default)(e.length,String):[],m=p.length;for(var v in e)!t&&!d.call(e,v)||u&&("length"==v||h&&("offset"==v||"parent"==v)||_&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||(0,n.default)(v,m))||p.push(v);return p}},976912:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){for(var s=-1,i=t.length,r=e.length;++s<i;)e[r+s]=t[s];return e}},652851:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(152528),r=s(166984),o=Object.prototype.hasOwnProperty;const a=function(e,t,s){var a=e[t];o.call(e,t)&&(0,r.default)(a,s)&&(void 0!==s||t in e)||(0,i.default)(e,t,s)}},210169:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(166984);const r=function(e,t){for(var s=e.length;s--;)if((0,i.default)(e[s][0],t))return s;return-1}},152528:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(684171);const r=function(e,t,s){"__proto__"==t&&i.default?(0,i.default)(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}},359712:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(523149),r=Object.create;const o=function(){function e(){}return function(t){if(!(0,i.default)(t))return{};if(r)return r(t);e.prototype=t;var s=new e;return e.prototype=void 0,s}}()},833831:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(976912),r=s(292049);const o=function(e,t,s){var o=t(e);return(0,r.default)(e)?o:(0,i.default)(o,s(e))}},974846:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(979672),r=s(753098);const o=function(e){return(0,r.default)(e)&&"[object Arguments]"==(0,i.default)(e)}},651979:(e,t,s)=>{s.d(t,{default:()=>u});var i=s(389610),r=s(870640),o=s(523149),a=s(281121),n=/^\[object .+?Constructor\]$/,c=Function.prototype,d=Object.prototype,l=c.toString,h=d.hasOwnProperty,_=RegExp("^"+l.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const u=function(e){return!(!(0,o.default)(e)||(0,r.default)(e))&&((0,i.default)(e)?_:n).test((0,a.default)(e))}},289717:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(979672),r=s(5254),o=s(753098),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1;const n=function(e){return(0,o.default)(e)&&(0,r.default)(e.length)&&!!a[(0,i.default)(e)]}},17064:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(897271),r=s(733938),o=Object.prototype.hasOwnProperty;const a=function(e){if(!(0,i.default)(e))return(0,r.default)(e);var t=[];for(var s in Object(e))o.call(e,s)&&"constructor"!=s&&t.push(s);return t}},708823:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(523149),r=s(897271),o=s(981493),a=Object.prototype.hasOwnProperty;const n=function(e){if(!(0,i.default)(e))return(0,o.default)(e);var t=(0,r.default)(e),s=[];for(var n in e)("constructor"!=n||!t&&a.call(e,n))&&s.push(n);return s}},159520:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){for(var s=-1,i=Array(e);++s<e;)i[s]=t(s);return i}},690565:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(243988);const r=function(e){var t=new e.constructor(e.byteLength);return new i.default(t).set(new i.default(e)),t}},180154:(e,t,s)=>{s.d(t,{default:()=>c});var i=s(41917),r="object"==typeof exports&&exports&&!exports.nodeType&&exports,o=r&&"object"==typeof module&&module&&!module.nodeType&&module,a=o&&o.exports===r?i.default.Buffer:void 0,n=a?a.allocUnsafe:void 0;const c=function(e,t){if(t)return e.slice();var s=e.length,i=n?n(s):new e.constructor(s);return e.copy(i),i}},801801:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(690565);const r=function(e,t){var s=t?(0,i.default)(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}},939759:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){var s=-1,i=e.length;for(t||(t=Array(i));++s<i;)t[s]=e[s];return t}},322031:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(652851),r=s(152528);const o=function(e,t,s,o){var a=!s;s||(s={});for(var n=-1,c=t.length;++n<c;){var d=t[n],l=o?o(s[d],e[d],d,s,e):void 0;void 0===l&&(l=e[d]),a?(0,r.default)(s,d,l):(0,i.default)(s,d,l)}return s}},113161:(e,t,s)=>{s.d(t,{default:()=>i});const i=s(41917).default["__core-js_shared__"]},684171:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(280702);const r=function(){try{var e=(0,i.default)(Object,"defineProperty");return e({},"",{}),e}catch(e){}}()},719042:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(833831),r=s(214792),o=s(327422);const a=function(e){return(0,i.default)(e,o.default,r.default)}},515547:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(649914);const r=function(e,t){var s=e.__data__;return(0,i.default)(t)?s["string"==typeof t?"string":"hash"]:s.map}},280702:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(651979),r=s(208104);const o=function(e,t){var s=(0,r.default)(e,t);return(0,i.default)(s)?s:void 0}},315647:(e,t,s)=>{s.d(t,{default:()=>i});const i=(0,s(40367).default)(Object.getPrototypeOf,Object)},214792:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(102634),r=s(613153),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols;const n=a?function(e){return null==e?[]:(e=Object(e),(0,i.default)(a(e),(function(t){return o.call(e,t)})))}:r.default},935861:(e,t,s)=>{s.d(t,{default:()=>w});var i=s(202732),r=s(168335),o=s(20180),a=s(439857),n=s(753631),c=s(979672),d=s(281121),l="[object Map]",h="[object Promise]",_="[object Set]",u="[object WeakMap]",p="[object DataView]",m=(0,d.default)(i.default),v=(0,d.default)(r.default),g=(0,d.default)(o.default),f=(0,d.default)(a.default),y=(0,d.default)(n.default),S=c.default;(i.default&&S(new i.default(new ArrayBuffer(1)))!=p||r.default&&S(new r.default)!=l||o.default&&S(o.default.resolve())!=h||a.default&&S(new a.default)!=_||n.default&&S(new n.default)!=u)&&(S=function(e){var t=(0,c.default)(e),s="[object Object]"==t?e.constructor:void 0,i=s?(0,d.default)(s):"";if(i)switch(i){case m:return p;case v:return l;case g:return h;case f:return _;case y:return u}return t});const w=S},208104:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){return null==e?void 0:e[t]}},962944:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(220674);const r=function(){this.__data__=i.default?(0,i.default)(null):{},this.size=0}},349190:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},178417:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(220674),r=Object.prototype.hasOwnProperty;const o=function(e){var t=this.__data__;if(i.default){var s=t[e];return"__lodash_hash_undefined__"===s?void 0:s}return r.call(t,e)?t[e]:void 0}},18813:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(220674),r=Object.prototype.hasOwnProperty;const o=function(e){var t=this.__data__;return i.default?void 0!==t[e]:r.call(t,e)}},463957:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(220674);const r=function(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=i.default&&void 0===t?"__lodash_hash_undefined__":t,this}},632729:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(359712),r=s(315647),o=s(897271);const a=function(e){return"function"!=typeof e.constructor||(0,o.default)(e)?{}:(0,i.default)((0,r.default)(e))}},925353:(e,t,s)=>{s.d(t,{default:()=>r});var i=/^(?:0|[1-9]\d*)$/;const r=function(e,t){var s=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==s||"symbol"!=s&&i.test(e))&&e>-1&&e%1==0&&e<t}},649914:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},870640:(e,t,s)=>{s.d(t,{default:()=>a});var i,r=s(113161),o=(i=/[^.]+$/.exec(r.default&&r.default.keys&&r.default.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";const a=function(e){return!!o&&o in e}},897271:(e,t,s)=>{s.d(t,{default:()=>r});var i=Object.prototype;const r=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||i)}},36838:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(){this.__data__=[],this.size=0}},362384:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(210169),r=Array.prototype.splice;const o=function(e){var t=this.__data__,s=(0,i.default)(t,e);return!(s<0)&&(s==t.length-1?t.pop():r.call(t,s,1),--this.size,!0)}},104787:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(210169);const r=function(e){var t=this.__data__,s=(0,i.default)(t,e);return s<0?void 0:t[s][1]}},898207:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(210169);const r=function(e){return(0,i.default)(this.__data__,e)>-1}},451031:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(210169);const r=function(e,t){var s=this.__data__,r=(0,i.default)(s,e);return r<0?(++this.size,s.push([e,t])):s[r][1]=t,this}},95088:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(965373),r=s(277919),o=s(168335);const a=function(){this.size=0,this.__data__={hash:new i.default,map:new(o.default||r.default),string:new i.default}}},829846:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(515547);const r=function(e){var t=(0,i.default)(this,e).delete(e);return this.size-=t?1:0,t}},831521:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(515547);const r=function(e){return(0,i.default)(this,e).get(e)}},782509:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(515547);const r=function(e){return(0,i.default)(this,e).has(e)}},549:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(515547);const r=function(e,t){var s=(0,i.default)(this,e),r=s.size;return s.set(e,t),this.size+=s.size==r?0:1,this}},220674:(e,t,s)=>{s.d(t,{default:()=>i});const i=(0,s(280702).default)(Object,"create")},733938:(e,t,s)=>{s.d(t,{default:()=>i});const i=(0,s(40367).default)(Object.keys,Object)},981493:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){var t=[];if(null!=e)for(var s in Object(e))t.push(s);return t}},40367:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){return function(s){return e(t(s))}}},591532:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(277919);const r=function(){this.__data__=new i.default,this.size=0}},42:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}},173061:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){return this.__data__.get(e)}},144105:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){return this.__data__.has(e)}},487681:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(277919),r=s(168335),o=s(935917);const a=function(e,t){var s=this.__data__;if(s instanceof i.default){var a=s.__data__;if(!r.default||a.length<199)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new o.default(a)}return s.set(e,t),this.size=s.size,this}},281121:(e,t,s)=>{s.d(t,{default:()=>r});var i=Function.prototype.toString;const r=function(e){if(null!=e){try{return i.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},657697:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(818593);const r=function(e,t){var s;if("function"!=typeof t)throw new TypeError("Expected a function");return e=(0,i.default)(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=void 0),s}}},166984:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e,t){return e===t||e!=e&&t!=t}},241788:(e,t,s)=>{s.d(t,{default:()=>c});var i=s(974846),r=s(753098),o=Object.prototype,a=o.hasOwnProperty,n=o.propertyIsEnumerable;const c=(0,i.default)(function(){return arguments}())?i.default:function(e){return(0,r.default)(e)&&a.call(e,"callee")&&!n.call(e,"callee")}},238446:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(389610),r=s(5254);const o=function(e){return null!=e&&(0,r.default)(e.length)&&!(0,i.default)(e)}},74616:(e,t,s)=>{s.d(t,{default:()=>c});var i=s(41917),r=s(624639),o="object"==typeof exports&&exports&&!exports.nodeType&&exports,a=o&&"object"==typeof module&&module&&!module.nodeType&&module,n=a&&a.exports===o?i.default.Buffer:void 0;const c=(n?n.isBuffer:void 0)||r.default},389610:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(979672),r=s(523149);const o=function(e){if(!(0,r.default)(e))return!1;var t=(0,i.default)(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},5254:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},118719:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(289717),r=s(552789),o=s(364841),a=o.default&&o.default.isTypedArray;const n=a?(0,r.default)(a):i.default},327422:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(550423),r=s(17064),o=s(238446);const a=function(e){return(0,o.default)(e)?(0,i.default)(e):(0,r.default)(e)}},241865:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(550423),r=s(708823),o=s(238446);const a=function(e){return(0,o.default)(e)?(0,i.default)(e,!0):(0,r.default)(e)}},33371:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(657697);const r=function(e){return(0,i.default)(2,e)}},613153:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(){return[]}},624639:(e,t,s)=>{s.d(t,{default:()=>i});const i=function(){return!1}},203080:(e,t,s)=>{function i(e){let t=function(e){let{PI:t,min:s,max:i,cos:r,round:o}=Math,a=e[0]|e[1]<<8|e[2]<<16,n=e[3]|e[4]<<8,c=(63&a)/63,d=(a>>6&63)/31.5-1,l=(a>>12&63)/31.5-1,h=(a>>18&31)/31,_=a>>23,u=(n>>3&63)/63,p=(n>>9&63)/63,m=n>>15,v=i(3,m?_?5:7:7&n),g=i(3,m?7&n:_?5:7),f=_?(15&e[5])/15:1,y=(e[5]>>4)/15,S=_?6:5,w=0,b=(t,s,i)=>{let r=[];for(let o=0;o<s;o++)for(let a=o?0:1;a*s<t*(s-o);a++)r.push(((e[S+(w>>1)]>>((1&w++)<<2)&15)/7.5-1)*i);return r},k=b(v,g,h),E=b(3,3,1.25*u),C=b(3,3,1.25*p),I=_&&b(5,5,y),T=function(e){let t=e[3],s=128&e[2],i=128&e[4];return(i?s?5:7:7&t)/(i?7&t:s?5:7)}(e),L=o(T>1?32:32*T),M=o(T>1?32/T:32),A=new Uint8Array(L*M*4),x=[],P=[];for(let e=0,o=0;e<M;e++)for(let a=0;a<L;a++,o+=4){let n=c,h=d,u=l,p=f;for(let e=0,s=i(v,_?5:3);e<s;e++)x[e]=r(t/L*(a+.5)*e);for(let s=0,o=i(g,_?5:3);s<o;s++)P[s]=r(t/M*(e+.5)*s);for(let e=0,t=0;e<g;e++)for(let s=e?0:1,i=2*P[e];s*g<v*(g-e);s++,t++)n+=k[t]*x[s]*i;for(let e=0,t=0;e<3;e++)for(let s=e?0:1,i=2*P[e];s<3-e;s++,t++){let e=x[s]*i;h+=E[t]*e,u+=C[t]*e}if(_)for(let e=0,t=0;e<5;e++)for(let s=e?0:1,i=2*P[e];s<5-e;s++,t++)p+=I[t]*x[s]*i;let m=n-2/3*h,y=(3*n-m+u)/2,S=y-u;A[o]=i(0,255*s(1,y)),A[o+1]=i(0,255*s(1,S)),A[o+2]=i(0,255*s(1,m)),A[o+3]=i(0,255*s(1,p))}return{w:L,h:M,rgba:A}}(e);return function(e,t,s){let i=4*e+1,r=6+t*(5+i),o=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,255&e,0,0,t>>8,255&t,8,6,0,0,0,0,0,0,0,r>>>24,r>>16&255,r>>8&255,255&r,73,68,65,84,120,1],a=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],n=1,c=0;for(let e=0,r=0,a=i-1;e<t;e++,a+=i-1)for(o.push(e+1<t?0:1,255&i,i>>8,255&~i,i>>8^255,0),c=(c+n)%65521;r<a;r++){let e=255&s[r];o.push(e),n=(n+e)%65521,c=(c+n)%65521}o.push(c>>8,255&c,n>>8,255&n,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[e,t]of[[12,29],[37,41+r]]){let s=-1;for(let i=e;i<t;i++)s^=o[i],s=s>>>4^a[15&s],s=s>>>4^a[15&s];s=~s,o[t++]=s>>>24,o[t++]=s>>16&255,o[t++]=s>>8&255,o[t++]=255&s}return"data:image/png;base64,"+btoa(String.fromCharCode(...o))}(t.w,t.h,t.rgba)}s.d(t,{thumbHashToDataURL:()=>i})}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.loaded=!0,s.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,s,i)=>{if(!t){var r=1/0;for(c=0;c<deferred.length;c++){for(var[t,s,i]=deferred[c],o=!0,a=0;a<t.length;a++)(!1&i||r>=i)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[a])))?t.splice(a--,1):(o=!1,i<r&&(r=i));if(o){deferred.splice(c--,1);var n=s();void 0!==n&&(e=n)}}return e}i=i||0;for(var c=deferred.length;c>0&&deferred[c-1][2]>i;c--)deferred[c]=deferred[c-1];deferred[c]=[t,s,i]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var s=Object.create(null);__webpack_require__.r(s);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&t&&e;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,__webpack_require__.d(s,i),s},__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,s)=>(__webpack_require__.f[s](e,t),t)),[])),__webpack_require__.u=e=>22081===e?"web/chunks/24b1ff74.async.ce45415c.js":51915===e?"web/chunks/0237bd22.async.018ce4c1.js":18624===e?"web/chunks/3285fd7d.async.635597ef.js":64007===e?"web/chunks/acb14247.async.95ee4cdd.js":36943===e?"web/chunks/b8ca2caf.async.e8c7c264.js":76573===e?"web/chunks/2f5bcbf8.async.b5bb275d.js":98897===e?"web/chunks/34566482.async.a228f4bf.js":57859===e?"web/chunks/15877459.async.7e9160d5.js":70715===e?"web/chunks/f70c08bb.async.d3181062.js":20089===e?"web/chunks/31025993.async.188a660a.js":6827===e?"web/chunks/podcasts_web.7b353ecc.js":96851===e?"web/chunks/bee66b22.async.f83a167a.js":95698===e?"web/chunks/2cb3ca65.async.fe6b01ed.js":88651===e?"web/chunks/bookmarkClipPost.29e87f32.js":61037===e?"web/chunks/grip-lib.e290cff5.js":24639===e?"web/chunks/plugins_maps_mmrgl_script_chunk.e5fd914b.js":30685===e?"web/chunks/plugins_maps_mmrgl_style_chunk.961eadc7.js":8870===e?"web/chunks/hls_lib.c0100db1.js":60712===e?"web/chunks/dae511d8.async.49386649.js":96050===e?"web/chunks/e4dd12c8.async.c5745238.js":69285===e?"web/chunks/305139c6.async.967971c0.js":27392===e?"web/chunks/9b1ce1a1.async.1f388dce.js":54462===e?"web/chunks/950fb940.async.da4ef98a.js":89433===e?"web/chunks/c87a1172.async.46f9ef07.js":42885===e?"web/chunks/f940ca6a.async.e4ccb1c0.js":34190===e?"web/chunks/audio_config_legacy.9cd2419b.js":82438===e?"web/chunks/audio_config_audioAdvertisingBannerViewModelProvider.8cb967b6.js":18586===e?"web/chunks/audio_config_overrides.eb155c4d.js":28365===e?"web/chunks/749b661c.async.80d91e90.js":98271===e?"web/chunks/audio_web_globalPlayerImpl.f94e09df.js":75466===e?"web/chunks/642a4b04.async.e8d1ebf7.js":37310===e?"web/chunks/8a0e825b.async.5a82c050.js":34770===e?"web/chunks/6236df4b.async.37527616.js":21589===e?"web/chunks/321e636f.async.25760e30.js":84835===e?"web/chunks/unauth_action_box.b2d9a4a0.js":30072===e?"web/chunks/showCaptchaPopup.4a5f24ea.js":51490===e?"web/chunks/showCaptchaSDK.a83f17a0.js":35285===e?"web/chunks/eb8ac05b.async.1bf4bbf7.js":77312===e?"web/chunks/3824b17d.async.a378a5c5.js":22801===e?"web/chunks/db3c5e15.async.4f1fdf4b.js":13542===e?"web/chunks/nav.93b3ab91.js":19072===e?"web/chunks/left_menu_store.9f099394.js":6694===e?"web/chunks/menu_settings.c5e1ef91.js":81399===e?"web/chunks/threads-es.ce40a11c.js":5375===e?"web/chunks/93d4eaf6.async.2f14edfa.js":44484===e?"web/chunks/5db42b40.async.15d03fbf.js":29e3===e?"web/chunks/cdac2895.async.5deaf866.js":94220===e?"web/chunks/03a98e38.async.85e3cff9.js":59933===e?"web/chunks/ReportMiniApp.7e02563c.js":66434===e?"web/chunks/ReportsProfileModal.c69f4e97.js":99595===e?"web/chunks/ReportForm.05c3a797.js":73214===e?"web/chunks/SilentModeForms.03437c14.js":97126===e?"web/chunks/WebDI.f301a714.js":14801===e?"web/chunks/WebLayers.135b788f.js":38302===e?"web/chunks/71806bb9.async.d12c656b.js":58020===e?"web/chunks/f7f88f40.async.16f43294.js":17102===e?"web/chunks/3b42c1ea.async.5f4d6d48.js":79934===e?"web/chunks/e4ca2309.async.9b62ada8.js":51943===e?"web/chunks/VideoUpload.a163b3a9.js":9397===e?"web/chunks/7ac15393.async.4f8568b4.js":96025===e?"web/chunks/e03e4ed2.async.d9c8fe47.js":87108===e?"web/chunks/98b8e735.async.6177099d.js":1071===e?"web/chunks/d3d91b63.async.f8a2bc87.js":31325===e?"web/chunks/1e8b9645.async.c44dc075.js":14262===e?"web/chunks/3a0fa345.async.d001c53f.js":80178===e?"web/chunks/2245988e.async.3d53c07d.js":1093===e?"web/chunks/10c1fbfa.async.9f6277a4.js":7743===e?"web/chunks/a73cb6dd.async.8f58638e.js":94781===e?"web/chunks/3c5e0eda.async.01b3cb30.js":57220===e?"web/chunks/0152aa47.async.21d8a853.js":15642===e?"web/chunks/6d651364.async.8e717800.js":83521===e?"web/chunks/7f6c5089.async.650a28c1.js":10275===e?"web/chunks/bec0e41d.async.72955160.js":63836===e?"web/chunks/MessengerClipsModal.93dadb52.js":82365===e?"web/chunks/gifts-open-gifts-catalog.b4ed4469.js":10190===e?"web/chunks/0eb063da.async.de14f96f.js":68425===e?"web/chunks/sticker-gift-modal-legacy.3c78bc02.js":19822===e?"web/chunks/4ead78dd.async.bdb6ec85.js":52007===e?"web/chunks/gift-modal-legacy.994f64a6.js":94160===e?"web/chunks/75f64ad0.async.06f64f4b.js":36502===e?"web/chunks/NewStickerPicker.f4fb39e2.js":12334===e?"web/chunks/stories-perf-metrics.0c2b96ce.js":12477===e?"web/chunks/OnboardingTooltipMarker-1.8b4efdb3.js":25126===e?"web/chunks/OnboardingTooltipMarker-2.82800be7.js":89519===e?"web/chunks/OnboardingTooltipMarker-3.2f93e038.js":80496===e?"web/chunks/OnboardingTooltipMarker-4.ea0bbc95.js":93305===e?"web/chunks/OnboardingTooltipMarker-5.f7e7d7db.js":6114===e?"web/chunks/OnboardingTooltipMarker-6.48d9f311.js":23666===e?"web/chunks/rlottie.487c959e.js":81652===e?"web/chunks/b962db66.async.1ba8f7cd.js":21904===e?"web/chunks/8dd4eacf.async.9ae66f77.js":52731===e?"web/chunks/stickers-layer-view.56dc0175.js":16846===e?"web/chunks/stickers-layer-purchase-details-view.b984e679.js":64273===e?"web/chunks/stickers-random-selector-view.5ae4a1ca.js":12318===e?"web/chunks/stickers-random-selector-packs-view.313e785a.js":71409===e?"web/chunks/stickers-random-selector-result-view.4cd602e7.js":25153===e?"web/chunks/"+e+".35b53cd8.js":18562===e?"web/chunks/"+e+".1e04ee91.js":65852===e?"web/chunks/7a162ebe.async.4c3022d4.js":90874===e?"web/chunks/"+e+".2ac3b8fc.js":25817===e?"web/chunks/"+e+".90f724a2.js":92105===e?"web/chunks/"+e+".a81879ec.js":47135===e?"web/chunks/audio_onMediaAttachmentPlayer.a51b33a8.js":69240===e?"web/chunks/audio_postingPlayer.31dc02eb.js":73538===e?"web/chunks/video_restore_button.c577f7d1.js":2163===e?"web/chunks/897797b7.async.925bd316.js":25700===e?"web/chunks/narratives_boxes.acc4b4d7.js":74558===e?"web/chunks/NarrativesListModelOpenService.a7395a02.js":14545===e?"web/chunks/e605e28e.async.e2c9f10f.js":7919===e?"web/chunks/adcd3fe8.async.c61a2fbb.js":16729===e?"web/chunks/68797ba6.async.a541069d.js":48296===e?"web/chunks/aa9a4412.async.aad8157b.js":88293===e?"web/chunks/0234490b.async.ad81b610.js":36===e?"web/chunks/fbd8fb30.async.c4a9ccc1.js":75908===e?"web/chunks/6016368a.async.65d8c846.js":16131===e?"web/chunks/aaf29586.async.393e97a4.js":33641===e?"web/chunks/audio_modals_MusicTrackList.08e2a1ca.js":1715===e?"web/chunks/AudioLongtapModal.ed3a9f5f.js":4871===e?"web/chunks/web_audio_AnyAudioLegacyService.7ff821ce.js":26731===e?"web/chunks/im_chat_preview.fb1c72cd.js":62229===e?"web/chunks/z_nav.a3696b2c.js":20781===e?"web/chunks/tutorial.b826ca3e.js":50453===e?"web/chunks/web_nav_AudioPlayer.5127a502.js":42255===e?"web/chunks/wikiModalExampleInitiator.0d6394c9.js":45055===e?"web/chunks/8a71e637.async.b3e7bbcb.js":56965===e?"web/chunks/stories_web_lib.ab663077.js":53927===e?"web/chunks/questions_boxes_web.ed4d239d.js":74336===e?"web/chunks/show_audio_playlist.12a42d75.js":22095===e?"web/chunks/6bbb4482.async.b165e220.js":88871===e?"web/chunks/7031c93b.async.80a5e56d.js":90417===e?"web/chunks/f80a1484.async.2d4d6374.js":39692===e?"web/chunks/2b6d6bdc.async.2533a993.js":10774===e?"web/chunks/show_attachment_audio_list.1c422830.js":17895===e?"web/chunks/money_transfer_box.2625a47e.js":50905===e?"web/chunks/money_transfer.af174bfd.js":2166===e?"web/chunks/showDonutSubscriptionModal.3c915577.js":4752===e?"web/chunks/c4851f31.async.0d56331f.js":29311===e?"web/chunks/feed-client-nav-skeleton.e75a1812.js":56091===e?"web/chunks/feed-client-nav-async-right-block.d99401bf.js":43451===e?"web/chunks/MiniAppService_MiniApp.613f9887.js":36182===e?"web/chunks/66a232f7.async.38f278f5.js":96374===e?"web/chunks/storyPublisher.696922ba.js":5333===e?"web/chunks/stories-editor-fonts.5cff632e.js":99370===e?"web/chunks/VideoEditorModal.ff45b8d8.js":85596===e?"web/chunks/34335d63.async.8fefb69b.js":75090===e?"web/chunks/video_upload_modal.c9a1da9e.js":95805===e?"web/chunks/PublishClipToVideoModal.91f42aba.js":73509===e?"web/chunks/sharedVideoUploadState.3e6090c3.js":91906===e?"web/chunks/VideoUploadModal.8ad02bc6.js":74205===e?"web/chunks/VideoExternalUploadModal.112c720c.js":14608===e?"web/chunks/bf0af950.async.e62a161c.js":36637===e?"web/chunks/ClipUploadModal.c1a46779.js":18493===e?"web/chunks/AddClipToVideoBlock.55c4bf1a.js":56099===e?"web/chunks/OpenNewVideoEditorButton.28514d92.js":50756===e?"web/chunks/sticker.de3a87c6.js":84714===e?"web/chunks/91e20a01.async.04441211.js":43162===e?"web/chunks/framer-motion-entrypoint.e7eaa013.js":2076===e?"web/chunks/1c4b5a5b.async.03b4a56b.js":71992===e?"web/chunks/95dd234f.async.bd143eb0.js":43403===e?"web/chunks/bb6fffaa.async.94a0475d.js":73238===e?"web/chunks/40de4f00.async.e536ee45.js":99056===e?"web/chunks/VideoShareModal.b795352f.js":87352===e?"web/chunks/c3bbb773.async.7218126f.js":91193===e?"web/chunks/ee2b7e73.async.bf90e623.js":88386===e?"web/chunks/gifts-catalog-modal-legacy.721e7795.js":7894===e?"web/chunks/StickersKit-AgeRestrictionModal.b21151e0.js":40966===e?"web/chunks/audio_modals_AudioForbiddance.ade3fe06.js":54833===e?"web/chunks/performance-stats.051b6238.js":9635===e?"web/chunks/9635.8d8ecbdf.js":55475===e?"web/chunks/407d3781.async.10400d85.js":14407===e?"web/chunks/ddac83eb.async.4255c7e8.js":35656===e?"web/chunks/aae5a8aa.async.0d8c8226.js":71011===e?"web/chunks/4f2708c4.async.4b2c13a1.js":32643===e?"web/chunks/story_blocks.b7a6bcc8.js":38308===e?"web/chunks/mvk-logout-modal.7d335980.js":37933===e?"web/chunks/33d96328.async.188e2488.js":82375===e?"web/chunks/3472d578.async.c8697663.js":85829===e?"web/chunks/7ed679fd.async.f71785ce.js":50915===e?"web/chunks/stories-creator-legacy-modal.9f3d41b7.js":56560===e?"web/chunks/CreateVideoChannelModal.2cc0c85b.js":8559===e?"web/chunks/ExitConfirmationModal.697af2aa.js":40953===e?"web/chunks/AddClipToVideoModal.f92debb1.js":60274===e?"web/chunks/ClipPlayerModule.320862e1.js":22698===e?"web/chunks/web_index.17e54bf4.js":76376===e?"web/chunks/renderPlayerOverlay.d4a70be4.js":64713===e?"web/chunks/"+e+".27a42353.js":23922===e?"web/chunks/"+e+".b3b19622.js":16067===e?"web/chunks/HintModal.77684fb3.js":76849===e?"web/chunks/6270a006.async.638ce0ba.js":96912===e?"web/chunks/3caf44bd.async.72aa3b24.js":13520===e?"web/chunks/b6bddc97.async.6f6d4d4d.js":82321===e?"web/chunks/LiveStatsModal.954261ee.js":84616===e?"web/chunks/StopLiveModal.391a730f.js":75846===e?"web/chunks/14e762e7.async.7f99f547.js":7651===e?"web/chunks/a93f3a47.async.a41135a7.js":32759===e?"web/chunks/AddToChannelModal.0412ee40.js":79894===e?"web/chunks/53684908.async.458717a1.js":93617===e?"web/chunks/LiveSettingsModal.b55cfacc.js":94515===e?"web/chunks/c908b95b.async.965bbede.js":55631===e?"web/chunks/SubscriptionModal.9c57de23.js":2408===e?"web/chunks/MusicShareModal.25f328df.js":84630===e?"web/chunks/MusicUnauthModal.744774d8.js":9994===e?"web/chunks/HTMLToImage.b391ad22.js":59039===e?"web/chunks/audio_mobile_globalPlayerImpl.9a83c43c.js":71393===e?"web/chunks/stories-creator-ord-app.fbe498ae.js":97895===e?"chunks/"+e+".18fa9d48.js":75477===e?"chunks/"+e+".2ff50533.js":30420===e?"chunks/"+e+".8b6ae694.js":"web/chunks/videoplayer-interactive.64323fe3.js",__webpack_require__.miniCssF=e=>({6827:1,18586:1,98271:1}[e]?"web/chunks/9f1d8ffd.css":30685===e?"web/chunks/d5a750da.css":{84835:1,22698:1,84630:1}[e]?"web/chunks/879b64d4.css":30072===e?"web/chunks/6dfda48d.css":6694===e?"web/chunks/e866bb9e.css":{59933:1,55631:1}[e]?"web/chunks/0268316e.css":66434===e?"web/chunks/f11dbb2f.css":99595===e?"web/chunks/9791d4ce.css":73214===e?"web/chunks/06964372.css":51943===e?"web/chunks/afb5d2d5.css":63836===e?"web/chunks/b9ef27b2.css":68425===e?"web/chunks/0c8c447f.css":52007===e?"web/chunks/2175c5a6.css":36502===e?"web/chunks/3230b445.css":23666===e?"web/chunks/e600429c.css":52731===e?"web/chunks/df40e85d.css":16846===e?"web/chunks/72f110db.css":64273===e?"web/chunks/aaf8817d.css":12318===e?"web/chunks/b16e8aec.css":71409===e?"web/chunks/6c796306.css":33641===e?"web/chunks/1bdac0bd.css":1715===e?"web/chunks/bc991442.css":{29311:1,56091:1}[e]?"web/chunks/bab20ffc.css":5333===e?"web/chunks/d05ec3bc.css":99370===e?"web/chunks/de279249.css":75090===e?"web/chunks/e5a245a8.css":95805===e?"web/chunks/78e1dd9d.css":73509===e?"web/chunks/d4b0dd83.css":{91906:1,74205:1}[e]?"web/chunks/1b17a7df.css":36637===e?"web/chunks/8b29a3ee.css":18493===e?"web/chunks/f84a06b6.css":50756===e?"web/chunks/a37ed021.css":99056===e?"web/chunks/7630872b.css":88386===e?"web/chunks/18a0d245.css":7894===e?"web/chunks/9e9b513b.css":40966===e?"web/chunks/bfb37ed0.css":32643===e?"web/chunks/3a629fad.css":38308===e?"web/chunks/706e8e64.css":50915===e?"web/chunks/473b0504.css":40953===e?"web/chunks/3f1528d1.css":60274===e?"web/chunks/48d69d56.css":76376===e?"web/chunks/92d01dc8.css":82321===e?"web/chunks/ae24e4bc.css":32759===e?"web/chunks/5f480b04.css":93617===e?"web/chunks/884ded26.css":71393===e?"web/chunks/871d8d85.css":void 0),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,s,i)=>{if(inProgress[e])inProgress[e].push(t);else{var r,o;if(void 0!==s)for(var a=document.getElementsByTagName("script"),n=0;n<a.length;n++){var c=a[n];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")=="vk:"+s){r=c;break}}r||(o=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,__webpack_require__.nc&&r.setAttribute("nonce",__webpack_require__.nc),r.setAttribute("data-webpack","vk:"+s),r.src=e),inProgress[e]=[t];var d=(t,s)=>{r.onerror=r.onload=null,clearTimeout(l);var i=inProgress[e];if(delete inProgress[e],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach((e=>e(s))),t)return t(s)},l=setTimeout(d.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=d.bind(null,r.onerror),r.onload=d.bind(null,r.onload),o&&document.head.appendChild(r)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",(()=>{if(void 0!==__webpack_require__){var e=__webpack_require__.u,t=__webpack_require__.e,s={},i={};__webpack_require__.u=function(t){return e(t)+(s.hasOwnProperty(t)?"?"+s[t]:"")},__webpack_require__.e=function(r){return t(r).catch((function(t){var o=i.hasOwnProperty(r)?i[r]:3;if(o<1){var a=e(r);throw t.message="Loading chunk "+r+" failed after 3 retries.\n("+a+")",t.request=a,t}return new Promise((function(e){var t,a=3-o+1;setTimeout((function(){var t="cache-bust=true"+("&retry-attempt="+a);s[r]=t,i[r]=o-1,e(__webpack_require__.e(r))}),(t=a,1e3*Math.pow(3,t)))}))}))}}})(),(()=>{if("undefined"!=typeof document){var e=e=>new Promise(((t,s)=>{var i=__webpack_require__.miniCssF(e),r=__webpack_require__.p+i;if(((e,t)=>{for(var s=document.getElementsByTagName("link"),i=0;i<s.length;i++){var r=(a=s[i]).getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(r===e||r===t))return a}var o=document.getElementsByTagName("style");for(i=0;i<o.length;i++){var a;if((r=(a=o[i]).getAttribute("data-href"))===e||r===t)return a}})(i,r))return t();((e,t,s,i,r)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",__webpack_require__.nc&&(o.nonce=__webpack_require__.nc),o.onerror=o.onload=s=>{if(o.onerror=o.onload=null,"load"===s.type)i();else{var a=s&&s.type,n=s&&s.target&&s.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+n+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=n,o.parentNode&&o.parentNode.removeChild(o),r(c)}},o.href=t,s?s.parentNode.insertBefore(o,s.nextSibling):document.head.appendChild(o)})(e,r,null,t,s)})),t={56357:0};__webpack_require__.f.miniCss=(s,i)=>{t[s]?i.push(t[s]):0!==t[s]&&{1715:1,5333:1,6694:1,6827:1,7894:1,12318:1,16846:1,18493:1,18586:1,22698:1,23666:1,29311:1,30072:1,30685:1,32643:1,32759:1,33641:1,36502:1,36637:1,38308:1,40953:1,40966:1,50756:1,50915:1,51943:1,52007:1,52731:1,55631:1,56091:1,59933:1,60274:1,63836:1,64273:1,66434:1,68425:1,71393:1,71409:1,73214:1,73509:1,74205:1,75090:1,76376:1,82321:1,84630:1,84835:1,88386:1,91906:1,93617:1,95805:1,98271:1,99056:1,99370:1,99595:1}[s]&&i.push(t[s]=e(s).then((()=>{t[s]=0}),(e=>{throw delete t[s],e})))}}})(),(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={56357:0};__webpack_require__.f.j=(t,s)=>{var i=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else if(/^(1(0(190|275|71|774|93)|2(318|334|477)|35(20|42)|4(262|407|545|608|801|925)|6(067|131|729|846)|7(102|15|356|895)|8(493|562|586|624|680)|(564|907|982)2)|2(0(04|089|76|781)|1(529|589|63|66|904)|2(081|095|698|801)|3(592|666|922)|5(126|153|700|817)|408|4639|6731|7392|8365|9000|9311)|3(6(|182|502|637|943)|830[28]|(068|132|528)5|(419|477|731)0|0072|2643|2759|3641|5656|7933|9692)|4(09(53|66)|3(162|403|451)|7(135|52|582)|(225|288|505)5|4484|8296|871)|5(0(453|560|756|905|915)|1(490|915|943)|3(33|75|927)|6(09[19]|357|560|965)|(27|56)31|(48|99)33|(72|80)20|2007|4462|5475|7859|9039)|6(0(077|274|712)|4(007|273|713)|92(40|85)|(11|643|69)4|1037|2229|2791|3616|3836|5852|827|8425)|7(1(011|393|409|992)|3([25]38|214|509)|4(205|336|558)|5(090|466|846|908)|6(2|376|51|573|849)|9(19|210|894|934)|0380|0715|2754|7312|743|894)|8(1(248|399|652)|2(3(21|65|75)|438)|4(616|630|714|835)|5(59(|6)|172|829)|8(293|386|651|70|871)|9(433|519|631|887)|0178|0496|3521|3741|7108|7352)|9(1(193|498|906)|3(305|617|97)|4(160|220|515|781)|6(025|050|35|374|851|912)|9(056|370|595|94)|(21|58)05|0417|0874|5698|7126|8271|8897))$/.test(t)){var r=new Promise(((s,r)=>i=e[t]=[s,r]));s.push(i[2]=r);var o=__webpack_require__.p+__webpack_require__.u(t),a=new Error;__webpack_require__.l(o,(s=>{if(__webpack_require__.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,i[1](a)}}),"chunk-"+t,t)}else e[t]=0},__webpack_require__.O.j=t=>0===e[t];var t=(t,s)=>{var i,r,[o,a,n]=s,c=0;if(o.some((t=>0!==e[t]))){for(i in a)__webpack_require__.o(a,i)&&(__webpack_require__.m[i]=a[i]);if(n)var d=n(__webpack_require__)}for(t&&t(s);c<o.length;c++)r=o[c],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return __webpack_require__.O(d)},s=self.webpackChunkvkweb=self.webpackChunkvkweb||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),(()=>{var e={},t={podcasts_web:"2aff0688e476525d",bookmarkClipPost:"f980fda40f715b2d",WebDI:"71122bffaa4f74c1",audio_config_legacy:"d45e6db72f23b09d",audio_config_overrides:"973d2e8046cab47e",audio_web_globalPlayerImpl:"f60581a0b0df2bf4",unauth_action_box:"537f133472cf5648",showCaptchaPopup:"efc84820ed8bb89c",showCaptchaSDK:"722622a930e4653e",nav:"15cd3e3c3fed1207",left_menu_store:"c9eed939813f6cda",menu_settings:"a8f4f383337e5768",ReportMiniApp:"2188a4bfd06d1e7c",ReportsProfileModal:"23579a018d596229",ReportForm:"f3854745714580bd",SilentModeForms:"c62172e8ae356a01",VideoUpload:"5e66e4acd3142b13",MessengerClipsModal:"6d747a1bcbb1e7de",storyPublisher:"ed9421807a6b4284","gifts-open-gifts-catalog":"0e81b7cdae451ee5",wikiModalExampleInitiator:"be30e82edc1853fe",stories_web_lib:"b1d2f13174001e86",show_audio_playlist:"d43416e3e424607e",show_attachment_audio_list:"124f8ba830be7230",money_transfer_box:"ef69c4589df71bb0",money_transfer:"899fd68cc954af25","sticker-gift-modal-legacy":"a980835792b72277","gift-modal-legacy":"5746246ae20fed8b","feed-client-nav-skeleton":"56ba9b41383f23ed","feed-client-nav-async-right-block":"56ba9b41383f23ed",audio_modals_MusicTrackList:"4ffbfd3b95ddc69b",AudioLongtapModal:"d2ade8d6189a9651",z_nav:"15cd3e3c3fed1207",im_chat_preview:"a4e7f074e711c095",NewStickerPicker:"6379dddc9a85b4fa",web_index:"658b6f4d2e45dbb4",VideoShareModal:"788cf1ab9f665abe","stickers-layer-view":"0acaf520f1ad1f0c","stickers-layer-purchase-details-view":"3993231cc38c4b95","stickers-random-selector-view":"d5d14885ce1b5b8c","stickers-random-selector-packs-view":"8f317c4b34e8ed45","stickers-random-selector-result-view":"63bdc729bf5d740e",VideoEditorModal:"fa1386d0a1195ea5",video_restore_button:"843076f1077dfcbc","framer-motion-entrypoint":"be30e82edc1853fe",story_blocks:"05f1ed233ca3245b","StickersKit-UGCManagementRestrictedModal":"be30e82edc1853fe","StickersKit-AgeRestrictionModal":"be30e82edc1853fe","StickersKit-ChatRestrictionModal":"be30e82edc1853fe",narratives_boxes:"607da87e096a3cea","stories-creator-legacy-modal":"f47856889b1c3728",CreateVideoChannelModal:"ccf65520b8d2b8b3",ExitConfirmationModal:"be30e82edc1853fe",video_upload_modal:"2c37ca52143115d2",AddClipToVideoModal:"c5f760b8814e4759",ClipPlayerModule:"be30e82edc1853fe",renderPlayerOverlay:"bfd8803536115302",HintModal:"be30e82edc1853fe",LiveStatsModal:"e181d12e8bf38add",StopLiveModal:"6bd20df7e549805c",AddToChannelModal:"39a343279a4eba54",LiveSettingsModal:"2939fdfd5b375eff",SubscriptionModal:"b1a354807f12f5a2",MusicShareModal:"67b9487c6f6e5db8",MusicUnauthModal:"9efe13d72420f8d5",PublishClipToVideoModal:"fd7f38b760e09d53",sharedVideoUploadState:"bb0cff523c6789a6",VideoUploadModal:"69a14c26c14ff18f",VideoExternalUploadModal:"69a14c26c14ff18f",ClipUploadModal:"9257b2a36342c75c",AddClipToVideoBlock:"3db135e76479446f",OpenNewVideoEditorButton:"be085d5a9ba950ca","mvk-logout-modal":"ad34b5b5ba7dfd41","gifts-catalog-modal-legacy":"d0edb8521b9fb7d4"};__webpack_require__.f.vkLangs=(s,i)=>{if("string"==typeof s&&s.startsWith("langs/web/")){var r=t[s.replace("langs/web/","")];if(r){var o=__webpack_require__.o(e,s)?e[s]:void 0;if(0!==o)if(o)i.push(o[2]);else{var a=new Promise(((t,i)=>o=e[s]=[t,i]));i.push(o[2]=a);var n="?v="+(window.vk&&window.vk.cfg?window.vk.cfg.langs_force_version:0)+"&p=web&l="+window.vk.lang||"",c=self.location.origin+/js/+s+"."+r+".js"+n,d=new Error;__webpack_require__.l(c,(t=>{if(__webpack_require__.o(e,s)&&(0!==(o=e[s])&&(e[s]=void 0),o)){o[0]();var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;d.message="Loading lang "+s+" failed.\n("+i+": "+r+")",d.name="LangLoadError",d.type=i,d.request=r,setTimeout((()=>{throw d}),0)}}),"lang-"+s)}}}};var s=self.langChunkLoadingGlobal||(e=>self.addLangKeys(e[1]));self.langChunkLoadingGlobal=((t,s)=>{var[i]=s;t&&t(s),__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0}).bind(null,s)})(),self.__declaredGlobals||(self.__declaredGlobals=new Set),self.__usedGlobals||(self.__usedGlobals={buffered:new Set,bufferedErrors:new Set,add(e){this.buffered.add(e)},addError(e){this.bufferedErrors.add(e)},listen(e){(this.buffered.size||this.bufferedErrors.size)&&e(Array.from(this.bufferedErrors),Array.from(this.buffered));const t=this.add.bind(this),s=this.addError.bind(this);this.add=s=>{e([],[s]),t(s)},this.addError=t=>{e([t],[]),s(t)}}}),__webpack_require__._dG=function(e,t){if(self.partConfigEnabled&&self.partConfigEnabled("global_variable_wrapper")&&!self.__declaredGlobals.has(e)){self.__declaredGlobals.add(e);try{let s=t;Object.defineProperty(self,e,{enumerable:!0,configurable:!0,get:()=>(self.__usedGlobals.add(e),s),set(e){s=e}})}catch(s){self.__usedGlobals.addError(e),window[e]=t}}else window[e]=t;return t};var __webpack_exports__=__webpack_require__.O(void 0,[91498,89631,50560,62791,762,21529,79210,63616,23592,89887,81248,14925,85172,60077,83741,2004,18680,72754,47582,70380],(()=>__webpack_require__(727968)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();