try{(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[85172],{897976:(e,t,i)=>{i.d(t,{constructConfig:()=>u,constructSources:()=>o,constructVideoData:()=>l});var r=i(317929),s=i(1100),a=i(807978);const n={"144p":"mp4_144","240p":"mp4_240","360p":"mp4_360","480p":"mp4_480","720p":"mp4_720","1080p":"mp4_1080","1440p":"mp4_1440","2160p":"mp4_2160"};function o({files:e,live_settings:t}){const i={};let s=t?.playback_duration??t?.max_rewind_duration;s&&(s*=a.SECOND);const o=Boolean(t),l=!s;if(!e)return i;const u={};for(const[t,i]of Object.entries(n))i in e&&(u[t]=e[i]);return Object.keys(u).length>0?i.MPEG=u:e.src&&(i.MPEG={"Invariant quality":e.src}),e.dash_sep&&(i[r.VideoFormat.DASH_SEP]={type:"url",url:e.dash_sep}),e.dash_webm&&(i[r.VideoFormat.DASH_WEBM]={type:"url",url:e.dash_webm}),e.dash_webm_av1&&(i[r.VideoFormat.DASH_WEBM_AV1]={type:"url",url:e.dash_webm_av1}),e.dash_streams&&(i[r.VideoFormat.DASH_STREAMS]={type:"url",url:e.dash_streams}),e.cmaf&&(i[r.VideoFormat.DASH_LIVE_CMAF]={type:"url",url:e.cmaf}),e.hls&&!o&&(i[r.VideoFormat.HLS]={type:"url",url:e.hls}),e.dash_live&&l&&(i[r.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live}),!e.dash_live_playback||l&&e.dash_live||(i[r.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live_playback}),e.hls_live&&l&&(i[r.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live}),!e.hls_live_playback||l&&e.hls_live||(i[r.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live_playback,maxSeekBackTime:s}),e.dash_ondemand&&(i[r.VideoFormat.DASH_ONDEMAND]={type:"url",url:e.dash_ondemand}),e.hls_ondemand&&(i[r.VideoFormat.HLS_ONDEMAND]={type:"url",url:e.hls_ondemand}),e.hls_live_ondemand&&(i[r.VideoFormat.HLS_LIVE_CMAF]={type:"url",url:e.hls_live_ondemand,maxSeekBackTime:s}),e.ws&&(i[r.VideoFormat.WEB_RTC_LIVE]={type:"url",url:e.ws}),i}function l(e){const t=o(e),i=e.image?.sort(((e,t)=>e.height-t.height))??[],r=i.find((({height:e})=>e>500))??i.at(-1),s=e.restriction?{restriction:e.restriction}:{};return{...Object.keys(t).length>0?{sources:t}:{},...e.live_status?{live:{status:e.live_status,startTime:e.live_start_time}}:{},title:e.title??"",thumbUrl:r?.url,unitedVideoId:parseInt(e.ov_id??"0",10),duration:e.duration??0,videoEpisodes:e.episodes?.map((({time:e,text:t})=>({time:e??0,text:t??""}))),previewThumbsData:e.timeline_thumbs?{countPerImage:e.timeline_thumbs.count_per_image??1,countPerRow:e.timeline_thumbs.count_per_row??1,countTotal:e.timeline_thumbs.count_total??1,frameHeight:e.timeline_thumbs.frame_height??0,frameWidth:e.timeline_thumbs.frame_width??0,frequency:e.timeline_thumbs.frequency??1,isUV:e.timeline_thumbs.is_uv??!1,links:e.timeline_thumbs.links??[]}:void 0,subtitles:e.subtitles?.filter((e=>Boolean(e.url))).map((({is_auto:e,title:t,lang:i,manifest_name:r,url:s,storage_index:a})=>({isAuto:e,id:[t,i,a].filter(Boolean).join("_"),language:i,label:r,url:s}))),subtitlesForcedLanguage:e.force_subtitles,...s}}function u(e,t){const i=e.map((e=>l(e))),r=e[0],a={videos:i??[]};return t&&(a.interactiveData={...t,videoLoader:async(e,i)=>{const r=t?.accessKeysMap||{};return u((await(0,s.fetchVideo)(parseInt(e,10),parseInt(i,10),r[i]||"")).items)}}),r?.album_id&&(a.albumId=r.album_id.toString(10)),r?.uv_stats_place&&(a.statPlace=r.uv_stats_place),r?.track_code&&(a.statTrackCode=r.track_code),2===r?.can_download&&(a.canDownload=!0),r?.files?.failover_host&&(a.failoverHosts=[r?.files?.failover_host]),r?.restriction?.mute_info_link&&(a.isAudioDisabled=Boolean(r?.restriction?.mute_info_link)),r?.volume_multiplier&&(a.volumeMultiplier=r?.volume_multiplier),a}},1100:(e,t,i)=>{i.d(t,{fetchVideo:()=>a});var r=i(538522),s=i(805658);const a=async(e,t,i,a={})=>(0,s.apiWithPrefetch)("video.get",{owner_id:e,videos:(0,r.joinRawId)({ownerId:e,itemId:t,externalId:i}),extended:1,...a})},773439:(e,t,i)=>{i.d(t,{ChromecastState:()=>Gi,HttpConnectionType:()=>Ki,Observable:()=>l.Observable,PlaybackState:()=>Wi,Player:()=>Gl,PredefinedQualityLimits:()=>Xi,SDK_VERSION:()=>Kl,Subscription:()=>l.Subscription,Surface:()=>Yi,VERSION:()=>Ui,VideoFormat:()=>Qi,VideoQuality:()=>l.VideoQuality,areValidLiveRecordSources:()=>Er,clientChecker:()=>Tr,isMobile:()=>pr});var r,s,a,n,o,l=i(819705),u=Object.create,d=Object.defineProperty,c=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,p=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty,m=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),g=(e,t,i)=>(i=null!=e?u(p(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of h(t))!f.call(e,s)&&s!==i&&d(e,s,{get:()=>t[s],enumerable:!(r=c(t,s))||r.enumerable});return e})(!t&&e&&e.__esModule?i:d(i,"default",{value:e,enumerable:!0}),e)),v=m(((e,t)=>{"use strict";var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),b=m(((e,t)=>{"use strict";t.exports=function(e){try{return!!e()}catch{return!0}}})),y=m(((e,t)=>{"use strict";var i=b();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),S=m(((e,t)=>{"use strict";var i=y(),r=Function.prototype,s=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(s):function(){return a.apply(s,arguments)})})),w=m(((e,t)=>{"use strict";var i=y(),r=Function.prototype,s=r.call,a=i&&r.bind.bind(s,s);t.exports=i?a:function(e){return function(){return s.apply(e,arguments)}}})),$=m(((e,t)=>{"use strict";var i=w(),r=i({}.toString),s=i("".slice);t.exports=function(e){return s(r(e),8,-1)}})),x=m(((e,t)=>{"use strict";var i=$(),r=w();t.exports=function(e){if("Function"===i(e))return r(e)}})),k=m(((e,t)=>{"use strict";var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),T=m(((e,t)=>{"use strict";var i=b();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),_=m(((e,t)=>{"use strict";var i=y(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),C=m((e=>{"use strict";var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),E=m(((e,t)=>{"use strict";t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),A=m(((e,t)=>{"use strict";var i=w(),r=b(),s=$(),a=Object,n=i("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?n(e,""):a(e)}:a})),L=m(((e,t)=>{"use strict";t.exports=function(e){return null==e}})),P=m(((e,t)=>{"use strict";var i=L(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),M=m(((e,t)=>{"use strict";var i=A(),r=P();t.exports=function(e){return i(r(e))}})),I=m(((e,t)=>{"use strict";var i=k();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),R=m(((e,t)=>{"use strict";t.exports={}})),V=m(((e,t)=>{"use strict";var i=R(),r=v(),s=k(),a=function(e){return s(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?a(i[e])||a(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),N=m(((e,t)=>{"use strict";var i=w();t.exports=i({}.isPrototypeOf)})),B=m(((e,t)=>{"use strict";var i=v().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),D=m(((e,t)=>{"use strict";var i,r,s=v(),a=B(),n=s.process,o=s.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&a&&((!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=a.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),O=m(((e,t)=>{"use strict";var i=D(),r=b(),s=v().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),F=m(((e,t)=>{"use strict";var i=O();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),j=m(((e,t)=>{"use strict";var i=V(),r=k(),s=N(),a=F(),n=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&s(t.prototype,n(e))}})),z=m(((e,t)=>{"use strict";var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),q=m(((e,t)=>{"use strict";var i=k(),r=z(),s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not a function")}})),H=m(((e,t)=>{"use strict";var i=q(),r=L();t.exports=function(e,t){var s=e[t];return r(s)?void 0:i(s)}})),U=m(((e,t)=>{"use strict";var i=_(),r=k(),s=I(),a=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!s(o=i(n,e))||r(n=e.valueOf)&&!s(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!s(o=i(n,e)))return o;throw new a("Can't convert object to primitive value")}})),W=m(((e,t)=>{"use strict";t.exports=!0})),Q=m(((e,t)=>{"use strict";var i=v(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),G=m(((e,t)=>{"use strict";var i=W(),r=v(),s=Q(),a="__core-js_shared__",n=t.exports=r[a]||s(a,{});(n.versions||(n.versions=[])).push({version:"3.43.0",mode:i?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.43.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),K=m(((e,t)=>{"use strict";var i=G();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),Y=m(((e,t)=>{"use strict";var i=P(),r=Object;t.exports=function(e){return r(i(e))}})),X=m(((e,t)=>{"use strict";var i=w(),r=Y(),s=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return s(r(e),t)}})),J=m(((e,t)=>{"use strict";var i=w(),r=0,s=Math.random(),a=i(1.1.toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+s,36)}})),Z=m(((e,t)=>{"use strict";var i=v(),r=K(),s=X(),a=J(),n=O(),o=F(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return s(u,e)||(u[e]=n&&s(l,e)?l[e]:d("Symbol."+e)),u[e]}})),ee=m(((e,t)=>{"use strict";var i=_(),r=I(),s=j(),a=H(),n=U(),o=Z(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||s(e))return e;var o,d=a(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||s(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),te=m(((e,t)=>{"use strict";var i=ee(),r=j();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),ie=m(((e,t)=>{"use strict";var i=v(),r=I(),s=i.document,a=r(s)&&r(s.createElement);t.exports=function(e){return a?s.createElement(e):{}}})),re=m(((e,t)=>{"use strict";var i=T(),r=b(),s=ie();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))})),se=m((e=>{"use strict";var t=T(),i=_(),r=C(),s=E(),a=M(),n=te(),o=X(),l=re(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=a(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return s(!i(r.f,e,t),e[t])}})),ae=m(((e,t)=>{"use strict";var i=b(),r=k(),s=/#|\.prototype\./,a=function(e,t){var s=o[n(e)];return s===u||s!==l&&(r(t)?i(t):!!t)},n=a.normalize=function(e){return String(e).replace(s,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a})),ne=m(((e,t)=>{"use strict";var i=x(),r=q(),s=y(),a=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:s?a(e,t):function(){return e.apply(t,arguments)}}})),oe=m(((e,t)=>{"use strict";var i=T(),r=b();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),le=m(((e,t)=>{"use strict";var i=I(),r=String,s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not an object")}})),ue=m((e=>{"use strict";var t=T(),i=re(),r=oe(),s=le(),a=te(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(s(e),t=a(t),s(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(s(e),t=a(t),s(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),de=m(((e,t)=>{"use strict";var i=T(),r=ue(),s=E();t.exports=i?function(e,t,i){return r.f(e,t,s(1,i))}:function(e,t,i){return e[t]=i,e}})),ce=m(((e,t)=>{"use strict";var i=v(),r=S(),s=x(),a=k(),n=se().f,o=ae(),l=R(),u=ne(),d=de(),c=X();G();var h=function(e){var t=function(i,s,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,s)}return new e(i,s,a)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,b,y,S,w=e.target,$=e.global,x=e.stat,k=e.proto,T=$?i:x?i[w]:i[w]&&i[w].prototype,_=$?l:l[w]||d(l,w,{})[w],C=_.prototype;for(m in t)p=!(r=o($?m:w+(x?".":"#")+m,e.forced))&&T&&c(T,m),v=_[m],p&&(e.dontCallGetSet?b=(S=n(T,m))&&S.value:b=T[m]),g=p&&b?b:t[m],(r||k||typeof v!=typeof g)&&(y=e.bind&&p?u(g,i):e.wrap&&p?h(g):k&&a(g)?s(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(y,"sham",!0),d(_,m,y),k&&(c(l,f=w+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&C&&(r||!C[m])&&d(C,m,g)))}})),he=m(((e,t)=>{"use strict";var i=K(),r=J(),s=i("keys");t.exports=function(e){return s[e]||(s[e]=r(e))}})),pe=m(((e,t)=>{"use strict";var i=b();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),fe=m(((e,t)=>{"use strict";var i=X(),r=k(),s=Y(),a=he(),n=pe(),o=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=s(e);if(i(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?u:null}})),me=m(((e,t)=>{"use strict";var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),ge=m(((e,t)=>{"use strict";var i=me();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),ve=m(((e,t)=>{"use strict";var i=ge(),r=Math.max,s=Math.min;t.exports=function(e,t){var a=i(e);return a<0?r(a+t,0):s(a,t)}})),be=m(((e,t)=>{"use strict";var i=ge(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ye=m(((e,t)=>{"use strict";var i=be();t.exports=function(e){return i(e.length)}})),Se=m(((e,t)=>{"use strict";var i=M(),r=ve(),s=ye(),a=function(e){return function(t,a,n){var o=i(t),l=s(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&a!=a){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===a)return e||d||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),we=m(((e,t)=>{"use strict";t.exports={}})),$e=m(((e,t)=>{"use strict";var i=w(),r=X(),s=M(),a=Se().indexOf,n=we(),o=i([].push);t.exports=function(e,t){var i,l=s(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~a(d,i)||o(d,i));return d}})),xe=m(((e,t)=>{"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),ke=m(((e,t)=>{"use strict";var i=$e(),r=xe();t.exports=Object.keys||function(e){return i(e,r)}})),Te=m(((e,t)=>{"use strict";var i=T(),r=b(),s=w(),a=fe(),n=ke(),o=M(),l=s(C().f),u=s([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,s=o(t),c=n(s),h=d&&null===a(s),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in s:l(s,r)))&&u(m,e?[r,s[r]]:s[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),_e=m((()=>{"use strict";var e=ce(),t=Te().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),Ce=m(((e,t)=>{"use strict";_e();var i=R();t.exports=i.Object.values})),Ee=m(((e,t)=>{"use strict";var i=Ce();t.exports=i})),Ae=m(((e,t)=>{"use strict";var i=Ee();t.exports=i})),Le=m(((e,t)=>{"use strict";t.exports=function(){}})),Pe=m((()=>{"use strict";var e=ce(),t=Se().includes,i=b(),r=Le();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Me=m(((e,t)=>{"use strict";var i=V();t.exports=i})),Ie=m(((e,t)=>{"use strict";Pe();var i=Me();t.exports=i("Array","includes")})),Re=m(((e,t)=>{"use strict";var i=Ie();t.exports=i})),Ve=m(((e,t)=>{"use strict";var i=Re();t.exports=i})),Ne=m((()=>{"use strict";var e=ce(),t=Te().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Be=m(((e,t)=>{"use strict";Ne();var i=R();t.exports=i.Object.entries})),De=m(((e,t)=>{"use strict";var i=Be();t.exports=i})),Oe=m(((e,t)=>{"use strict";var i=De();t.exports=i})),Fe=m(((e,t)=>{"use strict";t.exports={}})),je=m(((e,t)=>{"use strict";var i=v(),r=k(),s=i.WeakMap;t.exports=r(s)&&/native code/.test(String(s))})),ze=m(((e,t)=>{"use strict";var i,r,s,a,n,o=je(),l=v(),u=I(),d=de(),c=X(),h=G(),p=he(),f=we(),m="Object already initialized",g=l.TypeError,b=l.WeakMap;o||h.state?((a=h.state||(h.state=new b)).get=a.get,a.has=a.has,a.set=a.set,i=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},s=function(e){return a.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(c(e,n))throw new g(m);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},s=function(e){return c(e,n)}),t.exports={set:i,get:r,has:s,enforce:function(e){return s(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),qe=m(((e,t)=>{"use strict";var i=T(),r=X(),s=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,n=r(s,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&a(s,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),He=m((e=>{"use strict";var t=T(),i=oe(),r=ue(),s=le(),a=M(),n=ke();e.f=t&&!i?Object.defineProperties:function(e,t){s(e);for(var i,o=a(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),Ue=m(((e,t)=>{"use strict";var i=V();t.exports=i("document","documentElement")})),We=m(((e,t)=>{"use strict";var i,r=le(),s=He(),a=xe(),n=we(),o=Ue(),l=ie(),u=he(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=a.length;e--;)delete g[d][a[e]];return g()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:s.f(i,t)}})),Qe=m(((e,t)=>{"use strict";var i=de();t.exports=function(e,t,r,s){return s&&s.enumerable?e[t]=r:i(e,t,r),e}})),Ge=m(((e,t)=>{"use strict";var i,r,s,a=b(),n=k(),o=I(),l=We(),u=fe(),d=Qe(),c=Z(),h=W(),p=c("iterator"),f=!1;[].keys&&("next"in(s=[].keys())?(r=u(u(s)))!==Object.prototype&&(i=r):f=!0),!o(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),Ke=m(((e,t)=>{"use strict";var i={};i[Z()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Ye=m(((e,t)=>{"use strict";var i=Ke(),r=k(),s=$(),a=Z()("toStringTag"),n=Object,o="Arguments"===s(function(){return arguments}());t.exports=i?s:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),a))?i:o?s(t):"Object"===(l=s(t))&&r(t.callee)?"Arguments":l}})),Xe=m(((e,t)=>{"use strict";var i=Ke(),r=Ye();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Je=m(((e,t)=>{"use strict";var i=Ke(),r=ue().f,s=de(),a=X(),n=Xe(),o=Z()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(a(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&s(d,"toString",n))}})),Ze=m(((e,t)=>{"use strict";var i=Ge().IteratorPrototype,r=We(),s=E(),a=Je(),n=Fe(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:s(+!u,l)}),a(e,d,!1,!0),n[d]=o,e}})),et=m(((e,t)=>{"use strict";var i=w(),r=q();t.exports=function(e,t,s){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}}})),tt=m(((e,t)=>{"use strict";var i=I();t.exports=function(e){return i(e)||null===e}})),it=m(((e,t)=>{"use strict";var i=tt(),r=String,s=TypeError;t.exports=function(e){if(i(e))return e;throw new s("Can't set "+r(e)+" as a prototype")}})),rt=m(((e,t)=>{"use strict";var i=et(),r=I(),s=P(),a=it();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return s(i),a(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),st=m(((e,t)=>{"use strict";var i=ce(),r=_(),s=W(),a=qe(),n=k(),o=Ze(),l=fe(),u=rt(),d=Je(),c=de(),h=Qe(),p=Z(),f=Fe(),m=Ge(),g=a.PROPER,v=a.CONFIGURABLE,b=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,S=p("iterator"),w="keys",$="values",x="entries",T=function(){return this};t.exports=function(e,t,a,p,m,k,_){o(a,t,p);var C,E,A,L=function(e){if(e===m&&V)return V;if(!y&&e&&e in I)return I[e];switch(e){case w:case $:case x:return function(){return new a(this,e)}}return function(){return new a(this)}},P=t+" Iterator",M=!1,I=e.prototype,R=I[S]||I["@@iterator"]||m&&I[m],V=!y&&R||L(m),N="Array"===t&&I.entries||R;if(N&&((C=l(N.call(new e)))!==Object.prototype&&C.next&&(!s&&l(C)!==b&&(u?u(C,b):n(C[S])||h(C,S,T)),d(C,P,!0,!0),s&&(f[P]=T))),g&&m===$&&R&&R.name!==$&&(!s&&v?c(I,"name",$):(M=!0,V=function(){return r(R,this)})),m)if(E={values:L($),keys:k?V:L(w),entries:L(x)},_)for(A in E)(y||M||!(A in I))&&h(I,A,E[A]);else i({target:t,proto:!0,forced:y||M},E);return(!s||_)&&I[S]!==V&&h(I,S,V,{name:m}),f[t]=V,E}})),at=m(((e,t)=>{"use strict";t.exports=function(e,t){return{value:e,done:t}}})),nt=m(((e,t)=>{"use strict";var i=M(),r=Le(),s=Fe(),a=ze(),n=ue().f,o=st(),l=at(),u=W(),d=T(),c="Array Iterator",h=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=s.Arguments=s.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),ot=m(((e,t)=>{"use strict";var i=Z(),r=Fe(),s=i("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[s]===e)}})),lt=m(((e,t)=>{"use strict";var i=Ye(),r=H(),s=L(),a=Fe(),n=Z()("iterator");t.exports=function(e){if(!s(e))return r(e,n)||r(e,"@@iterator")||a[i(e)]}})),ut=m(((e,t)=>{"use strict";var i=_(),r=q(),s=le(),a=z(),n=lt(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return s(i(l,e));throw new o(a(e)+" is not iterable")}})),dt=m(((e,t)=>{"use strict";var i=_(),r=le(),s=H();t.exports=function(e,t,a){var n,o;r(e);try{if(!(n=s(e,"return"))){if("throw"===t)throw a;return a}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw a;if(o)throw n;return r(n),a}})),ct=m(((e,t)=>{"use strict";var i=ne(),r=_(),s=le(),a=z(),n=ot(),o=ye(),l=N(),u=ut(),d=lt(),c=dt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,b,y,S,w,$,x=m&&m.that,k=!(!m||!m.AS_ENTRIES),T=!(!m||!m.IS_RECORD),_=!(!m||!m.IS_ITERATOR),C=!(!m||!m.INTERRUPTED),E=i(t,x),A=function(e){return g&&c(g,"normal"),new p(!0,e)},L=function(e){return k?(s(e),C?E(e[0],e[1],A):E(e[0],e[1])):C?E(e,A):E(e)};if(T)g=e.iterator;else if(_)g=e;else{if(!(v=d(e)))throw new h(a(e)+" is not iterable");if(n(v)){for(b=0,y=o(e);y>b;b++)if((S=L(e[b]))&&l(f,S))return S;return new p(!1)}g=u(e,v)}for(w=T?e.next:g.next;!($=r(w,g)).done;){try{S=L($.value)}catch(e){c(g,"throw",e)}if("object"==typeof S&&S&&l(f,S))return S}return new p(!1)}})),ht=m(((e,t)=>{"use strict";var i=T(),r=ue(),s=E();t.exports=function(e,t,a){i?r.f(e,t,s(0,a)):e[t]=a}})),pt=m((()=>{"use strict";var e=ce(),t=ct(),i=ht();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),ft=m(((e,t)=>{"use strict";nt(),pt();var i=R();t.exports=i.Object.fromEntries})),mt=m(((e,t)=>{"use strict";t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),gt=m((()=>{"use strict";nt();var e,t=mt(),i=v(),r=Je(),s=Fe();for(e in t)r(i[e],e),s[e]=s.Array})),vt=m(((e,t)=>{"use strict";var i=ft();gt(),t.exports=i})),bt=m(((e,t)=>{"use strict";var i=vt();t.exports=i})),yt=m((()=>{})),St=m(((e,t)=>{"use strict";var i=v(),r=B(),s=$(),a=function(e){return r.slice(0,e.length)===e};t.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===s(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),wt=m(((e,t)=>{"use strict";var i=St();t.exports="NODE"===i})),$t=m(((e,t)=>{"use strict";var i=ue();t.exports=function(e,t,r){return i.f(e,t,r)}})),xt=m(((e,t)=>{"use strict";var i=V(),r=$t(),s=Z(),a=T(),n=s("species");t.exports=function(e){var t=i(e);a&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),kt=m(((e,t)=>{"use strict";var i=N(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),Tt=m(((e,t)=>{"use strict";var i=w(),r=k(),s=G(),a=i(Function.toString);r(s.inspectSource)||(s.inspectSource=function(e){return a(e)}),t.exports=s.inspectSource})),_t=m(((e,t)=>{"use strict";var i=w(),r=b(),s=k(),a=Ye(),n=V(),o=Tt(),l=function(){},u=n("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!s(e))return!1;try{return u(l,[],e),!0}catch{return!1}},f=function(e){if(!s(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch{return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),Ct=m(((e,t)=>{"use strict";var i=_t(),r=z(),s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not a constructor")}})),Et=m(((e,t)=>{"use strict";var i=le(),r=Ct(),s=L(),a=Z()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||s(n=i(o)[a])?t:r(n)}})),At=m(((e,t)=>{"use strict";var i=w();t.exports=i([].slice)})),Lt=m(((e,t)=>{"use strict";var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),Pt=m(((e,t)=>{"use strict";var i=B();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),Mt=m(((e,t)=>{"use strict";var i,r,s,a,n=v(),o=S(),l=ne(),u=k(),d=X(),c=b(),h=Ue(),p=At(),f=ie(),m=Lt(),g=Pt(),y=wt(),w=n.setImmediate,$=n.clearImmediate,x=n.process,T=n.Dispatch,_=n.Function,C=n.MessageChannel,E=n.String,A=0,L={},P="onreadystatechange";c((function(){i=n.location}));var M=function(e){if(d(L,e)){var t=L[e];delete L[e],t()}},I=function(e){return function(){M(e)}},R=function(e){M(e.data)},V=function(e){n.postMessage(E(e),i.protocol+"//"+i.host)};(!w||!$)&&(w=function(e){m(arguments.length,1);var t=u(e)?e:_(e),i=p(arguments,1);return L[++A]=function(){o(t,void 0,i)},r(A),A},$=function(e){delete L[e]},y?r=function(e){x.nextTick(I(e))}:T&&T.now?r=function(e){T.now(I(e))}:C&&!g?(a=(s=new C).port2,s.port1.onmessage=R,r=l(a.postMessage,a)):n.addEventListener&&u(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!c(V)?(r=V,n.addEventListener("message",R,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),M(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:w,clear:$}})),It=m(((e,t)=>{"use strict";var i=v(),r=T(),s=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=s(i,e);return t&&t.value}})),Rt=m(((e,t)=>{"use strict";var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),Vt=m(((e,t)=>{"use strict";var i=B();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),Nt=m(((e,t)=>{"use strict";var i=B();t.exports=/web0s(?!.*chrome)/i.test(i)})),Bt=m(((e,t)=>{"use strict";var i,r,s,a,n,o,l,u=v(),d=It(),c=ne(),h=Mt().set,p=Rt(),f=Pt(),m=Vt(),g=Nt(),b=wt(),y=u.MutationObserver||u.WebKitMutationObserver,S=u.document,w=u.process,$=u.Promise,x=d("queueMicrotask");x||(o=new p,l=function(){var e,t;for(b&&(e=w.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||b||g||!y||!S?!m&&$&&$.resolve?((a=$.resolve(void 0)).constructor=$,n=c(a.then,a),i=function(){n(l)}):b?i=function(){w.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,s=S.createTextNode(""),new y(l).observe(s,{characterData:!0}),i=function(){s.data=r=!r}),x=function(e){o.head||i(),o.add(e)}),t.exports=x})),Dt=m(((e,t)=>{"use strict";t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),Ot=m(((e,t)=>{"use strict";t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),Ft=m(((e,t)=>{"use strict";var i=v();t.exports=i.Promise})),jt=m(((e,t)=>{"use strict";var i=v(),r=Ft(),s=k(),a=ae(),n=Tt(),o=Z(),l=St(),u=W(),d=D(),c=r&&r.prototype,h=o("species"),p=!1,f=s(i.PromiseRejectionEvent),m=a("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),s=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=s,!(p=i.then((function(){}))instanceof s))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),zt=m(((e,t)=>{"use strict";var i=q(),r=TypeError,s=function(e){var t,s;this.promise=new e((function(e,i){if(void 0!==t||void 0!==s)throw new r("Bad Promise constructor");t=e,s=i})),this.resolve=i(t),this.reject=i(s)};t.exports.f=function(e){return new s(e)}})),qt=m((()=>{"use strict";var e,t,i,r,s=ce(),a=W(),n=wt(),o=v(),l=R(),u=_(),d=Qe(),c=rt(),h=Je(),p=xt(),f=q(),m=k(),g=I(),b=kt(),y=Et(),S=Mt().set,w=Bt(),$=Dt(),x=Ot(),T=Rt(),C=ze(),E=Ft(),A=jt(),L=zt(),P="Promise",M=A.CONSTRUCTOR,V=A.REJECTION_EVENT,N=A.SUBCLASSING,B=C.getterFor(P),D=C.set,O=E&&E.prototype,F=E,j=O,z=o.TypeError,H=o.document,U=o.process,Q=L.f,G=Q,K=!!(H&&H.createEvent&&o.dispatchEvent),Y="unhandledrejection",X=function(e){var t;return!(!g(e)||!m(t=e.then))&&t},J=function(e,t){var i,r,s,a=t.value,n=1===t.state,o=n?e.ok:e.fail,l=e.resolve,d=e.reject,c=e.domain;try{o?(n||(2===t.rejection&&re(t),t.rejection=1),!0===o?i=a:(c&&c.enter(),i=o(a),c&&(c.exit(),s=!0)),i===e.promise?d(new z("Promise-chain cycle")):(r=X(i))?u(r,i,l,d):l(i)):d(a)}catch(e){c&&!s&&c.exit(),d(e)}},Z=function(e,t){e.notified||(e.notified=!0,w((function(){for(var i,r=e.reactions;i=r.get();)J(i,e);e.notified=!1,t&&!e.rejection&&te(e)})))},ee=function(e,t,i){var r,s;K?((r=H.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),o.dispatchEvent(r)):r={promise:t,reason:i},!V&&(s=o["on"+e])?s(r):e===Y&&$("Unhandled promise rejection",i)},te=function(e){u(S,o,(function(){var t,i=e.facade,r=e.value;if(ie(e)&&(t=x((function(){n?U.emit("unhandledRejection",r,i):ee(Y,i,r)})),e.rejection=n||ie(e)?2:1,t.error))throw t.value}))},ie=function(e){return 1!==e.rejection&&!e.parent},re=function(e){u(S,o,(function(){var t=e.facade;n?U.emit("rejectionHandled",t):ee("rejectionhandled",t,e.value)}))},se=function(e,t,i){return function(r){e(t,r,i)}},ae=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Z(e,!0))},ne=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new z("Promise can't be resolved itself");var r=X(t);r?w((function(){var i={done:!1};try{u(r,t,se(ne,i,e),se(ae,i,e))}catch(t){ae(i,t,e)}})):(e.value=t,e.state=1,Z(e,!1))}catch(t){ae({done:!1},t,e)}}};if(M&&(j=(F=function(t){b(this,j),f(t),u(e,this);var i=B(this);try{t(se(ne,i),se(ae,i))}catch(e){ae(i,e)}}).prototype,(e=function(e){D(this,{type:P,done:!1,notified:!1,parent:!1,reactions:new T,rejection:!1,state:0,value:null})}).prototype=d(j,"then",(function(e,t){var i=B(this),r=Q(y(this,F));return i.parent=!0,r.ok=!m(e)||e,r.fail=m(t)&&t,r.domain=n?U.domain:void 0,0===i.state?i.reactions.add(r):w((function(){J(r,i)})),r.promise})),t=function(){var t=new e,i=B(t);this.promise=t,this.resolve=se(ne,i),this.reject=se(ae,i)},L.f=Q=function(e){return e===F||e===i?new t(e):G(e)},!a&&m(E)&&O!==Object.prototype)){r=O.then,N||d(O,"then",(function(e,t){var i=this;return new F((function(e,t){u(r,i,e,t)})).then(e,t)}),{unsafe:!0});try{delete O.constructor}catch{}c&&c(O,j)}s({global:!0,constructor:!0,wrap:!0,forced:M},{Promise:F}),i=l.Promise,h(F,P,!1,!0),p(P)})),Ht=m(((e,t)=>{"use strict";var i,r,s=Z()("iterator"),a=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){a=!0}})[s]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!a)return!1}catch{return!1}var i=!1;try{var r={};r[s]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),Ut=m(((e,t)=>{"use strict";var i=Ft(),r=Ht(),s=jt().CONSTRUCTOR;t.exports=s||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),Wt=m((()=>{"use strict";var e=ce(),t=_(),i=q(),r=zt(),s=Ot(),a=ct();e({target:"Promise",stat:!0,forced:Ut()},{all:function(e){var n=this,o=r.f(n),l=o.resolve,u=o.reject,d=s((function(){var r=i(n.resolve),s=[],o=0,d=1;a(e,(function(e){var i=o++,a=!1;d++,t(r,n,e).then((function(e){a||(a=!0,s[i]=e,--d||l(s))}),u)})),--d||l(s)}));return d.error&&u(d.value),o.promise}})})),Qt=m((()=>{"use strict";var e,t=ce(),i=W(),r=jt().CONSTRUCTOR,s=Ft(),a=V(),n=k(),o=Qe(),l=s&&s.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(s)&&(e=a("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),Gt=m((()=>{"use strict";var e=ce(),t=_(),i=q(),r=zt(),s=Ot(),a=ct();e({target:"Promise",stat:!0,forced:Ut()},{race:function(e){var n=this,o=r.f(n),l=o.reject,u=s((function(){var r=i(n.resolve);a(e,(function(e){t(r,n,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),Kt=m((()=>{"use strict";var e=ce(),t=zt();e({target:"Promise",stat:!0,forced:jt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),Yt=m(((e,t)=>{"use strict";var i=le(),r=I(),s=zt();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var a=s.f(e);return(0,a.resolve)(t),a.promise}})),Xt=m((()=>{"use strict";var e=ce(),t=V(),i=W(),r=Ft(),s=jt().CONSTRUCTOR,a=Yt(),n=t("Promise"),o=i&&!s;e({target:"Promise",stat:!0,forced:i||s},{resolve:function(e){return a(o&&this===n?r:this,e)}})})),Jt=m((()=>{"use strict";qt(),Wt(),Qt(),Gt(),Kt(),Xt()})),Zt=m((()=>{"use strict";var e,t=ce(),i=W(),r=Ft(),s=b(),a=V(),n=k(),o=Et(),l=Yt(),u=Qe(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&s((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,a("Promise")),i=n(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=a("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),ei=m(((e,t)=>{"use strict";yt(),Jt(),Zt();var i=Me();t.exports=i("Promise","finally")})),ti=m(((e,t)=>{"use strict";var i=ei();t.exports=i})),ii=m(((e,t)=>{"use strict";var i=ti();t.exports=i})),ri=m((()=>{"use strict";var e=ce(),t=Y(),i=ye(),r=ge(),s=Le();e({target:"Array",proto:!0},{at:function(e){var s=t(this),a=i(s),n=r(e),o=n>=0?n:a+n;return o<0||o>=a?void 0:s[o]}}),s("at")})),si=m(((e,t)=>{"use strict";ri();var i=Me();t.exports=i("Array","at")})),ai=m(((e,t)=>{"use strict";var i=si();t.exports=i})),ni=m(((e,t)=>{"use strict";var i=ai();t.exports=i})),oi=m(((e,t)=>{"use strict";var i=$();t.exports=Array.isArray||function(e){return"Array"===i(e)}})),li=m(((e,t)=>{"use strict";var i=TypeError;t.exports=function(e){if(e>9007199254740991)throw i("Maximum allowed index exceeded");return e}})),ui=m(((e,t)=>{"use strict";var i=oi(),r=ye(),s=li(),a=ne(),n=function(e,t,o,l,u,d,c,h){for(var p,f,m=u,g=0,v=!!c&&a(c,h);g<l;)g in o&&(p=v?v(o[g],g,t):o[g],d>0&&i(p)?(f=r(p),m=n(e,t,p,f,m,d-1)-1):(s(m+1),e[m]=p),m++),g++;return m};t.exports=n})),di=m(((e,t)=>{"use strict";var i=oi(),r=_t(),s=I(),a=Z()("species"),n=Array;t.exports=function(e){var t;return i(e)&&(t=e.constructor,r(t)&&(t===n||i(t.prototype))?t=void 0:s(t)&&(null===(t=t[a])&&(t=void 0))),void 0===t?n:t}})),ci=m(((e,t)=>{"use strict";var i=di();t.exports=function(e,t){return new(i(e))(0===t?0:t)}})),hi=m((()=>{"use strict";var e=ce(),t=ui(),i=q(),r=Y(),s=ye(),a=ci();e({target:"Array",proto:!0},{flatMap:function(e){var n,o=r(this),l=s(o);return i(e),(n=a(o,0)).length=t(n,o,o,l,0,1,e,arguments.length>1?arguments[1]:void 0),n}})})),pi=m((()=>{"use strict";Le()("flatMap")})),fi=m(((e,t)=>{"use strict";hi(),pi();var i=Me();t.exports=i("Array","flatMap")})),mi=m(((e,t)=>{"use strict";var i=fi();t.exports=i})),gi=m(((e,t)=>{"use strict";var i=mi();t.exports=i})),vi=m(((e,t)=>{"use strict";var i=Ye(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),bi=m(((e,t)=>{"use strict";t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"})),yi=m(((e,t)=>{"use strict";var i=w(),r=P(),s=vi(),a=bi(),n=i("".replace),o=RegExp("^["+a+"]+"),l=RegExp("(^|[^"+a+"])["+a+"]+$"),u=function(e){return function(t){var i=s(r(t));return 1&e&&(i=n(i,o,"")),2&e&&(i=n(i,l,"$1")),i}};t.exports={start:u(1),end:u(2),trim:u(3)}})),Si=m(((e,t)=>{"use strict";var i=qe().PROPER,r=b(),s=bi();t.exports=function(e){return r((function(){return!!s[e]()||"​᠎"!=="​᠎"[e]()||i&&s[e].name!==e}))}})),wi=m(((e,t)=>{"use strict";var i=yi().start,r=Si();t.exports=r("trimStart")?function(){return i(this)}:"".trimStart})),$i=m((()=>{"use strict";var e=ce(),t=wi();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),xi=m((()=>{"use strict";$i();var e=ce(),t=wi();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),ki=m(((e,t)=>{"use strict";xi();var i=Me();t.exports=i("String","trimLeft")})),Ti=m(((e,t)=>{"use strict";var i=ki();t.exports=i})),_i=m(((e,t)=>{"use strict";var i=Ti();t.exports=i})),Ci=m((()=>{})),Ei=m((()=>{})),Ai=m(((e,t)=>{"use strict";var i=I(),r=$(),s=Z()("match");t.exports=function(e){var t;return i(e)&&(void 0!==(t=e[s])?!!t:"RegExp"===r(e))}})),Li=m(((e,t)=>{"use strict";var i=v(),r=b(),s=i.RegExp,a=!r((function(){var e=!0;try{s(".","d")}catch{e=!1}var t={},i="",r=e?"dgimsy":"gimsy",a=function(e,r){Object.defineProperty(t,e,{get:function(){return i+=r,!0}})},n={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(n.hasIndices="d"),n)a(o,n[o]);return Object.getOwnPropertyDescriptor(s.prototype,"flags").get.call(t)!==r||i!==r}));t.exports={correct:a}})),Pi=m(((e,t)=>{"use strict";var i=le();t.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),Mi=m(((e,t)=>{"use strict";var i=_(),r=X(),s=N(),a=Li(),n=Pi(),o=RegExp.prototype;t.exports=a.correct?function(e){return e.flags}:function(e){return a.correct||!s(o,e)||r(e,"flags")?e.flags:i(n,e)}})),Ii=m(((e,t)=>{"use strict";var i=w(),r=Y(),s=Math.floor,a=i("".charAt),n=i("".replace),o=i("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,i,d,c,h){var p=i+e.length,f=d.length,m=u;return void 0!==c&&(c=r(c),m=l),n(h,m,(function(r,n){var l;switch(a(n,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,i);case"'":return o(t,p);case"<":l=c[o(n,1,-1)];break;default:var u=+n;if(0===u)return r;if(u>f){var h=s(u/10);return 0===h?r:h<=f?void 0===d[h-1]?a(n,1):d[h-1]+a(n,1):r}l=d[u-1]}return void 0===l?"":l}))}})),Ri=m((()=>{"use strict";var e=ce(),t=_(),i=w(),r=P(),s=k(),a=I(),n=Ai(),o=vi(),l=H(),u=Mi(),d=Ii(),c=Z(),h=W(),p=c("replace"),f=TypeError,m=i("".indexOf),g=i("".replace),v=i("".slice),b=Math.max;e({target:"String",proto:!0},{replaceAll:function(e,i){var c,y,S,w,$,x,k,T,_,C,E=r(this),A=0,L="";if(a(e)){if((c=n(e))&&(y=o(r(u(e))),!~m(y,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(S=l(e,p))return t(S,e,E,i);if(h&&c)return g(o(E),e,i)}for(w=o(E),$=o(e),(x=s(i))||(i=o(i)),k=$.length,T=b(1,k),_=m(w,$);-1!==_;)C=x?o(i($,_,w)):d($,w,_,[],void 0,i),L+=v(w,A,_)+C,A=_+k,_=_+T>w.length?-1:m(w,$,_+T);return A<w.length&&(L+=v(w,A)),L}})})),Vi=m(((e,t)=>{"use strict";Ci(),Ei(),Ri();var i=Me();t.exports=i("String","replaceAll")})),Ni=m(((e,t)=>{"use strict";var i=Vi();t.exports=i})),Bi=m(((e,t)=>{"use strict";var i=Ni();t.exports=i})),Di=m(((e,t)=>{"use strict";var i=ge(),r=vi(),s=P(),a=RangeError;t.exports=function(e){var t=r(s(this)),n="",o=i(e);if(o<0||o===1/0)throw new a("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),Oi=m(((e,t)=>{"use strict";var i=w(),r=be(),s=vi(),a=Di(),n=P(),o=i(a),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,a){var d,c,h=s(n(t)),p=r(i),f=h.length,m=void 0===a?" ":s(a);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),Fi=m(((e,t)=>{"use strict";var i=B();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),ji=m((()=>{"use strict";var e=ce(),t=Oi().start;e({target:"String",proto:!0,forced:Fi()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),zi=m(((e,t)=>{"use strict";ji();var i=Me();t.exports=i("String","padStart")})),qi=m(((e,t)=>{"use strict";var i=zi();t.exports=i})),Hi=m(((e,t)=>{"use strict";var i=qi();t.exports=i})),Ui="2.0.149",Wi=((a=Wi||{}).STOPPED="stopped",a.READY="ready",a.PLAYING="playing",a.PAUSED="paused",a),Qi=((s=Qi||{}).MPEG="MPEG",s.DASH="DASH",s.DASH_SEP="DASH_SEP",s.DASH_SEP_VK="DASH_SEP",s.DASH_WEBM="DASH_WEBM",s.DASH_WEBM_AV1="DASH_WEBM_AV1",s.DASH_STREAMS="DASH_STREAMS",s.DASH_WEBM_VK="DASH_WEBM",s.DASH_ONDEMAND="DASH_ONDEMAND",s.DASH_ONDEMAND_VK="DASH_ONDEMAND",s.DASH_LIVE="DASH_LIVE",s.DASH_LIVE_CMAF="DASH_LIVE_CMAF",s.DASH_LIVE_WEBM="DASH_LIVE_WEBM",s.HLS="HLS",s.HLS_ONDEMAND="HLS_ONDEMAND",s.HLS_JS="HLS",s.HLS_FMP4="HLS_FMP4",s.HLS_LIVE="HLS_LIVE",s.HLS_LIVE_CMAF="HLS_LIVE_CMAF",s.WEB_RTC_LIVE="WEB_RTC_LIVE",s),Gi=(e=>(e.NOT_AVAILABLE="NOT_AVAILABLE",e.AVAILABLE="AVAILABLE",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e))(Gi||{}),Ki=((n=Ki||{}).HTTP1="http1",n.HTTP2="http2",n.QUIC="quic",n),Yi=((o=Yi||{}).NONE="none",o.INLINE="inline",o.FULLSCREEN="fullscreen",o.SECOND_SCREEN="second_screen",o.PIP="pip",o.INVISIBLE="invisible",o),Xi=(e=>(e.TRAFFIC_SAVING="traffic_saving",e.HIGH_QUALITY="high_quality",e.UNKNOWN="unknown",e))(Xi||{}),Ji=g(Ae(),1),Zi=g(Ve(),1),er=class{connect(){cast.framework.CastContext.getInstance()?.requestSession()}disconnect(){cast.framework.CastContext.getInstance()?.getCurrentSession()?.endSession(!0)}stopMedia(){return new Promise(((e,t)=>{cast.framework.CastContext.getInstance()?.getCurrentSession()?.getMediaSession()?.stop(new chrome.cast.media.StopRequest,e,t)}))}toggleConnection(){(0,l.isNonNullable)(this.connection$.getValue())?this.disconnect():this.connect()}setVolume(e){let t=this.connection$.getValue();(0,l.isNullable)(t)||(t.remotePlayer.volumeLevel=e,t.remotePlayerController.setVolumeLevel())}setMuted(e){let t=this.connection$.getValue();(0,l.isNullable)(t)||e!==t.remotePlayer.isMuted&&t.remotePlayerController.muteOrUnmute()}destroy(){this.isDestroyed=!0,this.subscription.unsubscribe()}initListeners(){let e=new cast.framework.RemotePlayer,t=new cast.framework.RemotePlayerController(e),i=cast.framework.CastContext.getInstance();this.subscription.add((0,l.fromEvent)(i,cast.framework.CastContextEventType.SESSION_STATE_CHANGED).subscribe((e=>{switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTED:case cast.framework.SessionState.SESSION_STARTING:case cast.framework.SessionState.SESSION_RESUMED:this.contentId=i.getCurrentSession()?.getMediaSession()?.media?.contentId;break;case cast.framework.SessionState.NO_SESSION:case cast.framework.SessionState.SESSION_ENDING:case cast.framework.SessionState.SESSION_ENDED:case cast.framework.SessionState.SESSION_START_FAILED:this.contentId=void 0;break;default:return(0,l.assertNever)(e.sessionState)}}))).add((0,l.merge)((0,l.fromEvent)(i,cast.framework.CastContextEventType.CAST_STATE_CHANGED).pipe((0,l.tap)((e=>{this.log({message:`[cast.framework.RemotePlayerEventType.CAST_STATE_CHANGED]: ${JSON.stringify(e)}`})})),(0,l.map)((e=>e.castState))),(0,l.observableFrom)([i.getCastState()])).pipe((0,l.filterChanged)(),(0,l.map)(tr),(0,l.tap)((e=>{this.log({message:`realCastState$: ${e}`})}))).subscribe(this.realCastState$)).add(this.realCastState$.subscribe((r=>{let s="CONNECTED"===r,a=(0,l.isNonNullable)(this.connection$.getValue());if(s&&!a){let r=i.getCurrentSession();(0,l.assertNonNullable)(r);let s=r.getCastDevice(),a=r.getMediaSession()?.media?.contentId;((0,l.isNullable)(a)||a===this.contentId)&&(this.log({message:"connection created"}),this.connection$.next({remotePlayer:e,remotePlayerController:t,session:r,castDevice:s}))}else!s&&a&&(this.log({message:"connection destroyed"}),this.connection$.next(void 0));this.castState$.next("CONNECTED"===r?(0,l.isNonNullable)(this.connection$.getValue())?"CONNECTED":"AVAILABLE":r)})))}initializeCastApi(){let e,t,i;try{e=cast.framework.CastContext.getInstance(),t=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}catch{return}try{e.setOptions({receiverApplicationId:this.params.receiverApplicationId??t,autoJoinPolicy:i}),this.initListeners()}catch(e){this.errorEvent$.next({id:"ChromecastInitializer",category:l.ErrorCategory.EXTERNAL_API,message:"[initializeCastApi] failed",thrown:e})}}constructor(e){this.connection$=new l.ValueSubject(void 0),this.castState$=new l.ValueSubject("NOT_AVAILABLE"),this.errorEvent$=new l.Subject,this.realCastState$=new l.ValueSubject("NOT_AVAILABLE"),this.subscription=new l.Subscription,this.isDestroyed=!1,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastInitializer");let t="chrome"in window;if(this.log({message:`[constructor] receiverApplicationId: ${this.params.receiverApplicationId}, isDisabled: ${this.params.isDisabled}, isSupported: ${t}`}),e.isDisabled||!t)return;let r=(0,l.isNonNullable)(window.chrome?.cast),s=!!window.__onGCastApiAvailable;var a;r?this.initializeCastApi():(i._dG("__onGCastApiAvailable",(e=>{delete window.__onGCastApiAvailable,e&&!this.isDestroyed&&this.initializeCastApi()})),s||(a="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",new Promise(((e,t)=>{let i=document.createElement("script");i.setAttribute("src",a),i.onload=()=>e(),i.onerror=e=>t(e),document.body.appendChild(i)}))).catch((()=>this.errorEvent$.next({id:"ChromecastLoading",category:l.ErrorCategory.NETWORK,message:"Script loading failed!"}))))}},tr=e=>{switch(e){case cast.framework.CastState.NO_DEVICES_AVAILABLE:return"NOT_AVAILABLE";case cast.framework.CastState.NOT_CONNECTED:return"AVAILABLE";case cast.framework.CastState.CONNECTING:return"CONNECTING";case cast.framework.CastState.CONNECTED:return"CONNECTED";default:return(0,l.assertNever)(e)}},ir=(e,t=0,i=0)=>{switch(i){case 0:return e.replace("_offset_p",0===t?"":"_"+t.toFixed(0));case 1:{if(0===t)return e;let i=new URL(e);return i.searchParams.append("playback_shift",t.toFixed(0)),i.toString()}case 2:{let i=new URL(e);return i.searchParams.get("offset_p")||0!==t?(i.searchParams.set("offset_p",t.toFixed(0)),i.toString()):e}default:(0,l.assertNever)(i)}return e},rr=(e,t)=>{switch(t){case 0:return NaN;case 1:{let t=new URL(e);return Number(t.searchParams.get("playback_shift"))}case 2:{let t=new URL(e);return Number(t.searchParams.get("offset_p")??0)}default:(0,l.assertNever)(t)}},sr=e=>{let t,i,r,{source:s,format:a,meta:n,output:o}=e;switch(a){case"MPEG":{let e=s[a];(0,l.assertNonNullable)(e);let n=(0,l.getHighestQuality)(Object.keys(e));(0,l.assertNonNullable)(n);let o=e[n];(0,l.assertNonNullable)(o),t=o,i="video/mp4",r=ar();break}case"HLS":case"HLS_FMP4":case"HLS_ONDEMAND":{let e=s[a];(0,l.assertNonNullable)(e),t=e.url,i="application/x-mpegurl",r=ar();break}case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":{let e=s[a];(0,l.assertNonNullable)(e),t=e.url,i="application/dash+xml",r=ar();break}case"DASH_LIVE_CMAF":{let e=s[a];(0,l.assertNonNullable)(e),t=e.url,i="application/dash+xml",r=nr();break}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let e=s[a];(0,l.assertNonNullable)(e),t=ir(e.url),i="application/x-mpegurl",r=nr();break}case"DASH_LIVE":case"WEB_RTC_LIVE":{let e="Unsupported format for Chromecast",t=new Error(e);throw o.error$.next({id:"ChromecastProvider.createMediaInfo()",category:l.ErrorCategory.VIDEO_PIPELINE,message:e,thrown:t}),t}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${a} is no longer supported`);default:return(0,l.assertNever)(a)}let u=function(e,t){return chrome.cast?.media?.MediaInfo?new chrome.cast.media.MediaInfo(e,t):{contentId:e,contentType:t,metadata:{title:"",subtitle:""},streamType:ar()}}(n.videoId??t,i);u.contentUrl=t,u.streamType=r,u.metadata=chrome.cast?.media?.GenericMediaMetadata?new chrome.cast.media.GenericMediaMetadata:{images:[],metadataType:0,releaseDate:"",subtitle:"",title:"",releaseYear:1970,type:0};let{title:d,subtitle:c}=n;return(0,l.isNonNullable)(d)&&(u.metadata.title=d),(0,l.isNonNullable)(c)&&(u.metadata.subtitle=c),u};function ar(){return chrome.cast?.media?.StreamType?.BUFFERED??"BUFFERED"}function nr(){return chrome.cast?.media?.StreamType?.LIVE??"LIVE"}var or,lr=(e,t,i=!1)=>{let r=e.getTransition();(i||!r||r.to===t)&&e.setState(t)},ur=class{start(e=0){clearInterval(this.interval),this.startVideoPosition=e,this.startTs=Date.now(),this.interval=window.setInterval((()=>{let e=(Date.now()-this.startTs)/1e3,t=this.startVideoPosition+e;this.params.output.position$.next(t)}),1e3)}pause(){clearInterval(this.interval)}destroy(){clearInterval(this.interval)}constructor(e){this.interval=0,this.params=e}},dr=g(Ve(),1),cr=class{get current(){return this._current}get isChrome(){return"Chrome"===this.current}get isChromiumBased(){return(0,dr.default)(["Chrome","Chromium","Opera","Yandex","Edge","SamsungBrowser"],this.current)}get isFirefox(){return"Firefox"===this.current}get isSafari(){return"Safari"===this.current}get isOpera(){return"Opera"===this.current}get isEdge(){return"Edge"===this.current}get isYandex(){return"Yandex"===this.current}get isSamsungBrowser(){return"SamsungBrowser"===this.current}get currentVersion(){return this._current_version}get chromeVersion(){return this._chromeVersion}get firefoxVersion(){return this._firefoxVersion}get safariVersion(){return this._safariVersion}get operaVersion(){return this._operaVersion}get edgeVersion(){return this._edgeVersion}get yandexVersion(){return this._yandexVersion}get isMiuiBrowser(){return this._isMiuiBrowser}detect(){let{userAgent:e}=navigator;try{let t=/yabrowser/i.test(e)?"Yandex":void 0,i=/samsungbrowser/i.test(e)?"SamsungBrowser":void 0,r=/chrome|crios/i.test(e)?"Chrome":void 0,s=/chromium/i.test(e)?"Chromium":void 0,a=/firefox|fxios/i.test(e)?"Firefox":void 0,n=/webkit|safari|khtml/i.test(e)?"Safari":void 0,o=/opr\//i.test(e)?"Opera":void 0,l=/edg/i.test(e)?"Edge":void 0;this._isMiuiBrowser=/(XiaoMi)|(MiuiBrowser)/i.test(e),this._current=t||i||a||o||l||r||s||n||"Rest"}catch(e){console.error(e)}this.isChrome&&this.detectChromeVersion(),this.isFirefox&&this.detectFirefoxVersion(),this.isSafari&&this.detectSafariVersion(),this.isOpera&&this.detectOperaVersion(),this.isEdge&&this.detectEdgeVersion(),this.isYandex&&this.detectYandexVersion()}detectVersion(e){try{let{userAgent:t}=window.navigator,i=t.match(e);if(!i)return;let r=i[1],s=parseInt(r,10);if(!isNaN(s))return this._current_version=s,s}catch(e){console.error(e)}}detectChromeVersion(){this._chromeVersion=this.detectVersion(/Chrome\/(\d+\.\d+)/)}detectFirefoxVersion(){this._firefoxVersion=this.detectVersion(/Firefox\/(\d+\.\d+)/)}detectSafariVersion(){this._safariVersion=this.detectVersion(/Version\/(\d+)/)}detectOperaVersion(){this._operaVersion=this.detectVersion(/OPR\/(\d+\.\d+)/)}detectEdgeVersion(){this._edgeVersion=this.detectVersion(/Edg\/(\d+\.\d+)/)}detectYandexVersion(){this._yandexVersion=this.detectVersion(/YaBrowser\/(\d+\.\d+\.\d+)/)}constructor(){this._isMiuiBrowser=!1}},hr=g(Ve(),1),pr=()=>/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion??navigator.userAgent)||navigator?.userAgentData?.mobile,fr=class{get current(){return this._current}get os(){return this._os}get details(){return this._details}get isIOS(){return"iOS"===this._highEntropyValues.platform||this.os.name.toLowerCase().includes("ios")||(0,hr.default)(["iPhone","iPad","iPod"],this.current)}get isMac(){return"macOS"===this._highEntropyValues.platform||this.os.name.toLowerCase().includes("mac")||"Mac"===this.current}get isApple(){return this.isIOS||this.isMac}get isIphoneOrOldIpad(){if(!this.isApple||!this._displayChecker.isTouch)return!1;let e="iPad"===this.current||this._displayChecker.width>700,t=this._iosVersion;return!e||e&&!!t&&t<16}get isAndroid(){return"Android"===this._highEntropyValues.platform||this.os.name.toLowerCase().includes("android")||"Android"===this.current}get isWindows(){return this.os.name.toLowerCase().includes("windows")}get isLinux(){return this.os.name.toLowerCase().includes("linux")&&!this.isAndroid}get isMobile(){return this._highEntropyValues.mobile||this._isMobile}get iOSVersion(){return this._iosVersion}detect(){let{userAgent:e}=navigator;try{this._isMobile=pr()}catch(e){console.error("DeviceChecker: calling isMobile error - ",e)}this.detectDevice(e),this.detectOS(e),this.detectDeviceDetails(e),this.detectHighEntropyValues(),this.isIOS&&this.detectIOSVersion()}async detectHighEntropyValues(){let{userAgentData:e}=navigator;if(e?.getHighEntropyValues){let t=await e.getHighEntropyValues(["architecture","bitness","brands","mobile","platform","formFactor","model","platformVersion","wow64"]);this._highEntropyValues=t,t.platform&&(this._os.name=this.normalizeOSName(t.platform),t.platformVersion&&(this._os.version=this.normalizeOSVersion(t.platformVersion),this._os.full=`${this._os.name} ${this._os.version}`)),t.model&&(this._details.model=t.model)}}detectDevice(e){try{let t=/android/i.test(e)?"Android":void 0,i=/iphone/i.test(e)?"iPhone":void 0,r=/ipad/i.test(e)?"iPad":void 0,s=/ipod/i.test(e)?"iPod":void 0,a=/mac/i.test(e)?"Mac":void 0,n=/webOS|BlackBerry|IEMobile|Opera Mini/i.test(e)?"RestMobile":void 0;this._current=t||i||r||s||n||a||"Desktop"}catch(e){console.error("DeviceChecker: device detection error - ",e)}}detectOS(e){try{let t=[[/(windows nt) (6\.[23]); arm/i,["Windows RT"]],[/(windows nt) (6\.3); arm/i,["Windows RT 8.1"]],[/(windows (?:phone|mobile|iot))(?: os)?[/ ]?([\d.]+)/i,["Windows Mobile",2]],[/(windows)[/ ](xp|vista|7|8(\.1)?|10|11|2000|me)/i,[1,1]],[/windows nt ?([\d.]+)/i,["Windows",1]],[/(windows)[/ ](95|98|me|2000|xp|vista|7|8|8\.1|10|11)/i,[1,2]],[/(iphone os|cpu iphone os) ([\d_.]+)/i,["iOS",2]],[/(ipad os|cpu os) ([\d_.]+)/i,["iPadOS",2]],[/(ipod os|cpu ipod os) ([\d_.]+)/i,["iOS",2]],[/(?:ios|os) ([\d_.]+) like mac os x/i,["iOS",1]],[/cfnetwork\/.+darwin/i,["iOS"]],[/(mac os x) ?([\d_.]+)/i,["macOS",2]],[/(macintosh|mac os)/i,["macOS"]],[/(android) ([\d.]+)/i,[1,2]],[/(harmonyos)[/ ]?([\d.]*)/i,["HarmonyOS",2]],[/\b(ubuntu|debian|fedora|centos|arch|linux)(?:[-/ ]([\w.]+))?/i,[1,2]],[/(cros)\D*([\d.]+)/i,["Chrome OS",2]],[/(freebsd|openbsd|netbsd|dragonfly)[/ ]?([\w.]*)/i,[1,2]],[/(sunos|solaris)?([\d.]*)/i,["Solaris",2]],[/(aix)?([\d.]*)/i,["AIX",2]]];for(let[i,r]of t){let t=e.match(i);if(t){let i=r.length>0,s=r.length>1,a="Unknown",n="Unknown";if(i){let e=r[0];"number"==typeof e?e<t.length&&void 0!==t[e]&&(a=t[e]):a=e}if(s){let e=r[1];"number"==typeof e?e<t.length&&void 0!==t[e]&&(n=t[e]):void 0!==e&&(n=e)}else void 0!==t[2]?n=t[2]:void 0!==t[1]&&i&&"string"==typeof r[0]&&(n=t[1]);a=this.normalizeOSName(a),n=this.normalizeOSVersion(n,a),"iOS"===a&&/ipad/i.test(e)?a="iPadOS":"iPadOS"===a&&/ip(hone|od)/i.test(e)&&(a="iOS"),this._os={name:a,version:n||"Unknown",full:n&&"Unknown"!==n?`${a} ${n}`:a};break}}}catch(e){console.error("DeviceChecker: OS detection error - ",e)}}normalizeOSName(e){if(!e)return"Unknown";let t=e.toLowerCase();return t.includes("windows")?"Windows":t.includes("mac os")||t.includes("macintosh")?"macOS":t.includes("iphone")||t.includes("ios")?"iOS":t.includes("ipados")?"iPadOS":t.includes("android")?"Android":t.includes("harmonyos")?"HarmonyOS":t.includes("linux")?"Linux":t.includes("cros")?"Chrome OS":t.includes("freebsd")?"FreeBSD":t.includes("openbsd")?"OpenBSD":t.includes("solaris")||t.includes("sunos")?"Solaris":t.includes("aix")?"AIX":e}normalizeOSVersion(e,t){if(!e)return"Unknown";if("Unknown"!==e&&(e=e.replace(/_/g,"."),"Windows"===t)){let t=parseFloat(e);if(!isNaN(t)){if(t>=11)return"11";if(t>=10)return"10";if(6.3===t)return"8.1";if(6.2===t)return"8";if(6.1===t)return"7";if(6===t)return"Vista";if(5.1===t||5.2===t)return"XP";if(5===t)return"2000";if(4===t)return"NT 4.0"}}return e}detectDeviceDetails(e){try{let t=[[/(iphone)/i,["Apple","iPhone"]],[/(ipad)/i,["Apple","iPad"]],[/(ipod)/i,["Apple","iPod"]],[/(macintosh)/i,["Apple","Macintosh"]],[/(windows[\w\-_ ]*phone)/i,["Microsoft",0]],[/(windows nt|win64|win32|wow64)/i,["Microsoft","PC"]],[/\b(sch-i[89]0\d|shw-m380s|sm-[ptxs]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i,["Samsung",1]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?\d+a?|galaxy nexus)/i,["Samsung",1]],[/samsung[- ]((?!sm-[lr]|browser)[-\w]+)/i,["Samsung",1]],[/sec-(sgh\w+)/i,["Samsung",1]],[/smart-tv.+(samsung)/i,["Samsung","Smart TV"]],[/(samsung).*tizen/i,["Samsung","Smart TV"]],[/(pixel (?:c|tablet|[0-9a-z ]+))/i,["Google",1]],[/(pixelbook(?: go)?)/i,["Google",1]],[/nexus [0-9]/i,["Google",0]],[/(redmi[-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,["Xiaomi",1]],[/\b(mi[\w\-_ ]+)(?: bui|\))/i,["Xiaomi",1]],[/\b(poco[\w ]+)(?: bui|\))/i,["Xiaomi",1]],[/\b(hm[-_ ]?note?[\w ]*)(?: bui|\))/i,["Xiaomi",1]],[/\b(?:xiao)?mi[\w\-_ ]+pad/i,["Xiaomi",0]],[/(?:huawei|honor) ?([-\w ]+)[;)]/i,["Huawei",1]],[/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][\dc][adnt]?)\b(?!.+d\/s)/i,["Huawei",1]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?)/i,["Huawei",1]],[/(?:one)?(?:plus)? ?([a\d0]\d\d\d?)(?: b|\))/i,["OnePlus",1]],[/droid.+; (cph2[3-6]\d[13579]|((?:gm|hd)19|(?:ac|be|in|kb)20|(?:d[en]|eb|le|mt)21|ne22)[0-2]\d)(?: bui|\))/i,["OnePlus",1]],[/(oneplus)[-_ ]?([-\w]*)/i,["OnePlus",2]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i,["Realme",1]],[/(realme)[-_ ]?([-\w]*)/i,["Realme",2]],[/; (\w+) bui.+ oppo/i,["OPPO",1]],[/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i,["OPPO",1]],[/\b(opd2(\d{3}a?))(?: bui|\))/i,["OPPO",1]],[/(oppo)[-_ ]?([-\w]*)/i,["OPPO",2]],[/; vivo (\w+)(?: bui|\))/i,["Vivo",1]],[/\b(v[12]\d{3}\w?[at])(?: bui|;)/i,["Vivo",1]],[/(vivo)[-_ ]?([-\w]*)/i,["Vivo",2]],[/\bmot(?:orola)?[- ]([\w\s]+)(\)| bui)/i,["Motorola",1]],[/((?:moto(?! 360)[-\w() ]+|xt\d{3,4}[cgkosw+]?[-\d]*|nexus 6)(?= bui|\)))/i,["Motorola",1]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b/i,["Motorola",0]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i,["Motorola",0]],[/droid.+; ([a-z]?\d[0-2]{2}[a-z]{2}|[c-g]\d{4}|so[-gl]\w+|xq-[a-z]{2}\d\d)(?= bui|\))/i,["Sony",1]],[/sony tablet [ps]/i,["Sony","Xperia Tablet"]],[/\b(?:sony)?sgp\w+(?: bui|\))/i,["Sony",0]],[/(sony)[-_ ]?([-\w]*)/i,["Sony",2]],[/\blg[-e;/ ]+(?!.*(?:browser|netcast|android tv|watch|webos))(\w+)/i,["LG",1]],[/\blg-?([\d\w]+) bui/i,["LG",1]],[/(lm(?:-?f100[nv]?|-[\w.]+)(?= bui|\))|nexus [45])/i,["LG",1]],[/((?=lg)?[vl]k-?\d{3}) bui/i,["LG",0]],[/(lg)[-_ ]?([-\w]*)/i,["LG",2]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,["Nokia",1]],[/nokia[-_ ]?(([-\w. ]*?))(?: bui|\)|;|\/)/i,["Nokia",1]],[/(nokia) (t[12][01])/i,["Nokia",2]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i,["ASUS",1]],[/(?:asus[-_ ])?(zenfone[\w\-_ ]*)/i,["ASUS",1]],[/(rog[\w\-_ ]*)/i,["ASUS",1]],[/(asus)[-_ ]?([-\w]*)/i,["ASUS",2]],[/lenovo[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,["Lenovo",1]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])(?: bui|;|\)|\/)/i,["Lenovo",1]],[/(thinkpad[\w\-_ ]*)/i,["Lenovo",0]],[/(kf[a-z]{2}[a-z]*)(?: bui|\))/i,["Amazon",1]],[/(alexa)webm/i,["Amazon","Echo"]],[/(fire[\w\-_ ]*)/i,["Amazon",0]],[/(amazon)[-_ ]?([-\w]*)/i,["Amazon",2]],[/(?:blackberry|\(bb10;) (\w+)/i,["BlackBerry",1]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,["BlackBerry",1]],[/(playbook);[-\w),; ]+(rim)/i,["BlackBerry",1]],[/(microsoft); (lumia[\w ]+)/i,["Microsoft",2]],[/(surface duo)/i,["Microsoft","Surface Duo"]],[/(surface[\w\-_ ]*)/i,["Microsoft",0]],[/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,["ZTE",2]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,["HTC",2]],[/(alcatel|tcl)[-_ ]?([-\w]*)/i,[1,2]],[/(meizu)[-_ ]?([-\w]*)/i,["Meizu",2]],[/(tecno)[-_ ]?([-\w]*)/i,["Tecno",2]],[/(infinix)[-_ ]?([-\w]*)/i,["Infinix",2]],[/(micromax)[-_ ]?([-\w]*)/i,["Micromax",2]],[/(lava)[-_ ]?([-\w]*)/i,["Lava",2]],[/(panasonic)[-_ ]?([-\w]*)/i,["Panasonic",2]],[/(sharp)\/?([-\w]*)/i,["Sharp",2]],[/(benq)[-_ ]?([-\w]*)/i,["BenQ",2]],[/(palm)[-_ ]?([-\w]*)/i,["Palm",2]],[/(vertu)[-_ ]?([-\w]*)/i,["Vertu",2]],[/(gionee)[-_ ]?([-\w]*)/i,["Gionee",2]],[/(doogee)[-_ ]?([-\w]*)/i,["Doogee",2]],[/(ulefone)[-_ ]?([-\w]*)/i,["Ulefone",2]],[/(blackview)[-_ ]?([-\w]*)/i,["Blackview",2]],[/(cubot)[-_ ]?([-\w]*)/i,["Cubot",2]],[/(umidigi)[-_ ]?([-\w]*)/i,["UMIDIGI",2]],[/(oukitel)[-_ ]?([-\w]*)/i,["Oukitel",2]],[/(fairphone)[-_ ]?([-\w]*)/i,["Fairphone",2]],[/(cat)[-_ ]?([-\w]*)/i,["Cat",2]],[/(energy)[-_ ]?([-\w]*)/i,["Energizer",2]],[/(land rover)[-_ ]?([-\w]*)/i,["Land Rover",2]],[/(shield[\w\-_ ]*)/i,["Nvidia",0]],[/(crkey)/i,["Google","Chromecast"]],[/(roku)[\dx]*/i,["Roku",0]],[/(apple)[-_ ]?tv/i,["Apple","TV"]],[/(amazon)[-_ ]?tv/i,["Amazon","Fire TV"]],[/(google)[-_ ]?tv/i,["Google","TV"]],[/(smart[\w\-_ ]*tv)/i,[0,"Smart TV"]],[/(playstation[\w\-_ ]*)/i,["Sony",0]],[/(nintendo[\w\-_ ]*)/i,["Nintendo",0]],[/(xbox[\w\-_ ]*)/i,["Microsoft",0]],[/(googlebot)/i,["Google","Bot"]],[/(bingbot)/i,["Microsoft","Bing Bot"]],[/(yandexbot)/i,["Yandex","Bot"]],[/(slackbot)/i,["Slack","Bot"]],[/(twitterbot)/i,["Twitter","Bot"]],[/(facebookbot)/i,["Facebook","Bot"]],[/(linkedinbot)/i,["LinkedIn","Bot"]],[/(tesla)[-_ ]?([-\w]*)/i,["Tesla",2]],[/(raspberry[\w\-_ ]*)/i,["Raspberry Pi",0]]];for(let[i,r]of t){let t=e.match(i);if(t){let e=r[0],i=r[1],s="number"==typeof e?void 0!==t[e]?this.normalizeVendorName(t[e]):"Unknown":this.normalizeVendorName(e),a="Unknown";"number"==typeof i?a=void 0!==t[i]?t[i]:"Unknown":void 0!==i?a=i:void 0!==t[1]?a=t[1]:void 0!==t[0]&&(a=t[0]),a=this.normalizeModelName(a,s),this.details.vendor=s,this.details.model=a;break}}}catch(e){console.error("DeviceChecker: device details detection error - ",e)}}normalizeVendorName(e){if(!e)return"Unknown";return{apple:"Apple",samsung:"Samsung",google:"Google",xiaomi:"Xiaomi",huawei:"Huawei",oneplus:"OnePlus",oppo:"OPPO",vivo:"Vivo",realme:"Realme",motorola:"Motorola",sony:"Sony",lg:"LG",nokia:"Nokia",asus:"ASUS",lenovo:"Lenovo",amazon:"Amazon",blackberry:"BlackBerry",microsoft:"Microsoft",zte:"ZTE",htc:"HTC",alcatel:"Alcatel",tcl:"TCL",meizu:"Meizu",tecno:"Tecno",infinix:"Infinix",micromax:"Micromax",lava:"Lava",panasonic:"Panasonic",sharp:"Sharp",benq:"BenQ",palm:"Palm",honor:"Honor",nvidia:"NVIDIA",roku:"Roku"}[e.toLowerCase()]||e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}normalizeModelName(e,t){if(!e||"Unknown"===e)return e;if("0"===e)return"Unknown";let i=e.replace(/^build\//i,"").replace(/\s+bui$/i,"").replace(/\)$/,"").replace(/[;,)]/g,"").replace(/\s*\(.*?\)\s*/g,"").trim(),r=t.toLowerCase();return r.includes("samsung")?i=i.replace(/^(sm-|gt-|sgh-|sch-)/i,""):r.includes("xiaomi")?i=i.replace(/^(mi[\s\-_]*|redmi[\s\-_]*)/i,""):r.includes("oneplus")?i=i.replace(/^oneplus[\s\-_]*/i,""):r.includes("google")&&(i=i.replace(/^(pixel[\s\-_]*|nexus[\s\-_]*)/i,"")),i=i.replace(/_/g," ").replace(/-/g," ").replace(/\s+/g," ").trim(),i?(i.length>0&&/^[a-z]/.test(i)&&(i=i.charAt(0).toUpperCase()+i.slice(1)),i):"Unknown"}detectIOSVersion(){try{if(this._highEntropyValues.platformVersion){let e=this._highEntropyValues.platformVersion.split(".").slice(0,2).join(".");return void(this._iosVersion=parseFloat(e))}if("Unknown"!==this._os.version){let e=this._os.version.split("."),t=e.length>=2?`${e[0]}.${e[1]}`:e[0];return void(this._iosVersion=parseFloat(t))}let e=navigator.userAgent.match(/OS (\d+(_\d+)?)/i);e?.[1]&&(this._iosVersion=parseFloat(e[1].replace(/_/g,".")))}catch(e){console.error("DeviceChecker: iOS version detection error - ",e)}}constructor(e){this._highEntropyValues={},this._os={name:"Unknown",version:"Unknown",full:"Unknown"},this._details={vendor:"Unknown",model:"Unknown"},this._displayChecker=e}},mr=class{get isTouch(){return"number"==typeof this._maxTouchPoints?this._maxTouchPoints>1:"ontouchstart"in window}get maxTouchPoints(){return this._maxTouchPoints}get height(){return this._height}get width(){return this._width}get screenHeight(){return this._screenHeight}get screenWidth(){return this._screenWidth}get pixelRatio(){return this._pixelRatio}get isHDR(){return this._isHdr}get colorDepth(){return this._colorDepth}detect(){let{maxTouchPoints:e}=navigator;try{this._maxTouchPoints=e??0,this._isHdr=!!matchMedia("(dynamic-range: high)")?.matches,this._colorDepth=screen.colorDepth}catch(e){console.error(e)}try{this._pixelRatio=window.devicePixelRatio||1,this._height=screen.height,this._width=screen.width,this._height=screen.height,this._screenHeight=this._height*this._pixelRatio,this._screenWidth=this._width*this._pixelRatio}catch(e){console.error(e)}}},gr=()=>window.ManagedMediaSource||window.MediaSource,vr=()=>!(!window.ManagedMediaSource||!window.ManagedSourceBuffer?.prototype?.appendBuffer),br=()=>window.ManagedMediaSource?new ManagedMediaSource:new MediaSource,yr=document.createElement("video"),Sr='video/webm; codecs="vp09.00.10.08"',wr='video/webm; codecs="av01.0.00M.08"';(async()=>{if(!window.navigator.mediaCapabilities)return;let e={type:"media-source",video:{contentType:"video/webm",width:1280,height:720,bitrate:1e6,framerate:30}},[t,i]=await Promise.all([window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:wr}}),window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:Sr}})]);or={DASH_WEBM_AV1:t,DASH_WEBM:i}})().catch((e=>{console.log(yr),console.error(e)}));var $r=class{get protocols(){return this._protocols}get containers(){return this._containers}get codecs(){return this._codecs}get webmDecodingInfo(){return or}get supportedCodecs(){return Object.keys(this._codecs).filter((e=>this._codecs[e]))}get nativeHlsSupported(){return this._nativeHlsSupported}detect(){this._video=document.createElement("video");try{this._protocols={mms:vr(),mse:!(!window.MediaSource||!window.SourceBuffer?.prototype?.appendBuffer),hls:!(!this._video.canPlayType?.("application/x-mpegurl")&&!this._video.canPlayType?.("vnd.apple.mpegURL")),webrtc:!!window.RTCPeerConnection,ws:!!window.WebSocket},this._containers={mp4:!!this._video.canPlayType?.("video/mp4"),webm:!!this._video.canPlayType?.("video/webm"),cmaf:!0};let e=!!gr()?.isTypeSupported?.('video/mp4; codecs="avc1.42000a,mp4a.40.2"'),t=!!gr()?.isTypeSupported?.('video/mp4; codecs="hev1.1.6.L93.B0"'),i=!!gr()?.isTypeSupported?.('audio/mp4; codecs="mp4a.40.2"');this._codecs={h264:e,h265:t,vp9:!!gr()?.isTypeSupported?.(Sr),av1:!!gr()?.isTypeSupported?.(wr),aac:i,opus:!!gr()?.isTypeSupported?.('audio/webm; codecs="opus"'),mpeg:(e||t)&&i},this._nativeHlsSupported=this._protocols.hls&&this._containers.mp4}catch(e){console.error(e)}try{this.destroyVideoElement()}catch(e){console.error("Error destroying video element:",e)}}destroyVideoElement(){if(!this._video)return;if(this._video.pause(),this._video.currentTime=0,this._video.removeAttribute("src"),this._video.src="",this._video.load(),this._video.remove)return this._video.remove(),void(this._video=null);this._video.parentNode&&this._video.parentNode.removeChild(this._video);let e=this._video.cloneNode(!1);this._video.parentNode?.replaceChild(e,this._video),this._video=null}constructor(e,t){this._deviceChecker=e,this._browserChecker=t}},xr="audio/mpeg",kr=class{supportMp3(){return this._codecs.mp3&&this._containers.mpeg}detect(){this._audio=document.createElement("audio");try{this._containers={mpeg:!!this._audio.canPlayType?.(xr)},this._codecs={mp3:!!gr()?.isTypeSupported?.(xr)}}catch(e){console.error(e)}try{this.destroyAudioElement()}catch(e){console.error("Error destroying audio element:",e)}}destroyAudioElement(){if(!this._audio)return;if(this._audio.pause(),this._audio.currentTime=0,this._audio.removeAttribute("src"),this._audio.src="",this._audio.load(),this._audio.remove)return this._audio.remove(),void(this._audio=null);this._audio.parentNode&&this._audio.parentNode.removeChild(this._audio);let e=this._audio.cloneNode(!1);this._audio.parentNode?.replaceChild(e,this._audio),this._audio=null}},Tr=new class{get display(){return this._displayChecker}get device(){return this._deviceChecker}get browser(){return this._browserChecker}get video(){return this._videoChecker}get audio(){return this._audioChecker}async detect(){this._displayChecker.detect(),this._deviceChecker.detect(),this._browserChecker.detect(),this._videoChecker.detect(),this._audioChecker.detect(),this.isInited$.next(!0)}constructor(){this.isInited$=new l.ValueSubject(!1),this._displayChecker=new mr,this._deviceChecker=new fr(this._displayChecker),this._browserChecker=new cr,this._videoChecker=new $r(this._deviceChecker,this._browserChecker),this._audioChecker=new kr,this.detect()}},_r=e=>{let{containers:t,protocols:i,codecs:r,nativeHlsSupported:s}=Tr.video,a=(r.h264||r.h265)&&r.aac,n=i.mse||i.mms;return e.filter((e=>{switch(e){case"DASH_SEP":case"DASH_LIVE":case"DASH_ONDEMAND":return n&&t.mp4&&a;case"DASH_WEBM":return n&&t.webm&&r.vp9&&r.opus;case"DASH_WEBM_AV1":return n&&t.webm&&r.av1&&r.opus;case"DASH_STREAMS":return n&&(t.mp4&&a||t.webm&&(r.vp9||r.av1)&&(r.opus||r.aac));case"DASH_LIVE_CMAF":return n&&t.mp4&&a&&t.cmaf;case"HLS":case"HLS_ONDEMAND":case"HLS_FMP4":case"HLS_LIVE":case"HLS_LIVE_CMAF":return s;case"MPEG":return t.mp4;case"DASH":case"DASH_LIVE_WEBM":return!1;case"WEB_RTC_LIVE":return i.webrtc&&i.ws&&r.h264&&(t.mp4||t.webm);default:return(0,l.assertNever)(e)}}))},Cr=e=>{switch(e){case"MPEG":case"DASH":case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":case"HLS":case"HLS_FMP4":case"HLS_ONDEMAND":return!1;case"DASH_LIVE":case"DASH_LIVE_CMAF":case"HLS_LIVE":case"HLS_LIVE_CMAF":case"DASH_LIVE_WEBM":case"WEB_RTC_LIVE":return!0;default:return(0,l.assertNever)(e)}},Er=e=>{let t=Object.keys(e).filter((e=>!Cr(e)));return _r(t).length>0},Ar=class{subscribe(){let e=e=>{this.params.output.error$.next({category:l.ErrorCategory.WTF,id:"ChromecastPresentationApiProvider",message:e?.message??"Unknown error",thrown:e})};this.subscription.add(this.params.chromecastConnector.message$.pipe((0,l.filter)((e=>!!e))).subscribe((e=>{this.handleMessage(e)}),e)),this.subscription.add(this.sessionId$.pipe((0,l.filter)(l.isNonNullable),(0,l.filterChanged)(),(0,l.debounce)(0)).subscribe((()=>{this.loadMedia()}),e));let t=this.contentId$.pipe((0,l.filterChanged)(),(0,l.map)(Boolean));this.subscription.add((0,l.combine)({seekState:this.params.desiredState.seekState.stateChangeEnded$,mediaLoaded:t}).pipe((0,l.filter)((({mediaLoaded:e})=>e))).subscribe((()=>{let e=this.params.desiredState.seekState.getState();"requested"===e.state&&this.seek(e.position/1e3)}),e));let i=(0,l.combine)({playbackState:this.params.desiredState.playbackState.stateChangeStarted$,mediaLoaded:t});this.subscription.add(i.pipe((0,l.filter)((({mediaLoaded:e})=>e)),(0,l.debounce)(0)).subscribe((()=>{this.syncPlayback()}),e)),this.subscription.add(i.pipe((0,l.filter)((({mediaLoaded:e,playbackState:{from:t,to:i}})=>!e&&"stopped"===t&&"playing"===i))).subscribe((()=>{this.loadMedia()}),e)),this.subscription.add((0,l.combine)({volumeState:this.params.desiredState.volume.stateChangeStarted$.pipe((0,l.debounce)(30)),mediaLoaded:t}).pipe((0,l.filter)((({mediaLoaded:e})=>e))).subscribe((({volumeState:e})=>{let{muted:t,volume:i}=e.to;this.setVolume(i,t)}),e))}handleMessage(e){switch(e.type){case"new_session":case"update_session":{this.sessionId$.next(e.message.sessionId);let t=e.message?.media?.[0];this.syncMediaState(t);let i=e.message?.receiver.volume;this.syncVolumeState(i)}break;case"v2_message":switch(e.message?.type){case"MEDIA_STATUS":{let t=e.message?.status?.[0];this.syncMediaState(t);break}}}}loadMedia(){let e=sr(this.params),t=this.media?.currentTime,i=this.params.desiredState.seekState.getState(),r=t??("none"!==i.state?i.position/1e3:0),s="playing"===this.params.desiredState.playbackState.getState();this.params.chromecastConnector.sendV2Message({type:"LOAD",requestId:0,media:e,autoplay:s,currentTime:r,customData:null,activeTrackIds:null}),this.params.output.willSeekEvent$.next()}stop(){this.params.chromecastConnector.stopMedia()}play(){let e=this.mediaSessionId$.getValue();(0,l.assertNonNullable)(e,"play on null mediaSessionId"),this.params.chromecastConnector.sendV2Message({type:"PLAY",mediaSessionId:e,customData:null})}pause(){let e=this.mediaSessionId$.getValue();(0,l.assertNonNullable)(e,"pause on null mediaSessionId"),this.params.chromecastConnector.sendV2Message({type:"PAUSE",mediaSessionId:e,customData:null})}seek(e){let t=this.mediaSessionId$.getValue();(0,l.assertNonNullable)(t,"seek on null mediaSessionId"),this.params.chromecastConnector.sendV2Message({type:"SEEK",currentTime:e,mediaSessionId:t}),this.params.output.willSeekEvent$.next()}setVolume(e,t){let i=e,r=`[setVolume] volume: ${e}, muted: ${t}`;this.isMobile&&(i=this.mobileVolumeState.volume,r+=`, mobile next volume: ${i}`),this.log({message:r}),this.lastRequestedVolume={volume:i,muted:t},this.params.chromecastConnector.sendV2Message({type:"SET_VOLUME",requestId:0,volume:{level:t?0:i,muted:!!t||null}})}syncPlaybackState({playerState:e,idleReason:t}){let i="BUFFERING"===e;switch(this.params.output.isBuffering$.getValue()!==i&&this.params.output.isBuffering$.next(i),e){case"PAUSED":lr(this.params.desiredState.playbackState,"paused");break;case"PLAYING":lr(this.params.desiredState.playbackState,"playing");break;case"IDLE":"FINISHED"===t?(this.params.output.endedEvent$.next(),lr(this.params.desiredState.playbackState,"stopped"),this.contentId$.next(null)):lr(this.params.desiredState.playbackState,"ready")}}syncPlayback(){let e=this.params.desiredState.playbackState.getState();switch(this.log({message:`[syncPlayback] ${e}`}),e){case"ready":break;case"playing":this.play();break;case"paused":this.pause();break;case"stopped":this.stop()}}syncVolumeState(e){if((0,l.isNullable)(e))return;let{level:t,muted:i}=e,r={muted:i??!1,volume:t??0};this.lastRequestedVolume&&(i&&(r.volume=this.lastRequestedVolume.volume),this.lastRequestedVolume.muted&&!t&&!i&&(r.volume=this.lastRequestedVolume.volume,r.muted=!0),this.lastRequestedVolume=null);let s=`[syncVolumeState] volume: ${r.volume}, muted: ${r.muted}`;this.isMobile&&(this.mobileVolumeState.volume=r.volume,this.mobileVolumeState.muted=r.muted,r.volume=this.params.output.volume$.getValue().volume,s+=`, volume passed to state machine: ${r.volume}`),this.log({message:s}),this.params.output.volume$.next(r)}destroy(){this.progressTicker.destroy(),this.subscription.unsubscribe()}constructor(e){this.subscription=new l.Subscription,this.sessionId$=new l.ValueSubject(null),this.mediaSessionId$=new l.ValueSubject(null),this.contentId$=new l.ValueSubject(null),this.isMobile=pr(),this.mobileVolumeState={muted:!1,volume:0},this.media=null,this.lastRequestedVolume=null,this.syncMediaState=e=>{if((0,l.isNullable)(e))return;this.media=e,this.mediaSessionId$.next(e.mediaSessionId??null);let t=e.media?.contentId;t&&this.contentId$.next(t),this.syncPlaybackState(e);let i=e.media?.duration;(0,l.isNonNullable)(i)&&this.params.output.duration$.next(Math.max(0,i));let r=e.currentTime;if((0,l.isNonNullable)(r)){"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.params.output.position$.next(r);let t=this.params.output.isLive$.getValue();"PLAYING"!==e.playerState||t?this.progressTicker.pause():this.progressTicker.start(r)}},this.params=e,this.progressTicker=new ur(e),this.log=this.params.dependencies.logger.createComponentLog("ChromecastPresentationApiProvider"),this.log({message:`constructor, format: ${e.format}`}),this.params.output.isLive$.next(Cr(e.format)),this.subscribe()}},Lr=class{destroy(){this.log({message:"destroy"}),this.subscription.unsubscribe(),this.subscriptionEvents.unsubscribe(),this.broadcastChannel.close(),this.isDestroyed=!0}disconnect(e=!0){this.log({message:"disconnect"}),e&&this.stopMedia(),this.presentationRequest$.next(null);let t=this.presentationConnection$.getValue();t&&t.close(),this.presentationConnection$.next(null),this.friendlyName$.next(null),this.resetSequenceNumber(),this.resetSubscriptionEvents()}stopMedia(){this.log({message:"stopMedia"}),this.sendV2Message({type:"STOP"})}reinitPresentation(e=!0){let t=this.createCastUrl(),i=new PresentationRequest(t);this.presentationRequest$.next(i),this.log({message:"PresentationRequest created"}),i.getAvailability().then((e=>{let t=()=>{this.log({message:`PresentationRequest presentation availability: ${e.value}`}),this.presentationAvailable$.next(e.value)};this.subscriptionEvents.add((0,l.fromEvent)(e,"change").subscribe((()=>{t()}))),t()})).catch((()=>{this.presentationAvailable$.next(!0)})),window.navigator.presentation.defaultRequest=i,e&&i.reconnect("auto-join").then((e=>{this.log({message:"PresentationRequest reconnect success"}),this.handleConnection(e)})).catch((()=>{this.log({message:"PresentationRequest reconnect failed"})}))}async connect(){this.log({message:"connect"});try{this.presentationRequest$.getValue()||(this.log({message:"reinitPresentation"}),this.reinitPresentation(!1));let e=this.presentationRequest$.getValue();(0,l.assertNonNullable)(e,"connect with null presentationRequest");let t=await e.start();this.handleConnection(t)}catch(e){switch(e?.name){case"AbortError":case"NotAllowedError":break;default:this.errorEvent$.next({category:l.ErrorCategory.WTF,id:"ChromecastPresentationApiConnector",message:e?.message??"connect error",thrown:e})}}}subscribe(){this.subscription.add((0,l.fromEvent)(this.broadcastChannel,"message").subscribe((e=>{this.log({message:`broadcast connection data: ${e.data}`}),"connection"===e.data&&this.disconnect(!1)}))),this.subscription.add(this.presentationAvailable$.subscribe((e=>{this.log({message:`presentationAvailable$: ${e}`})}))),this.subscription.add(this.presentationConnection$.pipe((0,l.tap)((e=>{this.log({message:`presentationConnection$: ${!!e}`})})),(0,l.filter)((e=>!!e))).subscribe((e=>{let t=(0,l.fromEvent)(e,"message").subscribe((e=>{let t=JSON.parse(e.data);t.clientId===this.clientId&&(this.log({message:`[onmessage] ${e.data}`}),this.handleMessage(t),this.message$.next(t))})),i=(0,l.fromEvent)(e,"connect").subscribe((()=>{this.send("client_connect")})),r=(0,l.fromEvent)(e,"close").subscribe((e=>{if("error"===e.reason)this.errorEvent$.next({category:l.ErrorCategory.WTF,id:"ChromecastPresentationApiConnector",message:"Session error",thrown:e})}));this.subscriptionEvents.add(t),this.subscriptionEvents.add(i),this.subscriptionEvents.add(r)})))}send(e){switch(e){case"client_connect":{let e={type:"client_connect",message:this.clientId,sequenceNumber:-1,timeoutMillis:0,clientId:this.clientId};this.safeSend(JSON.stringify(e));break}}}sendV2Message(e){let t=this.sessionId$.getValue();if(t){let i={type:"v2_message",sequenceNumber:this.getSequenceNumber(),timeoutMillis:0,clientId:this.clientId,message:{...e,sessionId:t}};this.safeSend(JSON.stringify(i))}}safeSend(e){try{this.log({message:`[send] ${e}`});let t=this.presentationConnection$.getValue();"connected"===t?.state&&t?.send(e)}catch(t){this.errorEvent$.next({category:l.ErrorCategory.WTF,id:"ChromecastPresentationApiConnector",message:"PresentationConnection send error",data:{message:e},thrown:t})}}handleMessage(e){switch(e.type){case"new_session":case"update_session":this.sessionId$.next(e.message.sessionId),this.friendlyName$.next(e.message.receiver.friendlyName||"Chromecast Device");break;case"receiver_action":"stop"===e.message?.action&&this.disconnect()}}createCastUrl(){return`cast:${this.params.appId}?clientId=${this.clientId}&autoJoinPolicy=tab_and_origin_scoped&defaultActionPolicy=create_session&launchTimeout=60000&supportedAppTypes=${this.capabilities}&appParams=%7B%22launchCheckerParams%22%3A%7B%7D%7D`}getSequenceNumber(){let e=this.sequenceNumber;return this.sequenceNumber=(this.sequenceNumber+1)%Number.MAX_SAFE_INTEGER,e}resetSequenceNumber(){this.sequenceNumber=0}getClientId(){let e="__vk_player_chromecast_id";return window[e]=window[e]||String(Date.now())+String(Math.floor(1e5*Math.random()))}resetSubscriptionEvents(){this.subscriptionEvents.unsubscribe(),this.subscriptionEvents=new l.Subscription}handleConnection(e){this.log({message:"connection available"}),this.isDestroyed?(this.log({message:"connected on already destroyed component"}),e.close()):(this.broadcastChannel.postMessage("connection"),this.presentationConnection$.next(e))}constructor(e){this.capabilities=["WEB"],this.presentationRequest$=new l.ValueSubject(null),this.sessionId$=new l.ValueSubject(null),this.broadcastChannel=new BroadcastChannel("vk_player_chromecast_events"),this.subscription=new l.Subscription,this.subscriptionEvents=new l.Subscription,this.isDestroyed=!1,this.sequenceNumber=0,this.presentationAvailable$=new l.ValueSubject(!1),this.presentationConnection$=new l.ValueSubject(null),this.message$=new l.ValueSubject(null),this.friendlyName$=new l.ValueSubject(null),this.errorEvent$=new l.Subject,this.clientId=this.getClientId(),this.params=e,this.log=e.logger.createComponentLog("ChromecastPresentationApiConnector"),this.log({message:"constructor"}),this.reinitPresentation(),this.subscribe()}},Pr=class e{static isSupported(){return"chrome"in window&&"presentation"in navigator&&"BroadcastChannel"in window}subscribe(){(0,l.assertNonNullable)(this.chromecastConnector,"subscribe with null chromecastConnector"),this.subscription.add(this.chromecastConnector.errorEvent$.subscribe(this.errorEvent$));let e=(0,l.combine)({connection:this.chromecastConnector.presentationConnection$,available:this.chromecastConnector.presentationAvailable$,friendlyName:this.chromecastConnector.friendlyName$.pipe((0,l.filterChanged)())});this.subscription.add(e.pipe((0,l.map)((({connection:e,friendlyName:t})=>!(!e||!t))),(0,l.filterChanged)()).subscribe((e=>{let t=this.chromecastConnector?.friendlyName$.getValue()??"";this.connection$.next(e?(e=>({castDevice:{friendlyName:e},remotePlayer:{},remotePlayerController:{},session:{}}))(t):void 0)}))).add(e.subscribe((({available:e,connection:t})=>{e?t?this.castState$.next("CONNECTED"):this.castState$.next("AVAILABLE"):this.castState$.next("NOT_AVAILABLE")})))}connect(){this.log({message:"connect"}),this.chromecastConnector?.connect()}disconnect(){this.log({message:"disconnect"}),this.chromecastConnector?.disconnect()}async stopMedia(){this.log({message:"stopMedia"}),this.chromecastConnector?.stopMedia()}toggleConnection(){let e=!!this.chromecastConnector?.presentationConnection$.getValue();this.log({message:`toggleConnection: isConnected - ${e}`}),e?this.disconnect():this.connect()}setVolume(e){}setMuted(e){}destroy(){this.log({message:"destroy"}),this.chromecastConnector?.destroy(),this.subscription.unsubscribe()}constructor(t){this.subscription=new l.Subscription,this.connection$=new l.ValueSubject(void 0),this.castState$=new l.ValueSubject("NOT_AVAILABLE"),this.errorEvent$=new l.Subject;let i=e.isSupported();this.log=t.dependencies.logger.createComponentLog("ChromecastPresentationApiInitializer"),this.log({message:`[constructor] receiverApplicationId: ${t.receiverApplicationId}, isDisabled: ${t.isDisabled}, isSupported: ${i}`}),i&&!t.isDisabled&&t.receiverApplicationId&&(this.chromecastConnector=new Lr({appId:t.receiverApplicationId,logger:t.dependencies.logger}),this.subscribe())}},Mr=g(Ve(),1),Ir=g(Oe(),1),Rr=g(bt(),1),Vr=g(ii(),1),Nr=class{setState(e){let t=this.transition,i=this.state;this.transition=void 0,this.prevState=i,this.state=e,t?t.to===e?this.transitionEnded$.next(t):this.forceChanged$.next({from:t.from,to:e,canceledTransition:t}):this.forceChanged$.next({from:i,to:e,canceledTransition:t})}startTransitionTo(e){let t=this.transition,i=this.state;i===e||(0,l.isNonNullable)(t)&&t.to===e||(this.prevState=i,this.state=e,t?(this.transition={from:t.from,to:e,canceledTransition:t},this.transitionUpdated$.next(this.transition)):(this.transition={from:i,to:e},this.transitionStarted$.next(this.transition)))}getTransition(){return this.transition}getState(){return this.state}getPrevState(){return this.prevState}constructor(e){this.transitionStarted$=new l.Subject,this.transitionEnded$=new l.Subject,this.transitionUpdated$=new l.Subject,this.forceChanged$=new l.Subject,this.stateChangeStarted$=(0,l.merge)(this.transitionStarted$,this.transitionUpdated$),this.stateChangeEnded$=(0,l.merge)(this.transitionEnded$,this.forceChanged$),this.state=e,this.prevState=void 0}},Br=class{destroy(){this.log({message:"[destroy]"}),this.subscription.unsubscribe()}subscribe(){this.subscription.add(this.loadMediaTimeoutSubscription);let e=new l.Subscription;this.subscription.add(e),this.subscription.add((0,l.merge)(this.videoState.stateChangeStarted$.pipe((0,l.map)((e=>`stateChangeStarted$ ${JSON.stringify(e)}`))),this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>`stateChangeEnded$ ${JSON.stringify(e)}`)))).subscribe((e=>this.log({message:`[videoState] ${e}`}))));let t=(e,t)=>this.subscription.add(e.subscribe(t));if(this.params.output.isLive$.getValue())this.params.output.position$.next(0),this.params.output.duration$.next(0);else{let t=new l.Subject;e.add(t.pipe((0,l.debounce)(500)).subscribe((()=>{this.params.output.seekedEvent$.next()})));let i=NaN;e.add((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED).subscribe((e=>{this.logRemoteEvent(e);let r=e.value;this.params.output.position$.next(r),("applying"===this.params.desiredState.seekState.getState().state||Math.abs(r-i)>5)&&t.next(r),i=r}))),e.add((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED).subscribe((e=>{this.logRemoteEvent(e),this.params.output.duration$.next(e.value)})))}t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED),(t=>{this.logRemoteEvent(t),t.value?this.handleRemoteReady():(this.handleRemoteStop(),e.unsubscribe())})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED),(e=>{this.logRemoteEvent(e),e.value?this.handleRemotePause():this.handleRemotePlay()})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED),(e=>{this.logRemoteEvent(e);let{remotePlayer:t}=this.params.connection,i=e.value,r=this.params.output.isBuffering$.getValue(),s=i===chrome.cast.media.PlayerState.BUFFERING;switch(r!==s&&this.params.output.isBuffering$.next(s),i){case chrome.cast.media.PlayerState.IDLE:!this.params.output.isLive$.getValue()&&t.duration-t.currentTime<5&&this.params.output.endedEvent$.next(),this.handleRemoteStop(),lr(this.params.desiredState.playbackState,"stopped");break;case chrome.cast.media.PlayerState.PAUSED:this.handleRemotePause();break;case chrome.cast.media.PlayerState.PLAYING:this.handleRemotePlay();break;case chrome.cast.media.PlayerState.BUFFERING:break;default:(0,l.assertNever)(i)}})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({volume:e.value})})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({muted:e.value})})),t((0,l.merge)(this.params.desiredState.playbackState.stateChangeStarted$,this.params.desiredState.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0)),this.syncPlayback)}restoreSession(e){this.log({message:"restoreSession"});let{remotePlayer:t}=this.params.connection;if(e.playerState!==chrome.cast.media.PlayerState.IDLE){t.isPaused?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):(this.videoState.setState("playing"),lr(this.params.desiredState.playbackState,"playing"));let e=this.params.output.isLive$.getValue();this.params.output.duration$.next(e?0:t.duration),this.params.output.position$.next(e?0:t.currentTime),this.params.desiredState.seekState.setState({state:"none"})}}prepare(){let e=this.params.format;this.log({message:`[prepare] format: ${e}`});let t=sr(this.params),i=this.createLoadRequest(t);this.loadMedia(i)}handleRemotePause(){let e=this.videoState.getState();("paused"===this.videoState.getTransition()?.to||"playing"===e)&&(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused"))}handleRemotePlay(){let e=this.videoState.getState();("playing"===this.videoState.getTransition()?.to||"paused"===e)&&(this.videoState.setState("playing"),lr(this.params.desiredState.playbackState,"playing"))}handleRemoteReady(){"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"ready"===this.params.desiredState.playbackState.getTransition()?.to&&lr(this.params.desiredState.playbackState,"ready")}handleRemoteStop(){"stopped"!==this.videoState.getState()&&this.videoState.setState("stopped")}handleRemoteVolumeChange(e){let t=this.params.output.volume$.getValue(),i={volume:e.volume??t.volume,muted:e.muted??t.muted};(i.volume!==t.volume||i.muted!=i.muted)&&this.params.output.volume$.next(i)}seek(e){this.params.output.willSeekEvent$.next();let{remotePlayer:t,remotePlayerController:i}=this.params.connection;t.currentTime=e,i.seek()}stop(){let{remotePlayerController:e}=this.params.connection;e.stop()}createLoadRequest(e){let t=new chrome.cast.media.LoadRequest(e);t.autoplay=!1;let i=this.params.desiredState.seekState.getState();return"applying"===i.state||"requested"===i.state?t.currentTime=this.params.output.isLive$.getValue()?0:i.position/1e3:t.currentTime=0,t}loadMedia(e){let t=this.params.connection.session.loadMedia(e),i=new Promise(((e,t)=>{this.loadMediaTimeoutSubscription.add((0,l.timeout)(7e3).subscribe((()=>t("timeout(7000)"))))}));(0,Vr.default)(Promise.race([t,i]).then((()=>{this.log({message:`[loadMedia] completed, format: ${this.params.format}`}),"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.handleRemoteReady()}),(e=>{let t=`[prepare] loadMedia failed, format: ${this.params.format}, reason: ${e}`;this.log({message:t}),this.params.output.error$.next({id:"ChromecastProvider.loadMedia",category:l.ErrorCategory.VIDEO_PIPELINE,message:t,thrown:e})})),(()=>{this.loadMediaTimeoutSubscription.unsubscribe()}))}logRemoteEvent(e){this.log({message:`[remoteEvent] ${JSON.stringify(e)}`})}constructor(e){this.subscription=new l.Subscription,this.loadMediaTimeoutSubscription=new l.Subscription,this.videoState=new Nr("stopped"),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),s=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; desiredPlaybackStateTransition: ${this.params.desiredState.playbackState.getTransition()}; seekState: ${JSON.stringify(s)};`}),"stopped"!==i){if(!t){if("paused"!==r?.to&&"requested"===s.state&&"stopped"!==e)return void this.seek(s.position/1e3);switch(i){case"ready":switch(e){case"playing":case"paused":case"ready":break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,l.assertNever)(e)}break;case"playing":switch(e){case"playing":break;case"paused":case"ready":this.videoState.startTransitionTo("playing"),this.params.connection.remotePlayerController.playOrPause();break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,l.assertNever)(e)}break;case"paused":switch(e){case"playing":this.videoState.startTransitionTo("paused"),this.params.connection.remotePlayerController.playOrPause();break;case"paused":break;case"ready":this.videoState.startTransitionTo("paused"),this.videoState.setState("paused");break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,l.assertNever)(e)}break;default:(0,l.assertNever)(i)}}}else"stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.stop())},this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastProvider"),this.log({message:`constructor, format: ${e.format}`}),this.params.output.isLive$.next(Cr(e.format)),this.params.output.isAudioAvailable$.next(!0),this.handleRemoteVolumeChange({volume:this.params.connection.remotePlayer.volumeLevel,muted:this.params.connection.remotePlayer.isMuted});let t=this.params.connection.session.getMediaSession();t&&this.restoreSession(t),this.subscribe()}},Dr=g(Ve(),1),Or=window.WeakMap?new WeakMap:new class{get(e){return e.hasAttribute(this.attribute)}set(e,t){e.toggleAttribute(this.attribute,t)}delete(e){e.removeAttribute(this.attribute)}constructor(){this.attribute="data-pool-reused"}},Fr=window.WeakMap?new WeakMap:new Map,jr=(e,{audioVideoSyncRate:t,disableYandexPiP:i})=>{let r=e.querySelector("video"),s=!!r;r?(0,l.clearVideoElement)(r):(r=document.createElement("video"),e.appendChild(r)),Or.set(r,s);let a=new l.Subscription;return a.add(((e,t=20)=>{let i=0;return(0,l.fromEvent)(e,"ratechange").subscribe((r=>{i++,i>=t&&(e.currentTime=e.currentTime,i=0)}))})(r,t)),Fr.set(r,a),r.setAttribute("crossorigin","anonymous"),r.setAttribute("playsinline","playsinline"),i&&r.setAttribute("x-yandex-pip","false"),r.controls=!1,r.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),r},zr=e=>{Fr.get(e)?.unsubscribe(),Fr.delete(e);let t=Or.get(e);Or.delete(e),t?(0,l.clearVideoElement)(e):(e=>{try{e.pause(),e.playbackRate=0,(0,l.clearVideoElement)(e),e.remove()}catch(e){console.error(e)}})(e)},qr=g(Ae(),1),Hr=(e,t,i,{equal:r=(e,t)=>e===t,changed$:s,onError:a}={})=>{let n=e.getState(),o=t(),u=(0,l.isNullable)(s),d=new l.Subscription;return s&&d.add(s.subscribe((t=>{let i=e.getState();r(t,i)&&e.setState(t)}),a)),r(o,n)||(i(n),u&&e.setState(n)),d.add(e.stateChangeStarted$.subscribe((t=>{i(t.to),u&&e.setState(t.to)}),a)),d},Ur=(e,t,i)=>Hr(t,(()=>e.loop),(t=>{(0,l.isNonNullable)(t)&&(e.loop=t)}),{onError:i}),Wr=(e,t,i,r)=>Hr(t,(()=>({muted:e.muted,volume:e.volume})),(t=>{(0,l.isNonNullable)(t)&&(e.muted=t.muted,e.volume=t.volume)}),{equal:(e,t)=>e===t||e?.muted===t?.muted&&e?.volume===t?.volume,changed$:i,onError:r}),Qr=(e,t,i,r)=>Hr(t,(()=>e.playbackRate),(t=>{(0,l.isNonNullable)(t)&&(e.playbackRate=t)}),{changed$:i,onError:r}),Gr=Hr,Kr=(e,t)=>{if(e.id===t)return!0;let[i,r,s]=t.split("|");return e.language===r&&e.label===s},Yr=class e{connect(e,t,i){this.video=e,this.cueSettings=t.textTrackCuesSettings,this.subscribe();let r=e=>{this.error$.next({id:"TextTracksManager",category:l.ErrorCategory.WTF,message:"Generic HtmlVideoTextTrackManager error",thrown:e})};this.subscription.add(this.available$.subscribe(i.availableTextTracks$)),this.subscription.add(this.current$.subscribe(i.currentTextTrack$)),this.subscription.add(this.error$.subscribe(i.error$)),this.subscription.add(Gr(t.internalTextTracks,(()=>(0,qr.default)(this.internalTracks)),(e=>{(0,l.isNonNullable)(e)&&this.setInternal(e)}),{equal:(e,t)=>(0,l.isNonNullable)(e)&&(0,l.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,l.map)((e=>e.filter((({type:e})=>"internal"===e))))),onError:r})),this.subscription.add(Gr(t.externalTextTracks,(()=>(0,qr.default)(this.externalTracks)),(e=>{(0,l.isNonNullable)(e)&&this.setExternal(e)}),{equal:(e,t)=>(0,l.isNonNullable)(e)&&(0,l.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,l.map)((e=>e.filter((({type:e})=>"external"===e))))),onError:r})),this.subscription.add(Gr(t.currentTextTrack,(()=>{if(this.video)return;let e=this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e));return e&&this.htmlTextTrackToITextTrack(e).id}),(e=>this.select(e)),{changed$:this.current$,onError:r})),this.subscription.add(Gr(t.textTrackCuesSettings,(()=>({})),(()=>{if(this.video)for(let e of this.htmlTextTracksAsArray())this.applyCueSettings(e.cues),this.applyCueSettings(e.activeCues)})))}subscribe(){(0,l.assertNonNullable)(this.video);let{textTracks:e}=this.video;this.subscription.add((0,l.fromEvent)(e,"addtrack").subscribe((()=>{let e=this.current$.getValue();e&&this.select(e)}))),this.subscription.add((0,l.merge)((0,l.fromEvent)(e,"addtrack"),(0,l.fromEvent)(e,"removetrack"),(0,l.observableFrom)(["init"])).pipe((0,l.map)((()=>this.htmlTextTracksAsArray().map((e=>this.htmlTextTrackToITextTrack(e))))),(0,l.filterChanged)(((e,t)=>e.length===t.length&&e.every((({id:e},i)=>e===t[i].id))))).subscribe(this.available$)),this.subscription.add((0,l.merge)((0,l.fromEvent)(e,"change"),(0,l.observableFrom)(["init"])).pipe((0,l.map)((()=>this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e)))),(0,l.map)((e=>e&&this.htmlTextTrackToITextTrack(e).id)),(0,l.filterChanged)()).subscribe(this.current$));let t=e=>this.applyCueSettings(e.target?.activeCues??null);this.subscription.add((0,l.fromEvent)(e,"addtrack").subscribe((e=>{e.track?.addEventListener("cuechange",t);let i=e=>{let t=e.target?.cues??null;t&&t.length&&(this.applyCueSettings(e.target?.cues??null),e.target?.removeEventListener("cuechange",i))};e.track?.addEventListener("cuechange",i)}))),this.subscription.add((0,l.fromEvent)(e,"removetrack").subscribe((e=>{e.track?.removeEventListener("cuechange",t)})))}applyCueSettings(e){if(!e||!e.length)return;let t=this.cueSettings.getState();for(let i of Array.from(e)){let e=i;(0,l.isNonNullable)(t.align)&&(e.align=t.align),(0,l.isNonNullable)(t.position)&&(e.position=t.position),(0,l.isNonNullable)(t.size)&&(e.size=t.size),(0,l.isNonNullable)(t.line)&&(e.line=t.line)}}htmlTextTracksAsArray(t=!1){(0,l.assertNonNullable)(this.video);let i=[...this.video.textTracks];return t?i:i.filter(e.isHealthyTrack)}htmlTextTrackToITextTrack(e){let{language:t,label:i}=e,r=e.id?e.id:(e=>["__",e.language,e.label].join("|"))(e),s=this.externalTracks.has(r),a=(s?this.externalTracks.get(r)?.isAuto:this.internalTracks.get(r)?.isAuto)??r.includes("auto");return s?{id:r,type:"external",isAuto:a,language:t,label:i,url:this.externalTracks.get(r)?.url}:{id:r,type:"internal",isAuto:a,language:t,label:i,url:this.internalTracks.get(r)?.url}}static isHealthyTrack(e){return!("metadata"===e.kind||e.groupId||""===e.id&&""===e.label&&""===e.language)}setExternal(e){this.internalTracks.size>0&&Array.from(this.internalTracks).forEach((([,e])=>this.detach(e))),e.filter((({id:e})=>!this.externalTracks.has(e))).forEach((e=>this.attach(e))),Array.from(this.externalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}setInternal(e){let t=[...this.externalTracks];e.filter((({id:e,language:i,isAuto:r})=>!this.internalTracks.has(e)&&!t.some((([,e])=>e.language===i&&e.isAuto===r)))).forEach((e=>this.attach(e))),Array.from(this.internalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}select(e){(0,l.assertNonNullable)(this.video);for(let e of this.htmlTextTracksAsArray(!0))e.mode="showing";for(let t of this.htmlTextTracksAsArray(!0))((0,l.isNullable)(e)||!Kr(t,e))&&(t.mode="disabled")}destroy(){if(this.subscription.unsubscribe(),this.video)for(let e of Array.from(this.video.getElementsByTagName("track"))){let t=e.getAttribute("id");t&&this.externalTracks.has(t)&&this.video.removeChild(e)}this.externalTracks.clear()}attach(e){(0,l.assertNonNullable)(this.video);let t=document.createElement("track");this.baseURL?t.setAttribute("src",new URL(e.url,this.baseURL).toString()):t.setAttribute("src",e.url),t.setAttribute("id",e.id),e.label&&t.setAttribute("label",e.label),e.language&&t.setAttribute("srclang",e.language),"external"===e.type?this.externalTracks.set(e.id,e):"internal"===e.type&&this.internalTracks.set(e.id,e),this.video.appendChild(t)}detach(e){(0,l.assertNonNullable)(this.video);let t=Array.prototype.find.call(this.video.getElementsByTagName("track"),(t=>t.getAttribute("id")===e.id));t&&this.video.removeChild(t),"external"===e.type?this.externalTracks.delete(e.id):"internal"===e.type&&this.internalTracks.delete(e.id)}constructor(e){this.available$=new l.Subject,this.current$=new l.ValueSubject(void 0),this.error$=new l.Subject,this.subscription=new l.Subscription,this.externalTracks=new Map,this.internalTracks=new Map,this.baseURL=e}},Xr=class{getTotalPausedTime(){return this.pausedTime+this.getCurrentPausedTime()}getCurrentPausedTime(){return this.pauseTimestamp>0?Date.now()-this.pauseTimestamp:0}getStreamOffset(){return this.streamOffset}getTotalOffset(){return this.getTotalPausedTime()+this.streamOffset}pause(){0===this.pauseTimestamp&&(this.pauseTimestamp=Date.now())}resume(){this.pauseTimestamp>0&&(this.pausedTime+=this.getCurrentPausedTime(),this.pauseTimestamp=0)}resetTo(e,t=!1){this.streamOffset=e,this.pauseTimestamp=0,this.pausedTime=0,t&&this.pause()}constructor(){this.pausedTime=0,this.streamOffset=0,this.pauseTimestamp=0}},Jr=e=>{let t=e;for(;!(t instanceof Document||t instanceof ShadowRoot||null===t);)t=t?.parentNode;return t??void 0},Zr=e=>{let t=Jr(e);return!(!t||!t.fullscreenElement||t.fullscreenElement!==e)},es=e=>{let t,i=t=>(0,l.fromEvent)(e,t).pipe((0,l.mapTo)(void 0),(0,l.shareReplay)(1)),r=new l.Subscription,s=(0,l.merge)((0,l.fromEvent)(e,"progress"),(0,l.fromEvent)(e,"timeupdate")).pipe((0,l.map)((()=>((e,t,i=3)=>{let r=0,s=0;for(let a=0;a<e.length;a++){let n=e.start(a),o=e.end(a);if(n<=t&&t<=o){if(r=n,s=o,!i)return{from:r,to:s};for(let t=a-1;t>=0;t--)e.end(t)+i>=r&&(r=e.start(t));for(let t=a+1;t<e.length;t++)e.start(t)-i<=s&&(s=e.end(t))}}return{from:r,to:s}})(e.buffered,e.currentTime))),(0,l.shareReplay)(1)),a=Tr.browser.isSafari?(0,l.combine)({play:i("play").pipe((0,l.once)()),playing:i("playing")}).pipe((0,l.mapTo)(void 0),(0,l.shareReplay)(1)):i("playing"),n=(0,l.fromEvent)(e,"volumechange").pipe((0,l.map)((()=>({muted:e.muted,volume:e.volume}))),(0,l.shareReplay)(1)),o=(0,l.fromEvent)(e,"ratechange").pipe((0,l.map)((()=>e.playbackRate)),(0,l.shareReplay)(1)),u=(0,l.fromEvent)(e,"error").pipe((0,l.filter)((()=>!(!e.error&&!e.played.length))),(0,l.map)((()=>{let t=e.error;return{id:t?`MediaError#${t.code}`:"HtmlVideoError",category:l.ErrorCategory.VIDEO_PIPELINE,message:t?t.message:"Error event from HTML video element",thrown:e.error??void 0}})),(0,l.shareReplay)(1)),d=(0,l.fromEvent)(e,"timeupdate").pipe((0,l.map)((()=>e.currentTime)),(0,l.shareReplay)(1)),c=new l.Subject;r.add((0,l.merge)(...["waiting","seeking","seeked","timeupdate"].map((t=>(0,l.fromEvent)(e,t)))).subscribe((i=>{let r=e.currentTime;e.loop&&(0,l.isNonNullable)(t)&&(0,l.isNonNullable)(r)&&t>=e.duration-.3&&r<=.3&&c.next(t),t=r})));let h=i("pause").pipe((0,l.filter)((()=>!e.error&&t!==e.duration)),(0,l.shareReplay)(1)),p=(0,l.fromEvent)(e,"enterpictureinpicture").pipe((0,l.shareReplay)(1)),f=(0,l.fromEvent)(e,"leavepictureinpicture").pipe((0,l.shareReplay)(1)),m=new l.ValueSubject((e=>{let t=Jr(e);return!(!t||!t.pictureInPictureElement||t.pictureInPictureElement!==e)})(e));r.add(p.subscribe((()=>m.next(!0)))),r.add(f.subscribe((()=>m.next(!1))));let g=new l.ValueSubject(Zr(e)),v=(0,l.fromEvent)(e,"fullscreenchange").pipe((0,l.shareReplay)(1));r.add(v.pipe((0,l.map)((()=>Zr(e)))).subscribe(g));let b=(0,l.fromEvent)(e,"timeupdate").pipe((0,l.map)((t=>e.duration-e.currentTime<.1)),(0,l.filterChanged)(),(0,l.shareReplay)(1)),y=(0,l.merge)(b.pipe((0,l.filter)((t=>!e.loop&&t))),(0,l.fromEvent)(e,"ended")).pipe((0,l.throttle)(1e3),(0,l.mapTo)(void 0),(0,l.shareReplay)(1)),S=(0,l.merge)(...["waiting","pause","canplay","play","canplaythrough","playing","seeking","seeked","ended"].map((t=>(0,l.fromEvent)(e,t))),b.pipe((0,l.map)((e=>({type:e?"ended":"unknown"}))))).pipe((0,l.map)((t=>Tr.browser.isFirefox&&"ended"===t.type?e.readyState<2:e.readyState<3)),(0,l.filterChanged)(),(0,l.shareReplay)(1));return{playing$:a,pause$:h,canplay$:i("canplay"),ended$:y,looped$:c,error$:u,seeked$:i("seeked"),seeking$:i("seeking"),progress$:i("progress"),loadStart$:i("loadstart"),loadedMetadata$:i("loadedmetadata"),loadedData$:i("loadeddata"),timeUpdate$:d,durationChange$:(0,l.fromEvent)(e,"durationchange").pipe((0,l.map)((()=>e.duration)),(0,l.shareReplay)(1)),isBuffering$:S,currentBuffer$:s,volumeState$:n,playbackRateState$:o,inPiP$:m,inFullscreen$:g,enterPip$:p,leavePip$:f,destroy:()=>r.unsubscribe()}},ts=e=>{switch(e){case"mobile":return l.VideoQuality.Q_144P;case"lowest":return l.VideoQuality.Q_240P;case"low":return l.VideoQuality.Q_360P;case"sd":case"medium":return l.VideoQuality.Q_480P;case"hd":case"high":return l.VideoQuality.Q_720P;case"fullhd":case"full":return l.VideoQuality.Q_1080P;case"quadhd":case"quad":return l.VideoQuality.Q_1440P;case"ultrahd":case"ultra":return l.VideoQuality.Q_2160P}},is=g(ni(),1),rs=g(Ve(),1),ss=g(Oe(),1),as=!1,ns={},os=e=>{e(ns)},ls=(e,t)=>{as&&(ns.meta=ns.meta??{},ns.meta[e]=t)},us=class{next(e){if(!as)return;ns.series=ns.series??{};let t=ns.series[this.name]??[];t.push([Date.now(),e]),ns.series[this.name]=t}constructor(e){this.name=e}};function ds(e,t,i){return(0,l.isNullable)(e)||(0,l.isNonNullable)(e.min)&&(0,l.isNonNullable)(e.max)&&(0,l.isLower)(e.max,e.min)||(0,l.isNonNullable)(e.min)&&t&&(0,l.isHigher)(e.min,t)||(0,l.isNonNullable)(e.max)&&i&&(0,l.isLower)(e.max,i)}function cs({limits:e,highestAvailableHeight:t,lowestAvailableHeight:i}){return ds({max:e?.max?(0,l.videoHeightToQuality)(e.max):void 0,min:e?.min?(0,l.videoHeightToQuality)(e.min):void 0},t?(0,l.videoHeightToQuality)(t):void 0,i?(0,l.videoHeightToQuality)(i):void 0)}var hs=new us("best_bitrate"),ps=(e,t,i)=>(t-i)*Math.pow(2,-10*e)+i,fs=e=>(t,i)=>e*(Number(t.bitrate)-Number(i.bitrate)),ms=class{recordSelection(e){this.history[e.id]=(0,l.now)()}recordSwitch(e){this.last=e}clear(){this.last=void 0,this.history={}}constructor(){this.history={}}},gs='Assertion "ABR Tracks is empty array" failed',vs=new WeakMap,bs=new WeakMap,ys=new WeakMap,Ss=(e,t,i,r)=>{let s=[...t].sort(fs(1)),a=[...i].sort(fs(1)),n=a.filter((t=>!(0,l.isNonNullable)(t.bitrate)||!(0,l.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),o=(0,is.default)(a,Math.round(a.length*s.indexOf(e)/(s.length+1)))??(0,is.default)(a,-1);return o&&(0,rs.default)(n,o)?o:n.length?(0,is.default)(n,-1):(0,is.default)(a,0)},ws=(e,t,i,r)=>{let s=vs.get(t);s||(s=[...t].sort(fs(1)),vs.set(t,s));let a=vs.get(i);a||(a=[...i].sort(fs(1)),vs.set(i,a));let n=ys.get(e);n||(n=a.filter((t=>!(0,l.isNonNullable)(t.bitrate)||!(0,l.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),ys.set(e,n));let o=(0,is.default)(a,Math.round(a.length*s.indexOf(e)/(s.length+1)))??(0,is.default)(a,-1);return o&&(0,rs.default)(n,o)?o:n.length?(0,is.default)(n,-1):(0,is.default)(a,0)},$s=e=>"quality"in e,xs=(e,t,i,r)=>{let s=(0,l.isNonNullable)(r?.last?.bitrate)&&(0,l.isNonNullable)(i?.bitrate)&&r.last.bitrate<i.bitrate?e.trackCooldownIncreaseQuality:e.trackCooldownDecreaseQuality,a=i&&r&&r.history[i.id]&&(0,l.now)()-r.history[i.id]<=s&&(!r.last||i.id!==r.last.id);if(i?.id&&r&&!a&&r.recordSelection(i),a&&r?.last){let e=r.last;return r?.recordSwitch(e),t({message:`\n    [last ${$s(e)?"video":"audio"} selected] ${$s(e)?e.quality:e.bitrate}\n    `}),e}return r?.recordSwitch(i),i},ks=({tuning:e,container:t,limits:i,panelSize:r})=>{let s=e.containerSizeFactor;if(r)return{containerSizeLimit:r,containerSizeFactor:s};if(e.usePixelRatio&&Tr.display.pixelRatio){let t=Tr.display.pixelRatio;if(e.pixelRatioMultiplier)s*=e.pixelRatioMultiplier*(t-1)+1;else{let i=e.pixelRatioLogBase,[r=0,a=0,n=0]=e.pixelRatioLogCoefficients,o=((e,t)=>Math.log(t)/Math.log(e))(i,r*t+a)+n;Number.isFinite(o)&&(s*=o)}}return(0,l.isNonNullable)(i?.min)&&(0,l.isHigherOrEqual)(i.min,e.highQualityLimit)&&(s*=2),{containerSizeLimit:e.limitByContainer&&t&&t.width>0&&t.height>0?{width:t.width*s,height:t.height*s}:void 0,containerSizeFactor:s}},Ts=new WeakMap,_s=(e,{container:t,estimatedThroughput:i,tuning:r,limits:s,reserve:a=0,forwardBufferHealth:n,playbackRate:o,current:u,history:d,visible:c,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:g})=>{(0,l.assertNotEmptyArray)(e,gs);let{containerSizeFactor:v,containerSizeLimit:b}=ks({container:t,tuning:r,limits:s,panelSize:g}),y=r.considerPlaybackRate&&(0,l.isNonNullable)(o)?o:1,S=Ts.get(e);S||(S=e.filter((e=>!(0,l.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,l.isHigher)(e.quality,t.quality)?-1:1)),Ts.set(e,S));let w=(0,is.default)(S,-1)?.quality,$=(0,is.default)(S,0)?.quality,x=ds(s,$,w),k=y*ps(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),T={},_=null;for(let e of S){let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&(0,l.videoSizeToQuality)(b);t=!i||(0,l.isLowerOrEqual)(e.quality,i)}if(!t){T[e.quality]="FitsContainer";continue}let o=f||i,d=!((0,l.isNonNullable)(o)&&isFinite(o)&&(0,l.isNonNullable)(e.bitrate))||o-a>=e.bitrate*k,m=s?.min===e.quality;if(!d&&!m){T[e.quality]="FitsThroughput";continue}if(r.lazyQualitySwitch&&(0,l.isNonNullable)(r.minBufferToSwitchUp)&&u&&!(0,l.isInvariantQuality)(u.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,l.isHigher)(e.quality,u.quality)){T[e.quality]="Buffer";continue}if(h&&(0,l.isHigherOrEqual)(e.quality,h)&&!m){T[e.quality]="DroppedFramesLimit";continue}if(p&&(0,l.isHigherOrEqual)(e.quality,p)&&!m){T[e.quality]="StallsLimit";continue}let g=x||((0,l.isNullable)(s?.max)||(0,l.isLowerOrEqual)(e.quality,s.max))&&((0,l.isNullable)(s?.min)||(0,l.isHigherOrEqual)(e.quality,s.min)),v=!((0,l.isNonNullable)(c)&&!c)||(0,l.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);g&&v?_||(_=e):T[e.quality]="FitsQualityLimits"}_&&_.bitrate&&hs.next(_.bitrate);let C=_??(0,is.default)(S,-1)??e[0],E=d?.last,A=xs(r,m,C,d);return(0,l.isNonNullable)(d)&&A.quality!==E?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,ss.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${v},\n    containerSizeLimit: ${b?.width??0} x ${b?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${a},\n    playbackRate: ${o},\n    playbackRateFactor: ${y},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${k},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${x},\n    maxQualityLimit: ${s?.max},\n    minQualityLimit: ${s?.min},\n\n    [limited video tracks]\n    ${(0,ss.default)(T).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${_?.quality}\n    [selected video track] ${A?.quality}\n    `}),A},Cs=(e,{container:t,estimatedThroughput:i,tuning:r,limits:s,reserve:a=0,forwardBufferHealth:n,playbackRate:o,current:u,history:d,visible:c,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:g})=>{(0,l.assertNotEmptyArray)(e,gs);let{containerSizeFactor:v,containerSizeLimit:b}=ks({container:t,tuning:r,limits:s,panelSize:g}),y=r.considerPlaybackRate&&(0,l.isNonNullable)(o)?o:1,S=e.filter((e=>!(0,l.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,l.isHigher)(e.quality,t.quality)?-1:1)),w=(0,is.default)(S,-1)?.quality,$=(0,is.default)(S,0)?.quality,x=ds(s,$,w),k=y*ps(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),T={},_=S.filter((e=>{let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&(0,l.videoSizeToQuality)(b);t=!i||(0,l.isLowerOrEqual)(e.quality,i)}if(!t)return T[e.quality]="FitsContainer",!1;let o=f||i,d=!((0,l.isNonNullable)(o)&&isFinite(o)&&(0,l.isNonNullable)(e.bitrate))||o-a>=e.bitrate*k,m=s?.min===e.quality;if(!d&&!m)return T[e.quality]="FitsThroughput",!1;if(r.lazyQualitySwitch&&(0,l.isNonNullable)(r.minBufferToSwitchUp)&&u&&!(0,l.isInvariantQuality)(u.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,l.isHigher)(e.quality,u.quality))return T[e.quality]="Buffer",!1;if(h&&(0,l.isHigherOrEqual)(e.quality,h)&&!m)return T[e.quality]="DroppedFramesLimit",!1;if(p&&(0,l.isHigherOrEqual)(e.quality,p)&&!m)return T[e.quality]="StallsLimit",!1;let g=x||((0,l.isNullable)(s?.max)||(0,l.isLowerOrEqual)(e.quality,s.max))&&((0,l.isNullable)(s?.min)||(0,l.isHigherOrEqual)(e.quality,s.min)),v=!((0,l.isNonNullable)(c)&&!c)||(0,l.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);return!(!g||!v)||(T[e.quality]="FitsQualityLimits",!1)}))[0];_&&_.bitrate&&hs.next(_.bitrate);let C=_??(0,is.default)(S,-1)??e[0],E=d?.last,A=xs(r,m,C,d);return(0,l.isNonNullable)(d)&&A.quality!==E?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,ss.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${v},\n    containerSizeLimit: ${b?.width??0} x ${b?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${a},\n    playbackRate: ${o},\n    playbackRateFactor: ${y},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${k},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${x},\n    maxQualityLimit: ${s?.max},\n    minQualityLimit: ${s?.min},\n\n    [limited video tracks]\n    ${(0,ss.default)(T).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${_?.quality}\n    [selected video track] ${A?.quality}\n    `}),A},Es=(e,t,i,{estimatedThroughput:r,tuning:s,playbackRate:a,forwardBufferHealth:n,history:o,abrLogger:u,stallsPredictedThroughput:d})=>{(0,l.assertNotEmptyArray)(i,gs);let c=s.considerPlaybackRate&&(0,l.isNonNullable)(a)?a:1,h=[...i].sort(fs(-1)),p=e.bitrate;(0,l.assertNonNullable)(p);let f,m=c*ps(n??.5,s.bitrateAudioFactorAtEmptyBuffer,s.bitrateAudioFactorAtFullBuffer),g=Ss(e,t,i,s.minVideoAudioRatio),v=d||r;(0,l.isNonNullable)(v)&&isFinite(v)&&(f=h.find((e=>!(!(0,l.isNonNullable)(e.bitrate)||!(0,l.isNonNullable)(g?.bitrate))&&(v-p>=e.bitrate*m&&e.bitrate>=g.bitrate)))),f||(f=g);let b=o?.last,y=f&&xs(s,u,f,o);return(0,l.isNonNullable)(o)&&y?.bitrate!==b?.bitrate&&u({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,ss.default)(s??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${d},\n    reserve: ${p},\n    playbackRate: ${a},\n    playbackRateFactor: ${c},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${s.minBufferToSwitchUp},\n\n    [selected audio track] ${y?.id}\n    `}),y},As=(e,t,i,{estimatedThroughput:r,tuning:s,playbackRate:a,forwardBufferHealth:n,history:o,abrLogger:u,stallsPredictedThroughput:d})=>{(0,l.assertNotEmptyArray)(i,gs);let c=s.considerPlaybackRate&&(0,l.isNonNullable)(a)?a:1,h=bs.get(i);h||(h=[...i].sort(fs(-1)),bs.set(i,h));let p=e.bitrate;(0,l.assertNonNullable)(p);let f,m=c*ps(n??.5,s.bitrateAudioFactorAtEmptyBuffer,s.bitrateAudioFactorAtFullBuffer),g=ws(e,t,i,s.minVideoAudioRatio),v=d||r;(0,l.isNonNullable)(v)&&isFinite(v)&&(f=h.find((e=>!(!(0,l.isNonNullable)(e.bitrate)||!(0,l.isNonNullable)(g?.bitrate))&&(v-p>=e.bitrate*m&&e.bitrate>=g.bitrate)))),f||(f=g);let b=o?.last,y=f&&xs(s,u,f,o);return(0,l.isNonNullable)(o)&&y?.bitrate!==b?.bitrate&&u({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,ss.default)(s??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${d},\n    reserve: ${p},\n    playbackRate: ${a},\n    playbackRateFactor: ${c},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${s.minBufferToSwitchUp},\n\n    [selected audio track] ${y?.id}\n    `}),y},Ls=e=>new URL(e).hostname,Ps=g(ni(),1),Ms=g(Ve(),1),Is=e=>{if(e instanceof DOMException&&(0,Ms.default)(["Failed to load because no supported source was found.","The element has no supported sources."],e.message))throw e;return!(e instanceof DOMException&&(20===e.code||"AbortError"===e.name))},Rs=async(e,t)=>{let i=e.muted;try{await e.play()}catch(r){if(!Is(r))return!1;if(t&&t(),i)return console.warn(r),!1;e.muted=!0;try{await e.play()}catch(t){return Is(t)&&(e.muted=!1,console.warn(t)),!1}}return!0},Vs=g(Ae(),1);function Ns(){return(0,l.now)()}function Bs(e){return Ns()-e}function Ds(e){let t=e.split("/"),i=t.slice(0,t.length-1).join("/"),r=/^([a-z]+:)?\/\//i;return{resolve:(e,t,s=!1)=>{(e=>r.test(e))(e)||(e.startsWith("/")||(e="/"+e),e=i+e);let a=e.indexOf("?")>-1?"&":"?";return s&&(e+=a+"lowLat=1",a="&"),t&&(e+=a+"_rnd="+Math.floor(999999999*Math.random())),e}}}function Os(e,t,i,r){let s,a,n,o,u,d=window.XMLHttpRequest,c=!1,h=0,p=!1,f="arraybuffer",m=7e3,g=2e3,v=()=>{if(c)return;(0,l.assertNonNullable)(o);let e,t=Bs(o);if(t<g)return e=g-t,void setTimeout(v,e);g*=2,g>m&&(g=m),a&&a.abort(),a=new d,y()},b=()=>{if(!c){if(--h>=0)return v(),void(r&&r());c=!0,u&&u(),i&&i()}},y=()=>{o=Ns(),a=new d,a.open("get",e);let i,r=0,h=0,m=()=>((0,l.assertNonNullable)(o),Math.max(o,Math.max(i||0,h||0)));if(s&&a.addEventListener("progress",(e=>{let t=Ns();s.updateChunk&&e.loaded>r&&(s.updateChunk(m(),e.loaded-r),r=e.loaded,i=t)})),n&&(a.timeout=n,a.addEventListener("timeout",(()=>b()))),a.addEventListener("load",(()=>{if(c)return;(0,l.assertNonNullable)(a);let e=a.status;if(e>=200&&e<300){let{response:e,responseType:i}=a,n=e?.byteLength;if("number"==typeof n&&s){let e=n-r;e&&s.updateChunk&&s.updateChunk(m(),e)}"json"!==i||e&&(0,Vs.default)(e).length?(u&&u(),t(e)):b()}else b()})),a.addEventListener("error",(()=>{b()})),p){let e=()=>{(0,l.assertNonNullable)(a),a.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(h=Ns(),a.removeEventListener("readystatechange",e))};a.addEventListener("readystatechange",e)}return a.responseType=f,a.send(),S},S={withBitrateReporting:e=>(s=e,S),withParallel:e=>(p=e,S),withJSONResponse:()=>(f="json",S),withRetryCount:e=>(h=e,S),withRetryInterval:(e,t)=>((0,l.isNonNullable)(e)&&(g=e),(0,l.isNonNullable)(t)&&(m=t),S),withTimeout:e=>(n=e,S),withFinally:e=>(u=e,S),send:y,abort:()=>{a&&(a.abort(),a=void 0),c=!0,u&&u()}};return S}var Fs=class{_updateRate(e){let t=.2;this.currentRate&&(e<.1*this.currentRate?t=.8:e<.5*this.currentRate?t=.5:e<.7*this.currentRate&&(t=.3)),e=Math.max(1,Math.min(e,104857600)),this.currentRate=this.currentRate?this.currentRate*(1-t)+e*t:e}_createInterval(e,t,i){return{start:e,end:t,bytes:i}}_doMergeIntervals(e,t){e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end),e.bytes+=t.bytes}_mergeIntervals(e,t){return e.start<=t.end&&t.start<=e.end&&(this._doMergeIntervals(e,t),!0)}_flushIntervals(){if(!this.intervals.length)return!1;let e=this.intervals[0].start,t=this.intervals[this.intervals.length-1].end-500;if(t-e>2e3){let i=0,r=0;for(;this.intervals.length>0;){let e=this.intervals[0];if(e.end<=t)i+=e.end-e.start,r+=e.bytes,this.intervals.splice(0,1);else{if(e.start>=t)break;{let s=t-e.start,a=e.end-e.start;i+=s;let n=e.bytes*s/a;r+=n,e.start=t,e.bytes-=n}}}if(r>0&&i>0){let s=8*r/(i/1e3);return this._updateRate(s),this.logger(`rate updated, new=${Math.round(s/1024)}K; average=${Math.round(this.currentRate/1024)}K bytes/ms=${Math.round(r)}/${Math.round(i)} interval=${Math.round(t-e)}`),!0}}return!1}_joinIntervals(){let e;do{e=!1;for(let t=0;t<this.intervals.length-1;++t)this._mergeIntervals(this.intervals[t],this.intervals[t+1])&&(this.intervals.splice(t+1,1),e=!0)}while(e)}addInterval(e,t,i){return this.intervals.push(this._createInterval(e,t,i)),this._joinIntervals(),this.intervals.length>100&&(this.logger(`too many intervals (${this.intervals.length}); will merge`,{type:"warn"}),this._doMergeIntervals(this.intervals[1],this.intervals[0]),this.intervals.splice(0,1)),this._flushIntervals()}getBitRate(){return this.currentRate}constructor(e){this.intervals=[],this.currentRate=0,this.logger=e}},js=g(Ae(),1),zs=class{limitCompleteCount(){let e;for(;(e=Object.keys(this.completeRequests)).length>this._getParallelRequestCount()+2;){let t=e[Math.floor(Math.random()*e.length)];this.logger(`Dropping completed request for url ${t}`,{type:"warn"}),delete this.completeRequests[t]}}_sendRequest(e,t){let i=Ns(),r=i=>{delete this.activeRequests[t],this.limitCompleteCount(),this.completeRequests[t]=e,this._sendPending(),e._error=1,e._errorMsg=i,e._errorCB?e._errorCB(i):(this.limitCompleteCount(),this.completeRequests[t]=e)};e._request=Os(t,(r=>{e._complete=1,e._responseData=r,e._downloadTime=Ns()-i,delete this.activeRequests[t],this._sendPending(),e._cb?e._cb(r,e._downloadTime):(this.limitCompleteCount(),this.completeRequests[t]=e)}),(()=>r("error")),(()=>{e._retry=1,e._retryCB&&e._retryCB()})),e._request.withRetryCount(this.RETRY_COUNT).withTimeout(this.TIMEOUT).withBitrateReporting(this.BITRATE_ESTIMATOR).withParallel(this._getParallelRequestCount()>1).withFinally((()=>{e._finallyCB&&e._finallyCB()})),this.activeRequests[t]=e,e._request.send(),this.lastPrefetchStart=Ns()}_getParallelRequestCount(){return Math.min(this.MAX_PARALLEL_REQUESTS,this.averageSegmentDuration<3e3?3:2)}_getPrefetchDelay(){return Math.max(100,Math.min(5e3,this.averageSegmentDuration/3))}_canSendPending(){let e=this._getParallelRequestCount(),t=Ns();if(Object.keys(this.activeRequests).length>=e)return!1;let i=this._getPrefetchDelay()-(t-this.lastPrefetchStart);return this.throttleTimeout&&clearTimeout(this.throttleTimeout),!(i>0)||(this.throttleTimeout=window.setTimeout((()=>this._sendPending()),i),!1)}_sendPending(){for(;this._canSendPending();){let e=this.pendingQueue.pop();if(!e)return;this.activeRequests[e]||this.completeRequests[e]||(this.logger(`Submitting pending request url=${e}`),this._sendRequest({},e))}}_removeFromActive(e){delete this.completeRequests[e],delete this.activeRequests[e]}abortAll(){(0,js.default)(this.activeRequests).forEach((e=>{e&&e._request&&e._request.abort()})),this.activeRequests={},this.pendingQueue=[],this.completeRequests={}}requestData(e,t,i,r){let s={};return s.send=()=>{let a=this.activeRequests[e]||this.completeRequests[e];if(a)a._cb=t,a._errorCB=i,a._retryCB=r,a._finallyCB=s._finallyCB,a._error||a._complete?(this._removeFromActive(e),setTimeout((()=>{a._complete?(this.logger(`Requested url already prefetched, url=${e}`),t(a._responseData,a._downloadTime)):(this.logger(`Requested url already prefetched with error, url=${e}`),i(a._errorMsg)),s._finallyCB&&s._finallyCB()}),0)):this.logger(`Attached to active request, url=${e}`);else{let t=this.pendingQueue.indexOf(e);-1!==t&&this.pendingQueue.splice(t,1),this.logger(`Request not prefetched, starting new request, url=${e}${-1===t?"":"; removed pending"}`),this._sendRequest(s,e)}},s._cb=t,s._errorCB=i,s._retryCB=r,s.abort=function(){s.request&&s.request.abort()},s.withFinally=e=>(s._finallyCB=e,s),s}prefetch(e){this.activeRequests[e]||this.completeRequests[e]?this.logger(`Request already active for url=${e}`):(this.logger(`Added to pending queue; url=${e}`),this.pendingQueue.unshift(e),this._sendPending())}optimizeForSegDuration(e){this.averageSegmentDuration=e}constructor(e,t,i,r,s){this.pendingQueue=[],this.activeRequests={},this.completeRequests={},this.averageSegmentDuration=2e3,this.lastPrefetchStart=0,this.throttleTimeout=null,this.RETRY_COUNT=e,this.TIMEOUT=t,this.BITRATE_ESTIMATOR=i,this.MAX_PARALLEL_REQUESTS=r,this.logger=s}},qs=(e,t)=>(0,l.isNonNullable)(e)&&(0,l.isNonNullable)(t)&&"open"===e.readyState&&function(e,t){for(let i=0;i<e.activeSourceBuffers.length;++i)if(e.activeSourceBuffers[i]===t)return!0;return!1}(e,t);var Hs,Us=g(Oe(),1),Ws=class{toString(){return`${this.tag}: ${this.time}: ${JSON.stringify(this.data)}${this.stack?`, stack: ${this.stack}`:""}`}toDevNullEntry(){let e=(0,Us.default)(this.data).map((([e,t])=>`${e}:${t}`)).join(",");return{key:this.tag,strings:[e,this.stack??""],numbers:[this.time]}}constructor(e,t,i,r){this.tag=e,this.time=t,this.data=i,this.stack=r}},Qs=((e,t="warn")=>{let i=[];function r(r,s=!1){let a=window.performance?.timing?.navigationStart??0,n=new Ws(e,Math.round((Date.now()-a)/1e3),r,s?(new Error).stack:void 0);i.push(n),t&&window.console[t](n.toString())}return r.reset=()=>{i=[]},r.drain=()=>{let e=i;return i=[],e},r})("vp_dash_live_debug",!1),Gs=1e4,Ks=class{attachSource(e){this.manifestUrl=e,this.urlResolver=Ds(e),this.bitrateSwitcher=this._initBitrateSwitcher(),this._initManifest()}setAutoQualityEnabled(e){this.autoQuality=e}setAutoQualityLimits(e){this.autoQualityLimits=e}switchByName(e){let t;for(let i=0;i<this.manifest.length;++i)if(t=this.manifest[i],t.name===e)return void this._switchToQuality(t)}catchUp(){if(this.rep&&(Qs({m:"ldp.catchUp.1"}),this.rep.stop()),this.currentManifestEntry){let e=this.params.playbackState.getState();this.paused="paused"===e,Qs({m:"ldp.catchUp.2"}),this._initPlayerWith(this.currentManifestEntry),this._notifyBuffering(!0)}}stop(){this.params.videoElement.pause(),this.rep&&(this.rep.stop(),this.rep=null)}pause(){this.paused=!0,this.params.videoElement.pause(),this.videoPlayStarted=!1,this._notifyBuffering(!1)}play(){this.paused=!1;let e=this.lowLatency&&this._getBufferSizeSec()>this.sourceJitter+5;this.rep&&!e?(this.bufferStates=[],this.videoPlayStarted=!1,this.shouldPlay()?(Qs({m:"ldp.play.1"}),this._playVideoElement()):(Qs({m:"ldp.play.2"}),this._notifyBuffering(!0))):(Qs({m:"ldp.play.3"}),this.catchUp())}startPlay(e,t){this.autoQuality=t,Qs({m:"startPlay",url:e.jidxUrl}),this._initPlayerWith(e)}destroy(){this.destroyed=!0,this.rep&&(this.rep.stop(),this.rep=null),this.manifestRequest&&this.manifestRequest.abort(),this.manifestRefetchTimer&&(clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=void 0)}reinit(e){this.manifestUrl=e,this.urlResolver=Ds(e),Qs({m:"ldp.reinit",url:e}),this.catchUp()}_handleNetworkError(){this.params.logger("Fatal network error"),this.params.playerCallback({name:"error",type:"network"})}_retryCallback(){this.params.playerCallback({name:"retry"})}_getBufferSizeSec(){let e=this.params.videoElement,t=0,i=e.buffered.length;return 0!==i&&(t=e.buffered.end(i-1)-Math.max(e.currentTime,e.buffered.start(0))),t}_notifyBuffering(e){this.destroyed||(this.params.logger(`buffering: ${e}`),this.params.playerCallback({name:"buffering",isBuffering:e}),this.buffering=e)}_initVideo(){let{videoElement:e,logger:t}=this.params;Qs({m:"iv"}),e.addEventListener("error",(()=>{e.error&&!this.destroyed&&(Qs({m:"iv.err",e:e.error?.code+":"+e.error?.message}),t(`Video element error: ${e.error?.code}, details: ${e.error?.message}`),this.params.playerCallback({name:"error",type:"media"}))})),e.addEventListener("timeupdate",(()=>{let e=this._getBufferSizeSec();!this.paused&&e<.3?this.buffering||(this.buffering=!0,window.setTimeout((()=>{!this.paused&&this.buffering&&this._notifyBuffering(!0)}),1e3*(e+.1))):this.buffering&&this.videoPlayStarted&&this._notifyBuffering(!1)})),e.addEventListener("playing",(()=>{t("playing")})),e.addEventListener("stalled",(()=>this._fixupStall())),e.addEventListener("waiting",(()=>this._fixupStall()))}_fixupStall(){let e,{logger:t,videoElement:i}=this.params,r=i.buffered.length;0!==r&&!this.waitingForFirstBufferAfterSrcChange&&(e=i.buffered.start(r-1),i.currentTime<e&&(t("Fixup stall"),Qs({m:"ldp.fs",t:e}),i.currentTime=e))}_selectQuality(e){let t,i,r,{videoElement:s}=this.params,a=s&&1.62*(Tr.display.pixelRatio||1)*s.offsetHeight||520;for(let s=0;s<this.manifest.length;++s){r=this.manifest[s];let{max:n,min:o}=this.autoQualityLimits||{};!cs({limits:this.autoQualityLimits,highestAvailableHeight:this.manifest[0].video.height,lowestAvailableHeight:(0,Ps.default)(this.manifest,-1).video.height})&&(n&&r.video.height>n||o&&r.video.height<o)||(r.bitrate<e&&a>Math.min(r.video.height,r.video.width)?(!i||r.bitrate>i.bitrate)&&(i=r):(!t||t.bitrate>r.bitrate)&&(t=r))}return i||t}shouldPlay(){if(this.paused)return!1;let e=this._getBufferSizeSec()-Math.max(1,this.sourceJitter);return e>3||(0,l.isNonNullable)(this.downloadRate)&&(this.downloadRate>1.5&&e>2||this.downloadRate>2&&e>1)}_setVideoSrc(e,t){let{logger:i,videoElement:r,playerCallback:s}=this.params;this.mediaSource=new window.MediaSource,i("setting video src"),r.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",(()=>{this.mediaSource&&(Qs({m:"sourceopen",c:e.codecs}),this.sourceBuffer=this.mediaSource.addSourceBuffer(e.codecs),this.bufferStates=[],t())})),this.mediaSource?.addEventListener("sourceclose",(e=>{Qs({m:"sourceclose"})})),this.videoPlayStarted=!1,r.addEventListener("canplay",(()=>{Qs({m:"canplay"}),this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement())}));let a=()=>{!function(e,t,i){let r=(...s)=>{i.apply(null,s),e.removeEventListener(t,r)};e.addEventListener(t,r)}(r,"progress",(()=>{r.buffered.length?(r.currentTime=r.buffered.start(0),this.waitingForFirstBufferAfterSrcChange=!1,s({name:"playing"})):a()}))};this.waitingForFirstBufferAfterSrcChange=!0,a()}_initPlayerWith(e){this.bitrate=0,this.rep=0,this.sourceBuffer=0,this.bufferStates=[],this.filesFetcher&&this.filesFetcher.abortAll(),this.filesFetcher=new zs(3,Gs,this.bitrateSwitcher,this.params.config.maxParallelRequests,this.params.logger),this._setVideoSrc(e,(()=>this._switchToQuality(e)))}_representation(e){let{logger:t,videoElement:i,playerCallback:r}=this.params,s=!1,a=null,n=null,o=null,u=null,d=!1,c=()=>{let e=s&&(!d||d===this.rep);return e||t("Not running!"),e},h=(e,t,i)=>{o&&o.abort(),o=Os(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withTimeout(Gs).withBitrateReporting(this.bitrateSwitcher).withRetryCount(3).withFinally((()=>{o=null})).send()},p=(e,t,i)=>{(0,l.assertNonNullable)(this.filesFetcher),n?.abort(),n=this.filesFetcher.requestData(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withFinally((()=>{n=null})).send()},f=e=>{let r=i.playbackRate;i.playbackRate!==e&&(t(`Playback rate switch: ${r}=>${e}`),i.playbackRate=e)},m=e=>{this.lowLatency=e,t(`lowLatency changed to ${e}`),g()},g=()=>{if(this.lowLatency||this.params.config.isLiveCatchUpMode){let e=this._getBufferSizeSec();if(this.bufferStates.length<5)return void f(1);let i=Ns()-1e4,r=0;for(let t=0;t<this.bufferStates.length;t++){let s=this.bufferStates[t];e=Math.min(e,s.buf),s.ts<i&&r++}this.bufferStates.splice(0,r),t(`update playback rate;  minBuffer=${e} drop=${r} jitter=${this.sourceJitter}`);let s=e-1;this.sourceJitter>=0?s-=this.sourceJitter/2:this.sourceJitter-=1,f(s>3?1.15:s>1?1.1:s>.3?1.05:1)}else f(1)},v=e=>{let i,s=()=>i&&i.start?i.start.length:0,a=e=>i.start[e]/1e3,n=e=>i.dur[e]/1e3,o=e=>i.fragIndex+e,d=(e,t)=>({chunkIdx:o(e),startTS:a(e),dur:n(e),discontinuity:t}),h=()=>{let e=0;if(i&&i.dur){let t=this.lowLatency?this.params.config.lowLatencyMinBuffer:this.params.config.minBuffer,r=this.lowLatency?this.params.config.lowLatencyMinBufferSegments:this.params.config.minBufferSegments,s=t;this.sourceJitter>1&&(s+=this.sourceJitter-1);let a=i.dur.length-1;for(;a>=0&&(s-=i.dur[a],!(s<=0));--a);e=Math.min(a,i.dur.length-1-r),e=Math.max(e,0)}return d(e,!0)},p=(e,t,i)=>{u&&u.abort(),u=Os(this.urlResolver.resolve(e,!0,this.lowLatency),t,i,(()=>this._retryCallback())).withTimeout(Gs).withRetryCount(3).withFinally((()=>{u=null})).withJSONResponse().send()};return{seek:(t,n)=>{p(e,(e=>{if(!c())return;i=e;let o=!!i.lowLatency;o!==this.lowLatency&&m(o);let u=0;for(let e=0;e<i.dur.length;++e)u+=i.dur[e];u>0&&((0,l.assertNonNullable)(this.filesFetcher),this.filesFetcher.optimizeForSegDuration(u/i.dur.length)),r({name:"index",zeroTime:i.zeroTime,shiftDuration:i.shiftDuration}),this.sourceJitter=i.hasOwnProperty("jitter")?Math.min(10,Math.max(.01,i.jitter/1e3)):1,t((e=>{let t=s();if(!(t<=0)){if((0,l.isNonNullable)(e))for(let i=0;i<t;i++)if(a(i)>e)return d(i);return h()}})(n))}),(()=>this._handleNetworkError()))},nextChunk:e=>{let r=s(),a=e?e.chunkIdx+1:0,n=a-i.fragIndex;if(!(r<=0)){if(!e||n<0||n-r>10)return t(`Resync: offset=${n} bChunks=${r} chunk=`+JSON.stringify(e)),h();if(!(n>=r))return d(a-i.fragIndex,!1)}}}},b=()=>{s=!1,n&&n.abort(),o&&o.abort(),u&&u.abort(),(0,l.assertNonNullable)(this.filesFetcher),this.filesFetcher.abortAll()};return d={start:t=>{let i,r,n,o,d,f,m,{videoElement:y,logger:S}=this.params,w=v(e.jidxUrl),$=0,x=()=>{d&&(clearTimeout(d),d=void 0);let e=Math.max(500,1e3*(this._getBufferSizeSec()-this.sourceJitter-5)),t=$+e,i=Ns(),r=Math.min(1e4,t-i);$=i;let s=()=>{u||c()&&w.seek((()=>{c()&&($=Ns(),k(),x())}))};r>0?d=window.setTimeout((()=>{this.paused?x():s()}),r):s()},k=()=>{let t;for(;t=w.nextChunk(o);)o=t,A(t);let i=w.nextChunk(n);if(i){if(n&&i.discontinuity)return S("Detected discontinuity; restarting playback"),void(this.paused?x():(b(),Qs({m:"ldp.fetchChunkIdx.0"}),this._initPlayerWith(e)));E(i)}else x()},T=(e,t)=>{if(!c()||!this.sourceBuffer)return void Qs({m:"ab.0",c:[!c(),!this.sourceBuffer]});let i,r,s,a=i=>{Qs({m:"ldp.postpone",t:i}),window.setTimeout((()=>{c()&&T(e,t)}),i)};if(this.sourceBuffer.updating)S("Source buffer is updating; delaying appendBuffer"),Qs({m:"ldp.ab.1"}),a(100);else{let n=Ns(),o=y.currentTime;!this.paused&&y.buffered.length>1&&f===o&&n-m>500&&(S("Stall suspected; trying to fix"),this._fixupStall()),f!==o&&(f=o,m=n);let l=this._getBufferSizeSec();if(l>30)Qs({m:"ldp.ab.3"}),S(`Buffered ${l} seconds; delaying appendBuffer`),a(2e3);else try{if(this.params.config.useInvalidBufferFix&&qs(this.mediaSource,this.sourceBuffer))return;this.sourceBuffer.appendBuffer(e),this.videoPlayStarted?(Qs({m:"ldp.ab.5"}),this.bufferStates.push({ts:n,buf:l}),g(),this.bufferStates.length>200&&this.bufferStates.shift()):this.shouldPlay()&&(Qs({m:"ldp.ab.4"}),this.videoPlayStarted=!0,this._playVideoElement()),t&&t()}catch(e){if(Qs({m:"ldp.ab.err",e:e.name}),"QuotaExceededError"!==e.name)throw e;S("QuotaExceededError; delaying appendBuffer"),s=this.sourceBuffer.buffered.length,0!==s&&(i=this.sourceBuffer.buffered.start(0),r=o,r-i>4&&this.sourceBuffer.remove(i,r-3)),a(1e3)}}},_=()=>{r&&i&&(S([`Appending chunk, sz=${r.byteLength}:`,JSON.stringify(n)]),T(r,(function(){r=null,k()})))},C=t=>e.fragUrlTemplate.replace("%%id%%",t.chunkIdx),E=e=>{c()&&p(C(e),((t,i)=>{if(c()){if(i/=1e3,r=t,n=e,a=e.startTS,i){let t=Math.min(10,e.dur/i);this.downloadRate=this.downloadRate?.7*this.downloadRate+.3*t:t}_()}}),(()=>this._handleNetworkError()))},A=e=>{c()&&((0,l.assertNonNullable)(this.filesFetcher),this.filesFetcher.prefetch(this.urlResolver.resolve(C(e),!1)))},L=t=>{c()&&(e.cachedHeader=t,T(t,(()=>{i=!0,_()})))};s=!0,w.seek((e=>{if(c()){if($=Ns(),!e)return void x();o=e,!(0,l.isNullable)(t)||e.startTS>t?E(e):(n=e,k())}}),t),e.cachedHeader?L(e.cachedHeader):h(e.headerUrl,L,(()=>this._handleNetworkError()))},stop:b,getTimestampSec:()=>a},d}_switchToQuality(e){let t,{logger:i,playerCallback:r}=this.params;e.bitrate!==this.bitrate&&(this.rep&&(t=this.rep.getTimestampSec(),(0,l.isNonNullable)(t)&&(t+=.1),this.rep.stop()),this.currentManifestEntry=e,this.rep=this._representation(e),i(`switch to quality: codecs=${e.codecs}; headerUrl=${e.headerUrl}; bitrate=${e.bitrate}`),this.bitrate=e.bitrate,(0,l.assertNonNullable)(this.bitrateSwitcher),this.bitrateSwitcher.notifySwitch(this.bitrate),this.rep.start(t),r({name:"qualitySwitch",quality:e}))}_qualityAvailable(e){return(0,l.isNonNullable)(this.manifest.find((t=>t.name===e)))}_initBitrateSwitcher(){let e,{logger:t,playerCallback:i}=this.params,r=e=>{if(!this.autoQuality)return;let i,r,s;this.currentManifestEntry&&this._qualityAvailable(this.currentManifestEntry.name)&&e<this.bitrate&&(r=this._getBufferSizeSec(),s=e/this.bitrate,r>10&&s>.8||r>15&&s>.5||r>20&&s>.3)?t(`Not switching: buffer=${Math.floor(r)}; bitrate=${this.bitrate}; newRate=${Math.floor(e)}`):(i=this._selectQuality(e),i?this._switchToQuality(i):t(`Could not find quality by bitrate ${e}`))},s=(e,t)=>{let r=Ns();if(this.chunkRateEstimator.addInterval(e,r,t)){let s=this.chunkRateEstimator.getBitRate();return i({name:"bandwidth",size:t,duration:r-e,speed:s}),!0}},a=()=>{let e=this.chunkRateEstimator.getBitRate();return e?.85*e:0},n=-1/0,o=!0,l=()=>{let t=a();if(t&&e&&this.autoQuality){if(o&&t>e&&Bs(n)<3e4)return;r(t)}o=this.autoQuality};return{updateChunk:(e,t)=>{let i=s(e,t);return i&&l(),i},notifySwitch:t=>{let i=Ns();t<e&&(n=i),e=t}}}_fetchManifest(e,t,i){this.manifestRequest=Os(this.urlResolver.resolve(e,!0),t,i,(()=>this._retryCallback())).withJSONResponse().withTimeout(Gs).withRetryCount(this.params.config.manifestRetryMaxCount).withRetryInterval(this.params.config.manifestRetryInterval,this.params.config.manifestRetryMaxInterval).send().withFinally((()=>{this.manifestRequest=void 0}))}_playVideoElement(){let{videoElement:e}=this.params;Rs(e,(()=>{this.soundProhibitedEvent$.next()})).then((e=>{Qs({m:"ldp.pve.1"}),e||(Qs({m:"ldp.pve.2"}),this.params.liveOffset.pause(),this.params.videoState.setState("paused"))}))}_handleManifestUpdate(e){let{logger:t,playerCallback:i,videoElement:r}=this.params;this.manifest=(e=>{let t=[];return e?.length?(e.forEach(((e,i)=>{e.video&&r.canPlayType(e.codecs).replace(/no/,"")&&window.MediaSource?.isTypeSupported?.(e.codecs)&&(e.index=i,t.push(e))})),t.sort((function(e,t){return e.video&&t.video?t.video.height-e.video.height:t.bitrate-e.bitrate})),t):(i({name:"error",type:"empty_manifest"}),[])})(e),t(`Valid manifest entries: ${this.manifest.length}/${e.length}`),i({name:"manifest",manifest:this.manifest})}_refetchManifest(e){this.destroyed||(this.manifestRefetchTimer&&clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=window.setTimeout((()=>{this._fetchManifest(e,(t=>{this.destroyed||(this._handleManifestUpdate(t),this._refetchManifest(e))}),(()=>this._refetchManifest(e)))}),6e4))}_initManifest(){this._fetchManifest(this.manifestUrl,(e=>{this.destroyed||(this._handleManifestUpdate(e),this._refetchManifest(this.manifestUrl))}),(()=>this._handleNetworkError()))}constructor(e){this.paused=!1,this.autoQuality=!0,this.autoQualityLimits=void 0,this.buffering=!0,this.destroyed=!1,this.videoPlayStarted=!1,this.lowLatency=!1,this.bitrate=0,this.manifest=[],this.sourceBuffer=0,this.bufferStates=[],this.sourceJitter=-1,this.waitingForFirstBufferAfterSrcChange=!1,this.params=e,this.soundProhibitedEvent$=new l.Subject,this.chunkRateEstimator=new Fs(this.params.logger),this._initVideo()}},Ys=g(Oe(),1),Xs=class{connect(e){this.log=e.logger.createComponentLog("DroppedFramesManager"),this.video=e.video,this.isAuto=e.isAuto,this.tracks=e.tracks,this.droppedFramesChecker=e.droppedFramesChecker,this.subscription.add(e.playing$.subscribe((()=>this.playing=!0))),this.subscription.add(e.pause$.subscribe((()=>this.playing=!1))),this.isEnabled&&this.subscribe()}destroy(){this.currentTimer&&window.clearTimeout(this.currentTimer),this.subscription.unsubscribe()}get droppedVideoMaxQualityLimit(){return this.maxQualityLimit}subscribe(){this.subscription.add((0,l.fromEvent)(this.video,"resize").subscribe(this.handleChangeVideoQuality));let e=(0,l.interval)(this.droppedFramesChecker.checkTime).pipe((0,l.filter)((()=>this.playing)),(0,l.filter)((()=>{let e=!!this.isForceCheckCounter;return e&&(this.isForceCheckCounter-=1),!e}))),t=this.forceChecker$.pipe((0,l.debounce)(this.droppedFramesChecker.checkTime)),i=(0,l.merge)(e,t);this.subscription.add(i.subscribe(this.checkDroppedFrames))}onChangeQuality(e){this.currentQuality=e;let{totalVideoFrames:t,droppedVideoFrames:i}=this.video.getVideoPlaybackQuality();this.savePrevFrameCounts(t,i),this.isForceCheckCounter=this.droppedFramesChecker.tickCountAfterQualityChange,this.forceChecker$.next()}onDroopedVideoFramesLimitTrigger(){this.isAuto.getState()&&(this.log({message:`[onDroopedVideoFramesLimit]. maxQualityLimit: ${this.maxQualityLimit}`}),this.onDroopedVideoFramesLimit$.next())}getMaxQualityLimit(e){let t=(0,Ys.default)(this.limitCounts).filter((([,e])=>e>=this.droppedFramesChecker.countLimit)).sort((([e],[t])=>(0,l.isLower)(e,t)?-1:1))?.[0]?.[0];return e??t}get isEnabled(){return this.droppedFramesChecker.enabled&&this.isDroppedFramesCheckerSupport}get isDroppedFramesCheckerSupport(){return!!this.video&&"function"==typeof this.video.getVideoPlaybackQuality}savePrevFrameCounts(e,t){this.prevTotalVideoFrames=e,this.prevDroppedVideoFrames=t}constructor(){this.onDroopedVideoFramesLimit$=new l.Subject,this.subscription=new l.Subscription,this.playing=!1,this.tracks=[],this.forceChecker$=new l.Subject,this.isForceCheckCounter=0,this.prevTotalVideoFrames=0,this.prevDroppedVideoFrames=0,this.limitCounts={},this.handleChangeVideoQuality=()=>{let e=this.tracks.find((({size:e})=>e?.height===this.video.videoHeight&&e?.width===this.video.videoWidth));e&&!(0,l.isInvariantQuality)(e.quality)&&this.onChangeQuality(e.quality)},this.checkDroppedFrames=()=>{let{totalVideoFrames:e,droppedVideoFrames:t}=this.video.getVideoPlaybackQuality(),i=e-this.prevTotalVideoFrames,r=1-(i-(t-this.prevDroppedVideoFrames))/i;!isNaN(r)&&r>0&&this.log({message:`[dropped]. current dropped percent: ${r}, limit: ${this.droppedFramesChecker.percentLimit}`}),!isNaN(r)&&r>=this.droppedFramesChecker.percentLimit&&(0,l.isHigher)(this.currentQuality,this.droppedFramesChecker.minQualityBanLimit)&&(this.limitCounts[this.currentQuality]=(this.limitCounts[this.currentQuality]??0)+1,this.maxQualityLimit=this.getMaxQualityLimit(this.currentQuality),this.currentTimer&&window.clearTimeout(this.currentTimer),this.currentTimer=window.setTimeout((()=>this.maxQualityLimit=this.getMaxQualityLimit()),this.droppedFramesChecker.qualityUpWaitingTime),this.onDroopedVideoFramesLimitTrigger()),this.savePrevFrameCounts(e,t)}}},Js=()=>!!window.documentPictureInPicture?.window||!!document.pictureInPictureElement,Zs=(e,t)=>new l.Observable((i=>{if(!window.IntersectionObserver)return;let r=new IntersectionObserver(((e,t)=>{e.forEach((e=>i.next(e.isIntersecting||Js())))}),{root:null,...t});r.observe(e);let s=(0,l.fromEvent)(document,"visibilitychange").pipe((0,l.map)((e=>!document.hidden||Js()))).subscribe((e=>i.next(e)));return()=>{r.unobserve(e),s.unsubscribe()}})),ea=["paused","playing","ready"],ta=["paused","playing","ready"],ia=class{destroy(){Qs({m:"dlp.destroy"}),this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.droppedFramesManager.destroy(),this.dash.destroy(),this.params.output.element$.next(void 0),zr(this.video)}createLiveDashPlayer(){let e=new Ks({videoElement:this.video,videoState:this.videoState,playbackState:this.params.desiredState.playbackState,liveOffset:this.liveOffset,config:{maxParallelRequests:this.params.config.maxParallelRequests,minBuffer:this.params.tuning.live.minBuffer,minBufferSegments:this.params.tuning.live.minBufferSegments,lowLatencyMinBuffer:this.params.tuning.live.lowLatencyMinBuffer,lowLatencyMinBufferSegments:this.params.tuning.live.lowLatencyMinBufferSegments,isLiveCatchUpMode:this.params.tuning.live.isLiveCatchUpMode,manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount,useInvalidBufferFix:this.params.tuning.useInvalidBufferFix||!1},playerCallback:this._dashCb,logger:e=>{this.params.dependencies.logger.log({message:String(e),component:"LiveDashPlayer"})}});return e.pause(),e}prepare(){let e=this.representations$.getValue(),t=this.params.desiredState.videoTrack.getTransition()?.to??this.params.desiredState.videoTrack.getState(),i=this.params.desiredState.autoVideoTrackSwitching.getTransition()?.to??this.params.desiredState.autoVideoTrackSwitching.getState(),r=!i&&(0,l.isNonNullable)(t)?t:_s(e.map((({track:e})=>e)),{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,abrLogger:this.params.dependencies.abrLogger}),s=r?.id,a=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.videoTrack.getState()?.id,o=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(r&&(a||s!==n)&&this.setVideoTrack(r),o&&this.setAutoQuality(i),a||o||s!==n){let t=e.find((({track:e})=>e.id===s))?.representation;(0,l.assertNonNullable)(t,"Representations missing"),this.dash.startPlay(t,i)}}setVideoTrack(e){let t=this.representations$.getValue().find((({track:t})=>t.id===e.id))?.representation;(0,l.assertNonNullable)(t,`No such representation ${e.id}`),this.dash.switchByName(t.name),this.params.desiredState.videoTrack.setState(e)}setAutoQuality(e){this.dash.setAutoQualityEnabled(e),this.params.desiredState.autoVideoTrackSwitching.setState(e)}seek(e){this.log({message:`[seek] position: ${e}`}),this.params.output.willSeekEvent$.next();let t=this.params.desiredState.playbackState.getState(),i=this.videoState.getState(),r="paused"===t&&"paused"===i,s=-e,a=s<=this.maxSeekBackTime$.getValue()?s:0;this.params.output.position$.next(e/1e3),Qs({m:"dlp.seek",p:e,no:a,url:this.params.source.url}),this.dash.reinit(ir(this.params.source.url,a)),r&&this.dash.pause(),this.liveOffset.resetTo(a,r)}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.representations$=new l.ValueSubject([]),this.droppedFramesManager=new Xs,this.maxSeekBackTime$=new l.ValueSubject(1/0),this.zeroTime$=new l.ValueSubject(void 0),this.liveOffset=new Xr,this._dashCb=e=>{switch(e.name){case"buffering":{let t=e.isBuffering;this.params.output.isBuffering$.next(t);break}case"error":this.params.output.error$.next({id:`DashLiveProviderInternal:${e.type}`,category:l.ErrorCategory.WTF,message:"LiveDashPlayer reported error"});break;case"manifest":{let t=e.manifest,i=[];for(let e of t){let t=e.name??e.index.toString(10),r=ts(e.name)??(0,l.videoSizeToQuality)(e.video),s=e.bitrate/1e3,a={...e.video};if(!r)continue;let n={id:t,quality:r,bitrate:s,size:a};i.push({track:n,representation:e})}this.representations$.next(i),this.params.output.availableVideoTracks$.next(i.map((({track:e})=>e))),"manifest_ready"===this.videoState.getTransition()?.to&&this.videoState.setState("manifest_ready");break}case"qualitySwitch":{let t=e.quality,i=this.representations$.getValue().find((({representation:e})=>e===t))?.track;this.params.output.hostname$.next(new URL(t.headerUrl,this.params.source.url).hostname),(0,l.isNonNullable)(i)&&this.params.output.currentVideoTrack$.next(i);break}case"bandwidth":{let{size:t,duration:i}=e;this.params.dependencies.throughputEstimator.addRawSpeed(t,i);break}case"index":this.maxSeekBackTime$.next(e.shiftDuration||0),this.zeroTime$.next(e.zeroTime)}},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),s=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; seekState: ${JSON.stringify(s)};`}),"stopped"===i)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.dash.destroy(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped")));if(t)return;let a=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition();if((0,Dr.default)(ta,e)&&(a||n))this.prepare();else if("paused"!==r?.to&&"requested"===s.state&&(0,Dr.default)(ea,e))this.seek(s.position-this.liveOffset.getTotalPausedTime());else switch(e){case"stopped":return this.videoState.startTransitionTo("manifest_ready"),void this.dash.attachSource(ir(this.params.source.url));case"manifest_ready":this.videoState.startTransitionTo("ready"),this.prepare();break;case"ready":if("paused"===i)this.videoState.setState("paused");else if("playing"===i){Qs({m:"dlp.sync.1"}),this.videoState.startTransitionTo("playing");let e=r?.from;e&&"ready"===e&&(Qs({m:"dlp.sync.2"}),this.dash.catchUp()),Qs({m:"dlp.sync.3"}),this.dash.play()}return;case"playing":return void("paused"===i&&(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.dash.pause()));case"paused":if("playing"===i)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.dash.play(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.dash.reinit(ir(this.params.source.url,e))}return;default:return(0,l.assertNever)(e)}},this.textTracksManager=new Yr(e.source.url),this.params=e,this.log=this.params.dependencies.logger.createComponentLog("DashLiveProvider");let t=t=>{e.output.error$.next({id:"DashLiveProvider",category:l.ErrorCategory.WTF,message:"DashLiveProvider internal logic error",thrown:t})};this.subscription.add((0,l.merge)(this.videoState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{Qs({m:"dlp.s.1",t:t+`:${e.from}-${e.to}`}),this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})}))),this.video=jr(e.container,e.tuning),this.params.output.element$.next(this.video),this.dash=this.createLiveDashPlayer(),this.subscription.add(this.dash.soundProhibitedEvent$.subscribe(this.params.output.soundProhibitedEvent$)),this.params.output.duration$.next(1/0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.textTracksManager.connect(this.video,this.params.desiredState,this.params.output);let i=es(this.video);this.subscription.add((()=>i.destroy())),this.subscription.add(this.representations$.pipe((0,l.map)((e=>e.map((({track:e})=>e)))),(0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})))),this.subscription.add(i.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),t)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused")}),t)).add(i.playing$.subscribe((()=>{"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.videoState.setState("playing")}),t)).add(i.error$.subscribe(this.params.output.error$)).add(this.maxSeekBackTime$.pipe((0,l.filterChanged)(),(0,l.map)((e=>-e/1e3))).subscribe(this.params.output.duration$)).add((0,l.combine)({zeroTime:this.zeroTime$.pipe((0,l.filter)(l.isNonNullable)),position:i.timeUpdate$}).subscribe((({zeroTime:e,position:t})=>this.params.output.liveTime$.next(e+1e3*t)),t)).add(Ur(this.video,this.params.desiredState.isLooped,t)).add(Wr(this.video,this.params.desiredState.volume,i.volumeState$,t)).add(i.volumeState$.subscribe(this.params.output.volume$,t)).add(Qr(this.video,this.params.desiredState.playbackRate,i.playbackRateState$,t)).add(i.loadStart$.subscribe(this.params.output.firstBytesEvent$)).add(i.loadedMetadata$.subscribe(this.params.output.loadedMetadataEvent$)).add(i.playing$.subscribe(this.params.output.firstFrameEvent$)).add(i.canplay$.subscribe(this.params.output.canplay$)).add(i.inPiP$.subscribe(this.params.output.inPiP$)).add(i.inFullscreen$.subscribe(this.params.output.inFullscreen$)).add(Zs(this.video).subscribe(this.params.output.elementVisible$)).add(this.params.desiredState.autoVideoTrackLimits.stateChangeStarted$.subscribe((({to:{max:e,min:t}})=>{this.dash.setAutoQualityLimits({max:e&&(0,l.videoQualityToHeight)(e),min:t&&(0,l.videoQualityToHeight)(t)}),this.params.output.autoVideoTrackLimits$.next({max:e,min:t})}))).add(this.videoState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"stopped":this.params.output.position$.next(0),this.params.output.duration$.next(1/0),Qs({m:"dlp.vse.s"}),this.params.desiredState.playbackState.setState("stopped");break;case"manifest_ready":case"ready":"ready"===this.params.desiredState.playbackState.getTransition()?.to&&(Qs({m:"dlp.vse.r"}),this.params.desiredState.playbackState.setState("ready"));break;case"paused":Qs({m:"dlp.vse.pa"}),this.params.desiredState.playbackState.setState("paused");break;case"playing":Qs({m:"dlp.vse.pl"}),this.params.desiredState.playbackState.setState("playing");break;default:return(0,l.assertNever)(e.to)}}),t)).add((0,l.merge)(e.desiredState.playbackState.stateChangeStarted$,e.desiredState.seekState.stateChangeEnded$,e.desiredState.videoTrack.stateChangeStarted$,e.desiredState.autoVideoTrackSwitching.stateChangeStarted$,this.videoState.stateChangeEnded$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0)).subscribe(this.syncPlayback,t))}},ra=g(ni(),1),sa=({id:e,width:t,height:i,bitrate:r,fps:s,quality:a,streamId:n})=>{let o=(a?ts(a):void 0)??(0,l.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:s,streamId:n}},aa=({id:e,bitrate:t})=>({id:e,bitrate:t}),na=({language:e,label:t},{id:i,url:r,isAuto:s})=>({id:i,url:r,isAuto:s,type:"internal",language:e,label:t}),oa=({id:e,language:t,label:i,codecs:r,isDefault:s})=>({id:e,language:t,label:i,codec:(0,ra.default)(r.split("."),0),isDefault:s}),la=({id:e,language:t,label:i,hdr:r,codecs:s})=>({id:e,language:t,hdr:r,label:i,codec:(0,ra.default)(s.split("."),0)}),ua=e=>"template"===e.type,da=class{constructor(e,t){this.fov=e,this.orientation=t}},ca=class{turnCamera(e=0,t=0,i=0){this.pointCameraTo(this.camera.orientation.x+e,this.camera.orientation.y+t,this.camera.orientation.z+i)}pointCameraTo(e=0,t=0,i=0){t=this.limitCameraRotationY(t);let r=e-this.camera.orientation.x,s=t-this.camera.orientation.y,a=i-this.camera.orientation.z;this.camera.orientation.x=e,this.camera.orientation.y=t,this.camera.orientation.z=i,this.lastCameraTurn={x:r,y:s,z:a},this.lastCameraTurnTS=Date.now()}setRotationSpeed(e,t,i){this.rotationSpeed.x=e??this.rotationSpeed.x,this.rotationSpeed.y=t??this.rotationSpeed.y,this.rotationSpeed.z=i??this.rotationSpeed.z}startRotation(){this.rotating=!0}stopRotation(e=!1){e?(this.setRotationSpeed(0,0,0),this.fadeStartSpeed=null):this.startFading(this.rotationSpeed.x,this.rotationSpeed.y,this.rotationSpeed.z),this.rotating=!1}onCameraRelease(){if(this.lastCameraTurn&&this.lastCameraTurnTS){let e=Date.now()-this.lastCameraTurnTS;if(e<this.options.speedFadeThreshold){let t=(1-e/this.options.speedFadeThreshold)*this.options.rotationSpeedCorrection;this.startFading(this.lastCameraTurn.x*t,this.lastCameraTurn.y*t,this.lastCameraTurn.z*t)}}}startFading(e,t,i){this.setRotationSpeed(e,t,i),this.fadeStartSpeed={...this.rotationSpeed},this.fading=!0}stopFading(){this.fadeStartSpeed=null,this.fading=!0,this.fadeTime=0}limitCameraRotationY(e){return Math.max(-this.options.maxYawAngle,Math.min(e,this.options.maxYawAngle))}tick(e){if(!this.lastTickTS)return this.lastTickTS=e,void(this.lastCameraTurnTS=Date.now());let t=e-this.lastTickTS,i=t/1e3;if(this.rotating)this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i);else if(this.fading&&this.fadeStartSpeed){let e=-this.fadeCorrection*(this.fadeTime/1e3)**2+1;this.setRotationSpeed(this.fadeStartSpeed.x*e,this.fadeStartSpeed.y*e,this.fadeStartSpeed.z*e),e>0?this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i):(this.stopRotation(!0),this.stopFading()),this.fadeTime=Math.min(this.fadeTime+t,this.options.speedFadeTime)}this.lastTickTS=e}constructor(e,t){this.rotating=!1,this.fading=!1,this.lastTickTS=0,this.lastCameraTurnTS=0,this.fadeStartSpeed=null,this.fadeTime=0,this.camera=e,this.options=t,this.rotationSpeed={x:0,y:0,z:0},this.fadeCorrection=1/(this.options.speedFadeTime/1e3)**2}},ha=class{play(){this.active||(this.videoInitialized?this.doPlay():this.sourceVideoElement.readyState>=2?(this.videoInitialized=!0,this.doPlay()):this.sourceVideoElement.addEventListener("loadeddata",this.videoElementDataLoadedFn))}stop(){this.active=!1}startCameraManualRotation(e,t){this.cameraRotationManager.setRotationSpeed(e*this.params.rotationSpeed,t*this.params.rotationSpeed,0),this.cameraRotationManager.startRotation()}stopCameraManualRotation(e=!1){this.cameraRotationManager.stopRotation(e)}turnCamera(e,t){this.cameraRotationManager.turnCamera(e,t)}pointCameraTo(e,t){this.cameraRotationManager.pointCameraTo(e,t)}pixelToDegree(e){return{x:this.params.degreeToPixelCorrection*this.params.fov.x*-e.x/this.viewportWidth,y:this.params.degreeToPixelCorrection*this.params.fov.y*e.y/this.viewportHeight}}getCameraRotation(){return this.camera.orientation}holdCamera(){this.cameraRotationManager.stopRotation(!0)}releaseCamera(){this.cameraRotationManager.onCameraRelease()}destroy(){this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),this.stop(),this.canvas.remove()}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t,this.canvas.width=this.viewportWidth,this.canvas.height=this.viewportHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}onDataLoadedHandler(){this.videoInitialized=!0,this.doPlay()}doPlay(){this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.active=!0,this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),requestAnimationFrame(this.renderFn)}render(e){this.cameraRotationManager.tick(e),this.updateTexture(),this.updateTextureMappingBuffer();let t=this.gl.getAttribLocation(this.program,"a_vertex"),i=this.gl.getAttribLocation(this.program,"a_texel"),r=this.gl.getUniformLocation(this.program,"u_texture"),s=this.gl.getUniformLocation(this.program,"u_focus");this.gl.enableVertexAttribArray(t),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.uniform1i(r,0),this.gl.uniform2f(s,-this.camera.orientation.x,-this.camera.orientation.y),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disableVertexAttribArray(t),this.gl.disableVertexAttribArray(i),this.active&&requestAnimationFrame(this.renderFn)}createShader(e,t){let i=this.gl.createShader(t);if(!i)throw this.destroy(),new Error(`Could not create shader (${t})`);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw this.destroy(),new Error("An error occurred while compiling the shader: "+this.gl.getShaderInfoLog(i));return i}createProgram(){let e=this.gl.createProgram();if(!e)throw this.destroy(),new Error("Could not create shader program");let t=this.createShader("attribute vec2 a_vertex;\nattribute vec2 a_texel;\n\nvarying vec2 v_texel;\n\nvoid main(void) {\n    // direct vertex drawing\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\n    // save texel vector to pass to fragment shader\n    v_texel = a_texel;\n}\n",this.gl.VERTEX_SHADER),i=this.createShader("#ifdef GL_ES\n    precision highp float;\n    precision highp int;\n#else\n    precision highp float;\n#endif\n\n#define PI 3.14159265358979323846264\n\nvarying vec2 v_texel; // [0..1, 0..1]\n\nuniform sampler2D u_texture;\nuniform vec2 u_focus; // current central point [-180..180, -90..90] (degrees)\n\nvoid main(void) {\n    // center point of output projection\n    float lambda0 = u_focus.x / 360.0;\n    float phi0 = u_focus.y / 180.0;\n\n    float lambda = PI * 2.0 * (v_texel.x - 0.5 - lambda0); // [-pi..+pi] (rad)\n    float phi = PI * (v_texel.y - 0.5 - phi0); // [-pi/2..+pi/2] (rad)\n\n    float p = sqrt(lambda * lambda + phi * phi); // rou\n    float c = atan(p);\n    float cos_c = cos(c);\n    float sin_c = sin(c);\n\n    // geo coordinates of projection\n    float x = lambda0 + atan(\n        lambda * sin_c,\n        p * cos(phi0) * cos_c - phi * sin(phi0) * sin_c\n    );\n    float y = asin(cos_c * sin(phi0) + (phi * sin_c * cos(phi0)) / p);\n\n    // reprojected texture coordinates\n    vec2 tc = vec2(\n        mod(x / (PI * 2.0) - 0.5, 1.0), // [0..1]\n        mod(y / PI - 0.5, 1.0) // [0..1]\n    );\n\n    // sample using new coordinates\n    gl_FragColor = texture2D(u_texture, tc);\n}\n",this.gl.FRAGMENT_SHADER);if(this.gl.attachShader(e,t),this.gl.attachShader(e,i),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))throw this.destroy(),new Error("Could not link shader program.");return e}createTexture(){let e=this.gl.createTexture();if(!e)throw this.destroy(),new Error("Could not create texture");return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e}updateTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.sourceVideoElement),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}createVertexBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create vertex buffer");let t=1,i=1,r=this.frameHeight/(this.frameWidth/this.viewportWidth);return r>this.viewportHeight?t=this.viewportHeight/r:i=r/this.viewportHeight,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-t,-i,t,-i,t,i,-t,i]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}createTextureMappingBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create texture mapping buffer");return e}calculateTexturePosition(){let e=.5-this.camera.orientation.x/360,t=.5-this.camera.orientation.y/180,i=this.camera.fov.x/360/2,r=this.camera.fov.y/180/2;return[e-i,t-r,e+i,t-r,e+i,t+r,e-i,t+r]}updateTextureMappingBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([...this.calculateTexturePosition()]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}updateFrameSize(){this.frameWidth=this.sourceVideoElement.videoWidth,this.frameHeight=this.sourceVideoElement.videoHeight}createCanvas(){let e=document.createElement("canvas");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e}constructor(e,t,i){this.videoInitialized=!1,this.active=!1,this.container=e,this.sourceVideoElement=t,this.params=i,this.canvas=this.createCanvas();let r=this.canvas.getContext("webgl");if(!r)throw new Error("Could not initialize WebGL context");this.gl=r,this.container.appendChild(this.canvas),this.camera=new da(this.params.fov,this.params.orientation),this.cameraRotationManager=new ca(this.camera,{rotationSpeed:this.params.rotationSpeed,maxYawAngle:this.params.maxYawAngle,rotationSpeedCorrection:this.params.rotationSpeedCorrection,degreeToPixelCorrection:this.params.degreeToPixelCorrection,speedFadeTime:this.params.speedFadeTime,speedFadeThreshold:this.params.speedFadeThreshold}),this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.textureMappingBuffer=this.createTextureMappingBuffer(),this.updateTextureMappingBuffer(),this.program=this.createProgram(),this.videoTexture=this.createTexture(),this.gl.useProgram(this.program),this.videoElementDataLoadedFn=this.onDataLoadedHandler.bind(this),this.renderFn=this.render.bind(this)}},pa=(e,t,i)=>i*t+(1-i)*e,fa=(e,t)=>e.reduce(((e,t)=>e+t),0)/t,ma="stalls_manager_metrics",ga="stalls_manager_abr_params",va="stalls_manager_default_tuning_abr_params",ba=class{init(e){this.currentStallDuration$=e.currentStallDuration$,this.videoLastDataObtainedTimestamp$=e.videoLastDataObtainedTimestamp$,this.throughput$=e.throughput$,this.rtt$=e.rtt$,this.tuning=e.tuning,this.abrParams=e.abrParams,this.duration=e.duration,this.resetStoredAbrParamsIfNeeded(),this.subscribe(e)}get videoMaxQualityLimit(){return this.maxQualityLimit}get predictedThroughput(){return this.predictedThroughputWithoutData}get abrTuningParams(){let e=(this.tuning.ignoreDynamicAbrForShortVideo?this.tuning.enabled&&this.duration>this.tuning.minTvtToBeCounted:this.tuning.enabled)?this.getStoredData(ga):{};return{...this.abrParams,...e}}set lastVideoTrackSelected(e){this.lastUniqueVideoTrackSelected?.id!==e.id&&(this.lastUniqueVideoTrackSelected=e,this.lastUniqueVideoTrackSelectedTimestamp=(0,l.now)(),this.currentStallsCount=0)}destroy(){window.clearTimeout(this.qualityRestrictionTimer),this.subscription.unsubscribe(),0!==this.currentStallDuration$.getValue()&&this.updateStallData();let e=((0,l.now)()-this.providerStartWatchingTimestamp-this.sumStallsDuration)/1e3,t=this.sumStallsDuration;this.addStallInfoToHistory(e,t),this.updateStoredAbrParams()}resetStoredAbrParamsIfNeeded(){let{bitrateFactorAtEmptyBuffer:e,bitrateFactorAtFullBuffer:t,containerSizeFactor:i}={...this.getStoredData(va)},{bitrateFactorAtEmptyBuffer:r,bitrateFactorAtFullBuffer:s,containerSizeFactor:a}={...this.abrParams};this.tuning.enabled&&e===r&&t===s&&i===a||(this.removeStoredData(ga),this.setStoredData(va,{bitrateFactorAtEmptyBuffer:r,bitrateFactorAtFullBuffer:s,containerSizeFactor:a}))}updateStoredAbrParams(){let e=[],t=this.getStoredData(ma,"[]");if(!this.tuning.enabled||t.length<this.tuning.stallsMetricsHistoryLength)return;let i=t.reduce(((e,t)=>e+t.tvt),0);if(this.tuning.useTotalStallsDurationPerTvt){let r=t.reduce(((e,t)=>e+t.stallsDuration),0)/i;e.push(this.calculateOptimalAbrParams(r,i))}if(this.tuning.useAverageStallsDurationPerTvt){let r=t.reduce(((e,t)=>e+t.stallsDurationPerTvt),0)/t.length;e.push(this.calculateOptimalAbrParams(r,i))}this.tuning.useEmaStallsDurationPerTvt&&e.push(this.calculateOptimalAbrParams(t[t.length-1].stallsDurationPerTvtSmoothed,i));let r={bitrateFactorAtEmptyBuffer:Math.max(...e.map((e=>e.bitrateFactorAtEmptyBuffer))),bitrateFactorAtFullBuffer:Math.max(...e.map((e=>e.bitrateFactorAtFullBuffer))),containerSizeFactor:Math.min(...e.map((e=>e.containerSizeFactor)))};this.setStoredData(ma,[]),this.setStoredData(ga,r)}calculateOptimalAbrParams(e,t){let{targetStallsDurationPerTvt:i,deviationStallsDurationPerTvt:r,criticalStallsDurationPerTvt:s,abrAdjustingSpeed:a,significantTvt:n}=this.tuning,o=a*Math.min(t/n,1),l=this.abrTuningParams;return e<i-r?l={bitrateFactorAtEmptyBuffer:Math.max(l.bitrateFactorAtEmptyBuffer-o,this.abrParams.minBitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.max(l.bitrateFactorAtFullBuffer-o,this.abrParams.minBitrateFactorAtFullBuffer),containerSizeFactor:Math.min(l.containerSizeFactor+o,this.abrParams.maxContainerSizeFactor)}:e>i+r&&(l={bitrateFactorAtEmptyBuffer:Math.min(l.bitrateFactorAtEmptyBuffer+o,this.abrParams.maxBitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.min(l.bitrateFactorAtFullBuffer+o,this.abrParams.maxBitrateFactorAtFullBuffer),containerSizeFactor:Math.max(l.containerSizeFactor-o,this.abrParams.minContainerSizeFactor)}),e>s&&(l={bitrateFactorAtEmptyBuffer:Math.max(l.bitrateFactorAtEmptyBuffer,this.abrParams.bitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.max(l.bitrateFactorAtFullBuffer,this.abrParams.bitrateFactorAtFullBuffer),containerSizeFactor:Math.min(l.containerSizeFactor,this.abrParams.containerSizeFactor)}),l}getStoredData(e,t="{}"){return JSON.parse(l.safeStorage.get(e)??t)}setStoredData(e,t){l.safeStorage.set(e,JSON.stringify(t))}removeStoredData(e){l.safeStorage.remove(e)}addStallInfoToHistory(e,t){if(e<this.tuning.minTvtToBeCounted||e>this.tuning.maxTvtToBeCounted||1e3*e<t)return;let i=this.getStoredData(ma,"[]"),r=t/e,s={tvt:e,stallsDuration:t,stallsDurationPerTvt:r,stallsDurationPerTvtSmoothed:i.length?pa(i[i.length-1].stallsDurationPerTvtSmoothed,t/e,this.tuning.emaAlpha):r};i.push(s),i.length>this.tuning.stallsMetricsHistoryLength&&i.shift(),this.setStoredData(ma,i)}updateStallData(){this.providerStartWatchingTimestamp&&!this.isSeeked$.getValue()&&(this.sumStallsDuration+=Math.min(this.lastStallDuration,this.tuning.maxPossibleStallDuration),this.currentStallsCount++)}subscribe(e){this.subscription.add(e.isSeeked$.subscribe(this.isSeeked$)),this.subscription.add(e.isBuffering$.subscribe(this.isBuffering$)),this.subscription.add(e.looped$.subscribe((e=>this.currentStallsCount=0))),this.subscription.add(e.playing$.pipe((0,l.once)()).subscribe((e=>this.providerStartWatchingTimestamp=(0,l.now)()))),this.subscription.add(this.currentStallDuration$.pipe((0,l.filterChanged)()).subscribe((e=>{let{stallDurationNoDataBeforeQualityDecrease:t,stallCountBeforeQualityDecrease:i,resetQualityRestrictionTimeout:r,ignoreStallsOnSeek:s}=this.tuning;if((0,l.isNullable)(this.lastUniqueVideoTrackSelected)||s&&this.isSeeked$.getValue())return;let a=this.rtt$.getValue(),n=this.throughput$.getValue(),o=this.videoLastDataObtainedTimestamp$.getValue(),u=(0,l.now)(),d=i&&this.currentStallsCount>=i,c=t&&u-this.lastUniqueVideoTrackSelectedTimestamp>=t+a&&u-o>=t+a&&e>=t;(d||c)&&(this.severeStallOccurred$.next(!0),window.clearTimeout(this.qualityRestrictionTimer),this.maxQualityLimit=this.lastUniqueVideoTrackSelected.quality,(0,l.isNonNullable)(this.lastUniqueVideoTrackSelected.bitrate)&&n>this.lastUniqueVideoTrackSelected.bitrate&&(this.predictedThroughputWithoutData=this.lastUniqueVideoTrackSelected.bitrate)),!e&&(0,l.now)()-this.providerStartWatchingTimestamp>this.lastStallDuration&&(this.updateStallData(),this.severeStallOccurred$.next(!1),window.clearTimeout(this.qualityRestrictionTimer),this.qualityRestrictionTimer=window.setTimeout((()=>{this.maxQualityLimit=void 0,this.predictedThroughputWithoutData=0}),r)),this.lastStallDuration=e})))}constructor(){this.isSeeked$=new l.ValueSubject(!1),this.isBuffering$=new l.ValueSubject(!1),this.maxQualityLimit=void 0,this.currentStallsCount=0,this.sumStallsDuration=0,this.lastStallDuration=0,this.providerStartWatchingTimestamp=0,this.lastUniqueVideoTrackSelectedTimestamp=0,this.predictedThroughputWithoutData=0,this.subscription=new l.Subscription,this.severeStallOccurred$=new l.ValueSubject(!1)}},ya=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,l.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,l.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,l.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new l.Subscription,this.pipSize$=new l.ValueSubject(void 0),this.videoSize$=new l.ValueSubject(void 0),this.elementSize$=new l.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=l.noop}},Sa=({subscription:e,desiredState:t,videoElement$:i,observableVideo:r})=>{if(!Tr.browser.isSafari)return;let s=0,a=!1;e.add(t.volume.stateChangeStarted$.pipe((0,l.map)((()=>{let e=t.volume.getTransition(),r=i.getValue();return!(!r||!e)&&(!e.to.muted&&r.muted)})),(0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{s=performance.now(),a=!0}))),e.add(r.playbackRateState$.pipe((0,l.filter)((()=>a)),(0,l.once)()).subscribe((()=>{let e=i.getValue(),r=t.playbackRate.getState();e&&r!==e.playbackRate&&performance.now()-s<1e3&&(e.playbackRate=r)})))},wa=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params;(0,l.isNullable)(this.observableVideo)&&(this.observableVideo=es(this.video),this.subscription.add((()=>this.observableVideo?.destroy())));let i=this.constructor.name,r=t=>{e.error$.next({id:i,category:l.ErrorCategory.WTF,message:`${i} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:this.observableVideo,genericErrorListener:r,connect:(e,t)=>this.subscription.add(e.subscribe(t,r))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:s}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let a=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,l.map)((e=>"none"!==e.to.state)),(0,l.filterChanged)());this.stallsManager.init({isSeeked$:a,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$,duration:this.video.duration}),s(i.ended$,e.endedEvent$),s(i.looped$,e.loopedEvent$),s(i.error$,e.error$),s(i.isBuffering$,e.isBuffering$),s(i.currentBuffer$,e.currentNativeBuffer$),s(i.playing$,e.firstFrameEvent$),s(i.canplay$,e.canplay$),s(i.inPiP$,e.inPiP$),s(i.inFullscreen$,e.inFullscreen$),s(i.loadedMetadata$,e.loadedMetadataEvent$),s(this.player.error$,e.error$),s(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),s(this.player.fetcherError$,e.fetcherError$),s(this.player.lastConnectionType$,e.httpConnectionType$),s(this.player.lastConnectionReused$,e.httpConnectionReused$),s(this.player.isLive$,e.isLive$),s(this.player.currentBuffer$,e.currentBuffer$),s(this.player.lastRequestFirstBytes$.pipe((0,l.filter)(l.isNonNullable),(0,l.once)()),e.firstBytesEvent$),s(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),s(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(Ur(this.video,t.isLooped,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),Sa({subscription:this.subscription,desiredState:t,videoElement$:this.params.output.element$,observableVideo:i}),this.subscription.add(Wr(this.video,t.volume,i.volumeState$,r)),this.subscription.add(Qr(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),s(Zs(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),lr(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.params.tuning.changePlaybackStateToPausedWhenEnded&&this.subscription.add(i.ended$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}))),this.subscription.add(this.player.manifestRequested.subscribe(this.params.output.manifestRequested$)).add(this.player.manifestReceived.subscribe(this.params.output.manifestReceived$)).add(this.player.firstBytesRequested.subscribe(this.params.output.firstBytesRequested$)).add(this.player.firstBytesReceived.subscribe(this.params.output.firstBytesReceived$)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams(),t=this.player.getCodecs();if((0,l.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(oa(i));let e=[];for(let t of i.representations){let r=aa(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let i=[];for(let t of e.video){i.push(la(t));let e=[];for(let i of t.representations){let r=sa({...i,streamId:t.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:t,representation:i}))}this.videoStreamsMap.set(t,e)}this.params.output.availableVideoStreams$.next(i);for(let t of e.text)for(let e of t.representations){let i=na(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),t?.video&&this.params.output.availableVideoCodecs$.next(t.video),t?.audio&&this.params.output.availableAudioCodecs$.next(t.audio),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r));let n=(0,l.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,l.fromEvent)(this.video,"progress")).pipe((0,l.filter)((()=>this.videoTracksMap.size>0))),{abrThrottle:o}=this.params.tuning.dash;o&&(n=n.pipe((0,l.throttle)(o))),this.subscription.add(n.subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition(),r=t.autoVideoTrackSwitching.getState();if("manifest_ready"!==e&&"running"!==e||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState());let s=this.selectVideoAudioRepresentations();if(!s)return;let[a,n]=s,o=[...this.videoTracksMap.keys()].find((e=>this.videoTracksMap.get(e)?.representation.id===a.id));(0,l.isNonNullable)(o)&&(this.stallsManager.lastVideoTrackSelected=o);let u=this.params.desiredState.autoVideoTrackLimits.getTransition();u&&this.params.output.autoVideoTrackLimits$.next(u.to),"manifest_ready"===e?await this.player.initRepresentations(a.id,n?.id,this.params.sourceHls):(await this.player.switchRepresentation("video",a.id,r),n&&await this.player.switchRepresentation("audio",n.id,r))}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=[...this.audioTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:s}]=i,a=this.params.desiredState.audioStream.getTransition();a&&a.to&&a.to.id===s.id&&this.params.desiredState.audioStream.setState(a.to),e.currentAudioStream$.next(oa(s))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let u=t.playbackState.stateChangeStarted$.pipe((0,l.map)((({to:e})=>"ready"===e)),(0,l.filterChanged)());this.subscription.add((0,l.merge)(u,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,l.merge)(u,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let d=(0,l.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(d.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?ws:Ss,t=this.params.tuning.useNewAutoSelectVideoTrack?As:Es,i=this.params.tuning.useNewAutoSelectVideoTrack?_s:Cs,{desiredState:r,output:s}=this.params,a=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=[...this.videoTracksMap.keys()].find((({id:e})=>e===n)),l=s.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=[...this.videoStreamsMap.keys()].find((({id:e})=>e===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=this.player.bufferLength$.getValue();h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:a?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),g=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),v=[...this.audioStreamsMap.keys()].find((({id:e})=>e===g?.id))??this.audioStreamsMap.keys().next().value,b=0;if(v){if(o&&!a){let t=e(o,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let y=o;(a||!y)&&(y=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}));let S=v&&t(y,c,this.audioStreamsMap.get(v)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),w=this.videoTracksMap.get(y)?.representation,$=S&&this.audioTracksMap.get(S)?.representation;return w&&$?[w,$]:w&&!$&&0===this.audioTracksMap.size?[w,void 0]:void 0}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),zr(this.video),this.tracer.end()}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.observableVideo=null,this.droppedFramesManager=new Xs,this.stallsManager=new ba,this.elementSizeManager=new ya,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new ms,this.audioTrackSwitchHistory=new ms,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&lr(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&lr(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new ha(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new Yr(e.source.url),this.params=e,this.video=jr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=this.getPlayer(),this.subscribe()}},$a=g(gi(),1),{NativeAbortSignal:xa,NativeAbortController:ka}={NativeAbortSignal:(Hs=typeof self<"u"?self:global).AbortSignal,NativeAbortController:Hs.AbortController};var Ta=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},_a=class extends Ta{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}throwIfAborted(){let{aborted:e,reason:t="Aborted"}=this;if(e)throw t}static timeout(e){let t=new Ca;return setTimeout((()=>t.abort(new DOMException(`This signal is timeout in ${e}ms`,"TimeoutError"))),e),t.signal}static any(e){let t=new Ca;function i(){t.abort(this.reason),function(){for(let t of e)t.removeEventListener("abort",i)}()}for(let r of e){if(r.aborted){t.abort(r.reason);break}r.addEventListener("abort",i)}return t.signal}constructor(){super(),this.listeners||Ta.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Ca=class{abort(e){let t=function(e){if(void 0===e)if(typeof document>"u")(e=new Error("This operation was aborted")).name="AbortError";else try{e=new DOMException("signal is aborted without reason"),Object.defineProperty(e,"name",{value:"AbortError"})}catch{(e=new Error("This operation was aborted")).name="AbortError"}return e}(e),i=function(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}return t.reason=e,t}(t);this.signal.reason=t,this.signal.dispatchEvent(i)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new _a,writable:!0,configurable:!0})}};function Ea(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Ca.prototype[Symbol.toStringTag]="AbortController",_a.prototype[Symbol.toStringTag]="AbortSignal");var Aa="fetch"in window&&Ea({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),La=Aa?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s=!1}=e;if(!Ea({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s}))return{fetch:t,Request:a};let a=i;(a&&!a.prototype.hasOwnProperty("signal")||s)&&(a=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let s=new i(e,t);return r&&Object.defineProperty(s,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),s},a.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=a&&a.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let s=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([s,n(e,t)])}return n(e,t)},Request:a}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Pa=Aa?La.fetch:window.fetch,Ma=(Aa?La.Request:window.Request,Aa?Ca:window.AbortController),Ia=(Aa||window.AbortSignal,g(Ve(),1)),Ra=g(_i(),1),Va=e=>{if(!e)return{id:"EmptyResponse",category:l.ErrorCategory.PARSER,message:"Empty response"};if(e.length<=2&&e.match(/^\d+$/))return{id:`UVError#${e}`,category:l.ErrorCategory.NETWORK,message:`UV Error ${e}`};let t=(0,Ra.default)(e).substring(0,100).toLowerCase();return t.startsWith("<!doctype")||t.startsWith("<html>")||t.startsWith("<body>")||t.startsWith("<head>")?{id:"UnexpectedHTML",category:l.ErrorCategory.NETWORK,message:"Received unexpected HTML, possibly a ISP block"}:t.startsWith("<?xml")?(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?{id:"InvalidXML",category:l.ErrorCategory.PARSER,message:"XML parsing error"}:{id:"XMLParserLogicError",category:l.ErrorCategory.PARSER,message:"Response is valid XML, but parser failed"}:void 0},Na=e=>{let t=new URL(e);return t.searchParams.set("quic","1"),t.toString()},Ba=e=>{let t=e.get("X-Delivery-Type"),i=e.get("X-Reused");return{type:null===t?"http1":t??void 0,reused:null===i?void 0:{1:!0,0:!1}[i]??void 0}},Da=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),Oa=e=>{let t=new URL(e);return t.searchParams.set("enable-subtitles","yes"),t.toString()},Fa=class{onHeadersReceived(e){let{type:t,reused:i}=Ba(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return this.fetchTemplateRepresentation(e,i)??null;default:(0,l.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.subscription.unsubscribe(),this.tracer.end()}async doFetch(e,t){let i=await Pa(e,t);if(i.ok)return i;let r=await i.text(),s=parseInt(r);if(!isNaN(s))switch(s){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:l.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:l.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:l.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:l.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${s})`,category:l.ErrorCategory.FATAL})}}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:s=!1}){this.manifestRequested=new l.Subject,this.manifestReceived=new l.Subject,this.firstBytesRequested=new l.Subject,this.firstBytesReceived=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.recoverableError$=new l.Subject,this.error$=new l.Subject,this.abortAllController=new Ma,this.subscription=new l.Subscription,this.fetchManifest=(0,l.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Na(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=Oa(i)),this.manifestRequested.next();let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(ja);return r?(t.log("success",(0,l.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.manifestReceived.next(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",(0,l.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,l.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:s="auto",signal:a,measureThroughput:n=!0,isLowLatency:o=!1,bufferOptimisation:u=!1}={}){let d=e,c=new Headers,h=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:c.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(d,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),d=e.toString();break}default:(0,l.assertNever)(t)}this.requestQuic&&(d=Na(d));let p,f=this.abortAllController.signal;if(a){let e=new Ma;if(p=(0,l.merge)((0,l.fromEvent)(this.abortAllController.signal,"abort"),(0,l.fromEvent)(a,"abort")).subscribe((()=>{try{e.abort()}catch(e){ja(e)}})),this.subscription.add(p),this.abortAllController.signal.aborted||a.aborted)try{e.abort()}catch(e){ja(e)}f=e.signal}let m=0,g=(0,l.now)();h.log("startRequest",(0,l.flattenObject)({url:d,priority:s,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:g})),this.firstBytesRequested.next();let v=yield this.doFetch(d,{priority:s,headers:c,signal:f}),b=(0,l.now)();if(!v)return h.error("error",{message:"No response in request"}),h.end(),p?.unsubscribe(),null;if(this.throughputEstimator?.addRawRtt(b-g),!v.ok||!v.body){p?.unsubscribe();let e=`Fetch error ${v.status}: ${v.statusText}`;return h.error("error",{message:e}),h.end(),Promise.reject(new Error(`Fetch error ${v.status}: ${v.statusText}`))}if(this.onHeadersReceived(v.headers),!r&&!n){p?.unsubscribe();let e=(0,l.now)(),t={requestStartedAt:g,requestEndedAt:e,duration:e-g};return h.log("endRequest",(0,l.flattenObject)(t)),h.end(),v.arrayBuffer()}let y=v.body;if(n){let e;[y,e]=v.body.tee(),this.throughputEstimator?.trackStream(e,o)}let S,w=y.getReader(),$=parseInt(v.headers.get("content-length")??"",10);Number.isFinite($)&&(S=$),!S&&i&&(S=i.to-i.from+1);let x=S?new Uint8Array(S):new Uint8Array(0),k=!1,T=e=>{p?.unsubscribe(),k=!0,ja(e)},_=(0,l.abortable)(f,async function*({done:e,value:t}){if(0===m&&(this.lastRequestFirstBytes$.next((0,l.now)()-g),this.firstBytesReceived.next()),f.aborted)p?.unsubscribe();else if(!e&&t){if(u&&S)x.set(t,m),m+=t.byteLength;else{let e=new Uint8Array(x.length+t.length);e.set(x),e.set(t,x.length),x=e,m+=t.byteLength}r?.(new DataView(x.buffer),m),yield w?.read().then(_,T)}}.bind(this));yield w?.read().then(_,T),p?.unsubscribe();let C=(0,l.now)(),E={failed:k,requestStartedAt:g,requestEndedAt:C,duration:C-g};return k?(h.error("endRequest",(0,l.flattenObject)(E)),h.end(),null):(h.log("endRequest",(0,l.flattenObject)(E)),h.end(),x.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,s,{from:a,to:n}=e.initRange,o=a,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,s=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,a),l=Math.max(s,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},priority:i,measureThroughput:!1});if(!d)return null;let c=new DataView(d,a-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f).map((e=>({networkStatus:"none",bufferStatus:"none",status:"none",time:e.time,byte:e.byte})));return{initMetadata:p,initDataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});if(!r)return null;let s=e.segments.map((e=>({...e,networkStatus:"none",bufferStatus:"none",status:"none",size:void 0})));return{initMetadata:null,initDataView:new DataView(r),segments:s}}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=s}},ja=e=>{if(!Da(e))throw e},za=g(Bi(),1),qa=g(Oe(),1),Ha=g(Hi(),1),Ua=g(ni(),1),Wa=g(Ae(),1),Qa=g(Ve(),1),Ga=e=>{let t=e.split("."),[i,...r]=t;if(!i)return!1;switch(i){case"av01":{let[e,t,i]=r;return!!(i&&parseInt(i,10)>8)}case"vp09":{let[e,t,i]=r;return!!(e&&parseInt(e,10)>=2&&i&&parseInt(i,10)>8)}case"avc1":{let e=r[0];if(!e||6!==e.length)return!1;let[t,i]=e.toUpperCase(),s=t+i;return(0,Qa.default)(["6E","7A","F4"],s)}}return!1},Ka=e=>{if(e.includes("/")){let t=e.split("/");return parseInt(t[0])/parseInt(t[1])}return parseFloat(e)},Ya=e=>{try{let t=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),i=e.match(t),{groups:r}=i??{};if(r){let e={};if(r.extensions){let t=r.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let t=r.variants?.split(/-/).filter((e=>""!==e)),i={extlang:r.extlang,langtag:r.langtag,language:r.language,privateuse:r.privateuse||r.privateuse2,region:r.region,script:r.script,extensions:e,variants:t};return Object.keys(i).forEach((e=>{let t=i[e];(typeof t>"u"||""===t)&&delete i[e]})),i}return null}catch{return null}};var Xa=e=>{if(!e?.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===i?.[1]?-1:1;return 24*t(i?.[5],r)*60*60*1e3+60*t(i?.[6],r)*60*1e3+60*t(i?.[7],r)*1e3+1e3*t(i?.[8],r)},Ja=(e,t)=>{let i=e;i=(0,za.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,qa.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,za.default)(i,r,((e,i)=>(0,l.isNullable)(t)?e:(0,l.isNullable)(i)?t:(0,Ha.default)(t,parseInt(i,10),"0")))}return i},Za=(e,t)=>{let i,r={video:[],audio:[],text:[]},s=(new DOMParser).parseFromString(e,"application/xml").children[0],a=Array.from(s.querySelectorAll("MPD > BaseURL").values()).map((e=>e.textContent?.trim()??"")),n=(0,Ua.default)(a,0)??"",o="dynamic"===s.getAttribute("type"),u=s.getAttribute("availabilityStartTime"),d=s.getAttribute("publishTime"),c=s.getElementsByTagName("vk:Attrs")[0],h=c?.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,p=c?.getElementsByTagName("vk:XStreamIsLive")[0].textContent,f=c?.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,m=c?.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;o&&(i={availabilityStartTime:u?new Date(u).getTime():0,publishTime:d?new Date(d).getTime():0,latestSegmentPublishTime:h?new Date(h).getTime():0,streamIsAlive:"yes"===p,streamIsUnpublished:"yes"===f});let g,v=s.getAttribute("mediaPresentationDuration"),b=[...s.getElementsByTagName("Period")],y=b.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),S=b.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});v?g=Xa(v):(0,Wa.default)(S).filter((e=>e)).length&&!o?g=(0,Wa.default)(S).reduce(((e,t)=>e+(Xa(t)??0)),0):m&&(g=parseInt(m,10));let w=0,$=s.getAttribute("profiles")?.split(",")??[];for(let e of b.map((e=>e.id)))for(let i of y[e]){let e=i.getAttribute("id")??"id"+(w++).toString(10),s=i.getAttribute("mimeType")??"",a=i.getAttribute("codecs")??"",o=i.getAttribute("contentType")??s?.split("/")[0],u=i.getAttribute("profiles")?.split(",")??[],d=Ya(i.getAttribute("lang")??"")??{},c=i.querySelector("Label")?.textContent?.trim()??void 0,h=i.querySelectorAll("Representation"),p=i.querySelector("SegmentTemplate"),f=i.querySelector("Role")?.getAttribute("value")??void 0,m=o,v={id:e,language:d.language,isDefault:"main"===f,label:c,codecs:a,hdr:"video"===m&&Ga(a),mime:s,representations:[]};for(let e of h){var x,k,T,_,C;let r,h=e.getAttribute("lang")??void 0,f=c??i.getAttribute("label")??e.getAttribute("label")??void 0,b=e.querySelector("BaseURL")?.textContent?.trim()??"",y=new URL(b||n,t).toString(),S=e.getAttribute("mimeType")??s,E=e.getAttribute("codecs")??a??"";if("text"===o){let t=e.getAttribute("id")||"",i=d.privateuse?.includes("x-auto")||t.includes("_auto"),s=e.querySelector("SegmentTemplate");if(s){let a={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},n=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,o=parseInt(s.getAttribute("startNumber")??"",10)??1,l=parseInt(s.getAttribute("timescale")??"",10),u=s.querySelectorAll("SegmentTimeline S")??[],d=s.getAttribute("media");if(!d)continue;let c=[],h=0,p="",f=0,m=o,v=0;for(let e of u){let t=parseInt(e.getAttribute("d")??"",10),i=parseInt(e.getAttribute("r")??"",10)||0,r=parseInt(e.getAttribute("t")??"",10);v=Number.isFinite(r)?r:v;let s=t/l*1e3,n=v/l*1e3;for(let e=0;e<i+1;e++){let i=Ja(d,{...a,segmentNumber:m.toString(10),segmentTime:(v+e*t).toString(10)}),r=(n??0)+e*s,o=r+s;m++,c.push({time:{from:r,to:o},url:i})}v+=(i+1)*t,h+=(i+1)*s}f=v/l*1e3,p=Ja(d,{...a,segmentNumber:m.toString(10),segmentTime:v.toString(10)}),r={id:t,kind:"text",segmentReference:{type:"template",baseUrl:y,segmentTemplateUrl:d,initUrl:"",totalSegmentsDurationMs:h,segments:c,nextSegmentBeyondManifest:{time:{from:f,to:1/0},url:p},timescale:l},profiles:[],duration:g,bitrate:n,mime:"",codecs:"",width:0,height:0,isAuto:i}}else r={id:t,isAuto:i,kind:"text",url:y}}else{let t,s=e.getAttribute("contentType")??S?.split("/")[0]??o,a=i.getAttribute("profiles")?.split(",")??[],n=parseInt(e.getAttribute("width")??"",10),d=parseInt(e.getAttribute("height")??"",10),c=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,h=e.getAttribute("frameRate")??"",f=e.getAttribute("quality")??void 0,v=h?Ka(h):void 0,b=`${e.getAttribute("id")??"id"+(w++).toString(10)}@${"video"===s?`${d}p`:"audio"===s?`${c}Kbps`:E}`,x=[...$,...u,...a],k=e.querySelector("SegmentBase"),T=e.querySelector("SegmentTemplate")??p;if(k){let i=e.querySelector("SegmentBase Initialization")?.getAttribute("range")??"",[r,s]=i.split("-").map((e=>parseInt(e,10))),a={from:r,to:s},n=e.querySelector("SegmentBase")?.getAttribute("indexRange"),[o,l]=n?n.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:y,initRange:a,indexRange:n?{from:o,to:l}:void 0}}else{if(!T)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},r=parseInt(T.getAttribute("timescale")??"",10),s=T.getAttribute("initialization")??"",a=T.getAttribute("media"),n=parseInt(T.getAttribute("startNumber")??"",10)??1,o=Ja(s,i);if(!a)throw new ReferenceError("No media attribute in SegmentTemplate");let u=T.querySelectorAll("SegmentTimeline S")??[],d=[],c=0,h="",p=0;if(u.length){let e=n,t=0;for(let s of u){let n=parseInt(s.getAttribute("d")??"",10),o=parseInt(s.getAttribute("r")??"",10)||0,l=parseInt(s.getAttribute("t")??"",10);t=Number.isFinite(l)?l:t;let u=n/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let s=Ja(a,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*n).toString(10)}),o=(h??0)+r*u,l=o+u;e++,d.push({time:{from:o,to:l},url:s})}t+=(o+1)*n,c+=(o+1)*u}p=t/r*1e3,h=Ja(a,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if((0,l.isNonNullable)(g)){let e=parseInt(T.getAttribute("duration")??"",10)/r*1e3,t=Math.ceil(g/e),s=0;for(let r=1;r<t;r++){let t=Ja(a,{...i,segmentNumber:r.toString(10),segmentTime:s.toString(10)});d.push({time:{from:s,to:s+e},url:t}),s+=e}p=s,h=Ja(a,{...i,segmentNumber:t.toString(10),segmentTime:s.toString(10)})}t={type:"template",baseUrl:y,segmentTemplateUrl:a,initUrl:o,totalSegmentsDurationMs:c,segments:d,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!s||!S)continue;let _={video:"video",audio:"audio",text:"text"}[s];if(!_)continue;m||(m=_),r={id:b,kind:_,segmentReference:t,profiles:x,duration:g,bitrate:c,mime:S,codecs:E,width:n,height:d,fps:v,quality:f}}(x=v).language||(x.language=h),(k=v).label||(k.label=f),(T=v).mime||(T.mime=S),(_=v).codecs||(_.codecs=E),(C=v).hdr||(C.hdr="video"===m&&Ga(E)),v.representations.push(r)}if(m){let e=r[m].find((e=>e.id===v.id));if(e&&v.representations.every((e=>"template"===e.segmentReference.type)))for(let t of e.representations){let e=v.representations.find((e=>e.id===t.id));if(!e)continue;let i=e.segmentReference,r=t.segmentReference;r.segments.push(...i.segments),r.nextSegmentBeyondManifest=i.nextSegmentBeyondManifest}else r[m].push(v)}}return{duration:g,streams:r,baseUrls:a,live:i}},en=g(ni(),1),tn=g(Ve(),1),rn=e=>{let{webmDecodingInfo:t}=Tr.video,i="DASH_WEBM",r="DASH_WEBM_AV1";switch(e){case"vp9":return[i,r];case"av1":return[r,i];case"none":return[];case"smooth":return t?t[r].smooth?[r,i]:t[i].smooth?[i,r]:[r,i]:[i,r];case"power_efficient":return t?t[r].powerEfficient?[r,i]:t[i].powerEfficient?[i,r]:[r,i]:[i,r];default:(0,l.assertNever)(e)}},sn=({webmCodec:e,androidPreferredFormat:t,iosPreferredFormat:i,preferMultiStream:r})=>{let s=[...r?["DASH_STREAMS"]:[],...rn(e),"DASH_SEP","DASH_ONDEMAND",...r?[]:["DASH_STREAMS"]],a=[...r?["DASH_STREAMS"]:[],"DASH_SEP","DASH_ONDEMAND",...r?[]:["DASH_STREAMS"]];if(Tr.device.isAndroid)switch(t){case"mpeg":return["MPEG",...s,"HLS","HLS_ONDEMAND"];case"hls":return["HLS","HLS_ONDEMAND",...s,"MPEG"];case"dash":return[...s,"HLS","HLS_ONDEMAND","MPEG"];case"dash_any_mpeg":return[...a,"MPEG",...rn(e),"HLS","HLS_ONDEMAND"];case"dash_any_webm":return[...rn(e),"MPEG",...a,"HLS","HLS_ONDEMAND"];case"dash_sep":return["DASH_SEP","MPEG",...rn(e),...a,"HLS","HLS_ONDEMAND"];default:(0,l.assertNever)(t)}if(Tr.video.nativeHlsSupported)switch(i){case"hls":return[...s,"HLS","HLS_FMP4","HLS_ONDEMAND","MPEG"];case"hls_fmp4":return[...s,"HLS_FMP4","HLS","HLS_ONDEMAND","MPEG"];default:(0,l.assertNever)(i)}return[...s,"HLS","HLS_ONDEMAND","MPEG"]},an=({androidPreferredFormat:e,preferCMAF:t,preferWebRTC:i})=>{let r,s=t?["DASH_LIVE_CMAF","DASH_LIVE"]:["DASH_LIVE","DASH_LIVE_CMAF"],a=t?["HLS_LIVE_CMAF","HLS_LIVE"]:["HLS_LIVE","HLS_LIVE_CMAF"],n=[...s,...a],o=[...a,...s],u=Tr.device.isMac&&Tr.browser.isSafari;if(Tr.device.isAndroid)switch(e){case"dash":case"dash_any_mpeg":case"dash_any_webm":case"dash_sep":r=n;break;case"hls":case"mpeg":r=o;break;default:(0,l.assertNever)(e)}else r=!Tr.video.nativeHlsSupported||u||Tr.browser.isChromiumBased?u?t?["DASH_LIVE_CMAF","HLS_LIVE_CMAF","HLS_LIVE","DASH_LIVE"]:["HLS_LIVE","DASH_LIVE","DASH_LIVE_CMAF","HLS_LIVE_CMAF"]:n:o;return i?["WEB_RTC_LIVE",...r]:[...r,"WEB_RTC_LIVE"]},nn=e=>e?["HLS_LIVE","HLS_LIVE_CMAF","DASH_LIVE_CMAF"]:["DASH_WEBM","DASH_WEBM_AV1","DASH_SEP","DASH_ONDEMAND","HLS","HLS_ONDEMAND","MPEG"],on=e=>{if(0===e.size)return;if(1===e.size){let t=e.values().next();return(0,en.default)(t.value.split("."),0)}for(let t of e){let e=(0,en.default)(t.split("."),0);if("opus"===e||"vp09"===e||"av01"===e)return e}let t=e.values().next();return(0,en.default)(t.value.split("."),0)},ln=e=>{let t=e.map((e=>dn(e))),{codecs:i}=Tr.video;return cn().filter((e=>{if(!(0,tn.default)(t,e))return!1;switch(e){case"av1":return i.av1;case"vp9":return i.vp9;case"avc1":return i.h264;case"hev1":return i.h265;default:return!1}}))},un=e=>{let t=e.map((e=>dn(e))),{codecs:i}=Tr.video;return hn().filter((e=>{if(!(0,tn.default)(t,e))return!1;switch(e){case"opus":return i.opus;case"mp4a":return i.aac;default:return!1}}))},dn=e=>e.split(".")[0].replace("0",""),cn=()=>["av1","vp9","hev1","avc1"],hn=()=>["opus","mp4a"],pn=g(ni(),1),fn=e=>"function"==typeof e&&e?.toString().endsWith("{ [native code] }"),mn=!fn(window.requestIdleCallback)||!fn(window.cancelIdleCallback),gn=mn?(e,t={})=>{let i=t.timeout||1,r=performance.now();return window.setTimeout((()=>{e({get didTimeout(){return!t.timeout&&performance.now()-r-1>i},timeRemaining:()=>Math.max(0,performance.now()-r+1)})}),1)}:window.requestIdleCallback,vn=mn?e=>window.clearTimeout(e):window.cancelIdleCallback,bn=g(ni(),1),yn=e=>e.valid,Sn=class{get id(){return this.type}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),1===i&&(this.cursor+=8);let r,s=e.byteOffset+this.cursor;0===i||1===i?(this.size=void 0,this.valid=!1,r=void 0):i>e.byteLength?(this.size=i,this.valid=!1,r=Math.min(i-this.cursor,e.byteLength-this.cursor)):(this.size=i,this.valid=!0,r=i-this.cursor),this.content=new DataView(e.buffer,s,r)}},wn=class extends Sn{},$n=class extends Sn{constructor(e,t){if(super(e,t),!this.valid)return;let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i,this.content=new DataView(this.content.buffer,this.content.byteOffset+4,this.content.byteLength-4)}},xn=class extends $n{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){if(super(e,t),this.valid){this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let s=e>>>28,a=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:s,SAPDeltaTime:a})}}}},kn={ftyp:class extends Sn{constructor(e,t){if(super(e,t),!this.valid)return;this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8);for(let e=0;e<i.byteLength;e+=4){let e=this.readString(4);this.compatibleBrands.push(e)}}},moov:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends $n{constructor(e,t){super(e,t),this.valid&&(this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16())}},moof:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends Sn{constructor(e,t){super(e,t),this.data=this.content}},sidx:xn,trak:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends $n{constructor(e,t){super(e,t),this.valid&&(this.sequenceNumber=this.readUint32())}},tkhd:class extends $n{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends $n{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends $n{get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}},trun:class extends $n{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends $n{constructor(e,t){if(super(e,t),this.valid){switch(this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}}},prhd:class extends $n{constructor(e,t){super(e,t),this.valid&&(this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32())}},proj:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends $n{constructor(e,t){super(e,t),this.valid&&(this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32())}},uuid:class extends Sn{parseData(e,t){if("ondemandlivejson"===e){let e=new TextDecoder("ascii").decode(t),i=JSON.parse(e);return{received:i["t-in"],prepared:i["t-out"]}}(0,l.assertNever)(e)}constructor(e,t){if(super(e,t),!this.valid)return;let i=this.readString(16),r=new DataView(this.content.buffer,this.content.byteOffset+16,this.content.byteLength-16);this.userData=this.parseData(i,r)}},stbl:class extends Sn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends $n{constructor(e,t){super(e,t),this.valid&&(this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+4,this.content.byteLength-4)))}},avc1:class extends Sn{constructor(e,t){super(e,t),this.valid&&(this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78)))}},unknown:wn},Tn=class e{parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;){let r,s=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4));try{r=this.createBox(s,new DataView(e.buffer,e.byteOffset+i,e.byteLength-i))}catch(e){if(!(e instanceof RangeError))throw e}if(!r||!yn(r))break;t.push(r),i+=r.size}return t}createBox(t,i){let r=kn[t];return r?new r(i,new e):new wn(i,new e)}constructor(e={}){this.options={offset:0,...e}}},_n=class{indexBoxLevel(e){e.forEach((e=>{var t,i;yn(e)&&((t=this.index)[i=e.type]??(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children))}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}constructor(e){this.index={},this.indexBoxLevel(e)}},Cn=new TextDecoder("ascii"),En={validateData:e=>"ftyp"===Cn.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new Tn).parse(e),r=new _n(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let s=r.find("equi");s&&(t.projectionData.bounds.top=s.projectionBoundsTop,t.projectionData.bounds.right=s.projectionBoundsRight,t.projectionData.bounds.bottom=s.projectionBoundsBottom,t.projectionData.bounds.left=s.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new xn(e,new Tn),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let s=e.subsegmentDuration/t.timescale*1e3,a={status:"none",time:{from:i,to:i+s},byte:{from:r,to:r+e.referencedSize-1}};return i+=s,r+=e.referencedSize,a}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new Tn).parse(e),r=new _n(i),s=r.findAll("moof"),a=t?r.findAll("uuid"):r.findAll("mdat");if(!a.length||!s.length)return null;let n=s[0],o=a[a.length-1],l=n.source.byteOffset,u=o.source.byteOffset-n.source.byteOffset+o.size;return new DataView(e.buffer,l,u)},getChunkEndTime:(e,t)=>{let i=(new Tn).parse(e),r=new _n(i).findAll("traf"),s=r[r.length-1].children.find((e=>"tfhd"===e.type)),a=r[r.length-1].children.find((e=>"tfdt"===e.type)),n=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=n.sampleDuration.length?n.sampleDuration.reduce(((e,t)=>e+t),0):s.defaultSampleDuration*n.sampleCount,(Number(a.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new Tn).parse(e),i=new _n(t).findAll("uuid"),r=(0,bn.default)(i,-1);return r?{serverDataReceivedTimestamp:r.userData.received,serverDataPreparedTime:r.userData.received}:{}},getTimescaleFromIndex:e=>{let t=(new Tn).parse(e);return new _n(t).find("sidx")?.timescale}},An=g(Ve(),1),Ln={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},Pn=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=Mn(e,i),s=r in Ln,a=s?Ln[r].type:"binary",n=e.getUint8(i),o=0;128&n?o=1:64&n?o=2:32&n?o=3:16&n?o=4:8&n?o=5:4&n?o=6:2&n?o=7:1&n&&(o=8);let l,u=new DataView(e.buffer,e.byteOffset+i+1,o-1),d=(n&255>>o)*2**(8*(o-1))+Mn(u),c=i+o;return l=c+d>e.byteLength?new DataView(e.buffer,e.byteOffset+c):new DataView(e.buffer,e.byteOffset+c,d),{tag:s?r:"0x"+r.toString(16).toUpperCase(),type:a,tagHeaderSize:c,tagSize:c+d,value:l,valueSize:d}},Mn=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},In=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return Mn(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:(0,l.assertNever)(t)}},Rn=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),s=Pn(r);if(!t(s))return;"master"===s.type&&Rn(s.value,t),i=s.value.byteOffset-e.byteOffset+s.valueSize}},Vn=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],Nn=[231,22612,22743,167,171,163,160,175],Bn={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,s=Pn(e);return Rn(s.value,(({tag:e,type:s,value:a})=>(17143===e?t=In(a,s):17026===e?i=In(a,s):17029===e&&(r=In(a,s)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,s,a,n,o=!1,u=!1,d=!1,c=!1;return Rn(e,(({tag:e,type:l,value:h,valueSize:p})=>{if(21419===e){let e=In(h,l);n=Mn(e)}else 21420!==e&&(n=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?u=!0:2807729===e?r=In(h,l):17545===e?s=In(h,l):21420===e&&475249515===n?a=In(h,l):374648427===e?Rn(h,(({tag:e,type:t,value:i})=>30321!==e||(c=1===In(i,t),!1))):o&&u&&(0,An.default)(Vn,e)&&(d=!0),!d})),(0,l.assertNonNullable)(t,"Failed to parse webm Segment start"),(0,l.assertNonNullable)(i,"Failed to parse webm Segment end"),(0,l.assertNonNullable)(s,"Failed to parse webm Segment duration"),r=r??1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(s/1e9*r*1e3),cuesSeekPosition:a,is3dVideo:c,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if((0,l.isNullable)(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,s=!1,a=e=>(0,l.isNonNullable)(e.time)&&(0,l.isNonNullable)(e.position),n=[];return Rn(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&a(i)&&n.push(i),i={};break;case 179:i&&(i.time=In(o,t));break;case 183:break;case 241:i&&(i.position=In(o,t));break;default:r&&(0,An.default)(Vn,e)&&(s=!0)}return!(r&&s)})),i&&a(i)&&n.push(i),n.map(((e,i)=>{let{time:r,position:s}=e,a=n[i+1];return{status:"none",time:{from:r,to:a?a.time:t.segmentDuration},byte:{from:t.segmentStart+s,to:a?t.segmentStart+a.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{Rn(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,An.default)(Nn,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,An.default)([163,160,175],r.tag))),!0)))}catch{}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},Dn=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return Bn;case"mp4":return En}}throw new ReferenceError(`Unsupported mime type ${e}`)},On=g(ni(),1),Fn=({id:e,width:t,height:i,bitrate:r,fps:s,quality:a,streamId:n})=>{let o=(a?ts(a):void 0)??(0,l.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:s,streamId:n}},jn=({id:e,bitrate:t})=>({id:e,bitrate:t}),zn=({language:e,label:t},{id:i,url:r,isAuto:s})=>({id:i,url:r,isAuto:s,type:"internal",language:e,label:t}),qn=({id:e,language:t,label:i,codecs:r,isDefault:s})=>({id:e,language:t,label:i,codec:(0,On.default)(r.split("."),0),isDefault:s}),Hn=({id:e,language:t,label:i,hdr:r,codecs:s})=>({id:e,language:t,hdr:r,label:i,codec:(0,On.default)(s.split("."),0)}),Un=e=>"url"in e,Wn=e=>"template"===e.type,Qn=class{async seek(e){await this.abort(),await this.clearBuffer(),await this.maintain(e)}async maintain(e=this.getCurrentPosition()){(0,l.isNullable)(e)||(await this.maintainPlaybackBuffer(e),await this.maintainNativeBuffer(),this.actualizeLastSegmentInfo(e))}getForwardPlaybackBufferDuration(e=this.getCurrentPosition()){let t=this.getPlaybackBufferState();return(0,l.isNonNullable)(t)&&(0,l.isNonNullable)(e)?t.to-e:0}getPlaybackBufferState(){if(!this.bufferPlaybackQueue.length)return null;return{from:this.bufferPlaybackQueue[0].segment.time.from,to:this.bufferPlaybackQueue[this.bufferPlaybackQueue.length-1].segment.time.to}}async abort(){this.abortDownload(),await this.abortNativeBuffer()}findSegmentStartTime(e){let t=this.downloadingRepresentationId??this.playingRepresentationId??"";return this.segments.get(t)?.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from}getRepresentationInitialTime(){return(0,l.isNullable)(this.playingRepresentationId)?0:(this.segments.get(this.playingRepresentationId)?.[0].time.from??0)/1e3}calculateDurationFromSegments(){if((0,l.isNullable)(this.playingRepresentationId))return 0;let e=this.segments.get(this.playingRepresentationId);return(e?(0,pn.default)(e,-1)?.time.to:0)||0}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.initDataPromises.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.downloadAbortController.abort(),this.destroyAbortController.abort(),this.subscription.unsubscribe(),vn)for(let e of this.idleCallbacks.values())vn(e);this.idleCallbacks.clear(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}forceSwitchCondition(e,t){let i=!0;if("video"===this.kind){let r=Fn(e),s=Fn(t);i=(0,l.isNonNullable)(r)&&(0,l.isNonNullable)(s)&&(0,l.isHigher)(s.quality,r.quality)}else if("audio"===this.kind){let r=jn(e),s=jn(t);i=(0,l.isNonNullable)(r?.bitrate)&&(0,l.isNonNullable)(s?.bitrate)&&s.bitrate>r.bitrate}return i}async clearBuffer(){this.bufferClearingMutex=!0,await this.nativeBufferManager.clear(this.destroyAbortController.signal),this.bufferPlaybackQueue.forEach((e=>e.segment.bufferStatus="none")),this.bufferPlaybackQueue=[],this.bufferClearingMutex=!1}abortDownload(){this.downloadAbortController.abort(),this.downloadAbortController=new Ma,this.abortDownloadingItems(),this.maintainPlaybackBufferMutex=!1}abortDownloadingItems(){for(let e of this.downloadingBufferItems)"downloading"===e.segment.networkStatus&&(e.segment.networkStatus="none",e.segment.size=0,e.segment.loadedBytes=0,e.segment.feedingBytes=0,e.segment.fedBytes=0,e.segment.data=null);this.downloadingBufferItems=[]}async abortNativeBuffer(){this.abortNativeBufferMutex=!0;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0,i=await this.nativeBufferManager.abortBuffer(t);return this.abortNativeBufferMutex=!1,this.maintainNativeBufferMutex=!1,i}async loadInits(e){await this.loadInit(e,"high",!0);for(let[e,t]of this.representations)this.idleCallbacks.set(t.id,gn((async e=>await this.loadInitIfNeeded(t,"low",!1))))}async loadInitIfNeeded(e,t="auto",i=!1){let r,s=this.initDataPromises.get(e.id);r=this.initData.has(e.id)&&this.segments.has(e.id)?Promise.resolve():(0,l.isNonNullable)(s)?s:this.loadInit(e,t,i),await r}async loadInit(e,t="auto",i=!1){try{let i=this.tuning.dash.useFetchPriorityHints?t:"auto",r=this.fetcher.fetchRepresentation(e.segmentReference,this.containerParser,i);this.initDataPromises.set(e.id,r);let{initMetadata:s,initDataView:a,segments:n}=await r??{};if(this.initDataPromises.delete(e.id),(0,l.isNullable)(a)||(0,l.isNullable)(n))return;s&&this.parsedInitData.set(e.id,s);let o=a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);this.initData.set(e.id,o),this.segments.set(e.id,n),this.failedDownloads=0}catch(e){i&&this.error$.next({id:"LoadInits",category:l.ErrorCategory.WTF,message:"loadInit threw",thrown:e})}}async maintainNativeBuffer(){let e=this.getCurrentPosition();if((0,l.isNullable)(e)||this.maintainNativeBufferMutex||this.abortNativeBufferMutex||this.bufferClearingMutex||this.switchMutex||this.preloadOnly)return;this.maintainNativeBufferMutex=!0;let t=this.bufferPlaybackQueue.find((t=>this.withinInterval(e,t.segment.time))),i=this.bufferPlaybackQueue.find((e=>"fed"!==e.segment.bufferStatus)),r=this.initData.get(i?.representationId??""),s=this.bufferPlaybackQueue[0],a=this.downloadAbortController.signal;(0,l.isNonNullable)(r)&&(0,l.isNonNullable)(i)&&(0,l.isNonNullable)(t)&&this.playingRepresentationId!==i.representationId&&this.withinAppendInterval(e,i.segment.time)&&(i===t||"fed"===t.segment.bufferStatus)&&(await this.abortNativeBuffer(),await this.nativeBufferManager.addInitSegment(r,this.downloadAbortController.signal),this.playingRepresentationId=i.representationId,this.playingRepresentation$.next(this.playingRepresentationId)),(0,l.isNonNullable)(i)&&this.withinAppendInterval(e,i.segment.time)&&(i.segment.loadedBytes===i.segment.size&&"none"===i.segment.bufferStatus?await this.appendSegmentFully(i,a):await this.appendSegmentPartially(i,a)),(0,l.isNonNullable)(s)&&this.withinRemoveInterval(e,s.segment.time)&&await this.removeSegment(s,a),this.pruneVirtualBuffer(e),this.maintainNativeBufferMutex=!1}async maintainPlaybackBuffer(e){(0,l.assertNonNullable)(this.downloadingRepresentationId);let t=this.segments.get(this.downloadingRepresentationId),i=this.representations.get(this.downloadingRepresentationId);if((0,l.isNullable)(t)||(0,l.isNullable)(i)||this.maintainPlaybackBufferMutex||this.abortNativeBufferMutex||this.bufferClearingMutex||this.switchMutex)return;this.maintainPlaybackBufferMutex=!0;let r=t.find((t=>e>=t.time.from&&e<t.time.to));(0,l.isNonNullable)(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next(r?.time.to-r.time.from),this.downloadingBufferItems.length||(this.downloadingBufferItems=this.selectDownloadingItems(e,t)),await this.processCachedItems();let s=this.selectItemsToLoad();await this.loadItems(s,i),this.maintainPlaybackBufferMutex=!1}actualizeLastSegmentInfo(e){let t=this.segments.get(this.downloadingRepresentationId??"");if((0,l.isNullable)(t)||0===t.length)return;let i=t[t?.length-1];(0,l.isNullable)(i)||(this.fullyBuffered$.next(i.time.to-e-this.getForwardPlaybackBufferDuration(e)<this.tuning.dash.bufferTolerance),this.onLastSegment$.next(e-i.time.from>0))}selectDownloadingItems(e,t){(0,l.assertNonNullable)(this.downloadingRepresentationId);let i,r,s=this.getPlaybackBufferState();(0,l.isNonNullable)(s)&&this.withinInterval(e,s)?(r=this.forwardBufferTarget-this.getForwardPlaybackBufferDuration(e),i=this.bufferPlaybackQueue[this.bufferPlaybackQueue.length-1].segmentIndex+1):(r=this.forwardBufferTarget,i=t.findIndex((t=>this.withinInterval(e,t.time)))),i=-1===i?0:i;let a=[];for(;i<t.length&&r>0;){a.push({representationId:this.downloadingRepresentationId,segmentIndex:i,segment:t[i]});let{from:e,to:s}=t[i].time;r-=s-e,i++}return a}async processCachedItems(){let e=[...this.downloadingBufferItems];for(;e.length&&"downloaded"===e[0].segment.networkStatus;)await this.onDownloadItem(e[0]),e.shift()}withinInterval(e,{from:t,to:i},r=this.tuning.dash.bufferTolerance){return!!(0,l.isNonNullable)(e)&&(e+r>=t&&e<i)}withinAppendInterval(e,{from:t,to:i}){let{actionTimeShiftFromSegment:r}=this.tuning.dash;return!!(0,l.isNonNullable)(e)&&(e+r>=t&&e+r<i||this.withinInterval(e,{from:t,to:i}))}withinRemoveInterval(e,{to:t}){let{actionTimeShiftFromSegment:i}=this.tuning.dash;return!!(0,l.isNonNullable)(e)&&e-i>t}async appendSegmentFully(e,t){(0,l.isNullable)(e.segment.data)||(e.segment.feedingBytes=e.segment.size,await this.nativeBufferManager.append(e.segment.data,t)&&(e.segment.fedBytes=e.segment.size,this.onItemFullyAppended(e)))}async appendSegmentPartially(e,t){if((0,l.isNullable)(e.segment.data)||(0,l.isNullable)(e.segment.loadedBytes)||(0,l.isNullable)(e.segment.feedingBytes)||(0,l.isNullable)(e.segment.fedBytes)||(0,l.isNullable)(e.segment.size))return;let i=e.segment.data,r=new DataView(i.buffer,i.byteOffset+e.segment.feedingBytes,i.byteLength-e.segment.feedingBytes),s=e.segment.loadedBytes!==e.segment.size?this.parseFeedableSegmentChunk(r):r;s?.byteLength&&(e.segment.bufferStatus="partially_fed",e.segment.feedingBytes+=s.byteLength,await this.nativeBufferManager.append(s,t)&&(e.segment.fedBytes+=s.byteLength,e.segment.fedBytes===e.segment.size&&this.onItemFullyAppended(e)))}parseFeedableSegmentChunk(e){return this.containerParser.parseFeedableSegmentChunk(e,!1)}onItemFullyDownloaded(e){e.segment.networkStatus="downloaded"}onItemFullyAppended(e){e.segment.bufferStatus="fed"}async removeSegment(e,t){let{from:i,to:r}=e.segment.time,s=(r-i)/4;await this.nativeBufferManager.remove(0,r-s,t)&&(e.segment.fedBytes=0,e.segment.feedingBytes=0,e.segment.bufferStatus="none",this.bufferPlaybackQueue.shift())}async onDownloadItem(e){if(!this.downloadingBufferItems.find((t=>t===e)))return;let t=this.getCurrentPosition();return this.downloadingBufferItems=this.downloadingBufferItems.filter((t=>t!==e||"downloaded"!==t.segment.networkStatus)),(this.preloadOnly||(0,l.isNonNullable)(t)&&!this.withinRemoveInterval(t,e.segment.time))&&!this.bufferPlaybackQueue.find((t=>t===e))&&this.bufferPlaybackQueue.push(e),this.maintainNativeBuffer()}pruneVirtualBuffer(e){let{maxVirtualBufferSize:t,virtualBufferPruneSize:i,bufferPruningSafeZone:r}=this.tuning.dash;if(this.currentVirtualBufferSize<t)return;let s=this.currentVirtualBufferSize-t+i;for(let t of this.segments.values())for(let i of t)(0,l.isNonNullable)(i.size)&&s>0&&i.time.to<=e-r&&"none"===i.bufferStatus&&"downloaded"===i.networkStatus&&(i.data=null,i.networkStatus="none",this.currentVirtualBufferSize-=i.size,s-=i.size);for(let t of this.segments.values())for(let i of[...t].reverse())(0,l.isNonNullable)(i.size)&&s>0&&i.time.from>=e+r&&"none"===i.bufferStatus&&"downloaded"===i.networkStatus&&!this.bufferPlaybackQueue.find((e=>e.segment===i))&&!this.downloadingBufferItems.find((e=>e.segment===i))&&(i.data=null,i.networkStatus="none",this.currentVirtualBufferSize-=i.size,s-=i.size)}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())this.updateRepresentationBaseUrl(t,e)}constructor(e,t,i,{fetcher:r,tuning:s,getCurrentPosition:a,manifest:n}){this.error$=new l.Subject,this.playingRepresentation$=new l.ValueSubject(void 0),this.playingRepresentationInit$=new l.ValueSubject(void 0),this.currentSegmentLength$=new l.ValueSubject(0),this.onLastSegment$=new l.ValueSubject(!1),this.fullyBuffered$=new l.ValueSubject(!1),this.initData=new Map,this.initDataPromises=new Map,this.idleCallbacks=new Map,this.parsedInitData=new Map,this.segments=new Map,this.bufferPlaybackQueue=[],this.downloadingBufferItems=[],this.preloadOnly=!1,this.failedDownloads=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.currentVirtualBufferSize=0,this.baseUrls=[],this.baseUrlsIndex=0,this.maintainPlaybackBufferMutex=!1,this.maintainNativeBufferMutex=!1,this.bufferClearingMutex=!1,this.abortNativeBufferMutex=!1,this.switchMutex=!1,this.destroyAbortController=new Ma,this.downloadAbortController=new Ma,this.subscription=new l.Subscription,this.startWith=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,l.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.containerParser=Dn(t.mime),this.nativeBufferManager.init(t.mime,t.codecs,this.tuning.dash.useAbortMSEFix),yield this.loadInits(t);let i=this.initData.get(t.id),r=this.segments.get(t.id),s=this.parsedInitData.get(t.id);(0,l.assertNonNullable)(i,"No init buffer for starting representation"),(0,l.assertNonNullable)(r,"No segments for starting representation"),await this.nativeBufferManager.addInitSegment(i),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(s)}.bind(this)),this.switchTo=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!0){if((0,l.isNullable)(this.downloadingRepresentationId)||e===this.downloadingRepresentationId||e===this.switchingRepresentationId)return;this.switchMutex=!0,this.switchingRepresentationId=e;let i=this.representations.get(this.downloadingRepresentationId),r=this.representations.get(e);(0,l.assertNonNullable)(r,`No such representation ${e}`),(0,l.assertNonNullable)(i,`No such representation ${this.downloadingRepresentationId}`),yield this.loadInitIfNeeded(r,"high");let s=this.initData.get(r.id),a=this.segments.get(r.id);(0,l.assertNonNullable)(s,"No init buffer for switching representation"),(0,l.assertNonNullable)(a,"No segments for switching representation");let n=this.getCurrentPosition()??0,o=e=>"downloaded"!==e.segment.networkStatus||e.segment.time.to-n>this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment,u=e=>{let t=this.representations.get(e.representationId);return(0,l.assertNonNullable)(t,"No itemRepresentation for previous track before switch"),"downloaded"!==e.segment.networkStatus||this.forceSwitchCondition(t,r)},d=e=>t?o(e)&&u(e):o(e);this.bufferPlaybackQueue.filter(d).forEach((e=>e.segment.bufferStatus="none")),this.bufferPlaybackQueue=this.bufferPlaybackQueue.filter((e=>!d(e))),this.downloadingRepresentationId=e,this.switchingRepresentationId=null,this.bufferPlaybackQueue.length?(this.abortDownload(),yield this.maintain()):yield this.seek(n),this.switchMutex=!1}.bind(this)),this.waitExponentialDownloadDelay=(0,l.abortable)(this.downloadAbortController.signal,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),this.subscription.add((0,l.fromEvent)(window,"online").pipe((0,l.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)})))}))}.bind(this)),this.kind=e,this.nativeBufferManager=t,this.fetcher=r,this.tuning=s,this.getCurrentPosition=a,this.forwardBufferTarget=s.dash.forwardBufferTargetAuto,this.baseUrls=n?.baseUrls??[],this.representations=new Map(i.map((e=>[e.id,e])))}},Gn=class extends Qn{async loadItems(e,t,i="auto"){let{signal:r}=this.downloadAbortController;if(r.aborted||!e.length)return;let{url:s,...a}=this.prepareFetchParams(e,t);if(this.failedDownloads&&await this.waitExponentialDownloadDelay(),!r.aborted)try{await this.fetcher.fetch(s,{...a,priority:i}),this.lastDataObtainedTimestampMs=(0,l.now)(),this.failedDownloads=0}catch(e){this.abortDownloadingItems(),Da(e)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}selectItemsToLoad(){let e=0,t=0,i=[],r=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,s=this.preloadOnly?this.forwardBufferTarget:0,a=0;for(;a<this.downloadingBufferItems.length&&"none"===this.downloadingBufferItems[a].segment.networkStatus&&(e<=r||t<=s);){let r=this.downloadingBufferItems[a].segment;r.networkStatus="downloading",r.size=1/0,r.loadedBytes=0,r.feedingBytes=0,r.fedBytes=0,i.push(this.downloadingBufferItems[a]),e+=r.byte.to+1-r.byte.from,t+=r.time.to+1-r.time.from,a++}return i}prepareFetchParams(e,t){if(ua(t.segmentReference))throw new Error("Representation is not byte range type");let{signal:i}=this.downloadAbortController,r=t.segmentReference.url,s={from:e[0].segment.byte.from,to:e[e.length-1].segment.byte.to};return{url:r,range:s,onProgress:async(r,a)=>{if(!i.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)(),await this.onSomeDataLoaded({downloadingItems:e,dataView:r,loaded:a,signal:i,globalFrom:s?s.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}},signal:i,bufferOptimisation:this.tuning.dash.fetcherBufferOptimisation}}async onSomeDataLoaded({downloadingItems:e,dataView:t,representationId:i,globalFrom:r,loaded:s,signal:a}){let n=this.representations.get(i);if(this.downloadingBufferItems.length&&!(0,l.isNullable)(n)&&!(0,l.isNullable)(r)&&!a.aborted)for(let i of e){let{segment:e}=i,a=e.byte.from-r,n=e.byte.to-r,o=n-a+1,u=a<s,d=n<=s;e.size=o,u&&("downloading"===e.networkStatus&&"none"===e.bufferStatus&&d?(e.data=new DataView(t.buffer,t.byteOffset+a,o),this.currentVirtualBufferSize+=e.size,this.onItemFullyDownloaded(i),e.loadedBytes=Math.min(o,s-a),await this.onDownloadItem(i)):(0,l.isNonNullable)(e.feedingBytes)&&this.tuning.dash.enableSubSegmentBufferFeeding&&"downloading"===e.networkStatus&&(e.loadedBytes=Math.min(o,s-a),d&&(this.currentVirtualBufferSize+=e.size,this.onItemFullyDownloaded(i)),e.loadedBytes>e.feedingBytes&&(e.data=new DataView(t.buffer,t.byteOffset+a,e.loadedBytes),await this.onDownloadItem(i))))}}updateRepresentationBaseUrl(e,t){if(ua(e.segmentReference))throw new Error("Representation is not byte range type");e.segmentReference.url=t}constructor(e,t,i,r){super(e,t,i,r)}},Kn=class extends Qn{async loadItems(e,t,i="auto"){let{signal:r}=this.downloadAbortController;if(r.aborted||!e.length)return;let{url:s,...a}=this.prepareFetchParams(e,t);if(this.failedDownloads&&await this.waitExponentialDownloadDelay(),!r.aborted)try{let t=await this.fetcher.fetch(s,{...a,priority:i});if(this.lastDataObtainedTimestampMs=(0,l.now)(),(0,l.isNullable)(t))return;let r=e[0],n=new DataView(t);r.segment.size=n.byteLength,r.segment.loadedBytes=n.byteLength,r.segment.data=n,this.onItemFullyDownloaded(r),await this.onDownloadItem(r),this.failedDownloads=0}catch(e){this.abortDownloadingItems(),Da(e)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}selectItemsToLoad(){let e=[];for(let t of this.downloadingBufferItems){let i=t.segment;i.networkStatus="downloading",i.size=1/0,i.loadedBytes=0,i.feedingBytes=0,i.fedBytes=0,e.push(t)}return e}prepareFetchParams(e,t){let i=this.getFetchUrl(e,t).toString(),{signal:r}=this.downloadAbortController;return{url:i,onProgress:async(i,s)=>{if(!r.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)(),await this.onSomeDataLoaded({downloadingItems:e,dataView:i,loaded:s,signal:r,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}},signal:r,bufferOptimisation:this.tuning.dash.fetcherBufferOptimisation}}getFetchUrl(e,t){if(!ua(t.segmentReference))throw new Error("Representation is not template type");return new URL(e[0].segment.url,t.segmentReference.baseUrl)}async onSomeDataLoaded({downloadingItems:e,dataView:t,representationId:i,loaded:r,signal:s}){let a=e[0],{segment:n}=a,o=this.representations.get(i);!this.downloadingBufferItems.length||(0,l.isNullable)(o)||(0,l.isNullable)(n.feedingBytes)||"downloading"!==n.networkStatus||s.aborted||(n.loadedBytes=r,n.loadedBytes>n.feedingBytes&&this.tuning.dash.enableSubSegmentBufferFeeding&&(n.data=new DataView(t.buffer,t.byteOffset,n.loadedBytes),await this.onDownloadItem(a)))}updateRepresentationBaseUrl(e,t){if(!ua(e.segmentReference))throw new Error("Representation is not template type");e.segmentReference.baseUrl=t}constructor(e,t,i,r){super(e,t,i,r)}},Yn=g(gi(),1),Xn=g(ni(),1),Jn=class extends Kn{updateManifest(e){if(!e||[...this.segments.values()].every((e=>!e.length)))return;let t=(0,Yn.default)(e.streams[this.kind],(e=>e.representations));for(let e of t){if((0,l.isNullable)(e)||!ua(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,networkStatus:"none",bufferStatus:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],s=(0,Xn.default)(r,-1)?.time.to??0,a=t?.findIndex((e=>s>=e.time.from+i&&s<=e.time.to+i));if(-1===a){let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(a+1);this.segments.set(e.id,[...r,...i])}this.representations.set(e.id,e)}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,l.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let i={representationId:e,segmentIndex:t.length-1,segment:t[t.length-1]};this.updateLowLatencyLive(i)}}getLiveSegmentsToLoadState(e){let t=e?.streams[this.kind],i=(0,Yn.default)(t,(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if((0,l.isNullable)(i))return;let r=this.segments.get(i.id);return r?.length?{from:r[0].time.from,to:r[r.length-1].time.to}:void 0}getRepresentationInitialTime(){if((0,l.isNullable)(this.playingRepresentationId))return 0;let e=this.representations.get(this.playingRepresentationId)?.segmentReference;return(0,l.isNullable)(e)||!ua(e)?0:this.getActualLiveStartingSegments(e)[0].time.from+this.tuning.dash.bufferTolerance}prepareFetchParams(e,t){return{...super.prepareFetchParams(e,t),isLowLatency:this.isActiveLowLatency()}}async onSomeDataLoaded({downloadingItems:e,...t}){await super.onSomeDataLoaded({downloadingItems:e,...t}),this.isActiveLowLatency()&&this.updateLowLatencyItemTime(e[0])}onItemFullyDownloaded(e){if(super.onItemFullyDownloaded(e),(0,l.isNullable)(e.segment.data)||!this.isActiveLowLatency())return;let t=e.segment.data,i=this.containerParser,{serverDataReceivedTimestamp:r,serverDataPreparedTime:s}=i.getServerLatencyTimestamps(t);r&&s&&this.currentLiveSegmentServerLatency$.next(s-r),this.updateLowLatencyItemTime(e),this.updateLowLatencyLive(e)}updateLowLatencyItemTime(e){let t=e.segment.data,i=this.representations.get(e.representationId)?.segmentReference;if((0,l.isNullable)(e.segment.data)||(0,l.isNullable)(i)||!ua(i))return;let r=this.containerParser;if(e.segment.isCurrentLowLatency){let{timescale:s}=i;e.segment.time.to=r.getChunkEndTime(t,s)}}updateLowLatencyLive(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!ua(r))return;let s=this.segments.get(i.id)??[],a=s.find((t=>Math.floor(t.time.from)===Math.floor(e.segment.time.from)));if(a?.isCurrentLowLatency&&(a.time.to=e.segment.time.to,t=a.time.to-a.time.from,a.isCurrentLowLatency=!1),!s.find((t=>Math.floor(t.time.from)===Math.floor(e.segment.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.segment.time.to*r.timescale/1e3).toString(10),i=Ja(r.segmentTemplateUrl,{segmentTime:t});s.push({networkStatus:"none",bufferStatus:"none",time:{from:e.segment.time.to,to:e.segment.time.to+this.tuning.dash.bufferTolerance},url:i,isCurrentLowLatency:!0})}}this.currentLowLatencySegmentLength$.next(t)}parseFeedableSegmentChunk(e){return this.containerParser.parseFeedableSegmentChunk(e,!0)}getFetchUrl(e,t){let i=super.getFetchUrl(e,t);return this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes"),i}async loadInit(e,t="auto",i=!1){try{let i=this.tuning.dash.useFetchPriorityHints?t:"auto",r=this.fetcher.fetchRepresentation(e.segmentReference,this.containerParser,i);this.initDataPromises.set(e.id,r);let{initMetadata:s,initDataView:a,segments:n}=await r??{};if(this.initDataPromises.delete(e.id),(0,l.isNullable)(a)||(0,l.isNullable)(n))return;s&&this.parsedInitData.set(e.id,s);let o=this.getActualLiveStartingSegments(e.segmentReference);this.segments.has(e.id)||this.segments.set(e.id,o);let u=a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);this.initData.set(e.id,u),this.failedDownloads=0}catch(e){i&&this.error$.next({id:"LoadInits",category:l.ErrorCategory.WTF,message:"loadInit threw",thrown:e})}}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],s=0,a=t.length-1;do{r.unshift(t[a]),s+=t[a].time.to-t[a].time.from,a--}while(s<i&&a>=0);return this.liveInitialAdditionalOffset=s-i,this.isActiveLowLatency()?[r[0]]:r}constructor(e,t,i,r){super(e,t,i,r),this.currentLiveSegmentServerLatency$=new l.ValueSubject(0),this.currentLowLatencySegmentLength$=new l.ValueSubject(0),this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.isActiveLowLatency=r.isActiveLowLatency}},Zn=class{static getBufferManager(e,t,i,r){return r.manifest?.live?new Jn(e,t,i,r):ua(i[0].segmentReference)?new Kn(e,t,i,r):new Gn(e,t,i,r)}},eo=!1;try{eo=Tr.browser.isSafari&&!!Tr.browser.safariVersion&&Tr.browser.safariVersion<=18}catch(Hs){console.error(Hs)}var to=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let s={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(s),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=eo&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.isAbortFixEnabled?this.queue[0]:this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,l.assertNever)(t)}}constructor(e,t=!1){this.bufferFull$=new l.Subject,this.error$=new l.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.isAbortFixEnabled=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null,this.isAbortFixEnabled&&this.queue.shift()}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.isAbortFixEnabled=t,this.buffer.addEventListener("updateend",this.completeTask)}},io=(e,t)=>{let i=0;for(let r=0;r<e.length;r++){let s=1e3*e.start(r),a=1e3*e.end(r);s<=t&&t<=a&&(i=a)}return Math.max(i-t,0)},ro=class{init(e,t,i=!1){this.sourceBuffer=this.mediaSource.addSourceBuffer(`${e}; codecs="${t}"`),this.sourceBufferTaskQueue=new to(this.sourceBuffer,i),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"}))))}addInitSegment(e,t){return this.sourceBufferTaskQueue.append(e,t)}append(e,t){return this.sourceBufferTaskQueue.append(e,t)}remove(e,t,i){return this.sourceBufferTaskQueue.remove(e,t,i)}async clear(e){let t=this.getBufferState();if((0,l.isNullable)(t))return Promise.resolve(!1);let i=!0;await this.sourceBufferTaskQueue.abort();for(let r of t)i&&(i=await this.sourceBufferTaskQueue.remove(r.from,r.to,e));return i}warmUpMediaSource(){!(0,l.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}getBufferState(){if((0,l.isNullable)(this.sourceBuffer)||!qs(this.mediaSource,this.sourceBuffer)||!this.sourceBuffer.buffered.length)return null;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++)e.push({from:1e3*this.sourceBuffer.buffered.start(t),to:1e3*this.sourceBuffer.buffered.end(t)});return e}getForwardBufferDuration(e){return(0,l.isNullable)(this.sourceBuffer)||!qs(this.mediaSource,this.sourceBuffer)||!this.sourceBuffer.buffered.length||(0,l.isNullable)(e)?0:io(this.sourceBuffer.buffered,e)}async abortBuffer(e){return!(0,l.isNullable)(this.sourceBuffer)&&this.sourceBufferTaskQueue.abort(e)}destroy(){if(this.subscription.unsubscribe(),this.sourceBufferTaskQueue?.destroy(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null}constructor(e){this.error$=new l.Subject,this.subscription=new l.Subscription,this.mediaSource=e}},so=["timeupdate","progress","play","seeked","stalled","waiting"],ao=["timeupdate","progress","loadeddata","playing","seeked"],no=class{async initManifest(e,t,i){this.tracer.log("initManifest"),this.state$.startTransitionTo("manifest_ready"),this.element=e,this.manifestUrlString=this.prepareManifestUrlString(t,i),this.manifest=await this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:l.ErrorCategory.PARSER,message:"No playable video representations"})}initBuffer(){(0,l.assertNonNullable)(this.element),this.state$.setState("running"),this.subscription.add((0,l.merge)(...so.map((e=>(0,l.fromEvent)(this.element,e))),(0,l.fromEvent)(window,"online")).subscribe((()=>this.tick()),(e=>this.error$.next({id:"DashVKPlayer",category:l.ErrorCategory.WTF,message:"Internal logic error",thrown:e}))));let e=[...this.source?.activeSourceBuffers??[]];this.subscription.add((0,l.merge)(...e.map((e=>(0,l.fromEvent)(e,"updateend")))).subscribe((e=>this.reinitDecoderIfNeeded()))),this.subscription.add((0,l.fromEvent)(this.element,"waiting").subscribe((e=>{this.stallWatchdogSubscription&&(this.stallWatchdogSubscription.unsubscribe(),this.subscriptionRemovable.remove(this.stallWatchdogSubscription)),this.stallWatchdogSubscription=(0,l.interval)(this.tuning.dash.stallWatchdogInterval).subscribe((()=>this.stallWatchdogIntervalCallback()),(e=>this.error$.next({id:"StallWatchdogCallback",category:l.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e}))),this.subscriptionRemovable.add(this.stallWatchdogSubscription)})))}async switchRepresentation(e,t,i=!1){return{video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e]?.switchTo(t,i)}async seek(e,t=!1){let i;(0,l.assertNonNullable)(this.element),(0,l.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),this.element.currentTime=i/1e3,await this.videoBufferManager.seek(i),await(this.audioBufferManager?.seek(i)),this.tracer.log("seek",(0,l.flattenObject)({requestedPosition:e,forcePrecise:t,position:i}))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,l.isNonNullable)(this.element)&&(0,l.isNonNullable)(this.source)&&(0,l.isNonNullable)(e)&&this.isStreamEnded&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.nativeBufferManagers.forEach((e=>e.warmUpMediaSource()))}calculateDurationFromSegments(){return Math.max(this.videoBufferManager?.calculateDurationFromSegments()||0,this.audioBufferManager?.calculateDurationFromSegments()||0)}get isStreamEnded(){return"ended"===this.source?.readyState}getStreams(){return this.manifest?.streams}getCodecs(){return this.manifest?.codecs}setBufferTarget(e){this.bufferManagers.forEach((t=>t.setTarget(e)))}setPreloadOnly(e){this.bufferManagers.forEach((t=>t.setPreloadOnly(e)))}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.nativeBufferManagers.forEach((e=>e.destroy())),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}destroy(){this.subscription.unsubscribe(),this.subscriptionRemovable.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),(0,l.isNonNullable)(this.source)&&this.isStreamNotOpen&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}get isStreamNotOpen(){return"open"!==this.source?.readyState}async reinitDecoderIfNeeded(e=!1){let t=this.videoNativeBufferManager?.getBufferState()??[];if((0,l.isNullable)(this.element)||!t.length)return;let i=1e3*this.element.currentTime;this.element.readyState<3&&t.some((e=>i>=e.from&&i<=e.to))&&(e?await this.seek(i):this.element.currentTime=this.element.currentTime)}async stallWatchdogIntervalCallback(){(0,l.assertNonNullable)(this.element),(0,l.assertNonNullable)(this.source);let{stallWatchdogInterval:e}=this.tuning.dash;if(this.isStreamNotOpen)return;let t=this.currentStallDuration$.getValue()+e;this.currentStallDuration$.next(t);let i={timeInWaiting:t};if(await this.reinitDecoderIfNeeded(t%1e3==0),this.isStallExceeded(t))throw new Error(`Stall timeout exceeded: ${t} ms`);await this.restoreAfterDeepStall(i),this.tracer.log("stallIntervalCallback",(0,l.flattenObject)(i))}isStallExceeded(e){let{crashOnStallTimeout:t,crashOnStallTWithoutDataTimeout:i}=this.tuning.dash,r=(0,l.now)(),s=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(s);let a=this.audioBufferManager?.lastDataObtainedTimestamp??0,n=this.videoBufferManager?.getForwardPlaybackBufferDuration()??0,o=this.audioBufferManager?.getForwardPlaybackBufferDuration()??0,u=(0,l.isNonNullable)(this.videoBufferManager)&&n<100&&r-s>i,d=(0,l.isNonNullable)(this.audioBufferManager)&&o<100&&r-a>i;return(u||d)&&e>i||e>=t}async updateManifest(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=await this.fetchManifest();if((0,l.isNullable)(e))return null;let t=this.parseManifest(e);if(!t)return null;let i=this.getResultManifest(t);return this.tracer.log("updateManifestEnd",(0,l.flattenObject)(i)),i}parseManifest(e){try{return Za(e??"",this.manifestUrlString)}catch(t){let i=Va(e)??{id:"ManifestParsing",category:l.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}}getResultManifest(e){let t,i,r={text:e.streams.text,video:[],audio:[]},s=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&gr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);for(let a of["video","audio"]){let n,o=e.streams[a].filter((({mime:e,codecs:t})=>s(a,e,t)));if(r[a]=o,this.tuning.dash.codecsPrioritizeEnabled){let e=o.map((({codecs:e})=>e));"audio"===a&&(i=un(e),n=i[0]),"video"===a&&(t=ln(e),n=this.forceVideoCodec&&(0,Ia.default)(t,this.forceVideoCodec)?this.forceVideoCodec:t[0]),n&&(r[a]=o.filter((({codecs:e})=>dn(e)===n)))}else{let e=new Set(o.map((({codecs:e})=>e)));n=on(e),n&&(r[a]=o.filter((({codecs:e})=>e.startsWith(n))))}if("video"===a){let e=this.tuning.preferHDR,t=r.video.some((e=>e.hdr)),i=r.video.some((e=>!e.hdr));Tr.display.isHDR&&e&&t?r.video=r.video.filter((e=>e.hdr)):i&&(r.video=r.video.filter((e=>!e.hdr)))}}let a={...e,streams:r};return this.tuning.dash.codecsPrioritizeEnabled&&(a.codecs={video:t,audio:i}),a}stopStallWatchdogSubscription(){this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)}createBuffers(e,t,i,r){(0,l.assertNonNullable)(this.manifest),(0,l.assertNonNullable)(this.element);let s=e=>{this.representationSubscription.add((0,l.fromEvent)(e,"error").pipe((0,l.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=br();let a=document.createElement("source");if(s(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),vr())if(r){let e=document.createElement("source");s(e),e.type="application/x-mpegurl",e.src=r.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;let n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoNativeBufferManager=new ro(this.source),this.videoBufferManager=Zn.getBufferManager("video",this.videoNativeBufferManager,n,e),this.bufferManagers=[this.videoBufferManager],this.nativeBufferManagers=[this.videoNativeBufferManager],(0,l.isNonNullable)(i)){this.audioNativeBufferManager=new ro(this.source);let t=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=Zn.getBufferManager("audio",this.audioNativeBufferManager,t,e),this.bufferManagers.push(this.audioBufferManager),this.nativeBufferManagers.push(this.audioNativeBufferManager)}}async waitStreamToOpen(){if(this.isStreamNotOpen){let e=this.tuning.dash.sourceOpenTimeout>=0;await new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{this.isStreamNotOpen?t():this.error$.next({id:"OpenOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0})}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}}initRepresentationSubscriptions(){this.representationSubscription.add(this.fetcher.manifestRequested.subscribe(this.manifestRequested)),this.representationSubscription.add(this.fetcher.manifestReceived.subscribe(this.manifestReceived)),this.representationSubscription.add(this.fetcher.firstBytesRequested.subscribe(this.firstBytesRequested)),this.representationSubscription.add(this.fetcher.firstBytesReceived.subscribe(this.firstBytesReceived)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$)),this.representationSubscription.add((0,l.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),(0,l.assertNonNullable)(this.videoBufferManager),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.initBufferLengthSubscription()}initBufferLengthSubscription(){this.representationSubscription.add((0,l.merge)(...ao.map((e=>(0,l.fromEvent)(this.element,e)))).pipe((0,l.map)((e=>this.videoBufferManager?.getPlaybackBufferState())),(0,l.filter)(l.isNonNullable),(0,l.map)((({from:e,to:t})=>({from:e/1e3,to:t/1e3})))).subscribe(this.currentBuffer$)),this.representationSubscription.add((0,l.merge)(...ao.map((e=>(0,l.fromEvent)(this.element,e)))).pipe((0,l.map)((e=>Math.max(this.videoBufferManager?.getForwardPlaybackBufferDuration()??0,this.audioBufferManager?.getForwardPlaybackBufferDuration()??0))),(0,l.filterChanged)()).subscribe(this.bufferLength$)),this.representationSubscription.add(this.nativeBufferLength$.pipe((0,l.filter)((e=>e>this.tuning.dash.bufferEmptinessTolerance))).subscribe((e=>this.stopStallWatchdogSubscription())))}initTracerSubscription(){let e=(0,l.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}async tick(){if((0,l.isNullable)(this.element)||(0,l.isNullable)(this.videoBufferManager)||this.isStreamNotOpen)return;let e=1e3*this.element.currentTime,t=(this.videoNativeBufferManager?.getBufferState()??[]).find((t=>e>=t.from&&e<=t.to));this.nativeBufferLength$.next(t?t.to-e:0),await this.videoBufferManager.maintain(e),await(this.audioBufferManager?.maintain(e))}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.bufferManagers=[],this.nativeBufferManagers=[],this.subscription=new l.Subscription,this.subscriptionRemovable=new l.SubscriptionRemovable,this.representationSubscription=new l.Subscription,this.forceEnded$=new l.Subject,this.destroyController=new Ma,this.state$=new Nr("none"),this.currentVideoRepresentation$=new l.ValueSubject(void 0),this.currentVideoRepresentationInit$=new l.ValueSubject(void 0),this.currentAudioRepresentation$=new l.ValueSubject(void 0),this.currentVideoSegmentLength$=new l.ValueSubject(0),this.currentAudioSegmentLength$=new l.ValueSubject(0),this.error$=new l.Subject,this.manifestRequested=new l.Subject,this.manifestReceived=new l.Subject,this.firstBytesRequested=new l.Subject,this.firstBytesReceived=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.currentLiveTextRepresentation$=new l.ValueSubject(null),this.isLive$=new l.ValueSubject(!1),this.isActiveLive$=new l.ValueSubject(!1),this.isLowLatency$=new l.ValueSubject(!1),this.liveDuration$=new l.ValueSubject(0),this.liveSeekableDuration$=new l.ValueSubject(0),this.liveAvailabilityStartTime$=new l.ValueSubject(0),this.liveStreamStatus$=new l.ValueSubject(void 0),this.currentBuffer$=new l.ValueSubject({from:0,to:0}),this.bufferLength$=new l.ValueSubject(0),this.nativeBufferLength$=new l.ValueSubject(0),this.liveLatency$=new l.ValueSubject(void 0),this.liveLoadBufferLength$=new l.ValueSubject(0),this.livePositionFromPlayer$=new l.ValueSubject(0),this.currentStallDuration$=new l.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new l.ValueSubject(0),this.fetcherRecoverableError$=new l.Subject,this.fetcherError$=new l.Subject,this.initRepresentations=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,l.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),this.representationSubscription.unsubscribe(),this.state$.startTransitionTo("representations_ready");let r={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest};this.createBuffers(r,e,t,i),this.initRepresentationSubscriptions(),yield this.waitStreamToOpen(),this.setSourceDuration(),(0,l.assertNonNullable)(this.videoBufferManager),yield Promise.all([this.videoBufferManager.startWith(e),t?this.audioBufferManager?.startWith(t):Promise.resolve()]),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.fetchManifest=(0,l.abortable)(this.destroyController.signal,async function*(){try{return yield this.fetcher.fetchManifest(this.manifestUrlString)}catch(e){(0,l.isNullable)(this.manifest)&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:l.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}}.bind(this)),this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.forceVideoCodec=e.forceVideoCodec,this.fetcher=new Fa({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.initTracerSubscription()}},oo=class extends no{prepareManifestUrlString(e,t){return e}initRepresentationSubscriptions(){super.initRepresentationSubscriptions(),this.initDisableStallWatchdogSubscription(),this.initEndOfVideoSubscription()}setSourceDuration(){(0,l.assertNonNullable)(this.manifest),(0,l.assertNonNullable)(this.source);let e=[this.manifest.duration??0,...(0,$a.default)((0,$a.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),ua(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}async restoreAfterDeepStall(e){(0,l.assertNonNullable)(this.element);let t=1e3*this.element.currentTime;await Promise.all([this.videoBufferManager?.maintain(t),this.audioBufferManager?.maintain(t)]),e.position=t}initDisableStallWatchdogSubscription(){(0,l.assertNonNullable)(this.element);let e=(0,l.merge)((0,l.fromEvent)(this.element,"ended"),this.forceEnded$),t=this.nativeBufferLength$.pipe((0,l.filter)((e=>e>this.tuning.dash.bufferEmptinessTolerance)));this.representationSubscription.add((0,l.merge)(e,t).subscribe((e=>this.stopStallWatchdogSubscription())))}initEndOfVideoSubscription(){let e=(0,l.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,l.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),t=(0,l.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,l.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),i=(0,l.combine)({allBuffersFull:e,someBufferEnded:t}).pipe((0,l.filterChanged)(),(0,l.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,l.filter)((e=>e)));this.representationSubscription.add((0,l.merge)(this.forceEnded$,i).pipe((0,l.filter)((e=>(0,l.isNonNullable)(this.source)&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))))).subscribe((()=>{try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}})))}constructor(e){super(e)}},lo=class extends wa{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i,genericErrorListener:r}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=[...this.videoTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:s}]=i,a=this.params.desiredState.videoStream.getTransition();a&&a.to&&a.to.id===s.id&&this.params.desiredState.videoStream.setState(a.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(la(s));let n=this.player.calculateDurationFromSegments();n&&this.params.output.duration$.next(n/1e3)}),r))}getPlayer(){return new oo({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer,forceVideoCodec:this.params.forceVideoCodec})}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},uo=g(Ve(),1),co=g(gi(),1),ho=(e,t,i=0)=>{for(let r=0;r<e.length;r++)if(1e3*e.start(r)-i<=t&&1e3*e.end(r)+i>t)return!0;return!1},po=g(Ve(),1),fo=g(ni(),1),mo=g(gi(),1),go=g(ii(),1),vo=!1;try{vo=Tr.browser.isSafari&&!!Tr.browser.safariVersion&&Tr.browser.safariVersion<=18}catch(Hs){console.error(Hs)}var bo=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let s={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(s),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=vo&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.isAbortFixEnabled?this.queue[0]:this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,l.assertNever)(t)}}constructor(e,t=!1){this.bufferFull$=new l.Subject,this.error$=new l.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.isAbortFixEnabled=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null,this.isAbortFixEnabled&&this.queue.shift()}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.isAbortFixEnabled=t,this.buffer.addEventListener("updateend",this.completeTask)}},yo=e=>{let t=0;for(let i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return 1e3*t},So=class{switchToWithPreviousAbort(e,t=!1){!qs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Ma,(0,l.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),s=this.initData.get(e);if((0,l.isNullable)(s)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):s instanceof Promise&&(yield s),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),s=this.initData.get(e),s instanceof ArrayBuffer&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(s,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,l.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Ma,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,l.isNullable)(e)||(0,l.isNullable)(this.downloadingRepresentationId)||(0,l.isNullable)(this.playingRepresentationId)||(0,l.isNullable)(this.sourceBuffer)||!qs(this.mediaSource,this.sourceBuffer)||(0,l.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.representations.get(this.playingRepresentationId),r=this.segments.get(this.downloadingRepresentationId),s=this.segments.get(this.playingRepresentationId);if((0,l.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),(0,l.assertNonNullable)(i,`No such representation ${this.playingRepresentationId}`),(0,l.isNullable)(r)||(0,l.isNullable)(s))return;let a=r.find((t=>e>=t.time.from&&e<t.time.to));(0,l.isNonNullable)(a)&&isFinite(a.time.from)&&isFinite(a.time.to)&&this.currentSegmentLength$.next(a?.time.to-a.time.from);let n=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let r=this.getForwardBufferDuration(e),s=Fn(i),o=Fn(t),u=this.useSmartRepresentationSwitch&&this.tuning.dash.useNewRepresentationSwitch&&this.tuning.dash.useSmartRepresentationSwitch&&(0,l.isNonNullable)(s)&&(0,l.isNonNullable)(o)&&(0,l.isHigher)(s.quality,o.quality),d=this.useSmartRepresentationSwitch&&this.tuning.dash.useNewRepresentationSwitch&&this.tuning.dash.useDelayedRepresentationSwitch;if(u||d?n+=Math.min(r,this.tuning.dash.representationSwitchForwardBufferGap):a&&a.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&r>=a.time.to-e+100&&(n=a?a.time.to+100:-1/0),this.tuning.dash.useNewRepresentationSwitch){let t=[...this.segments.entries()].map((([t,i])=>{let r=i.find((t=>e>=t.time.from&&e<t.time.to));return{representationId:t,status:r?.status}})).find((e=>"fed"===e.status))?.representationId;t&&(this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)))}}if(isFinite(this.bufferLimit)&&yo(this.sourceBuffer.buffered)>=this.bufferLimit){let t=this.getForwardBufferDuration(e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let o=[];if(!this.activeSegments.size&&(o=this.selectForwardBufferSegments(r,t.segmentReference.type,n),o.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&a)if((0,po.default)(o,a))e="high";else{let t=(0,fo.default)(o,0);t&&t.time.from-a.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(o,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&a&&"fed"===a.status&&!o.length&&this.getForwardBufferDuration(e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let u=(0,fo.default)(r,-1);!this.isLive&&u&&(this.fullyBuffered$.next(u.time.to-e-this.getForwardBufferDuration(e)<100),this.onLastSegment$.next(e-u.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let s of e)Math.trunc(s.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:s.time.from+r,persistent:!0}),i=s.time.to;(0,l.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration,persistent:!0})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],s=0,a=t.length-1;do{r.unshift(t[a]),s+=t[a].time.to-t[a].time.from,a--}while(s<i&&a>=0);return this.liveInitialAdditionalOffset=s-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=e?.streams[this.kind];if(!t)return;let i=(0,mo.default)(t,(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!i)return;let r=this.segments.get(i.id);return r?.length?{from:r[0].time.from,to:r[r.length-1].time.to}:void 0}updateLive(e){if(!e||[...this.segments.values()].every((e=>!e.length)))return;let t=(0,mo.default)(e.streams[this.kind],(e=>e.representations));for(let e of t){if(!e||!Wn(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],s=(0,fo.default)(r,-1)?.time.to??0,a=t?.findIndex((e=>s>=e.time.from+i&&s<=e.time.to+i));if(-1===a){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(a+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,l.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}calculateDurationFromSegments(){if(!this.playingRepresentationId)return 0;let e=this.segments.get(this.playingRepresentationId);return(e?(0,fo.default)(e,-1)?.time.to:0)||0}setSmartRepresentationSwitch(e){this.useSmartRepresentationSwitch=e}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!Wn(r))return;let s=this.segments.get(i.id)??[],a=s.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(a&&!isFinite(a.time.to)&&(a.time.to=e.time.to,t=a.time.to-a.time.from),!s.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=Ja(r.segmentTemplateUrl,{segmentTime:t});s.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.gapDetectionIdleCallback&&vn&&vn(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&vn&&vn(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));return this.playingRepresentationId!==this.downloadingRepresentationId&&(this.liveUpdateSegmentIndex=i),this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):[]}selectForwardBufferSegmentsRecord(e,t,i){let r=this.getForwardBufferDuration(i),s=e.findIndex((({status:e,time:{from:t,to:s}},a)=>{let n=t>i||t<=i&&s>=i||0===a&&0===i,o=Math.min(this.forwardBufferTarget,this.bufferLimit),l=this.preloadOnly&&t<=i+o||r<o&&s-t>=o||s<=i+o;return("none"===e||"partially_ejected"===e&&n&&l&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&!(ho(this.sourceBuffer.buffered,t)&&ho(this.sourceBuffer.buffered,s)))&&n&&l}));if(-1===s)return[];if("byteRange"!==t)return e.slice(s,s+1);let a=e,n=0,o=0,l=[],u=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,d=this.preloadOnly?this.forwardBufferTarget:0;for(let e=s;e<a.length&&(n<=u||o<=d);e++){let t=a[e];if(n+=t.byte.to+1-t.byte.from,o+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;l.push(t)}return l}async loadSegments(e,t,i="auto"){Wn(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:s,url:a,signal:n,onProgress:o,onProgressTasks:u}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,l.abortable)(n,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(a,{range:s,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency(),bufferOptimisation:this.tuning.dash.fetcherBufferOptimisation});if(this.lastDataObtainedTimestampMs=(0,l.now)(),!e)return;let d=new DataView(e),c=Dn(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=c.getChunkEndTime(d,e)}o&&r.feedingBytes&&u?await Promise.all(u):await this.sourceBufferTaskQueue.append(d,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=c.getServerLatencyTimestamps(d);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),Da(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())Wn(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:s,signal:a,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&a&&(await(0,l.abortable)(a,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,l.fromEvent)(window,"online").pipe((0,l.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),a.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(s,{range:r,onProgress:n,signal:a,priority:i,bufferOptimisation:this.tuning.dash.fetcherBufferOptimisation}),this.lastDataObtainedTimestampMs=(0,l.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),Da(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(Wn(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,fo.default)(e,0).byte.from,to:(0,fo.default)(e,-1).byte.to},{signal:s}=this.downloadAbortController;return{url:i,range:r,signal:s,onProgress:async(e,i)=>{if(!s.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:s,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!Wn(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:s}=this.downloadAbortController,a=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!s.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:s,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});a.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:s,onProgress:n,onProgressTasks:a}}abortActiveSegments(e){for(let t of this.activeSegments)(0,po.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:s}){if(!this.activeSegments.size||!qs(this.mediaSource,this.sourceBuffer))return;let a=this.representations.get(t);if(a)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(s.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=Dn(a.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:s,onSegmentAppendFailed:a}){if(!this.activeSegments.size||!qs(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){let{segment:l}=o;if(o.representationId!==t)continue;if(s.aborted){await a();continue}let u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(!(u<r))continue;let p=Dn(n.mime);if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,s)&&!s.aborted?this.onSegmentFullyAppended(o,t):await a()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:p.parseFeedableSegmentChunk(i);r?.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,s)&&!s.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await a())}}}onSegmentFullyAppended(e,t){if(!(0,l.isNullable)(this.sourceBuffer)&&qs(this.mediaSource,this.sourceBuffer)){!this.isLive&&Tr.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(ho(this.sourceBuffer.buffered,e.segment.time.from,100)&&ho(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.tuning.dash.useNewRepresentationSwitch||(this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId))),e.segment.status="fed",Un(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values())if(i.id!==t)for(let t of this.segments.get(i.id)??[])"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none");this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,[e.segment])}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=gn((()=>(0,go.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",s=!i&&this.tuning.dash.ignoreNetworkErrorsOnLoadInit,a=(!i&&this.failedDownloads>0?(0,l.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,Dn(e.mime),{priority:r,ignoreNetworkErrors:s}))).then((async t=>{if(!t)return;let{init:i,dataView:r,segments:s}=t,a=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,a);let n=s;this.isLive&&Wn(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{s||this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:l.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,a),a}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,l.isNullable)(e))return!1;let r=[],s=0,a=e=>{if(s>=t)return r;r.push({...e.time}),r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:s}=e[i],a=t[t.length-1];a.to>=r?a.to=Math.max(a.to,s):t.push(e[i])}return t})(r);let i=Un(e)?e.size??0:e.byte.to-e.byte.from;s+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&a(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let s of e)(0,po.default)(["none","partially_ejected"],s.status)&&Math.round(s.time.from)<=Math.round(t)&&Math.round(s.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){a({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&a(r)}return!!r.length&&(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1)}async abortBuffer(){if(!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,l.isNullable)(e)?io(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer))for(let i of t){let t={representation:e,from:i.time.from,to:i.time.to,persistent:!1},{buffered:r}=this.sourceBuffer;for(let e=0;e<r.length;e++){let s=1e3*r.start(e),a=1e3*r.end(e);if(!(a<=i.time.from||s>=i.time.to)){if(s<=i.time.from&&a>=i.time.to){t=void 0;break}a>i.time.from&&a<i.time.to&&(t.from=a),s<i.time.to&&s>i.time.from&&(t.to=s)}}t&&t.to-t.from>1&&!this.gaps.some((e=>t&&e.from===t.from&&e.to===t.to))&&this.gaps.push(t)}}detectGapsWhenIdle(e,t){if(this.gapDetectionIdleCallback||!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer))return;let{buffered:i}=this.sourceBuffer,{usePersistentGaps:r}=this.tuning.dash;this.gaps=this.gaps.filter((e=>{if(r&&e.persistent)return!0;let t=Math.round(e.from),s=Math.round(e.to);for(let e=0;e<i.length;e++)if(t>=Math.round(1e3*i.start(e))&&s<=Math.round(1e3*i.end(e)))return!1;return!0})),this.gapDetectionIdleCallback=gn((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:l.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}checkEjectedSegments(){if((0,l.isNullable)(this.sourceBuffer)||!qs(this.mediaSource,this.sourceBuffer)||(0,l.isNullable)(this.playingRepresentationId))return;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++){let i=Math.floor(1e3*this.sourceBuffer.buffered.start(t)),r=Math.ceil(1e3*this.sourceBuffer.buffered.end(t));e.push({from:i,to:r})}let t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let s=Math.floor(r.time.from),a=Math.ceil(r.time.to),n=e.some((e=>e.from-t<=s&&e.to+t>=a)),o=e.filter((e=>s>=e.from&&s<e.to-t||a>e.from+t&&a<=e.to));n||(1===o.length||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:l.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}constructor(e,t,i,{fetcher:r,tuning:s,getCurrentPosition:a,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:u}){this.currentLiveSegmentServerLatency$=new l.ValueSubject(0),this.currentLowLatencySegmentLength$=new l.ValueSubject(0),this.currentSegmentLength$=new l.ValueSubject(0),this.onLastSegment$=new l.ValueSubject(!1),this.fullyBuffered$=new l.ValueSubject(!1),this.playingRepresentation$=new l.ValueSubject(void 0),this.playingRepresentationInit$=new l.ValueSubject(void 0),this.error$=new l.Subject,this.gaps=[],this.subscription=new l.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Ma,this.switchAbortController=new Ma,this.destroyAbortController=new Ma,this.useSmartRepresentationSwitch=!1,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.startWith=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,l.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new bo(this.sourceBuffer,this.tuning.dash.useAbortMSEFix),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.checkEjectedSegments(),this.maintain()}),(e=>{let t,i=this.mediaSource.readyState;"open"!==i&&(t={id:`SegmentEjection_source_${i}`,category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),t??(t={id:"SegmentEjection",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),this.error$.next(t)}))),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!qs(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*yo(this.sourceBuffer.buffered));this.bufferLimit=i;let r=this.getForwardBufferDuration(t),s=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<s).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),s=this.parsedInitData.get(t.id);(0,l.assertNonNullable)(i,"No init buffer for starting representation"),(0,l.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(s))}.bind(this)),this.switchTo=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!qs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),s=this.initData.get(e);if((0,l.isNullable)(s)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):s instanceof Promise&&(yield s),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),s=this.initData.get(e),s&&s instanceof ArrayBuffer&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(s,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!qs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),s=this.initData.get(e);if((0,l.isNullable)(s)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):s instanceof Promise&&(yield s),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),s=this.initData.get(e),s&&s instanceof ArrayBuffer&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(s,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,mo.default)(e,(e=>e.representations));if(!this.downloadingRepresentationId||!t.length)return;this.isSeekingLive=!0;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!Wn(r.segmentReference))return void(this.isSeekingLive=!1);let s=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,s)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,l.assertNonNullable)(r,`Representation not found by id ${i}`);let s=this.segments.get(i);(0,l.assertNonNullable)(s,"No segments for starting representation");let a=this.initData.get(i);if((0,l.assertNonNullable)(a,"No init buffer for starting representation"),!(a instanceof ArrayBuffer))return void(this.isSeekingLive=!1);let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(s,r),yield this.sourceBufferTaskQueue.append(a,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=s,this.compatibilityMode=o,this.forwardBufferTarget=s.dash.forwardBufferTargetAuto,this.getCurrentPosition=a,this.isActiveLowLatency=n,this.isLive=!!u?.live,this.baseUrls=u?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},wo=class{onHeadersReceived(e){let{type:t,reused:i}=Ba(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,l.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.subscription.unsubscribe(),this.tracer.end()}async doFetch(e,t,i){let r=await Pa(e,t);if(r.ok)return r;if(i?.ignoreNetworkErrors)return;let s=await r.text(),a=parseInt(s);if(!isNaN(a))switch(a){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:l.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:l.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:l.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:l.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${a})`,category:l.ErrorCategory.FATAL})}}unsubscribeAbortSubscription(e){e&&(e.unsubscribe(),this.subscription.remove(e))}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:s=!1}){this.manifestRequested$=new l.Subject,this.firstBytesManifest$=new l.Subject,this.firstBytesRequested$=new l.Subject,this.firstBytesReceived$=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.recoverableError$=new l.Subject,this.error$=new l.Subject,this.abortAllController=new Ma,this.subscription=new l.SubscriptionRemovable,this.fetchManifest=(0,l.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Na(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=Oa(i)),this.manifestRequested$.next();let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch($o);return r?(t.log("success",(0,l.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),this.firstBytesManifest$.next(),r.text()):(t.error("error",(0,l.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,l.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:s="auto",signal:a,measureThroughput:n=!0,isLowLatency:o=!1,bufferOptimisation:u=!1,ignoreNetworkErrors:d=!1}={}){let c=e,h=new Headers,p=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:h.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(c,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),c=e.toString();break}default:(0,l.assertNever)(t)}this.requestQuic&&(c=Na(c));let f,m=this.abortAllController.signal;if(a){let e=new Ma;if(f=(0,l.merge)((0,l.fromEvent)(this.abortAllController.signal,"abort"),(0,l.fromEvent)(a,"abort")).subscribe((()=>{try{e.abort()}catch(e){$o(e)}})),this.subscription.add(f),this.abortAllController.signal.aborted||a.aborted)try{e.abort()}catch(e){$o(e)}m=e.signal}let g=0,v=(0,l.now)();p.log("startRequest",(0,l.flattenObject)({url:c,priority:s,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:v})),this.firstBytesRequested$.next();let b=yield this.doFetch(c,{priority:s,headers:h,signal:m},{ignoreNetworkErrors:d}),y=(0,l.now)();if(!b)return p.error("error",{message:"No response in request"}),p.end(),this.unsubscribeAbortSubscription(f),null;if(this.throughputEstimator?.addRawRtt(y-v),!b.ok||!b.body){this.unsubscribeAbortSubscription(f);let e=`Fetch error ${b.status}: ${b.statusText}`;return p.error("error",{message:e}),p.end(),Promise.reject(new Error(`Fetch error ${b.status}: ${b.statusText}`))}if(this.onHeadersReceived(b.headers),!r&&!n){this.unsubscribeAbortSubscription(f);let e=(0,l.now)(),t={requestStartedAt:v,requestEndedAt:e,duration:e-v};return p.log("endRequest",(0,l.flattenObject)(t)),p.end(),b.arrayBuffer()}let S=b.body;if(n){let e;[S,e]=b.body.tee(),this.throughputEstimator?.trackStream(e,o)}let w,$=S.getReader(),x=parseInt(b.headers.get("content-length")??"",10);Number.isFinite(x)&&(w=x),!w&&i&&(w=i.to-i.from+1);let k=w?new Uint8Array(w):new Uint8Array(0),T=!1,_=e=>{this.unsubscribeAbortSubscription(f),T=!0,$o(e)},C=(0,l.abortable)(m,async function*({done:e,value:t}){if(0===g&&(this.lastRequestFirstBytes$.next((0,l.now)()-v),this.firstBytesReceived$.next()),m.aborted)this.unsubscribeAbortSubscription(f);else if(!e&&t){if(u&&w)k.set(t,g),g+=t.byteLength;else{let e=new Uint8Array(k.length+t.length);e.set(k),e.set(t,k.length),k=e,g+=t.byteLength}r?.(new DataView(k.buffer),g),yield $?.read().then(C,_)}}.bind(this));yield $?.read().then(C,_),this.unsubscribeAbortSubscription(f);let E=(0,l.now)(),A={failed:T,requestStartedAt:v,requestEndedAt:E,duration:E-v};return T?(p.error("endRequest",(0,l.flattenObject)(A)),p.end(),null):(p.log("endRequest",(0,l.flattenObject)(A)),p.end(),k.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,s,{from:a,to:n}=e.initRange,o=a,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,s=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,a),l=Math.max(s,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},measureThroughput:!1,...i});if(!d)return null;let c=new DataView(d,a-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{measureThroughput:!1,...t});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=s}},$o=e=>{if(!Da(e))throw e},xo=class{next(e){let t=0,i=0;for(let e=0;e<this.pastMeasures.length;e++)void 0!==this.pastMeasures[e]&&(t+=(this.pastMeasures[e]-this.smoothed)**2,i++);this.takenMeasures=i,t/=i;let r=Math.sqrt(t),s=this.smoothed+this.params.deviationFactor*r,a=this.smoothed-this.params.deviationFactor*r;this.pastMeasures[this.measuresCursor]=e,this.measuresCursor=(this.measuresCursor+1)%this.pastMeasures.length,this.rawSeries$.next(e),this.updateSmoothedValue(e),this.smoothed$.next(this.smoothed),this.smoothedSeries$.next(this.smoothed),!(this.smoothed>s||this.smoothed<a)&&((0,l.isNullable)(this.prevReported)||Math.abs(this.smoothed-this.prevReported)/this.prevReported>=this.params.changeThreshold)&&(this.prevReported=this.smoothed,this.debounced$.next(this.smoothed),this.reportedSeries$.next(this.smoothed))}constructor(e){this.prevReported=void 0,this.pastMeasures=[],this.takenMeasures=0,this.measuresCursor=0,this.params=e,this.pastMeasures=Array(e.deviationDepth),this.smoothed=this.prevReported=e.initial,this.smoothed$=new l.ValueSubject(e.initial),this.debounced$=new l.ValueSubject(e.initial);let t=e.label??"value"+Math.random().toString(16).substring(2,6);this.rawSeries$=new us(`raw_${t}`),this.smoothedSeries$=new us(`smoothed_${t}`),this.reportedSeries$=new us(`reported_${t}`),this.rawSeries$.next(e.initial),this.smoothedSeries$.next(e.initial),this.reportedSeries$.next(e.initial)}},ko=class extends xo{updateSmoothedValue(e){this.slow=pa(this.slow,e,this.params.emaAlphaSlow),this.fast=pa(this.fast,e,this.params.emaAlphaFast);let t=this.params.fastDirection>0?Math.max:Math.min;this.smoothed=t(this.slow,this.fast)}constructor(e){super(e),this.slow=this.fast=e.initial}},To=class extends xo{updateSmoothedValue(e){let t=fa(this.pastMeasures,this.takenMeasures);this.emaSmoothed=pa(this.emaSmoothed,e,this.params.emaAlpha);let i=((e,t,i,r)=>{let s=0,a=i,n=fa(e,t),o=t<r?t:r;for(let t=0;t<o;t++)e[a]>n?s++:s--,a=(e.length+a-1)%e.length;return Math.abs(s)===o})(this.pastMeasures,this.takenMeasures,this.measuresCursor-1,this.params.basisTrendChangeCount);this.smoothed=i?this.emaSmoothed:t}constructor(e){super(e),this.emaSmoothed=e.initial}},_o=class extends xo{next(e){this.currentTopExtremumValue<=e?(this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.length===this.extremumInterval?(super.next(this.currentTopExtremumValue),this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.push(e)}updateSmoothedValue(e){this.smoothed=this.smoothed?pa(this.smoothed,e,this.params.emaAlpha):e}constructor(e){super(e),this.furtherValues=[],this.currentTopExtremumValue=0,this.extremumInterval=e.extremumInterval}},Co=class{static getSmoothedValue(e,t,i){return"TwoEma"===i.type?new ko({initial:e,emaAlphaSlow:i.emaAlphaSlow,emaAlphaFast:i.emaAlphaFast,changeThreshold:i.changeThreshold,fastDirection:t,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"}):new To({initial:e,emaAlpha:i.emaAlpha,basisTrendChangeCount:i.basisTrendChangeCount,changeThreshold:i.changeThreshold,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"})}static getLiveBufferSmoothedValue(e,t){return new _o({initial:e,label:"liveEdgeDelay",...t})}},Eo=(e,t)=>{e&&e.playbackRate!==t&&(e.playbackRate=t)},Ao=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,l.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,s=t.segments[0].time.from,a=t.segments[r-1].time.to;if(e<s||e>a)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&Wn(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new l.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},Lo=["timeupdate","progress","play","seeked","stalled","waiting"],Po=["timeupdate","progress","loadeddata","playing","seeked"],Mo=class{setSmartRepresentationSwitch(e){this.bufferManagers.forEach((t=>t.setSmartRepresentationSwitch(e)))}async seekLive(e){(0,l.assertNonNullable)(this.element),this.updateManifestUrlWithTimeOffset(e),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await this.updateLiveBuffersFromManifest(this.manifest))}updateManifestUrlWithTimeOffset(e){let t="active"!==this.liveStreamStatus$.getValue()?(0,l.now)()-this.liveStreamEndTimestamp:0,i=this.normalizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=ir(this.manifestUrlString,i,2)}async updateLiveBuffersFromManifest(e){await(this.videoBufferManager?.seekLive(e.streams.video)),await(this.audioBufferManager?.seekLive(e.streams.audio)),this.liveTextManager?.seekLive(e.streams.text)}stopStallWatchdogSubscription(){this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)}initBuffer(){(0,l.assertNonNullable)(this.element),this.state$.setState("running"),this.subscription.add((0,l.merge)(...Lo.map((e=>(0,l.fromEvent)(this.element,e))),(0,l.fromEvent)(window,"online")).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:l.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,l.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,l.fromEvent)(this.element,"waiting").subscribe((()=>{this.tuning.dash.useVideoElementWaitingCurrentTimeReassign&&this.element&&2===this.element.readyState&&!this.element.seeking&&ho(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription&&(this.stallWatchdogSubscription.unsubscribe(),this.subscriptionRemovable.remove(this.stallWatchdogSubscription)),this.stallWatchdogSubscription=(0,l.interval)(this.tuning.dash.stallWatchdogInterval).subscribe((()=>{let{keepSilentStallWatchdogWhenNotActive:e}=this.tuning.dashCmafLive,{crashOnStallTimeout:t,crashOnStallTWithoutDataTimeout:i,liveStallReinitInterval:r,stallWatchdogInterval:s}=this.tuning.dash,a=this.isLive$.getValue(),n="active"===this.liveStreamStatus$.getValue();if(!this.element||"open"!==this.source?.readyState)return;let o=this.currentStallDuration$.getValue();o+=s,this.currentStallDuration$.next(o);let u={timeInWaiting:o},d=(0,l.now)(),c=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(c);let h=this.audioBufferManager?.lastDataObtainedTimestamp??0,p=this.videoBufferManager?.getForwardBufferDuration()??0,f=this.audioBufferManager?.getForwardBufferDuration()??0,m=p<100&&d-c>i,g=this.audioBufferManager&&f<100&&d-h>i;if((!e||n)&&((m||g)&&o>i||o>=t))throw new Error(`Stall timeout exceeded: ${o} ms`);if(a&&o%r==0){let t=this.normalizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);!n&&e?(this.liveWasInterrupted=!0,this.updateManifestUrlWithTimeOffset(t),this.updateManifest()):this.seekLive(t).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:l.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),u.liveLastOffset=t}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),u.position=e}this.tracer.log("stallIntervalCallback",(0,l.flattenObject)(u))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:l.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscriptionRemovable.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,l.assertNonNullable)(this.element),(0,l.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),ho(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,l.isNullable)(this.element)&&!(0,l.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,l.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,l.isNonNullable)(this.element)&&(0,l.isNonNullable)(this.source)&&(0,l.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}getCodecs(){return this.manifest?.codecs}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.subscriptionRemovable.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,l.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){if(!this.element||!this.isLive$.getValue())return!1;let e=1-this.element.playbackRate;return Number(e.toFixed(2))>Number(this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup.toFixed(2))}normalizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getDebugBufferState();if(!e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i={isJumpGapAfterSeekLive:this.isJumpGapAfterSeekLive,isActiveLowLatency:t,initialCurrentTime:this.element.currentTime},{usePersistentGaps:r}=this.tuning.dash;this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e.to&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let s=1e3*this.element.currentTime,a=[],n=1===this.element.readyState?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)(r&&t.persistent||e.playingRepresentation$.getValue()===t.representation)&&t.from-n<=s&&t.to+n>s&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?a.push(1/0):a.push(t.to));if(a.length){let e=Math.max(...a)+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,i={...i,gapEnds:a,jumpTo:e,resultCurrentTime:this.element.currentTime},this.tracer.log("jumpGap",(0,l.flattenObject)(i)))}}calculateDurationFromSegments(){return Math.max(this.videoBufferManager?.calculateDurationFromSegments()||0,this.audioBufferManager?.calculateDurationFromSegments()||0)}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.bufferManagers=[],this.subscription=new l.Subscription,this.subscriptionRemovable=new l.SubscriptionRemovable,this.representationSubscription=new l.Subscription,this.state$=new Nr("none"),this.currentVideoRepresentation$=new l.ValueSubject(void 0),this.currentVideoRepresentationInit$=new l.ValueSubject(void 0),this.currentAudioRepresentation$=new l.ValueSubject(void 0),this.currentVideoSegmentLength$=new l.ValueSubject(0),this.currentAudioSegmentLength$=new l.ValueSubject(0),this.error$=new l.Subject,this.manifestRequested$=new l.Subject,this.firstBytesManifest$=new l.Subject,this.manifestReceived$=new l.Subject,this.firstBytesRequested$=new l.Subject,this.firstBytesReceived$=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.currentLiveTextRepresentation$=new l.ValueSubject(null),this.isLive$=new l.ValueSubject(!1),this.isActiveLive$=new l.ValueSubject(!1),this.isLowLatency$=new l.ValueSubject(!1),this.liveDuration$=new l.ValueSubject(0),this.liveSeekableDuration$=new l.ValueSubject(0),this.liveAvailabilityStartTime$=new l.ValueSubject(0),this.liveStreamStatus$=new l.ValueSubject(void 0),this.bufferLength$=new l.ValueSubject(0),this.liveLatency$=new l.ValueSubject(void 0),this.liveLoadBufferLength$=new l.ValueSubject(0),this.livePositionFromPlayer$=new l.ValueSubject(0),this.currentStallDuration$=new l.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new l.ValueSubject(0),this.fetcherRecoverableError$=new l.Subject,this.fetcherError$=new l.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new l.Subject,this.gapWatchdogActive=!1,this.liveWasInterrupted=!1,this.destroyController=new Ma,this.initManifest=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=ir(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:l.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,l.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:l.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=Za(e??"",this.manifestUrlString),this.manifestReceived$.next()}catch(t){let i=Va(e)??{id:"ManifestParsing",category:l.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&gr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!0);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:s}=t.live,a=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*a),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";if(s||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n),s&&this.liveWasInterrupted){this.liveWasInterrupted=!1,this.stopStallWatchdogSubscription();let e=this.normalizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"updateManifest",category:l.ErrorCategory.VIDEO_PIPELINE,message:"seekLive after stream restore failed",thrown:e})}))}}let r,s,a={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let n,o=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r)));if(a[e]=o,this.tuning.dash.codecsPrioritizeEnabled){let t=o.map((({codecs:e})=>e));"audio"===e&&(s=un(t),n=s[0]),"video"===e&&(r=ln(t),n=this.forceVideoCodec&&(0,uo.default)(r,this.forceVideoCodec)?this.forceVideoCodec:r[0]),n&&(a[e]=o.filter((({codecs:e})=>dn(e)===n)))}else{let t=new Set(o.map((({codecs:e})=>e)));n=on(t),n&&(a[e]=o.filter((({codecs:e})=>e.startsWith(n))))}if("video"===e){let e=this.tuning.preferHDR,t=a.video.some((e=>e.hdr)),i=a.video.some((e=>!e.hdr));Tr.display.isHDR&&e&&t?a.video=a.video.filter((e=>e.hdr)):i&&(a.video=a.video.filter((e=>!e.hdr)))}}let n={...t,streams:a};return this.tuning.dash.codecsPrioritizeEnabled&&(n.codecs={video:r,audio:s}),this.tracer.log("updateManifestEnd",(0,l.flattenObject)(n)),n}.bind(this)),this.initRepresentations=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,l.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,l.assertNonNullable)(this.manifest),(0,l.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,l.fromEvent)(e,"error").pipe((0,l.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=br();let s=document.createElement("source");if(r(s),s.src=URL.createObjectURL(this.source),this.element.appendChild(s),vr())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let a={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new So("video",this.source,n,a),this.bufferManagers=[this.videoBufferManager],(0,l.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new So("audio",this.source,e,a),this.bufferManagers.push(this.audioBufferManager)}if(Ao.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new Ao(this.manifest.streams.text,a)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$)),this.representationSubscription.add((0,l.merge)(...Po.map((e=>(0,l.fromEvent)(this.element,e)))).pipe((0,l.map)((e=>this.element?io(this.element.buffered,1e3*this.element.currentTime):0)),(0,l.filterChanged)(),(0,l.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&this.stopStallWatchdogSubscription()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,l.merge)((0,l.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{this.stopStallWatchdogSubscription()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,l.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,l.now)()))),this.subscription.add((0,l.fromEvent)(this.element,"pause").subscribe((()=>{let{liveUpdateInterval:e}=this.tuning.dash;this.livePauseWatchdogSubscription=(0,l.interval)(e).subscribe((t=>{let i=rr(this.manifestUrlString,2);this.manifestUrlString=ir(this.manifestUrlString,i+e,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,l.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,l.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,l.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,l.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||Eo(this.element,1)}))),this.representationSubscription.add((0,l.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,l.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,l.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,l.filter)((({isLive:e})=>e)),(0,l.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,l.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+rr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,l.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,s=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,a=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>s&&(o=1+Math.sign(n)*a),Eo(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,l.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,l.throttle)(this.tuning.dash.liveUpdateInterval)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,s=rr(this.manifestUrlString,2),a=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(a,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=a<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==s&&u<n?h="live_forward_buffering":u<n+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),a=this.normalizeLiveOffset(Math.trunc(s+i/r)),l=Math.abs(a-s),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=s:a>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=a),this.manifestUrlString=ir(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:l.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let o=(0,l.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,l.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),u=(0,l.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,l.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),d=(0,l.combine)({allBuffersFull:o,someBufferEnded:u}).pipe((0,l.filterChanged)(),(0,l.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,l.filter)((e=>e)));if(this.representationSubscription.add((0,l.merge)(this.forceEnded$,d).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,l.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState?this.error$.next({id:"OpenOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0}):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,co.default)((0,co.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),Wn(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,l.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,l.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:l.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.forceVideoCodec=e.forceVideoCodec,this.fetcher=new wo({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.subscription.add(this.fetcher.manifestRequested$.subscribe(this.manifestRequested$)),this.subscription.add(this.fetcher.firstBytesManifest$.subscribe(this.firstBytesManifest$)),this.subscription.add(this.fetcher.firstBytesRequested$.subscribe(this.firstBytesRequested$)),this.subscription.add(this.fetcher.firstBytesReceived$.subscribe(this.firstBytesReceived$)),this.subscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.subscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.liveBuffer=Co.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},Io=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,l.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,l.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,l.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new l.Subscription,this.pipSize$=new l.ValueSubject(void 0),this.videoSize$=new l.ValueSubject(void 0),this.elementSize$=new l.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=l.noop}},Ro=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params;(0,l.isNullable)(this.observableVideo)&&(this.observableVideo=es(this.video),this.subscription.add((()=>this.observableVideo?.destroy())));let i=this.constructor.name,r=t=>{e.error$.next({id:i,category:l.ErrorCategory.WTF,message:`${i} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:this.observableVideo,genericErrorListener:r,connect:(e,t)=>this.subscription.add(e.subscribe(t,r))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:s}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let a=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,l.map)((e=>"none"!==e.to.state)),(0,l.filterChanged)());this.stallsManager.init({isSeeked$:a,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$,duration:this.video.duration}),s(i.ended$,e.endedEvent$),s(i.looped$,e.loopedEvent$),s(i.error$,e.error$),s(i.isBuffering$,e.isBuffering$),s(i.currentBuffer$,e.currentBuffer$),s(i.currentBuffer$,e.currentNativeBuffer$),s(i.playing$,e.firstFrameEvent$),s(i.canplay$,e.canplay$),s(i.inPiP$,e.inPiP$),s(i.inFullscreen$,e.inFullscreen$),s(i.loadedMetadata$,e.loadedMetadataEvent$),s(this.player.error$,e.error$),s(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),s(this.player.fetcherError$,e.fetcherError$),s(this.player.manifestRequested$,e.manifestRequested$),s(this.player.firstBytesManifest$,e.firstBytesManifest$),s(this.player.manifestReceived$,e.manifestReceived$),s(this.player.firstBytesRequested$,e.firstBytesRequested$),s(this.player.firstBytesReceived$,e.firstBytesReceived$),s(this.player.lastConnectionType$,e.httpConnectionType$),s(this.player.lastConnectionReused$,e.httpConnectionReused$),s(this.player.isLive$,e.isLive$),s(this.player.lastRequestFirstBytes$.pipe((0,l.filter)(l.isNonNullable),(0,l.once)()),e.firstBytesEvent$),s(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),s(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(Ur(this.video,t.isLooped,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),Sa({subscription:this.subscription,desiredState:t,videoElement$:this.params.output.element$,observableVideo:i}),this.subscription.add(Wr(this.video,t.volume,i.volumeState$,r)),this.subscription.add(Qr(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),s(Zs(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),lr(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.params.tuning.changePlaybackStateToPausedWhenEnded&&this.subscription.add(i.ended$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}))),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams(),t=this.player.getCodecs();if((0,l.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(qn(i));let e=[];for(let t of i.representations){let r=jn(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let i=[];for(let t of e.video){i.push(Hn(t));let e=[];for(let i of t.representations){let r=Fn({...i,streamId:t.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:t,representation:i}))}this.videoStreamsMap.set(t,e)}this.params.output.availableVideoStreams$.next(i);for(let t of e.text)for(let e of t.representations){let i=zn(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),t?.video&&this.params.output.availableVideoCodecs$.next(t.video),t?.audio&&this.params.output.availableAudioCodecs$.next(t.audio),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r));let n=(0,l.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,l.fromEvent)(this.video,"progress")).pipe((0,l.filter)((()=>this.videoTracksMap.size>0))),{abrThrottle:o}=this.params.tuning.dash;o&&(n=n.pipe((0,l.throttle)(o))),this.subscription.add(n.subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if("manifest_ready"!==e&&"running"!==e||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState());let r=this.selectVideoAudioRepresentations();if(!r)return;let[s,a]=r,n=[...this.videoTracksMap.keys()].find((e=>this.videoTracksMap.get(e)?.representation.id===s.id));(0,l.isNonNullable)(n)&&(this.stallsManager.lastVideoTrackSelected=n);let o=this.params.desiredState.autoVideoTrackLimits.getTransition();if(o&&this.params.output.autoVideoTrackLimits$.next(o.to),"manifest_ready"===e)await this.player.initRepresentations(s.id,a?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",s.id),a){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",a.id,e)}}),r)),this.subscription.add((0,l.combine)({videoState:this.videoState.stateChangeEnded$,autoVideoTrackState:(0,l.merge)((0,l.observableFrom)([t.autoVideoTrackSwitching.getState()]),t.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,l.map)((e=>e.to))))}).pipe((0,l.map)((({videoState:e,autoVideoTrackState:t})=>"stopped"!==e.to&&t)),(0,l.filterChanged)()).subscribe((e=>this.player.setSmartRepresentationSwitch(e)))),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=[...this.videoTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:s}]=i,a=this.params.desiredState.videoStream.getTransition();a&&a.to&&a.to.id===s.id&&this.params.desiredState.videoStream.setState(a.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(Hn(s));let n=this.player.calculateDurationFromSegments();n&&this.params.output.duration$.next(n/1e3)}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=[...this.audioTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:s}]=i,a=this.params.desiredState.audioStream.getTransition();a&&a.to&&a.to.id===s.id&&this.params.desiredState.audioStream.setState(a.to),e.currentAudioStream$.next(qn(s))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let u=t.playbackState.stateChangeStarted$.pipe((0,l.map)((({to:e})=>"ready"===e)),(0,l.filterChanged)());this.subscription.add((0,l.merge)(u,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,l.merge)(u,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let d=(0,l.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(d.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?ws:Ss,t=this.params.tuning.useNewAutoSelectVideoTrack?As:Es,i=this.params.tuning.useNewAutoSelectVideoTrack?_s:Cs,{desiredState:r,output:s}=this.params,a=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=[...this.videoTracksMap.keys()].find((({id:e})=>e===n)),l=s.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=[...this.videoStreamsMap.keys()].find((({id:e})=>e===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=io(this.video.buffered,1e3*this.video.currentTime);h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:a?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),g=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),v=[...this.audioStreamsMap.keys()].find((({id:e})=>e===g?.id))??this.audioStreamsMap.keys().next().value,b=0;if(v){if(o&&!a){let t=e(o,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let y=o;(a||!y)&&(y=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}));let S=v&&t(y,c,this.audioStreamsMap.get(v)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),w=this.videoTracksMap.get(y)?.representation,$=S&&this.audioTracksMap.get(S)?.representation;return w&&$?[w,$]:w&&!$&&0===this.audioTracksMap.size?[w,void 0]:void 0}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),zr(this.video),this.tracer.end()}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.observableVideo=null,this.droppedFramesManager=new Xs,this.stallsManager=new ba,this.elementSizeManager=new Io,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new ms,this.audioTrackSwitchHistory=new ms,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&lr(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&lr(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new ha(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new Yr(e.source.url),this.params=e,this.video=jr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new Mo({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer,forceVideoCodec:this.params.forceVideoCodec}),this.subscribe()}},Vo=class extends Ro{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},No=class extends Ro{subscribe(){super.subscribe();let e=!1,t=-1,{output:i,observableVideo:r,desiredState:s,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canPlayLiveTailBuffer$.next(!0),a(r.timeUpdate$,i.liveBufferTime$),a(this.player.liveSeekableDuration$,i.duration$),a(this.player.liveLatency$,i.liveLatency$);let n=new l.ValueSubject(1);a(r.playbackRateState$,n),this.params.tuning.dashCmafLive.catchupLiveForMutedInactiveTab&&this.subscription.add(i.elementVisible$.pipe((0,l.filterChanged)()).subscribe((t=>{let r=i.position$.getValue(),s=i.volume$.getValue(),a=!s.volume||s.muted;t||r||!a?t&&e&&(this.seek(0),e=!1):e=!0}))),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(s.isLowLatency.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,l.combine)({liveBufferTime:i.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,l.map)((({liveBufferTime:e,liveAvailabilityStartTime:i})=>e&&i?1e3*e+i+t:void 0))).subscribe(i.liveTime$)).add((0,l.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,l.merge)(r.playbackRateState$,new l.ValueSubject(1))}).pipe((0,l.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:e,playbackRate:r})=>{let s=i.liveBufferTime$.getValue(),a=i.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;a||r<1-n||this.video.paused||(0,l.isNullable)(s)||(t=e-s)}))).add((0,l.combine)({time:i.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,l.merge)(r.playbackRateState$,new l.ValueSubject(1))}).pipe((0,l.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:e,liveDuration:r,playbackRate:s})=>{let a=i.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!a&&!this.video.paused&&s>=1-n||(0,l.isNullable)(e)||(0,l.isNullable)(r))return;let o=-1*(r-e-t);i.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:s})=>({id:i,url:r,isAuto:s,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}}))),this.params.tuning.dashCmafLive.externalStopControl||this.subscription.add(this.player.liveStreamStatus$.pipe((0,l.filter)((e=>(0,l.isNonNullable)(e)))).subscribe((e=>i.isLiveEnded$.next("unpublished"===e&&0===i.position$.getValue()))))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},Bo=g(Ve(),1),Do=g(gi(),1),Oo=g(Ve(),1),Fo=g(ni(),1),jo=g(gi(),1),zo=g(ii(),1),qo=!1;try{qo=Tr.browser.isSafari&&!!Tr.browser.safariVersion&&Tr.browser.safariVersion<=18}catch(Hs){console.error(Hs)}var Ho=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let s={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(s),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=qo&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.isAbortFixEnabled?this.queue[0]:this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,l.assertNever)(t)}}constructor(e,t=!1){this.bufferFull$=new l.Subject,this.error$=new l.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.isAbortFixEnabled=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null,this.isAbortFixEnabled&&this.queue.shift()}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.isAbortFixEnabled=t,this.buffer.addEventListener("updateend",this.completeTask)}},Uo=g(ni(),1),Wo=({id:e,width:t,height:i,bitrate:r,fps:s,quality:a,streamId:n})=>{let o=(a?ts(a):void 0)??(0,l.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:s,streamId:n}},Qo=({id:e,bitrate:t})=>({id:e,bitrate:t}),Go=({language:e,label:t},{id:i,url:r,isAuto:s})=>({id:i,url:r,isAuto:s,type:"internal",language:e,label:t}),Ko=({id:e,language:t,label:i,codecs:r,isDefault:s})=>({id:e,language:t,label:i,codec:(0,Uo.default)(r.split("."),0),isDefault:s}),Yo=({id:e,language:t,label:i,hdr:r,codecs:s})=>({id:e,language:t,hdr:r,label:i,codec:(0,Uo.default)(s.split("."),0)}),Xo=e=>"url"in e,Jo=e=>"template"===e.type,Zo=(e,t)=>{for(let i of e)if(t(i))return i;return null},el=e=>{let t=[];for(let i=0;i<e.length;i++){let r=Math.floor(1e3*e.start(i)),s=Math.ceil(1e3*e.end(i));t.push(r,s)}return t},tl=class{updateend(){if(!qs(this.mediaSource,this.sourceBuffer))return;let{prevRanges:e}=this,t=el(this.sourceBuffer.buffered);this.prevRanges=t,this.isRangesRemoved(e,t)&&(this.lastUpdateTs=Date.now())}isRangesRemoved(e,t){if(e.length!==t.length)return!0;for(let i=0;i<e.length;i+=2){let r=e[i],s=e[i+1],a=t[i],n=t[i+1];if(a>r||n<s)return!0}return!1}wasUpdated(){let{lastCallTs:e,lastUpdateTs:t}=this;return this.lastCallTs=Date.now(),e<=t}destroy(){this.subscription.unsubscribe()}constructor(e,t){this.lastUpdateTs=0,this.lastCallTs=0,this.prevRanges=[],this.subscription=new l.Subscription,this.mediaSource=e,this.sourceBuffer=t,this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>this.updateend())))}},il=class{switchToWithPreviousAbort(e,t=!1){!qs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Ma,(0,l.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),s=this.initData.get(e);if((0,l.isNullable)(s)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):s instanceof Promise&&(yield s),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),s=this.initData.get(e),s instanceof ArrayBuffer&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(s,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,l.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Ma,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,l.isNullable)(e)||(0,l.isNullable)(this.downloadingRepresentationId)||(0,l.isNullable)(this.playingRepresentationId)||(0,l.isNullable)(this.sourceBuffer)||!qs(this.mediaSource,this.sourceBuffer)||(0,l.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.representations.get(this.playingRepresentationId),r=this.segments.get(this.downloadingRepresentationId),s=this.segments.get(this.playingRepresentationId);if((0,l.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),(0,l.assertNonNullable)(i,`No such representation ${this.playingRepresentationId}`),(0,l.isNullable)(r)||(0,l.isNullable)(s))return;let a=r.find((t=>e>=t.time.from&&e<t.time.to));(0,l.isNonNullable)(a)&&isFinite(a.time.from)&&isFinite(a.time.to)&&this.currentSegmentLength$.next(a?.time.to-a.time.from);let n=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let r=this.getForwardBufferDuration(e),s=Wo(i),o=Wo(t),u=this.useSmartRepresentationSwitch&&this.tuning.dash.useNewRepresentationSwitch&&this.tuning.dash.useSmartRepresentationSwitch&&(0,l.isNonNullable)(s)&&(0,l.isNonNullable)(o)&&(0,l.isHigher)(s.quality,o.quality),d=this.useSmartRepresentationSwitch&&this.tuning.dash.useNewRepresentationSwitch&&this.tuning.dash.useDelayedRepresentationSwitch;if(u||d?n+=Math.min(r,this.tuning.dash.representationSwitchForwardBufferGap):a&&a.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&r>=a.time.to-e+100&&(n=a?a.time.to+100:-1/0),this.tuning.dash.useNewRepresentationSwitch){let t=[...this.segments.entries()].map((([t,i])=>{let r=i.find((t=>e>=t.time.from&&e<t.time.to));return{representationId:t,status:r?.status}})).find((e=>"fed"===e.status))?.representationId;t&&(this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)))}}if(isFinite(this.bufferLimit)&&yo(this.sourceBuffer.buffered)>=this.bufferLimit){let t=io(this.sourceBuffer.buffered,e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let o=null;if(!this.activeSegments.size&&(o=this.selectForwardBufferSegments(r,t.segmentReference.type,n),o?.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&a)if((0,Oo.default)(o,a))e="high";else{let t=(0,Fo.default)(o,0);t&&t.time.from-a.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(o,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&a&&"fed"===a.status&&!o?.length&&io(this.sourceBuffer.buffered,e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let u=(0,Fo.default)(r,-1);!this.isLive&&u&&(this.fullyBuffered$.next(u.time.to-e-io(this.sourceBuffer.buffered,e)<100),this.onLastSegment$.next(e-u.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let s of e)Math.trunc(s.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:s.time.from+r,persistent:!0}),i=s.time.to;(0,l.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration,persistent:!0})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],s=0,a=t.length-1;do{r.unshift(t[a]),s+=t[a].time.to-t[a].time.from,a--}while(s<i&&a>=0);return this.liveInitialAdditionalOffset=s-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=e?.streams[this.kind];if(!t)return;let i=(0,jo.default)(t,(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!i)return;let r=this.segments.get(i.id);return r?.length?{from:r[0].time.from,to:r[r.length-1].time.to}:void 0}updateLive(e){if(!e||[...this.segments.values()].every((e=>!e.length)))return;let t=(0,jo.default)(e.streams[this.kind],(e=>e.representations))??[];for(let e of t){if(!e||!Jo(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],s=(0,Fo.default)(r,-1)?.time.to??0,a=t?.findIndex((e=>s>=e.time.from+i&&s<=e.time.to+i));if(-1===a){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(a+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,l.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}setSmartRepresentationSwitch(e){this.useSmartRepresentationSwitch=e}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!Jo(r))return;let s=this.segments.get(i.id);if(!s)continue;let a=s.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(a&&!isFinite(a.time.to)&&(a.time.to=e.time.to,t=a.time.to-a.time.from),!s.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=Ja(r.segmentTemplateUrl,{segmentTime:t});s.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.sourceBufferBufferedDiff?.destroy(),this.gapDetectionIdleCallback&&vn&&vn(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&vn&&vn(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.checkEjectedSegments(),this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){if(this.playingRepresentationId!==this.downloadingRepresentationId){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));this.liveUpdateSegmentIndex=i}return this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):null}selectForwardBufferSegmentsRecord(e,t,i){let r=this.getForwardBufferDuration(i),s=e.findIndex((({status:e,time:{from:t,to:s}},a)=>{let n=t>i||t<=i&&s>=i||0===a&&0===i,o=Math.min(this.forwardBufferTarget,this.bufferLimit),l=this.preloadOnly&&t<=i+o||r<o&&s-t>=o||s<=i+o;return("none"===e||"partially_ejected"===e&&n&&l&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&!(ho(this.sourceBuffer.buffered,t)&&ho(this.sourceBuffer.buffered,s)))&&n&&l}));if(-1===s)return null;if("byteRange"!==t)return e.slice(s,s+1);let a=e,n=0,o=0,l=[],u=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,d=this.preloadOnly?this.forwardBufferTarget:0;for(let e=s;e<a.length&&(n<=u||o<=d);e++){let t=a[e];if(n+=t.byte.to+1-t.byte.from,o+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;l.push(t)}return l}async loadSegments(e,t,i="auto"){Jo(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:s,url:a,signal:n,onProgress:o,onProgressTasks:u}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,l.abortable)(n,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(a,{range:s,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency(),bufferOptimisation:this.tuning.dash.fetcherBufferOptimisation});if(this.lastDataObtainedTimestampMs=(0,l.now)(),!e)return;let d=new DataView(e),c=Dn(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=c.getChunkEndTime(d,e)}o&&r.feedingBytes&&u?await Promise.all(u):await this.sourceBufferTaskQueue.append(d,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=c.getServerLatencyTimestamps(d);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),Da(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())Jo(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:s,signal:a,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&a&&(await(0,l.abortable)(a,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,l.fromEvent)(window,"online").pipe((0,l.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),a.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(s,{range:r,onProgress:n,signal:a,priority:i,bufferOptimisation:this.tuning.dash.fetcherBufferOptimisation}),this.lastDataObtainedTimestampMs=(0,l.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),Da(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(Jo(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,Fo.default)(e,0).byte.from,to:(0,Fo.default)(e,-1).byte.to},{signal:s}=this.downloadAbortController;return{url:i,range:r,signal:s,onProgress:async(e,i)=>{if(!s.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:s,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!Jo(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:s}=this.downloadAbortController,a=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!s.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:s,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});a.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:s,onProgress:n,onProgressTasks:a}}abortActiveSegments(e){for(let t of this.activeSegments)(0,Oo.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:s}){if(!this.activeSegments.size||!qs(this.mediaSource,this.sourceBuffer))return;let a=this.representations.get(t);if(a)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(s.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=Dn(a.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:s,onSegmentAppendFailed:a}){if(!this.activeSegments.size||!qs(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){if(o.representationId!==t)continue;if(s.aborted){await a();continue}let{segment:l}=o,u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(u<r)if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,s)&&!s.aborted?this.onSegmentFullyAppended(o,t):await a()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:Dn(n.mime).parseFeedableSegmentChunk(i);r?.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,s)&&!s.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await a())}}}onSegmentFullyAppended(e,t){if(!(0,l.isNullable)(this.sourceBuffer)&&qs(this.mediaSource,this.sourceBuffer)){!this.isLive&&Tr.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(ho(this.sourceBuffer.buffered,e.segment.time.from,100)&&ho(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",Xo(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values()){if(i.id===t)continue;let r=this.segments.get(i.id);if(r)for(let t of r)"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none")}this.isActiveLowLatency()&&this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,e.segment)}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=gn((()=>(0,zo.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",s=(!i&&this.failedDownloads>0?(0,l.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,Dn(e.mime),r))).then((t=>{if(!t)return;let{init:i,dataView:r,segments:s}=t,a=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,a);let n=s;this.isLive&&Jo(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:l.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,s),s}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,l.isNullable)(e))return!1;this.checkEjectedSegments();let r=[],s=0,a=e=>{if(s>=t)return;r.push({...e.time});let i=Xo(e)?e.size??0:e.byte.to-e.byte.from;s+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&a(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let s of e)(0,Oo.default)(["none","partially_ejected"],s.status)&&Math.round(s.time.from)<=Math.round(t)&&Math.round(s.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){a({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&a(r)}return!!r.length&&(r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:s}=e[i],a=t[t.length-1];a.to>=r?a.to=Math.max(a.to,s):t.push(e[i])}return t})(r),(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1))}async abortBuffer(){if(!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getBufferedTo(){return this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length?this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1):null}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,l.isNullable)(e)?io(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer))return;let{buffered:i}=this.sourceBuffer,r={representation:e,from:t.time.from,to:t.time.to,persistent:!1};for(let e=0;e<i.length;e++){let s=1e3*i.start(e),a=1e3*i.end(e);if(!(a<=t.time.from||s>=t.time.to)){if(s<=t.time.from&&a>=t.time.to){r=void 0;break}a>t.time.from&&a<t.time.to&&(r.from=a),s<t.time.to&&s>t.time.from&&(r.to=s)}}r&&r.to-r.from>1&&!this.gaps.some((e=>r&&e.from===r.from&&e.to===r.to))&&this.gaps.push(r)}detectGapsWhenIdle(e,t){if(this.gapDetectionIdleCallback||!this.sourceBuffer||!qs(this.mediaSource,this.sourceBuffer))return;let{buffered:i}=this.sourceBuffer;this.gaps=this.gaps.filter((e=>{if(e.persistent)return!0;let t=Math.round(e.from),r=Math.round(e.to);for(let e=0;e<i.length;e++)if(t>=Math.round(1e3*i.start(e))&&r<=Math.round(1e3*i.end(e)))return!1;return!0})),this.gapDetectionIdleCallback=gn((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:l.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}checkEjectedSegments(){if((0,l.isNullable)(this.sourceBuffer)||!qs(this.mediaSource,this.sourceBuffer)||(0,l.isNullable)(this.playingRepresentationId)||this.sourceBufferBufferedDiff&&!this.sourceBufferBufferedDiff.wasUpdated())return;let e=el(this.sourceBuffer.buffered),t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let s=Math.floor(r.time.from),a=Math.ceil(r.time.to),n=!1,o=0;for(let i=0;i<e.length;i+=2){let r=e[i],l=e[i+1];n||(n=r-t<=s&&l+t>=a),(s>=r&&s<l-t||a>r+t&&a<=l)&&(o+=1)}n||(1===o||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:l.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}calculateDurationFromSegments(){if(!this.playingRepresentationId)return 0;let e=this.segments.get(this.playingRepresentationId);return(e?(0,Fo.default)(e,-1)?.time.to:0)||0}constructor(e,t,i,{fetcher:r,tuning:s,getCurrentPosition:a,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:u}){this.currentLiveSegmentServerLatency$=new l.ValueSubject(0),this.currentLowLatencySegmentLength$=new l.ValueSubject(0),this.currentSegmentLength$=new l.ValueSubject(0),this.onLastSegment$=new l.ValueSubject(!1),this.fullyBuffered$=new l.ValueSubject(!1),this.playingRepresentation$=new l.ValueSubject(void 0),this.playingRepresentationInit$=new l.ValueSubject(void 0),this.error$=new l.Subject,this.gaps=[],this.subscription=new l.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Ma,this.switchAbortController=new Ma,this.destroyAbortController=new Ma,this.useSmartRepresentationSwitch=!1,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.sourceBufferBufferedDiff=null,this.startWith=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,l.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new Ho(this.sourceBuffer,this.tuning.dash.useAbortMSEFix),this.sourceBufferBufferedDiff=new tl(this.mediaSource,this.sourceBuffer),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.maintain()}))),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!qs(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*yo(this.sourceBuffer.buffered));this.bufferLimit=i;let r=io(this.sourceBuffer.buffered,t),s=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<s).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),s=this.parsedInitData.get(t.id);(0,l.assertNonNullable)(i,"No init buffer for starting representation"),(0,l.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(s))}.bind(this)),this.switchTo=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!qs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),s=this.initData.get(e);if((0,l.isNullable)(s)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):s instanceof Promise&&(yield s),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),s=this.initData.get(e),s&&s instanceof ArrayBuffer&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(s,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!qs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),s=this.initData.get(e);if((0,l.isNullable)(s)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):s instanceof Promise&&(yield s),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),s=this.initData.get(e),s&&s instanceof ArrayBuffer&&this.sourceBuffer&&qs(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(s,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,jo.default)(e,(e=>e.representations));if(!this.downloadingRepresentationId||!t.length)return;this.isSeekingLive=!0;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!Jo(r.segmentReference))return void(this.isSeekingLive=!1);let s=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,s)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,l.assertNonNullable)(r,`Representation not found by id ${i}`);let s=this.segments.get(i);(0,l.assertNonNullable)(s,"No segments for starting representation");let a=this.initData.get(i);if((0,l.assertNonNullable)(a,"No init buffer for starting representation"),!(a instanceof ArrayBuffer))return void(this.isSeekingLive=!1);let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(s,r),yield this.sourceBufferTaskQueue.append(a,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=s,this.compatibilityMode=o,this.forwardBufferTarget=s.dash.forwardBufferTargetAuto,this.getCurrentPosition=a,this.isActiveLowLatency=n,this.isLive=!!u?.live,this.baseUrls=u?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},rl=class{onHeadersReceived(e){let{type:t,reused:i}=Ba(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,l.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.tracer.end(),this.subscription.unsubscribe()}async doFetch(e,t){let i=await Pa(e,t);if(i.ok)return i;let r=await i.text(),s=parseInt(r);if(!isNaN(s))switch(s){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:l.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:l.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:l.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:l.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${s})`,category:l.ErrorCategory.FATAL})}}unsubscribeAbortSubscription(e){e&&(e.unsubscribe(),this.subscription.remove(e))}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:s=!1}){this.manifestRequested$=new l.Subject,this.firstBytesManifest$=new l.Subject,this.firstBytesRequested$=new l.Subject,this.firstBytesReceived$=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.recoverableError$=new l.Subject,this.error$=new l.Subject,this.abortAllController=new Ma,this.subscription=new l.SubscriptionRemovable,this.fetchManifest=(0,l.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Na(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=Oa(i)),this.manifestRequested$.next();let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(sl);return r?(t.log("success",(0,l.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),this.firstBytesManifest$.next(),r.text()):(t.error("error",(0,l.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,l.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:s="auto",signal:a,measureThroughput:n=!0,isLowLatency:o=!1,bufferOptimisation:u=!1}={}){let d=e,c=new Headers,h=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:c.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(d,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),d=e.toString();break}default:(0,l.assertNever)(t)}this.requestQuic&&(d=Na(d));let p,f=this.abortAllController.signal;if(a){let e=new Ma;if(p=(0,l.merge)((0,l.fromEvent)(this.abortAllController.signal,"abort"),(0,l.fromEvent)(a,"abort")).subscribe((()=>{try{e.abort()}catch(e){sl(e)}})),this.subscription.add(p),this.abortAllController.signal.aborted||a.aborted)try{e.abort()}catch(e){sl(e)}f=e.signal}let m=0,g=(0,l.now)();h.log("startRequest",(0,l.flattenObject)({url:d,priority:s,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:g})),this.firstBytesRequested$.next();let v=yield this.doFetch(d,{priority:s,headers:c,signal:f}),b=(0,l.now)();if(!v)return h.error("error",{message:"No response in request"}),h.end(),this.unsubscribeAbortSubscription(p),null;if(this.throughputEstimator?.addRawRtt(b-g),!v.ok||!v.body){this.unsubscribeAbortSubscription(p);let e=`Fetch error ${v.status}: ${v.statusText}`;return h.error("error",{message:e}),h.end(),Promise.reject(new Error(`Fetch error ${v.status}: ${v.statusText}`))}if(this.onHeadersReceived(v.headers),!r&&!n){this.unsubscribeAbortSubscription(p);let e=(0,l.now)(),t={requestStartedAt:g,requestEndedAt:e,duration:e-g};return h.log("endRequest",(0,l.flattenObject)(t)),h.end(),v.arrayBuffer()}let y=v.body;if(n){let e;[y,e]=v.body.tee(),this.throughputEstimator?.trackStream(e,o)}let S,w=y.getReader(),$=parseInt(v.headers.get("content-length")??"",10);Number.isFinite($)&&(S=$),!S&&i&&(S=i.to-i.from+1);let x=S?new Uint8Array(S):new Uint8Array(0),k=!1,T=e=>{this.unsubscribeAbortSubscription(p),k=!0,sl(e)},_=(0,l.abortable)(f,async function*({done:e,value:t}){if(0===m&&(this.lastRequestFirstBytes$.next((0,l.now)()-g),this.firstBytesReceived$.next()),f.aborted)this.unsubscribeAbortSubscription(p);else if(!e&&t){if(u&&S)x.set(t,m),m+=t.byteLength;else{let e=new Uint8Array(x.length+t.length);e.set(x),e.set(t,x.length),x=e,m+=t.byteLength}r?.(new DataView(x.buffer),m),yield w?.read().then(_,T)}}.bind(this));yield w?.read().then(_,T),this.unsubscribeAbortSubscription(p);let C=(0,l.now)(),E={failed:k,requestStartedAt:g,requestEndedAt:C,duration:C-g};return k?(h.error("endRequest",(0,l.flattenObject)(E)),h.end(),null):(h.log("endRequest",(0,l.flattenObject)(E)),h.end(),x.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,s,{from:a,to:n}=e.initRange,o=a,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,s=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,a),l=Math.max(s,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},priority:i,measureThroughput:!1});if(!d)return null;let c=new DataView(d,a-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=s}},sl=e=>{if(!Da(e))throw e},al=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,l.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,s=t.segments[0].time.from,a=t.segments[r-1].time.to;if(e<s||e>a)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&Jo(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new l.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},nl=["progress","play","seeked","stalled","waiting"],ol=["timeupdate","progress","loadeddata","playing","seeked"],ll=class{setSmartRepresentationSwitch(e){this.bufferManagers.forEach((t=>t.setSmartRepresentationSwitch(e)))}async seekLive(e){(0,l.assertNonNullable)(this.element);let t="active"!==this.liveStreamStatus$.getValue()?(0,l.now)()-this.liveStreamEndTimestamp:0,i=this.normolizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=ir(this.manifestUrlString,i,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(this.videoBufferManager?.seekLive(this.manifest.streams.video)),await(this.audioBufferManager?.seekLive(this.manifest.streams.audio)),this.liveTextManager?.seekLive(this.manifest.streams.text))}initBuffer(){(0,l.assertNonNullable)(this.element),this.state$.setState("running");let e=(0,l.fromEvent)(this.element,"timeupdate");this.tuning.dash.timeupdateEventTickThrottle&&(e=e.pipe((0,l.throttle)(this.tuning.dash.timeupdateEventTickThrottle))),this.subscription.add((0,l.merge)(...nl.map((e=>(0,l.fromEvent)(this.element,e))),(0,l.fromEvent)(window,"online"),e).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:l.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,l.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&this.element.readyState===HTMLMediaElement.HAVE_CURRENT_DATA&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,l.fromEvent)(this.element,"waiting").subscribe((()=>{this.tuning.dash.useVideoElementWaitingCurrentTimeReassign&&this.element&&this.element.readyState===HTMLMediaElement.HAVE_CURRENT_DATA&&!this.element.seeking&&ho(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription&&(this.stallWatchdogSubscription.unsubscribe(),this.subscriptionRemovable.remove(this.stallWatchdogSubscription)),this.stallWatchdogSubscription=(0,l.interval)(50).subscribe((()=>{if(!this.element||"open"!==this.source?.readyState)return;let e=this.currentStallDuration$.getValue();e+=50,this.currentStallDuration$.next(e);let t={timeInWaiting:e},i=(0,l.now)(),r=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(r);let s=this.audioBufferManager?.lastDataObtainedTimestamp??0,a=this.videoBufferManager?.getForwardBufferDuration()??0,n=this.audioBufferManager?.getForwardBufferDuration()??0,o=a<100&&i-r>this.tuning.dash.crashOnStallTWithoutDataTimeout,u=this.audioBufferManager&&n<100&&i-s>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((o||u)&&e>this.tuning.dash.crashOnStallTWithoutDataTimeout||e>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${e} ms`);if(this.isLive$.getValue()&&e%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:l.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),t.liveLastOffset=e}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),t.position=e}this.tracer.log("stallIntervalCallback",(0,l.flattenObject)(t))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:l.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscriptionRemovable.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,l.assertNonNullable)(this.element),(0,l.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),ho(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,l.isNullable)(this.element)&&!(0,l.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,l.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,l.isNonNullable)(this.element)&&(0,l.isNonNullable)(this.source)&&(0,l.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}getCodecs(){return this.manifest?.codecs}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.subscriptionRemovable.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,l.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){return!(!this.element||!this.isLive$.getValue())&&1-this.element.playbackRate>this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getBufferedTo();if(null===e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i=this.isJumpGapAfterSeekLive,r=this.element.currentTime;this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let s=1e3*this.element.currentTime,a=null,n=this.element.readyState===HTMLMediaElement.HAVE_METADATA?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)(t.persistent||e.playingRepresentation$.getValue()===t.representation)&&t.from-n<=s&&t.to+n>s&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?a=1/0:(null===a||t.to>a)&&(a=t.to));if(null!==a){let e=a+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,this.tracer.log("jumpGap",(0,l.flattenObject)({isJumpGapAfterSeekLive:i,isActiveLowLatency:t,initialCurrentTime:r,jumpTo:e,resultCurrentTime:this.element.currentTime})))}}calculateDurationFromSegments(){return Math.max(this.videoBufferManager?.calculateDurationFromSegments()||0,this.audioBufferManager?.calculateDurationFromSegments()||0)}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.bufferManagers=[],this.subscription=new l.Subscription,this.subscriptionRemovable=new l.SubscriptionRemovable,this.representationSubscription=new l.Subscription,this.state$=new Nr("none"),this.currentVideoRepresentation$=new l.ValueSubject(void 0),this.currentVideoRepresentationInit$=new l.ValueSubject(void 0),this.currentAudioRepresentation$=new l.ValueSubject(void 0),this.currentVideoSegmentLength$=new l.ValueSubject(0),this.currentAudioSegmentLength$=new l.ValueSubject(0),this.error$=new l.Subject,this.manifestRequested$=new l.Subject,this.firstBytesManifest$=new l.Subject,this.manifestReceived$=new l.Subject,this.firstBytesRequested$=new l.Subject,this.firstBytesReceived$=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.currentLiveTextRepresentation$=new l.ValueSubject(null),this.isLive$=new l.ValueSubject(!1),this.isActiveLive$=new l.ValueSubject(!1),this.isLowLatency$=new l.ValueSubject(!1),this.liveDuration$=new l.ValueSubject(0),this.liveSeekableDuration$=new l.ValueSubject(0),this.liveAvailabilityStartTime$=new l.ValueSubject(0),this.liveStreamStatus$=new l.ValueSubject(void 0),this.bufferLength$=new l.ValueSubject(0),this.liveLatency$=new l.ValueSubject(void 0),this.liveLoadBufferLength$=new l.ValueSubject(0),this.livePositionFromPlayer$=new l.ValueSubject(0),this.currentStallDuration$=new l.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new l.ValueSubject(0),this.fetcherRecoverableError$=new l.Subject,this.fetcherError$=new l.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new l.Subject,this.gapWatchdogActive=!1,this.destroyController=new Ma,this.initManifest=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=ir(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:l.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,l.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:l.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=Za(e??"",this.manifestUrlString),this.manifestReceived$.next()}catch(t){let i=Va(e)??{id:"ManifestParsing",category:l.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&gr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!!t.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:s}=t.live,a=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*a),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";s||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n)}let r,s,a={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let n,o=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r)));if(a[e]=o,this.tuning.dash.codecsPrioritizeEnabled){let t=o.map((({codecs:e})=>e));"audio"===e&&(s=un(t),n=s[0]),"video"===e&&(r=ln(t),n=this.forceVideoCodec&&(0,Bo.default)(r,this.forceVideoCodec)?this.forceVideoCodec:r[0]),n&&(a[e]=o.filter((({codecs:e})=>dn(e)===n)))}else{let t=new Set(o.map((({codecs:e})=>e)));n=on(t),n&&(a[e]=o.filter((({codecs:e})=>e.startsWith(n))))}if("video"===e){let e=this.tuning.preferHDR,t=a.video.some((e=>e.hdr)),i=a.video.some((e=>!e.hdr));Tr.display.isHDR&&e&&t?a.video=a.video.filter((e=>e.hdr)):i&&(a.video=a.video.filter((e=>!e.hdr)))}}let n={...t,streams:a};return this.tuning.dash.codecsPrioritizeEnabled&&(n.codecs={video:r,audio:s}),this.tracer.log("updateManifestEnd",(0,l.flattenObject)(n)),n}.bind(this)),this.initRepresentations=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,l.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,l.assertNonNullable)(this.manifest),(0,l.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.representationSubscription=new l.Subscription,this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,l.fromEvent)(e,"error").pipe((0,l.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=br();let s=document.createElement("source");if(r(s),s.src=URL.createObjectURL(this.source),this.element.appendChild(s),vr())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let a={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new il("video",this.source,n,a),this.bufferManagers=[this.videoBufferManager],(0,l.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new il("audio",this.source,e,a),this.bufferManagers.push(this.audioBufferManager)}al.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new al(this.manifest.streams.text,a)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let o=()=>{this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add((0,l.merge)(...ol.map((e=>(0,l.fromEvent)(this.element,e)))).pipe((0,l.map)((e=>this.element?io(this.element.buffered,1e3*this.element.currentTime):0)),(0,l.filterChanged)(),(0,l.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&o()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,l.merge)((0,l.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{o()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,l.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,l.now)()))),this.subscription.add((0,l.fromEvent)(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=(0,l.interval)(1e3).subscribe((e=>{let t=rr(this.manifestUrlString,2);this.manifestUrlString=ir(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,l.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,l.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,l.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,l.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||Eo(this.element,1)}))),this.representationSubscription.add((0,l.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,l.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,l.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,l.filter)((({isLive:e})=>e)),(0,l.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,l.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+rr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,l.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,s=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,a=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>s&&(o=1+Math.sign(n)*a),Eo(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,l.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,l.throttle)(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,s=rr(this.manifestUrlString,2),a=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(a,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=a<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==s&&u<n?h="live_forward_buffering":u<n+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),a=this.normolizeLiveOffset(Math.trunc(s+i/r)),l=Math.abs(a-s),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=s:a>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=a),this.manifestUrlString=ir(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:l.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let u=(0,l.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,l.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),d=(0,l.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,l.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),c=(0,l.combine)({allBuffersFull:u,someBufferEnded:d}).pipe((0,l.filterChanged)(),(0,l.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,l.filter)((e=>e)));if(this.representationSubscription.add((0,l.merge)(this.forceEnded$,c).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,l.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState?this.error$.next({id:"OpenOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0}):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,Do.default)((0,Do.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),Jo(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,l.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,l.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:l.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.forceVideoCodec=e.forceVideoCodec,this.fetcher=new rl({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.subscription.add(this.fetcher.manifestRequested$.subscribe(this.manifestRequested$)),this.subscription.add(this.fetcher.firstBytesManifest$.subscribe(this.firstBytesManifest$)),this.subscription.add(this.fetcher.firstBytesRequested$.subscribe(this.firstBytesRequested$)),this.subscription.add(this.fetcher.firstBytesReceived$.subscribe(this.firstBytesReceived$)),this.subscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.subscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.liveBuffer=Co.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},ul=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,l.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,l.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,l.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new l.Subscription,this.pipSize$=new l.ValueSubject(void 0),this.videoSize$=new l.ValueSubject(void 0),this.elementSize$=new l.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=l.noop}},dl=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params;(0,l.isNullable)(this.observableVideo)&&(this.observableVideo=es(this.video),this.subscription.add((()=>this.observableVideo?.destroy())));let i=this.constructor.name,r=t=>{e.error$.next({id:i,category:l.ErrorCategory.WTF,message:`${i} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:this.observableVideo,genericErrorListener:r,connect:(e,t)=>this.subscription.add(e.subscribe(t,r))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:s}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let a=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,l.map)((e=>"none"!==e.to.state)),(0,l.filterChanged)());this.stallsManager.init({isSeeked$:a,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$,duration:this.video.duration}),s(i.ended$,e.endedEvent$),s(i.looped$,e.loopedEvent$),s(i.error$,e.error$),s(i.isBuffering$,e.isBuffering$),s(i.currentBuffer$,e.currentBuffer$),s(i.currentBuffer$,e.currentNativeBuffer$),s(i.playing$,e.firstFrameEvent$),s(i.canplay$,e.canplay$),s(i.inPiP$,e.inPiP$),s(i.inFullscreen$,e.inFullscreen$),s(i.loadedMetadata$,e.loadedMetadataEvent$),s(this.player.error$,e.error$),s(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),s(this.player.fetcherError$,e.fetcherError$),s(this.player.manifestRequested$,e.manifestRequested$),s(this.player.firstBytesManifest$,e.firstBytesManifest$),s(this.player.manifestReceived$,e.manifestReceived$),s(this.player.firstBytesRequested$,e.firstBytesRequested$),s(this.player.firstBytesReceived$,e.firstBytesReceived$),s(this.player.lastConnectionType$,e.httpConnectionType$),s(this.player.lastConnectionReused$,e.httpConnectionReused$),s(this.player.isLive$,e.isLive$),s(this.player.lastRequestFirstBytes$.pipe((0,l.filter)(l.isNonNullable),(0,l.once)()),e.firstBytesEvent$),s(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),s(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(Ur(this.video,t.isLooped,r)),this.subscription.add(Wr(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(Qr(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),s(Zs(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),lr(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.params.tuning.changePlaybackStateToPausedWhenEnded&&this.subscription.add(i.ended$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}))),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams(),t=this.player.getCodecs();if((0,l.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(Ko(i));let e=[];for(let t of i.representations){let r=Qo(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let i=[];for(let t of e.video){i.push(Yo(t));let e=[];for(let i of t.representations){let r=Wo({...i,streamId:t.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:t,representation:i}))}this.videoStreamsMap.set(t,e)}this.params.output.availableVideoStreams$.next(i);for(let t of e.text)for(let e of t.representations){let i=Go(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),t?.video&&this.params.output.availableVideoCodecs$.next(t.video),t?.audio&&this.params.output.availableAudioCodecs$.next(t.audio),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r));let{vktvAbrThrottle:n}=this.params.tuning.dash,o=n&&(e=>{let t=!1,i=(0,l.throttleFn)((()=>{t=!0}),e);return()=>{try{return i(),t}finally{t=!1}}})(n)||null;this.subscription.add((0,l.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,l.fromEvent)(this.video,"progress")).pipe((0,l.filter)((()=>this.videoTracksMap.size>0))).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if("manifest_ready"!==e&&"running"!==e||i||"running"===e&&o&&!o())return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState()),this.selectVideoAudioRepresentations();let{video:r,audio:s}=this.selectedRepresentations;if(!r)return;let a=Zo(this.videoTracksMap.keys(),(e=>this.videoTracksMap.get(e)?.representation.id===r.id));(0,l.isNonNullable)(a)&&(this.stallsManager.lastVideoTrackSelected=a);let n=this.params.desiredState.autoVideoTrackLimits.getTransition();if(n&&this.params.output.autoVideoTrackLimits$.next(n.to),"manifest_ready"===e)await this.player.initRepresentations(r.id,s?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",r.id),s){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",s.id,e)}}),r)),this.subscription.add((0,l.combine)({videoState:this.videoState.stateChangeEnded$,autoVideoTrackState:(0,l.merge)((0,l.observableFrom)([t.autoVideoTrackSwitching.getState()]),t.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,l.map)((e=>e.to))))}).pipe((0,l.map)((({videoState:e,autoVideoTrackState:t})=>"stopped"!==e.to&&t)),(0,l.filterChanged)()).subscribe((e=>this.player.setSmartRepresentationSwitch(e)))),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=Zo(this.videoTracksMap.entries(),(([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:s}]=i,a=this.params.desiredState.videoStream.getTransition();a&&a.to&&a.to.id===s.id&&this.params.desiredState.videoStream.setState(a.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(Yo(s));let n=this.player.calculateDurationFromSegments();n&&this.params.output.duration$.next(n/1e3)}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=Zo(this.audioTracksMap.entries(),(([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:s}]=i,a=this.params.desiredState.audioStream.getTransition();a&&a.to&&a.to.id===s.id&&this.params.desiredState.audioStream.setState(a.to),e.currentAudioStream$.next(Ko(s))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let u=t.playbackState.stateChangeStarted$.pipe((0,l.map)((({to:e})=>"ready"===e)),(0,l.filterChanged)());this.subscription.add((0,l.merge)(u,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,l.merge)(u,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let d=(0,l.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(d.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?ws:Ss,t=this.params.tuning.useNewAutoSelectVideoTrack?As:Es,i=this.params.tuning.useNewAutoSelectVideoTrack?_s:Cs,{desiredState:r,output:s}=this.params,a=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=Zo(this.videoTracksMap.keys(),(e=>e.id===n)),l=s.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=Zo(this.videoStreamsMap.keys(),(e=>e.id===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=io(this.video.buffered,1e3*this.video.currentTime);h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:a?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),g=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),v=g?.id&&Zo(this.audioStreamsMap.keys(),(e=>e.id===g.id))||this.audioStreamsMap.keys().next().value,b=0;if(v){if(o&&!a){let t=e(o,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let y=o;(a||!y)&&(y=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}));let S=v&&t(y,c,this.audioStreamsMap.get(v)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),w=this.videoTracksMap.get(y)?.representation,$=S&&this.audioTracksMap.get(S)?.representation;w&&$?(this.selectedRepresentations.video=w,this.selectedRepresentations.audio=$):w&&!$&&0===this.audioTracksMap.size&&(this.selectedRepresentations.video=w,this.selectedRepresentations.audio=null)}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),zr(this.video),this.tracer.end()}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.observableVideo=null,this.droppedFramesManager=new Xs,this.stallsManager=new ba,this.elementSizeManager=new ul,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new ms,this.audioTrackSwitchHistory=new ms,this.selectedRepresentations={audio:null,video:null},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&lr(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&lr(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new ha(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new Yr(e.source.url),this.params=e,this.video=jr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new ll({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer,forceVideoCodec:this.params.forceVideoCodec}),this.subscribe()}},cl=class extends dl{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},hl=class extends dl{subscribe(){super.subscribe();let e=!1,t=-1,{output:i,observableVideo:r,desiredState:s,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canPlayLiveTailBuffer$.next(!0),a(r.timeUpdate$,i.liveBufferTime$),a(this.player.liveSeekableDuration$,i.duration$),a(this.player.liveLatency$,i.liveLatency$);let n=new l.ValueSubject(1);a(r.playbackRateState$,n),this.params.tuning.dashCmafLive.catchupLiveForMutedInactiveTab&&this.subscription.add(i.elementVisible$.pipe((0,l.filterChanged)()).subscribe((t=>{let r=i.position$.getValue(),s=i.volume$.getValue(),a=!s.volume||s.muted;t||r||!a?t&&e&&(this.seek(0),e=!1):e=!0}))),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(s.isLowLatency.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,l.combine)({liveBufferTime:i.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,l.map)((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(i.liveTime$)).add(this.player.liveStreamStatus$.pipe((0,l.filter)((e=>(0,l.isNonNullable)(e)))).subscribe((e=>i.isLiveEnded$.next("active"!==e&&0===i.position$.getValue())))).add((0,l.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,l.merge)(r.playbackRateState$,new l.ValueSubject(1))}).pipe((0,l.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:e,playbackRate:r})=>{let s=i.liveBufferTime$.getValue(),a=i.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;a||r<1-n||this.video.paused||(0,l.isNullable)(s)||(t=e-s)}))).add((0,l.combine)({time:i.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,l.merge)(r.playbackRateState$,new l.ValueSubject(1))}).pipe((0,l.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:e,liveDuration:r,playbackRate:s})=>{let a=i.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!a&&!this.video.paused&&s>=1-n||(0,l.isNullable)(e)||(0,l.isNullable)(r))return;let o=-1*(r-e-t);i.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:s})=>({id:i,url:r,isAuto:s,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},pl="X-Playback-Duration",fl=async e=>{let t=await Pa(e),i=await t.text(),r=/#EXT-X-VK-PLAYBACK-DURATION:(\d+)/m.exec(i)?.[1];return r?parseInt(r,10):t.headers.has(pl)?parseInt(t.headers.get(pl),10):void 0},ml=g(bt(),1),gl=e=>{let t=null;if(e.QUALITY&&(t=ts(e.QUALITY)),!t&&e.RESOLUTION){let[i,r]=e.RESOLUTION.split("x").map((e=>parseInt(e,10)));t=(0,l.videoSizeToQuality)({width:i,height:r})}return t??null},vl=0,bl=async(e,t=e,i,r)=>{let s=await(await Pa(e,r)).text();vl+=1;try{let{qualityManifests:e,textTracks:i}=((e,t)=>{let i=e.split("\n"),r=[],s=[];for(let e=0;e<i.length;e++){let a=i[e],n=a.match(/^#EXT-X-STREAM-INF:(.+)/),o=a.match(/^#EXT-X-MEDIA:TYPE=SUBTITLES,(.+)/);if(n||o){if(n){let s,a=(0,ml.default)(n[1].split(",").map((e=>e.split("=")))),o=a.QUALITY??`stream-${a.BANDWIDTH}`,l=gl(a);a.BANDWIDTH&&(s=parseInt(a.BANDWIDTH,10)/1e3||void 0),!s&&a["AVERAGE-BANDWIDTH"]&&(s=parseInt(a["AVERAGE-BANDWIDTH"],10)/1e3||void 0);let u,d=a["FRAME-RATE"]?parseFloat(a["FRAME-RATE"]):void 0;if(a.RESOLUTION){let[e,t]=a.RESOLUTION.split("x").map((e=>parseInt(e,10)));e&&t&&(u={width:e,height:t})}let c=new URL(i[++e],t).toString();l&&r.push({id:o,quality:l,url:c,bandwidth:s,size:u,fps:d})}if(o){let e=(0,ml.default)(o[1].split(",").map((e=>{let t=e.indexOf("=");return[e.substring(0,t),e.substring(t+1)]})).map((([e,t])=>[e,t.replace(/^"|"$/g,"")]))),t=e.URI?.replace(/playlist$/,"subtitles.vtt"),i=e.LANGUAGE,r=e.NAME;t&&i&&s.push({type:"internal",id:i,label:r,language:i,url:t,isAuto:!1})}}}if(!r.length)throw new Error("Empty manifest");return{qualityManifests:r,textTracks:s}})(s,t);return{qualityManifests:e,textTracks:i}}catch{if(vl<=i.manifestRetryMaxCount)return await(e=>new Promise((t=>{setTimeout((()=>{t()}),e)})))((0,l.getExponentialDelay)(vl-1,{start:i.manifestRetryInterval,max:i.manifestRetryMaxInterval})),bl(e,t,i)}return{qualityManifests:[],textTracks:[]}},yl=bl,Sl=class{destroy(){this.subscription.unsubscribe(),this.abortControllers.destroy.abort()}async prepare(e){try{let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),this.prepareUrl=t.toString();let{textTracks:i}=await this.fetchManifestData();await this.processTextTracks(i,this.params.sourceUrl)}catch(e){this.error("prepare",e)}}async processTextTracks(e,t){try{let i=await this.parseTextTracks(e,t);i&&(this.currentTextTrackData=i)}catch(e){this.error("processTextTracks",e)}}async parseTextTracks(e,t){for(let i of e){let e=new URL(i.url,t).toString(),r=await(await Pa(e,{signal:this.abortControllers.destroy.signal})).text();return{textTrack:i,playlist:this.parsePlaylist(r,e)}}}parsePlaylist(e,t){let i={mediaSequence:0,programDateTime:"",segments:[],targetDuration:0,vkPlaybackDuration:0,segmentStartTime:0,vkStartTime:""},r=e.split("\n"),s=0;for(let e=0;e<r.length;++e){let a=r[e];switch(!0){case a.startsWith("#EXTINF:"):{let n=r[++e],o=new URL(n,t).toString(),l=1e3*Number(this.extractPlaylistRowValue("#EXTINF:",a));if(i.segments.push({time:{from:s,to:s+l},url:o}),s+=l,!i.segmentStartTime){let e=new Date(i.vkStartTime).valueOf(),t=new Date(i.programDateTime).valueOf();i.segmentStartTime=t-e}break}case a.startsWith("#EXT-X-TARGETDURATION:"):i.targetDuration=Number(this.extractPlaylistRowValue("#EXT-X-TARGETDURATION:",a));break;case a.startsWith("#EXT-X-MEDIA-SEQUENCE:"):i.mediaSequence=Number(this.extractPlaylistRowValue("#EXT-X-MEDIA-SEQUENCE:",a));break;case a.startsWith("#EXT-X-VK-PLAYBACK-DURATION:"):i.vkPlaybackDuration=Number(this.extractPlaylistRowValue("#EXT-X-VK-PLAYBACK-DURATION:",a));break;case a.startsWith("#EXT-X-PROGRAM-DATE-TIME:"):{let e=this.extractPlaylistRowValue("#EXT-X-PROGRAM-DATE-TIME:",a);i.programDateTime=e;let t=new Date(e);t.setMilliseconds(0),s=t.valueOf();break}case a.startsWith("#EXT-X-VK-START-TIME:"):i.vkStartTime=this.extractPlaylistRowValue("#EXT-X-VK-START-TIME:",a)}}return i}extractPlaylistRowValue(e,t){return"#EXTINF:"===e?t.substring(e.length,t.length-1):t.substring(e.length)}processLiveTime(e){if((0,l.isNonNullable)(e)&&this.currentTextTrackData){let{segments:t}=this.currentTextTrackData.playlist,{from:i}=t[0].time,{to:r}=t[t.length-1].time;if(e<i||e>r)return;r-e<this.params.downloadThreshold&&this.fetchNextManifestData();for(let i of t)if(i.time.from<=e&&i.time.to>=e){this.availableTextTracks$.next([{...this.currentTextTrackData.textTrack,url:i.url,isAuto:!0}]);break}}}async fetchNextManifestData(){try{if(this.abortControllers.nextManifest)return;this.abortControllers.nextManifest=new Ma;let{textTracks:e}=await this.fetchManifestData(),t=await this.parseTextTracks(e,this.params.sourceUrl);this.currentTextTrackData&&t&&(this.currentTextTrackData.playlist.segments=t.playlist.segments)}catch(e){this.error("fetchNextManifestData",e)}finally{this.abortControllers.nextManifest=null}}async fetchManifestData(){let e=this.prepareUrl??this.params.sourceUrl;return await this.params.fetchManifestData(e,{signal:this.abortControllers.destroy.signal})}error(e,t){this.error$.next({id:"[LiveTextManager][HLS_LIVE_CMAF]",category:l.ErrorCategory.WTF,thrown:t,message:e})}constructor(e,t,i,r,s){this.subscription=new l.Subscription,this.abortControllers={destroy:new Ma,nextManifest:null},this.prepareUrl=void 0,this.currentTextTrackData=null,this.availableTextTracks$=new l.ValueSubject(null),this.getCurrentTime$=new l.ValueSubject(null),this.error$=new l.Subject,this.params={fetchManifestData:i,sourceUrl:r,downloadThreshold:s},this.subscription.add(e.pipe((0,l.throttle)(1e3)).subscribe((e=>{this.processLiveTime(e)}))),this.getCurrentTime$.next((()=>this.currentTextTrackData?this.currentTextTrackData.playlist.segmentStartTime/1e3+t.currentTime:0))}},wl=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),s=r?.to?.id??t.getState()?.id??"master",a=this.manifests$.getValue();if(!a.length)return;let n=i?"master":s;return i&&!r&&t.startTransitionTo(this.masterManifest),a.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsLiveProvider",category:l.ErrorCategory.WTF,message:"HlsLiveProvider internal logic error",thrown:t})},r=es(this.video);this.subscription.add((()=>r.destroy()));let s=(e,t)=>this.subscription.add(e.subscribe(t,i));s(r.ended$,e.endedEvent$),s(r.error$,e.error$),s(r.isBuffering$,e.isBuffering$),s(r.currentBuffer$,e.currentBuffer$),s(r.currentBuffer$,e.currentNativeBuffer$),s(r.loadedMetadata$,e.firstBytesEvent$),s(r.loadedMetadata$,e.loadedMetadataEvent$),s(r.playing$,e.firstFrameEvent$),s(r.canplay$,e.canplay$),s(r.inPiP$,e.inPiP$),s(r.inFullscreen$,e.inFullscreen$),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(Wr(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(Qr(this.video,t.playbackRate,r.playbackRateState$,i)),s(Zs(this.video),e.elementVisible$),this.liveTextManager?(s(this.liveTextManager.getCurrentTime$,this.params.output.getCurrentTime$),s(this.liveTextManager.error$,this.params.output.error$)):this.textTracksManager&&this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),lr(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.liveTextManager&&this.subscription.add(this.liveTextManager.availableTextTracks$.subscribe((e=>{e&&this.params.output.availableTextTracks$.next(e)}))),this.subscription.add(this.maxSeekBackTime$.pipe((0,l.filterChanged)(),(0,l.map)((e=>-e/1e3))).subscribe(this.params.output.duration$,i)),this.subscription.add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,l.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(Ls(t.url)))}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),e&&"requested"===e.state&&this.seek(e.position)}),i)),this.subscription.add(r.loadedData$.subscribe((()=>{let e=this.video?.getStartDate?.()?.getTime();this.manifestStartTime$.next(e||void 0)}),i)),this.subscription.add((0,l.combine)({startTime:this.manifestStartTime$.pipe((0,l.filter)(l.isNonNullable)),currentTime:r.timeUpdate$}).subscribe((({startTime:e,currentTime:t})=>this.params.output.liveTime$.next(e+1e3*t)),i)),this.subscription.add(this.manifests$.pipe((0,l.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:s})=>({id:e,quality:t,size:i,fps:s,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i));let a=(0,l.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(a.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager?.destroy(),this.liveTextManager?.destroy(),this.params.output.element$.next(void 0),zr(this.video)}prepare(){let e=this.selectManifest();if((0,l.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:s}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[s,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}let s="HLS_LIVE_CMAF"===this.params.format?2:0,a=ir(r.toString(),this.liveOffset.getTotalOffset(),s);this.liveTextManager?.prepare(a),this.video.setAttribute("src",a),this.video.load(),fl(a).then((e=>{if((0,l.isNullable)(e)){let e=this.params.source.maxSeekBackTime??this.maxSeekBackTime$.getValue();((0,l.isNullable)(e)||!isFinite(e))&&Pa(a).then((e=>e.text())).then((e=>{let t=/#EXT-X-STREAM-INF[^\n]+\n(.+)/m.exec(e)?.[1];if(t){let e=new URL(t,a).toString();fl(e).then((e=>{(0,l.isNullable)(e)||this.maxSeekBackTime$.next(e)}))}})).catch((()=>{}))}else this.maxSeekBackTime$.next(e)}))}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),this.liveOffset.pause(),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=t<this.maxSeekBackTime$.getValue()?t:0;this.liveOffset.resetTo(i),this.params.output.position$.next(-i/1e3),this.params.output.seekedEvent$.next()}generateLiveUrl(){let e=ir(this.params.source.url);if(this.params.tuning.useHlsLiveNewTextManager){let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),e=t.toString()}return e}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.textTracksManager=null,this.liveTextManager=null,this.manifests$=new l.ValueSubject([]),this.liveOffset=new Xr,this.manifestStartTime$=new l.ValueSubject(void 0),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),s=this.params.desiredState.autoVideoTrackSwitching.getTransition(),a=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||s||a){let e=this.videoState.getState();return this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e),this.prepare(),a&&this.params.output.autoVideoTrackLimits$.next(a.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:-this.liveOffset.getTotalOffset(),forcePrecise:!0}))}if("paused"!==i?.to&&"requested"===n.state)return this.videoState.startTransitionTo("ready"),this.seek(n.position&&n.position-this.liveOffset.getTotalPausedTime()),void this.prepare();switch(e){case"ready":return void("ready"===t?lr(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),this.liveOffset.pause(),lr(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":if("playing"===t)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.playIfAllowed(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.prepare()}else"paused"===i?.to&&(lr(this.params.desiredState.playbackState,"paused"),this.liveOffset.pause());return;case"changing_manifest":break;default:return(0,l.assertNever)(e)}},this.params=e,this.video=jr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:l.VideoQuality.INVARIANT,url:this.params.source.url};let t=(e,t)=>yl(e,this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},t);this.params.tuning.useHlsLiveNewTextManager?this.liveTextManager=new Sl(this.params.output.liveTime$,this.video,t,this.params.source.url,this.params.tuning.hlsLiveNewTextManagerDownloadThreshold):this.textTracksManager=new Yr(e.source.url),t(this.generateLiveUrl()).then((({qualityManifests:e,textTracks:t})=>{0===e.length&&this.params.output.error$.next({id:"HlsLiveProviderInternal:empty_manifest",category:l.ErrorCategory.WTF,message:"HlsLiveProvider: there are no qualities in manifest"}),this.liveTextManager?.processTextTracks(t,this.params.source.url),this.manifests$.next([this.masterManifest,...e])})).catch((e=>{this.params.output.error$.next({id:"ExtractHlsQualities",category:l.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e})})),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.maxSeekBackTime$=new l.ValueSubject(e.source.maxSeekBackTime??1/0),this.subscribe()}},$l=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),s=r?.to?.id??t.getState()?.id??"master",a=this.manifests$.getValue();if(!a.length)return;let n=i?"master":s;return i&&(!r||!r.from)&&t.startTransitionTo(this.masterManifest),a.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsProvider",category:l.ErrorCategory.WTF,message:"HlsProvider internal logic error",thrown:t})},r=es(this.video);this.subscription.add((()=>r.destroy()));let s=(e,t)=>this.subscription.add(e.subscribe(t));if(s(r.timeUpdate$,e.position$),s(r.durationChange$,e.duration$),s(r.ended$,e.endedEvent$),s(r.looped$,e.loopedEvent$),s(r.error$,e.error$),s(r.isBuffering$,e.isBuffering$),s(r.currentBuffer$,e.currentBuffer$),s(r.currentBuffer$,e.currentNativeBuffer$),s(r.loadedMetadata$,e.firstBytesEvent$),s(r.loadedMetadata$,e.loadedMetadataEvent$),s(r.playing$,e.firstFrameEvent$),s(r.canplay$,e.canplay$),s(r.seeked$,e.seekedEvent$),s(r.inPiP$,e.inPiP$),s(r.inFullscreen$,e.inFullscreen$),s(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(Ur(this.video,t.isLooped,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(Qr(this.video,t.playbackRate,r.playbackRateState$,i)),Sa({subscription:this.subscription,desiredState:t,videoElement$:this.params.output.element$,observableVideo:r}),this.subscription.add(Wr(this.video,t.volume,r.volumeState$,i)),this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),lr(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i).add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,l.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(Ls(t.url)))}let s=this.params.desiredState.playbackRate.getState(),a=this.params.output.element$.getValue()?.playbackRate;if(s!==a){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(s),e.playbackRate=s)}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),"requested"===e.state&&this.seek(e.position)}),i))),this.params.tuning.changePlaybackStateToPausedWhenEnded&&this.subscription.add(r.ended$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}))),this.subscription.add(this.manifests$.pipe((0,l.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:s})=>({id:e,quality:t,size:i,fps:s,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i)),!Tr.device.isIOS||!this.params.tuning.useNativeHLSTextTracks){let{textTracks:e}=this.video;this.subscription.add((0,l.merge)((0,l.fromEvent)(e,"addtrack"),(0,l.fromEvent)(e,"removetrack"),(0,l.fromEvent)(e,"change"),(0,l.observableFrom)(["init"])).subscribe((()=>{for(let t=0;t<e.length;t++)e[t].mode="hidden"}),i))}let a=(0,l.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(a.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.params.output.element$.next(void 0),zr(this.video)}prepare(){let e=this.selectManifest();if((0,l.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:s}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[s,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}this.video.setAttribute("src",r.toString()),this.video.load()}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.manifests$=new l.ValueSubject([]),this.unmuteAfterBrowserResetsHappened=new l.ValueSubject(!1),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),s=this.params.desiredState.autoVideoTrackSwitching.getTransition(),a=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||s||a){let e=this.videoState.getState();this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e);let{currentTime:t}=this.video;return this.prepare(),a&&this.params.output.autoVideoTrackLimits$.next(a.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*t,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===n.state&&this.seek(n.position),e){case"ready":return void("ready"===t?lr(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&lr(this.params.desiredState.playbackState,"paused"));case"changing_manifest":break;default:return(0,l.assertNever)(e)}},this.textTracksManager=new Yr(e.source.url),this.params=e,this.video=jr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:l.VideoQuality.INVARIANT,url:this.params.source.url},this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.manifestRequested$.next(),yl(ir(this.params.source.url),this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount}).then((({qualityManifests:e,textTracks:t})=>{this.params.output.firstBytesManifest$.next(),this.manifests$.next([this.masterManifest,...e]),this.params.output.manifestReceived$.next(),this.params.tuning.useNativeHLSTextTracks||this.params.desiredState.internalTextTracks.startTransitionTo(t)}),(e=>this.params.output.error$.next({id:"ExtractHlsQualities",category:l.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e}))),this.subscribe()}},xl=g(Oe(),1),kl=g(Ae(),1),Tl=g(ni(),1),_l=class{subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"MpegProvider",category:l.ErrorCategory.WTF,message:"MpegProvider internal logic error",thrown:t})},r=es(this.video);this.subscription.add((()=>r.destroy()));let s=(e,t)=>this.subscription.add(e.subscribe(t,i));s(r.timeUpdate$,e.position$),s(r.durationChange$,e.duration$),s(r.ended$,e.endedEvent$),s(r.looped$,e.loopedEvent$),s(r.error$,e.error$),s(r.isBuffering$,e.isBuffering$),s(r.currentBuffer$,e.currentNativeBuffer$),s(r.currentBuffer$,e.currentBuffer$),s(r.loadedMetadata$,e.firstBytesEvent$),s(r.loadedMetadata$,e.loadedMetadataEvent$),s(r.playing$,e.firstFrameEvent$),s(r.canplay$,e.canplay$),s(r.seeked$,e.seekedEvent$),s(r.inPiP$,e.inPiP$),s(r.inFullscreen$,e.inFullscreen$),s(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(Ur(this.video,t.isLooped,i)),Sa({subscription:this.subscription,desiredState:t,videoElement$:this.params.output.element$,observableVideo:r}),this.subscription.add(Wr(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(Qr(this.video,t.playbackRate,r.playbackRateState$,i)),s(Zs(this.video),e.elementVisible$),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),lr(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready");let e=this.params.desiredState.videoTrack.getTransition();if(e&&(0,l.isNonNullable)(e.to)){this.params.desiredState.videoTrack.setState(e.to),this.params.output.currentVideoTrack$.next(this.trackUrls[e.to.id].track);let t=this.params.desiredState.playbackRate.getState(),i=this.params.output.element$.getValue()?.playbackRate;if(t!==i){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(t),e.playbackRate=t)}}"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.params.tuning.changePlaybackStateToPausedWhenEnded&&this.subscription.add(r.ended$.subscribe((()=>{this.videoState.setState("paused"),lr(t.playbackState,"paused")}))),this.textTracksManager.connect(this.video,t,e);let a=(0,l.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(a.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.trackUrls={},this.params.output.element$.next(void 0),zr(this.video)}prepare(){let e=this.params.desiredState.videoTrack.getState()?.id;(0,l.assertNonNullable)(e,"MpegProvider: track is not selected");let{url:t}=this.trackUrls[e];(0,l.assertNonNullable)(t,`MpegProvider: No url for ${e}`),this.params.tuning.requestQuick&&(t=Na(t)),this.video.setAttribute("src",t),this.video.load(),this.params.output.hostname$.next(Ls(t))}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}handleQualityLimitTransition(e){this.params.output.autoVideoTrackLimits$.next(e);let t=e=>{this.params.output.currentVideoTrack$.next(e),this.params.desiredState.videoTrack.startTransitionTo(e)},i=e=>{let i=_s(a,{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:0,limits:e,abrLogger:this.params.dependencies.abrLogger});t(i)},r=this.params.output.currentVideoTrack$.getValue()?.quality,s=!(!e.max&&!e.min),a=(0,kl.default)(this.trackUrls).map((e=>e.track));if(!r||!s||ds(e,a[0].quality,(0,Tl.default)(a,-1)?.quality))return void i();let n=!e.max||(0,l.isLowerOrEqual)(r,e.max),o=!e.min||(0,l.isHigherOrEqual)(r,e.min);n&&o||i(e)}constructor(e){this.subscription=new l.Subscription,this.videoState=new Nr("stopped"),this.trackUrls={},this.textTracksManager=new Yr,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.autoVideoTrackLimits.getTransition(),s=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.seekState.getState();if(!r||"ready"===e||s){if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(s){let{currentTime:e}=this.video;return this.prepare(),void("none"===a.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*e,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===a.state&&this.seek(a.position),e){case"ready":return void("ready"===t?lr(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&lr(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}}else this.handleQualityLimitTransition(r.to)},this.params=e,this.video=jr(e.container,e.tuning),this.params.output.element$.next(this.video),(0,xl.default)(this.params.source).reverse().forEach((([e,t],i)=>{let r=i.toString(10);this.trackUrls[r]={track:{quality:e,id:r},url:t}})),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next((0,kl.default)(this.trackUrls).map((({track:e})=>e))),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.desiredState.autoVideoTrackSwitching.setState(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.subscribe()}},Cl=["stun:videostun.mycdn.me:80"],El=()=>null,Al=class{onStart(e){try{this.externalStartCallback=e}catch(e){this.handleSystemError(e)}}onStop(e){try{this.externalStopCallback=e}catch(e){this.handleSystemError(e)}}onError(e){try{this.externalErrorCallback=e}catch(e){this.handleSystemError(e)}}connect(){this.connectWS()}disconnect(){try{this.externalStopCallback(),this.closeConnections()}catch(e){this.handleSystemError(e)}}connectWS(){this.ws||(this.ws=new WebSocket(this.serverUrl),this.ws.onopen=this.onSocketOpen.bind(this),this.ws.onmessage=this.onSocketMessage.bind(this),this.ws.onclose=this.onSocketClose.bind(this),this.ws.onerror=this.onSocketError.bind(this))}onSocketOpen(){this.handleLogin()}onSocketClose(e){try{if(!this.ws)return;this.ws=null,e.code>1e3?(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():this.scheduleRetry()):this.externalStopCallback()}catch(e){this.handleRTCError(e)}}onSocketError(e){try{this.externalErrorCallback(new Error(e.toString()))}catch(e){this.handleRTCError(e)}}onSocketMessage(e){try{let t=this.parseMessage(e.data);switch(t.type){case"JOIN":case"CALL_JOIN":this.handleJoinMessage(t);break;case"UPDATE":this.handleUpdateMessage(t);break;case"STATUS":this.handleStatusMessage(t)}}catch(e){this.handleRTCError(e)}}handleJoinMessage(e){switch(e.inviteType){case"ANSWER":this.handleAnswer(e.sdp);break;case"CANDIDATE":this.handleCandidate(e.candidate)}}handleStatusMessage(e){if("UNPUBLISHED"===e.status)this.handleUnpublished()}async handleUpdateMessage(e){try{let t=await this.createOffer();this.peerConnection&&await this.peerConnection.setLocalDescription(t),this.handleAnswer(e.sdp)}catch(e){this.handleRTCError(e)}}async handleLogin(){try{let e={iceServers:[{urls:Cl}]};this.peerConnection=new RTCPeerConnection(e),this.peerConnection.ontrack=this.onPeerConnectionStream.bind(this),this.peerConnection.onicecandidate=this.onPeerConnectionIceCandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this.onPeerConnectionIceConnectionStateChange.bind(this);let t=await this.createOffer();await this.peerConnection.setLocalDescription(t),this.send({type:this.signalingType,inviteType:"OFFER",streamKey:this.streamKey,sdp:t.sdp,callSupport:!1})}catch(e){this.handleRTCError(e)}}async handleAnswer(e){try{this.peerConnection&&await this.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}catch(e){this.handleRTCError(e)}}async handleCandidate(e){if(e)try{this.peerConnection&&await this.peerConnection.addIceCandidate(e)}catch(e){this.handleRTCError(e)}}handleUnpublished(){try{this.closeConnections(),this.externalStopCallback()}catch(e){this.handleRTCError(e)}}handleSystemError(e){this.options.errorChanel&&this.options.errorChanel.next({id:"webrtc-provider-error",category:l.ErrorCategory.WTF,message:e.message})}async onPeerConnectionStream(e){let t=e.streams[0];this.stream&&this.stream.id===t.id||(this.stream=t,this.externalStartCallback(this.stream))}onPeerConnectionIceCandidate(e){e.candidate&&this.send({type:this.signalingType,inviteType:"CANDIDATE",candidate:e.candidate})}onPeerConnectionIceConnectionStateChange(){if(this.peerConnection){let e=this.peerConnection.iceConnectionState;["failed","closed"].indexOf(e)>-1&&(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():(this.closeConnections(),this.scheduleRetry()))}}async createOffer(){if(!this.peerConnection)throw new Error("Can not create offer - no peer connection instance ");let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}),t=e.sdp||"";if(!/^a=rtpmap:\d+ H264\/\d+$/m.test(t))throw new Error("No h264 codec support error");return e}handleRTCError(e){try{this.externalErrorCallback(e||new Error("RTC connection error"))}catch(e){this.handleSystemError(e)}}handleNetworkError(){try{this.externalErrorCallback(new Error("Network error"))}catch(e){this.handleSystemError(e)}}send(e){this.ws&&this.ws.send(JSON.stringify(e))}parseMessage(e){try{return JSON.parse(e)}catch{throw new Error("Can not parse socket message")}}closeConnections(){let e=this.ws;e&&(this.ws=null,e.close(1e3)),this.removePeerConnection()}removePeerConnection(){let e=this.peerConnection;e&&(this.peerConnection=null,e.close(),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e=null)}scheduleRetry(){this.retryTimeout=setTimeout(this.connectWS.bind(this),1e3)}normalizeOptions(e={}){let t={stunServerList:Cl,maxRetryNumber:3,errorChanel:null};return e.stunServerList&&(t.stunServerList=e.stunServerList),e.maxRetryNumber&&e.maxRetryNumber>0&&(t.maxRetryNumber=e.maxRetryNumber),t}constructor(e,t){this.ws=null,this.peerConnection=null,this.serverUrl="",this.streamKey="",this.stream=null,this.signalingType="JOIN",this.retryCount=0,this.externalStartCallback=El,this.externalStopCallback=El,this.externalErrorCallback=El,this.options=this.normalizeOptions(t);let i=e.split("/");this.serverUrl=i.slice(0,i.length-1).join("/"),this.streamKey=i[i.length-1]}},Ll=class{destroy(){this.subscription.unsubscribe(),this.liveStreamClient.disconnect(),this.params.output.element$.next(void 0),zr(this.video)}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"WebRTCLiveProvider",category:l.ErrorCategory.WTF,message:"WebRTCLiveProvider internal logic error",thrown:t})};this.subscription.add((0,l.merge)(this.videoState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})})));let r=es(this.video);this.subscription.add((()=>r.destroy()));let s=(e,t)=>this.subscription.add(e.subscribe(t,i));s(r.timeUpdate$,e.liveTime$),s(r.ended$,e.endedEvent$),s(r.looped$,e.loopedEvent$),s(r.error$,e.error$),s(r.isBuffering$,e.isBuffering$),s(r.currentBuffer$,e.currentBuffer$),s(r.currentBuffer$,e.currentNativeBuffer$),s(Zs(this.video),this.params.output.elementVisible$),this.subscription.add(r.durationChange$.subscribe((t=>{e.duration$.next(t===1/0?0:t)}))).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused")}),i)).add(r.playing$.subscribe((()=>{this.videoState.setState("playing")}),i)).add(r.error$.subscribe(e.error$)).add(this.maxSeekBackTime$.subscribe(this.params.output.duration$)).add(Wr(this.video,t.volume,r.volumeState$,i)).add(r.volumeState$.subscribe(e.volume$,i)).add(this.videoState.stateChangeEnded$.subscribe((i=>{switch(i.to){case"stopped":e.position$.next(0),e.duration$.next(0),t.playbackState.setState("stopped");break;case"ready":break;case"paused":t.playbackState.setState("paused");break;case"playing":t.playbackState.setState("playing");break;default:return(0,l.assertNever)(i.to)}}),i)).add((0,l.merge)(t.playbackState.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0)).subscribe(this.syncPlayback.bind(this),i)),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(t.autoVideoTrackSwitching.stateChangeStarted$.subscribe((()=>t.autoVideoTrackSwitching.setState(!1)),i))}onLiveStreamStart(e){this.params.output.element$.next(this.video),this.params.output.duration$.next(0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(Ls(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.currentVideoTrack$.next({id:"webrtc",quality:l.VideoQuality.INVARIANT}),this.video.srcObject=e,lr(this.params.desiredState.playbackState,"playing")}onLiveStreamStop(){this.videoState.startTransitionTo("stopped"),this.syncPlayback(),this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.params.output.endedEvent$.next()}onLiveStreamError(e){this.onLiveStreamStop(),this.params.output.error$.next({id:"WebRTC stream runtime error",category:l.ErrorCategory.EXTERNAL_API,message:e.message,thrown:e})}playIfAllowed(){Rs(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}prepare(){this.liveStreamClient.connect()}constructor(e){this.videoState=new Nr("stopped"),this.maxSeekBackTime$=new l.ValueSubject(0),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.pause(),this.video.srcObject=null,this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.currentNativeBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),lr(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.videoTrack.getTransition();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r)this.prepare();else switch(e){case"ready":return void("paused"===t?(this.videoState.setState("paused"),lr(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&lr(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&lr(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}},this.subscription=new l.Subscription,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("WebRTCLiveProvider"),this.video=jr(e.container,e.tuning),this.liveStreamClient=new Al(this.params.source.url,{maxRetryNumber:this.params.tuning.webrtc.connectionRetryMaxNumber,errorChanel:this.params.output.error$}),this.liveStreamClient.onStart(this.onLiveStreamStart.bind(this)),this.liveStreamClient.onStop(this.onLiveStreamStop.bind(this)),this.liveStreamClient.onError(this.onLiveStreamError.bind(this)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.subscribe()}},Pl=class{next(){this.current=this.iterator.next(),this.index=void 0===this.index?0:this.index+1}getValue(){if(this.current.done)throw new Error("Iterable is completed");return this.current.value}isCompleted(){return!!this.current.done}isLast(){return this.index===this.length-1}constructor(e){this.length=e.length,this.iterator=e[Symbol.iterator](),this.next()}};var Ml=(r=class e{subscribe(e){Tr.browser.isSafari&&"MPEG"!==e||this.subscriptions.add((0,l.combine)({video:this.providerOutput.element$,playbackState:this.providerOutput.playbackState$,volume:this.providerOutput.volume$}).pipe((0,l.filter)((({playbackState:e,video:t,volume:{muted:i,volume:r}})=>"playing"===e&&!!t&&!i&&!!r)),(0,l.once)()).subscribe((({video:e})=>{this.initAudioContextOnce(e).then((e=>{e||this.destroy()})).catch((e=>{this.handleError(e),this.destroy()}))})))}static isSupported(){return"AudioContext"in window&&"GainNode"in window&&"MediaElementAudioSourceNode"in window}async initAudioContextOnce(e){let{volumeMultiplier:t}=this,i=new(window.AudioContext||window.webkitAudioContext);this.audioContext=i;let r=i.createGain();if(this.gainNode=r,r.gain.value=t,r.connect(i.destination),"suspended"===i.state&&(await i.resume(),this.destroyController.signal.aborted))return!1;let s=i.createMediaElementSource(e);return this.mediaElementSource=s,s.connect(r),!0}cleanup(){this.mediaElementSource&&(this.mediaElementSource.disconnect(),this.mediaElementSource=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.audioContext&&("closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null)}destroy(){this.destroyController.abort(),this.subscriptions.unsubscribe(),this.cleanup()}handleError(t){this.volumeMultiplierError$.next({id:e.errorId,category:l.ErrorCategory.VIDEO_PIPELINE,message:t?.message??`${e.errorId} exception`,thrown:t})}constructor(e,t,i,r){this.providerOutput=e,this.provider$=t,this.volumeMultiplierError$=i,this.volumeMultiplier=r,this.destroyController=new Ma,this.subscriptions=new l.Subscription,this.audioContext=null,this.gainNode=null,this.mediaElementSource=null,this.subscriptions.add(this.provider$.pipe((0,l.filter)((e=>!!e.type)),(0,l.once)()).subscribe((({type:e})=>this.subscribe(e))))}},r.errorId="VolumeMultiplierManager",r),Il={chunkDuration:5e3,maxParallelRequests:5},Rl=class{init(){Qs.reset(),this.subscription.add(this.initProviderErrorHandling()).add(this.params.dependencies.chromecastInitializer.connection$.subscribe((()=>{this.reinitProvider()}))).add(this.providerOutput.availableVideoCodecs$.subscribe((e=>{!this.videoCodecsIterator&&e.length>1&&(this.videoCodecsIterator=new Pl(e))})))}destroy(){this.destroyProvider(),this.current$.next({type:void 0}),this.subscription.unsubscribe(),this.volumeMultiplierManager?.destroy(),this.volumeMultiplierManager=null,this.tracer.end()}initProvider(){let e,t=this.chooseDestination(),i=this.chooseFormat(t);if((0,l.isNullable)(i))this.handleNoFormatsError(t);else{try{e=this.createProvider(t,i)}catch(e){this.providerError$.next({id:"ProviderNotConstructed",category:l.ErrorCategory.WTF,message:"Failed to create provider",thrown:e})}e?this.current$.next({type:i,provider:e,destination:t}):this.current$.next({type:void 0})}}reinitProvider(){this.tracer.log("reinitProvider"),this.destroyProvider(),this.initProvider()}switchToNextProvider(e){this.tracer.log("switchToNextProvider",{destination:e}),this.destroyProvider(),this.failoverIndex=void 0,this.skipFormat(e),this.initProvider()}switchToNextVideoCodec(){this.params.tuning.dash.codecsPrioritizeEnabled&&!this.videoCodecsIterator.isLast()&&(this.tracer.log("switchToNextVideoCodec"),this.destroyProvider(),this.videoCodecsIterator.next(),this.initProvider())}destroyProvider(){let e=this.current$.getValue().provider;if(!e)return;this.log({message:"destroyProvider"}),this.tracer.log("destroyProvider"),e.destroy();let t=1e3*this.providerOutput.position$.getValue(),i=this.params.desiredState.seekState.getState(),r="none"!==i.state;if(this.params.desiredState.seekState.setState({state:"requested",position:r?i.position:t,forcePrecise:!!r&&i.forcePrecise}),e.scene3D){let t=e.scene3D.getCameraRotation();this.params.desiredState.cameraOrientation.setState({x:t.x,y:t.y})}let s=this.providerOutput.isBuffering$;s.getValue()||s.next(!0)}createProvider(e,t){switch(this.log({message:`createProvider: ${e}:${t}`}),this.tracer.log("createProvider",{destination:e,format:t}),e){case"SCREEN":return this.createScreenProvider(t);case"CHROMECAST":return this.createChromecastProvider(t);default:return(0,l.assertNever)(e)}}createScreenProvider(e){let{sources:t,container:i,desiredState:r,panelSize:s}=this.params,a=this.providerOutput,n={container:i,source:null,desiredState:r,output:a,dependencies:this.params.dependencies,tuning:this.params.tuning,panelSize:s};switch(e){case"DASH_SEP":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_ONDEMAND":case"DASH_STREAMS":{let i=this.applyFailoverHost(t[e]),r=this.applyFailoverHost(t.HLS_ONDEMAND||t.HLS);return(0,l.assertNonNullable)(i),this.params.tuning.useNewDashProvider?new cl({...n,source:i,sourceHls:r,forceVideoCodec:this.videoCodecsIterator?.getValue()}):this.params.tuning.useDashProviderVirtual&&!Tr.device.isMobile||this.params.tuning.useDashProviderVirtualMobile&&Tr.device.isMobile?new lo({...n,source:i,sourceHls:r,forceVideoCodec:this.videoCodecsIterator?.getValue()}):new Vo({...n,source:i,sourceHls:r,forceVideoCodec:this.videoCodecsIterator?.getValue()})}case"DASH_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),this.params.tuning.useNewDashProvider?new hl({...n,source:i}):new No({...n,source:i})}case"HLS":case"HLS_ONDEMAND":case"HLS_FMP4":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new $l({...n,source:i})}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new wl({...n,source:i,config:{maxPausedTime:this.params.tuning.live.maxPausedTime},format:e})}case"MPEG":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new _l({...n,source:i})}case"DASH_LIVE":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new ia({...n,source:i,config:{...Il,maxPausedTime:this.params.tuning.live.maxPausedTime}})}case"WEB_RTC_LIVE":{let s=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(s),new Ll({container:i,source:s,desiredState:r,output:a,dependencies:this.params.dependencies,tuning:this.params.tuning})}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,l.assertNever)(e)}}createChromecastProvider(e){let{sources:t,container:i,desiredState:r,meta:s}=this.params,a={meta:s,container:i,source:t,format:e,desiredState:r,output:this.providerOutput,dependencies:this.params.dependencies,tuning:this.params.tuning};if(this.params.tuning.chromecastPresentationApi&&this.params.dependencies.chromecastInitializer instanceof Pr){let{chromecastConnector:e}=this.params.dependencies.chromecastInitializer;return(0,l.assertNonNullable)(e),new Ar({...a,chromecastConnector:e})}let n=this.params.dependencies.chromecastInitializer.connection$.getValue();return(0,l.assertNonNullable)(n),new Br({...a,connection:n})}chooseDestination(){return this.params.dependencies.chromecastInitializer.connection$.getValue()?"CHROMECAST":"SCREEN"}chooseFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.isCompleted()?void 0:this.screenFormatsIterator.getValue();case"CHROMECAST":return this.chromecastFormatsIterator.isCompleted()?void 0:this.chromecastFormatsIterator.getValue();default:return(0,l.assertNever)(e)}}skipFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.next();case"CHROMECAST":return this.chromecastFormatsIterator.next();default:return(0,l.assertNever)(e)}}handleNoFormatsError(e){switch(e){case"SCREEN":return this.noAvailableProvidersError$.next(this.params.tuning.forceFormat),void this.current$.next({type:void 0});case"CHROMECAST":return void this.params.dependencies.chromecastInitializer.disconnect();default:return(0,l.assertNever)(e)}}applyFailoverHost(e){if(void 0===this.failoverIndex)return e;let t=this.params.failoverHosts[this.failoverIndex];if(!t)return e;let i=e=>{let i=new URL(e);return i.host=t,i.toString()};if(void 0===e)return e;if("type"in e){if("raw"===e.type)return e;if("url"===e.type)return{...e,url:i(e.url)}}return(0,Rr.default)((0,Ir.default)(e).map((([e,t])=>[e,i(t)])))}initProviderErrorHandling(){let e=new l.Subscription,t=!1,i=0;e.add((0,l.merge)(this.providerOutput.error$.pipe((0,l.filter)((e=>!this.params.tuning.ignoreAudioRendererError||!e.message||!/AUDIO_RENDERER_ERROR/gi.test(e.message)))),(e=>new l.Observable((t=>{let i=new l.Subscription,r=e.desiredPlaybackState$.stateChangeStarted$.pipe((0,l.map)((({from:e,to:t})=>`${e}-${t}`))),s=e.desiredPlaybackState$.stateChangeEnded$,a=e.providerChanged$.pipe((0,l.map)((({type:e})=>void 0!==e))),n=new l.Subject,o=0,u="unknown";return i.add(r.subscribe((t=>{o&&window.clearTimeout(o),u=t,o=window.setTimeout((()=>n.next(t)),e.maxTransitionInterval),Qs({m:"hangup.set",l:t,id:o})}))),i.add(s.subscribe((()=>{Qs({m:"hangup.cl",id:o}),window.clearTimeout(o),u="unknown",o=0}))),i.add(a.subscribe((t=>{o&&(Qs({m:"hangup.rs.0",id:o}),window.clearTimeout(o),o=0,t&&(o=window.setTimeout((()=>n.next(u)),e.maxTransitionInterval),Qs({m:"hangup.rs.1",id:o})))}))),i.add(n.subscribe(t)),()=>{window.clearTimeout(o),i.unsubscribe()}})))({desiredPlaybackState$:this.params.desiredState.playbackState,maxTransitionInterval:this.params.tuning.maxPlaybackTransitionInterval,position$:this.providerOutput.position$,providerChanged$:this.current$}).pipe((0,l.map)((e=>({id:`ProviderHangup:${e}`,category:l.ErrorCategory.WTF,message:`A ${e} transition failed to complete within reasonable time`}))))).subscribe(this.providerError$)),e.add(this.providerOutput.fetcherError$.subscribe(this.providerError$)),e.add(this.current$.subscribe((()=>{t=!1;let i=this.params.desiredState.playbackState.transitionEnded$.pipe((0,l.filter)((({to:e})=>"playing"===e)),(0,l.once)()).subscribe((()=>t=!0));e.add(i)})));let r=()=>{let e=Qs.drain(),{logDashLiveDebug:t,sendDashLiveDebug:i}=this.params.tuning;if(t&&window.console.log("===== DASH_LIVE DEBUG START ====\n",e.map((({time:e,data:t,stack:i})=>`${e}: ${JSON.stringify(t)}${i?"\n"+i:""}`)).join("\n"),"\n===== DASH_LIVE DEBUG END ===="),i){let t=e.reduce(((e,{time:t,data:i,stack:r})=>e+=`${t}: ${(0,Ir.default)(i).map((([e,t])=>`${e}:${t}`)).join(",")}${r?`: ${r}`:""};`),"");l.devNull.push("core",{key:"vp_dash_live_debug",strings:[t]})}};return e.add(this.providerError$.subscribe((e=>{e.id.startsWith("ProviderHangup")&&(Qs({m:"final.0",e:e.id}),r())}))).add(this.noAvailableProvidersError$.subscribe((()=>{Qs({m:"final.1"}),r()}))),e.add(this.providerError$.subscribe((e=>{let r=this.current$.getValue().destination,s={error:e,currentDestination:r};if("CHROMECAST"===r)this.destroyProvider(),this.params.dependencies.chromecastInitializer.stopMedia().then((()=>this.switchToNextProvider("CHROMECAST")),(()=>this.params.dependencies.chromecastInitializer.disconnect()));else{let a=e.category===l.ErrorCategory.NETWORK,n=e.category===l.ErrorCategory.FATAL,o=this.params.failoverHosts.length>0&&(void 0===this.failoverIndex||this.failoverIndex<this.params.failoverHosts.length-1),u=i<this.params.tuning.providerErrorLimit&&!n,d=this.videoCodecsIterator&&!this.videoCodecsIterator.isLast()&&this.params.tuning.dash.codecsPrioritizeEnabled,c=o&&!n&&(a&&t||!u);s={...s,isNetworkError:a,isFatalError:n,haveFailoverHost:o,tryFailover:c,canReinitProvider:u},u?(i++,this.reinitProvider()):c?(this.failoverIndex=void 0===this.failoverIndex?0:this.failoverIndex+1,this.reinitProvider()):d?this.switchToNextVideoCodec():(i=0,this.switchToNextProvider(r??"SCREEN"))}e.traceAsLog?this.tracer.log("providerInfo",(0,l.flattenObject)(s)):this.tracer.error("providerError",(0,l.flattenObject)(s))}))),e}constructor(e){this.current$=new l.ValueSubject({type:void 0}),this.providerError$=new l.Subject,this.noAvailableProvidersError$=new l.Subject,this.volumeMultiplierError$=new l.Subject,this.providerOutput={position$:new l.ValueSubject(0),duration$:new l.ValueSubject(1/0),volume$:new l.ValueSubject({muted:!1,volume:1}),availableVideoStreams$:new l.ValueSubject([]),currentVideoStream$:new l.ValueSubject(void 0),availableVideoTracks$:new l.ValueSubject([]),currentVideoTrack$:new l.ValueSubject(void 0),availableVideoCodecs$:new l.ValueSubject([]),availableAudioStreams$:new l.ValueSubject([]),currentAudioStream$:new l.ValueSubject(void 0),availableAudioTracks$:new l.ValueSubject([]),availableAudioCodecs$:new l.ValueSubject([]),currentVideoSegmentLength$:new l.ValueSubject(0),currentAudioSegmentLength$:new l.ValueSubject(0),isAudioAvailable$:new l.ValueSubject(!0),autoVideoTrackLimitingAvailable$:new l.ValueSubject(!1),autoVideoTrackLimits$:new l.ValueSubject(void 0),currentBuffer$:new l.ValueSubject(void 0),currentNativeBuffer$:new l.ValueSubject(void 0),isBuffering$:new l.ValueSubject(!0),error$:new l.Subject,fetcherError$:new l.Subject,fetcherRecoverableError$:new l.Subject,warning$:new l.Subject,willSeekEvent$:new l.Subject,soundProhibitedEvent$:new l.Subject,seekedEvent$:new l.Subject,loopedEvent$:new l.Subject,endedEvent$:new l.Subject,manifestRequested$:new l.Subject,firstBytesManifest$:new l.Subject,manifestReceived$:new l.Subject,firstBytesRequested$:new l.Subject,firstBytesReceived$:new l.Subject,firstBytesEvent$:new l.Subject,loadedMetadataEvent$:new l.Subject,firstFrameEvent$:new l.Subject,canplay$:new l.Subject,isLive$:new l.ValueSubject(void 0),isLiveEnded$:new l.ValueSubject(null),canPlayLiveTailBuffer$:new l.ValueSubject(!1),isLowLatency$:new l.ValueSubject(!1),canChangePlaybackSpeed$:new l.ValueSubject(!0),liveTime$:new l.ValueSubject(void 0),liveBufferTime$:new l.ValueSubject(void 0),liveLatency$:new l.ValueSubject(void 0),severeStallOccurred$:new l.Subject,availableTextTracks$:new l.ValueSubject([]),currentTextTrack$:new l.ValueSubject(void 0),hostname$:new l.ValueSubject(void 0),httpConnectionType$:new l.ValueSubject(void 0),httpConnectionReused$:new l.ValueSubject(void 0),inPiP$:new l.ValueSubject(!1),inFullscreen$:new l.ValueSubject(!1),element$:new l.ValueSubject(void 0),elementVisible$:new l.ValueSubject(!0),availableSources$:new l.ValueSubject(void 0),is3DVideo$:new l.ValueSubject(!1),playbackState$:new l.ValueSubject(""),getCurrentTime$:new l.ValueSubject(null)},this.subscription=new l.Subscription,this.volumeMultiplierManager=null,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ProviderContainer"),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name);let t=_r([...an(this.params.tuning),...sn(this.params.tuning)]).filter((t=>(0,l.isNonNullable)(e.sources[t]))),{forceFormat:i,formatsToAvoid:r}=this.params.tuning,s=[];s=i?[i]:r.length?[...t.filter((e=>!(0,Mr.default)(r,e))),...t.filter((e=>(0,Mr.default)(r,e)))]:t,this.log({message:`Selected formats: ${s.join(" > ")}`}),this.tracer.log("Selected formats",(0,l.flattenObject)(s)),this.screenFormatsIterator=new Pl(s);let a=[...nn(!0),...nn(!1)];this.chromecastFormatsIterator=new Pl(a.filter((t=>(0,l.isNonNullable)(e.sources[t])))),this.providerOutput.availableSources$.next(e.sources);let{volumeMultiplier:n=1,tuning:{useVolumeMultiplier:o}}=this.params;o&&1!==n&&Ml.isSupported()&&(this.volumeMultiplierManager=new Ml(this.providerOutput,this.current$,this.volumeMultiplierError$,n))}},Vl="one_video_throughput",Nl="one_video_rtt",Bl=window.navigator.connection,Dl=()=>{let e=Bl?.downlink;if((0,l.isNonNullable)(e)&&10!==e)return 1e3*e},Ol=()=>{let e=Bl?.rtt;if((0,l.isNonNullable)(e)&&3e3!==e)return e},Fl=(e,t,i)=>{let r=8*i;return r/(r/e+t)},jl=class e{destroy(){this.concurrentDownloads.clear(),this.subscription.unsubscribe()}trackXHR(e){let t=0,i=(0,l.now)(),r=new l.Subscription;switch(this.subscription.add(r),this.concurrentDownloads.add(e),e.readyState){case 4:break;case 3:case 2:r.add((0,l.fromEvent)(e,"progress").pipe((0,l.once)()).subscribe((e=>{t=e.loaded,i=(0,l.now)()})));break;case 1:case 0:r.add((0,l.fromEvent)(e,"loadstart").subscribe((()=>{t=0,i=(0,l.now)()})))}r.add((0,l.fromEvent)(e,"loadend").subscribe((s=>{if(200===e.status){let e=s.loaded,r=(0,l.now)(),a=e-t,n=r-i;this.addRawSpeed(a,n,1)}this.concurrentDownloads.delete(e),r.unsubscribe()})))}trackStream(e,t=!1){let i=e.getReader();if(!i)return void e.cancel("Could not get reader");let r=0,s=(0,l.now)(),a=0,n=(0,l.now)(),o=t=>{this.concurrentDownloads.delete(e),i.releaseLock(),e.cancel(`Throughput Estimator error: ${t}`).catch((()=>{}))},u=async({done:d,value:c})=>{if(d)!t&&this.addRawSpeed(r,(0,l.now)()-s,1),this.concurrentDownloads.delete(e);else if(c){if(t){let e=(0,l.now)();if(e-n>this.tuningConfig.lowLatency.continuesByteSequenceInterval||e-s>this.tuningConfig.lowLatency.maxLastEvaluationTimeout){let e=n-s;e&&this.addRawSpeed(a,e,1,t),a=c.byteLength,s=(0,l.now)()}else a+=c.byteLength;n=(0,l.now)()}else r+=c.byteLength,a+=c.byteLength,a>=this.tuningConfig.streamMinSampleSize&&(0,l.now)()-n>=this.tuningConfig.streamMinSampleTime&&(this.addRawSpeed(a,(0,l.now)()-n,this.concurrentDownloads.size),a=0,n=(0,l.now)());await(i?.read().then(u,o))}};this.concurrentDownloads.add(e),i?.read().then(u,o)}addRawSpeed(t,i,r=1,s=!1){if(e.sanityCheck(t,i,s)){let e=8*t/i;this.throughput.next(e*r)}}addRawThroughput(e){this.throughput.next(e)}addRawRtt(e){this.rtt.next(e)}static sanityCheck(e,t,i=!1){let r=8*e/t;return!(!r||!isFinite(r)||r>1e6||r<30||i&&e<1e4||!i&&e<10240||!i&&t<=20)}static load(e){let t=l.safeStorage.get(e);if((0,l.isNonNullable)(t))return parseInt(t,10)??void 0}constructor(t){this.subscription=new l.Subscription,this.concurrentDownloads=new Set,this.tuningConfig=t;let i=e.load(Vl)||(t.useBrowserEstimation?Dl():void 0)||5e3,r=e.load(Nl)??(t.useBrowserEstimation?Ol():void 0)??0;if(this.throughput$=new l.ValueSubject(i),this.rtt$=new l.ValueSubject(r),this.rttAdjustedThroughput$=new l.ValueSubject(Fl(i,r,t.rttPenaltyRequestSize)),this.throughput=Co.getSmoothedValue(i,-1,t),this.rtt=Co.getSmoothedValue(r,1,t),t.useBrowserEstimation){let e=()=>{let e=Dl();e&&this.throughput.next(e);let t=Ol();(0,l.isNonNullable)(t)&&this.rtt.next(t)};Bl&&"onchange"in Bl&&this.subscription.add((0,l.fromEvent)(Bl,"change").subscribe(e)),e()}this.subscription.add(this.throughput.smoothed$.subscribe((e=>{l.safeStorage.set(Vl,e.toFixed(0))}))),this.subscription.add(this.rtt.smoothed$.subscribe((e=>{l.safeStorage.set(Nl,e.toFixed(0))}))),this.subscription.add(this.throughput.debounced$.pipe((0,l.map)((e=>Math.round(e)))).subscribe(this.throughput$)),this.subscription.add(this.rtt.debounced$.subscribe(this.rtt$)),this.subscription.add((0,l.combine)({throughput:this.throughput.smoothed$,rtt:this.rtt.smoothed$}).pipe((0,l.map)((({throughput:e,rtt:i})=>Fl(e,i,t.rttPenaltyRequestSize))),(0,l.filter)((e=>{let i=this.rttAdjustedThroughput$.getValue()||0;return Math.abs(e-i)/i>=t.changeThreshold}))).subscribe(this.rttAdjustedThroughput$))}},zl={configName:["core"],throughputEstimator:{type:"EmaAndMa",emaAlphaSlow:.2,emaAlphaFast:.7,emaAlpha:.45,basisTrendChangeCount:10,changeThreshold:.05,useBrowserEstimation:!0,rttPenaltyRequestSize:1048576,streamMinSampleSize:10240,streamMinSampleTime:300,deviationDepth:20,deviationFactor:.5,lowLatency:{continuesByteSequenceInterval:50,maxLastEvaluationTimeout:300}},autoTrackSelection:{maxBitrateFactorAtEmptyBuffer:4,bitrateFactorAtEmptyBuffer:2.8,minBitrateFactorAtEmptyBuffer:1.5,bitrateAudioFactorAtEmptyBuffer:10,maxBitrateFactorAtFullBuffer:3,bitrateFactorAtFullBuffer:2,minBitrateFactorAtFullBuffer:1,bitrateAudioFactorAtFullBuffer:7,minVideoAudioRatio:5,minAvailableThroughputAudioRatio:5,usePixelRatio:!0,pixelRatioMultiplier:void 0,pixelRatioLogBase:3,pixelRatioLogCoefficients:[1,0,1],limitByContainer:!0,maxContainerSizeFactor:2,containerSizeFactor:1.3,minContainerSizeFactor:1,lazyQualitySwitch:!0,minBufferToSwitchUp:.4,considerPlaybackRate:!1,trackCooldownIncreaseQuality:15e3,trackCooldownDecreaseQuality:3e3,backgroundVideoQualityLimit:l.VideoQuality.Q_4320P,activeVideoAreaThreshold:.1,highQualityLimit:l.VideoQuality.Q_720P,trafficSavingLimit:l.VideoQuality.Q_480P},stallsManager:{enabled:!1,ignoreDynamicAbrForShortVideo:!1,stallDurationNoDataBeforeQualityDecrease:500,stallDurationToBeCount:100,stallCountBeforeQualityDecrease:3,resetQualityRestrictionTimeout:1e4,ignoreStallsOnSeek:!0,stallsMetricsHistoryLength:20,maxPossibleStallDuration:3e4,minTvtToBeCounted:120,maxTvtToBeCounted:10800,significantTvt:600,targetStallsDurationPerTvt:1,deviationStallsDurationPerTvt:.5,criticalStallsDurationPerTvt:6,abrAdjustingSpeed:.1,emaAlpha:.6,useTotalStallsDurationPerTvt:!0,useAverageStallsDurationPerTvt:!0,useEmaStallsDurationPerTvt:!0},droppedFramesChecker:{enabled:!1,percentLimit:.1,checkTime:1e3,countLimit:3,tickCountAfterQualityChange:5,qualityUpWaitingTime:5e3,minQualityBanLimit:l.VideoQuality.Q_480P},dash:{forwardBufferTarget:6e4,forwardBufferTargetAuto:6e4,forwardBufferTargetManual:3e5,forwardBufferTargetPreload:5e3,seekBiasInTheEnd:2e3,maxSegmentDurationLeftToSelectNextSegment:3e3,minSafeBufferThreshold:.5,bufferPruningSafeZone:1e3,segmentRequestSize:1048576,maxVirtualBufferSize:262144e3,virtualBufferPruneSize:104857600,representationSwitchForwardBufferGap:15e3,crashOnStallTimeout:25e3,crashOnStallTWithoutDataTimeout:5e3,enableSubSegmentBufferFeeding:!0,bufferEmptinessTolerance:100,useNewRepresentationSwitch:!1,useDelayedRepresentationSwitch:!1,useSmartRepresentationSwitch:!1,useFetchPriorityHints:!0,useAbortMSEFix:!1,enableBaseUrlSupport:!0,maxSegmentRetryCount:5,sourceOpenTimeout:1e3,vktvAbrThrottle:0,timeupdateEventTickThrottle:300,fetcherBufferOptimisation:!0,codecsPrioritizeEnabled:!1,usePersistentGaps:!1,abrThrottle:0,useVideoElementWaitingCurrentTimeReassign:!0,stallWatchdogInterval:100,liveUpdateInterval:1e3,liveStallReinitInterval:3e3,ignoreNetworkErrorsOnLoadInit:!1,bufferTolerance:100,actionTimeShiftFromSegment:500},dashCmafLive:{externalStopControl:!1,keepSilentStallWatchdogWhenNotActive:!1,maxActiveLiveOffset:1e4,normalizedTargetMinBufferSize:6e4,normalizedLiveMinBufferSize:5e3,normalizedActualBufferOffset:1e4,offsetCalculationError:3e3,maxLiveDuration:7200,catchupLiveForMutedInactiveTab:!0,lowLatency:{maxTargetOffset:3e3,maxTargetOffsetDeviation:250,playbackCatchupSpeedup:.05,isActiveOnDefault:!1,bufferEstimator:{emaAlpha:.45,changeThreshold:.05,deviationDepth:20,deviationFactor:.5,extremumInterval:5}}},live:{minBuffer:3e3,minBufferSegments:3,lowLatencyMinBuffer:1e3,lowLatencyMinBufferSegments:1,isLiveCatchUpMode:!1,lowLatencyActiveLiveDelay:3e3,activeLiveDelay:5e3,maxPausedTime:5e3},downloadBackoff:{bufferThreshold:100,start:100,factor:2,max:3e3,random:.1},enableWakeLock:!0,enableTelemetryAtStart:!1,forceFormat:void 0,formatsToAvoid:[],disableChromecast:!1,chromecastReceiverId:"07A4434E",chromecastPresentationApi:!1,useWebmBigRequest:!1,webmCodec:"vp9",androidPreferredFormat:"dash",iosPreferredFormat:"hls",preferCMAF:!1,preferWebRTC:!1,preferMultiStream:!1,preferHDR:!1,bigRequestMinInitSize:51200,bigRequestMinDataSize:1048576,stripRangeHeader:!0,flushShortLoopedBuffers:!0,insufficientBufferRuleMargin:1e4,seekNearDurationBias:1,dashSeekInSegmentDurationThreshold:18e4,dashSeekInSegmentAlwaysSeekDelta:1e4,endGapTolerance:300,stallIgnoreThreshold:33,gapWatchdogInterval:50,requestQuick:!1,useHlsJs:!1,useNativeHLSTextTracks:!1,useNewSwitchTo:!1,useNewDashProvider:!1,useDashProviderVirtual:!1,useDashProviderVirtualMobile:!1,useNewAutoSelectVideoTrack:!1,useSafariEndlessRequestBugfix:!0,isAudioDisabled:!1,autoplayOnlyInActiveTab:!0,dynamicImportTimeout:5e3,maxPlaybackTransitionInterval:2e4,providerErrorLimit:3,manifestRetryInterval:300,manifestRetryMaxInterval:1e4,manifestRetryMaxCount:10,audioVideoSyncRate:20,webrtc:{connectionRetryMaxNumber:3},spherical:{enabled:!1,fov:{x:135,y:76},rotationSpeed:45,maxYawAngle:175,rotationSpeedCorrection:10,degreeToPixelCorrection:5,speedFadeTime:2e3,speedFadeThreshold:50},useVolumeMultiplier:!1,ignoreAudioRendererError:!1,useEnableSubtitlesParam:!1,useHlsLiveNewTextManager:!1,exposeInternalsToGlobal:!1,hlsLiveNewTextManagerDownloadThreshold:4e3,disableYandexPiP:!1,asyncResolveClientChecker:!1,autostartOnlyIfVisible:!1,changePlaybackStateToPausedWhenEnded:!1,suppressExceptionsInObservables:!0,devNullLogEnabled:!1,collectingDecodingInfoEnabled:!1,sendDashLiveDebug:!1,logDashLiveDebug:!1},ql=({seekState:e,position$:t})=>(0,l.merge)(e.stateChangeEnded$.pipe((0,l.map)((({to:e})=>"none"===e.state?void 0:(e.position??NaN)/1e3)),(0,l.filter)(l.isNonNullable)),t.pipe((0,l.filter)((()=>"none"===e.getState().state)))),Hl=g(Oe(),1),Ul=async e=>{if(!e)return Promise.resolve({supported:!1});let t={["channels"in e?"audio":"video"]:e};return await navigator.mediaCapabilities.decodingInfo({type:"media-source",...t})},Wl=e=>{if(!e)return Promise.resolve({supported:!1});let t="channels"in e?document.createElement("audio"):document.createElement("video");return Promise.resolve({supported:"probably"===t.canPlayType(e?.contentType??"")})},Ql={H264:{contentType:'video/mp4; codecs="avc1.4D400C"',width:720,height:720,bitrate:2886,framerate:30},H265:{contentType:'video/mp4; codecs="hvc1.1.6.L123.B0"',width:720,height:720,bitrate:2886,framerate:30},VP8:{contentType:'video/webm; codecs="vp8"',width:720,height:720,bitrate:2886,framerate:30},VP9:{contentType:'video/webm; codecs="vp09.00.10.08"',width:720,height:720,bitrate:2886,framerate:30},AV1:{contentType:'video/mp4; codecs="av01.0.01M.08"',width:720,height:720,bitrate:2886,framerate:30},OPUS:{contentType:'audio/ogg; codecs="opus"',channels:"2",bitrate:128e3},AAC_LC:{contentType:'audio/mp4; codecs="mp4a.40.2"',channels:"2",bitrate:128e3},AC3:{contentType:'audio/mp4; codecs="ac-3"',channels:"6",bitrate:128e3},EAC3:{contentType:'audio/mp4; codecs="ec-3"',channels:"6",bitrate:128e3},AAC_HE_V1:{contentType:'audio/mp4; codecs="mp4a.40.5"',channels:"2",bitrate:128e3},AAC_HE_V2:{contentType:'audio/mp4; codecs="mp4a.40.29"',channels:"2",bitrate:128e3},AAC_xHE:{contentType:'audio/mp4; codecs="mp4a.40.42"',channels:"2",bitrate:128e3}},Gl=class{initVideo(e){this.config=e,this.internalsExposure?.expose({config:e,logger:this.logger,tuning:this.tuning}),this.setMuted(this.tuning.isAudioDisabled);let t=()=>{let{container:t,...i}=e;this.tracer.log("initVideo",(0,l.flattenObject)(i)),this.domContainer=(e=>{let t="string"==typeof e.container?document.getElementById(e.container):e.container;return(0,l.assertNonNullable)(t,`Wrong container or containerId {${e.container}}`),t})(e),this.chromecastInitializer.contentId=e.meta?.videoId,this.providerContainer=new Rl({sources:e.sources,meta:e.meta??{},failoverHosts:e.failoverHosts??[],container:this.domContainer,desiredState:this.desiredState,dependencies:{throughputEstimator:this.throughputEstimator,chromecastInitializer:this.chromecastInitializer,tracer:this.tracer,logger:this.logger,abrLogger:this.abrLogger},tuning:this.tuning,volumeMultiplier:e.volumeMultiplier,panelSize:e.panelSize}),this.initProviderContainerSubscription(this.providerContainer),this.initStartingVideoTrack(this.providerContainer),this.initTracerSubscription(),this.providerContainer.init(),this.setLiveLowLatency(this.tuning.dashCmafLive.lowLatency.isActiveOnDefault),this.initDebugTelemetry(),this.initWakeLock(),this.playerInited.next(!0),this.devNullLog&&this.tuning.devNullLogEnabled?(l.devNull.subscribe("core",this.devNullLog),this.tuning.collectingDecodingInfoEnabled&&(this.collectDecodingInfoDestroyCb=(()=>{let e="mediaCapabilities"in navigator?Ul:Wl,t=gn((async()=>{let t=await Promise.all((0,Hl.default)(Ql).map((async([t,i])=>({codec:t,supported:await e(i)})))),i=[Tr.browser.current,...t.map((e=>JSON.stringify(e)))].slice(0,16);return l.devNull.push("core",{key:"videoplayer_decoding_info",strings:i}),t}));return()=>vn(t)})())):l.devNull.destroy("core")},i=()=>{this.tuning.autostartOnlyIfVisible&&window.requestAnimationFrame?this.playerInitRequest=window.requestAnimationFrame((()=>t())):t()},r=()=>{this.tuning.asyncResolveClientChecker?Tr.isInited$.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{console.log("Core SDK async start"),i()})):i()};return this.isNotActiveTabCase()?(this.tracer.log("request play from hidden tab"),(0,l.fromEvent)(document,"visibilitychange").pipe((0,l.once)()).subscribe(r)):r(),this}destroy(){this.tracer.log("destroy"),window.clearTimeout(this.hasLiveOffsetByPausedTimer),this.playerInitRequest&&window.cancelAnimationFrame(this.playerInitRequest),this.events.willDestruct$.next(),this.stop(),this.providerContainer?.destroy(),this.throughputEstimator.destroy(),this.chromecastInitializer.destroy(),this.subscription.unsubscribe(),this.tracer.end(),this.internalsExposure?.destroy(),l.devNull.destroy("core"),this.collectDecodingInfoDestroyCb?.()}waitInit(e){this.playerInited.getValue()?e():this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe(e))}prepare(){return this.waitInit((()=>{let e=this.desiredState.playbackState;this.tracer.log("prepare",{currentPlayBackState:e.getState()}),"stopped"===e.getState()&&e.startTransitionTo("ready")})),this}play(){return this.waitInit((()=>{let e=this.desiredState.playbackState;this.tracer.log("play",{currentPlayBackState:e.getState()}),"playing"!==e.getState()&&e.startTransitionTo("playing")})),this}pause(){return this.waitInit((()=>{let e=this.desiredState.playbackState;this.tracer.log("pause",{currentPlayBackState:e.getState()}),"paused"!==e.getState()&&e.startTransitionTo("paused")})),this}stop(){return this.waitInit((()=>{let e=this.desiredState.playbackState;this.tracer.log("stop",{currentPlayBackState:e.getState()}),"stopped"!==e.getState()&&e.startTransitionTo("stopped")})),this}seekTime(e,t=!0){return this.waitInit((()=>{let i=this.info.duration$.getValue(),r=this.info.isLive$.getValue(),s=e;e>=i&&!r&&(s=i-this.tuning.seekNearDurationBias),this.tracer.log("seekTime",{duration:i,isLive:r,time:e,calculatedTime:s,forcePrecise:t}),Number.isFinite(s)&&(this.events.willSeek$.next({from:this.getExactTime(),to:s}),this.desiredState.seekState.setState({state:"requested",position:1e3*s,forcePrecise:t}))})),this}seekPercent(e){return this.waitInit((()=>{let t=this.info.duration$.getValue();this.tracer.log("seekPercent",{percent:e,duration:t}),isFinite(t)&&this.seekTime(Math.abs(t)*e,!1)})),this}setVolume(e,t){return this.waitInit((()=>{let i=this.desiredState.volume,r=i.getTransition()?.to.muted??this.info.muted$.getValue(),s=t??(this.tuning.isAudioDisabled||r);this.tracer.log("setVolume",{volume:e,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue(),muted:s}),"CONNECTED"!==this.chromecastInitializer.castState$.getValue()||this.chromecastInitializer instanceof Pr?i.startTransitionTo({volume:e,muted:s}):this.chromecastInitializer.setVolume(e)})),this}setMuted(e,t=!1){return this.waitInit((()=>{let i=this.desiredState.volume,r=this.tuning.isAudioDisabled&&!t||e,s=i.getTransition()?.to.volume??this.info.volume$.getValue();this.tracer.log("setMuted",{isMuted:e,nextMuted:r,volume:s,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue()}),"CONNECTED"!==this.chromecastInitializer.castState$.getValue()||this.chromecastInitializer instanceof Pr?i.startTransitionTo({volume:s,muted:r}):this.chromecastInitializer.setMuted(r)})),this}setVideoStream(e){return this.waitInit((()=>{this.desiredState.videoStream.startTransitionTo(e)})),this}setAudioStream(e){return this.waitInit((()=>{this.desiredState.audioStream.startTransitionTo(e)})),this}setQuality(e){return this.waitInit((()=>{(0,l.assertNonNullable)(this.providerContainer);let t=this.providerContainer.providerOutput.availableVideoTracks$.getValue();this.tracer.log("setQuality",{isDelayed:0===t.length,quality:e}),void 0===this.desiredState.videoTrack.getState()&&void 0===this.desiredState.videoTrack.getPrevState()&&0===t.length?this.wasSetStartedQuality?this.providerContainer.providerOutput.availableVideoTracks$.pipe((0,l.filter)((e=>e.length>0)),(0,l.once)()).subscribe((t=>{this.setVideoTrackIdByQuality(t,e)})):this.explicitInitialQuality=e:t.length>0&&this.setVideoTrackIdByQuality(t,e)})),this}setAutoQuality(e){return this.waitInit((()=>{this.tracer.log("setAutoQuality",{enable:e}),this.desiredState.autoVideoTrackSwitching.startTransitionTo(e)})),this}setAutoQualityLimits(e){return this.waitInit((()=>{this.tracer.log("setAutoQualityLimits",(0,l.flattenObject)(e)),this.desiredState.autoVideoTrackLimits.startTransitionTo(e)})),this}setPredefinedQualityLimits(e){return this.waitInit((()=>{if(this.info.predefinedQualityLimitType$.getValue()===e)return this;let t,{highQualityLimit:i,trafficSavingLimit:r}=this.tuning.autoTrackSelection;switch(e){case"high_quality":t={min:i,max:void 0};break;case"traffic_saving":t={max:r,min:void 0};break;default:t={max:void 0,min:void 0}}this.setAutoQualityLimits(t)})),this}setPlaybackRate(e){return this.waitInit((()=>{this.tracer.log("setPlaybackRate",{playbackRate:e}),this.desiredState.playbackRate.startTransitionTo(e)})),this}setExternalTextTracks(e){return this.waitInit((()=>{e.length&&this.tracer.log("setExternalTextTracks",(0,l.flattenObject)(e)),this.desiredState.externalTextTracks.startTransitionTo(e.map((e=>({type:"external",...e}))))})),this}selectTextTrack(e){return this.waitInit((()=>{((e,t,i,r)=>{void 0!==e&&void 0===t.getState()&&void 0===t.getPrevState()&&0===i?.getValue().length?i.pipe((0,l.filter)((e=>e.length>0)),(0,l.once)()).subscribe((i=>{i.find(r)&&t.startTransitionTo(e)})):(void 0===e||i?.getValue().find(r))&&t.startTransitionTo(e)})(e,this.desiredState.currentTextTrack,this.providerContainer?.providerOutput.availableTextTracks$,(t=>t.id===e)),this.tracer.log("selectTextTrack",{textTrackId:e})})),this}setTextTrackCueSettings(e){return this.waitInit((()=>{this.tracer.log("setTextTrackCueSettings",{...e}),this.desiredState.textTrackCuesSettings.startTransitionTo(e)})),this}setLiveLowLatency(e){let t=this.info.isLive$.getValue(),i=this.desiredState.isLowLatency.getState();return t&&i!==e?(this.tracer.log("live switch to low latency "+e),this.desiredState.isLowLatency.setState(e),this.seekTime(0)):this}setLooped(e){return this.waitInit((()=>{this.tracer.log("setLooped",{isLooped:e}),this.desiredState.isLooped.startTransitionTo(e)})),this}toggleChromecast(){this.tracer.log("toggleChromecast"),this.chromecastInitializer.toggleConnection()}startCameraManualRotation(e,t){return this.waitInit((()=>{let i=this.getScene3D();this.tracer.log("startCameraManualRotation",{isScene3DAvailable:!!i,mx:e,my:t}),i&&i.startCameraManualRotation(e,t)})),this}stopCameraManualRotation(e=!1){return this.waitInit((()=>{let t=this.getScene3D();this.tracer.log("stopCameraManualRotation",{isScene3DAvailable:!!t,immediate:e}),t&&t.stopCameraManualRotation(e)})),this}moveCameraFocusPX(e,t){return this.waitInit((()=>{let i=this.getScene3D();if(this.tracer.log("moveCameraFocusPX",{isScene3DAvailable:!!i,dxpx:e,dypx:t}),i){let r=i.getCameraRotation(),s=i.pixelToDegree({x:e,y:t});this.desiredState.cameraOrientation.setState({x:r.x+s.x,y:r.y+s.y})}})),this}holdCamera(){return this.waitInit((()=>{let e=this.getScene3D();e&&e.holdCamera()})),this}releaseCamera(){return this.waitInit((()=>{let e=this.getScene3D();e&&e.releaseCamera()})),this}getExactTime(){if(!this.providerContainer)return 0;let e=this.providerContainer.providerOutput.element$.getValue();if((0,l.isNullable)(e))return this.info.position$.getValue();let t=this.desiredState.seekState.getState(),i="none"===t.state?void 0:t.position;return(0,l.isNonNullable)(i)?i/1e3:e.currentTime}getAllLogs(){return this.logger.getAllLogs()}getScene3D(){let e=this.providerContainer?.current$.getValue();if(e?.provider?.scene3D)return e.provider.scene3D}setIntrinsicVideoSize(...e){let t={width:e.reduce(((e,{width:t})=>e||t||0),0),height:e.reduce(((e,{height:t})=>e||t||0),0)};t.width&&t.height&&this.info.intrinsicVideoSize$.next({width:t.width,height:t.height})}initDesiredStateSubscriptions(){this.subscription.add((0,l.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,l.map)((e=>e.to))).subscribe(this.info.playbackState$)).add(this.desiredState.isLooped.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.info.isLooped$)).add(this.desiredState.playbackRate.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.info.currentPlaybackRate$)).add(this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.info.isAutoQualityEnabled$)).add(this.desiredState.autoVideoTrackLimits.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe((e=>{this.info.autoQualityLimits$.next(e);let{highQualityLimit:t,trafficSavingLimit:i}=this.tuning.autoTrackSelection;this.info.predefinedQualityLimitType$.next(function(e,t,i){return e.max||e.min!==t?e.min||e.max!==i?"unknown":"traffic_saving":"high_quality"}(e,t,i))}))),this.subscription.add(this.desiredState.playbackState.stateChangeStarted$.pipe((0,l.filter)((({from:e})=>"stopped"===e)),(0,l.once)()).subscribe((()=>{this.initedAt=(0,l.now)(),this.events.inited$.next()}))).add(this.desiredState.playbackState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"ready":this.events.ready$.next();break;case"playing":this.isPlaybackStarted||this.events.started$.next(),this.isPlaybackStarted=!0,this.events.playing$.next();break;case"paused":this.events.paused$.next();break;case"stopped":this.events.stopped$.next()}}))).add(this.desiredState.playbackState.stateChangeStarted$.subscribe((e=>{switch(e.to){case"ready":this.events.willReady$.next();break;case"paused":this.events.willPause$.next();break;case"playing":this.isPlaybackStarted?this.events.willResume$.next():this.events.willStart$.next();break;case"stopped":this.events.willStop$.next()}})))}initProviderContainerSubscription(e){this.subscription.add(e.providerOutput.willSeekEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("willSeekEvent",(0,l.flattenObject)(e)),"requested"===e.state?this.desiredState.seekState.setState({...e,state:"applying"}):this.events.managedError$.next({id:`WillSeekIn${e.state}`,category:l.ErrorCategory.WTF,message:"Received unexpeceted willSeek$"})}))).add(e.providerOutput.soundProhibitedEvent$.pipe((0,l.once)()).subscribe(this.events.autoplaySoundProhibited$)).add(e.providerOutput.severeStallOccurred$.subscribe(this.events.severeStallOccured$)).add(e.providerOutput.seekedEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("seekedEvent",(0,l.flattenObject)(e)),"applying"===e.state&&(this.desiredState.seekState.setState({state:"none"}),this.events.seeked$.next())}))).add(e.current$.pipe((0,l.map)((e=>e.type))).subscribe(this.info.currentFormat$)).add(e.current$.pipe((0,l.map)((e=>e.destination)),(0,l.filterChanged)()).subscribe((()=>this.isPlaybackStarted=!1))).add(e.providerOutput.availableVideoStreams$.subscribe(this.info.availableVideoStreams$)).add((0,l.combine)({availableVideoTracks:e.providerOutput.availableVideoTracks$,currentVideoStream:e.providerOutput.currentVideoStream$}).pipe((0,l.map)((({availableVideoTracks:e,currentVideoStream:t})=>e.filter((e=>!t||t.id===e.streamId)).map((({quality:e})=>e)).sort(((e,t)=>(0,l.isInvariantQuality)(e)?1:(0,l.isInvariantQuality)(t)?-1:(0,l.isHigher)(t,e)?1:-1))))).subscribe(this.info.availableQualities$)).add(e.providerOutput.availableVideoTracks$.subscribe((e=>{let t={};for(let i of e)i.fps&&(t[i.quality]=i.fps);this.info.availableQualitiesFps$.next(t)}))).add(e.providerOutput.availableAudioStreams$.subscribe(this.info.availableAudioStreams$)).add(e.providerOutput.currentVideoStream$.subscribe(this.info.currentVideoStream$)).add(e.providerOutput.currentAudioStream$.subscribe(this.info.currentAudioStream$)).add(e.providerOutput.availableAudioTracks$.subscribe(this.info.availableAudioTracks$)).add(e.providerOutput.isAudioAvailable$.pipe((0,l.filterChanged)()).subscribe(this.info.isAudioAvailable$)).add(e.providerOutput.currentVideoTrack$.pipe((0,l.filter)((e=>(0,l.isNonNullable)(e)))).subscribe((e=>{this.info.currentQuality$.next(e?.quality),this.info.videoBitrate$.next(e?.bitrate)}))).add(e.providerOutput.currentVideoSegmentLength$.pipe((0,l.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentVideoSegmentLength$)).add(e.providerOutput.currentAudioSegmentLength$.pipe((0,l.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentAudioSegmentLength$)).add(e.providerOutput.hostname$.pipe((0,l.filterChanged)()).subscribe(this.info.hostname$)).add(e.providerOutput.httpConnectionType$.pipe((0,l.filterChanged)()).subscribe(this.info.httpConnectionType$)).add(e.providerOutput.httpConnectionReused$.pipe((0,l.filterChanged)()).subscribe(this.info.httpConnectionReused$)).add(e.providerOutput.currentTextTrack$.subscribe(this.info.currentTextTrack$)).add(e.providerOutput.availableTextTracks$.subscribe(this.info.availableTextTracks$)).add(e.providerOutput.autoVideoTrackLimitingAvailable$.subscribe(this.info.autoQualityLimitingAvailable$)).add(e.providerOutput.autoVideoTrackLimits$.subscribe((e=>{this.desiredState.autoVideoTrackLimits.setState(e??{})}))).add(e.providerOutput.currentBuffer$.pipe((0,l.map)((e=>e?{start:e.from,end:e.to}:{start:0,end:0}))).subscribe(this.info.currentBuffer$)).add(e.providerOutput.currentNativeBuffer$.pipe((0,l.map)((e=>e?{start:e.from,end:e.to}:{start:0,end:0}))).subscribe(this.info.currentNativeBuffer$)).add(e.providerOutput.duration$.subscribe(this.info.duration$)).add(e.providerOutput.isBuffering$.subscribe(this.info.isBuffering$)).add(e.providerOutput.isLive$.subscribe(this.info.isLive$)).add(e.providerOutput.isLiveEnded$.pipe((0,l.tap)((e=>e&&this.stop()))).subscribe(this.info.isLiveEnded$)).add(e.providerOutput.canPlayLiveTailBuffer$.subscribe(this.info.canPlayLiveTailBuffer$)).add(e.providerOutput.canChangePlaybackSpeed$.subscribe(this.info.canChangePlaybackSpeed$)).add(e.providerOutput.liveTime$.subscribe(this.info.liveTime$)).add(e.providerOutput.liveBufferTime$.subscribe(this.info.liveBufferTime$)).add(e.providerOutput.liveLatency$.subscribe(this.info.liveLatency$)).add((0,l.combine)({hasLiveOffsetByPaused:(0,l.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,l.map)((e=>e.to)),(0,l.filterChanged)(),(0,l.map)((e=>"paused"===e))),isLowLatency:e.providerOutput.isLowLatency$}).subscribe((({hasLiveOffsetByPaused:e,isLowLatency:t})=>{window.clearTimeout(this.hasLiveOffsetByPausedTimer),e?this.hasLiveOffsetByPausedTimer=window.setTimeout((()=>{this.hasLiveOffsetByPaused.next(!0)}),this.getActiveLiveDelay(t)):this.hasLiveOffsetByPaused.next(!1)}))).add((0,l.combine)({atLiveEdge:(0,l.combine)({isLive:e.providerOutput.isLive$,isLowLatency:e.providerOutput.isLowLatency$,position:ql({seekState:this.desiredState.seekState,position$:e.providerOutput.position$})}).pipe((0,l.map)((({isLive:e,position:t,isLowLatency:i})=>{let r=this.getActiveLiveDelay(i);return e&&Math.abs(t)<r/1e3})),(0,l.filterChanged)(),(0,l.tap)((e=>e&&this.setPlaybackRate(1)))),hasPausedTimeoutCase:this.hasLiveOffsetByPaused}).pipe((0,l.map)((({atLiveEdge:e,hasPausedTimeoutCase:t})=>e&&!t))).subscribe(this.info.atLiveEdge$)).add((0,l.combine)({isLive:e.providerOutput.isLive$,position:e.providerOutput.position$,duration:e.providerOutput.duration$}).pipe((0,l.map)((({isLive:e,position:t,duration:i})=>e&&1e3*(Math.abs(i)-Math.abs(t))<this.tuning.live.activeLiveDelay)),(0,l.filterChanged)(),(0,l.tap)((e=>e&&this.setPlaybackRate(1)))).subscribe(this.info.atLiveDurationEdge$)).add(e.providerOutput.volume$.pipe((0,l.map)((e=>e.muted)),(0,l.filterChanged)()).subscribe(this.info.muted$)).add(e.providerOutput.volume$.pipe((0,l.map)((e=>e.volume)),(0,l.filterChanged)()).subscribe(this.info.volume$)).add(ql({seekState:this.desiredState.seekState,position$:e.providerOutput.position$}).subscribe(this.info.position$)).add(e.providerOutput.seekedEvent$.subscribe((()=>{this.info.isEnded$.getValue()&&this.tuning.changePlaybackStateToPausedWhenEnded&&this.play()}))).add((0,l.merge)(e.providerOutput.endedEvent$.pipe((0,l.mapTo)(!0)),e.providerOutput.seekedEvent$.pipe((0,l.mapTo)(!1))).pipe((0,l.filterChanged)()).subscribe(this.info.isEnded$)).add(e.providerOutput.endedEvent$.subscribe(this.events.ended$)).add(e.providerOutput.loopedEvent$.subscribe(this.events.looped$)).add(e.providerError$.subscribe(this.events.managedError$)).add(e.providerOutput.fetcherRecoverableError$.subscribe(this.events.fetcherRecoverableError$)).add(e.providerOutput.fetcherError$.subscribe(this.events.fatalError$)).add(e.volumeMultiplierError$.subscribe(this.events.managedError$)).add(e.noAvailableProvidersError$.pipe((0,l.map)((e=>({id:e?`No${e}`:"NoProviders",category:l.ErrorCategory.VIDEO_PIPELINE,message:e?`${e} was forced but failed or not available`:"No suitable providers or all providers failed"})))).subscribe(this.events.fatalError$)).add(e.providerOutput.element$.subscribe(this.experimental.element$)).add(e.providerOutput.getCurrentTime$.subscribe(this.experimental.getCurrentTime$)).add(e.providerOutput.manifestRequested$.pipe((0,l.once)()).subscribe(this.events.manifestRequested$)).add(e.providerOutput.firstBytesManifest$.pipe((0,l.once)()).subscribe(this.events.firstBytesManifest$)).add(e.providerOutput.manifestReceived$.pipe((0,l.once)()).subscribe(this.events.manifestReceived$)).add(e.providerOutput.firstBytesRequested$.pipe((0,l.once)()).subscribe(this.events.firstBytesRequested$)).add(e.providerOutput.firstBytesReceived$.pipe((0,l.once)()).subscribe(this.events.firstBytesReceived$)).add(e.providerOutput.firstBytesEvent$.pipe((0,l.once)(),(0,l.map)((e=>e??(0,l.now)()-this.initedAt))).subscribe(this.events.firstBytes$)).add(e.providerOutput.loadedMetadataEvent$.subscribe(this.events.loadedMetadata$)).add(e.providerOutput.firstFrameEvent$.pipe((0,l.once)(),(0,l.map)((()=>(0,l.now)()-this.initedAt))).subscribe(this.events.firstFrame$)).add(e.providerOutput.canplay$.pipe((0,l.once)(),(0,l.map)((()=>(0,l.now)()-this.initedAt))).subscribe(this.events.canplay$)).add(this.throughputEstimator.throughput$.subscribe(this.info.throughputEstimation$)).add(this.throughputEstimator.rtt$.subscribe(this.info.rttEstimation$)).add(e.providerOutput.availableSources$.subscribe(this.info.availableSources$));let t=new l.ValueSubject(!1);this.subscription.add(e.providerOutput.seekedEvent$.subscribe((()=>t.next(!1)))).add(e.providerOutput.willSeekEvent$.subscribe((()=>t.next(!0))));let i=new l.ValueSubject(!0);this.subscription.add(e.current$.subscribe((()=>i.next(!0)))).add(this.desiredState.playbackState.stateChangeEnded$.pipe((0,l.filter)((({to:e})=>"playing"===e)),(0,l.once)()).subscribe((()=>i.next(!1))));let r=0,s=(0,l.merge)(e.providerOutput.isBuffering$,t,i).pipe((0,l.map)((()=>{let r=e.providerOutput.isBuffering$.getValue(),s=t.getValue()||i.getValue();return r&&!s})),(0,l.filterChanged)());this.subscription.add(s.subscribe((e=>{e?r=window.setTimeout((()=>this.info.isStalled$.next(!0)),this.tuning.stallIgnoreThreshold):(window.clearTimeout(r),this.info.isStalled$.next(!1))}))),this.subscription.add((0,l.merge)(e.providerOutput.canplay$,e.providerOutput.firstFrameEvent$,e.providerOutput.firstBytesEvent$).subscribe((()=>{let t=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.videoWidth,height:t?.videoHeight})}))).add(e.providerOutput.currentVideoTrack$.subscribe((t=>{let i=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.size?.width,height:t?.size?.height},{width:i?.videoWidth,height:i?.videoHeight})}))).add(e.providerOutput.is3DVideo$.subscribe(this.info.is3DVideo$)),this.subscription.add((0,l.merge)(e.providerOutput.inPiP$,e.providerOutput.inFullscreen$,e.providerOutput.element$,e.providerOutput.elementVisible$,this.chromecastInitializer.castState$).subscribe((()=>{let t,i=e.providerOutput.inPiP$.getValue(),r=e.providerOutput.inFullscreen$.getValue(),s=e.providerOutput.element$.getValue(),a=e.providerOutput.elementVisible$.getValue();t="CONNECTED"===this.chromecastInitializer.castState$.getValue()?"second_screen":s?a?i?"pip":r?"fullscreen":"inline":"invisible":"none",this.info.surface$.getValue()!==t&&this.info.surface$.next(t)})))}initChromecastSubscription(){this.subscription.add(this.chromecastInitializer.castState$.subscribe(this.info.chromecastState$)),this.subscription.add(this.chromecastInitializer.connection$.pipe((0,l.map)((e=>e?.castDevice.friendlyName))).subscribe(this.info.chromecastDeviceName$)),this.subscription.add(this.chromecastInitializer.errorEvent$.subscribe(this.events.managedError$))}initStartingVideoTrack(e){let t=new l.Subscription;this.subscription.add(t),this.subscription.add(e.current$.pipe((0,l.filterChanged)(((e,t)=>e.provider===t.provider))).subscribe((()=>{t.unsubscribe(),t.add(e.providerOutput.availableVideoTracks$.pipe((0,l.filter)((e=>e.length>0)),(0,l.once)()).subscribe((e=>{this.setStartingVideoTrack(e)})))})))}setStartingVideoTrack(e){let t;this.wasSetStartedQuality=!0;let i=this.explicitInitialQuality??this.info.currentQuality$.getValue();i&&(t=e.find((({quality:e})=>e===i)),t||this.setAutoQuality(!0)),t||(t=_s(e,{container:this.domContainer.getBoundingClientRect(),panelSize:this.config.panelSize,estimatedThroughput:this.throughputEstimator.throughput$.getValue(),tuning:this.tuning.autoTrackSelection,limits:this.desiredState.autoVideoTrackLimits.getState(),playbackRate:this.info.currentPlaybackRate$.getValue(),forwardBufferHealth:0,abrLogger:this.abrLogger})),this.desiredState.videoTrack.startTransitionTo(t),this.info.currentQuality$.next(t.quality),this.info.videoBitrate$.next(t.bitrate)}initLogs(){this.subscription.add((0,l.merge)(this.desiredState.videoTrack.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"quality",type:"start"})))),this.desiredState.videoTrack.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"quality",type:"end"})))),this.desiredState.autoVideoTrackSwitching.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"start"})))),this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"end"})))),this.desiredState.seekState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"seekState",type:"start"})))),this.desiredState.seekState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"seekState",type:"end"})))),this.desiredState.playbackState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"playbackState",type:"start"})))),this.desiredState.playbackState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"playbackState",type:"end"}))))).pipe((0,l.map)((e=>({component:"desiredState",message:`[${e.entity} change] ${e.type}: ${JSON.stringify(e.transition)}`})))).subscribe(this.logger.log)),this.subscription.add(this.logger.log$.subscribe(this.events.log$))}initDebugTelemetry(){let e=this.providerContainer?.providerOutput;(0,l.assertNonNullable)(this.providerContainer),(0,l.assertNonNullable)(e),ns={},this.experimental.enableDebugTelemetry$.next(this.tuning.enableTelemetryAtStart),[this.experimental.enableDebugTelemetry$.subscribe((e=>(e=>{as=e})(e))),this.providerContainer.current$.subscribe((({type:e})=>ls("provider",e))),e.duration$.subscribe((e=>ls("duration",e))),e.availableVideoTracks$.pipe((0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>ls("tracks",e))),this.events.fatalError$.subscribe(new us("fatalError")),this.events.managedError$.subscribe(new us("managedError")),e.position$.subscribe(new us("position")),e.currentVideoTrack$.pipe((0,l.map)((e=>e?.quality))).subscribe(new us("quality")),this.info.currentBuffer$.subscribe(new us("buffer")),e.isBuffering$.subscribe(new us("isBuffering"))].forEach((e=>this.subscription.add(e))),ls("codecs",Tr.video.supportedCodecs)}initTracerSubscription(){let e=(0,l.getTraceSubscriptionMethod)(this.tracer.log.bind(this.tracer)),t=(0,l.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.info.playbackState$.subscribe(e("playbackState"))).add(this.info.isLooped$.subscribe(e("isLooped"))).add(this.info.currentPlaybackRate$.pipe((0,l.filterChanged)()).subscribe(e("currentPlaybackRate"))).add(this.info.isAutoQualityEnabled$.subscribe(e("isAutoQualityEnabled"))).add(this.info.autoQualityLimits$.subscribe(e("autoQualityLimits"))).add(this.info.currentFormat$.subscribe(e("currentFormat"))).add(this.info.availableQualities$.subscribe(e("availableQualities"))).add(this.info.availableQualitiesFps$.subscribe(e("availableQualitiesFps"))).add(this.info.availableAudioTracks$.subscribe(e("availableAudioTracks"))).add(this.info.isAudioAvailable$.subscribe(e("isAudioAvailable"))).add((0,l.combine)({currentQuality:this.info.currentQuality$,videoBitrate:this.info.videoBitrate$}).pipe((0,l.filter)((({currentQuality:e,videoBitrate:t})=>!!e&&!!t)),(0,l.filterChanged)(((e,t)=>e.currentQuality===t.currentQuality))).subscribe(e("currentVideoTrack"))).add(this.info.currentVideoSegmentLength$.pipe((0,l.filter)((e=>e>0)),(0,l.filterChanged)()).subscribe(e("currentVideoSegmentLength"))).add(this.info.currentAudioSegmentLength$.pipe((0,l.filter)((e=>e>0)),(0,l.filterChanged)()).subscribe(e("currentAudioSegmentLength"))).add(this.info.hostname$.subscribe(e("hostname"))).add(this.info.currentTextTrack$.subscribe(e("currentTextTrack"))).add(this.info.availableTextTracks$.subscribe(e("availableTextTracks"))).add(this.info.autoQualityLimitingAvailable$.subscribe(e("autoQualityLimitingAvailable"))).add((0,l.combine)({currentBuffer:this.info.currentBuffer$.pipe((0,l.filter)((e=>e.end>0)),(0,l.filterChanged)(((e,t)=>e.end===t.end&&e.start===t.start))),position:this.info.position$.pipe((0,l.filterChanged)())}).pipe((0,l.throttle)(1e3)).subscribe(e("currentBufferAndPosition"))).add(this.info.duration$.pipe((0,l.filterChanged)()).subscribe(e("duration"))).add(this.info.isBuffering$.subscribe(e("isBuffering"))).add(this.info.isLive$.pipe((0,l.filterChanged)()).subscribe(e("isLive"))).add(this.info.canChangePlaybackSpeed$.pipe((0,l.filterChanged)()).subscribe(e("canChangePlaybackSpeed"))).add((0,l.combine)({liveTime:this.info.liveTime$,liveBufferTime:this.info.liveBufferTime$,position:this.info.position$}).pipe((0,l.filter)((({liveTime:e,liveBufferTime:t})=>!!e&&!!t)),(0,l.throttle)(1e3)).subscribe(e("liveBufferAndPosition"))).add(this.info.atLiveEdge$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("atLiveEdge"))).add(this.info.atLiveDurationEdge$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("atLiveDurationEdge"))).add(this.info.muted$.pipe((0,l.filterChanged)()).subscribe(e("muted"))).add(this.info.volume$.pipe((0,l.filterChanged)()).subscribe(e("volume"))).add(this.info.isEnded$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("isEnded"))).add(this.info.availableSources$.subscribe(e("availableSources"))).add((0,l.combine)({throughputEstimation:this.info.throughputEstimation$,rtt:this.info.rttEstimation$}).pipe((0,l.filter)((({throughputEstimation:e,rtt:t})=>!!e&&!!t)),(0,l.throttle)(3e3)).subscribe(e("throughputEstimation"))).add(this.info.isStalled$.subscribe(e("isStalled"))).add(this.info.is3DVideo$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("is3DVideo"))).add(this.info.surface$.subscribe(e("surface"))).add(this.events.ended$.subscribe(e("ended"))).add(this.events.looped$.subscribe(e("looped"))).add(this.events.managedError$.subscribe(t("managedError"))).add(this.events.fatalError$.subscribe(t("fatalError"))).add(this.events.firstBytes$.subscribe(e("firstBytes"))).add(this.events.firstFrame$.subscribe(e("firstFrame"))).add(this.events.canplay$.subscribe(e("canplay")))}initWakeLock(){if(!window.navigator.wakeLock||!this.tuning.enableWakeLock)return;let e,t=()=>{e?.release(),e=void 0},i=async()=>{t(),e=await window.navigator.wakeLock.request("screen").catch((e=>{e instanceof DOMException&&"NotAllowedError"===e.name||this.events.managedError$.next({id:"WakeLock",category:l.ErrorCategory.DOM,message:String(e)})}))};this.subscription.add((0,l.merge)((0,l.fromEvent)(document,"visibilitychange"),(0,l.fromEvent)(document,"fullscreenchange"),this.desiredState.playbackState.stateChangeEnded$).subscribe((()=>{let r="visible"===document.visibilityState,s="playing"===this.desiredState.playbackState.getState();r&&s?!!e&&!e?.released||i():t()}))).add(this.events.willDestruct$.subscribe(t))}setVideoTrackIdByQuality(e,t){let i=e.find((e=>e.quality===t));this.tracer.log("setVideoTrackIdByQuality",(0,l.flattenObject)({quality:t,availableTracks:(0,l.flattenObject)(e),track:(0,l.flattenObject)(i),isAutoQuality:!i})),i?this.desiredState.videoTrack.startTransitionTo(i):this.setAutoQuality(!0)}getActiveLiveDelay(e=!1){return e?this.tuning.live.lowLatencyActiveLiveDelay:this.tuning.live.activeLiveDelay}isNotActiveTabCase(){return document.hidden&&this.tuning.autoplayOnlyInActiveTab&&!Js()}constructor(e={configName:[]},t=l.TracerFactory.createRootTracer(!1),i){this.subscription=new l.Subscription,this.logger=new l.Logger,this.abrLogger=this.logger.createComponentLog("ABR"),this.internalsExposure=null,this.isPlaybackStarted=!1,this.hasLiveOffsetByPaused=new l.ValueSubject(!1),this.hasLiveOffsetByPausedTimer=0,this.playerInitRequest=0,this.playerInited=new l.ValueSubject(!1),this.wasSetStartedQuality=!1,this.desiredState={playbackState:new Nr("stopped"),seekState:new Nr({state:"none"}),volume:new Nr({volume:1,muted:!1}),videoTrack:new Nr(void 0),videoStream:new Nr(void 0),audioStream:new Nr(void 0),autoVideoTrackSwitching:new Nr(!0),autoVideoTrackLimits:new Nr({}),isLooped:new Nr(!1),isLowLatency:new Nr(!1),playbackRate:new Nr(1),externalTextTracks:new Nr([]),internalTextTracks:new Nr([]),currentTextTrack:new Nr(void 0),textTrackCuesSettings:new Nr({}),cameraOrientation:new Nr({x:0,y:0})},this.info={playbackState$:new l.ValueSubject(void 0),position$:new l.ValueSubject(0),duration$:new l.ValueSubject(1/0),muted$:new l.ValueSubject(!1),volume$:new l.ValueSubject(1),availableVideoStreams$:new l.ValueSubject([]),currentVideoStream$:new l.ValueSubject(void 0),availableQualities$:new l.ValueSubject([]),availableQualitiesFps$:new l.ValueSubject({}),currentQuality$:new l.ValueSubject(void 0),isAutoQualityEnabled$:new l.ValueSubject(!0),autoQualityLimitingAvailable$:new l.ValueSubject(!1),autoQualityLimits$:new l.ValueSubject({}),predefinedQualityLimitType$:new l.ValueSubject("unknown"),availableAudioStreams$:new l.ValueSubject([]),currentAudioStream$:new l.ValueSubject(void 0),availableAudioTracks$:new l.ValueSubject([]),isAudioAvailable$:new l.ValueSubject(!0),currentPlaybackRate$:new l.ValueSubject(1),currentBuffer$:new l.ValueSubject({start:0,end:0}),currentNativeBuffer$:new l.ValueSubject({start:0,end:0}),isBuffering$:new l.ValueSubject(!0),isStalled$:new l.ValueSubject(!1),isEnded$:new l.ValueSubject(!1),isLooped$:new l.ValueSubject(!1),isLive$:new l.ValueSubject(void 0),isLiveEnded$:new l.ValueSubject(null),canPlayLiveTailBuffer$:new l.ValueSubject(!1),canChangePlaybackSpeed$:new l.ValueSubject(void 0),atLiveEdge$:new l.ValueSubject(void 0),atLiveDurationEdge$:new l.ValueSubject(void 0),liveTime$:new l.ValueSubject(void 0),liveBufferTime$:new l.ValueSubject(void 0),liveLatency$:new l.ValueSubject(void 0),currentFormat$:new l.ValueSubject(void 0),availableTextTracks$:new l.ValueSubject([]),currentTextTrack$:new l.ValueSubject(void 0),throughputEstimation$:new l.ValueSubject(void 0),rttEstimation$:new l.ValueSubject(void 0),videoBitrate$:new l.ValueSubject(void 0),hostname$:new l.ValueSubject(void 0),httpConnectionType$:new l.ValueSubject(void 0),httpConnectionReused$:new l.ValueSubject(void 0),surface$:new l.ValueSubject("none"),chromecastState$:new l.ValueSubject("NOT_AVAILABLE"),chromecastDeviceName$:new l.ValueSubject(void 0),intrinsicVideoSize$:new l.ValueSubject(void 0),availableSources$:new l.ValueSubject(void 0),is3DVideo$:new l.ValueSubject(!1),currentVideoSegmentLength$:new l.ValueSubject(0),currentAudioSegmentLength$:new l.ValueSubject(0)},this.events={inited$:new l.Subject,ready$:new l.Subject,started$:new l.Subject,playing$:new l.Subject,paused$:new l.Subject,stopped$:new l.Subject,willReady$:new l.Subject,willStart$:new l.Subject,willResume$:new l.Subject,willPause$:new l.Subject,willStop$:new l.Subject,willDestruct$:new l.Subject,watchCoverageRecord$:new l.Subject,watchCoverageLive$:new l.Subject,managedError$:new l.Subject,fatalError$:new l.Subject,fetcherRecoverableError$:new l.Subject,ended$:new l.Subject,looped$:new l.Subject,seeked$:new l.Subject,willSeek$:new l.Subject,autoplaySoundProhibited$:new l.Subject,manifestRequested$:new l.Subject,firstBytesManifest$:new l.Subject,manifestReceived$:new l.Subject,firstBytesRequested$:new l.Subject,firstBytesReceived$:new l.Subject,firstBytes$:new l.Subject,loadedMetadata$:new l.Subject,firstFrame$:new l.Subject,canplay$:new l.Subject,log$:new l.Subject,fetcherError$:new l.Subject,severeStallOccured$:new l.Subject},this.experimental={element$:new l.ValueSubject(void 0),tuningConfigName$:new l.ValueSubject([]),enableDebugTelemetry$:new l.ValueSubject(!1),dumpTelemetry:os,getCurrentTime$:new l.ValueSubject(null)},this.initLogs(),this.tuning=(e=>({...(0,l.fillWithDefault)(e,zl),configName:[...e.configName??[],...zl.configName]}))(e),this.tracer=t,this.tuning.suppressExceptionsInObservables&&((0,Ji.default)(this.info).forEach((e=>e.setSuppressErrors(!0))),(0,Ji.default)(this.events).forEach((e=>e.setSuppressErrors(!0)))),this.experimental.tuningConfigName$.next(this.tuning.configName);let r={receiverApplicationId:this.tuning.chromecastReceiverId,isDisabled:this.tuning.disableChromecast,dependencies:{logger:this.logger}};if(this.chromecastInitializer=this.tuning.chromecastPresentationApi?new Pr(r):new er(r),this.throughputEstimator=new jl(this.tuning.throughputEstimator),e.exposeInternalsToGlobal&&(this.internalsExposure=new l.InternalsExposure("core",(0,l.getPlayerId)(i?.playerId)),this.internalsExposure.expose({player:this})),this.initChromecastSubscription(),this.initDesiredStateSubscriptions(),this.devNullLog=i?.onDevNullLog,l.devNull.create("core"),Proxy&&Reflect)return new Proxy(this,{get:(e,t,i)=>{let r=Reflect.get(e,t,i);return"function"!=typeof r?r:(...i)=>{try{return r.apply(e,i)}catch(e){let r=i.map((e=>JSON.stringify(e,((e,t)=>{let i=typeof t;return(0,Zi.default)(["number","string","boolean"],i)?t:null===t?null:`<${i}>`})))),s=`Player.${String(t)}`,a=`Exception calling ${s} (${r.join(", ")})`;throw this.events.fatalError$.next({id:s,category:l.ErrorCategory.WTF,message:a,thrown:e}),e}}}})}},Kl=`@vkontakte/videoplayer-core@${Ui}`},819705:(e,t,i)=>{var r;i.d(t,{ErrorCategory:()=>nr,InterfaceLanguage:()=>xr,InternalsExposure:()=>Tr,Logger:()=>kt,Observable:()=>$t,Subject:()=>xt,Subscription:()=>gt,SubscriptionRemovable:()=>Vi,TracerFactory:()=>Ti,VERSION:()=>mt,ValueSubject:()=>Ci,VideoQuality:()=>Gt,abortable:()=>Pt,addScript:()=>At,assertNever:()=>vt,assertNonNullable:()=>Tt,assertNotEmptyArray:()=>Et,checkNever:()=>bt,clearVideoElement:()=>pi,cloneDeepWith:()=>di,combine:()=>Ai,debounce:()=>Bi,debounceFn:()=>li,detectEmbed:()=>Qt,devNull:()=>_r,fillWithDefault:()=>oi,filter:()=>zi,filterChanged:()=>Wi,flattenObject:()=>hi,fromEvent:()=>Ri,getExponentialDelay:()=>Mt,getHighestQuality:()=>ei,getPlayerId:()=>vi,getRangeAroundIndex:()=>yi,getTraceSubscriptionMethod:()=>Si,getVideoQualityLabel:()=>ni,interpolate:()=>bi,interval:()=>Mi,isHigher:()=>Yt,isHigherOrEqual:()=>Xt,isIntersecting:()=>mi,isInvariantQuality:()=>ai,isLower:()=>Jt,isLowerOrEqual:()=>Zt,isNonNullable:()=>_t,isNullable:()=>Ct,isValidURL:()=>fi,loadVKLangPack:()=>Sr,map:()=>Ki,mapTo:()=>Xi,merge:()=>Li,noop:()=>yt,now:()=>Lt,observableFrom:()=>Ii,observeElementSize:()=>ci,once:()=>Ji,safeStorage:()=>It,shareReplay:()=>rr,skip:()=>tr,tap:()=>Zi,throttle:()=>Fi,throttleFn:()=>ui,timeout:()=>Pi,videoHeightToQuality:()=>ii,videoQualityToHeight:()=>si,videoSizeToQuality:()=>ri});var s=Object.create,a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,l=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,t)=>{for(var i in t)a(e,i,{get:t[i],enumerable:!0})},h=(e,t,i)=>(i=null!=e?s(l(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of o(t))!u.call(e,s)&&s!==i&&a(e,s,{get:()=>t[s],enumerable:!(r=n(t,s))||r.enumerable});return e})(!t&&e&&e.__esModule?i:a(i,"default",{value:e,enumerable:!0}),e)),p=d(((e,t)=>{"use strict";var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),f=d(((e,t)=>{"use strict";t.exports=function(e){try{return!!e()}catch{return!0}}})),m=d(((e,t)=>{"use strict";var i=f();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),g=d(((e,t)=>{"use strict";var i=m(),r=Function.prototype,s=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(s):function(){return a.apply(s,arguments)})})),v=d(((e,t)=>{"use strict";var i=m(),r=Function.prototype,s=r.call,a=i&&r.bind.bind(s,s);t.exports=i?a:function(e){return function(){return s.apply(e,arguments)}}})),b=d(((e,t)=>{"use strict";var i=v(),r=i({}.toString),s=i("".slice);t.exports=function(e){return s(r(e),8,-1)}})),y=d(((e,t)=>{"use strict";var i=b(),r=v();t.exports=function(e){if("Function"===i(e))return r(e)}})),S=d(((e,t)=>{"use strict";var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),w=d(((e,t)=>{"use strict";var i=f();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),$=d(((e,t)=>{"use strict";var i=m(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),x=d((e=>{"use strict";var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),k=d(((e,t)=>{"use strict";t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),T=d(((e,t)=>{"use strict";var i=v(),r=f(),s=b(),a=Object,n=i("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?n(e,""):a(e)}:a})),_=d(((e,t)=>{"use strict";t.exports=function(e){return null==e}})),C=d(((e,t)=>{"use strict";var i=_(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),E=d(((e,t)=>{"use strict";var i=T(),r=C();t.exports=function(e){return i(r(e))}})),A=d(((e,t)=>{"use strict";var i=S();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),L=d(((e,t)=>{"use strict";t.exports={}})),P=d(((e,t)=>{"use strict";var i=L(),r=p(),s=S(),a=function(e){return s(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?a(i[e])||a(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),M=d(((e,t)=>{"use strict";var i=v();t.exports=i({}.isPrototypeOf)})),I=d(((e,t)=>{"use strict";var i=p().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),R=d(((e,t)=>{"use strict";var i,r,s=p(),a=I(),n=s.process,o=s.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&a&&((!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=a.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),V=d(((e,t)=>{"use strict";var i=R(),r=f(),s=p().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),N=d(((e,t)=>{"use strict";var i=V();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),B=d(((e,t)=>{"use strict";var i=P(),r=S(),s=M(),a=N(),n=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&s(t.prototype,n(e))}})),D=d(((e,t)=>{"use strict";var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),O=d(((e,t)=>{"use strict";var i=S(),r=D(),s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not a function")}})),F=d(((e,t)=>{"use strict";var i=O(),r=_();t.exports=function(e,t){var s=e[t];return r(s)?void 0:i(s)}})),j=d(((e,t)=>{"use strict";var i=$(),r=S(),s=A(),a=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!s(o=i(n,e))||r(n=e.valueOf)&&!s(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!s(o=i(n,e)))return o;throw new a("Can't convert object to primitive value")}})),z=d(((e,t)=>{"use strict";t.exports=!0})),q=d(((e,t)=>{"use strict";var i=p(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),H=d(((e,t)=>{"use strict";var i=z(),r=p(),s=q(),a="__core-js_shared__",n=t.exports=r[a]||s(a,{});(n.versions||(n.versions=[])).push({version:"3.43.0",mode:i?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.43.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),U=d(((e,t)=>{"use strict";var i=H();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),W=d(((e,t)=>{"use strict";var i=C(),r=Object;t.exports=function(e){return r(i(e))}})),Q=d(((e,t)=>{"use strict";var i=v(),r=W(),s=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return s(r(e),t)}})),G=d(((e,t)=>{"use strict";var i=v(),r=0,s=Math.random(),a=i(1.1.toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+s,36)}})),K=d(((e,t)=>{"use strict";var i=p(),r=U(),s=Q(),a=G(),n=V(),o=N(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return s(u,e)||(u[e]=n&&s(l,e)?l[e]:d("Symbol."+e)),u[e]}})),Y=d(((e,t)=>{"use strict";var i=$(),r=A(),s=B(),a=F(),n=j(),o=K(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||s(e))return e;var o,d=a(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||s(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),X=d(((e,t)=>{"use strict";var i=Y(),r=B();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),J=d(((e,t)=>{"use strict";var i=p(),r=A(),s=i.document,a=r(s)&&r(s.createElement);t.exports=function(e){return a?s.createElement(e):{}}})),Z=d(((e,t)=>{"use strict";var i=w(),r=f(),s=J();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))})),ee=d((e=>{"use strict";var t=w(),i=$(),r=x(),s=k(),a=E(),n=X(),o=Q(),l=Z(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=a(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return s(!i(r.f,e,t),e[t])}})),te=d(((e,t)=>{"use strict";var i=f(),r=S(),s=/#|\.prototype\./,a=function(e,t){var s=o[n(e)];return s===u||s!==l&&(r(t)?i(t):!!t)},n=a.normalize=function(e){return String(e).replace(s,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a})),ie=d(((e,t)=>{"use strict";var i=y(),r=O(),s=m(),a=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:s?a(e,t):function(){return e.apply(t,arguments)}}})),re=d(((e,t)=>{"use strict";var i=w(),r=f();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),se=d(((e,t)=>{"use strict";var i=A(),r=String,s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not an object")}})),ae=d((e=>{"use strict";var t=w(),i=Z(),r=re(),s=se(),a=X(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(s(e),t=a(t),s(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(s(e),t=a(t),s(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),ne=d(((e,t)=>{"use strict";var i=w(),r=ae(),s=k();t.exports=i?function(e,t,i){return r.f(e,t,s(1,i))}:function(e,t,i){return e[t]=i,e}})),oe=d(((e,t)=>{"use strict";var i=p(),r=g(),s=y(),a=S(),n=ee().f,o=te(),l=L(),u=ie(),d=ne(),c=Q();H();var h=function(e){var t=function(i,s,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,s)}return new e(i,s,a)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,b,y,S,w=e.target,$=e.global,x=e.stat,k=e.proto,T=$?i:x?i[w]:i[w]&&i[w].prototype,_=$?l:l[w]||d(l,w,{})[w],C=_.prototype;for(m in t)p=!(r=o($?m:w+(x?".":"#")+m,e.forced))&&T&&c(T,m),v=_[m],p&&(e.dontCallGetSet?b=(S=n(T,m))&&S.value:b=T[m]),g=p&&b?b:t[m],(r||k||typeof v!=typeof g)&&(y=e.bind&&p?u(g,i):e.wrap&&p?h(g):k&&a(g)?s(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(y,"sham",!0),d(_,m,y),k&&(c(l,f=w+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&C&&(r||!C[m])&&d(C,m,g)))}})),le=d(((e,t)=>{"use strict";var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),ue=d(((e,t)=>{"use strict";var i=le();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),de=d(((e,t)=>{"use strict";var i=ue(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ce=d(((e,t)=>{"use strict";var i=de();t.exports=function(e){return i(e.length)}})),he=d(((e,t)=>{"use strict";t.exports=function(){}})),pe=d((()=>{"use strict";var e=oe(),t=W(),i=ce(),r=ue(),s=he();e({target:"Array",proto:!0},{at:function(e){var s=t(this),a=i(s),n=r(e),o=n>=0?n:a+n;return o<0||o>=a?void 0:s[o]}}),s("at")})),fe=d(((e,t)=>{"use strict";var i=P();t.exports=i})),me=d(((e,t)=>{"use strict";pe();var i=fe();t.exports=i("Array","at")})),ge=d(((e,t)=>{"use strict";var i=me();t.exports=i})),ve=d(((e,t)=>{"use strict";var i=ge();t.exports=i})),be=d(((e,t)=>{"use strict";var i=U(),r=G(),s=i("keys");t.exports=function(e){return s[e]||(s[e]=r(e))}})),ye=d(((e,t)=>{"use strict";var i=f();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),Se=d(((e,t)=>{"use strict";var i=Q(),r=S(),s=W(),a=be(),n=ye(),o=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=s(e);if(i(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?u:null}})),we=d(((e,t)=>{"use strict";var i=ue(),r=Math.max,s=Math.min;t.exports=function(e,t){var a=i(e);return a<0?r(a+t,0):s(a,t)}})),$e=d(((e,t)=>{"use strict";var i=E(),r=we(),s=ce(),a=function(e){return function(t,a,n){var o=i(t),l=s(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&a!=a){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===a)return e||d||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),xe=d(((e,t)=>{"use strict";t.exports={}})),ke=d(((e,t)=>{"use strict";var i=v(),r=Q(),s=E(),a=$e().indexOf,n=xe(),o=i([].push);t.exports=function(e,t){var i,l=s(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~a(d,i)||o(d,i));return d}})),Te=d(((e,t)=>{"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),_e=d(((e,t)=>{"use strict";var i=ke(),r=Te();t.exports=Object.keys||function(e){return i(e,r)}})),Ce=d(((e,t)=>{"use strict";var i=w(),r=f(),s=v(),a=Se(),n=_e(),o=E(),l=s(x().f),u=s([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,s=o(t),c=n(s),h=d&&null===a(s),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in s:l(s,r)))&&u(m,e?[r,s[r]]:s[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ee=d((()=>{"use strict";var e=oe(),t=Ce().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Ae=d(((e,t)=>{"use strict";Ee();var i=L();t.exports=i.Object.entries})),Le=d(((e,t)=>{"use strict";var i=Ae();t.exports=i})),Pe=d(((e,t)=>{"use strict";var i=Le();t.exports=i})),Me=d((()=>{"use strict";var e=oe(),t=$e().includes,i=f(),r=he();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Ie=d(((e,t)=>{"use strict";Me();var i=fe();t.exports=i("Array","includes")})),Re=d(((e,t)=>{"use strict";var i=Ie();t.exports=i})),Ve=d(((e,t)=>{"use strict";var i=Re();t.exports=i})),Ne=d(((e,t)=>{"use strict";t.exports={}})),Be=d(((e,t)=>{"use strict";var i=p(),r=S(),s=i.WeakMap;t.exports=r(s)&&/native code/.test(String(s))})),De=d(((e,t)=>{"use strict";var i,r,s,a,n,o=Be(),l=p(),u=A(),d=ne(),c=Q(),h=H(),f=be(),m=xe(),g="Object already initialized",v=l.TypeError,b=l.WeakMap;o||h.state?((a=h.state||(h.state=new b)).get=a.get,a.has=a.has,a.set=a.set,i=function(e,t){if(a.has(e))throw new v(g);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},s=function(e){return a.has(e)}):(m[n=f("state")]=!0,i=function(e,t){if(c(e,n))throw new v(g);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},s=function(e){return c(e,n)}),t.exports={set:i,get:r,has:s,enforce:function(e){return s(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new v("Incompatible receiver, "+e+" required");return i}}}})),Oe=d(((e,t)=>{"use strict";var i=w(),r=Q(),s=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,n=r(s,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&a(s,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),Fe=d((e=>{"use strict";var t=w(),i=re(),r=ae(),s=se(),a=E(),n=_e();e.f=t&&!i?Object.defineProperties:function(e,t){s(e);for(var i,o=a(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),je=d(((e,t)=>{"use strict";var i=P();t.exports=i("document","documentElement")})),ze=d(((e,t)=>{"use strict";var i,r=se(),s=Fe(),a=Te(),n=xe(),o=je(),l=J(),u=be(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=a.length;e--;)delete g[d][a[e]];return g()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:s.f(i,t)}})),qe=d(((e,t)=>{"use strict";var i=ne();t.exports=function(e,t,r,s){return s&&s.enumerable?e[t]=r:i(e,t,r),e}})),He=d(((e,t)=>{"use strict";var i,r,s,a=f(),n=S(),o=A(),l=ze(),u=Se(),d=qe(),c=K(),h=z(),p=c("iterator"),m=!1;[].keys&&("next"in(s=[].keys())?(r=u(u(s)))!==Object.prototype&&(i=r):m=!0),!o(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:m}})),Ue=d(((e,t)=>{"use strict";var i={};i[K()("toStringTag")]="z",t.exports="[object z]"===String(i)})),We=d(((e,t)=>{"use strict";var i=Ue(),r=S(),s=b(),a=K()("toStringTag"),n=Object,o="Arguments"===s(function(){return arguments}());t.exports=i?s:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),a))?i:o?s(t):"Object"===(l=s(t))&&r(t.callee)?"Arguments":l}})),Qe=d(((e,t)=>{"use strict";var i=Ue(),r=We();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Ge=d(((e,t)=>{"use strict";var i=Ue(),r=ae().f,s=ne(),a=Q(),n=Qe(),o=K()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(a(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&s(d,"toString",n))}})),Ke=d(((e,t)=>{"use strict";var i=He().IteratorPrototype,r=ze(),s=k(),a=Ge(),n=Ne(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:s(+!u,l)}),a(e,d,!1,!0),n[d]=o,e}})),Ye=d(((e,t)=>{"use strict";var i=v(),r=O();t.exports=function(e,t,s){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}}})),Xe=d(((e,t)=>{"use strict";var i=A();t.exports=function(e){return i(e)||null===e}})),Je=d(((e,t)=>{"use strict";var i=Xe(),r=String,s=TypeError;t.exports=function(e){if(i(e))return e;throw new s("Can't set "+r(e)+" as a prototype")}})),Ze=d(((e,t)=>{"use strict";var i=Ye(),r=A(),s=C(),a=Je();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return s(i),a(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),et=d(((e,t)=>{"use strict";var i=oe(),r=$(),s=z(),a=Oe(),n=S(),o=Ke(),l=Se(),u=Ze(),d=Ge(),c=ne(),h=qe(),p=K(),f=Ne(),m=He(),g=a.PROPER,v=a.CONFIGURABLE,b=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,w=p("iterator"),x="keys",k="values",T="entries",_=function(){return this};t.exports=function(e,t,a,p,m,S,$){o(a,t,p);var C,E,A,L=function(e){if(e===m&&V)return V;if(!y&&e&&e in I)return I[e];switch(e){case x:case k:case T:return function(){return new a(this,e)}}return function(){return new a(this)}},P=t+" Iterator",M=!1,I=e.prototype,R=I[w]||I["@@iterator"]||m&&I[m],V=!y&&R||L(m),N="Array"===t&&I.entries||R;if(N&&((C=l(N.call(new e)))!==Object.prototype&&C.next&&(!s&&l(C)!==b&&(u?u(C,b):n(C[w])||h(C,w,_)),d(C,P,!0,!0),s&&(f[P]=_))),g&&m===k&&R&&R.name!==k&&(!s&&v?c(I,"name",k):(M=!0,V=function(){return r(R,this)})),m)if(E={values:L(k),keys:S?V:L(x),entries:L(T)},$)for(A in E)(y||M||!(A in I))&&h(I,A,E[A]);else i({target:t,proto:!0,forced:y||M},E);return(!s||$)&&I[w]!==V&&h(I,w,V,{name:m}),f[t]=V,E}})),tt=d(((e,t)=>{"use strict";t.exports=function(e,t){return{value:e,done:t}}})),it=d(((e,t)=>{"use strict";var i=E(),r=he(),s=Ne(),a=De(),n=ae().f,o=et(),l=tt(),u=z(),d=w(),c="Array Iterator",h=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=s.Arguments=s.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),rt=d(((e,t)=>{"use strict";var i=K(),r=Ne(),s=i("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[s]===e)}})),st=d(((e,t)=>{"use strict";var i=We(),r=F(),s=_(),a=Ne(),n=K()("iterator");t.exports=function(e){if(!s(e))return r(e,n)||r(e,"@@iterator")||a[i(e)]}})),at=d(((e,t)=>{"use strict";var i=$(),r=O(),s=se(),a=D(),n=st(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return s(i(l,e));throw new o(a(e)+" is not iterable")}})),nt=d(((e,t)=>{"use strict";var i=$(),r=se(),s=F();t.exports=function(e,t,a){var n,o;r(e);try{if(!(n=s(e,"return"))){if("throw"===t)throw a;return a}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw a;if(o)throw n;return r(n),a}})),ot=d(((e,t)=>{"use strict";var i=ie(),r=$(),s=se(),a=D(),n=rt(),o=ce(),l=M(),u=at(),d=st(),c=nt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,b,y,S,w,$,x=m&&m.that,k=!(!m||!m.AS_ENTRIES),T=!(!m||!m.IS_RECORD),_=!(!m||!m.IS_ITERATOR),C=!(!m||!m.INTERRUPTED),E=i(t,x),A=function(e){return g&&c(g,"normal"),new p(!0,e)},L=function(e){return k?(s(e),C?E(e[0],e[1],A):E(e[0],e[1])):C?E(e,A):E(e)};if(T)g=e.iterator;else if(_)g=e;else{if(!(v=d(e)))throw new h(a(e)+" is not iterable");if(n(v)){for(b=0,y=o(e);y>b;b++)if((S=L(e[b]))&&l(f,S))return S;return new p(!1)}g=u(e,v)}for(w=T?e.next:g.next;!($=r(w,g)).done;){try{S=L($.value)}catch(e){c(g,"throw",e)}if("object"==typeof S&&S&&l(f,S))return S}return new p(!1)}})),lt=d(((e,t)=>{"use strict";var i=w(),r=ae(),s=k();t.exports=function(e,t,a){i?r.f(e,t,s(0,a)):e[t]=a}})),ut=d((()=>{"use strict";var e=oe(),t=ot(),i=lt();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),dt=d(((e,t)=>{"use strict";it(),ut();var i=L();t.exports=i.Object.fromEntries})),ct=d(((e,t)=>{"use strict";t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),ht=d((()=>{"use strict";it();var e,t=ct(),i=p(),r=Ge(),s=Ne();for(e in t)r(i[e],e),s[e]=s.Array})),pt=d(((e,t)=>{"use strict";var i=dt();ht(),t.exports=i})),ft=d(((e,t)=>{"use strict";var i=pt();t.exports=i})),mt="1.0.78",gt=class{unsubscribe(){let e=this.subscriptions;this.subscriptions=[],e.forEach((e=>{"function"==typeof e?e():e.unsubscribe()}))}add(e){return this.subscriptions.push(e),this}constructor(){this.subscriptions=[]}},vt=e=>{throw new Error(`${e} is value of unexpected type`)},bt=e=>{},yt=()=>{},St=e=>{throw console.error(e),e},wt=e=>{console.error(e)},$t=class{setSuppressErrors(e){this.suppressErrors=e}subscribe(e,t){let i,r=this.suppressErrors?wt:St;i=t?"function"==typeof t?{next:t,error:yt}:{next:e=>t.next(e),error:e=>t.error?.(e)}:{next:r,error:yt};let s,a="function"==typeof e?{next:t=>{try{let r=e(t);r instanceof Promise&&r.catch((e=>i.next(e)))}catch(e){i.next(e)}},error:e=>i.next(e)}:{next:t=>e.next(t),error:t=>e.error?e.error(t):i.next(t)};try{s=this._subscribe(a)}catch(e){a.error?.(e)}return(new gt).add((()=>{switch(a.next=yt,a.error=yt,typeof s){case"function":return void s();case"object":return void s.unsubscribe();case"undefined":return;default:return vt(s)}}))}pipe(...e){return e.reduce(((e,t)=>t(e)),this)}_subscribe(e){}constructor(e){this.suppressErrors=!1,e&&(this._subscribe=e)}},xt=class extends $t{next(e){this.subscribers.forEach((t=>t.next(e)))}error(e){this.subscribers.forEach((t=>t.error?.(e)))}_subscribe(e){let t=this.keyCounter++;return this.subscribers.set(t,e),(new gt).add((()=>this.subscribers.delete(t)))}constructor(){super(),this.keyCounter=0,this.subscribers=new Map}},kt=class{createCustomLog(e){return(...t)=>{let i;try{i=e(...t)}catch{i={message:"error in `createCustomLog`",component:"Logger"}}this.log(i)}}createComponentLog(e){return this.createCustomLog((t=>({component:e,...t})))}constructor(){this.log$=new xt,this.logs=[],this.log=e=>{let t={...e,timestamp:Date.now()};this.logs.push(t),this.log$.next(t)},this.getAllLogs=()=>this.logs}};function Tt(e,t='Assertion "value is not nullable" failed'){if(null==e)throw new Error(t)}function _t(e){return typeof e<"u"&&null!==e}function Ct(e){return null==e}function Et(e,t){if(!e?.length)throw new Error(t)}var At=(e,t,i)=>new Promise(((r,s)=>{t.addEventListener("abort",(()=>{l(),u.remove()}));let a,n=()=>{l(),s("error")},o=()=>{l(),r()},l=()=>{a&&clearTimeout(a),u.removeEventListener("load",o),u.removeEventListener("error",n)};i&&(a=window.setTimeout((()=>{l(),s("timeout")}),i));let u=document.createElement("script");u.addEventListener("load",o),u.addEventListener("error",n),u.src=e,document.head.appendChild(u)})),Lt="function"==typeof window.performance?.now?()=>window.performance.now():()=>Date.now(),Pt=(e,t)=>async(...i)=>{let r,s=t(...i),a=e.aborted;for(;!a&&!e.aborted;)try{let e=await s.next(r);a=e.done??!1,r=e.value}catch(e){await s.throw(e)}return r},Mt=(e,{start:t=0,factor:i=2,max:r=1/0,min:s=t,random:a=0}={})=>{let n=t;return n*=i**e,n*=Math.random()*a*2-a+1,n=Math.round(n),n=Math.min(n,r),n=Math.max(n,s),n},It={};c(It,{clear:()=>Ht,get:()=>Ft,has:()=>zt,isPersistent:()=>Ot,remove:()=>qt,set:()=>jt});var Rt,Vt,Nt,Bt=`vk-videoplayer-dummy-key-${Math.random()}`,Dt=()=>{if(void 0!==Vt)return Vt;try{localStorage.setItem(Bt,"test"),localStorage.removeItem(Bt),Vt=0}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;try{sessionStorage.getItem(Bt),Vt=1}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;Vt=2}}return 2===Vt&&(Rt=new Map),Vt},Ot=()=>0===Dt(),Ft=e=>{let t=Dt();switch(t){case 0:return localStorage.getItem(e)??void 0;case 1:return sessionStorage.getItem(e)??void 0;case 2:return Rt?.get(e);default:vt(t)}},jt=(e,t)=>{let i=Dt();switch(i){case 0:try{localStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 1:try{sessionStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 2:return void Rt?.set(e,t);default:vt(i)}},zt=e=>{let t=Dt();switch(t){case 0:return e in localStorage;case 1:return e in sessionStorage;case 2:return Rt?.has(e)??!1;default:return vt(t),!1}},qt=e=>{let t=Dt();switch(t){case 0:return localStorage.removeItem(e);case 1:return sessionStorage.removeItem(e);case 2:return void Rt?.delete(e);default:vt(t)}},Ht=()=>{let e=Dt();switch(e){case 0:return localStorage.clear();case 1:return sessionStorage.clear();case 2:return Rt?.clear();default:vt(e)}},Ut=(e,t,i)=>{if("function"==typeof e.canParse)return e.canParse(t,i);try{return new e(t,i),!0}catch{return!1}},Wt=h(ve(),1),Qt=()=>{let e,t=[];try{e=window.self!==window.top}catch(t){t instanceof DOMException&&"SecurityError"===t.name?e=!0:(e=!1,console.error(t))}try{window.location.ancestorOrigins&&(t=[...window.location.ancestorOrigins])}catch(e){console.error(e)}try{!t.length&&document.referrer&&(t=[new URL(document.referrer).origin])}catch(e){console.error(e)}return t=t.filter((e=>Ut(URL,e))),{isEmbed:e,origins:t,topOrigin:(0,Wt.default)(t,-1),immediateOrigin:(0,Wt.default)(t,0)}},Gt=((Nt=Gt||{}).INVARIANT="Invariant quality",Nt.Q_144P="144p",Nt.Q_240P="240p",Nt.Q_360P="360p",Nt.Q_480P="480p",Nt.Q_576P="576p",Nt.Q_720P="720p",Nt.Q_1080P="1080p",Nt.Q_1440P="1440p",Nt.Q_2160P="2160p",Nt.Q_4320P="4320p",Nt),Kt={"144p":{width:256,height:144},"240p":{width:428,height:240},"360p":{width:640,height:360},"480p":{width:856,height:480},"576p":{width:1024,height:576},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"2160p":{width:3840,height:2160},"4320p":{width:7680,height:4320}},Yt=(e,t)=>Kt[e].height>Kt[t].height,Xt=(e,t)=>Kt[e].height>=Kt[t].height,Jt=(e,t)=>Kt[e].height<Kt[t].height,Zt=(e,t)=>Kt[e].height<=Kt[t].height,ei=e=>e.sort(((e,t)=>e===t?0:"Invariant quality"===e?1:"Invariant quality"===t?-1:Jt(e,t)?1:-1))[0],ti=Object.keys(Kt).sort(((e,t)=>Jt(e,t)?-1:1)),ii=(e,t=.02)=>[...ti].find((i=>Kt[i].height*(1+t)>=e)),ri=({width:e,height:t})=>{let i=Math.min(e,t),r=Math.max(e,t);return ti.find((e=>{let t=Kt[e];return t.width>=r&&t.height>=i}))},si=e=>Kt[e].height,ai=e=>"Invariant quality"===e;var ni=e=>{switch(e){case"4320p":return"8K";case"2160p":return"4K";case"1440p":return"QHD";case"1080p":return"FHD";case"720p":return"HD";default:return""}},oi=(e,t)=>{let i={};for(let r of Object.keys(t)){let s=t[r],a=e[r];Array.isArray(s)&&Array.isArray(a)?i[r]=a:i[r]="object"==typeof s&&"object"==typeof a?oi(a,s):r in e?a:s}return i};function li(e,t=0,i){let r,s,a,n,o,l,u=0,d=!1,c=!1,h=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;function f(t){let i=r,a=s;return r=s=void 0,u=t,n=e.apply(a,i),n}function m(e,t){return p?(o&&window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function g(e){let i=e-l;return void 0===l||i>=t||i<0||c&&e-u>=a}function v(){let e=Date.now();if(g(e))return b(e);o=m(v,function(e){let i=e-u,r=t-(e-l);return c?Math.min(r,a-i):r}(e))}function b(e){return o=void 0,h&&r?f(e):(r=s=void 0,n)}function y(...e){let i=Date.now(),a=g(i);if(r=e,s=this,l=i,a){if(void 0===o)return function(e){return u=e,o=m(v,t),d?f(e):n}(l);if(c)return o=m(v,t),f(l)}return void 0===o&&(o=m(v,t)),n}return i&&(d=!!i.leading,c="maxWait"in i,a=i?.maxWait?Math.max(+i?.maxWait||0,t):a,h="trailing"in i?!!i.trailing:h),y.cancel=function(){var e;void 0!==o&&(e=o,p?window.cancelAnimationFrame(e):clearTimeout(e)),u=0,r=l=s=o=void 0},y.flush=function(){return void 0===o?n:b(Date.now())},y.pending=function(){return void 0!==o},y}var ui=(e,t=0,i)=>li(e,t,{leading:!0,trailing:!0,...i,maxWait:t}),di=(e,t)=>{if(null===e||"object"!=typeof e)return e;let i=Array.isArray(e)?[]:{};for(let r in e){if("function"==typeof t){let s=t(e[r],r,e,i);if(void 0!==s){i[r]=s;continue}}"object"==typeof e[r]?i[r]=di(e[r],t):i[r]=e[r]}return i},ci=(e,t=300)=>new $t((i=>{let{width:r,height:s}=e.getBoundingClientRect();if(i.next({width:r,height:s}),!window.ResizeObserver)return;let a=new ResizeObserver(ui((e=>{let t,r,s=e[0];s&&(s.contentBoxSize&&s.contentBoxSize[0]?(r=s.contentBoxSize[0].blockSize,t=s.contentBoxSize[0].inlineSize):s.contentRect&&(t=s.contentRect.width,r=s.contentRect.height),_t(t)&&_t(r)&&i.next({width:t,height:r}))}),t));return a.observe(e),()=>a.disconnect()})),hi=(e,t=6,i=".")=>{let r={};for(let s in e)if(e.hasOwnProperty(s)&&!(e[s]instanceof HTMLElement)&&t)if("object"==typeof e[s]&&null!==e[s]){let a=hi(e[s],t-1);for(let e in a)a.hasOwnProperty(e)&&(r[s+i+e]=a[e])}else r[s]=e[s];return r},pi=e=>{e.removeAttribute("src"),e.load()},fi=e=>{let t;try{t=new URL(e)}catch{return!1}return"https:"===t.protocol},mi=(e,t)=>!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom),gi=(()=>{let e=0;return()=>{let t=e;return e=(e+1)%Number.MAX_SAFE_INTEGER,t}})(),vi=e=>void 0!==e&&""!==e?e:gi().toString();function bi(e,t,i){if(e<=t[0])return i[0];if(e>=t[t.length-1])return i[i.length-1];let r=1;for(;r<t.length&&t[r]<e;)r++;r>=t.length&&(r=t.length-1);let s=t[r-1],a=t[r],n=i[r-1],o=i[r];return e===s?n:e===a?o:n+(e-s)/(a-s)*(o-n)}function yi(e,t,i){if(e<=0||i<0)return[];let r=[],s=t-Math.floor((e-1)/2),a=t+Math.floor(e/2);s<0&&(a+=Math.abs(s),s=0),a>i&&(s-=a-i,a=i),s=Math.max(0,s),a=Math.min(i,a);for(let e=s;e<=a;e++)r.push(e);return r}var Si=e=>t=>i=>{let r="object"==typeof i;null==i||r&&!Object.keys(i).length||e(t,r?hi(i):{value:i})},wi=(e={})=>{let t=e=>{let t=e;return void 0===e?t="undefined":null===e?t="null":("number"==typeof e||"boolean"==typeof e)&&(t=e.toString()),t},i={};for(let r in e)Array.isArray(e[r])?i[r]=e[r].map(t):i[r]=t(e[r]);return i},$i=(r=class e{init({name:t,getParentContext:i},r){this.span=e.rootTracer.startSpan(t,{startTime:r},i?.()),this.context=e.dynamicImports.opentelemetryApi.trace.setSpan(e.dynamicImports.opentelemetryApi.context.active(),this.span)}async loadOpentelemetry(){if("not_started"===e.dynamicImportStatus){e.dynamicImportStatus="in_progress";try{let t=new Promise(((e,t)=>setTimeout(t,this.dynamicImportTimeout))),r=Promise.all([Promise.all([i.e(65852),i.e(90874),i.e("langs/web/65852+90874")]).then(i.bind(i,590874)),Promise.all([i.e(65852),i.e(25817),i.e("langs/web/65852+25817")]).then(i.bind(i,625817)),Promise.all([i.e(92105),i.e("langs/web/92105")]).then(i.bind(i,392105))]),[s,a,n]=await Promise.race([r,t]);e.dynamicImports={opentelemetryApi:s,opentelemetrySdk:a,tracer:n},e.dynamicImportStatus="completed"}catch{e.dynamicImportStatus="failed"}}}isComponentTracerNotInitialized(){return Ct(this.span)||"failed"===e.dynamicImportStatus}log(e,t){let i=Date.now();this.initPromise.then((r=>{this.isComponentTracerNotInitialized()||this.span.addEvent(e,{...wi(t),type:"log"},i)}))}error(e,t){let i=Date.now();this.initPromise.then((r=>{this.isComponentTracerNotInitialized()||this.span.addEvent(e,{...wi(t),type:"error"},i)}))}critical(e,t){let i=Date.now();this.initPromise.then((r=>{this.isComponentTracerNotInitialized()||this.span.addEvent(e,{...wi(t),type:"critical"},i)}))}createComponentTracer(t){let i=new e({name:t,getParentContext:()=>this.context});return this.childTracers.push(i),i}end(){this.initPromise.then((e=>{this.isComponentTracerNotInitialized()||(this.childTracers.forEach((e=>e.end())),this.span.end())}))}constructor({name:t,getParentContext:i}){this.dynamicImportTimeout=5e3,this.childTracers=[],"not_started"===e.dynamicImportStatus&&(e.dynamicImportPromise=this.loadOpentelemetry());let r=Date.now();this.initPromise=e.dynamicImportPromise.then((s=>{"completed"===e.dynamicImportStatus&&this.init({name:t,getParentContext:i},r)}))}},r.dynamicImportStatus="not_started",r),xi=class extends $i{init({name:e,getParentContext:t},i){let r=$i.dynamicImports.tracer.initTracerOpenTelemetry({serviceName:"videoplayer-sdk-web",appToken:"L9SBoka6ZWk4xPjaK7tmfSfYvMhcge7nvGDjpdMmscb",spanLimits:{attributeCountLimit:1/0,eventCountLimit:1/0,attributePerEventCountLimit:1/0}}).getProvider(),s=new $i.dynamicImports.tracer.TracerMemorySpanExporter;this.spanExporter=s,r.addSpanProcessor(new $i.dynamicImports.tracer.TracerAllSpansProcessor({startedSpansExporter:s})),$i.rootTracer=r.getTracer("sdk-videoplayer-tracer"),super.init({name:e,getParentContext:t},i)}getFinishedSpans(){if(!this.isComponentTracerNotInitialized())return this.spanExporter?.getJsonData()}getTraceId(){return this.isComponentTracerNotInitialized()?"":this.span.spanContext().traceId}constructor(){super({name:"Root"})}},ki=class e{log(e,t){}error(e,t){}critical(e,t){}createComponentTracer(t){return new e({name:t})}end(){}getFinishedSpans(){}getTraceId(){return this.fakeTraceId}constructor(e){}},Ti=class{static createRootTracer(e=!1){return e?new xi:new ki}},_i=class extends xt{next(e){this.cursorEnd+=1,this.cursorStart=this.cursorEnd>=this.bufferSize?this.cursorStart+1:0,this.buffer[this.cursorEnd%this.bufferSize]=e,this.subscribers.forEach((t=>t.next(e)))}_subscribe(e){for(let t=this.cursorStart;t<=this.cursorEnd;t++)e.next(this.buffer[t%this.bufferSize]);let t=this.keyCounter++;return this.subscribers.set(t,e),(new gt).add((()=>this.subscribers.delete(t)))}constructor(e){super(),this.buffer=[],this.cursorEnd=-1,this.cursorStart=0,this.bufferSize=e,this.buffer=Array(e)}},Ci=class extends xt{next(e){super.next(this.value=e)}error(e){super.error(this.value=e)}getValue(){return this.value}_subscribe(e){let t=super._subscribe(e);return e.next(this.value),t}constructor(e){super(),this.value=e}},Ei=h(Pe(),1);function Ai(e){return new $t((t=>{let i={},r=Object.keys(e).length;return(0,Ei.default)(e).reduce(((e,[s,a])=>e.add(a.subscribe((e=>s=>{e in i||r--,i[e]=s,0===r&&t.next(i)})(s)))),new gt)}))}function Li(...e){return new $t((t=>e.reduce(((e,i)=>e.add(i.subscribe(t))),new gt)))}var Pi=e=>new $t((t=>{let i=window.setTimeout((()=>{try{t.next()}catch(e){if(!t.error)throw e;t.error(e)}}),e);return()=>window.clearTimeout(i)})),Mi=e=>new $t((t=>{let i=window.setInterval((()=>t.next()),e);return()=>{i&&(window.clearInterval(i),i=void 0)}})),Ii=e=>new $t((t=>{e.forEach((e=>t.next(e)))})),Ri=(e,t)=>new $t((i=>{let r=e=>i.next(e);return e.addEventListener(t,r),()=>e.removeEventListener(t,r)})),Vi=class extends gt{remove(e){this.subscriptions=this.subscriptions.filter((t=>t!==e))}};var Ni={leading:!1,trailing:!0};function Bi(e,t=Ni){return i=>new $t((r=>i.subscribe(new Di(r,e,t))))}var Di=class{next(e){this.lastValue=e,_t(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(e){if(!this.destination.error)throw e;this.destination.error(e)}this.timeout=void 0}),this.time)}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}},Oi={leading:!0,trailing:!1};function Fi(e,t=Oi){return i=>new $t((r=>i.subscribe(new ji(r,e,t))))}var ji=class{next(e){this.lastValue=e,Ct(this.timeout)&&(this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}};function zi(e){return t=>new $t((i=>t.subscribe(new qi(i,e))))}var qi=class{next(e){let t;try{t=this.predicate(e)}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t}},Hi=h(Ve(),1),Ui=(e,t)=>e instanceof Object&&t instanceof Object?((e,t)=>{let i=(e,t)=>{let i=Object.keys(e);for(let r in t)if(!(0,Hi.default)(i,r)||t[r]!==e[r])return!1;return!0};return i(e,t)&&i(t,e)})(e,t):e===t;function Wi(e=Ui){return t=>new $t((i=>t.subscribe(new Gi(i,e))))}var Qi={},Gi=class{next(e){let t;try{t=this.lastValue===Qi||!this.predicate(this.lastValue,e),this.lastValue=e instanceof Object&&!Array.isArray(e)?{...e}:e}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t,this.lastValue=Qi}};function Ki(e){return t=>new $t((i=>t.subscribe(new Yi(i,e))))}var Yi=class{next(e){let t;try{t=this.mapper(e)}catch(e){throw this.error(e),e}this.destination.next(t)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.mapper=t}};function Xi(e){return Ki((()=>e))}function Ji(){return e=>new $t((t=>{let i=!1,r=!1,s=e.subscribe((e=>{i||(i=!0,t.next(e)),r&&s.unsubscribe()}),(e=>{i=!0,t.error?.(e),r&&s.unsubscribe()}));return r=!0,i&&s.unsubscribe(),s}))}function Zi(e){return t=>new $t((i=>t.subscribe(new er(i,e))))}var er=class{next(e){try{this.effect(e)}catch(e){throw this.error(e),e}this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.effect=t}};function tr(e){return t=>new $t((i=>t.subscribe(new ir(i,e))))}var ir=class{next(e){0===this.count?this.destination.next(e):this.count--}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.count=t,t<0&&this.destination.error?.(new Error("Count can not be less than zero"))}};function rr(e=0){return t=>{let i=0,r=new _i(e),s=t.subscribe(r);return new $t((e=>(i++,(e=>()=>{e.unsubscribe(),i--,0===i&&s.unsubscribe()})(r.subscribe(e)))))}}var sr,ar,nr=((sr=nr||{}).NETWORK="network",sr.VIDEO_PIPELINE="video_pipeline",sr.EXTERNAL_API="external_api",sr.PARSER="parser",sr.DOM="dom",sr.WTF="wtf",sr.FATAL="fatal",sr),{NativeAbortSignal:or,NativeAbortController:lr}={NativeAbortSignal:(ar=typeof self<"u"?self:global).AbortSignal,NativeAbortController:ar.AbortController};var ur=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},dr=class extends ur{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}throwIfAborted(){let{aborted:e,reason:t="Aborted"}=this;if(e)throw t}static timeout(e){let t=new cr;return setTimeout((()=>t.abort(new DOMException(`This signal is timeout in ${e}ms`,"TimeoutError"))),e),t.signal}static any(e){let t=new cr;function i(){t.abort(this.reason),function(){for(let t of e)t.removeEventListener("abort",i)}()}for(let r of e){if(r.aborted){t.abort(r.reason);break}r.addEventListener("abort",i)}return t.signal}constructor(){super(),this.listeners||ur.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},cr=class{abort(e){let t=function(e){if(void 0===e)if(typeof document>"u")(e=new Error("This operation was aborted")).name="AbortError";else try{e=new DOMException("signal is aborted without reason"),Object.defineProperty(e,"name",{value:"AbortError"})}catch{(e=new Error("This operation was aborted")).name="AbortError"}return e}(e),i=function(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}return t.reason=e,t}(t);this.signal.reason=t,this.signal.dispatchEvent(i)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new dr,writable:!0,configurable:!0})}};function hr(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(cr.prototype[Symbol.toStringTag]="AbortController",dr.prototype[Symbol.toStringTag]="AbortSignal");var pr,fr="fetch"in window&&hr({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),mr=fr?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s=!1}=e;if(!hr({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s}))return{fetch:t,Request:a};let a=i;(a&&!a.prototype.hasOwnProperty("signal")||s)&&(a=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let s=new i(e,t);return r&&Object.defineProperty(s,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),s},a.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=a&&a.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let s=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([s,n(e,t)])}return n(e,t)},Request:a}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,gr=fr?mr.fetch:window.fetch,vr=(fr?mr.Request:window.Request,fr||window.AbortController,fr||window.AbortSignal,h(Pe(),1)),br=h(ft(),1),yr=(e=>(e.Armenian="58",e.Azerbaijani="57",e.Belarusian="114",e.English="3",e.Kazakh="97",e.Portuguese="73",e.Russian="0",e.Spanish="4",e.Ukrainian="1",e.Uzbek="65",e.Vietnamese="75",e))(yr||{}),Sr=async(e,t,i)=>{let r=new URL("https://vk.com/js/lang-pack.js");r.searchParams.set("format","json"),r.searchParams.set("name",t),void 0!==e&&r.searchParams.set("lang",e);let s=await(await gr(r.toString())).json();return wr(s,i)},wr=(e,t)=>(0,br.default)((0,vr.default)(e.keys).map((([e,i])=>[e.substring(`${t}_`.length),$r(i)]))),$r=e=>Array.isArray(e)?e[0]:e,xr=((pr=xr||{}).RU="ru",pr.EN="en",pr),kr="__vk_vp_internals_exposure",Tr=class{getWindowObject(){if(typeof window>"u")return{};let e=this.playerId,t=this.type;return window[kr]?.[e]?.[t]??{}}initWindowObjects(){if(typeof window>"u")return;let e=this.playerId,t=this.type;window[kr]||(window[kr]={}),window[kr][e]||(window[kr][e]={}),window[kr][e][t]||(window[kr][e][t]={})}expose(e){typeof window>"u"||Object.assign(this.getWindowObject(),e)}destroy(){if(typeof window>"u")return;let e=this.playerId,t=this.type;window[kr]&&window[kr][e]&&window[kr][e][t]&&(delete window[kr][e][t],Object.keys(window[kr][e]).length||delete window[kr][e],Object.keys(window[kr]).length||delete window[kr])}constructor(e,t){this.playerId=t,this.type=e,this.initWindowObjects()}},_r={};c(_r,{create:()=>Er,destroy:()=>Ar,push:()=>Lr,subscribe:()=>Pr});var Cr=new Map,Er=(e,t)=>Cr.set(e,t??[]),Ar=e=>Cr.delete(e),Lr=(e,t)=>{let i=Cr.get(e);i&&("function"==typeof i?i(t):i.push(t))},Pr=(e,t)=>{let i=Cr.get(e);if(i){if(i&&Array.isArray(i))for(let e of i)t(e);Cr.set(e,t)}}},89923:(e,t,i)=>{i.d(t,{ApiEnv:()=>mi,InteractiveInterfaceClick:()=>Si,MediascopePixel:()=>Hr,OneStat:()=>ur,SeekAction:()=>yi,ThinOneStat:()=>dr,VERSION:()=>Ri});var r,s,a,n,o,l,u=i(819705),d=i(773439),c=Object.create,h=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),b=(e,t,i)=>(i=null!=e?c(m(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of f(t))!g.call(e,s)&&s!==i&&h(e,s,{get:()=>t[s],enumerable:!(r=p(t,s))||r.enumerable});return e})(!t&&e&&e.__esModule?i:h(i,"default",{value:e,enumerable:!0}),e)),y=v(((e,t)=>{"use strict";var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),S=v(((e,t)=>{"use strict";t.exports=function(e){try{return!!e()}catch{return!0}}})),w=v(((e,t)=>{"use strict";var i=S();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),$=v(((e,t)=>{"use strict";var i=w(),r=Function.prototype,s=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(s):function(){return a.apply(s,arguments)})})),x=v(((e,t)=>{"use strict";var i=w(),r=Function.prototype,s=r.call,a=i&&r.bind.bind(s,s);t.exports=i?a:function(e){return function(){return s.apply(e,arguments)}}})),k=v(((e,t)=>{"use strict";var i=x(),r=i({}.toString),s=i("".slice);t.exports=function(e){return s(r(e),8,-1)}})),T=v(((e,t)=>{"use strict";var i=k(),r=x();t.exports=function(e){if("Function"===i(e))return r(e)}})),_=v(((e,t)=>{"use strict";var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),C=v(((e,t)=>{"use strict";var i=S();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),E=v(((e,t)=>{"use strict";var i=w(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),A=v((e=>{"use strict";var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),L=v(((e,t)=>{"use strict";t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),P=v(((e,t)=>{"use strict";var i=x(),r=S(),s=k(),a=Object,n=i("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?n(e,""):a(e)}:a})),M=v(((e,t)=>{"use strict";t.exports=function(e){return null==e}})),I=v(((e,t)=>{"use strict";var i=M(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),R=v(((e,t)=>{"use strict";var i=P(),r=I();t.exports=function(e){return i(r(e))}})),V=v(((e,t)=>{"use strict";var i=_();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),N=v(((e,t)=>{"use strict";t.exports={}})),B=v(((e,t)=>{"use strict";var i=N(),r=y(),s=_(),a=function(e){return s(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?a(i[e])||a(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),D=v(((e,t)=>{"use strict";var i=x();t.exports=i({}.isPrototypeOf)})),O=v(((e,t)=>{"use strict";var i=y().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),F=v(((e,t)=>{"use strict";var i,r,s=y(),a=O(),n=s.process,o=s.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&a&&((!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=a.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),j=v(((e,t)=>{"use strict";var i=F(),r=S(),s=y().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),z=v(((e,t)=>{"use strict";var i=j();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),q=v(((e,t)=>{"use strict";var i=B(),r=_(),s=D(),a=z(),n=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&s(t.prototype,n(e))}})),H=v(((e,t)=>{"use strict";var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),U=v(((e,t)=>{"use strict";var i=_(),r=H(),s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not a function")}})),W=v(((e,t)=>{"use strict";var i=U(),r=M();t.exports=function(e,t){var s=e[t];return r(s)?void 0:i(s)}})),Q=v(((e,t)=>{"use strict";var i=E(),r=_(),s=V(),a=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!s(o=i(n,e))||r(n=e.valueOf)&&!s(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!s(o=i(n,e)))return o;throw new a("Can't convert object to primitive value")}})),G=v(((e,t)=>{"use strict";t.exports=!0})),K=v(((e,t)=>{"use strict";var i=y(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),Y=v(((e,t)=>{"use strict";var i=G(),r=y(),s=K(),a="__core-js_shared__",n=t.exports=r[a]||s(a,{});(n.versions||(n.versions=[])).push({version:"3.43.0",mode:i?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.43.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),X=v(((e,t)=>{"use strict";var i=Y();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),J=v(((e,t)=>{"use strict";var i=I(),r=Object;t.exports=function(e){return r(i(e))}})),Z=v(((e,t)=>{"use strict";var i=x(),r=J(),s=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return s(r(e),t)}})),ee=v(((e,t)=>{"use strict";var i=x(),r=0,s=Math.random(),a=i(1.1.toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+s,36)}})),te=v(((e,t)=>{"use strict";var i=y(),r=X(),s=Z(),a=ee(),n=j(),o=z(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return s(u,e)||(u[e]=n&&s(l,e)?l[e]:d("Symbol."+e)),u[e]}})),ie=v(((e,t)=>{"use strict";var i=E(),r=V(),s=q(),a=W(),n=Q(),o=te(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||s(e))return e;var o,d=a(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||s(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),re=v(((e,t)=>{"use strict";var i=ie(),r=q();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),se=v(((e,t)=>{"use strict";var i=y(),r=V(),s=i.document,a=r(s)&&r(s.createElement);t.exports=function(e){return a?s.createElement(e):{}}})),ae=v(((e,t)=>{"use strict";var i=C(),r=S(),s=se();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))})),ne=v((e=>{"use strict";var t=C(),i=E(),r=A(),s=L(),a=R(),n=re(),o=Z(),l=ae(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=a(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return s(!i(r.f,e,t),e[t])}})),oe=v(((e,t)=>{"use strict";var i=S(),r=_(),s=/#|\.prototype\./,a=function(e,t){var s=o[n(e)];return s===u||s!==l&&(r(t)?i(t):!!t)},n=a.normalize=function(e){return String(e).replace(s,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a})),le=v(((e,t)=>{"use strict";var i=T(),r=U(),s=w(),a=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:s?a(e,t):function(){return e.apply(t,arguments)}}})),ue=v(((e,t)=>{"use strict";var i=C(),r=S();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),de=v(((e,t)=>{"use strict";var i=V(),r=String,s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not an object")}})),ce=v((e=>{"use strict";var t=C(),i=ae(),r=ue(),s=de(),a=re(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(s(e),t=a(t),s(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(s(e),t=a(t),s(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),he=v(((e,t)=>{"use strict";var i=C(),r=ce(),s=L();t.exports=i?function(e,t,i){return r.f(e,t,s(1,i))}:function(e,t,i){return e[t]=i,e}})),pe=v(((e,t)=>{"use strict";var i=y(),r=$(),s=T(),a=_(),n=ne().f,o=oe(),l=N(),u=le(),d=he(),c=Z();Y();var h=function(e){var t=function(i,s,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,s)}return new e(i,s,a)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,b,y,S,w=e.target,$=e.global,x=e.stat,k=e.proto,T=$?i:x?i[w]:i[w]&&i[w].prototype,_=$?l:l[w]||d(l,w,{})[w],C=_.prototype;for(m in t)p=!(r=o($?m:w+(x?".":"#")+m,e.forced))&&T&&c(T,m),v=_[m],p&&(e.dontCallGetSet?b=(S=n(T,m))&&S.value:b=T[m]),g=p&&b?b:t[m],(r||k||typeof v!=typeof g)&&(y=e.bind&&p?u(g,i):e.wrap&&p?h(g):k&&a(g)?s(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(y,"sham",!0),d(_,m,y),k&&(c(l,f=w+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&C&&(r||!C[m])&&d(C,m,g)))}})),fe=v(((e,t)=>{"use strict";var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),me=v(((e,t)=>{"use strict";var i=fe();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),ge=v(((e,t)=>{"use strict";var i=me(),r=Math.max,s=Math.min;t.exports=function(e,t){var a=i(e);return a<0?r(a+t,0):s(a,t)}})),ve=v(((e,t)=>{"use strict";var i=me(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),be=v(((e,t)=>{"use strict";var i=ve();t.exports=function(e){return i(e.length)}})),ye=v(((e,t)=>{"use strict";var i=R(),r=ge(),s=be(),a=function(e){return function(t,a,n){var o=i(t),l=s(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&a!=a){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===a)return e||d||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),Se=v(((e,t)=>{"use strict";t.exports=function(){}})),we=v((()=>{"use strict";var e=pe(),t=ye().includes,i=S(),r=Se();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),$e=v(((e,t)=>{"use strict";var i=B();t.exports=i})),xe=v(((e,t)=>{"use strict";we();var i=$e();t.exports=i("Array","includes")})),ke=v(((e,t)=>{"use strict";var i=xe();t.exports=i})),Te=v(((e,t)=>{"use strict";var i=ke();t.exports=i})),_e=v(((e,t)=>{"use strict";var i={};i[te()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Ce=v(((e,t)=>{"use strict";var i=_e(),r=_(),s=k(),a=te()("toStringTag"),n=Object,o="Arguments"===s(function(){return arguments}());t.exports=i?s:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),a))?i:o?s(t):"Object"===(l=s(t))&&r(t.callee)?"Arguments":l}})),Ee=v(((e,t)=>{"use strict";var i=Ce(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),Ae=v(((e,t)=>{"use strict";var i=me(),r=Ee(),s=I(),a=RangeError;t.exports=function(e){var t=r(s(this)),n="",o=i(e);if(o<0||o===1/0)throw new a("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),Le=v(((e,t)=>{"use strict";var i=x(),r=ve(),s=Ee(),a=Ae(),n=I(),o=i(a),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,a){var d,c,h=s(n(t)),p=r(i),f=h.length,m=void 0===a?" ":s(a);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),Pe=v(((e,t)=>{"use strict";var i=O();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),Me=v((()=>{"use strict";var e=pe(),t=Le().start;e({target:"String",proto:!0,forced:Pe()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),Ie=v(((e,t)=>{"use strict";Me();var i=$e();t.exports=i("String","padStart")})),Re=v(((e,t)=>{"use strict";var i=Ie();t.exports=i})),Ve=v(((e,t)=>{"use strict";var i=Re();t.exports=i})),Ne=v((()=>{})),Be=v(((e,t)=>{"use strict";var i=y(),r=O(),s=k(),a=function(e){return r.slice(0,e.length)===e};t.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===s(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),De=v(((e,t)=>{"use strict";var i=Be();t.exports="NODE"===i})),Oe=v(((e,t)=>{"use strict";var i=he();t.exports=function(e,t,r,s){return s&&s.enumerable?e[t]=r:i(e,t,r),e}})),Fe=v(((e,t)=>{"use strict";var i=x(),r=U();t.exports=function(e,t,s){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}}})),je=v(((e,t)=>{"use strict";var i=V();t.exports=function(e){return i(e)||null===e}})),ze=v(((e,t)=>{"use strict";var i=je(),r=String,s=TypeError;t.exports=function(e){if(i(e))return e;throw new s("Can't set "+r(e)+" as a prototype")}})),qe=v(((e,t)=>{"use strict";var i=Fe(),r=V(),s=I(),a=ze();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return s(i),a(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),He=v(((e,t)=>{"use strict";var i=_e(),r=Ce();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Ue=v(((e,t)=>{"use strict";var i=_e(),r=ce().f,s=he(),a=Z(),n=He(),o=te()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(a(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&s(d,"toString",n))}})),We=v(((e,t)=>{"use strict";var i=ce();t.exports=function(e,t,r){return i.f(e,t,r)}})),Qe=v(((e,t)=>{"use strict";var i=B(),r=We(),s=te(),a=C(),n=s("species");t.exports=function(e){var t=i(e);a&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),Ge=v(((e,t)=>{"use strict";var i=D(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),Ke=v(((e,t)=>{"use strict";var i=x(),r=_(),s=Y(),a=i(Function.toString);r(s.inspectSource)||(s.inspectSource=function(e){return a(e)}),t.exports=s.inspectSource})),Ye=v(((e,t)=>{"use strict";var i=x(),r=S(),s=_(),a=Ce(),n=B(),o=Ke(),l=function(){},u=n("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!s(e))return!1;try{return u(l,[],e),!0}catch{return!1}},f=function(e){if(!s(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch{return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),Xe=v(((e,t)=>{"use strict";var i=Ye(),r=H(),s=TypeError;t.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not a constructor")}})),Je=v(((e,t)=>{"use strict";var i=de(),r=Xe(),s=M(),a=te()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||s(n=i(o)[a])?t:r(n)}})),Ze=v(((e,t)=>{"use strict";var i=B();t.exports=i("document","documentElement")})),et=v(((e,t)=>{"use strict";var i=x();t.exports=i([].slice)})),tt=v(((e,t)=>{"use strict";var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),it=v(((e,t)=>{"use strict";var i=O();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),rt=v(((e,t)=>{"use strict";var i,r,s,a,n=y(),o=$(),l=le(),u=_(),d=Z(),c=S(),h=Ze(),p=et(),f=se(),m=tt(),g=it(),v=De(),b=n.setImmediate,w=n.clearImmediate,x=n.process,k=n.Dispatch,T=n.Function,C=n.MessageChannel,E=n.String,A=0,L={},P="onreadystatechange";c((function(){i=n.location}));var M=function(e){if(d(L,e)){var t=L[e];delete L[e],t()}},I=function(e){return function(){M(e)}},R=function(e){M(e.data)},V=function(e){n.postMessage(E(e),i.protocol+"//"+i.host)};(!b||!w)&&(b=function(e){m(arguments.length,1);var t=u(e)?e:T(e),i=p(arguments,1);return L[++A]=function(){o(t,void 0,i)},r(A),A},w=function(e){delete L[e]},v?r=function(e){x.nextTick(I(e))}:k&&k.now?r=function(e){k.now(I(e))}:C&&!g?(a=(s=new C).port2,s.port1.onmessage=R,r=l(a.postMessage,a)):n.addEventListener&&u(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!c(V)?(r=V,n.addEventListener("message",R,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),M(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:b,clear:w}})),st=v(((e,t)=>{"use strict";var i=y(),r=C(),s=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=s(i,e);return t&&t.value}})),at=v(((e,t)=>{"use strict";var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),nt=v(((e,t)=>{"use strict";var i=O();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),ot=v(((e,t)=>{"use strict";var i=O();t.exports=/web0s(?!.*chrome)/i.test(i)})),lt=v(((e,t)=>{"use strict";var i,r,s,a,n,o,l,u=y(),d=st(),c=le(),h=rt().set,p=at(),f=it(),m=nt(),g=ot(),v=De(),b=u.MutationObserver||u.WebKitMutationObserver,S=u.document,w=u.process,$=u.Promise,x=d("queueMicrotask");x||(o=new p,l=function(){var e,t;for(v&&(e=w.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||v||g||!b||!S?!m&&$&&$.resolve?((a=$.resolve(void 0)).constructor=$,n=c(a.then,a),i=function(){n(l)}):v?i=function(){w.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,s=S.createTextNode(""),new b(l).observe(s,{characterData:!0}),i=function(){s.data=r=!r}),x=function(e){o.head||i(),o.add(e)}),t.exports=x})),ut=v(((e,t)=>{"use strict";t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),dt=v(((e,t)=>{"use strict";t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),ct=v(((e,t)=>{"use strict";var i=y(),r=_(),s=i.WeakMap;t.exports=r(s)&&/native code/.test(String(s))})),ht=v(((e,t)=>{"use strict";var i=X(),r=ee(),s=i("keys");t.exports=function(e){return s[e]||(s[e]=r(e))}})),pt=v(((e,t)=>{"use strict";t.exports={}})),ft=v(((e,t)=>{"use strict";var i,r,s,a,n,o=ct(),l=y(),u=V(),d=he(),c=Z(),h=Y(),p=ht(),f=pt(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||h.state?((a=h.state||(h.state=new v)).get=a.get,a.has=a.has,a.set=a.set,i=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},s=function(e){return a.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(c(e,n))throw new g(m);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},s=function(e){return c(e,n)}),t.exports={set:i,get:r,has:s,enforce:function(e){return s(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),mt=v(((e,t)=>{"use strict";var i=y();t.exports=i.Promise})),gt=v(((e,t)=>{"use strict";var i=y(),r=mt(),s=_(),a=oe(),n=Ke(),o=te(),l=Be(),u=G(),d=F(),c=r&&r.prototype,h=o("species"),p=!1,f=s(i.PromiseRejectionEvent),m=a("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),s=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=s,!(p=i.then((function(){}))instanceof s))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),vt=v(((e,t)=>{"use strict";var i=U(),r=TypeError,s=function(e){var t,s;this.promise=new e((function(e,i){if(void 0!==t||void 0!==s)throw new r("Bad Promise constructor");t=e,s=i})),this.resolve=i(t),this.reject=i(s)};t.exports.f=function(e){return new s(e)}})),bt=v((()=>{"use strict";var e,t,i,r,s=pe(),a=G(),n=De(),o=y(),l=N(),u=E(),d=Oe(),c=qe(),h=Ue(),p=Qe(),f=U(),m=_(),g=V(),v=Ge(),b=Je(),S=rt().set,w=lt(),$=ut(),x=dt(),k=at(),T=ft(),C=mt(),A=gt(),L=vt(),P="Promise",M=A.CONSTRUCTOR,I=A.REJECTION_EVENT,R=A.SUBCLASSING,B=T.getterFor(P),D=T.set,O=C&&C.prototype,F=C,j=O,z=o.TypeError,q=o.document,H=o.process,W=L.f,Q=W,K=!!(q&&q.createEvent&&o.dispatchEvent),Y="unhandledrejection",X=function(e){var t;return!(!g(e)||!m(t=e.then))&&t},J=function(e,t){var i,r,s,a=t.value,n=1===t.state,o=n?e.ok:e.fail,l=e.resolve,d=e.reject,c=e.domain;try{o?(n||(2===t.rejection&&re(t),t.rejection=1),!0===o?i=a:(c&&c.enter(),i=o(a),c&&(c.exit(),s=!0)),i===e.promise?d(new z("Promise-chain cycle")):(r=X(i))?u(r,i,l,d):l(i)):d(a)}catch(e){c&&!s&&c.exit(),d(e)}},Z=function(e,t){e.notified||(e.notified=!0,w((function(){for(var i,r=e.reactions;i=r.get();)J(i,e);e.notified=!1,t&&!e.rejection&&te(e)})))},ee=function(e,t,i){var r,s;K?((r=q.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),o.dispatchEvent(r)):r={promise:t,reason:i},!I&&(s=o["on"+e])?s(r):e===Y&&$("Unhandled promise rejection",i)},te=function(e){u(S,o,(function(){var t,i=e.facade,r=e.value;if(ie(e)&&(t=x((function(){n?H.emit("unhandledRejection",r,i):ee(Y,i,r)})),e.rejection=n||ie(e)?2:1,t.error))throw t.value}))},ie=function(e){return 1!==e.rejection&&!e.parent},re=function(e){u(S,o,(function(){var t=e.facade;n?H.emit("rejectionHandled",t):ee("rejectionhandled",t,e.value)}))},se=function(e,t,i){return function(r){e(t,r,i)}},ae=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Z(e,!0))},ne=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new z("Promise can't be resolved itself");var r=X(t);r?w((function(){var i={done:!1};try{u(r,t,se(ne,i,e),se(ae,i,e))}catch(t){ae(i,t,e)}})):(e.value=t,e.state=1,Z(e,!1))}catch(t){ae({done:!1},t,e)}}};if(M&&(j=(F=function(t){v(this,j),f(t),u(e,this);var i=B(this);try{t(se(ne,i),se(ae,i))}catch(e){ae(i,e)}}).prototype,(e=function(e){D(this,{type:P,done:!1,notified:!1,parent:!1,reactions:new k,rejection:!1,state:0,value:null})}).prototype=d(j,"then",(function(e,t){var i=B(this),r=W(b(this,F));return i.parent=!0,r.ok=!m(e)||e,r.fail=m(t)&&t,r.domain=n?H.domain:void 0,0===i.state?i.reactions.add(r):w((function(){J(r,i)})),r.promise})),t=function(){var t=new e,i=B(t);this.promise=t,this.resolve=se(ne,i),this.reject=se(ae,i)},L.f=W=function(e){return e===F||e===i?new t(e):Q(e)},!a&&m(C)&&O!==Object.prototype)){r=O.then,R||d(O,"then",(function(e,t){var i=this;return new F((function(e,t){u(r,i,e,t)})).then(e,t)}),{unsafe:!0});try{delete O.constructor}catch{}c&&c(O,j)}s({global:!0,constructor:!0,wrap:!0,forced:M},{Promise:F}),i=l.Promise,h(F,P,!1,!0),p(P)})),yt=v(((e,t)=>{"use strict";t.exports={}})),St=v(((e,t)=>{"use strict";var i=te(),r=yt(),s=i("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[s]===e)}})),wt=v(((e,t)=>{"use strict";var i=Ce(),r=W(),s=M(),a=yt(),n=te()("iterator");t.exports=function(e){if(!s(e))return r(e,n)||r(e,"@@iterator")||a[i(e)]}})),$t=v(((e,t)=>{"use strict";var i=E(),r=U(),s=de(),a=H(),n=wt(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return s(i(l,e));throw new o(a(e)+" is not iterable")}})),xt=v(((e,t)=>{"use strict";var i=E(),r=de(),s=W();t.exports=function(e,t,a){var n,o;r(e);try{if(!(n=s(e,"return"))){if("throw"===t)throw a;return a}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw a;if(o)throw n;return r(n),a}})),kt=v(((e,t)=>{"use strict";var i=le(),r=E(),s=de(),a=H(),n=St(),o=be(),l=D(),u=$t(),d=wt(),c=xt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,b,y,S,w,$,x=m&&m.that,k=!(!m||!m.AS_ENTRIES),T=!(!m||!m.IS_RECORD),_=!(!m||!m.IS_ITERATOR),C=!(!m||!m.INTERRUPTED),E=i(t,x),A=function(e){return g&&c(g,"normal"),new p(!0,e)},L=function(e){return k?(s(e),C?E(e[0],e[1],A):E(e[0],e[1])):C?E(e,A):E(e)};if(T)g=e.iterator;else if(_)g=e;else{if(!(v=d(e)))throw new h(a(e)+" is not iterable");if(n(v)){for(b=0,y=o(e);y>b;b++)if((S=L(e[b]))&&l(f,S))return S;return new p(!1)}g=u(e,v)}for(w=T?e.next:g.next;!($=r(w,g)).done;){try{S=L($.value)}catch(e){c(g,"throw",e)}if("object"==typeof S&&S&&l(f,S))return S}return new p(!1)}})),Tt=v(((e,t)=>{"use strict";var i,r,s=te()("iterator"),a=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){a=!0}})[s]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!a)return!1}catch{return!1}var i=!1;try{var r={};r[s]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),_t=v(((e,t)=>{"use strict";var i=mt(),r=Tt(),s=gt().CONSTRUCTOR;t.exports=s||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),Ct=v((()=>{"use strict";var e=pe(),t=E(),i=U(),r=vt(),s=dt(),a=kt();e({target:"Promise",stat:!0,forced:_t()},{all:function(e){var n=this,o=r.f(n),l=o.resolve,u=o.reject,d=s((function(){var r=i(n.resolve),s=[],o=0,d=1;a(e,(function(e){var i=o++,a=!1;d++,t(r,n,e).then((function(e){a||(a=!0,s[i]=e,--d||l(s))}),u)})),--d||l(s)}));return d.error&&u(d.value),o.promise}})})),Et=v((()=>{"use strict";var e,t=pe(),i=G(),r=gt().CONSTRUCTOR,s=mt(),a=B(),n=_(),o=Oe(),l=s&&s.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(s)&&(e=a("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),At=v((()=>{"use strict";var e=pe(),t=E(),i=U(),r=vt(),s=dt(),a=kt();e({target:"Promise",stat:!0,forced:_t()},{race:function(e){var n=this,o=r.f(n),l=o.reject,u=s((function(){var r=i(n.resolve);a(e,(function(e){t(r,n,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),Lt=v((()=>{"use strict";var e=pe(),t=vt();e({target:"Promise",stat:!0,forced:gt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),Pt=v(((e,t)=>{"use strict";var i=de(),r=V(),s=vt();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var a=s.f(e);return(0,a.resolve)(t),a.promise}})),Mt=v((()=>{"use strict";var e=pe(),t=B(),i=G(),r=mt(),s=gt().CONSTRUCTOR,a=Pt(),n=t("Promise"),o=i&&!s;e({target:"Promise",stat:!0,forced:i||s},{resolve:function(e){return a(o&&this===n?r:this,e)}})})),It=v((()=>{"use strict";bt(),Ct(),Et(),At(),Lt(),Mt()})),Rt=v((()=>{"use strict";var e,t=pe(),i=G(),r=mt(),s=S(),a=B(),n=_(),o=Je(),l=Pt(),u=Oe(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&s((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,a("Promise")),i=n(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=a("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),Vt=v(((e,t)=>{"use strict";Ne(),It(),Rt();var i=$e();t.exports=i("Promise","finally")})),Nt=v(((e,t)=>{"use strict";var i=Vt();t.exports=i})),Bt=v(((e,t)=>{"use strict";var i=Nt();t.exports=i})),Dt=v(((e,t)=>{"use strict";var i=S();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),Ot=v(((e,t)=>{"use strict";var i=Z(),r=_(),s=J(),a=ht(),n=Dt(),o=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=s(e);if(i(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?u:null}})),Ft=v(((e,t)=>{"use strict";var i=x(),r=Z(),s=R(),a=ye().indexOf,n=pt(),o=i([].push);t.exports=function(e,t){var i,l=s(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~a(d,i)||o(d,i));return d}})),jt=v(((e,t)=>{"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),zt=v(((e,t)=>{"use strict";var i=Ft(),r=jt();t.exports=Object.keys||function(e){return i(e,r)}})),qt=v(((e,t)=>{"use strict";var i=C(),r=S(),s=x(),a=Ot(),n=zt(),o=R(),l=s(A().f),u=s([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,s=o(t),c=n(s),h=d&&null===a(s),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in s:l(s,r)))&&u(m,e?[r,s[r]]:s[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ht=v((()=>{"use strict";var e=pe(),t=qt().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Ut=v(((e,t)=>{"use strict";Ht();var i=N();t.exports=i.Object.entries})),Wt=v(((e,t)=>{"use strict";var i=Ut();t.exports=i})),Qt=v(((e,t)=>{"use strict";var i=Wt();t.exports=i})),Gt=v(((e,t)=>{"use strict";var i=C(),r=Z(),s=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,n=r(s,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&a(s,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),Kt=v((e=>{"use strict";var t=C(),i=ue(),r=ce(),s=de(),a=R(),n=zt();e.f=t&&!i?Object.defineProperties:function(e,t){s(e);for(var i,o=a(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),Yt=v(((e,t)=>{"use strict";var i,r=de(),s=Kt(),a=jt(),n=pt(),o=Ze(),l=se(),u=ht(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=a.length;e--;)delete g[d][a[e]];return g()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:s.f(i,t)}})),Xt=v(((e,t)=>{"use strict";var i,r,s,a=S(),n=_(),o=V(),l=Yt(),u=Ot(),d=Oe(),c=te(),h=G(),p=c("iterator"),f=!1;[].keys&&("next"in(s=[].keys())?(r=u(u(s)))!==Object.prototype&&(i=r):f=!0),!o(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),Jt=v(((e,t)=>{"use strict";var i=Xt().IteratorPrototype,r=Yt(),s=L(),a=Ue(),n=yt(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:s(+!u,l)}),a(e,d,!1,!0),n[d]=o,e}})),Zt=v(((e,t)=>{"use strict";var i=pe(),r=E(),s=G(),a=Gt(),n=_(),o=Jt(),l=Ot(),u=qe(),d=Ue(),c=he(),h=Oe(),p=te(),f=yt(),m=Xt(),g=a.PROPER,v=a.CONFIGURABLE,b=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,S=p("iterator"),w="keys",$="values",x="entries",k=function(){return this};t.exports=function(e,t,a,p,m,T,_){o(a,t,p);var C,E,A,L=function(e){if(e===m&&V)return V;if(!y&&e&&e in I)return I[e];switch(e){case w:case $:case x:return function(){return new a(this,e)}}return function(){return new a(this)}},P=t+" Iterator",M=!1,I=e.prototype,R=I[S]||I["@@iterator"]||m&&I[m],V=!y&&R||L(m),N="Array"===t&&I.entries||R;if(N&&((C=l(N.call(new e)))!==Object.prototype&&C.next&&(!s&&l(C)!==b&&(u?u(C,b):n(C[S])||h(C,S,k)),d(C,P,!0,!0),s&&(f[P]=k))),g&&m===$&&R&&R.name!==$&&(!s&&v?c(I,"name",$):(M=!0,V=function(){return r(R,this)})),m)if(E={values:L($),keys:T?V:L(w),entries:L(x)},_)for(A in E)(y||M||!(A in I))&&h(I,A,E[A]);else i({target:t,proto:!0,forced:y||M},E);return(!s||_)&&I[S]!==V&&h(I,S,V,{name:m}),f[t]=V,E}})),ei=v(((e,t)=>{"use strict";t.exports=function(e,t){return{value:e,done:t}}})),ti=v(((e,t)=>{"use strict";var i=R(),r=Se(),s=yt(),a=ft(),n=ce().f,o=Zt(),l=ei(),u=G(),d=C(),c="Array Iterator",h=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=s.Arguments=s.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),ii=v(((e,t)=>{"use strict";var i=C(),r=ce(),s=L();t.exports=function(e,t,a){i?r.f(e,t,s(0,a)):e[t]=a}})),ri=v((()=>{"use strict";var e=pe(),t=kt(),i=ii();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),si=v(((e,t)=>{"use strict";ti(),ri();var i=N();t.exports=i.Object.fromEntries})),ai=v(((e,t)=>{"use strict";t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),ni=v((()=>{"use strict";ti();var e,t=ai(),i=y(),r=Ue(),s=yt();for(e in t)r(i[e],e),s[e]=s.Array})),oi=v(((e,t)=>{"use strict";var i=si();ni(),t.exports=i})),li=v(((e,t)=>{"use strict";var i=oi();t.exports=i})),ui=v((()=>{"use strict";var e=pe(),t=qt().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),di=v(((e,t)=>{"use strict";ui();var i=N();t.exports=i.Object.values})),ci=v(((e,t)=>{"use strict";var i=di();t.exports=i})),hi=v(((e,t)=>{"use strict";var i=ci();t.exports=i})),pi=b(Te(),1),fi=(e,t,i)=>{if("function"==typeof e.canParse)return e.canParse(t,i);try{return new e(t,i),!0}catch{return!1}},mi=((a=mi||{}).PROD="prod",a.VK_ALIAS="vk_alias",a.VIDEOTEST="videotest",a.TEST="test",a.OKCDN="okcdn",a.AUTO="auto",a),gi=((s=gi||{}).Q144P="mobile",s.Q240P="lowest",s.Q360P="low",s.Q480P="medium",s.Q720P="high",s.Q1080P="fullhd",s.Q1440P="quadhd",s.Q2160P="ultrahd",s.UNKNOWN="unknown",s),vi=((r=vi||{}).MP4="mp4",r.DASH="dash",r.DASH_SEP="dash_sep",r.ONDEMAND_DASH="ondemand_dash",r.HLS="hls",r.HLS_FMP4="hls_fmp4",r.ONDEMAND_HLS="ondemand_hls",r.WEBM="webm",r.AV1="av1",r.ONDEMAND_DASH_LIVE="ondemand_dash_live",r.ONDEMAND_HLS_LIVE="ondemand_hls_live",r.WEBRTC="webrtc",r.UNKNOWN="unknown",r.RTMP="rtmp",r),bi=((n=bi||{}).HTTP1="http1",n.HTTP2="http2",n.HTTP3="http3",n),yi=((l=yi||{}).SLIDER="slider",l.DOUBLE_TAP="double_tap",l.TIME_CODE="time_code",l.EPISODE="episode",l.REWIND="rewind",l.LIVE="live",l.UNKNOWN="unknown",l),Si=((o=Si||{}).GRAPH_SHOW="iGraphShow",o.GRAPH_HIDE="iGraphHide",o.NEXT_AREA="iNextChapterArea",o.NEXT_BUTTON="iNextChapterBtn",o.WATCH_AGAIN="iWatchAgainBtn",o),wi={action_play:"ap",action_play_interactive:"api",first_bytes:"fb",player_ready:"pr",first_frame:"ff",seek:"sk",watch_coverage_record:"wr",watch_coverage_live:"wl",empty_buffer:"eb",action_stop:"as",close_at_empty_buffer:"cb",content_error:"er",player_interface_click:"pc",next_movie:"nm",track_switch:"ts",failover:"fo",quality:"qt"},$i={vsid:"si",isid:"is",vid:"vi",place:"pl",quality:"qt",cdn_host:"ch",stat_type:"st",param:"pm",vk_app_id:"va",track_code:"tc",connection_type:"cnt",connection_reused:"cr",cached_data:"cd",live:"lv",muted:"mu",mode:"mo",subtitles:"sb",failover:"fo",download_speed:"ds",manual_quality:"mq",ref_domain:"rd",direct_url:"du"},xi={unknown:"un",mobile:"m",lowest:"ls",low:"l",medium:"md",high:"h",fullhd:"f",quadhd:"q",ultrahd:"u"},ki={pip:"pi",fullscreen:"fs",external:"ex",prefetch:"pr",airplay:"ap",chromecast:"cc",invisible:"iv",minimal:"minimal"},Ti={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},_i={apiEnv:"vk_alias",apiKey:"CIOPGQJGDIHBABABA",apiBaseUrl:null,requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageInterval:15e3,disabledOperations:["quality"],disabledCustomFields:[],shorten:!0,maxLoops:100,embedUrlParams:[],useBeacon:!0,synchronizeTime:!0,debugLog:!1,clearStorageAtUnload:!0,useVKComIsMobileLogic:!1,backoff:{start:1e3,factor:1.5,max:3e5,random:.1},useKeepalive:!1,watchCoverageTimeoutFix:!1};var Ci,Ei=b(Ve(),1),Ai=class e{static getVSID(){return e.vsid}static generateVSID(){return e.vsid=(0,Ei.default)(Math.floor(Math.random()*2**32).toString(36),13,"0"),e.vsid}},Li=b(Bt(),1),Pi=b(Qt(),1),Mi=b(li(),1),Ii=e=>{let{operation:t,custom:i}=e,r=(0,Mi.default)((0,Pi.default)(i).map((([e,t])=>{let i=t;return t&&("mode"===e?i=ki[t]??t:"quality"===e&&(i=xi[t]??t)),[$i[e]??e,i]})));return{...e,operation:wi[t]??t,custom:r}},Ri="1.0.95",Vi=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,Ni=class{async authorize(e){return this.authToken=e??await this.refreshAuthToken(),this._authorizeWithBackoff()}logBeacon(e){let t=this.createLogParams(e),i=this.sessionKey;i&&(this.params.apiTransport.sendBeacon("log.externalLog",t,i)||this.logRequest(e).catch((()=>{})))}async logRequest(e){let t="log.externalLog",i=this.createLogParams(e),r=this.sessionKey??await this._authorizeWithBackoff();if(!r)return;let s=async(e,a=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(t,i,r)}catch(i){if(!i||!("error_code"in i))return void this.params.error$.next({id:"logRequestUnknown",category:u.ErrorCategory.NETWORK,message:`Unknown ${t} error`,thrown:i});let r=i?.error_code;switch(r){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this._authorizeWithBackoff(),a>0?s(e,a-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this._authorizeWithBackoff(),a>0?s(e,a-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${r}`,category:u.ErrorCategory.EXTERNAL_API,message:`${t} error`,data:i})}}};return s(e)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,Li.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(e){let t="WEB",i=!1,r=`@vkontakte/videoplayer-statistics:${Ri}`;if(this.params.config.useVKComIsMobileLogic){let{appVersion:e}=window.navigator;i=Vi.test(e)}else this.params.mobile&&(i=!0);return i&&(t="M_WEB"),this.params.vktvVersion&&(t="SMART_TV",r=this.params.vktvVersion),{collector:"ok.mobile.apps.video",data:JSON.stringify({application:r,platform:t,items:this.params.config.shorten?e.map(Ii):e})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();let e=(0,u.getExponentialDelay)(this.consequentAuthErrors,this.params.config.backoff);return new Promise((t=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{(0,Li.default)(this._authorize().then(t).catch((e=>this.params.error$.next({id:"AuthorizeBackoff",category:u.ErrorCategory.NETWORK,message:"Otherwise unhandled error in authorization",thrown:e}))),(()=>this.backoffTimeoutId=0))}),e))}))}async _authorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let e={session_data:{version:2,device_id:this.params.deviceId,client_version:Ri.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(e.session_data.auth_token=this.authToken,e.session_data.version=3),this.authorizePromise=(0,Li.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",e).then((e=>((!e||!e.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:u.ErrorCategory.EXTERNAL_API,message:"No session key",data:e}),this.sessionKey=e?.session_key??void 0,this.sessionKey))).catch((async e=>{this.sessionKey=void 0;let t=e?.error_code;if(401===t)return this.authToken=await this.refreshAuthToken(),this._authorizeWithBackoff();t?this.params.error$.next({id:`Authorize#${t}`,category:u.ErrorCategory.EXTERNAL_API,message:"authorize error",data:e}):this.params.error$.next({id:"AuthorizeUnknown",category:u.ErrorCategory.NETWORK,message:"authorize error",thrown:e})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}constructor(e){this.consequentAuthErrors=0,this.authorized$=new u.ValueSubject(!1),this.params=e}},{NativeAbortSignal:Bi,NativeAbortController:Di}={NativeAbortSignal:(Ci=typeof self<"u"?self:global).AbortSignal,NativeAbortController:Ci.AbortController};var Oi=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Fi=class extends Oi{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}throwIfAborted(){let{aborted:e,reason:t="Aborted"}=this;if(e)throw t}static timeout(e){let t=new ji;return setTimeout((()=>t.abort(new DOMException(`This signal is timeout in ${e}ms`,"TimeoutError"))),e),t.signal}static any(e){let t=new ji;function i(){t.abort(this.reason),function(){for(let t of e)t.removeEventListener("abort",i)}()}for(let r of e){if(r.aborted){t.abort(r.reason);break}r.addEventListener("abort",i)}return t.signal}constructor(){super(),this.listeners||Oi.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},ji=class{abort(e){let t=function(e){if(void 0===e)if(typeof document>"u")(e=new Error("This operation was aborted")).name="AbortError";else try{e=new DOMException("signal is aborted without reason"),Object.defineProperty(e,"name",{value:"AbortError"})}catch{(e=new Error("This operation was aborted")).name="AbortError"}return e}(e),i=function(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}return t.reason=e,t}(t);this.signal.reason=t,this.signal.dispatchEvent(i)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Fi,writable:!0,configurable:!0})}};function zi(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(ji.prototype[Symbol.toStringTag]="AbortController",Fi.prototype[Symbol.toStringTag]="AbortSignal");var qi="fetch"in window&&zi({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Hi=qi?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s=!1}=e;if(!zi({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s}))return{fetch:t,Request:a};let a=i;(a&&!a.prototype.hasOwnProperty("signal")||s)&&(a=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let s=new i(e,t);return r&&Object.defineProperty(s,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),s},a.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=a&&a.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let s=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([s,n(e,t)])}return n(e,t)},Request:a}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Ui=qi?Hi.fetch:window.fetch,Wi=(qi?Hi.Request:window.Request,qi||window.AbortController,qi||window.AbortSignal,b(Te(),1)),Qi=b(Qt(),1),Gi=class{async resolveApiBaseUrl(){if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let e=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),t=(await(await Ui(e,{method:"GET",mode:"cors",cache:"no-cache"})).json())?.Answer[0]?.data;if(!t)throw new Error("Wrong DNS response");return t}catch(e){return this.params.error$.next({id:"OneStat:ApiTransport:resolveApiBaseUrl",category:u.ErrorCategory.NETWORK,message:"Unhandled resolve api base url error",thrown:e}),Ti.vk_alias}finally{this.isApiBaseUrlFetched=!0}}sendBeacon(e,t,i){if(!window.Blob||!window.navigator.sendBeacon)return!1;let r=this._prepareQueryParams({method:e,queryParams:t,sessionKey:i}),s=new window.Blob([r.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,s)}catch(i){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:u.ErrorCategory.NETWORK,message:"Unhandled beacon error",thrown:i,data:{method:e,params:t}})}return!1}async sendRequest(e,t,i){let r=(0,u.now)(),s=s=>{s instanceof TypeError&&(0,Wi.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],s.message)?this.params.error$.next({id:"Network",category:u.ErrorCategory.NETWORK,message:"Request failed",thrown:s}):this.params.error$.next({id:"OneStat:ApiTransport:sendRequest",category:u.ErrorCategory.NETWORK,message:"Unhandled request error",thrown:s,data:{method:e,params:t,sessionKey:i,time:(0,u.now)()-r}})};this.apiBaseUrl=await this.resolveApiBaseUrl();let a={method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:this._prepareQueryParams({method:e,queryParams:t,sessionKey:i})};return this.params.config.useKeepalive&&(a.keepalive=!0),Ui(`${this.apiBaseUrl}/fb.do`,a).then((e=>{let t=0===Number(e.headers.get("content-length")),i=new Date(e.headers.get("date")??"").getTime(),a=(0,u.now)()-r;if(isFinite(i)&&this.timeSynchronisation?.addServerTime(i,a),!t)return e.json().then((e=>Object.prototype.hasOwnProperty.call(e,"error_msg")?Promise.reject(e):e),s)}),s)}_prepareQueryParams(e){let t=new URLSearchParams({format:"JSON",method:e.method,application_key:this.apiKey});return void 0!==e.sessionKey&&t.append("session_key",e.sessionKey),(0,Qi.default)(e.queryParams).forEach((([e,i])=>t.append(e,"string"==typeof i?i:JSON.stringify(i)))),t}constructor(e){this.params=e,this.apiKey=e.config.apiKey,this.apiEnv=e.config.apiEnv,this.apiBaseUrl=e.config.apiBaseUrl??Ti[this.apiEnv],this.timeSynchronisation=e.timeSynchronisation,this.isApiBaseUrlFetched=!1}},Ki=b(Te(),1),Yi=b(Qt(),1),Xi="onestat_events",Ji=e=>t=>t.timestamp+e>=(0,u.now)(),Zi=class{safeFlush(){try{this.flush()}catch(e){this.error$.next({id:"LoggerError",category:u.ErrorCategory.WTF,message:e?String(e):"Unknown logger error",thrown:e})}}readFromStorage(){let e=u.safeStorage.get(Xi);try{return e?JSON.parse(e):{}}catch{}return{}}addToStorage(e){if(!this.userSalt)return void this.unsaltedStorage.push(e);let t=this.readFromStorage(),i=(t[this.userSalt]??[]).filter(Ji(this.params.config.storageExpiration));u.safeStorage.set(Xi,JSON.stringify({...t,[this.userSalt]:[...i,e]}))}getFromStorage(){return this.userSalt?(this.readFromStorage()[this.userSalt]??[]).filter(Ji(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let e=this.readFromStorage();delete e[this.userSalt],u.safeStorage.set(Xi,JSON.stringify(e))}housekeepStorage(){let e=this.readFromStorage();for(let[t,i]of(0,Yi.default)(e)){let r=i.filter(Ji(this.params.config.storageExpiration));r.length?e[t]=r:delete e[t],this.loggerDebugLog({message:`${i.length} retrieved from storage, ${r.length} of them actual`})}u.safeStorage.set(Xi,JSON.stringify(e))}log(e){this.addToStorage(e),!this.isPaused&&(this.isUrgent(e)?this.flush():this.lastVsid!==e.custom.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=e.custom.vsid)}flush({wantBeacon:e,clearStorage:t}={wantBeacon:!1,clearStorage:!0}){let i=this.getFromStorage();0!==i.length&&(this.api.authorized$.getValue()?(e&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${i.length} events through beacon`}),this.api.logBeacon(i)):(this.loggerDebugLog({message:`Flushing ${i.length} events`}),this.api.logRequest(i)),t&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}constructor(e){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=e=>{let{operation:t}=e;return(0,Ki.default)(["action_play","watch_coverage_record","watch_coverage_live"],t)},this.params=e,this.api=e.api,this.error$=e.error$,this.userSalt=e.userSalt,this.loggerDebugLog=e.debugLogger.createComponentLog("stat logger"),this.firstFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let t=u.safeStorage.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:t}),this.subscription=this.api.authorized$.subscribe((e=>{e&&this.debouncedFlush()})),this.housekeepStorage()}},er=e=>e&&{[d.HttpConnectionType.HTTP1]:"http1",[d.HttpConnectionType.HTTP2]:"http2",[d.HttpConnectionType.QUIC]:"http3"}[e],tr=e=>{if(void 0!==e)switch(e){case d.VideoFormat.MPEG:return"mp4";case d.VideoFormat.DASH:case d.VideoFormat.DASH_LIVE:case d.VideoFormat.DASH_STREAMS:return"dash";case d.VideoFormat.DASH_SEP:return"dash_sep";case d.VideoFormat.DASH_ONDEMAND:return"ondemand_dash";case d.VideoFormat.DASH_WEBM:case d.VideoFormat.DASH_LIVE_WEBM:return"webm";case d.VideoFormat.DASH_WEBM_AV1:return"av1";case d.VideoFormat.DASH_LIVE_CMAF:return"ondemand_dash_live";case d.VideoFormat.HLS:case d.VideoFormat.HLS_LIVE:return"hls";case d.VideoFormat.HLS_FMP4:return"hls_fmp4";case d.VideoFormat.HLS_ONDEMAND:return"ondemand_hls";case d.VideoFormat.HLS_LIVE_CMAF:return"ondemand_hls_live";case d.VideoFormat.WEB_RTC_LIVE:return"webrtc";default:return(0,u.assertNever)(e)}},ir=(e,t)=>{if(t)return"minimal";switch(e){case void 0:case d.Surface.NONE:case d.Surface.INLINE:return;case d.Surface.FULLSCREEN:return"fullscreen";case d.Surface.SECOND_SCREEN:return"chromecast";case d.Surface.PIP:return"pip";case d.Surface.INVISIBLE:return"invisible";default:return(0,u.assertNever)(e)}},rr=e=>{switch(e){case"slow-2g":case"2g":return"poor";case"3g":return"good";case"4g":return"excellent"}},sr=class{getOffset(){return this.offset??0}setOffset(e){this.offset=e}now(){return Date.now()+(this.offset??0)}date(e=new Date){return e.setTime(e.getTime()+(this.offset??0)),e}addServerTime(e,t){let i=e-Date.now()-t/2;Math.abs(i)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(i):this.offset=Math.round(.2*i+.8*this.offset)}constructor(e){this.offset=void 0,this.offset=e}},ar=b(Ve(),1),nr=(e,t,i)=>{let r=new u.Subject,s=r.pipe((0,u.debounce)(0),(0,u.filterChanged)()),a=!1,n=!1,o=!1;return t(e.inPiP$,(e=>{a=e,r.next(e?d.Surface.PIP:n?d.Surface.FULLSCREEN:o?d.Surface.INLINE:void 0)})),t(e.inFullscreen$,(e=>{n=e,r.next(e?d.Surface.FULLSCREEN:a?d.Surface.PIP:o?d.Surface.INLINE:void 0)})),i&&t(i.info.surface$,(e=>{switch(e){case d.Surface.SECOND_SCREEN:case d.Surface.NONE:case d.Surface.INLINE:!n&&!a&&(e===d.Surface.INLINE&&(o=!0),r.next(e))}})),{surface$:s}},or="_one-stat_deviceId",lr=()=>{let e=new u.Subscription;return{subscription:e,subscribe:(t,i)=>{t&&e.add(t.subscribe(i))}}},ur=class{get vsid$(){return new u.ValueSubject(Ai.getVSID())}updateContext(e){this.statContext={...this.statContext,...e}}attachTo(e){let t,i=new u.Subscription,r=(e,t)=>i.add(e.subscribe(t));r(e.events.willStart$,(()=>{let t=e.info.position$.getValue();this.logActionPlay({position:t}),this.statContext.projectId&&this.logActionPlayInteractive()})),r(e.events.looped$,(()=>{this.resetViewSession(),++this.loopCounter>this.config.maxLoops&&(this.disabled=!0),this.logActionPlay({position:e.info.position$.getValue()})})),r(e.events.seeked$,(()=>{this.logSeek({action:this.seekAction$.getValue(),time:e.info.position$.getValue()}),this.seekAction$.next("unknown")})),r(e.events.paused$,(()=>{this.logPause({position:e.info.position$.getValue()})})),r(e.events.willResume$,(()=>{this.logPlay()})),r(e.events.started$,(()=>{this.statContext.clip&&this.logWatchCoverageRecord({start:0,end:0})})),r(e.events.playing$,(()=>{this.logPlaying()})),r(((e,t)=>new u.Observable((i=>{let r,s=new u.Subscription,a=(0,u.merge)((0,u.fromEvent)(window,"beforeunload"),e.events.willDestruct$),n=new u.ValueSubject(void 0);s.add(e.info.isLive$.pipe((0,u.filterChanged)()).subscribe((t=>{r&&(r.unsubscribe(),n.next(void 0)),r=t?e.info.liveTime$.pipe((0,u.map)((e=>e&&e/1e3))).subscribe(n):e.info.position$.subscribe(n),s.add(r)})));let{playing$:o,paused$:l}=e.events,c=e.events.willSeek$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),h=e.events.seeked$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),p=!1,f=new u.Subject;s.add(c.subscribe((()=>{p||f.next(),p=!0}))),s.add(h.subscribe((()=>p=!1)));let m,g=new u.Subject,v=new u.Subject,b=(0,u.merge)(o,h,g),y=(0,u.merge)(l,f,a,e.events.looped$,v),S=()=>{v.next(),g.next()};if(s.add(b.subscribe((()=>m=n.getValue()))),s.add(y.subscribe((()=>{let e=n.getValue();(0,u.isNullable)(m)||m===e||(0,u.isNullable)(e)||(i.next({from:m,to:e}),m=void 0)}))),t.forceInterval&&isFinite(t.forceInterval))if(t.watchCoverageTimeoutFix){let e,i=()=>{void 0!==e&&(window.clearTimeout(e),e=void 0)};s.add(b.subscribe((()=>{i(),e=window.setTimeout(S,t.forceInterval)}))),s.add(y.subscribe((()=>i()))),s.add((()=>i()))}else{let e=0;s.add(b.subscribe((()=>e=window.setTimeout(S,t.forceInterval)))),s.add(y.subscribe((()=>window.clearTimeout(e))))}return s})))(e,{forceInterval:this.config.watchCoverageInterval,watchCoverageTimeoutFix:this.config.watchCoverageTimeoutFix}),(t=>{let i=e.info.isLive$.getValue(),r=e.info.atLiveEdge$.getValue(),s={start:parseFloat(t.from.toFixed(3)),end:parseFloat(t.to.toFixed(3))};if(r){let t=e.info.liveLatency$.getValue()??0,i=e.info.currentBuffer$.getValue()?.end??0,r=e.info.liveBufferTime$.getValue()??0,a=Math.round(1e3*(t-(i-r))),n=Math.round(1e3*t);a&&n&&(s.latency=a,s.bufferLatency=n)}i?this.logWatchCoverageLive(s):this.logWatchCoverageRecord(s)})),r(e.info.isStalled$,(e=>{e?t=(0,u.now)():((0,u.isNonNullable)(t)&&this.logEmptyBuffer({duration:(0,u.now)()-t}),t=void 0)}));let s=!1;i.add(e.events.fatalError$.pipe((0,u.once)()).subscribe((()=>s=!0))),r(e.events.willStop$,(()=>{if(e.info.isStalled$.getValue()){let e=(0,u.isNonNullable)(t)?(0,u.now)()-t:void 0;this.logCloseAtEmptyBuffer({duration:e??0}),t=void 0}else s||this.logActionStop()})),r(e.events.managedError$,(({id:e})=>{this.logError({fatal:!1,errorType:e})})),r(e.events.fatalError$,(({id:e})=>{this.logError({fatal:!0,errorType:e})}));let a,n,o,l,c,h=!1;return r(e.events.firstBytes$,(e=>{a=(0,u.now)(),this.logFirstBytes({time:e})})),r(e.events.willStart$,(()=>n=(0,u.now)())),r(e.info.currentBuffer$,(e=>{!h&&e&&e.end-e.start>0&&(0,u.isNonNullable)(a)&&(this.logPlayerReady({duration:(0,u.now)()-a}),h=!0)})),r(e.events.firstFrame$,(()=>{(0,u.isNonNullable)(a)&&!h&&(this.logPlayerReady({duration:(0,u.now)()-a}),h=!0),(0,u.isNonNullable)(n)&&this.logFirstFrame({time:(0,u.now)()-n})})),r(e.info.currentVideoStream$,(e=>{e&&(o&&e.id!==o&&this.logTrackSwitch(e),o=e.id)})),r(e.info.currentAudioStream$,(e=>{e&&(l&&e.id!==l&&this.logTrackSwitch(e),l=e.id)})),r(e.info.atLiveEdge$,(e=>this.updateContext({liveEdge:e}))),r((0,u.combine)({muted:e.info.muted$,volume:e.info.volume$}),(({muted:e,volume:t})=>this.updateContext({audible:!e&&t>0}))),r(e.info.currentQuality$,(e=>{let t=(e=>e&&{[d.VideoQuality.INVARIANT]:"unknown",[d.VideoQuality.Q_144P]:"mobile",[d.VideoQuality.Q_240P]:"lowest",[d.VideoQuality.Q_360P]:"low",[d.VideoQuality.Q_480P]:"medium",[d.VideoQuality.Q_576P]:"unknown",[d.VideoQuality.Q_720P]:"high",[d.VideoQuality.Q_1080P]:"fullhd",[d.VideoQuality.Q_1440P]:"quadhd",[d.VideoQuality.Q_2160P]:"ultrahd",[d.VideoQuality.Q_4320P]:"unknown"}[e])(e);this.updateContext({quality:t}),t&&this.logQuality(t)})),r(e.info.isAutoQualityEnabled$,(e=>this.updateContext({autoQuality:e}))),r(e.info.currentFormat$,(e=>this.updateContext({contentType:tr(e)}))),r(e.info.currentPlaybackRate$,(e=>this.updateContext({rate:e}))),r(e.info.is3DVideo$,(e=>this.updateContext({is3d:e}))),r(e.info.hostname$,(e=>{let t=void 0!==c&&c!==e;this.updateContext({cdnHostname:e,failover:t}),t&&this.logFailover(e),c=e})),r(e.info.throughputEstimation$,(e=>this.updateContext({downloadSpeed:e}))),r(e.info.httpConnectionType$,(e=>{this.statContext.firstConnectionType||this.updateContext({firstConnectionType:er(e)}),this.updateContext({connectionType:er(e)})})),r(e.info.httpConnectionReused$,(e=>{(0,u.isNullable)(this.statContext.firstConnectionReused)&&this.updateContext({firstConnectionReused:e}),this.updateContext({connectionReused:e})})),r(e.info.surface$,(e=>{this.uiEvents||this.updateContext({mode:ir(e,this.statContext.isPreviewPlayerView)})})),r((0,u.combine)({current:e.info.currentTextTrack$,available:e.info.availableTextTracks$}),(({current:e,available:t})=>{let i=t.find((({id:t})=>t===e)),r=i&&(i.isAuto?`${i.language}_auto`:i.language);this.updateContext({subtitles:r?.split(".")[0]})})),this.player=e,this.uiEvents&&this.attachToUi(this.uiEvents),this.resubscribeBeforeunload(),this.subscription.add(i),i}attachToUi(e){this.uiEvents=e;let{subscription:t,subscribe:i}=lr();if(!this.player)return t;i(e.actionRewind$,(()=>{this.player&&(this.resetViewSession(),this.logActionPlay({position:this.player.info.position$.getValue()}))})),i(e.actionSeek$,this.seekAction$);let{surface$:r}=nr(this.uiEvents,i,this.player);return i(r,(e=>{this.updateContext({mode:ir(e,this.statContext.isPreviewPlayerView)})})),i(e.actionSetSubtitle$,(e=>this.updateContext({subtitles:e?.split(".")[0]}))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t),t}attachToAds(e){let{subscription:t,subscribe:i}=lr();return i(e.slotRequested$,(()=>this.logAdSlotRequest())),i(e.started$,(e=>this.logAdStarted(e))),i(e.paused$,(()=>this.logAdPaused())),i(e.resumed$,(()=>this.logAdResumed())),i(e.ended$,(()=>this.logAdEnded())),i(e.skipped$,(()=>this.logAdSkipped())),i(e.clicked$,(()=>this.logAdClicked())),i(e.error$,(e=>this.logError({errorType:e,fatal:!1}))),this.resubscribeBeforeunload(),this.subscription.add(t),t}attachToInteractive(e){let{subscription:t,subscribe:i}=lr();return i(e.click$,(e=>this.logInterfaceClick(e))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t),t}authorize(e){return this.api.authorize(e)}pause(){this.logger.pause(),this.oneStatDebugLog({message:"paused"})}resume(){this.logger.resume(),this.oneStatDebugLog({message:"resumed"})}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}resetViewSession(){this.oneStatDebugLog({message:"VSID reset"}),Ai.generateVSID()}getDeviceId(){return this.deviceId}setFieldBlacklist(){}logInited(){}logReady(e){this.log({operation:"player_ready",param:String(e.time)})}logStarted(...e){this.logActionPlay(...e)}logPlay(){this.log({operation:"play_toggle"})}logPlaying(){this.log({operation:"playing"})}logPause(e){this.log({operation:"pause",param:String(Math.round(e.position))})}logSeek(e){this.log({operation:"seek",param:e.action,time:e.time})}logFirstBytes(e){this.log({operation:"first_bytes",param:String(e.time)})}logFirstFrame(e){this.log({operation:"first_frame",param:String(e.time)})}logError(e){this.log({operation:"content_error",param:`${e.fatal?"fatal":"recoverable"}_${e.errorType}`})}logWatchCoverageRecord(e){this.log({operation:"watch_coverage_record",param:`${e.start}-${e.end}`},{in_history:this.statContext.inHistory?1:void 0})}logWatchCoverageLive(e){let t=this.timeSynchronisation?.getOffset()??0,i=e.start+t,r=e.end+t;this.log({operation:"watch_coverage_live",param:`${i}-${r}`},{in_history:this.statContext.inHistory?1:void 0,latency:e.latency,buffer_latency:e.bufferLatency})}logEmptyBuffer(e){this.log({operation:"empty_buffer",param:String(e.duration)})}logDownloadSpeed(){}logAdSlotRequest(){this.log({operation:"adv",param:"slot_request"})}logAdStarted(e){this.log({operation:"adv",param:e})}logAdPaused(){this.log({operation:"adv",param:"pause"})}logAdResumed(){this.log({operation:"adv",param:"resume"})}logAdEnded(){this.log({operation:"adv",param:"ended"})}logAdSkipped(){this.log({operation:"adv",param:"skip"})}logAdClicked(){this.log({operation:"adv",param:"click"})}logInterfaceClick(e){this.log({operation:"player_interface_click",param:e})}logNextMovie(e){this.log({operation:"next_movie",param:String(e)})}subscribe(){this.resubscribeBeforeunload();let e=window.navigator.connection;e&&"onchange"in e&&"effectiveType"in e&&this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).subscribe((()=>this.updateContext({network:rr(e.effectiveType)})))),this.config.debugLog&&this.debugLogger.log$.subscribe((e=>{console.debug("%c stat ","background:#fa6470;",`component: ${e.component}.`,e.message)}))}resubscribeBeforeunload(){this.beforeunloadSubscription?.unsubscribe(),this.beforeunloadSubscription=(0,u.fromEvent)(window,"beforeunload").subscribe((()=>this.logger.flush({wantBeacon:!0,clearStorage:this.config.clearStorageAtUnload}))),this.subscription.add(this.beforeunloadSubscription)}logPlayerReady(e){this.log({operation:"player_ready",param:String(Math.round(e.duration))})}logActionPlay(e){this.log({operation:"action_play",param:String(Math.round(e.position))})}logActionPlayInteractive(){this.statContext.projectId&&this.log({operation:"action_play_interactive",param:String(this.statContext.movieId)},{vid:this.statContext.projectId})}logFailover(e){this.log({operation:"failover",param:e})}logCloseAtEmptyBuffer(e){this.log({operation:"close_at_empty_buffer",param:String(Math.round(e.duration))})}logActionStop(){this.log({operation:"action_stop"})}logTrackSwitch(e){this.log({operation:"track_switch",param:e.id})}logQuality(e){this.log({operation:"quality",param:e})}log(e,t={}){if(this.disabled)return void this.oneStatDebugLog({message:`operation ${e.operation} but statistics is disabled`});if((0,pi.default)(this.config.disabledOperations,e.operation))return void this.oneStatDebugLog({message:`operation ${e.operation} but it is disabled`});this.oneStatDebugLog({message:`operation ${e.operation} ${e.param}`});let i=this.createLogItem(e,t);this.logger.log(i)}createLogItem({operation:e,param:t,time:i},r={}){let s=this.timeSynchronisation?.now()??(0,u.now)(),a=this.vsid$.getValue();(0,u.assertNonNullable)(a);let n,o,l=this.isid$.getValue(),d="empty_buffer"===e||"close_at_empty_buffer"===e?this.statContext.connectionType:this.statContext.firstConnectionType,c=this.statContext.firstConnectionReused;if(this.isEmbed||"embed"===this.statContext.place){n=this.embedParent;let e=[...new URLSearchParams(location.search).entries()].filter((([e,t])=>(0,pi.default)(this.config.embedUrlParams,e)));o=new URLSearchParams(e).toString()}else if("direct"===this.statContext.place){let e=this.statContext.refDomain||document.referrer;n=e&&fi(URL,e)?new URL(e).hostname:e,o=location.href.substring(0,1024)}let h={vsid:a,isid:l,vid:this.statContext.movieId,uid:this.zenUid$.getValue(),ct:this.statContext.contentType,place:this.isEmbed?"embed":this.statContext.place,quality:this.statContext.quality,cdn_host:this.statContext.cdnHostname,stat_type:!0===this.statContext.autoplay?"auto":!1===this.statContext.autoplay?"":void 0,param:t,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode,connection_type:d,connection_reused:!0===c?1:!1===c?0:void 0,cached_data:!0===this.statContext.cached?1:!1===this.statContext.cached?0:void 0,live:this.statContext.liveEdge?1:void 0,muted:!1===this.statContext.audible?1:void 0,mode:this.statContext.mode,subtitles:this.statContext.subtitles,download_speed:this.statContext.downloadSpeed,manual_quality:this.statContext.autoQuality?void 0:1,ref_domain:n,direct_url:o,rate:1===this.statContext.rate||(0,u.isNullable)(this.statContext.rate)?void 0:this.statContext.rate.toFixed(2),view_360:this.statContext.is3d?1:void 0,aid:this.statContext.albumId,vk_playlist_id:this.statContext.vkPlaylistId,...r};for(let e of this.config.disabledCustomFields)delete h[e];return{operation:e,type:1,time:i,network:this.statContext.network,timestamp:s,custom:h}}constructor(e,t){this.subscription=new u.Subscription,this.debugLogger=new u.Logger,this.oneStatDebugLog=this.debugLogger.createComponentLog("onestat"),this.loopCounter=0,this.disabled=!1,this.isid$=new u.ValueSubject(void 0),this.zenUid$=new u.ValueSubject(void 0),this.seekAction$=new u.ValueSubject("unknown"),this.statContext=e,this.config=(e=>(0,u.fillWithDefault)(e,_i))(t.config??{}),(0,u.isNonNullable)(t.apiEnv)&&(this.config.apiEnv=t.apiEnv),this.config.synchronizeTime&&(this.timeSynchronisation=new sr);let i=new u.Subject;this.experimental={error$:i};let r=u.safeStorage.get(or);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:r?this.deviceId=r:(this.deviceId=function(){let e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),s=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(s<=2&&(s=33554432+16777216*Math.random()|0),e=15&s,s>>=4,r[t]=i[19===t?3&e|8:e]);return r.join("")}(),u.safeStorage.set(or,this.deviceId)),this.resetViewSession(),t.useIsid&&this.isid$.next(t.isid??(0,ar.default)(Math.floor(Math.random()*2**64).toString(36),13,"0")),this.zenUid$.next(t.zenUid);let s=new Gi({config:this.config,error$:i,timeSynchronisation:this.timeSynchronisation});this.api=new Ni({config:this.config,apiTransport:s,refreshAuthToken:t.refreshAuthToken,mobile:this.statContext.mobile??!1,deviceId:this.deviceId,error$:i,vktvVersion:t.vktvVersion}),this.logger=new Zi({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:i,userSalt:t.userSalt});let{isEmbed:a,topOrigin:n}=(0,u.detectEmbed)();this.isEmbed=a,this.embedParent=n?new URL(n).hostname:void 0,this.subscribe()}},dr={};((e,t)=>{for(var i in t)h(e,i,{get:t[i],enumerable:!0})})(dr,{ActionSeekType:()=>fr,ThinOneStat:()=>Dr,VERSION:()=>Ri});var cr=b(hi(),1),hr=b(Te(),1),pr=(e=>(e.AUTO="auto",e.AUTO_POOR="auto_poor",e.AUTO_RICH="auto_rich",e))(pr||{}),fr=(e=>(e.SLIDER="slider",e.DOUBLE_TAP="double_tap",e.TIME_CODE="time_code",e.EPISODE="episode",e.REWIND="rewind",e.LIVE="live",e.UNKNOWN="unknown",e))(fr||{}),mr={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},gr={apiKey:"CIOPGQJGDIHBABABA",apiEnv:"okcdn",apiBaseUrl:null,requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageHeartbeatInterval:30,synchronizeTime:!0,useBeacon:!1,alwaysSendDesktop:!1,watchedNFirstTvtLog:1e3,watchedNDefaultTargetDuration:1e4},vr=b(Bt(),1),br=class{async authorize(e){return this.authToken=e??await this.refreshAuthToken(),this.authorizeWithBackoff()}logBeacon(e){let t=this.createLogParams(e),i=this.sessionKey;i&&(this.params.apiTransport.sendBeacon("log.logUvStat",t,i)||this.logRequest(e).catch((()=>{})))}async logRequest(e){let t="log.logUvStat",i=this.createLogParams(e),r={},s=this.sessionKey??await this.authorizeWithBackoff();if(!s)return;let a=async(e,n=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(t,i,s,r)}catch(i){if(!i||!("error_code"in i))return void this.params.error$.next({id:"logRequestUnknown",category:u.ErrorCategory.NETWORK,message:`Unknown ${t} error`,thrown:i});let r=i?.error_code;switch(r){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this.authorizeWithBackoff(),n>0?a(e,n-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this.authorizeWithBackoff(),n>0?a(e,n-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${r}`,category:u.ErrorCategory.EXTERNAL_API,message:`${t} error`,data:i})}}};return a(e)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,vr.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(e){return{collector:"ok.mobile.apps.video",uv_stat_data:JSON.stringify({application:`@vkontakte/videoplayer-statistics:${Ri}`,platform:e[0].platform,product:e[0].product,events:e})}}authorizeWithBackoff(){if(!this.consequentAuthErrors)return this.doAuthorize();let e=(0,u.getExponentialDelay)(this.consequentAuthErrors);return new Promise((t=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((async()=>{try{let e=await this.doAuthorize();t(e)}catch(e){this.params.error$.next({id:"AuthorizeBackoff",category:u.ErrorCategory.NETWORK,message:"Otherwise unhandled error in authorization",thrown:e})}finally{this.backoffTimeoutId=0}}),e))}))}doAuthorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let e={session_data:{version:2,device_id:this.params.deviceId,client_version:Ri.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(e.session_data.auth_token=this.authToken,e.session_data.version=3),this.authorizePromise=(0,vr.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",e).then((e=>((!e||!e.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:u.ErrorCategory.EXTERNAL_API,message:"No session key",data:e}),this.sessionKey=e?.session_key??void 0,this.sessionKey))).catch((async e=>{this.sessionKey=void 0;let t=e?.error_code;if(401===t)return this.authToken=await this.refreshAuthToken(),this.authorizeWithBackoff();t?this.params.error$.next({id:`Authorize#${t}`,category:u.ErrorCategory.EXTERNAL_API,message:"authorize error",data:e}):this.params.error$.next({id:"AuthorizeUnknown",category:u.ErrorCategory.NETWORK,message:"authorize error",thrown:e})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}constructor(e){this.params=e,this.authorized$=new u.ValueSubject(!1),this.consequentAuthErrors=0}},yr=b(Te(),1),Sr=b(Qt(),1),wr=class{sendBeacon(e,t,i){if(!window.Blob||!window.navigator.sendBeacon)return!1;let r=this.prepareQueryParams({method:e,queryParams:t,sessionKey:i}),s=new window.Blob([r.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,s)}catch(i){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:u.ErrorCategory.NETWORK,message:"Unhandled beacon error",thrown:i,data:{method:e,params:t}})}return!1}async sendRequest(e,t,i,r){let s=(0,u.now)(),a=r=>{r instanceof TypeError&&(0,yr.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],r.message)?this.params.error$.next({id:"Network",category:u.ErrorCategory.NETWORK,message:"Request failed",thrown:r}):this.params.error$.next({id:"ThinOneStat:ApiTransport:sendRequest",category:u.ErrorCategory.NETWORK,message:"Unhandled request error",thrown:r,data:{method:e,params:t,sessionKey:i,time:(0,u.now)()-s}})};return this.apiBaseUrl=await this.resolveApiBaseUrl(),Ui(`${this.apiBaseUrl}/fb.do`,{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded",...r},body:this.prepareQueryParams({method:e,queryParams:t,sessionKey:i})}).then((e=>{let t=0===Number(e.headers.get("content-length")),i=new Date(e.headers.get("date")??"").getTime(),r=(0,u.now)()-s;if(isFinite(i)&&this.timeSynchronisation?.addServerTime(i,r),!t)return e.json().then((e=>Object.prototype.hasOwnProperty.call(e,"error_msg")?Promise.reject(e):e),a)}),a)}async resolveApiBaseUrl(){if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let e=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),t=(await(await Ui(e,{method:"GET",mode:"cors",cache:"no-cache"})).json())?.Answer[0]?.data;if(!t)throw new Error("Wrong DNS response");return t}catch(e){return this.params.error$.next({id:"ThinOneStat:ApiTransport:resolveApiBaseUrl",category:u.ErrorCategory.NETWORK,message:"Unhandled resolve api base url error",thrown:e}),mr.vk_alias}finally{this.isApiBaseUrlFetched=!0}}prepareQueryParams(e){let t=new URLSearchParams({format:"JSON",method:e.method,application_key:this.apiKey});return void 0!==e.sessionKey&&t.append("session_key",e.sessionKey),(0,Sr.default)(e.queryParams).forEach((([e,i])=>t.append(e,"string"==typeof i?i:JSON.stringify(i)))),t}constructor(e){this.params=e,this.apiKey=e.config.apiKey,this.apiEnv=e.config.apiEnv,this.apiBaseUrl=e.config.apiBaseUrl??mr[this.apiEnv],this.timeSynchronisation=e.timeSynchronisation,this.isApiBaseUrlFetched=!1}},$r=b(Te(),1),xr=b(Qt(),1),kr="thinonestat_events",Tr=e=>t=>t.client_time+e>=(0,u.now)(),_r=class{safeFlush(){try{this.flush()}catch(e){this.error$.next({id:"LoggerError",category:u.ErrorCategory.WTF,message:String(e)||"Unknown logger error",thrown:e})}}readFromStorage(){let e=u.safeStorage.get(kr);try{return e?JSON.parse(e):{}}catch{}return{}}addToStorage(e){if(!this.userSalt)return void this.unsaltedStorage.push(e);let t=this.readFromStorage(),i=(t[this.userSalt]??[]).filter(Tr(this.params.config.storageExpiration));u.safeStorage.set(kr,JSON.stringify({...t,[this.userSalt]:[...i,e]}))}getFromStorage(){return this.userSalt?(this.readFromStorage()[this.userSalt]??[]).filter(Tr(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let e=this.readFromStorage();delete e[this.userSalt],u.safeStorage.set(kr,JSON.stringify(e))}housekeepStorage(){let e=this.readFromStorage();for(let[t,i]of(0,xr.default)(e)){let r=i.filter(Tr(this.params.config.storageExpiration));r.length?e[t]=r:delete e[t],this.loggerDebugLog({message:`${i.length} retrieved from storage, ${r.length} of them actual`})}u.safeStorage.set(kr,JSON.stringify(e))}log(e){this.addToStorage(e),!this.isPaused&&(this.isUrgent(e)?this.flush():this.lastVsid!==e.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=e.vsid)}flush({wantBeacon:e,clearStorage:t}={wantBeacon:!1,clearStorage:!0}){let i=this.getFromStorage();0!==i.length&&(this.api.authorized$.getValue()?(e&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${i.length} events through beacon`}),this.api.logBeacon(i)):(this.loggerDebugLog({message:`Flushing ${i.length} events`}),this.api.logRequest(i)),t&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}constructor(e){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=e=>{let{event_name:t}=e;return(0,$r.default)(["watch_coverage","watch_coverage_live","watched_n","playback_started"],t)},this.params=e,this.api=e.api,this.error$=e.error$,this.userSalt=e.userSalt,this.loggerDebugLog=e.debugLogger.createComponentLog("stat logger"),this.firstFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let t=u.safeStorage.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:t}),this.subscription=this.api.authorized$.subscribe((e=>{e&&this.debouncedFlush()})),this.housekeepStorage()}};var Cr=class{getOffset(){return this.offset??0}setOffset(e){this.offset=e}now(){return Date.now()+(this.offset??0)}date(e=new Date){return e.setTime(e.getTime()+(this.offset??0)),e}addServerTime(e,t){let i=e-Date.now()-t/2;Math.abs(i)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(i):this.offset=Math.round(.2*i+.8*this.offset)}constructor(e){this.offset=void 0,this.offset=e}},Er=e=>e&&{[d.HttpConnectionType.HTTP1]:"http1",[d.HttpConnectionType.HTTP2]:"http2",[d.HttpConnectionType.QUIC]:"http3"}[e],Ar=e=>{if(void 0!==e)switch(e){case d.VideoFormat.MPEG:return"MP4";case d.VideoFormat.DASH:case d.VideoFormat.DASH_LIVE:return"DASH";case d.VideoFormat.DASH_SEP:return"DASH_SEP";case d.VideoFormat.DASH_ONDEMAND:return"ONDEMAND_DASH";case d.VideoFormat.HLS_ONDEMAND:return"ONDEMAND_HLS";case d.VideoFormat.HLS:case d.VideoFormat.HLS_LIVE:return"HLS";case d.VideoFormat.HLS_FMP4:return"HLS_FMP4";case d.VideoFormat.DASH_WEBM:case d.VideoFormat.DASH_LIVE_WEBM:return"WEBM";case d.VideoFormat.DASH_LIVE_CMAF:return"ONDEMAND_DASH_LIVE";case d.VideoFormat.HLS_LIVE_CMAF:return"ONDEMAND_HLS_LIVE";case d.VideoFormat.WEB_RTC_LIVE:return"WEBRTC";case d.VideoFormat.DASH_WEBM_AV1:return"AV1";case d.VideoFormat.DASH_STREAMS:return"MULTI_DASH";default:return(0,u.assertNever)(e)}},Lr=e=>{if(void 0!==e)switch(e){case d.VideoQuality.Q_144P:return"144p";case d.VideoQuality.Q_240P:return"240p";case d.VideoQuality.Q_360P:return"360p";case d.VideoQuality.Q_480P:return"480p";case d.VideoQuality.Q_720P:return"720p";case d.VideoQuality.Q_1080P:return"1080p";case d.VideoQuality.Q_1440P:return"1440p";case d.VideoQuality.Q_2160P:return"2160p";case d.VideoQuality.INVARIANT:case d.VideoQuality.Q_576P:case d.VideoQuality.Q_4320P:return"UNKNOWN";default:return(0,u.assertNever)(e)}},Pr=e=>{if(void 0!==e)switch(e){case"MP4":case"ONDEMAND_DASH":case"ONDEMAND_DASH_LIVE":case"ONDEMAND_HLS":case"ONDEMAND_HLS_LIVE":case"MULTI_DASH":case"WEBM":case"AV1":return"vod";case"DASH":case"HLS":case"HLS_FMP4":case"WEBRTC":return"live";default:return}},Mr=(e,t,i)=>{if(e&&t){if(e===d.VideoFormat.MPEG)return i&&t[e]&&t[e][i];return t[e]?.url}},Ir=(e,t=!1)=>{if(t)return"minimal";switch(e){case void 0:case d.Surface.NONE:return;case d.Surface.INLINE:return"inline";case d.Surface.FULLSCREEN:return"fullscreen";case d.Surface.SECOND_SCREEN:return"chromecast";case d.Surface.PIP:return"pip_external"}},Rr=e=>{switch(e){case void 0:return;case d.Surface.INVISIBLE:return"background";default:return"foreground"}},Vr=b(Ve(),1),Nr="_thin-one-stat_deviceId",Br=()=>{let e=new u.Subscription;return{subscription:e,subscribe:(t,i)=>{t&&e.add(t.subscribe(i))}}},Dr=class{get vsid$(){return new u.ValueSubject(Ai.getVSID())}authorize(e){return this.api.authorize(e)}updateContext(e){this.statContext={...this.statContext,...e}}attachTo(e,t){let i,r,s,a,n=new u.Subscription,o=(e,t)=>n.add(e.subscribe(t));return o((e=>new u.Observable((t=>{let i=new u.Subscription,r=0,s=1,a=0,n=!1,o=!1,l=()=>{if(!n)return;let e=Date.now();a+=(e-r)*s,r=e},{started$:d,playing$:c,paused$:h,willSeek$:p,ended$:f,willDestruct$:m}=e.events,{currentPlaybackRate$:g}=e.info;return i.add(p.subscribe((()=>{n&&(l(),n=!1,o=!0)}))).add((0,u.merge)(d,c).subscribe((()=>{(!n||o)&&(r=Date.now(),n=!0,o=!1)}))).add((0,u.merge)(h,f,m).subscribe((()=>{n&&(l(),n=!1)}))).add(g.subscribe((e=>{n&&l(),s=e,r=Date.now()}))),t.next((()=>{let e=a;return n&&(e+=(Date.now()-r)*s),e})),i})))(e),(e=>{this.getTotalViewTime=e})),o(e.info.isLive$,(e=>this.isLive=e)),o((0,u.combine)({hostname:e.info.hostname$,connectionType:e.info.httpConnectionType$,connectionReused:e.info.httpConnectionReused$}).pipe((0,u.filter)((({hostname:e})=>void 0!==e)),(0,u.filter)((({connectionType:e})=>void 0!==e)),(0,u.filter)((({connectionReused:e})=>void 0!==e))),(({hostname:t,connectionType:r,connectionReused:s})=>{if(void 0!==i&&i!==t){let i={cdn_host:t,connection_type:Er(r),connection_reused:s,content_type:Ar(e.info.currentFormat$.getValue())};this.logFailover(i)}this.cdnHostname=i=t})),o(e.info.httpConnectionType$,(e=>{this.connectionType=Er(e)})),o(e.info.httpConnectionReused$,(e=>{this.connectionReused=e})),o(((e,t,i)=>new u.Observable((r=>{let s,a=new u.Subscription,n=new u.ValueSubject(void 0);a.add(e.info.isLive$.pipe((0,u.filterChanged)()).subscribe((t=>{s&&(s.unsubscribe(),n.next(void 0)),s=t?e.info.liveTime$.pipe((0,u.filterChanged)()).subscribe(n):e.info.position$.subscribe(n),a.add(s)})));let{playing$:o,paused$:l,ended$:c,looped$:h}=e.events,p=e.events.willSeek$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),f=e.events.seeked$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),m=!1,g=new u.Subject;a.add(p.subscribe((()=>{m||g.next(),m=!0}))).add(f.subscribe((()=>m=!1)));let v,b=(0,u.merge)((0,u.fromEvent)(window,"beforeunload"),e.events.willDestruct$),y=new u.Subject,S=new u.Subject,w=(0,u.merge)(o,g,y),$=(0,u.merge)(l,f,b,c,h,S),x=t.started$&&t.ended$?(0,u.merge)(w,t.ended$):w,k=t.started$&&t.ended$?(0,u.merge)($,t.started$):$;if(a.add(x.subscribe((()=>v=n.getValue()))).add(k.subscribe((()=>{let e=n.getValue();(0,u.isNullable)(v)||(0,u.isNullable)(e)||v===e||(r.next({from:v,to:e}),v=void 0)}))),i.heartbeatInterval&&isFinite(i.heartbeatInterval)){let e=[],t=1e3*i.heartbeatInterval,r=()=>{S.next(),y.next()};a.add(x.subscribe((()=>{let i=window.setTimeout(r,t);e.push(i)}))).add(k.subscribe((()=>{e.forEach((e=>{window.clearTimeout(e)})),e=[]})))}return a})))(e,t,{heartbeatInterval:this.config.watchCoverageHeartbeatInterval}),(t=>{let i={watch_interval:`${Math.round(1e3*t.from)}-${Math.round(1e3*t.to)}`,in_history:!!this.statContext.inHistory,content_type:Ar(e.info.currentFormat$.getValue()),playback_quality:Lr(e.info.currentQuality$.getValue()),recom_info:this.statContext.recomInfo};if(e.info.isLive$.getValue()){let t=e.info.atLiveEdge$.getValue();this.logWatchCoverageLive({...i,live:!!t})}else this.logWatchCoverage(i)})),o(((e,t)=>new u.Observable((i=>{let r=new d.Subscription,s=0;return r.add(e.info.position$.subscribe((()=>{let e=1e3*t.getTotalViewTime();e>s&&(e===t.firstTvtLog||e%t.targetDuration==0)&&(s=e,i.next({target_duration:t.targetDuration,current_tvt:e}))}))),r})))(e,{targetDuration:this.targetDuration,firstTvtLog:this.config.watchedNFirstTvtLog,getTotalViewTime:this.getTotalViewTime}),(e=>{this.logWatchedN(e)})),o(e.events.willReady$,(()=>{if(this.statContext.preload){let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentBuffer$.getValue(),s=e.info.currentQuality$.getValue(),a={target_buffer_time:this.calcBufferTime(r),playback_url:Mr(t,i,s),playback_quality:Lr(s)};this.logPreloadStarted(a)}})),o(e.events.ready$,(()=>{let t=e.info.currentBuffer$.getValue();if(this.statContext.preload){let e={buffer_time:this.calcBufferTime(t)};this.logPreloadEnded(e)}this.logReady({buffer_time:this.calcBufferTime(t)})})),o(e.events.manifestRequested$,(()=>{let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentQuality$.getValue(),s={playback_url:Mr(t,i,r),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logManifestRequest(s)})),o(e.events.firstBytesManifest$,(()=>{let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentQuality$.getValue(),s={playback_url:Mr(t,i,r),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logFirstByteManifest(s)})),o(e.events.manifestReceived$,(()=>{let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentQuality$.getValue(),s={playback_url:Mr(t,i,r),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logManifestReceived(s)})),o(e.events.firstBytesRequested$,(()=>{let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentQuality$.getValue(),s={playback_url:Mr(t,i,r),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logFirstMediaRequest(s)})),o(e.events.firstBytesReceived$,(()=>{let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentQuality$.getValue(),s={playback_url:Mr(t,i,r),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logFirstByteMedia(s)})),o((0,u.merge)(e.events.willStart$,e.events.looped$),(t=>{t&&this.resetViewSession();let i={isid:this.isid$.getValue(),stream_profile:Pr(Ar(e.info.currentFormat$.getValue())),dpi:96*d.clientChecker.display.pixelRatio,web_layout:this.statContext.isMobile||d.clientChecker.device.isMobile?"mobile":"desktop",preloaded:this.statContext.preload,navigation:this.statContext.navigation,recom_info:this.statContext.recomInfo};this.isEmbed&&(i.iframe_host=this.embedHostname??"unknown"),this.logStartSession(i)})),o(e.events.started$,(()=>{this.isStarted=!0;let t=e.info.currentBuffer$.getValue(),i=e.info.currentQuality$.getValue(),r=e.info.isAutoQualityEnabled$.getValue(),s=e.info.muted$.getValue(),a=e.info.volume$.getValue(),n=e.info.surface$.getValue(),o=e.info.availableTextTracks$.getValue(),l=e.info.currentTextTrack$.getValue(),u=e.info.currentAudioStream$.getValue(),d=e.info.currentPlaybackRate$.getValue(),c={playback_quality:Lr(i),user_quality:r?"auto":Lr(i),player_width:this.playerSize.width,player_height:this.playerSize.height,muted:s,sound_volume:Math.round(100*a),buffer_time:this.calcBufferTime(t),mode:Ir(n,this.statContext.isPreviewPlayerView),visibility:Rr(n),subtitles_enabled:l?!!l:this.currentSubtitle?.enabled,auto_subtitles:o.find((({id:e})=>e===l))?.isAuto??this.currentSubtitle?.auto,audio_track_lang:u?.language,playback_rate:d,recom_info:this.statContext.recomInfo};this.logPlaybackStarted(c)})),o((0,u.merge)(e.events.willStart$,e.events.willResume$),(()=>{this.logPlay()})),o(e.events.playing$,(()=>{let t=e.info.currentBuffer$.getValue(),i={buffer_time:this.calcBufferTime(t)};this.logPlaying(i),this.wasPaused&&this.logResume()})),o(e.events.paused$,(()=>{this.wasPaused=!0,this.logPause()})),o(e.events.willStop$,(()=>{this.logStop()})),o((0,u.merge)(e.events.fetcherRecoverableError$,e.events.fatalError$),(()=>{this.statContext.preload&&this.logPreloadError()})),o((0,u.combine)({connectionType:e.info.httpConnectionType$,connectionReused:e.info.httpConnectionReused$}).pipe((0,u.filter)((({connectionReused:e})=>void 0!==e)),(0,u.filterChanged)(((e,t)=>e.connectionType===t.connectionType))),(()=>{let t=e.info.currentFormat$.getValue(),i=e.info.availableSources$.getValue(),r=e.info.currentQuality$.getValue(),s=e.info.rttEstimation$.getValue(),a={playback_url:Mr(t,i,r),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused,rtt:s?Math.round(s):void 0};this.logConnectionEstablished(a)})),o(e.events.firstFrame$,(()=>{this.logFirstVideoFrameDecoded()})),o(e.events.willSeek$,(()=>{let e={seek_type:this.seekAction$.getValue()};this.logSeeking(e)})),o(e.events.seeked$,(()=>{let e={seek_type:this.seekAction$.getValue()};this.logSeeked(e),this.seekAction$.next("unknown")})),o(e.info.isStalled$,(t=>{let i=e.info.currentBuffer$.getValue(),r=this.calcBufferTime(i);t&&r&&r>0&&this.logBufferStarvation({buffer_time:r})})),o((0,u.combine)({videoStream:e.info.currentVideoStream$,audioStream:e.info.currentAudioStream$,quality:e.info.currentQuality$}).pipe((0,u.filter)((({videoStream:e,audioStream:t})=>void 0!==e&&void 0!==t)),(0,u.filter)((({quality:e})=>void 0!==e))),(({videoStream:t,audioStream:i,quality:s})=>{if(r!==s){let a=e.info.isAutoQualityEnabled$.getValue(),n=t?.codec,o=i?.codec,l={user_quality:a?"auto":Lr(s),playback_quality:Lr(s),download_quality:Lr(s),codec_info:n&&o?`${n},${o}`:void 0};r=s,this.logQualityChanged(l)}})),o(e.info.surface$,(e=>{let t=Ir(e,this.statContext.isPreviewPlayerView);t&&!this.uiEvents&&this.isStarted&&this.logModeChanged({mode:t}),a=Rr(e),s!==a&&this.isStarted&&(s=Rr(e),this.logVisibilityChanged({visibility:a}))})),o((0,u.combine)({muted:e.info.muted$,volume:e.info.volume$}),(({muted:e,volume:t})=>{if(this.isStarted){let i={muted:e,sound_volume:Math.round(100*t)};this.logSoundChanged(i)}})),this.player=e,this.resubscribeBeforeunload(),this.subscription.add(n),n}attachToUi(e){this.uiEvents=e;let{subscribe:t,subscription:i}=Br();t(e.actionSeek$,this.seekAction$),t(e.playerSize$,(({width:e,height:t})=>{e&&t&&(this.playerSize={width:e,height:t},this.logViewPortChanged({player_width:e,player_height:t}))})),t(e.isLoaderVisible$,(e=>{e&&this.isStarted&&this.logShowLoader()})),t(e.actionSubtitlesSwitched$,(e=>{if(this.currentSubtitle={...e},this.isStarted){let t={subtitles_enabled:e.enabled,subtitles_track_lang:e.lang,auto_subtitles:e.auto};this.logSubtitlesSwitched(t)}}));let{surface$:r}=nr(this.uiEvents,t,this.player);return t(r,(e=>{this.isStarted&&this.logModeChanged({mode:Ir(e)})})),t(e.actionQuality$,(e=>{let t=this.player?.info.currentVideoStream$.getValue()?.codec,i=this.player?.info.currentAudioStream$.getValue()?.codec,r={user_quality:(s=e,(0,hr.default)((0,cr.default)(pr),s)?"auto":Lr(e)),playback_quality:Lr(this.player?.info.currentQuality$.getValue()),download_quality:Lr(this.player?.info.currentQuality$.getValue()),codec_info:t&&i?`${t},${i}`:void 0};var s;this.logQualityChangeRequested(r)})),this.resubscribeBeforeunload(),this.subscription.add(i),i}attachToAds(e){let{subscription:t,subscribe:i}=Br();return i(e.init$,(e=>{let t={slot:e};this.logAdvConfiguration(t)})),i(e.slotRequested$,(()=>{this.logAdvRequest()})),i(e.started$,(e=>{let t={adv_section:e};this.logAdvBreakStarted(t)})),i(e.ended$,(e=>{let t={adv_section:e};this.logAdvBreakEnded(t)})),i(e.error$,(e=>{let t={error_message:e};this.logAdvError(t)})),this.resubscribeBeforeunload(),this.subscription.add(t),t}getDeviceId(){return this.deviceId}resetViewSession(){this.thinOneStatDebugLog({message:"VSID reset"}),Ai.generateVSID(),this.eventNumber=0}destroy(){this.api.destroy()}calcBufferTime(e){return e?1e3*Math.round((e.end??0)-(e.start??0)):void 0}createRequiredParams(e){let t=this.vsid$.getValue();(0,u.assertNonNullable)(t);let i=this.eventNumber++,r=1e3*((this.isLive?this.player?.info.liveTime$.getValue():this.player?.info.position$.getValue())??0);return{vsid:t,uv_movie_id:this.statContext.movieId,event_name:e,client_time:Date.now(),application:this.statContext.application??`@vkontakte/videoplayer-statistics:${Ri}`,platform:this.statContext.platform??"web:"+(this.statContext.isMobile||d.clientChecker.device.isMobile?"mobile":"desktop"),product:this.statContext.product,event_number:i,playback_position:r,current_tvt:this.getTotalViewTime(),cdn_host:this.cdnHostname}}createRequiredFatParams(){return{stats_version:"2.1.1",browser:this.statContext.browser??d.clientChecker.browser.current,browser_version:this.statContext.browserVersion??String(d.clientChecker.browser.currentVersion),os:this.statContext.os??d.clientChecker.device.os.name,os_version:this.statContext.osVersion??d.clientChecker.device.os.version,device_type:this.statContext.deviceType??(this.statContext.isMobile||d.clientChecker.device.isMobile?"mobile":"desktop"),device_manufacturer:this.statContext.deviceManufacturer??d.clientChecker.device.details.vendor,device_model:this.statContext.deviceModel??d.clientChecker.device.details.model,navigation:this.statContext.navigation}}log(e,t,i=!1){let r=this.createRequiredParams(e),s={};i&&(s=this.createRequiredFatParams()),this.logger.log({...r,...s,...t})}logWatchCoverage(e){this.log("watch_coverage",e,!0)}logWatchCoverageLive(e){this.log("watch_coverage_live",e,!0)}logWatchedN(e){this.log("watched_n",e,!0)}logStartSession(e){this.log("start_session",e,!0)}logPreloadStarted(e){this.log("preload_started",e)}logPreloadEnded(e){this.log("preload_ended",e)}logPreloadError(){this.log("preload_error")}logPlaybackStarted(e){this.log("playback_started",e,!0)}logPlay(){this.log("play")}logManifestRequest(e){this.log("manifest_request",e)}logFirstByteManifest(e){this.log("first_byte_manifest",e)}logFirstMediaRequest(e){this.log("first_media_request",e)}logFirstByteMedia(e){this.log("first_byte_media",e)}logManifestReceived(e){this.log("manifest_received",e)}logConnectionEstablished(e){this.log("connection_established",e)}logFirstVideoFrameDecoded(){this.log("first_video_frame_decoded")}logReady(e){this.log("ready",e)}logPlaying(e){this.log("playing",e)}logPause(){this.log("pause")}logResume(){this.log("resume")}logSeeking(e){this.log("seeking",e)}logSeeked(e){this.log("seeked",e)}logStop(){this.log("stop")}logBufferStarvation(e){this.log("buffer_starvation",e)}logShowLoader(){this.log("show_loader")}logQualityChangeRequested(e){this.log("quality_change_requested",e)}logQualityChanged(e){this.log("quality_changed",e)}logCdnHostChanged(e){this.log("cdn_host_changed",e)}logViewPortChanged(e){this.log("view_port_changed",e)}logModeChanged(e){this.log("mode_changed",e)}logVisibilityChanged(e){this.log("visibility_changed",e)}logSubtitlesSwitched(e){this.log("subtitles_switched",e)}logSoundChanged(e){this.log("sound_changed",e)}logFailover(e){this.log("failover",e)}logAdvConfiguration(e){this.log("adv_configuration",e)}logAdvRequest(){this.log("adv_request")}logAdvBreakStarted(e){this.log("adv_break_started",e)}logAdvBreakEnded(e){this.log("adv_break_ended",e)}logAdvError(e){this.log("adv_error",e)}resubscribeBeforeunload(){this.beforeunloadSubscription?.unsubscribe(),this.beforeunloadSubscription=(0,u.fromEvent)(window,"beforeunload").subscribe((()=>{})),this.subscription.add(this.beforeunloadSubscription)}constructor(e,t){this.debugLogger=new u.Logger,this.thinOneStatDebugLog=this.debugLogger.createComponentLog("ThinOneStat"),this.eventNumber=1,this.playerSize={width:0,height:0},this.seekAction$=new u.ValueSubject("unknown"),this.isid$=new u.ValueSubject(void 0),this.statContext=e,this.config=(e=>(0,u.fillWithDefault)(e,gr))(t.config??{}),this.subscription=new u.Subscription,this.config.synchronizeTime&&(this.timeSynchronisation=new Cr);let i=new u.Subject,r=u.safeStorage.get(Nr);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:r?this.deviceId=r:(this.deviceId=function(){let e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),s=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(s<=2&&(s=33554432+16777216*Math.random()|0),e=15&s,s>>=4,r[t]=i[19===t?3&e|8:e]);return r.join("")}(),u.safeStorage.set(Nr,this.deviceId)),this.statContext.targetDuration?this.targetDuration=this.statContext.targetDuration:this.targetDuration=this.config.watchedNDefaultTargetDuration,this.resetViewSession(),t.useIsid&&this.isid$.next(t.isid??(0,Vr.default)(Math.floor(Math.random()*2**64).toString(36),13,"0"));let s=new wr({error$:i,config:this.config,timeSynchronisation:this.timeSynchronisation});this.api=new br({config:this.config,apiTransport:s,error$:i,deviceId:this.deviceId,refreshAuthToken:t.refreshAuthToken}),this.logger=new _r({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:i,userSalt:t.userSalt});let{isEmbed:a,topOrigin:n}=(0,u.detectEmbed)();this.isEmbed=a,this.embedHostname=n?new URL(n).hostname:void 0}},Or=e=>"function"==typeof e&&e?.toString().endsWith("{ [native code] }"),Fr=!Or(window.requestIdleCallback)||!Or(window.cancelIdleCallback),jr=Fr?(e,t={})=>{let i=t.timeout||1,r=performance.now();return window.setTimeout((()=>{e({get didTimeout(){return!t.timeout&&performance.now()-r-1>i},timeRemaining:()=>Math.max(0,performance.now()-r+1)})}),1)}:window.requestIdleCallback,zr=Fr?e=>window.clearTimeout(e):window.cancelIdleCallback,qr=class{get time(){return Math.floor(this.timeMs/1e3)}get timeMs(){return null===this.startTime?0:(this.stopTime??this.now())-this.startTime-this.accumulatedTime}get isRunning(){return null!==this.startTime&&null===this.stopTime}start(){this.isRunning||(null!==this.stopTime?(this.accumulatedTime+=this.now()-this.stopTime,this.stopTime=null):this.startTime=this.now())}stop(){this.isRunning&&(this.stopTime=this.now())}reset(){this.startTime=null,this.stopTime=null,this.accumulatedTime=0}now(){return Date.now()}constructor(){this.startTime=null,this.stopTime=null,this.accumulatedTime=0}},Hr=class{attachTo(e){this.subscription.add(e.info.playbackState$.subscribe((e=>this.onPlaybackState(e)))).add(e.info.position$.subscribe((e=>this.onPosition(e)))).add(e.info.atLiveEdge$.subscribe((e=>this.isActiveLive=e))),this.subscription.add(e.events.willSeek$.subscribe((()=>this.onWillSeek()))).add(e.events.seeked$.subscribe((()=>this.onSeeked()))).add(e.events.ended$.subscribe((()=>this.onEnded())))}destroy(){this.stopwatch.reset(),this.subscription.unsubscribe(),window.clearTimeout(this.heartbeatFirstTimeoutId),this.idleCallbackIds.forEach((e=>zr(e))),this.send("stop")}onPlaybackState(e){e===d.PlaybackState.PLAYING?this.started?this.play():this.start():e===d.PlaybackState.PAUSED&&this.pause()}start(){this.started=!0,this.stopwatch.start(),this.send("start"),this.heartbeatPixels=this.prepareHeartbeatPixels(),this.heartbeatInterval=this.heartbeatPixels[0]?.interval;let e=this.heartbeatPixels[0]?.url,t=this.heartbeatPixels[0]?.delay;if(void 0!==t&&e)try{this.heartbeatFirstTimeoutId=window.setTimeout((()=>{this.sendHeartbeat(e)}),1e3*t)}catch(e){this.log({message:e.message})}}play(){this.stopwatch.start(),this.send("resume")}pause(){this.stopwatch.stop(),this.send("pause")}onPosition(e){if(this.position=e,this.heartbeatInterval&&0!==this.stopwatch.time&&this.stopwatch.time%this.heartbeatInterval==0)for(let[e,{url:t}]of this.heartbeatPixels.entries())this.heartbeatLastTimeSent[e]!==this.stopwatch.time&&(this.heartbeatLastTimeSent[e]=this.stopwatch.time,this.sendHeartbeat(t))}onWillSeek(){this.started&&this.send("stop")}onSeeked(){this.started&&this.send("start")}onEnded(){this.stopwatch.stop(),this.send("stop")}validatePixels(e,t){return e?.filter((e=>e.event===t.event&&t.keys.every((t=>!!e[t]))))}getFrameTimestamp(){let e;if(this.isActiveLive){let t=Math.floor(25*Math.random())+5;e=Date.now()/1e3-t}else e=this.position||0;return Math.floor(e)}getUTC(){return Math.floor(Date.now()/1e3)}prepareUrl(e){return e.replace("{@fts_fake_sec}",String(this.getFrameTimestamp())).replace("{@utc_sec}",String(this.getUTC())).split("&").filter((e=>!/={@[a-zA-Z_]+}/.test(e))).join("&")}preparePixels(e){return this.validatePixels(this.params.pixels,{event:e,keys:["url"]})}prepareHeartbeatPixels(){return this.validatePixels(this.params.pixels,{event:"heartbeat",keys:["url","interval"]})}call(e){try{this.idleCallbackIds.push(jr((()=>(window.Image?new Image:document.createElement("img")).src=this.prepareUrl(e))))}catch(e){this.log({message:e.message})}}send(e){let t=this.preparePixels(e);for(let{url:e}of t)this.call(e)}sendHeartbeat(e){this.call(e)}constructor(e){this.position=0,this.started=!1,this.heartbeatPixels=[],this.heartbeatLastTimeSent={},this.idleCallbackIds=[],this.stopwatch=new qr,this.subscription=new d.Subscription,this.params=e;let t=new u.Logger;this.log=t.createComponentLog("MediascopePixel")}}},317929:(e,t,i)=>{i.d(t,{ControlButtonType:()=>Ed,GridTypes:()=>Ms,VERSION:()=>Vs,VideoFormat:()=>f.VideoFormat,registerPlayerWebComponent:()=>$v});var r,s,a,n,o,l,u,d,c,h=i(434518),p=i(763812),f=i(773439),m=i(819705),g=i(89923),v="[!",b={},y=Symbol(),S=Symbol("filename"),w=(Symbol("hmr"),globalThis.process?.env?.NODE_ENV),$=w&&!w.toLowerCase().startsWith("prod"),x=Array.isArray,k=Array.prototype.indexOf,T=Array.from,_=Object.keys,C=Object.defineProperty,E=Object.getOwnPropertyDescriptor,A=Object.getOwnPropertyDescriptors,L=Object.prototype,P=Array.prototype,M=Object.getPrototypeOf,I=Object.isExtensible;function R(e){return"function"==typeof e}var V=()=>{};function N(e){return e()}function B(e){for(var t=0;t<e.length;t++)e[t]()}var D=Symbol("$state"),O=Symbol("legacy props"),F=Symbol(""),j=Symbol("proxy path");function z(e){return e===this.v}function q(e,t){return e!=e?t==t:e!==t||null!==e&&"object"==typeof e||"function"==typeof e}function H(e,t){return e!==t}function U(e){return!q(e,this.v)}var W=!1;function Q(e,t){return e.label=t,G(e.v,t),e}function G(e,t){return e?.[j]?.(t),e}function K(e){if($){let t=new Error(`lifecycle_outside_component\n\`${e}(...)\` can only be used during component initialisation\nhttps://svelte.dev/e/lifecycle_outside_component`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/lifecycle_outside_component")}var Y=null;function X(e){Y=e}var J=null;function Z(e){J=e}function ee(e){return ne("getContext").get(e)}function te(e,t){return ne("setContext").set(e,t),t}function ie(){return ne("getAllContexts")}function re(e,t=!1,i){var r=Y={p:Y,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};W&&!t&&(Y.l={s:null,u:null,r1:[],r2:xe(!1)}),it((()=>{r.d=!0})),$&&(Y.function=i,J=i)}function se(e){let t=Y;if(null!==t){void 0!==e&&(t.x=e);let n=t.e;if(null!==n){var i=Bt,r=Rt;t.e=null;try{for(var s=0;s<n.length;s++){var a=n[s];Dt(a.effect),Nt(a.reaction),st(a.fn)}}finally{Dt(i),Nt(r)}}Y=t.p,$&&(J=t.p?.function??null),t.m=!0}return e||{}}function ae(){return!W||null!==Y&&null===Y.l}function ne(e){var t;return null===Y&&K(e),(t=Y).c??(t.c=new Map(function(e){let t=e.p;for(;null!==t;){let e=t.c;if(null!==e)return e;t=t.p}return null}(Y)||void 0))}var oe=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function le(e){if("object"!=typeof e||null===e||D in e)return e;let t=M(e);if(t!==L&&t!==P)return e;var i=new Map,r=x(e),s=ke(0),a=null,n=Rt,o=e=>{var t=Rt;Nt(n);var i=e();return Nt(t),i};r&&i.set("length",ke(e.length,a));var l="";function u(e){Q(s,`${l=e} version`);for(let[e,t]of i)Q(t,ue(l,e))}return new Proxy(e,{defineProperty(e,t,r){(!("value"in r)||!1===r.configurable||!1===r.enumerable||!1===r.writable)&&function(){if($){let e=new Error("state_descriptors_fixed\nProperty descriptors defined on `$state` objects must contain `value` and always be `enumerable`, `configurable` and `writable`.\nhttps://svelte.dev/e/state_descriptors_fixed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_descriptors_fixed")}();var s=i.get(t);return void 0===s?s=o((()=>{var e=ke(r.value,a);return i.set(t,e),$&&"string"==typeof t&&Q(e,ue(l,t)),e})):_e(s,r.value,!0),!0},deleteProperty(e,t){var n=i.get(t);if(void 0===n){if(t in e){let e=o((()=>ke(y,a)));i.set(t,e),de(s),$&&Q(e,ue(l,t))}}else{if(r&&"string"==typeof t){var u=i.get("length"),d=Number(t);Number.isInteger(d)&&d<u.v&&_e(u,d)}_e(n,y),de(s)}return!0},get(t,r,s){if(r===D)return e;if($&&r===j)return u;var n=i.get(r),d=r in t;if(void 0===n&&(!d||E(t,r)?.writable)&&(n=o((()=>{var e=ke(le(d?t[r]:y),a);return $&&Q(e,ue(l,r)),e})),i.set(r,n)),void 0!==n){var c=ui(n);return c===y?void 0:c}return Reflect.get(t,r,s)},getOwnPropertyDescriptor(e,t){var r=Reflect.getOwnPropertyDescriptor(e,t);if(r&&"value"in r){var s=i.get(t);s&&(r.value=ui(s))}else if(void 0===r){var a=i.get(t),n=a?.v;if(void 0!==a&&n!==y)return{enumerable:!0,configurable:!0,value:n,writable:!0}}return r},has(e,t){if(t===D)return!0;var r=i.get(t),s=void 0!==r&&r.v!==y||Reflect.has(e,t);if((void 0!==r||null!==Bt&&(!s||E(e,t)?.writable))&&(void 0===r&&(r=o((()=>{var i=ke(s?le(e[t]):y,a);return $&&Q(i,ue(l,t)),i})),i.set(t,r)),ui(r)===y))return!1;return s},set(e,t,n,u){var d=i.get(t),c=t in e;if(r&&"length"===t)for(var h=n;h<d.v;h+=1){var p=i.get(h+"");void 0!==p?_e(p,y):h in e&&(p=o((()=>ke(y,a))),i.set(h+"",p),$&&Q(p,ue(l,h)))}void 0===d?(!c||E(e,t)?.writable)&&(_e(d=o((()=>ke(void 0,a))),le(n)),i.set(t,d),$&&Q(d,ue(l,t))):(c=d.v!==y,_e(d,o((()=>le(n)))));var f=Reflect.getOwnPropertyDescriptor(e,t);if(f?.set&&f.set.call(u,n),!c){if(r&&"string"==typeof t){var m=i.get("length"),g=Number(t);Number.isInteger(g)&&g>=m.v&&_e(m,g+1)}de(s)}return!0},ownKeys(e){ui(s);var t=Reflect.ownKeys(e).filter((e=>{var t=i.get(e);return void 0===t||t.v!==y}));for(var[r,a]of i)a.v!==y&&!(r in e)&&t.push(r);return t},setPrototypeOf(){!function(){if($){let e=new Error("state_prototype_fixed\nCannot set prototype of `$state` object\nhttps://svelte.dev/e/state_prototype_fixed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_prototype_fixed")}()}})}function ue(e,t){return"symbol"==typeof t?`${e}[Symbol(${t.description??""})]`:oe.test(t)?`${e}.${t}`:/^\d+$/.test(t)?`${e}[${t}]`:`${e}['${t}']`}function de(e,t=1){_e(e,e.v+t)}function ce(e){try{if(null!==e&&"object"==typeof e&&D in e)return e[D]}catch{}return e}function he(e,t){return Object.is(ce(e),ce(t))}function pe(e){var t=2050,i=null!==Rt&&2&Rt.f?Rt:null;null===Bt||null!==i&&256&i.f?t|=256:Bt.f|=1048576;let r={ctx:Y,deps:null,effects:null,equals:z,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:i??Bt};return r}function fe(e){let t=pe(e);return Ft(t),t}function me(e){let t=pe(e);return t.equals=U,t}function ge(e){var t=e.effects;if(null!==t){e.effects=null;for(var i=0;i<t.length;i+=1)ct(t[i])}}var ve=[];function be(e){var t,i=Bt;if(Dt(function(e){for(var t=e.parent;null!==t;){if(!(2&t.f))return t;t=t.parent}return null}(e)),$){let r=Se;$e(new Set);try{ve.includes(e)&&function(){if($){let e=new Error("derived_references_self\nA derived value cannot reference itself recursively\nhttps://svelte.dev/e/derived_references_self");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/derived_references_self")}(),ve.push(e),ge(e),t=Xt(e)}finally{Dt(i),$e(r),ve.pop()}}else try{ge(e),t=Xt(e)}finally{Dt(i)}return t}function ye(e){var t=be(e);(e.equals(t)||(e.v=t,e.wv=Gt()),Lt)||hi(e,(Wt||256&e.f)&&null!==e.deps?4096:1024)}var Se=new Set,we=new Map;function $e(e){Se=e}function xe(e,t){var i={f:0,v:e,reactions:null,equals:z,rv:0,wv:0};return i}function ke(e,t){let i=xe(e);return Ft(i),i}function Te(e,t=!1,i=!0){var r;let s=xe(e);return t||(s.equals=U),W&&i&&null!==Y&&null!==Y.l&&((r=Y.l).s??(r.s=[])).push(s),s}function _e(e,t,i=!1){null!==Rt&&(!Vt||262144&Rt.f)&&ae()&&262162&Rt.f&&(!Ot?.[1].includes(e)||Ot[0]!==Rt)&&function(){if($){let e=new Error("state_unsafe_mutation\nUpdating state inside `$derived(...)`, `$inspect(...)` or a template expression is forbidden. If the value should not be reactive, declare it without `$state`\nhttps://svelte.dev/e/state_unsafe_mutation");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_unsafe_mutation")}();let r=i?le(t):t;return $&&G(r,e.label),Ce(e,r)}function Ce(e,t){if(!e.equals(t)){var i=e.v;if(Lt?we.set(e,t):we.set(e,i),e.v=t,!!(2&e.f)&&(!!(2048&e.f)&&be(e),hi(e,256&e.f?4096:1024)),e.wv=Gt(),Ee(e,2048),ae()&&null!==Bt&&!!(1024&Bt.f)&&!(96&Bt.f)&&(null===qt?function(e){qt=e}([e]):qt.push(e)),$&&Se.size>0){let e=Array.from(Se);for(let t of e)!!(1024&t.f)&&hi(t,4096),Kt(t)&&ei(t);Se.clear()}}return t}function Ee(e,t){var i=e.reactions;if(null!==i)for(var r=ae(),s=i.length,a=0;a<s;a++){var n=i[a],o=n.f;if(!(2048&o)&&(r||n!==Bt)){if($&&262144&o){Se.add(n);continue}hi(n,t),1280&o&&(2&o?Ee(n,4096):ai(n))}}}var Ae="font-weight: bold",Le="font-weight: normal";function Pe(e){$?console.warn(`%c[svelte] hydration_mismatch\n%c${e?`Hydration failed because the initial UI does not match what was rendered on the server. The error occurred near ${e}`:"Hydration failed because the initial UI does not match what was rendered on the server"}\nhttps://svelte.dev/e/hydration_mismatch`,Ae,Le):console.warn("https://svelte.dev/e/hydration_mismatch")}function Me(e){$?console.warn(`%c[svelte] state_proxy_equality_mismatch\n%cReactive \`$state(...)\` proxies and the values they proxy have different identities. Because of this, comparisons with \`${e}\` will produce unexpected results\nhttps://svelte.dev/e/state_proxy_equality_mismatch`,Ae,Le):console.warn("https://svelte.dev/e/state_proxy_equality_mismatch")}var Ie,Re,Ve,Ne,Be,De=!1;function Oe(e){De=e}function Fe(e){if(null===e)throw Pe(),b;return Ie=e}function je(){return Fe(Ke(Ie))}function ze(e){if(De){if(null!==Ke(Ie))throw Pe(),b;Ie=e}}function qe(e=1){if(De){for(var t=e,i=Ie;t--;)i=Ke(i);Ie=i}}function He(){for(var e=0,t=Ie;;){if(8===t.nodeType){var i=t.data;if("]"===i){if(0===e)return t;e-=1}else("["===i||i===v)&&(e+=1)}var r=Ke(t);t.remove(),t=r}}function Ue(e){if(!e||8!==e.nodeType)throw Pe(),b;return e.data}function We(){if(void 0===Re){Re=window,document,Ve=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,i=Text.prototype;Ne=E(t,"firstChild").get,Be=E(t,"nextSibling").get,I(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),I(i)&&(i.__t=void 0),$&&(e.__svelte_meta=null,function(){let e=Array.prototype,t=Array.__svelte_cleanup;t&&t();let{indexOf:i,lastIndexOf:r,includes:s}=e;e.indexOf=function(e,t){let r=i.call(this,e,t);if(-1===r)for(let i=t??0;i<this.length;i+=1)if(ce(this[i])===e){Me("array.indexOf(...)");break}return r},e.lastIndexOf=function(e,t){let i=r.call(this,e,t??this.length-1);if(-1===i)for(let i=0;i<=(t??this.length-1);i+=1)if(ce(this[i])===e){Me("array.lastIndexOf(...)");break}return i},e.includes=function(e,t){let i=s.call(this,e,t);if(!i)for(let t=0;t<this.length;t+=1)if(ce(this[t])===e){Me("array.includes(...)");break}return i},Array.__svelte_cleanup=()=>{e.indexOf=i,e.lastIndexOf=r,e.includes=s}}())}}function Qe(e=""){return document.createTextNode(e)}function Ge(e){return Ne.call(e)}function Ke(e){return Be.call(e)}function Ye(e,t){if(!De)return Ge(e);var i=Ge(Ie);if(null===i)i=Ie.appendChild(Qe());else if(t&&3!==i.nodeType){var r=Qe();return i?.before(r),Fe(r),r}return Fe(i),i}function Xe(e,t){if(!De){var i=Ge(e);return 8===i.nodeType&&""===i.data?Ke(i):i}if(t&&3!==Ie?.nodeType){var r=Qe();return Ie?.before(r),Fe(r),r}return Ie}function Je(e,t=1,i=!1){let r=De?Ie:e;for(var s;t--;)s=r,r=Ke(r);if(!De)return r;if(i&&3!==r?.nodeType){var a=Qe();return null===r?s?.after(a):r.before(a),Fe(a),a}return Fe(r),r}function Ze(e){e.textContent=""}function et(e){null===Bt&&null===Rt&&function(e){if($){let t=new Error(`effect_orphan\n\`${e}\` can only be used inside an effect (e.g. during component initialisation)\nhttps://svelte.dev/e/effect_orphan`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/effect_orphan")}(e),null!==Rt&&!!(256&Rt.f)&&null===Bt&&function(){if($){let e=new Error("effect_in_unowned_derived\nEffect cannot be created inside a `$derived` value that was not itself created inside an effect\nhttps://svelte.dev/e/effect_in_unowned_derived");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}(),Lt&&function(e){if($){let t=new Error(`effect_in_teardown\n\`${e}\` cannot be used inside an effect cleanup function\nhttps://svelte.dev/e/effect_in_teardown`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/effect_in_teardown")}(e)}function tt(e,t,i,r=!0){var s=Bt;if($)for(;null!==s&&262144&s.f;)s=s.parent;var a,n={ctx:Y,deps:null,nodes_start:null,nodes_end:null,f:2048|e,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if($&&(n.component_function=J),i)try{ei(n),n.f|=32768}catch(e){throw ct(n),e}else null!==t&&ai(n);!(i&&null===n.deps&&null===n.first&&null===n.nodes_start&&null===n.teardown&&!(1048704&n.f))&&r&&(null!==s&&function(e,t){var i=t.last;null===i?t.last=t.first=e:(i.next=e,e.prev=i,t.last=e)}(n,s),null!==Rt&&2&Rt.f)&&((a=Rt).effects??(a.effects=[])).push(n);return n}function it(e){let t=tt(8,null,!1);return hi(t,1024),t.teardown=e,t}function rt(e){et("$effect");var t,i=null!==Bt&&!!(32&Bt.f)&&null!==Y&&!Y.m;if($&&C(e,"name",{value:"$effect"}),!i)return st(e);((t=Y).e??(t.e=[])).push({fn:e,effect:Bt,reaction:Rt})}function st(e){return tt(4,e,!1)}function at(e){return tt(8,e,!0)}function nt(e,t=[],i=pe){if($)return at((()=>{var r=()=>e(...s.map(ui));C(Bt.fn,"name",{value:"{expression}"}),C(r,"name",{value:"{expression}"});let s=t.map(i);ot(r)}));let r=t.map(i);return ot((()=>e(...r.map(ui))))}function ot(e,t=0){return tt(24|t,e,!0)}function lt(e,t=!0){return tt(40,e,!0,t)}function ut(e){var t=e.teardown;if(null!==t){let e=Lt,i=Rt;Pt(!0),Nt(null);try{t.call(null)}finally{Pt(e),Nt(i)}}}function dt(e,t=!1){var i=e.first;for(e.first=e.last=null;null!==i;){var r=i.next;64&i.f?i.parent=null:ct(i,t),i=r}}function ct(e,t=!0){var i=!1;(t||!!(524288&e.f))&&null!==e.nodes_start&&null!==e.nodes_end&&(ht(e.nodes_start,e.nodes_end),i=!0),dt(e,t&&!i),Zt(e,0),hi(e,16384);var r=e.transitions;if(null!==r)for(let e of r)e.stop();ut(e);var s=e.parent;null!==s&&null!==s.first&&pt(e),$&&(e.component_function=null),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function ht(e,t){for(;null!==e;){var i=e===t?null:Ke(e);e.remove(),e=i}}function pt(e){var t=e.parent,i=e.prev,r=e.next;null!==i&&(i.next=r),null!==r&&(r.prev=i),null!==t&&(t.first===e&&(t.first=r),t.last===e&&(t.last=i))}function ft(e,t){var i=[];gt(e,i,!0),mt(i,(()=>{ct(e),t&&t()}))}function mt(e,t){var i=e.length;if(i>0){var r=()=>--i||t();for(var s of e)s.out(r)}else t()}function gt(e,t,i){if(!(8192&e.f)){if(e.f^=8192,null!==e.transitions)for(let r of e.transitions)(r.is_global||i)&&t.push(r);for(var r=e.first;null!==r;){var s=r.next;gt(r,t,!!(!!(65536&r.f)||!!(32&r.f))&&i),r=s}}}function vt(e){bt(e,!0)}function bt(e,t){if(8192&e.f){e.f^=8192;for(var i=e.first;null!==i;){var r=i.next;bt(i,!!(!!(65536&i.f)||!!(32&i.f))&&t),i=r}if(null!==e.transitions)for(let i of e.transitions)(i.is_global||t)&&i.in()}}var yt=[],St=[];function wt(){var e=yt;yt=[],B(e)}function $t(e){0===yt.length&&queueMicrotask(wt),yt.push(e)}function xt(){var e;yt.length>0&&wt(),St.length>0&&(e=St,St=[],B(e))}function kt(e){var t=Bt;if($&&e instanceof Error&&function(e,t){if(_t.has(e))return;_t.add(e);let i=E(e,"message");if(!i||i.configurable){for(var r=Ve?"  ":"\t",s=`\n${r}in ${t.fn?.name||"<unknown>"}`,a=t.ctx;null!==a;)s+=`\n${r}in ${a.function?.[S].split("/").pop()}`,a=a.p;C(e,"message",{value:e.message+`\n${s}\n`}),e.stack&&C(e,"stack",{value:e.stack.split("\n").filter((e=>!e.includes("svelte/src/internal"))).join("\n")})}}(e,t),32768&t.f)Tt(e,t);else{if(!(128&t.f))throw e;t.fn(e)}}function Tt(e,t){for(;null!==t;){if(128&t.f)try{return void t.fn(e)}catch{}t=t.parent}throw e}var _t=new WeakSet;var Ct=!1,Et=null,At=!1,Lt=!1;function Pt(e){Lt=e}var Mt=[],It=[],Rt=null,Vt=!1;function Nt(e){Rt=e}var Bt=null;function Dt(e){Bt=e}var Ot=null;function Ft(e){null!==Rt&&2097152&Rt.f&&(null===Ot?Ot=[Rt,[e]]:Ot[1].push(e))}var jt=null,zt=0,qt=null;var Ht=1,Ut=0,Wt=!1,Qt=null;function Gt(){return++Ht}function Kt(e){var t=e.f;if(2048&t)return!0;if(4096&t){var i=e.deps,r=!!(256&t);if(null!==i){var s,a,n=!!(512&t),o=r&&null!==Bt&&!Wt,l=i.length;if(n||o){var u,d=e,c=d.parent;for(s=0;s<l;s++)a=i[s],(n||!a?.reactions?.includes(d))&&((u=a).reactions??(u.reactions=[])).push(d);n&&(d.f^=512),o&&null!==c&&!(256&c.f)&&(d.f^=256)}for(s=0;s<l;s++)if(Kt(a=i[s])&&ye(a),a.wv>e.wv)return!0}(!r||null!==Bt&&!Wt)&&hi(e,1024)}return!1}function Yt(e,t,i=!0){var r=e.reactions;if(null!==r)for(var s=0;s<r.length;s++){var a=r[s];Ot?.[1].includes(e)&&Ot[0]===Rt||(2&a.f?Yt(a,t,!1):t===a&&(i?hi(a,2048):!!(1024&a.f)&&hi(a,4096),ai(a)))}}function Xt(e){var t=jt,i=zt,r=qt,s=Rt,a=Wt,n=Ot,o=Y,l=Vt,u=e.f;jt=null,zt=0,qt=null,Wt=!!(256&u)&&(Vt||!At||null===Rt),Rt=96&u?null:e,Ot=null,X(e.ctx),Vt=!1,Ut++,e.f|=2097152;try{var d=(0,e.fn)(),c=e.deps;if(null!==jt){var h,p;if(Zt(e,zt),null!==c&&zt>0)for(c.length=zt+jt.length,p=0;p<jt.length;p++)c[zt+p]=jt[p];else e.deps=c=jt;if(!Wt||2&u&&null!==e.reactions)for(p=zt;p<c.length;p++)((h=c[p]).reactions??(h.reactions=[])).push(e)}else null!==c&&zt<c.length&&(Zt(e,zt),c.length=zt);if(ae()&&null!==qt&&!Vt&&null!==c&&!(6146&e.f))for(p=0;p<qt.length;p++)Yt(qt[p],e);return null!==s&&s!==e&&(Ut++,null!==qt&&(null===r?r=qt:r.push(...qt))),d}catch(e){kt(e)}finally{jt=t,zt=i,qt=r,Rt=s,Wt=a,Ot=n,X(o),Vt=l,e.f^=2097152}}function Jt(e,t){let i=t.reactions;if(null!==i){var r=k.call(i,e);if(-1!==r){var s=i.length-1;0===s?i=t.reactions=null:(i[r]=i[s],i.pop())}}null===i&&2&t.f&&(null===jt||!jt.includes(t))&&(hi(t,4096),!(768&t.f)&&(t.f^=512),ge(t),Zt(t,0))}function Zt(e,t){var i=e.deps;if(null!==i)for(var r=t;r<i.length;r++)Jt(e,i[r])}function ei(e){var t=e.f;if(!(16384&t)){hi(e,1024);var i=Bt,r=At;if(Bt=e,At=!0,$){var s=J;Z(e.component_function)}try{16&t?function(e){for(var t=e.first;null!==t;){var i=t.next;!(32&t.f)&&ct(t),t=i}}(e):dt(e),ut(e);var a=Xt(e);e.teardown="function"==typeof a?a:null,e.wv=Ht,$&&It.push(e)}finally{At=r,Bt=i,$&&Z(s)}}}function ti(){console.error("Last ten effects were: ",It.slice(-10).map((e=>e.fn))),It=[]}function ii(){try{!function(){if($){let e=new Error("effect_update_depth_exceeded\nMaximum update depth exceeded. This can happen when a reactive block or effect repeatedly sets a new value. Svelte limits the number of nested updates to prevent infinite loops\nhttps://svelte.dev/e/effect_update_depth_exceeded");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(e){if($&&C(e,"stack",{value:""}),null===Et)throw $&&ti(),e;if($)try{Tt(e,Et)}catch(e){throw ti(),e}else Tt(e,Et)}}function ri(){var e=At;try{var t=0;for(At=!0;Mt.length>0;){t++>1e3&&ii();var i=Mt,r=i.length;Mt=[];for(var s=0;s<r;s++){si(ni(i[s]))}we.clear()}}finally{Ct=!1,At=e,Et=null,$&&(It=[])}}function si(e){var t=e.length;if(0!==t)for(var i=0;i<t;i++){var r=e[i];!(24576&r.f)&&Kt(r)&&(ei(r),null===r.deps&&null===r.first&&null===r.nodes_start&&(null===r.teardown?pt(r):r.fn=null))}}function ai(e){Ct||(Ct=!0,queueMicrotask(ri));for(var t=Et=e;null!==t.parent;){var i=(t=t.parent).f;if(96&i){if(!(1024&i))return;t.f^=1024}}Mt.push(t)}function ni(e){for(var t=[],i=e;null!==i;){var r=i.f,s=!!(96&r);if(!(s&&!!(1024&r)||8192&r)){4&r?t.push(i):s?i.f^=1024:Kt(i)&&ei(i);var a=i.first;if(null!==a){i=a;continue}}var n=i.parent;for(i=i.next;null===i&&null!==n;)i=n.next,n=n.parent}return t}function oi(e){var t;for(e&&(Ct=!0,ri(),Ct=!0,t=e());;){if(xt(),0===Mt.length)return Ct=!1,Et=null,$&&(It=[]),t;Ct=!0,ri()}}async function li(){await Promise.resolve(),oi()}function ui(e){var t=!!(2&e.f);if(null!==Qt&&Qt.add(e),null===Rt||Vt){if(t&&null===e.deps&&null===e.effects){var i=e,r=i.parent;null!==r&&!(256&r.f)&&(i.f^=256)}}else if(!Ot?.[1].includes(e)||Ot[0]!==Rt){var s=Rt.deps;e.rv<Ut&&(e.rv=Ut,null===jt&&null!==s&&s[zt]===e?zt++:null===jt?jt=[e]:(!Wt||!jt.includes(e))&&jt.push(e))}return t&&(Kt(i=e)&&ye(i)),Lt&&we.has(e)?we.get(e):e.v}function di(e){var t=Vt;try{return Vt=!0,e()}finally{Vt=t}}var ci=-7169;function hi(e,t){e.f=e.f&ci|t}function pi(e,t=new Set){if(!("object"!=typeof e||null===e||e instanceof EventTarget||t.has(e))){t.add(e),e instanceof Date&&e.getTime();for(let i in e)try{pi(e[i],t)}catch{}let i=M(e);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){let t=A(i);for(let i in t){let r=t[i].get;if(r)try{r.call(e)}catch{}}}}}function fi(e,t){if(t){let t=document.body;e.autofocus=!0,$t((()=>{document.activeElement===t&&e.focus()}))}}function mi(e){var t=Rt,i=Bt;Nt(null),Dt(null);try{return e()}finally{Nt(t),Dt(i)}}var gi=new Set,vi=new Set;function bi(e){if(!De)return;e.removeAttribute("onload"),e.removeAttribute("onerror");let t=e.__e;void 0!==t&&(e.__e=void 0,queueMicrotask((()=>{e.isConnected&&e.dispatchEvent(t)})))}function yi(e,t,i,r={}){function s(e){if(r.capture||$i.call(t,e),!e.cancelBubble)return mi((()=>i?.call(this,e)))}return e.startsWith("pointer")||e.startsWith("touch")||"wheel"===e?$t((()=>{t.addEventListener(e,s,r)})):t.addEventListener(e,s,r),s}function Si(e,t,i,r,s){var a={capture:r,passive:s},n=yi(e,t,i,a);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&it((()=>{t.removeEventListener(e,n,a)}))}function wi(e){for(var t=0;t<e.length;t++)gi.add(e[t]);for(var i of vi)i(e)}function $i(e){var t=this,i=t.ownerDocument,r=e.type,s=e.composedPath?.()||[],a=s[0]||e.target,n=0,o=e.__root;if(o){var l=s.indexOf(o);if(-1!==l&&(t===document||t===window))return void(e.__root=t);var u=s.indexOf(t);if(-1===u)return;l<=u&&(n=l)}if((a=s[n]||e.target)!==t){C(e,"currentTarget",{configurable:!0,get:()=>a||i});var d=Rt,c=Bt;Nt(null),Dt(null);try{for(var h,p=[];null!==a;){var f=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+r];if(null!=m&&(!a.disabled||e.target===a))if(x(m)){var[g,...v]=m;g.apply(a,[e,...v])}else m.call(a,e)}catch(e){h?p.push(e):h=e}if(e.cancelBubble||f===t||null===f)break;a=f}if(h){for(let e of p)queueMicrotask((()=>{throw e}));throw h}}finally{e.__root=t,delete e.currentTarget,Nt(d),Dt(c)}}}function xi(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","\x3c!----\x3e"),t.content}function ki(e,t){var i=Bt;null===i.nodes_start&&(i.nodes_start=e,i.nodes_end=t)}function Ti(e,t){var i,r=!!(1&t),s=!!(2&t),a=!e.startsWith("<!>");return()=>{if(De)return ki(Ie,null),Ie;void 0===i&&(i=xi(a?e:"<!>"+e),r||(i=Ge(i)));var t=s||Ve?document.importNode(i,!0):i.cloneNode(!0);r?ki(Ge(t),t.lastChild):ki(t,t);return t}}function _i(e,t){return function(e,t,i="svg"){var r,s=!e.startsWith("<!>"),a=!!(1&t),n=`<${i}>${s?e:"<!>"+e}</${i}>`;return()=>{if(De)return ki(Ie,null),Ie;if(!r){var e=Ge(xi(n));if(a)for(r=document.createDocumentFragment();Ge(e);)r.appendChild(Ge(e));else r=Ge(e)}var t=r.cloneNode(!0);return a?ki(Ge(t),t.lastChild):ki(t,t),t}}(e,t,"svg")}function Ci(e=""){if(!De){var t=Qe(e+"");return ki(t,t),t}var i=Ie;return 3!==i.nodeType&&(i.before(i=Qe()),Fe(i)),ki(i,i),i}function Ei(){if(De)return ki(Ie,null),Ie;var e=document.createDocumentFragment(),t=document.createComment(""),i=Qe();return e.append(t,i),ki(t,i),e}function Ai(e,t){if(De)return Bt.nodes_end=Ie,void je();null!==e&&e.before(t)}var Li=/\r/g;function Pi(e){return e.endsWith("capture")&&"gotpointercapture"!==e&&"lostpointercapture"!==e}var Mi=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Ii(e){return Mi.includes(e)}var Ri={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Vi(e){return e=e.toLowerCase(),Ri[e]??e}var Ni=["touchstart","touchmove"];function Bi(e){return Ni.includes(e)}var Di=["textarea","script","style","title"];var Oi=!0;function Fi(e){Oi=e}function ji(e,t){var i,r=null==t?"":"object"==typeof t?t+"":t;r!==((i=e).__t??(i.__t=e.nodeValue))&&(e.__t=r,e.nodeValue=r+"")}function zi(e,t){return Ui(e,t)}function qi(e,t){We(),t.intro=t.intro??!1;let i=t.target,r=De,s=Ie;try{for(var a=Ge(i);a&&(8!==a.nodeType||"["!==a.data);)a=Ke(a);if(!a)throw b;Oe(!0),Fe(a),je();let r=Ui(e,{...t,anchor:a});if(null===Ie||8!==Ie.nodeType||"]"!==Ie.data)throw Pe(),b;return Oe(!1),r}catch(r){if(r===b)return!1===t.recover&&function(){if($){let e=new Error("hydration_failed\nFailed to hydrate the application\nhttps://svelte.dev/e/hydration_failed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/hydration_failed")}(),We(),Ze(i),Oe(!1),zi(e,t);throw r}finally{Oe(r),Fe(s)}}var Hi=new Map;function Ui(e,{target:t,anchor:i,props:r={},events:s,context:a,intro:n=!0}){We();var o=new Set,l=e=>{for(var i=0;i<e.length;i++){var r=e[i];if(!o.has(r)){o.add(r);var s=Bi(r);t.addEventListener(r,$i,{passive:s});var a=Hi.get(r);void 0===a?(document.addEventListener(r,$i,{passive:s}),Hi.set(r,1)):Hi.set(r,a+1)}}};l(T(gi)),vi.add(l);var u=void 0,d=function(e){let t=tt(64,e,!0);return(e={})=>new Promise((i=>{e.outro?ft(t,(()=>{ct(t),i(void 0)})):(ct(t),i(void 0))}))}((()=>{var d=i??t.appendChild(Qe());return lt((()=>{a&&(re({}),Y.c=a);s&&(r.$$events=s),De&&ki(d,null),Oi=n,u=e(d,r)||{},Oi=!0,De&&(Bt.nodes_end=Ie),a&&se()})),()=>{for(var e of o){t.removeEventListener(e,$i);var r=Hi.get(e);0==--r?(document.removeEventListener(e,$i),Hi.delete(e)):Hi.set(e,r)}vi.delete(l),d!==i&&d.parentNode?.removeChild(d)}}));return Wi.set(u,d),u}var Wi=new WeakMap;function Qi(e,t){let i=Wi.get(e);return i?(Wi.delete(e),i(t)):($&&($?console.warn("%c[svelte] lifecycle_double_unmount\n%cTried to unmount a component that was not mounted\nhttps://svelte.dev/e/lifecycle_double_unmount",Ae,Le):console.warn("https://svelte.dev/e/lifecycle_double_unmount")),Promise.resolve())}function Gi(e,t,...i){var r,s=e,a=V;ot((()=>{a!==(a=t())&&(r&&(ct(r),r=null),$&&null==a&&function(){if($){let e=new Error("invalid_snippet\nCould not `{@render}` snippet due to the expression being `null` or `undefined`. Consider using optional chaining `{@render snippet?.()}`\nhttps://svelte.dev/e/invalid_snippet");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/invalid_snippet")}(),r=lt((()=>a(s,...i))))}),65536),De&&(s=Ie)}if($){let e=function(e){if(!(e in globalThis)){let t;Object.defineProperty(globalThis,e,{configurable:!0,get:()=>{if(void 0!==t)return t;!function(e){if($){let t=new Error(`rune_outside_svelte\nThe \`${e}\` rune is only available inside \`.svelte\` and \`.svelte.js/ts\` files\nhttps://svelte.dev/e/rune_outside_svelte`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/rune_outside_svelte")}(e)},set:e=>{t=e}})}};e("$state"),e("$effect"),e("$derived"),e("$inspect"),e("$props"),e("$bindable")}function Ki(e){null===Y&&K("onMount"),W&&null!==Y.l?function(e){var t,i=e.l;return(t=i).u??(t.u={a:[],b:[],m:[]})}(Y).m.push(e):rt((()=>{let t=di(e);if("function"==typeof t)return t}))}function Yi(e){null===Y&&K("onDestroy"),Ki((()=>()=>di(e)))}var Xi=new Map;function Ji(e,t,[i,r]=[0,0]){De&&0===i&&je();var s=e,a=null,n=null,o=y,l=!1;let u=(e,t=!0)=>{l=!0,d(t,e)},d=(e,t)=>{if(o===(o=e))return;let l=!1;if(De&&-1!==r){if(0===i){let e=Ue(s);"["===e?r=0:e===v?r=1/0:(r=parseInt(e.substring(1)))!=r&&(r=o?1/0:-1)}!!o===r>i&&(Fe(s=He()),Oe(!1),l=!0,r=-1)}o?(a?vt(a):t&&(a=lt((()=>t(s)))),n&&ft(n,(()=>{n=null}))):(n?vt(n):t&&(n=lt((()=>t(s,[i+1,r])))),a&&ft(a,(()=>{a=null}))),l&&Oe(!0)};ot((()=>{l=!1,t(u),l||d(null,null)}),i>0?65536:0),De&&(s=Ie)}function Zi(e,t,i){De&&je();var r,s=e,a=y,n=ae()?H:q;ot((()=>{n(a,a=t())&&(r&&ft(r),r=lt((()=>i(s))))})),De&&(s=Ie)}var er,tr=null;function ir(e){tr=e}function rr(e,t){return t}function sr(e,t,i,r,s,a=null){var n=e,o={flags:t,items:new Map,first:null};if(!!(4&t)){var l=e;n=De?Fe(Ge(l)):l.appendChild(Qe())}De&&je();var u=null,d=!1,c=me((()=>{var e=i();return x(e)?e:null==e?[]:T(e)}));ot((()=>{var e=ui(c),l=e.length;if(d&&0===l)return;d=0===l;let h=!1;De&&(Ue(n)===v!==(0===l)&&(Fe(n=He()),Oe(!1),h=!0));if(De){for(var p,f=null,m=0;m<l;m++){if(8===Ie.nodeType&&"]"===Ie.data){n=Ie,h=!0,Oe(!1);break}var g=e[m],b=r(g,m);p=nr(Ie,o,f,null,g,b,m,s,t,i),o.items.set(b,p),f=p}l>0&&Fe(He())}De||function(e,t,i,r,s,a,n){var o,l,u,d,c,h,p=!!(8&s),f=!!(3&s),m=e.length,g=t.items,v=t.first,b=v,y=null,S=[],w=[];if(p)for(h=0;h<m;h+=1)u=e[h],d=a(u,h),void 0!==(c=g.get(d))&&(c.a?.measure(),(l??(l=new Set)).add(c));for(h=0;h<m;h+=1)if(d=a(u=e[h],h),void 0!==(c=g.get(d))){if(f&&ar(c,u,h,s),!!(8192&c.e.f)&&(vt(c.e),p&&(c.a?.unfix(),(l??(l=new Set)).delete(c))),c!==b){if(void 0!==o&&o.has(c)){if(S.length<w.length){var $,x=w[0];y=x.prev;var k=S[0],_=S[S.length-1];for($=0;$<S.length;$+=1)or(S[$],x,i);for($=0;$<w.length;$+=1)o.delete(w[$]);lr(t,k.prev,_.next),lr(t,y,k),lr(t,_,x),b=x,y=_,h-=1,S=[],w=[]}else o.delete(c),or(c,b,i),lr(t,c.prev,c.next),lr(t,c,null===y?t.first:y.next),lr(t,y,c),y=c;continue}for(S=[],w=[];null!==b&&b.k!==d;)!(8192&b.e.f)&&(o??(o=new Set)).add(b),w.push(b),b=b.next;if(null===b)continue;c=b}S.push(c),y=c,b=c.next}else{y=nr(b?b.e.nodes_start:i,t,y,null===y?t.first:y.next,u,d,h,r,s,n),g.set(d,y),S=[],w=[],b=y.next}if(null!==b||void 0!==o){for(var C=void 0===o?[]:T(o);null!==b;)!(8192&b.e.f)&&C.push(b),b=b.next;var E=C.length;if(E>0){var A=4&s&&0===m?i:null;if(p){for(h=0;h<E;h+=1)C[h].a?.measure();for(h=0;h<E;h+=1)C[h].a?.fix()}!function(e,t,i,r){for(var s=[],a=t.length,n=0;n<a;n++)gt(t[n].e,s,!0);var o=a>0&&0===s.length&&null!==i;if(o){var l=i.parentNode;Ze(l),l.append(i),r.clear(),lr(e,t[0].prev,t[a-1].next)}mt(s,(()=>{for(var i=0;i<a;i++){var s=t[i];o||(r.delete(s.k),lr(e,s.prev,s.next)),ct(s.e,!o)}}))}(t,C,A,g)}}p&&$t((()=>{if(void 0!==l)for(c of l)c.a?.apply()})),Bt.first=t.first&&t.first.e,Bt.last=y&&y.e}(e,o,n,s,t,r,i),null!==a&&(0===l?u?vt(u):u=lt((()=>a(n))):null!==u&&ft(u,(()=>{u=null}))),h&&Oe(!0),ui(c)})),De&&(n=Ie)}function ar(e,t,i,r){!!(1&r)&&Ce(e.v,t),2&r?Ce(e.i,i):e.i=i}function nr(e,t,i,r,s,a,n,o,l,u){var d=tr,c=!!(1&l),h=c?!(16&l)?Te(s,!1,!1):xe(s):s,p=2&l?xe(n):n;$&&c&&(h.trace=()=>{var e="number"==typeof p?n:p.v;u()[e]});var f={i:p,v:h,k:a,a:null,e:null,prev:i,next:r};tr=f;try{return f.e=lt((()=>o(e,h,p,u)),De),f.e.prev=i&&i.e,f.e.next=r&&r.e,null===i?t.first=f:(i.next=f,i.e.next=f.e),null!==r&&(r.prev=f,r.e.prev=f.e),f}finally{tr=d}}function or(e,t,i){for(var r=e.next?e.next.e.nodes_start:i,s=t?t.e.nodes_start:i,a=e.e.nodes_start;a!==r;){var n=Ke(a);s.before(a),a=n}}function lr(e,t,i){null===t?e.first=i:(t.next=i,t.e.next=i&&i.e),null!==i&&(i.prev=t,i.e.prev=t&&t.e)}function ur(e,t,i){if(!t||t===function(e){let t=5381,i=(e=e.replace(Li,"")).length;for(;i--;)t=(t<<5)-t^e.charCodeAt(i);return(t>>>0).toString(36)}(String(i??"")))return;let r,s=e.__svelte_meta?.loc;s?r=`near ${s.file}:${s.line}:${s.column}`:J?.[S]&&(r=`in ${J[S]}`),function(e){$?console.warn(`%c[svelte] hydration_html_changed\n%c${e?`The value of an \`{@html ...}\` block ${e} changed between server and client renders. The client value will be ignored in favour of the server value`:"The value of an `{@html ...}` block changed between server and client renders. The client value will be ignored in favour of the server value"}\nhttps://svelte.dev/e/hydration_html_changed`,Ae,Le):console.warn("https://svelte.dev/e/hydration_html_changed")}(function(e){return e?.replace(/\//g,"/​")}(r))}function dr(e,t,i=!1,r=!1,s=!1){var a=e,n="";nt((()=>{var e=Bt;if(n!==(n=t()??"")){if(null!==e.nodes_start&&(ht(e.nodes_start,e.nodes_end),e.nodes_start=e.nodes_end=null),""!==n){if(De){for(var o=Ie.data,l=je(),u=l;null!==l&&(8!==l.nodeType||""!==l.data);)u=l,l=Ke(l);if(null===l)throw Pe(),b;return $&&!s&&ur(l.parentNode,o,n),ki(Ie,u),void(a=Fe(l))}var d=n+"";i?d=`<svg>${d}</svg>`:r&&(d=`<math>${d}</math>`);var c=xi(d);if((i||r)&&(c=Ge(c)),ki(Ge(c),c.lastChild),i||r)for(;Ge(c);)a.before(Ge(c));else a.before(c)}}else De&&je()}))}function cr(e,t,i){De&&je();var r,s,a=e;ot((()=>{r!==(r=t())&&(s&&(ft(s),s=null),r&&(s=lt((()=>i(a,r)))))}),65536),De&&(a=Ie)}function hr(e,t,i,r,s,a){let n=De;De&&je();var o,l,u=$&&a&&Y?.function[S],d=null;De&&1===Ie.nodeType&&(d=Ie,je());var c,h=De?Ie:e,p=tr;ot((()=>{let e=t()||null;var n=s?s():i||"svg"===e?"http://www.w3.org/2000/svg":null;if(e!==o){var f=tr;ir(p),c&&(null===e?ft(c,(()=>{c=null,l=null})):e===l?vt(c):(ct(c),Fi(!1))),e&&e!==l&&(c=lt((()=>{if(d=De?d:n?document.createElementNS(n,e):document.createElement(e),$&&a&&(d.__svelte_meta={loc:{file:u,line:a[0],column:a[1]}}),ki(d,d),r){De&&function(e){return Di.includes(e)}(e)&&d.append(document.createComment(""));var t=De?Ge(d):d.appendChild(Qe());De&&(null===t?Oe(!1):Fe(t)),r(d,t)}Bt.nodes_end=d,h.before(d)}))),(o=e)&&(l=o),Fi(!0),ir(f)}}),65536),n&&(Oe(!0),Fe(h))}var pr=(a=(0,p._)("_t"),n=(0,p._)("_e"),class{$set(e){(0,h._)(this,n)[n].$set(e)}$on(e,t){(0,h._)(this,a)[a][e]=(0,h._)(this,a)[a][e]||[];let i=(...e)=>t.call(this,...e);return(0,h._)(this,a)[a][e].push(i),()=>{(0,h._)(this,a)[a][e]=(0,h._)(this,a)[a][e].filter((e=>e!==i))}}$destroy(){(0,h._)(this,n)[n].$destroy()}constructor(e){Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0});var t=new Map,i=(e,i)=>{var r=Te(i,!1,!1);return t.set(e,r),r};let r=new Proxy({...e.props||{},$$events:{}},{get:(e,r)=>ui(t.get(r)??i(r,Reflect.get(e,r))),has:(e,r)=>r===O||(ui(t.get(r)??i(r,Reflect.get(e,r))),Reflect.has(e,r)),set:(e,r,s)=>(_e(t.get(r)??i(r,s),s),Reflect.set(e,r,s))});(0,h._)(this,n)[n]=(e.hydrate?qi:zi)(e.component,{target:e.target,anchor:e.anchor,props:r,context:e.context,intro:e.intro??!1,recover:e.recover}),(!e?.props?.$$host||!1===e.sync)&&oi(),(0,h._)(this,a)[a]=r.$$events;for(let e of Object.keys((0,h._)(this,n)[n]))"$set"===e||"$destroy"===e||"$on"===e||C(this,e,{get(){return(0,h._)(this,n)[n][e]},set(t){(0,h._)(this,n)[n][e]=t},enumerable:!0});(0,h._)(this,n)[n].$set=e=>{Object.assign(r,e)},(0,h._)(this,n)[n].$destroy=()=>{Qi((0,h._)(this,n)[n])}}});function fr(e,t){$t((()=>{var i=e.getRootNode(),r=i.host?i:i.head??i.ownerDocument.head??er?.parentNode;if(!r?.querySelector("#"+t.hash)){let e=document.createElement("style");e.id=t.hash,e.textContent=t.code,r.appendChild(e),$&&function(e,t){var i=Xi.get(e);i||(i=new Set,Xi.set(e,i)),i.add(t)}(t.hash,e)}}))}function mr(e,t){var i,r=void 0;ot((()=>{r!==(r=t())&&(i&&(ct(i),i=null),r&&(i=lt((()=>{st((()=>r(e)))}))))}))}function gr(e){var t,i,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(i=gr(e[t]))&&(r&&(r+=" "),r+=i)}else for(i in e)e[i]&&(r&&(r+=" "),r+=i);return r}function vr(e){return"object"==typeof e?function(){for(var e,t,i=0,r="",s=arguments.length;i<s;i++)(e=arguments[i])&&(t=gr(e))&&(r&&(r+=" "),r+=t);return r}(e):e??""}var br=[..." \t\n\r\f \v\ufeff"];function yr(e,t=!1){var i=t?" !important;":";",r="";for(var s in e){var a=e[s];null!=a&&""!==a&&(r+=" "+s+": "+a+i)}return r}function Sr(e){return"-"!==e[0]||"-"!==e[1]?e.toLowerCase():e}function wr(e,t,i,r,s,a){var n=e.__className;if(De||n!==i||void 0===n){var o=function(e,t,i){var r=null==e?"":""+e;if(t&&(r=r?r+" "+t:t),i)for(var s in i)if(i[s])r=r?r+" "+s:s;else if(r.length)for(var a=s.length,n=0;(n=r.indexOf(s,n))>=0;){var o=n+a;0!==n&&!br.includes(r[n-1])||o!==r.length&&!br.includes(r[o])?n=o:r=(0===n?"":r.substring(0,n))+r.substring(o+1)}return""===r?null:r}(i,r,a);(!De||o!==e.getAttribute("class"))&&(null==o?e.removeAttribute("class"):t?e.className=o:e.setAttribute("class",o)),e.__className=i}else if(a&&s!==a)for(var l in a){var u=!!a[l];(null==s||u!==!!s[l])&&e.classList.toggle(l,u)}return a}function $r(e,t={},i,r){for(var s in i){var a=i[s];t[s]!==a&&(null==i[s]?e.style.removeProperty(s):e.style.setProperty(s,a,r))}}function xr(e,t,i,r){var s=e.__style;if(De||s!==t){var a=function(e,t){if(t){var i,r,s="";if(Array.isArray(t)?(i=t[0],r=t[1]):i=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,n=0,o=!1,l=[];i&&l.push(...Object.keys(i).map(Sr)),r&&l.push(...Object.keys(r).map(Sr));var u=0,d=-1;let t=e.length;for(var c=0;c<t;c++){var h=e[c];if(o?"/"===h&&"*"===e[c-1]&&(o=!1):a?a===h&&(a=!1):"/"===h&&"*"===e[c+1]?o=!0:'"'===h||"'"===h?a=h:"("===h?n++:")"===h&&n--,!o&&!1===a&&0===n)if(":"===h&&-1===d)d=c;else if(";"===h||c===t-1){if(-1!==d){var p=Sr(e.substring(u,d).trim());l.includes(p)||(";"!==h&&c++,s+=" "+e.substring(u,c).trim()+";")}u=c+1,d=-1}}}return i&&(s+=yr(i)),r&&(s+=yr(r,!0)),""===(s=s.trim())?null:s}return null==e?null:String(e)}(t,r);(!De||a!==e.getAttribute("style"))&&(null==a?e.removeAttribute("style"):e.style.cssText=a),e.__style=t}else r&&(Array.isArray(r)?($r(e,i?.[0],r[0]),$r(e,i?.[1],r[1],"important")):$r(e,i,r));return r}function kr(e,t,i){if(e.multiple){if(null==t)return;if(!x(t))return void($?console.warn("%c[svelte] select_multiple_invalid_value\n%cThe `value` property of a `<select multiple>` element should be an array, but it received a non-array value. The selection will be kept as is.\nhttps://svelte.dev/e/select_multiple_invalid_value",Ae,Le):console.warn("https://svelte.dev/e/select_multiple_invalid_value"));for(var r of e.options)r.selected=t.includes(Tr(r))}else{for(r of e.options){if(he(Tr(r),t))return void(r.selected=!0)}(!i||void 0!==t)&&(e.selectedIndex=-1)}}function Tr(e){return"__value"in e?e.__value:e.value}var _r=Symbol("class"),Cr=Symbol("style"),Er=Symbol("is custom element"),Ar=Symbol("is html");function Lr(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Pr(e,t,i,r){var s=Ir(e);De&&(s[t]=e.getAttribute(t),"src"===t||"srcset"===t||"href"===t&&"LINK"===e.nodeName)?r||function(e,t,i){$&&("srcset"===t&&function(e,t){var i=Br(e.srcset),r=Br(t);return r.length===i.length&&r.every((([e,t],r)=>t===i[r][1]&&(Nr(i[r][0],e)||Nr(e,i[r][0]))))}(e,i)||Nr(e.getAttribute(t)??"",i)||function(e,t,i){$?console.warn(`%c[svelte] hydration_attribute_changed\n%cThe \`${e}\` attribute on \`${t}\` changed its value between server and client renders. The client value, \`${i}\`, will be ignored in favour of the server value\nhttps://svelte.dev/e/hydration_attribute_changed`,Ae,Le):console.warn("https://svelte.dev/e/hydration_attribute_changed")}(t,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(i)))}(e,t,i??""):s[t]!==(s[t]=i)&&("loading"===t&&(e[F]=i),null==i?e.removeAttribute(t):"string"!=typeof i&&Vr(e).includes(t)?e[t]=i:e.setAttribute(t,i))}function Mr(e,t,i=[],r,s=!1,a=pe){let n=i.map(a);var o=void 0,l={},u="SELECT"===e.nodeName,d=!1;if(ot((()=>{var i=t(...n.map(ui)),a=function(e,t,i,r,s=!1){var a,n=Ir(e),o=n[Er],l=!n[Ar];let u=De&&o;u&&Oe(!1);var d=t||{},c="OPTION"===e.tagName;for(var h in t)h in i||(i[h]=null);i.class?i.class=vr(i.class):(r||i[_r])&&(i.class=null),i[Cr]&&((a=i).style??(a.style=null));var p=Vr(e);for(let a in i){let u=i[a];if(c&&"value"===a&&null==u)e.value=e.__value="",d[a]=u;else if("class"!==a)if("style"!==a){var f=d[a];if(u!==f||void 0===u&&e.hasAttribute(a)){d[a]=u;var m=a[0]+a[1];if("$$"!==m)if("on"===m){let t={},i="$$"+a,r=a.slice(2);var g=Ii(r);if(Pi(r)&&(r=r.slice(0,-7),t.capture=!0),!g&&f){if(null!=u)continue;e.removeEventListener(r,d[i],t),d[i]=null}if(null!=u)if(g)e[`__${r}`]=u,wi([r]);else{let s=function(e){d[a].call(this,e)};d[i]=yi(r,e,s,t)}else g&&(e[`__${r}`]=void 0)}else if("style"===a)Pr(e,a,u);else if("autofocus"===a)fi(e,!!u);else if(o||"__value"!==a&&("value"!==a||null==u))if("selected"===a&&c)Lr(e,u);else{var v=a;l||(v=Vi(v));var b="defaultValue"===v||"defaultChecked"===v;if(null!=u||o||b)b||p.includes(v)&&(o||"string"!=typeof u)?e[v]=u:"function"!=typeof u&&Pr(e,v,u,s);else if(n[a]=null,"value"===v||"checked"===v){let i=e,r=void 0===t;if("value"===v){let e=i.defaultValue;i.removeAttribute(v),i.defaultValue=e,i.value=i.__value=r?e:null}else{let e=i.defaultChecked;i.removeAttribute(v),i.defaultChecked=e,i.checked=!!r&&e}}else e.removeAttribute(a)}else e.value=e.__value=u}}else xr(e,u,t?.[Cr],i[Cr]),d[a]=u,d[Cr]=i[Cr];else wr(e,"http://www.w3.org/1999/xhtml"===e.namespaceURI,u,r,t?.[_r],i[_r]),d[a]=u,d[_r]=i[_r]}return u&&Oe(!0),d}(e,o,i,r,s);d&&u&&"value"in i&&kr(e,i.value,!1);for(let e of Object.getOwnPropertySymbols(l))i[e]||ct(l[e]);for(let t of Object.getOwnPropertySymbols(i)){var c=i[t];"@attach"===t.description&&(!o||c!==o[t])&&(l[t]&&ct(l[t]),l[t]=lt((()=>mr(e,(()=>c))))),a[t]=c}o=a})),u){var c=e;st((()=>{kr(c,o.value),function(e){var t=new MutationObserver((()=>{kr(e,e.__value)}));t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),it((()=>{t.disconnect()}))}(c)}))}d=!0}function Ir(e){var t;return(t=e).__attributes??(t.__attributes={[Er]:e.nodeName.includes("-"),[Ar]:"http://www.w3.org/1999/xhtml"===e.namespaceURI})}var Rr=new Map;function Vr(e){var t=Rr.get(e.nodeName);if(t)return t;Rr.set(e.nodeName,t=[]);for(var i,r=e,s=Element.prototype;s!==r;){for(var a in i=A(r))i[a].set&&t.push(a);r=M(r)}return t}function Nr(e,t){return e===t||new URL(e,document.baseURI).href===new URL(t,document.baseURI).href}function Br(e){return e.split(",").map((e=>e.trim().split(" ").filter(Boolean)))}var Dr=()=>performance.now(),Or={tick:e=>requestAnimationFrame(e),now:()=>Dr(),tasks:new Set};function Fr(){let e=Or.now();Or.tasks.forEach((t=>{t.c(e)||(Or.tasks.delete(t),t.f())})),0!==Or.tasks.size&&Or.tick(Fr)}function jr(e,t){mi((()=>{e.dispatchEvent(new CustomEvent(t))}))}function zr(e){if("float"===e)return"cssFloat";if("offset"===e)return"cssOffset";if(e.startsWith("--"))return e;let t=e.split("-");return 1===t.length?t[0]:t[0]+t.slice(1).map((e=>e[0].toUpperCase()+e.slice(1))).join("")}function qr(e){let t={},i=e.split(";");for(let e of i){let[i,r]=e.split(":");if(!i||void 0===r)break;t[zr(i.trim())]=r.trim()}return t}var Hr=e=>e;function Ur(e,t,i,r){var s,a,n,o,l=!!(1&e),u=!!(2&e),d=!!(4&e),c=l&&u?"both":l?"in":"out",h=t.inert,p=t.style.overflow;function f(){var e=Rt,s=Bt;Nt(null),Dt(null);try{return a??(a=i()(t,r?.()??{},{direction:c}))}finally{Nt(e),Dt(s)}}var m={is_global:d,in(){if(t.inert=h,!l)return o?.abort(),void o?.reset?.();u||n?.abort(),jr(t,"introstart"),n=Wr(t,f(),o,1,(()=>{jr(t,"introend"),n?.abort(),n=a=void 0,t.style.overflow=p}))},out(e){if(!u)return e?.(),void(a=void 0);t.inert=!0,jr(t,"outrostart"),o=Wr(t,f(),n,0,(()=>{jr(t,"outroend"),e?.()}))},stop:()=>{n?.abort(),o?.abort()}},g=Bt;if(((s=g).transitions??(s.transitions=[])).push(m),l&&Oi){var v=d;if(!v){for(var b=g.parent;b&&65536&b.f;)for(;(b=b.parent)&&!(16&b.f););v=!b||!!(32768&b.f)}v&&st((()=>{di((()=>m.in()))}))}}function Wr(e,t,i,r,s){var a=1===r;if(R(t)){var n,o=!1;return $t((()=>{if(!o){var l=t({direction:a?"in":"out"});n=Wr(e,l,i,r,s)}})),{abort:()=>{o=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(i?.deactivate(),!t?.duration)return s(),{abort:V,deactivate:V,reset:V,t:()=>r};let{delay:l=0,css:u,tick:d,easing:c=Hr}=t;var h=[];if(a&&void 0===i&&(d&&d(0,1),u)){var p=qr(u(0,1));h.push(p,p)}var f=()=>1-r,m=e.animate(h,{duration:l,fill:"forwards"});return m.onfinish=()=>{m.cancel();var a=i?.t()??1-r;i?.abort();var n=r-a,o=t.duration*Math.abs(n),l=[];if(o>0){var h=!1;if(u)for(var p=Math.ceil(o/16.666666666666668),g=0;g<=p;g+=1){var v=a+n*c(g/p),b=qr(u(v,1-v));l.push(b),h||(h="hidden"===b.overflow)}h&&(e.style.overflow="hidden"),f=()=>{var e=m.currentTime;return a+n*c(e/o)},d&&function(e){let t;0===Or.tasks.size&&Or.tick(Fr),new Promise((i=>{Or.tasks.add(t={c:e,f:i})}))}((()=>{if("running"!==m.playState)return!1;var e=f();return d(e,1-e),!0}))}(m=e.animate(l,{duration:o,fill:"forwards"})).onfinish=()=>{f=()=>r,d?.(r,1-r),s()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=V)},deactivate:()=>{s=V},reset:()=>{0===r&&d?.(1,0)},t:()=>f()}}var Qr=(o=(0,p._)("_t"),l=(0,p._)("_e"),u=(0,p._)("_i"),d=(0,p._)("_o"),c=class{observe(e,t){var i=(0,h._)(this,o)[o].get(e)||new Set;return i.add(t),(0,h._)(this,o)[o].set(e,i),(0,h._)(this,d)[d]().observe(e,(0,h._)(this,u)[u]),()=>{var i=(0,h._)(this,o)[o].get(e);i.delete(t),0===i.size&&((0,h._)(this,o)[o].delete(e),(0,h._)(this,l)[l].unobserve(e))}}constructor(e){Object.defineProperty(this,d,{value:xv}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),(0,h._)(this,o)[o]=new WeakMap,(0,h._)(this,u)[u]=e}},c.entries=new WeakMap,c),Gr=new Qr({box:"border-box"});function Kr(e,t,i){var r=Gr.observe(e,(()=>i(e[t])));st((()=>(di((()=>i(e[t]))),r)))}function Yr(e,t){return e===t||e?.[D]===t}function Xr(e={},t,i,r){return st((()=>{var s,a;return at((()=>{s=a,a=r?.()||[],di((()=>{e!==i(...a)&&(t(e,...a),s&&Yr(i(...s),e)&&t(null,...s))}))})),()=>{$t((()=>{a&&Yr(i(...a),e)&&t(null,...a)}))}})),e}function Jr(e=!1){let t=Y,i=t.l.u;if(!i)return;let r=()=>function(e){if("object"==typeof e&&e&&!(e instanceof EventTarget))if(D in e)pi(e);else if(!Array.isArray(e))for(let t in e){let i=e[t];"object"==typeof i&&i&&D in i&&pi(i)}}(t.s);if(e){let e=0,i={},s=pe((()=>{let r=!1,s=t.s;for(let e in s)s[e]!==i[e]&&(i[e]=s[e],r=!0);return r&&e++,e}));r=()=>ui(s)}i.b.length&&function(e){et("$effect.pre"),$&&C(e,"name",{value:"$effect.pre"}),at(e)}((()=>{Zr(t,r),B(i.b)})),rt((()=>{let e=di((()=>i.m.map(N)));return()=>{for(let t of e)"function"==typeof t&&t()}})),i.a.length&&rt((()=>{Zr(t,r),B(i.a)}))}function Zr(e,t){if(e.l.s)for(let t of e.l.s)ui(t);t()}function es(e,t,i){if(null==e)return t(void 0),i&&i(void 0),V;let r=di((()=>e.subscribe(t,i)));return r.unsubscribe?()=>r.unsubscribe():r}var ts=[];function is(e,t){return{subscribe:rs(e,t).subscribe}}function rs(e,t=V){let i=null,r=new Set;function s(t){if(q(e,t)&&(e=t,i)){let t=!ts.length;for(let t of r)t[1](),ts.push(t,e);if(t){for(let e=0;e<ts.length;e+=2)ts[e][0](ts[e+1]);ts.length=0}}}function a(t){s(t(e))}return{set:s,update:a,subscribe:function(n,o=V){let l=[n,o];return r.add(l),1===r.size&&(i=t(s,a)||V),n(e),()=>{r.delete(l),0===r.size&&i&&(i(),i=null)}}}}function ss(e,t,i){let r=!Array.isArray(e),s=r?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let a=t.length<2;return is(i,((e,i)=>{let n=!1,o=[],l=0,u=V,d=()=>{if(l)return;u();let s=t(r?o[0]:o,e,i);a?e(s):u="function"==typeof s?s:V},c=s.map(((e,t)=>es(e,(e=>{o[t]=e,l&=~(1<<t),n&&d()}),(()=>{l|=1<<t}))));return n=!0,d(),function(){B(c),u(),n=!1}}))}function as(e){let t;return es(e,(e=>t=e))(),t}var ns=!1,os=Symbol();function ls(e,t,i){var r,s;let a=(r=i)[s=t]??(r[s]={store:null,source:Te(void 0),unsubscribe:V});if(a.store!==e&&!(os in i))if(a.unsubscribe(),a.store=e??null,null==e)a.source.v=void 0,a.unsubscribe=V;else{var n=!0;a.unsubscribe=es(e,(e=>{n?a.source.v=e:_e(a.source,e)})),n=!1}return e&&os in i?as(e):ui(a.source)}function us(){let e={};return[e,function(){it((()=>{for(var t in e)e[t].unsubscribe();C(e,os,{enumerable:!1,value:!0})}))}]}var ds={get(e,t){if(!e.exclude.includes(t))return e.props[t]},set:(e,t)=>($&&function(e){if($){let t=new Error(`props_rest_readonly\nRest element properties of \`$props()\` such as \`${e}\` are readonly\nhttps://svelte.dev/e/props_rest_readonly`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/props_rest_readonly")}(`${e.name}.${String(t)}`),!1),getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},has:(e,t)=>!e.exclude.includes(t)&&t in e.props,ownKeys:e=>Reflect.ownKeys(e.props).filter((t=>!e.exclude.includes(t)))};function cs(e,t,i){return new Proxy($?{props:e,exclude:t,name:i,other:{},to_proxy:[]}:{props:e,exclude:t},ds)}var hs={get(e,t){let i=e.props.length;for(;i--;){let r=e.props[i];if(R(r)&&(r=r()),"object"==typeof r&&null!==r&&t in r)return r[t]}},set(e,t,i){let r=e.props.length;for(;r--;){let s=e.props[r];R(s)&&(s=s());let a=E(s,t);if(a&&a.set)return a.set(i),!0}return!1},getOwnPropertyDescriptor(e,t){let i=e.props.length;for(;i--;){let r=e.props[i];if(R(r)&&(r=r()),"object"==typeof r&&null!==r&&t in r){let e=E(r,t);return e&&!e.configurable&&(e.configurable=!0),e}}},has(e,t){if(t===D||t===O)return!1;for(let i of e.props)if(R(i)&&(i=i()),null!=i&&t in i)return!0;return!1},ownKeys(e){let t=[];for(let i of e.props)if(R(i)&&(i=i()),i){for(let e in i)t.includes(e)||t.push(e);for(let e of Object.getOwnPropertySymbols(i))t.includes(e)||t.push(e)}return t}};function ps(...e){return new Proxy({props:e},hs)}function fs(e){return e.ctx?.d??!1}function ms(e,t,i,r){var s,a=!!(1&i),n=!W||!!(2&i),o=!!(8&i),l=!!(16&i),u=!1;o?[s,u]=function(e){var t=ns;try{return ns=!1,[e(),ns]}finally{ns=t}}((()=>e[t])):s=e[t];var d,c=D in e||O in e,h=o&&(E(e,t)?.set??(c&&t in e&&(i=>e[t]=i)))||void 0,p=r,f=!0,m=!1,g=()=>(m=!0,f&&(f=!1,p=l?di(r):r),p);if(void 0===s&&void 0!==r&&(h&&n&&function(e){if($){let t=new Error(`props_invalid_value\nCannot do \`bind:${e}={undefined}\` when \`${e}\` has a fallback value\nhttps://svelte.dev/e/props_invalid_value`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/props_invalid_value")}(t),s=g(),h&&h(s)),n)d=()=>{var i=e[t];return void 0===i?g():(f=!0,m=!1,i)};else{var v=(a?pe:me)((()=>e[t]));v.f|=131072,d=()=>{var e=ui(v);return void 0!==e&&(p=void 0),void 0===e?p:e}}if(!(4&i)&&n)return d;if(h){var b=e.$$legacy;return function(e,t){return arguments.length>0?((!n||!t||b||u)&&h(t?d():e),e):d()}}var y=!1,S=!1,w=Te(s),x=pe((()=>{var e=d(),t=ui(w);return y?(y=!1,S=!0,t):(S=!1,w.v=e)}));return o&&ui(x),a||(x.equals=U),function(e,t){if(null!==Qt&&(y=S,d(),ui(w)),arguments.length>0){let i=t?ui(x):n&&o?le(e):e;if(!x.equals(i)){if(y=!0,_e(w,i),m&&void 0!==p&&(p=i),fs(x))return e;di((()=>ui(x)))}return e}return fs(x)?x.v:ui(x)}}function gs(e,t,i,r){let s=i[e]?.type;if(!r||!i[e])return t;if("toAttribute"===r)switch(s){case"Object":case"Array":return null==t?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(s){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":default:return t;case"Number":return null!=t?+t:t}}"function"==typeof HTMLElement&&HTMLElement;typeof window<"u"&&((s=(r=window).__svelte??(r.__svelte={})).v??(s.v=new Set)).add("5");var vs,bs={isMobile:void 0,disableInvisibleComponentsTimeout:500,debugLog:!1,devNullLog:!1,defaultLanguage:m.InterfaceLanguage.RU,downloadVKLanguages:!0,updateBuiltinLanguages:!0,isSmoothVideoRotate:!0,showSupport:!0,supportLink:"https://vk.com/support?act=new&from=v",showLogo:void 0,logoLink:"https://vk.com/video",logoType:"vk_video",volumeDefault:1,volumeMinRestore:.05,loaderDelay:500,minSubtitlesFontSize:13,autoSubtitlesTimeout:2e3,allowChangingFullscreenTarget:!0,trafficSavingLimit:m.VideoQuality.Q_480P,highQualityLimit:m.VideoQuality.Q_720P,episodeMinWidthPc:8,hideThumbTimerAfterTouch:!0,preventPauseOnVideoClick:!1,sentry:{dsn:"https://e349fd23c68f405388980d0868d0ff27@sentry.mvk.com/126",sampleRate:.01,whiteErrorCategoryList:[],blackErrorCategoryList:[],whiteErrorIdList:[],blackErrorIdList:[]},features:{autoplay:!0,statistics:!0,thinStatistics:!1,sentry:!0,preload:!0,subtitles:!0,episodes:!0,fullscreen:!0,timelinePreview:!0,mediaSession:!0,annotations:!0,slots:!0,annotationsInside:!1,pip:!0,dpip:!0,download:!0,liveRewind:!0,playbackRate:!0,trafficSaving:!0,episodesClustering:!0,copyVideoLink:!0,videoRotate:!0,tracer:!1,interactiveGraph:!1,interactiveResponsiveUi:!1,seekToInteractive:!0,interactiveLastFrame:!1,interactiveTextPermanent:!0,interactiveHideTime:!0,interactivePlayPrevChapter:!0,interactiveTimeIndicator:!0,interactiveTimeOpenUri:!1,interactiveAreaControlShadow:!1,interactiveControlsExpectTimeBlinkAnimation:!1,interactiveControlsTapPlace:!1,interactiveControlsFillAnimation:!1,interactiveControlsHideAnimation:!1,interactiveHistoryEndChapterFix:!0,thumbTimer:!0,hotKeyMapModal:!0,hotKeyHelpers:!0,saveDebugInfoToFile:!1,saveTraceInfoToFile:!1,additionalButtons:!0,additionalButtonsDesktopControlPanelRight:!0,additionalSettingsMenuItems:!0,additionalContextMenuItems:!0,contextMenuButton:!0,audioLanguages:!1,saveRate:!1,fullscreenInternalTargetPlayerContainer:!1,endScreen:!0,autoplayNext:!0,nextPrevButtons:!0,previewNoEmptySpace:!1,exposeInternalsToGlobal:!1,qualityDetailsSubMenuEnabled:!1,showSlowVideoNotification:!1,forceAutoQualityWhenSevereStallHappens:!1,timeoutShowSlowVideoNotification:0,maxCountShowSlowVideoNotification:1,forcePlayerDisplayBlock:!1,playbackStatusShow:!1,playbackStatusNextVideoShow:!1,initSubtitles:!0,useCallbackForMediaSessionNextPrevClick:!1,usePerformanceFix:!1,userVideoPrefs:!1,savePreferredStatesOnUserActionOnly:!1,useLoopSetting:!1,doubleForwardAvailable:!1,useRichSeek:!1,disableThumbUnstartedOnAutoplay:!1},controls:{showOnStartupAtAutoplay:!0,hideTimeout:500,hideTimeoutMobile:3e3,hideTimeoutInitial:200,hideTimeoutFullscreen:3e3,hideTimeoutCursor:3e3,hideTimeoutTooltips:1e3,collapseMobileUnmute:6e3,hide360IconTimeout:3e3,hideHotKeyHelpers:2e3,playbackRateMin:.25,playbackRateMax:2,playbackRateStep:.25,volumeStepKeyboard:.05,volumeStepWheel:.05,volumeBarTimeout:300,seekStepKeyboard:1e4,seekStepMobile:15e3,seekStepFrame:400},ads:{enable:void 0,initTimeout:2e3,loadTimeout:2e3,runtimeTimeout:5e3,slot:void 0,preview:void 0,paramsOverride:void 0,isMobileGoToSiteButton:!0,useAdmanFromNPM:!1,volumeMultiplier:1,isVsidOriginal:!1},interactive:{historyMaxLength:100,noInteractionEventTimeout:3e4},view:{timelineSliderColor:null,timelineSliderHandleColor:null,timelineSliderFilledColor:null,timelineSliderLoadedColor:null,volumeSliderColor:null,volumeSliderHandleColor:null,volumeSliderFilledColor:null,controlsTimeColor:null,timelineSliderFilledActiveLiveColor:null,timelineSliderHandleActiveLiveColor:null,buttonColor:null,buttonToggleOnColor:null,focusedColor:null,font:null,focusedOutlineWidth:null,focusedOutlineRadius:null,controlsDesktopPaddingHorizontal:null,timelinePaddingHorizontal:null,settingsBackgroundColor:null,controlsGradientHeight:null,controlsGradient:null},userSalt:"0",doubleForwardActivationTime:600,playbackStatusAnimationDuration:1e3,playbackStatusNextVideoAnimationDuration:1e3,suitableDurationForUsingRichSeek:180,titleShowBehaviour:"fullscreen"},ys=()=>ee("ui-config"),Ss="vk_player_debug_panel_opened",ws="f",$s="k",xs="c",ks="m",Ts=new Set(["ArrowLeft","ArrowRight","KeyL","KeyJ"]),_s=new Set(["Tab","Space","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]),Cs=new Set(["ShiftRight","ShiftLeft"]),Es=["TIMELINE"],As=[...Es,"GRAPH_BUTTON"],Ls=[...Es,"PLAY_BUTTON"],Ps=[...As,"PLAY_BUTTON"],Ms=((vs=Ms||{}).XS="xs",vs.S="s",vs.M="m",vs.L="l",vs.XL="xl",vs),Is={xs:0,s:1,m:2,l:3,xl:4},Rs="prod",Vs="1.1.80",Ns=(e,t,i)=>{let r=document.createElement("a");r.href=e,r.download=`${t}.${i}`,r.style.display="none",r.click()},Bs=Symbol("storeContext"),Ds=Symbol("microStoresContext"),Os=()=>{let e=ee(Bs);return(0,m.assertNonNullable)(e,"Store context is empty!"),e},Fs=()=>{let e=ee(Ds);return(0,m.assertNonNullable)(e,"MicroStores context is empty!"),e},js=(e,t)=>zs(e,e.getValue(),t),zs=(e,t,i)=>is(t,(t=>{let r=e.subscribe((e=>{t(e),i?.(e)}));return()=>r.unsubscribe()})),qs=class{async download(e){if(this.pendingDownloads.has(e))return null;this.pendingDownloads.add(e);try{let t=await fetch(e,{signal:this.destroyController.signal});if(t.ok)return await t.text();throw t}finally{this.pendingDownloads.delete(e)}}destroy(){this.destroyController.abort(),this.pendingDownloads.clear()}isDestroyed(){return this.destroyController.signal.aborted}constructor(){this.destroyController=new AbortController,this.pendingDownloads=new Set}},Hs="vk_player_prefer_traffic_saving_enabled",Us="vk_player_preferred_volume",Ws="vk_player_prefer_volume_mute",Qs="vk_player_preferred_quality",Gs="vk_player_preferred_default_quality_settings",Ks="vk_player_preferred_quality_settings_by_video",Ys="vk_player_preferred_stream_language",Xs="vk_player_preferred_rate",Js="vk_player_preferred_autoplay_next",Zs="vk_player_preferred_subtitles_language",ea="vk_player_user_video_prefs",ta="vk_player_preview_track_close_tooltip",ia=e=>e>1?1:e<0?0:e,ra=e=>m.safeStorage.set(Us,ia(e).toString(10)),sa=()=>{let e=m.safeStorage.get(Us);return(0,m.isNullable)(e)?void 0:ia(parseFloat(e))},aa=(e,t)=>m.safeStorage.set(Qs,JSON.stringify({videoId:e,value:t})),na=()=>m.safeStorage.remove(Qs),oa=e=>{let t=m.safeStorage.get(Qs);if((0,m.isNullable)(t))return;let{videoId:i,value:r}=JSON.parse(t);if(e===i)return r;na()},la=(e,t)=>{t?m.safeStorage.set(e,"true"):m.safeStorage.remove(e)},ua=e=>"true"===m.safeStorage.get(e),da=e=>la(Ws,e),ca=e=>la(Hs,e),ha=()=>ua(Hs),pa=e=>m.safeStorage.set(Ys,e),fa=()=>m.safeStorage.get(Zs),ma=e=>{e?m.safeStorage.set(Zs,e):m.safeStorage.remove(Zs)},{getPreferredQualitySettings:ga,migrateSettingsToLegacyWay:va,savePreferredQualitySettings:ba,savePreferredDefaultQualitySettings:ya,removePreferredQualitySettingsByVideo:Sa,getPreferredDefaultQualitySettings:wa}=(()=>{let e=e=>{m.safeStorage.set(Gs,JSON.stringify(e))},t=()=>{try{let e=m.safeStorage.get(Gs);return e?JSON.parse(e):null}catch{return null}},i=e=>{m.safeStorage.set(Ks,JSON.stringify(e))},r=i=>{a(i);let r=i?(()=>{try{let e=m.safeStorage.get(Ks);return e?JSON.parse(e):null}catch{return null}})():null;if(r&&r?.videoId===i)return{...r,appliesTo:"to-video"};r&&s();let n=t();return n?{...n,appliesTo:"as-default"}:(e({type:"auto_quality"}),{type:"auto_quality",appliesTo:"as-default"})},s=()=>{m.safeStorage.remove(Ks)},a=t=>{let r=oa(t);r?i({type:"exact_quality",videoId:t,quality:r}):(ha()&&e({type:"traffic_saving",videoId:t}),ca(!1),na())};return{getPreferredQualitySettings:r,migrateSettingsToLegacyWay:e=>{let t=r(e);if(t){switch(t.type){case"traffic_saving":ca(!0);break;case"exact_quality":aa(e,t.quality)}s(),m.safeStorage.remove(Gs)}},savePreferredQualitySettings:(t,r="as-default")=>{"exact_quality"===t.type||"to-video"===r?i(t):e(t)},savePreferredDefaultQualitySettings:e,removePreferredQualitySettingsByVideo:s,getPreferredDefaultQualitySettings:t,getPreferredSubtitlesLanguage:fa,savePreferredSubtitlesLanguage:ma}})(),$a=()=>{let e=m.safeStorage.get(ea);if(e)try{return JSON.parse(e)}catch{return null}return null},xa=(e,t)=>$a()?.[e]?.[t]??null,ka=(e,t,i)=>{let r=$a()??{},s=r[e]?.[t]??{};Object.assign(s,i,{updatedTs:Date.now()}),e in r||(r[e]={}),r[e][t]=s;let a=function(e){let t=Object.entries(e).reduce(((e,[t,i])=>{let r=0;return Object.values(i).forEach((e=>{r<e.updatedTs&&(r=e.updatedTs)})),e.push([t,r]),e}),[]);return t.sort((([,e],[,t])=>e>t?-1:1)),t.splice(3),t.reduce(((t,[i])=>(t[i]=function(e){let t=Object.entries(e);return t.sort((([,e],[,t])=>e.updatedTs>t.updatedTs?-1:1)),t.splice(3),Object.fromEntries(t)}(e[i]),t)),{})}(r);m.safeStorage.set(ea,JSON.stringify(a))};W=!0;var Ta="var(--btn-color, #fff)",_a=_i('<g filter="url(#strokeAndShadow)"><!></g><defs><filter x="-12" width="72" y="-12" height="72" id="strokeAndShadow"><feMorphology operator="dilate" radius=".4" result="outer"></feMorphology><feFlood flood-color="rgba(0,0,0,0.1)" result="outerColor"></feFlood><feComposite operator="in" in="outerColor" in2="outer" result="outerOutline"></feComposite><feDropShadow in="SourceGraphic" dx="0" dy="0" stdDeviation="3" flood-color="rgba(0,0,0,0.4)" result="outerShadow"></feDropShadow><feMerge><feMergeNode in="outerShadow"></feMergeNode><feMergeNode in="outerOutline"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs>',1),Ca=_i('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill-rule="evenodd" clip-rule="evenodd"><!></svg>');function Ea(e,t){re(t,!0);let i=ms(t,"width",19,(()=>"24")),r=ms(t,"height",19,(()=>"24")),s=ms(t,"fill",3,Ta),a=t.viewBox??`0 0 ${i()} ${r()}`;var n=Ca(),o=Ye(n),l=e=>{var i=_a(),r=Xe(i);Gi(Ye(r),(()=>t.children)),ze(r),qe(),Ai(e,i)},u=e=>{var i=Ei();Gi(Xe(i),(()=>t.children)),Ai(e,i)};Ji(o,(e=>{t.shadow?e(l):e(u,!1)})),ze(n),nt((()=>{Pr(n,"aria-label",t.ariaLabel),Pr(n,"aria-hidden",!t.ariaLabel),Pr(n,"width",i()),Pr(n,"height",r()),Pr(n,"viewBox",a),Pr(n,"fill",s()),xr(n,t.style),Pr(n,"data-testid",t.testId)})),Ai(e,n),se()}var Aa={auto_quality_invariant:"Авто",auto_quality:"Авто ({actual})",auto_quality_option:"Авто",other_quality:"Другое",high_quality:"Высокое качество",high_quality_description:"Будет использовано больше трафика",auto_quality_limit:"Автоматически",traffic_saving_quality:"Экономия трафика",traffic_saving_quality_description:"Видео грузятся быстрее, но качество ниже",default_quality_for_any_video:"Качество для всех видео",quality_applience:"Качество по умолчанию можно {action}",quality_applience_action:"изменить",menu_quality:"Качество",menu_traffic_saving:"Экономия данных",menu_playback_rate:"Скорость",menu_report:"Сообщить о проблеме",menu_pip:"Картинка в картинке",menu_pip_close:"Развернуть видео",menu_copy_video_link:"Скопировать ссылку на видео",menu_copy_video_link_with_timestamp:"Скопировать ссылку на кадр",menu_video_rotate:"Повернуть",menu_video_loop_on:"Включить повторение",menu_video_loop_off:"Отключить повторение",menu_chromecast:"Chromecast трансляция",menu_copy_debug:"Копировать данные для диагностики",menu_save_debug:"Сохранить данные для диагностики",menu_debug_overlay:"Техническая информация",menu_copy_embed_code:"Копировать код для встраивания",menu_audio_languages:"Звуковая дорожка",audio_stream_display_language_label:"{label} ({language})",audio_stream_display_language_label_index:"{label} {index} ({language})",audio_stream_display_label_index:"{label} {index}",audio_stream_display_language_index:"{language} {index}",audio_stream_display_unknown:"Дорожка {index}",pip_dummy_title:"Видео воспроизводится в режиме картинка в картинке",submenu_quality:"Качество",submenu_playback_rate:"Скорость",submenu_settings:"Настройки",submenu_traffic_saving:"Экономия данных",submenu_audio_languages:"Звуковая дорожка",playing_ads:"Реклама {timeleft}",skip_ads_now:"Пропустить рекламу",skip_ads_after:"Пропустить {time}с",visit_advertiser:"Перейти на сайт",aria_timeline:"Ползунок временной шкалы",aria_timeline_value:"{position} (общая длительность {duration}",doubletap_seek_step:"{seconds} секунд",playback_rate_1:"Обычная",playback_rate:"{multiplier}x",video360:"панорамное видео",subtitles_caption:"Субтитры",subtitles_auto:"{language} (Автоматические)",subtitles_off:"Выкл.",subtitles_auto_caption:"Автоматические субтитры",subtitles_turn_on:"Включить субтитры",subtitles_turn_off:"Выключить субтитры",traffic_saving_off:"Откл.",traffic_saving_on:"Вкл.",traffic_saving_helper_text:"При включении качество видео будет снижено для экономии трафика",tooltip_button_disabled:"Кнопка недоступна",tooltip_previous:"Предыдущее видео",tooltip_restart:"Начать заново",tooltip_play:"Смотреть",tooltip_pause:"Пауза",tooltip_next:"Следующее видео",tooltip_interactive_go_back:"Вернуться к предыдущей главе",tooltip_interactive_go_back_disabled:"История прохождения недоступна",tooltip_interactive_go_back_disabled_first:"Вы смотрите первую главу",tooltip_interactive_go_back_disabled_limit:"Лимит возвратов исчерпан",tooltip_chapter_without_interactive:"В этой главе нет интерактива",tooltip_interactive_of_chapter_completed:"Интерактивы этой главы уже пройдены",tooltip_interactive_seek:"Перейти к интерактиву",tooltip_interactive_graph_off:"Показать карту сюжета",tooltip_interactive_graph_on:"Скрыть карту сюжета",tooltip_live:"Перемотать на актуальный лайв",tooltip_episodes:"Эпизоды",tooltip_volume:"Включить звук",tooltip_volume_muted:"Выключить звук",tooltip_sound_unavailable:"Звук недоступен",tooltip_subtitles_off:"Включить субтитры",tooltip_subtitles_on:"Выключить субтитры",tooltip_settings_off:"Открыть настройки",tooltip_settings_on:"Закрыть настройки",tooltip_fullscreen_off:"На весь экран",tooltip_fullscreen_on:"Выйти из полноэкранного режима",tooltip_chromecast_off:"Включить Chromecast",tooltip_chromecast_on:"Выключить Chromecast",tooltip_episode_finished:"Вы уже сделали свой выбор",tooltip_episode_unfinished:"Не пройдено",tooltip_disabled_when_interactive:"Интерактив уже идёт",tooltip_disabled_when_graph_on:"Кнопка недоступна во время просмотра карты",tooltip_interactive_interaction_time_indicator:"Нажмите на элемент интерактива",tooltip_vk_logo:"Открыть в VK Видео",tooltip_vk_video_logo:"Перейти в VK Видео",tooltip_autoplay_off:"Включить автовоспроизведение",tooltip_autoplay_on:"Отключить автовоспроизведение",tooltip_context_menu_open:"Открыть контекстное меню",tooltip_context_menu_close:"Закрыть контекстное меню",download_video_caption:"Скачать видео",hotkey_helper_current_volume:"{value} %",hotkey_map_modal_title:"Быстрые клавиши",hotkey_map_modal_close_btn_text:"Закрыть",hotkey_map_group_title_common:"Общие",hotkey_map_group_title_playback:"Воспроизведение",hotkey_map_group_title_subtitles:"Субтитры",hotkey_map_group_title_episodes:"Эпизоды",hotkey_map_item_mute_description:"Включить или отключить звук",hotkey_map_item_mute_value:"m",hotkey_map_item_volume_up_description:"Увеличить громкость",hotkey_map_item_volume_up_value:"Стрелка вверх",hotkey_map_item_volume_down_description:"Уменьшить громкость",hotkey_map_item_volume_down_value:"Стрелка вниз",hotkey_map_item_pip_description:"Свернуть или развернуть мини-проигрыватель",hotkey_map_item_pip_value:"i",hotkey_map_item_full_screen_description:"Включить или выключить полноэкранный режим",hotkey_map_item_full_screen_value:"f",hotkey_map_item_show_context_menu_description:"Скрыть или показать контекстное меню",hotkey_map_item_show_context_menu_value:"Shift + !",hotkey_map_item_show_hotkey_map_description:"Скрыть или показать список горячих клавиш",hotkey_map_item_show_hotkey_map_value:"Shift + ?",hotkey_map_item_play_toggle_description:"Приостановить или продолжить воспроизведение",hotkey_map_item_play_toggle_value:"Пробел (или k)",hotkey_map_item_seek_backward_description:"Перемотать ролик на 10 секунд назад",hotkey_map_item_seek_backward_value:"Стрелка влево (или j)",hotkey_map_item_seek_forward_description:"Перемотать ролик на 10 секунд вперёд",hotkey_map_item_seek_forward_value:"Стрелка вправо (или l)",hotkey_map_item_fast_seek_backward_description:"Ускоренная перемотка назад",hotkey_map_item_fast_seek_backward_value:"Shift + Стрелка влево",hotkey_map_item_fast_seek_forward_description:"Ускоренная перемотка вперёд",hotkey_map_item_fast_seek_forward_value:"Shift + Стрелка вправо",hotkey_map_item_rate_down_description:"Уменьшить скорость воспроизведения",hotkey_map_item_rate_down_value:"< (Shift + ,)",hotkey_map_item_rate_up_description:"Увеличить скорость воспроизведения",hotkey_map_item_rate_up_value:"> (Shift + .)",hotkey_map_item_prev_frame_description:"Перейти к предыдущему кадру <br />(когда воспроизведение приостановлено)",hotkey_map_item_prev_frame_value:",",hotkey_map_item_next_frame_description:"Перейти к следующему кадру <br />(когда воспроизведение приостановлено)",hotkey_map_item_next_frame_value:".",hotkey_map_item_jump_seek_description:"Перейти к определённому моменту видео <br />(например, при нажатии на цифру «7» ролик будет перемотан до временной отметки, которая соответствует 70% от длительности видео)",hotkey_map_item_jump_seek_value:"0, 1, 2, 3, 4, 5, 6, 7, 8, 9",hotkey_map_item_subtitles_toggle_description:"Включить или отключить субтитры",hotkey_map_item_subtitles_toggle_value:"c",hotkey_map_item_prev_episode_description:"Перейти к предыдущему эпизоду",hotkey_map_item_prev_episode_pc_value:"Ctrl + Стрелка влево",hotkey_map_item_prev_episode_mac_value:"Option + Стрелка влево",hotkey_map_item_next_episode_description:"Перейти к следующему эпизоду",hotkey_map_item_next_episode_pc_value:"Ctrl + Стрелка вправо",hotkey_map_item_next_episode_mac_value:"Option + Стрелка вправо",hotkey_map_item_next_video_description:"Перейти к следующему видео",hotkey_map_item_next_video_value:"Shift + N",hotkey_map_item_prev_video_description:"Перейти к предыдущему видео",hotkey_map_item_prev_video_value:"Shift + P",waiting_live_day_value:"дн",waiting_live_hour_value:"ч",waiting_live_minute_value:"мин",waiting_live_second_value:"сек",waiting_live_colon:":",waiting_live_upcoming_title:"Трансляция еще не началась",waiting_live_timer_title:"До начала трансляции осталось",waiting_live_recover_title:"Трансляция приостановлена - она продолжится, когда автор вернётся",waiting_record_title:"Трансляция завершена - запись появится позже",aria_label_video_player:"Видео плеер",aria_label_spherical_control:"Контроллер для сферического видео. Используйте клавиши со стрелками для панорамирования видео.",aria_label_debug_panel:"Область с технической информацией, сделайте скриншот для техподдержки",aria_label_new_tab_alert:"Откроется в новой вкладке.",aria_label_menu_quality:"Качество: {actual}",aria_label_menu_audio_languages:"Язык аудио: {actual}",aria_label_menu_rate:"Скорость: {actual}",aria_label_menu_subtitle:"Субтитры: {actual}",aria_label_menu_download:"Скачать видео",aria_label_menu_debug_overlay:"Отображение технической информации",aria_label_menu_rotate:"Повернуть видео на 90 градусов",aria_label_menu_loop:"Переключение режима повторения",aria_label_submenu_back:"Вернуться в меню настроек",aria_label_submenu_traffic_saving:"Режим экономии данных",aria_label_settings:"Настройки",aria_label_context_menu:"Контекстное меню",aria_label_autoplay:"Автовоспроизведение",end_screen_next_video:"Следующее видео",end_screen_recommended_video:"Рекомендуемое видео",slow_video_notification_button:"Выбрать качество «Авто»",slow_video_notification_force_description:"Видео грузится слишком медленно,\nкачество изменено на «Авто»",slow_video_notification_suggest_description:"Видео загружается слишком медленно -\nпопробуйте изменить качество на «Авто»",double_forward_label:"2x",preview_track_notification_text:"Потяните вверх для точной перемотки",preview_track_close_tooltip:"Выйти из режима точной перемотки"},La={auto_quality_invariant:"Auto",auto_quality:"Auto ({actual})",auto_quality_option:"Auto",other_quality:"Other",high_quality:"High quality",high_quality_description:"Uses more data",auto_quality_limit:"Auto",traffic_saving_quality:"Data saving",traffic_saving_quality_description:"Videos load faster but at lower quality",quality_applience:"You can {action} the default quality",quality_applience_action:"change",default_quality_for_any_video:"Quality for all videos",menu_quality:"Quality",menu_playback_rate:"Playback rate",menu_traffic_saving:"Data saving",menu_report:"Report a problem",menu_pip:"Picture in picture",menu_pip_close:"Expand video",menu_copy_video_link:"Copy video link",menu_copy_video_link_with_timestamp:"Copy link with timestamp",menu_video_rotate:"Rotate",menu_video_loop_on:"Enable loop",menu_video_loop_off:"Disable loop",menu_chromecast:"Chromecast stream",menu_copy_debug:"Copy debug info",menu_save_debug:"Save debug info",menu_debug_overlay:"Tech stats",menu_copy_embed_code:"Copy embed code",menu_audio_languages:"Audio track",audio_stream_display_language_label:"{label} ({language})",audio_stream_display_language_label_index:"{label} {index} ({language})",audio_stream_display_label_index:"{label} {index}",audio_stream_display_language_index:"{language} {index}",audio_stream_display_unknown:"Audio track {index}",pip_dummy_title:"Video plays in picture-in-picture mode",submenu_quality:"Quality",submenu_playback_rate:"Playback rate",submenu_traffic_saving:"Data saving",submenu_settings:"Settings",submenu_audio_languages:"Audio track",playing_ads:"Ads {timeleft}",skip_ads_after:"Skip ads",skip_ads_now:"Skip {time}s",visit_advertiser:"Visit site",aria_timeline:"Time scale slider",aria_timeline_value:"{position} out of {duration}",doubletap_seek_step:"{seconds} seconds",playback_rate_1:"Normal",playback_rate:"{multiplier}x",video360:"spherical video",subtitles_caption:"Subtitles",subtitles_auto:"{language} (Auto-generated)",subtitles_off:"Off",subtitles_auto_caption:"Auto subtitles",subtitles_turn_on:"Turn on subtitles",subtitles_turn_off:"Turn off subtitles",traffic_saving_off:"Off",traffic_saving_on:"On",traffic_saving_helper_text:"When turned on the video quality will be reduced to save data",tooltip_button_disabled:"Button disabled",tooltip_previous:"Previous video",tooltip_restart:"Watch again",tooltip_play:"Play",tooltip_pause:"Pause",tooltip_next:"Next video",tooltip_interactive_go_back:"Back to previous chapter",tooltip_interactive_go_back_disabled:"Interactive history unavailable",tooltip_interactive_go_back_disabled_first:"You're watching the first chapter",tooltip_interactive_go_back_disabled_limit:"Go-back limit exceeded",tooltip_chapter_without_interactive:"This chapter has no interactive segment",tooltip_interactive_of_chapter_completed:"Chapter's interactive segments already watched",tooltip_interactive_seek:"Go to interactive",tooltip_interactive_graph_off:"Show interactive graph",tooltip_interactive_graph_on:"Hide interactive graph",tooltip_live:"Go to the live edge",tooltip_episodes:"Episodes",tooltip_volume:"Volume off",tooltip_volume_muted:"Turn volume on",tooltip_sound_unavailable:"Sound unavailable",tooltip_subtitles_off:"Turn subtitles on",tooltip_subtitles_on:"Turn subtitles off",tooltip_settings_off:"Open settings",tooltip_settings_on:"Close settings",tooltip_fullscreen_off:"Enter fullscreen mode",tooltip_fullscreen_on:"Exit fullscreen mode",tooltip_chromecast_off:"Turn Chromecast on",tooltip_chromecast_on:"Turn Chromecast off",tooltip_episode_finished:"You have already viewed interactive episode",tooltip_episode_unfinished:"Interactive episode not finished",tooltip_disabled_when_interactive:"Interactive video in progress",tooltip_disabled_when_graph_on:"Button is disabled when graph is opened",tooltip_interactive_interaction_time_indicator:"Press the interactive element",tooltip_vk_logo:"Open in VK Video",tooltip_vk_video_logo:"Go to VK Video",tooltip_autoplay_off:"Turn autoplay on",tooltip_autoplay_on:"Turn autoplay off",tooltip_context_menu_open:"Open context menu",tooltip_context_menu_close:"Close context menu",download_video_caption:"Download video",hotkey_helper_current_volume:"{value} %",hotkey_map_modal_title:"Keyboard shortcuts",hotkey_map_modal_close_btn_text:"Close",hotkey_map_group_title_common:"Common",hotkey_map_group_title_playback:"Playback",hotkey_map_group_title_subtitles:"Subtitles",hotkey_map_group_title_episodes:"Episodes",hotkey_map_item_mute_description:"Toggle mute",hotkey_map_item_mute_value:"m",hotkey_map_item_volume_up_description:"Increase volume",hotkey_map_item_volume_up_value:"Arrow up",hotkey_map_item_volume_down_description:"Decrease volume",hotkey_map_item_volume_down_value:"Arrow down",hotkey_map_item_pip_description:"Toggle miniplayer",hotkey_map_item_pip_value:"i",hotkey_map_item_full_screen_description:"Toggle full screen",hotkey_map_item_full_screen_value:"f",hotkey_map_item_show_context_menu_description:"Hide or show context menu",hotkey_map_item_show_context_menu_value:"Shift + !",hotkey_map_item_show_hotkey_map_description:"Hide or show list of hotkeys",hotkey_map_item_show_hotkey_map_value:"Shift + ?",hotkey_map_item_play_toggle_description:"Toggle play/pause",hotkey_map_item_play_toggle_value:"Space (or k)",hotkey_map_item_seek_backward_description:"Rewind 10 seconds",hotkey_map_item_seek_backward_value:"Arrow left (or j)",hotkey_map_item_seek_forward_description:"Forward 10 seconds",hotkey_map_item_seek_forward_value:"Arrow right (or l)",hotkey_map_item_fast_seek_backward_description:"Fast rewind",hotkey_map_item_fast_seek_backward_value:"Shift + Arrow left",hotkey_map_item_fast_seek_forward_description:"Fast forward",hotkey_map_item_fast_seek_forward_value:"Shift + Arrow right",hotkey_map_item_rate_down_description:"Decrease playback rate",hotkey_map_item_rate_down_value:"< (Shift + ,)",hotkey_map_item_rate_up_description:"Increase playback rate",hotkey_map_item_rate_up_value:"> (Shift + .)",hotkey_map_item_prev_frame_description:"Previous frame (while paused)",hotkey_map_item_prev_frame_value:",",hotkey_map_item_next_frame_description:"Next frame (while paused)",hotkey_map_item_next_frame_value:".",hotkey_map_item_jump_seek_description:"Seek to specific point in the video (7 advances to 70% of duration)",hotkey_map_item_jump_seek_value:"0, 1, 2, 3, 4, 5, 6, 7, 8, 9",hotkey_map_item_subtitles_toggle_description:"Toggle captions ON/OFF",hotkey_map_item_subtitles_toggle_value:"c",hotkey_map_item_prev_episode_description:"Seek to previous episode",hotkey_map_item_prev_episode_pc_value:"Ctrl + Arrow left",hotkey_map_item_prev_episode_mac_value:"Option + Arrow left",hotkey_map_item_next_episode_description:"Seek to next episode",hotkey_map_item_next_episode_pc_value:"Ctrl + Arrow right",hotkey_map_item_next_episode_mac_value:"Option + Arrow right",hotkey_map_item_next_video_description:"Next video",hotkey_map_item_next_video_value:"Shift + N",hotkey_map_item_prev_video_description:"Previous video",hotkey_map_item_prev_video_value:"Shift + P",waiting_live_day_value:"d",waiting_live_hour_value:"h",waiting_live_minute_value:"min",waiting_live_second_value:"sec",waiting_live_colon:":",waiting_live_upcoming_title:"The broadcast hasn't started yet",waiting_live_timer_title:"Before the start of the broadcast left",waiting_live_recover_title:"The broadcast has been paused - it will resume when the author returns",waiting_record_title:"The broadcast completed - recording will appear later",aria_label_video_player:"Video player",aria_label_spherical_control:"Spherical video control. Use the arrow keys to pan the video.",aria_label_debug_panel:"Technical information area, take a screenshot for technical support",aria_label_new_tab_alert:"Opens in a new tab.",aria_label_menu_quality:"Quality: {actual}",aria_label_menu_audio_languages:"Audio language: {actual}",aria_label_menu_rate:"Rate: {actual}",aria_label_menu_subtitle:"Subtitles: {actual}",aria_label_menu_download:"Download video",aria_label_menu_debug_overlay:"Display of technical information",aria_label_menu_rotate:"Rotate video 90 degrees",aria_label_menu_loop:"Toggle loop",aria_label_submenu_back:"Return to settings menu",aria_label_submenu_traffic_saving:"Data saving mode",aria_label_settings:"Settings",aria_label_context_menu:"Context menu",aria_label_autoplay:"Autoplay",end_screen_next_video:"Next video",end_screen_recommended_video:"Recommended video",slow_video_notification_button:"Select Auto quality",slow_video_notification_force_description:"The video is loading too slowly,\nso the quality was changed to Auto",slow_video_notification_suggest_description:"The video is loading too slowly.\nTry switching the quality to Auto.",double_forward_label:"2x",preview_track_notification_text:"pull up to open precise rewind",preview_track_close_tooltip:"dismiss precise rewind"},Pa=new Map;Pa.set(m.InterfaceLanguage.EN,La),Pa.set(m.InterfaceLanguage.RU,Aa);var Ma,Ia,Ra=new Map,Va=({language:e,pack:t,fallback:i})=>{if(Pa.has(e)){let i=Pa.get(e);Pa.set(e,{...i,...t})}else Pa.set(e,t);Ra.set(e,i)},Na=e=>Pa.has(e),Ba=(e,t,i,r)=>{let s=Pa.get(e)?.[t];if((0,m.isNullable)(s)){let i=Ra.get(e)??r;s=(i?Pa.get(i):void 0)?.[t]}return(0,m.isNullable)(s)?t+Object.values(i??{}).join(" "):i?s.replaceAll(/{(\w+?)}/g,((e,t)=>i[t]??"")):s},Da=(e,t)=>{let{interfaceLanguage$:i}=Os(),r=as(i),s=ys();return Ba(r,e,t,s.defaultLanguage)},Oa=_i('<path d="M26.86 15.18a3.7 3.7 0 0 0 2.53-3.6C29.4 8.91 27.2 7 24.07 7c-1.96 0-3.57.78-4.67 2.29l-.1.15a1.33 1.33 0 0 0 .26 1.85c.54.4 1.3.35 1.74-.16l.2-.25a3 3 0 0 1 2.5-1.3c1.53 0 2.6.91 2.6 2.25 0 1.36-1.09 2.27-2.65 2.27h-.58a1.23 1.23 0 0 0 0 2.47h.58c1.75 0 2.91.98 2.91 2.39 0 1.45-1.19 2.46-2.88 2.46a3.2 3.2 0 0 1-2.89-1.6l-.2-.29a1.4 1.4 0 0 0-2.05-.25 1.3 1.3 0 0 0-.3 1.68l.21.33A6 6 0 0 0 24 24c3.28 0 5.63-2.04 5.63-4.92a4 4 0 0 0-2.77-3.9M37.73 12.68c-.46 0-1 .04-1.5.16L38.8 9.1a1.34 1.34 0 1 0-2.2-1.52l-3.76 5.47C31.43 15.18 31 16.87 31 18.33 31 21.8 33.56 24 37.19 24c3.6 0 6.16-2.4 6.16-5.77a5.4 5.4 0 0 0-5.63-5.56m-.53 8.74c-1.98 0-3.33-1.27-3.33-3.14 0-1.85 1.35-3.14 3.33-3.14 1.95 0 3.3 1.29 3.3 3.14 0 1.87-1.35 3.14-3.3 3.14m20.8-5.9c0 5.03-2.7 8.43-6.63 8.43s-6.62-3.4-6.62-8.44 2.7-8.44 6.62-8.44S58 10.47 58 15.51m-10.35 0c0 3.56 1.49 5.85 3.72 5.85s3.72-2.3 3.72-5.86-1.48-5.86-3.72-5.86c-2.23 0-3.72 2.3-3.72 5.86M67 9.49A3.5 3.5 0 0 1 63.51 13 3.5 3.5 0 0 1 60 9.49 3.5 3.5 0 0 1 63.51 6 3.5 3.5 0 0 1 67 9.49m-5 0c0 .83.68 1.51 1.51 1.51.81 0 1.5-.68 1.5-1.51 0-.81-.69-1.5-1.5-1.5-.83 0-1.51.69-1.51 1.5ZM67 23.5c0-1.32-1.2-3.1-4.2-4.67a1.5 1.5 0 1 1 1.4-2.66c3.25 1.72 5.8 4.26 5.8 7.33 0 3.13-2.56 5.55-6.09 7.27-3.63 1.77-8.82 3.06-15.26 3.72a1.5 1.5 0 0 1-.3-2.98c6.25-.64 11.05-1.88 14.25-3.44 3.3-1.6 4.4-3.27 4.4-4.57M38.88 35H38c-9.64 0-17.45-1.13-22.9-3.02-2.72-.94-4.94-2.1-6.5-3.47C7.01 27.14 6 25.44 6 23.5a6.2 6.2 0 0 1 1.9-4.25 16 16 0 0 1 4.43-3.1 1.5 1.5 0 1 1 1.34 2.7q-2.39 1.19-3.59 2.46C9.3 22.14 9 22.87 9 23.5c0 .8.4 1.74 1.57 2.76s3 2.01 5.51 2.89C21.11 30.89 28.55 32 38 32h.88l-1.44-1.44a1.5 1.5 0 0 1 2.12-2.12l4 4h.01a1.5 1.5 0 0 1 .32 1.63 2 2 0 0 1-.33.5l-4 4a1.5 1.5 0 0 1-2.12-2.13z"></path>');function Fa(e,t){re(t,!1);let i=Da("video360");Jr(),Ea(e,{width:"76",height:"45",get ariaLabel(){return i},testId:"video-360-icon",shadow:!0,children:(e,t)=>{Ai(e,Oa())},$$slots:{default:!0}}),se()}(Ia=Ma||(Ma={})).fatal="fatal",Ia.error="error",Ia.warning="warning",Ia.log="log",Ia.info="info",Ia.debug="debug",Ia.critical="critical";var ja=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,za=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,qa=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,Ha="?",Ua=/^(?:(\w+):)\/\/(?:([\w-]+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Wa(e){return(e&&e.message||"No error message").split("\n").filter((e=>!!e))[0]}function Qa(e){try{let t=function(e){if(!e.stack)return null;let t,i,r=[],s=e.stack.split("\n");for(let a=0;a<s.length;++a){if(t=ja.exec(s[a]))i={filename:t[2]&&0===t[2].indexOf("address at ")?t[2].substr(11):t[2],function:t[1]||Ha,lineno:t[3]?+t[3]:null,colno:t[4]?+t[4]:null};else if(t=qa.exec(s[a]))i={filename:t[2],function:t[1]||Ha,lineno:+t[3],colno:t[4]?+t[4]:null};else{if(!(t=za.exec(s[a])))continue;0===a&&!t[5]&&void 0!==e.columnNumber&&(r[0].column=e.columnNumber+1),i={filename:t[3],function:t[1]||Ha,lineno:t[4]?+t[4]:null,colno:t[5]?+t[5]:null}}!i.function&&i.lineno&&(i.function=Ha),r.push(i)}return r.length?{value:Wa(e),type:e.name,stacktrace:{frames:r.reverse()}}:null}(e);if(t)return t}catch{}return{value:Wa(e),type:e&&e.name,stacktrace:{frames:[]}}}var Ga=class{prepare(e){return{...this.getRequestBlank(),exception:{values:[Qa(e)]}}}report(e){this.send(this.prepare(e))}send(e){!this.apiUrl||!e||this.createRequest(e)}createRequest(e){let t=new XMLHttpRequest;t.open("POST",this.apiUrl,!0),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-Sentry-Auth",this.authHeader||""),t.send(JSON.stringify(e))}getRequestBlank(){return{platform:"javascript",event_id:"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),sdk:{name:"micro-sentry.javascript.core",version:"0.0.0"},timestamp:Date.now()/1e3,environment:this.environment}}constructor(e){if(e&&e.dsn){let t=Ua.exec(e.dsn),i=t?t.slice(1):[],r=i[5].split("/"),s=r.slice(0,-1).join("/");this.apiUrl=i[0]+"://"+i[3]+(i[4]?":"+i[4]:"")+(s?"/"+s:"")+"/api/"+r.pop()+"/store/",this.authHeader="Sentry sentry_version=7,sentry_key="+i[1]+(i[2]?",sentry_secret="+i[2]:"")}this.environment=e&&e.environment}};function Ka(e,t){return"[object RegExp]"===Object.prototype.toString.call(t)?t.test(e):"string"==typeof t&&-1!==e.indexOf(t)}var Ya=class e extends Ga{get state(){return this._state}clearState(){this._state={}}setTags(e){return this.setKeyState("tags",{...e}),this}setTag(e,t){return this.extendState({tags:{[e]:t}}),this}setExtra(e,t){return this.extendState({extra:{[e]:t}}),this}setExtras(e){return this.setKeyState("extra",{...e}),this}setUser(e){return this.setKeyState("user",{...e}),this}clone(){let t=new e({...this.options,plugins:[]});return t.extendState(this.state),t}withScope(e){let t=this.clone();e(t),t.destroy(),this.setBreadcrumbs(void 0)}addBreadcrumb(e){this.extendState({breadcrumbs:[{timestamp:Date.now()/1e3,...this.beforeBreadcrumb(e)}]})}setBreadcrumbs(e){this.setKeyState("breadcrumbs",e)}captureMessage(e,t){this.send({...this.getRequestBlank(),message:e,level:t})}destroy(){this.destroyed=!0,this.plugins.forEach((e=>{e.destroy&&e.destroy()}))}isIgnoredError(e){return!!this.ignoreErrors.length&&this.getPossibleEventMessages(e).some((e=>this.ignoreErrors.some((t=>Ka(e,t)))))}getRequestBlank(){return{request:{url:this.window.location.toString(),headers:{"User-Agent":this.window.navigator.userAgent}},...super.getRequestBlank(),sdk:{name:"micro-sentry.javascript.browser",version:"0.0.0"},...this.state}}send(e){this.destroyed||this.isDeniedUrl(e)||this.isIgnoredError(e)||(super.send(this.beforeSend({release:this.release,...e})),this.setBreadcrumbs(void 0))}getPossibleEventMessages(e){if(e.message)return[e.message];if(e.exception)try{let{type:t="",value:i=""}=e.exception.values&&e.exception.values[0]||{};return[`${i}`,`${t}: ${i}`]}catch{return[]}return[]}isDeniedUrl(e){if(!this.blacklistUrls.length)return!1;let t=this.getEventFilterUrl(e);return!!t&&this.blacklistUrls.some((e=>Ka(t,e)))}getEventFilterUrl(e){try{if(e.exception){let t=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return t&&t[t.length-1].filename||null}return null}catch{return null}}extendState(e){this._state=Object.keys(e).reduce(((t,i)=>{let r=this._state[i],s=Array.isArray(r)?r:null,a=e[i],n=Array.isArray(a)?a:null;return{...t,[i]:s||n?[...s||[],...n||[]]:{..."string"!=typeof r?r:{},..."string"!=typeof a?a:{}}}}),this._state)}setKeyState(e,t){this._state[e]=t}constructor(e,t=function(){return window}()){super(e),this.options=e,this.window=t,this.destroyed=!1,this._state={};let{plugins:i=[],beforeSend:r=e=>e,beforeBreadcrumb:s=e=>e,blacklistUrls:a=[],ignoreErrors:n=[],release:o}=this.options||{};this.plugins=i.map((e=>new e(this))),this.beforeSend=r,this.beforeBreadcrumb=s,this.blacklistUrls=a,this.ignoreErrors=n,this.release=o}},Xa=null,Ja=class{destroy(){this.sentryClient?.destroy(),this.sentrySubscription?.unsubscribe(),Xa=null}logIError(e,t=!1){e.thrown&&this.report(e.thrown,{fatal:t,errorType:e.id,category:e.category},{message:e.message,errorData:e.data})}report(e,t={},i={}){let{sentryClient:r,context:s,options:a}=this,{sampleRate:n=0,whiteErrorIdList:o,whiteErrorCategoryList:l=[],blackErrorIdList:u,blackErrorCategoryList:d}=a,{errorType:c,category:h}=t;if(!((0,m.isNonNullable)(h)&&d.includes(h)||(0,m.isNonNullable)(c)&&u.includes(c))&&(Math.random()<=n||(0,m.isNonNullable)(h)&&l.includes(h)||(0,m.isNonNullable)(c)&&o.includes(c))){Object.keys(t).length&&r.setTags({version:this.version,...t}),(Object.keys(s).length||Object.keys(i).length)&&r.setExtras({...s,...i});try{c&&r.captureMessage(c,t.fatal?Ma.fatal:Ma.error),r.report(e)}catch(e){console.error(e)}}}static getInstance(){return Xa}constructor(e,t,i={}){!Xa&&e.dsn&&(this.sentryClient=new Ya({dsn:e.dsn,environment:t.env}),this.version=t.version,this.sentrySubscription=new m.Subscription,this.options=e,this.context=i,Xa=this)}},Za=(e=>(e.Thumb="thumb",e.Video="video",e.Ads="ads",e.Crashed="crashed",e.LiveWaitingStart="LiveWaitingStart",e.LiveWaitingRecover="LiveWaitingRecover",e.LiveWaitingRecord="LiveWaitingRecord",e))(Za||{}),en=e=>{if(e.requestFullscreen)return e.requestFullscreen();if(e.msRequestFullscreen)return e.msRequestFullscreen();if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen();if(e.mozRequestFullScreen)return e.mozRequestFullScreen();let t=e.querySelector("video");return t?.webkitEnterFullscreen?(t.webkitEnterFullscreen(),Promise.resolve()):Promise.reject()},tn=e=>e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():Promise.reject(),rn=()=>{let e=document;return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement},sn=()=>!!rn(),an=e=>{document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)},nn=e=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)},on=class{isSupported(){return document.pictureInPictureEnabled}isActive(){return this.info.isActive$.getValue()}setContext(e){this.svelteContext=e}async revealPictureInPicture(){this.isRequested&&(this.removeEventHandlers(),await this.request(),this.addEventHandlers())}async request(){if(this.isSupported()&&!this.isActive())try{await(this.videoElement?.requestPictureInPicture())}catch{this.isRequested=!1}}async exit(){!this.isSupported()||!this.isActive()||await document.exitPictureInPicture()}assignPlayerContainer(e){this.isSupported()&&(this.playerContainer=e)}updateVideoElement(){this.isSupported()&&this.exit().finally((()=>{this.removeEventHandlers(),this.videoElement=this.playerContainer?.querySelector("video"),this.addEventHandlers()}))}addEventHandlers(){this.videoElement?.addEventListener("enterpictureinpicture",this.eventHandlers.enterpictureinpicture),this.videoElement?.addEventListener("leavepictureinpicture",this.eventHandlers.leavepictureinpicture)}setExternalEventHandlers(e){this.externalEventHandlers={...e}}removeEventHandlers(){this.videoElement?.removeEventListener("enterpictureinpicture",this.eventHandlers.enterpictureinpicture),this.videoElement?.removeEventListener("leavepictureinpicture",this.eventHandlers.leavepictureinpicture)}async dispose(){this.removeEventHandlers(),await this.exit(),this.info.isActive$.next(!1),this.isRequested=!1}onEnterPictureInPicture(e){let t=e.pictureInPictureWindow;t&&(this.info.isActive$.next(!0),this.isRequested=!0,t.addEventListener("resize",this.eventHandlers.resize),this.externalEventHandlers.enterpictureinpicture?.(e))}onLeavePictureInPicture(e){let t=e.pictureInPictureWindow;this.info.isActive$.next(!1),this.isRequested=!1,this.eventHandlers.resize.cancel(),t?.removeEventListener("resize",this.eventHandlers.resize),this.externalEventHandlers.leavepictureinpicture?.(e)}onResize(e){this.externalEventHandlers.resize?.(e)}setEnabled(e){this.info.isEnabled$.next(e)}constructor({enabled:e=!0}={enabled:!0}){this.isRequested=!1,this.videoElement=void 0,this.playerContainer=void 0,this.externalEventHandlers={},this.eventHandlers={enterpictureinpicture:this.onEnterPictureInPicture.bind(this),leavepictureinpicture:this.onLeavePictureInPicture.bind(this),resize:(0,m.debounceFn)(this.onResize.bind(this),300)},this.info={isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1),type:0},this.info.isEnabled$=new m.ValueSubject(e)}};function ln(e){return e instanceof on}var un=_i('<path d="M11.74 6.74a.9.9 0 0 1-1.28 0L6 2.27 1.54 6.74A.9.9 0 1 1 .26 5.46l5.1-5.1a.9.9 0 0 1 1.28 0l5.1 5.1a.9.9 0 0 1 0 1.28Z"></path>'),dn=_i('<path d="m5.773 8 3.363 3.364a.9.9 0 1 1-1.272 1.272l-4-4a.9.9 0 0 1 0-1.272l4-4a.9.9 0 0 1 1.272 1.272L5.773 8z"></path>');function cn(e,t){re(t,!0);let i=ms(t,"direction",3,"left"),r=ms(t,"useBtnColor",3,!1),s=fe((()=>["up","down"].includes(i()))),a=fe((()=>["right","down"].includes(i()))),n=fe((()=>`chevron-icon--${i()}`)),o=fe((()=>(()=>{let e="";return ui(a)&&(e+="transform: rotate(180deg);"),e.length?e:void 0})())),l=fe((()=>r()?Ta:"currentColor")),u=fe((()=>ui(s)?"7":"16"));Ea(e,{width:"12",get height(){return ui(u)},get fill(){return ui(l)},get testId(){return ui(n)},get style(){return ui(o)},children:(e,t)=>{var i=Ei(),r=Xe(i),a=e=>{Ai(e,un())},n=e=>{Ai(e,dn())};Ji(r,(e=>{ui(s)?e(a):e(n,!1)})),Ai(e,i)},$$slots:{default:!0}}),se()}var hn=(e,t,i)=>{e.stopPropagation(),ui(t)&&i()()},pn=Ti('<div class="skip s-17"> <!></div>'),fn=Ti("<div><!></div>"),mn={hash:"s-17",code:".container.s-17{background:rgba(0,0,0,.56);border-radius:6px;color:#fff;font-size:13px;padding:6px 10px;position:absolute;right:16px;top:14px;transition:color .2s}.container-mobile.s-17{bottom:14px;font-size:15px;max-width:142px;top:unset}.skip.s-17{align-items:flex-end;display:flex;gap:4px;white-space:nowrap}.skippable.s-17{color:var(--white);cursor:pointer}.skippable.s-17:hover{color:hsla(0,0%,100%,.75)}"};function gn(e,t){re(t,!0),fr(e,mn);let[i,r]=us(),s=ms(t,"position",3,0),a=ms(t,"secondsToWatchBeforeSkip",3,0),n=ms(t,"skipAd",3,m.noop),o=Os().ui.isMobile,l=fe((()=>s()>0&&s()>=a()));var u=fn();let d;u.__click=[hn,l,n];var c=Ye(u),h=e=>{var t=pn(),i=Ye(t);cn(Je(i),{direction:"right"}),ze(t),nt((e=>ji(i,`${e??""} `)),[()=>Da("skip_ads_now")]),Ai(e,t)},p=e=>{var t=Ci();nt((e=>ji(t,e)),[()=>Da("skip_ads_after",{time:Math.ceil(a()-s()).toFixed(0)})]),Ai(e,t)};Ji(c,(e=>{ui(l)?e(h):e(p,!1)})),ze(u),nt((e=>d=wr(u,1,"container s-17",null,d,e)),[()=>({"container-mobile":ls(o,"$isMobile",i),skippable:ui(l)})]),Ai(e,u),se(),r()}wi(["click"]);var vn=Ti('<button class="go-to-site s-16"> </button>'),bn={hash:"s-16",code:"button.go-to-site.s-16{background:#fff;border:none;border-radius:6px;bottom:14px;color:#000;font-size:15px;left:16px;padding:6px 10px;pointer-events:none;position:absolute}"};var yn=Ti('<div class="top-gradient-mobile s-n"></div>'),Sn=Ti('<div class="container s-n"><!> <video style="width: 100%; height: 100%" playsinline=""></video> <!> <!> <!></div>',2),wn={hash:"s-n",code:".container.s-n{height:100%;width:100%}.top-gradient-mobile.s-n{background:linear-gradient(1turn,transparent,rgba(0,0,0,.05) 12%,rgba(0,0,0,.15) 25%,rgba(0,0,0,.3) 45%,rgba(0,0,0,.4) 57%,rgba(0,0,0,.5) 77%,rgba(0,0,0,.55) 88%,rgba(0,0,0,.65));height:80px;left:0;pointer-events:none;position:absolute;top:0;width:100%}"};function $n(e,t){re(t,!0),fr(e,wn);let[i,r]=us(),s=()=>ls(S,"$adPlaybackState",i),a=()=>ls(f,"$isMobile",i),n=ms(t,"adsSlotId",3,void 0),o=ms(t,"adsParams",3,void 0),l=ms(t,"adsAutoplayParam",3,void 0),u=ms(t,"duration",3,0),d=ms(t,"adsExternalApi",3,void 0),c=Os(),h=ys(),p=c.state.isEnded$,f=c.ui.isMobile,g=h.ads.isMobileGoToSiteButton,v=ke(void 0),b=ke(void 0),y=!1,S=c.ads.playbackState,w=c.ads.canSkip,$=c.ads.position,x=c.ads.secondsToWatchBeforeSkip,k=fe((()=>ls(w,"$canSkipAd",i)&&"inactive"!==s())),T=fe((()=>a()&&"inactive"!==s()&&g));Ki((()=>{let e=c.getAdmanWrapper();if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_mount"],numbers:[(0,m.now)(),n()]}),!n())return void e.onAdmanLoadingError();let t=async t=>{t&&await li();let i=(()=>{let{width:e,height:t}=as(c.ui.playerSize),i=as(c.ui.isFullscreen),r=l()??as(c.ui.isAutoplay),s=h.ads.paramsOverride;return{width:e,height:t,isFullscreen:i,isAutoplay:r,adsContainer:ui(v),adsVideoElement:ui(b),slotId:n(),params:o(),paramsOverride:s,duration:u(),externalApi:d()}})();await e.initAdman(i),y=!0},i=new AbortController;return window.AdmanHTML?t(!0).catch((()=>{e.onAdmanLoadingError()})):e.loadAdman(i.signal).then((()=>t(!1))).catch((()=>{e.onAdmanLoadingError()})),()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_unmount"],numbers:[(0,m.now)(),n()]}),!y&&i.abort()}}));var _=Sn(),C=Ye(_),E=e=>{Ai(e,yn())};Ji(C,(e=>{a()&&e(E)}));var A=Je(C,2);Xr(A,(e=>_e(b,e)),(()=>ui(b)));var L=Je(A,2),P=e=>{gn(e,{get position(){return ls($,"$adPosition",i)},get secondsToWatchBeforeSkip(){return ls(x,"$secondsToWatchBeforeSkipAd",i)},get skipAd(){return c.actions.internal.skipAd}})};Ji(L,(e=>{ui(k)&&e(P)}));var M=Je(L,2),I=e=>{!function(e,t){re(t,!1);let i=Os();Ki((()=>{i.getAdmanWrapper().startPostroll()})),Jr(),se()}(0,{})};Ji(M,(e=>{ls(p,"$isVideoEnded",i)&&e(I)}));var R=Je(M,2),V=e=>{!function(e,t){re(t,!1),fr(e,bn),Jr();var i=vn(),r=Ye(i,!0);ze(i),nt((e=>ji(r,e)),[()=>Da("visit_advertiser")],me),Ai(e,i),se()}(e,{})};Ji(R,(e=>{ui(T)&&e(V)})),ze(_),Xr(_,(e=>_e(v,e)),(()=>ui(v))),Ai(e,_),se(),r()}var xn=e=>{if(!isFinite(e))return"00:00";let t=Math.round(e),i=Math.floor(t/3600);t-=3600*i;let r=Math.floor(t/60);t-=60*r;let s=[r,t].map((e=>String(e).padStart(2,"0"))).join(":");return i>0&&(s=`${i}:${s}`),s},kn=_i('<path fill="#fff"></path>'),Tn=_i("<path></path><!>",1);function _n(e,t){let i=ms(t,"isActive",3,!1),r=fe((()=>i()?"live-active-icon":"live-icon")),s=fe((()=>i()?"var(--timeline-slider-filled-active-live-bg, #FF3347)":void 0)),a="M8 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2H9V6a1 1 0 0 0-1-1m7 1a1 1 0 1 1 2 0v8a1 1 0 1 1-2 0zm15-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2h-3v-2h3a1 1 0 1 0 0-2h-3V7h3a1 1 0 1 0 0-2zm-8.32 9.31-2.55-7.82a1 1 0 0 1-.12-.37L19 6.1a1 1 0 1 1 2-.2l2 6.4 2-6.4a1 1 0 0 1 2 .2v.02a1 1 0 0 1-.13.37l-2.55 7.82a1 1 0 0 1-.95.69h-.74a1 1 0 0 1-.95-.69";Ea(e,{width:"42",height:"20",get testId(){return ui(r)},get fill(){return ui(s)},children:(e,t)=>{var r=Tn(),s=Xe(r),n=Je(s),o=e=>{var t=kn();Pr(t,"d",a),Ai(e,t)};Ji(n,(e=>{i()&&e(o)})),nt((()=>Pr(s,"d",`M5 0h32s5 0 5 5v10s0 5 -5 5h-32s-5 0 -5 -5v-10s0 -5 5 -5${i()?"":"M5.5 2h31s3.5 0 3.5 3.5v9s0 3.5-3.5 3.5h-31s-3.5 0-3.5-3.5v-9s0-3.5 3.5-3.5"+a}z`))),Ai(e,r)},$$slots:{default:!0}})}var Cn=Ti('<div class="equalizer s-e"><div class="col s-e"></div> <div class="col s-e"></div> <div class="col s-e"></div></div>'),En=Ti('<div class="live-icon s-e"><!></div>'),An=Ti('<span class="text s-e"> </span>'),Ln=Ti("<div><!> <!></div>"),Pn={hash:"s-e",code:".wrapper.s-e{background-color:var(--black-alpha-40);border-radius:4px;padding:2px 6px;transition:visibility var(--controls-transition-duration),opacity var(--controls-transition-duration);white-space:nowrap}.wrapper.live.s-e{background:var(--red);border-radius:2px;font-size:0;height:20px;line-height:20px;padding:0 7px}.equalizer.s-e{display:inline-block;height:10px;margin-right:4px;margin-top:-4px;position:relative;vertical-align:middle;width:10px}.live.s-e .equalizer:where(.s-e){margin-top:-2px}.equalizer.s-e .col:where(.s-e){animation:1.5s linear infinite alternate;animation-play-state:paused;background:var(--btn-color,--white);bottom:0;height:10px;margin-right:2px;position:absolute;transform-origin:50% 100%;width:2px}.playing.s-e .equalizer:where(.s-e) .col:where(.s-e){animation-play-state:running}.equalizer.s-e .col:where(.s-e):first-child{animation-name:s-e-thumb-timer-equalizer-col1;left:0}.equalizer.s-e .col:where(.s-e):nth-child(2){animation-name:s-e-thumb-timer-equalizer-col2;left:3px}.equalizer.s-e .col:where(.s-e):nth-child(3){animation-name:s-e-thumb-timer-equalizer-col3;left:6px}.live-icon.s-e{display:inline-block;height:20px;margin:0 -7px;vertical-align:middle;width:42px}@keyframes s-e-thumb-timer-equalizer-col1{0%{transform:scaleY(.1)}25%{transform:scaleY(.8)}50%{transform:scaleY(.4)}75%{transform:scaleY(.6)}to{transform:scaleY(.1)}}@keyframes s-e-thumb-timer-equalizer-col2{0%{transform:scaleY(1)}25%{transform:scaleY(.3)}50%{transform:scaleY(.9)}75%{transform:scaleY(.6)}to{transform:scaleY(1)}}@keyframes s-e-thumb-timer-equalizer-col3{0%{transform:scaleY(.6)}25%{transform:scaleY(.9)}50%{transform:scaleY(.1)}75%{transform:scaleY(.9)}to{transform:scaleY(.6)}}.text.s-e{color:var(--controls-time);font-size:13px;font-weight:500;line-height:16px}"};function Mn(e,t){fr(e,Pn);let i=ms(t,"withEqualizer",3,!1),r=ms(t,"isLive",3,!1),s=ms(t,"isPlaying",3,!1);var a=Ln();let n;var o=Ye(a),l=e=>{Ai(e,Cn())};Ji(o,(e=>{i()&&e(l)}));var u=Je(o,2),d=e=>{var t=En();_n(Ye(t),{isActive:!0}),ze(t),Ai(e,t)},c=e=>{var i=An(),r=Ye(i,!0);ze(i),nt((()=>ji(r,t.time))),Ai(e,i)};Ji(u,(e=>{r()?e(d):e(c,!1)})),ze(a),nt((e=>n=wr(a,1,"wrapper s-e",null,n,e)),[()=>({live:r(),playing:s()})]),Ai(e,a)}var In=(e,t,i)=>{let r;return()=>(window.clearTimeout(r),e?r=window.setTimeout((()=>t.set(!0)),i):t.set(!1),()=>window.clearTimeout(r))},Rn=Ti('<div role="timer" data-testid="thumb-timer"><!></div>'),Vn={hash:"s-i",code:".thumb-timer.s-i{bottom:0;margin:8px;position:absolute;right:0;transition:visibility var(--controls-transition-duration),opacity var(--controls-transition-duration);z-index:var(--thumb-timer-z-index)}"};function Nn(e,t){re(t,!0),fr(e,Vn);let[i,r]=us(),s=ms(t,"isHidden",3,!1),a=ms(t,"isLive",3,!1),n=ms(t,"isPlaying",3,!1),o=ys(),l=fe((()=>xn(t.duration-t.position))),u=rs(!1);var d=Rn();let c;Mn(Ye(d),{get time(){return ui(l)},get isLive(){return a()},get isPlaying(){return n()},withEqualizer:!0}),ze(d),mr(d,(()=>In(s()&&o.features.usePerformanceFix,u,o.disableInvisibleComponentsTimeout))),nt((e=>c=wr(d,1,"thumb-timer s-i",null,c,e)),[()=>({"out-of-flow":ls(u,"$disabled",i),hidden:s()})]),Ai(e,d),se(),r()}var Bn=e=>{navigator.clipboard?navigator.clipboard.writeText(e).catch((()=>Dn(e))):Dn(e)};function Dn(e){if(document.queryCommandSupported&&document.queryCommandSupported("copy")){let t=document.createElement("textarea");t.textContent=e,t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}}}var On="focus-hidden",Fn=e=>{e.stopPropagation(),e.preventDefault()},jn=e=>{e.parentNode?.firstElementChild?.classList.remove(On)},zn=e=>"Escape"===e.code,qn=(e,t=[])=>{let i=e.code;return["Enter","Space",...t].includes(i)},Hn=e=>{(e=>{let t=e.code;return"Tab"===t&&!e.shiftKey||"ArrowDown"===t})(e)?(Fn(e),(e=>{let t=e.nextElementSibling;t||(t=e.parentNode?.firstElementChild),t?.focus()})(e.target)):(e=>{let t=e.code;return"Tab"===t||"ArrowUp"===t})(e)&&(Fn(e),(e=>{let t=e.previousElementSibling;t||(t=e.parentNode?.lastElementChild),t?.focus()})(e.target))},Un=e=>!f.clientChecker.device.isAndroid&&0===e?.detail||f.clientChecker.device.isAndroid&&""===e?.pointerType,Wn=async(e,t,i)=>{await li(),e&&!e.classList.contains("opened")&&!t&&as(i)&&(await li(),i.set(!1),e.focus())},Qn=async(e,t,i,r=!1)=>{if(await li(),e&&t&&!r){let t=e.children[0];t?.classList.toggle(On,!i),t?.focus()}},Gn=(e,t)=>{Hn(e),jn(e.target),zn(e)&&(Fn(e),t())},Kn=async(e,t)=>{qn(e,["ArrowRight"])&&(Fn(e),t())},Yn=(e,t)=>{qn(e)&&(Fn(e),t())},Xn=100,Jn=200,Zn=300,eo=400,to=500,io=600,ro=700,so=800,ao=900,no=1e3,oo=(e,t)=>{Yn(e,(()=>t()))},lo=Ti('<li class="item s-1v" role="menuitem" tabindex="0"> </li>'),uo={hash:"s-1v",code:".item.s-1v{color:hsla(0,0%,100%,.72);cursor:pointer;display:block;font-size:13px;letter-spacing:-.14px;line-height:18px;padding:8px 16px;position:relative;white-space:nowrap}.item.s-1v:hover{background:rgba(66,66,66,.5);color:var(--white)}"};function co(e,t){re(t,!0),fr(e,uo);let i=ms(t,"onClick",3,m.noop),r=ms(t,"closeContextMenu",3,m.noop),s=e=>{e?.stopPropagation(),i()(),r()()};var a=lo();a.__click=s,a.__keydown=[oo,s];var n=Ye(a,!0);ze(a),nt((()=>{Pr(a,"aria-label",t.ariaLabel??t.label),Pr(a,"data-testid",t.id),ji(n,t.label)})),Ai(e,a),se()}wi(["click","keydown"]);var ho=(e,t)=>e.weight-t.weight,po=(e=>(e.OPEN_SUB_MENU="OPEN_SUB_MENU",e.CLICK="CLICK",e.SWITCH="SWITCH",e))(po||{}),fo=(e,t)=>{Gn(e,t)},mo=e=>{e.preventDefault()},go=Ti('<ul role="menu" class="s-1c"></ul>'),vo={hash:"s-1c",code:"ul.s-1c{background:rgba(0,0,0,.72);border-radius:8px;list-style:none;margin:0;max-height:100%;max-width:100%;overflow-x:hidden;overflow-y:auto;padding:6px 0;position:absolute;transition:visibility .1s,opacity .1s;z-index:var(--context-menu-z-index)}"};function bo(e,t){re(t,!0),fr(e,vo);let[i,r]=us(),s=()=>ls(E,"$playerPhase",i),a=()=>ls(L,"$pictureInPictureApiIsActive$",i),n=()=>ls(C,"$isLooped$",i),o=ms(t,"visible",3,!1),l=ms(t,"position",19,(()=>({top:0,left:0}))),u=ms(t,"playerContainerRef",3,void 0),d=ms(t,"menuElementRef",15,void 0),c=ke(0),h=ke(0),p=Os(),{pictureInPicture$:g}=Fs(),v=ys(),b=p.ui.contextMenu.visible$,y=p.ui.debugPanelVisible,S=p.ui.additionalContextMenuItems$,w=p.ui.t,$=p.actions.internal.togglePictureInPicture,x=p.state.chromecastState$,k=p.state.isLive$,T=p.state.positionExact$,_=p.state.isInteractive,C=p.state.looped$,E=p.playerPhase,{isEnabled$:A,isActive$:L}=g,P=fe((()=>"video"===s())),M=fe((()=>!!ls(k,"$isLive$",i)&&ui(P))),I=fe((()=>["thumb","LiveWaitingStart","LiveWaitingRecover","LiveWaitingRecord"].includes(s()))),R=fe((()=>v.features.copyVideoLink&&p.callbacks?.onCopyVideoLink)),V=fe((()=>ui(R)&&!ui(I)&&!_&&!ui(M))),N=fe((()=>!!p.callbacks?.onCopyEmbedCodeClicked)),B=fe((()=>ls(A,"$isPiPEnabled$",i)&&ls(x,"$chromecastState$",i)!==f.ChromecastState.CONNECTED&&!_&&ui(P))),D=fe((()=>!_&&!ui(I)&&!ui(M))),O=fe((()=>v.features.videoRotate&&!_&&!ui(I))),F=fe((()=>v.showSupport&&!a())),j=fe((()=>v.features.saveTraceInfoToFile)),z=()=>{b.set(!1),t.returnFocus?.()};rt((()=>{(async()=>{if(d()&&u()){await li();let{top:e,left:t,bottom:i,right:r}=l(),s=t??0,a=e??0,n=d().getBoundingClientRect();(0,m.isNullable)(t)&&!(0,m.isNullable)(r)&&(s=r-n.width),(0,m.isNullable)(e)&&!(0,m.isNullable)(i)&&(a=i-n.height),s=Math.max(s,0),a=Math.max(a,0),((e,t)=>{if(!d()||!u())return;let i=d().getBoundingClientRect(),r=u().getBoundingClientRect();_e(c,e-r.left),_e(h,t-r.top),ui(c)+i.width>r.width&&_e(c,r.width-i.width),ui(h)+i.height>r.height&&_e(h,r.height-i.height),_e(c,Math.max(ui(c),0),!0),_e(h,Math.max(ui(h),0),!0)})(s,a)}})()}));let q=()=>{p.actions.internal.videoRotate()},H=()=>{(0,m.isValidURL)(t.supportLink)&&window.open(t.supportLink,"_blank"),p.actions.internal.reportProblem(),p.actions.internal.pause()},U=()=>{let e=p.actions.internal.getDebugTextData();if(v.features.saveDebugInfoToFile){let t=new Blob([...e],{type:"plain/text"}),i=window.URL.createObjectURL(t);Ns(i,"vk_player_debug_info","txt")}else Bn(p.actions.internal.getDebugTextData())},W=()=>{let e=p.actions.internal.getTraceTextData(),t=new Blob([...e],{type:"application/json"}),i=window.URL.createObjectURL(t);Ns(i,"vk_player_trace_info","json")},Q=()=>{y.set(!0)},G=async()=>{try{$()}finally{t.returnFocus?.()}},K=()=>{p.actions.internal.setLooped(!n())},Y=()=>{if(ui(N)){let e=p.callbacks?.onCopyEmbedCodeClicked?.();e&&Bn(e)}},X=(e=!1)=>{if(p.callbacks?.onCopyVideoLink){let t=p.callbacks?.onCopyVideoLink(e,ls(T,"$positionExact$",i));t&&Bn(t)}},J=fe((()=>v.features.saveDebugInfoToFile?w("menu_save_debug"):w("menu_copy_debug"))),Z=fe((()=>ui(R)?{id:"copy-link",weight:Xn,label:w("menu_copy_video_link"),onClick:()=>X()}:void 0)),ee=fe((()=>ui(V)?{id:"copy-link-timestamp",weight:Jn,label:w("menu_copy_video_link_with_timestamp"),onClick:()=>X(!0)}:void 0)),te=fe((()=>ui(N)?{id:"copy-embed-code",weight:Zn,label:w("menu_copy_embed_code"),onClick:Y}:void 0)),ie=fe((()=>ui(B)?{id:"pip",weight:eo,label:a()?w("menu_pip_close"):w("menu_pip"),onClick:G}:void 0)),ae=fe((()=>ui(D)?{id:"video-loop",weight:to,label:n()?w("menu_video_loop_off"):w("menu_video_loop_on"),ariaLabel:w("aria_label_menu_loop"),onClick:K}:void 0)),ne=fe((()=>ui(O)?{id:"rotate",weight:io,label:w("menu_video_rotate"),ariaLabel:w("aria_label_menu_rotate"),onClick:q}:void 0)),oe=fe((()=>ui(F)?{id:"report",weight:ro,label:w("menu_report"),ariaLabel:`${w("menu_report")}. ${w("aria_label_new_tab_alert")}`,onClick:H}:void 0)),le=fe((()=>({id:"save-debug",weight:so,label:ui(J),onClick:U}))),ue=fe((()=>ui(j)?{id:"save-trace",weight:ao,label:w("menu_save_debug"),onClick:W}:void 0)),de=fe((()=>({id:"debug-info",weight:no,label:w("menu_debug_overlay"),ariaLabel:w("aria_label_menu_debug_overlay"),onClick:Q}))),ce=fe((()=>[ui(Z),ui(ee),ui(te),ui(ie),ui(ae),ui(ne),ui(oe),ui(le),ui(ue),ui(de),...ls(S,"$additionalContextMenuItems$",i)].filter((e=>!!e)).sort(ho)));var he=Ei(),pe=Xe(he),me=e=>{var t=go();t.__contextmenu=[mo],t.__keydown=[fo,z],sr(t,21,(()=>ui(ce)),(e=>e.id),((e,t)=>{co(e,{get id(){return ui(t).id},get label(){return ui(t).label},get ariaLabel(){return ui(t).ariaLabel},get onClick(){return ui(t).onClick},closeContextMenu:z})})),ze(t),Xr(t,(e=>d(e)),(()=>d())),nt((()=>xr(t,`top: ${ui(h)??""}px; left: ${ui(c)??""}px;`))),Ai(e,t)};Ji(pe,(e=>{o()&&e(me)})),Ai(e,he),se(),r()}wi(["contextmenu","keydown"]);var yo=class{constructor(e){this.value=e,this.next=null}},So=class{push(e){let t=new yo(e);this.top?(this.top.next=t,this.top=t):(this.top=t,this.bottom=t),this.size++,this.size>this.maxSize&&this.bottom&&(this.bottom=this.bottom.next)}getValuesFromBottom(){let e=[],t=this.bottom;for(;t;)e.push(t.value),t=t.next;return e}constructor(e){this.top=null,this.bottom=null,this.size=0,this.maxSize=e}},wo=Ti('<div class="container s-15"><canvas class="s-15"></canvas></div>'),$o={hash:"s-15",code:".container.s-15{display:inline-block;height:16px;width:120px}canvas.s-15{margin-top:2px;transform:scaleY(-1)}"};function xo(e,t){re(t,!0),fr(e,$o);let i=ms(t,"values",19,(()=>[])),r=ke(void 0),s=ke(null);function a(e,t,i,r,s){0===s&&(s=1),e.fillStyle="#fff",e.fillRect(t,i,r,s)}Ki((()=>{ui(r).width=120,ui(r).height=16,_e(s,ui(r).getContext("2d"),!0)})),rt((()=>{let e="";if(ui(s)){let t=i()[0];for(let e=1;e<i().length;e++)i()[e]>t&&(t=i()[e]);ui(s).clearRect(0,0,120,16);let r=59;for(let n=i().length-1;n>=0;n--){let o=2*r,l=t>0?i()[n]/t*16:0;a(ui(s),o,0,2,l),e=l+" "+e,r--}}}));var n=wo();Xr(Ye(n),(e=>_e(r,e)),(()=>ui(r))),ze(n),Ai(e,n),se()}var ko=(e,t)=>{e.stopPropagation(),m.safeStorage.remove(Ss),t.set(!1)},To=Ti('<div class="s-l"><div class="s-l">Video id</div> <span> </span></div>'),_o=Ti('<div class="s-l"><div class="s-l">VSID</div> <span> </span></div>'),Co=Ti('<div class="s-l"><div class="s-l">Provider</div> <span> </span></div>'),Eo=Ti('<div class="s-l"><div class="s-l">Streams</div> <span> </span></div>'),Ao=Ti('<div class="s-l"><div class="s-l">Viewport</div> <span> </span></div>'),Lo=Ti('<div class="s-l"><div class="s-l">Video size</div> <span> </span></div>'),Po=Ti('<div class="s-l"><div class="s-l">CDN host</div> <span> </span></div>'),Mo=Ti('<div class="s-l"><div class="s-l">Volume</div> <span> </span></div>'),Io=Ti('<div class="s-l"><div class="s-l">Position</div> <span> </span></div>'),Ro=Ti('<div class="s-l"><div class="s-l">Buffer</div> <span> </span></div>'),Vo=Ti('<div class="s-l"><div class="s-l">Nbuffer</div> <span> </span></div>'),No=Ti('<div class="s-l"><div class="s-l">Live latency</div> <span> </span></div>'),Bo=Ti('<div class="s-l"><div class="s-l">Segment</div> <span> </span></div>'),Do=Ti('<div class="s-l"><div class="s-l">Network</div> <!> <span> </span></div>'),Oo=Ti('<div class="s-l"><div class="s-l">V bitrate</div> <!> <span> </span></div>'),Fo=Ti('<div role="region"><button class="close s-l" title="закрыть">[x]</button> <div class="content s-l"><div class="s-l"><div class="s-l">Version</div> <span> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="s-l"><div class="s-l">Dropped</div> <span> </span></div> <!> <!> <div class="s-l"><div class="s-l">FPS</div> <!> <span> </span></div></div></div>'),jo={hash:"s-l",code:".container.s-l{background:rgba(28,28,28,.8);border-radius:4px;color:#fff;font-size:10px;left:20px;min-width:160px;position:absolute;text-align:left;top:45px;user-select:text;z-index:var(--debug-panel-z-index)}.container-mobile.s-l{left:16px;top:16px}button.close.s-l{background-color:transparent;border:none;color:#fff;cursor:pointer;outline:0;padding:0;position:absolute;right:5px;top:3px}.content.s-l{padding:5px}.content.s-l>div:where(.s-l)>div:where(.s-l){display:inline-block;padding:0 5px;text-align:right;width:60px}"};function zo(e,t){re(t,!0),fr(e,jo);let[i,r]=us(),s=Os(),a=s.ui.debugPanelVisible,n=s.ui.isMobile,o=ke(le(s.actions.internal.getDebugPanelData())),l=s.actions.internal.getVideoElement(),u=ke(0),d=ke(0),c=ke(0),h=new So(60),p=new So(60),f=new So(60),g=ke(le([])),v=ke(le([])),b=ke(le([])),y=Da("aria_label_debug_panel");Ki((()=>{m.safeStorage.set(Ss,"true"),s.actions.internal.startLogging(),l&&(_e(d,l.getVideoPlaybackQuality().droppedVideoFrames,!0),_e(u,l.getVideoPlaybackQuality().totalVideoFrames,!0));let e,t=window.setInterval((()=>{_e(o,s.actions.internal.getDebugPanelData(),!0)}),500);return l&&(e=window.setInterval((()=>{if(l){_e(d,l.getVideoPlaybackQuality().droppedVideoFrames,!0);let e=l.getVideoPlaybackQuality().totalVideoFrames;_e(c,e-ui(u)),_e(u,e,!0),h.push(ui(c)),ui(o).speed&&p.push(ui(o).speed),ui(o).bitrate&&f.push(ui(o).bitrate),_e(g,h.getValuesFromBottom(),!0),_e(v,p.getValuesFromBottom(),!0),_e(b,f.getValuesFromBottom(),!0)}}),1e3)),()=>{s.actions.internal.stopLogging(),clearInterval(t),e&&clearInterval(e)}}));var S=Fo();let w;var $=Ye(S);$.__click=[ko,a];var x=Je($,2),k=Ye(x),T=Je(Ye(k),2),_=Ye(T,!0);ze(T),ze(k);var C=Je(k,2),E=e=>{var t=To(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((()=>ji(r,ui(o).id))),Ai(e,t)};Ji(C,(e=>{ui(o).id&&e(E)}));var A=Je(C,2),L=e=>{var t=_o(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((()=>ji(r,ui(o).vsid))),Ai(e,t)};Ji(A,(e=>{ui(o).vsid&&e(L)}));var P=Je(A,2),M=e=>{var t=Co(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((()=>ji(r,ui(o).provider))),Ai(e,t)};Ji(P,(e=>{ui(o).provider&&e(M)}));var I=Je(P,2),R=e=>{var t=Eo(),i=Je(Ye(t),2),r=Ye(i);ze(i),ze(t),nt((()=>ji(r,`Video: ${(ui(o).videoCodec||"")??""} ${ui(o).hdr?"(HDR)":""}\n          &\n          Audio: ${(ui(o).audioCodec||"")??""} ${ui(o).audioLanguage?`(${ui(o).audioLanguage})`:""}`))),Ai(e,t)};Ji(I,(e=>{(ui(o).videoCodec||ui(o).audioCodec)&&e(R)}));var V=Je(I,2),N=e=>{var t=Ao(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((()=>ji(r,ui(o).viewport))),Ai(e,t)};Ji(V,(e=>{ui(o).viewport&&e(N)}));var B=Je(V,2),D=e=>{var t=Lo(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((()=>ji(r,ui(o).videoSize))),Ai(e,t)};Ji(B,(e=>{ui(o).videoSize&&e(D)}));var O=Je(B,2),F=e=>{var t=Po(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((()=>ji(r,ui(o).cdn))),Ai(e,t)};Ji(O,(e=>{ui(o).cdn&&e(F)}));var j=Je(O,2),z=e=>{var t=Mo(),i=Je(Ye(t),2),r=Ye(i);ze(i),ze(t),nt((()=>ji(r,`${ui(o).volume??""} %`))),Ai(e,t)};Ji(j,(e=>{ui(o).volume&&e(z)}));var q=Je(j,2),H=e=>{var t=Io(),i=Je(Ye(t),2),r=Ye(i);ze(i),ze(t),nt((e=>ji(r,`${e??""} s`)),[()=>ui(o).position.toFixed(2)]),Ai(e,t)};Ji(q,(e=>{ui(o).position&&e(H)}));var U=Je(q,2),W=e=>{var t=Ro(),i=Je(Ye(t),2),r=Ye(i);ze(i),ze(t),nt((e=>ji(r,`${e??""} s`)),[()=>ui(o).buffer.toFixed(2)]),Ai(e,t)};Ji(U,(e=>{ui(o).buffer&&e(W)}));var Q=Je(U,2),G=e=>{var t=Vo(),i=Je(Ye(t),2),r=Ye(i);ze(i),ze(t),nt((e=>ji(r,`${e??""} s`)),[()=>ui(o).nativeBuffer.toFixed(2)]),Ai(e,t)};Ji(Q,(e=>{ui(o).nativeBuffer&&e(G)}));var K=Je(Q,2),Y=e=>{var t=No(),i=Je(Ye(t),2),r=Ye(i);ze(i),ze(t),nt((e=>ji(r,`${e??""} s`)),[()=>ui(o).liveLatency.toFixed(2)]),Ai(e,t)};Ji(K,(e=>{ui(o).liveLatency&&e(Y)}));var X=Je(K,2),J=e=>{var t=Bo(),i=Je(Ye(t),2),r=Ye(i,!0);ze(i),ze(t),nt((e=>ji(r,e)),[()=>[{value:ui(o).currentVideoSegmentLength,title:"Video:"},{value:ui(o).currentAudioSegmentLength,title:"Audio:"}].filter((({value:e})=>e)).map((({value:e,title:t})=>`${t} ${((e??0)/1e3).toFixed(2)} s`)).join(" & ")]),Ai(e,t)};Ji(X,(e=>{(ui(o).currentVideoSegmentLength||ui(o).currentAudioSegmentLength)&&e(J)}));var Z=Je(X,2),ee=Je(Ye(Z),2),te=Ye(ee);ze(ee),ze(Z);var ie=Je(Z,2),ae=e=>{var t=Do(),i=Je(Ye(t),2);xo(i,{get values(){return ui(v)}});var r=Je(i,2),s=Ye(r);ze(r),ze(t),nt((e=>ji(s,`${e??""} Kbps`)),[()=>ui(o).speed.toFixed(2)]),Ai(e,t)};Ji(ie,(e=>{ui(o).speed&&e(ae)}));var ne=Je(ie,2),oe=e=>{var t=Oo(),i=Je(Ye(t),2);xo(i,{get values(){return ui(b)}});var r=Je(i,2),s=Ye(r);ze(r),ze(t),nt((e=>ji(s,`${e??""} Kbps`)),[()=>ui(o).bitrate.toFixed(2)]),Ai(e,t)};Ji(ne,(e=>{ui(o).bitrate&&e(oe)}));var ue=Je(ne,2),de=Je(Ye(ue),2);xo(de,{get values(){return ui(g)}});var ce=Je(de,2),he=Ye(ce,!0);ze(ce),ze(ue),ze(x),ze(S),nt((e=>{w=wr(S,1,"container s-l",null,w,e),Pr(S,"aria-label",y),ji(_,ui(o).version),ji(te,`${ui(d)??""} / ${ui(u)??""} frames`),ji(he,ui(c))}),[()=>({"container-mobile":ls(n,"$isMobile",i)})]),Ai(e,S),se(),r()}wi(["click"]);var qo=(e,t)=>{e.stopPropagation(),t()()},Ho=Ti('<div class="close s-10"></div>'),Uo={hash:"s-10",code:'.close.s-10{cursor:pointer;height:16px;opacity:.8;position:relative;transition:opacity .2s;width:16px}.close.s-10:hover{opacity:1}.close.s-10:after,.close.s-10:before{background-color:var(--white);content:" ";height:16px;left:8px;position:absolute;width:2px}.close.s-10:before{transform:rotate(45deg)}.close.s-10:after{transform:rotate(-45deg)}'};function Wo(e,t){re(t,!0),fr(e,Uo);let i=ms(t,"onClick",3,m.noop);var r=Ho();r.__click=[qo,i],Ai(e,r),se()}wi(["click"]);var Qo=e=>`width:${e}px;height:${e}px;`,Go=_i('<path d="m14.4 8.76 24.02 13.85a1.6 1.6 0 0 1 0 2.78L14.4 39.24a1.6 1.6 0 0 1-2.4-1.39v-27.7a1.6 1.6 0 0 1 2.4-1.39"></path>');function Ko(e,t){re(t,!0);let i=fe((()=>Qo(t.size)));Ea(e,{get width(){return"48"},get height(){return"48"},get fill(){return t.fill},get style(){return ui(i)},testId:"play-icon",get shadow(){return t.shadow},children:(e,t)=>{Ai(e,Go())},$$slots:{default:!0}}),se()}var Yo=Ti('<div class="timer s-13"><canvas class="timer-canvas s-13" width="100" height="100"></canvas> <!></div>'),Xo={hash:"s-13",code:".timer.s-13{align-items:center;background:rgba(31,31,31,.65);border-radius:50%;display:flex;height:50px;justify-content:space-around;transition:background .2s;width:50px}.timer.s-13:hover{background:rgba(31,31,31,.85)}.timer-canvas.s-13{height:50px;position:absolute;width:50px}"};function Jo(e,t){re(t,!0),fr(e,Xo);let i,r,s,a=ms(t,"isRunning",3,!0),n=ms(t,"onTimerEnded",3,m.noop),o=ke(void 0),l=0;rt((()=>{a()&&di((()=>{r=Date.now(),l=requestAnimationFrame(d)}))}));let u=()=>{l&&(cancelAnimationFrame(l),l=0)},d=()=>{u(),a()&&(s=(Date.now()-r)/5e3,s<1?(i?.clearRect(0,0,100,100),i?.beginPath(),i?.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*s),i?.stroke(),l=requestAnimationFrame(d)):n()())};Ki((()=>{i=ui(o).getContext("2d"),i&&(i.lineWidth=6,i.lineCap="round",i.strokeStyle="#fff")})),Yi((()=>{u()}));var c=Yo(),h=Ye(c);Xr(h,(e=>_e(o,e)),(()=>ui(o))),Ko(Je(h,2),{get size(){return"24"}}),ze(c),Ai(e,c),se()}var Zo=(e,t,i)=>{t(!1),i()},el=Ti('<div class="overlay s-1g"></div> <div class="next-video s-1g"><div class="top s-1g"><div class="caption s-1g"> </div> <!></div> <div class="row s-1g"><div class="column s-1g"><div class="thumb s-1g"><div></div> <!></div></div> <div class="column s-1g"><div class="title s-1g"> </div></div></div></div>',1),tl={hash:"s-1g",code:".overlay.s-1g{background:rgba(0,0,0,.72);height:100%;position:absolute;width:100%}.next-video.s-1g{display:flex;flex-direction:column;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:362px}.top.s-1g{display:flex;justify-content:space-between}.caption.s-1g{color:var(--white);font-size:11px;font-weight:700;opacity:.8;text-transform:uppercase}.row.s-1g{background:rgba(48,48,48,.8);cursor:pointer;display:flex;flex-direction:row;height:102px;margin-top:6px;width:100%}.column.s-1g{display:flex;flex-basis:50%;flex-direction:column}.thumb.s-1g{align-items:center;background:no-repeat 50%;background-size:cover;display:flex;justify-content:space-around;position:relative}.thumb.s-1g,.thumb-overlay.s-1g{height:100%;width:100%}.thumb-overlay.s-1g{position:absolute}.thumb-overlay.withOpacity.s-1g{background:var(--black);opacity:.3}.title.s-1g{color:var(--white);font-size:12px;font-weight:700;line-height:1.6;max-height:52px;overflow:hidden;padding:10px 16px}"};function il(e,t){re(t,!0),fr(e,tl);let[i,r]=us(),s=()=>ls(n,"$autoplayNextEnabled$",i),a=Os(),n=a.ui.autoplayNextEnabled$,o=a.ui.timerNextVideoRunning$,l=a.actions.internal.nextVideoClick,u=a.actions.internal.nextVideoAnnouncementShow,d=a.actions.internal.nextVideoAnnouncementClick,c=a.actions.internal.nextVideoAnnouncementAuto,h=a.actions.internal.nextVideoAnnouncementCancel,p=()=>{s()&&(l(!1),c())},f=()=>{t.clickCloseIcon(),h()};Ki((()=>{t.isHide||u(),t.isHide&&s()&&(l(!1),c())}));var m=Ei(),g=Xe(m),v=e=>{var r=el(),a=Je(Xe(r),2),n=Ye(a),u=Ye(n),c=Ye(u,!0);ze(u),Wo(Je(u,2),{onClick:f}),ze(n);var h=Je(n,2);h.__click=[Zo,l,d];var m=Ye(h),g=Ye(m),v=Ye(g);let b;var y=Je(v,2),S=e=>{let t=fe((()=>ls(o,"$timerNextVideoRunning$",i)&&s()));Jo(e,{get isRunning(){return ui(t)},onTimerEnded:p})};Ji(y,(e=>{s()&&e(S)})),ze(g),ze(m);var w=Je(m,2),$=Ye(w),x=Ye($,!0);ze($),ze(w),ze(h),ze(a),nt(((e,i)=>{ji(c,e),xr(g,`background-image: url('${t.thumb}')`),b=wr(v,1,"thumb-overlay s-1g",null,b,i),ji(x,t.title)}),[()=>Da("end_screen_next_video"),()=>({withOpacity:s()})]),Ai(e,r)};Ji(g,(e=>{t.isHide||e(v)})),Ai(e,m),se(),r()}wi(["click"]);var rl=(e,t)=>Math.min(+(e+t).toFixed(2),1),sl=(e,t)=>Math.max(+(e-t).toFixed(2),0),al=(e,t,i)=>{let r=rl(t,i);t<1&&e.actions.internal.setVolume(r)},nl=(e,t,i)=>{let r=sl(t,i);t>0&&e.actions.internal.setVolume(r)},ol=({isAudioDisabled:e,isAudioAvailable:t,isAds:i,audioDisabledHintCallback:r,audioIsNotExistHintCallback:s})=>e?!!i||(r?.(),!1):!!t||(s?.(),!1);function ll(){return document.activeElement?.shadowRoot?.activeElement??null}var ul=(e,t)=>{t(e)},dl=Ti('<div class="keyboard-controls s-1f" tabindex="-1" role="region"><!></div>'),cl={hash:"s-1f",code:".keyboard-controls.s-1f{bottom:0;left:0;position:absolute;right:0;top:0}"};function hl(e,t){re(t,!0),fr(e,cl);let[i,r]=us(),s=()=>ls(E,"$disabledControls$",i),a=()=>ls($,"$playbackState$",i),n=()=>ls(R,"$doubleForwardOn$",i),o=()=>ls(k,"$adPlaybackState",i),l=()=>ls(T,"$positionExact$",i),u=()=>ls(_,"$duration$",i),d=()=>ls(z,"$isAudioAvailable$",i),c=()=>ls(C,"$volume$",i),h=()=>ls(x,"$canChangePlaybackSpeed$",i),p=()=>ls(L,"$currentSubtitle$",i),v=ms(t,"nextButtonActive",3,!1),b=ms(t,"prevButtonActive",3,!1),y=Os(),S=ys(),w=y.getLogger().createComponentLog("KeyboardControls component"),$=y.state.playbackState$,x=y.state.canChangePlaybackSpeed$,k=y.ads.playbackState,T=y.state.positionExact$,_=y.state.duration$,C=y.state.volume$,E=y.ui.controls.disabledControls$,A=y.state.muted$,L=y.state.currentSubtitle$,P=y.ui.contextMenu.openedByHotKey$,M=y.ui.contextMenu.lastActiveElem$,I=y.ui.contextMenu.visible$,R=y.ui.doubleForwardOn$,N=y.ui.doubleForwardAvailable$,B=y.ui.contextMenu.position$,D=y.state.isEnded$,O=y.ui.overlayContainer$,F=y.callbacks?.onAudioDoesNotExistHint,j=y.callbacks?.onAudioDisabledHint,z=y.state.isAudioAvailable$,q=y.state.isAudioDisabled,H=y.state.isInteractiveTime$,{showInteractiveTimeIndicatorTooltip$:U}=Fs(),W=0,Q=!0,G=ke(void 0),K=e=>(e!==Q&&(Q=e,W=0),W+=1,(S.controls.seekStepKeyboard+S.controls.seekStepKeyboard*W)/1e3),Y=!0,X=({type:e,repeat:r,disableDoubleForward:o})=>{let l=()=>{if(!s().has("PLAY_BUTTON"))if(ls(H,"$isInteractiveTime$",i)&&ls(U,"$showInteractiveTimeIndicatorTooltip$",i)&&U.set(!1),t.fakePlayButtonHandler)t.fakePlayButtonHandler();else{y.actions.internal.togglePlay();let e="PLAY";a()===f.PlaybackState.PAUSED?e="PAUSE":ls(D,"$isEnded$",i)&&(e="REPLAY"),t.showHotKeyHelpers({type:e})}},u="down"===e;if(!ls(N,"$doubleForwardAvailable$",i)||o)return u&&l(),void(Y=!0);if(u)Y=!1;else if(Y)return;u?!r&&t.startDoubleForwardActivationTimer():(n()||l(),t.stopDoubleForward(),Y=!0)},J=e=>{let t=(e=>{if(!e)return{top:0,left:0};let t=e.getBoundingClientRect(),i=t.left+8;return{bottom:t.bottom+-58,left:i}})(ls(O,"$overlayContainer$",i));B.set(t),M.set(e.target),P.set(!0),I.set(!0)},Z=(e,r=!1)=>{let $=e.target,x=$?.getAttribute("role")?.includes("menuitem"),k=$.classList.contains("btn"),T=e.code;if(k&&"Space"===T)return!1;let _=_s.has(T);if(x&&_)return!1;let C=!Ts.has(T);if(e.ctrlKey&&C||e.altKey&&C||e.metaKey)return!1;let E=x&&"Escape"===T;Cs.has(T)||E||t.hideContextMenu();let L=a()===f.PlaybackState.PLAYING||a()===f.PlaybackState.PAUSED,P=t.isAds&&("paused"===o()||"playing"===o()),M=!P&&!s().has("TIMELINE"),I=e.shiftKey&&["Digit1","Numpad1"].includes(T);if(!I&&!L&&!P)return!1;w({message:`key down, code: ${T}, isExternal = ${r}`});let R=!1,V=()=>{R=!0,r||e.preventDefault()};if(I)return J(e),V(),!0;switch(T){case"KeyJ":case"ArrowLeft":if(!M)break;if(e.ctrlKey||e.altKey){let e=y.actions.internal.getPrevEpisode();y.actions.internal.seekToPrevEpisode(e),e&&t.showHotKeyHelpers({type:"EPISODE_PREV",text:e.text}),V()}else{let i=e.shiftKey?K(!1):S.controls.seekStepKeyboard/1e3,r=Math.max(l()-i,0);l()>0&&(y.actions.internal.seekTime(r,g.SeekAction.DOUBLE_TAP),t.showHotKeyHelpers({type:"BACKWARD_SEEK",text:i.toString()}),V())}break;case"KeyL":case"ArrowRight":if(!M)break;if(e.ctrlKey||e.altKey){let e=y.actions.internal.getNextEpisode();y.actions.internal.seekToNextEpisode(e),e&&t.showHotKeyHelpers({type:"EPISODE_NEXT",text:e.text}),V()}else{let i=e.shiftKey?K(!0):S.controls.seekStepKeyboard/1e3,r=Math.min(l()+i,u());Math.round(l())<Math.round(u())&&(y.actions.internal.seekTime(r,g.SeekAction.DOUBLE_TAP),t.showHotKeyHelpers({type:"FORWARD_SEEK",text:i.toString()}),V())}break;case"ArrowUp":if(ol({isAudioDisabled:q,audioDisabledHintCallback:j,isAudioAvailable:d(),audioIsNotExistHintCallback:F,isAds:t.isAds})){let e=c(),i=S.controls.volumeStepKeyboard,r=e<=1;if(al(y,e,i),r){let r=Math.round(100*rl(e,i)).toString();t.showHotKeyHelpers({type:"VOLUME",t:{key:"hotkey_helper_current_volume",value:r}})}}V();break;case"ArrowDown":if(ol({isAudioDisabled:q,audioDisabledHintCallback:j,isAudioAvailable:d(),audioIsNotExistHintCallback:F,isAds:t.isAds})){let e=c(),i=S.controls.volumeStepKeyboard,r=e>=0;if(nl(y,e,i),r){let r=Math.round(100*sl(e,i)).toString();t.showHotKeyHelpers({type:"VOLUME",t:{key:"hotkey_helper_current_volume",value:r}})}}V();break;case"Comma":if(e.shiftKey){if(!n()&&h()){let e=y.actions.internal.decrementPlaybackRate();t.showHotKeyHelpers({type:"RATE_DOWN",text:e?.displayValue}),V()}}else{if(P||a()!==f.PlaybackState.PAUSED)break;let e=Math.max(l()-S.controls.seekStepFrame/1e3,0);l()>0&&(t.showHotKeyHelpers({type:"BACKWARD_SEEK"}),y.actions.internal.clearDelayedBufferingCheckTimeout(),y.actions.internal.seekTime(e,g.SeekAction.DOUBLE_TAP),V())}break;case"Period":if(e.shiftKey){if(!n()&&h()){let e=y.actions.internal.incrementPlaybackRate();t.showHotKeyHelpers({type:"RATE_UP",text:e?.displayValue}),V()}}else{if(P||a()!==f.PlaybackState.PAUSED)break;let e=Math.min(l()+S.controls.seekStepFrame/1e3,u());l()<u()&&(t.showHotKeyHelpers({type:"FORWARD_SEEK"}),y.actions.internal.clearDelayedBufferingCheckTimeout(),y.actions.internal.seekTime(e,g.SeekAction.DOUBLE_TAP),V())}break;case"KeyK":case"Space":X({type:"down",repeat:e.repeat,disableDoubleForward:"KeyK"===T}),V();break;case"KeyM":ol({isAudioDisabled:q,audioDisabledHintCallback:j,isAudioAvailable:d(),audioIsNotExistHintCallback:F,isAds:t.isAds})&&(t.showHotKeyHelpers({type:ls(A,"$muted$",i)?"VOLUME":"MUTE"}),y.actions.internal.toggleMuted()),V();break;case"KeyF":t.toggleFullscreen(),V();break;case"KeyC":y.actions.internal.toggleSubtitle(),"off"!==p().value?t.showHotKeyHelpers({type:"SUBTITLES_ON",text:p()?.displayValue}):t.showHotKeyHelpers({type:"SUBTITLES_OFF"}),V();break;case"KeyI":y.actions.internal.togglePictureInPicture(),V();break;case"Digit1":case"Numpad1":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.1,g.SeekAction.DOUBLE_TAP),V();break;case"Digit2":case"Numpad2":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.2,g.SeekAction.DOUBLE_TAP),V();break;case"Digit3":case"Numpad3":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.3,g.SeekAction.DOUBLE_TAP),V();break;case"Digit4":case"Numpad4":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.4,g.SeekAction.DOUBLE_TAP),V();break;case"Digit5":case"Numpad5":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.5,g.SeekAction.DOUBLE_TAP),V();break;case"Digit6":case"Numpad6":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.6,g.SeekAction.DOUBLE_TAP),V();break;case"Digit7":case"Numpad7":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.7,g.SeekAction.DOUBLE_TAP),V();break;case"Digit8":case"Numpad8":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.8,g.SeekAction.DOUBLE_TAP),V();break;case"Digit9":case"Numpad9":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.9,g.SeekAction.DOUBLE_TAP),V();break;case"Digit0":case"Numpad0":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(0,g.SeekAction.DOUBLE_TAP),V();break;case"Slash":e.shiftKey&&S.features.hotKeyMapModal&&(t.showKeyMap(),V());break;case"KeyN":e.shiftKey&&v()&&(y.actions.internal.nextVideoClick(),V());break;case"KeyP":e.shiftKey&&b()&&(y.actions.internal.prevVideoClick(),V());break;case"ShiftLeft":case"ShiftRight":V();break;case"Tab":case"Escape":case"Enter":break;default:(0,m.checkNever)(T)}return R},ee=e=>{let i=e.code;if(e.ctrlKey||e.altKey||e.metaKey)return;let r=a()===f.PlaybackState.PLAYING||a()===f.PlaybackState.PAUSED,s=t.isAds&&("paused"===o()||"playing"===o());if(r||s)switch(i){case"ShiftLeft":case"ShiftRight":W=0;break;case"Space":X({type:"up"})}},te=Da("aria_label_video_player");var ie=dl();ie.__keyup=ee,ie.__keydown=[ul,Z],Gi(Ye(ie),(()=>t.children??V)),ze(ie),Xr(ie,(e=>_e(G,e)),(()=>ui(G))),nt((()=>Pr(ie,"aria-label",te))),Ai(e,ie);var ae=se({focus:()=>ui(G)?.focus(),isFocused:()=>ui(G)===ll(),handleExternalKeyboardEvent:e=>"keydown"===e.type?Z(e,!0):("keyup"===e.type&&ee(e),!1)});return r(),ae}wi(["keyup","keydown"]);var pl=Ti('<div class="container s-m"><div class="dot s-m"></div> <div class="dot s-m"></div> <div class="dot s-m"></div></div>'),fl={hash:"s-m",code:".container.s-m{display:flex;left:50%;pointer-events:none;position:absolute;top:50%;transform:translate(-50%,-50%)}.dot.s-m:first-child{animation-delay:0s}.dot.s-m:nth-child(2){animation-delay:.18s}.dot.s-m:nth-child(3){animation-delay:.36s}@keyframes s-m-dot_animation{0%{opacity:.2}30%{opacity:1}to{opacity:.2}}.dot.s-m{animation-duration:.75s;animation-iteration-count:infinite;animation-name:s-m-dot_animation;background:var(--btn-color);border-radius:4px;height:8px;width:8px}.dot.s-m+.dot:where(.s-m){margin-left:4px}"};function ml(e,t){fr(e,fl);let i=ms(t,"style",3,"");var r=pl();nt((()=>xr(r,i()))),Ai(e,r)}var gl=_i('<path d="M5.26 5.26a.9.9 0 0 1 1.28 0L12 10.73l5.46-5.47a.9.9 0 0 1 1.28 1.28L13.27 12l5.47 5.46a.9.9 0 1 1-1.28 1.28L12 13.27l-5.46 5.47a.9.9 0 1 1-1.28-1.28L10.73 12 5.26 6.54a.9.9 0 0 1 0-1.28Z"></path>');var vl=e=>{e.stopPropagation()},bl=Ti("<button><!></button>"),yl={hash:"s-1x",code:"button.btn.s-1x{align-items:center;display:flex;flex-direction:row;height:var(--controls-height);justify-content:center;margin:0;padding:8px;will-change:opacity}button.w-max.s-1x{width:100%}button.btn--live.s-1x{padding:10px 4px}button.btn-jc-l.s-1x{justify-content:left}button.btn-m.s-1x{background-color:rgba(0,0,0,.56);border-radius:12px;height:44px;left:12px;position:absolute;top:50%;transform:translateY(-50%);transition:opacity var(--controls-transition-duration);width:44px}button.btn-m.s-1x,button.btn-m--play.s-1x{align-items:center;display:flex;justify-content:center}button.btn-m--play.s-1x{height:var(--big-play-size);padding:16px;position:relative;width:var(--big-play-size)}button.btn-m--next.s-1x,button.btn-m--prev.s-1x{height:50px;position:absolute;width:50px}button.btn-m--prev.s-1x{right:calc(100% + 35px)}button.btn-m--next.s-1x{left:calc(100% + 35px)}button.btn.s-1x:disabled{cursor:default;pointer-events:none}button.btn.s-1x:not(.btn-full-opacity):disabled{opacity:.4}button.btn.s-1x:not(:disabled):hover{opacity:.8}button.pr-0.s-1x{padding-right:0}button.pl-0.s-1x{padding-left:0}"};function Sl(e,t){re(t,!0),fr(e,yl);let i=ms(t,"className",3,""),r=ms(t,"style",3,""),s=ms(t,"disabled",3,void 0),a=ms(t,"testId",3,void 0),n=ms(t,"ariaHidden",3,void 0),o=ms(t,"ariaLabel",3,void 0),l=ms(t,"ref",15,void 0),u=ms(t,"ariaKeyShortCut",3,void 0),d=ms(t,"ariaExpanded",3,void 0),c=ms(t,"tabIndex",3,0),h=ms(t,"click",3,m.noop),p=ms(t,"focus",3,m.noop),f=ms(t,"blur",3,m.noop),g=fe((()=>h()===m.noop?null:e=>{e.stopPropagation(),h()(e)})),v=fe((()=>p()===m.noop?null:e=>{e.preventDefault(),p()()})),b=fe((()=>f()===m.noop?null:e=>{e.preventDefault(),f()()}));var y=bl();y.__pointerdown=[vl],y.__click=function(...e){ui(g)?.apply(this,e)},Gi(Ye(y),(()=>t.children??V)),ze(y),Xr(y,(e=>l(e)),(()=>l())),nt((()=>{wr(y,1,`btn ${i()??""}`,"s-1x"),xr(y,r()||null),y.disabled=s()??null,Pr(y,"aria-hidden",n()??null),Pr(y,"aria-label",o()??null),Pr(y,"aria-keyshortcuts",u()??null),Pr(y,"aria-expanded",d()??null),Pr(y,"data-testid",a()??null),Pr(y,"tabindex",c()),Pr(y,"role",t.role),Pr(y,"aria-checked",t.areaChecked??null)})),Si("focus",y,(function(...e){ui(v)?.apply(this,e)})),Si("blur",y,(function(...e){ui(b)?.apply(this,e)})),Ai(e,y),se()}wi(["pointerdown","click"]);var wl=(e,t)=>{"Escape"===e.key&&t.onClose(),("ArrowUp"===e.key||"ArrowDown"===e.key)&&e.stopPropagation()},$l=Ti('<div class="modal-header s-1p"><h3 class="modal-title s-1p"> </h3> <!></div>'),xl=Ti('<div class="modal-overlay s-1p"><div class="modal-container s-1p" role="dialog" aria-modal="true"><!> <div class="modal-scroll s-1p" tabindex="0" role="scrollbar"><div class="modal-main s-1p"><!></div></div></div></div>'),kl={hash:"s-1p",code:'.modal-overlay.s-1p{align-items:center;background:transparent;bottom:0;display:flex;justify-content:center;left:0;position:absolute;right:0;top:0;z-index:var(--modal-z-index)}.modal-container.s-1p{background:var(--mobile-settings-bg);border-radius:8px;color:var(--white);display:flex;flex-direction:column;height:calc(100% - 24px);max-height:490px;max-width:600px;width:calc(100% - 32px)}.modal-header.s-1p{align-items:start;border-bottom:1px solid var(--white-alpha-24);box-sizing:border-box;display:flex;height:40px;justify-content:space-between;padding:8px 10px}.modal-title.s-1p{color:var(--white);font-feature-settings:"clig" off,"liga" off;font-size:13px;font-style:normal;font-weight:600;line-height:16px;margin:3px 0 0 6px}.modal-scroll.s-1p{height:100%;margin:8px 4px 8px 0;overflow-x:hidden;overflow-y:auto}.modal-scroll.s-1p::-webkit-scrollbar{width:8px}.modal-scroll.s-1p::-webkit-scrollbar-track{background-color:transparent;border-radius:4px;box-shadow:none;margin-right:2px}.modal-scroll.s-1p::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:#666;border:1px solid transparent;border-radius:5px;min-height:40px}.modal-scroll.s-1p::-webkit-scrollbar-thumb:hover{background-color:#777}.modal-main.s-1p{margin:-8px -4px 0 0}'};function Tl(e,t){re(t,!0),fr(e,kl);let i=ms(t,"showHeader",3,!0),r=ms(t,"showCloseCross",3,!0),s=ke(void 0),a=ke(void 0),{webApi:{focusManager:n}}=Os(),o=Da("hotkey_map_modal_close_btn_text");Ki((()=>(ui(s)?.focus(),ui(a)&&n&&(n.setContainerForFocusLock(ui(a)),n.activateLock()),()=>n?.deactivateLock())));var l=xl();l.__keydown=[wl,t];var u=Ye(l),d=Ye(u),c=e=>{var i=$l(),s=Ye(i),a=Ye(s,!0);ze(s);var n=Je(s,2),l=e=>{Sl(e,{get click(){return t.onClose},testId:"close-modal",style:"padding: 0; height: 24px; width: 24px",get ariaLabel(){return o},children:(e,t)=>{!function(e,t){Ea(e,{get fill(){return t.fill},children:(e,t)=>{Ai(e,gl())},$$slots:{default:!0}})}(e,{fill:"currentColor"})},$$slots:{default:!0}})};Ji(n,(e=>{r()&&e(l)})),ze(i),nt((()=>ji(a,t.title))),Ai(e,i)};Ji(d,(e=>{i()&&e(c)}));var h=Je(d,2),p=Ye(h);Gi(Ye(p),(()=>t.children??V)),ze(p),ze(h),Xr(h,(e=>_e(s,e)),(()=>ui(s))),ze(u),Xr(u,(e=>_e(a,e)),(()=>ui(a))),ze(l),Ai(e,l),se()}wi(["keydown"]);var _l=new Set(["BR"]),Cl=Ti('<li class="hot-key-map-item s-1d"><span class="hot-key-map-item-description s-1d"><!></span> &nbsp; <span class="hot-key-map-item-value s-1d"> </span></li>'),El=Ti('<div class="hot-key-map-group s-1d"><h5 class="hot-key-map-group-title s-1d"> </h5> <ul class="hot-key-map-group-items s-1d"></ul></div>'),Al=Ti('<div class="hot-key-map s-1d"></div>'),Ll={hash:"s-1d",code:'.hot-key-map.s-1d{box-sizing:border-box;color:var(--black);overflow-x:hidden}.hot-key-map-group.s-1d{border-bottom:1px solid var(--white-alpha-24);margin:0 20px 0 16px}.hot-key-map-group.s-1d:last-child{border-bottom:none}.hot-key-map-group-title.s-1d{color:var(--white);font-feature-settings:"clig" off,"liga" off;font-size:13px;font-style:normal;font-weight:600;line-height:16px}.hot-key-map-group-title.s-1d,.hot-key-map-item.s-1d{margin:0;padding:12px 0;width:100%}.hot-key-map-group-items.s-1d{box-sizing:border-box;list-style:none;margin:0;padding:0}.hot-key-map-item.s-1d{align-items:center;box-sizing:border-box;display:flex;justify-content:space-between;--videoplayer-hotkey-item-value-width:156px;--videoplayer-hotkey-item-value-padding-left:24px}.hot-key-map-item-description.s-1d{color:var(--white-alpha-72);max-width:388px;width:calc(100% - var(--videoplayer-hotkey-item-value-width) - var(--videoplayer-hotkey-item-value-padding-left))}.hot-key-map-item-value.s-1d{color:var(--white);letter-spacing:-.14px;padding-left:var(--videoplayer-hotkey-item-value-padding-left);width:var(--videoplayer-hotkey-item-value-width)}.hot-key-map-item-description.s-1d,.hot-key-map-item-value.s-1d{font-feature-settings:"clig" off,"liga" off;font-size:13px;font-style:normal;font-weight:400;line-height:16px}'};function Pl(e,t){re(t,!1),fr(e,Ll);let[i,r]=us(),s=()=>ls(n,"$data",i),a=Os(),{data:n,show:o}=a.ui.modals.hotKeyMap;Jr(),Tl(e,{get title(){return s().title},onClose:()=>{o.set(!1)},children:(e,t)=>{var i=Al();sr(i,5,(()=>s().groups),(({title:e,items:t})=>e),((e,t)=>{var i=El(),r=Ye(i),s=Ye(r,!0);ze(r);var a=Je(r,2);sr(a,5,(()=>ui(t).items),(({description:e,value:t})=>t),((e,t)=>{var i=Cl(),r=Ye(i);dr(Ye(r),(()=>(e=>{let t=document.createElement("DIV");t.innerHTML=e;let i=t.querySelectorAll("*"),r=i.length;for(;r--;){let e=i[r],t=e.tagName;_l.has(t)||e.parentElement?.removeChild(e)}return t.innerHTML})(ui(t).description))),ze(r);var s=Je(r,2),a=Ye(s,!0);ze(s),ze(i),nt((()=>ji(a,ui(t).value))),Ai(e,i)})),ze(a),ze(i),nt((()=>ji(s,ui(t).title))),Ai(e,i)})),ze(i),Ai(e,i)},$$slots:{default:!0}}),se(),r()}var Ml=Ti('<div class="pillow s-1y"><!></div>'),Il={hash:"s-1y",code:".pillow.s-1y{background-color:#679ff8;color:var(--white);font-size:6px;font-weight:600;-webkit-font-smoothing:antialiased;border-radius:12px;padding:2px 4px}"};var Rl=_i('<svg><!><path d="M5.52 5c.32 0 .51-.2.51-.54V3.5l.5-.51 1.46 1.74c.16.2.3.28.51.28a.5.5 0 0 0 .5-.5c0-.14-.07-.29-.22-.48L7.3 2.3 8.8.87c.16-.14.2-.25.2-.4A.47.47 0 0 0 8.52 0c-.18 0-.3.07-.45.22l-2 2.03h-.04V.54C6.03.2 5.84 0 5.52 0S5 .2 5 .54v3.92c0 .34.2.54.52.54M2.55 1.05 1.05 3.1h1.5zM3.5 3.1V.83C3.5.03 2.41-.3 1.94.35L.14 2.82A.75.75 0 0 0 .75 4h1.8v.55c0 .25.25.45.5.45a.45.45 0 0 0 .45-.45V4h.05a.45.45 0 0 0 0-.9z"></path></svg>');function Vl(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=Rl();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"currentColor","fill-rule":"evenodd",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(),ze(r),Ai(e,r)}var Nl=_i('<svg><!><path d="M5.51 5c.33 0 .52-.2.52-.54V3.5l.49-.51L7.99 4.7c.16.21.3.29.51.29a.49.49 0 0 0 .5-.5c0-.14-.07-.29-.22-.48L7.29 2.3 8.82.87C8.95.73 9 .62 9 .47A.47.47 0 0 0 8.52 0c-.17 0-.3.07-.44.22L6.06 2.25h-.03V.54C6.03.2 5.83 0 5.5 0S5 .2 5 .54v3.92c0 .34.19.54.51.54M2 0c-.35 0-.67.06-.95.17a1.5 1.5 0 0 0-.66.49c-.15.2-.23.44-.23.7 0 .43.21.76.62 1-.23.11-.41.26-.55.44-.15.2-.23.44-.23.71 0 .29.08.55.25.78.18.23.41.4.71.52.3.13.65.19 1.04.19s.73-.06 1.03-.19c.3-.12.54-.3.71-.52a1.26 1.26 0 0 0 .03-1.49 1.45 1.45 0 0 0-.55-.44c.4-.23.62-.57.62-1a1.14 1.14 0 0 0-.24-.7 1.44 1.44 0 0 0-.66-.49A2.4 2.4 0 0 0 2 0m-.57.96C1.56.86 1.75.8 2 .8s.43.06.56.16a.51.51 0 0 1 .2.43c0 .2-.06.34-.2.44A.87.87 0 0 1 2 2a.9.9 0 0 1-.57-.16.52.52 0 0 1-.2-.44c0-.18.06-.32.2-.43ZM1.08 3.5a.6.6 0 0 1 .24-.5c.16-.13.38-.2.68-.2s.52.07.68.2a.6.6 0 0 1 .24.5.63.63 0 0 1-.24.52c-.16.12-.38.19-.68.19s-.52-.07-.68-.19a.64.64 0 0 1-.24-.52"></path></svg>');function Bl(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=Nl();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"currentColor","fill-rule":"evenodd",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(),ze(r),Ai(e,r)}var Dl=_i('<svg><!><path d="M5.52 5h1.1C8.1 5 9 4.07 9 2.5S8.1 0 6.62 0h-1.1C5.19 0 5 .2 5 .54v3.92c0 .34.2.54.52.54m.51-.85V.85h.47C7.41.85 8 1.47 8 2.5c0 1.07-.58 1.65-1.5 1.65zM.52 5c.32 0 .51-.2.51-.54V2.92h1.94v1.54c0 .34.19.54.51.54S4 4.8 4 4.46V.54C4 .2 3.8 0 3.48 0s-.51.2-.51.54v1.53H1.03V.54C1.03.2.84 0 .52 0S0 .2 0 .54v3.99c0 .34.2.47.52.47"></path></svg>');function Ol(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=Dl();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"currentColor",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(),ze(r),Ai(e,r)}var Fl=_i('<svg><!><path d="M9.52 5h1.1C12.1 5 13 4.07 13 2.5S12.1 0 10.62 0h-1.1C9.19 0 9 .2 9 .54v3.92c0 .34.2.54.52.54m.51-.85V.85h.47c.91 0 1.5.62 1.5 1.65 0 1.07-.58 1.65-1.5 1.65zM4.52 5c.32 0 .51-.2.51-.54V2.92h1.94v1.54c0 .34.19.54.51.54S8 4.8 8 4.46V.54C8 .2 7.8 0 7.48 0s-.51.2-.51.54v1.53H5.03V.54C5.03.2 4.84 0 4.52 0S4 .2 4 .54v3.99c0 .34.2.47.52.47m-4 0c.32 0 .51-.2.51-.54V3h1.33c.27 0 .45-.15.45-.41 0-.25-.18-.4-.45-.4H1.03V.84h1.5C2.81.85 3 .7 3 .43S2.8 0 2.53 0H.52C.19 0 0 .2 0 .54v3.92C0 4.8.2 5 .52 5"></path></svg>');function jl(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=Fl();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"13",height:"5",fill:"currentColor",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(),ze(r),Ai(e,r)}var zl=_i('<svg><!><path d="M11.52 5.75h1.1c1.48 0 2.38-.94 2.38-2.5s-.9-2.5-2.38-2.5h-1.1c-.33 0-.52.2-.52.54V5.2c0 .34.2.54.52.54Zm.51-.85V1.6h.47c.91 0 1.5.62 1.5 1.65 0 1.07-.58 1.65-1.5 1.65zm-5.51.85c.32 0 .51-.2.51-.54V3.67h1.94v1.54c0 .34.19.54.51.54s.52-.2.52-.54V1.3c0-.34-.2-.54-.52-.54s-.51.2-.51.54v1.53H7.03V1.3c0-.34-.19-.54-.51-.54S6 .95 6 1.29v3.99c0 .34.2.47.52.47m-3.18-.09a4 4 0 0 1-.84.09C1.04 5.75 0 4.88 0 3.3 0 1.73 1.04.75 2.5.75S5 1.73 5 3.3c0 .87-.27 1.46-.78 1.88l.2.3a.5.5 0 0 1-.84.55zm-.52-.78-.24-.35a.5.5 0 1 1 .84-.56l.24.37c.18-.26.29-.62.29-1.04 0-1.03-.64-1.65-1.45-1.65s-1.45.62-1.45 1.65.64 1.6 1.45 1.6c.08 0 .2 0 .32-.02"></path></svg>');function ql(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=zl();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"15",height:"7",fill:"currentColor",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(),ze(r),Ai(e,r)}var Hl=e=>{switch(e){case m.VideoQuality.Q_720P:return Ol;case m.VideoQuality.Q_1080P:return jl;case m.VideoQuality.Q_1440P:return ql;case m.VideoQuality.Q_2160P:return Vl;case m.VideoQuality.Q_4320P:return Bl}},Ul=_i('<path d="M12.72 2.21q1.8.07 2.41 1.96l.06.21.06.2.06.23.06.16.04.01.06-.02.14-.05.15-.07c1.42-.66 2.5-.53 3.4.44l.12.14.82 1.02c.73.96.7 2 0 3.1l-.13.19-.12.16-.14.2-.07.12-.04.05v.03l.1.06.13.07.15.09c1.39.7 1.96 1.64 1.74 2.93l-.04.19-.24 1.06c-.16.68-.28 1-.77 1.45-.48.43-1.02.61-1.73.67l-.22.02h-.2l-.25.02-.18.02.02.14v.1l.04.17c.32 1.53-.04 2.56-1.19 3.2l-.17.1-1.17.57q-1.64.73-3.02-.7l-.15-.17-.13-.15-.17-.19-.1-.1-.05-.04-.1.09-.1.1-.12.14c-.95 1.13-1.95 1.54-3.17 1.07l-.18-.08-1.05-.5-.31-.17a2 2 0 0 1-1-1.06 3 3 0 0 1-.16-1.88l.04-.23.04-.24.02-.17-.1-.02-.15-.01h-.18c-1.56-.04-2.48-.62-2.85-1.89l-.05-.18-.3-1.28q-.33-1.77 1.37-2.78l.2-.11.17-.1.22-.12.15-.1v-.02l-.06-.1-.08-.13-.1-.14c-.94-1.25-1.04-2.34-.28-3.4L4 6.32l.82-1.01c.8-.92 1.8-1.1 3.04-.64l.2.08.19.08.22.1.13.04.04-.01.03-.1.05-.13.04-.17c.36-1.43 1.09-2.24 2.4-2.35h1.58Zm-.05 1.8h-1.34l-.14.01c-.28.04-.47.2-.65.83l-.04.16-.06.2a6 6 0 0 1-.46 1.14 6 6 0 0 0-1.15.56 7 7 0 0 1-1.16-.35l-.35-.16q-.37-.15-.59-.17h-.08a.6.6 0 0 0-.4.19l-.08.07-.78.98-.1.12c-.18.26-.2.5.2 1.08l.22.31q.34.48.6 1.1-.2.59-.27 1.2-.51.45-1.01.73l-.34.18c-.62.34-.7.56-.65.88l.01.08.28 1.21.04.16c.1.3.27.47.97.5l.39.02q.57.03 1.22.2.35.53.78.97a6 6 0 0 1-.12 1.45c-.2.95-.01 1.1.38 1.3l1.13.54a1 1 0 0 0 .34.1l.06-.01q.26-.03.67-.49l.26-.3q.4-.42.95-.83l.3.02.3.01h.3l.3-.03q.56.4.95.84l.26.3c.32.36.53.48.73.48h.07l.18-.05.09-.04 1.13-.54.14-.08c.3-.17.42-.4.24-1.22a6 6 0 0 1-.12-1.45q.44-.45.78-.97a7 7 0 0 1 1.22-.2l.39-.01c.81-.04.91-.26 1-.66l.27-1.15c.09-.4.1-.64-.62-1.03l-.34-.18a6 6 0 0 1-1.01-.73 6 6 0 0 0-.27-1.2q.26-.62.6-1.1l.22-.31c.4-.58.38-.81.2-1.08l-.05-.06-.78-.97c-.14-.18-.26-.3-.46-.33h-.07q-.23 0-.67.17l-.35.16a6 6 0 0 1-1.16.35 6 6 0 0 0-1.15-.56 7 7 0 0 1-.45-1.1l-.11-.4c-.2-.68-.4-.81-.72-.83zM12 8.2a3.8 3.8 0 1 1 0 7.6 3.8 3.8 0 0 1 0-7.6m0 1.8a2 2 0 1 0 0 4 2 2 0 0 0 0-4"></path>');var Wl=_i('<path d="M13.25 2.83c.23.75.38 1.5 1.63 2.23 1.4.38 2.08 0 2.72-.42.66-.45.86-.32 1.12-.06l.65.64c.29.3.4.42 0 1.18-.38.7-.8 1.33-.42 2.73.72 1.25 1.47 1.47 2.22 1.62.78.16.83.39.83.76v.9c0 .42 0 .59-.83.84-.75.23-1.5.38-2.23 1.63-.38 1.4 0 2.08.42 2.72.45.66.32.86.06 1.12l-.64.65c-.3.29-.42.4-1.18 0-.7-.38-1.34-.8-2.73-.42-1.25.72-1.47 1.47-1.62 2.22-.16.78-.39.83-.76.83h-.9c-.42 0-.59 0-.84-.83-.23-.75-.38-1.5-1.63-2.23-1.4-.38-2.08 0-2.72.42-.66.45-.86.32-1.12.06l-.65-.64c-.29-.3-.4-.42 0-1.18.38-.7.8-1.34.42-2.73-.72-1.25-1.47-1.47-2.22-1.62-.78-.16-.83-.39-.83-.76v-.9c0-.42 0-.59.83-.84.75-.23 1.5-.38 2.22-1.63.38-1.4 0-2.08-.42-2.72-.44-.66-.31-.86-.05-1.12l.64-.65c.3-.29.42-.4 1.18 0 .7.38 1.33.8 2.73.42 1.25-.72 1.47-1.47 1.62-2.22.16-.78.39-.83.76-.83h.9c.42 0 .59 0 .84.83M12 7.25a4.75 4.75 0 1 0 0 9.5 4.75 4.75 0 0 0 0-9.5"></path>');var Ql=Ti('<div aria-hidden="true"><!> <!></div>'),Gl={hash:"s-1t",code:".icon.s-1t{display:flex;height:24px;position:relative;width:24px}.icon.s-1t .pillow{position:absolute;right:-9px;top:1px}.icon.triple.s-1t .pillow{right:-13px}.icon.s-1t svg[data-testid=settings-icon--labeled] ._full{opacity:0;visibility:hidden}"};function Kl(e,t){re(t,!0),fr(e,Gl);let i=ms(t,"isMobile",3,!1),r=ms(t,"currentQuality",3,void 0),s=fe((()=>r()?(0,m.getVideoQualityLabel)(r()):"")),a=fe((()=>Hl(r()))),n=fe((()=>ui(s).length>2));var o=Ei(),l=Xe(o),u=e=>{!function(e,t){Ea(e,{get testId(){return t.testId},children:(e,t)=>{Ai(e,Ul())},$$slots:{default:!0}})}(e,{testId:"settings-mobile-icon"})},d=e=>{var t=Ql();let i;var r=Ye(t),o=e=>{let t=fe((()=>`${ui(s)}-pill-icon`));!function(e,t){fr(e,Il);var i=Ml();Gi(Ye(i),(()=>t.children??V)),ze(i),nt((()=>Pr(i,"data-testid",t.testId))),Ai(e,i)}(e,{get testId(){return ui(t)},children:(e,t)=>{var i=Ei();cr(Xe(i),(()=>ui(a)),((e,t)=>{t(e,{})})),Ai(e,i)},$$slots:{default:!0}})};Ji(r,(e=>{ui(a)&&e(o)}));var l=Je(r,2);let u=fe((()=>ui(a)?"settings-icon--labeled":"settings-icon"));(function(e,t){Ea(e,{get testId(){return t.testId},children:(e,t)=>{Ai(e,Wl())},$$slots:{default:!0}})})(l,{get testId(){return ui(u)}}),ze(t),nt((e=>i=wr(t,1,"icon s-1t",null,i,e)),[()=>({triple:ui(n)})]),Ai(e,t)};Ji(l,(e=>{i()?e(u):e(d,!1)})),Ai(e,o),se()}var Yl=Ti('<span class="settings-icon-wrapper s-23"><!></span>'),Xl={hash:"s-23",code:".settings-icon-wrapper.s-23{position:relative;width:24px}"};function Jl(e,t){re(t,!0),fr(e,Xl);let[i,r]=us(),s=()=>ls(o,"$settingsMenuVisible",i),a=Os(),n=a.state.currentQuality$,o=a.ui.settingsMenu.visible$,l=a.actions.internal.openSettingsMenu,u=a.actions.internal.closeSettingsMenu,d=a.ui.isMobile,c=a.ui.t,h=ke(void 0);rt((()=>{ui(h)&&di((()=>{t.ref$.set(ui(h))}))}));let p=c("aria_label_settings");let f=fe((()=>s()?"opened":""));Sl(e,{get className(){return ui(f)},testId:"settings-btn",click:async function(e){let t=Un(e);s()?u():l(t,li)},get ariaLabel(){return p},get ariaExpanded(){return s()},get ref(){return ui(h)},set ref(e){_e(h,e,!0)},children:(e,t)=>{var r=Yl();Kl(Ye(r),{get isMobile(){return ls(d,"$isMobile",i)},get currentQuality(){return ls(n,"$currentQuality",i)}}),ze(r),Ai(e,r)},$$slots:{default:!0}}),se(),r()}var Zl=_i('<path d="M6.56 4.44a1.5 1.5 0 1 0-2.12 2.12l3.09 3.09a11 11 0 0 0-2.39 3.08 11 11 0 0 0-1.01 4.14C4 18.43 4 20.37 4 22.83v2.34c0 2.46 0 4.4.13 5.96.13 1.6.4 2.93 1.01 4.14a10.5 10.5 0 0 0 4.6 4.59c1.2.61 2.53.88 4.13 1.01 1.56.13 3.5.13 5.96.13h8.34c2.46 0 4.4 0 5.96-.13 1.44-.12 2.66-.35 3.78-.84l3.53 3.53a1.5 1.5 0 0 0 2.12-2.12zM13.5 28a1.5 1.5 0 0 0 0 3h11a1.5 1.5 0 0 0 0-3zM12 22a1.5 1.5 0 0 1 1.5-1.5h4a1.5 1.5 0 0 1 0 3h-4A1.5 1.5 0 0 1 12 22"></path><path d="M34.5 23.5h-4.64l12.55 12.55q.23-.37.45-.78a11 11 0 0 0 1.01-4.14c.13-1.56.13-3.5.13-5.96v-2.34c0-2.46 0-4.4-.13-5.96a11 11 0 0 0-1.01-4.14 10.5 10.5 0 0 0-4.6-4.59 11 11 0 0 0-4.13-1.01C32.57 7 30.63 7 28.17 7h-8.34c-2.46 0-4.4 0-5.96.13l-.35.03L26.86 20.5h7.64a1.5 1.5 0 0 1 0 3"></path>',1),eu=_i("<path></path>");function tu(e,t){re(t,!0);let i=fe((()=>"subtitles-icon"+("off"===t.type?"-off":"outline"===t.type?"-outline":""))),r=fe((()=>Qo(t.size)));Ea(e,{get width(){return"48"},get height(){return"48"},get style(){return ui(r)},get testId(){return ui(i)},get shadow(){return t.shadow},children:(e,i)=>{var r=Ei(),s=Xe(r),a=e=>{var t=Zl();qe(),Ai(e,t)},n=e=>{var i=eu();nt((()=>Pr(i,"d",`M16.92 8h14.16q2.82-.02 4.66.1c1.28.1 2.4.32 3.46.86a8.8 8.8 90 013.84 3.84c.54 1.04.76 2.18.86 3.46q.12 1.84.1 4.66v6.16q.02 2.82-.1 4.66a10 10 90 01-.86 3.46 8.8 8.8 90 01-3.84 3.84 10 10 90 01-3.46.86q-1.84.12-4.66.1H16.92q-2.82.02-4.66-.1a10 10 90 01-3.46-.86 8.8 8.8 90 01-3.84-3.84 10 10 90 01-.86-3.46Q4 29.9 4 27.08v-6.16q-.02-2.82.1-4.66c.1-1.28.32-2.4.86-3.46A8.8 8.8 90 018.8 8.96a10 10 90 013.46-.86Q14.1 8 16.92 8\n     ${"outline"===t.type?"M12.54 11.68c-1.04.1-1.64.26-2.1.48a5.2 5.2 90 00-2.28 2.28c-.22.46-.4 1.06-.48 2.1-.08 1.08-.08 2.46-.08 4.46v6c0 2 0 3.38.08 4.46.1 1.04.26 1.64.48 2.1q.78 1.5 2.28 2.28c.46.22 1.06.4 2.1.48 1.08.08 2.48.08 4.46.08h14c2 0 3.38 0 4.46-.08 1.04-.1 1.64-.26 2.1-.48a5.2 5.2 90 002.28-2.28c.22-.46.4-1.06.48-2.1.08-1.08.08-2.48.08-4.46v-6c0-2 0-3.38-.08-4.46a6 6 90 00-.48-2.1 5.2 5.2 90 00-2.28-2.28c-.46-.22-1.06-.4-2.1-.48-1.08-.08-2.48-.08-4.46-.08h-14c-2 0-3.38 0-4.46.08":""}\n     M12 29.8c0-1 .8-1.8 1.8-1.8h10.4a1.8 1.8 90 010 3.6H13.8a1.8 1.8 90 01-1.8-1.8m0-7.6c0-1 .8-1.8 1.8-1.8h3.4a1.8 1.8 90 110 3.6H13.8a1.8 1.8 90 01-1.8-1.8m17 7.6c0-1 .8-1.8 1.8-1.8h3.4a1.8 1.8 90 110 3.6h-3.4a1.8 1.8 90 01-1.8-1.8M22 22.2c0-1 .8-1.8 1.8-1.8h10.4a1.8 1.8 90 010 3.6h-10.4a1.8 1.8 90 01-1.8-1.8`))),Ai(e,i)};Ji(s,(e=>{"off"===t.type?e(a):e(n,!1)})),Ai(e,r)},$$slots:{default:!0}}),se()}function iu(e,t){re(t,!0);let i=ms(t,"isSubtitlesEnabled",3,!1),r=Os().ui.t,s=fe((()=>i()?r("tooltip_subtitles_on"):r("tooltip_subtitles_off")));Sl(e,{testId:"subtitles-btn",get ariaLabel(){return ui(s)},get click(){return t.click},get ariaKeyShortCut(){return xs},role:"button",children:(e,t)=>{let r=fe((()=>i()?void 0:"outline"));tu(e,{get size(){return"24"},get type(){return ui(r)}})},$$slots:{default:!0}}),se()}var ru=Ti('<span class="duration s-21" data-testid="video_duration"> </span>'),su=Ti('<div><span class="current s-21" data-testid="current_time"> </span> <!></div>'),au={hash:"s-21",code:'.time.s-21{align-items:center;color:var(--controls-time);display:flex;font-variant-numeric:tabular-nums;font-weight:500;padding:12px 6px}.time.mobile.s-21{padding:0 0 0 8px}.current.s-21{position:relative}.duration.s-21{opacity:.7}.duration.s-21:before{content:" / ";white-space:pre}'};function nu(e,t){re(t,!0),fr(e,au);let i=ms(t,"isMobile",3,!1),r=ms(t,"isHidden",3,!1),s=ms(t,"showDuration",3,!0),a=ms(t,"ref",15),n=ys(),o=rs(!1),l=fe((()=>xn(t.duration))),u=fe((()=>xn(t.position)));var d=su();let c;var h=Ye(d),p=Ye(h,!0);ze(h);var f=Je(h,2),m=e=>{var t=ru(),i=Ye(t,!0);ze(t),nt((()=>ji(i,ui(l)))),Ai(e,t)};Ji(f,(e=>{s()&&e(m)})),ze(d),mr(d,(()=>In(r()&&n.features.usePerformanceFix,o,n.disableInvisibleComponentsTimeout))),Xr(d,(e=>a(e)),(()=>a())),nt((e=>{c=wr(d,1,"time s-21",null,c,e),ji(p,ui(u))}),[()=>({mobile:i()})]),Ai(e,d),se()}var ou=_i('<path d="M21.8632 10.0832C22.2147 9.73171 22.7852 9.73171 23.1367 10.0832C23.4881 10.4347 23.4881 11.0051 23.1367 11.3566L18.6367 15.8566C18.2852 16.2081 17.7147 16.2081 17.3632 15.8566C17.0117 15.5051 17.0117 14.9347 17.3632 14.5832L21.8632 10.0832Z"></path><path d="M17.3632 11.3566C17.0117 11.0051 17.0117 10.4347 17.3632 10.0832C17.7147 9.73171 18.2852 9.73171 18.6367 10.0832L23.1367 14.5832C23.4881 14.9347 23.4881 15.5051 23.1367 15.8566C22.7852 16.2081 22.2147 16.2081 21.8632 15.8566L17.3632 11.3566Z"></path>',1),lu=_i("<path></path>"),uu=_i('<path d="M14 3.96997C14.5523 3.96997 15 4.41769 15 4.96997V20.97C15 21.5223 14.5523 21.97 14 21.97C13.3585 21.97 12.7422 21.7208 12.2808 21.2751L6.79013 15.97H4C2.89543 15.97 2 15.0745 2 13.97V11.97C2 10.8654 2.89543 9.96997 4 9.96997H6.765L12.2794 4.66337C12.7417 4.21849 13.3584 3.96997 14 3.96997Z"></path><!>',1);function du(e,t){re(t,!0);let i=ms(t,"volume",3,1),r=ms(t,"muted",3,!1),s=fe((()=>((e,t)=>t?"off":e>.5?"max":e>.2?"mid":e>0?"min":"off")(i(),r()))),a=fe((()=>Qo(t.size)));Ea(e,{get style(){return ui(a)},get testId(){return`volume-${ui(s)??""}-icon`},get shadow(){return t.shadow},children:(e,t)=>{var i=uu(),r=Je(Xe(i)),a=e=>{var t=ou();qe(),Ai(e,t)},n=e=>{var t=lu();nt((()=>Pr(t,"d","M16.8748 8.85259C17.2324 8.50731 17.8021 8.51726 18.1474 8.87481C18.5465 9.28803 18.8614 9.77691 19.0757 10.3128C19.2901 10.8486 19.4 11.4218 19.4 12C19.4 12.5782 19.2901 13.1514 19.0757 13.6872C18.8614 14.2231 18.5465 14.712 18.1474 15.1252C17.8021 15.4827 17.2324 15.4927 16.8748 15.1474C16.5173 14.8021 16.5073 14.2324 16.8526 13.8748C17.0876 13.6314 17.2757 13.3408 17.4045 13.0187C17.5333 12.6966 17.6 12.3504 17.6 12C17.6 11.6496 17.5333 11.3034 17.4045 10.9813C17.2757 10.6592 17.0876 10.3686 16.8526 10.1252C16.5073 9.76764 16.5173 9.19788 16.8748 8.85259Z"+("max"===ui(s)?"M19.2636 6.2636C19.6151 5.91213 20.1849 5.91213 20.5364 6.2636C21.2516 6.97878 21.9929 7.99659 22.3989 8.97678C22.7959 9.93525 23.0003 10.9625 23.0003 12C23.0003 13.0374 22.7959 14.0647 22.3989 15.0232C21.9929 16.0034 21.2516 17.0212 20.5364 17.7364C20.1849 18.0879 19.6151 18.0879 19.2636 17.7364C18.9121 17.3849 18.9121 16.8151 19.2636 16.4636C19.8484 15.8788 20.4384 15.0527 20.7359 14.3343C21.0425 13.5943 21.2003 12.801 21.2003 12C21.2003 11.1989 21.0425 10.4057 20.7359 9.66561C20.4384 8.94724 19.8484 8.12124 19.2636 7.5364C18.9121 7.18492 18.9121 6.61508 19.2636 6.2636Z":"")))),Ai(e,t)};Ji(r,(e=>{"off"===ui(s)?e(a):e(n,!1)})),Ai(e,i)},$$slots:{default:!0}}),se()}var cu=Ti('<div class="overlay"><!></div>');function hu(e,t){re(t,!0);let[i,r]=us(),s=()=>ls(a,"$overlayContainer$",i),a=Os().ui.overlayContainer$,n=ke(void 0),o=e=>{!e||!ui(n)||e.contains(ui(n))||e.appendChild(ui(n))};rt((()=>{o(s())})),Ki((()=>(o(s()),()=>{var e;!(e=s())||!ui(n)||!e.contains(ui(n))||e.removeChild(ui(n))})));var l=cu();Gi(Ye(l),(()=>t.children??V)),ze(l),Xr(l,(e=>_e(n,e)),(()=>ui(n))),Ai(e,l),se(),r()}var pu=Ti('<div class="tooltip s-1m"><div class="content s-1m"> </div> <div class="tooltip-pointer s-1m"></div></div>'),fu=Ti("<div><!></div> <!>",1),mu={hash:"s-1m",code:'.tooltip-wrapper.s-1m{display:flex;flex-direction:column;min-width:0}.full-width.s-1m{width:100%}.tooltip.s-1m{bottom:100%;left:0;opacity:0;position:absolute;transition:opacity .2s,visibility .2s;visibility:hidden}.content.s-1m{background-color:rgba(41,41,41,.8);border-radius:3px;color:var(--white);display:inline-block;padding:6px 10px}.tooltip-pointer.s-1m{border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid rgba(41,41,41,.8);bottom:0;content:" ";font-size:0;line-height:0;position:absolute;width:0}'};function gu(e,t){re(t,!0),fr(e,mu);let i,[r,s]=us(),a=()=>ls(T,"$overlayContainer$",r),n=ms(t,"isMobile",3,!1),o=ms(t,"content",3,""),l=ms(t,"active",15,!1),u=ms(t,"translateX",3,0),d=ms(t,"translateY",3,0),c=ms(t,"isFullWidthWrapper",3,!1),h=ms(t,"maxTooltipWidth",3,void 0),p=ms(t,"placement",3,"top"),f=ms(t,"onVisibilityChange",3,m.noop),g=ke(void 0),v=ke(void 0),b=ke(0),y=ke(0),S=ke(0),w=ke(0),$=ys(),x=Os(),k=x.ui.playerSize,T=x.ui.overlayContainer$;rt((()=>{di((()=>{f()(l())}))}));let _=x.getLogger().createComponentLog("Tooltip component"),C=()=>{if(!a()||!ui(v)||!ui(g))return;_e(y,5);let e=a().getBoundingClientRect(),t=ui(g).getBoundingClientRect(),i=t.width,s=ui(v).clientWidth,n=ls(k,"$containerSize",r).width,o=(i-s)/2,l=t.left+u()-e.left,c=l+o,h=t.top+d()-e.top,p=s/2-5,f=c+s>n-8;c<8&&(c=8,p=l+t.width/2-12.5),f&&(c=n-8-s,p=t.left-e.left+t.width/2-c-5),_e(S,c,!0),_e(w,h),_e(b,p,!0)},E=()=>{switch(p()){case"top":C();break;case"bottom":!a()||!ui(v)||!ui(g)||_e(y,-5);break;case"left":(()=>{if(!a()||!ui(v)||!ui(g))return;_e(b,5);let e=a().getBoundingClientRect(),t=ui(g).getBoundingClientRect(),i=t.height,r=ui(v).clientHeight,s=(i-r)/2+r,n=t.left+u()-e.left-ui(v).clientWidth-5;n<8&&(n=8);let o=t.top+d()-e.top+s,l=2-s/2;_e(S,n,!0),_e(w,o),_e(y,l),_e(b,-3)})();break;default:!a()||!ui(v)||!ui(g)||_e(b,-5)}},A=()=>{try{if(!a()||!ui(g))return;E(),l(!0)}catch(e){_({message:String(e)})}},L=()=>{ui(v)&&(i||(i=window.setTimeout(A,$.controls.hideTimeoutTooltips)),l()&&A())},P=()=>{l(!1),window.clearTimeout(i),i=void 0},M=fe((()=>((e,t,i)=>{let r="";switch(p()){case"top":default:r=`transform: translate(${e}px, ${t}px);`;break;case"bottom":r=`transform: translate(${e}px, ${t}px); top: auto; bottom: 100%;`;break;case"left":r=`transform: translate(${e}px, ${t}px); left: 0; right: auto;`}return r+=` max-width: ${void 0===h()?"auto":`${h()}px`};`,r+=` opacity: ${i?1:0}; visibility: ${i?"visible":"hidden"}`,r})(ui(S),ui(w),l()))),I=fe((()=>((e,t)=>{let i="";switch(p()){case"top":i=`transform: translate(${e}px, ${t}px) rotate(0); top: auto; bottom: 0;`;break;case"bottom":i=`transform: translate(${e}px, ${t}px) rotate(180deg); top: 0; bottom: auto;`;break;case"left":i=`transform: translate(${e}px, ${t}px) rotate(-90deg); left: 100%; top: auto; bottom: 0;`;break;default:i=`transform: translate(${e}px, ${t}px) rotate(90deg); right: 100%; top: auto; bottom: 0;`}return i})(ui(b),ui(y))));Ki(E),Yi((()=>window.clearTimeout(i)));var R=fu(),N=Xe(R);let B;N.__pointermove=L,N.__pointerdown=P,N.__pointerup=function(...e){(t.disableMouseupTooltipShow?void 0:L)?.apply(this,e)},Gi(Ye(N),(()=>t.children??V)),ze(N),Xr(N,(e=>_e(g,e)),(()=>ui(g)));var D=Je(N,2),O=e=>{hu(e,{children:(e,t)=>{var i=pu(),r=Ye(i),s=Ye(r,!0);ze(r);var a=Je(r,2);ze(i),Xr(i,(e=>_e(v,e)),(()=>ui(v))),nt((()=>{xr(i,ui(M)),ji(s,o()),xr(a,ui(I))})),Ai(e,i)},$$slots:{default:!0}})};Ji(D,(e=>{o()&&!n()&&e(O)})),nt((e=>B=wr(N,1,"tooltip-wrapper s-1m",null,B,e)),[()=>({"full-width":c()})]),Si("pointerenter",N,L),Si("pointerleave",N,P),Ai(e,R),se(),s()}wi(["pointermove","pointerdown","pointerup"]);var vu=e=>{e.stopPropagation()},bu=Ti("<div><!></div>"),yu={hash:"s-18",code:".btn-container.s-18{align-items:center;display:flex;height:100%;position:relative;transition:var(--button-hover-transition);will-change:opacity;-webkit-tap-highlight-color:transparent}.w-max.s-18{min-width:0;width:100%}"};function Su(e,t){re(t,!0),fr(e,yu);let[i,r]=us(),s=Os(),a=Fs(),n=s.ui.isMobile,o=a.graphIsOpened$,l=s.ui.t,u=ms(t,"className",3,""),d=ms(t,"disabled",3,!1),c=ms(t,"hasTooltip",3,!0),h=ms(t,"ref",15,void 0),p=ms(t,"width",15,void 0),f=ms(t,"isFullWidthTooltip",3,!0),g=ms(t,"tooltipContent",3,""),v=ms(t,"tooltipVisible",3,!1),b=ms(t,"tooltipPlacement",3,"top"),y=ms(t,"disabledTooltipContent",19,(()=>l("tooltip_button_disabled"))),S=ms(t,"isAriaHidden",3,!1),w=ms(t,"onTooltipVisibilityChange",3,m.noop),$=ms(t,"initialTranslateXPx",3,0),x=ms(t,"initialTranslateYPx",19,(()=>-18)),k=ms(t,"mouseEnter",3,m.noop),T=ms(t,"mouseLeave",3,m.noop),_=fe((()=>d()?ls(o,"$isGraphOpened$",i)?l("tooltip_disabled_when_graph_on"):y():g())),C=ke(!1);rt((()=>{v()||_e(C,!1)}));var E=bu();E.__pointerdown=[vu],E.__click=[vu];var A=Ye(E),L=e=>{gu(e,{get content(){return ui(_)},get translateX(){return $()},get translateY(){return x()},get isFullWidthWrapper(){return f()},get placement(){return b()},get onVisibilityChange(){return w()},get disableMouseupTooltipShow(){return t.disableMouseupTooltipShow},get active(){return ui(C)},set active(e){_e(C,e,!0)},children:(e,i)=>{var r=Ei();Gi(Xe(r),(()=>t.children??V)),Ai(e,r)},$$slots:{default:!0}})},P=e=>{var i=Ei();Gi(Xe(i),(()=>t.children??V)),Ai(e,i)};Ji(A,(e=>{c()&&ui(_)&&!ls(n,"$isMobile",i)?e(L):e(P,!1)})),ze(E),Xr(E,(e=>h(e)),(()=>h())),nt((()=>{wr(E,1,`btn-container ${u()??""}`,"s-18"),Pr(E,"aria-hidden",S()||null)})),Si("mouseenter",E,(function(...e){k()?.apply(this,e)})),Si("mouseleave",E,(function(...e){T()?.apply(this,e)})),Kr(E,"clientWidth",p),Ai(e,E),se(),r()}wi(["pointerdown","click"]);var wu=_i('<rect width="20" height="20" rx="10"></rect><path d="m12.53 8.69.06.19-.22-.64a.83.83 0 0 0-1.6.47l.13.48-.23-.85a.82.82 0 0 0-1.6.24l-.73-2.93a.85.85 0 0 0-1.65.4L8 11.34l-1.12-1.16a.8.8 0 0 0-1.21 1.03l2.23 2.94s1.23 1.83 4.3 1.23c2.43-.48 3.25-2.67 2.58-4.88l-.55-2.3a.88.88 0 1 0-1.7.49"></path>',1);function $u(e,t){let i=fe((()=>(t.completed,"interactive-episode-completed-icon")));Ea(e,{width:"20",height:"20",fill:"none",get testId(){return ui(i)},children:(e,i)=>{var r=wu(),s=Xe(r),a=Je(s);nt((()=>{Pr(s,"fill",Ta),Pr(s,"fill-opacity",t.completed?1:.24),Pr(a,"fill",t.completed?"var(--interactive-episode-complete)":"white")})),Ai(e,r)},$$slots:{default:!0}})}var xu=Ti("<div><!></div>"),ku={hash:"s-w",code:".interactive-episode-icon.s-w{cursor:default;height:20px;position:absolute;transform:translateX(-50%);width:20px}.interactive-episode-icon.disabled.s-w{opacity:.4;pointer-events:none}"};var Tu=Ti('<div><div class="video-episode-inner s-x"><div class="video-episode-loaded s-x"></div> <div></div></div></div>'),_u=Ti('<div class="video-episodes-wrap s-x"></div>'),Cu={hash:"s-x",code:".video-episodes-wrap.s-x{height:100%;position:absolute;width:100%}.video-episode.s-x{box-sizing:border-box;height:calc(var(--slider-height)*3);margin-top:calc(var(--slider-height)*-1);padding:var(--slider-height) var(--slider-video-episode-gap);position:absolute;transition:transform .2s}.video-episode.s-x:first-child{padding-left:0}.video-episode.s-x:last-child{padding-right:0}.video-episode.s-x:not(.disabled):where(:hover,:active){transform:scaleY(1.5)}.video-episode-filled.s-x,.video-episode-inner.s-x,.video-episode-loaded.s-x{border-radius:var(--slider-radius);height:var(--slider-height);position:absolute}.video-episode-inner.s-x{background:var(--slider-bg);overflow:hidden;position:absolute;width:calc(100% - var(--slider-video-episode-gap)*2)}.video-episode.s-x:first-child .video-episode-inner:where(.s-x),.video-episode.s-x:last-child .video-episode-inner:where(.s-x){width:calc(100% - var(--slider-video-episode-gap))}.video-episode-loaded.s-x{background:var(--slider-loaded-bg);transition:transform .2s}.video-episode-filled.s-x,.video-episode-loaded.s-x{border-radius:var(--slider-radius);height:100%;left:-100%;position:absolute;width:100%}.video-episode-filled.s-x{background-color:var(--slider-filled-bg)}"};function Eu(e,t,i,r,s,a,n){if(e.preventDefault(),t()&&_e(i,t().getBoundingClientRect(),!0),r()||ui(s)||!t())return;_e(s,!0);let o=a(e.clientX,e.clientY);n()(o,e),t().setPointerCapture(e.pointerId)}function Au(e,t,i,r,s,a,n,o){if(e.preventDefault(),t())return;let l=i(e.clientX,e.clientY),u=r(e.clientX);s()(l,u,ui(a).width,e),ui(n)&&o()(l)}function Lu(e,t,i,r,s){if(e.preventDefault(),t()||!ui(i))return;_e(i,!1);let a=r(e.clientX,e.clientY);s()(a,e)}function Pu(e,t,i,r){e.stopPropagation(),e.preventDefault(),t()&&i()(r(e.clientX,e.clientY))}function Mu(e,t,i,r,s,a){let n=t(e.clientX,e.clientY);i()&&r()(n),_e(s,!1),a()(n)}var Iu=Ti("<div></div>"),Ru=Ti('<div class="bars s-s"><div class="loaded s-s"></div> <div></div></div>'),Vu=Ti('<!> <div role="slider" tabindex="0"><!> <div><div></div></div></div>',1),Nu={hash:"s-s",code:'.interactive-icons.s-s{position:absolute;top:-28px;width:calc(100% - 20px)}.interactive-icons.mobile.s-s{top:-10px}.slider.s-s{border-radius:var(--slider-radius);cursor:pointer;height:var(--slider-height);position:relative;touch-action:none;transition:opacity .2s;width:100%;will-change:opacity,transform;-webkit-tap-highlight-color:transparent}.no-handle.s-s{cursor:default}.slider.s-s:before{content:"";height:calc(var(--controls-height)/2);left:0;position:absolute;right:0;top:calc((var(--controls-height)/2 - var(--slider-height))*-1/2)}.bars.s-s{background:var(--slider-bg);overflow:hidden}.bars.s-s,.loaded.s-s{border-radius:var(--slider-radius);height:100%;position:absolute;width:100%}.loaded.s-s{background:var(--slider-loaded-bg);left:-100%;transition:transform .2s;will-change:transform}.filled.s-s{background-color:var(--slider-filled-bg);border-radius:var(--slider-radius);height:100%;left:-100%;position:absolute;width:100%}.slider.square.s-s,.slider.square.s-s .filled:where(.s-s),.slider.square.s-s .loaded:where(.s-s),.slider.square.s-s>.bars:where(.s-s){border-radius:unset}.filled.active-live.s-s{background-color:var(--timeline-slider-filled-active-live-bg)}.filled.ads.s-s{background-color:var(--slider-filled-ads)}.handleWrap.s-s{left:-100%;position:absolute;width:100%}.handle.s-s{background-color:var(--slider-handle-bg);border-radius:50%;height:var(--slider-handle-size);opacity:0;position:absolute;right:calc(var(--slider-handle-size)*-1/2);top:calc((var(--slider-height) - var(--slider-handle-size))/2);transform:scale(0);transition:opacity .2s,transform .2s;visibility:hidden;width:var(--slider-handle-size);will-change:opacity,transform}.handle.active-live.s-s{background-color:var(--timeline-slider-handle-active-live-bg)}.handle-always-visible.s-s .handle:where(.s-s),.slider-dragging.s-s .handle:where(.s-s),.slider.s-s:hover .handle:where(.s-s){opacity:1;transform:scale(1);visibility:visible}.slider-dragging.s-s .handle:where(.s-s){transform:scale(1.3)}.slider-vertical.s-s{left:-8px;position:absolute;top:-18px;transform:rotate(-90deg);transform-origin:0 0}.slider.disabled.s-s{cursor:default;opacity:.4}'};function Bu(e,t){re(t,!0),fr(e,Nu);let i=ms(t,"ref",15,void 0),r=ms(t,"className",3,""),s=ms(t,"testId",3,void 0),a=ms(t,"isHidden",3,!1),n=ms(t,"isVertical",3,!1),o=ms(t,"isActiveLive",3,!1),l=ms(t,"isMobile",3,!1),u=ms(t,"squareBorders",3,!1),d=ms(t,"videoEpisodes",19,(()=>[])),c=ms(t,"withWheelHandler",3,!1),h=ms(t,"isInteractive",3,!1),p=ms(t,"disabled",3,!1),f=ms(t,"hideHandel",3,!1),g=ms(t,"onPointerDown",3,m.noop),v=ms(t,"onHandleMove",3,m.noop),b=ms(t,"onPointerUp",3,m.noop),y=ms(t,"onPointerEnter",3,m.noop),S=ms(t,"onPointerMove",3,m.noop),w=ms(t,"onPointerLeave",3,m.noop),$=ms(t,"onMouseEnter",3,m.noop),x=ms(t,"onMouseLeave",3,m.noop),k=ms(t,"onWheelUp",3,m.noop),T=ms(t,"onWheelDown",3,m.noop),_=ms(t,"onWheelLeft",3,m.noop),C=ms(t,"onWheelRight",3,m.noop),E=ms(t,"onDisabledClick",3,m.noop),A=ms(t,"loadedProgress",3,0),L=ms(t,"filledProgress",3,0),P=ms(t,"handleProgress",3,0),M=ms(t,"ariaLabel",3,""),I=ms(t,"ariaValueMin",3,void 0),R=ms(t,"ariaValueMax",3,void 0),V=ms(t,"ariaValueNow",3,void 0),N=ms(t,"ariaValueText",3,""),B=ms(t,"onContextMenu",3,m.noop),D=ms(t,"handleAlwaysVisible",3,!1),O=ys(),F=ke(void 0),j=ke(!1),z=fe((()=>R()??0)),q=fe((()=>(0,m.isNonNullable)(d())&&d()[d().length-1]?.time<ui(z))),H=fe((()=>(0,m.isNonNullable)(d())&&d().length&&ui(q)&&ui(z)?function(e,t){let i=O.features.episodesClustering&&!h()?O.episodeMinWidthPc:0,r=[],s=d()[0].time/ui(z)*100,a=0,n=0;for(let o=1;o<d().length;o++)a=d()[o].time/ui(z)*100,a-s>i&&(r.push({from:s,width:Math.max(0,a-s),loadedWidth:Math.max(0,Math.min(a,e)-s),filledWidth:Math.max(0,Math.min(a,t)-s),interactive:d()[o-1].interactive,completed:d()[o-1].completed}),s=d()[o].time/ui(z)*100,n++);let o={from:s,width:Math.max(0,100-s),loadedWidth:Math.max(0,Math.min(e,100)-s),filledWidth:Math.max(0,Math.min(t,100)-s),interactive:d()[n].interactive,completed:d()[n].completed};100-s<i?(n-=1,r[n].width+=100-s,r[n].loadedWidth+=Math.max(0,Math.min(e,100)-s),r[n].filledWidth+=Math.max(0,Math.min(t,100)-s)):r[n]=o;let l=d()[0].time;if(0!==l){let i=l/ui(z)*100;r.unshift({from:0,width:i,loadedWidth:Math.min(i,e),filledWidth:Math.min(i,t)})}return r}(100*A(),100*L()):[]));function U(e,t){return n()?Math.max(0,Math.min(1,(ui(F).height-(t-ui(F).top))/ui(F).height)):Math.min(Math.max(e-ui(F).x,0),ui(F).width)/ui(F).width}function W(e){return Math.min(Math.max(e-ui(F).x,0),ui(F).width)}function Q(e){return Math.max(0,Math.min(100,100*e))}let G=fe((()=>Q(A()))),K=fe((()=>Q(L())));var Y=Vu(),X=Xe(Y),J=e=>{var t=Iu();let i;sr(t,21,(()=>ui(H)),(e=>e.from),((e,t)=>{var i=Ei(),r=Xe(i),s=e=>{!function(e,t){re(t,!0),fr(e,ku);let i=Os().ui.t,r=ke(0),s=fe((()=>i(t.videoEpisode.completed?"tooltip_episode_finished":"tooltip_episode_unfinished")));Su(e,{get tooltipContent(){return ui(s)},initialTranslateXPx:-10,initialTranslateYPx:-10,get disabled(){return t.disabled},get width(){return ui(r)},isAriaHidden:!0,isFullWidthTooltip:!1,children:(e,i)=>{var s=xu();let a;var n=Ye(s);let o=fe((()=>!!t.videoEpisode.completed));$u(n,{get completed(){return ui(o)}}),ze(s),nt((e=>{a=wr(s,1,"interactive-episode-icon s-w",null,a,e),xr(s,`left: ${t.videoEpisode.from+t.videoEpisode.width/2}%`)}),[()=>({disabled:t.disabled})]),Kr(s,"clientWidth",(e=>_e(r,e))),Ai(e,s)},$$slots:{default:!0}}),se()}(e,{get videoEpisode(){return ui(t)},get disabled(){return p()}})};Ji(r,(e=>{ui(t).interactive&&e(s)})),Ai(e,i)})),ze(t),nt((e=>i=wr(t,1,"interactive-icons s-s",null,i,e)),[()=>({mobile:l(),hidden:l()&&!ui(j)})]),Ai(e,t)};Ji(X,(e=>{h()&&e(J)}));var Z=Je(X,2);let ee;Z.__pointerdown=[Eu,i,F,p,j,U,g],Z.__pointermove=[Au,p,U,W,S,F,j,v],Z.__pointerup=[Lu,p,j,U,b],Z.__click=[Pu,p,E,U],Z.__contextmenu=[Mu,U,p,E,j,B];var te=Ye(Z),ie=e=>{!function(e,t){fr(e,Cu);let i=ms(t,"videoEpisodes",19,(()=>[]));var r=_u();sr(r,21,i,(e=>e.from),((e,i)=>{var r=Tu();let s;var a=Ye(r),n=Ye(a),o=Je(n,2);let l;ze(a),ze(r),nt(((e,t)=>{s=wr(r,1,"video-episode s-x",null,s,e),xr(r,`left: ${ui(i).from}%; width: ${ui(i).width}%`),xr(n,`transform: translateX(${ui(i).loadedWidth/ui(i).width*100}%)`),l=wr(o,1,"video-episode-filled s-x",null,l,t),xr(o,`transform: translateX(${ui(i).filledWidth/ui(i).width*100}%)`)}),[()=>({disabled:t.disabled,mobile:t.isMobile}),()=>({mobile:t.isMobile})]),Ai(e,r)})),ze(r),Ai(e,r)}(e,{get videoEpisodes(){return ui(H)},get disabled(){return p()},get isMobile(){return l()}})},ae=e=>{var t=Ru(),i=Ye(t),r=Je(i,2);let s;ze(t),nt((e=>{Pr(i,"data-value",ui(G)),xr(i,`transform: translateX(${ui(G)}%);`),s=wr(r,1,"filled s-s",null,s,e),Pr(r,"data-value",ui(K)),xr(r,`transform: translateX(${ui(K)}%);`)}),[()=>({"active-live":o()})]),Ai(e,t)};Ji(te,(e=>{ui(H).length?e(ie):e(ae,!1)}));var ne=Je(te,2);let oe;var le=Ye(ne);let ue;ze(ne),ze(Z),Xr(Z,(e=>i(e)),(()=>i())),nt(((e,t,i,a)=>{ee=wr(Z,1,`slider ${r()??""}`,"s-s",ee,e),Pr(Z,"aria-label",M()),Pr(Z,"aria-valuemin",I()),Pr(Z,"aria-valuemax",R()),Pr(Z,"aria-valuenow",V()),Pr(Z,"aria-valuetext",N()),Pr(Z,"data-testid",s()??null),oe=wr(ne,1,"handleWrap s-s",null,oe,t),xr(ne,i),ue=wr(le,1,"handle s-s",null,ue,a)}),[()=>({disabled:p(),"slider-dragging":ui(j),hidden:a(),"handle-always-visible":D(),"slider-vertical":n(),"no-handle":f(),square:u()}),()=>({hidden:f()}),()=>`transform: translateX(${Q(P())}%);`,()=>({"active-live":o()})]),Si("pointerenter",Z,(function(e){if(e.preventDefault(),i()&&_e(F,i().getBoundingClientRect(),!0),p())return;let t=U(e.clientX,e.clientY),r=W(e.clientX);y()(t,r,ui(F).width)})),Si("pointerleave",Z,(function(e){e.preventDefault(),!p()&&w()()})),Si("mouseenter",Z,(function(){$()()})),Si("mouseleave",Z,(function(){x()()})),Si("wheel",Z,(function(e){p()||c()&&(e.preventDefault(),e.deltaY<0?k()():e.deltaY>0?T()():e.deltaX>0?C()():_()())})),Ai(e,Y),se()}wi(["pointerdown","pointermove","pointerup","click","contextmenu"]);var Du=(e,t)=>Is[e]>=Is[t],Ou=(e,t)=>Is[e]<=Is[t],Fu=Ti("<div><!></div>"),ju=Ti("<div><!> <!></div>"),zu={hash:"s-29",code:".volumeBar-container.s-29{align-items:center;display:flex}.vertical.s-29 .btn,.vertical.s-29 .tooltip-wrapper,.volumeBar-container.vertical.s-29{width:40px}.volumeBar.s-29{align-items:center;display:flex;margin:0 8px;position:relative;width:70px;--slider-height:var(--slider-volume-height);--slider-radius:var(--slider-volume-radius);--slider-handle-size:var(--slider-volume-handle-size);--slider-bg:var(--volume-slider-bg);--slider-filled-bg:var(--volume-slider-filled-bg);--slider-handle-bg:var(--volume-slider-handle-bg)}.volumeBar-slider-vertical{width:50px!important}.volumeBar-vertical.s-29{padding:0 8px 0 0;width:0}"};function qu(e,t){re(t,!0),fr(e,zu);let i,[r,s]=us(),a=()=>ls(b,"$isAudioAvailable$",r),n=()=>ls(u,"$volume$",r),o=Os(),l=ys(),u=o.state.volume$,d=o.state.muted$,{setVolume:c,startVolumeChanging:h,stopVolumeChanging:p}=o.actions.internal,f=o.ui.currentGridType$,g=o.callbacks?.onAudioDoesNotExistHint,v=o.callbacks?.onAudioDisabledHint,b=o.state.isAudioAvailable$,y=o.state.isAudioDisabled,S=o.ui.t,w=ke(!1),$=fe((()=>t.isAds||a())),x=fe((()=>!ui($)||ls(d,"$muted$",r)||0===n())),k=fe((()=>Ou(ls(f,"$currentGridType$",r),"l"))),T=fe((()=>ui(k)?"":ui(x)?!a()||y?S("tooltip_sound_unavailable"):S("tooltip_volume"):S("tooltip_volume_muted"))),_=fe((()=>ui(x)?S("tooltip_volume"):S("tooltip_volume_muted"))),C=fe((()=>ui(x)?0:n())),E=!1,A=fe((()=>!t.isAds&&(y?!v:!a()&&!g)));function L(e){h(),c(e)}function P(){al(o,n(),l.controls.volumeStepWheel)}function M(){nl(o,n(),l.controls.volumeStepWheel)}function I(e){c(e)}function R(e){c(e),p()}function V(){E=!0}function N(){E=!1,O()}function B(){clearTimeout(i),_e(w,!0)}function D(){O()}function O(){i=window.setTimeout((()=>{E||_e(w,!1)}),l.controls.volumeBarTimeout)}let F=ke(!1),j=o.ui.controlsVisible;rt((()=>{ls(j,"$controlsVisible",r)||_e(F,!1)}));var z=ju();let q;var H=Ye(z);gu(H,{get content(){return ui(T)},translateY:-18,get active(){return ui(F)},set active(e){_e(F,e,!0)},children:(e,i)=>{let r=fe((()=>ui(k)?"btn-volume-vertical":"btn-volume-horizontal"));Sl(e,{className:"btn-full-opacity",get disabled(){return ui(A)},get testId(){return ui(r)},get ariaLabel(){return ui(_)},get click(){return t.click},get ariaKeyShortCut(){return ks},role:"button",children:(e,t)=>{du(e,{get size(){return"24"},get volume(){return n()},get muted(){return ui(x)}})},$$slots:{default:!0}})},$$slots:{default:!0}});var U=Je(H,2),W=e=>{var t=Fu();let i;var r=Ye(t);let s=fe((()=>ui(k)?"volumeBar-slider-vertical":"")),a=fe((()=>ui(k)&&!ui(w))),n=fe((()=>ui(k)?V:m.noop)),o=fe((()=>ui(k)?N:m.noop)),l=fe((()=>Math.round(100*ui(C)))),u=fe((()=>`${Math.round(100*ui(C))}%`)),d=fe((()=>ui(k)?"volume-slider-vertical":"volume-slider"));Bu(r,{get className(){return ui(s)},get isHidden(){return ui(a)},get isVertical(){return ui(k)},withWheelHandler:!0,onWheelUp:P,onWheelDown:M,onPointerDown:L,onHandleMove:I,onPointerUp:R,get onPointerEnter(){return ui(n)},get onPointerLeave(){return ui(o)},ariaLabel:"Ползунок громкости",ariaValueMin:0,ariaValueMax:100,get ariaValueNow(){return ui(l)},get ariaValueText(){return ui(u)},get filledProgress(){return ui(C)},get handleProgress(){return ui(C)},get testId(){return ui(d)}}),ze(t),nt((e=>i=wr(t,1,"volumeBar s-29",null,i,e)),[()=>({"volumeBar-vertical":ui(k)})]),Ai(e,t)};Ji(U,(e=>{ui($)&&e(W)})),ze(z),nt((e=>q=wr(z,1,"volumeBar-container s-29",null,q,e)),[()=>({vertical:ui(k)})]),Si("mouseenter",z,(function(...e){(ui(k)?B:m.noop)?.apply(this,e)})),Si("mouseleave",z,(function(...e){(ui(k)?D:m.noop)?.apply(this,e)})),Si("wheel",z,(function(e){e.preventDefault(),e.deltaY<0?P():e.deltaY>0&&M()})),Ai(e,z),se(),s()}var Hu=_i('<path d="M4.58 13.98a1 1 0 0 1 .99-1h4.45a1 1 0 0 1 1 1v4.45a.99.99 0 0 1-1.99 0v-2.05L5.71 19.7a1 1 0 1 1-1.41-1.4l3.32-3.32H5.57a1 1 0 0 1-.99-1m10.39-6.36 3.32-3.32a1 1 0 1 1 1.41 1.4l-3.32 3.32h2.05a.99.99 0 0 1 0 1.98H14a1 1 0 0 1-1-1V5.57a.99.99 0 1 1 1.98 0z"></path>'),Uu=_i('<path d="M10.5 19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-4.5a1 1 0 0 1 2 0v2.07l3.36-3.36a1 1 0 0 1 1.42 0l.01.01a1 1 0 0 1 0 1.42L7.43 18H9.5a1 1 0 0 1 1 1M18 7.43l-3.36 3.36a1 1 0 0 1-1.42 0l-.01-.01a1 1 0 0 1 0-1.42L16.57 6H14.5a1 1 0 0 1 0-2H19a1 1 0 0 1 1 1v4.5a1 1 0 0 1-2 0z"></path>');function Wu(e,t){re(t,!0);let i=ms(t,"isFullscreen",3,!1),r=ms(t,"click",3,m.noop),s=Os(),a=s.ui.isFullscreenOpenedByKeyboard,n=s.ui.t,o=fe((()=>i()?n("tooltip_fullscreen_on"):n("tooltip_fullscreen_off")));Sl(e,{testId:"fullscreen-btn",get ariaLabel(){return ui(o)},click:e=>{let t=Un(e);a.set(t),r()()},get ariaKeyShortCut(){return ws},role:"button",children:(e,t)=>{!function(e,t){let i=ms(t,"isFullscreen",8,!1),r=me((()=>i()?"close-fullscreen-icon":"open-fullscreen-icon"));Ea(e,{get testId(){return ui(r)},children:(e,t)=>{var r=Ei(),s=Xe(r),a=e=>{Ai(e,Hu())},n=e=>{Ai(e,Uu())};Ji(s,(e=>{i()?e(a):e(n,!1)})),Ai(e,r)},$$slots:{default:!0}})}(e,{get isFullscreen(){return i()}})},$$slots:{default:!0}}),se()}var Qu=_i('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4.26 4.26C3 5.54 3 7.57 3 11.65v.72c0 4.07 0 6.11 1.26 7.38C5.54 21 7.57 21 11.65 21h.72c4.07 0 6.11 0 7.38-1.26C21 18.47 21 16.43 21 12.36v-.72c0-4.07 0-6.11-1.26-7.38C18.47 3 16.43 3 12.36 3h-.72C7.57 3 5.53 3 4.26 4.26M6 8.5c.1 4.68 2.56 7.5 6.61 7.5h.24v-2.68c1.47.15 2.57 1.25 3.02 2.68H18a6 6 0 0 0-3-3.76 5.7 5.7 0 0 0 2.55-3.74h-1.94c-.4 1.49-1.61 2.84-2.77 2.97V8.5h-1.96v5.2c-1.2-.3-2.76-1.76-2.83-5.2z" clip-rule="evenodd"></path></svg>');var Gu=_i('<svg><!><svg data-logo="vk_video"><path d="M7 8.6c0-1.96 0-2.94.38-3.69a3.5 3.5 0 0 1 1.53-1.53C9.66 3 10.64 3 12.6 3h1.36c2.46 0 3.7 0 4.64.48a4.4 4.4 0 0 1 1.92 1.92c.48.94.48 2.18.48 4.64v3.92c0 2.46 0 3.7-.48 4.64a4.4 4.4 0 0 1-1.92 1.92c-.94.48-2.18.48-4.64.48H12.6c-1.96 0-2.94 0-3.69-.38a3.5 3.5 0 0 1-1.53-1.53C7 18.34 7 17.36 7 15.4zm9.26 1.74c.9.54 1.36.81 1.51 1.16.13.3.13.65 0 .96-.15.34-.6.61-1.5 1.15l-2.4 1.43c-.93.56-1.4.84-1.8.8-.33-.03-.64-.2-.84-.48-.23-.31-.23-.86-.23-1.96v-2.85c0-1.1 0-1.64.23-1.96q.31-.42.85-.48c.38-.04.86.25 1.8.8zM5 9.04c0-2.46 0-3.7.48-4.64q.37-.71.95-1.25-.58.1-1.03.33A4.4 4.4 0 0 0 3.48 5.4C3 6.34 3 7.58 3 10.04v3.92c0 2.46 0 3.7.48 4.64a4.4 4.4 0 0 0 1.92 1.92q.45.23 1.03.33a4 4 0 0 1-.95-1.25C5 18.66 5 17.42 5 14.96z"></path></svg><svg x="4" y="3" data-logo="play_market"><path d="M0 1.26v15.47q0 .66.34 1L9.52 9 .33.28C.08.53 0 .92 0 1.26"></path><path d="M.33.28.38.23c.34-.3.89-.32 1.49 0l10.75 5.81-2.6 2.48zm10.29 8.75 2.88 2.45-.53.29-.34.18-2.58-2.44-9.71 8.22c.33.34.9.37 1.53.04l11.1-6 .53-.29 2.73-1.47c1.03-.56 1.03-1.47 0-2.02l-2.77-1.5-.84-.45.84.45.1.05z"></path></svg><svg x="3" data-logo="app_store"><path d="M17.62 16.37q-.48 1.09-1.15 2.03-.9 1.27-1.48 1.75-.88.8-1.9.83-.72 0-1.76-.42a5 5 0 0 0-1.89-.4q-.9 0-1.94.4a5 5 0 0 1-1.68.44q-.98.04-1.95-.85-.62-.53-1.55-1.82a13 13 0 0 1-1.63-3.2 12 12 0 0 1-.69-3.8q0-2.1.93-3.64A5.4 5.4 0 0 1 5.5 5.03q.77 0 2.03.46t1.62.47q.26 0 1.79-.55a6 6 0 0 1 2.43-.42 5.2 5.2 0 0 1 4.05 2.09q-2.4 1.44-2.4 4.02a4.4 4.4 0 0 0 1.49 3.34q.66.61 1.48.95-.18.5-.38.98M13.5.42q0 1.58-1.17 2.94c-.94 1.08-2.07 1.7-3.3 1.6L9 4.56c0-1 .45-2.08 1.24-2.96q.6-.67 1.5-1.12.93-.44 1.74-.48z"></path></svg><path d="M32.55 17.04h2.5L38.7 7h-1.8l-2.94 8.28h-.28L30.84 7H29zm15.52 0-4.61-5.2L47.72 7H45.6l-3.56 4.09h-.42V7h-1.7v10.04h1.7v-4.3h.43l3.76 4.3z"></path><path d="M57.89 11.89a2.2 2.2 0 0 0 1.44-2.16C59.33 8.14 58 7 56.06 7h-3.92v10.04h4.2c1.96 0 3.29-1.14 3.29-2.8 0-1.17-.66-2.04-1.74-2.35m-4.04-3.4h2.21c.92 0 1.54.56 1.54 1.39 0 .8-.62 1.36-1.54 1.36h-2.2zm2.5 7.06h-2.5v-2.81h2.5c.9 0 1.52.57 1.52 1.4 0 .84-.62 1.4-1.52 1.4m4.84 1.5h2.32l2.77-5.5h.22v5.5h1.57v-7.4h-2.32l-2.77 5.5h-.22v-5.5h-1.57zm7.96 2.21h1.64v-2.2h5.33v2.2h1.64v-3.7h-1.29V9.64h-5.43l-.37 3.78c-.13 1.34-.53 2.13-1.34 2.13h-.18zm2.49-3.7c.4-.39.57-1.04.68-2.15l.23-2.27h2.28v4.42zm14.38-2.3a3.7 3.7 0 0 0-3.84-3.76 3.7 3.7 0 0 0-3.85 3.85 3.7 3.7 0 0 0 3.85 3.84c1.54 0 2.99-.72 3.55-2.13l-1.54-.26c-.36.53-1.04.9-1.91.9-1.26 0-2.09-.77-2.24-1.91H86zm-3.84-2.33c1.02 0 1.8.65 2.06 1.58h-4.1a2.1 2.1 0 0 1 2.04-1.58m8.66 6.26c2.32 0 3.96-1.6 3.96-3.84 0-2.25-1.64-3.85-3.96-3.85s-3.97 1.6-3.97 3.85 1.64 3.84 3.97 3.84m0-1.5c-1.34 0-2.25-.95-2.25-2.34 0-1.4.9-2.35 2.25-2.35 1.34 0 2.25.95 2.25 2.35s-.91 2.35-2.25 2.35" class="_ru"></path><path d="M35.02 17.36h-2.48L29 7.42h1.83l2.83 8.2h.28l2.93-8.2h1.8zm8.41-5.15 4.6 5.15h-2.24l-3.75-4.26h-.43v4.26h-1.7V7.42h1.7v4.05h.41l3.55-4.05h2.1zm13.37 5.15h-2.48L50.8 7.42h1.83l2.82 8.2h.29l2.92-8.2h1.8zm6.46 0h-1.64v-7.33h1.64zm-.81-8.37q-.45 0-.74-.27a1 1 0 0 1-.28-.72q0-.44.28-.72.3-.28.74-.28t.72.28q.3.29.29.72 0 .44-.29.72t-.72.27m5.93 8.51q-1.03 0-1.86-.48a3.5 3.5 0 0 1-1.29-1.35 4 4 0 0 1-.45-1.98q0-1.1.45-1.95.46-.88 1.3-1.36.81-.5 1.85-.5.9 0 1.6.38.68.35 1.13.88V7.42h1.63v9.94h-1.22l-.34-1.18q-.46.54-1.17.94a3.4 3.4 0 0 1-1.63.38m.4-1.45q1.04 0 1.68-.65.65-.66.65-1.7t-.65-1.7a2.2 2.2 0 0 0-1.68-.66 2.2 2.2 0 0 0-1.66.66q-.64.66-.64 1.7t.64 1.7q.64.65 1.66.65m13.15-2.44-.03.52h-5.94q.12.86.71 1.38.6.51 1.52.51.63 0 1.13-.24.51-.24.78-.65l1.53.26q-.39 1.01-1.38 1.56-.96.55-2.16.55-1.1 0-1.98-.48a3.6 3.6 0 0 1-1.85-3.33q0-1.1.48-1.95.5-.88 1.37-1.36a4 4 0 0 1 1.98-.5q1.11 0 1.98.5.88.48 1.36 1.34.5.86.5 1.89m-3.84-2.31q-.73 0-1.29.42-.53.42-.74 1.14h4.1a2.2 2.2 0 0 0-2.07-1.56m8.66 6.2q-1.14 0-2.04-.48a3.7 3.7 0 0 1-1.4-1.35 4 4 0 0 1-.5-1.98q0-1.1.5-1.95.5-.88 1.4-1.36.9-.5 2.04-.5t2.03.5q.91.48 1.4 1.36.52.86.52 1.95 0 1.11-.51 1.98-.5.86-1.4 1.35-.9.48-2.04.48m0-1.48q.99 0 1.62-.63.63-.66.63-1.7t-.63-1.67a2.2 2.2 0 0 0-1.62-.65q-.99 0-1.62.65-.62.63-.62 1.67 0 1.05.62 1.7.63.63 1.62.63" class="_en"></path></svg>');var Ku={hash:"s-2a",code:"svg [data-logo],svg[data-testid=vk-video-logo-icon--en] ._ru,svg[data-testid=vk-video-logo-icon--short] ._en,svg[data-testid=vk-video-logo-icon--short] ._ru,svg[data-testid=vk-video-logo-icon] ._en{opacity:0;visibility:hidden}svg[data-logo=app_store] [data-logo=app_store],svg[data-logo=play_market] [data-logo=play_market],svg[data-logo=vk_video] [data-logo=vk_video]{opacity:1;visibility:visible}"};function Yu(e,t){re(t,!0),fr(e,Ku);let i=ms(t,"short",3,!1),r=ms(t,"isCyrillic",3,!0),s=ms(t,"logo",19,(()=>"vk_video")),a=fe((()=>r()||i()?i()?24:95:91)),n=fe((()=>r()||i()?i()?"vk-video-logo-icon--short":"vk-video-logo-icon":"vk-video-logo-icon--en")),o=fe((()=>`0 0 ${ui(a)} 24`));(function(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=Gu();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"95",height:"24",fill:"var(--btn-color, #fff)","fill-rule":"evenodd","aria-hidden":"true","clip-rule":"evenodd",viewBox:"0 0 95 24",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(6),ze(r),Ai(e,r)})(e,{get width(){return ui(a)},height:"24",get viewBox(){return ui(o)},get"data-testid"(){return ui(n)},get"data-logo"(){return s()}}),se()}function Xu(e,t){re(t,!0);let[i,r]=us(),s=()=>ls(d,"$currentGridType$",i),a=ms(t,"ref",15,void 0),n=ms(t,"logoClickable",3,!1),o=ms(t,"targetUrl",3,""),l=ys(),u=Os(),d=u.ui.currentGridType$,c=u.ui.isMobile,h=u.ui.t,p=u.isCyrillicRelatedInterface$,f=fe((()=>"vk"!==l.logoType)),m=fe((()=>ui(f)?h("tooltip_vk_video_logo"):h("tooltip_vk_logo"))),g=fe((()=>(ls(c,"$isMobile",i)&&Ou(s(),"m")||Ou(s(),"l"))&&ui(f))),v=fe((()=>!n())),b=fe((()=>ui(f)?"btn-vk-video-logo":"btn-vk-logo"));Sl(e,{className:"btn-full-opacity",get disabled(){return ui(v)},click:()=>{t.click(),u.callbacks?.onLogoClicked?u.callbacks?.onLogoClicked():o()&&window.open(o(),"_blank")},get testId(){return ui(b)},get ariaLabel(){return ui(m)},get ref(){return a()},set ref(e){a(e)},children:(e,t)=>{var r=Ei(),s=Xe(r),a=e=>{Yu(e,{get logo(){return l.logoType},get short(){return ui(g)},get isCyrillic(){return ls(p,"$isCyrillicRelatedInterface$",i)}})},n=e=>{!function(e,t){let i=cs(t,["$$slots","$$events","$$legacy","children"]);var r=Qu();Mr(r,(()=>({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"vk-logo-icon",role:"img",...i}))),Gi(Ye(r),(()=>t.children??V)),qe(),ze(r),Ai(e,r)}(e,{})};Ji(s,(e=>{ui(f)?e(a):e(n,!1)})),Ai(e,r)},$$slots:{default:!0}}),se(),r()}var Ju=_i('<path d="M3.6 13.3a5.1 5.1 0 0 1 5.05 5.83.9.9 0 0 1-1.78-.26 3.3 3.3 0 0 0-3.74-3.74.9.9 0 0 1-.26-1.78c.24-.03.49-.05.73-.05Z" class="s-z"></path><path d="M3.6 9.7a8.7 8.7 0 0 1 8.68 9.37.9.9 0 0 1-1.8-.14c.02-.17.02-.35.02-.53a6.9 6.9 0 0 0-7.43-6.88.9.9 0 0 1-.14-1.8l.67-.02ZM3.6 16.9a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z" class="s-z"></path><path d="M16.24 4.1c.8 0 1.47 0 2 .04a4 4 0 0 1 1.53.38 3.9 3.9 0 0 1 1.7 1.71 4 4 0 0 1 .39 1.53c.04.53.04 1.2.04 2v4.48c0 .8 0 1.47-.04 2a4 4 0 0 1-.38 1.53 3.9 3.9 0 0 1-1.7 1.7 4 4 0 0 1-1.54.39c-.53.04-1.2.04-2 .04H15a.9.9 0 0 1 0-1.8h1.2c.85 0 1.44 0 1.9-.04.44-.03.68-.1.85-.19.4-.2.72-.52.92-.92.09-.17.16-.4.2-.85.03-.46.03-1.05.03-1.9V9.8c0-.85 0-1.44-.04-1.9-.03-.44-.1-.68-.19-.85a2.1 2.1 0 0 0-.92-.92 2.25 2.25 0 0 0-.85-.2 25.9 25.9 0 0 0-1.9-.03H5.83a2.1 2.1 0 0 0-1.81 1.4.9.9 0 1 1-1.7-.6A3.9 3.9 0 0 1 6 4.1h10.24Z" class="s-z"></path>',1),Zu=_i('<path d="M3.60219 13.2993C6.41858 13.2995 8.70256 15.5835 8.70278 18.3999C8.70277 18.6469 8.68424 18.8909 8.65004 19.1294C8.57937 19.6212 8.12333 19.9625 7.63149 19.8921C7.13968 19.8213 6.79823 19.3654 6.86879 18.8735C6.89087 18.7195 6.90199 18.5611 6.902 18.3999C6.90178 16.5776 5.42447 15.1003 3.60219 15.1001C3.441 15.1001 3.28267 15.1112 3.12856 15.1333C2.63666 15.2039 2.18077 14.8624 2.11 14.3706C2.03966 13.8788 2.38091 13.4227 2.8727 13.3521C3.11125 13.3178 3.35516 13.2993 3.60219 13.2993Z"></path><path d="M3.60219 9.69971C8.40682 9.69977 12.3021 13.5953 12.3024 18.3999C12.3024 18.6248 12.2938 18.8489 12.277 19.0698C12.239 19.5651 11.8065 19.9365 11.3112 19.8989C10.8157 19.8611 10.4445 19.4286 10.4821 18.9331C10.4954 18.7576 10.5026 18.5791 10.5026 18.3999C10.5023 14.5894 7.41271 11.5005 3.60219 11.5005C3.42268 11.5005 3.24474 11.5066 3.06899 11.52C2.57352 11.5578 2.14115 11.1863 2.10317 10.6909C2.06587 10.1957 2.43694 9.76287 2.93227 9.7251C3.15348 9.70823 3.37699 9.69971 3.60219 9.69971Z"></path><path d="M3.60219 16.8999C4.43047 16.8999 5.10198 17.5717 5.10219 18.3999C5.10209 19.2282 4.43054 19.8999 3.60219 19.8999C2.77383 19.8999 2.10229 19.2282 2.10219 18.3999C2.10241 17.5717 2.7739 16.8999 3.60219 16.8999Z"></path><path d="M16.2379 4.1001C17.0459 4.10009 17.7067 4.10017 18.2438 4.14404C18.7997 4.18946 19.3022 4.28599 19.7711 4.5249C20.5049 4.89882 21.1014 5.49623 21.4752 6.22998C21.714 6.69873 21.8107 7.20063 21.8561 7.75635C21.9 8.29338 21.9001 8.95424 21.9 9.76221V14.2378C21.9001 15.0458 21.9 15.7066 21.8561 16.2437C21.8107 16.7996 21.7141 17.3021 21.4752 17.771C21.1014 18.5046 20.5048 19.1012 19.7711 19.4751C19.3022 19.714 18.7997 19.8105 18.2438 19.856C17.7067 19.8998 17.0459 19.8999 16.2379 19.8999H14.9997C14.503 19.8996 14.1005 19.4972 14.1002 19.0005C14.1002 18.5036 14.5028 18.1004 14.9997 18.1001H16.1998C17.0548 18.1001 17.6422 18.0992 18.0973 18.062C18.5419 18.0257 18.7809 17.9596 18.9538 17.8716C19.3489 17.6702 19.6704 17.3487 19.8717 16.9536C19.9598 16.7808 20.0258 16.5417 20.0622 16.0972C20.0993 15.6421 20.1002 15.0546 20.1002 14.1997V9.80029C20.1002 8.94536 20.0993 8.35794 20.0622 7.90283C20.0258 7.45834 19.9598 7.21921 19.8717 7.04639C19.6704 6.6514 19.3487 6.33073 18.9538 6.12939C18.7809 6.04133 18.5419 5.97431 18.0973 5.93799C17.6422 5.9008 17.0548 5.8999 16.1998 5.8999H6.00063L5.83071 5.90674C4.99191 5.97398 4.28981 6.53462 4.01918 7.30029C3.85342 7.76872 3.33928 8.01472 2.87075 7.84912C2.40214 7.68346 2.15628 7.16833 2.32192 6.69971C2.85696 5.18632 4.30125 4.1001 6.00063 4.1001H16.2379Z"></path><path d="M2.95114 7.11345C2.42394 7.1914 1.90399 6.78569 2.00995 6.2634C2.05777 6.0277 2.12517 5.82449 2.22018 5.63803C2.5078 5.07354 2.96674 4.6146 3.53123 4.32698C4.17296 4 5.01304 4 6.6932 4H17.2001C18.8803 4 19.7204 4 20.3621 4.32698C20.9266 4.6146 21.3855 5.07354 21.6731 5.63803C22.0001 6.27976 22.0001 7.11984 22.0001 8.8V15.2C22.0001 16.8802 22.0001 17.7202 21.6731 18.362C21.3855 18.9265 20.9266 19.3854 20.3621 19.673C19.7204 20 18.8803 20 17.2001 20H15.7196C15.2009 20 14.8203 19.5134 14.8938 19C14.9638 18.5101 15.0001 18.0093 15.0001 17.5C15.0001 11.701 10.2991 7 4.5001 7C3.97384 7 3.45662 7.03872 2.95114 7.11345Z"></path>',1),ed={hash:"s-z",code:".animated.s-z{animation-duration:1s;animation-iteration-count:infinite}.wave1.animated.s-z{animation-name:s-z-wave1}.wave2.animated.s-z{animation-name:s-z-wave2}.wave3.animated.s-z{animation-name:s-z-wave3}@keyframes s-z-wave1{0%{opacity:.3}33%{opacity:1}66%{opacity:1}to{opacity:1}}@keyframes s-z-wave2{0%{opacity:.3}33%{opacity:.3}66%{opacity:1}to{opacity:1}}@keyframes s-z-wave3{0%{opacity:.3}33%{opacity:.3}66%{opacity:.3}to{opacity:1}}"};function td(e,t){re(t,!0),fr(e,ed);let i=ms(t,"isMobile",3,!1),r=fe((()=>t.iconState===f.ChromecastState.CONNECTED)),s=fe((()=>t.iconState===f.ChromecastState.CONNECTING)),a=fe((()=>ui(r)?"#2688EB":Ta)),n=fe((()=>t.size?Qo(t.size):void 0));var o=Ei(),l=Xe(o),u=e=>{Ea(e,{get fill(){return ui(a)},get style(){return ui(n)},testId:"chromecast-mobile-icon",children:(e,t)=>{var i=Ju();qe(2),Ai(e,i)},$$slots:{default:!0}})},d=e=>{Ea(e,{get style(){return ui(n)},testId:"chromecast-icon",children:(e,t)=>{var i=Zu(),a=Xe(i);let n;var o=Je(a);let l;var u=Je(o);let d;var c=Je(u);let h;var p=Je(c);let f;nt(((e,t,i,r,s)=>{n=wr(a,0,"wave2 s-z",null,n,e),l=wr(o,0,"wave3 s-z",null,l,t),d=wr(u,0,"wave1 s-z",null,d,i),h=wr(c,0,"s-z",null,h,r),f=wr(p,0,"s-z",null,f,s)}),[()=>({animated:ui(s)}),()=>({animated:ui(s)}),()=>({animated:ui(s)}),()=>({hidden:ui(r)}),()=>({hidden:!ui(r)})]),Ai(e,i)},$$slots:{default:!0}})};Ji(l,(e=>{i()?e(u):e(d,!1)})),Ai(e,o),se()}function id(e,t){re(t,!0);let i=ms(t,"ref",15,void 0),r=ms(t,"isMobile",3,!1),s=ms(t,"click",3,m.noop),a=Os().ui.t,n=fe((()=>t.state===f.ChromecastState.CONNECTED?a("tooltip_chromecast_on"):a("tooltip_chromecast_off")));Sl(e,{get ariaLabel(){return ui(n)},get click(){return s()},testId:"btn-chromecast",get ref(){return i()},set ref(e){i(e)},children:(e,i)=>{td(e,{get isMobile(){return r()},get iconState(){return t.state}})},$$slots:{default:!0}}),se()}var rd=_i('<path d="m21.62 16.5-.02.07q-.22 1.27-.42 2.09a5 5 0 0 1-.64 1.5 4.4 4.4 0 0 1-2.51 1.73q-.77.18-1.63.07t-2.11-.34l-4.34-.8q-1.27-.22-2.1-.42a5 5 0 0 1-1.5-.65 4.4 4.4 0 0 1-1.72-2.5 5 5 0 0 1-.07-1.63q.1-.84.34-2.11l.01-.07q.22-1.27.43-2.1a5 5 0 0 1 .64-1.5 4.4 4.4 0 0 1 2.5-1.73 5 5 0 0 1 1.64-.07q.83.1 2.1.35l4.34.8q1.28.21 2.1.42a5 5 0 0 1 1.5.64 4.4 4.4 0 0 1 1.73 2.5q.18.78.07 1.64-.1.83-.34 2.1m-1.45-2.3c.05-.49.03-.77-.02-1a2.6 2.6 0 0 0-1.02-1.48 3 3 0 0 0-.93-.37c-.48-.13-1.1-.24-2-.4l-4.26-.79c-.9-.16-1.52-.27-2.01-.33a3 3 0 0 0-1 .03 2.6 2.6 0 0 0-1.48 1.02 3 3 0 0 0-.37.92c-.13.48-.24 1.1-.4 2s-.28 1.51-.33 2c-.06.5-.04.78.02 1 .15.6.51 1.13 1.02 1.48.19.13.45.25.92.37.48.13 1.1.25 2 .4l4.27.79c.9.16 1.52.28 2.01.33s.77.03 1-.02a2.6 2.6 0 0 0 1.47-1.03c.14-.19.25-.45.38-.92.12-.48.24-1.1.4-2s.28-1.51.33-2"></path><path d="M18.19 7.49a.9.9 0 0 1-1.05-.73c-.14-.8-.2-1.08-.28-1.3A2.6 2.6 0 0 0 14.5 3.8c-.22 0-.5.04-1.31.17l-5.85.96a8 8 0 0 0-2.17.5 2.6 2.6 0 0 0-1.33 1.75c-.08.38-.04.85.11 2.23l.01.1a.9.9 0 1 1-1.78.2l-.01-.1-.02-.17a9 9 0 0 1-.07-2.64 4.4 4.4 0 0 1 2.25-2.97c.63-.33 1.42-.46 2.56-.65l.16-.03 5.85-.96.1-.01c.67-.11 1.13-.19 1.55-.18a4.4 4.4 0 0 1 4 2.82c.14.39.23.85.35 1.53l.01.1a.9.9 0 0 1-.72 1.04"></path><path d="M12.72 12.41a.42.42 0 0 0-.69.23l-.72 4.18a.4.4 0 0 0 .03.23c.08.2.33.3.54.22l3.67-1.47a.4.4 0 0 0 .12-.68z"></path>',1);var sd=(e,t,i)=>i.filter((i=>i.time<=e*t)).pop(),ad=Ti('<span class="text mobile s-22"> </span> <div class="chevron-episodes s-22" data-testid="btn-episodes_icon"><!></div>',1),nd=Ti('<span class="text s-22"> </span>'),od=Ti('<span class="text count s-22"> </span>'),ld=Ti('<span class="icon s-22"><!></span> <!>',1),ud={hash:"s-22",code:".icon.s-22{flex-shrink:0}.text.s-22{overflow:hidden;padding:0 8px;text-overflow:ellipsis;white-space:nowrap}.text.count.s-22{overflow:visible}.text.mobile.s-22{padding:0 3px 0 4px}.chevron-episodes.s-22{margin-bottom:-6px;opacity:.7;transform:scale(.8)}"};function dd(e,t){re(t,!0),fr(e,ud);let[i,r]=us(),s=()=>ls(p,"$currentGridType$",i),a=()=>ls(g,"$panelOpened$",i),n=()=>ls(v,"$isMobile",i),o=ms(t,"position",3,0),l=ms(t,"duration",3,0),u=ms(t,"timeCodes",19,(()=>[])),d=Os(),c=d.callbacks?.onEpisodeChanged??m.noop,h=!!d.callbacks?.onEpisodeClicked,p=d.ui.currentGridType$,f=d.ui.episodes.openedByKeyboard$,g=d.ui.episodes.panelOpened$,v=d.ui.isMobile,b=d.ui.t,y=ke(void 0),S=e=>{if(d.callbacks?.onEpisodeClicked){let t=Un(e);f.set(t),g.set(!0),d.callbacks?.onEpisodeClicked?.(t)}},w=ke(null),$=fe((()=>o()/l()));rt((()=>{let e=sd(ui($),l(),u());e?ui(w)?.time!==e.time&&(c(e),_e(w,e,!0)):_e(w,null)}));let x=fe((()=>ui(w)?.text||"")),k=fe((()=>Du(s(),"xl")?"FULL":Du(s(),"m")?"COUNT":"SHORT")),T=fe((()=>`${b("tooltip_episodes")}: ${ui(x)}`));rt((()=>{(async(e,t,i)=>{await li(),"false"===e?.getAttribute("aria-expanded")&&t&&!i&&di((()=>{f.set(!1),e.focus()}))})(ui(y),ls(f,"$openedByKeyboard$",i),a())}));var _=Ei(),C=Xe(_),E=e=>{let t=fe((()=>n()?"px-0":"")),i=fe((()=>!h));Sl(e,{get className(){return`w-max btn-full-opacity btn-jc-l ${ui(t)??""}`},testId:"btn-episodes",click:S,get disabled(){return ui(i)},get ariaExpanded(){return a()},get ariaLabel(){return ui(T)},get ref(){return ui(y)},set ref(e){_e(y,e,!0)},children:(e,t)=>{var i=Ei(),r=Xe(i),s=e=>{var t=ad(),i=Xe(t),r=Ye(i,!0);ze(i);var s=Je(i,2);cn(Ye(s),{direction:"right"}),ze(s),nt((()=>ji(r,ui(x)))),Ai(e,t)},a=e=>{var t=ld(),i=Xe(t);(function(e){Ea(e,{testId:"episodes-icon",children:(e,t)=>{var i=rd();qe(2),Ai(e,i)},$$slots:{default:!0}})})(Ye(i)),ze(i);var r=Je(i,2),s=e=>{var t=nd(),i=Ye(t,!0);ze(t),nt((()=>ji(i,ui(x)))),Ai(e,t)},a=(e,t)=>{var i=e=>{var t=od(),i=Ye(t,!0);ze(t),nt((()=>ji(i,u().length))),Ai(e,t)};Ji(e,(e=>{"COUNT"===ui(k)&&e(i)}),t)};Ji(r,(e=>{"FULL"===ui(k)?e(s):e(a,!1)})),Ai(e,t)};Ji(r,(e=>{n()?e(s):e(a,!1)})),Ai(e,i)},$$slots:{default:!0}})};Ji(C,(e=>{ui(w)&&e(E)})),Ai(e,_),se(),r()}var cd,hd,pd,fd=class{init(e,t,i){this.actions=e,this.adsState=t,this.playerState=i}onAdmanLoadingError(){this.onAdError("adman loading error")}async initAdman(e){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init","already inited: "+!!this.adman],numbers:[(0,m.now)(),e.slotId]}),this.adman)return;this.events.init$.next(e.slotId),this.startWatchDog();let{width:t,height:i,isAutoplay:r,adsContainer:s,adsVideoElement:a,slotId:n,params:o={},paramsOverride:l={},duration:u,externalApi:d}=e;this.externalApi=d;let c,h=this.playerState&&as(this.playerState.vsid);h&&(c=this.isVsidOriginal?h:parseInt(h,36));let{isEmbed:p,immediateOrigin:f}=(0,m.detectEmbed)(),g=(p?f:window.location.href)??window.location.href,v={...o,dl:encodeURIComponent(g),autoplay:r?1:0,player_width:t,player_height:i,...c?{request_id:c}:{},duration:u,...l};v=Object.fromEntries(Object.entries(v).filter((([e,t])=>(0,m.isNonNullable)(t))));let b={slot:n,wrapper:s,videoEl:a,videoQuality:i,params:v,browser:{mobile:!1}};try{let e=new window.AdmanHTML;if(e.onReady(this.onAdsReady),e.onStarted(this.onAdStarted),e.onPlayed(this.onAdPlayed),e.onPaused(this.onAdPaused),e.adMidrollPoint(this.onAdMidrollPoint),e.onClosed(this.onAdClosed),e.onSkipped(this.onAdSkipped),e.onClicked(this.onAdClicked),e.onTimeRemained(this.onAdTimeRemained),e.onCompleted(this.onAdCompleted),e.onError(this.onAdError),e.setDebug(!1),this.externalApi?.videoGetAds){let e=await this.safeExternalCall(this.externalApi.videoGetAds,v);e&&(delete b.slot,delete b.params,Object.assign(b,{json:e}))}e.init(b),this.adman=e,this.videoElement=a,this.events.slotRequested$.next(),this.log({message:`adman init, config: ${JSON.stringify(b)}`})}catch(e){m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_threw",String(e)],numbers:[(0,m.now)()]}),this.onAdError("could not init adman")}}switchToVideo(e=!1){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_switch_to_video",this.currentAdSection??"","force: "+e],numbers:[(0,m.now)()]}),null===this.currentAdSection&&!e)return void this.log({message:"switch to video, no currentAdSection. can't switch"});let t="postroll"===this.currentAdSection;if(this.actions){if(this.adsState&&this.playerState)this.adsState.playbackState.set("inactive"),this.currentAdSection=null,this.log({message:`switch to video, isPostroll: ${t}`});else{let e="Switch to video: Adman state was not updated correctly";this.log({message:e}),this.events.error$.next(e)}this.actions.switchFromAdsToVideo?.(!t)}}setPostrollPassed(e){this.adsState?.postrollPassed.set(e),this.log({message:"postroll passed"})}togglePlay(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_toggle_play",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adsState){this.log({message:"toggle play"});let e=as(this.adsState.playbackState);"playing"===e?this.pause():"paused"===e&&this.play()}else this.onAdError("Can not toggle play: Adman state is not initialized")}setInitialVolume(e){this.log({message:`set initial volume ${e}`}),this.initialVolume=e}setVolume(e){let t=e*this.volumeMultiplier;if(this.log({message:`set volume ${t}`}),this.adman)try{this.adman.setVolume(t)}catch{this.onAdError("could not set ad volume")}this.videoElement&&(this.videoElement.volume=t)}setFullscreen(e){if(this.log({message:`set fullscreen ${e}`}),this.adman)try{this.adman.setFullscreen(e)}catch{this.onAdError("could not set ad fullscreen")}}startPreroll(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_start_preroll"],numbers:[(0,m.now)()]}),this.adman){if(!this.isDestroyed){this.log({message:"start preroll"}),this.setVolume(this.initialVolume),this.currentAdSection="preroll",this.startWatchDog();try{this.adman.start("preroll")}catch{this.onAdError("could not start preroll")}}}else this.onAdError("Can not start preroll: Adman is not initialized")}startPostroll(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_start_postroll",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman&&this.actions){this.log({message:"start postroll"}),this.actions.switchFromVideoToAds(),this.currentAdSection="postroll",this.startWatchDog();try{this.adman.start("postroll")}catch{this.onAdError("could not start postroll")}}else this.onAdError("Can not start postroll: Adman is not initialized")}startWatchDog(){this.watchDogTimeout&&this.stopWatchDog(),this.watchDogTimeout=window.setTimeout((()=>this.onAdError("Watchdog timeout")),this.runtimeTimeout)}stopWatchDog(){clearTimeout(this.watchDogTimeout)}play(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_pplay",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.log({message:"ad play"}),this.startWatchDog();try{this.adman.resume(),this.events.resumed$.next()}catch{this.onAdError("could not resume ad")}}else this.onAdError("Can not play: Adman is not initialized")}pause(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_pause",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.stopWatchDog(),this.log({message:"ad pause"});try{this.adman.pause(),this.events.paused$.next()}catch{this.onAdError("could not pause ad")}}else this.onAdError("Can not pause: Adman is not initialized")}skip(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_skip",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.stopWatchDog(),this.log({message:"ad skip"});try{this.adman.skip(),this.events.skipped$.next()}catch{this.onAdError("could not skip ad")}}else this.onAdError("Can not skip: Adman is not initialized")}setPosition(e,t){this.adman?.setPosition(Math.floor(e),Math.floor(t))}destroy(){m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_destroy"],numbers:[(0,m.now)()]}),this.log({message:"destroy"}),this.stopWatchDog(),this.adman?.onReady(void 0),this.adman?.onStarted(void 0),this.adman?.onPlayed(void 0),this.adman?.onPaused(void 0),this.adman?.adMidrollPoint(void 0),this.adman?.onClosed(void 0),this.adman?.onSkipped(void 0),this.adman?.onClicked(void 0),this.adman?.onTimeRemained(void 0),this.adman?.onCompleted(void 0),this.adman?.onError(void 0),this.adman?.destroy(),this.videoElement&&(0,m.clearVideoElement)(this.videoElement),this.isDestroyed=!0}async safeExternalCall(e,...t){try{return await e(...t)}catch(e){return this.onAdError(e?.message??"External call failed"),null}}constructor(e,t){this.adman=null,this.initialVolume=1,this.videoElement=null,this.currentAdSection=null,this.actions=null,this.adsState=null,this.playerState=null,this.events={init$:new m.Subject,loadStarted$:new m.Subject,loadEnded$:new m.Subject,loadError$:new m.Subject,ready$:new m.Subject,slotRequested$:new m.Subject,started$:new m.Subject,timeRemained$:new m.Subject,paused$:new m.Subject,resumed$:new m.Subject,ended$:new m.Subject,empty$:new m.Subject,skipped$:new m.Subject,clicked$:new m.Subject,closed$:new m.Subject,error$:new m.Subject},this.loadAdman=e=>(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_start",this.useAdmanFromNPM?"npm":"http"],numbers:[(0,m.now)()]}),this.useAdmanFromNPM?this.loadAdmanNPM(e):this.loadAdmanMailRu(e)),this.loadAdmanMailRu=e=>new Promise(((t,r)=>{let s;this.events.loadStarted$.next();let a=()=>{clearTimeout(s),delete window.admanAsyncInit,window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_async_init_done","http"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_timed_out","http"],numbers:[(0,m.now)()]}),r())};(0,m.addScript)("//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",e,this.loadTimeout).then((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_script_loaded","http"],numbers:[(0,m.now)()]}),window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_already_inited","http"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_wait_async_init","http"],numbers:[(0,m.now)()]}),i._dG("admanAsyncInit",a),s=window.setTimeout(a,this.initTimeout))})).catch((e=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_script_load_error","http",String(e)],numbers:[(0,m.now)()]}),r(),clearTimeout(s)}))})),this.loadAdmanNPM=e=>new Promise(((t,r)=>{let s;this.events.loadStarted$.next();let a=()=>{clearTimeout(s),delete window.admanAsyncInit,window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_done","npm"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_timed_out","npm"],numbers:[(0,m.now)()]}),r())},n=()=>{o=!0,r()},o=!1,l=window.setTimeout((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_timed_out","npm"],numbers:[(0,m.now)()]}),n()}),this.loadTimeout);e.addEventListener("abort",n),e.aborted&&(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_aborted","npm"],numbers:[(0,m.now)()]}),n()),i._dG("AdmanHTML",window.AdmanHTML||null),Promise.all([i.e(25153),i.e("langs/web/25153")]).then(i.t.bind(i,25153,19)).then((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_chunk_imorted","npm","failed: "+String(o)],numbers:[(0,m.now)()]}),!o&&(window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_already_inited","npm"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_wait_async_init","npm"],numbers:[(0,m.now)()]}),i._dG("admanAsyncInit",a),s=window.setTimeout(a,this.initTimeout)))}),n).finally((()=>{clearTimeout(s),clearTimeout(l),e.removeEventListener("abort",n)}))})),this.onAdsReady=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_ready"],numbers:[(0,m.now)()]}),this.log({message:"ads ready"}),this.events.ready$.next(),this.startPreroll()},this.onAdStarted=(e,t)=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_started",e,"muted: "+t.muted],numbers:[(0,m.now)(),t.bannerID]}),this.adsState&&this.playerState&&this.actions?(this.log({message:`ad started, section: ${e}, banner: ${JSON.stringify(t)}`}),this.events.started$.next(e),t.muted&&(this.setVolume(0),this.actions.setMuted(!0),this.log({message:"ad muted start"})),this.adsState.duration.set(t.duration),this.adsState.playbackState.set("playing"),this.adsState.canSkip.set(t.allowClose),this.adsState.secondsToWatchBeforeSkip.set(t.allowCloseDelay),this.startWatchDog(),this.externalApi?.videoTrackAdEvent&&this.safeExternalCall(this.externalApi.videoTrackAdEvent,e,String(t.bannerID))):this.onAdError("Started callback failed: Adman is not initialized")},this.onAdTimeRemained=e=>{"inactive"!==(this.adsState?.playbackState?as(this.adsState.playbackState):void 0)&&(this.adsState?(this.adsState.position.set(e.currentTime),this.events.timeRemained$.next(e),this.startWatchDog()):this.onAdError("TimeRemained callback failed: Adman state is not initialized"))},this.onAdPaused=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_pased",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.stopWatchDog(),this.adsState?(this.log({message:"ad paused"}),this.adsState.playbackState.set("paused")):this.onAdError("Paused callback failed: Adman state is not initialized")},this.onAdPlayed=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_played",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.startWatchDog(),this.adsState?(this.log({message:"ad played"}),this.adsState.playbackState.set("playing")):this.onAdError("Player callback failed: Adman is not initialized")},this.onAdMidrollPoint=()=>{if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_midroll_pioint"],numbers:[(0,m.now)()]}),this.adman&&this.actions){this.log({message:"midroll point"}),this.actions.switchFromVideoToAds(),this.currentAdSection="midroll",this.startWatchDog();try{this.adman.start("midroll")}catch{this.onAdError("could not start midroll")}}else this.onAdError("Midroll callback failed: Adman is not initialized")},this.onAdSkipped=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_skipped",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad skipped"}),this.stopWatchDog()},this.onAdClosed=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_closed",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad closed"}),this.currentAdSection&&this.events.closed$.next(this.currentAdSection),this.stopWatchDog(),this.switchToVideo()},this.onAdCompleted=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_completed",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad completed"}),this.currentAdSection?(this.events.ended$.next(this.currentAdSection),"postroll"===this.currentAdSection&&this.setPostrollPassed(!0)):this.events.empty$.next(),this.switchToVideo(),this.stopWatchDog()},this.onAdClicked=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_clicked",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad clicked"}),this.videoElement?.pause(),this.currentAdSection&&this.events.clicked$.next(this.currentAdSection),this.stopWatchDog()},this.onAdError=(e="ad error")=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_error",e],numbers:[(0,m.now)()]}),this.log({message:e}),this.events.error$.next(e),"postroll"===this.currentAdSection&&this.setPostrollPassed(!0),this.switchToVideo(!0),this.stopWatchDog()},this.log=e.createComponentLog("AdmanWrapper"),m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_created"],numbers:[(0,m.now)()]}),this.loadTimeout=t.loadTimeout,this.initTimeout=t.initTimeout,this.runtimeTimeout=t.runtimeTimeout,this.useAdmanFromNPM=t.useAdmanFromNPM,this.volumeMultiplier=Math.max(0,Math.min(t.volumeMultiplier,1)),this.isVsidOriginal=t.isVsidOriginal}},md=e=>{let t=Math.round(e);return isNaN(t)||t<40?"":t>=40&&t<55?50:t>=55&&t<90?60:t>=90&&t<180?120:t>=180?240:""},gd=class{parse(e){let t={startTime:0,endTime:0},i=this.timingRegExp.exec(e);return i&&(t.startTime=this.calcTime(i[1],i[2],i[3],i[4]),t.endTime=this.calcTime(i[6],i[7],i[8],i[9])),t}parseTime(e){let t=this.timeRegExp.exec(e);return t?this.calcTime(t[1],t[2],t[3],t[4]):0}isTime(e){return this.timeRegExp.test(e)}calcTime(e="0",t="0",i="0",r="0"){return 60*Number(e)*60+60*Number(t)+Number(i)+ +`0.${r}`}constructor(){this.timeRegExp=/(\d{2,})?:?(\d{2}):(\d{2}).(\d{2,3})/,this.timingRegExp=new RegExp(`${this.timeRegExp.source}( ?--\x3e ?)${this.timeRegExp.source}`)}},vd=class{parse(e){let t={texts:[]},i=e.replace(new RegExp(this.letterTagRegExp,"g"),"").split({[Symbol.split](e){let t=0,i=[];for(;t<e.length;){let r=["<",">"].reduce(((i,r)=>{let s=e.indexOf(r,t);return-1===i||i>s?s:i}),-1);if(-1===r){i.push(e.substring(t));break}i.push(e.substring(t,r)),t=r+1}return i}}),r=new gd;for(let e of i)r.isTime(e)?t.texts.push({type:"timestamp",value:r.parseTime(e)}):t.texts.push({type:"text",value:e});return t}constructor(){this.letterTagRegExp=/<[a-z]*>|<\/[a-z]*>/}},bd=class{parse(e,t){let i=[],r=e.split(this.twoLinesRegExp);for(let e of r){let r={startTime:0,endTime:0,texts:[],lang:t},s=e.split(this.oneLineRegExp);for(let e of s)if(r.startTime||r.endTime){if(""!==e.trim()){let t=new vd,{texts:i}=t.parse(e);r.texts=[...r.texts,...i]}}else{let t=new gd,{startTime:i,endTime:s}=t.parse(e);r.startTime=i,r.endTime=s}(r.startTime||r.endTime)&&r.texts.length>0&&i.push(r)}return i}constructor(){this.oneLineRegExp=/\r\n|\n|\r/,this.twoLinesRegExp=/\r\n\r\n|\n\n|\r\r/}},yd=0,Sd=!1,wd="",$d=(e,t=0,i=0)=>e<t&&e<i,xd=(e,t=0,i=0)=>e>=t&&e<=i,kd={ru:"Русский",en:"English",uk:"Українська",be:"Беларуская (тарашкевiца)",es:"Español",fi:"Suomi",de:"Deutsch",it:"Italiano",bg:"Български",hr:"Hrvatski",hu:"Magyar",sr:"Српски",pt:"Português",el:"Ελληνικά",pl:"Polski",fr:"Français",ko:"한국어","zh-CN":"汉语",lt:"Lietuvių",ja:"日本語",cs:"Čeština",et:"Eesti",tt:"Татарча",ba:"Башҡортса",cv:"Чăвашла",sk:"Slovenčina",ro:"Română",no:"Norsk",lv:"Latviešu",az:"Azərbaycan dili",hy:"Հայերեն",sv:"Svenska",nl:"Nederlands",tk:"Türkmen",ka:"ქართული",da:"Dansk",uz:"O‘zbek",th:"ภาษาไทย",id:"Bahasa Indonesia",tg:"Тоҷикӣ",sl:"Slovenščina",bs:"Bosanski","pt-BR":"Português brasileiro",fa:"فارسی",vi:"Tiếng Việt",hi:"हिन्दी",si:"සිංහල",bn:"বাংলা",tl:"Tagalog",mn:"Монгол",my:"ဗမာစာ",tr:"Türkçe",ne:"नेपाली",ur:"اردو",ky:"Кыргыз тили",pa:"پنجابی",os:"Ирон",kn:"ಕನ್ನಡ",sw:"Kiswahili",kk:"Қазақша",ar:"العربية",he:"עברית",ab:"Аҧсшәа",eu:"Euskara",eo:"Esperanto"},Td={abk:"as",ara:"ar",aze:"az",bak:"ba",bel:"be",ben:"bn",bos:"bs",bul:"bg",ces:"cs",chv:"cv",dan:"da",deu:"de",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",fas:"fa",fin:"fi",fra:"fr",heb:"he",hin:"hi",hrv:"hr",hun:"hu",hye:"hy",ind:"id",ita:"it",jpn:"ja",kan:"kn",kat:"ka",kaz:"kk",kir:"ky",kor:"ko",lav:"lv",lit:"lt",mon:"mn",mya:"my",nep:"ne",nld:"nl",nor:"no",oss:"os",pan:"pa",pol:"pl",por:"pt",ron:"ro",rus:"ru",sin:"si",slk:"sk",slv:"sl",spa:"es",srp:"sr",swa:"sw",swe:"sv",tat:"tt",tgk:"tg",tgl:"tl",tha:"th",tuk:"tk",tur:"tr",ukr:"uk",urd:"ur",uzb:"uz",vie:"vi"},_d=e=>kd[e]??kd[Td[e]]??void 0,Cd=class{destroy(){this.oneStat?.destroy(),this.thinOneStat?.destroy(),this.mediascopePixel?.destroy(),this.statSubscription.unsubscribe()}constructor(e,t,i,r=new m.Subscription){this.oneStat=e,this.thinOneStat=t,this.mediascopePixel=i,this.statSubscription=r}},Ed=((pd=Ed||{}).DESKTOP_CONTROL_PANEL_LEFT="desktop-control-panel-left",pd.DESKTOP_CONTROL_PANEL_RIGHT="desktop-control-panel-right",pd),Ad=e=>e??0,Ld=(e,t)=>{let i=e?.getBoundingClientRect?.(),r=t?.getBoundingClientRect?.();return{top:Math.round(Ad(i?.top)-Ad(r?.top)),left:Math.round(Ad(i?.left)-Ad(r?.left)),bottom:Math.round(Ad(i?.bottom)-Ad(r?.top)),right:Math.round(Ad(i?.right)-Ad(r?.left))}},Pd=e=>{let t=e?.getBoundingClientRect?.();return{width:Ad(t?.width),height:Ad(t?.height)}},Md="off",Id=e=>!!(Math.round(Math.abs(e)/90)%2),Rd=({interfaceLanguage:e,isCyrillicRelatedInterface:t,videoId:i,isClip:r,isLiveCatchUpMode:s,statAuthToken:a,isAudioDisabled:n,canDownload:o,callbacks:l,webApi:u,videoEpisodes:d,previewThumbsData:c,uiConfig:h,coreConfig:p,player:v,disabledControls:b,isInteractive:y,interactiveRanges$:S,isInteractiveTime$:w,replayInteractive:$,stopPlayer:x,hasInteractiveBranches:k,playPrevChapterDisabledTooltip:T,additionalButtons:_,additionalSettingsMenuItems:C,additionalContextMenuItems:E,playPrevVideo:A,playNextVideo:L,onVideoChanged:P,looped:M=!1,statistics:I,saveRate:R,internalsExposure:V,playerView:N,playerId:B})=>{let D={...p,configName:[...p.configName??[],"ui"],isAudioDisabled:n,live:{...p.live??{},isLiveCatchUpMode:!!s}},O=h,F=m.TracerFactory.createRootTracer(O.features.tracer),j=F.createComponentTracer("Store"),z=v||new f.Player(D,F,{playerId:B,onDevNullLog:l?.onDevNullLog});V?.expose({corePlayer:z});let q,H,U=new m.Logger,W=new fd(U,{loadTimeout:O.ads.loadTimeout,initTimeout:O.ads.initTimeout,runtimeTimeout:O.ads.runtimeTimeout,useAdmanFromNPM:O.ads.useAdmanFromNPM,volumeMultiplier:O.ads.volumeMultiplier,isVsidOriginal:O.ads.isVsidOriginal}),Q=Ja.getInstance(),G=u?.pictureInPictureApi,K=u?.annotationsApi,Y=u?.slotsApi,X=u?.focusManager,J=U.createComponentLog("Store"),Z={},ee=new qs,te=new m.Subscription,ie="",re=rs(!1),se=I&&I.oneStat?js(I.oneStat.vsid$):is(void 0),ae=rs(sn()),ne=rs(!1),oe=G?.info.isActive$??new m.ValueSubject(!1),le=rs(0),ue=rs(!1),de=rs(!1),ce=rs([]),he=(0,m.merge)(z.events.fatalError$,z.events.managedError$).subscribe((e=>ce.update((t=>[...t,e])))),pe=is(!1,(e=>{let t=z.events.fatalError$.subscribe((()=>e(!0)));return()=>t.unsubscribe()})),fe=async e=>{let t=Object.values(m.InterfaceLanguage).includes(e);if(O.downloadVKLanguages&&(t&&O.updateBuiltinLanguages||!Na(e))){let t;try{t=await(0,m.loadVKLangPack)(e,"videoplayer","videoplayer")}catch(e){I?.oneStat?.logError({errorType:"VKLangPack",fatal:!1}),Q?.report(e,{errorType:"VKLangPack",fatal:!1})}t&&(Va({language:e,pack:t,fallback:O.defaultLanguage}),me.set(e),ge.update((e=>e+1)))}Na(e)&&me.set(e)},me=rs(e),ge=rs(0),ve=rs(t);fe(e);let be=(e,t)=>{let i=as(me);return Ba(i,e,t,O.defaultLanguage)},ye=rs("thumb");ye.subscribe((e=>{"ads"===e&&z.info.playbackState$.getValue()&&$e()}));let Se=(()=>{let e=ss([pe,ye],(([e,t])=>e?"crashed":t));return{...e,is:t=>as(e)===t}})(),we=rs(),$e=()=>{we.set({muted:z.info.muted$.getValue()})},xe=(()=>{let e=rs(new Set(b));return{...e,add:t=>{e.update((e=>new Set([...e].concat(t))))},remove:t=>{e.update((e=>{let i=[...e];return new Set(Array.isArray(t)?i.filter((e=>!t.includes(e))):i.filter((e=>e!==t)))}))},includes:t=>{let i=as(e);return Array.isArray(t)?t.every((e=>i.has(e))):i.has(t)}}})(),ke=rs({width:0,height:0}),Te=null,_e=z.info.isBuffering$,Ce=is(_e.getValue(),(e=>{let t=_e.subscribe((t=>{t&&null===Te?Te=window.setTimeout((()=>{e(_e.getValue()),Te=null}),O.loaderDelay):e(t)}));return()=>{t.unsubscribe(),Te&&clearTimeout(Te)}}));j.log("create store"),J({message:"create store"});let Ee=new m.Subject,Ae=new m.Subject,Le=new m.Subject,Pe=new m.Subject,Me=null,Ie={actionRewind$:Ae,actionSeek$:Le,inPiP$:oe,inFullscreen$:new m.Observable((e=>ae.subscribe((t=>e.next(t))))),actionSetSubtitle$:Pe,nextMovie$:Ee},Re=new m.Subject,Ve=new m.Subject,Ne={actionSeek$:Le,actionSubtitlesSwitched$:Re,actionQuality$:Ve,playerSize$:new m.Observable((e=>ke.subscribe((t=>e.next(t))))),inPiP$:oe,inFullscreen$:new m.Observable((e=>ae.subscribe((t=>e.next(t))))),isLoaderVisible$:new m.Observable((e=>Ce.subscribe((t=>e.next(t)))))};if(I){let{oneStat:e,thinOneStat:t,mediascopePixel:i,statSubscription:r}=I;e&&(y||r.add(e.attachTo(z)),r.add(e.attachToUi(Ie)),r.add(e.attachToAds(W.events)),e.authorize(a).catch((e=>{J({message:`onestat auth error ${String(e)}`})})),i&&i.attachTo(z)),t&&(r.add(t.attachTo(z,W.events)),r.add(t.attachToUi(Ne)),r.add(t.attachToAds(W.events)),t.updateContext({isMobile:as(re)}),t.authorize(a))}if(Q){let e=new m.Subscription,t=(t,i)=>e.add(t.subscribe(i));if(t(z.events.managedError$,(e=>{Q.logIError(e)})),t(z.events.fatalError$,(e=>{Q.logIError(e,!0)})),I){let{oneStat:e}=I;e&&t(e.experimental.error$,(e=>{Q.logIError(e)}))}Q.sentrySubscription.add(e)}let Be=()=>{if(f.clientChecker.device.isIOS&&H)try{(e=>{let t=e;t?.webkitExitFullscreen&&t?.webkitExitFullscreen()})(H)}catch(e){J({message:`exitIosSafariFullscreen failed: ${e}`})}};te.add(z.experimental.element$.subscribe((e=>{e&&(H=e,e.classList.add("player-media"),ln(G)&&G.updateVideoElement(),y&&e.setAttribute("pip","false"),"preview"===N&&(e.setAttribute("disablePictureInPicture","true"),e.setAttribute("x-yandex-pip","false")))}))).add(z.events.ended$.subscribe((()=>{Be(),l?.onEnded?.()}))).add(z.events.looped$.subscribe((()=>{l?.onLooped?.()}))).add(z.events.started$.subscribe((async()=>{ln(G)&&await(G?.revealPictureInPicture());let e=z.info.muted$.getValue();l?.onStarted?.(),Z.onStarted?.(e)}))).add(z.events.willSeek$.subscribe((({from:e,to:t})=>{l?.onSeek?.(e,t)}))).add(z.events.autoplaySoundProhibited$.subscribe((()=>{l?.onAutoplaySoundProhibited?.()}))).add(z.info.position$.subscribe((e=>{let t=z.info.duration$.getValue();isFinite(t)&&t>0&&(l?.onTimeupdate?.(t,e),W.setPosition(e,t))}))).add(z.events.fatalError$.subscribe((e=>{l?.onCrashed?.(e?`${e.id}: ${e.message}`:void 0)}))).add(z.events.fetcherRecoverableError$.subscribe((e=>{l?.onRecoverableError?.(e?`${e.id}: ${e.message}`:void 0)}))).add(z.events.loadedMetadata$.subscribe((()=>{ue.set(!0)}))).add(z.info.is3DVideo$.subscribe((e=>{de.set(e)}))).add(z.info.isEnded$.subscribe((e=>{y&&(e?(w?.getValue()&&xe.add(Ps),xe.add("PLAY_BUTTON")):xe.remove("PLAY_BUTTON"))}))).add(z.info.liveTime$.subscribe((e=>{l?.onLiveTime?.(e)}))).add(z.info.isStalled$.subscribe((e=>{l?.onStalledChanged?.(e)}))).add(z.info.isLiveEnded$.subscribe((e=>e&&l?.onLiveEnded?.()))).add(W.events.loadStarted$.subscribe((()=>l?.adsInfo?.onLoadStarted?.()))).add(W.events.loadEnded$.subscribe((()=>l?.adsInfo?.onLoadEnded?.()))).add(W.events.loadError$.subscribe((()=>l?.adsInfo?.onLoadError?.()))).add(W.events.init$.subscribe((()=>l?.adsInfo?.onInit?.()))).add(W.events.ready$.subscribe((()=>l?.adsInfo?.onReady?.()))).add(W.events.started$.subscribe((e=>l?.adsInfo?.onStarted?.(e)))).add(W.events.timeRemained$.subscribe((e=>l?.adsInfo?.onTimeRemained?.(e)))).add(W.events.ended$.subscribe((e=>l?.adsInfo?.onCompleted?.(e)))).add(W.events.empty$.subscribe((()=>l?.adsInfo?.onEmpty?.()))).add(W.events.clicked$.subscribe((e=>l?.adsInfo?.onClicked?.(e)))).add(W.events.closed$.subscribe((e=>l?.adsInfo?.onClosed?.(e)))).add(W.events.error$.subscribe((e=>l?.adsInfo?.onError?.(e)))).add(W.events.paused$.subscribe((()=>l?.adsInfo?.onPaused?.()))).add(W.events.resumed$.subscribe((()=>l?.adsInfo?.onResumed?.())));let De=new m.Subscription,Oe=is(z.info.position$.getValue(),(e=>{let t,i,r=()=>{let s=z.info.playbackState$.getValue(),a=z.info.isLive$.getValue(),n=z.info.duration$.getValue(),o=z.info.position$.getValue();if(s&&[f.PlaybackState.PLAYING,f.PlaybackState.PAUSED].includes(s)){let t=a?o-n:z.getExactTime();t!==i&&e(t),i=t}t=requestAnimationFrame(r)};return r(),()=>cancelAnimationFrame(t)})),Fe=js(z.info.playbackState$),je=ss([Fe,js(z.info.isBuffering$)],(([e,t])=>t?"buffering":e)),ze=js(z.info.currentBuffer$),qe=js(z.info.isEnded$),He=js(z.info.isLive$),Ue=O.features.playbackRate?js(z.info.canChangePlaybackSpeed$):is(!1),We=js(z.info.liveBufferTime$),Qe=js(z.info.volume$),Ge=js(z.info.muted$),Ke=zs(z.info.predefinedQualityLimitType$.pipe((0,m.map)((e=>e===f.PredefinedQualityLimits.TRAFFIC_SAVING))),z.info.predefinedQualityLimitType$.getValue()===f.PredefinedQualityLimits.TRAFFIC_SAVING),Ye=zs(z.info.predefinedQualityLimitType$.pipe((0,m.map)((e=>e===f.PredefinedQualityLimits.HIGH_QUALITY))),z.info.predefinedQualityLimitType$.getValue()===f.PredefinedQualityLimits.HIGH_QUALITY),Xe=js(z.info.autoQualityLimitingAvailable$),Je=js(z.info.availableQualities$),Ze=js(z.info.availableQualitiesFps$),et=js(z.info.chromecastState$),tt=js(z.info.chromecastDeviceName$),it=js(z.info.currentFormat$),rt=js(z.info.throughputEstimation$),st=js(z.info.videoBitrate$),at=js(z.info.intrinsicVideoSize$),nt=js(z.info.duration$),ot=js(z.info.isAudioAvailable$),lt=ss([nt,He],(([e,t])=>t?-e:e)),ut=ss([Fe],(([e])=>e===f.PlaybackState.PLAYING)),dt=js(z.info.atLiveEdge$),ct=js(z.info.atLiveDurationEdge$),ht=js(z.info.position$),pt=ss([ht,nt],(([e,t])=>isFinite(e)&&isFinite(t)&&!!t)),ft=ss([et],(([e])=>e===f.ChromecastState.CONNECTED)),mt=js(z.info.availableVideoStreams$),gt=O.features.audioLanguages?js(z.info.availableAudioStreams$):is([]),vt=js(z.info.currentVideoStream$),bt=js(z.info.currentAudioStream$),yt=(e,t)=>{z.setAudioStream(e),Qt(t)&&(e.language&&pa(e.language),O.features.userVideoPrefs&&i&&ka(O.userSalt,String(i),{audioTrackId:e.id}))},St=e=>{let t;if(1===e.length&&(t=e.at(0)),t??(t=e.find((e=>"isDefault"in e&&e.isDefault))),O.features.userVideoPrefs&&i){let r=xa(O.userSalt,String(i));r?.audioTrackId&&(t=e.find((e=>e.id===r.audioTrackId))??t)}let r=m.safeStorage.get(Ys);return r&&(t??(t=e.find((({language:e})=>r===e)))),t??(t=e.at(0)),t},wt=!1;te.add(z.info.availableAudioStreams$.subscribe((e=>{if(!wt&&e.length){let t=St(e);t&&(z.setAudioStream(t),wt=!0)}}))),gt.subscribe((e=>{l?.onAvailableAudioStreamsChanged?.(e.map((({label:e="",id:t="",language:i=""})=>({label:e,language:i,id:t}))))})),bt.subscribe((e=>e&&l?.onAudioStreamChanged?.(e.id)));let $t=!1;te.add(z.info.availableVideoStreams$.subscribe((e=>{if(!$t&&e.length){let t=St(e);t&&(z.setVideoStream(t),$t=!0)}})));let xt=rs(void 0),kt=js(z.info.isAutoQualityEnabled$,(e=>e&&xt.set(void 0))),Tt=js(z.info.currentQuality$,(()=>xt.set(void 0))),_t=ss([xt,Tt],(([e,t])=>e??t)),Ct=ss(it,(e=>e!==f.VideoFormat.MPEG)),Et=ss([Je,Ze,kt,_t,Ct],(([e,t,i,r,s])=>{let a=[];s&&a.push({value:"auto",displayValue:be("auto_quality_option"),selected:i});let n=e.filter((e=>!(0,m.isInvariantQuality)(e)));for(let e of n){let s=t[e];a.push({value:e,displayValue:`${e}${s?md(s):""}`,selected:!i&&e===r})}return a})),At=js(z.info.currentPlaybackRate$),Lt=ss([At,dt,ct],(([e,t,i])=>{let r=i||y?1:O.controls.playbackRateMin,s=t?1:O.controls.playbackRateMax,a=O.controls.playbackRateStep,n=[];for(let t=r;t<=s;t+=a)n.push({value:t,displayValue:1===t?be("playback_rate_1"):be("playback_rate",{multiplier:t.toString(10)}),selected:e===t});return n})),Pt=()=>({displayValue:be("subtitles_off"),value:Md,language:""}),Mt=rs(Pt()),It=ss([Mt,ge],(([e],t)=>{e.value===Md?t(Pt()):t(e)})),Rt=O.features.subtitles?js(z.info.availableTextTracks$):is([]),Vt=(()=>{let e=[],t=0;return{add:(i,r)=>{e[t]=[i,r],t=(t+1)%10},find:t=>e.find((([e])=>e===t))}})(),Nt=ss([Rt,It],(([e,t],i)=>{let r=[],s=e.find((({id:e})=>e===t.value));if(s?.url){let[,e]=Vt.find(s.url)??[];if(e)return void i(e);ee.download(s.url).then((e=>{if(!e||ee.isDestroyed())return;let a=new bd,n=s.language;if(n){let t=!!s.isAuto,i=a.parse(e,n);r.push({lang:n,subtitles:i,isAuto:t,id:s.id})}Vt.add(s.url,r),as(It).value===t.value&&i(r)})).catch((e=>{I?.oneStat?.logError({errorType:"Subtitles download",fatal:!1}),Q?.report(e,{errorType:"Subtitles download",fatal:!1})}))}i(r)})),Bt=ss([At,ut,It],(([e,t,i],r)=>{let s;if(z.info.isLive$.getValue()&&t&&i.value!==Md){let t=()=>{s=setTimeout(t,1e3/(3*e)),r(Date.now())};return t(),()=>clearTimeout(s)}})),Dt=ss([Rt,It],(([e,t])=>{if(!e.length)return[];let i=[];for(let{language:r,isAuto:s,id:a}of e){let e=r&&_d(r);r&&e&&i.push({displayValue:s?be("subtitles_auto",{language:e}):e,value:a,selected:t?.value===a,isAuto:s,language:r})}return i.length?(i.unshift({...Pt(),selected:t?.value===Md}),i):[]})),Ot={available:[],prev:[]},Ft=ss([Oe,It,Nt,Bt],(([e,t,i,r])=>{let s=z.info.isLive$.getValue();if(s&&Ot.prev!==i){let e=i.find((({id:e})=>e===t.value)),r=Ot.prev.find((({id:e})=>e===t.value));if(e){let t={...e,subtitles:[...r?.subtitles??[],...e.subtitles]};Ot.available=[t],Ot.prev=i}}if(t&&t.value!==Md){let r=s?z.experimental.getCurrentTime$.getValue()?.()??H?.currentTime??0:e,a=s?Ot.available:i;return((e,t,i,r=!1)=>{let s=i.find((({id:e})=>e===t.value))?.subtitles;if(r)return s?.find((({startTime:t,endTime:i})=>xd(e,t,i)));let a=e>=yd,n=e<yd;return yd=e,n&&(Sd=!1),(0,m.isNonNullable)(cd)&&xd(e,cd.startTime,cd.endTime)&&wd===t.value?cd:(0,m.isNonNullable)(hd)||!s?.length||Sd?xd(e,hd?.startTime,hd?.endTime)?(cd=hd,hd=void 0,wd=t.value,cd):void((a&&((e,t=0,i=0)=>e>t&&e>i)(e,hd?.startTime,hd?.endTime)||n&&$d(e,hd?.startTime,hd?.endTime))&&(hd=void 0)):(hd=s.find((({startTime:t,endTime:i})=>xd(e,t,i)||a&&$d(e,t,i))),cd=void 0,void(!(0,m.isNonNullable)(hd)&&s[s.length-1].endTime<e&&(Sd=!0)))})(r,t,a,s)}})),jt=ss([Ft],(([e])=>e?.texts?e.texts:[]));te.add(It.subscribe((e=>{if(e.value===Md)l?.onSubtitleOff?.();else{let t=Object.entries(kd).find((([t,i])=>i===e.displayValue));l?.onSubtitleOn?.(t?t[0]:"",e.value)}})));let zt=rs(!0),qt=ss([ze,lt,ht,We],(([e,t,i,r])=>{let s=e?.end??0;return r?(s-(-i+r-t))/t:s/t})),Ht=js(z.info.availableSources$),Ut=ss([Ht],(([e])=>Object.keys(e?.[f.VideoFormat.MPEG]||{}).length>0)),Wt=()=>{let e=Math.max(O.volumeMinRestore,sa()??0);return 0===e?O.volumeDefault:e},Qt=e=>{let t=O.features.savePreferredStatesOnUserActionOnly;return!t||t&&!e},Gt=(e,t)=>{let i=0===e?Wt():e,r=z.info.muted$.getValue();J({message:`set volume, volume: ${e}, preferredVolume: ${i}`});let s=!n||Se.is("ads");r&&e>0&&s&&(r=!1,Qt(t)&&da(!1)),z.setVolume(e,r),W.setVolume(e),Qt(t)&&ra(i)},Kt=(e,t)=>{let i=z.info.volume$.getValue();J({message:`set muted, currentVolume: ${i}, mute: ${e}`});let r=Se.is("ads");if(z.setMuted(e,r),W.setVolume(e?0:i),Qt(t)&&(!r||!e)&&da(e),!e&&0===i){let e=Wt();z.setVolume(e),Qt(t)&&ra(e),W.setVolume(e)}},Yt=rs(!1),Xt=e=>{j.log("set looped",{isLooped:e}),Yt.set(e),z.setLooped(e),l?.uiInfo?.onLoopedChanged?.(e)};Xt(M);let Jt=(e,{changeReason:t="default",appliesTo:r="to-video",byUser:s=!1}={},a)=>{J({message:`set quality, quality: ${e}`}),j.log("set quality",{quality:e}),s&&Ve.next(e),z.setAutoQuality("auto"===e);let{qualityDetailsSubMenuEnabled:n}=O.features;na(),"auto"!==e?(n?(ba({type:"exact_quality",quality:e,videoId:i},r),z.setPredefinedQualityLimits(f.PredefinedQualityLimits.UNKNOWN)):aa(i,e),xt.set(e),z.setQuality(e)):n&&"default"===t&&(ii("auto_quality",r,a),as(Ke)&&Zt(!1,void 0,a),as(Ye)&&ei(!1,void 0,a))},Zt=(e,t="as-default",i)=>{J({message:`set trafficSavingEnabled, value: ${e}`}),j.log("set traffic saving enabled",{trafficSavingEnabled:e});let r=e?f.PredefinedQualityLimits.TRAFFIC_SAVING:f.PredefinedQualityLimits.UNKNOWN;O.features.qualityDetailsSubMenuEnabled?(ti(r,t,i),ca(!1)):(z.setPredefinedQualityLimits(r),Qt(i)&&ca(e))},ei=(e,t="as-default",i)=>{J({message:`set highQualityEnabled, value: ${e}`}),j.log("set high quality enabled",{highQualityEnabled:e}),ti(e?f.PredefinedQualityLimits.HIGH_QUALITY:f.PredefinedQualityLimits.UNKNOWN,t,i)},ti=(e,t,i)=>{e!==f.PredefinedQualityLimits.UNKNOWN&&(as(Xe)&&!as(kt)&&Jt("auto",{appliesTo:t,changeReason:"limit-changed"},i),ii(e,t,i)),z.setPredefinedQualityLimits(e)},ii=(e,t,r)=>{Qt(r)&&(ba({type:e,videoId:i},t),"as-default"===t&&ba({type:e,videoId:i},"to-video"))},ri=(e,t=!0)=>{j.log("set playback rate",{playbackRate:e}),z.setPlaybackRate(e),O.features.saveRate&&R&&!z.info.isLive$.getValue()&&t&&(e=>{m.safeStorage.set(Xs,JSON.stringify({rate:e}))})(e)},si=(e={...Pt(),selected:!1},t)=>{j.log("set subtitles",{...e}),e.value!==Md&&Pe.next(e.isAuto?e.value+"_auto":e.value),Re.next({enabled:e.value!==Md,lang:e.language,auto:!!e.isAuto}),Mt.set(e),Qt(t)&&(ma(e.value===Md?void 0:e.language),O.features.userVideoPrefs&&i&&ka(O.userSalt,String(i),{subtitleTrackId:e.value===Md?void 0:e.value}))},ai=e=>{j.log("toggle subtitles"),as(It)?.value===Md?ni(e):oi(e)},ni=(e,t)=>{j.log("subtitle on");let i,r=as(Dt),s=as(me),a=ie??s;t&&(i=r.find((e=>e.value===t))),i??(i=r.filter((e=>e.value!==Md)).find((e=>e.language===a))),si(i??r[1],e)},oi=e=>{j.log("subtitle off"),si(void 0,e)};te.add(z.info.availableTextTracks$.subscribe((e=>{l?.onAvailableSubtitlesChanged?.(function(){let t=[];for(let{language:i,isAuto:r,id:s}of e){let e=i&&_d(i);i&&e&&t.push({id:s,language:i,title:r?be("subtitles_auto",{language:e}):e})}return t}())})));let li=rs(!0),ui=e=>{li.set(e)},di=(e,t,i=!0)=>{if(J({message:`seek to time, time: ${e}`}),j.log("seek to time",{time:e,action:t,forcePrecise:i}),Le.next(t),z.info.isLive$.getValue()){let t=z.info.duration$.getValue(),r=Math.min(0,t+e);z.seekTime(r,i)}else{if(w?.getValue())return;z.info.isEnded$.getValue()&&(J({message:"seek after ended, call callbacks.onPlay"}),l?.onPlay?.()),z.seekTime(Wi(e),i)}},ci=(e,t,i=!1)=>{J({message:`seek to percent, percent: ${e}`}),j.log("seek to percent",{percent:e,action:t});let r=as(lt)*e;di(r,t,i)},hi=rs(!1),pi=rs(!1),fi=ss([lt],(([e])=>!!c&&e>=O.suitableDurationForUsingRichSeek&&O.features.useRichSeek&&!y)),mi=(c?.frameWidth||0)>=(c?.frameHeight||0),gi=ss([le],(([e])=>{let t=Id(e);return mi?!t:t}));te.add(Se.subscribe((e=>{"video"!==e&&hi.set(!1)})));let vi,bi,yi=rs(void 0),Si=rs(!1),wi=e=>{yi.set(e)},$i=()=>{yi.set(void 0),Si.set(!1)},xi=()=>{clearTimeout(bi),clearTimeout(vi),vi=window.setTimeout((()=>{$i()}),500),H?.removeEventListener("seeked",xi)},ki=ss([Oe,lt,yi],(([e,t,i],r)=>{r((0,m.isNonNullable)(i)?i*t:e)})),Ti=rs(!1),_i=ss([ke],(([{width:e}],t)=>{let i=(e=>e>699?"xl":e>599?"l":e>509?"m":e>320?"s":"xs")(e);t(i)})),Ci=_.filter((e=>(e=>!e.type)(e))),Ei=ss([_i,re],(([e,t])=>t?Ci.filter((e=>!e.hideOnMobile)):Ci.filter((t=>!t.hideOnDesktopGridTypes?.includes(e))))),Ai=rs(_.filter((e=>(e=>!!e.type)(e)))),Li=ss([Ai,_i],(([e,t])=>e.filter((e=>!e.hideOnDesktopGridTypes?.includes(t))))),Pi=ss([Li,Ei],(([e,t])=>[...O.features.additionalButtonsDesktopControlPanelRight?e.filter((e=>"desktop-control-panel-right"===e.type)):[],...O.features.additionalButtons?t.map(((e,t)=>({id:t,weight:t,type:"desktop-control-panel-right",testId:e.testId,icon:e.iconUrl,onClick:e.onClick,ariaLabel:e.ariaLabel??e.tooltip,tooltipText:e.tooltip}))):[]])),Mi=rs(C),Ii=ss([Mi],(([e])=>O.features.additionalSettingsMenuItems?e.map((e=>"SWITCH"===e.type?{...e,onClick:e.onChangeEnabled}:e)):[])),Ri=rs(E),Vi=ss([Ri],(([e])=>O.features.additionalContextMenuItems?e:[])),Ni=ss([re,pe],(([e,t],i)=>{i(e&&t)})),Bi=()=>H,Di=e=>{if((0,m.assertNonNullable)(Ji),z.info.isEnded$.getValue())return;let t=!e;if("ads"===as(Ji.playerPhase))return J({message:`pause ads, internalCall: ${t}`}),j.log("pause ads",{internalCall:t}),void W.pause();J({message:`pause video, internalCall: ${t}`}),j.log("pause video",{internalCall:t}),t&&l?.onPause?.(),z.pause()},Oi=e=>{(0,m.assertNonNullable)(Ji);let t=!e;if("ads"===as(Ji.playerPhase))return J({message:`play ads, internalCall: ${t}`}),j.log("play ads",{internalCall:t}),void W.play();J({message:`play video, internalCall: ${t}`}),j.log("play video",{internalCall:t}),t&&l?.onPlay?.(),z.play()},Fi=(e,t)=>{(0,m.assertNonNullable)(Ji),J({message:`first start, show ads: ${e}, internalCall: ${!t}`}),j.log("first start",{showAds:e,external:t}),e?ye.set("ads"):(ye.set("video"),t?z.play():Ji.actions.internal.togglePlay())},ji=()=>(J({message:"getting time codes"}),d),zi=()=>{let e=ji();if(!e||[0,1].includes(e.length))return;let t=z.info.position$.getValue();return e.find((e=>e.time>t))},qi=()=>{let e=ji();if(!e||[0,1].includes(e.length))return;let t=z.info.position$.getValue(),i=e.findIndex((e=>e.time>t)),r=-1===i?e.length-2:i-2;return r<0?void 0:e[r]},Hi=rs([]);S?.subscribe((e=>{let t=[];for(let i=0;i<e.length;i++){let{range:[r,s],subjects:a}=e[i];0===i&&0!==r&&t.push({time:0,text:"",interactive:!1,completed:!0}),t.push({time:r/1e3,text:"",interactive:!0,completed:O.features.interactiveTimeOpenUri?!a.length||a.every((e=>e.isRemoved)):!a.length}),s!==1/0&&t.push({time:s/1e3,text:"",interactive:!1,completed:!0})}Hi.set(t)}));let Ui=rs(!1);w?.subscribe((e=>{e&&as(Si)&&$i()}));let Wi=e=>{if(!y)return e;let t=as(Hi),i=as(lt),r=as(ht)/i,s=t.find((e=>e.interactive&&!e.completed&&e.time>r));return"number"==typeof s?.time?Math.min(e,s.time-.05):e},Qi=ss([dt,Se,Ue],(([e,t,i])=>h.features.doubleForwardAvailable&&!e&&"video"===t&&i)),Gi=rs(!1),Ki=null,Yi=e=>{if(!as(ut)&&e)return;let t=z.info.currentPlaybackRate$.getValue();e?2!==t&&(Ki=t,ri(2,!1),Gi.set(!0)):(Ki&&ri(Ki,!1),Gi.set(!1),Ki=null)};Se.subscribe((e=>{"video"!==e&&Yi(!1)}));let Xi=!1;z.events.playing$.subscribe((()=>{as(hi)&&Di(!1)}));let Ji={interfaceLanguage$:me,isCyrillicRelatedInterface$:ve,initVideo:e=>{J({message:`init video, config: ${JSON.stringify(e)}`}),y?(e=>{let t=e.container,i=()=>{Me=new MutationObserver((e=>{let{removedNodes:i}=e[0];i.length&&t.append(z.experimental.element$.getValue())})),Me.observe(t,{childList:!0})},r=z.experimental.element$.getValue();if(r)t.append(r),i();else{let e=z.experimental.element$.pipe((0,m.filter)((e=>!!e)),(0,m.once)()).subscribe((e=>{t.append(e),i()}));te.add(e)}})(e):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","core_init_video"],numbers:[(0,m.now)()]}),z.initVideo(e)),j.log("init video",{isInteractive:y}),e.subtitles&&z.setExternalTextTracks(e.subtitles),q=e,ie=e.subtitlesForcedLanguage||""},videoId:i,isClip:r,playerPhase:Se,vsid:se,state:{positionExact$:Oe,positionWithScrubbing$:ki,duration$:lt,playbackState$:Fe,playbackStateRealistic$:je,isPlaying$:ut,isLoaderVisible:Ce,bufferedProgress$:qt,isLive$:He,canChangePlaybackSpeed$:Ue,isActiveLive$:dt,isOldestAvailableLive$:ct,isRewindableLive$:pt,isEnded$:qe,muted$:Ge,volume$:Qe,trafficSavingEnabled$:Ke,highQualityEnabled$:Ye,autoQualityLimitingAvailable$:Xe,availableVideoStreams$:mt,availableAudioStreams$:gt,videoStream$:vt,audioStream$:bt,currentQuality$:_t,isAutoQualityEnabled$:kt,availableQualities$:Et,currentPlaybackRate$:At,availablePlaybackRates$:Lt,currentSubtitle$:It,availableTextTracks$:Rt,availableSubtitlesList$:Dt,currentSubtitleCaptions$:jt,isAutoSubtitleCaptionVisible$:zt,chromecastState$:et,chromecastDeviceName$:tt,chromecastConnected$:ft,currentFormat$:it,throughputEstimation$:rt,videoBitrate$:st,videoSize$:at,errorLog$:ce,crashed$:pe,isAudioAvailable$:ot,isAudioDisabled:!!n,canDownload:O.features.download&&!!o,availableSources$:Ht,hasMpegSources$:Ut,isInteractive:y,showInteractiveGraph:O.features.interactiveGraph,showSeekToInteractive:O.features.seekToInteractive,showPlayPrevChapter:O.features.interactivePlayPrevChapter,showInteractiveTimeIndicator:O.features.interactiveTimeIndicator&&!!as(Hi).length,interactiveEpisodes$:Hi,isInteractiveTime$:w?js(w):rs(!1),isInteractiveExpectation$:Ui,hasInteractiveBranches:k,playPrevChapterDisabledTooltip:T,looped$:Yt,loadedMetadata$:ue,isAutoQualityAvailable$:Ct,previewTrackActive:hi,previewTrackDragInProgress:pi},ui:{t:be,controlsVisible:rs(!1),touched:rs(!1),controls:{prevButton:rs(void 0),playButton:rs(void 0),replayButton:rs(void 0),nextButton:rs(void 0),playPrevChapterButton:rs(void 0),seekToInteractiveButton:rs(void 0),interactiveGraphButton:rs(void 0),liveButton:rs(void 0),time:rs(void 0),episodes:rs(void 0),volume:rs(void 0),subtitles:rs(void 0),settings:rs(void 0),context:rs(void 0),chromecast:rs(void 0),pip:rs(void 0),fullscreen:rs(void 0),vkLogo:rs(void 0),interactiveTimeIndicator:rs(void 0),timeline:rs(void 0),autoplayNextToggle:rs(void 0),additionalButtons:_.length?_.reduce((e=>[...e,rs(void 0)]),[]):[],disabledControls$:xe},modals:{hotKeyMap:{show:rs(!1),data:rs({title:"",closeBtnText:"",groups:[]})}},isFullscreen:ae,isFullscreenOpenedByKeyboard:ne,rotateAlpha:le,isAutoplay:rs(!1),debugPanelVisible:rs(!1),episodes:{panelOpened$:rs(!1),openedByKeyboard$:rs(!1)},contextMenu:{visible$:rs(!1),btnRef$:rs(void 0),openedByBtnKeyboard$:rs(!1),openedByHotKey$:rs(!1),lastActiveElem$:rs(void 0),showContextMenuBtn$:rs(!1),position$:rs({top:0,left:0})},playerSize:ke,isMobile:re,mobileNotReportControlHidden$:Ni,icon3DVideoVisible:rs(!1),scrubbingInProgress:Si,volumeChangingInProgress:Ti,is3DVideo:de,currentGridType$:_i,additionalButtonsDeprecated$:Ei,additionalDesktopControlPanelRightButtons$:Pi,additionalSettingsMenuItems$:Ii,additionalContextMenuItems$:Vi,interactiveHideMobileControls:rs(!1),overlayContainer$:rs(void 0),startedByKeyboard$:rs(!1),autoplayNextEnabled$:rs(!1),timerNextVideoRunning$:rs(!0),settingsMenu:{visible$:rs(!1),ref$:rs(void 0),openedByBtnKeyboard$:rs(!1)},settingsSubMenu:{visible$:rs(!1),ref$:rs(void 0),name$:rs(void 0)},userActionsDisabled:rs(!1),hiddenControls:{volume:rs(!1),vkLogo:rs(!1),pip:rs(!1),chromecast:rs(!1),settings:rs(!1)},isControlsAvailable:li,controlBlocks:{topLeft:rs(void 0),topRight:rs(void 0),middle:rs(void 0),bottom:rs(void 0),bottomLeft:rs(void 0),bottomRight:rs(void 0)},videoTitleInfo:rs(void 0),doubleForwardOn$:Gi,doubleForwardAvailable$:Qi,previewTrackNotificationVisible:rs(!1),previewTrackActive:hi,previewTrackDragInProgress:pi,previewTrackAvailable:fi,isPreviewTrackHorizontallyAligned:gi},ads:{position:rs(0),duration:rs(0),playbackState:rs("inactive"),canSkip:rs(!1),secondsToWatchBeforeSkip:rs(0),postrollPassed:rs(!1)},webApi:{pictureInPictureApi:G,annotationsApi:K,slotsApi:Y,focusManager:X},actions:{internal:{preload:()=>{z.prepare()},firstStart:e=>Fi(e,!1),play:()=>Oi(!1),pause:()=>Di(!1),togglePlay:()=>{(0,m.assertNonNullable)(Ji);let e=as(Ji.ui.controls.disabledControls$),t=as(Ji.playerPhase),i={playerPhase:t,isInteractive:y,isVideoEnded:!1,action:"none"};if(e.has("PLAY_BUTTON"))return;if(J({message:"toggle play"}),"ads"===t)return i.action="play",j.log("toggle adman play",i),void W.togglePlay();let r=()=>{J({message:"toggle play, call player.play"}),i.action="play",z.play(),l?.onPlay?.()};if(z.info.isEnded$.getValue()){if(J({message:"toggle play, video ended, seek to 0"}),Ae.next(),Le.next(g.SeekAction.REWIND),y)return void $?.();z.seekTime(0),r()}else z.info.playbackState$.getValue()!==f.PlaybackState.PLAYING?r():(J({message:"toggle play, call player.pause"}),i.action="pause",z.pause(),l?.onPause?.());j.log("toggle play",i)},toggleMuted:()=>{J({message:"toggle muted"});let e=z.info.muted$.getValue();0!==z.info.volume$.getValue()||e?Kt(!e,!1):Gt(Wt(),!1)},openSettingsMenu:async(e,t=()=>Promise.resolve())=>{Ji.ui.settingsMenu.openedByBtnKeyboard$.set(!!e),Ji.ui.settingsMenu.visible$.set(!0),await t();let i=as(Ji.ui.settingsMenu.ref$),r=Bi();if(l?.uiInfo?.onSettingsMenu&&i&&r){let e=Pd(i),t=Ld(i,r);l.uiInfo.onSettingsMenu({visible:!0,size:e,position:t,name:"settings"})}j.log("open settings menu",{wasOpenedByKeyboard:e})},closeSettingsMenu:()=>{if(Ji.ui.settingsMenu.visible$.set(!1),!as(Ji.ui.settingsSubMenu.visible$)){let e=as(Ji.ui.settingsMenu.ref$);if(l?.uiInfo?.onSettingsMenu&&e){let t=Pd(e),i={top:0,left:0,bottom:0,right:0};l.uiInfo.onSettingsMenu({visible:!1,size:t,position:i,name:"settings"})}}j.log("close settings menu")},openSettingsSubMenu:(e,t)=>{Ji.ui.settingsSubMenu.visible$.set(!0),Ji.ui.settingsSubMenu.ref$.set(t),Ji.ui.settingsSubMenu.name$.set(e);let i=Bi();if(l?.uiInfo?.onSettingsMenu&&t&&i){let r=Pd(t),s=Ld(t,i);l.uiInfo.onSettingsMenu({visible:!0,name:e,size:r,position:s})}j.log("open settings sub menu",{name:e})},closeSettingsSubMenu:(e,t=!1)=>{Ji.ui.settingsSubMenu.visible$.set(!1);let i=as(Ji.ui.settingsMenu.ref$),r=Bi(),s=as(Ji.ui.settingsMenu.visible$);if(l?.uiInfo?.onSettingsMenu&&i&&r)if(s&&!t){let e=Pd(i),t=Ld(i,r);l.uiInfo.onSettingsMenu({visible:!0,size:e,position:t,name:"settings"})}else{let t=Pd(e),i={top:0,left:0,bottom:0,right:0},r=as(Ji.ui.settingsSubMenu.name$);l.uiInfo.onSettingsMenu({visible:!1,size:t,position:i,name:r})}j.log("close settings sub menu")},setVolume:e=>Gt(e,!1),setMuted:e=>Kt(e,!1),startVolumeChanging:()=>{Ti.set(!0)},stopVolumeChanging:()=>{Ti.set(!1)},setVideoStream:e=>{e.language&&pa(e.language),z.setVideoStream(e)},setAudioStream:e=>yt(e,!1),setQuality:(e,t)=>Jt(e,t,!1),setTrafficSavingEnabled:(e,t)=>Zt(e,t,!1),setHighQualityEnabled:(e,t)=>ei(e,t,!1),setPlaybackRate:ri,incrementPlaybackRate:()=>{let e=as(Ue),t=as(Lt),i=t.findIndex((({selected:e})=>e));if(i===t.length-1||!e)return t[i];let r=t[i+1];return ri(r.value),r},decrementPlaybackRate:()=>{let e=as(Ue),t=as(Lt),i=t.findIndex((({selected:e})=>e));if(0===i||!e)return t[i];let r=t[i-1];return ri(r.value),r},setSubtitle:e=>si(e,!1),toggleSubtitle:()=>ai(!1),togglePictureInPicture:async()=>{let e=G?.isActive(),t="none";G?.isActive()?(t="exit",await(G?.exit())):(t="request",await(G?.request())),j.log("toggle picture in picture",{isActive:e,action:t})},startScrubbing:e=>{J({message:`start scrubbing, progress: ${e}`}),j.log("start scrubbing",{progress:e}),Si.set(!0),wi(e)},progressScrubbing:wi,completeScrubbing:(e,t=!1)=>{J({message:`complete scrubbing, progress: ${e}`}),j.log("complete scrubbing",{progress:e}),ci(e,g.SeekAction.SLIDER,t),as(Ji.ui.isMobile)&&as(Ji.state.currentFormat$)===f.VideoFormat.HLS?(H?.addEventListener("seeked",xi),bi=window.setTimeout((()=>{xi()}),300)):$i()},toggleChromecast:()=>{J({message:"toggle chromecast"}),j.log("toggle chromecast"),z.toggleChromecast()},switchToActiveLive:()=>{Le.next(g.SeekAction.LIVE),J({message:"switch to active live"}),j.log("switch to active live"),z.seekTime(0),z.info.playbackState$.getValue()!==f.PlaybackState.PLAYING&&Ji.actions.internal.togglePlay()},switchFromAdsToVideo:(e=!0)=>{(0,m.assertNonNullable)(Ji),J({message:`switch from ads to video, callPlay: ${e}`}),j.log("switch from ads to video",{callPlay:e}),ye.set("video"),e&&z.play(),n&&Kt(!0,!0);let t=as(we)?.muted,i=!z.info.muted$.getValue();void 0!==t&&!i&&Kt(t,!0),we.set(void 0)},switchFromVideoToAds:()=>{(0,m.assertNonNullable)(Ji),J({message:"switch from video to ads"}),j.log("switch from video to ads"),Ji.actions.internal.pause(),Be(),ye.set("ads")},skipAd:()=>{j.log("skip adman"),W.skip()},setLiveWaitingStart:e=>{(0,m.assertNonNullable)(Ji);let t=e?"LiveWaitingStart":"thumb";j.log("set live waiting start",{state:e,playerPhase:t}),ye.set(t)},setLiveWaitingRecover:e=>{(0,m.assertNonNullable)(Ji);let t=e?"LiveWaitingRecover":"thumb";j.log("set live waiting recover",{state:e,playerPhase:t}),ye.set(t)},setLiveWaitingRecord:e=>{(0,m.assertNonNullable)(Ji);let t=e?"LiveWaitingRecord":"thumb";j.log("set live waiting record",{state:e,playerPhase:t}),ye.set(t)},getDebugTextData:()=>((0,m.assertNonNullable)(Ji),j.log("get debug text data"),((e,t,i,r)=>{let s=e.info,{width:a,height:n}=as(i.ui.playerSize),o=s.throughputEstimation$.getValue()?.toFixed(0)??0,l=s.rttEstimation$.getValue()?.toFixed(0)??0,u=s.isAutoQualityEnabled$.getValue()?"auto":"manual",d=`${Vs} (core: ${f.VERSION}, stat: ${g.VERSION}, shared: ${m.VERSION})`,c=as(i.state.errorLog$),h=c.length?"\n"+c.map(((e,t)=>`${t}) Type: ${e.id}\nMessage: ${e.message} (${e.thrown})\nTrace: ${e.thrown?.stack}\n`)).join("\n"):void 0,p=i.state.isAudioDisabled?"disabled":as(i.state.isAudioAvailable$)?void 0:"unavailable",v=e.info.currentVideoStream$.getValue(),b=e.info.currentAudioStream$.getValue(),y=[];v&&y.push(`Video: ${v?.codec??""}`+(v?.hdr?" (HDR)":"")),b&&y.push(`Audio: ${b?.codec??""}`+(b?.language?` (${b.language})`:""));let S=s.currentQuality$.getValue(),w="";if(S){let e=s.availableQualitiesFps$.getValue()[S];w=e?`${e}fps`:""}let $=s.httpConnectionType$.getValue(),x=s.currentBuffer$.getValue()?.end??0,k=Math.max(x-as(i.state.positionExact$),0),T={Version:d,Browser:navigator.userAgent,Config:e.experimental.tuningConfigName$.getValue().join(", "),"United video id":String(i.videoId),TraceId:r,VSID:as(i.vsid),"Content host":s.hostname$.getValue(),"Connection type":$?$+(s.httpConnectionReused$.getValue()?" (reused)":""):"",Throughput:`${o}Kbps @ ${l}ms RTT`,Format:s.currentFormat$.getValue(),"Available Formats":t?.sources?Object.keys(t.sources).join(", "):"",Streams:y.join(", "),Quality:`${u} ${S??""} ${w}`,"Available qualities":s.availableQualities$.getValue().join(", "),Audio:p,Position:`${as(i.state.positionExact$)}s`,Buffer:`${k}s`,State:`${as(i.playerPhase)} ${s.playbackState$.getValue()??""}`,"Player size":`${a}x${n}`,URL:window.location.href,Errors:h};return Object.entries(T).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e}: ${t}`)).join("\n")})(z,q,Ji,F.getTraceId())),getTraceTextData:()=>((0,m.assertNonNullable)(Ji),JSON.stringify(F.getFinishedSpans())),getDebugPanelData:()=>((0,m.assertNonNullable)(Ji),((e,t,i)=>{let r=e.info,{width:s,height:a}=as(i.ui.playerSize),n={version:Vs,viewport:`${s}x${a}`,volume:Math.round(100*as(i.state.volume$))};n.id=i.videoId,r.currentFormat$.getValue()&&(n.provider=r.currentFormat$.getValue()),r.hostname$.getValue()&&(n.cdn=r.hostname$.getValue());let o=r.intrinsicVideoSize$.getValue();o&&(n.videoSize=`${o.width}x${o.height}`);let l=r.currentBuffer$.getValue(),u=r.currentNativeBuffer$.getValue(),d=r.isLive$.getValue(),c=r.liveBufferTime$.getValue();l&&u&&(d&&c?(n.buffer=l.end-c,n.nativeBuffer=u.end-c):(n.buffer=Math.max(l.end-as(i.state.positionExact$),0),n.nativeBuffer=Math.max(u.end-as(i.state.positionExact$),0))),n.position=as(i.state.positionExact$);let h=r.throughputEstimation$.getValue();h&&(n.speed=h);let p=r.videoBitrate$.getValue();p&&(n.bitrate=p);let f=r.liveLatency$.getValue();f&&(n.liveLatency=f);let m=r.currentVideoSegmentLength$.getValue();m&&(n.currentVideoSegmentLength=m);let g=r.currentAudioSegmentLength$.getValue();g&&(n.currentAudioSegmentLength=g);let v=as(i.vsid);"string"==typeof v&&(n.vsid=v);let b=e.info.currentVideoStream$.getValue()?.codec;b&&(n.videoCodec=b);let y=e.info.currentAudioStream$.getValue()?.codec;y&&(n.audioCodec=y),e.info.currentVideoStream$.getValue()?.hdr&&(n.hdr=!0);let S=e.info.currentAudioStream$.getValue()?.language;return S&&(n.audioLanguage=S),n})(z,0,Ji)),getVideoElement:Bi,seekTime:(e,t,i)=>di(e,t,i),clearDelayedBufferingCheckTimeout:()=>{Te&&clearTimeout(Te),Te=null},seekEpisodeStartTime:e=>{J({message:`seek to episode start time: ${e}`}),j.log("seek to episode start time",{time:e}),di(e,g.SeekAction.EPISODE,!0)},seekToPercent:ci,getNextEpisode:zi,seekToNextEpisode:e=>{let t=e;t||(t=zi());let i=z.info.position$.getValue();j.log("seek to next episode",{currentTime:i,...t}),t&&(J({message:"seek to next episode"}),di(t.time,g.SeekAction.EPISODE,!0))},getPrevEpisode:qi,seekToPrevEpisode:e=>{let t=e;t||(t=qi());let i=z.info.position$.getValue();j.log("seek to prev episode",{currentTime:i,...t}),t&&(J({message:"seek to prev episode"}),di(t.time,g.SeekAction.EPISODE,!0))},startLogging:()=>{let e,{debugLog:t}=O,i="#9df7b7",r="#efd169";if(t&&!0!==t){let{colors:s}=t;e=t.tag,i=s?.[0]??i,r=s?.[1]??s?.[0]??r}let s=e?`: ${e}`:"";De.add(z.events.log$.subscribe((e=>{console.debug(`%c sdk${s} `,`background:${i};`,`sdk component: ${e.component}`,e.message)}))).add(U.log$.subscribe((e=>{console.debug(`%c ui${s} `,`background:${r};`,`ui component: ${e.component}.`,e.message)})))},stopLogging:()=>{De.unsubscribe()},startCameraManualRotation:(e,t)=>{j.log("start camera manual rotation",{mx:e,my:t}),z.startCameraManualRotation(e,t)},stopCameraManualRotation:(e=!1)=>{j.log("stop camera manual rotation",{immediate:e}),z.stopCameraManualRotation(e)},moveCameraFocusPX:(e,t,i)=>{j.log("move camera focus px",{xpx:e,ypx:t,dt:i}),z.moveCameraFocusPX(e,t,i)},holdCamera:()=>{z.holdCamera()},releaseCamera:()=>{z.releaseCamera()},getVideoEpisodes:ji,getPreviewThumbsData:()=>(J({message:"getting preview thumbs data"}),j.log("get preview thumbs data",{...c}),c),downloadVideo:()=>{let e=(()=>{let e=Object.keys(z.info.availableSources$?.getValue()?.[f.VideoFormat.MPEG]||{}),t=(0,m.getHighestQuality)(e)||m.VideoQuality.Q_144P;return q.sources[f.VideoFormat.MPEG]?.[t]})();if(e)j.log("download video",{url:e}),((e,t)=>{Ns(e,t,"mp4")})(e,q?.meta?.title||"video");else{let e="There is no URL for download video";j.log("download video",{message:e}),J({message:e})}},addLanguage:Va,setLanguage:fe,nextMovie:e=>Ee.next(e),videoRotate:(e=-90)=>{j.log("rotate video",{alphaDiff:e}),le.update((t=>t+e))},correctSeekTimeToInteractive:Wi,replayInteractive:$,setLooped:Xt,reportProblem:()=>{l?.uiInfo?.onReportProblem?.()},setAutoplayNextEnabled:(e,t=!1)=>{J({message:`set autoplayNextEnabled, value: ${e}`}),j.log("set autoplay next enabled",{autoplayNextEnabled:e}),Ji.ui.autoplayNextEnabled$.set(e),(e=>{m.safeStorage.set(Js,String(e))})(e),t&&l?.onSetAutoplayNextEnabled?.(e)},setTimerNextVideoRunning:e=>{J({message:`set timerNextVideoRunning, value: ${e}`}),j.log("set timer next video running",{timerNextVideoRunning:e}),Ji.ui.timerNextVideoRunning$.set(e)},prevVideoClick:(e=!0)=>{let t=!0;if(e&&l?.onPrevVideoClick)try{t=l?.onPrevVideoClick?.()}catch{J({message:"onPrevVideoClick callback failed to execute"})}P(!0),t&&A()},nextVideoClick:(e=!0)=>{let t=!0;if(e&&l?.onNextVideoClick)try{t=l?.onNextVideoClick?.()}catch{J({message:"onNextVideoClick callback failed to execute"})}P(!1),t&&L()},nextVideoAnnouncementShow:()=>{l?.onNextVideoAnnouncementShow?.()},nextVideoAnnouncementClick:()=>{l?.onNextVideoAnnouncementClick?.()},nextVideoAnnouncementAuto:()=>{l?.onNextVideoAnnouncementAuto?.()},nextVideoAnnouncementCancel:()=>{l?.onNextVideoAnnouncementCancel?.()},checkFullscreenSupport:()=>((e,t)=>!!t||e.fullscreenEnabled||!!e.webkitFullscreenEnabled||!!e.mozFullscreenEnabled||!!e.msFullscreenEnabled)(document,f.clientChecker.device.isIOS),changeDoubleForwardOn:Yi,closePreviewTrack:()=>{Oi(!1),hi.set(!1)},previewTrackOpened:()=>{Di(!1),hi.set(!0)},previewTrackDragStarted:()=>{pi.set(!0),Xi=z.info.playbackState$.getValue()===f.PlaybackState.PLAYING,Di(!1)},previewTrackDragFinished:()=>{pi.set(!1),!as(hi)&&Xi&&Oi(!1),Xi=!1}},external:{firstStart:e=>Fi(e,!0),play:()=>Oi(!0),pause:()=>Di(!0),stop:()=>(e=>{(0,m.assertNonNullable)(Ji);let t=!e;"ads"!==as(Ji.playerPhase)?(J({message:`player will be stopped, internalCall: ${t}`}),x?.()):J({message:"player cannot be stopped during ads via external method"})})(!0),seekTime:e=>(e=>{J({message:`seek external, time: ${e}`}),j.log("seek external",{time:e}),Le.next(g.SeekAction.UNKNOWN),z.seekTime(z.info.isLive$.getValue()?-e:e)})(e),seekEpisodeStartTime:e=>(e=>{J({message:`seek external to episode start time: ${e}`}),j.log("seek external to episode start time",{time:e}),di(e,g.SeekAction.EPISODE,!0)})(e),setPlaybackRate:e=>(e=>{J({message:`set playback rate to: ${e}`}),j.log("set playback rate external",{playbackRate:e}),z.setPlaybackRate(e)})(e),setAutoQualityLimits:e=>(e=>{let t=e.max??"none",i=e.min??"none";J({message:`set auto quality limitation. Max: ${t}. Min: ${i}`}),j.log("set auto quality limits",{max:t,min:i}),z.setAutoQualityLimits(e)})(e),setMuted:e=>Kt(e,!0),toggleSubtitle:()=>ai(!0),changeSubtitle:(e,t)=>{j.log("change subtitle",{enabled:e}),e?ni(!0,t):oi(!0)},setVolume:e=>Gt(e,!0),returnFocusToEpisodes:()=>{Ji.ui.episodes.panelOpened$.set(!1)},updateAdditionalSettingsItem:(e,t)=>{let i=as(Mi).map((i=>i.id!==e?i:{...i,...t}));Mi.set(i)},addAdditionalSettingsItem:e=>{let t=as(Mi);t.some((t=>t.id===e.id))?J({message:`Settings menu item with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),Mi.set(t))},removeAdditionalSettingsItem:e=>{let t=as(Mi);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),Mi.set(t)):J({message:`Can't find settings menu item with id: "${e}"! Can't remove item with this id`})},updateAdditionalContextItem:(e,t)=>{let i=as(Ri).map((i=>i.id!==e?i:{...i,...t}));Ri.set(i)},addAdditionalContextItem:e=>{let t=as(Ri);t.some((t=>t.id===e.id))?J({message:`Context menu item with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),Ri.set(t))},removeAdditionalContextItem:e=>{let t=as(Ri);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),Ri.set(t)):J({message:`Can't find context menu item with id: "${e}"! Can't remove item with this id`})},updateAdditionalButton:(e,t)=>{let i=as(Ai).map((i=>i.id!==e?i:{...i,...t}));Ai.set(i)},addAdditionalButton:e=>{let t=as(Ai);t.some((t=>t.id===e.id))?J({message:`Additional button with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),Ai.set(t))},removeAdditionalButton:e=>{let t=as(Ai);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),Ai.set(t)):J({message:`Can't find additional button with id: "${e}"! Can't remove item with this id`})},setLiveLowLatency:e=>{Le.next(g.SeekAction.LIVE),J({message:"live switch to low latency "+e}),j.log("live switch to low latency "+e),z.setLiveLowLatency(e)},hideControls:()=>ui(!1),showControls:()=>ui(!0),setQuality:e=>Jt(e,{appliesTo:"to-video"},!0),setTrafficSavingEnabled:e=>Zt(e,"to-video",!0),setHighQualityEnabled:e=>ei(e,"to-video",!0),changeAudioStream:e=>{j.log("change audio stream",{id:e});let t=z.info.availableAudioStreams$.getValue().find((t=>t.id===e));t&&yt(t,!0)}}},callbacks:l,setUiCallbacks:e=>{Z={...e}},getAdmanWrapper:()=>W,getLogger:()=>U,getPlayer:()=>z,destroy:()=>{j.log("destroy store"),clearTimeout(bi),clearTimeout(vi),te.unsubscribe(),De.unsubscribe(),z.destroy(),W.destroy(),I?.destroy(),Q?.destroy(),he.unsubscribe(),Me?.disconnect(),Me=null,ee.destroy()}};return Ji};function Vd(e,t,i,r){let s=t[i]?.getBoundingClientRect(),a=r&&!!s&&!!(s.right-s.left),{top:n,left:o,bottom:l,right:u}=Ld(t[i],e||void 0);return{left:a?o:0,right:a?u:0,top:a?n:0,bottom:a?l:0,isDisplayed:a}}var Nd=["disabledControls$","additionalButtons"],Bd=["interactiveTimeIndicator"],Dd=(e,t,i,r)=>{if(e)for(let[s,a]of Object.entries(t))if(!Nd.includes(s)){let t=r||Bd.includes(s);a.set(Vd(e,i,s,t))}},Od=async(e,t,i)=>{await li(),t&&i&&(i.focus(),e.set(!1))},Fd=_i('<path d="M18 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2Zm-6 4c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Zm-6 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Z"></path>');function jd(e,t){re(t,!0);let[i,r]=us(),s=()=>ls(l,"$contextMenuVisible$",i),a=ms(t,"disabled",3,!1),n=ms(t,"ariaLabel",3,""),o=Os(),l=o.ui.contextMenu.visible$,u=o.ui.contextMenu.openedByBtnKeyboard$,d=o.ui.contextMenu.showContextMenuBtn$,c=o.ui.contextMenu.position$,h=o.ui.contextMenu.btnRef$,p=ke(void 0);rt((()=>{ui(p)&&di((()=>{h.set(ui(p))}))}));let f=fe((()=>s()?"opened":""));Sl(e,{get className(){return ui(f)},testId:"btn-context-menu",get disabled(){return a()},get ariaLabel(){return n()},click:e=>{let t=Un(e),i=(e=>{let t=e.getBoundingClientRect();return{right:t.left+t.width,bottom:t.top+-14}})(ui(p));c.set(i),u.set(t),l.set(!s())},focus:()=>{d.set(!0)},blur:()=>{d.set(!1)},get ariaExpanded(){return s()},get ref(){return ui(p)},set ref(e){_e(p,e,!0)},children:(e,t)=>{!function(e){Ea(e,{children:(e,t)=>{Ai(e,Fd())},$$slots:{default:!0}})}(e)},$$slots:{default:!0}}),se(),r()}var zd=e=>{e.stopPropagation()},qd=Ti("<div><!> <div></div> <div></div></div>"),Hd={hash:"s-26",code:'.interactive-episode-icon-animated.s-26{height:32px;opacity:1;position:absolute;right:16px;top:16px;transition:.3s;width:32px}.interactive-episode-icon-animated.icon-small.s-26{height:28px;width:28px}.invisible.s-26{opacity:0;visibility:hidden}.fullscreen.s-26:not(.mobile){height:40px;right:23px;top:19px;width:40px}.mobile.s-26{height:28px;right:14px;top:12px;width:28px}.fullscreen.mobile.s-26{height:32px;width:32px}@media screen and (orientation:portrait){.interactive-episode-icon-animated.mobile.fullscreen.s-26{right:16px;top:40px}}@keyframes s-26-pulse{0%{border-width:1px;opacity:0;transform:scale(1)}10%{opacity:1}50%{border-width:1px;opacity:.5;transform:scale(1.5)}to{border-width:.5px;opacity:0;transform:scale(1.5)}}.pulse.s-26{animation:s-26-pulse 1s infinite;border:1px solid #fff;border-radius:100%;bottom:0;content:"";display:block;left:0;pointer-events:none;position:absolute;right:0;top:0;transform:scale(1.8);transition:.3s}.pulse.paused.s-26{animation-play-state:paused}.interactive-episode-icon-animated svg{height:100%;width:100%}.ref-block.s-26{height:100%;position:absolute;top:0;visibility:hidden;width:100%}.hidden.s-26{display:none}'};function Ud(e,t){re(t,!0),fr(e,Hd);let[i,r]=us(),s=()=>ls(c,"$isMobile",i),a=()=>ls(f,"$showInteractiveTimeIndicatorTooltip$",i),n=ms(t,"ref",15,void 0),o=ke(void 0),l=Os(),u=Fs(),{interactiveControlsOpacity$:d}=u,c=l.ui.isMobile,h=l.ui.isFullscreen,p=l.state.isInteractiveTime$,f=u.showInteractiveTimeIndicatorTooltip$,m=l.ui.controlsVisible,g=l.callbacks?.onInteractiveTimeIndicatorClick,v=l.ui.currentGridType$,b=fe((()=>!s()&&ls(m,"$areControlsVisible",i))),y=fe((()=>Ou(ls(v,"$currentGridType$",i),"s"))),S=fe((()=>!ls(p,"$isInteractiveTime$",i)||!!ls(d,"$interactiveControlsOpacity$",i)||ui(b))),w=ke(!1);rt((()=>{_e(w,ui(S),!0)}));let $=()=>{_e(w,!0)},x=()=>{_e(w,!1),ui(o)?.removeEventListener("animationiteration",$)},k=fe((()=>a()&&!ui(S)));rt((()=>{a()?(x(),ui(o)?.addEventListener("animationiteration",$,{once:!0})):x()}));Yi((()=>{f.clearTimeout(),x()}));let T=Da("tooltip_interactive_interaction_time_indicator");var _=qd();let C;_.__mousemove=[zd],_.__click=()=>{ui(S)||(f.set(!0),g?.())};var E=Ye(_);Su(E,{get tooltipContent(){return T},get tooltipVisible(){return ui(k)},initialTranslateYPx:72,tooltipPlacement:"bottom",onTooltipVisibilityChange:e=>{f.set(e)},get ref(){return n()},set ref(e){n(e)},children:(e,t)=>{$u(e,{completed:!0})},$$slots:{default:!0}});var A=Je(E,2);let L;Xr(A,(e=>n(e)),(()=>n()));var P=Je(A,2);let M;Xr(P,(e=>_e(o,e)),(()=>ui(o))),ze(_),nt(((e,t,i)=>{C=wr(_,1,"interactive-episode-icon-animated s-26",null,C,e),L=wr(A,1,"ref-block s-26",null,L,t),M=wr(P,1,"pulse s-26",null,M,i)}),[()=>({mobile:s(),fullscreen:ls(h,"$isFullscreen",i),invisible:ui(S),"icon-small":ui(y)}),()=>({hidden:ui(S)}),()=>({paused:ui(w)})]),Si("mouseleave",_,(()=>{f.set(!1)})),Ai(e,_),se(),r()}function Wd(e,t){re(t,!0);let i=ms(t,"tooltipEnabled",3,!0),r=ms(t,"disabled",3,!1),s=ms(t,"className",3,void 0),a=ms(t,"ref",15),n=ms(t,"tooltipVisible",3,!1);Su(e,{get disabled(){return r()},get tooltipContent(){return t.tooltipText},get disabledTooltipContent(){return t.disabledTooltipContent},get hasTooltip(){return i()},get mouseEnter(){return t.mouseEnter},get mouseLeave(){return t.mouseLeave},get tooltipVisible(){return n()},get className(){return s()},get ref(){return a()},set ref(e){a(e)},children:(e,i)=>{var r=Ei();let s=fe((()=>t.buttonComponent));cr(Xe(r),(()=>ui(s)),((e,i)=>{i(e,ps((()=>t.buttonComponentProps??{})))})),Ai(e,r)},$$slots:{default:!0}}),se()}wi(["mousemove","click"]);var Qd=100,Gd=200,Kd=300,Yd=400,Xd=500,Jd=600,Zd=700,ec=800,tc=_i('<path d="M32 21.68V15a2 2 90 114 0v18a2 2 90 01-4 0v-6.66l-16.3 9.32A2.48 2.48 90 0112 33.56V14.46c0-1.9 2.06-3.08 3.7-2.12z"></path>');function ic(e,t){re(t,!0);let i=ms(t,"reversed",3,!1),r=fe((()=>i()?"transform: scaleX(-1);transform-origin: 50%;":void 0)),s=fe((()=>`${Qo(t.size)}${ui(r)}`)),a=fe((()=>i()?"prev-icon":"next-icon"));Ea(e,{get width(){return"48"},get height(){return"48"},get style(){return ui(s)},get testId(){return ui(a)},get shadow(){return t.shadow},children:(e,t)=>{Ai(e,tc())},$$slots:{default:!0}}),se()}var rc=Ti('<div class="icon-background-mobile s-24"><!></div>'),sc={hash:"s-24",code:".icon-background-mobile.s-24{align-items:center;background-color:var(--big-play-bg-color);border-radius:var(--big-play-radius);display:flex;height:100%;justify-content:space-around;left:0;position:absolute;top:0;width:100%}"};function ac(e,t){re(t,!0),fr(e,sc);let i=ms(t,"ref",15,void 0),r=ms(t,"isMobile",3,!1),s=ms(t,"disabled",3,!1),a=Os().ui.t,n=fe((()=>"prev"===t.type?a("tooltip_previous"):a("tooltip_next"))),o=fe((()=>"prev"===t.type?a("hotkey_map_item_prev_video_value"):a("hotkey_map_item_next_video_value"))),l=fe((()=>`btn-${r()?"m":"d"}--${t.type}`));Sl(e,{get className(){return ui(l)},get testId(){return`btn-${t.type??""}`},get disabled(){return s()},get ariaLabel(){return ui(n)},get click(){return t.click},get ariaKeyShortCut(){return ui(o)},get ref(){return i()},set ref(e){i(e)},children:(e,i)=>{var s=Ei(),a=Xe(s),n=e=>{var i=rc(),r=Ye(i);let s=fe((()=>"prev"===t.type));ic(r,{get size(){return"32"},get reversed(){return ui(s)}}),ze(i),Ai(e,i)},o=e=>{let i=fe((()=>"prev"===t.type));ic(e,{get size(){return"24"},get reversed(){return ui(i)}})};Ji(a,(e=>{r()?e(n):e(o,!1)})),Ai(e,s)},$$slots:{default:!0}}),se()}var nc=_i('<path d="M24 21.2a.8.8 90 01-1.34.6L14.08 14a1.34 1.34 90 010-2l8.6-7.8a.8.8 90 011.32.6V11a16 16 90 11-16 16 2 2 90 114 0 12 12 90 1012-12z"></path>');function oc(e,t){re(t,!0);let i=fe((()=>Qo(t.size)));Ea(e,{get width(){return"48"},get height(){return"48"},get style(){return ui(i)},testId:"replay-icon",get shadow(){return t.shadow},children:(e,t)=>{Ai(e,nc())},$$slots:{default:!0}}),se()}var lc=Ti('<div class="icon-background-mobile s-25"></div>'),uc=Ti("<!> <div><!></div>",1),dc={hash:"s-25",code:".mobile.s-25{align-items:center;display:flex;justify-content:center;position:relative}.icon-background-mobile.s-25{background-color:var(--big-play-bg-color);border-radius:var(--big-play-radius);height:calc(100% - 32px);left:16px;position:absolute;top:16px;width:calc(100% - 32px)}"};function cc(e,t){re(t,!0),fr(e,dc);let i=ms(t,"ref",15,void 0),r=ms(t,"isMobile",3,!1),s=ms(t,"disabled",3,!1),a=ms(t,"className",3,""),n=ms(t,"click",3,m.noop),o=Da("tooltip_restart"),l=fe((()=>`${r()?"btn-m--play":""} ${a()}`));Sl(e,{get className(){return ui(l)},testId:"replay-btn",get ariaLabel(){return o},get disabled(){return s()},get click(){return n()},get ariaKeyShortCut(){return $s},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{var i=uc(),s=Xe(i),a=e=>{Ai(e,lc())};Ji(s,(e=>{r()&&e(a)}));var n=Je(s,2);let o;var l=Ye(n);let u=fe((()=>r()?"48":"24"));oc(l,{get size(){return ui(u)}}),ze(n),nt((e=>o=wr(n,1,"s-25",null,o,e)),[()=>({mobile:r()})]),Ai(e,i)},$$slots:{default:!0}}),se()}var hc=_i('<path d="m17.4 10 1.6.2a2 2 90 01.8.8l.2 1.6v22.8l-.2 1.6a2 2 90 01-.8.8l-1.6.2h-4l-1.4-.2a2 2 90 01-.8-.8l-.2-1.6V12.6l.2-1.6a2 2 90 01.8-.8l1.6-.2h3.801zm16 0 1.6.2a2 2 90 01.8.8l.2 1.6v22.8l-.2 1.6a2 2 90 01-.8.8l-1.6.2h-4l-1.4-.2a2 2 90 01-.8-.8l-.2-1.6V12.6l.2-1.6a2 2 90 01.8-.8l1.6-.2h4z"></path>');function pc(e,t){re(t,!0);let i=fe((()=>Qo(t.size)));Ea(e,{get width(){return"48"},get height(){return"48"},get fill(){return t.fill},get style(){return ui(i)},testId:"pause-icon",get shadow(){return t.shadow},children:(e,t)=>{Ai(e,hc())},$$slots:{default:!0}}),se()}var fc=Ti('<div class="icon-background-mobile s-1z"><!></div>'),mc={hash:"s-1z",code:".icon-background-mobile.s-1z{align-items:center;background-color:var(--big-play-bg-color);border-radius:var(--big-play-radius);display:flex;height:calc(100% - 32px);justify-content:space-around;left:16px;position:absolute;top:16px;width:calc(100% - 32px)}"};function gc(e,t){re(t,!0),fr(e,mc);let[i,r]=us(),s=()=>ls(a,"$fakeIsPlaying$",i),{fakeIsPlaying$:a}=Fs(),n=ms(t,"ref",15,void 0),o=ms(t,"isMobile",3,!1),l=ms(t,"isPlaying",3,!1),u=ms(t,"disabled",3,!1),d=ms(t,"className",3,""),c=ms(t,"click",3,m.noop),h=Os().ui.t,{toggle:p}=a,f=fe((()=>p)),g=fe((()=>null!==s())),v=fe((()=>ui(g)?s():l())),b=fe((()=>ui(v)?h("tooltip_pause"):h("tooltip_play"))),y=fe((()=>ui(v)?pc:Ko)),S=fe((()=>`${o()?"btn-m--play":""} ${d()}`)),w=fe((()=>ui(g)?ui(f):c()));Sl(e,{get className(){return ui(S)},testId:"play-btn",get click(){return ui(w)},get disabled(){return u()},get ariaLabel(){return ui(b)},get ariaKeyShortCut(){return $s},get ref(){return n()},set ref(e){n(e)},children:(e,t)=>{var i=Ei();let r=fe((()=>ui(y)));var s=Xe(i),a=e=>{var t=fc();cr(Ye(t),(()=>ui(r)),((e,t)=>{t(e,{get size(){return"48"}})})),ze(t),Ai(e,t)},n=e=>{var t=Ei();cr(Xe(t),(()=>ui(r)),((e,t)=>{t(e,{get size(){return"24"}})})),Ai(e,t)};Ji(s,(e=>{o()?e(a):e(n,!1)})),Ai(e,i)},$$slots:{default:!0}}),se(),r()}var vc=_i('<path d="M12.58 12.92v2.5a1 1 0 0 1-1.52.85l-5.58-3.42a1 1 0 0 1 0-1.7l5.58-3.42a1 1 0 0 1 1.52.86v2.5l5.48-3.36a1 1 0 0 1 1.52.86v6.82a1 1 0 0 1-1.52.86z"></path>');function bc(e,t){re(t,!0);let i=ms(t,"ref",15,void 0),r=ms(t,"hidden",3,!1),s=ms(t,"disabled",3,!1),a=Da("tooltip_interactive_go_back"),n=fe((()=>r()?"hidden":""));Sl(e,{get className(){return ui(n)},testId:"play-prev-chapter-btn",get ariaLabel(){return a},get disabled(){return s()},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e){Ea(e,{testId:"play-prev-chapter-icon",children:(e,t)=>{Ai(e,vc())},$$slots:{default:!0}})}(e)},$$slots:{default:!0}}),se()}var yc=Ti('<span class="gutter s-27"><span><!></span></span>'),Sc={hash:"s-27",code:".gutter.s-27{--gutterWidth:32px;--gutterHeight:12px;--togglerWidth:18px;--togglerHeight:18px;--togglerGap:calc(var(--togglerWidth)/6);background-color:hsla(0,0%,100%,.3);border-radius:50px;height:var(--gutterHeight);position:relative;width:var(--gutterWidth)}.toggler.s-27{align-items:center;background-color:#626364;border-radius:50%;display:flex;height:var(--togglerHeight);justify-content:center;left:0;position:absolute;top:calc((var(--togglerHeight) - var(--gutterHeight))/2*-1);transform:translateX(calc(var(--togglerGap)*-1));transition-duration:.2s;transition-property:background-color,transform;transition-timing-function:ease;width:var(--togglerWidth)}.toggler.enabled.s-27{background-color:var(--toggle-color-autoplay-on);transform:translateX(calc(var(--gutterWidth) - var(--togglerWidth) + var(--togglerGap)))}"};function wc(e,t){re(t,!0),fr(e,Sc);let[i,r]=us(),s=()=>ls(l,"$autoplayNextEnabled$",i),a=ms(t,"ref",15,void 0),n=Os(),o=n.ui.t,l=n.ui.autoplayNextEnabled$,u=n.actions.internal.setAutoplayNextEnabled,d=o("aria_label_autoplay"),c="#000",h=fe((()=>s()?"true":"false"));Sl(e,{click:()=>{u(!s(),!0)},get ariaLabel(){return d},role:"switch",get areaChecked(){return ui(h)},get ref(){return a()},set ref(e){a(e)},children:(e,t)=>{var i=yc(),r=Ye(i);let a;var n=Ye(r),o=e=>{Ko(e,{get size(){return"12"},fill:c})},l=e=>{pc(e,{get size(){return"12"},fill:c})};Ji(n,(e=>{s()?e(o):e(l,!1)})),ze(r),ze(i),nt((e=>a=wr(r,1,"toggler s-27",null,a,e)),[()=>({enabled:s()})]),Ai(e,i)},$$slots:{default:!0}}),se(),r()}var $c=_i('<path d="M16.73 4.85c-.54-.05-1.23-.05-2.23-.05H7.9a.9.9 0 1 1 0-1.8h6.64q1.41-.01 2.33.05c.64.05 1.2.16 1.73.43a4.4 4.4 0 0 1 1.92 1.92c.27.52.38 1.09.43 1.73q.06.92.05 2.33v5.08q.01 1.41-.05 2.33a5 5 0 0 1-.43 1.73 4.4 4.4 0 0 1-1.92 1.92 5 5 0 0 1-1.73.43q-.92.06-2.33.05H7.9a.9.9 0 1 1 0-1.8h6.6c1 0 1.69 0 2.23-.04.52-.05.82-.13 1.05-.24a2.6 2.6 0 0 0 1.14-1.14c.11-.23.2-.53.24-1.06s.04-1.23.04-2.22v-5c0-1 0-1.69-.04-2.23a3 3 0 0 0-.24-1.05 2.6 2.6 0 0 0-1.14-1.14c-.23-.11-.53-.2-1.05-.24"></path><path d="M7.76 11.17V8.9c0-.71.7-1.15 1.25-.78l4.6 3.1a.96.96 0 0 1 0 1.54L9 15.87c-.55.37-1.25-.07-1.25-.78v-2.26l-4.5 3.04C2.7 16.24 2 15.8 2 15.09V8.91c0-.71.7-1.15 1.25-.78z "></path>',1);function xc(e,t){re(t,!0);let i=ms(t,"ref",15,void 0),r=ms(t,"hidden",3,!1),s=ms(t,"disabled",3,!1),a=Da("tooltip_interactive_seek"),n=fe((()=>r()?"hidden":""));Sl(e,{get className(){return ui(n)},testId:"btn-seek-to-interactive",get ariaLabel(){return a},get disabled(){return s()},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e){Ea(e,{testId:"seek-to-interactive-icon",children:(e,t)=>{var i=$c();qe(),Ai(e,i)},$$slots:{default:!0}})}(e)},$$slots:{default:!0}}),se()}var kc=_i('<path d="M15.2 5.9v1.2c0 .6 0 .9.12 1.12q.15.3.46.46c.23.12.52.12 1.12.12h1.2c.6 0 .9 0 1.12-.12q.3-.15.46-.46c.12-.23.12-.52.12-1.12V5.9c0-.6 0-.9-.12-1.12a1 1 0 0 0-.46-.46c-.23-.12-.52-.12-1.12-.12h-1.2c-.6 0-.9 0-1.12.12q-.3.15-.47.46c-.11.23-.11.53-.11 1.12m-.05 11.03v1.14c0 .6 0 .91.12 1.14q.15.31.47.47c.23.12.53.12 1.14.12h1.22c.6 0 .9 0 1.14-.12a1 1 0 0 0 .47-.47c.12-.23.12-.53.12-1.14v-1.14c0-.6 0-.9-.12-1.14a1 1 0 0 0-.47-.47c-.23-.12-.54-.12-1.14-.12h-1.22c-.6 0-.91 0-1.14.12a1 1 0 0 0-.47.47c-.12.23-.12.53-.12 1.14"></path>'),Tc=_i('<path d="M16.78 3h1.42q.47 0 .83.02.4.02.82.21.61.31.92.92.2.41.21.81.03.36.02.83v1.4q0 .47-.02.83-.02.4-.21.81a2 2 0 0 1-.92.92 2 2 0 0 1-.82.21q-.36.02-.83.02h-1.42q-.47 0-.84-.02a2 2 0 0 1-.81-.2 2 2 0 0 1-.93-.93 2 2 0 0 1-.2-.8l-.03-.64h-2.2c-.49 0-.8 0-1.04.02a1 1 0 0 0-.35.06 1 1 0 0 0-.35.35 1 1 0 0 0-.07.35c-.02.24-.02.55-.02 1.04v5.57c0 .5 0 .8.02 1.04s.05.31.07.34q.12.23.35.35c.03.02.11.05.34.07s.56.02 1.05.02h2.2q0-.34.02-.62.01-.4.21-.81.31-.61.93-.92.42-.2.81-.21.37-.02.84-.02h1.42q.47 0 .83.02.4.01.82.2.61.31.92.93.2.41.21.8.03.37.02.84v1.4q0 .47-.02.83-.02.39-.21.81a2 2 0 0 1-.92.92q-.43.2-.82.21-.36.02-.83.02h-1.42q-.47 0-.84-.02a2 2 0 0 1-.81-.21 2 2 0 0 1-.93-.92 2 2 0 0 1-.2-.81l-.03-.63h-2.24q-.68 0-1.16-.03a3 3 0 0 1-1.01-.26 2.6 2.6 0 0 1-1.14-1.14 3 3 0 0 1-.26-1q-.04-.5-.03-1.16v-1.93H2.9A.9.9 0 0 1 2 12c0-.5.4-.9.9-.9h5.23V9.18q0-.68.03-1.16.02-.51.26-1.02a2.6 2.6 0 0 1 1.14-1.13q.5-.24 1.02-.26.48-.04 1.16-.02h2.23q0-.34.02-.63.01-.4.21-.81.31-.61.93-.92.42-.2.81-.21.37-.02.84-.02m-.84 1.84.15-.02c.16-.02.37-.02.72-.02h1.35c.36 0 .57 0 .72.02l.15.02a.3.3 0 0 1 .12.12l.03.15.01.71v1.34l-.01.71-.02.15a.3.3 0 0 1-.13.13l-.15.02-.72.01h-1.35l-.72-.01-.15-.03a.3.3 0 0 1-.12-.12l-.02-.15-.02-.71V5.82q0-.5.02-.71l.02-.15a.3.3 0 0 1 .12-.12m0 11.02.15-.03.72-.01h1.35l.72.01.15.03a.3.3 0 0 1 .12.12l.03.15.01.71v1.34l-.01.71-.02.15a.3.3 0 0 1-.13.12l-.15.02c-.15.02-.36.02-.72.02h-1.35c-.35 0-.56 0-.72-.02l-.15-.02a.3.3 0 0 1-.12-.12l-.02-.15-.02-.71v-1.34c0-.35 0-.56.02-.71l.02-.15a.3.3 0 0 1 .12-.13"></path><!>',1);function _c(e,t){re(t,!0);let i=ms(t,"ref",15,void 0),r=ms(t,"hidden",3,!1),s=ms(t,"disabled",3,!1),a=ms(t,"graphIsOpened",3,!1),n=Os().ui.t,o=fe((()=>a()?n("tooltip_interactive_graph_on"):n("tooltip_interactive_graph_off"))),l=fe((()=>r()?"hidden":""));Sl(e,{get className(){return ui(l)},testId:"btn-graph",get disabled(){return s()},get ariaLabel(){return ui(o)},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{let i=fe((()=>!!a()));!function(e,t){let i=ms(t,"isOpened",3,!1),r=fe((()=>i()?"graph-close-icon":"graph-open-icon"));Ea(e,{get testId(){return ui(r)},children:(e,t)=>{var r=Tc(),s=Je(Xe(r)),a=e=>{Ai(e,kc())};Ji(s,(e=>{i()&&e(a)})),Ai(e,r)},$$slots:{default:!0}})}(e,{get isOpened(){return ui(i)}})},$$slots:{default:!0}}),se()}function Cc(e,t){re(t,!0);let[i,r]=us(),s=()=>ls(u,"$playbackState$",i),a=ms(t,"isMobile",3,!1),n=ms(t,"isLiveActive",3,!1),o=ms(t,"ariaLabel",3,""),l=Os(),u=l.state.playbackState$,d=l.actions.internal.switchToActiveLive,c=l.actions.internal.togglePlay,h=fe((()=>()=>{n()?s()===f.PlaybackState.PAUSED&&c():d()})),p=fe((()=>a()?"":"btn--live btn-full-opacity")),m=fe((()=>n()?"btn-live":"btn-live-offset")),g=fe((()=>n()&&s()===f.PlaybackState.PLAYING));Sl(e,{get className(){return ui(p)},get testId(){return ui(m)},get disabled(){return ui(g)},get ariaLabel(){return o()},get click(){return ui(h)},children:(e,t)=>{_n(e,{get isActive(){return n()}})},$$slots:{default:!0}}),se(),r()}var Ec=Ti('<div class="icon icon-error-stub"><div class="inner"></div></div>'),Ac=Ti('<img class="icon" aria-hidden="true"/>');function Lc(e,t){"use strict";let i=ke(!1),r=()=>{_e(i,!0)};var s=Ei(),a=Xe(s),n=e=>{Ai(e,Ec())},o=e=>{var i=Ac();nt((()=>Pr(i,"src",t.icon))),Si("error",i,r),bi(i),Ai(e,i)};Ji(a,(e=>{ui(i)?e(n):e(o,!1)})),Ai(e,s)}var Pc=100,Mc=200,Ic=300,Rc=400,Vc=500,Nc=600,Bc=700,Dc=800,Oc=(e,t,i,r)=>{if(e)for(let[s,a]of Object.entries(t))a.set(Vd(e,i,s,r))},Fc=e=>e;function jc(e,{delay:t=0,duration:i=400,easing:r=Fc}={}){let s=+getComputedStyle(e).opacity;return{delay:t,duration:i,easing:r,css:e=>"opacity: "+e*s}}var zc=Ti('<span class="root s-2d"> </span>'),qc={hash:"s-2d",code:".root.s-2d{box-shadow:0 8px 24px 0 rgba(0,0,0,.08);box-shadow:0 0 2px 0 rgba(0,0,0,.08);color:#fff;font-size:13px;font-weight:500;line-height:16px}"};var Hc=Ti('<div class="tooltip-wrapper s-v"><div><!></div></div>'),Uc={hash:"s-v",code:'.tooltip-wrapper.s-v{display:block;position:relative}.tooltip.s-v{bottom:100%;opacity:0;position:absolute;transform:translateX(-50%);transition:opacity .2s;visibility:hidden}.pointer.s-v:after{border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid rgba(41,41,41,.8);bottom:0;content:" ";font-size:0;left:50%;line-height:0;position:absolute;transform:translate(-50%,5px);width:0}.tooltip.active.s-v{opacity:1;visibility:visible}'};function Wc(e,t){fr(e,Uc);let i=ms(t,"active",3,!1),r=ms(t,"pointer",3,!1),s=ms(t,"translateXPx",3,0),a=ms(t,"translateYPx",3,0),n=ms(t,"leftOffset",3,0),o=ms(t,"rightOffset",3,0),l=ke(void 0),u=ke(void 0);let d=fe((()=>function(e){if(!ui(u))return 0;let{width:i}=ui(u).getBoundingClientRect(),r=i/2;return e<r?r+n():e>t.containerWidth-r?t.containerWidth-r-o():e}(s())));var c=Hc(),h=Ye(c);let p;Gi(Ye(h),(()=>t.children??V)),ze(h),Xr(h,(e=>_e(u,e)),(()=>ui(u))),ze(c),Xr(c,(e=>_e(l,e)),(()=>ui(l))),nt((e=>{xr(c,`transform: translate(${ui(d)}px, ${a()}px);`),p=wr(h,1,"tooltip s-v",null,p,e),xr(h,`opacity: ${i()?1:0}; visibility: ${i()?"visible":"hidden"}`)}),[()=>({active:i(),pointer:r()})]),Ai(e,c)}var Qc=Ti('<div class="preview s-u"></div>'),Gc=Ti('<div class="time s-u"> </div>'),Kc=Ti('<div><!> <div class="episode s-u"><!></div> <!></div>'),Yc={hash:"s-u",code:".timeline-preview.s-u{border-radius:2px;bottom:18px;pointer-events:none}.timeline-preview.mobile.s-u{bottom:72px}.preview.s-u{background-color:var(--timeline-preview-bg);border:1px solid var(--white);border-radius:8px;box-shadow:0 0 2px var(--timeline-preview-shadow),0 8px 24px var(--timeline-preview-shadow)}.episode.s-u{margin-bottom:4px;margin-top:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.episode.s-u,.time.s-u{font-size:13px;font-weight:500;line-height:16px;text-align:center;text-shadow:0 8px 24px var(--timeline-preview-shadow),0 0 2px var(--timeline-preview-shadow)}.time.s-u{color:var(--white)}"};function Xc(e,t){re(t,!0),fr(e,Yc);let[i,r]=us(),s=()=>ls(f,"$rotateAlpha",i),a=150,n=278,o=ms(t,"time",3,""),l=ms(t,"isMobile",3,!1),u=ms(t,"videoEpisodes",19,(()=>[])),d=ms(t,"progress",3,0),c=ms(t,"duration",3,0),h=ms(t,"isInteractive",3,!1),p=Os(),f=p.ui.rotateAlpha,m=p.ui.playerSize,g=ke(0),v=ke(0),b=ke(""),y=ke(0),S=ke(0),w=ke(0),$=ke(0),x=fe((()=>sd(d(),c(),u()))),k=fe((()=>Id(s()))),T=fe((()=>(e=>Math.abs(e)/90%4==1)(s()))),_=fe((function(){let e=l()?a:n,{isVertical:t}=A(),r=30;return ui(x)?.text&&(r+=16),(t||ui(k))&&(r+=18,r+=50),Math.min(Math.max(ls(m,"$playerSize",i).height-r,0),e)})),C=fe((()=>(ui(T)?1:-1)*(ui(g)/2-ui(v)/2))),E=fe((()=>-1*ui(C)));function A(){let e=t.previewThumbsData.frameWidth,i=t.previewThumbsData.frameHeight,r=i>e;return{width:e,height:i,isHorizontal:!r,isVertical:r}}rt((()=>{(e=>{_e(g,e.width,!0),_e(v,e.height,!0)})(function(){let{height:e,isHorizontal:t,isVertical:i,width:r}=A();return t&&(e=e/r*ui(_),r=ui(_)),i&&(r=r/e*ui(_),e=ui(_)),{width:r,height:e}}())})),rt((()=>{(e=>{_e(b,e.imgSrc,!0),_e(y,e.imgWidth,!0),_e(S,e.imgHeight,!0),_e(w,e.imgOffsetX,!0),_e($,e.imgOffsetY,!0)})(function(e){let i;i=t.previewThumbsData.isUV?Math.floor(c()*e/t.previewThumbsData.frequency):Math.min(t.previewThumbsData.countTotal,Math.max(0,Math.floor(t.previewThumbsData.countTotal*e)));let r=Math.floor(i/t.previewThumbsData.countPerImage),s=Math.floor(i%t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow),a=i%t.previewThumbsData.countPerRow,n=Math.floor(t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow);!t.previewThumbsData.isUV&&r===Math.floor(t.previewThumbsData.countTotal/t.previewThumbsData.countPerImage)&&(n=Math.floor(t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow),t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage%t.previewThumbsData.countPerRow>0&&n++);let o=t.previewThumbsData.countPerRow;!t.previewThumbsData.isUV&&r===Math.floor(t.previewThumbsData.countTotal/t.previewThumbsData.countPerImage)&&t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage>0&&(o=Math.min(t.previewThumbsData.countPerRow,t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage));let l=ui(g)*o,u=ui(v)*n,d=-a*ui(g),h=-s*ui(v);return{imgSrc:t.previewThumbsData.links[r],imgWidth:l,imgHeight:u,imgOffsetX:d,imgOffsetY:h}}(d()))}));var L=Kc();let P;var M=Ye(L),I=e=>{var t=Qc();nt((()=>xr(t,`width: ${ui(g)}px; height: ${ui(v)}px; background-image: url(${ui(b)}); background-size: ${ui(y)}px ${ui(S)}px; background-position: ${ui(w)}px ${ui($)}px;\n    transform: rotate(${s()}deg) ${ui(k)?`translate(${ui(C)}px, ${ui(E)}px)`:""};\n    `))),Ai(e,t)};Ji(M,(e=>{ui(b)&&e(I)}));var R=Je(M,2),V=Ye(R),N=e=>{var t=Ei(),i=Xe(t),r=e=>{var t=Ci();nt((e=>ji(t,e)),[()=>Da("tooltip_episode_unfinished")]),Ai(e,t)},s=e=>{var t=Ci();nt((()=>ji(t,ui(x).text||""))),Ai(e,t)};Ji(i,(e=>{h()&&!1===ui(x).completed?e(r):e(s,!1)})),Ai(e,t)};Ji(V,(e=>{ui(x)&&e(N)})),ze(R);var B=Je(R,2),D=e=>{var t=Gc(),i=Ye(t,!0);ze(t),nt((()=>ji(i,o()))),Ai(e,t)};Ji(B,(e=>{h()||e(D)})),ze(L),nt((e=>{P=wr(L,1,"timeline-preview s-u",null,P,e),xr(L,`width: ${ui(k)?ui(v):ui(g)}px;`)}),[()=>({mobile:l()})]),Ai(e,L),se(),r()}var Jc=Ti('<span class="time s-f"> </span>'),Zc=Ti("<!> <!>",1),eh={hash:"s-f",code:".time.s-f{background-color:rgba(41,41,41,.8);border-radius:3px;color:var(--white);display:inline-block;padding:6px 10px}.timeline-slider{--slider-bg:var(--timeline-slider-bg);--slider-filled-bg:var(--timeline-slider-filled-bg);--slider-handle-bg:var(--timeline-slider-handle-bg);--slider-loaded-bg:var(--timeline-slider-loaded-bg)}"};function th(e,t){re(t,!0),fr(e,eh);let[i,r]=us(),s=()=>ls(v,"$duration$",i),a=()=>ls(g,"$position$",i),n=()=>ls(T,"$isInteractiveTime$",i),o=()=>ls(L,"$previewTrackActive",i),l=()=>ls(b,"$isLive$",i),u=()=>ls(S,"$isMobile",i),d=ms(t,"showTimeline",3,!1),c=ms(t,"withEpisodes",3,!0),h=ms(t,"ref",15,void 0),p=Os(),f=ys(),m=p.state.bufferedProgress$,g=p.state.positionWithScrubbing$,v=p.state.duration$,b=p.state.isLive$,y=p.state.isActiveLive$,S=p.ui.isMobile,w=f.features.episodes&&c()?p.actions.internal.getVideoEpisodes():void 0,$=p.actions.internal.getPreviewThumbsData(),x=p.state.interactiveEpisodes$,k=p.state.isInteractive,T=p.state.isInteractiveTime$,_=p.state.isInteractiveExpectation$,C=p.actions.internal.correctSeekTimeToInteractive,E=p.callbacks?.onDisabledTimelineClick,A=p.ui.controls.disabledControls$,L=p.ui.previewTrackActive,P=p.callbacks?.uiInfo?.onTimelineMouseEnter,M=p.callbacks?.uiInfo?.onTimelineMouseLeave,I=p.ui.t,R=f.features.interactiveResponsiveUi,V=fe((()=>k?ls(x,"$interactiveEpisodes$",i):w)),N=fe((()=>xn(s()))),B=fe((()=>xn(a()))),D=fe((()=>a()/s())),O=fe((()=>ls(_,"$isInteractiveExpectation$",i)||n())),F=ke(!1),j=ke(""),z=ke(0),q=ke(0),H=ke(0),U=fe((()=>({containerWidth:ui(q),translateXPx:ui(z),translateYPx:k&&$?-36:-16,active:ui(F)&&d()&&!ui(O)&&!R&&!o(),pointer:!f.features.timelinePreview||!$||l()}))),W=I("aria_timeline"),Q=fe((()=>I("aria_timeline_value",{position:ui(B),duration:ui(N)})));function G(e){return C&&k?C(e*s())/s():e}function K(e){p.actions.internal.completeScrubbing(G(e)),_e(F,!1),t.onSliderPointerUp?.()}function Y(e,t,i){_e(H,G(e),!0),_e(z,t,!0),i&&_e(q,i,!0),_e(j,function(e){let t=xn((l()?1-e:e)*s());return l()?`-${t}`:t}(e),!0)}let X=fe((()=>ls(A,"$disabledControls$",i).has("TIMELINE")));var J=Zc(),Z=Xe(J);Wc(Z,ps((()=>ui(U)),{get leftOffset(){return t.tooltipLeftOffset},get rightOffset(){return t.tooltipRightOffset},children:(e,t)=>{var i=Ei(),r=Xe(i),a=e=>{Xc(e,{get time(){return ui(j)},get isMobile(){return u()},get videoEpisodes(){return ui(V)},get previewThumbsData(){return $},get progress(){return ui(H)},get duration(){return s()},get isInteractive(){return k}})},n=e=>{var t=Jc(),i=Ye(t,!0);ze(t),nt((()=>ji(i,ui(j)))),Ai(e,t)};Ji(r,(e=>{f.features.timelinePreview&&$&&!l()?e(a):e(n,!1)})),Ai(e,i)},$$slots:{default:!0}})),Bu(Je(Z,2),{className:"timeline-slider",get isActiveLive(){return ls(y,"$isActiveLive$",i)},get isMobile(){return u()},get ariaLabel(){return W},ariaValueMin:0,get ariaValueMax(){return s()},get ariaValueNow(){return a()},get ariaValueText(){return ui(Q)},get loadedProgress(){return ls(m,"$bufferedProgress$",i)},get filledProgress(){return ui(D)},get handleProgress(){return ui(D)},get videoEpisodes(){return ui(V)},onPointerDown:function(e,i){t.onSliderPointerDown?.(i),p.actions.internal.startScrubbing(G(e))},onHandleMove:function(e){n()||p.actions.internal.progressScrubbing(G(e))},onPointerMove:function(e,i,r,s){t.onSliderMove?.(s,e),Y(e,i,r),_e(F,!0)},onPointerUp:K,onPointerEnter:function(e,i,r){t.onSliderPointerEnter?.(e),Y(e,i,r),_e(F,!0)},onPointerLeave:function(){_e(F,!1),t.onSliderLeave?.()},get onMouseEnter(){return P},get onMouseLeave(){return M},get onDisabledClick(){return E},get isInteractive(){return k},get disabled(){return ui(X)},get handleAlwaysVisible(){return o()},get hideHandel(){return n()},testId:"progress_bar",onContextMenu:K,get ref(){return h()},set ref(e){h(e)}}),Ai(e,J),se(),r()}var ih={hash:"s-g",code:".timeline-ads-slider{--slider-bg:var(--timeline-slider-bg);--slider-filled-bg:var(--timeline-slider-filled-bg);--slider-handle-bg:var(--timeline-slider-handle-bg);--slider-loaded-bg:var(--timeline-slider-loaded-bg)}"};function rh(e,t){re(t,!0),fr(e,ih);let[i,r]=us(),s=ms(t,"position",3,0),a=ms(t,"duration",3,0),n=Os(),o=n.ui.isMobile,l=n.ui.t,u=fe((()=>xn(a()))),d=fe((()=>xn(s()))),c=fe((()=>s()/a())),h=fe((()=>l("aria_timeline_value",{position:ui(d),duration:ui(u)}))),p=fe((()=>Math.round(100*ui(c))));Bu(e,{className:"timeline-ads-slider",ariaValueMin:0,get ariaValueMax(){return a()},get ariaValueNow(){return ui(p)},get ariaValueText(){return ui(h)},get filledProgress(){return ui(c)},hideHandel:!0,get squareBorders(){return ls(o,"$isMobile",i)}}),se(),r()}var sh=Ti("<div><!></div>"),ah=Ti("<div></div>"),nh={hash:"s-c",code:".timeline.s-c{align-items:center;bottom:0;box-sizing:border-box;display:flex;min-width:86px;pointer-events:all;position:relative;width:100%}.timeline.mobile.s-c{height:16px;margin-top:6px;padding:6px 12px 7px}.withoutPadding.s-c{padding:0}.timeline-stub.s-c{min-width:20px;width:100%}.timeline-stub.mobile.s-c{height:8px}"};function oh(e,t){re(t,!0),fr(e,nh);let[i,r]=us(),s=()=>ls(p,"$isLive$",i),a=()=>ls(g,"$isMobile",i),n=ms(t,"isAds",3,!1),o=ms(t,"isHidden",3,!1),l=ms(t,"timelineNotAvailable",3,!1),u=ms(t,"needPadding",3,!0),d=ms(t,"ref",15,void 0),c=Os(),h=ys(),p=c.state.isLive$,f=c.ads.duration,m=c.ads.position,g=c.ui.isMobile,v=rs(!1),b=fe((()=>!l()&&(!s()||s()&&t.canRewindLive&&t.isRewindableLive||n())));var y=Ei(),S=Xe(y),w=e=>{var r=sh();let s;var l=Ye(r),c=e=>{rh(e,{get position(){return ls(m,"$adPosition",i)},get duration(){return ls(f,"$adDuration",i)}})},p=e=>{th(e,{get tooltipLeftOffset(){return t.tooltipLeftOffset},get tooltipRightOffset(){return t.tooltipRightOffset},get showTimeline(){return ui(b)},get withEpisodes(){return t.withEpisodes},get onSliderMove(){return t.onSliderMove},get onSliderPointerDown(){return t.onSliderPointerDown},get onSliderPointerUp(){return t.onSliderPointerUp},get onSliderLeave(){return t.onSliderLeave},get onSliderPointerEnter(){return t.onSliderPointerEnter},get ref(){return d()},set ref(e){d(e)}})};Ji(l,(e=>{n()?e(c):e(p,!1)})),ze(r),mr(r,(()=>In(o()&&h.features.usePerformanceFix,v,h.disableInvisibleComponentsTimeout))),nt((e=>s=wr(r,1,"timeline s-c",null,s,e)),[()=>({withoutPadding:!u(),mobile:a(),"out-of-flow":ls(v,"$disabled",i)})]),Ai(e,r)},$=e=>{var t=ah();let i;nt((e=>i=wr(t,1,"timeline-stub s-c",null,i,e)),[()=>({mobile:a()})]),Ai(e,t)};Ji(S,(e=>{ui(b)?e(w):e($,!1)})),Ai(e,y),se(),r()}var lh=(e,t,i,r,s,a,n)=>{_e(t,!0),_e(i,e.clientX,!0),_e(r,ui(s),!0),a(n())},uh=Ti("<div></div>"),dh=Ti('<div><div class="track s-2b"></div></div>'),ch={hash:"s-2b",code:'.root.s-2b{display:flex;height:var(--preview-track-frame-height-horizontal);overflow:hidden;position:relative;width:100%}.root.is-vertical-video.s-2b,.root.vertically-rotated.s-2b{height:var(--preview-track-frame-height-vertical)}.root.s-2b:after{background-color:#fff;box-shadow:0 2px 2px 0 rgba(0,0,0,.12);box-shadow:0 0 2px 0 rgba(0,0,0,.06);content:"";height:100%;margin:0 auto;pointer-events:none;width:3px;z-index:1}.track.s-2b{bottom:0;display:flex;left:0;padding:0 50%;top:0}.frame.s-2b,.track.s-2b{position:absolute}.frame.s-2b{background-position-x:calc(var(--column-index)*-1*var(--frame-width));background-position-y:calc(var(--frame-height)*-1*var(--row-index));background-size:calc(var(--frame-width)*var(--column-numbers)) calc(var(--frame-height)*var(--row-numbers));flex-shrink:0;height:var(--frame-height);pointer-events:none;transform-origin:center;width:var(--frame-width)}.vertically-rotated.s-2b .frame:where(.s-2b){transform-origin:0 0}.rotate-1.s-2b{transform:rotate(-90deg) translateX(-100%)}.rotate-2.s-2b{transform:rotate(-180deg)}.rotate-3.s-2b{transform:rotate(-270deg) translateY(-100%)}'};function hh(e,t){re(t,!0),fr(e,ch);let[i,r]=us(),s=()=>ls(y,"$rotateAlpha",i),a=()=>ls(p,"$duration$",i),n=Os(),{countPerImage:o=0,countPerRow:l=0,countTotal:u=0,links:d=[],frameHeight:c=0,frameWidth:h=0}=n.actions.internal.getPreviewThumbsData()||{},{duration$:p,positionWithScrubbing$:f}=n.state,{startScrubbing:g,progressScrubbing:v,completeScrubbing:b}=n.actions.internal,y=n.ui.rotateAlpha,S=ke(void 0),w=ke(!1),$=ke(0),x=ke(0),k=ke(0),T=ke(0),_=fe((()=>c<=h)),C=fe((()=>Id(s()))),E=fe((()=>ui(_)?!ui(C):ui(C))),A=fe((()=>ui(E)?114:65)),L=fe((()=>ui(_)?114:65)),P=fe((()=>ui(_)?"var(--preview-track-frame-height-horizontal)":"var(--preview-track-frame-height-vertical)")),M=fe((()=>u*ui(A))),I=ke(0);rt((()=>{_e(T,Math.ceil(-ui(k)/ui(A))-1),_e(k,-ui(M)*ls(f,"$position$",i)/a())}));let R=()=>a()*-ui(k)/ui(M)/a(),V=!1,N=e=>{ui(w)&&(_e(w,!1),!V&&e&&_e(k,-(e.offsetX-ui(I)/2)),V=!1,b(R(),!0))},B=fe((()=>o/l)),D=(e,t)=>{if(e!==d.length-1)return l;let i=0,r=t*l;for(let t=1;t<=l;t++)e*o+i+r<u&&i++;return i},O=fe((()=>Math.floor(ui(T)/o))),F=fe((()=>(0,m.getRangeAroundIndex)(3,ui(O),d.length-1))),j=fe((()=>[`--row-numbers: ${ui(B)}`,`--column-numbers: ${l}`,`--frame-width: ${ui(L)}px`,`--frame-height: ${ui(P)}`].join(";")));var z=dh();let q;var H=Ye(z);H.__pointerdown=[lh,w,$,x,k,g,R],H.__pointermove=e=>{if(!ui(w))return!1;let t=e.clientX-ui($);_e(k,ui(x)+t),_e(k,Math.max(Math.min(ui(k),0),-ui(M)),!0),Math.abs(t)>1&&(V=!0),v(R())},H.__pointerup=N,sr(H,20,(()=>ui(F)),(e=>e),((e,t)=>{var i=Ei();sr(Xe(i),16,(()=>Array.from({length:ui(B)},((e,t)=>t))),(e=>e),((e,i)=>{var r=Ei();sr(Xe(r),16,(()=>Array.from({length:D(t,i)},((e,t)=>t))),(e=>e),((e,r)=>{var a=uh();nt(((e,t)=>{xr(a,e),wr(a,1,t,"s-2b")}),[()=>`--row-index: ${i}; --column-index: ${r}; left: ${((e,t,i)=>e*(o*ui(A))+t*ui(A)*l+ui(I)/2-1.5+i*ui(A))(t,i,r)}px; background-image: url(${d[t]});`,()=>"frame rotate-"+Math.abs(s())/90%4]),Ai(e,a)})),Ai(e,r)})),Ai(e,i)})),ze(H),ze(z),Xr(z,(e=>_e(S,e)),(()=>ui(S))),nt((e=>{q=wr(z,1,"root s-2b",null,q,e),xr(z,ui(j)),xr(H,`transform: translateX(${ui(k)}px); width: ${ui(M)}px;`)}),[()=>({"is-vertical-video":!ui(_),"vertically-rotated":ui(C)})]),Si("mouseleave",H,(()=>{ui(w)&&N()})),Kr(z,"clientWidth",(e=>_e(I,e))),Ai(e,z),se(),r()}wi(["pointerdown","pointermove","pointerup"]);var ph=Ti('<div class="notification s-2c"><span class="description s-2c"> </span></div>'),fh={hash:"s-2c",code:".notification.s-2c{background:var(--notification-bg);border-radius:var(--notification-radius);padding:9px 14px 10px 12px}.description.s-2c{font-size:14px;line-height:18px}"};var mh=Ti('<div class="preview-track-close tooltip s-28"><!></div>'),gh=Ti('<div class="preview-track-control s-28"><!> <div class="preview-track-close s-28"><!></div> <!></div>'),vh=Ti('<div class="wrapper-preview-track s-28"><!></div>'),bh=Ti('<div class="enriched-timeline s-28"><!> <!> <!></div>'),yh={hash:"s-28",code:".enriched-timeline.s-28{padding:var(--timeline-padding-vertical-top) var(--timeline-padding-horizontal) var(--timeline-padding-vertical-bottom);pointer-events:auto;position:relative}.preview-track-control.s-28{align-items:center;display:flex;justify-content:center;left:0;padding:0 calc(var(--timeline-padding-horizontal));pointer-events:none;position:absolute;right:0;top:calc((var(--timeline-height) + var(--preview-track-controls-top))*-1)}.preview-track-close.s-28{pointer-events:auto;position:absolute;right:calc(var(--timeline-padding-horizontal))}.preview-track-close.tooltip.s-28{bottom:32px;opacity:0;transition:opacity .2s}.preview-track-close.s-28:hover+.tooltip:where(.s-28){opacity:1}.wrapper-preview-track.s-28{box-sizing:border-box;left:0;overflow:hidden;padding:0 calc(var(--timeline-padding-horizontal));position:absolute;right:0;z-index:-1}"};function Sh(e,t){re(t,!0),fr(e,yh);let[i,r]=us(),s=()=>ls(c,"$previewTrackActive",i),a=ms(t,"timelineRef",15,void 0),n=Os(),{positionWithScrubbing$:o,isRewindableLive$:l,duration$:u}=n.state,{playerSize:d,previewTrackActive:c}=n.ui,{countPerImage:h=0,links:p=[],frequency:f=0}=n.actions.internal.getPreviewThumbsData()||{},g=fe((()=>ls(d,"$playerSize",i).width>100)),v=ke(!function(){let e=m.safeStorage.get(ta);try{return!!e&&JSON.parse(e)}catch{return!1}}()),b=()=>{ui(v)&&(m.safeStorage.set(ta,JSON.stringify(!0)),_e(v,!1))},y=e=>{let t=Math.floor(ls(u,"$duration$",i)*e/f),r=Math.floor(t/h),s=(0,m.getRangeAroundIndex)(3,r,p.length-1);for(let e of s){(new Image).src=p[e]}};var S=bh(),w=Ye(S),$=e=>{var t=gh(),r=Ye(t);let s=fe((()=>xn(ls(o,"$position$",i))));!function(e,t){fr(e,qc);var i=zc(),r=Ye(i,!0);ze(i),nt((()=>ji(r,t.time))),Ai(e,i)}(r,{get time(){return ui(s)}});var a=Je(r,2);Wo(Ye(a),{onClick:()=>n.actions.internal.closePreviewTrack()}),ze(a);var l=Je(a,2),u=e=>{var t=mh();(function(e,t){re(t,!1),fr(e,fh);let{ui:{t:i}}=Os();Jr();var r=ph(),s=Ye(r),a=Ye(s,!0);ze(s),ze(r),nt((e=>ji(a,e)),[()=>i("preview_track_close_tooltip")],me),Ur(3,r,(()=>jc),(()=>({duration:340}))),Ai(e,r),se()})(Ye(t),{}),ze(t),Ai(e,t)};Ji(l,(e=>{ui(v)&&e(u)})),ze(t),Si("mouseleave",a,b),Ur(3,t,(()=>jc),(()=>({duration:200}))),Ai(e,t)};Ji(w,(e=>{s()&&e($)}));var x=Je(w,2);let k=fe((()=>!ui(g)));oh(x,{get isHidden(){return ui(k)},get isAds(){return t.isAds},get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return ls(l,"$isRewindableLive$",i)},onSliderMove:(e,i)=>{y(i),!s()&&t.onTimelineMove(e)},get onSliderPointerDown(){return t.onTimelinePointerDown},get onSliderPointerUp(){return t.onTimelinePointerUp},get onSliderLeave(){return t.onTimelinePointerLeave},onSliderPointerEnter:y,get ref(){return a()},set ref(e){a(e)}});var T=Je(x,2),_=e=>{var i=vh();hh(Ye(i),{}),ze(i),nt((()=>xr(i,`height: ${t.animatedPreviewTrackHeight}px;`))),Ai(e,i)};Ji(T,(e=>{t.previewTrackAvailable&&e(_)})),ze(S),nt((()=>xr(S,`transform: translateY(${t.animatedOffsetY}px);`))),Ai(e,S),se(),r()}var wh=Ti('<div><!> <div class="controls s-12" data-testid="player_controls"><div class="controls-left s-12"><!> <!> <!></div> <div class="controls-right s-12"></div></div></div> <!>',1),$h={hash:"s-12",code:'.wrapper-bottom.s-12{bottom:0;box-sizing:border-box;display:flex;flex-direction:column;justify-content:flex-end;left:0;pointer-events:none;position:absolute;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);width:100%;will-change:transform;z-index:var(--controls-container-z-index)}.wrapper-bottom.s-12:before{background:var(--controls-gradient);content:"";height:var(--controls-gradient-height);position:absolute;width:100%}.wrapper-bottom.s-12>:where(.s-12){pointer-events:auto}.controls.s-12{align-items:center;box-sizing:border-box;display:flex;font-size:13px;height:var(--controls-height);justify-content:space-between;padding:0 var(--controls-desktop-padding-horizontal) 4px;white-space:nowrap;width:100%}.controls-left.s-12,.controls-right.s-12{align-content:center;display:flex}.controls-left.s-12{flex-grow:1;min-width:0;overflow:hidden}.controls-left.s-12 >:not(:first-child),.controls-right.s-12 >*{margin-left:var(--controls-desktop-item-margin-left)}.controls-hidden.s-12{transform:translateY(100%);visibility:visible}.wrapper-bottom.no-smooth.s-12{transition:none}'};function xh(e,t){re(t,!0),fr(e,$h);let[i,r]=us(),s=()=>ls(Le,"$disabledControls$",i),a=()=>ls(ce,"$playbackState$",i),n=()=>ls(me,"$isEnded$",i),o=()=>ls(He,"$currentGridType$",i),l=()=>ls(ge,"$isLive$",i),u=()=>ls(Ce,"$chromecastState$",i),d=()=>ls(ye,"$isPictureInPictureActive",i),c=()=>ls(Se,"$pictureInPictureType$",i),h=()=>ls(dt,"$graphIsOpened$",i),p=()=>ls(je,"$isFullscreen",i),g=()=>ls(ui(Jt),"$prevButton",i),v=()=>ls(ui(Zt),"$replayButton",i),b=()=>ls(ui(ei),"$playButton",i),y=()=>ls(ui(ti),"$nextButton",i),S=()=>ls(ui(ii),"$playPrevChapterButton",i),w=()=>ls(ui(ri),"$seekToInteractiveButton",i),$=()=>ls(ui(si),"$interactiveGraphButton",i),x=()=>ls(ui(ai),"$liveButton",i),k=()=>ls(ui(ni),"$time",i),T=()=>ls(ui(oi),"$episodes",i),_=()=>ls(ui(li),"$vkLogo",i),C=()=>ls(ui(ci),"$volume",i),E=()=>ls(ui(hi),"$subtitles",i),A=()=>ls(ui(pi),"$settings",i),L=()=>ls(ui(fi),"$context",i),P=()=>ls(ui(mi),"$fullscreen",i),M=()=>ls(ui(gi),"$chromecast",i),I=()=>ls(Ue,"$additionalDesktopControlPanelRightButtons$",i),R=()=>ls(Zi,"$previewTrackActive",i),V=()=>ls(we,"$settingsMenuVisible",i),N=()=>ls(xi,"$settingButtonRef$",i),B=()=>ls(Re,"$startedByKeyboard$",i),D=()=>ls(K,"$fakeIsPlaying$",i),O=()=>ls(tr,"$previewTrackAvailable",i),F=()=>ls(er,"$previewTrackDragInProgress",i),j=()=>ls(de,"$position$",i),z=()=>ls(ue,"$duration$",i),q=ms(t,"playerControlsWrapperRef",15,void 0),H=ms(t,"playerControlsRef",15,void 0),U=ms(t,"isAds",3,!1),W=ms(t,"logoTargetUrl",3,""),Q=ms(t,"isOneVideoPlaylist",3,!1),G=ms(t,"customFullscreenSupported",3,!0),{fakeIsPlaying$:K}=Fs(),Y=Os(),X=Fs(),J=ys(),Z=Y.actions.internal.toggleMuted,ee=Y.actions.internal.togglePlay,te=Y.actions.internal.pause,ie=Y.actions.internal.toggleSubtitle,ae=Y.actions.internal.checkFullscreenSupport,ne=Y.callbacks?.onAudioDoesNotExistHint,oe=Y.callbacks?.onAudioDisabledHint,ue=Y.state.duration$,de=Y.state.positionWithScrubbing$,ce=Y.state.playbackState$,he=Y.state.isAudioAvailable$,pe=Y.state.isAudioDisabled,me=Y.state.isEnded$,ge=Y.state.isLive$,ve=Y.state.isActiveLive$,be=Y.state.isRewindableLive$,{isActive$:ye,type$:Se}=X.pictureInPicture$,we=Y.ui.settingsMenu.visible$,$e=Y.ui.settingsMenu.openedByBtnKeyboard$,xe=Y.ui.controls,Te=Y.actions.internal.getVideoEpisodes(),Ce=Y.state.chromecastState$,Ee=Y.state.availableSubtitlesList$,Ae=Y.state.currentSubtitle$,Le=xe.disabledControls$,Pe=Y.ui.contextMenu.visible$,Me=Y.ui.contextMenu.showContextMenuBtn$,Ie=Y.ui.contextMenu.openedByBtnKeyboard$,Re=Y.ui.startedByKeyboard$,Ve=Y.ui.controlBlocks,Ne=Y.ui.previewTrackNotificationVisible,Be=Y.ui.t,De=Y.ads.duration,Oe=Y.ads.position,Fe=Y.ads.playbackState,je=Y.ui.isFullscreen,qe=Y.ui.playerSize,He=Y.ui.currentGridType$,Ue=Y.ui.additionalDesktopControlPanelRightButtons$,We=Y.ui.autoplayNextEnabled$,Qe=Y.actions.internal.getVideoElement,Ge=Y.actions.internal.replayInteractive,Ke=Y.actions.internal.prevVideoClick,Ze=Y.actions.internal.nextVideoClick,et=Y.state.isInteractive,tt=Y.state.isInteractiveTime$,it=Y.state.showInteractiveGraph,st=Y.state.showSeekToInteractive,at=Y.state.showPlayPrevChapter,ot=Y.state.showInteractiveTimeIndicator,lt=Y.state.playPrevChapterDisabledTooltip,ut=X.seekToInteractiveDisabledTooltip$,dt=X.graphIsOpened$,ct=J.features.interactiveResponsiveUi,ht=fe((()=>s().has("EPISODE_BUTTON"))),pt=fe((()=>s().has("GRAPH_BUTTON"))),ft=fe((()=>s().has("SEEK_TO_INTERACTIVE_BUTTON"))),mt=fe((()=>s().has("PLAY_BUTTON"))),gt=fe((()=>s().has("REPLAY_BUTTON"))),vt=fe((()=>s().has("PLAY_PREV_CHAPTER_BUTTON"))),bt=()=>Y.actions.internal.toggleChromecast(),yt=fe((()=>U()?"playing"===ls(Fe,"$adPlaybackState",i):a()===f.PlaybackState.PLAYING)),St=fe((()=>"off"!==ls(Ae,"$currentSubtitle$",i).value)),wt=fe((()=>n()&&!U()||et)),$t=fe((()=>ct?ui(wt)&&Du(o(),"m"):ui(wt))),xt=fe((()=>!n()||et||U())),kt=fe((()=>Du(o(),"m"))),Tt=fe((()=>t.showNextPrevButtons&&Du(o(),"m")&&!U()&&t.nextButtonActive)),_t=fe((()=>t.showNextPrevButtons&&Du(o(),"m")&&!U()&&t.prevButtonActive)),Ct=fe((()=>!U()&&!!l())),Et=fe((()=>u()!==f.ChromecastState.NOT_AVAILABLE&&!(d()&&1===c())&&Du(o(),"m")&&!et)),At=fe((()=>t.showAutoplayNext&&!Q()&&Du(o(),"s"))),Lt=fe((()=>ls(Ee,"$availableSubtitlesList$",i).length>0&&Du(o(),"m"))),Pt=fe((()=>ls(Ie,"$contextMenuOpenedByKeyboard$",i)||ls(Me,"$showContextMenuBtn$",i))),Mt=fe((()=>Du(o(),"s")&&!U())),It=fe((()=>!t.logoHidden&&!U())),Rt=fe((()=>J.features.fullscreen&&ae()&&(t.logoHidden||Du(o(),ct?"xs":"s"))&&!(d()&&1===c())&&(!et||G()))),Vt=fe((()=>(!l()||U())&&!(J.features.interactiveHideTime&&et))),Nt=fe((()=>it&&Du(o(),"m"))),Bt=fe((()=>ct?st&&Du(o(),"s"):st)),Dt=fe((()=>ct?at&&Du(o(),"s"):at)),Ot=fe((()=>!U()&&!l()&&!!Te?.length&&ui(kt)&&!ui(ht))),Ft=fe((()=>!ls(be,"$isRewindableLive$",i)||!!ls(ve,"$isActiveLive$",i))),jt=fe((()=>h()?Be("tooltip_interactive_graph_on"):Be("tooltip_interactive_graph_off"))),zt=fe((()=>ls(Pe,"$contextMenuVisible$",i)?Be("tooltip_context_menu_close"):Be("tooltip_context_menu_open"))),qt=fe((()=>{return e=ui(Ft),t=a(),e?t&&t===f.PlaybackState.PAUSED?Be("tooltip_play"):"":Be("tooltip_live");var e,t})),Ht=fe((()=>"vk_video"===J.logoType?Be("tooltip_vk_video_logo"):Be("tooltip_vk_logo"))),Ut=fe((()=>ui(St)?Be("tooltip_subtitles_on"):Be("tooltip_subtitles_off"))),Wt=fe((()=>p()?Be("tooltip_fullscreen_on"):Be("tooltip_fullscreen_off"))),Qt=fe((()=>u()===f.ChromecastState.CONNECTED?Be("tooltip_chromecast_on"):Be("tooltip_chromecast_off"))),Gt=fe((()=>ls(We,"$autoplayNextEnabled",i)?Be("tooltip_autoplay_on"):Be("tooltip_autoplay_off"))),Kt=ke(0),Yt=le({}),Xt=le({}),Jt=fe((()=>xe.prevButton)),Zt=fe((()=>xe.replayButton)),ei=fe((()=>xe.playButton)),ti=fe((()=>xe.nextButton)),ii=fe((()=>xe.playPrevChapterButton)),ri=fe((()=>xe.seekToInteractiveButton)),si=fe((()=>xe.interactiveGraphButton)),ai=fe((()=>xe.liveButton)),ni=fe((()=>xe.time)),oi=fe((()=>xe.episodes)),li=fe((()=>xe.vkLogo)),ci=fe((()=>xe.volume)),hi=fe((()=>xe.subtitles)),pi=fe((()=>xe.settings)),fi=fe((()=>xe.context)),mi=fe((()=>xe.fullscreen)),gi=fe((()=>xe.chromecast)),vi=fe((()=>({prevButton:g()?g().right-g().left:0,replayButton:v()?v().right-v().left:0,playButton:b()?b().right-b().left:0,nextButton:y()?y().right-y().left:0,playPrevChapterButton:S()?S().right-S().left:0,seekToInteractiveButton:w()?w().right-w().left:0,interactiveGraphButton:$()?$().right-$().left:0,liveButton:x()?x().right-x().left:0,time:k()?k().right-k().left:0,episodes:T()?T().right-T().left:0,vkLogo:_()?_().right-_().left:0,volume:C()?C().right-C().left:0,subtitles:E()?E().right-E().left:0,settings:A()?A().right-A().left:0,context:L()?L().right-L().left:0,fullscreen:P()?P().right-P().left:0,chromecast:M()?M().right-M().left:0,additionalButtons:I().length?I().reduce((e=>[...e,40]),[]):[]}))),bi=ke(0);rt((()=>{(!ui(bi)||ui(bi)<ui(vi).time)&&di((()=>_e(bi,ui(vi).time,!0)))}));let yi=ke(!1);rt((()=>{let e=0;ui(Ot)&&(e=Du(o(),"xl")?ui(vi).time:60);let t=ui(vi).prevButton+ui(vi).playButton+ui(vi).nextButton+ui(vi).seekToInteractiveButton+ui(vi).interactiveGraphButton+ui(vi).liveButton+ui(bi)+e;_e(yi,ui(Vt)&&ui(Kt)>=t,!0)}));let Si=fe((()=>ui(yi)&&Du(o(),"m"))),wi=(0,m.debounceFn)(Dd,260),$i=(0,m.debounceFn)(Oc,260);rt((()=>{ls(qe,"$playerSize",i),ls(tt,"$isInteractiveTime$",i),R(),wi(Qe(),xe,Yt,t.showControls),$i(Qe(),Ve,Xt,t.showControls)})),rt((()=>{Xt.bottom=q()}));let xi=rs();function ki(){ol({isAudioDisabled:pe,isAudioAvailable:ls(he,"$isAudioAvailable$",i),isAds:U(),audioIsNotExistHintCallback:ne,audioDisabledHintCallback:oe})&&Z()}rt((()=>{V(),N()&&di((()=>Wn(N(),V(),$e)))})),rt((()=>{B(),di((()=>Od(Re,B(),undefined)))}));let Ti,_i=et?Ge:ee,Ci=fe((()=>null!==D())),Li=fe((()=>ui(Ci)?D():ui(yt))),Pi=fe((()=>ui(Li)?Be("tooltip_pause"):Be("tooltip_play"))),Mi=Be("tooltip_episodes"),Ii=fe((()=>ui(_t)?{id:"prevButton",type:"desktop-control-panel-left",weight:Qd,buttonComponent:ac,buttonComponentProps:{disabled:!t.prevButtonActive,type:"prev",click:Ke.bind(null,!0)},tooltipEnabled:!Y.callbacks?.uiInfo?.onPrevButtonMouseEnter&&!Y.callbacks?.uiInfo?.onPrevButtonMouseLeave,mouseEnter:()=>{Y.callbacks?.uiInfo?.onPrevButtonMouseEnter?.(Vd(Qe(),Yt,"prevButton",t.showControls))},mouseLeave:()=>{Y.callbacks?.uiInfo?.onPrevButtonMouseLeave?.(Vd(Qe(),Yt,"prevButton",t.showControls))},tooltipText:Be("tooltip_previous"),disabled:!t.prevButtonActive}:void 0)),Ri=fe((()=>ui($t)?{id:"replayButton",type:"desktop-control-panel-left",weight:Gd,buttonComponent:cc,buttonComponentProps:{disabled:ui(gt),click:_i},tooltipText:Be("tooltip_restart"),disabled:ui(gt)}:void 0)),Vi=fe((()=>ui(xt)?{id:"playButton",type:"desktop-control-panel-left",weight:Kd,buttonComponent:gc,buttonComponentProps:{disabled:ui(mt),isPlaying:ui(yt),click:ee},tooltipText:ui(Pi),disabled:ui(mt)}:void 0)),Ni=fe((()=>ui(Tt)?{id:"nextButton",type:"desktop-control-panel-left",weight:Yd,buttonComponent:ac,buttonComponentProps:{disabled:!t.nextButtonActive,type:"next",click:Ze.bind(null,!0)},tooltipEnabled:!Y.callbacks?.uiInfo?.onNextButtonMouseEnter&&!Y.callbacks?.uiInfo?.onNextButtonMouseLeave,mouseEnter:()=>{Y.callbacks?.uiInfo?.onNextButtonMouseEnter?.(Vd(Qe(),Yt,"nextButton",t.showControls))},mouseLeave:()=>{Y.callbacks?.uiInfo?.onNextButtonMouseLeave?.(Vd(Qe(),Yt,"nextButton",t.showControls))},tooltipText:Be("tooltip_next"),disabled:!t.nextButtonActive}:void 0)),Bi=fe((()=>et&&ui(Dt)?{id:"playPrevChapterButton",type:"desktop-control-panel-left",weight:Xd,buttonComponent:bc,buttonComponentProps:{disabled:ui(vt),click:t.playPrevChapter},tooltipText:Be("tooltip_interactive_go_back"),disabledTooltipContent:Be(lt),disabled:ui(vt)}:void 0)),Di=fe((()=>et&&ui(Bt)?{id:"seekToInteractiveButton",type:"desktop-control-panel-left",weight:Jd,buttonComponent:xc,buttonComponentProps:{disabled:ui(ft),click:t.seekToInteractive},tooltipText:Be("tooltip_interactive_seek"),disabled:ui(ft),disabledTooltipContent:Be(ls(ut,"$seekToInteractiveDisabledTooltip$",i))}:void 0)),Oi=fe((()=>et&&ui(Nt)?{id:"interactiveGraphButton",type:"desktop-control-panel-left",weight:Zd,buttonComponent:_c,buttonComponentProps:{disabled:ui(pt),click:dt.toggle,graphIsOpened:h()},tooltipText:ui(jt)}:void 0)),Fi=fe((()=>ui(Ct)?{id:"liveButton",type:"desktop-control-panel-left",weight:ec,buttonComponent:Cc,buttonComponentProps:{isLiveActive:ui(Ft),ariaLabel:ui(qt)},tooltipText:ui(qt),disabled:ui(Ft)&&a()===f.PlaybackState.PLAYING}:void 0)),ji=fe((()=>[ui(Ii),ui(Ri),ui(Vi),ui(Ni),ui(Bi),ui(Di),ui(Oi),ui(Fi)].filter((e=>!!e)).sort(ho))),zi=fe((()=>ui(It)?{id:"vkLogo",type:"desktop-control-panel-right",weight:Pc,buttonComponent:Xu,buttonComponentProps:{targetUrl:W(),logoClickable:t.logoClickable,click:te},tooltipText:ui(Ht),disabledTooltipContent:"",disabled:!t.logoClickable}:void 0)),qi=fe((()=>ui(At)?{id:"autoplayNext",type:"desktop-control-panel-right",weight:Mc,buttonComponent:wc,tooltipText:ui(Gt)}:void 0)),Hi=fe((()=>({id:"volume",type:"desktop-control-panel-right",weight:Ic,buttonComponent:qu,buttonComponentProps:{click:ki,isAds:U()}}))),Ui=fe((()=>ui(Lt)?{id:"subtitles",type:"desktop-control-panel-right",weight:Rc,buttonComponent:iu,buttonComponentProps:{isSubtitlesEnabled:ui(St),click:ie},tooltipText:ui(Ut)}:void 0)),Wi=fe((()=>ui(Mt)?{id:"settings",type:"desktop-control-panel-right",weight:Vc,buttonComponent:Jl,buttonComponentProps:{ref$:xi},tooltipText:V()?void 0:Be("tooltip_settings_off")}:void 0)),Qi=fe((()=>J.features.contextMenuButton?{id:"context",type:"desktop-control-panel-right",weight:Nc,buttonComponent:jd,buttonComponentProps:{ariaLabel:Be("aria_label_context_menu")},className:ui(Pt)?"":"out-of-view",tooltipText:ui(zt)}:void 0)),Gi=fe((()=>ui(Rt)?{id:"fullscreen",type:"desktop-control-panel-right",weight:Bc,buttonComponent:Wu,buttonComponentProps:{isFullscreen:p(),click:t.toggleFullscreen},tooltipText:ui(Wt)}:void 0)),Yi=fe((()=>ui(Et)?{id:"chromecast",type:"desktop-control-panel-right",weight:Dc,buttonComponent:id,buttonComponentProps:{state:u(),click:bt},tooltipText:ui(Qt)}:void 0)),Xi=fe((()=>[ui(zi),ui(qi),ui(Hi),ui(Ui),ui(Wi),ui(Qi),ui(Gi),ui(Yi),...I()].filter((e=>!!e)).sort(ho))),Zi=Y.ui.previewTrackActive,er=Y.ui.previewTrackDragInProgress,tr=Y.ui.previewTrackAvailable,ir=Y.ui.isPreviewTrackHorizontallyAligned,rr=fe((()=>(({onPreviewTrackOpened:e,getTimelineRef:t,isHorizontal:i})=>{let r=fe((()=>i?65:114)),s=ke(!1),a=ke(0),n=ke(0),o=fe((()=>ui(r)+10-40-4)),l=fe((()=>(0,m.interpolate)(ui(a),[.2,1],[0,-ui(o)]))),u=fe((()=>(0,m.interpolate)(ui(a),[.2,1],[0,40]))),d=fe((()=>(0,m.interpolate)(ui(a),[.2,1],[0,ui(r)+10])));return{progressBarY:()=>ui(l),controlsY:()=>ui(u),calculatedHeight:()=>ui(d),onPointerDown:e=>{_e(n,t()?.getBoundingClientRect().bottom||0,!0),_e(s,!0)},onPointerMove:e=>{if(!ui(s))return;let t=Math.max(Math.min(e.clientY-ui(n),0),-ui(o));_e(a,Math.abs(t/ui(o)),!0)},onPointerUp:()=>{_e(s,!1),_e(a,ui(a)>=.5?1:0,!0),1===ui(a)&&e()},closePreviewTrack:()=>{_e(a,0)}}})({onPreviewTrackOpened:Y.actions.internal.previewTrackOpened,getTimelineRef:()=>Yt.timeline,isHorizontal:ls(ir,"$isPreviewTrackHorizontallyAligned$",i)}))),ar=fe((()=>ui(rr).progressBarY)),nr=fe((()=>ui(rr).controlsY)),or=fe((()=>ui(rr).onPointerDown)),lr=fe((()=>ui(rr).onPointerMove)),ur=fe((()=>ui(rr).onPointerUp)),dr=fe((()=>ui(rr).calculatedHeight)),cr=fe((()=>ui(rr).closePreviewTrack));rt((()=>{R()?Ne.set(!1):ui(cr)()})),Ki((()=>()=>Ti&&clearTimeout(Ti)));let hr=e=>{R()||!O()||(ui(or)(e),Ti=setTimeout((()=>{Y.actions.internal.previewTrackDragStarted()}),200))},pr=()=>{R()||ui(ur)(),Ti&&clearTimeout(Ti),F()&&Y.actions.internal.previewTrackDragFinished()},mr=e=>{ui(lr)(e),!R()&&O()&&!R()&&Ne.set(!0)},gr=()=>{Ne.set(!1)};var vr=wh(),br=Xe(vr);let yr;var Sr=Ye(br),$r=e=>{let i=fe((()=>ui(ar)())),r=fe((()=>ui(dr)()));Sh(e,{get animatedOffsetY(){return ui(i)},get animatedPreviewTrackHeight(){return ui(r)},get canRewindLive(){return t.canRewindLive},get isAds(){return U()},onTimelineMove:mr,onTimelinePointerDown:hr,onTimelinePointerUp:pr,onTimelinePointerLeave:gr,get previewTrackAvailable(){return O()},get timelineRef(){return Yt.timeline},set timelineRef(e){Yt.timeline=e}})};Ji(Sr,(e=>{t.showControls&&e($r)}));var kr=Je(Sr,2),Tr=Ye(kr),_r=Ye(Tr);sr(_r,17,(()=>ui(ji)),(e=>e.id),((e,i)=>{Wd(e,{get buttonComponent(){return ui(i).buttonComponent},get buttonComponentProps(){return ui(i).buttonComponentProps},get tooltipText(){return ui(i).tooltipText},get disabledTooltipContent(){return ui(i).disabledTooltipContent},get disabled(){return ui(i).disabled},get className(){return ui(i).className},get tooltipEnabled(){return ui(i).tooltipEnabled},get mouseEnter(){return ui(i).mouseEnter},get mouseLeave(){return ui(i).mouseLeave},get tooltipVisible(){return t.showControls},get ref(){return Yt[ui(i).id]},set ref(e){Yt[ui(i).id]=e}})}));var Cr=Je(_r,2),Er=e=>{let r=fe((()=>!t.showControls)),s=fe((()=>U()?ls(Oe,"$adPosition",i):j())),a=fe((()=>U()?ls(De,"$adDuration",i):z()));nu(e,{get isHidden(){return ui(r)},isMobile:!1,get showDuration(){return ui(Si)},get position(){return ui(s)},get duration(){return ui(a)},get ref(){return Yt.time},set ref(e){Yt.time=e}})};Ji(Cr,(e=>{ui(Vt)&&e(Er)}));var Ar=Je(Cr,2);let Lr=fe((()=>!ui(Ot)));Su(Ar,{className:"w-max",get disabled(){return ui(Lr)},get tooltipContent(){return Mi},get tooltipVisible(){return t.showControls},get ref(){return Yt.episodes},set ref(e){Yt.episodes=e},children:(e,t)=>{var i=Ei(),r=Xe(i),s=e=>{dd(e,{get position(){return j()},get duration(){return z()},get timeCodes(){return Te}})};Ji(r,(e=>{ui(Ot)&&e(s)})),Ai(e,i)},$$slots:{default:!0}}),ze(Tr);var Pr=Je(Tr,2);sr(Pr,21,(()=>ui(Xi)),(e=>e.id),((e,i)=>{var r=Ei(),s=Xe(r),a=e=>{Wd(e,{get buttonComponent(){return ui(i).buttonComponent},get buttonComponentProps(){return ui(i).buttonComponentProps},get tooltipText(){return ui(i).tooltipText},get disabledTooltipContent(){return ui(i).disabledTooltipContent},get disabled(){return ui(i).disabled},get className(){return ui(i).className},get tooltipVisible(){return t.showControls},get ref(){return Yt[ui(i).id]},set ref(e){Yt[ui(i).id]=e}})},n=e=>{let r=fe((()=>!!ui(i).disabled));!function(e,t){re(t,!0);let i=ms(t,"disabled",3,!1),r=ms(t,"onClick",3,m.noop),s=ms(t,"ref",15),a=fe((()=>r()===m.noop)),n=fe((()=>ui(a)||i())),o=fe((()=>ui(a)?"btn-full-opacity":""));Su(e,{get disabled(){return ui(n)},get tooltipContent(){return t.tooltipText},get disabledTooltipContent(){return t.disabledTooltipContent},width:40,get disableMouseupTooltipShow(){return t.disableMouseupTooltipShow},get tooltipVisible(){return t.tooltipVisible},get ref(){return s()},set ref(e){s(e)},children:(e,i)=>{let s=fe((()=>t.testId??t.id));Sl(e,{get className(){return ui(o)},get ariaLabel(){return t.ariaLabel},get click(){return r()},get disabled(){return ui(n)},get testId(){return ui(s)},children:(e,i)=>{Lc(e,{get icon(){return t.icon}})},$$slots:{default:!0}})},$$slots:{default:!0}}),se()}(e,{get id(){return ui(i).id},get testId(){return ui(i).testId},get icon(){return ui(i).icon},get ariaLabel(){return ui(i).ariaLabel},get tooltipText(){return ui(i).tooltipText},get disabledTooltipContent(){return ui(i).disabledTooltipContent},get disabled(){return ui(r)},get onClick(){return ui(i).onClick},get disableMouseupTooltipShow(){return ui(i).disableMouseupTooltipShow},get tooltipVisible(){return t.showControls},get ref(){return Yt[ui(i).id]},set ref(e){Yt[ui(i).id]=e}})};Ji(s,(e=>{(e=>!!e.buttonComponent)(ui(i))?e(a):e(n,!1)})),Ai(e,r)})),ze(Pr),ze(kr),Xr(kr,(e=>H(e)),(()=>H())),ze(br),Xr(br,(e=>q(e)),(()=>q()));var Mr=Je(br,2),Ir=e=>{Ud(e,{get ref(){return Yt.interactiveTimeIndicator},set ref(e){Yt.interactiveTimeIndicator=e}})};Ji(Mr,(e=>{ot&&e(Ir)})),nt(((e,t)=>{yr=wr(br,1,"wrapper-bottom s-12",null,yr,e),xr(kr,t),kr.inert=R()}),[()=>({hidden:t.bottomHidden,"controls-hidden":!t.showControls,"no-smooth":t.bottomNoSmooth||F()}),()=>`transform: translateY(${ui(nr)()}px);`]),Kr(Tr,"clientWidth",(e=>_e(Kt,e))),Ai(e,vr),se(),r()}var kh=Ti('<div class="icon icon-error-stub s-20"><div class="inner s-20"></div></div>'),Th=Ti('<img class="icon s-20" aria-hidden="true"/>'),_h={hash:"s-20",code:".icon.s-20{height:24px!important;width:24px!important}.inner.s-20{background-color:var(--white);height:16px;width:16px}"};var Ch=_i('<path d="M8.7 8.1 5.3 4.72A1 1 0 0 1 6.72 3.3L20.7 17.29a1 1 0 0 1-1.41 1.41L16 15.41V20a1 1 0 0 1-1 1c-.64 0-1.26-.25-1.72-.7L7.79 15H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2.77zm2.88-2.76 1.7-1.65A2.5 2.5 0 0 1 15 3a1 1 0 0 1 1 1v5.76z"></path>');function Eh(e,t){re(t,!0);let i=ms(t,"muted",3,!1),r=ms(t,"click",3,m.noop),s=ms(t,"ref",15,void 0),a=Os().ui.t,n=fe((()=>i()?a("tooltip_volume"):a("tooltip_volume_muted"))),o=fe((()=>i()?"btn-mobile-muted":"btn-mobile-unmuted"));Sl(e,{get testId(){return ui(o)},get click(){return r()},get ariaLabel(){return ui(n)},role:"button",get ref(){return s()},set ref(e){s(e)},children:(e,t)=>{var r=Ei(),s=Xe(r),a=e=>{!function(e){Ea(e,{testId:"muted-icon",children:(e,t)=>{Ai(e,Ch())},$$slots:{default:!0}})}(e)},n=e=>{du(e,{get size(){return"24"}})};Ji(s,(e=>{i()?e(a):e(n,!1)})),Ai(e,r)},$$slots:{default:!0}}),se()}var Ah=_i('<path d="M11.64 12.37 9.07 9.8h1.03a.9.9 0 1 0 0-1.8H6.9a.9.9 0 0 0-.9.9v3.2a.9.9 0 0 0 1.8 0v-1.02l2.53 2.52.13.14a.9.9 0 0 0 1.28-1.28z"></path>'),Lh=_i('<path d="m6.36 9.63 2.57 2.57H7.9a.9.9 0 1 0 0 1.8h3.2a.9.9 0 0 0 .9-.9V9.9a.9.9 0 0 0-1.8 0v1.02L7.67 8.4l-.13-.14a.9.9 0 0 0-1.28 1.28z"></path>'),Ph=_i('<path d="M7.66 4h6.68q1.2-.01 2 .04.83.06 1.53.38a4 4 0 0 1 1.7 1.7c.24.48.34.98.39 1.54q.05.8.04 2v1.44a.9.9 0 0 1-1.8 0V9.7c0-.85 0-1.44-.04-1.9-.03-.44-.1-.68-.19-.85a2 2 0 0 0-.92-.92 2 2 0 0 0-.85-.2c-.46-.03-1.04-.03-1.9-.03H7.7c-.85 0-1.44 0-1.9.04-.44.03-.68.1-.85.19a2 2 0 0 0-.92.92c-.09.17-.16.4-.2.85-.03.46-.03 1.05-.03 1.9v2.65c0 .85 0 1.44.04 1.9.03.44.1.68.19.85a2 2 0 0 0 .92.92c.17.08.4.15.85.19.46.03 1.04.04 1.9.04h2.4a.9.9 0 0 1 0 1.8H7.66q-1.2.01-2-.05a4 4 0 0 1-1.53-.38 4 4 0 0 1-1.7-1.7 4 4 0 0 1-.39-1.53q-.05-.8-.04-2V9.65q-.01-1.2.04-2c.05-.56.15-1.06.39-1.53a4 4 0 0 1 1.7-1.7c.47-.24.97-.34 1.53-.39q.8-.05 2-.04M13 16.8c0-.98 0-1.47.19-1.84a2 2 0 0 1 .77-.77c.37-.19.86-.19 1.84-.19h3.4c.98 0 1.47 0 1.85.19q.5.27.76.77c.19.37.19.86.19 1.84v.4c0 .98 0 1.47-.19 1.85a2 2 0 0 1-.77.76c-.37.19-.86.19-1.84.19h-3.4c-.98 0-1.47 0-1.85-.19a2 2 0 0 1-.76-.76c-.19-.38-.19-.87-.19-1.85z"></path><!>',1);function Mh(e,t){re(t,!0);let i=ms(t,"ref",15,void 0),r=ms(t,"isPictureInPictureActive",3,!1),s=ms(t,"click",3,m.noop),a=Da("menu_pip");Sl(e,{testId:"btn-pip",get ariaLabel(){return a},get click(){return s()},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e,t){let i=ms(t,"isActive",3,!1),r=fe((()=>i()?"pip-icon--active":"pip-icon"));Ea(e,{get testId(){return ui(r)},children:(e,t)=>{var r=Ph(),s=Je(Xe(r)),a=e=>{Ai(e,Ah())},n=e=>{Ai(e,Lh())};Ji(s,(e=>{i()?e(a):e(n,!1)})),Ai(e,r)},$$slots:{default:!0}})}(e,{get isActive(){return r()}})},$$slots:{default:!0}}),se()}var Ih=(e,t,i,r)=>{ui(t)&&i.onDisabledPlayPrevChapterClick(ui(r))},Rh=(e,t,i,r)=>{ui(t)&&i.onDisabledSeekToInteractiveClick(ui(r))},Vh=Ti("<div><!></div>"),Nh=Ti("<div><!></div>"),Bh=Ti("<div><!></div>"),Dh=Ti("<!> <!> <!>",1),Oh=Ti("<div></div> <div></div> <div><!> <!> <!> <!> <!> <!></div> <div><!> <!> <!> <!></div> <!>",1),Fh=Ti('<div class="wrapper-middle s-11"><!></div>'),jh=Ti("<div><!></div>  <!> <div><!></div>",1),zh=Ti('<div aria-hidden="true">·</div> <!>',1),qh=Ti('<!> <!> <div><div><div class="controls mobile s-11" data-testid="bottom-controls"><div class="controls-group contain s-11"><!> <!> <!> <!></div> <div class="controls-group s-11"><!> <!> <!></div></div> <!></div></div> <!>',1),Hh={hash:"s-11",code:".wrapper-bottom.s-11{background:var(--controls-gradient);bottom:0;box-sizing:border-box;display:flex;flex-direction:column;height:var(--controls-gradient-height);justify-content:flex-end;left:0;padding:0 4px 8px;pointer-events:none;position:absolute;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);width:100%;z-index:var(--controls-container-z-index)}.wrapper-bottom.s-11>:where(.s-11){pointer-events:auto}.wrapper-bottom.ads-timeline-mobile.s-11{height:9px;padding:0 4px 4px}.wrapper-middle.s-11{align-items:center;left:50%;top:50%;transform:translate(-50%,-50%)}.wrapper-middle.s-11,.wrapper-top-right.s-11{display:flex;position:absolute;transition:opacity var(--controls-transition-duration);z-index:var(--controls-container-z-index)}.wrapper-top-right.s-11{right:8px;top:4px}.wrapper-top-left.s-11{left:8px;position:absolute;top:4px;z-index:var(--controls-container-z-index)}.wrapper-middle-left.s-11,.wrapper-middle-left-second.s-11,.wrapper-middle-right.s-11{align-items:center;background-color:rgba(0,0,0,.56);border-radius:12px;display:flex;height:44px;justify-content:center;position:absolute;top:50%;transform:translateY(-50%);transition:opacity var(--controls-transition-duration);width:44px}.wrapper-middle-left.s-11{left:12px}.wrapper-middle-left-second.s-11{left:64px}.wrapper-middle-right.s-11{right:12px}.controls.s-11{align-items:center;box-sizing:border-box;font-size:13px;height:var(--controls-height);justify-content:space-between;padding:0 4px;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);white-space:nowrap;width:100%;will-change:transform}.controls.s-11,.controls-group.s-11{display:flex}.controls-group.contain.s-11{min-width:0}.controls-group.s-11 >:not(:first-child){margin-left:8px}.hidden.s-11{opacity:0;visibility:hidden}.controls-hidden.s-11{transform:translateY(100%);visibility:visible}.wrapper-bottom.no-smooth.s-11{transition:none}.overlay-mobile.s-11{background-color:rgba(0,0,0,.3);height:100%;left:0;pointer-events:none;position:absolute;top:0;transition:opacity var(--controls-transition-duration);width:100%}@media screen and (orientation:portrait){.wrapper-top-left.fullscreen.s-11,.wrapper-top-right.fullscreen.s-11{top:16px}.controls-wrapper.fullscreen.s-11{bottom:30px;position:absolute;width:calc(100% - 8px)}}@media screen and (orientation:landscape){.wrapper-top-left.fullscreen.s-11{left:44px;top:12px}.wrapper-top-right.fullscreen.s-11{right:44px;top:12px}.wrapper-middle-left.fullscreen.s-11{left:44px}.wrapper-middle-left-second.fullscreen.s-11{left:96px}.wrapper-middle-right.fullscreen.s-11{right:44px}.controls-wrapper.fullscreen.s-11{bottom:32px;left:36px;position:absolute;right:36px;width:calc(100% - 72px)}}"};function Uh(e,t){re(t,!0),fr(e,Hh);let[i,r]=us(),s=()=>ls(Ee,"$disabledControls$",i),a=()=>ls(Y,"$playbackState$",i),n=()=>ls(Ie,"$adPlaybackState",i),o=()=>ls(Z,"$isEnded$",i),l=()=>ls(Ve,"$playerSize",i),u=()=>ls(oe,"$scrubbingInProgress",i),d=()=>ls(Te,"$chromecastState$",i),c=()=>ls(de,"$isPictureInPictureActive",i),h=()=>ls(ce,"$pictureInPictureType$",i),p=()=>ls(ue,"$mobileNotReportControlHidden$",i),g=()=>ls(Le,"$currentGridType$",i),v=()=>ls(ee,"$isLive$",i),b=()=>ls(he,"$settingsMenuVisible",i),y=()=>ls(ne,"$isRewindableLive$",i),S=()=>ls(X,"$isAudioAvailable$",i),w=()=>ls(ie,"$muted$",i),$=()=>ls(Ot,"$settingButtonRef$",i),x=()=>ls(Re,"$isFullscreen",i),k=()=>ls(Ne,"$additionalButtons$",i),T=()=>ls(Qe,"$graphIsOpened$",i),_=()=>ls(Me,"$adPosition",i),C=()=>ls(Pe,"$adDuration",i),E=()=>ls(K,"$position$",i),A=()=>ls(G,"$duration$",i),L=ms(t,"playerControlsWrapperRef",15,void 0),P=ms(t,"playerControlsRef",15,void 0),M=ms(t,"isAds",3,!1),I=ms(t,"logoTargetUrl",3,""),R=ms(t,"isOneVideoPlaylist",3,!1),V=ms(t,"customFullscreenSupported",3,!0),N=Os(),B=Fs(),D=ys(),O=N.actions.internal.toggleMuted,F=N.actions.internal.togglePlay,j=N.actions.internal.pause,z=N.actions.internal.prevVideoClick,q=N.actions.internal.nextVideoClick,H=N.actions.internal.checkFullscreenSupport,U=N.callbacks?.onAudioDoesNotExistHint,W=N.callbacks?.onAudioDisabledHint,Q=N.playerPhase,G=N.state.duration$,K=N.state.positionWithScrubbing$,Y=N.state.playbackState$,X=N.state.isAudioAvailable$,J=N.state.isAudioDisabled,Z=N.state.isEnded$,ee=N.state.isLive$,te=N.state.volume$,ie=N.state.muted$,ae=N.state.isActiveLive$,ne=N.state.isRewindableLive$,oe=N.ui.scrubbingInProgress,ue=N.ui.mobileNotReportControlHidden$,{isActive$:de,type$:ce}=B.pictureInPicture$,he=N.ui.settingsMenu.visible$,pe=N.ui.settingsMenu.openedByBtnKeyboard$,me=N.ui.controls,{volume:ge,vkLogo:ve,autoplayNextToggle:be,pip:ye,settings:Se,chromecast:we}=N.ui.hiddenControls,$e=N.actions.internal.getVideoEpisodes(),xe=N.webApi.pictureInPictureApi,Te=N.state.chromecastState$,Ce=N.state.crashed$,Ee=me.disabledControls$,Ae=N.ui.startedByKeyboard$,Le=N.ui.currentGridType$,Pe=N.ads.duration,Me=N.ads.position,Ie=N.ads.playbackState,Re=N.ui.isFullscreen,Ve=N.ui.playerSize,Ne=N.ui.additionalButtonsDeprecated$,Be=N.actions.internal.getVideoElement,De=N.actions.internal.replayInteractive,Oe=N.state.isInteractive,Fe=N.state.isInteractiveTime$,je=N.state.showInteractiveGraph,qe=N.state.showSeekToInteractive,He=N.state.showPlayPrevChapter,Ue=N.state.showInteractiveTimeIndicator,We=B.seekToInteractiveDisabledTooltip$,Qe=B.graphIsOpened$,Ge=N.ui.controlBlocks,Ke=fe((()=>Da(N.state.playPrevChapterDisabledTooltip))),Ze=fe((()=>Da(ls(We,"$seekToInteractiveDisabledTooltip$",i)))),et=fe((()=>s().has("EPISODE_BUTTON"))),tt=fe((()=>s().has("GRAPH_BUTTON"))),it=fe((()=>s().has("SEEK_TO_INTERACTIVE_BUTTON"))),st=fe((()=>s().has("PLAY_BUTTON"))),at=fe((()=>s().has("REPLAY_BUTTON"))),ot=fe((()=>s().has("PLAY_PREV_CHAPTER_BUTTON"))),lt=fe((()=>a()===f.PlaybackState.PLAYING)),ut=fe((()=>"paused"===n())),dt=fe((()=>o()&&!M()&&!Oe)),ct=fe((()=>!o()||M())),ht=fe((()=>t.showNextPrevButtons&&!M()&&t.prevButtonActive)),pt=fe((()=>t.showNextPrevButtons&&!M()&&t.nextButtonActive)),ft=fe((()=>l().width>300)),mt=fe((()=>l().width>400)),gt=fe(u),vt=fe((()=>!(d()===f.ChromecastState.NOT_AVAILABLE||c()&&1===h()||p()||Oe||ls(we,"$chromecastHidden",i)))),bt=fe((()=>"LiveWaitingStart"===ls(Q,"$playerPhase",i))),yt=fe((()=>!!xe&&d()!==f.ChromecastState.CONNECTED&&!p()&&(1===h()&&ui(bt)||!ui(bt))&&!ui(gt)&&!Oe&&!ls(ye,"$pipHidden",i))),St=ke(!1);Ki((()=>{let e=xe?.info.isActive$.subscribe((e=>_e(St,e,!0)));return()=>e?.unsubscribe()}));let wt=fe((()=>!ui(gt)&&Du(g(),"s"))),$t=fe((()=>!t.logoHidden&&l().width>350&&!ls(ve,"$vkLogoHidden",i))),xt=fe((()=>D.features.fullscreen&&H()&&!(c()&&1===h())&&(!Oe||V())&&!ui(gt)&&!ui(St))),kt=fe((()=>!ls(ge,"$volumeHidden",i)&&!ui(gt))),Tt=fe((()=>(!v()||M())&&l().width>260&&!ui(gt)&&!(D.features.interactiveHideTime&&Oe))),_t=fe((()=>b()||t.showControls)),Ct=fe((()=>!M()&&!v()&&!!$e?.length&&ui(ft)&&!ui(et)&&!ui(gt))),Et=fe((()=>!y()||!!ls(ae,"$isActiveLive$",i))),At=fe((()=>je&&Du(g(),"m"))),Lt=fe((()=>!S()||w()||0===ls(te,"$volume$",i))),Pt=le({}),Mt=le({}),It=(0,m.debounceFn)(Dd,260),Rt=(0,m.debounceFn)(Oc,260);rt((()=>{l(),ls(Fe,"$isInteractiveTime$",i),It(Be(),me,Pt,t.showControls),Rt(Be(),Ge,Mt,t.showControls)}));let Vt=()=>N.actions.internal.toggleChromecast();async function Nt(){xe?.isActive()?await(xe?.exit()):await(xe?.request())}function Bt(){ol({isAudioDisabled:J,audioDisabledHintCallback:W,isAudioAvailable:S(),audioIsNotExistHintCallback:U,isAds:M()})&&O()}let Dt=ke("");rt((()=>{var e,t;e=ui(Et),t=a(),e?t&&t===f.PlaybackState.PAUSED&&_e(Dt,Da("tooltip_play"),!0):_e(Dt,Da("tooltip_live"),!0)}));let Ot=rs();rt((()=>{$()&&Wn($(),b(),pe)})),rt((()=>{Od(Ae,ls(Ae,"$startedByKeyboard$",i),Pt.playButton)}));var Ft=qh(),jt=Xe(Ft),zt=e=>{var r=Oh(),s=Xe(r);let a;var n=Je(s,2);let o;Xr(n,(e=>Mt.topLeft=e),(()=>Mt?.topLeft));var l=Je(n,2);let h;var f=Ye(l);sr(f,1,k,(({iconUrl:e,ariaLabel:t,testId:i,onClick:r,tooltip:s})=>e),((e,t)=>{let i=fe((()=>ui(t).ariaLabel??ui(t).tooltip));!function(e,t){fr(e,_h);let i=ms(t,"disabled",3,!1),r=ms(t,"onClick",3,m.noop),s=fe((()=>r()===m.noop)),a=fe((()=>ui(s)||i())),n=ke(!1),o=()=>{_e(n,!0)},l=fe((()=>ui(s)?"btn-full-opacity":""));Sl(e,{get className(){return ui(l)},get ariaLabel(){return t.ariaLabel},get click(){return r()},get disabled(){return ui(a)},get testId(){return t.testId},children:(e,i)=>{var r=Ei(),s=Xe(r),a=e=>{Ai(e,kh())},l=e=>{var i=Th();nt((()=>Pr(i,"src",t.iconUrl))),Si("error",i,o),bi(i),Ai(e,i)};Ji(s,(e=>{ui(n)?e(a):e(l,!1)})),Ai(e,r)},$$slots:{default:!0}})}(e,{get iconUrl(){return ui(t).iconUrl},get ariaLabel(){return ui(i)},get testId(){return ui(t).testId},get onClick(){return ui(t).onClick}})}));var g=Je(f,2),v=e=>{wc(e,{get ref(){return Pt.autoplayNextToggle},set ref(e){Pt.autoplayNextToggle=e}})};Ji(g,(e=>{t.showAutoplayNext&&!R()&&!ls(be,"$autoplayNextToggleHidden",i)&&e(v)}));var b=Je(g,2),y=e=>{id(e,{isMobile:!0,click:Vt,get state(){return d()},get ref(){return Pt.chromecast},set ref(e){Pt.chromecast=e}})};Ji(b,(e=>{ui(vt)&&e(y)}));var S=Je(b,2),w=e=>{Mh(e,{click:Nt,get isPictureInPictureActive(){return c()},get ref(){return Pt.pip},set ref(e){Pt.pip=e}})};Ji(S,(e=>{ui(yt)&&e(w)}));var $=Je(S,2),_=e=>{Jl(e,{get ref$(){return Ot}})};Ji($,(e=>{ls(Ce,"$crashed$",i)&&!ls(Se,"$settingsHidden",i)&&e(_)}));var C=Je($,2),E=e=>{Xu(e,{get click(){return j},get targetUrl(){return I()},get logoClickable(){return t.logoClickable},get ref(){return Pt.vkLogo},set ref(e){Pt.vkLogo=e}})};Ji(C,(e=>{ui($t)&&e(E)})),ze(l),Xr(l,(e=>Mt.topRight=e),(()=>Mt?.topRight));var A=Je(l,2);let L;var P=Ye(A),M=e=>{let t=fe((()=>z.bind(null,!0)));ac(e,{get click(){return ui(t)},type:"prev",isMobile:!0,get ref(){return Pt.prevButton},set ref(e){Pt.prevButton=e}})};Ji(P,(e=>{ui(ht)&&e(M)}));var V=Je(P,2),N=e=>{gc(e,{get disabled(){return ui(st)},get click(){return F},isMobile:!0,get isPlaying(){return ui(lt)},get ref(){return Pt.playButton},set ref(e){Pt.playButton=e}})};Ji(V,(e=>{ui(ct)&&e(N)}));var B=Je(V,2),D=e=>{cc(e,{get disabled(){return ui(at)},get click(){return F},isMobile:!0,get ref(){return Pt.replayButton},set ref(e){Pt.replayButton=e}})};Ji(B,(e=>{ui(dt)&&e(D)}));var O=Je(B,2),H=e=>{let t=fe((()=>q.bind(null,!0)));ac(e,{get click(){return ui(t)},type:"next",isMobile:!0,get ref(){return Pt.nextButton},set ref(e){Pt.nextButton=e}})};Ji(O,(e=>{ui(pt)&&e(H)})),ze(A),Xr(A,(e=>Mt.middle=e),(()=>Mt?.middle));var U=Je(A,2),W=e=>{var i=Dh(),r=Xe(i),s=e=>{var i=Vh();let r;i.__click=[Ih,ot,t,Ke];var s=Ye(i);let a=fe((()=>!t.showControls));bc(s,{get hidden(){return ui(a)},get disabled(){return ui(ot)},get click(){return t.playPrevChapter},get ref(){return Pt.playPrevChapterButton},set ref(e){Pt.playPrevChapterButton=e}}),ze(i),nt((e=>r=wr(i,1,"wrapper-middle-left s-11",null,r,e)),[()=>({fullscreen:x(),hidden:!t.showControls})]),Ai(e,i)};Ji(r,(e=>{He&&e(s)}));var a=Je(r,2),n=e=>{var i=Nh();let r;var s=Ye(i);let a=fe((()=>!t.showControls&&!T()));_c(s,{get hidden(){return ui(a)},get disabled(){return ui(tt)},get click(){return Qe.toggle},get graphIsOpened(){return T()},get ref(){return Pt.interactiveGraphButton},set ref(e){Pt.interactiveGraphButton=e}}),ze(i),nt((e=>r=wr(i,1,vr(He?"wrapper-middle-left-second":"wrapper-middle-left"),"s-11",r,e)),[()=>({fullscreen:x(),hidden:!t.showControls&&!T()})]),Ai(e,i)};Ji(a,(e=>{ui(At)&&e(n)}));var o=Je(a,2),l=e=>{var i=Bh();let r;i.__click=[Rh,it,t,Ze];var s=Ye(i);let a=fe((()=>!t.showControls));xc(s,{get hidden(){return ui(a)},get disabled(){return ui(it)},get click(){return t.seekToInteractive},get ref(){return Pt.seekToInteractiveButton},set ref(e){Pt.seekToInteractiveButton=e}}),ze(i),nt((e=>r=wr(i,1,"wrapper-middle-right s-11",null,r,e)),[()=>({fullscreen:x(),hidden:!t.showControls})]),Ai(e,i)};Ji(o,(e=>{qe&&e(l)})),Ai(e,i)};Ji(U,(e=>{Oe&&!u()&&e(W)})),nt(((e,t,i,r)=>{a=wr(s,1,"overlay-mobile s-11",null,a,e),o=wr(n,1,"wrapper-top-left s-11",null,o,t),h=wr(l,1,"wrapper-top-right s-11",null,h,i),L=wr(A,1,"wrapper-middle s-11",null,L,r)}),[()=>({hidden:!ui(_t)}),()=>({hidden:!t.showControls,fullscreen:x()}),()=>({hidden:!t.showControls&&!p(),fullscreen:x()}),()=>({hidden:!t.showControls||u()||t.endScreenShown&&t.showNextPrevButtons})]),Ai(e,r)};Ji(jt,(e=>{M()||e(zt)}));var qt=Je(jt,2),Ht=e=>{var t=jh(),i=Xe(t);let r;Eh(Ye(i),{get muted(){return w()},click:Bt,get ref(){return Pt.volume},set ref(e){Pt.volume=e}}),ze(i);var s=Je(i,2),a=e=>{var t=Fh(),i=Ye(t);let r=fe((()=>!ui(ut)));gc(i,{get disabled(){return ui(st)},get click(){return F},isMobile:!0,get isPlaying(){return ui(r)},get ref(){return Pt.playButton},set ref(e){Pt.playButton=e}}),ze(t),Ai(e,t)};Ji(s,(e=>{ui(ut)&&e(a)}));var n=Je(s,2);let o;rh(Ye(n),{get position(){return _()},get duration(){return C()}}),ze(n),nt(((e,t)=>{r=wr(i,1,"wrapper-top-right s-11",null,r,e),o=wr(n,1,"wrapper-bottom ads-timeline-mobile s-11",null,o,t)}),[()=>({fullscreen:x()}),()=>({fullscreen:x()})]),Ai(e,t)};Ji(qt,(e=>{M()&&"inactive"!==n()&&e(Ht)}));var Ut=Je(qt,2);let Wt;var Qt=Ye(Ut);let Gt;var Kt=Ye(Qt),Yt=Ye(Kt),Xt=Ye(Yt),Jt=e=>{Su(e,{get disabled(){return ui(at)},get ref(){return Pt.replayButton},set ref(e){Pt.replayButton=e},children:(e,t)=>{cc(e,{get disabled(){return ui(at)},get click(){return De}})},$$slots:{default:!0}})};Ji(Xt,(e=>{Oe&&e(Jt)}));var Zt=Je(Xt,2),ei=e=>{Su(e,{get ref(){return Pt.liveButton},set ref(e){Pt.liveButton=e},children:(e,t)=>{Cc(e,{get isLiveActive(){return ui(Et)},isMobile:!0,get ariaLabel(){return ui(Dt)}})},$$slots:{default:!0}})};Ji(Zt,(e=>{!M()&&v()&&e(ei)}));var ti=Je(Zt,2),ii=e=>{let i=fe((()=>M()?_():E())),r=fe((()=>M()?C():A())),s=fe((()=>!t.showControls));nu(e,{get showDuration(){return ui(mt)},get position(){return ui(i)},get duration(){return ui(r)},isMobile:!0,get isHidden(){return ui(s)},get ref(){return Pt.time},set ref(e){Pt.time=e}})};Ji(ti,(e=>{ui(Tt)&&e(ii)}));var ri=Je(ti,2);let si=fe((()=>!ui(Ct)));Su(ri,{className:"w-max",get disabled(){return ui(si)},get ref(){return Pt.episodes},set ref(e){Pt.episodes=e},children:(e,t)=>{var i=Ei(),r=Xe(i),s=e=>{var t=zh();dd(Je(Xe(t),2),{get position(){return E()},get duration(){return A()},get timeCodes(){return $e}}),Ai(e,t)};Ji(r,(e=>{ui(Ct)&&e(s)})),Ai(e,i)},$$slots:{default:!0}}),ze(Yt),Xr(Yt,(e=>Mt.bottomLeft=e),(()=>Mt?.bottomLeft));var ai=Je(Yt,2),ni=Ye(ai),oi=e=>{Su(e,{get ref(){return Pt.volume},set ref(e){Pt.volume=e},children:(e,t)=>{Eh(e,{get muted(){return ui(Lt)},click:Bt})},$$slots:{default:!0}})};Ji(ni,(e=>{ui(kt)&&e(oi)}));var li=Je(ni,2),di=e=>{Su(e,{get ref(){return Pt.settings},set ref(e){Pt.settings=e},children:(e,t)=>{Jl(e,{get ref$(){return Ot}})},$$slots:{default:!0}})};Ji(li,(e=>{ui(wt)&&e(di)}));var ci=Je(li,2),hi=e=>{Su(e,{get ref(){return Pt.fullscreen},set ref(e){Pt.fullscreen=e},children:(e,i)=>{Wu(e,{get click(){return t.toggleFullscreen},get isFullscreen(){return x()}})},$$slots:{default:!0}})};Ji(ci,(e=>{ui(xt)&&e(hi)})),ze(ai),Xr(ai,(e=>Mt.bottomRight=e),(()=>Mt?.bottomRight)),ze(Kt),Xr(Kt,(e=>P(e)),(()=>P()));var pi=Je(Kt,2);let fi=fe((()=>!t.showControls));oh(pi,{get isHidden(){return ui(fi)},get isAds(){return M()},get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return y()},get ref(){return Pt.timeline},set ref(e){Pt.timeline=e}}),ze(Qt),Xr(Qt,(e=>Mt.bottom=e),(()=>Mt?.bottom)),ze(Ut),Xr(Ut,(e=>L(e)),(()=>L()));var mi=Je(Ut,2),gi=e=>{Ud(e,{get ref(){return Pt.interactiveTimeIndicator},set ref(e){Pt.interactiveTimeIndicator=e}})};Ji(mi,(e=>{Ue&&e(gi)})),nt(((e,t)=>{Wt=wr(Ut,1,"wrapper-bottom mobile s-11",null,Wt,e),Gt=wr(Qt,1,"controls-wrapper s-11",null,Gt,t)}),[()=>({hidden:t.bottomHidden,"controls-hidden":!t.showControls,"no-smooth":t.bottomNoSmooth}),()=>({fullscreen:x()})]),Ai(e,Ft),se(),r()}function Wh(e,t){re(t,!0);let[i,r]=us(),s=ms(t,"bottomNoSmooth",3,!1),a=ms(t,"playerControlsWrapperRef",15,void 0),n=ms(t,"playerControlsRef",15,void 0),o=ms(t,"isAds",3,!1),l=ms(t,"logoTargetUrl",3,""),u=ms(t,"showAutoplayNext",3,!1),d=ms(t,"isOneVideoPlaylist",3,!1),c=ms(t,"customFullscreenSupported",3,!0),h=ms(t,"endScreenShown",3,!1),p=ms(t,"onDisabledPlayPrevChapterClick",3,m.noop),f=ms(t,"onDisabledSeekToInteractiveClick",3,m.noop),g=Os().ui.isMobile,v=ke(!1);Ki((()=>{let e=setTimeout((()=>_e(v,!0)),0);return()=>clearTimeout(e)}));var b=Ei(),y=Xe(b),S=e=>{var r=Ei(),m=Xe(r),v=e=>{Uh(e,{get bottomHidden(){return t.bottomHidden},get bottomNoSmooth(){return s()},get showControls(){return t.showControls},get isAds(){return o()},get canRewindLive(){return t.canRewindLive},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return l()},get showAutoplayNext(){return u()},get showNextPrevButtons(){return t.showNextPrevButtons},get nextButtonActive(){return t.nextButtonActive},get prevButtonActive(){return t.prevButtonActive},get isOneVideoPlaylist(){return d()},get customFullscreenSupported(){return c()},get endScreenShown(){return h()},get toggleFullscreen(){return t.toggleFullscreen},get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get onDisabledPlayPrevChapterClick(){return p()},get onDisabledSeekToInteractiveClick(){return f()},get playerControlsWrapperRef(){return a()},set playerControlsWrapperRef(e){a(e)},get playerControlsRef(){return n()},set playerControlsRef(e){n(e)}})},b=e=>{xh(e,{get bottomHidden(){return t.bottomHidden},get bottomNoSmooth(){return s()},get showControls(){return t.showControls},get isAds(){return o()},get canRewindLive(){return t.canRewindLive},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return l()},get isOneVideoPlaylist(){return d()},get showAutoplayNext(){return u()},get showNextPrevButtons(){return t.showNextPrevButtons},get nextButtonActive(){return t.nextButtonActive},get prevButtonActive(){return t.prevButtonActive},get customFullscreenSupported(){return c()},get toggleFullscreen(){return t.toggleFullscreen},get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get playerControlsWrapperRef(){return a()},set playerControlsWrapperRef(e){a(e)},get playerControlsRef(){return n()},set playerControlsRef(e){n(e)}})};Ji(m,(e=>{ls(g,"$isMobile",i)?e(v):e(b,!1)})),Ai(e,r)};Ji(y,(e=>{ui(v)&&e(S)})),Ai(e,b),se(),r()}wi(["click"]);var Qh=_i('<path d="M23.75 31.2v-5.45l-11.84 6.7a1.45 1.45 180 01-2.16-1.25v-14.4a1.45 1.45 180 012.16-1.26l11.84 6.7v-5.44a1.45 1.45 180 012.16-1.26l12.7 7.19a1.45 1.45 180 010 2.52l-12.7 7.2a1.45 1.45 180 01-2.16-1.27Z"></path>');function Gh(e,t){re(t,!0);let i=fe((()=>t.reversed?"transform:scaleX(-1);transform-origin:50% 0;":"")),r=fe((()=>`${Qo(t.size)}${ui(i)}`));Ea(e,{get width(){return"48"},get height(){return"48"},get fill(){return t.fill},get style(){return ui(r)},get testId(){return t.testId},get shadow(){return t.shadow},children:(e,t)=>{Ai(e,Qh())},$$slots:{default:!0}}),se()}var Kh=_i('<path d="M32.46 9.53a1.16 1.16 90 010 1.96l-7.66 4.83c-.78.49-1.8-.07-1.8-.98v-3.3a14 14 90 1014.1 18.93 1.5 1.5 90 012.8 1.06 17 17 90 11-16.9-23V5.66c0-.91 1.03-1.47 1.8-.98z"></path>');var Yh=Ti('<span class="hot-key-helpers-text s-1e"> </span>'),Xh=Ti('<div data-testid="hotkey-helper-icon" class="s-1e"><!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),Jh=Ti("<div><!></div>"),Zh={hash:"s-1e",code:'.hot-key-helpers-container.s-1e{align-items:center;animation:s-1e-fadeIn ease var(--controls-transition-duration);box-sizing:border-box;display:flex;flex-direction:column;height:120px;left:calc(50% - 100px);padding-top:14px;position:absolute;top:calc(50% - 40px);width:200px;z-index:var(--hot-key-helpers-container-z-index)}.hot-key-helpers-container--left.s-1e{left:calc(25% - 100px)}.hot-key-helpers-container--right.s-1e{left:calc(75% - 100px)}.hot-key-helpers-text.s-1e{display:-webkit-box;font-feature-settings:"clig" off,"liga" off;font-size:15px;font-style:normal;font-weight:600;letter-spacing:-.105px;-webkit-line-clamp:2;line-height:20px;margin-top:4px;max-height:40px;overflow:hidden;text-align:center;text-overflow:ellipsis;text-shadow:0 0 5px rgba(0,0,0,.16);white-space:pre-wrap;width:100%;-webkit-box-orient:vertical}.hidden.s-1e{animation:s-1e-fadeOut ease var(--controls-transition-duration);height:0;visibility:hidden;width:0}@keyframes s-1e-fadeIn{0%{opacity:0}to{opacity:1}}@keyframes s-1e-fadeOut{0%{opacity:1}to{opacity:0}}'};function ep(e,t){re(t,!0),fr(e,Zh);let[i,r]=us(),s=()=>ls(t.data,"$data",i),a=Os(),{features:n}=ys(),o=a.ui.t,l=fe((()=>!s())),u=fe((()=>"BACKWARD_SEEK"===s()?.type)),d=fe((()=>"FORWARD_SEEK"===s()?.type)),c=fe((()=>s()?.type)),h=fe((()=>s()?.t?o(s().t.key,{value:s().t.value||""}):s()?.text));var p=Jh();let f;var m=Ye(p),g=e=>{var t=Xh(),i=Xe(t),r=Ye(i),s=e=>{let t=fe((()=>"BACKWARD_SEEK"===ui(c)));!function(e,t){re(t,!0);let i=ms(t,"reversed",3,!1),r=fe((()=>i()?"transform:scaleX(-1);transform-origin: 50% 0;":void 0)),s=fe((()=>"seek-icon-"+(i()?"backward":"forward")));Ea(e,{get width(){return"48"},get height(){return"48"},get style(){return ui(r)},get testId(){return ui(s)},get shadow(){return t.shadow},children:(e,t)=>{Ai(e,Kh())},$$slots:{default:!0}}),se()}(e,{get reversed(){return ui(t)},shadow:!0})};Ji(r,(e=>{["BACKWARD_SEEK","FORWARD_SEEK"].includes(ui(c))&&e(s)}));var a=Je(r,2),o=e=>{pc(e,{get size(){return"48"},shadow:!0})};Ji(a,(e=>{"PAUSE"===ui(c)&&!n.playbackStatusShow&&e(o)}));var l=Je(a,2),u=e=>{Ko(e,{get size(){return"48"},shadow:!0})};Ji(l,(e=>{"PLAY"===ui(c)&&!n.playbackStatusShow&&e(u)}));var d=Je(l,2),p=e=>{oc(e,{get size(){return"48"},shadow:!0})};Ji(d,(e=>{"REPLAY"===ui(c)&&!n.playbackStatusShow&&e(p)}));var f=Je(d,2),m=e=>{tu(e,{get size(){return"48"},type:"off",shadow:!0})};Ji(f,(e=>{"SUBTITLES_OFF"===ui(c)&&e(m)}));var g=Je(f,2),v=e=>{tu(e,{get size(){return"48"},shadow:!0})};Ji(g,(e=>{"SUBTITLES_ON"===ui(c)&&e(v)}));var b=Je(g,2),y=e=>{let t=fe((()=>"RATE_DOWN"===ui(c)));Gh(e,{get size(){return"48"},get reversed(){return ui(t)},testId:"rate-change-icon",shadow:!0})};Ji(b,(e=>{["RATE_DOWN","RATE_UP"].includes(ui(c))&&e(y)}));var S=Je(b,2),w=e=>{let t=fe((()=>"EPISODE_PREV"===ui(c)));ic(e,{get size(){return"48"},get reversed(){return ui(t)},shadow:!0})};Ji(S,(e=>{["EPISODE_PREV","EPISODE_NEXT"].includes(ui(c))&&e(w)}));var $=Je(S,2),x=e=>{du(e,{get size(){return"48"},volume:0,shadow:!0})};Ji($,(e=>{"MUTE"===ui(c)&&e(x)}));var k=Je($,2),T=e=>{du(e,{get size(){return"48"},volume:1,shadow:!0})};Ji(k,(e=>{"VOLUME"===ui(c)&&e(T)})),ze(i);var _=Je(i,2),C=e=>{var t=Yh(),i=Ye(t,!0);ze(t),nt((()=>ji(i,ui(h)))),Ai(e,t)};Ji(_,(e=>{ui(h)&&e(C)})),nt((()=>Pr(i,"data-type",ui(c)))),Ai(e,t)};Ji(m,(e=>{!ui(l)&&ui(c)&&e(g)})),ze(p),nt((e=>f=wr(p,1,"hot-key-helpers-container s-1e",null,f,e)),[()=>({hidden:ui(l),"hot-key-helpers-container--left":ui(u),"hot-key-helpers-container--right":ui(d)})]),Ai(e,p),se(),r()}var tp=(e,t,i,r,s,a)=>{if(t.has(e.code))switch(e.preventDefault(),e.stopPropagation(),e.code){case"ArrowUp":i();break;case"ArrowDown":r();break;case"ArrowLeft":s();break;case"ArrowRight":a()}},ip=(e,t,i)=>{t.has(e.code)&&(e.preventDefault(),e.stopPropagation(),i())},rp=Ti('<div tabindex="0" role="button"><div class="button-block s-j" aria-hidden="true"><div class="button-row s-j"><div class="button button-up s-j"><!></div> <div class="button button-right s-j"><!></div></div> <div class="button-row s-j"><div class="button button-left s-j"><!></div> <div class="button button-down s-j"><!></div></div></div></div>'),sp={hash:"s-j",code:".immersive-controls.s-j{background-color:rgba(0,0,0,.56);border-radius:8px;display:flex;flex-direction:row;height:56px;left:10px;position:absolute;top:10px;transition-duration:var(--controls-transition-duration);transition-property:top,left;transition-timing-function:var(--controls-transition-fn);width:56px}.immersive-controls.m-shifted.s-j{left:20px;top:50px}.button-block.s-j{height:40px;margin:auto;transform:rotate(45deg);width:40px}.button-row.s-j{display:flex;flex-direction:row;position:relative}.button.s-j{cursor:pointer;height:20px;text-align:center;width:20px}.button.s-j svg{opacity:.7;transition:opacity .2s linear}.button.button-up.s-j svg{transform:rotate(-45deg) translate(-1px,-1px)}.button.button-right.s-j svg{transform:rotate(45deg) translate(1px,-1px)}.button.button-down.s-j svg{transform:rotate(135deg) translate(1px,-3px)}.button.button-left.s-j svg{transform:rotate(-135deg) translate(-1px,-3px)}.button.s-j:hover svg{opacity:1}"};function ap(e,t){re(t,!0),fr(e,sp);let i=ms(t,"isShifted",3,!1),r=Os(),s=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]),a=()=>{r.actions.internal.startCameraManualRotation(0,1)},n=()=>{r.actions.internal.startCameraManualRotation(0,-1)},o=()=>{r.actions.internal.startCameraManualRotation(1,0)},l=()=>{r.actions.internal.startCameraManualRotation(-1,0)},u=()=>(r.actions.internal.stopCameraManualRotation(),null),d=Da("aria_label_spherical_control");var c=rp();let h;c.__keydown=[tp,s,a,n,l,o],c.__keyup=[ip,s,u];var p=Ye(c),f=Ye(p),m=Ye(f);m.__mousedown=a,m.__mouseup=u,cn(Ye(m),{direction:"up",useBtnColor:!0}),ze(m);var g=Je(m,2);g.__mousedown=o,g.__mouseup=u,cn(Ye(g),{direction:"up",useBtnColor:!0}),ze(g),ze(f);var v=Je(f,2),b=Ye(v);b.__mousedown=l,b.__mouseup=u,cn(Ye(b),{direction:"up",useBtnColor:!0}),ze(b);var y=Je(b,2);y.__mousedown=n,y.__mouseup=u,cn(Ye(y),{direction:"up",useBtnColor:!0}),ze(y),ze(v),ze(p),ze(c),nt((e=>{h=wr(c,1,"immersive-controls s-j",null,h,e),Pr(c,"aria-label",d)}),[()=>({"m-shifted":i()})]),Si("mouseleave",m,u),Si("mouseleave",g,u),Si("mouseleave",b,u),Si("mouseleave",y,u),Ai(e,c),se()}wi(["keydown","keyup","mousedown","mouseup"]);var np=class{subscribe(){return this.subscriptions.add(this.captions$.pipe((0,m.filter)((()=>this.isEnabled())),(0,m.filterChanged)()).subscribe((e=>{this.processCaptions(e)}))),this}setIsAuto(e){this.isAuto=e}setIsLive(e){this.isLive=e}setCaptions(e){this.captions$.next(e)}destroy(){this.subscriptions.unsubscribe(),this.flickeringTimeout.clear()}isEnabled(){return this.isAuto&&!this.isLive}processCaptions(e){if(!e.length)return void this.flickeringTimeout.add((()=>{this.captionsPrepared$.next([])}));this.flickeringTimeout.clear();let t=[],i=e.length>1&&"timestamp"!==e[0].type&&"timestamp"!==e[1].type;i&&t.push([{value:String(e[0].value),timeAppeared:null}]),t.push(e.reduce(((e,{type:t,value:r},s)=>(i&&!s||("timestamp"===t?e.push({timeAppeared:Number(r),value:""}):0===e.length?e.push({value:String(r)}):e[e.length-1].value=String(r)),e)),[])),this.captionsPrepared$.next(t)}constructor(){this.flickeringTimeout=((e=1e3)=>{let t=null,i=()=>{t&&(clearTimeout(t),t=null)};return{add:r=>{i(),t=setTimeout(r,e)},clear:i}})(1e3),this.subscriptions=new m.Subscription,this.isAuto=!1,this.isLive=!1,this.captions$=new m.ValueSubject([]),this.captionsPrepared$=new m.ValueSubject([])}},op=Ti('<span class="caption-line s-b"><span class="caption-segment s-b"> </span></span>'),lp=Ti('<span class="caption-line s-b"><span class="caption-segment s-b"></span></span>'),up=Ti('<span class="caption-line s-b"><span class="caption-segment s-b"> </span></span>'),dp=Ti('<div><span class="caption s-b"><!></span></div>'),cp=Ti("<div><!></div>"),hp={hash:"s-b",code:".subtitles-container.s-b{height:100%;left:0;pointer-events:none;position:absolute;top:0;transition:transform var(--controls-transition-duration);width:100%}.subtitles-container.shifted.s-b{transform:translateY(calc(var(--controls-height)*-1))}.subtitles-container.preview-track-active.s-b{transform:translateY(calc(var(--preview-track-height)*-1))}.preview-track-active.s-b .subtitles-caption:where(.s-b){bottom:var(--preview-track-controls-top-offset)}.subtitles-caption.s-b{bottom:4%;display:flex;justify-content:center;left:4%;position:absolute;right:4%}.subtitles-caption.mobile.s-b{bottom:8%}.subtitles-container.auto.s-b .subtitles-caption:where(.s-b){left:var(--subtitles-caption-margin);right:var(--subtitles-caption-margin)}.caption.s-b{background:rgba(0,0,0,.4);border-radius:4px;display:block;overflow-wrap:normal;padding:4px 8px}.subtitles-container.auto.s-b .caption:where(.s-b){width:100%}.caption-line.s-b{display:block;text-align:center}.subtitles-container.auto.s-b .caption-line:where(.s-b){text-align:left}.caption-segment.s-b{color:var(--white);display:inline-block;font-size:13px;line-height:1.2;white-space:pre-wrap}"};function pp(e,t){re(t,!0),fr(e,hp);let[i,r]=us(),s=()=>ls(u,"$isAutoSubtitleCaptionVisible$",i),a=ms(t,"isMobile",3,!1),n=Os(),o=ys(),l=n.state.currentSubtitle$,u=n.state.isAutoSubtitleCaptionVisible$,d=n.state.isLive$,c=n.ui.isFullscreen,h=n.ui.previewTrackActive,p=fe((()=>!!ls(l,"$currentSubtitle$",i).isAuto)),f=fe((()=>!!ls(d,"$isLive$",i))),m=fe((()=>.02*t.playerSize.width)),g=fe((()=>a()&&!ls(c,"$isFullscreen",i)||ui(m)<=o.minSubtitlesFontSize?o.minSubtitlesFontSize:ui(m))),v=ke(null);rt((()=>{ui(v)?.setIsAuto(ui(p)),ui(v)?.setIsLive(ui(f)),ui(v)?.setCaptions(t.captions)}));let b=ke(le([[]]));Ki((()=>{_e(v,(new np).subscribe(),!0);let e=ui(v).captionsPrepared$.subscribe((e=>{_e(b,e,!0)}));return()=>{ui(v)?.destroy(),e.unsubscribe()}})),Ki((()=>{if(ui(p)){let e=window.setTimeout((()=>{u.set(!1)}),o.autoSubtitlesTimeout);return()=>{window.clearTimeout(e)}}u.set(!1)}));let y=fe((()=>t.playerSize.width<400?10:t.playerSize.width<550?14:24));var S=cp();let w;var $=Ye(S),x=e=>{var i=dp();let r;var n=Ye(i),o=Ye(n),l=e=>{var t=op(),i=Ye(t),r=Ye(i,!0);ze(i),ze(t),nt((e=>{xr(i,`font-size: ${ui(g)??""}px`),ji(r,e)}),[()=>Da("subtitles_auto_caption")]),Ai(e,t)},u=(e,i)=>{var r=e=>{var i=Ei();sr(Xe(i),17,(()=>ui(b)),rr,((e,i)=>{var r=lp(),s=Ye(r);sr(s,21,(()=>ui(i)),(({value:e,timeAppeared:t})=>t),((e,i)=>{let r=()=>ui(i).timeAppeared;var s=Ei(),a=Xe(s),n=e=>{var t=Ci();nt((()=>ji(t,ui(i).value))),Ai(e,t)};Ji(a,(e=>{(!r()||r()<=t.position)&&e(n)})),Ai(e,s)})),ze(s),ze(r),nt((()=>xr(s,`font-size: ${ui(g)??""}px`))),Ai(e,r)})),Ai(e,i)},s=e=>{var i=Ei();sr(Xe(i),17,(()=>t.captions),(({value:e})=>e),((e,t)=>{var i=up(),r=Ye(i),s=Ye(r,!0);ze(r),ze(i),nt((()=>{xr(r,`font-size: ${ui(g)??""}px`),ji(s,ui(t).value)})),Ai(e,i)})),Ai(e,i)};Ji(e,(e=>{ui(p)&&ui(b)?.length?e(r):e(s,!1)}),i)};Ji(o,(e=>{ui(p)&&s()?e(l):e(u,!1)})),ze(n),ze(i),nt((e=>{r=wr(i,1,"subtitles-caption s-b",null,r,e),xr(i,`--subtitles-caption-margin: ${ui(y)??""}%`)}),[()=>({mobile:a()})]),Ai(e,i)};Ji($,(e=>{(t.captions.length||ui(b)?.length)&&e(x)})),ze(S),nt((e=>w=wr(S,1,"subtitles-container s-b",null,w,e)),[()=>({shifted:t.shifted,"preview-track-active":ls(h,"$previewTrackActive",i),auto:ui(p)&&!ui(f)&&!s()})]),Ai(e,S),se(),r()}var fp=Ti('<div class="text s-o"> </div>'),mp=Ti('<div><div class="icon_wrapper s-o"><!></div> <!></div>'),gp={hash:"s-o",code:".wrapper.s-o{align-items:center;background-position:50%;background-repeat:no-repeat;background-size:contain;display:flex;flex-direction:column;font-size:16px;height:100%;justify-content:center}.wrapper.bgCover.s-o{background-size:cover}.icon_wrapper.s-o{align-items:center;display:flex;flex-direction:column;width:400px}.text.s-o{margin-top:20px}"};function vp(e,t){re(t,!0),fr(e,gp);let i=ms(t,"chromecastDeviceName",3,"chromecastDeviceName"),r=ys();var s=mp();let a;s.__contextmenu=function(...e){t.onContextMenu?.apply(this,e)},s.__click=function(...e){t.onClick?.apply(this,e)},s.__dblclick=function(...e){t.onDblClick?.apply(this,e)};var n=Ye(s);td(Ye(n),{get size(){return"48"},get iconState(){return f.ChromecastState.CONNECTED}}),ze(n);var o=Je(n,2),l=e=>{var t=fp(),r=Ye(t);ze(t),nt((()=>ji(r,`Видео воспроизводится на ${i()??""}`))),Ai(e,t)};Ji(o,(e=>{i()&&e(l)})),ze(s),nt((e=>{a=wr(s,1,"wrapper s-o",null,a,e),xr(s,`background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('${t.thumbUrl||""}')`)}),[()=>({bgCover:r.features.previewNoEmptySpace})]),Ai(e,s),se()}wi(["contextmenu","click","dblclick"]);var bp=_i('<path d="M460 194a4 4 0 0 1 4-4h122a4 4 0 0 1 4 4v82a4 4 0 0 1-4 4H464a4 4 0 0 1-4-4zm6 3a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm112-72a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm0 12a1 1 0 0 1 .99-1h4.02a1 1 0 0 1 .99 1v4a1 1 0 0 1-.99 1h-4.02a1 1 0 0 1-.99-1zm-71-37a6 6 0 1 0 0-12 6 6 0 0 0 0 12m36 0a6 6 0 1 0 0-12 6 6 0 0 0 0 12m-18.05 15c6.05 0 11.62 4.45 11.94 4.65 2.11 1.35 3.26.77 3.96.16s1.15-2.81-1.04-4.66c-1.74-1.48-5.8-5.16-14.86-5.15s-12.95 3.5-14.8 5.18c-1.83 1.69-2.28 3.5-.96 4.66s2.31 1.16 4.35-.33c0 .01 5.36-4.51 11.41-4.51"></path>');var yp=Ti('<div class="container s-5"><!></div>'),Sp={hash:"s-5",code:".container.s-5{align-items:center;background:#000;bottom:0;display:flex;justify-content:center;left:0;position:absolute;right:0;top:0}"};function wp(e){fr(e,Sp);var t=yp();(function(e){Ea(e,{width:"200",height:"200",viewBox:"460 190 130 90",testId:"error-icon",children:(e,t)=>{Ai(e,bp())},$$slots:{default:!0}})})(Ye(t)),ze(t),Ai(e,t)}var $p=Ti('<div class="playButton s-a" tabindex="0" role="button"><div class="playButtonBackground s-a"></div> <!></div>'),xp=Ti('<div data-testid="unstarted-thumb"><!></div>'),kp={hash:"s-a",code:".container.s-a{background-position:50%;background-repeat:no-repeat;background-size:contain;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0;transition:opacity .2s,visibility .2s;will-change:opacity}.container.hidden.s-a{opacity:0;visibility:hidden}.container.bgCover.s-a{background-size:cover}.playButton.s-a{align-items:center;display:flex;height:var(--big-play-size);justify-content:center;margin:auto;width:var(--big-play-size)}.playButton.s-a,.playButtonBackground.s-a{bottom:0;left:0;position:absolute;right:0;top:0}.playButtonBackground.s-a{background-color:var(--big-play-bg-color);border-radius:var(--big-play-radius);transition:background .2s,transform .2s;transition-timing-function:ease-out;will-change:background,transform}.container.s-a:hover .playButtonBackground:where(.s-a){background-color:var(--big-play-hover-bg-color);transform:scale(1.15)}.playButton.s-a svg{position:relative}"};function Tp(e,t){re(t,!0),fr(e,kp);let i=ms(t,"iconVisible",3,!0),r=Os(),s=ys(),a=r.ui.startedByKeyboard$,n=Da("tooltip_play"),o=e=>{let i=e.code;["Enter","Space"].includes(i)&&(e.stopPropagation(),e.preventDefault(),a.set(!0),t.startVideo?.())},l=e=>{e.stopPropagation(),t.startVideo?.(),t.onClick?.(e)};var u=xp();let d;u.__click=l,u.__contextmenu=function(...e){t.onContextMenu?.apply(this,e)};var c=Ye(u),h=e=>{var t=$p();t.__keydown=o,Ko(Je(Ye(t),2),{get size(){return"48"}}),ze(t),nt((()=>Pr(t,"aria-label",n))),Ai(e,t)};return Ji(c,(e=>{i()&&e(h)})),ze(u),nt((e=>{d=wr(u,1,"container s-a",null,d,e),xr(u,`background-color: #222; background-image: url('${t.thumbUrl||""}')`)}),[()=>({hidden:t.hidden,bgCover:s.features.previewNoEmptySpace})]),Ai(e,u),se({handlePressKey:o,handleClick:l})}wi(["click","contextmenu","keydown"]);var _p=Ti('<span class="text s-1h"> </span>'),Cp=(e,t)=>t.onTitleClicked?.(),Ep=Ti('<a target="_blank" class="link s-1h"><!></a>'),Ap=Ti('<div data-testid="video_title"><!></div>'),Lp={hash:"s-1h",code:".title.s-1h{background:linear-gradient(0deg,transparent,rgba(0,0,0,.02) 19%,rgba(0,0,0,.1) 34%,rgba(0,0,0,.4) 60%,rgba(0,0,0,.6));box-sizing:border-box;font-size:15px;height:var(--controls-gradient-height);left:0;overflow:hidden;padding:18px 20px 10px;pointer-events:none;position:absolute;text-overflow:ellipsis;top:0;transition-duration:var(--controls-transition-duration);transition-property:visibility,transform,opacity;transition-timing-function:var(--controls-transition-fn);white-space:nowrap;width:100%;will-change:transform,opacity;z-index:var(--controls-container-z-index)}.link.s-1h,.title.s-1h{color:var(--white)}.link.s-1h{pointer-events:auto;text-decoration:none}.link.s-1h:hover{text-decoration:underline}.text.s-1h{pointer-events:auto}.size-sm.s-1h{font-size:14px;font-weight:500;line-height:18px}.hidden.s-1h{opacity:0;transform:translateY(calc(var(--controls-gradient-height)*-1));visibility:hidden}"};wi(["click"]);var Pp=Ti('<div class="timer__cell cell s-y"><span class="cell__value s-y"> </span> <span class="cell__unit s-y"> </span></div> <span class="timer__points s-y"> </span>',1),Mp=Ti('<div class="timer__cell cell s-y"><span class="cell__value s-y"> </span> <span class="cell__unit s-y"> </span></div> <span class="timer__points s-y"> </span>',1),Ip=Ti('<div class="timer__cell cell s-y"><span class="cell__value s-y"> </span> <span class="cell__unit s-y"> </span></div> <span class="timer__points s-y"> </span>',1),Rp=Ti('<div class="timer__cell cell s-y"><span class="cell__value s-y"> </span> <span class="cell__unit s-y"> </span></div>'),Vp=Ti("<div><!> <!> <!> <!></div>"),Np={hash:"s-y",code:".timer__container.s-y{align-items:flex-start;display:flex;justify-content:center}.cell.s-y{align-items:center;display:flex;flex-direction:column}.cell__value.s-y{font-size:48px;font-weight:600;line-height:1.2}.small.s-y .cell__value:where(.s-y){font-size:24px}.cell__unit.s-y{font-size:14px;font-weight:400;line-height:1.2}.small.s-y .cell__unit:where(.s-y){font-size:12px}.timer__points.s-y{display:inline-block;font-size:42px;font-weight:600;line-height:1.2;margin:0 8px}.small.s-y .timer__points:where(.s-y){font-size:20px}"};function Bp(e,t){re(t,!0),fr(e,Np);let i,r=ke(""),s=ke(""),a=ke(""),n=ke(""),o=e=>String(e).padStart(2,"0"),l=e=>(t.isSmallSize?16:32)*(e=>Math.max(e.length,1))(e)+"px",u=()=>{let e=Math.floor(Date.now()/1e3),l=t.startTime-e;(e=>{let t=Math.floor(e/86400);t&&(e-=86400*t,_e(r,o(t),!0));let i=Math.floor(e/3600);_e(s,o(i),!0);let l=Math.floor(e/60)%60;_e(a,o(l),!0),_e(n,o(e%60),!0)})(l),l>=1?i=requestAnimationFrame(u):t.onTimerOver()};Ki((()=>{i=requestAnimationFrame(u)})),Yi((()=>{cancelAnimationFrame(i)}));var d=Vp();let c;var h=Ye(d),p=e=>{var t=Pp(),i=Xe(t);let s;var a=Ye(i),n=Ye(a,!0);ze(a);var o=Je(a,2),u=Ye(o,!0);ze(o),ze(i);var d=Je(i,2),c=Ye(d,!0);ze(d),nt(((e,t,a)=>{s=xr(i,"",s,{width:e}),ji(n,ui(r)),ji(u,t),ji(c,a)}),[()=>l(ui(r)),()=>Da("waiting_live_day_value"),()=>Da("waiting_live_colon")]),Ai(e,t)};Ji(h,(e=>{ui(r)&&e(p)}));var f=Je(h,2),m=e=>{var t=Mp(),i=Xe(t);let r;var a=Ye(i),n=Ye(a,!0);ze(a);var o=Je(a,2),u=Ye(o,!0);ze(o),ze(i);var d=Je(i,2),c=Ye(d,!0);ze(d),nt(((e,t,a)=>{r=xr(i,"",r,{width:e}),ji(n,ui(s)),ji(u,t),ji(c,a)}),[()=>l(ui(s)),()=>Da("waiting_live_hour_value"),()=>Da("waiting_live_colon")]),Ai(e,t)};Ji(f,(e=>{ui(s)&&e(m)}));var g=Je(f,2),v=e=>{var t=Ip(),i=Xe(t);let r;var s=Ye(i),n=Ye(s,!0);ze(s);var o=Je(s,2),u=Ye(o,!0);ze(o),ze(i);var d=Je(i,2),c=Ye(d,!0);ze(d),nt(((e,t,s)=>{r=xr(i,"",r,{width:e}),ji(n,ui(a)),ji(u,t),ji(c,s)}),[()=>l(ui(a)),()=>Da("waiting_live_minute_value"),()=>Da("waiting_live_colon")]),Ai(e,t)};Ji(g,(e=>{ui(a)&&e(v)}));var b=Je(g,2),y=e=>{var t=Rp();let i;var r=Ye(t),s=Ye(r,!0);ze(r);var a=Je(r,2),o=Ye(a,!0);ze(a),ze(t),nt(((e,r)=>{i=xr(t,"",i,{width:e}),ji(s,ui(n)),ji(o,r)}),[()=>l(ui(n)),()=>Da("waiting_live_second_value")]),Ai(e,t)};Ji(b,(e=>{ui(n)&&e(y)})),ze(d),nt((e=>c=wr(d,1,"timer__container s-y",null,c,e)),[()=>({small:t.isSmallSize})]),Ai(e,d),se()}var Dp=Ti('<div class="waiting s-r"><span> </span></div>'),Op=Ti('<div class="upcoming-timer timer s-r"><span> </span> <!></div>'),Fp=Ti('<div class="waiting-container s-r"><!></div>'),jp={hash:"s-r",code:'.waiting-container.s-r{background-color:var(--black);background-position:50%;background-repeat:no-repeat;background-size:cover;white-space:nowrap}.waiting-container.s-r,.waiting-container.s-r:before{height:100%;left:0;position:absolute;top:0;width:100%}.waiting-container.s-r:before{backdrop-filter:blur(15px);background-color:rgba(0,0,0,.56);content:"";z-index:1}.waiting.s-r{align-items:center;display:flex;flex-direction:column;justify-content:center;left:0;position:absolute;top:50%;transform:translateY(-50%);width:100%;z-index:2}.waiting__title.s-r{font-size:20px;font-weight:600;line-height:1.2}.upcoming-timer.s-r{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:2}.timer.s-r{align-items:center;display:flex;flex-direction:column;justify-content:center}.timer__title.s-r{display:inline-block;font-size:20px;font-weight:600;line-height:1.2;margin-bottom:12px;vertical-align:middle}.small.s-r{font-size:15px}.medium.s-r{font-size:17px}'};function zp(e,t){re(t,!0),fr(e,jp);let i=ms(t,"startTime",3,0),r=fe((()=>i()<Math.floor(Date.now()/1e3))),s=ke(void 0),a=ke(void 0),n=0,o=ke(void 0),l=ke(void 0),u=fe((()=>(ui(o)??1/0)<=509||(ui(l)??1/0)<=320)),d=fe((()=>!ui(u)&&((ui(o)??1/0)<=699||(ui(l)??1/0)<=599))),c=t.onUpcomingLiveViewStateChanged?(0,m.throttleFn)((()=>{cancelAnimationFrame(n),n=requestAnimationFrame((()=>{let e={type:ui(r)?"expired":"default",size:ui(u)?"s":ui(d)?"m":"l"},i=ui(r)?ui(s):ui(a);t.onUpcomingLiveViewStateChanged(e,i)}))}),300):void 0;rt((()=>{ui(l),ui(o),ui(r),c?.()})),Yi((()=>{if(cancelAnimationFrame(n),c?.cancel(),t.onUpcomingLiveViewStateChanged){let e={type:ui(r)?"expired":"default",size:ui(u)?"s":ui(d)?"m":"l"};t.onUpcomingLiveViewStateChanged(e)}}));var h=Fp();h.__contextmenu=function(...e){t.onContextMenu?.apply(this,e)},h.__click=function(...e){t.onClick?.apply(this,e)};var p=Ye(h),f=e=>{var t=Dp(),i=Ye(t);let r;var a=Ye(i,!0);ze(i),ze(t),Xr(t,(e=>_e(s,e)),(()=>ui(s))),nt(((e,t)=>{r=wr(i,1,"waiting__title s-r",null,r,e),ji(a,t)}),[()=>({medium:ui(d),small:ui(u)}),()=>Da("waiting_live_upcoming_title")]),Ai(e,t)},g=e=>{var t=Op(),s=Ye(t);let n;var o=Ye(s,!0);ze(s);var l=Je(s,2);let c=fe((()=>ui(u)||ui(d))),h=fe((()=>i()||0));Bp(l,{get isSmallSize(){return ui(c)},get startTime(){return ui(h)},onTimerOver:()=>_e(r,!0)}),ze(t),Xr(t,(e=>_e(a,e)),(()=>ui(a))),nt(((e,t)=>{n=wr(s,1,"timer__title s-r",null,n,e),ji(o,t)}),[()=>({medium:ui(d),small:ui(u)}),()=>Da("waiting_live_timer_title")]),Ai(e,t)};Ji(p,(e=>{ui(r)?e(f):e(g,!1)})),ze(h),nt((()=>xr(h,`background-image: url(${t.thumbUrl})`))),Kr(h,"clientWidth",(e=>_e(o,e))),Kr(h,"clientHeight",(e=>_e(l,e))),Ai(e,h),se()}wi(["contextmenu","click"]);var qp=Ti('<div class="waiting-container s-p"><div class="waiting-caption s-p"><!> <p class="waiting-title s-p"> </p></div></div>'),Hp={hash:"s-p",code:'.waiting-container.s-p{align-items:center;background-color:var(--black);background-position:50%;background-repeat:no-repeat;background-size:cover;display:flex;justify-content:center}.waiting-container.s-p,.waiting-container.s-p:before{height:100%;left:0;position:absolute;top:0;width:100%}.waiting-container.s-p:before{backdrop-filter:blur(10px);background-color:rgba(0,0,0,.4);content:""}.waiting-caption.s-p{align-items:center;display:flex;flex-direction:column;position:relative}.waiting-title.s-p{font-size:20px;font-weight:400;line-height:1.2;margin:0;padding:20px;text-align:center}'};function Up(e,t){re(t,!0),fr(e,Hp);let i=ms(t,"thumbUrl",3,""),r={recover:Da("waiting_live_recover_title"),record:Da("waiting_record_title")},s=fe((()=>r[t.kind]||""));var a=qp();a.__contextmenu=function(...e){t.onContextMenu?.apply(this,e)},a.__click=function(...e){t.onClick?.apply(this,e)};var n=Ye(a),o=Ye(n);ml(o,{style:"position: static; transform: translate(0, 0)"});var l=Je(o,2),u=Ye(l,!0);ze(l),ze(n),ze(a),nt((()=>{xr(a,`background-image: url('${i()}')`),ji(u,ui(s))})),Ai(e,a),se()}wi(["contextmenu","click"]);var Wp=_i('<path d="M6 10.2 3.5 7.7a.99.99 0 0 0-1.4 1.4l3.2 3.2a1 1 0 0 0 1.4 0l7.6-7.6a.99.99 0 0 0-1.4-1.4z"></path>');var Qp=Ti('<div class="select-icon s-1w"><!></div>'),Gp={hash:"s-1w",code:".select-icon.s-1w{margin-right:auto;opacity:.9;padding-right:12px;position:relative;top:3px}"};function Kp(e){fr(e,Gp);var t=Qp();(function(e){Ea(e,{width:"16",height:"16",testId:"check-mark-icon",children:(e,t)=>{Ai(e,Wp())},$$slots:{default:!0}})})(Ye(t)),ze(t),Ai(e,t)}var Yp=(e,t)=>{e.stopPropagation(),t.item.selectItem(t.item.value)},Xp=(e,t)=>{Yn(e,(()=>t.item.selectItem(t.item.value)))},Jp=Ti("<p> </p>"),Zp=Ti('<p class="sublabel s-1q"> </p>'),ef=Ti('<li role="menuitem" tabindex="0"><!> <div><!> <!></div></li>'),tf={hash:"s-1q",code:".menu-item-value.s-1q{align-items:end;display:flex;flex-direction:column;min-width:0}.menu-item-value[data-selected=false].s-1q{--select-icon-width:16px;--icon-padding:12px;margin-left:calc(var(--icon-padding) + var(--select-icon-width))}.label.s-1q,.sublabel.s-1q{max-width:100%;overflow:hidden;text-overflow:ellipsis}.sublabel.s-1q{opacity:.5}"};wi(["click","keydown"]);var rf=Ti('<li role="menuitem" tabindex="0" aria-haspopup="true"><!> <div><!></div></li>');wi(["click","keydown"]);var sf=100,af=200,nf=300,of=400,lf=500,uf=600,df=700,cf=800,hf=900,pf=1e3,ff=(e,t)=>{(async(e,t,i)=>{if(Hn(e),(e=>"ArrowLeft"===e.code)(e))return Fn(e),void t();zn(e)&&(Fn(e),i())})(e,t.returnFromSubMenu,t.closeSettingsMenu)},mf=(e,t)=>{e.stopPropagation(),t.returnFromSubMenu()},gf=(e,t)=>{qn(e)&&(Fn(e),t.returnFromSubMenu())},vf=Ti('<div><ul role="menu"><li role="menuitem" tabindex="0" data-testid="return-to-settings-menu"><!> <p class="title s-19"> </p></li> <!></ul></div>'),bf={hash:"s-19",code:".sub-menu.s-19{--item-padding-vertical-mobile:16px;--item-padding-vertical:7px;--item-label-line-height:18px;--edge-item-padding-vertical-mobile:calc(6px + var(--item-padding-vertical-mobile));--edge-item-padding-vertical:calc(8px + var(--item-padding-vertical))}.sub-menu.s-19 .item.mobile{font-size:14px;line-height:var(--item-label-line-height);padding:var(--item-padding-vertical-mobile) 17px}.sub-menu.s-19{padding-top:calc(var(--edge-item-padding-vertical) + var(--item-padding-vertical) + var(--item-label-line-height))}.sub-menu.mobile.s-19{padding-top:calc(var(--edge-item-padding-vertical-mobile) + var(--item-padding-vertical-mobile) + var(--item-label-line-height) + 1px)}.sub-menu.s-19 .items:where(.s-19) .item.header:where(.s-19){border-bottom:var(--divider-border);display:flex;justify-content:space-between;left:0;min-width:max-content;position:absolute;right:0;top:0}.header.s-19 .title:where(.s-19){margin-left:8px}.sub-menu.s-19 .item{padding:var(--item-padding-vertical) 12px;padding-right:22px}.items.s-19 .item:first-child:not(.mobile){padding-top:var(--edge-item-padding-vertical)}.items.s-19 .item:last-child:not(.mobile){padding-bottom:var(--edge-item-padding-vertical)}.items.s-19 .item.mobile:first-child{padding-top:var(--edge-item-padding-vertical-mobile)}.items.s-19 .item.mobile:last-child{padding-bottom:var(--edge-item-padding-vertical-mobile)}.sub-menu.s-19 .item.bottomBordered{border-bottom:var(--divider-border)}.sub-menu.s-19 .item .sublabel{font-size:12px;line-height:14px}.item.s-19:not(.mobile) p:where(.s-19),.sub-menu.s-19 .item:not(.mobile) .label{font-size:13px;line-height:var(--item-label-line-height)}"};function yf(e,t){re(t,!0),fr(e,bf);let[i,r]=us(),s=()=>ls(c,"$playerSize",i),a=ms(t,"isMobile",3,!1),n=ms(t,"playerControlsHeight",3,0),o=ms(t,"ariaLabelReturnFromSubMenu",19,(()=>Da("aria_label_submenu_back"))),l=ms(t,"listRef",15);Ki((()=>{let e=t.items.findIndex((e=>e.selected));l().children[e+1].focus()}));let u=Os(),d=u.ui.isFullscreen,c=u.ui.playerSize,h=ke(void 0),p=ke(0),f=ke(0),m=fe((()=>a()&&ls(d,"$isFullscreen",i)?`max-height: ${Math.round(.6*s().height)}px`:a()?"":`max-height: ${s().height-32-ui(f)-n()}px; overflow: auto;`)),g=fe((()=>Math.max(t.minWidth,ui(p))));var v=vf();let b;var y=Ye(v);let S;y.__keydown=[ff,t];var w=Ye(y);let $;w.__click=[mf,t],w.__keydown=[gf,t];var x=Ye(w);cn(x,{direction:"left"});var k=Je(x,2),T=Ye(k,!0);ze(k),ze(w),Xr(w,(e=>_e(h,e)),(()=>ui(h))),sr(Je(w,2),17,(()=>t.items),rr,((e,i)=>{var r=Ei(),s=Xe(r),n=e=>{!function(e,t){re(t,!0),fr(e,tf);let i=ms(t,"isMobile",3,!1);var r=ef();let s;r.__click=[Yp,t],r.__keydown=[Xp,t];var a=Ye(r),n=e=>{Kp(e)};Ji(a,(e=>{t.item.selected&&e(n)}));var o=Je(a,2);let l;var u=Ye(o),d=e=>{var i=Ei();cr(Xe(i),(()=>t.item.valueComponent),((e,i)=>{i(e,ps((()=>t.item.valueComponentParams??{})))})),Ai(e,i)},c=e=>{var r=Jp();let s;var a=Ye(r,!0);ze(r),nt((e=>{s=wr(r,1,"label s-1q",null,s,e),ji(a,t.item.label??t.item.value)}),[()=>({mobile:i()})]),Ai(e,r)};Ji(u,(e=>{t.item.valueComponent?e(d):e(c,!1)}));var h=Je(u,2),p=e=>{var i=Zp(),r=Ye(i,!0);ze(i),nt((()=>ji(r,t.item.sublabel))),Ai(e,i)};Ji(h,(e=>{t.item.sublabel&&e(p)})),ze(o),ze(r),nt(((e,i,a)=>{s=wr(r,1,"item",null,s,e),Pr(r,"data-value",t.item.dataValue??t.item.value),Pr(r,"aria-label",i),Pr(r,"data-testid",t.item.dataTestid),l=wr(o,1,"menu-item-value s-1q",null,l,a),Pr(o,"data-selected",t.item.selected)}),[()=>({mobile:i()}),()=>t.item.ariaLabel??t.item.label??t.item.value.toString(),()=>({"submenu-value-mobile":i()})]),Ai(e,r),se()}(e,{get item(){return ui(i)},get isMobile(){return a()}})},o=(e,r)=>{var s=e=>{!function(e,t){re(t,!0);let i=ms(t,"isMobile",3,!1),r=ms(t,"refMenuItems",15),s=fe((()=>()=>t.openSubMenuList(t.item.children))),a=fe((()=>e=>Kn(e,ui(s))));var n=rf();let o;n.__click=function(...e){ui(s)?.apply(this,e)},n.__keydown=function(...e){ui(a)?.apply(this,e)};var l=Ye(n),u=e=>{Kp(e)};Ji(l,(e=>{t.item.selected&&e(u)}));var d=Je(l,2);let c;var h=Ye(d),p=e=>{var i=Ei();let r=fe((()=>t.item.valueComponent));cr(Xe(i),(()=>ui(r)),((e,i)=>{i(e,ps((()=>t.item.valueComponentParams??{})))})),Ai(e,i)},f=e=>{var i=Ci();nt((()=>ji(i,t.item.label))),Ai(e,i)};Ji(h,(e=>{t.item.valueComponent?e(p):e(f,!1)})),ze(d),ze(n),Xr(n,(e=>r(r()[t.item.id]=e,!0)),(()=>r()?.[t.item.id])),nt(((e,i)=>{o=wr(n,1,"item",null,o,e),Pr(n,"aria-label",t.item.ariaLabel??t.item.label),Pr(n,"data-testid",t.item.id),c=wr(d,1,"menu-item-value",null,c,i)}),[()=>({mobile:i(),bottomBordered:t.item.bottomBordered}),()=>({"submenu-value-mobile":i()})]),Ai(e,n),se()}(e,{get isMobile(){return a()},get item(){return ui(i)},get openSubMenuList(){return t.openSubMenuList},get refMenuItems(){return t.refMenuItems}})};Ji(e,(e=>{"OPEN_SUB_MENU"===ui(i).type&&e(s)}),r)};Ji(s,(e=>{"SELECT_VALUE"===ui(i).type?e(n):e(o,!1)})),Ai(e,r)})),ze(y),Xr(y,(e=>l(e)),(()=>l())),ze(v),nt(((e,i,r)=>{b=wr(v,1,"sub-menu menu s-19",null,b,e),Pr(v,"data-testid",`${t.id}-sub-menu`),xr(v,`min-width: ${ui(g)}px`),S=wr(y,1,"items s-19",null,S,i),xr(y,ui(m)),$=wr(w,1,"item header back s-19",null,$,r),Pr(w,"aria-label",o()),ji(T,t.title)}),[()=>({desktop:!a(),mobile:a()}),()=>({mobile:a()}),()=>({mobile:a()})]),Kr(w,"clientWidth",(e=>_e(p,e))),Kr(w,"clientHeight",(e=>_e(f,e))),Ai(e,v),se(),r()}wi(["keydown","click"]);var Sf=(e,t)=>Kn(e,t()),wf=(e,t)=>{e.stopPropagation(),t()()},$f=Ti('<div class="value s-1a"> </div>'),xf=Ti('<li role="menuitem" tabindex="0" aria-haspopup="true"><div class="icon-wrapper"><!></div> <div class="label"> </div> <!></li>'),kf={hash:"s-1a",code:".value.s-1a{opacity:.7;overflow:hidden;position:relative;text-overflow:ellipsis}"};wi(["click","keydown"]);var Tf=(e,t)=>{Yn(e,(()=>t()))},_f=Ti('<div class="icon icon-error-stub"><div class="inner"></div></div>'),Cf=Ti('<img class="icon" aria-hidden="true"/>'),Ef=Ti('<li role="menuitem" tabindex="0"><div class="icon-wrapper"><!></div> <div class="label s-1b"> </div></li>'),Af={hash:"s-1b",code:".label.s-1b{overflow:hidden;text-overflow:ellipsis}"};wi(["click","keydown"]);var Lf=Ti('<div class="toggle_wrap s-1o"><div></div> <div class="toggle-label s-1o"></div></div>'),Pf={hash:"s-1o",code:'.toggle_wrap.s-1o{cursor:pointer;font-size:12px;line-height:15px;min-height:15px;padding:0;user-select:none}.toggle.s-1o{background-color:var(--toggle-color-separator);border-radius:45px;cursor:pointer;float:right;height:9px;margin-top:3px;width:28px}.toggle.s-1o:after{background-color:var(--toggle-color-off);border-radius:50%;content:"";float:left;height:15px;left:0;position:relative;top:-3px;transition:left .1s ease;width:15px}.toggle.on.s-1o:after{background-color:var(--toggle-color-on);left:13px}.toggle-label.s-1o{overflow:hidden}'};var Mf=(e,t,i)=>{((e,t,i)=>{if(qn(e))Fn(e),i(!t);else{let r=e.code;if("ArrowLeft"===r&&t)return i(!1),void Fn(e);"ArrowRight"===r&&!t&&(i(!0),Fn(e))}})(e,t(),(e=>i()(e)))},If=(e,t,i)=>{e.stopPropagation(),t()(!i())},Rf=Ti('<div><div class="icon-wrapper"><!></div> <div class="label"> </div> <!></div>'),Vf=Ti('<li role="menuitem" tabindex="0"><!></li>');function Nf(e,t){re(t,!0);let i=ms(t,"isMobile",3,!1),r=ms(t,"onClick",3,m.noop),s=ms(t,"enabled",3,!1),a=ms(t,"tooltipText",3,void 0),n=ms(t,"maxTooltipWidth",3,void 0);var o=Vf();let l;o.__click=[If,r,s],o.__keydown=[Mf,s,r],gu(Ye(o),{get content(){return a()},get isMobile(){return i()},placement:"left",translateX:10,isFullWidthWrapper:!0,get maxTooltipWidth(){return n()},children:(e,r)=>{var a=Rf();let n;var o=Ye(a),l=Ye(o),u=e=>{Lc(e,{get icon(){return t.icon}})},d=e=>{var i=Ei();let r=fe((()=>t.icon));cr(Xe(i),(()=>ui(r)),((e,t)=>{t(e,{})})),Ai(e,i)};Ji(l,(e=>{"string"==typeof t.icon?e(u):e(d,!1)})),ze(o);var c=Je(o,2),h=Ye(c,!0);ze(c),function(e,t){fr(e,Pf);let i=ms(t,"enabled",3,!1);var r=Lf(),s=Ye(r);let a;qe(2),ze(r),nt((e=>a=wr(s,1,"toggle s-1o",null,a,e)),[()=>({on:i()})]),Ai(e,r)}(Je(c,2),{get enabled(){return s()}}),ze(a),nt((e=>{n=wr(a,1,"switch-wrapper",null,n,e),ji(h,t.label)}),[()=>({mobile:i()})]),Ai(e,a)},$$slots:{default:!0}}),ze(o),nt((e=>{l=wr(o,1,"item switch-item",null,l,e),Pr(o,"aria-label",t.ariaLabel??t.label),Pr(o,"data-testid",t.id)}),[()=>({mobile:i()})]),Ai(e,o),se()}wi(["click","keydown"]);var Bf=Ti('<div class="quality-icon s-1n"><!></div>'),Df=Ti('<div class="quality-label s-1n"><span> </span> <!></div>'),Of={hash:"s-1n",code:".quality-label.s-1n{position:relative}.quality.s-1n{font-size:13px;line-height:18px}.quality.sub.s-1n{opacity:.7}.quality-icon.s-1n{display:flex;padding-left:2px;position:absolute;right:0;top:0;transform:translateX(100%)}.quality-icon.s-1n svg{color:var(--blue-light)}"};function Ff(e,t){re(t,!0),fr(e,Of);let i=ms(t,"isSubCase",3,!1),r=fe((()=>t.quality?(0,m.getVideoQualityLabel)(t.quality):"")),s=fe((()=>Hl(t.quality)));var a=Df(),n=Ye(a);let o;var l=Ye(n,!0);ze(n);var u=Je(n,2),d=e=>{var t=Bf();let i=fe((()=>ui(s)));cr(Ye(t),(()=>ui(i)),((e,t)=>{t(e,{})})),ze(t),nt((()=>Pr(t,"data-testid",`${ui(r)}-icon`))),Ai(e,t)};Ji(u,(e=>{ui(s)&&!t.isMobile&&e(d)})),ze(a),nt((e=>{o=wr(n,1,"s-1n",null,o,e),ji(l,t.label)}),[()=>({sub:!i(),quality:!t.isMobile})]),Ai(e,a),se()}var jf=({quality:e,availableQualities:t})=>{let i=t.find((t=>t.value===e));return i?i.displayValue:e},zf=Ti('<div class="menu-item-value-wrapper s-1s"><!></div>'),qf={hash:"s-1s",code:".menu-item-value-wrapper.s-1s{line-height:normal}"};function Hf(e,t){re(t,!0),fr(e,qf);let[i,r]=us(),s=()=>ls(n,"$currentQuality$",i),a=Os(),n=a.state.currentQuality$,o=a.state.availableQualities$,l=a.ui.isMobile,u=fe((()=>t.prefix+(t.selected&&s()!==m.VideoQuality.INVARIANT?" · ":""))),d=fe((()=>(({quality:e,availableQualities:t,prefix:i,onlyPrefix:r})=>e?r||e===f.VideoQuality.INVARIANT?i:`${i}${jf({quality:e,availableQualities:t})}`:"...")({prefix:ui(u),quality:s(),availableQualities:ls(o,"$availableQualities$",i),onlyPrefix:!t.selected})));var c=zf(),h=Ye(c);let p=fe((()=>t.selected?s():void 0));Ff(h,{get quality(){return ui(p)},get label(){return ui(d)},get isMobile(){return ls(l,"$isMobile$",i)},isSubCase:!0}),ze(c),Ai(e,c),se(),r()}var Uf={br:!0,span:!0},Wf=(e,t={})=>{if(!e)return e;let i={...Uf,...t},r=Object.keys(i);if(!r.length)return e;let s=(e=>{let t=e.join("|");return new RegExp(`<(?<keyhtml>.*?)(?<propshtml> .*?)?>(?<childrenhtml>.*?)</\\k<keyhtml>>|{(?<keyi18n>${t})}(?<childreni18n>.*?){/\\k<keyi18n>}|<(?<keyhtmlself>.*?)(?<propshtmlself> .*?)?/?>|{(?<keyi18nself>${t})}`,"g")})(r),a=[],n=0;for(let t of e.matchAll(s)){let r=t[0],s=t.groups?.keyhtml||t.groups?.keyi18n||t.groups?.keyhtmlself||t.groups?.keyi18nself||"",{index:o}=t;if(!i[s]){a.push(e.slice(n,o)),n=o+r.length;continue}let l=t.groups?.childrenhtml?Wf(t.groups.childrenhtml,i):"",u=t.groups?.childrenhtml?r.replace(new RegExp(t.groups?.childrenhtml),(()=>l||"")):r;a.push(e.slice(n,o),u),n=o+r.length}return 0===n?e:(a.push(e.slice(n)),a.join(""))};function Qf(e,t){re(t,!1);let i=ms(t,"message",8),r=Wf(i());Jr();var s=Ei(),a=Xe(s),n=e=>{var t=Ei();dr(Xe(t),(()=>r)),Ai(e,t)};Ji(a,(e=>{r&&e(n)})),Ai(e,s),se()}var Gf=Ti('<p class="quality-applies sublabel s-1r"><!></p>'),Kf={hash:"s-1r",code:".quality-applies.s-1r{color:hsla(0,0%,100%,.5);display:flex;justify-content:end;padding:3px 0}.quality-applies span{color:#70c1ff}"};function Yf(e,t){re(t,!1),fr(e,Kf),Jr();var i=Gf(),r=Ye(i);let s=me((()=>Da("quality_applience",{action:`<span>${Da("quality_applience_action")}</span>`})));Qf(r,{get message(){return ui(s)}}),ze(i),Ai(e,i),se()}var Xf=({isAutoQualityEnabled:e,trafficSavingEnabled:t,highQualityEnabled:i})=>{let r=!e&&!t&&!i;return{id:"quality-other-settings",type:"OPEN_SUB_MENU",label:Da("other_quality"),selected:r,valueComponent:Hf,valueComponentParams:{prefix:Da("other_quality"),selected:r},children:"quality-other-settings"}},Jf=({appliesTo:e,labelWithQuality:t,selected:i},{selectQuality:r})=>({id:"quality-auto",type:"SELECT_VALUE",value:"auto",label:Da("auto_quality_limit"),valueComponent:t?Hf:void 0,valueComponentParams:{prefix:Da("auto_quality_limit"),selected:i},selectItem:()=>r("auto",e),selected:i}),Zf=({labelWithQuality:e,appliesTo:t,selected:i},{toggleHighQuality:r})=>({id:"quality-high",type:"SELECT_VALUE",value:"high_quality",selectItem:()=>r(!0,t),selected:i,label:Da("high_quality"),valueComponent:e?Hf:void 0,valueComponentParams:{prefix:Da("high_quality"),selected:i},sublabel:Da("high_quality_description")}),em=({labelWithQuality:e,appliesTo:t,selected:i},{toggleTrafficSaving:r})=>({id:"quality-traffic-saving",type:"SELECT_VALUE",value:"save_traffic",selectItem:()=>r(!0,t),selected:i,label:Da("traffic_saving_quality"),valueComponent:e?Hf:void 0,valueComponentParams:{prefix:Da("traffic_saving_quality"),selected:i},sublabel:Da("traffic_saving_quality_description")}),tm=(e,t)=>String(t.findIndex((t=>t.id===e.id))+1),im=(e,t)=>{if(!e)return"";let i,{language:r,label:s}=e;if("und"===r?i=void 0:r&&(i=_d(r)??r),s&&r&&i){let a=t.filter((e=>e.label===s&&e.language===r));if(1===a.length)return Da("audio_stream_display_language_label",{language:i,label:s});{let t=tm(e,a);return Da("audio_stream_display_language_label_index",{language:i,label:s,index:t})}}if(s){let i=t.filter((e=>e.label===s));if(1===i.length)return s;{let t=tm(e,i);return Da("audio_stream_display_label_index",{label:s,index:t})}}if(r&&i){let s=t.filter((e=>e.language===r));if(1===s.length)return i;{let t=tm(e,s);return Da("audio_stream_display_language_index",{language:i,index:t})}}let a=tm(e,t);return Da("audio_stream_display_unknown",{index:a})},rm={"quality-settings":e=>{let{isAutoQualityEnabled:t,isAutoQualityAvailable:i,trafficSavingEnabled:r,highQualityEnabled:s}=e,a=[];return i&&a.push({handler:Jf,selected:t&&!r&&!s||!1}),a.push({handler:em,selected:r},{handler:Zf,selected:s}),{title:Da("submenu_quality"),id:"quality-settings",items:[{id:"quality-appliance-settings",type:"OPEN_SUB_MENU",valueComponent:Yf,bottomBordered:!0,children:"quality-appliance"},...a.map((({handler:t,selected:i})=>t({labelWithQuality:!0,appliesTo:"to-video",selected:i},e))),Xf(e)]}},"quality-other-settings":({closeSettingsMenu:e,selectQuality:t,availableQualities:i,isMobile:r})=>({id:"quality-other-settings",title:Da("submenu_quality"),closeSettingsMenu:e,items:i.map((e=>({type:"SELECT_VALUE",value:e.value,valueComponent:Ff,valueComponentParams:{quality:e.value,label:e.displayValue,isMobile:r,isSubCase:!0},selectItem:e=>t(e,"to-video"),selected:e.selected,label:e.displayValue})))}),"quality-appliance":e=>{let{closeSettingsMenu:t}=e;return{id:"quality-appliance",title:Da("default_quality_for_any_video"),closeSettingsMenu:t,items:[{handler:Jf,selected:"auto_quality"===wa()?.type},{handler:em,selected:"traffic_saving"===wa()?.type},{handler:Zf,selected:"high_quality"===wa()?.type}].map((({handler:t,selected:i})=>t({labelWithQuality:!1,appliesTo:"as-default",selected:i},e)))}},"audio-tracks":({closeSettingsMenu:e,availableAudioStreams:t,currentAudioStream:i,selectAudioLanguage:r})=>({id:"audio-tracks",title:Da("submenu_audio_languages"),closeSettingsMenu:e,items:t.map((e=>({type:"SELECT_VALUE",value:e,dataValue:e.id,selectItem:r,selected:e.id===i?.id,label:im(e,t)})))}),"playback-rate":({closeSettingsMenu:e,availablePlaybackRates:t,selectPlaybackRate:i})=>({id:"playback-rate",title:Da("submenu_playback_rate"),closeSettingsMenu:e,items:t.map((e=>({type:"SELECT_VALUE",value:e.value,selectItem:i,selected:e.selected,label:e.displayValue})))}),subtitles:({availableSubtitlesList:e,selectSubtitle:t})=>({id:"subtitles",minWidth:164,title:Da("subtitles_caption"),items:e.map((e=>({type:"SELECT_VALUE",value:e.value,selectItem:()=>t(e),selected:e.selected,label:e.displayValue,dataTestid:e.value===Md?"sub_off":void 0})))})},sm=_i('<path d="M3.1 9.5c0-2.24 0-3.36.44-4.22A4 4 0 015.28 3.54C6.14 3.1 7.26 3.1 9.5 3.1h5c2.24 0 3.36 0 4.22.44a4 4 0 011.74 1.74c.44.86.44 1.98.44 4.22s0 3.36-.44 4.22a4 4 0 01-1.74 1.74c-.84.43-1.93.44-4.07.44l.55 2.2h1.9a.9.9 0 010 1.8H6.9a.9.9 0 110-1.8h1.9l.55-2.2c-2.14 0-3.23-.01-4.07-.44a4 4 0 01-1.74-1.74C3.1 12.86 3.1 11.74 3.1 9.5m11.4-4.6h-5c-1.15 0-1.9 0-2.48.05-.56.04-.79.12-.92.19a2.2 2.2 0 00-.96.96 2 2 0 00-.2.92C4.9 7.6 4.9 8.35 4.9 9.5s0 1.9.05 2.48c.04.56.12.79.19.92q.33.63.96.96c.13.07.36.15.92.2.58.04 1.33.04 2.48.04h5c1.15 0 1.9 0 2.48-.05.56-.04.79-.12.92-.19a2.2 2.2 0 00.96-.96c.07-.13.15-.36.2-.92.04-.58.04-1.33.04-2.48s0-1.9-.05-2.48a3 3 0 00-.19-.92 2.2 2.2 0 00-.96-.96 2 2 0 00-.92-.2c-.58-.04-1.33-.04-2.48-.04m-3.3 11-.55 2.2h2.7l-.55-2.2z"></path>');function am(e){Ea(e,{testId:"traffic-saving-icon",children:(e,t)=>{Ai(e,sm())},$$slots:{default:!0}})}var nm=_i('<path d="M8.3 14.25c1.86 1.9 5.5.02 5.5-3.55V5.64l2.4-.7A2.74 2.74 0 0 0 18 2.37V.64a.75.75 0 0 0-.92-.62l-.26.06C15.88.3 14.93.51 14 .8c-1.33.45-2.03 1.62-2.01 3.08V9c-3.89.2-5.64 3.29-3.7 5.25ZM.9.1a.9.9 0 0 0 0 1.8h8.2a.9.9 0 0 0 0-1.8H.9ZM.9 5.1a.9.9 0 1 0 0 1.8h7.2a.9.9 0 0 0 0-1.8H.9ZM0 11c0-.5.4-.9.9-.9h4.18a.9.9 0 1 1 0 1.8H.9A.9.9 0 0 1 0 11Z"></path>');function om(e){Ea(e,{width:"18",height:"15",children:(e,t)=>{Ai(e,nm())},$$slots:{default:!0}})}var lm=_i('<path d="M11 4.07V2.05c-2.01.2-3.84 1-5.32 2.21L7.1 5.69A8 8 0 0 1 11 4.07M5.69 7.1 4.26 5.68A10 10 0 0 0 2.05 11h2.02a8 8 0 0 1 1.62-3.9M2.05 13c.2 2.01 1 3.84 2.21 5.32l1.43-1.43A8 8 0 0 1 4.07 13zM11 21.95v-2.02a8 8 0 0 1-3.9-1.62l-1.42 1.43A10 10 0 0 0 11 21.95M22 12c0 5.16-3.92 9.42-8.95 9.95v-2.02C16.97 19.41 20 16.05 20 12s-3.03-7.41-6.95-7.93V2.05C18.08 2.58 22 6.84 22 12M10.69 8.58l4.74 2.73a.8.8 0 0 1 0 1.37l-4.74 2.74a.8.8 0 0 1-1.19-.68V9.26a.8.8 0 0 1 1.19-.68"></path>');function um(e){Ea(e,{testId:"play-speed-icon",children:(e,t)=>{Ai(e,lm())},$$slots:{default:!0}})}var dm=_i('<path d="M12 2a.9.9 0 01.9.9v10.93l4.56-4.57a.9.9 0 011.28 1.28l-6.1 6.1a.9.9 0 01-1.28 0l-6.1-6.1a.9.9 0 111.28-1.28l4.56 4.57V2.9A.9.9 0 0112 2M4 20a.9.9 0 01.9-.9h14.2a.9.9 0 110 1.8H4.9A.9.9 0 014 20"></path>');function cm(e){Ea(e,{testId:"download-icon",children:(e,t)=>{Ai(e,dm())},$$slots:{default:!0}})}var hm=_i('<path d="M8.86 2.1h6.28c.67 0 1.2.21 1.68.7l4.38 4.38c.48.48.7 1 .7 1.68v6.28c0 .68-.22 1.2-.7 1.68l-4.38 4.38c-.48.48-1 .7-1.68.7H8.86c-.68 0-1.2-.22-1.68-.7L2.8 16.82c-.48-.48-.7-1-.7-1.68V8.86c0-.68.22-1.2.7-1.68L7.18 2.8c.48-.49 1-.7 1.68-.7m-.44 2L4.1 8.43c-.18.18-.21.24-.21.5v6.17c0 .25.03.31.2.5l4.32 4.3c.18.18.24.21.5.21h6.17c.25 0 .31-.03.5-.2l4.3-4.32c.18-.18.21-.24.21-.5V8.92c0-.25-.03-.31-.2-.5l-4.32-4.3c-.18-.18-.24-.21-.5-.21H8.92c-.25 0-.32.03-.5.2M13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-.1-8.1a.9.9 0 0 0-1.8 0v5.2a.9.9 0 1 0 1.8 0z"></path>');function pm(e){Ea(e,{testId:"report-icon",children:(e,t)=>{Ai(e,hm())},$$slots:{default:!0}})}var fm=_i('<path d="M4 12.3V12c0-1.47 0-2.55.08-3.4.07-.9.21-1.48.45-1.95a4.85 4.85 0 0 1 2.12-2.12 5.1 5.1 0 0 1 1.95-.45C9.5 4 10.68 4 12.3 4h4.51c-.03-.16-.09-.33-.17-.49a2.4 2.4 0 0 0-1.05-1.05c-.3-.16-.63-.21-.93-.24-.29-.02-.64-.02-1.03-.02h-1.37c-1.58 0-2.81 0-3.81.08a6.84 6.84 0 0 0-2.62.64 6.65 6.65 0 0 0-2.9 2.91c-.4.76-.57 1.6-.65 2.62-.08 1-.08 2.23-.08 3.81v1.37c0 .4 0 .74.02 1.03.03.3.08.62.24.93A2.4 2.4 0 0 0 4 16.8V12.3ZM10.08 6h-.03c-.53 0-.97 0-1.33.03-.39.03-.76.1-1.12.28a2.9 2.9 0 0 0-1.3 1.3c-.17.35-.24.72-.27 1.1C6 9.09 6 9.53 6 10.06v7.9c0 .53 0 .97.03 1.33.03.39.1.76.28 1.12a2.9 2.9 0 0 0 1.3 1.3c.35.17.72.24 1.1.27.37.03.81.03 1.33.03h6.91c.53 0 .97 0 1.33-.03.39-.03.76-.1 1.12-.28a2.9 2.9 0 0 0 1.3-1.3c.17-.35.24-.72.27-1.1.03-.37.03-.81.03-1.34v-7.9c0-.53 0-.97-.03-1.33-.03-.39-.1-.76-.28-1.12a2.9 2.9 0 0 0-1.3-1.3 2.96 2.96 0 0 0-1.1-.27C17.91 6 17.47 6 16.94 6h-6.87ZM8.41 7.92c.06-.04.18-.07.45-.1.28-.02.65-.02 1.22-.02h6.84c.57 0 .94 0 1.22.02.27.03.39.06.45.1.21.1.39.28.5.49.03.06.06.18.09.45.02.28.02.65.02 1.22v7.84c0 .57 0 .94-.02 1.22-.03.27-.06.39-.1.45-.1.21-.28.39-.49.5-.06.03-.18.06-.45.09-.28.02-.65.02-1.22.02h-6.84c-.57 0-.94 0-1.22-.02a1.23 1.23 0 0 1-.45-.1 1.1 1.1 0 0 1-.5-.49 1.23 1.23 0 0 1-.09-.45c-.02-.28-.02-.65-.02-1.22v-7.84c0-.57 0-.94.02-1.22.03-.27.06-.39.1-.45.1-.21.28-.39.49-.5Z"></path>');function mm(e){Ea(e,{children:(e,t)=>{Ai(e,fm())},$$slots:{default:!0}})}var gm=_i('<path d="M12 20.1a8.1 8.1 0 1 0 0-16.2 8.1 8.1 0 0 0 0 16.2m0 1.9a10 10 0 1 1 0-20 10 10 0 0 1 0 20m0-12.37A1.32 1.32 0 1 1 12 7a1.32 1.32 0 0 1 0 2.63m-.95 2.82c0-.54.43-.98.95-.98s.95.44.95.98v3.83c0 .54-.43.98-.95.98a.96.96 0 0 1-.95-.98z"></path>');function vm(e){Ea(e,{testId:"info-icon",children:(e,t)=>{Ai(e,gm())},$$slots:{default:!0}})}var bm=Ti('<div class="menu-item-value-wrapper s-1u"><!></div>'),ym={hash:"s-1u",code:".menu-item-value-wrapper.s-1u{line-height:normal}"};function Sm(e,t){re(t,!0),fr(e,ym);let[i,r]=us(),s=()=>ls(n,"$currentQuality$",i),a=Os(),n=a.state.currentQuality$,o=a.state.availableQualities$,l=a.state.isAutoQualityEnabled$,u=a.ui.isMobile,d=fe((()=>(({quality:e,availableQualities:t,isAutoQualityEnabled:i})=>{if(!e)return"...";let r=jf({quality:e,availableQualities:t});return i?e===f.VideoQuality.INVARIANT?Da("auto_quality_invariant"):Da("auto_quality",{actual:r}):r})({quality:s(),availableQualities:ls(o,"$availableQualities$",i),isAutoQualityEnabled:ls(l,"$isAutoQualityEnabled$",i)})));var c=bm();Ff(Ye(c),{get quality(){return s()},get label(){return ui(d)},get isMobile(){return ls(u,"$isMobile$",i)}}),ze(c),Ai(e,c),se(),r()}var wm={"quality-settings":({isAutoQualityEnabled:e,currentQuality:t,qualityDetailsSubMenuEnabled:i})=>{let r=(e?Da("auto_quality_option"):t)||"";return{id:"quality-settings",type:"OPEN_SUB_MENU",ariaLabel:Da("aria_label_menu_quality",{actual:r}),icon:Kl,label:Da("menu_quality"),value:t,valueComponent:Sm,weight:sf,children:i?"quality-settings":"quality-other-settings"}},"traffic-saving-switch":({trafficSavingEnabled:e,toggleTrafficSaving:t})=>({id:"traffic-saving-switch",weight:lf,type:"SWITCH",onClick:e=>t(e,"to-video"),ariaLabel:Da("aria_label_submenu_traffic_saving"),icon:am,label:Da("menu_traffic_saving"),enabled:e,tooltipText:Da("traffic_saving_helper_text"),maxTooltipWidth:175}),"audio-tracks-settings":({currentAudioStream:e,availableAudioStreams:t})=>{let i=im(e,t);return{id:"audio-tracks-settings",weight:af,type:"OPEN_SUB_MENU",ariaLabel:Da("aria_label_menu_audio_languages",{actual:i}),icon:om,label:Da("menu_audio_languages"),value:i,children:"audio-tracks"}},"playback-rate-settings":({availablePlaybackRates:e,currentPlaybackRate:t})=>{let i=e.find((e=>e.value===t))?.displayValue||"";return{id:"playback-rate-settings",weight:nf,type:"OPEN_SUB_MENU",ariaLabel:Da("aria_label_menu_rate",{actual:i}),icon:um,label:Da("menu_playback_rate"),value:`${t}x`,children:"playback-rate"}},"subtitles-settings":({currentSubtitle:e})=>({id:"subtitles-settings",weight:of,type:"OPEN_SUB_MENU",ariaLabel:Da("aria_label_menu_subtitle",{actual:e.displayValue}),icon:tu,iconProps:{type:"outline"},label:Da("subtitles_caption"),value:e.displayValue,children:"subtitles"}),download:({onDownloadClick:e})=>({id:"download",weight:uf,type:"CLICK",onClick:e,label:Da("download_video_caption"),ariaLabel:Da("aria_label_menu_download"),icon:cm}),"show-support":({onReportProblemClick:e})=>({id:"show-support",weight:df,type:"CLICK",onClick:e,label:Da("menu_report"),ariaLabel:`${Da("menu_report")}. ${Da("aria_label_new_tab_alert")}`,icon:pm,isHiddenFor:["desktop"]}),"copy-data":({onCopyDataClick:e})=>({id:"copy-data",weight:cf,type:"CLICK",onClick:e,label:Da("menu_copy_debug"),ariaLabel:Da("menu_copy_debug"),icon:mm,isHiddenFor:["desktop"]}),"save-trace-info":({onSaveTraceDataClick:e})=>({id:"save-trace-info",weight:hf,type:"CLICK",onClick:e,label:Da("menu_save_debug"),ariaLabel:Da("menu_save_debug"),icon:mm,isHiddenFor:["desktop"]}),"debug-info":({toggleShowDebugInfo:e})=>({id:"debug-info",weight:pf,type:"CLICK",onClick:e,ariaLabel:Da("aria_label_menu_debug_overlay"),label:Da("menu_debug_overlay"),icon:vm,isHiddenFor:["desktop"]})},$m=(e,t)=>{Gn(e,t)},xm=Ti('<div><div> </div> <div class="close s-q"></div></div>'),km=Ti('<div data-testid="settings-menu" role="presentation"><!> <ul role="menu"></ul></div>'),Tm=Ti("<div><!> <!></div>"),_m={hash:"s-q",code:'.settings-menu-container.mobile.s-q{width:100%;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.settings-menu-container.s-q ul{list-style-type:none;margin:0;padding:0}.settings-menu-container.s-q .menu{background-color:var(--settings-bg);border-radius:var(--settings-radius);overflow:hidden;transition:opacity .2s,visibility .2s}.settings-menu-container.s-q .menu .item:first-child:not(.mobile){border-top-left-radius:var(--settings-radius);border-top-right-radius:var(--settings-radius)}.settings-menu-container.s-q .menu .item:last-child{border-bottom-left-radius:var(--settings-radius);border-bottom-right-radius:var(--settings-radius)}.settings-menu-container.s-q .settings-menu .item:first-child:not(.mobile){padding-top:6px}.settings-menu-container.s-q .settings-menu .item:last-child:not(.mobile){padding-bottom:6px}.settings-menu-container.s-q .menu.desktop{bottom:0;max-width:100%;position:absolute;right:0}.settings-menu.s-q{line-height:40px}.settings-menu.desktop.s-q{min-width:300px}.settings-menu-container.s-q .menu.mobile{background:var(--mobile-settings-bg);font-size:15px;line-height:50px;width:100%}.settings-menu-container.s-q .menu.mobile.hidden{display:none}.settings-menu-container.s-q .menu .item:not(.switch-item),.settings-menu-container.s-q .menu .switch-wrapper{align-items:center;color:var(--white);cursor:pointer;display:flex;justify-content:flex-end;position:relative;white-space:nowrap}.settings-menu-container.s-q .menu .item:hover{background-color:var(--settings-item-bg-hover)}.settings-menu-container.s-q .menu .item.mobile:hover{background:var(--mobile-settings-bg)}.settings-menu.s-q .item:not(.switch-item),.settings-menu.s-q .switch-wrapper{padding:0 32px 0 18px}.settings-menu.s-q .item.mobile:not(.switch-item),.settings-menu.s-q .switch-wrapper.mobile{padding:0 14px}.settings-menu.s-q .icon-wrapper{align-items:center;display:flex;height:24px;justify-content:center;margin-right:16px;min-width:24px;width:24px}.settings-menu.s-q .label{flex-grow:1;margin-right:24px;overflow:hidden;text-overflow:ellipsis}.settings-menu.s-q .item.header.mobile:where(.s-q){border-bottom:var(--divider-border);color:var(--white);column-gap:12px;cursor:pointer;display:flex;justify-content:space-between;margin-bottom:4px}.settings-menu-container.s-q .items::-webkit-scrollbar{width:8px}.settings-menu-container.s-q .items::-webkit-scrollbar-track{background-color:#3a3a3a;border-radius:4px;box-shadow:none}.settings-menu-container.s-q .items::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:#666;border:1px solid transparent;border-radius:5px;min-height:40px}.settings-menu-container.s-q .items::-webkit-scrollbar-thumb:hover{background-color:#777}.settings-menu-container.s-q .items.mobile{max-height:160px;overflow-x:hidden;overflow-y:auto;text-align:left}.close.s-q{height:12px;margin-right:-12px;padding:12px;position:relative;width:12px}.close.s-q:after,.close.s-q:before{background-color:var(--white);content:" ";height:12px;left:18px;position:absolute;width:2px}.close.s-q:before{transform:rotate(45deg)}.close.s-q:after{transform:rotate(-45deg)}'};function Cm(e,t){re(t,!0),fr(e,_m);let[i,r]=us(),s=()=>ls(N,"$settingsMenuVisible",i),a=()=>ls(B,"$settingsMenuOpenedByKeyboard",i),n=()=>ls(O,"$isMobile",i),o=()=>ls(H,"$playerSize",i),l=()=>ls(F,"$mobileNotReportControlHidden$",i),u=()=>ls(I,"$availableSubtitlesList$",i),d=()=>ls(k,"$availableAudioStreams$",i),c=()=>ls(P,"$availablePlaybackRates$",i),h=()=>ls(x,"$currentAudioStream$",i),p=()=>ls(z,"$trafficSavingEnabled",i),f=()=>ls(T,"$currentQuality$",i),g=()=>ls(E,"$isAutoQualityEnabled$",i),v=ms(t,"ref",15,void 0),b=ms(t,"playerControlsHeight",3,0),y=le({}),S=le({}),w=Os(),$=ys(),x=w.state.audioStream$,k=w.state.availableAudioStreams$,T=w.state.currentQuality$,_=w.state.availableQualities$,C=w.state.autoQualityLimitingAvailable$,E=w.state.isAutoQualityEnabled$,A=w.state.isAutoQualityAvailable$,L=w.state.currentPlaybackRate$,P=w.state.availablePlaybackRates$,M=w.state.currentSubtitle$,I=w.state.availableSubtitlesList$,R=w.state.canDownload,V=w.state.hasMpegSources$,N=w.ui.settingsMenu.visible$,B=w.ui.settingsMenu.openedByBtnKeyboard$,D=w.ui.settingsMenu.ref$,O=w.ui.isMobile,F=w.ui.mobileNotReportControlHidden$,j=w.state.canChangePlaybackSpeed$,z=w.state.trafficSavingEnabled$,q=w.state.highQualityEnabled$,H=w.ui.playerSize,U=w.ui.debugPanelVisible,W=w.state.isInteractiveTime$,Q=w.ui.additionalSettingsMenuItems$,G=w.ui.t,K=w.actions.internal.downloadVideo,Y=w.actions.internal.closeSettingsMenu,X=w.actions.internal.openSettingsSubMenu,J=w.actions.internal.closeSettingsSubMenu,Z=ke(!1),ee=ke(void 0),te=(()=>{let e=ke(le([])),t=fe((()=>(ui(e).length?ui(e).at(-1):null)||null));return{get current(){return ui(t)},pushSubMenu:t=>{ui(e).push(t)},popSubMenu:()=>{_e(e,ui(e).slice(0,-1),!0)},popAllSubMenus:()=>{_e(e,[],!0)}}})();async function ie(e){te.pushSubMenu(e),await li(),X(e,S[e]);let t=v()?.firstElementChild;t&&jn(t)}function ae(e){e?.stopPropagation(),a()||t.returnFocus?.(),Y(),_e(Z,!1)}function ne(e,t){w.actions.internal.setQuality(e,{appliesTo:t,byUser:!0}),ae()}function oe(e){w.actions.internal.setAudioStream(e),ae()}function ue(e,t){w.actions.internal.setTrafficSavingEnabled(e,t),$.features.qualityDetailsSubMenuEnabled&&ae()}function de(e,t){w.actions.internal.setHighQualityEnabled(e,t),ae()}function ce(e){w.actions.internal.setPlaybackRate(e),ae()}function he(e){w.actions.internal.setSubtitle(e),ae()}function pe(){K()}function me(){(0,m.isValidURL)(t.supportLink)&&window.open(t.supportLink,"_blank"),w.actions.internal.reportProblem(),w.actions.internal.pause()}function ge(){Bn(w.actions.internal.getDebugTextData())}rt((()=>{!s()&&te.current&&(J(S[te.current]),te.popAllSubMenus())})),rt((()=>{s()||_e(ee,void 0)})),rt((()=>{!te.current&&ui(ee)&&(async(e,t)=>{setTimeout((()=>{let i=e[t];i&&i.focus()}),100)})(y,ui(ee))})),rt((()=>{v()&&D.set(v())}));let ve=()=>{let e=w.actions.internal.getTraceTextData(),t=new Blob([...e],{type:"application/json"}),i=window.URL.createObjectURL(t);Ns(i,"vk_player_trace_info","json")};function be(){U.set(!ls(U,"$debugPanelVisible",i))}function ye(){_e(Z,!0)}function Se(){_e(Z,!1)}function we(){return n()?`max-height: ${Math.round(.6*o().height)}px`:`max-height: ${o().height-32-b()}px; overflow: auto;`}let $e=fe((()=>R&&ls(V,"$hasMpegSources$",i)&&!l())),xe=fe((()=>$.features.trafficSaving&&!l()&&ls(C,"$autoQualityLimitingAvailable$",i)&&!$.features.qualityDetailsSubMenuEnabled)),Te=fe((()=>u().length>0&&!l())),Ce=fe((()=>!!ls(j,"$isLiveWithPlaybackSpeed",i)&&!l())),Ee=fe((()=>$.features.audioLanguages&&d().length>=2&&!l())),Ae=fe((()=>!l()));Ki((()=>W.subscribe((e=>{e&&!n()&&!ui(Z)&&!a()&&ae()}))));let Le=fe((()=>(({items:e,context:t,additionalSettingsMenuItems:i})=>{let{isMobile:r}=t;return[...e.map((e=>wm[e](t))),...i.map((e=>({...e,isAdditional:!0})))].filter((e=>!e?.isHiddenFor?.length||!e?.isHiddenFor?.includes("desktop")&&!r||!e?.isHiddenFor?.includes("mobile")&&r)).sort(ho)})({items:[ui(Ae)&&"quality-settings",ui(Ee)&&"audio-tracks-settings",ui(Ce)&&"playback-rate-settings",ui(Te)&&"subtitles-settings",ui(xe)&&"traffic-saving-switch",ui($e)&&"download",$.showSupport&&"show-support","copy-data",$.features.saveTraceInfoToFile&&"save-trace-info","debug-info"].filter((e=>!!e)),context:{qualityDetailsSubMenuEnabled:$.features.qualityDetailsSubMenuEnabled,availablePlaybackRates:c(),currentAudioStream:h(),availableAudioStreams:d(),currentPlaybackRate:ls(L,"$currentPlaybackRate$",i),selectPlaybackRate:ce,trafficSavingEnabled:p(),toggleTrafficSaving:ue,currentQuality:f()||m.VideoQuality.INVARIANT,isAutoQualityEnabled:g()||!1,currentSubtitle:ls(M,"$currentSubtitle$",i),isMobile:n(),onDownloadClick:pe,onCopyDataClick:ge,onReportProblemClick:me,onSaveTraceDataClick:ve,toggleShowDebugInfo:be},additionalSettingsMenuItems:ls(Q,"$additionalSettingsMenuItems$",i)}))),Pe=fe((()=>(({subMenuId:e,context:t})=>e?[rm[e](t)]:[])({subMenuId:te.current,context:{availablePlaybackRates:c(),selectPlaybackRate:ce,trafficSavingEnabled:p(),toggleTrafficSaving:ue,currentQuality:f()||m.VideoQuality.INVARIANT,isAutoQualityEnabled:g()||!1,isAutoQualityAvailable:ls(A,"$isAutoQualityAvailable$",i)||!1,availableQualities:ls(_,"$availableQualities$",i),highQualityEnabled:ls(q,"$highQualityEnabled",i),toggleHighQuality:de,availableAudioStreams:d(),availableSubtitlesList:u(),closeSettingsMenu:Y,currentAudioStream:h(),isMobile:n(),selectAudioLanguage:oe,selectQuality:ne,selectSubtitle:he}})));var Me=Tm();let Ie;var Re=Ye(Me),Ve=e=>{var t=km();let i;t.__keydown=[$m,Y];var r=Ye(t),s=e=>{var t=xm();let i;var r=Ye(t),s=Ye(r,!0);ze(r),Je(r,2).__click=ae,ze(t),nt(((e,r)=>{i=wr(t,1,"item header s-q",null,i,e),ji(s,r)}),[()=>({mobile:n()}),()=>G("submenu_settings")]),Ai(e,t)};Ji(r,(e=>{n()&&e(s)}));var a=Je(r,2);let o;sr(a,21,(()=>ui(Le)),(e=>e.id),((e,t)=>{var i=Ei(),r=Xe(i),s=e=>{!function(e,t){re(t,!0),fr(e,kf);let i=ms(t,"isMobile",3,!1),r=ms(t,"onClick",3,m.noop),s=ms(t,"valueComponent",3,void 0),a=ms(t,"iconProps",19,(()=>({}))),n=ms(t,"ref",15);var o=xf();let l;o.__click=[wf,r],o.__keydown=[Sf,r];var u=Ye(o),d=Ye(u),c=e=>{Lc(e,{get icon(){return t.icon}})},h=e=>{var i=Ei();let r=fe((()=>t.icon));cr(Xe(i),(()=>ui(r)),((e,t)=>{t(e,ps(a))})),Ai(e,i)};Ji(d,(e=>{"string"==typeof t.icon?e(c):e(h,!1)})),ze(u);var p=Je(u,2),f=Ye(p,!0);ze(p);var g=Je(p,2),v=e=>{var t=Ei();let i=fe(s);cr(Xe(t),(()=>ui(i)),((e,t)=>{t(e,{})})),Ai(e,t)},b=e=>{var i=$f(),r=Ye(i,!0);ze(i),nt((()=>ji(r,t.value))),Ai(e,i)};Ji(g,(e=>{s()?e(v):e(b,!1)})),ze(o),Xr(o,(e=>n(e)),(()=>n())),nt((e=>{l=wr(o,1,"item",null,l,e),Pr(o,"aria-label",t.ariaLabel),Pr(o,"data-testid",t.id),ji(f,t.label)}),[()=>({mobile:i()})]),Ai(e,o),se()}(e,{get isMobile(){return n()},get id(){return ui(t).id},get icon(){return ui(t).icon},get iconProps(){return ui(t).iconProps},get label(){return ui(t).label},get ariaLabel(){return ui(t).ariaLabel},get value(){return ui(t).value},get valueComponent(){return ui(t).valueComponent},onClick:()=>{ie(ui(t).children),_e(ee,ui(t).id,!0)},get ref(){return y[ui(t).id]},set ref(e){y[ui(t).id]=e}})},a=(e,i)=>{var r=e=>{let i=fe((()=>`${ui(t).id}-menu-item`));!function(e,t){re(t,!0),fr(e,Af);let i=ms(t,"isMobile",3,!1),r=ms(t,"onClick",3,m.noop),s=ms(t,"closeSettings",3,m.noop),a=ke(!1),n=()=>{_e(a,!0)},o=e=>{e?.stopPropagation(),r()(),s()()};var l=Ef();let u;l.__click=o,l.__keydown=[Tf,o];var d=Ye(l),c=Ye(d),h=e=>{var i=Ei(),r=Xe(i),s=e=>{Ai(e,_f())},o=e=>{var i=Cf();nt((()=>Pr(i,"src",t.icon))),Si("error",i,n),bi(i),Ai(e,i)};Ji(r,(e=>{ui(a)?e(s):e(o,!1)})),Ai(e,i)},p=e=>{var i=Ei();let r=fe((()=>t.icon));cr(Xe(i),(()=>ui(r)),((e,t)=>{t(e,{})})),Ai(e,i)};Ji(c,(e=>{"string"==typeof t.icon?e(h):e(p,!1)})),ze(d);var f=Je(d,2),g=Ye(f,!0);ze(f),ze(l),nt((e=>{u=wr(l,1,"item",null,u,e),Pr(l,"aria-label",t.ariaLabel??t.label),Pr(l,"data-testid",t.id),ji(g,t.label)}),[()=>({mobile:i()})]),Ai(e,l),se()}(e,{get isMobile(){return n()},get id(){return ui(i)},get onClick(){return ui(t).onClick},get icon(){return ui(t).icon},get label(){return ui(t).label},get ariaLabel(){return ui(t).ariaLabel},closeSettings:ae})},s=(e,i)=>{var r=e=>{let i=fe((()=>`${ui(t).id}-menu-item`));Nf(e,{get isMobile(){return n()},get id(){return ui(i)},get onClick(){return ui(t).onClick},get icon(){return ui(t).icon},get label(){return ui(t).label},get ariaLabel(){return ui(t).ariaLabel},get enabled(){return ui(t).enabled},get tooltipText(){return ui(t).tooltipText},get maxTooltipWidth(){return ui(t).maxTooltipWidth}})};Ji(e,(e=>{"SWITCH"===ui(t).type&&e(r)}),i)};Ji(e,(e=>{"CLICK"===ui(t).type?e(r):e(s,!1)}),i)};Ji(r,(e=>{"OPEN_SUB_MENU"===ui(t).type?e(s):e(a,!1)})),Ai(e,i)})),ze(a),Xr(a,(e=>v(e)),(()=>v())),ze(t),nt(((e,r,s)=>{i=wr(t,1,"settings-menu menu s-q",null,i,e),o=wr(a,1,"items",null,o,r),xr(a,s)}),[()=>({desktop:!n(),mobile:n(),hidden:!!te.current}),()=>({mobile:n()}),we]),Si("mouseenter",t,ye),Si("mouseleave",t,Se),Ai(e,t)};Ji(Re,(e=>{s()&&e(Ve)})),sr(Je(Re,2),17,(()=>ui(Pe)),(e=>e.id),((e,t)=>{let i=fe((()=>ui(t).minWidth??137));yf(e,{get isMobile(){return n()},get playerControlsHeight(){return b()},get returnFromSubMenu(){return te.popSubMenu},get id(){return ui(t).id},get title(){return ui(t).title},get closeSettingsMenu(){return Y},openSubMenuList:ie,get items(){return ui(t).items},get minWidth(){return ui(i)},get refMenuItems(){return y},get listRef(){return S[ui(t).id]},set listRef(e){S[ui(t).id]=e}})})),ze(Me),nt((e=>Ie=wr(Me,1,"settings-menu-container s-q",null,Ie,e)),[()=>({mobile:n(),hidden:!s()})]),Ai(e,Me),se(),r()}wi(["keydown","click"]);var Em=Ti('<button class="btn s-14"> </button>'),Am={hash:"s-14",code:"button.btn.s-14{background:hsla(0,0%,100%,.1);border-radius:8px;font-size:14px;line-height:18px;margin-top:12px;padding:6px 12px 7px}"};wi(["click"]);var Lm=Ti('<div class="container s-t"><div class="notification s-t"><div><p class="description s-t"><!></p> <!></div> <!></div></div>'),Pm={hash:"s-t",code:".container.s-t{display:flex;justify-content:center;left:0;pointer-events:none;position:absolute;right:0;top:20px}.notification.s-t{background:var(--notification-bg);border-radius:var(--notification-radius);display:inline-flex;gap:10px;padding:9px 14px 10px 12px;pointer-events:auto}.description.s-t{font-size:13px;line-height:16px;margin:0;white-space:pre}"};function Mm(e,t){re(t,!0),fr(e,Pm);let{features:{forceAutoQualityWhenSevereStallHappens:i}}=ys(),{ui:{t:r}}=Os(),s=r(i?"slow_video_notification_force_description":"slow_video_notification_suggest_description");var a=Lm(),n=Ye(a),o=Ye(n),l=Ye(o);Qf(Ye(l),{get message(){return s}}),ze(l);var u=Je(l,2),d=e=>{let i=fe((()=>r("slow_video_notification_button")));!function(e,t){fr(e,Am);var i=Em();i.__click=function(...e){t.onClick?.apply(this,e)};var r=Ye(i,!0);ze(i),nt((()=>ji(r,t.label))),Ai(e,i)}(e,{get label(){return ui(i)},get onClick(){return t.onSelectAutoQuality}})};Ji(u,(e=>{i||e(d)})),ze(o),Wo(Je(o,2),{get onClick(){return t.onClose}}),ze(n),ze(a),Ur(3,n,(()=>jc),(()=>({duration:340}))),Ai(e,a),se()}var Im="annotation",Rm=class{init(e,t){this.shadowRootContainer=e,this.store=t}add(e,t){let{overlay:i,id:r,controlsBehaviour:s,hideAllControls:a}=t;e.setAttribute("slot",Im),this.setupSlotStyles(e,i),this.shadowRootContainer.append(e),this.slots.set(r,{rootElement:e,options:t}),s&&this.runHidingControlsWhenIntersected(r,s),a&&this.store?.ui.isControlsAvailable.set(!1)}setupSlotStyles(e,t){switch(e.style.position="absolute",t){case"over_video":e.style.zIndex="calc(var(--video-container-z-index) + 1)";break;case"over_controls":e.style.zIndex="calc(var(--controls-container-z-index) + 1)";break;default:e.style.zIndex="0"}}async runHidingControlsWhenIntersected(e,{observedSlotElementId:t,controlsToObserve:i}){let r=this.slots.get(e);if(!r)return;let s=await this.findSlotElement(r.rootElement,t,e),{controls:a,hiddenControls:n}=this.store?.ui||{},o=new MutationObserver((e=>e.forEach((()=>{let e=Ld(s,this.shadowRootContainer);i.forEach((t=>{let i=a?.[t],r=i?as(i):null,s=n?.[t];r&&s?.set((0,m.isIntersecting)(r,e))}))}))));o.observe(s,{childList:!0,subtree:!0}),r.observer=o;let l=new m.Subscription;i.forEach((e=>{a&&l.add(a[e].subscribe((t=>{let i=n?.[e];t&&t.isDisplayed?i?.set((0,m.isIntersecting)(t,Ld(s,this.shadowRootContainer))):i?.set(!1)})))})),r.subs=l}async findSlotElement(e,t,i){return new Promise((r=>{let s=null,a=new MutationObserver((()=>{if(s=e.querySelector(`#${t}`),s){a.disconnect();let e=this.slots.get(i);e&&(e.observerForFindingSlotElement=void 0),r(s)}}));a.observe(e,{childList:!0,subtree:!0});let n=this.slots.get(i);n&&(n.observerForFindingSlotElement=a)}))}remove(e){let t=this.slots.get(e);if(!t)return;let{rootElement:i,observer:r,observerForFindingSlotElement:s,subs:a,options:{controlsBehaviour:n,hideAllControls:o}}=t;i&&i.remove(),[r,s].forEach((e=>e?.disconnect())),a?.unsubscribe(),this.slots.delete(e),o&&this.store?.ui.isControlsAvailable.set(!0),n?.controlsToObserve?.forEach((e=>{this.store?.ui.hiddenControls[e]?.set(!1)}))}destroy(){for(let e in this.slots.keys())this.remove(e);this.slots.clear()}haveSlots(){return this.slots.size>0}constructor(){this.slots=new Map}},Vm=Ti('<div class="container s-4"><!></div>'),Nm={hash:"s-4",code:".container.s-4{align-items:center;animation-fill-mode:forwards;animation-name:s-4-videoPlayerStatusIconPopup;background-color:#00000073;border-radius:100%;display:flex;height:64px;justify-content:center;width:64px;will-change:opacity,scale}@keyframes s-4-videoPlayerStatusIconPopup{0%{opacity:0;scale:.6}10%{animation-timing-function:ease-in;opacity:1;scale:1}75%{opacity:1;scale:1}90%{animation-timing-function:ease-out;opacity:0;scale:.4}to{opacity:0;scale:0}}"};function Bm(e,t){re(t,!0),fr(e,Nm);let i=ms(t,"reversed",3,!1);var r=Ei();Zi(Xe(r),(()=>t.Icon),(e=>{var r=Vm();cr(Ye(r),(()=>t.Icon),((e,t)=>{t(e,{get size(){return"48"},get reversed(){return i()}})})),ze(r),nt((()=>xr(r,`animation-duration: ${t.duration}ms`))),Ai(e,r)})),Ai(e,r),se()}var Dm=Ti('<div class="container s-1i"><!></div>'),Om={hash:"s-1i",code:".container.s-1i{align-items:center;display:flex;height:100%;justify-content:center;pointer-events:none;position:absolute;width:100%}"};function Fm(e,t){re(t,!0),fr(e,Om);let[i,r]=us(),s=()=>ls(a,"$playbackState$",i),{state:{playbackState$:a,isPlaying$:n},ui:{previewTrackActive:o,previewTrackDragInProgress:l}}=Os(),{features:{playbackStatusShow:u},playbackStatusAnimationDuration:d}=ys(),c=0,h=ke(null),p=ke(!1);rt((()=>{s()===f.PlaybackState.PLAYING?_e(h,Ko,!0):s()===f.PlaybackState.PAUSED?_e(h,pc,!0):_e(h,null)})),rt((()=>{if(u&&!ls(o,"$previewTrackActive",i)&&!ls(l,"$previewTrackDragInProgress",i))return c=window.setTimeout((()=>{c=0,_e(h,null)}),d),()=>{c&&(window.clearTimeout(c),c=0)}})),rt((()=>{ls(n,"$isPlaying$",i)&&!ui(p)&&(_e(p,!0),_e(h,null))}));var m=Ei(),g=Xe(m),v=e=>{var t=Dm();Bm(Ye(t),{get duration(){return d},get Icon(){return ui(h)}}),ze(t),Ai(e,t)};Ji(g,(e=>{ui(h)&&u&&e(v)})),Ai(e,m),se(),r()}var jm=Ti('<div><div data-testid="video-container"></div></div>'),zm={hash:"s-d",code:".video-container.s-d,.video-wrapper.s-d{height:100%;left:0;position:absolute;top:0;width:100%}.video-wrapper.s-d{background:var(--black)}.video-container.s-d,.video-wrapper.s-d{z-index:var(--video-container-z-index)}.video-container.s-d{transition:var(--rotate-transition-duration) ease all}.video-container.fast-rotate.s-d{transition:none}.nocursor.s-d{cursor:none}"};function qm(e,t){re(t,!0),fr(e,zm);let[i,r]=us(),s=()=>ls(l,"$rotateAlpha",i),a=()=>ls(u,"$playerSize",i),n=ms(t,"videoContainer",15),{playerPhase:o,ui:{rotateAlpha:l,playerSize:u},state:{isPlaying$:d,chromecastConnected$:c}}=Os(),{isSmoothVideoRotate:h}=ys(),p=fe((()=>n()&&s()%180?a().height/a().width:1));var f=jm();let m;f.__contextmenu=function(...e){t.onContextMenu?.apply(this,e)},f.__mousedown=function(...e){t.onMouseDown?.apply(this,e)},f.__mouseup=function(...e){t.onMouseUp?.apply(this,e)},f.__click=function(...e){t.onClick?.apply(this,e)},f.__dblclick=function(...e){t.onDblClick?.apply(this,e)};var g=Ye(f);let v;Xr(g,(e=>n(e)),(()=>n())),ze(f),nt(((e,t)=>{m=wr(f,1,"video-wrapper s-d",null,m,e),v=wr(g,1,"video-container s-d",null,v,t),xr(g,`transform: rotate(${s()}deg) scale(${ui(p)})`),Pr(g,"data-is-playing",ls(d,"$isPlaying$",i))}),[()=>({hidden:"video"!==ls(o,"$playerPhase",i)||ls(c,"$chromecastConnected$",i),nocursor:t.hideCursor}),()=>({"fast-rotate":!h})]),Ai(e,f),se(),r()}wi(["contextmenu","mousedown","mouseup","click","dblclick"]);var Hm=Ti('<div><span class="text s-1k"> </span> <!></div>'),Um={hash:"s-1k",code:".root.s-1k{background-color:var(--double-forward-bg);border-radius:100px;color:var(--white);display:flex;gap:4px;left:50%;opacity:0;padding:6px 12px;pointer-events:none;position:absolute;top:24px;transition:opacity var(--controls-transition-duration) var(--controls-transition-fn);visibility:hidden}.root.s-1k,.root.visible.s-1k{transform:translateX(-50%)}.root.visible.s-1k{opacity:1;visibility:visible}.text.s-1k{font-size:13px;font-weight:600;line-height:16px}"};var Wm=Ti('<div class="container s-1l" role="button" data-testid="preview-track-overlay"><div class="icon s-1l"><!></div></div>'),Qm={hash:"s-1l",code:".container.s-1l{background-color:rgba(0,0,0,.48);cursor:pointer;height:100%;position:absolute;width:100%}.container.s-1l,.icon.s-1l{align-items:center;display:flex;justify-content:center}.icon.s-1l{background-color:#00000073;border-radius:100%;height:64px;transition:transform .2s;transition-timing-function:ease-out;width:64px;will-change:transform}.container.s-1l:hover .icon:where(.s-1l){transform:scale(1.15)}"};function Gm(e,t){re(t,!1),fr(e,Qm);let i=Os().actions.internal.closePreviewTrack,r=e=>{e.stopPropagation(),i()};Jr();var s=Wm();s.__click=r;var a=Ye(s);return Ko(Ye(a),{get size(){return"32"}}),ze(a),ze(s),Ur(3,s,(()=>jc),(()=>({duration:200}))),Ai(e,s),function(e,t,i){var r=E(e,t);r&&r.set&&(e[t]=i,it((()=>{e[t]=null})))}(t,"handleClick",r),se({handleClick:r})}wi(["click"]);var Km=Ti('<div class="container s-1j"><div class="notification s-1j"><span class="text s-1j"> </span></div></div>'),Ym={hash:"s-1j",code:".container.s-1j{display:flex;justify-content:center;left:0;pointer-events:none;position:absolute;right:0;top:20px}.notification.s-1j{background-color:var(--black-alpha-40);border-radius:var(--notification-radius);padding:10px 16px}.text.s-1j{font-size:14px;font-weight:500;line-height:18px}"};var Xm=(e,t,i,r,s,a)=>{e.stopPropagation(),(t()||r())&&a()},Jm=Ti("<div><!></div>"),Zm=Ti('<div class="spherical-video-icon s-9"><!></div>'),eg=Ti("<div><!></div>"),tg=Ti('<div class="settings-menu s-9"><!></div>'),ig=Ti("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1),rg=Ti("<!> <!> <!>",1),sg=Ti('<div class="blocked s-9"></div>'),ag=Ti('<div class="player-wrapper s-9"><!> <div class="overlay-container"></div></div> <!>',1),ng={hash:"s-9",code:".blocked.s-9,.player-wrapper.s-9{height:100%;position:absolute;width:100%}.blocked.s-9{z-index:var(--overlay-container-z-index)}.player-wrapper.s-9 .player-media{background:var(--black);height:100%;left:0;position:absolute;top:0;transition:transform .2s ease-in-out;width:100%}.spherical-video-icon.s-9{display:inline-block;left:calc(50% - 38px);position:absolute;top:calc(50% - 23px)}.ads-container.s-9{background:var(--black);height:100%;left:0;position:absolute;top:0;width:100%;z-index:var(--ads-container-z-index)}.settings-menu.s-9{bottom:57px;left:0;position:absolute;right:18px;transition:opacity .2s;z-index:var(--settings-menu-z-index)}"};function og(e,t){re(t,!0),fr(e,ng);let i,r,s,[a,n]=us(),o=()=>ls(le,"$playerPhase",a),l=()=>ls(Ae,"$crashed",a),u=()=>ls(Oe,"$isInteractiveTime$",a),d=()=>ls(he,"$settingsMenuVisible",a),c=()=>ls(ce,"$controlsVisible",a),h=()=>ls(ft,"$graphIsOpened$",a),p=()=>ls(ue,"$isFullscreen",a),m=()=>ls(tt,"$autoplayNextEnabled$",a),g=()=>ls(we,"$isEnded$",a),v=()=>ls(st,"$isControlsAvailable",a),b=()=>ls(ot,"$doubleForwardOn$",a),y=()=>ls(_t,"$bottomNoSmooth",a),S=()=>ls(Qe,"$interactiveTimeIndicator",a),w=()=>ls(Ve,"$playerSize",a),$=()=>ls(Ne,"$is3DVideo",a),x=()=>ls(be,"$contextMenuVisible$",a),k=()=>ls(te,"$playbackState$",a),T=()=>ls(ge,"$scrubbingInProgress",a),_=()=>ls($e,"$chromecastConnected$",a),C=()=>ls(Ct,"$controlsTimeoutActive",a),E=()=>ls(pe,"$settingsMenuOpenedByKeyboard",a),A=()=>ls(yi,"$contextMenuOpenedByKeyboard$",a),L=()=>ls(xi,"$contextMenuOpenedByHotKey$",a),P=()=>ls(ee,"$language$",a),M=()=>ls(ne,"$position$",a),I=()=>ls(oe,"$duration$",a),R=ms(t,"videoContainer",15),V=ms(t,"adsSlotId",3,void 0),N=ms(t,"adsParams",3,void 0),B=ms(t,"adsAutoplayParam",3,void 0),D=ms(t,"duration",3,void 0),O=ms(t,"logoTargetUrl",3,""),F=ms(t,"showNextPrevButtons",3,!1),j=ms(t,"nextButtonActive",3,!1),z=ms(t,"prevButtonActive",3,!1),q=ms(t,"endScreenVideoTitle",3,void 0),H=ms(t,"endScreenVideoThumb",3,void 0),U=ms(t,"isOneVideoPlaylist",3,!1),W=ms(t,"shadowRootContainer",3,void 0),Q=ms(t,"outerContainerRef",3,void 0),G=ms(t,"playerStarted",3,!1),K=ms(t,"fullScreenTarget",3,void 0),Y=ms(t,"showMiniTimer",3,!1),X=ms(t,"showEndScreen",3,!0),J=ms(t,"keyboardControls",15),Z=t.store.getLogger().createComponentLog("Root component"),ee=t.store.interfaceLanguage$,te=t.store.state.playbackState$,ae=t.store.ads.playbackState,ne=t.store.state.positionWithScrubbing$,oe=t.store.state.duration$,le=t.store.playerPhase,ue=t.store.ui.isFullscreen,de=t.store.ui.isFullscreenOpenedByKeyboard,ce=t.store.ui.controlsVisible,he=t.store.ui.settingsMenu.visible$,pe=t.store.ui.settingsMenu.openedByBtnKeyboard$,ge=t.store.ui.scrubbingInProgress,ve=t.store.ui.volumeChangingInProgress,be=t.store.ui.contextMenu.visible$,ye=t.store.ui.debugPanelVisible,Se=t.store.state.isLoaderVisible,we=t.store.state.isEnded$,$e=t.store.state.chromecastConnected$,xe=t.store.state.chromecastDeviceName$,Te=t.store.ads.postrollPassed,Ce=t.store.state.isLive$,Ee=t.store.state.isPlaying$,Ae=t.store.state.crashed$,Le=t.store.webApi.annotationsApi,Pe=t.store.webApi.pictureInPictureApi,Me=t.store.state.currentSubtitle$,Ie=t.store.state.currentSubtitleCaptions$,Ve=t.store.ui.playerSize,Ne=t.store.ui.is3DVideo,Be=t.store.ui.icon3DVideoVisible,De=t.store.state.isInteractive,Oe=t.store.state.isInteractiveTime$,Fe=t.store.state.isInteractiveExpectation$,je=t.store.state.hasInteractiveBranches,qe=t.store.ui.touched,He=t.store.ui.modals.hotKeyMap.data,Ue=t.store.ui.modals.hotKeyMap.show,We=t.store.ui.overlayContainer$,Qe=t.store.ui.controls.interactiveTimeIndicator,Ge=t.store.state.showInteractiveTimeIndicator,Ke=t.store.ui.contextMenu.position$,Ze=t.store.actions.internal.setQuality,et=t.store.actions.internal.closeSettingsMenu,tt=t.store.ui.autoplayNextEnabled$,it=t.store.ui.userActionsDisabled,st=t.store.ui.isControlsAvailable,at=t.store.ui.videoTitleInfo,ot=t.store.ui.doubleForwardOn$,lt=t.store.ui.doubleForwardAvailable$,ut=t.store.ui.previewTrackNotificationVisible,dt=t.store.actions.internal.getVideoElement,ct=t.store.actions.internal.checkFullscreenSupport,{fakeIsPlaying$:ht,notifications$:pt,graphIsOpened$:ft}=Fs(),mt=ke(void 0),gt=ke(void 0),vt=ke(void 0),bt=ke(void 0);He.set({title:Da("hotkey_map_modal_title"),closeBtnText:Da("hotkey_map_modal_close_btn_text"),groups:[{title:Da("hotkey_map_group_title_common"),items:[{description:Da("hotkey_map_item_mute_description"),value:Da("hotkey_map_item_mute_value")},{description:Da("hotkey_map_item_volume_up_description"),value:Da("hotkey_map_item_volume_up_value")},{description:Da("hotkey_map_item_volume_down_description"),value:Da("hotkey_map_item_volume_down_value")},{description:Da("hotkey_map_item_pip_description"),value:Da("hotkey_map_item_pip_value")},{description:Da("hotkey_map_item_full_screen_description"),value:Da("hotkey_map_item_full_screen_value")},{description:Da("hotkey_map_item_show_context_menu_description"),value:Da("hotkey_map_item_show_context_menu_value")},{description:Da("hotkey_map_item_show_hotkey_map_description"),value:Da("hotkey_map_item_show_hotkey_map_value")}]},{title:Da("hotkey_map_group_title_playback"),items:[{description:Da("hotkey_map_item_play_toggle_description"),value:Da("hotkey_map_item_play_toggle_value")},{description:Da("hotkey_map_item_seek_backward_description"),value:Da("hotkey_map_item_seek_backward_value")},{description:Da("hotkey_map_item_seek_forward_description"),value:Da("hotkey_map_item_seek_forward_value")},{description:Da("hotkey_map_item_fast_seek_backward_description"),value:Da("hotkey_map_item_fast_seek_backward_value")},{description:Da("hotkey_map_item_fast_seek_forward_description"),value:Da("hotkey_map_item_fast_seek_forward_value")},{description:Da("hotkey_map_item_rate_down_description"),value:Da("hotkey_map_item_rate_down_value")},{description:Da("hotkey_map_item_rate_up_description"),value:Da("hotkey_map_item_rate_up_value")},{description:Da("hotkey_map_item_prev_frame_description"),value:Da("hotkey_map_item_prev_frame_value")},{description:Da("hotkey_map_item_next_frame_description"),value:Da("hotkey_map_item_next_frame_value")},{description:Da("hotkey_map_item_jump_seek_description"),value:Da("hotkey_map_item_jump_seek_value")},{description:Da("hotkey_map_item_next_video_description"),value:Da("hotkey_map_item_next_video_value")},{description:Da("hotkey_map_item_prev_video_description"),value:Da("hotkey_map_item_prev_video_value")}]},{title:Da("hotkey_map_group_title_subtitles"),items:[{description:Da("hotkey_map_item_subtitles_toggle_description"),value:Da("hotkey_map_item_subtitles_toggle_value")}]},{title:Da("hotkey_map_group_title_episodes"),items:[{description:Da("hotkey_map_item_prev_episode_description"),value:f.clientChecker.device.isApple?Da("hotkey_map_item_prev_episode_mac_value"):Da("hotkey_map_item_prev_episode_pc_value")},{description:Da("hotkey_map_item_next_episode_description"),value:f.clientChecker.device.isApple?Da("hotkey_map_item_next_episode_mac_value"):Da("hotkey_map_item_next_episode_pc_value")}]}]});let yt,{closeNotification:St,notificationsToShow$:wt}=pt,$t=fe((()=>!!ls(wt,"$notificationsToShow$",a).slow_video)),xt=()=>St("slow_video"),kt=fe((()=>("video"===o()&&ls(Se,"$isLoaderVisible",a)||"ads"===o()&&"inactive"===ls(ae,"$adPlaybackState",a))&&!l())),Tt=ke(void 0),_t=rs(!1),Ct=rs(!1),Et=rs(),At=rs(!1),Lt=ke(!1),Pt=ke(!1),Mt=ke(!1),It=ke(!(t.autoplay&&!t.uiConfig.controls.showOnStartupAtAutoplay)),Rt=fe((()=>u()&&!d()&&!(ui(Lt)||ui(Pt))&&!(ui(Mt)&&!ls(Fe,"$isInteractiveExpectation$",a)))),Vt=!0,Nt=fe((()=>t.uiConfig.features.thumbTimer&&Y()&&"video"===o()&&!c()&&!l()&&!De&&(t.uiConfig.hideThumbTimerAfterTouch&&!ls(qe,"$touched",a)||!t.uiConfig.hideThumbTimerAfterTouch))),Bt=t.uiConfig.titleShowBehaviour,Dt=fe((()=>!(!["video","thumb"].includes(o())||"never"===Bt||h())&&("fullscreen"!==Bt||p()))),Ot=fe((()=>"always"!==Bt&&"thumb"!==o()&&!c())),Ft=ke(!1),jt=fe((()=>(X()||t.showAutoplayNext&&m())&&!!q()&&!!H()&&(t.showAds&&ls(Te,"$postrollPassed",a)||!t.showAds)&&g()&&!l()&&!ui(Ft))),zt=fe((()=>ls(At,"$cursorInside",a)&&!(c()||ui(jt))&&!u()&&v()&&!b())),qt=ke(!1),Ht=fe((()=>null!==ls(ht,"$fakeIsPlaying$",a))),{toggle:Ut}=ht,Wt=!1,Qt=null;Pe?.setContext(ie());t.store.setUiCallbacks({onStarted:()=>{t.autoplay&&!De&&t.uiConfig.controls.showOnStartupAtAutoplay&&Kt(t.uiConfig.controls.hideTimeout)}});let Gt=()=>{window.clearTimeout(i),Ct.set(!1)},Kt=e=>{Gt(),Ct.set(!0),i=window.setTimeout((()=>Ct.set(!1)),e);let t=e-100;yt=window.setTimeout((()=>{y()&&_t.set(!1)}),t>0?t:e)},Yt=(e,t)=>{window.clearTimeout(r),Et.set(null),Et.set(t),r=window.setTimeout((()=>Et.set(null)),e)},Xt=Ne.subscribe((e=>{Be.set(e),e&&(window.clearTimeout(s),s=window.setTimeout((()=>Be.set(!1)),t.uiConfig.controls.hide360IconTimeout))})),Jt=async()=>{let e=sn();if(e){let t=rn();e=t===ti()||t===W()}if(e){Kt(t.uiConfig.controls.hideTimeoutFullscreen);try{await(Pe?.exit())}catch(e){Z({message:String(e)})}}ue.set(e),t.store.getAdmanWrapper().setFullscreen(e),p()?t.store.callbacks?.onFullscreenEnter?.():t.store.callbacks?.onFullscreenExit?.()},Zt=e=>{let{width:t,height:i}=e.target;Ve.set({width:t,height:i})},ei=()=>{let{width:e,height:t}=ui(mt).getBoundingClientRect();Ve.set({width:e,height:t})};Ki((()=>(an(Jt),t.uiConfig.features.annotationsInside&&Le?.init(ui(mt)),ln(Pe)&&(Pe?.assignPlayerContainer(ui(mt)),Pe?.setExternalEventHandlers({resize:Zt,leavepictureinpicture:ei})),t.interactiveContainer&&R().parentElement?.insertBefore(t.interactiveContainer,R().nextSibling),()=>{window.clearTimeout(i),window.clearTimeout(yt),window.clearTimeout(r),window.clearTimeout(s),Xt(),Pe?.dispose().catch((e=>{Z({message:String(e)})})),nn(Jt)})));let ti=()=>{let e=t.uiConfig.features.fullscreenInternalTargetPlayerContainer||!Q()?ui(mt):Q(),i=e.getRootNode(),r=i instanceof ShadowRoot?i.host:i,s=K()instanceof HTMLElement&&K().contains(r);return t.uiConfig.allowChangingFullscreenTarget&&K()&&s?K():e},ii=()=>{be.set(!1)},ri=()=>{et(),ii()},si=async()=>{ct()?(ii(),sn()?(await tn(document),Z({message:"exit fullscreen"})):(Z({message:"request fullscreen"}),await en(ti()))):Z({message:"fullscreen disabled"})},ai=e=>{h()||(e.preventDefault(),be.set(!0),Ke.set({left:e.clientX,top:e.clientY}))};function ni(e){return e?e.offsetTop+ni(e.offsetParent):0}function oi(e){return e?e.offsetLeft+oi(e.offsetParent):0}function ci(e){if(S()&&Ge){let t=e.currentTarget,i=ni(t),r=oi(t),s=e.pageX-r,a=e.pageY-i,{left:n,bottom:o,right:l}=S(),u=l-n;return s>=n-u&&a<=o+u}}let hi=null,pi=()=>{hi=window.setTimeout((()=>{t.store.actions.internal.changeDoubleForwardOn(!0),Gt()}),t.uiConfig.doubleForwardActivationTime)},fi=()=>{t.store.actions.internal.changeDoubleForwardOn(!1),hi&&clearTimeout(hi),hi=null},mi=e=>{e.preventDefault(),0===e.button&&(Wt=!0,t.store.actions.internal.holdCamera(),ls(lt,"$doubleForwardAvailable$",a)&&pi()),!Wt&&Kt(t.uiConfig.controls.hideTimeoutCursor)},gi=e=>{e.preventDefault(),0===e.button&&(Qt=e,Wt=!1,t.store.actions.internal.releaseCamera()),!b()&&Kt(t.uiConfig.controls.hideTimeoutCursor)},vi=e=>{e.preventDefault(),Z({message:"double click on video"}),si(),Kt(t.uiConfig.controls.hideTimeoutCursor)},bi=e=>{if(e.preventDefault(),b())fi();else if(hi&&fi(),x()||d())ri();else if(!g()||je){if(ui(Ht))return Ut();if(J()?.focus(),!G())return t.firstStart(),void Kt(t.uiConfig.controls.hideTimeoutCursor);(!t.uiConfig.preventPauseOnVideoClick||k()!==f.PlaybackState.PLAYING)&&t.store.actions.internal.togglePlay(),Kt(t.uiConfig.controls.hideTimeoutCursor)}},yi=t.store.ui.contextMenu.openedByBtnKeyboard$,wi=t.store.ui.contextMenu.btnRef$,$i=ke(void 0),xi=t.store.ui.contextMenu.openedByHotKey$,ki=t.store.ui.contextMenu.lastActiveElem$,Ti=ke(!1),_i=t.store.ui.previewTrackActive;rt((()=>{We.set(ui(Tt))})),rt((()=>{_e(Mt,ui(It)&&k()!==f.PlaybackState.PLAYING,!0),ui(It)||di((()=>_e(It,!0)))})),rt((()=>{let e=(ui(Mt)||g()||d()||T()||ls(ve,"$volumeChangingInProgress",a)||_()||C()||ui(Ti))&&!ui(Rt)&&("video"===o()||"ads"===o())&&!l()&&v();ce.set(e),!e&&!C()&&ui(vt)?.contains(ll())&&J()?.focus()})),rt((()=>{!T()&&ui(qt)&&!u()&&Kt(t.uiConfig.controls.hideTimeoutCursor),di((()=>_e(qt,T(),!0)))})),rt((()=>{ui(bt),d(),E(),di((()=>Qn(ui(bt),d(),E())))})),rt((()=>{ui($i),x(),A(),L(),di((()=>{let e=A()||L();Qn(ui($i),x(),e)}))})),rt((()=>{let e=ls(wi,"$contextMenuButtonRef$",a);e&&(x(),di((()=>Wn(e,x(),yi))))})),rt((()=>{let e=ls(ki,"$contextMenuLastActiveElem$",a);e&&(x(),di((()=>(async(e,t,i)=>{await li(),e&&!t&&as(i)&&(i.set(!1),e.focus())})(e,x(),xi))))})),rt((()=>{!ls(de,"$isFullscreenOpenedByKeyboard",a)&&p()&&(di((()=>de.set(!1))),J()?.focus())})),rt((()=>{h()&&ri()}));let Ci=ke(void 0),Ei=e=>{at.set(Vd(dt(),{title:ui(Ci)},"title",e))},Li=(e,i)=>{let r=t.store.callbacks?.uiInfo?.onUpcomingLiveViewStateChanged;if(!r)return;let s=!!i;r({...Vd(ui(mt),{upcomingLiveScreen:i},"upcomingLiveScreen",s),...e})};var Pi=ag();Si("blur",Re,ri);var Mi=Xe(Pi);Mi.__mousemove=function(e){(function(e){if(ui(mt)){let t=ni(e.currentTarget),i=w().height,r=e.pageY-t;if(ci(e))return void _e(Pt,!1);r<40?_e(Pt,!0):r>i-40?_e(Lt,!0):(_e(Pt,!1),d()||_e(Lt,!1))}})(e),!ui(Rt)&&!b()&&Kt(t.uiConfig.controls.hideTimeoutCursor),$()&&Wt&&Qt&&t.store.actions.internal.moveCameraFocusPX(Qt.clientX-e.clientX,Qt.clientY-e.clientY,e.timeStamp-Qt.timeStamp),Qt=e};var Ii=Ye(Mi);let Ri=fe((()=>"ads"===o())),Vi=fe((()=>ui(Ht)?Ut:void 0));Xr(hl(Ii,{startDoubleForwardActivationTimer:pi,stopDoubleForward:fi,toggleFullscreen:si,hideContextMenu:ri,showHotKeyHelpers:e=>{ri(),qe.set(!0),Kt(t.uiConfig.controls.hideTimeout),e&&Yt(t.uiConfig.controls.hideHotKeyHelpers,e)},showKeyMap:()=>{ri(),t.store.callbacks?.onOpenHotKeyMap?t.store.callbacks?.onOpenHotKeyMap(ls(He,"$hotKeyMapData",a)):Ue.update((e=>!e))},get isAds(){return ui(Ri)},get fakePlayButtonHandler(){return ui(Vi)},get nextButtonActive(){return j()},get prevButtonActive(){return z()},children:(e,i)=>{var r=rg(),s=Xe(r);qm(s,{get hideCursor(){return ui(zt)},onClick:bi,onContextMenu:ai,onMouseDown:mi,onMouseUp:gi,onDblClick:vi,get videoContainer(){return R()},set videoContainer(e){R(e)}});var n=Je(s,2);hr(n,(()=>"slot"),!1,((e,t)=>{Mr(e,(()=>({name:Im})))})),Zi(Je(n,2),P,(e=>{var i=ig(),r=Xe(i);let s=fe((()=>"thumb"!==o()||l()||De&&t.autoplay));Tp(r,{get hidden(){return ui(s)},get thumbUrl(){return t.thumbUrl},get startVideo(){return t.firstStart},onContextMenu:ai,onClick:ii});var n=Je(r,2),u=e=>{Gm(e,{})};Ji(n,(e=>{ls(_i,"$previewTrackActive$",a)&&e(u)}));var h=Je(n,2);Fm(h,{});var f=Je(h,2);!function(e,t){re(t,!0),fr(e,Um);let{ui:{t:i}}=Os();var r=Hm();let s;var a=Ye(r),n=Ye(a,!0);ze(a),Gh(Je(a,2),{get size(){return"16"},fill:"currentColor"}),ze(r),nt(((e,t)=>{s=wr(r,1,"root s-1k",null,s,e),ji(n,t)}),[()=>({visible:t.isVisible}),()=>i("double_forward_label")]),Ai(e,r),se()}(f,{get isVisible(){return b()}});var g=Je(f,2),v=e=>{let i=fe((()=>t.live?.startTime));zp(e,{get thumbUrl(){return t.thumbUrl},get startTime(){return ui(i)},onUpcomingLiveViewStateChanged:Li,onContextMenu:ai,onClick:ii})};Ji(g,(e=>{"LiveWaitingStart"===o()&&e(v)}));var S=Je(g,2),k=e=>{Up(e,{kind:"recover",get thumbUrl(){return t.thumbUrl},onContextMenu:ai,onClick:ii})};Ji(S,(e=>{"LiveWaitingRecover"===o()&&e(k)}));var T=Je(S,2),C=e=>{Up(e,{kind:"record",get thumbUrl(){return t.thumbUrl},onContextMenu:ai,onClick:ii})};Ji(T,(e=>{"LiveWaitingRecord"===o()&&e(C)}));var E=Je(T,2),A=e=>{var i=Jm();let r;$n(Ye(i),{get adsSlotId(){return V()},get adsParams(){return N()},get adsAutoplayParam(){return B()},get duration(){return D()},get adsExternalApi(){return t.adsExternalApi}}),ze(i),nt((e=>r=wr(i,1,"ads-container s-9",null,r,e)),[()=>({hidden:"ads"!==o()})]),Ai(e,i)};Ji(E,(e=>{t.showAds&&G()&&e(A)}));var L=Je(E,2),P=e=>{let i=fe((()=>!X()&&t.showAutoplayNext&&m()));il(e,{get title(){return q()},get thumb(){return H()},get isHide(){return ui(i)},clickCloseIcon:()=>_e(Ft,!0)})};Ji(L,(e=>{ui(jt)&&q()&&H()&&e(P)}));var R=Je(L,2),W=e=>{let i=fe((()=>p()?"md":"sm")),r=fe((()=>t.store.callbacks?.onTitleClicked));!function(e,t){re(t,!0),fr(e,Lp);let i=e=>{var i=_p(),s=Ye(i,!0);ze(i),Xr(i,(e=>n(e)),(()=>n())),nt((()=>ji(s,r()))),Si("mouseenter",i,(function(...e){t.onMouseEnter?.apply(this,e)})),Si("mouseleave",i,(function(...e){t.onMouseLeave?.apply(this,e)})),Ai(e,i)},r=ms(t,"title",3,""),s=ms(t,"isHidden",3,!1),a=ms(t,"size",3,"md"),n=ms(t,"ref",15),o=ke(void 0);Ki((()=>{function e(e){"transform"===e.propertyName&&t.onVisibilityChanged?.(!s())}return requestAnimationFrame((()=>{t.onVisibilityChanged?.(!0)})),ui(o)?.addEventListener("transitionend",e),()=>ui(o)?.removeEventListener("transitionend",e)}));let l=t.getVideoDeeplink?.();var u=Ap();let d;var c=Ye(u),h=e=>{var r=Ep();r.__click=[Cp,t];var s=Ye(r);i(s),ze(r),nt((()=>Pr(r,"href",l||""))),Ai(e,r)},p=e=>{i(e)};Ji(c,(e=>{l||t.onTitleClicked?e(h):e(p,!1)})),ze(u),Xr(u,(e=>_e(o,e)),(()=>ui(o))),nt((e=>d=wr(u,1,`title size-${a()}`,"s-1h",d,e)),[()=>({hidden:s()})]),Ai(e,u),se()}(e,{get title(){return t.title},get getVideoDeeplink(){return t.getVideoDeeplink},get isHidden(){return ui(Ot)},onVisibilityChanged:Ei,onMouseEnter:()=>{_e(Ti,!0)},onMouseLeave:()=>{_e(Ti,!1)},get size(){return ui(i)},get onTitleClicked(){return ui(r)},get ref(){return ui(Ci)},set ref(e){_e(Ci,e,!0)}})};Ji(R,(e=>{ui(Dt)&&e(W)}));var Q=Je(R,2),K=e=>{let t=fe((()=>"video"===o()&&c()));ap(e,{get isShifted(){return ui(t)}})};Ji(Q,(e=>{$()&&e(K)}));var Y=Je(Q,2),Z=e=>{var t=Zm();Fa(Ye(t),{}),ze(t),Ai(e,t)};Ji(Y,(e=>{ls(Be,"$icon3DVideoVisible",a)&&e(Z)}));var ee=Je(Y,2),te=e=>{vp(e,{get thumbUrl(){return t.thumbUrl},get chromecastDeviceName(){return ls(xe,"$chromecastDeviceName$",a)},onClick:bi,onContextMenu:ai,onDblClick:vi})};Ji(ee,(e=>{_()&&e(te)}));var ie=Je(ee,2),ae=e=>{pp(e,{get shifted(){return c()},get captions(){return ls(Ie,"$currentSubtitleCaptions$",a)},get position(){return M()},get playerSize(){return w()}})};Ji(ie,(e=>{"off"!==ls(Me,"$currentSubtitle$",a).value&&e(ae)}));var ne=Je(ie,2),oe=e=>{var t=eg();t.__contextmenu=ai,t.__click=[Xm,x,be,d,he,ri],wp(Ye(t)),ze(t),Ai(e,t)};Ji(ne,(e=>{l()&&e(oe)}));var le=Je(ne,2),ue=e=>{let i=fe((()=>"thumb"===o()||"LiveWaitingStart"===o()||"LiveWaitingRecover"===o()||"LiveWaitingRecord"===o())),r=fe((()=>"ads"===o())),s=fe((()=>t.canRewindLive&&0!==I()));Wh(e,{get bottomHidden(){return ui(i)},get bottomNoSmooth(){return y()},get showControls(){return c()},get isAds(){return ui(r)},get canRewindLive(){return ui(s)},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return O()},get showAutoplayNext(){return t.showAutoplayNext},get showNextPrevButtons(){return F()},get nextButtonActive(){return j()},get prevButtonActive(){return z()},get isOneVideoPlaylist(){return U()},customFullscreenSupported:Vt,toggleFullscreen:si,get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get playerControlsWrapperRef(){return ui(gt)},set playerControlsWrapperRef(e){_e(gt,e,!0)},get playerControlsRef(){return ui(vt)},set playerControlsRef(e){_e(vt,e,!0)}})};Ji(le,(e=>{G()&&e(ue)}));var de=Je(le,2),ce=e=>{var i=tg(),r=Ye(i);let s=fe((()=>ui(vt)?.clientHeight));Cm(r,{get supportLink(){return t.supportLink},get playerControlsHeight(){return ui(s)},returnFocus:()=>J()?.focus(),get ref(){return ui(bt)},set ref(e){_e(bt,e,!0)}}),ze(i),Ai(e,i)};Ji(de,(e=>{!_()&&"ads"!==o()&&e(ce)}));var pe=Je(de,2);let ge=fe((()=>!ui(Nt)));Nn(pe,{get isLive(){return ls(Ce,"$isLive$",a)},get isHidden(){return ui(ge)},get isPlaying(){return ls(Ee,"$isPlaying$",a)},get position(){return M()},get duration(){return I()}});var ve=Je(pe,2);ep(ve,{get data(){return Et}});var Se=Je(ve,2);bo(Se,{get supportLink(){return t.supportLink},returnFocus:()=>J()?.focus(),get visible(){return x()},get playerContainerRef(){return ui(mt)},get position(){return ls(Ke,"$contextMenuPosition$",a)},get menuElementRef(){return ui($i)},set menuElementRef(e){_e($i,e,!0)}});var we=Je(Se,2),$e=e=>{Mm(e,{onClose:xt,onSelectAutoQuality:()=>{Ze("auto"),xt()}})};Ji(we,(e=>{ui($t)&&e($e)}));var Te=Je(we,2),Ae=e=>{!function(e,t){re(t,!1),fr(e,Ym);let{ui:{t:i}}=Os();Jr();var r=Km(),s=Ye(r),a=Ye(s),n=Ye(a,!0);ze(a),ze(s),ze(r),nt((e=>ji(n,e)),[()=>i("preview_track_notification_text")],me),Ur(3,s,(()=>jc),(()=>({duration:340}))),Ai(e,r),se()}(e,{})};Ji(Te,(e=>{ls(ut,"$previewTrackNotificationVisible$",a)&&e(Ae)}));var Le=Je(Te,2),Pe=e=>{ml(e,{})};Ji(Le,(e=>{ui(kt)&&e(Pe)}));var Re=Je(Le,2),Ve=e=>{Pl(e,{})};Ji(Re,(e=>{ls(Ue,"$showHotKeyMap",a)&&e(Ve)}));var Ne=Je(Re,2),Oe=e=>{zo(e,{})};Ji(Ne,(e=>{ls(ye,"$debugPanelVisible",a)&&e(Oe)})),Ai(e,i)})),Ai(e,r)},$$slots:{default:!0}}),(e=>J(e)),(()=>J())),Xr(Je(Ii,2),(e=>_e(Tt,e)),(()=>ui(Tt))),ze(Mi),Xr(Mi,(e=>_e(mt,e)),(()=>ui(mt)));var Ni=Je(Mi,2),Bi=e=>{Ai(e,sg())};Ji(Ni,(e=>{ls(it,"$userActionsDisabled$",a)&&e(Bi)})),Si("mouseenter",Mi,(function(){At.set(!0),De||Kt(t.uiConfig.controls.hideTimeoutCursor)})),Si("mouseleave",Mi,(function(){At.set(!1),_e(Pt,!1),_e(Lt,!1),Wt=!1,t.store.actions.internal.releaseCamera(),Kt(t.uiConfig.controls.hideTimeout),b()&&fi()})),Si("click",Mi,(()=>{qe.set(!0)}),!0),Si("focusin",Mi,(function(e){let{relatedTarget:i}=e,r=!(!i||!ui(vt)?.contains(i))&&J()?.isFocused();!De&&!r&&(_t.set(!0),Kt(t.uiConfig.controls.hideTimeoutCursor))}),!0),Ai(e,Pi),se(),n()}wi(["mousemove","contextmenu","click"]);var lg=Ti('<div></div> <div class="info s-h"><div class="triangles-wrapper s-h"><div></div> <div></div> <div></div></div> <p class="step-caption s-h"> </p></div>',1),ug=Ti("<div><!></div>"),dg={hash:"s-h",code:".double-click-area.s-h{height:100%;overflow:hidden;position:absolute;top:0;width:25%}.double-click-area.left.s-h{left:0}.double-click-area.right.s-h{right:0}.semicircle.s-h{background-color:rgba(0,0,0,.5);height:100%;position:absolute;top:0;width:100%}.semicircle.left.s-h{border-bottom-right-radius:50%;border-top-right-radius:50%;left:0}.semicircle.right.s-h{border-bottom-left-radius:50%;border-top-left-radius:50%;right:0}.info.s-h{align-items:center;flex-direction:column;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.info.s-h,.triangles-wrapper.s-h{display:flex;justify-content:center}.triangles-wrapper.s-h{margin-bottom:10px;position:relative}.triangle.s-h{animation:s-h-blink .5s infinite;border-bottom:6px solid transparent;border-top:6px solid transparent;height:0;opacity:0;width:0}.triangle.left.s-h:nth-child(3),.triangle.right.s-h:first-child{animation-delay:0s}.triangle.left.s-h:nth-child(2),.triangle.right.s-h:nth-child(2){animation-delay:.1s}.triangle.left.s-h:first-child,.triangle.right.s-h:nth-child(3){animation-delay:.2s}@keyframes s-h-blink{0%{opacity:0}50%{opacity:1}to{opacity:0}}.triangle.left.s-h{border-right:8px solid var(--white)}.triangle.right.s-h{border-left:8px solid var(--white)}.triangle.s-h:not(:last-child){margin-right:5px}.step-caption.s-h{color:var(--white);font-size:12px;line-height:1;margin:0;text-align:center}"};function cg(e,t){re(t,!0),fr(e,dg);let i=ms(t,"seekStep",3,0),r=ke(!1),s=0,a=0,n=ke(le(i()));Yi((()=>{window.clearTimeout(s)}));var o=ug();o.__click=e=>{e.stopPropagation(),a+=1,_e(n,i()*(a-1)),1===a?t.handleSingleFirstClick(e):(_e(r,!0),t.handleSecondClick()),window.clearTimeout(s),s=window.setTimeout((()=>{a=0,_e(r,!1)}),300)};var l=Ye(o),u=e=>{var i=lg(),r=Xe(i),s=Je(r,2),a=Ye(s),o=Ye(a),l=Je(o,2),u=Je(l,2);ze(a);var d=Je(a,2),c=Ye(d,!0);ze(d),ze(s),nt((e=>{wr(r,1,`semicircle ${t.side??""}`,"s-h"),wr(o,1,`triangle ${t.side??""}`,"s-h"),wr(l,1,`triangle ${t.side??""}`,"s-h"),wr(u,1,`triangle ${t.side??""}`,"s-h"),ji(c,e)}),[()=>Da("doubletap_seek_step",{seconds:ui(n).toFixed(0)})]),Ai(e,i)};Ji(l,(e=>{ui(r)&&e(u)})),ze(o),nt((()=>wr(o,1,`double-click-area ${t.side??""}`,"s-h"))),Ai(e,o),se()}wi(["click"]);var hg=(e,t,i)=>{t(!1),i()},pg=Ti('<div class="overlay s-k"></div> <div class="next-video s-k"><div class="top s-k"><div class="caption s-k"> </div> <!></div> <div class="row s-k"><div class="column s-k"><div class="thumb s-k"><div></div> <!></div></div> <div class="column s-k"><div class="title s-k"> </div></div></div></div>',1),fg={hash:"s-k",code:".overlay.s-k{background:rgba(0,0,0,.72);height:100%;position:absolute;width:100%}.next-video.s-k{display:flex;flex-direction:column;left:50%;margin:0 auto;max-width:362px;min-width:320px;padding-bottom:12px;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:var(--end-screen-mobile-z-index)}.top.s-k{display:flex;justify-content:space-between}.caption.s-k{color:var(--white);font-size:11px;font-weight:700;opacity:.8;text-transform:uppercase}.row.s-k{background:rgba(48,48,48,.8);cursor:pointer;display:flex;flex-direction:row;height:102px;margin-top:6px;width:100%}.column.s-k{display:flex;flex-basis:50%;flex-direction:column}.thumb.s-k{align-items:center;background:no-repeat 50%;background-size:cover;display:flex;justify-content:space-around;position:relative}.thumb.s-k,.thumb-overlay.s-k{height:100%;width:100%}.thumb-overlay.s-k{position:absolute}.thumb-overlay.withOpacity.s-k{background:var(--black);opacity:.3}.title.s-k{color:var(--white);font-size:12px;font-weight:700;line-height:1.6;max-height:52px;overflow:hidden;padding:10px 16px}"};function mg(e,t){re(t,!0),fr(e,fg);let[i,r]=us(),s=()=>ls(n,"$autoplayNextEnabled$",i),a=Os(),n=a.ui.autoplayNextEnabled$,o=a.ui.timerNextVideoRunning$,l=a.actions.internal.nextVideoClick,u=a.actions.internal.nextVideoAnnouncementShow,d=a.actions.internal.nextVideoAnnouncementClick,c=a.actions.internal.nextVideoAnnouncementAuto,h=a.actions.internal.nextVideoAnnouncementCancel,p=()=>{l(!1),c()},f=()=>{t.clickCloseIcon(),h()};Ki((()=>{t.isHide||u(),t.isHide&&s()&&(l(!1),c())}));var m=Ei(),g=Xe(m),v=e=>{var r=pg(),a=Je(Xe(r),2),n=Ye(a),u=Ye(n),c=Ye(u,!0);ze(u),Wo(Je(u,2),{onClick:f}),ze(n);var h=Je(n,2);h.__click=[hg,l,d];var m=Ye(h),g=Ye(m),v=Ye(g);let b;var y=Je(v,2),S=e=>{Jo(e,{get isRunning(){return ls(o,"$timerNextVideoRunning$",i)},onTimerEnded:p})};Ji(y,(e=>{s()&&e(S)})),ze(g),ze(m);var w=Je(m,2),$=Ye(w),x=Ye($,!0);ze($),ze(w),ze(h),ze(a),nt(((e,i)=>{ji(c,e),xr(g,`background-image: url('${t.thumb}')`),b=wr(v,1,"thumb-overlay s-k",null,b,i),ji(x,t.title)}),[()=>s()?Da("end_screen_next_video"):Da("end_screen_recommended_video"),()=>({withOpacity:s()})]),Ai(e,r)};Ji(g,(e=>{t.isHide||e(v)})),Ai(e,m),se(),r()}wi(["click"]);var gg=class{getTracksArray(){return Array.from(this.video.getElementsByTagName("track"))}attach(e,t=!1){let i=document.createElement("track");i.setAttribute("src",e.url),i.setAttribute("id",e.id),e.label&&i.setAttribute("label",e.label),e.language&&i.setAttribute("srclang",e.language),t&&(i.track.mode="showing"),this.video.appendChild(i)}detachAll(){for(let e of this.getTracksArray())this.video.removeChild(e)}updateSrc(e){let t=this.getTracksArray().find((t=>t.id===e.id));t&&(t.src=e.url)}getCurrentShowingId(){return this.getTracksArray().find((e=>"showing"===e.track.mode))?.id??null}constructor(e){this.video=e}},vg=({store:e,getFullscreenTarget:t})=>{let{isFullscreen:i}=e.ui,{setSubtitle:r}=e.actions.internal,{currentSubtitle$:s,availableSubtitlesList$:a,currentFormat$:n,availableTextTracks$:o}=e.state,l=null,u=()=>{l?.(),l=null},d=e=>{if(u(),!f.clientChecker.device.isIOS||as(n)!==f.VideoFormat.DASH_LIVE_CMAF||!e)return;let i=t().querySelector("video");if(!i)return;let d=new gg(i),c=as(o),h=as(a),p=as(s);for(let e of c)h.some((t=>t.value===e.id))&&d.attach(e,p.value===e.id);let m=o.subscribe((e=>{for(let t of e)d.updateSrc(t)})),g=()=>{let e=d.getCurrentShowingId();r(as(a).find((t=>t.value===e)))};i.textTracks.addEventListener("change",g),l=()=>{m(),d.detachAll(),i.textTracks.removeEventListener("change",g)}};Ki((()=>i.subscribe(d))),Yi(u)},bg=(e,t,i,r)=>{e.stopPropagation(),t()&&r()},yg=Ti("<!> <!>",1),Sg=Ti("<div><!></div>"),wg=Ti('<div class="spherical-video-icon s-8"><!></div>'),$g=Ti("<div><!></div>"),xg=Ti('<div class="settings-mobile s-8"><!></div>'),kg=Ti("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1),Tg=Ti('<div class="player-wrapper s-8" role="region" tabindex="-1"><!> <!> <!> <div class="overlay-container"></div></div>'),_g={hash:"s-8",code:".player-wrapper.s-8{height:100%;position:absolute;width:100%}.player-wrapper.s-8 .player-media{background:var(--black);height:100%;left:0;position:absolute;top:0;transition:transform .2s ease-in-out;width:100%}.spherical-video-icon.s-8{display:inline-block;left:calc(50% - 38px);position:absolute;top:calc(50% - 23px)}.ads-container.s-8{background:var(--black);height:100%;left:0;position:absolute;top:0;width:100%;z-index:var(--ads-container-z-index)}.settings-mobile.s-8{align-items:center;display:flex;left:50%;max-width:320px;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity var(--controls-transition-duration);width:90%;z-index:var(--settings-menu-z-index)}"};function Cg(e,t){re(t,!0),fr(e,_g);let i,r,s,[a,n]=us(),o=()=>ls(Q,"$playerPhase",a),l=()=>ls(ge,"$crashed",a),u=()=>ls(X,"$interactiveHideMobileControls",a),d=()=>ls(oe,"$isEnded$",a),c=()=>ls(K,"$controlsVisible",a),h=()=>ls(Ne,"$autoplayNextEnabled$",a),p=()=>ls(it,"$bottomNoSmooth",a),g=()=>ls(ye,"$videoSize",a),v=()=>ls(xe,"$playerSize",a),b=()=>ls(U,"$position$",a),y=()=>ls(W,"$duration$",a),S=()=>ls(J,"$settingsMenuVisible",a),w=()=>ls(ee,"$scrubbingInProgress",a),$=()=>ls(le,"$chromecastConnected$",a),x=ms(t,"videoContainer",15),k=ms(t,"adsSlotId",3,void 0),T=ms(t,"adsParams",3,void 0),_=ms(t,"adsAutoplayParam",3,void 0),C=ms(t,"duration",3,void 0),E=ms(t,"logoTargetUrl",3,""),A=ms(t,"showNextPrevButtons",3,!1),L=ms(t,"nextButtonActive",3,!1),P=ms(t,"prevButtonActive",3,!1),M=ms(t,"endScreenVideoTitle",3,void 0),I=ms(t,"endScreenVideoThumb",3,void 0),R=ms(t,"isOneVideoPlaylist",3,!1),V=ms(t,"showMiniTimer",3,!1),N=ms(t,"fullScreenTarget",3,void 0),B=ms(t,"playerStarted",3,!1),D=ms(t,"showEndScreen",3,!0),{notifications$:O,graphIsOpened$:F}=Fs(),j=t.store.getLogger().createComponentLog("Root component"),z=t.store.interfaceLanguage$,q=t.store.state.playbackState$,H=t.store.ads.playbackState,U=t.store.state.positionWithScrubbing$,W=t.store.state.duration$,Q=t.store.playerPhase,G=t.store.ui.isFullscreen,K=t.store.ui.controlsVisible,Y=t.store.ui.isControlsAvailable,X=t.store.ui.interactiveHideMobileControls,J=t.store.ui.settingsMenu.visible$,Z=t.store.ui.settingsMenu.openedByBtnKeyboard$,ee=t.store.ui.scrubbingInProgress,te=t.store.ui.volumeChangingInProgress,ae=t.store.ui.debugPanelVisible,ne=t.store.state.isLoaderVisible,oe=t.store.state.isEnded$,le=t.store.state.chromecastConnected$,ue=t.store.state.chromecastDeviceName$,de=t.store.ads.postrollPassed,ce=t.store.state.isLive$,he=t.store.state.isPlaying$,pe=t.store.state.isActiveLive$,me=t.store.state.isRewindableLive$,ge=t.store.state.crashed$,ve=t.store.webApi.annotationsApi,be=t.store.webApi.pictureInPictureApi,ye=t.store.state.videoSize$,Se=t.store.state.currentSubtitle$,we=t.store.state.currentSubtitleCaptions$,$e=t.store.state.duration$,xe=t.store.ui.playerSize,Te=t.store.ui.is3DVideo,Ce=t.store.ui.icon3DVideoVisible,Ee=t.store.state.isInteractive,Ae=t.store.state.isInteractiveTime$,Le=t.store.state.isInteractiveExpectation$,Pe=t.store.state.hasInteractiveBranches,Me=t.store.ui.controls.disabledControls$,Ie=t.store.ui.touched,Ve=t.store.ui.overlayContainer$,Ne=t.store.ui.autoplayNextEnabled$,Be=t.store.state.loadedMetadata$,De=t.store.actions.internal.closeSettingsMenu,Oe=t.store.callbacks?.onDisabledPlayPrevChapterClick,Fe=t.store.callbacks?.onDisabledSeekToInteractiveClick,je=t.store.actions.internal.setQuality,qe=ke(void 0),He=ke(void 0),Ue=ke(void 0),We=ke(void 0),Qe=fe((()=>("video"===o()&&ls(ne,"$isLoaderVisible",a)||"ads"===o()&&"inactive"===ls(H,"$adPlaybackState",a))&&!l())),Ge=ke(void 0),{closeNotification:Ke,notificationsToShow$:Ze}=O,et=fe((()=>!!ls(Ze,"$notificationsToShow$",a).slow_video)),tt=()=>Ke("slow_video"),it=rs(!1),st=ke(!1),at=fe((()=>ls(q,"$playbackState$",a)!==f.PlaybackState.PLAYING)),ot=ke(!1),lt=fe((()=>ls(F,"$graphIsOpened$",a)||u()||!ui(st)&&(d()&&!!Pe||ui(at)&&ls(Le,"$isInteractiveExpectation$",a)))),ut=ke(!0),dt=fe((()=>t.uiConfig.features.thumbTimer&&V()&&"video"===o()&&!c()&&!l()&&!Ee&&(t.uiConfig.hideThumbTimerAfterTouch&&!ls(Ie,"$touched",a)||!t.uiConfig.hideThumbTimerAfterTouch))),ct=ke(!1),ht=fe((()=>(D()||t.showAutoplayNext&&h())&&!!M()&&!!I()&&(t.showAds&&ls(de,"$postrollPassed",a)||!t.showAds)&&d()&&!l()&&!ui(ct))),pt=ke(!1);be?.setContext(ie());t.store.setUiCallbacks({onStarted:e=>{e&&!Ee&&mt(t.uiConfig.controls.hideTimeoutMobile)}});let ft=()=>{clearTimeout(i),_e(st,!1),u()&&X.set(!1)},mt=e=>{ft(),_e(st,!0),i=setTimeout((()=>_e(st,!1)),e);let t=e-100;s=setTimeout((()=>{p()&&it.set(!1)}),t>0?t:e)},gt=Te.subscribe((e=>{Ce.set(e),e&&(clearTimeout(r),r=setTimeout((()=>Ce.set(!1)),t.uiConfig.controls.hide360IconTimeout))})),vt=async(e=sn())=>{if(e&&!f.clientChecker.device.isIOS){let i=rn(),r=xt(),s=f.clientChecker.browser.isSamsungBrowser&&i===t.shadowRootContainer;e=i===r||s}if(e){mt(t.uiConfig.controls.hideTimeoutFullscreen);try{await(be?.exit())}catch(e){j({message:String(e)})}try{let e=g()?.width&&g()?.height?g():v();await(e=>{let t=window.screen;return(async e=>t.orientation?t.orientation.lock(e):t.mozLockOrientation?t.mozLockOrientation(e):t.msLockOrientation?t.msLockOrientation(e):Promise.reject())(((e={width:0,height:0})=>e.width<=e.height?"portrait":"landscape")(e))})(e)}catch(e){j({message:String(e)})}}G.set(e),t.store.getAdmanWrapper().setFullscreen(e),ls(G,"$isFullscreen",a)?t.store.callbacks?.onFullscreenEnter?.():t.store.callbacks?.onFullscreenExit?.()},bt=e=>{let t=e,{width:i,height:r}=t.target;xe.set({width:i,height:r})},yt=()=>{let{width:e,height:t}=ui(qe).getBoundingClientRect();xe.set({width:e,height:t})};Ki((()=>(an(vt),t.uiConfig.features.annotationsInside&&ve?.init(ui(qe)),ln(be)&&(be?.assignPlayerContainer(ui(qe)),be?.setExternalEventHandlers({resize:bt,leavepictureinpicture:yt})),_e(ut,!f.clientChecker.device.isIphoneOrOldIpad),t.interactiveContainer&&x().parentElement?.insertBefore(t.interactiveContainer,x().nextSibling),()=>{clearTimeout(i),clearTimeout(s),clearTimeout(r),gt(),be?.dispose().catch((e=>{j({message:String(e)})})),nn(vt)})));let St=ke(!0),wt=ke(!0),$t=e=>{let i=b()+("forward"===e?1:-1)*t.uiConfig.controls.seekStepMobile/1e3;i<0?(_e(St,!1),i=0):i>=y()&&(_e(wt,!1),i=y()),_e(ot,!0),t.seekTime(i)},xt=()=>f.clientChecker.device.isIOS?ui(qe):t.uiConfig.allowChangingFullscreenTarget&&N()&&N().contains(t.outerContainerRef)?N():t.outerContainerRef,kt=async()=>{try{if(sn())await tn(document),j({message:"exit fullscreen"});else{if(j({message:"request fullscreen"}),f.clientChecker.device.isIOS&&!ls(Be,"$loadedMetadata",a))return;await en(xt())}}catch(e){j({message:String(e)})}},Tt=()=>{De()},_t=e=>{if(e.preventDefault(),!S())return B()?(_e(ot,!1),void(c()?ft():mt(t.uiConfig.controls.hideTimeoutMobile))):(t.firstStart(),void mt(t.uiConfig.controls.hideTimeoutCursor));Tt()},Ct=e=>{Oe&&(Oe(e),mt(t.uiConfig.controls.hideTimeoutMobile))},Et=e=>{Fe&&(Fe(e),mt(t.uiConfig.controls.hideTimeoutMobile))};rt((()=>{Ve.set(ui(Ge))})),rt((()=>{K.set((ui(at)||S()||w()||ls(te,"$volumeChangingInProgress",a)||$()||!ui(ht)&&(d()||ui(st)&&!ui(ot)))&&!ui(lt)&&"video"===o()&&!l()&&ls(Y,"$isControlsAvailable",a))})),rt((()=>{!w()&&ui(pt)&&!ls(Ae,"$isInteractiveTime$",a)&&mt(t.uiConfig.controls.hideTimeoutMobile),_e(pt,w(),!0)})),rt((()=>{_e(St,b()>0),_e(wt,!ls(pe,"$isActiveLive",a)&&b()<y(),!0)})),rt((()=>{Qn(ui(We),S(),ls(Z,"$settingsMenuOpenedByKeyboard",a),!0)}));let At=Da("aria_label_video_player");(({getFullscreenTarget:e,fullScreenChangeHandler:t})=>{let i,r=null;Ki((()=>{f.clientChecker.device.isIOS&&(i=setTimeout((()=>{let i=e().querySelector("video");if(!i)return;let s=()=>t(!0),a=()=>t(!1);i.addEventListener("webkitbeginfullscreen",s),i.addEventListener("webkitendfullscreen",a),r=()=>{i.removeEventListener("webkitbeginfullscreen",s),i.removeEventListener("webkitendfullscreen",a)}}),0))})),Yi((()=>{r?.(),clearTimeout(i)}))})({fullScreenChangeHandler:vt,getFullscreenTarget:xt}),vg({store:t.store,getFullscreenTarget:xt});let Lt=(e,i)=>{let r=t.store.callbacks?.uiInfo?.onUpcomingLiveViewStateChanged;if(!r)return;let s=!!i;r({...Vd(ui(qe),{upcomingLiveScreen:i},"upcomingLiveScreen",s),...e})};var Pt=Tg();Si("blur",Re,Tt);var Mt=Ye(Pt);qm(Mt,{onClick:_t,get videoContainer(){return x()},set videoContainer(e){x(e)}});var It=Je(Mt,2);hr(It,(()=>"slot"),!1,((e,t)=>{Mr(e,(()=>({name:Im})))}));var Rt=Je(It,2);Zi(Rt,(()=>ls(z,"$language$",a)),(e=>{var i=kg(),r=Xe(i);let s=fe((()=>"thumb"!==o()||l()||Ee&&t.autoplay||t.uiConfig.features.disableThumbUnstartedOnAutoplay&&t.autoplay));Tp(r,{get hidden(){return ui(s)},get thumbUrl(){return t.thumbUrl},get startVideo(){return t.firstStart}});var n=Je(r,2),u=e=>{var i=yg(),r=Xe(i),s=e=>{let i=fe((()=>t.uiConfig.controls.seekStepMobile/1e3));cg(e,{side:"left",get seekStep(){return ui(i)},handleSingleFirstClick:_t,handleSecondClick:()=>$t("backward")})};Ji(r,(e=>{ui(St)&&e(s)}));var a=Je(r,2),n=e=>{let i=fe((()=>t.uiConfig.controls.seekStepMobile/1e3));cg(e,{side:"right",get seekStep(){return ui(i)},handleSingleFirstClick:_t,handleSecondClick:()=>$t("forward")})};Ji(a,(e=>{ui(wt)&&e(n)})),Ai(e,i)};Ji(n,(e=>{t.canRewindLive&&me&&!ls(Me,"$disabledControls$",a).has("TIMELINE")&&e(u)}));var d=Je(n,2),f=e=>{let i=fe((()=>t.live?.startTime));zp(e,{get thumbUrl(){return t.thumbUrl},get startTime(){return ui(i)},onUpcomingLiveViewStateChanged:Lt})};Ji(d,(e=>{"LiveWaitingStart"===o()&&e(f)}));var g=Je(d,2),w=e=>{Up(e,{kind:"recover",get thumbUrl(){return t.thumbUrl}})};Ji(g,(e=>{"LiveWaitingRecover"===o()&&e(w)}));var x=Je(g,2),V=e=>{Up(e,{kind:"record",get thumbUrl(){return t.thumbUrl}})};Ji(x,(e=>{"LiveWaitingRecord"===o()&&e(V)}));var N=Je(x,2),O=e=>{var i=Sg();let r;$n(Ye(i),{get adsSlotId(){return k()},get adsParams(){return T()},get adsAutoplayParam(){return _()},get duration(){return C()},get adsExternalApi(){return t.adsExternalApi}}),ze(i),nt((e=>r=wr(i,1,"ads-container s-8",null,r,e)),[()=>({hidden:"ads"!==o()})]),Ai(e,i)};Ji(N,(e=>{t.showAds&&B()&&e(O)}));var F=Je(N,2),j=e=>{let i=fe((()=>!D()&&t.showAutoplayNext&&h()));mg(e,{get title(){return M()},get thumb(){return I()},get isHide(){return ui(i)},clickCloseIcon:()=>_e(ct,!0)})};Ji(F,(e=>{ui(ht)&&M()&&I()&&e(j)}));var z=Je(F,2),q=e=>{ap(e,{})};Ji(z,(e=>{ls(Te,"$is3DVideo",a)&&e(q)}));var H=Je(z,2),U=e=>{var t=wg();Fa(Ye(t),{}),ze(t),Ai(e,t)};Ji(H,(e=>{ls(Ce,"$icon3DVideoVisible",a)&&e(U)}));var W=Je(H,2),Q=e=>{vp(e,{get thumbUrl(){return t.thumbUrl},get chromecastDeviceName(){return ls(ue,"$chromecastDeviceName$",a)},onClick:_t})};Ji(W,(e=>{$()&&e(Q)}));var G=Je(W,2),K=e=>{pp(e,{get shifted(){return c()},get captions(){return ls(we,"$currentSubtitleCaptions$",a)},get position(){return b()},get playerSize(){return v()},isMobile:!0})};Ji(G,(e=>{"off"!==ls(Se,"$currentSubtitle$",a).value&&e(K)}));var Y=Je(G,2),X=e=>{var t=$g();t.__click=[bg,S,J,Tt],wp(Ye(t)),ze(t),Ai(e,t)};Ji(Y,(e=>{l()&&e(X)}));var Z=Je(Y,2),ee=e=>{let i=fe((()=>"thumb"===o()||"LiveWaitingStart"===o()||"LiveWaitingRecover"===o()||"LiveWaitingRecord"===o()||"ads"===o())),r=fe((()=>"ads"===o())),s=fe((()=>t.canRewindLive&&0!==ls($e,"$realDuration$",a)));Wh(e,{get bottomHidden(){return ui(i)},get showControls(){return c()},get bottomNoSmooth(){return p()},get isAds(){return ui(r)},get canRewindLive(){return ui(s)},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return E()},get showAutoplayNext(){return t.showAutoplayNext},get showNextPrevButtons(){return A()},get nextButtonActive(){return L()},get prevButtonActive(){return P()},get isOneVideoPlaylist(){return R()},get customFullscreenSupported(){return ui(ut)},get endScreenShown(){return ui(ht)},toggleFullscreen:kt,get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},onDisabledPlayPrevChapterClick:Ct,onDisabledSeekToInteractiveClick:Et,get playerControlsWrapperRef(){return ui(He)},set playerControlsWrapperRef(e){_e(He,e,!0)},get playerControlsRef(){return ui(Ue)},set playerControlsRef(e){_e(Ue,e,!0)}})};Ji(Z,(e=>{B()&&e(ee)}));var te=Je(Z,2),ie=e=>{var i=xg();Cm(Ye(i),{get supportLink(){return t.supportLink},get returnFocus(){return m.noop},get ref(){return ui(We)},set ref(e){_e(We,e,!0)}}),ze(i),Ai(e,i)};Ji(te,(e=>{S()&&e(ie)}));var re=Je(te,2);let se=fe((()=>!ui(dt)));Nn(re,{get isLive(){return ls(ce,"$isLive$",a)},get isHidden(){return ui(se)},get isPlaying(){return ls(he,"$isPlaying$",a)},get position(){return b()},get duration(){return y()}});var ne=Je(re,2),oe=e=>{ml(e,{})};Ji(ne,(e=>{ui(Qe)&&e(oe)}));var le=Je(ne,2),de=e=>{zo(e,{})};Ji(le,(e=>{ls(ae,"$debugPanelVisible",a)&&e(de)}));var pe=Je(le,2),ge=e=>{Mm(e,{onClose:tt,onSelectAutoQuality:()=>{je("auto"),tt()}})};Ji(pe,(e=>{ui(et)&&e(ge)})),Ai(e,i)})),Xr(Je(Rt,2),(e=>_e(Ge,e)),(()=>ui(Ge))),ze(Pt),Xr(Pt,(e=>_e(qe,e)),(()=>ui(qe))),nt((()=>Pr(Pt,"aria-label",At))),Si("click",Pt,(()=>{Ie.set(!0)}),!0),Si("focusin",Pt,(()=>{Ee||(it.set(!0),mt(t.uiConfig.controls.hideTimeoutCursor))}),!0),Ai(e,Pt),se(),n()}function Eg(e){let t="";return Ag(e.timelineSliderFilledColor)&&(t+=`--timeline-slider-filled-bg:${e.timelineSliderFilledColor};`),Ag(e.timelineSliderHandleColor)&&(t+=`--timeline-slider-handle-bg:${e.timelineSliderHandleColor};`),Ag(e.timelineSliderLoadedColor)&&(t+=`--timeline-slider-loaded-bg:${e.timelineSliderLoadedColor};`),Ag(e.timelineSliderColor)&&(t+=`--timeline-slider-bg:${e.timelineSliderColor};`),Ag(e.volumeSliderColor)&&(t+=`--volume-slider-bg:${e.volumeSliderColor};`),Ag(e.volumeSliderHandleColor)&&(t+=`--volume-slider-handle-bg:${e.volumeSliderHandleColor};`),Ag(e.volumeSliderFilledColor)&&(t+=`--volume-slider-filled-bg:${e.volumeSliderFilledColor};`),Ag(e.controlsTimeColor)&&(t+=`--controls-time:${e.controlsTimeColor};`),Ag(e.timelineSliderFilledActiveLiveColor)&&(t+=`--timeline-slider-filled-active-live-bg:${e.timelineSliderFilledActiveLiveColor};`),Ag(e.timelineSliderHandleActiveLiveColor)&&(t+=`--timeline-slider-handle-active-live-bg:${e.timelineSliderHandleActiveLiveColor};`),Ag(e.buttonColor)&&(t+=`--btn-color:${e.buttonColor};`),Ag(e.buttonToggleOnColor)&&(t+=`--toggle-color-on:${e.buttonToggleOnColor};`,t+=`--toggle-color-autoplay-on:${e.buttonToggleOnColor};`),Ag(e.focusedColor)&&(t+=`--focused:${e.focusedColor};`),Ag(e.focusedOutlineWidth)&&(t+=`--focused-outline-width:${e.focusedOutlineWidth};`),Ag(e.focusedOutlineRadius)&&(t+=`--focused-outline-radius:${e.focusedOutlineRadius};`),Ag(e.controlsDesktopPaddingHorizontal)&&(t+=`--controls-desktop-padding-horizontal:${e.controlsDesktopPaddingHorizontal};`),Ag(e.timelinePaddingHorizontal)&&(t+=`--timeline-padding-horizontal:${e.timelinePaddingHorizontal};`),Ag(e.settingsBackgroundColor)&&(t+=`--settings-bg:${e.settingsBackgroundColor};`),Ag(e.font)&&(t+=`--font:${e.font};`),Ag(e.controlsGradientHeight)&&(t+=`--controls-gradient-height:${e.controlsGradientHeight};`),Ag(e.controlsGradient)&&(t+=`--controls-gradient:${e.controlsGradient};`),t.length&&t||void 0}function Ag(e){return"string"==typeof e&&!e.includes(";")}wi(["click"]);var Lg=Ti('<div class="time-container s-7"><!></div>'),Pg=Ti('<div class="player-wrapper s-7" role="region"><!> <!> <!> <!> <!> <div><!></div></div>'),Mg={hash:"s-7",code:".player-wrapper.s-7{height:100%;position:absolute;width:100%}.player-wrapper.s-7 .player-media{background:var(--black);height:100%;left:0;position:absolute;top:0;transition:transform .2s ease-in-out;width:100%}.timeline.s-7{bottom:0;left:0;opacity:0;opacity:1;position:absolute;transition:opacity var(--controls-transition-duration) var(--controls-transition-fn);width:100%;z-index:var(--controls-container-z-index)}.visible.s-7{opacity:1}.time-container.s-7{bottom:8px;position:absolute;right:8px;z-index:var(--thumb-timer-z-index)}"};function Ig(e,t){re(t,!0),fr(e,Mg);let[i,r]=us(),s=()=>ls(S,"$playerSize",i),a=()=>ls(p,"$isPlaying$",i),n=()=>ls(c,"$duration$",i),o=ms(t,"outsideDuration",3,0),l=ms(t,"videoContainer",15),{playerPhase:u,state:{crashed$:d,duration$:c,positionExact$:h,isPlaying$:p,currentSubtitle$:f,currentSubtitleCaptions$:g,positionWithScrubbing$:v,isLive$:b,isRewindableLive$:y},ui:{playerSize:S,controls:w,scrubbingInProgress:$},actions:{internal:{getVideoElement:x}}}=Os(),k=ke(!1),T=le({}),_=ke(!1),C=fe((()=>!ls($,"$scrubbingInProgress",i)&&!ui(_))),E=(0,m.debounceFn)(Dd,260);rt((()=>{s(),E(x(),w,T,ui(k))}));let A=fe((()=>a()?xn(n()-ls(v,"$positionWithScrubbing$",i)):xn(isFinite(n())?n():o())));var L=Pg(),P=Ye(L);qm(P,{hideCursor:!1,get videoContainer(){return l()},set videoContainer(e){l(e)}});var M=Je(P,2);hr(M,(()=>"slot"),!1,((e,t)=>{Mr(e,(()=>({name:Im})))}));var I=Je(M,2);let R=fe((()=>"thumb"!==ls(u,"$playerPhase",i)||ls(d,"$crashed$",i)));Tp(I,{get hidden(){return ui(R)},get thumbUrl(){return t.thumbUrl},iconVisible:!1});var V=Je(I,2),N=e=>{pp(e,{shifted:!1,get captions(){return ls(g,"$currentSubtitleCaptions$",i)},get position(){return ls(h,"$positionExact$",i)},get playerSize(){return s()}})};Ji(V,(e=>{"off"!==ls(f,"$currentSubtitle$",i).value&&ui(C)&&e(N)}));var B=Je(V,2),D=e=>{var t=Lg();Mn(Ye(t),{get isLive(){return ls(b,"$isLive$",i)},get isPlaying(){return a()},get time(){return ui(A)}}),ze(t),Ai(e,t)};Ji(B,(e=>{ui(C)&&e(D)}));var O=Je(B,2);let F;oh(Ye(O),{get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return ls(y,"$isRewindableLive$",i)},isAds:!1,needPadding:!1,isHidden:!1,withEpisodes:!1,tooltipLeftOffset:8,tooltipRightOffset:8,get ref(){return T.timeline},set ref(e){T.timeline=e}}),ze(O),ze(L),nt((e=>F=wr(O,1,"timeline s-7",null,F,e)),[()=>({visible:ui(k)})]),Si("mouseenter",L,(()=>{_e(k,!0)})),Si("mouseleave",L,(()=>{_e(k,!1)})),Si("mouseenter",O,(()=>_e(_,!0))),Si("mouseleave",O,(()=>_e(_,!1))),Ai(e,L),se(),r()}var Rg=Ti("<div><!></div>"),Vg={hash:"s-0",code:'.vk-vp-root.s-0{--white:#fff;--black:#000;--red:#ff3347;--blue-light:#70c1ff;--black-alpha-40:rgba(0,0,0,.4);--white-alpha-24:hsla(0,0%,100%,.24);--white-alpha-72:hsla(0,0%,100%,.72);--devider-gray:#dce1e6;--text-gray:#626d7a;--font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;--controls-height:40px;--controls-gradient-height:100px;--controls-transition-duration:0.25s;--controls-transition-fn:cubic-bezier(0.455,0.03,0.515,0.955);--controls-desktop-item-margin-left:4px;--controls-desktop-padding-horizontal:4px;--focused:var(--white);--focused-outline-width:2px;--focused-outline-radius:0;--focused-element-shadow:inset 0 0 0 var(--focused-outline-width) var(--focused);--focused-slider-shadow:0 0 0 2px var(--focused);--big-play-size:96px;--big-play-radius:50%;--big-play-bg-color:rgba(0,0,0,.5);--big-play-hover-bg-color:rgba(0,0,0,.6);--big-play-icon-width:38px;--big-play-icon-height:33px;--interactive-episode-complete:#5c9ce6;--slider-bg:hsla(0,0%,100%,.4);--slider-filled-bg:var(--white);--slider-handle-bg:var(--white);--slider-loaded-bg:hsla(0,0%,100%,.4);--slider-height:3px;--slider-video-episode-gap:1.5px;--slider-radius:0px;--slider-handle-size:12px;--slider-filled-ads:#67a5eb;--slider-disabled-color:hsla(0,0%,97%,.31);--slider-volume-height:5px;--slider-volume-radius:calc(var(--slider-volume-height)/2);--slider-volume-handle-size:13px;--timeline-slider-filled-active-live-bg:var(--red);--timeline-slider-handle-active-live-bg:var(--red);--timeline-slider-bg:var(--slider-bg);--timeline-slider-filled-bg:var(--slider-filled-bg);--timeline-slider-handle-bg:var(--slider-handle-bg);--timeline-slider-loaded-bg:var(--slider-loaded-bg);--volume-slider-bg:var(--slider-bg);--volume-slider-filled-bg:var(--slider-filled-bg);--volume-slider-handle-bg:var(--slider-handle-bg);--controls-time:var(--white);--controls-gradient:linear-gradient(180deg,transparent 0%,rgba(0,0,0,.005) 6.67%,rgba(0,0,0,.02) 13.33%,rgba(1,1,1,.04) 20%,rgba(1,1,1,.07) 26.67%,rgba(2,2,2,.11) 33.33%,rgba(3,3,3,.16) 40%,rgba(4,4,4,.22) 46.67%,rgba(6,6,6,.28) 53.33%,rgba(7,7,7,.33) 60%,rgba(8,8,8,.38) 66.67%,rgba(9,9,9,.42) 73.33%,rgba(9,9,9,.46) 80%,hsla(0,0%,4%,.48) 86.67%,hsla(0,0%,4%,.5));--timeline-preview-shadow:rgba(0,0,0,.08);--timeline-preview-bg:#222;--timeline-padding-horizontal:10px;--timeline-padding-vertical-top:3px;--timeline-padding-vertical-bottom:4px;--timeline-height:calc(var(--timeline-padding-vertical-bottom) + var(--timeline-padding-vertical-top) + var(--slider-height));--preview-track-frame-height-vertical:114px;--preview-track-frame-height-horizontal:65px;--preview-track-controls-top:16px;--preview-track-time-line-height:16px;--preview-track-bottom-offset:10px;--preview-track-height:calc(var(--preview-track-frame-height-vertical) + var(--preview-track-bottom-offset));--preview-track-controls-top-offset:calc(var(--timeline-height) + var(--preview-track-controls-top) + var(--preview-track-time-line-height));--settings-bg:rgba(0,0,0,.72);--settings-item-bg-hover:hsla(0,0%,100%,.08);--settings-radius:8px;--mobile-settings-bg:#2c2d2e;--divider-border:1px solid var(--white-alpha-24);--toggle-color-separator:#363738;--toggle-color-off:#656565;--toggle-color-on:#71aaeb;--toggle-color-autoplay-on:var(--white);--notification-bg:#2c2d2e;--notification-radius:8px;--button-hover-transition:opacity 0.2s;--video-container-z-index:0;--controls-container-z-index:1;--ads-container-z-index:1;--end-screen-mobile-z-index:1;--notification-z-index:1;--thumb-timer-z-index:2;--debug-panel-z-index:2;--modal-z-index:2;--settings-menu-z-index:2;--context-menu-z-index:3;--hot-key-helpers-container-z-index:3;--overlay-container-z-index:4;--rotate-transition-duration:0.25s;--btn-color:var(--white);--double-forward-bg:rgba(0,0,0,.6);background:var(--black);color:var(--white);font-family:var(--vk-vp-custom-font,var(--font));font-size:12px;height:100%;line-height:normal;outline:0;overflow:hidden;position:relative;user-select:none;width:100%}.vk-vp-root.visible-outside.s-0{overflow:visible}.vk-vp-root.s-0 *{-webkit-tap-highlight-color:transparent}.vk-vp-root.s-0 button{background:transparent;border:none;color:inherit;font:inherit;line-height:normal;margin:0;overflow:visible;padding:0;width:auto;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none;cursor:pointer}.vk-vp-root.s-0 p{margin:0}.vk-vp-root.s-0 svg:not(.interactive-root svg){pointer-events:none}.vk-vp-root.s-0 .interactive-root{font-family:var(--vk-vp-int-custom-font,inherit)}.vk-vp-root.s-0 :focus,.vk-vp-root.s-0 :focus-visible{outline:none}.vk-vp-root.s-0 :focus-visible{border-radius:var(--focused-outline-radius);box-shadow:var(--focused-element-shadow)}.vk-vp-root.s-0 .focus-hidden:focus-visible{box-shadow:none}.vk-vp-root.s-0 .hidden{opacity:0;visibility:hidden}.vk-vp-root.s-0 .out-of-flow{content-visibility:hidden!important}.vk-vp-root.s-0 .overlay-container{height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%;z-index:var(--overlay-container-z-index)}.vk-vp-root.s-0 .out-of-view{left:-1000vh!important;position:absolute!important}.vk-vp-root.s-0 .icon.icon-error-stub{align-items:center;display:flex;justify-content:center}'};function Ng(e,t){re(t,!0),fr(e,Vg);let[i,r]=us(),s=()=>ls(ye,"$availableSubtitlesList$",i),a=ms(t,"sources",7),n=ms(t,"store",7),o=ms(t,"microStoresRoot",7),l=ms(t,"videoConfig",7),u=ms(t,"uiConfig",7),d=ms(t,"title",7),c=ms(t,"thumbUrl",7),h=ms(t,"interactiveContainer",7),p=ms(t,"interactiveController",7),v=ms(t,"subtitles",7),b=ms(t,"subtitlesForcedLanguage",7),y=ms(t,"live",7),S=ms(t,"preload",7),w=ms(t,"autoplay",7),$=ms(t,"volume",7,void 0),x=ms(t,"muted",7,void 0),k=ms(t,"fromTime",7),T=ms(t,"canRewindLive",7),_=ms(t,"showAds",7),C=ms(t,"adsSlotId",7,void 0),E=ms(t,"adsParams",7,void 0),A=ms(t,"adsAutoplayParam",7,void 0),L=ms(t,"duration",7,void 0),P=ms(t,"logoClickable",7),M=ms(t,"logoHidden",7),I=ms(t,"isMobile",7),R=ms(t,"showNextPrevButtons",7,!1),V=ms(t,"nextButtonActive",7,!1),N=ms(t,"prevButtonActive",7,!1),B=ms(t,"endScreenVideoTitle",7,void 0),D=ms(t,"endScreenVideoThumb",7,void 0),O=ms(t,"isOneVideoPlaylist",7,!1),F=ms(t,"supportLink",7),j=ms(t,"shadowRootContainer",7),z=ms(t,"outerContainerRef",7),q=ms(t,"fullScreenTarget",7,void 0),H=ms(t,"failoverHosts",7,void 0),U=ms(t,"showMiniTimer",7,!1),W=ms(t,"saveRate",7),Q=ms(t,"seekToInteractive",7,m.noop),G=ms(t,"playPrevChapter",7,m.noop),K=ms(t,"volumeMultiplier",7),Y=ms(t,"showAutoplayNext",7),X=ms(t,"showEndScreen",7,!0),J=ms(t,"keyboardControls",15,void 0),{subscribers:Z,stores:ee}=o();(e=>{te("ui-config",e)})(u());let ie=ys(),ae=u().logoLink,ne=n().ui.debugPanelVisible,oe=n().ui.playerSize,le=n().state.isLive$,ue=n().state.isInteractive&&f.clientChecker.device.isAndroid,de=ke(void 0),ce=null,he=ke(!1);n().getAdmanWrapper().init({switchFromAdsToVideo:n().actions.internal.switchFromAdsToVideo,switchFromVideoToAds:n().actions.internal.switchFromVideoToAds,setMuted:n().actions.external.setMuted},n().ads,{vsid:n().vsid}),((e,t)=>{te(Bs,e),te(Ds,t)})(n(),ee),rt((()=>{n().ui.isMobile.set(I()),l().callbacks?.onDomReady?.()}));let pe=(e=!1)=>{_e(he,!0),e?n().actions.external.firstStart(_()):n().actions.internal.firstStart(_())};function fe(e){let t=a()||e;t&&n().initVideo({container:ui(de),sources:t,failoverHosts:H(),subtitles:v(),subtitlesForcedLanguage:b(),volumeMultiplier:K()});let r="true"===m.safeStorage.get(Ss);ne.set(r),k()>0&&n().actions.external.seekTime(k());let s=I()?ie.volumeDefault:$()??sa()??ie.volumeDefault,o=x()??ua(Ws);if(n().actions.external.setVolume(s),n().actions.external.setMuted(o),n().getAdmanWrapper().setInitialVolume(o?0:s),(()=>{if(ie.features.qualityDetailsSubMenuEnabled){let e=ga(n().videoId);if(e)switch(e.type){case"high_quality":n().actions.internal.setHighQualityEnabled(!0,e.appliesTo);break;case"traffic_saving":n().actions.internal.setTrafficSavingEnabled(!0,e.appliesTo);break;case"exact_quality":n().actions.internal.setQuality(e.quality)}}else{va(n().videoId),ha()&&n().actions.internal.setTrafficSavingEnabled(!0);let e=oa(n().videoId);e&&n().actions.internal.setQuality(e)}})(),ie.features.saveRate&&W()){let e=(()=>{let e=m.safeStorage.get(Xs);if((0,m.isNullable)(e))return;let{rate:t}=JSON.parse(e);return t})();e&&!ls(le,"$isLive$",i)&&n().actions.internal.setPlaybackRate(e)}if(Y()){let e=ua(Js);e&&n().actions.internal.setAutoplayNextEnabled(e)}n().ui.isAutoplay.set(w()),w()&&pe(),S()&&ie.features.preload&&n().actions.internal.preload()}let me=()=>{document.hidden&&n().actions.external.stop()};function ge(e){n().actions.internal.seekTime(e,g.SeekAction.UNKNOWN)}Ki((()=>{ue&&document.addEventListener("visibilitychange",me),ie.debugLog&&n().actions.internal.startLogging(),(e=>{if(window.ResizeObserver){let t,i;ce=new ResizeObserver((0,m.throttleFn)((e=>{let r=e[0];if(r.contentBoxSize){let e=Array.isArray(r.contentBoxSize)?r.contentBoxSize[0]:r.contentBoxSize;t=e.inlineSize,i=e.blockSize}else r.contentRect&&(t=r.contentRect.width,i=r.contentRect.height);oe.set({width:t,height:i})}),300)),ce.observe(e)}e.clientWidth&&e.clientHeight&&oe.set({width:e.clientWidth,height:e.clientHeight})})(ui(de));let e=Z.map((e=>e.init({store:n(),microStores:ee,config:l(),interactiveController:p(),uiConfig:u()}))),t=()=>{ue&&document.removeEventListener("visibilitychange",me),ce?.disconnect(),e.forEach((e=>e.unsubscribe())),n().destroy()};return"upcoming"===y()?.status?(n().actions.internal.setLiveWaitingStart(!0),t):"waiting"===y()?.status?(n().actions.internal.setLiveWaitingRecover(!0),t):"finished"!==y()?.status&&"postlive"!==y()?.status||a()&&(0,f.areValidLiveRecordSources)(a())?(fe(),t):(n().actions.internal.setLiveWaitingRecord(!0),t)}));let ve=Eg(ie.view),be="preview"===l().playerView,ye=n().state.availableSubtitlesList$;if(ie.features.initSubtitles){let e=!1;rt((()=>{if(!e&&s().length){let t;if(e=!0,ie.features.userVideoPrefs&&n().videoId){let e=xa(ie.userSalt,String(n().videoId));e?.subtitleTrackId&&(t=s().find((t=>t.value===e.subtitleTrackId)))}let i=b()??fa();i&&(t=s().find((e=>e.language===i))),n().actions.internal.setSubtitle(t)}}))}let Se=n().ui.isPreviewTrackHorizontallyAligned;var we=Rg();let $e;var xe=Ye(we),Te=e=>{Cg(e,{get store(){return n()},get uiConfig(){return ie},get thumbUrl(){return c()},get interactiveContainer(){return h()},get live(){return y()},get autoplay(){return w()},get canRewindLive(){return T()},get showAds(){return _()},get adsSlotId(){return C()},get adsParams(){return E()},get adsAutoplayParam(){return A()},get duration(){return L()},get logoClickable(){return P()},get logoHidden(){return M()},get logoTargetUrl(){return ae},get nextButtonActive(){return V()},get prevButtonActive(){return N()},get endScreenVideoTitle(){return B()},get endScreenVideoThumb(){return D()},get isOneVideoPlaylist(){return O()},get supportLink(){return F()},get shadowRootContainer(){return j()},get outerContainerRef(){return z()},get fullScreenTarget(){return q()},get showMiniTimer(){return U()},get playerStarted(){return ui(he)},get seekToInteractive(){return Q()},get playPrevChapter(){return G()},firstStart:pe,seekTime:ge,get showEndScreen(){return X()},get showAutoplayNext(){return Y()},get showNextPrevButtons(){return R()},get adsExternalApi(){return t.adsExternalApi},get videoContainer(){return ui(de)},set videoContainer(e){_e(de,e,!0)}})},Ce=e=>{var i=Ei(),r=Xe(i),s=e=>{Ig(e,{get thumbUrl(){return c()},get outsideDuration(){return L()},get canRewindLive(){return T()},get videoContainer(){return ui(de)},set videoContainer(e){_e(de,e,!0)}})},a=e=>{og(e,{get store(){return n()},get uiConfig(){return ie},get title(){return d()},get thumbUrl(){return c()},get interactiveContainer(){return h()},get live(){return y()},get autoplay(){return w()},get canRewindLive(){return T()},get showAds(){return _()},get adsSlotId(){return C()},get adsParams(){return E()},get adsAutoplayParam(){return A()},get duration(){return L()},get logoClickable(){return P()},get logoHidden(){return M()},get logoTargetUrl(){return ae},get nextButtonActive(){return V()},get prevButtonActive(){return N()},get endScreenVideoTitle(){return B()},get endScreenVideoThumb(){return D()},get isOneVideoPlaylist(){return O()},get supportLink(){return F()},get shadowRootContainer(){return j()},get outerContainerRef(){return z()},get fullScreenTarget(){return q()},get showMiniTimer(){return U()},get playerStarted(){return ui(he)},get seekToInteractive(){return Q()},get playPrevChapter(){return G()},firstStart:pe,get showEndScreen(){return X()},get showAutoplayNext(){return Y()},get showNextPrevButtons(){return R()},get adsExternalApi(){return t.adsExternalApi},get getVideoDeeplink(){return t.getVideoDeeplink},get videoContainer(){return ui(de)},set videoContainer(e){_e(de,e,!0)},get keyboardControls(){return J()},set keyboardControls(e){J(e)}})};Ji(r,(e=>{be?e(s):e(a,!1)})),Ai(e,i)};Ji(xe,(e=>{I()?e(Te):e(Ce,!1)})),ze(we),nt((e=>{$e=wr(we,1,"vk-vp-root s-0",null,$e,e),xr(we,ve)}),[()=>({"root--miui-browser":f.clientChecker.device.isMobile&&f.clientChecker.browser.isMiuiBrowser,"visible-outside":be,"preview-track-horizontally-alinged":ls(Se,"$isPreviewTrackHorizontallyAligned$",i)})]),Ai(e,we);var Ee=se({initVideo:fe,play:function(){ui(he)?n().actions.external.play():pe(!0)},pause:function(){n().actions.external.pause()},setMuted:function(e){n().actions.external.setMuted(e)},toggleSubtitle:function(){n().actions.external.toggleSubtitle()},changeSubtitle:function(e,t){n().actions.external.changeSubtitle(e,t)},changeAudioStream:function(e){n().actions.external.changeAudioStream(e)},hideControls:function(){n().webApi.slotsApi?.haveSlots()&&n().actions.external.hideControls()},showControls:function(){n().webApi.slotsApi?.haveSlots()&&n().actions.external.showControls()},setVolume:function(e){I()||e>=0&&e<=1&&n().actions.external.setVolume(e)},seekTime:ge,seekEpisodeStartTime:function(e){n().actions.external.seekEpisodeStartTime(e)},returnFocusToEpisodes:function(){n().actions.external.returnFocusToEpisodes()},setPlaybackRate:function(e){n().actions.external.setPlaybackRate(e)},setAutoQualityLimits:function(e){n().actions.external.setAutoQualityLimits(e)},setAutoQuality:function(){n().actions.external.setQuality("auto")},toggleTrafficSaving:function(e){n().actions.external.setTrafficSavingEnabled(e)},toggleHighQuality:function(e){n().actions.external.setHighQualityEnabled(e)},get sources(){return a()},set sources(e){a(e)},get store(){return n()},set store(e){n(e)},get microStoresRoot(){return o()},set microStoresRoot(e){o(e)},get videoConfig(){return l()},set videoConfig(e){l(e)},get uiConfig(){return u()},set uiConfig(e){u(e)},get title(){return d()},set title(e){d(e)},get thumbUrl(){return c()},set thumbUrl(e){c(e)},get interactiveContainer(){return h()},set interactiveContainer(e){h(e)},get interactiveController(){return p()},set interactiveController(e){p(e)},get subtitles(){return v()},set subtitles(e){v(e)},get subtitlesForcedLanguage(){return b()},set subtitlesForcedLanguage(e){b(e)},get live(){return y()},set live(e){y(e)},get preload(){return S()},set preload(e){S(e)},get autoplay(){return w()},set autoplay(e){w(e)},get volume(){return $()},set volume(e){$(e)},get muted(){return x()},set muted(e){x(e)},get fromTime(){return k()},set fromTime(e){k(e)},get canRewindLive(){return T()},set canRewindLive(e){T(e)},get showAds(){return _()},set showAds(e){_(e)},get adsSlotId(){return C()},set adsSlotId(e){C(e)},get adsParams(){return E()},set adsParams(e){E(e)},get adsAutoplayParam(){return A()},set adsAutoplayParam(e){A(e)},get duration(){return L()},set duration(e){L(e)},get logoClickable(){return P()},set logoClickable(e){P(e)},get logoHidden(){return M()},set logoHidden(e){M(e)},get isMobile(){return I()},set isMobile(e){I(e)},get showNextPrevButtons(){return R()},set showNextPrevButtons(e){R(e)},get nextButtonActive(){return V()},set nextButtonActive(e){V(e)},get prevButtonActive(){return N()},set prevButtonActive(e){N(e)},get endScreenVideoTitle(){return B()},set endScreenVideoTitle(e){B(e)},get endScreenVideoThumb(){return D()},set endScreenVideoThumb(e){D(e)},get isOneVideoPlaylist(){return O()},set isOneVideoPlaylist(e){O(e)},get supportLink(){return F()},set supportLink(e){F(e)},get shadowRootContainer(){return j()},set shadowRootContainer(e){j(e)},get outerContainerRef(){return z()},set outerContainerRef(e){z(e)},get fullScreenTarget(){return q()},set fullScreenTarget(e){q(e)},get failoverHosts(){return H()},set failoverHosts(e){H(e)},get showMiniTimer(){return U()},set showMiniTimer(e){U(e)},get saveRate(){return W()},set saveRate(e){W(e)},get showAutoplayNext(){return Y()},set showAutoplayNext(e){Y(e)},get seekToInteractive(){return Q()},set seekToInteractive(e){Q(e)},get playPrevChapter(){return G()},set playPrevChapter(e){G(e)},get volumeMultiplier(){return K()},set volumeMultiplier(e){K(e)},get showEndScreen(){return X()},set showEndScreen(e){X(e)},get keyboardControls(){return J()},set keyboardControls(e){J(e)}});return r(),Ee}var Bg=_i('<defs><path id="rect" d="m2.72 0c.45 0 .6.05.77.13a1 1 0 01.38.38c.09.16.13.33.13.77v1.44c0 .44-.04.6-.13.77a1 1 0 01-.38.38c-.16.08-.32.13-.77.13h-1.44c-.44 0-.6-.05-.77-.13a1 1 0 01-.37-.38c-.1-.16-.14-.33-.14-.77v-1.44c0-.44.05-.6.13-.77a1 1 0 01.38-.38c.17-.08.33-.13.77-.13z"></path></defs><path d="M38.24 6c3.57 0 4.86.37 6.17 1.07a7.3 7.3 0 0 1 3.02 3.02c.7 1.3 1.07 2.6 1.07 6.17v23.49c0 3.56-.37 4.85-1.07 6.16a7.3 7.3 0 0 1-3.02 3.02c-1.3.7-2.6 1.07-6.16 1.07h-19.5c-3.56 0-4.85-.37-6.16-1.07a7.3 7.3 0 0 1-3.02-3.02c-.7-1.3-1.07-2.6-1.07-6.16v-23.5c0-3.56.37-4.85 1.07-6.16a7.3 7.3 0 0 1 3.02-3.02C13.9 6.37 15.2 6 18.76 6zm.32 3h-19.8c-2.8 0-3.77.19-4.75.71a4.3 4.3 0 0 0-1.8 1.8c-.5.95-.7 1.87-.7 4.43l-.01 23.8c0 2.8.19 3.76.71 4.75a4.3 4.3 0 0 0 1.8 1.8c.98.52 1.95.71 4.75.71h19.49c2.8 0 3.76-.19 4.74-.71a4.3 4.3 0 0 0 1.8-1.8c.52-.98.71-1.95.71-4.74v-23.5c0-2.8-.19-3.75-.71-4.74a4.3 4.3 0 0 0-1.8-1.8c-.95-.5-1.87-.7-4.43-.7z"></path><use xlink:href="#rect" x="16.5" y="14"></use><use xlink:href="#rect" x="16.5" y="22"></use><use xlink:href="#rect" x="16.5" y="30"></use><use xlink:href="#rect" x="16.5" y="38"></use><use xlink:href="#rect" x="37" y="14"></use><use xlink:href="#rect" x="37" y="22"></use><use xlink:href="#rect" x="37" y="30"></use><use xlink:href="#rect" x="37" y="38"></use>',1);var Dg=Ti('<div class="title s-1"> </div>'),Og=Ti('<div class="playerStub s-1"><!> <!></div>'),Fg={hash:"s-1",code:".playerStub.s-1{align-items:center;background-color:#222;background-position:50%;background-size:cover;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;height:100%;justify-content:center;position:relative;width:100%}.title.s-1{box-sizing:border-box;color:#fff;font-size:15px;left:0;overflow:hidden;padding:18px 20px 10px;position:absolute;text-overflow:ellipsis;top:0;white-space:nowrap;width:100%}"};function jg(e,t){fr(e,Fg);var i=Og(),r=Ye(i),s=e=>{var i=Dg(),r=Ye(i,!0);ze(i),nt((()=>ji(r,t.title))),Ai(e,i)};Ji(r,(e=>{t.title&&e(s)}));var a=Je(r,2),n=e=>{let i=fe((()=>!!t.thumbUrl));!function(e,t){let i=ms(t,"isWhite",3,!1),r=fe((()=>i()?"#fff":"#909499"));Ea(e,{width:"57",height:"60",get fill(){return ui(r)},testId:"stub-icon",children:(e,t)=>{var i=Bg();qe(9),Ai(e,i)},$$slots:{default:!0}})}(e,{get isWhite(){return ui(i)}})};Ji(a,(e=>{(!t.title||!t.thumbUrl)&&e(n)})),ze(i),nt((()=>xr(i,t.thumbUrl?`background-image: url('${t.thumbUrl}')`:""))),Ai(e,i)}var zg=Ti('<div class="playerError s-3"><!></div>'),qg={hash:"s-3",code:".playerError.s-3{align-items:center;background-color:#222;background-position:50%;background-size:cover;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;height:100%;justify-content:center;position:relative;width:100%}"};function Hg(e){fr(e,qg);var t=zg();wp(Ye(t)),ze(t),Ai(e,t)}var Ug=class{isSupported(){return"mediaSession"in navigator}setMetaData({title:e,artist:t="",thumbUrl:i=""}){this.isSupported()&&(navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:t,artwork:[{src:i,sizes:"96x96",type:"image/png"},{src:i,sizes:"128x128",type:"image/png"},{src:i,sizes:"192x192",type:"image/png"},{src:i,sizes:"256x256",type:"image/png"},{src:i,sizes:"384x384",type:"image/png"},{src:i,sizes:"512x512",type:"image/png"}]}))}updateActionHandlers(e){this.resetActionHandlers(),this.setActionHandlers(e)}resetActionHandlers(){this.setActionHandlers([["play",null],["pause",null],["stop",null],["nexttrack",null],["previoustrack",null],["seekto",null],["seekbackward",null],["seekforward",null]])}setActionHandlers(e){if(this.isSupported())for(let[t,i]of e)try{navigator.mediaSession.setActionHandler?.(t,i)}catch{throw new Error(`The media session action "${t}" is not supported yet.`)}}attachToStore(e){!this.isSupported()||!e||(this.clearSubscriptions(),this.subscription.add(e.state.positionExact$.subscribe((t=>{let i=as(e.state.currentPlaybackRate$),r=as(e.state.duration$);if(isFinite(t)&&isFinite(r))try{navigator.mediaSession.setPositionState?.({position:t,playbackRate:i,duration:r})}catch{this.log({message:`MediaSession setPositionState can't call with position: ${t} and duration: ${r}`})}}))))}clearSubscriptions(){this.subscription.unsubscribe()}destroy(){this.resetActionHandlers(),this.clearSubscriptions()}constructor(){this.subscription=new m.Subscription,this.logger=new m.Logger,this.log=this.logger.createComponentLog("MediaSessionApi")}},Wg=_i('<path d="M31.257 3.998c3.037.01 4.52.39 6.13 1.24a9 9 0 013.47 3.35l.17.31.15.3c.78 1.55 1.07 3.18 1.09 6.25v9.04a1.5 1.5 0 01-3 .02v-9.65c-.05-2.04-.24-3.12-.64-4.04l-.12-.27-.13-.25A6 6 0 0036.2 7.9c-1.19-.64-2.34-.88-5.11-.9h-8.84c-2.73 0-4 .2-5.07.7l-.25.13a6 6 0 00-2.4 2.41c-.64 1.19-.88 2.34-.9 5.11v20.83c0 2.74.2 4 .7 5.08l.13.25a6 6 0 002.41 2.4c1.1.6 2.13.83 4.44.89H26a1.5 1.5 0 010 3h-4.47c-3-.05-4.53-.38-6.14-1.24a9 9 0 01-3.48-3.35l-.15-.3c-.73-1.47-1.04-3.01-1.08-5.8V15c.05-2.98.39-4.52 1.25-6.12a9 9 0 013.293-3.582c1.85-.871 2.623-1.27 5.747-1.27z"></path><path d="M30.5 33.8c0-1.68 0-2.52.33-3.16a3 3 0 0 1 1.3-1.31c.65-.33 1.49-.33 3.17-.33h6.4c1.68 0 2.52 0 3.16.33a3 3 0 0 1 1.31 1.3c.33.65.33 1.49.33 3.17v13.4c0 1.68 0 2.52-.33 3.16a3 3 0 0 1-1.3 1.31c-.65.33-1.49.33-3.17.33h-6.4c-1.68 0-2.52 0-3.16-.33a3 3 0 0 1-1.31-1.3c-.33-.65-.33-1.49-.33-3.17z"></path>',1),Qg=Ti('<div><div><!></div> <span class="title s-6"> </span></div>'),Gg={hash:"s-6",code:".player-pip-dummy.s-6{align-items:center;background-color:#19191a;display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;height:100%;justify-content:center;width:100%}.player-pip-dummy.is-pip-api.s-6{position:relative}.dummy-image.s-6 svg{transform:scale(1.07143)}.dummy-image.desktop.s-6{transform:scale(1.07143) rotate(-90deg) rotateY(180deg)}.title.s-6{color:#fff;font-size:16px;padding:18px 20px 10px;text-align:center}"};function Kg(e,t){re(t,!0),fr(e,Gg);let[i,r]=us(),s=Os(),a=ys(),n=!!s.webApi.pictureInPictureApi,o=s.interfaceLanguage$,l=s.ui.isMobile,u=s.ui.t,d=fe((()=>ls(o,"$interfaceLanguage$",i)&&u("pip_dummy_title"))),c=Eg(a.view);var h=Qg();let p;var f=Ye(h);let m;Ea(Ye(f),{width:"57",height:"56",testId:"pip-dummy-icon",children:(e,t)=>{var i=Wg();qe(),Ai(e,i)},$$slots:{default:!0}}),ze(f);var g=Je(f,2),v=Ye(g,!0);ze(g),ze(h),nt(((e,t)=>{p=wr(h,1,"player-pip-dummy s-6",null,p,e),xr(h,c),m=wr(f,1,"dummy-image s-6",null,m,t),ji(v,ui(d))}),[()=>({"is-pip-api":n}),()=>({desktop:!ls(l,"$isMobile$",i)})]),Ai(e,h),se(),r()}var Yg=class{isSupported(){let{isEmbed:e}=(0,m.detectEmbed)();return"documentPictureInPicture"in window&&!e}isActive(){return this.info.isActive$.getValue()}setPlayerDomElement(e,t){this.playerDomElement=e,this.playerParentShadowRoot=t}setContext(e){this.svelteContext=e}async request(){if(!this.isSupported()||!this.playerDomElement||!this.playerParentShadowRoot)return;this.pipWindow=await documentPictureInPicture.requestWindow({width:460,height:280,copyStyleSheets:!0}),this.pipWindow.document.body.style.margin="0";let e=[...this.playerParentShadowRoot.styleSheets].map((e=>[...e.cssRules].map((e=>e.cssText)).join(" "))).filter(Boolean).join("\n"),t=document.createElement("style");t.textContent=e;let i=this.createStretchedContainer(),r=i.attachShadow({mode:"open"});r.append(t),r.append(this.playerDomElement);let s={target:this.playerParentShadowRoot,context:this.svelteContext};this.playerDummyElement=zi(Kg,s),this.pipWindow?.document.body.append(i),this.info.isActive$.next(!0),this.pipWindow?.addEventListener("unload",(e=>{!this.playerDomElement||!this.playerParentShadowRoot||!this.playerDummyElement||(Qi(this.playerDummyElement),this.playerParentShadowRoot.append(this.playerDomElement),this.info.isActive$.next(!1),this.pipWindow=void 0)}))}async exit(){return new Promise((e=>{this.pipWindow&&documentPictureInPicture.window?.close(),e()}))}async dispose(){await this.exit()}setEnabled(e){this.info.isEnabled$.next(e)}createStretchedContainer(){let e=document.createElement("div");return e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e}constructor({enabled:e=!0}={enabled:!0}){this.info={isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1),type:1},this.info.isEnabled$=new m.ValueSubject(e)}};var Xg=class{static getLatestSupportedVersion(e){let t=new on(e),i=new Yg(e);return i.isSupported()?i:t.isSupported()?t:void 0}};function Jg(e,t){let i=new Set([...Object.keys(e),...Object.keys(t)]),r={};for(let s of i)r[s]=t[s]??e[s]??void 0;return r}var Zg=class extends Error{constructor(e){super(e),this.name="AnnotationError"}},ev=class{init(e){if(this.rootAnnotationsContainer=e,this.annotationsInside)return;let t=(0,m.throttleFn)((()=>{for(let e of this.annotations.values())this.isElementExceedsBoundaries(e,this.playerSize.width,this.playerSize.height)?e.style.visibility="hidden":e.style.visibility="visible"}),100);this.subscriptions.add((0,m.observeElementSize)(this.rootAnnotationsContainer).subscribe((({width:e,height:i})=>{this.playerSize={width:e,height:i},t()}))),this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(this.rootAnnotationsContainer,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}add(e,t){if(!this.rootAnnotationsContainer)throw new Zg("Inner error. Unexpectedly root annotation container null reference exception");if(this.annotations.has(e))throw new Zg("Annotation with such name already exists");t.style.zIndex=t.style.zIndex??"1",t.style.position="absolute",this.rootAnnotationsContainer.append(t),this.annotations.set(e,t)}get(e){let t=this.annotations.get(e);if(!t)throw new Zg("Annotation with such name does not exist");return t}remove(e){let t=this.get(e);this.annotations.delete(e)&&t.remove()}clear(){for(let e in this.annotations.keys())this.remove(e)}destroy(){this.annotations.clear(),this.subscriptions.unsubscribe(),this.mutationObserver?.disconnect(),this.rootAnnotationsContainer=null}isElementExceedsBoundaries(e,t,i){let r=e.offsetTop,s=e.offsetLeft,a=e.offsetWidth,n=e.offsetHeight;return r<0||s<0||s+a>t||r+n>i}registryRootContainer(e){}addLayer(e){return document.createElement("div")}getLayer(e){}removeLayer(e){}clearLayer(e){}detach(){}reattach(){}constructor(e){this.annotationsInside=e,this.annotations=new Map,this.subscriptions=new m.Subscription}},tv=class{init({store:e,microStores:t,interactiveController:i,config:r}){return(0,m.assertNonNullable)(e),(0,m.assertNonNullable)(t),(0,m.assertNonNullable)(r),r.interactiveData&&(0,m.assertNonNullable)(i),this.subscription=new m.Subscription,this.subscription}},iv=class extends tv{init(e){let t=super.init(e),{isInteractiveExpectation$:i}=e.store.state;return t.add(i.subscribe((e=>{this.state$.set(!!e||null)}))),t}constructor(){super(...arguments),this.stateName="fakeIsPlaying$",this.state$={...rs(null),toggle:()=>this.state$.update((e=>!e))}}},rv=class extends tv{init(e){let t=super.init(e),{microStores:i,store:r}=e,{fakeIsPlaying$:s}=i,{isInteractiveExpectation$:a,isPlaying$:n}=r.state,{controlsVisible:o,isMobile:l}=r.ui,u=as(l),d=()=>u&&as(o);return t.add(o.subscribe((e=>{if(!u)return;let t=as(s);as(n)?this.state$.set(e):null!==t&&this.state$.set(!t||e)}))),t.add(n.subscribe((e=>{this.state$.set(!e||d())}))),t.add(s.subscribe((e=>{if(null===e)return;let t=as(a);d()?this.state$.set(!0):t&&this.state$.set(!e)}))),t}constructor(){super(...arguments),this.stateName="interactiveControlsOpacity$",this.state$={...rs(null),toggle:()=>this.state$.update((e=>!e))}}},sv=class extends tv{init(e){let t=super.init(e),{store:i}=e;return t.add(i.state.interactiveEpisodes$.subscribe((e=>{e.length&&(e.every((e=>e.completed))?this.state$.set("tooltip_interactive_of_chapter_completed"):this.state$.set("tooltip_disabled_when_interactive"))}))),t}constructor(){super(...arguments),this.stateName="seekToInteractiveDisabledTooltip$",this.state$=rs("tooltip_chapter_without_interactive")}},av=rs(!1),nv=null,ov=class extends tv{init(e){let t=super.init(e),{store:i,config:r}=e,{isInteractiveTime$:s,isPlaying$:a}=i.state,n=i.ui.controlsVisible,{interactiveTimeIndicator:o}=i.ui.controls;t.add(n.subscribe((e=>{as(s)&&e&&this.state$.set(!1)})));let l=r?.interactiveData||{tooltipHelpHintActive:!1};return t.add((0,m.combine)({isPlaying$:a,isInteractiveTime$:s,interactiveTimeIndicator:o}).subscribe((({isPlaying$:e,isInteractiveTime$:t,interactiveTimeIndicator:r})=>{if(e&&r?.isDisplayed){if(!t)return this.state$.set(!1);l.tooltipHelpHintActive&&null===nv&&(nv=!0,l.tooltipHelpHintActive=!1,this.state$.set(!0),i.callbacks?.onInteractiveTimeIndicatorHintDeactivated?.())}}))),t}clearTimeout(){window.clearTimeout(this.timeout)}constructor(){super(...arguments),this.stateName="showInteractiveTimeIndicatorTooltip$",this.state$={...av,set:(e,t=!1)=>{e!==as(av)&&(this.clearTimeout(),av.set(e),!e&&nv&&(nv=!1),e&&t&&(this.timeout=setTimeout((()=>{this.state$.set(!1)}),3e3)))},clearTimeout:()=>this.clearTimeout()}}},lv=class extends tv{init(e){let t=super.init(e),{store:i,interactiveController:r}=e,s=i.ui.currentGridType$,a=i.getLogger().createComponentLog("GraphIsOpened microStore");return this.state$.toggle=async()=>{if(this.checkIfShouldHide(as(s)))return;let e=as(this.state$),{isEnded$:t,playbackState$:n}=i.state,{disabledControls$:o}=i.ui.controls,l=as(t),u=as(n);if(e)try{await(r?.toggleGraphView(!1)),this.state$.set(!1),o.remove(Ls),!l&&this.graphMadePause&&i.actions.internal.play()}catch{a({message:"Cant hide graph"})}else{this.graphMadePause="playing"===u;try{await(r?.toggleGraphView(!0)),this.state$.set(!0),o.add(Ls),!l&&this.graphMadePause&&i.actions.internal.pause()}catch{a({message:"Cant show graph"})}}},t.add((0,m.combine)({graphIsOpened:this.state$,currentGridType:s}).subscribe((async({graphIsOpened:e,currentGridType:t})=>{if(this.checkIfShouldHide(t)&&e)try{await(r?.toggleGraphView(!1)),this.state$.set(!1)}catch{a({message:"Cant hide graph"})}}))),t}constructor(){super(...arguments),this.stateName="graphIsOpened$",this.graphMadePause=!1,this.state$={...rs(null),toggle:m.noop},this.checkIfShouldHide=e=>Ou(e,"s")}},uv=class extends tv{init(e){let t=super.init(e),{store:i}=e,{info:{isActive$:r,isEnabled$:s,type:a}}=i.webApi.pictureInPictureApi||{info:{isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1)}};return t.add(r.subscribe((e=>{this.state$.isActive$.set(e)}))),t.add(s.subscribe((e=>{this.state$.isEnabled$.set(e)}))),this.state$.type$.set(a),t}constructor(){super(...arguments),this.stateName="pictureInPicture$",this.state$={isActive$:rs(!1),isEnabled$:rs(!1),type$:rs(void 0)}}},dv=({maxCount:e})=>{let t={};return{notificationShowed:e=>{t[e]=(t[e]??0)+1,m.safeStorage.set("videoplayer_notifications_manager_count",JSON.stringify(t[e]??0))},canShowNotification:i=>(t[i]??0)<e}},cv=({timeout:e})=>{let t="videoplayer_notifications_manager",i=()=>{try{return JSON.parse(m.safeStorage.get(t)||"{}")}catch{return{}}},r=e=>m.safeStorage.set(t,JSON.stringify(e));return{notificationShowed:t=>{r({...i(),[t]:{timeout:e,launchTime:Date.now()}})},canShowNotification:t=>{let s=i()[t];if(s){let a=Date.now()-s.launchTime>e;return a&&(e=>{let t=i();delete t[e],r(t)})(t),a}return!0}}},hv=class extends tv{init(e){let t=super.init(e),{store:i,uiConfig:{features:{maxCountShowSlowVideoNotification:r,timeoutShowSlowVideoNotification:s,showSlowVideoNotification:a,forceAutoQualityWhenSevereStallHappens:n}}}=e;this.notificationManager=(({maxShowCount:e,timeout:t})=>{let i=[0!==e?dv({maxCount:e}):void 0,0!==t?cv({timeout:t}):void 0].filter((e=>!!e));return{notificationShowed:e=>i.forEach((t=>t.notificationShowed(e))),canShowNotification:e=>i.every((t=>t.canShowNotification(e)))}})({maxShowCount:r,timeout:s});let o=i.getPlayer();return t.add(o.events.severeStallOccured$.pipe((0,m.filterChanged)(),(0,m.filter)((e=>e))).subscribe((()=>{a&&!o.info.isAutoQualityEnabled$.getValue()&&this.notificationManager.canShowNotification("slow_video")&&(n&&i.actions.internal.setQuality("auto"),this.state$.showNotification("slow_video"))}))),t}constructor(){super(...arguments),this.stateName="notifications$",this.state$={notificationsToShow$:rs({}),showNotification:e=>{this.state$.notificationsToShow$.update((t=>(t[e]=!0,t))),this.notificationManager.notificationShowed(e)},closeNotification:e=>{this.state$.notificationsToShow$.update((t=>(delete t[e],t)))}}}},pv=class{activate(){this.isActive||(document.addEventListener("keydown",this.handleTabKey),this.isActive=!0)}deactivate(){this.isActive&&(document.removeEventListener("keydown",this.handleTabKey),this.isActive=!1,this.focusableElements=[])}updateFocusableElements(){this.isActive&&(this.focusableElements=this.getFocusableElements())}getFocusableElements(){let e=["button:not([disabled])","[href]:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(", ");return Array.from(this.container.querySelectorAll(e)).filter((e=>!e.disabled&&null!==e.offsetParent))}destroy(){this.deactivate()}setContainer(e){this.container=e}constructor(e){this.getActiveElement=e,this.focusableElements=[],this.isActive=!1,this.handleTabKey=e=>{if(this.updateFocusableElements(),!this.focusableElements.length)return;let t=this.focusableElements[0],i=this.focusableElements[this.focusableElements.length-1],r=this.getActiveElement();e.shiftKey&&r===t?(e.preventDefault(),i.focus()):!e.shiftKey&&r===i&&(e.preventDefault(),t.focus())}}},fv=class{destroy(){this.shadowRoot.removeEventListener("focusin",this.handleFocusChange),this.focusLock.destroy()}getLastFocusedNode(){return this.lastFocusedNode}activateLock(){this.focusLock.activate()}deactivateLock(){this.focusLock.deactivate()}setContainerForFocusLock(e){this.focusLock.setContainer(e)}constructor(e){this.shadowRoot=e,this.lastFocusedNode=null,this.init=()=>{this.shadowRoot.addEventListener("focusin",this.handleFocusChange)},this.handleFocusChange=()=>{this.lastFocusedNode=this.shadowRoot.activeElement},this.restoreFocus=()=>{this.lastFocusedNode?.focus()},this.focusLock=new pv((()=>this.lastFocusedNode)),this.init()}},mv=Ti('<div class="root s-2"><!></div>'),gv={hash:"s-2",code:".root.s-2{align-items:center;display:flex;inset:0;justify-content:center;pointer-events:none;position:absolute;z-index:1}"};function vv(e,t){re(t,!0),fr(e,gv);let i=null,r=ke(null);rt((()=>(ui(r)&&(i=window.setTimeout((()=>{_e(r,null)}),t.animationDuration)),()=>{i&&clearTimeout(i)})));var s=Ei(),a=Xe(s),n=e=>{var i=Ei();Zi(Xe(i),(()=>ui(r)),(e=>{var i=mv(),s=Ye(i);let a=fe((()=>"prev"===ui(r)));Bm(s,{get duration(){return t.animationDuration},get Icon(){return ic},get reversed(){return ui(a)}}),ze(i),Ai(e,i)})),Ai(e,i)};return Ji(a,(e=>{t.playbackStatusShow&&ui(r)&&e(n)})),Ai(e,s),se({startVideoChangedAnimation:function(e){t.playbackStatusShow&&_e(r,e?"prev":"next",!0)}})}var bv={preload:!0,autoplay:!1,repeat:!1,loop:!1,fromTime:0,canRewindLive:!0,showAds:!1,interfaceLanguage:m.InterfaceLanguage.RU,isCyrillicRelatedInterface:!0,logoClickable:!1,logoHidden:!1,isTouch:(0,f.isMobile)(),isMediaSessionEnabled:!0,isPictureInPictureEnabled:!0,isAudioDisabled:!1,callbacks:{uiInfo:{}},tuningConfig:{configName:[]},saveRate:!0,volumeMultiplier:1,showEndScreen:!0,showAutoplayNext:!0,showNextPrevButtons:!0},yv=ke(void 0),Sv=le({animationDuration:0,playbackStatusShow:!1}),wv=class extends HTMLElement{connectedCallback(){if(this.rootContainer)return;this.initPlayerRootContainers();let e=le({title:this.getAttribute("stub-title")??void 0,thumbUrl:this.getAttribute("stub-thumb-url")??void 0}),t={target:this.playerContainer,props:e};this.svelteStubComponent=zi(jg,t),this.sveltePersistentLayerComponent=zi(vv,{target:this.playerContainer,props:Sv}),this.postponedInitParams&&(this.initPlayer(...this.postponedInitParams),this.postponedInitParams=null)}updatePersistentLayerProps(){if(!this.uiConfig)return;let{playbackStatusNextVideoAnimationDuration:e,features:{playbackStatusShow:t,playbackStatusNextVideoShow:i}}=this.uiConfig;Sv.animationDuration=e,Sv.playbackStatusShow=t&&i}disconnectedCallback(){this.shadowDOMCallbacksDisabled||(this.annotationsApi?.destroy(),this.slotsApi?.destroy(),this.focusManager?.destroy(),this.mediaSessionApi?.destroy(),this.unmountComponent(this.svelteRootComponent),this.unmountComponent(this.svelteStubComponent),this.unmountComponent(this.svelteErrorComponent),this.unmountComponent(this.sveltePersistentLayerComponent),this.subscription.unsubscribe(),this.unsubscribePlayerPhaseSubscription?.(),this.interactiveController?.destroy(),this.interactiveSubscription.unsubscribe(),this.internalsExposure?.destroy(),m.devNull.destroy("ui"))}initPlayerRootContainers(){this.rootContainer=document.createElement("div"),this.rootContainer.style.position="relative",this.rootContainer.className="root-container",this.rootContainer.style.width="100%",this.rootContainer.style.height="100%",this.rootContainer.style.minHeight="206px",this.shadowRootContainer=document.createElement("div"),this.shadowRootContainer.style.position="absolute",this.shadowRootContainer.className="shadow-root-container",this.shadowRootContainer.style.width="100%",this.shadowRootContainer.style.height="100%",this._shadowRoot=this.shadowRootContainer.attachShadow({mode:"open"}),this.playerContainer=document.createElement("div"),this.playerContainer.style.all="initial",this.playerContainer.style.display="block",this.playerContainer.style.contain="strict",this.playerContainer.style.width="100%",this.playerContainer.style.height="100%",this._shadowRoot.append(this.playerContainer),this.rootContainer.append(this.shadowRootContainer),this.stateContainer=document.createElement("div"),this.stateContainer.className="state-container",this.stateContainer.style.width="1px",this.stateContainer.style.height="1px",this.stateContainer.style.position="absolute",this.stateContainer.style.backgroundColor="transparent",this.stateContainer.style.left="-100000px",this.append(this.rootContainer),this.append(this.stateContainer)}needToShowNextPrevButtons(){return!!this.videoConfig&&(this.videoConfig.videos.length>1&&this.videoConfig.showNextPrevButtons)}isNextButtonActive(){return!!this.videoConfig&&(this.needToShowNextPrevButtons()&&(this.currentPlayingVideoIndex<this.videoConfig.videos.length-1||this.needToRepeatPlaylist))}isPrevButtonActive(){return!!this.videoConfig&&(this.needToShowNextPrevButtons()&&(this.currentPlayingVideoIndex>0||this.needToRepeatPlaylist))}isControlDisabled(e){return this.store?.ui.controls.disabledControls$?.includes(e)||!1}getNextVideoInfo(){if(!this.videoConfig)return{nextVideoTitle:void 0,nextVideoThumb:void 0};let e=this.videoConfig.videos[this.currentPlayingVideoIndex+1]||{};return{nextVideoTitle:e.title,nextVideoThumb:e.thumbUrl}}createThinOneStat(e,t={}){if(!this.videoConfig)return;let{deviceId:i,preload:r,refreshStatAuthToken:s}=Jg(this.videoConfig,t),{unitedVideoId:a}=e;return this.uiConfig.features.thinStatistics&&a?new g.ThinOneStat.ThinOneStat({deviceId:i,movieId:a,preload:r,isPreviewPlayerView:"preview"===this.videoConfig.playerView},{config:this.statisticsConfig,refreshAuthToken:s}):void 0}createPlayer(e,t={},i){if(!this.videoConfig)return;let{albumId:r,statPlace:s,statAuthToken:a,preload:n,autoplay:o,volume:l,muted:u,fromTime:d,canRewindLive:c,supportLink:h,showAds:p,adsSlotId:v,adsParams:b={},adsAutoplayParam:y,interfaceLanguage:S,isCyrillicRelatedInterface:w,logoClickable:$,logoHidden:x,isMobile:k,isTouch:T,isAudioDisabled:_,isLiveCatchUpMode:C,fullScreenTarget:E,failoverHosts:A,canDownload:L,callbacks:P,interactiveData:M,showThumbTimer:I,additionalButtons:R=[],additionalSettingsMenuItems:V=[],additionalContextMenuItems:N=[],repeat:B,loop:D,saveRate:O,volumeMultiplier:F,showEndScreen:j,showAutoplayNext:z,mediascopePixels:q}=Jg(this.videoConfig,t),{sources:H,title:U,thumbUrl:W,unitedVideoId:Q,isClip:G=!1,duration:K,adsParams:Y={},videoEpisodes:X,previewThumbsData:J,subtitles:Z,subtitlesForcedLanguage:ee,live:te,adsExternalApi:ie}=e;if(!H&&!te){let e=new Error("empty sources and live");return this.fatalError$.next(e),void P.onCrashed?.(e.message)}let re={...b,...Y},se=this.getNextVideoInfo(),ae={sources:H,title:U,thumbUrl:W,subtitles:Z,subtitlesForcedLanguage:ee,unitedVideoId:Q,isClip:G,live:te,albumId:r,statPlace:s,autoplay:o,muted:u,volume:l,fromTime:d,canRewindLive:c,showAds:p,adsSlotId:v,adsParams:re,adsAutoplayParam:y,duration:K,logoClickable:$,logoHidden:x,isTouch:T??k,repeat:B,loop:D,showNextPrevButtons:this.needToShowNextPrevButtons(),nextButtonActive:this.isNextButtonActive(),prevButtonActive:this.isPrevButtonActive(),endScreenVideoTitle:se.nextVideoTitle,endScreenVideoThumb:se.nextVideoThumb,isOneVideoPlaylist:this.isOneVideoPlaylist()},ne={pictureInPictureApi:this.pictureInPictureApi,annotationsApi:this.annotationsApi,slotsApi:this.slotsApi,focusManager:this.focusManager};this.log({message:`create player, props: ${JSON.stringify(ae)}`});let oe,le=this.interactiveController?.state.statistics$.getValue(),ue=le?.oneStat||this.createOneStat(e,t),de=this.createThinOneStat(e,t);q&&(oe=new g.MediascopePixel({pixels:q})),(ue||de)&&(this.statistics=new Cd(ue,de,oe,le?.statSubscription)),this.uiConfig.features.sentry&&this.uiConfig.sentry.dsn&&new Ja(this.uiConfig.sentry,{version:Vs,env:Rs},{movieId:Q,albumId:r,place:s,autoplay:(o&&!this.interactiveController)??!1,mobile:T??k,clip:G}),this.interactiveController&&(this.prevIsid??(this.prevIsid=this.statistics?.oneStat?.isid$.getValue())),this.sentry={...this.sentry,...Ja.getInstance()};let ce=!!M,he=[],pe="tooltip_interactive_go_back_disabled_first";if(ce&&this.interactiveController){let e=this.interactiveController.state.isInitialChapter$.getValue(),t=this.interactiveController.getHistoryState();e&&he.push("REPLAY_BUTTON"),this.interactiveController.getIsSeekable().getValue()||he.push("SEEK_TO_INTERACTIVE_BUTTON"),t.hasPrevChapter$.getValue()||(he.push("PLAY_PREV_CHAPTER_BUTTON"),e||(pe=t.isGoBackLimited$.getValue()?"tooltip_interactive_go_back_disabled_limit":"tooltip_interactive_go_back_disabled"))}let fe=B&&1===this.videoConfig.videos.length;this.store=Rd({player:i,interfaceLanguage:S,isCyrillicRelatedInterface:w,videoId:Q,isClip:G,isLiveCatchUpMode:C,isAudioDisabled:_,statAuthToken:a,callbacks:P,webApi:ne,videoEpisodes:X,previewThumbsData:J,canDownload:L,uiConfig:this.uiConfig,coreConfig:this.coreConfig,disabledControls:he,isInteractive:ce,saveRate:O,interactiveRanges$:this.interactiveController?.state.interactiveRanges$,isInteractiveTime$:this.interactiveController?.state.isInteractiveTime$,stopPlayer:()=>this.stop(),replayInteractive:()=>{this.isInited=!1,this.prevIsid=void 0;let e=i?.info.isEnded$.getValue()&&this.interactiveController?.state.isEndChapter$.getValue();P.onReplayInteractiveVideo&&!e?P.onReplayInteractiveVideo():this.replayInteractiveVideo()},playPrevChapterDisabledTooltip:pe,hasInteractiveBranches:!!this.interactiveController?.getChapterBranches()?.length,additionalButtons:this.uiConfig.features.additionalButtons?R:[],additionalSettingsMenuItems:V??[],additionalContextMenuItems:N??[],playPrevVideo:()=>this.playPrevVideo(),playNextVideo:()=>this.playNextVideo(),onVideoChanged:e=>this.sveltePersistentLayerComponent?.startVideoChangedAnimation(e),looped:this.uiConfig.features.useLoopSetting?D:fe,statistics:this.statistics,internalsExposure:this.internalsExposure,playerView:this.videoConfig.playerView,playerId:this.playerId});let{stores:me}=this.microStoresRoot=[iv,rv,sv,ov,lv,uv,hv].reduce((({subscribers:e,stores:t},i)=>{let r=new i;return{subscribers:[...e,r],stores:{...t,[r.stateName]:r.state$}}}),{subscribers:[],stores:{}}),ge=()=>{if(!this.store||!this.microStoresRoot||!this.videoConfig)return;this.subscription.add(this.store.state.currentFormat$.subscribe((e=>P?.onCurrentFormatChanged?.(e)))),this.subscription.add(me.interactiveControlsOpacity$.subscribe((e=>{null!==e&&this?.interactiveController?.setDisabledControls(e)}))),this.subscription.add(this.store.state.throughputEstimation$.subscribe((e=>P?.onThroughputEstimationChanged?.(e)))),this.subscription.add(this.store.state.trafficSavingEnabled$.subscribe((e=>P?.onTrafficSavingEnabledChanged?.(e)))),this.subscription.add(this.store.state.highQualityEnabled$.subscribe((e=>P?.onHighQualityEnabledChanged?.(e)))),this.subscription.add(this.store.state.isAutoQualityEnabled$.subscribe((e=>P?.onAutoQualityEnabledChanged?.(!!e)))),this.subscription.add(new m.Observable((e=>{this.store&&this.subscription.add(this.store.state.currentPlaybackRate$.subscribe((t=>e.next(t))))})).pipe((0,m.skip)(1)).subscribe((e=>P?.onCurrentPlaybackRateChanged?.(e)))),this.subscription.add(this.store.state.volume$.subscribe((e=>P?.onVolumeChange?.(e)))),this.subscription.add(this.store.state.muted$.subscribe((e=>{if(e)P?.onMute?.();else{let e=(this.store?.state.volume$&&as(this.store.state.volume$))??0;P?.onUnmute?.(e)}}))),this.subscription.add(this.store.state.videoBitrate$.subscribe((e=>P?.onVideoBitrateChanged?.(e)))),this.subscription.add(this.store.state.isInteractiveTime$.subscribe((e=>{let t=this.store?.ui.controls.disabledControls$;t&&(e&&!t.includes(As)&&t.add(As),e||t.remove(As))}))),this.subscription.add(this.store.ui.isFullscreen.subscribe((async e=>{f.clientChecker.browser.isSamsungBrowser&&e&&this.interactiveController&&document.fullscreenElement===this.shadowRootContainer&&await this.replayInteractiveChapter(this.videoConfig?.callbacks.onExternalFullscreenExit)}))),this.statistics&&this.statistics.oneStat&&this.subscription.add(this.statistics.oneStat.vsid$.subscribe((e=>P?.onVSIDChanged?.(e)))),this.initMediaSession(),_e(yv,{interactiveController:this.interactiveController,interactiveContainer:this.interactiveContainer,sources:H,store:this.store,microStoresRoot:this.microStoresRoot,videoConfig:this.videoConfig,uiConfig:this.uiConfig,title:U,thumbUrl:W,subtitles:Z,subtitlesForcedLanguage:ee,live:te,preload:n,autoplay:o,muted:u,volume:l,fromTime:d,canRewindLive:c,supportLink:h,showAds:p,adsSlotId:v,adsParams:re,adsAutoplayParam:y,duration:K,logoClickable:$,logoHidden:x,isMobile:T??k,failoverHosts:A,fullScreenTarget:E,saveRate:O,shadowRootContainer:this.shadowRootContainer,showMiniTimer:I,outerContainerRef:this.rootContainer,showNextPrevButtons:this.needToShowNextPrevButtons(),nextButtonActive:this.isNextButtonActive(),prevButtonActive:this.isPrevButtonActive(),endScreenVideoTitle:se.nextVideoTitle,endScreenVideoThumb:se.nextVideoThumb,isOneVideoPlaylist:this.isOneVideoPlaylist(),playPrevChapter:()=>this.playPrevChapter(),seekToInteractive:()=>this.seekToInteractive(),volumeMultiplier:F,showEndScreen:j,showAutoplayNext:z,adsExternalApi:ie,getVideoDeeplink:this.videoConfig.getVideoDeeplink},!0);let e={target:this.playerContainer,props:ui(yv)};this.svelteRootComponent=zi(Ng,e),this.addPlayerInfoSubscriptions(),this.isInited||(this.isInited=!0,this.videoConfig?.callbacks?.onInited?.()),this.internalsExposure?.expose({player:this,videoConfig:this.videoConfig,coreConfig:this.coreConfig,uiConfig:this.uiConfig,statisticsConfig:this.statisticsConfig,logger:this.logger,log:this.log}),this.uiConfig.devNullLog&&this.videoConfig?.callbacks?.onDevNullLog?m.devNull.subscribe("ui",this.videoConfig.callbacks.onDevNullLog):m.devNull.destroy("ui")};this.coreConfig.asyncResolveClientChecker?f.clientChecker.isInited$.subscribe((e=>{e&&(console.log("UI SDK async start"),ge())})):ge()}addPlayerInfoSubscriptions(){let e=this.store,t=this.microStoresRoot?.stores;if(!e||!t)return;let i=this.videoConfig?.callbacks;i&&this.subscription.add(e.playerPhase.subscribe((e=>i.onPlayerPhaseChanged?.(e)))).add(e.state.playbackState$.subscribe((e=>e&&i.onPlaybackStateChanged?.(e)))).add(e.state.playbackStateRealistic$.subscribe((e=>{e?this.stateContainer.setAttribute("data-playback-state",e):this.stateContainer.removeAttribute("data-playback-state")}))).add(e.state.isLive$.subscribe((e=>i.onIsLiveChanged?.(e)))).add(e.state.isActiveLive$.subscribe((e=>i.onIsActiveLiveChanged?.(e)))).add(e.state.isAudioAvailable$.subscribe((e=>i.onIsAudioAvailableChanged?.(e)))).add(e.state.currentQuality$.subscribe((e=>i.onCurrentQualityChanged?.(e)))).add(e.state.availableQualities$.subscribe((e=>i.onAvailableQualitiesChanged?.(e.map((({value:e})=>e)).filter((e=>"auto"!==e)))))).add(e.state.availableAudioStreams$.subscribe((e=>{e.length>1&&i.onAudioLanguagesAvailable&&i.onAudioLanguagesAvailable()}))).add(t.pictureInPicture$.isActive$.subscribe((e=>e?i.onPiPEnter?.():i.onPiPExit?.())));let r=i?.uiInfo;r&&this.subscription.add(e.ui.controlsVisible.subscribe((e=>r.onControlsVisibleChanged?.(e)))).add(e.ui.isMobile.subscribe((e=>r.onIsMobileChanged?.(e)))).add(e.ui.playerSize.subscribe((e=>r.onPlayerSizeChanged?.(e)))).add(e.ui.controls.prevButton.subscribe((e=>r.onPrevButtonChanged?.(e)))).add(e.ui.controls.playButton.subscribe((e=>r.onPlayButtonChanged?.(e)))).add(e.ui.controls.replayButton.subscribe((e=>r.onReplayButtonChanged?.(e)))).add(e.ui.controls.nextButton.subscribe((e=>r.onNextButtonChanged?.(e)))).add(e.ui.controls.playPrevChapterButton.subscribe((e=>r.onPlayPrevChapterChanged?.(e)))).add(e.ui.controls.seekToInteractiveButton.subscribe((e=>r.onSeekToInteractiveButtonChanged?.(e)))).add(e.ui.controls.interactiveGraphButton.subscribe((e=>r.onGraphButtonChanged?.(e)))).add(e.ui.controls.liveButton.subscribe((e=>r.onLiveButtonChanged?.(e)))).add(e.ui.controls.time.subscribe((e=>r.onTimeUpdateChanged?.(e)))).add(e.ui.controls.episodes.subscribe((e=>r.onEpisodesChanged?.(e)))).add(e.ui.controls.subtitles.subscribe((e=>r.onSubtitlesChanged?.(e)))).add(e.ui.controlBlocks.topLeft.subscribe((e=>r.onTopLeftControlBlockChanged?.(e)))).add(e.ui.controlBlocks.topRight.subscribe((e=>r.onTopRightControlBlockChanged?.(e)))).add(e.ui.controlBlocks.bottomLeft.subscribe((e=>r.onBottomLeftControlBlockChanged?.(e)))).add(e.ui.controlBlocks.bottomRight.subscribe((e=>r.onBottomRightControlBlockChanged?.(e)))).add(e.ui.controlBlocks.middle.subscribe((e=>r.onMiddleControlBlockChanged?.(e)))).add(e.ui.controlBlocks.bottom.subscribe((e=>r.onBottomControlBlockChanged?.(e)))).add(e.ui.videoTitleInfo.subscribe((e=>r.onTitleChanged?.(e)))).add(e.ui.controls.settings.subscribe((e=>r.onSettingsChanged?.(e)))).add(e.ui.controls.fullscreen.subscribe((e=>r.onFullscreenChanged?.(e)))).add(e.ui.controls.chromecast.subscribe((e=>r.onChromecastChanged?.(e)))).add(e.ui.controls.pip.subscribe((e=>r.onPipChanged?.(e)))).add(e.ui.controls.vkLogo.subscribe((e=>r.onVkLogoChanged?.(e)))).add(e.ui.controls.interactiveTimeIndicator.subscribe((e=>r.onInteractiveTimeIndicatorChanged?.(e)))).add(e.ui.controls.timeline.subscribe((e=>r.onTimelineChanged?.(e))))}playNextVideo(){this.videoConfig&&(this.currentPlayingVideoIndex++,this.currentPlayingVideoIndex>=this.videoConfig.videos.length&&(this.currentPlayingVideoIndex=0),this.log({message:`play next video, index: ${this.currentPlayingVideoIndex}`}),this.createPlayerWithCurrentVideo())}playPrevVideo(){this.videoConfig&&(this.currentPlayingVideoIndex--,this.currentPlayingVideoIndex<0&&(this.currentPlayingVideoIndex=this.videoConfig.videos.length-1),this.log({message:`play prev video, index: ${this.currentPlayingVideoIndex}`}),this.createPlayerWithCurrentVideo())}createPlayerWithCurrentVideo(e,t=!0){if(!this.videoConfig)return;let i=this.videoConfig.videos[this.currentPlayingVideoIndex];i?(this.isInited&&(0,m.isNonNullable)(i.unitedVideoId)&&this.store?.actions.internal.nextMovie(i.unitedVideoId),this.unmountComponent(this.svelteRootComponent),this.createPlayer(i,{autoplay:t,fromTime:0},e)):this.log({message:"no next video"})}playPrevChapter(){this.interactiveController?.playPrevChapter()}seekToInteractive(){let e=this.interactiveController?.getNextInteractiveStartTime();"number"==typeof e&&this.seekTime(e/1e3)}async initInteractives(){if(this.videoConfig?.interactiveData)try{let{Interactives:e}=await Promise.all([i.e(17356),i.e(18562),i.e("langs/web/17356+18562")]).then(i.bind(i,34414));this.interactiveContainer=document.createElement("div"),this.interactiveContainer.classList.add("interactive-root");let t=this.store?.interfaceLanguage$,r=t?as(t):this.videoConfig.interfaceLanguage,{projectInfo:s,initChapterId:a,historyApi:n,videoLoader:o}=this.videoConfig.interactiveData;this.interactiveController=new e({parentElement:this.interactiveContainer,fullscreenTargetElement:this.playerContainer,lang:r,graph:this.uiConfig.features.interactiveGraph,projectInfo:s,initChapterId:a,historyApi:n,vkVideoLoader:o,lastFrame:this.uiConfig.features.interactiveLastFrame,permanentTextControls:this.uiConfig.features.interactiveTextPermanent,interactiveTimeOpenUri:this.uiConfig.features.interactiveTimeOpenUri,initSeamless:!0,config:this.uiConfig.interactive,coreConfig:this.coreConfig,createOneStat:this.createOneStat,isTouch:this.videoConfig.isTouch,animationsFeatureToggles:{areaControlShadow:this.uiConfig.features.interactiveAreaControlShadow,controlsExpectTimeBlinkAnimation:this.uiConfig.features.interactiveControlsExpectTimeBlinkAnimation,controlsTapPlace:this.uiConfig.features.interactiveControlsTapPlace,controlsFillAnimation:this.uiConfig.features.interactiveControlsFillAnimation,controlsHideAnimation:this.uiConfig.features.interactiveControlsHideAnimation},endChapterHistoryFix:this.uiConfig.features.interactiveHistoryEndChapterFix});let{isInteractiveExpectation$:l,isSeekable$:u}=this.interactiveController.state;this.uiConfig.features.seekToInteractive&&this.subscription.add(u.subscribe((e=>{if(!this.isInited)return;let t=this.store;e?t.ui.controls.disabledControls$.remove("SEEK_TO_INTERACTIVE_BUTTON"):t.ui.controls.disabledControls$.add("SEEK_TO_INTERACTIVE_BUTTON")}))),this.subscription.add(l.subscribe((e=>{this.store&&this.store.state.isInteractiveExpectation$.set(e)})));let d=!0;if(this.subscription.add(this.interactiveController.events.playerChanged$.subscribe((e=>{if(!this.videoConfig)return;this.videoConfig.videos[this.currentPlayingVideoIndex]={...e.config,title:s?.title||e.config.title};let t=!d||this.videoConfig.autoplay;this.createPlayerWithCurrentVideo(e.player,t),d&&(d=!1)}))),this.interactiveSubscription.add(this.interactiveController.events.interactiveActionChoice$.subscribe((({type:e,actionType:t})=>{if(!this.store||!this.microStoresRoot)return;let i=l.getValue();if("action-choice"===e&&"setRandomBranch"===t&&(this.microStoresRoot.stores.graphIsOpened$.set(!1),this.store.ui.controls.disabledControls$.remove(Ps)),"action-choice-canceled"===e){let e=as(this.store.state.isPlaying$)||i;if((this.videoConfig?.isTouch??this.videoConfig?.isMobile)&&e)return void this.store.ui.interactiveHideMobileControls.set(!0);this.videoConfig?.callbacks.onDisabledInteractiveClick?.()}}))),this.interactiveSubscription.add(this.interactiveController.events.interactiveContainerFakeRemoved$.subscribe((({type:e,removeAllOpenURI:t})=>{this.store&&"container-fake-removed"===e&&t&&this.store.ui.controls.disabledControls$.remove(Ps)}))),await this.interactiveController.setManifest(this.videoConfig.interactiveData.manifest),this.videoConfig?.callbacks?.onInteractiveHistoryChanged){let e=this.interactiveController.getHistoryState();this.subscription.add(e.history$.subscribe((e=>{e.length&&this.videoConfig?.callbacks?.onInteractiveHistoryChanged?.(e)})))}this.videoConfig?.callbacks?.onInteractiveChapterChanged&&this.subscription.add(this.interactiveController.events.chapterChanged$.subscribe((e=>{this.videoConfig?.callbacks.onInteractiveChapterChanged?.(e.chapter,e.manifestVideo)}))),this.uiConfig.features.interactiveTimeIndicator&&this.subscription.add(this.interactiveController.events.noInteraction$.subscribe((()=>{this.microStoresRoot?.stores.showInteractiveTimeIndicatorTooltip$.set(!0,!0),this.videoConfig?.callbacks.onInteractiveTimeIndicatorClick?.()}))),this.interactiveSubscription.add(this.interactiveController.events.error$.subscribe((e=>{this.log({message:e.toString()})})))}catch(e){this.log({message:e.message})}}initPlayer(e,t={}){var i,r;if(this.isConnected){if(!Array.isArray(e.videos)||0===e.videos.length&&!e.interactiveData){let t=new Error("empty videos");return this.fatalError$.next(t),void e.callbacks?.onCrashed?.(t.message)}if(this.fatalError$.next(null),this.videoConfig=Jg(bv,(0,m.cloneDeepWith)(e,(e=>e instanceof HTMLElement?e:void 0))),this.playerId=(0,m.getPlayerId)(e.playerId),this.uiConfig=(e=>(0,m.fillWithDefault)(e,bs))(t.ui??{}),this.updatePersistentLayerProps(),this.coreConfig=t.core??{configName:[]},this.statisticsConfig=t.statistics??{},this.uiConfig.features.forcePlayerDisplayBlock&&(this.rootContainer&&(this.rootContainer.style.minHeight="unset"),this.style.display="block",this.style.width="100%",this.style.height="100%"),"preview"===this.videoConfig.playerView&&(this.playerContainer.style.contain="none"),this.sentry={config:this.uiConfig.sentry??{}},this.uiConfig.features.exposeInternalsToGlobal&&(this.internalsExposure??(this.internalsExposure=new m.InternalsExposure("ui",this.playerId))),m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","player_init_player","ads.enable: "+this.uiConfig.ads.enable,"showAds: "+this.videoConfig?.showAds],numbers:[(0,m.now)()]}),(0,m.isNonNullable)(this.videoConfig.isMediaSessionEnabled)&&(this.uiConfig.features.mediaSession=this.uiConfig.features.mediaSession??this.videoConfig.isMediaSessionEnabled??!0),(0,m.isNonNullable)(this.videoConfig.isPictureInPictureEnabled)&&(this.uiConfig.features.pip=this.uiConfig.features.pip??this.videoConfig.isPictureInPictureEnabled??!0,this.uiConfig.features.dpip=this.uiConfig.features.dpip??this.videoConfig.isPictureInPictureEnabled??!0),this.uiConfig.ads.paramsOverride={preview:this.uiConfig.ads.preview??this.videoConfig.adsPreviewParam,...this.uiConfig.ads.paramsOverride},this.videoConfig.isTouch=this.uiConfig.isMobile??this.videoConfig.isTouch??this.videoConfig.isMobile,(i=this.videoConfig).autoplay&&(i.autoplay=this.uiConfig.features.autoplay),this.videoConfig.showAds=this.uiConfig.ads.enable??this.videoConfig.showAds,this.videoConfig.adsSlotId=this.uiConfig.ads.slot??this.videoConfig.adsSlotId,this.videoConfig.logoHidden=!(this.uiConfig.showLogo??!this.videoConfig.logoHidden),(r=this.videoConfig).canRewindLive&&(r.canRewindLive=this.uiConfig.features.liveRewind),this.videoConfig.supportLink=this.videoConfig.supportLink??this.uiConfig.supportLink,this.videoConfig.showEndScreen=this.uiConfig.features.endScreen&&this.videoConfig.showEndScreen,this.videoConfig.showAutoplayNext=this.uiConfig.features.autoplayNext&&this.videoConfig.showAutoplayNext,this.videoConfig.showNextPrevButtons=this.uiConfig.features.nextPrevButtons&&this.videoConfig.showNextPrevButtons,this.currentPlayingVideoIndex=this.videoConfig.videoIndex&&this.videoConfig.videos?.[this.videoConfig.videoIndex]?this.videoConfig.videoIndex:0,this.needToRepeatPlaylist=this.videoConfig.repeat,this.uiConfig.features.pip){let e={enabled:this.videoConfig.pipEnabled};this.uiConfig.features.dpip?this.pictureInPictureApi=Xg.getLatestSupportedVersion(e):this.pictureInPictureApi=new on(e)}this.mediaSessionApi=this.uiConfig.features.mediaSession?new Ug:void 0,this.slotsApi=this.uiConfig.features.slots?new Rm:void 0,this.annotationsApi=this.uiConfig.features.annotations?new ev(this.uiConfig.features.annotationsInside):void 0,this.annotationsApi&&!this.uiConfig.features.annotationsInside&&this.annotationsApi.init(this.rootContainer),this.focusManager=this._shadowRoot?new fv(this._shadowRoot):void 0,this.unmountComponent(this.svelteStubComponent),this.unmountComponent(this.svelteRootComponent),this.unmountComponent(this.svelteErrorComponent),this.isInited=!1,this.prevIsid=void 0,this.interactiveController&&(this.interactiveController.destroy(),this.interactiveController=void 0,this.interactiveSubscription.unsubscribe()),this.videoConfig.interactiveData?this.initInteractives():this.createPlayer(this.videoConfig.videos[this.currentPlayingVideoIndex]),function(e){return e instanceof Yg}(this.pictureInPictureApi)&&this.pictureInPictureApi.setPlayerDomElement(this.playerContainer,this._shadowRoot),this.slotsApi?.init(this.shadowRootContainer,this.store)}else this.postponedInitParams=[e,t]}isOneVideoPlaylist(){return!!this.videoConfig&&1===this.videoConfig.videos.length}updateVideos(e,t){if(!this.videoConfig)return;this.log({message:`update ${t} videos, videos: ${JSON.stringify(e)}`}),"prev"===t?(this.videoConfig.videos.splice(0,this.currentPlayingVideoIndex),this.videoConfig.videos.unshift(...e),this.currentPlayingVideoIndex=e.length):"next"===t&&(this.videoConfig.videos.splice(this.currentPlayingVideoIndex+1),this.videoConfig.videos.push(...e));let i=this.getNextVideoInfo();ui(yv)&&(ui(yv).showNextPrevButtons=this.needToShowNextPrevButtons(),ui(yv).nextButtonActive=this.isNextButtonActive(),ui(yv).prevButtonActive=this.isPrevButtonActive(),ui(yv).endScreenVideoTitle=i.nextVideoTitle,ui(yv).endScreenVideoThumb=i.nextVideoThumb,ui(yv).isOneVideoPlaylist=this.isOneVideoPlaylist())}updatePrevVideos(e){this.updateVideos(e,"prev")}updateNextVideos(e){this.updateVideos(e,"next")}initMediaSession(){this.mediaSessionApi&&(this.unsubscribePlayerPhaseSubscription?.(),this.mediaSessionApi.clearSubscriptions(),this.unsubscribePlayerPhaseSubscription=this.store?.playerPhase.subscribe((e=>{"video"===e?this.setupMediaSessionForVideo():"ads"===e&&this.setupMediaSessionForAds()})))}setupMediaSessionForVideo(){if(this.videoConfig&&this.mediaSessionApi)try{let{title:e,thumbUrl:t}={...this.videoConfig.videos[this.currentPlayingVideoIndex]},i=[["play",()=>this.play()],["pause",()=>this.pause()],["seekto",e=>this.seekTime(e.seekTime)]];this.videoConfig.videos.length>1&&(this.currentPlayingVideoIndex<this.videoConfig.videos.length-1&&i.push(["nexttrack",()=>{if(this.uiConfig.features.useCallbackForMediaSessionNextPrevClick)try{this.videoConfig?.callbacks?.onNextVideoClick?.()}catch{this.log({message:"onNextVideoClick callback failed to execute"})}else this.playNextVideo()}]),this.currentPlayingVideoIndex>0&&i.push(["previoustrack",()=>{if(this.uiConfig.features.useCallbackForMediaSessionNextPrevClick)try{this.videoConfig?.callbacks?.onPrevVideoClick?.()}catch{this.log({message:"onPrevVideoClick callback failed to execute"})}else this.playPrevVideo()}])),this.mediaSessionApi.setMetaData({title:e,thumbUrl:t}),this.mediaSessionApi.updateActionHandlers(i),this.mediaSessionApi.attachToStore(this.store)}catch(e){this.log({message:e.message})}}setupMediaSessionForAds(){if(this.videoConfig&&this.mediaSessionApi)try{let e="Реклама",t=[["play",()=>this.play()],["pause",()=>this.pause()]];this.mediaSessionApi.setMetaData({title:e}),this.mediaSessionApi.updateActionHandlers(t),this.mediaSessionApi.attachToStore(this.store)}catch(e){this.log({message:e.message})}}moveTo(e){this.shadowDOMCallbacksDisabled=!0,e.append(this),this.shadowDOMCallbacksDisabled=!1}play(){this.isControlDisabled("PLAY_BUTTON")||this.store?.playerPhase.is("LiveWaitingStart")||this.store?.playerPhase.is("LiveWaitingRecover")||this.store?.playerPhase.is("LiveWaitingRecord")||(this.log({message:"play"}),this.svelteRootComponent?.play())}pause(){this.log({message:"pause"}),this.svelteRootComponent?.pause()}stop(){if(!this.videoConfig)return;this.log({message:"stop"});let e=!!this.interactiveController;e&&(this.interactiveController.destroy(),this.interactiveController=void 0,this.interactiveContainer=void 0,this.interactiveSubscription.unsubscribe()),this.unmountComponent(this.svelteStubComponent),this.mediaSessionApi?.destroy();let t=this.videoConfig.videos[0];t&&(this.unmountComponent(this.svelteRootComponent),e?(this.videoConfig.autoplay=!1,this.initInteractives()):this.createPlayer(t))}setMuted(e){this.log({message:`set muted, muted: ${e}`}),this.svelteRootComponent?.setMuted(e)}toggleSubtitle(){this.log({message:"toggle subtitle"}),this.svelteRootComponent?.toggleSubtitle()}changeSubtitle(e,t){this.log({message:"change subtitle"}),this.svelteRootComponent?.changeSubtitle(e,t)}hideControls(){this.log({message:"hide controls"}),this.svelteRootComponent?.hideControls()}showControls(){this.log({message:"show controls"}),this.svelteRootComponent?.showControls()}setPiPEnabled(e){this.store?.webApi.pictureInPictureApi?.setEnabled(e)}setVolume(e){this.log({message:`set volume, volume: ${e}`}),this.svelteRootComponent?.setVolume(e)}setRepeat(e){this.log({message:`set repeat, repeat: ${e}`}),this.needToRepeatPlaylist=e,ui(yv)&&(ui(yv).needToRepeatPlaylist=this.needToRepeatPlaylist,ui(yv).showNextPrevButtons=this.needToShowNextPrevButtons(),ui(yv).nextButtonActive=this.isNextButtonActive(),ui(yv).prevButtonActive=this.isPrevButtonActive())}seekTime(e){this.isControlDisabled("TIMELINE")||(this.log({message:`seek time, time: ${e}`}),this.svelteRootComponent?.seekTime(e))}seekEpisodeStartTime(e){this.log({message:`seek episode start time, time: ${e}`}),this.svelteRootComponent?.seekEpisodeStartTime(e)}returnFocusToEpisodes(){this.log({message:"return focus to episodes button"}),this.svelteRootComponent?.returnFocusToEpisodes()}setPlaybackRate(e){this.log({message:`set playback rate to: ${e}`}),this.svelteRootComponent?.setPlaybackRate(e)}setAutoQualityLimits(e){this.log({message:`set auto quality limitation. Max: ${e.max??"none"}. Min: ${e.min??"none"}`}),this.svelteRootComponent?.setAutoQualityLimits(e)}setAutoQuality(){this.svelteRootComponent?.setAutoQuality()}toggleTrafficSaving(e){this.svelteRootComponent?.toggleTrafficSaving(e)}toggleHighQuality(e){this.svelteRootComponent?.toggleHighQuality(e)}changeAudioStream(e){this.svelteRootComponent?.changeAudioStream(e)}addLanguage(e){this.store?.actions.internal.addLanguage(e)}async setLanguage(e){await(this.store?.actions.internal.setLanguage(e))}setLiveStart(e){let t=this.isLiveTailPlaying();this.log({message:`live started: liveTailPlaying = ${t}`}),t||(this.store?.actions.internal.setLiveWaitingRecover(!1),this.store?.actions.internal.setLiveWaitingStart(!1),this.unmountComponent(this.svelteRootComponent),this.createPlayer(e,{autoplay:!0}))}setLiveWaitingStart(){this.log({message:"live waiting"}),this.store?.actions.internal.setLiveWaitingStart(!0)}isLiveTailPlaying(){let e=this.store?.getPlayer();if(!e)return!1;let{info:t}=e;return t.canPlayLiveTailBuffer$.getValue()&&!t.isStalled$.getValue()&&!t.atLiveEdge$.getValue()}setLiveWaitingRecover(e=!1){let t=this.isLiveTailPlaying(),i=e||!t;this.log({message:`live waiting recover: forceImmediate = ${e}, liveTailPlaying = ${t}`});let r=()=>{this.store?.actions.internal.setLiveWaitingRecover(!0)};i&&r(),this.store?.callbacks&&(this.store.callbacks.onLiveEnded=()=>{i||r(),this.store?.destroy()})}setLiveWaitingRecord(){let e=this.isLiveTailPlaying(),t=!e;this.log({message:`live waiting record: liveTailPlaying = ${e}`});let i=()=>{this.store?.actions.internal.setLiveWaitingRecord(!0)};t&&i(),this.store?.callbacks&&(this.store.callbacks.onLiveEnded=()=>{t||i(),this.store?.destroy()})}setLiveEnd(e){let t=this.isLiveTailPlaying(),i=!t;this.log({message:`live ended: liveTailPlaying = ${t}`});let r=()=>{this.store?.actions.internal.setLiveWaitingRecover(!1),this.store?.actions.internal.setLiveWaitingRecord(!1),this.unmountComponent(this.svelteRootComponent),this.createPlayer(e,{autoplay:!1})};i?r():this.store?.callbacks&&(this.store.callbacks.onLiveEnded=r)}setLiveLowLatency(e){this.log({message:"live switch to low latency "+e}),this.store?.actions.external.setLiveLowLatency(e)}setLooped(e){this.store?.actions.internal.setLooped(e)}getDebugData(){return this.store?.actions.internal.getDebugTextData()??""}getDeviceId(){return this.statistics?.oneStat?.getDeviceId()??void 0}replayInteractiveVideo(){this.interactiveController&&this.interactiveController.setChapter()}async replayInteractiveChapter(e){if(this.interactiveController&&this.store?.state.positionExact$){let t=as(this.store.state.positionExact$),i=as(this.store.state.interactiveEpisodes$).find((e=>!e.completed));this.interactiveController.events.playerChanged$.pipe((0,m.once)()).subscribe((()=>{i&&t>=i.time?this.seekTime(i.time):this.seekTime(t),e?.()}));let r=this.interactiveController.getCurrentChapter();await this.interactiveController.setChapter({chapterId:r?.chapter?.id,pushToHistory:!1})}}showInteractiveIndicatorTooltip(e,t=!1){this.microStoresRoot?.stores.showInteractiveTimeIndicatorTooltip$.set(e,t)}switchToActiveLive(){this.store?.actions.internal.switchToActiveLive()}updateAdditionalSettingsItem(e,t){this.store?.actions.external.updateAdditionalSettingsItem(e,t)}addAdditionalSettingsItem(e){this.store?.actions.external.addAdditionalSettingsItem(e)}removeAdditionalSettingsItem(e){this.store?.actions.external.removeAdditionalSettingsItem(e)}updateAdditionalContextItem(e,t){this.store?.actions.external.updateAdditionalContextItem(e,t)}addAdditionalContextItem(e){this.store?.actions.external.addAdditionalContextItem(e)}removeAdditionalContextItem(e){this.store?.actions.external.removeAdditionalContextItem(e)}updateAdditionalButton(e,t){this.store?.actions.external.updateAdditionalButton(e,t)}addAdditionalButton(e){this.store?.actions.external.addAdditionalButton(e)}removeAdditionalButton(e){this.store?.actions.external.removeAdditionalButton(e)}updateStatContext(e){this.statistics&&(this.statistics.oneStat&&this.statistics.oneStat.updateContext(e),this.statistics.thinOneStat&&this.statistics.thinOneStat.updateContext(e))}handleTimerNextVideo(e){this.store?.actions.internal.setTimerNextVideoRunning(e)}togglePictureInPicture(){this.store?.actions.internal.togglePictureInPicture()}focus(){this.svelteRootComponent?.keyboardControls?.focus?.()}restoreFocus(){this.focusManager?.restoreFocus()}handleExternalKeyboardEvent(e){return!!this.svelteRootComponent?.keyboardControls?.handleExternalKeyboardEvent(e)}setAutoplayNext(e){this.store?.actions.internal.setAutoplayNextEnabled(e)}getTotalViewTime(){return this.statistics?.thinOneStat?.getTotalViewTime()}unmountComponent(e){e&&Qi(e)}constructor(){super(),this.currentPlayingVideoIndex=0,this.needToRepeatPlaylist=!1,this.videoConfig=void 0,this.pictureInPictureApi=void 0,this.mediaSessionApi=void 0,this.unsubscribePlayerPhaseSubscription=void 0,this.annotationsApi=void 0,this.prevIsid=void 0,this.isInited=!1,this.postponedInitParams=null,this.internalsExposure=null,this.shadowDOMCallbacksDisabled=!1,this.fatalError$=new m.ValueSubject(null),this.createOneStat=(e,t={})=>{if(!this.videoConfig)return;let{albumId:i,statPlace:r,statUserSalt:s,statTrackCode:a,statVKAppId:n,refreshStatAuthToken:o,autoplay:l,isMobile:u,isTouch:d,refDomain:c,deviceId:h,interactiveData:p}=Jg(this.videoConfig,t),f=p?.projectInfo?.pid,m=this.interactiveController?.state.isReplay$.getValue()??!1;m&&(this.prevIsid=void 0);let{unitedVideoId:v,isClip:b=!1}=e;if(this.uiConfig.features.statistics&&v)try{return new g.OneStat({movieId:v,albumId:i,place:r,trackCode:a,vkAppId:n,autoplay:(l&&!this.interactiveController)??!1,mobile:d??u,clip:b,refDomain:c,deviceId:h,isPreviewPlayerView:"preview"===this.videoConfig.playerView,...f&&(!this.isInited||m)&&{projectId:Number(f)}},{refreshAuthToken:o,userSalt:s,config:this.statisticsConfig,...this.interactiveController&&{useIsid:!0,isid:this.prevIsid}})}catch(e){console.error(e),this.log({message:e.message})}},m.devNull.create("ui"),this.logger=new m.Logger,this.log=this.logger.createComponentLog("VKVideoPlayer"),this.subscription=new m.Subscription,this.interactiveSubscription=new m.Subscription,this.graphMadePause=!1,this.fatalError$.subscribe((e=>{this.unmountComponent(this.svelteErrorComponent),e&&(this.unmountComponent(this.svelteStubComponent),this.unmountComponent(this.svelteRootComponent),this.svelteErrorComponent=zi(Hg,{target:this.playerContainer}))}))}},$v=()=>{window.customElements.define("vk-video-player",wv)};function xv(){return(0,h._)(this,l)[l]??((0,h._)(this,l)[l]=new ResizeObserver((e=>{for(var t of e)for(var i of(c.entries.set(t.target,t),(0,h._)(this,o)[o].get(t.target)||[]))i(t)})))}}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/d38b692c.681091f6.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/web/chunks/d38b692c.681091f6.js",e),e}