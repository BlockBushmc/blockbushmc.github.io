try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[90172],{890172:(e,t,s)=>{s.r(t),s.d(t,{sendMask:()=>N,showNarrative:()=>R,showStory:()=>F,storiesPreloadStatic:()=>y});var r=s(917128),i=s(2096),a=s(799835),o=s(80965),n=s(178009),d=s(138635),_=s(293395),h=s(9467),c=s(595253),l=s(791635),L=s(911817),u=s(857431),E=s(376405),A=s(982238),I=s(335791),v=s(799211),w=s(227210),S=s(612495),m=s(402033),g=s(752647),f=s(203374),O=s(756774);let T=!1,p=!1;function F(e,t={},s=void 0){if((0,w.vB)()){const s=performance.now();(0,d.x_)({nonce:s,isColdStart:!(0,g.D)().state.storiesViewerLoaded,isAnimated:null!=t.fromEl,viewSource:t.source,navigationSource:_.yr.OPEN_STORY_BY_CLICK});const r=(0,v.T)().state;r.withAnimate=Boolean(t.fromEl),r.onClose=t.onClose,r.afterNarrativeRemoved=t.afterNarrativeRemoved,r.afterNarrativeEdited=t.afterNarrativeEdited,r.nonce=s,r.source=t.source;const i=new URLSearchParams(window.location.search).get("w")??"",{narrativesViewerModal:a,storiesViewerModal:o}=L.j,n=Boolean((0,I.J)({layerName:"w",layerPath:i,layersConfig:{narrativesViewerModal:a,storiesViewerModal:o},partConfigEnabled:h.z2,isToggleEnabled:h.AW})),[l,w,T,p,F,R]=(0,A.E)(e),D=e=>{e&&(0,c.X)().resolve(u.h).open((0,f._)(),{layerParams:e,replace:n})},y=e=>{e&&(0,c.X)().resolve(u.h).open((0,O.I)(),{layerParams:e,replace:n})};if((0,m.GR)(),w&&l&&F)D({storyId:w,ownerId:l,listName:F});else{const e=(0,E.V)();(0,c.X)().resolve(S.f).getStoryViewerModalParams({listName:F,query:e,blockKey:p,uniqKey:T,extra:R}).then((e=>{e.narrativeId?y(e):D(e)}))}return}(0,d.x_)({nonce:e,isColdStart:!p,isAnimated:null!=t.fromEl,viewSource:t.source,navigationSource:_.yr.OPEN_STORY_BY_CLICK});const r=`stories_viewer_loader_${performance.now()}`;let i=!1;clearTimeout(T),T=setTimeout((function(){document.body.appendChild((0,n.ce)("div",{id:"stories_loader",innerHTML:(0,o.P1)("stories_loader_pr","pr_baw pr_medium")+'<div class="back"></div>'})),i=!0,(0,d.Wg)({nonce:r,isColdStart:!p})}),1e3),(0,l.E)().then((()=>{clearTimeout(T),(0,n.re)("stories_loader"),p=!0,i&&(0,d.nb)({nonce:r}),window.Stories.show(e,t,s)}))}function R(e,t,s=0,r="",i={}){const a=`narrative${t}`;s=s?`_${s}`:"";let o=r.match(/^narrative(-?\d+)_(\d+)(?:_(\d+))?(?:\/([a-z0-9_\-]+))?(?:\/([a-z0-9_:;\-]+))?$/i);if(o){const[,,,,s,i]=o;r=s||(i?`narrative${e}_${t}/${i}`:`narrative${e}_${t}`)}else r=r||`narrative${e}_${t}`;F(r=`${e}${s}&${a}/${r}`,i)}let D=!1;function y(){D||(D=!0,window.stManager.add([window.jsc("web/stories.js"),"stories.css",window.jsc("web/story_publisher.js")]))}let P=!1;function N(e,t,s=!1){P||(P=!0,ajax.post("al_stories.php",{act:"send_mask",mask_id:e,hash:t,is_short_video:s},{loader:!0,onDone:(e,t,s,o)=>{"cant_send"===e?(0,r.NL)({title:t,width:460},s,o):(0,i.Xv)((0,a.Xo)("stories_mask_sent")),P=!1},onFail:()=>(P=!1,(0,r.NL)({title:(0,a.Xo)("global_box_error_title")},(0,a.Xo)("global_unknown_error")),!0)}))}},402033:(e,t,s)=>{s.d(t,{Z0:()=>_,GR:()=>d});var r=s(2096);let i=[];function a(){const e=o();e&&(e.forceHide=!1,e._show(!0,!1,!0))}function o(){if(!window._message_boxes?.length)return null;const e=window._message_boxes.filter(Boolean);return e.length?e[e.length-1]:null}function n(e){(0,r.kI)()&&(e.fromEl=null,function(){const e=o();e&&(e._hide(!1,!0,!0),e.forceHide=!0)}(),window.cur.storiesCashedBoxQueueData=(0,r.r7)())}s._dG("LayersX",i);const d=()=>{n({}),window.wkcur&&window.wkcur.shown&&window.layerQueue?.push()},_=()=>{window.cur.storiesCashedBoxQueueData?((0,r.DT)(window.cur.storiesCashedBoxQueueData),a(),delete window.cur.storiesCashedBoxQueueData):window.layerQueue.count()&&window.layerQueue.pop()}},791635:(e,t,s)=>{function r(){const e=[window.jsc("web/stories.js"),"stories.css",window.jsc("web/emoji.js")];return window.stManager.add(e)}s.d(t,{E:()=>r})},376405:(e,t,s)=>{s.d(t,{V:()=>r});const r=()=>{const e="feed"===window.cur?.module&&"search"===window.cur?.section?window.cur.q??"":"";if(e)return e;const t=new URLSearchParams(window.location.search),s=t.get("section"),r=t.get("c[q]");return"search"===s&&r?r:""}},189538:(e,t,s)=>{s.d(t,{D7:()=>i,H5:()=>c,IN:()=>r,MB:()=>l,Qb:()=>o,SX:()=>u,WD:()=>I,b7:()=>g,cx:()=>h,dr:()=>L,e5:()=>m,f6:()=>A,mF:()=>S,mi:()=>d,my:()=>E,pJ:()=>w,pR:()=>v,tS:()=>a,ur:()=>n,zB:()=>_});const r=/^feed$/,i=/^discover$/,a=/^(-?\d+)_(\d+)/,o=/^owner_feed(-?\d+)/,n=/^replies(-?\d+)_(\d+)/,d=/^narrative(-?\d+)_(\d+)$/,_=/^narratives(-?\d+)$/,h=/^archive(?:(-?\d+)_)?([0-9]+)/,c=/^ads_preview(\d+)$/,l=/^search_([\w|-]+)/,L=/^place(\d+)/,u=5e3,E=6e4,A="stories_viewer_errors",I=20,v=20,w=40,S=200,m="story_viewer_volume",g=3},610964:(e,t,s)=>{s.d(t,{F:()=>r,H:()=>i});var r=function(e){return e.FAIL_STORY_VIEWER_DATA_PARSE="FAIL_STORY_VIEWER_DATA_PARSE",e.FAIL_RENDER_STORY_PACK="FAIL_RENDER_STORY_PACK",e.FAIL_FETCH_VIDEO="FAIL_FETCH_VIDEO",e.FAIL_FETCH_VK_VIDEO="FAIL_FETCH_VK_VIDEO",e.FAIL_FETCH_PRELOAD="FAIL_FETCH_PRELOAD",e.FAIL_GET_CURRENT_MEDIA="FAIL_GET_CURRENT_MEDIA",e.FAIL_MARK_SKIPPED="FAIL_MARK_SKIPPED",e.FAIL_FOLLOW="FAIL_FOLLOW",e.FAIL_UNFOLLOW="FAIL_UNFOLLOW",e.FAIL_MARK_SEEN="FAIL_MARK_SEEN",e.FAIL_LIST_DATA_FETCH="FAIL_LIST_DATA_FETCH",e.FAIL_DISCOVER_DATA_FETCH="FAIL_DISCOVER_DATA_FETCH",e.FAIL_SET_DISCOVER_VISIBILITY="FAIL_SET_DISCOVER_VISIBILITY",e.FAIL_HIDE_REPLY="FAIL_HIDE_REPLY",e.FAIL_HIDE_ALL_REPLIES="FAIL_HIDE_ALL_REPLIES",e.FAIL_BAN_OWNER="FAIL_BAN_OWNER",e.FAIL_SEND_MESSAGE="FAIL_SEND_MESSAGE",e.FAIL_MARK_NOT_INTERESTED="FAIL_MARK_NOT_INTERESTED",e.FAIL_BOOKMARK_NARRATIVE_ADD="FAIL_BOOKMARK_NARRATIVE_ADD",e.FAIL_BOOKMARK_NARRATIVE_DELETE="FAIL_BOOKMARK_NARRATIVE_DELETE",e.FAIL_DELETE_STORY="FAIL_DELETE_STORY",e.FAIL_DELETE_NARRATIVE="FAIL_DELETE_NARRATIVE",e.FAIL_DELETE_STORY_FROM_NARRATIVE="FAIL_DELETE_STORY_FROM_NARRATIVE",e.FAIL_FETCH_FEEDBACK="FAIL_FETCH_FEEDBACK",e.FAIL_SEEN_FEEDBACK="FAIL_SEEN_FEEDBACK",e.FAIL_AUDIO_TRACK_ADD_TO_MY_MUSIC="FAIL_AUDIO_TRACK_ADD_TO_MY_MUSIC",e.FAIL_AUDIO_TRACK_DELETE_FROM_MY_MUSIC="FAIL_AUDIO_TRACK_DELETE_FROM_MY_MUSIC",e.FAIL_PLAYLIST_FOLLOW="FAIL_PLAYLIST_FOLLOW",e.FAIL_PLAYLIST_UNFOLLOW="FAIL_PLAYLIST_UNFOLLOW",e.FAIL_FETCH_FEEDBACK_VIEWERS="FAIL_FETCH_FEEDBACK_VIEWERS",e.FAIL_FETCH_FEEDBACK_QUESTIONS="FAIL_FETCH_FEEDBACK_QUESTIONS",e.FAIL_TO_OPEN_PUBLISHER_BY_SITUATIONAL_TEMPLATE_STICKER="FAIL_TO_OPEN_PUBLISHER_BY_SITUATIONAL_TEMPLATE_STICKER",e.FAIL_TO_LOAD_USERS_BY_SITUATIONAL_TEMPLATE_STICKER="FAIL_TO_LOAD_USERS_BY_SITUATIONAL_TEMPLATE_STICKER",e.FAIL_DELETE_QUESTION="FAIL_DELETE_QUESTION",e.FAIL_BAN_QUESTION_AUTHOR="FAIL_BAN_QUESTION_AUTHOR",e.FAIL_UNBAN_QUESTION_AUTHOR="FAIL_UNBAN_QUESTION_AUTHOR",e.FAIL_QUESTION_SEND_MESSAGE="FAIL_QUESTION_SEND_MESSAGE",e.FAIL_ASK_QUESTION="FAIL_ASK_QUESTION",e.UKNOWN_ERROR="UKNOWN_ERROR",e}({}),i=function(e){return e.IS_REPLY_HIDE="IS_REPLY_HIDE",e.IS_EXPIRED="IS_EXPIRED",e.IS_DELETED="IS_DELETED",e.IS_PRIVATE="IS_PRIVATE",e}({})},223548:(e,t,s)=>{s.d(t,{k:()=>g});var r=s(331635),i=s(42107),a=s(57561),o=s(253661),n=s(327813),d=s(413006);const _=e=>void 0===e?.is_liked?{...e,is_liked:!1}:e,h=e=>t=>t.items?{...t,items:e(t.items)}:t,c=e=>e.map(_),l=h(c),L=h(c),u=e=>e.stories?{...e,stories:c(e.stories)}:e,E=e=>e.map(u),A=h(E),I=h(E),v=h(E),w=h(E),S=h(E);var m=s(954514);class g{constructor(e){this.storiesListProvider=e,this.feed=new a.p((e=>({feed:new d.J(this.storiesListProvider.feed.ensure(e).feed,{stateKey:`StoriesFeedListShared_${this.storiesListProvider.feed.getKeyByParams(e)}`,version:1},A),isMinimized:()=>Boolean(e.isMinimized)}))),this.search=new a.p((e=>new d.J(this.storiesListProvider.search.ensure(e).search,{stateKey:`StoriesFeedListShared_${this.storiesListProvider.search.getKeyByParams(e)}`,version:1},I))),this.discover=new d.J(this.storiesListProvider.discover,{stateKey:"StoriesDiscoverListShared",version:1},v,((e,t)=>({...e,items:(0,m.c)(e.items,t.items,"id"),groups:(0,m.c)(e.groups,t.groups,"id"),profiles:(0,m.c)(e.profiles,t.profiles,"id"),next_from:t.next_from}))),this.archive=new a.p((e=>new d.J(this.storiesListProvider.archive.ensure(e),{stateKey:`StoriesArchiveListShared_${this.storiesListProvider.archive.getKeyByParams(e)}`,version:1},l))),this.byAds=new a.p((e=>new d.J(this.storiesListProvider.byAds.ensure(e),{stateKey:`StoriesByAdsListShared_${this.storiesListProvider.byAds.getKeyByParams(e)}`,version:1},S))),this.byId=new a.p((e=>new d.J(this.storiesListProvider.byId.ensure(e),{stateKey:`StoriesByIdListShared_${this.storiesListProvider.byId.getKeyByParams(e)}`,version:1},L))),this.replies=new a.p((e=>new d.J(this.storiesListProvider.replies.ensure(e),{stateKey:`StoriesRepliesListShared_${this.storiesListProvider.replies.getKeyByParams(e)}`,version:1},w))),(0,n.l_)(this)}}g=(0,r.Cg)([i.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===o.t?Object:o.t])],g)},413006:(e,t,s)=>{s.d(t,{J:()=>a});var r=s(327813),i=s(860656);class a{get data(){return this.state.data}async fetch(e=null,t=null,s=!1,r=!1){if(this.state.promise)return this.state.promise;this.state.status="loading",this.state.promise=this.storiesEntity.fetch(e,t,s);try{const e=await this.state.promise;return this.onSuccess(e,r)}catch(e){throw this.onFail(e),e}finally{delete this.state.promise}}onSuccess(e,t=!1){this.state.whenLoadedPromise&&(this.state.whenLoadedPromise.resolve(),delete this.state.whenLoadedPromise);const s=this.normalizeData?.(e)??e,r=this.state.data,i=t&&this.mergeMoreData&&r?this.mergeMoreData(r,s):s;return this.state.data=i,this.state.status="loaded",i}onFail(e){this.state.whenLoadedPromise&&(this.state.whenLoadedPromise.reject(e),delete this.state.whenLoadedPromise),this.state.status="failed"}isLoading(){return"loading"===this.state.status}isLoaded(){return"loaded"===this.state.status}isFailed(){return"failed"===this.state.status}isInitial(){return"initial"===this.state.status}abort(){this.storiesEntity.abort(),this.state.status=this.state.data?"loaded":"initial",delete this.state.promise}reset(){this.storiesEntity.reset(),this.abort(),this.state.data=null,this.state.status="initial"}fail(){this.reset(),this.state.status="failed"}nextLoad(){return this.state.whenLoadedPromise||(this.state.whenLoadedPromise=Promise.withResolvers()),this.state.whenLoadedPromise.promise}addData(e,t=!0){this.state.data=e,t&&(this.state.status="loaded"),this.storiesEntity.addData(e,t)}constructor(e,{stateKey:t,version:s},a,o){this.storiesEntity=e,this.state={data:null,promise:void 0,status:"initial",whenLoadedPromise:void 0},(0,r.l_)(this),this.normalizeData=a,this.mergeMoreData=o;const n=(0,i.b)(t,(()=>({})),{version:s});n().state?this.state=n().state??this.state:n().state=this.state}}},612495:(e,t,s)=>{s.d(t,{f:()=>T});var r=s(331635),i=s(327813),a=s(42107),o=s(144819),n=s(253307);function d(e,t,s){const r=e.find((e=>e.id===t));if(r)return r;if(s?.length)for(let e=0;e<s.length;e++){const r=s[e],i=r.stories?.find((e=>e.id===t));if(i)return i}return(0,n.Y)(e,s)}var _=s(329057),h=s(646642),c=s(223548),l=s(57561),L=s(766669),u=s(413006);class E{constructor(e){this.narrativesListProvider=e,this.byId=new l.p((e=>new u.J(this.narrativesListProvider.byId.ensure(e),{stateKey:`NarrativesByIdShared_${this.narrativesListProvider.byId.getKeyByParams(e)}`,version:1}))),this.byOwner=new l.p((e=>new u.J(this.narrativesListProvider.byOwner.ensure(e),{stateKey:`NarrativesByOwnerShared_${this.narrativesListProvider.byOwner.getKeyByParams(e)}`,version:1}))),this.byOwnerWithStories=new l.p((e=>new u.J(this.narrativesListProvider.byOwnerWithStories.ensure(e),{stateKey:`NarrativesByOwnerWithStoriesShared_${this.narrativesListProvider.byOwnerWithStories.getKeyByParams(e)}`,version:1}))),(0,i.l_)(this)}}E=(0,r.Cg)([a.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===L.l?Object:L.l])],E);var A=s(189538);function I(e,t="windows-1251"){return new TextDecoder(t).decode(function(e){const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)||0))}(e))}var v=s(849601),w=s(610964),S=s(97929),m=s(273193),g=s(860656),f=s(466098);const O=(0,g.b)("StoriesViewerDataServiceExtraParams",(()=>({})),{version:1});class T{getIsListLoading(e){const{single:t,multiple:s,narratives:r}=this.getCurrentList(e);return Boolean((t||s||r)?.isLoading())}getIsListHasFailed(e){const{single:t,multiple:s,narratives:r}=this.getCurrentList(e);return Boolean((t||s||r)?.isFailed())}getListData(e){const{single:t,multiple:s,narratives:r}=this.getCurrentList(e);return t?{single:t.data}:s?{multiple:s.data}:r?{narratives:r.data}:{}}async ensureListData(e,t=!1){if(t||!Object.values(this.getListData(e)).some(Boolean)){const{single:t,multiple:s,narratives:r}=this.getCurrentList(e);try{await Promise.all([t?.fetch(),s?.fetch(),r?.fetch()])}catch(e){this.errorsService.error(w.F.FAIL_LIST_DATA_FETCH,e),this.snackbar.show({type:"error",text:(0,_.T)(w.F.FAIL_LIST_DATA_FETCH,this.langs)})}}return this.getListData(e)}async fetchDiscoverDataWithPagination(e){const t=this.storiesListSharedProvider.discover;try{await t.fetch(e,null,!1,!0)}catch(e){this.errorsService.error(w.F.FAIL_DISCOVER_DATA_FETCH,e)}}resetListData(e){const{multiple:t,single:s,narratives:r}=this.getCurrentList(e);t?.data?t.reset():s?.data?s.reset():r?.data&&r.reset()}failListData(e){const{multiple:t,single:s,narratives:r}=this.getCurrentList(e);[t,s,r].map((e=>{e?.fail()}))}async getStoryViewerModalParams({listName:e,blockKey:t="",ownerId:s=0,query:r="",uniqKey:i="",narrativeId:a=0,narrativeRawIds:o="",storyId:_=0,extra:c}){c&&(O()[e]=(0,f.m)(c));const{single:l,multiple:L,narratives:u}=await this.ensureListData({listName:e,query:r,narrativeRawIds:o});if(L){const r=L.items?.find((e=>t?e.id===t:!!s&&e.stories?.some((e=>e.owner_id===s))))??L.items?.[0];if(!r)return;const i=_?d(r.stories||[],_):(0,n.$)(r);if(!i)return;return{ownerId:String(i.owner_id),storyId:String(i.id),listName:e??h.Jg.feed}}if(l){const t=_?d(l.items,_):(0,n.Y)(l.items);return{ownerId:String(t?.owner_id),storyId:String(t?.id),listName:e??h.Jg.feed}}if(u){const t=a||(i?.startsWith("narrative")?Number(i?.replace("narrative","")):u.items?.[0]?.id),s=u.items.find((e=>String(e.id)===String(t)));if(!s||!t)return;const r=(0,n.Y)(s.stories);return{ownerId:String(r?.owner_id),storyId:String(r?.id),listName:e??h.Jg.feed,narrativeId:String(t)}}}getCurrentList(e){const{listName:t="",query:s}=e;if(!t)return{};const r=O()[t];let i=t.match(A.IN);if(i)return s?{multiple:this.storiesListSharedProvider.search.ensure({query:s})}:{multiple:this.storiesListSharedProvider.feed.ensure({}).feed};if(i=t.match(A.D7),i)return{multiple:this.storiesListSharedProvider.discover};if(i=t.match(A.Qb),i){const e=Number(i[1]);if(!e)throw new Error("empty ownerId");return{multiple:this.storiesListSharedProvider.feed.ensure({owner_id:e}).feed}}if(i=t.match(A.ur),i){const e=Number(i[1]),t=Number(i[2]);if(!e||!t)throw new Error("ownerId or storyId is empty");return{multiple:this.storiesListSharedProvider.replies.ensure({owner_id:e,story_id:t,extended:1})}}if(i=t.match(A.H5),i){const t=Number(i[1]),s=r?.ads_preview_hash||e.ads_preview_hash;if(!t||!s)throw new Error("ownerId or hash is empty");return{multiple:this.storiesListSharedProvider.byAds.ensure({ad_id:t,hash:s,extended:1})}}if(i=t.match(A.mi),i){const t=Number(i[1]),s=Number(i[2]);if(!t||!s)throw new Error("ownerId or narrativeId is empty");return{narratives:this.narrativesListSharedProvider.byId.ensure({narratives:String((0,o.WO)({ownerId:t,id:s})),access_hash:r?.access_hash||e.access_hash,extended:1})}}if(i=t.match(A.zB),i){const t=Number(i[1]);if(!t)throw new Error("ownerId is empty");const s=e?.narrativeRawIds;return s?.length?{narratives:this.narrativesListSharedProvider.byId.ensure({narratives:s,extended:1})}:{narratives:this.narrativesListSharedProvider.byOwnerWithStories.ensure({owner_id:t,extended:1})}}if(i=t.match(A.cx),i){const e=Number(i[1]),t=Number(i[2]);if(!e)throw new Error("ownerId is empty");return{single:this.storiesListSharedProvider.archive.ensure({owner_id:e,date:t,extended:1})}}if(i=t.match(A.tS),i){const t=Number(i[1]),s=Number(i[2]);if(!t||!s)throw new Error("ownerId or storyId is empty");const a=r?.context||e.context;return"all"===a||"new"===a?{multiple:this.storiesListSharedProvider.feed.ensure({first_owner_id:t,extended:1}).feed}:{single:this.storiesListSharedProvider.byId.ensure({stories:String((0,o.WO)({ownerId:t,id:s})),with_context:"owner"===a?1:0,extended:1,access_hash:r?.access_hash||e.access_hash})}}if(i=t.match(A.MB),i){const t=i[1],s=e?.situationalSuggestId;if(!t&&void 0===s)throw new Error("rawQuery or suggest id is empty");let r="";if(t){r=I(t.replaceAll("-","+").replaceAll("_","/"))}return{multiple:this.storiesListSharedProvider.search.ensure({query:r,situational_suggest_id:e?.situationalSuggestId})}}if(i=t.match(A.dr),i){const e=Number(i?.[1]);if(!e)throw new Error("place id is empty");return{multiple:this.storiesListSharedProvider.search.ensure({placeId:e})}}throw new Error("can't find list")}clearExtraParams(){Object.keys(O()).forEach((e=>{delete O()[e]}))}constructor(e,t,s,r,a){this.storiesListSharedProvider=e,this.narrativesListSharedProvider=t,this.errorsService=s,this.snackbar=r,this.langs=a,(0,i.l_)(this)}}T=(0,r.Cg)([a.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===c.k?Object:c.k,void 0===E?Object:E,void 0===v.U?Object:v.U,void 0===S.q?Object:S.q,void 0===m.Y?Object:m.Y])],T)},849601:(e,t,s)=>{s.d(t,{U:()=>l});var r=s(331635),i=s(42107),a=s(327813),o=s(651253),n=s(349785),d=s(645189),_=s(189538),h=s(400612),c=s(610964);class l{error(e,t){const s=new Error(e,{cause:t});this.eventsService.emitter.emit(h.i.error,s),this.log(s,e)}log(e,t=c.F.UKNOWN_ERROR){const s=this.sentryErrors.includes(e.message);this.userEnv.partConfigEnabled("frontend.stories_viewer_error_console")&&console.log(e),s?this.errorLogger.log(e):this.statLog.send({name:_.f6,value:1,keys:[t]})}constructor(e,t,s,r){this.errorLogger=e,this.eventsService=t,this.statLog=s,this.userEnv=r,this.sentryErrors=[c.F.FAIL_RENDER_STORY_PACK],(0,a.l_)(this)}}l=(0,r.Cg)([i.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===o.v?Object:o.v,void 0===h.G?Object:h.G,void 0===n.R?Object:n.R,void 0===d.J?Object:d.J])],l)},646642:(e,t,s)=>{s.d(t,{$A:()=>n,Eg:()=>l,Jg:()=>r,KV:()=>E,LF:()=>L,Pq:()=>d,Sp:()=>i,T0:()=>h,a:()=>a,kq:()=>c,lK:()=>_,qm:()=>u,tq:()=>o});var r=function(e){return e.feed="feed",e.apps="apps",e.discover="discover",e.place="place",e}({}),i=function(e){return e.PHOTO="photo",e.VIDEO="video",e.LIVE_ACTIVE="live_active",e.LIVE_FINISHED="live_finished",e}({}),a=function(e){return e[e.SMALL=150]="SMALL",e[e.MEDIUM=375]="MEDIUM",e[e.BIG=500]="BIG",e[e.MAX=Number.MAX_VALUE]="MAX",e}({}),o=function(e){return e.FEEDBACK="FEEDBACK",e.DELETE_WITH_REASON="DELETE_WITH_REASON",e.ABOUT_QUESTIONS="ABOUT_QUESTIONS",e.BEST_FRIENDS="BEST_FRIENDS",e.STORIES_CREATOR="STORIES_CREATOR",e.STICKER_TEMPLATE_FALLBACK="STICKER_TEMPLATE_FALLBACK",e.AUDIO_TRACK_MODAL="AUDIO_TRACK_MODAL",e.MUSIC_PLAYLIST_MODAL="MUSIC_PLAYLIST_MODAL",e.HIDE_DISCOVER_MODAL="HIDE_DISCOVER_MODAL",e.AUDIO_RESTRICTION_MODAL="AUDIO_RESTRICTION_MODAL",e.QUESTION_ANSWER_MODAL="QUESTION_ANSWER_MODAL",e.BLACK_LIST="BLACK_LIST",e}({}),n=function(e){return e.NOT_STARTED="NOT_STARTED",e.LOADING="LOADING",e.SUCCESS="SUCCESS",e.ERROR="ERROR",e}({}),d=function(e){return e.WEB="WEB",e.MVK="MVK",e}({}),_=function(e){return e.ARCHIVE="archive",e}({}),h=function(e){return e.STORY_ARCHIVE="story_archive",e}({}),c=function(e){return e.DELETE_FROM_ARCHIVE="delete_from_archive",e}({}),l=function(e){return e.VIEWERS="VIEWERS",e.STATS="STATS",e.STICKERS="STICKERS",e}({}),L=function(e){return e.PUBLIC="PUBLIC",e.AUTHOR_ONLY="AUTHOR_ONLY",e.ANONYMOUS="ANONYMOUS",e}({}),u=function(e){return e.STORIES_SHARE_ENDED="stories_share_ended",e}({}),E=function(e){return e.USER_INFO_MODULE="user_personal_card",e.GROUP_INFO_MODULE="group_personal_card",e.SPAMFEED_MODULE="sf",e.ABUSE_MODULE="abuse",e.ADMIN_STORY_VIEW_MODULE="admin_story_view",e}({})},253307:(e,t,s)=>{function r(e,t){let s=e?.find((e=>!e.seen)),r=s||e?.[0];if(!r&&t?.length){for(let e=0;e<t.length;e++){const r=t[e],i=r.stories?.find((e=>!e.seen));if(i){s=i;break}}r=s||t[0]?.stories?.[0]}return r}function i(e){return r(e.stories,e.grouped)}s.d(t,{$:()=>i,Y:()=>r})},203374:(e,t,s)=>{s.d(t,{_:()=>i});var r=s(227210);const i=()=>(0,r._w)()?"storiesViewerModalAdditional":"storiesViewerModal"},756774:(e,t,s)=>{s.d(t,{I:()=>i});var r=s(227210);const i=()=>(0,r._w)()?"narrativesViewerModalAdditional":"narrativesViewerModal"},329057:(e,t,s)=>{s.d(t,{T:()=>i});var r=s(610964);function i(e,t){switch(e){case r.F.FAIL_LIST_DATA_FETCH:return t.getLang("stories_viewer_list_error");case r.F.FAIL_GET_CURRENT_MEDIA:case r.F.FAIL_RENDER_STORY_PACK:return t.getLang("stories_viewer_media_error");case r.F.FAIL_FETCH_VIDEO:return t.getLang("stories_viewer_video_error");case r.F.FAIL_FETCH_VK_VIDEO:return t.getLang("stories_viewer_vk_video_error");case r.F.FAIL_MARK_SKIPPED:case r.F.FAIL_MARK_SEEN:return t.getLang("stories_viewer_mark_seen_error");case r.F.FAIL_FETCH_PRELOAD:return t.getLang("stories_viewer_preload_error");case r.F.FAIL_FOLLOW:return t.getLang("stories_viewer_follow_error");case r.F.FAIL_UNFOLLOW:return t.getLang("stories_viewer_unfollow_error");case r.F.FAIL_MARK_NOT_INTERESTED:return t.getLang("stories_viewer_mark_not_interested_error");case r.F.FAIL_HIDE_REPLY:return t.getLang("stories_viewer_fail_hide_reply");case r.F.FAIL_AUDIO_TRACK_ADD_TO_MY_MUSIC:return t.getLang("stories_viewer_audio_track_add_error");case r.F.FAIL_AUDIO_TRACK_DELETE_FROM_MY_MUSIC:return t.getLang("stories_viewer_audio_track_delete_error");case r.F.FAIL_PLAYLIST_FOLLOW:return t.getLang("stories_follow_playlist_error");case r.F.FAIL_PLAYLIST_UNFOLLOW:return t.getLang("stories_unfollow_playlist_error");case r.F.FAIL_DELETE_QUESTION:return t.getLang("stories_viewer_fail_delete_question");case r.F.FAIL_BAN_QUESTION_AUTHOR:return t.getLang("stories_viewer_fail_ban_question_author");case r.F.FAIL_UNBAN_QUESTION_AUTHOR:return t.getLang("stories_viewer_fail_unban_question_author");case r.F.FAIL_SET_DISCOVER_VISIBILITY:return t.getLang("stories_viewer_set_discover_visibility_error");case r.F.FAIL_STORY_VIEWER_DATA_PARSE:return t.getLang("stories_viewer_data_parse");case r.H.IS_EXPIRED:return t.getLang("stories_viewer_story_is_expired");case r.H.IS_DELETED:return t.getLang("stories_viewer_story_is_deleted");case r.H.IS_PRIVATE:return t.getLang("stories_viewer_story_is_private");case r.H.IS_REPLY_HIDE:return t.getLang("stories_viewer_story_is_reply_hide")}return""}},954514:(e,t,s)=>{function r(e,t,s,r="second"){const i=Array.isArray(e)?e:null,a=Array.isArray(t)?t:null;if(!i&&!a)return[];if(!i)return a;if(!a)return i;const o=new Map;return i.forEach((e=>{null!=e&&void 0!==e[s]&&null!==e[s]&&o.set(e[s],e)})),a.forEach((e=>{if(null!=e&&void 0!==e[s]&&null!==e[s]){const t=e[s];"second"===r?o.set(t,e):o.has(t)||o.set(t,e)}})),Array.from(o.values())}s.d(t,{c:()=>r})},466098:(e,t,s)=>{function r(e){const t={},s=String(e).split(";");for(let e of s){const[s,r]=e.split(":");s&&r&&(t[s]=r)}if(t.ads_preview_hash||t.context||t.access_hash)return t}s.d(t,{m:()=>r})},766669:(e,t,s)=>{s.d(t,{l:()=>l});var r=s(331635),i=s(42107),a=s(327813),o=s(645023),n=s(349785),d=s(316396),_=s(57561),h=s(816874),c=s(144819);class l{async getNarrativesByOwner({prefetch:e,...t}){const s=e?this.narrativesApi.getFromOwnerWithPrefetch:this.narrativesApi.getFromOwner,r=e?this.narrativesApi.getByIdWithPrefetch:this.narrativesApi.getById,i=(await s(t)).items.map((e=>(0,c.WO)({id:e.id,ownerId:t.owner_id}))).join(","),{fields:a,extended:o}=t;return r({fields:a,extended:o,narratives:i})}constructor(e,t){this.narrativesApi=e,this.statLog=t,this.byId=new _.p((({prefetch:e,...t})=>new h.q(e?this.narrativesApi.getByIdWithPrefetch:this.narrativesApi.getById,void 0,this.statLog,{...t,fields:t.fields??d.Dm}))),this.byOwner=new _.p((({prefetch:e,...t})=>new h.q(e?this.narrativesApi.getFromOwnerWithPrefetch:this.narrativesApi.getFromOwner,void 0,this.statLog,{...t,fields:t.fields??d.Dm},((e,t)=>({...e,items:[...e.items||[],...t.items||[]],next_from:t.next_from}))))),this.byOwnerWithStories=new _.p((({prefetch:e,...t})=>new h.q(this.getNarrativesByOwner.bind(this),void 0,this.statLog,{...t,fields:t.fields??d.Dm}))),(0,a.l_)(this)}}l=(0,r.Cg)([i.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===o.E?Object:o.E,void 0===n.R?Object:n.R])],l)},253661:(e,t,s)=>{s.d(t,{t:()=>u});var r=s(331635),i=s(42107),a=s(327813),o=s(57561),n=s(369544),d=s(747180),_=s(816874),h=s(323763),c=s(800191),l=s(349785),L=s(316396);class u{constructor(e,t){this.storiesApi=e,this.statLog=t,this.feed=new o.p((e=>new n.g(this.storiesApi,this.statLog,e))),this.search=new o.p((e=>new d.A(this.storiesApi,this.statLog,e))),this.archive=new o.p((({prefetch:e,...t})=>new _.q(e?this.storiesApi.getArchiveWithPrefetch:this.storiesApi.getArchive,void 0,this.statLog,{...t,fields:t.fields??L.Dm},((e,t)=>({...e,items:[...e.items||[],...t.items||[]]}))))),this.byAds=new o.p((({prefetch:e,...t})=>new _.q(e?this.storiesApi.getByAdsWithPrefetch:this.storiesApi.getByAds,void 0,this.statLog,{...t,fields:t.fields??L.Dm}))),this.byId=new o.p((({prefetch:e,...t})=>new _.q(e?this.storiesApi.getByIdWithPrefetch:this.storiesApi.getById,void 0,this.statLog,{...t,fields:t.fields??L.Dm}))),this.replies=new o.p((({prefetch:e,...t})=>new _.q(e?this.storiesApi.repliesWithPrefetch:this.storiesApi.replies,void 0,this.statLog,{...t,fields:t.fields??L.Dm}))),(0,a.l_)(this),this.discover=new h.n(this.storiesApi,this.statLog).discover}}u=(0,r.Cg)([i.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===c.o?Object:c.o,void 0===l.R?Object:l.R])],u)},316396:(e,t,s)=>{s.d(t,{Dm:()=>i,MA:()=>r,vt:()=>a});const r=["photo_100"].join(","),i=["first_name","last_name","first_name_gen","last_name_gen","first_name_ins","last_name_ins","screen_name","name","is_member","is_closed","photo_50","photo_100","photo_200","friend_status","is_verified","verified","sex"].join(","),a=20},816874:(e,t,s)=>{s.d(t,{q:()=>a});var r=s(99677),i=s(327813);class a{async fetch(e=null,t=null,s=!1,r=!1){if(this.promise)return this.promise;this.status="loading",this.controller=new AbortController,this.promise=(s&&this.requestWithPrefetch?this.requestWithPrefetch:this.request)({...this.defaultParams,...e??{}},t||{signal:this.controller.signal});try{const e=await this.promise;return delete this.promise,this.onSuccess(e,r)}catch(e){throw delete this.promise,this.onFail(e),e}}onSuccess(e,t=!1){return this.whenLoadedPromise&&(this.whenLoadedPromise.resolve(),delete this.whenLoadedPromise),t&&this.loadMoreReplaceCallback&&this.data?this.data=this.loadMoreReplaceCallback(this.data,e):this.data=e,this.status="loaded",e}onFail(e){if(this.whenLoadedPromise&&(this.whenLoadedPromise.reject(e),delete this.whenLoadedPromise),e?.error&&(0,r.E)(e.error))return;const t=e?.error?.error_code;this.statLog.send({name:"stories_api_web_errors",value:t}),this.status="failed"}isLoading(){return"loading"===this.status}isLoaded(){return"loaded"===this.status}isFailed(){return"failed"===this.status}isInitial(){return"initial"===this.status}abort(){this.controller&&(this.controller.abort(),this.status=this.data?"loaded":"initial",delete this.promise)}reset(){this.abort(),this.data=null,this.status="initial"}nextLoad(){return this.whenLoadedPromise||(this.whenLoadedPromise=Promise.withResolvers()),this.whenLoadedPromise.promise}addData(e,t=!0){this.data=e,t&&(this.status="loaded")}constructor(e,t=e,s,r,a){this.statLog=s,this.data=null,this.status="initial",this.request=e,this.requestWithPrefetch=t,this.defaultParams=r,this.loadMoreReplaceCallback=a,(0,i.l_)(this)}}},323763:(e,t,s)=>{s.d(t,{n:()=>o});var r=s(327813),i=s(816874),a=s(316396);class o{constructor(e,t){this.storiesApi=e,this.statLog=t,this.discover=new i.q(this.storiesApi.getDiscover,void 0,this.statLog,{count:15,fields:a.Dm,extended:1}),(0,r.l_)(this)}}},57561:(e,t,s)=>{s.d(t,{p:()=>o});var r=s(327813),i=s(316396),a=s(103700);class o{ensure(e){const t=this.getKeyByParams(e);this.entities[t]||(this.entities[t]=this.makeEntity(e));const s=Object.keys(this.entities);if(s.length>i.vt){const e=s.find((e=>e!==t));e&&this.entities.hasOwnProperty(e)&&delete this.entities[e]}return this.entities[t]}getKeyByParams(e){return(0,a.B)(e)}constructor(e){this.entities={},this.makeEntity=e,(0,r.l_)(this)}}},369544:(e,t,s)=>{s.d(t,{g:()=>o});var r=s(327813),i=s(816874),a=s(316396);class o{isMinimized(){return this.minimized}constructor(e,t,s){this.storiesApi=e,this.statLog=t,this.minimized=!1;let{isMinimized:o,minimizedPreview:n,...d}=s||{};o=Boolean(o),n=n||null==n&&o,this.minimized=o,this.feed=new i.q(this.storiesApi.get,this.storiesApi.getWithPrefetch,this.statLog,{fields:this.minimized?a.MA:a.Dm,minimized:this.minimized?1:0,extended:1,...n?{minimized_preview:1}:{},...d}),(0,r.l_)(this)}}},747180:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(327813),i=s(816874),a=s(316396);class o{constructor(e,t,{query:s,placeId:o,prefetch:n,...d}){this.storiesApi=e,this.statLog=t,this.search=new i.q(n?this.storiesApi.searchWithPrefetch:this.storiesApi.search,void 0,this.statLog,{...d,q:s,place_id:o,count:100,fields:a.Dm,extended:1}),(0,r.l_)(this)}}},103700:(e,t,s)=>{s.d(t,{B:()=>r});const r=e=>{const t=Object.keys(e).filter((t=>Boolean(e[t]))).sort();return t.length?JSON.stringify(t.reduce(((t,s)=>(t.push(s,e[s]),t)),[])):"default"}},645023:(e,t,s)=>{s.d(t,{E:()=>o});var r=s(331635),i=s(42107),a=s(820282);class o extends a.S{get namespace(){return"narratives"}constructor(...e){super(...e),this.create=this.makeMethod("create"),this.edit=this.makeMethod("edit"),this.getCustomCoverUploadServer=this.makeMethod("getCustomCoverUploadServer"),this.saveCustomCover=this.makeMethod("saveCustomCover"),this.delete=this.makeMethod("delete"),this.reorder=this.makeMethod("reorder"),this.getFromOwner=this.makeMethod("getFromOwner"),this.getFromOwnerWithPrefetch=this.makeMethod("getFromOwner",!0),this.getById=this.makeMethod("getById"),this.getByIdWithPrefetch=this.makeMethod("getById",!0),this.batchEdit=this.makeMethod("batchEdit")}}o=(0,r.Cg)([i.z8.global()],o)}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/90172.5c3d3355.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/90172.5c3d3355.js",e),e}