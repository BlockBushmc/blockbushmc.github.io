try{(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[60077],{923713:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6 12A6 6 0 1 0 6 0a6 6 0 0 0 0 12z" fill="#99a2ad"/><path clip-rule="evenodd" d="M8.78 3.97c.3.3.3.77 0 1.06L5.53 8.28c-.3.3-.77.3-1.06 0L3.22 7.03a.75.75 0 0 1 1.06-1.06l.72.72 2.72-2.72c.3-.3.77-.3 1.06 0z" fill="#fff" fill-rule="evenodd"/></svg>',name:"check_circle_fill_12"}}i.d(t,{getIcon12CheckCircleFill:()=>s})},35245:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M9.77 5.35c.5.29.5 1.01 0 1.3L4.15 9.9a.75.75 0 0 1-1.13-.65v-6.5c0-.57.63-.94 1.13-.65z" fill="currentColor"/></svg>',name:"play_12"}}i.d(t,{getIcon12Play:()=>s})},249823:(e,t,i)=>{function s(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="m7.22 3.38.01-.03a4.15 4.15 0 0 1 .17-.48c.36-.82.95-1.29 1.86-1.36l.16-.01h1.21c1.05.03 1.74.6 2.1 1.7l.05.18.05.16c.01.07.03.14.06.2l.05.14.03.02.06-.02.11-.04.14-.06a5.36 5.36 0 0 1 .17-.08l.03-.01a4.23 4.23 0 0 1 .43-.15c.93-.27 1.68-.08 2.32.61l.1.13.72.88c.63.83.61 1.72 0 2.68l-.12.16-.1.14-.12.18-.06.1-.03.05v.02l.08.05.11.06.13.08c1.21.61 1.71 1.42 1.52 2.54l-.03.16-.22.92c-.13.59-.24.87-.67 1.25a2.13 2.13 0 0 1-1.05.52h-.01a3.92 3.92 0 0 1-.44.06l-.2.02H15.63l-.16.01-.16.02.01.13.01.08.03.15c.07.32.1.62.1.9a2.04 2.04 0 0 1-1.13 1.87l-.15.08-1.02.5c-.9.4-1.72.23-2.48-.47a3.93 3.93 0 0 1-.15-.14l-.13-.14-.11-.13a2.94 2.94 0 0 0-.15-.17l-.09-.08-.04-.04-.08.08-.09.1-.1.1c-.83.99-1.7 1.34-2.77.93l-.15-.06-.91-.45-.28-.13a1.78 1.78 0 0 1-.87-.92 2.15 2.15 0 0 1-.2-1.01v-.02c0-.19.02-.39.06-.6l.04-.2.04-.2.01-.15-.1-.02-.12-.01h-.15a4.14 4.14 0 0 1-.86-.1h-.01a2.05 2.05 0 0 1-1.61-1.53l-.05-.16-.25-1.1c-.2-1.03.2-1.82 1.19-2.41l.17-.1.15-.08.19-.1.13-.1v-.01l-.05-.1-.07-.1-.09-.13a5.2 5.2 0 0 1-.29-.42c-.54-.9-.53-1.72.05-2.52l.1-.14.72-.87c.68-.8 1.56-.96 2.64-.56l.18.08.16.07a2.9 2.9 0 0 0 .19.08l.12.04.03-.02.03-.07.04-.12.04-.15.04-.16Zm4.24.84.01.04.05.14a1.5 1.5 0 0 0 .75.83l.03.01a1.5 1.5 0 0 0 1.13.08l.06-.02a1.47 1.47 0 0 0 .07-.02l.12-.04.06-.03.13-.06.04-.01a2.7 2.7 0 0 1 .41-.16c.27-.08.41-.06.47-.04.06.01.16.05.32.22l.07.09.69.84c.13.18.15.29.15.35 0 .09-.03.27-.23.58l-.08.12-.08.1a4.4 4.4 0 0 0-.18.27l-.02.02-.06.1v.01l-.01.02-.03.05a1.5 1.5 0 0 0-.18 1.06v.01a1.5 1.5 0 0 0 .65.96l.08.05.05.04.1.06.07.03.13.08.04.01c.45.24.62.43.67.52.04.06.09.16.04.42l-.02.12-.2.89c-.07.28-.1.35-.11.37h-.01a.97.97 0 0 1-.1.11.65.65 0 0 1-.36.16 2.36 2.36 0 0 1-.25.04h-.16l-.13.01h-.08a4.55 4.55 0 0 0-.28.02l-.15.02a1.5 1.5 0 0 0-1.32 1.63l.01.12v.07l.02.09.01.06.03.15v.05c.06.23.07.42.07.55 0 .2-.04.3-.07.35a.72.72 0 0 1-.28.24l-.1.05-.98.47c-.2.1-.32.09-.38.07-.08-.01-.23-.06-.46-.28a2.38 2.38 0 0 1-.08-.07l-.1-.1-.09-.11a4.39 4.39 0 0 0-.21-.24l-.02-.01-.08-.09a1.43 1.43 0 0 0-.04-.03l-.04-.04a1.5 1.5 0 0 0-2.05.01l-.08.08a1.43 1.43 0 0 0-.04.04l-.1.1a1.53 1.53 0 0 0-.04.04l-.1.12-.03.03c-.31.37-.53.5-.64.53-.08.03-.19.05-.42-.03l-.1-.04-.86-.42-.24-.12a1.19 1.19 0 0 1-.13-.08v-.01a1.08 1.08 0 0 1-.09-.15.67.67 0 0 1-.06-.34l.04-.36.04-.18a4.38 4.38 0 0 0 .06-.35l.01-.15a1.5 1.5 0 0 0-.43-1.22 1.5 1.5 0 0 0-.86-.43h-.1a1.4 1.4 0 0 0-.06-.02h-.13a1.54 1.54 0 0 0-.06-.01h-.19a2.66 2.66 0 0 1-.55-.07c-.22-.05-.3-.11-.35-.15a.7.7 0 0 1-.17-.32L3.26 12l-.24-1.05c-.04-.22 0-.33.02-.38.04-.08.15-.23.46-.42l.13-.08.12-.06a4.43 4.43 0 0 0 .31-.18l.14-.09a1.5 1.5 0 0 0 .65-.94v-.02a1.5 1.5 0 0 0-.17-1.07l-.05-.09a1.49 1.49 0 0 0-.04-.06l-.07-.11a1.5 1.5 0 0 0-.04-.06l-.09-.12a1.52 1.52 0 0 0-.02-.03c-.31-.4-.37-.65-.38-.76 0-.06 0-.18.15-.4L4.2 6l.68-.83c.16-.18.27-.21.33-.23.1-.02.28-.03.63.1l.13.06.13.05a4.42 4.42 0 0 0 .31.13l.12.04a1.5 1.5 0 0 0 1.14-.05l.03-.02a1.5 1.5 0 0 0 .76-.82l.03-.08.02-.07.04-.12.02-.06.04-.14.01-.04.03-.12.12-.32c.1-.23.19-.32.24-.36.04-.03.13-.09.34-.1l.1-.01h1.14c.24.01.34.07.39.11.07.06.2.2.3.54l.05.14.03.13.1.3ZM10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm0 1.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/></svg>',name:"gear_outline_20"}}i.d(t,{getIcon20GearOutline:()=>s})},957480:(e,t,i)=>{function s(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="gift_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="gift_outline_20__Icons-20/gift_outline_20"><g id="gift_outline_20__gift_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.85 2.31c1.02 1.03 1.23 2.88-.26 4.19h.91a3 3 0 0 1 3 3v.5c0 .82-.1 1.15-.27 1.48a1.88 1.88 0 0 1-1.23.94v1.61c0 1.56-.16 2.13-.47 2.7-.3.57-.75 1.02-1.32 1.32l-.2.1c-.48.23-1.04.35-2.23.37h-5.3c-1.55 0-2.12-.16-2.69-.47a3.18 3.18 0 0 1-1.32-1.32l-.1-.2A5.12 5.12 0 0 1 3 14.3V12.4a1.88 1.88 0 0 1-1.23-.93c-.16-.3-.25-.6-.27-1.3V9.5a3 3 0 0 1 3-3h.91c-1.49-1.31-1.28-3.16-.26-4.19C6.37 1.1 8.74 1.04 10 3.57c1.26-2.53 3.63-2.47 4.85-1.26ZM9.25 12.5H4.5v1.76l.01.4c.02.6.08.92.2 1.2l.08.16c.17.31.4.54.7.71l.17.08c.33.14.72.2 1.6.2h1.99V12.5Zm6.25 0h-4.75v4.52h2l.4-.01c.6-.02.91-.08 1.19-.2l.16-.08c.31-.17.54-.4.71-.7.19-.36.27-.7.29-1.56V12.5ZM9.16 8H4.5C3.67 8 3 8.67 3 9.5v.87c.02.23.04.31.09.4.03.06.08.1.14.14.11.06.22.08.63.09h5.39V8h-.09Zm6.34 0h-4.76v3h5.4c.4 0 .52-.03.63-.09.06-.03.1-.08.14-.14.06-.12.09-.25.09-.78V9.5c0-.83-.67-1.5-1.5-1.5ZM9.22 6.16c-.43-3.1-1.96-3.83-3-2.79C5.16 4.42 5.9 5.95 9 6.38l.26.04Zm1.56 0-.03.19.01.06.24-.03c3.1-.43 3.83-1.96 2.79-3-1.05-1.05-2.58-.32-3.01 2.78Z" id="gift_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"gift_outline_20"}}i.d(t,{getIcon20GiftOutline:()=>s})},493782:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.88 18.12a1.25 1.25 0 0 1-1.76 1.76l-7-7a1.25 1.25 0 0 1 0-1.76l7-7a1.25 1.25 0 0 1 1.76 1.76L9.77 12z" fill="currentColor"/></svg>',name:"chevron_left_24"}}i.d(t,{getIcon24ChevronLeft:()=>s})},597825:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.23 12 8.12 5.88a1.25 1.25 0 1 1 1.76-1.76l7 7c.5.48.5 1.28 0 1.76l-7 7a1.25 1.25 0 0 1-1.76-1.76z" fill="currentColor"/></svg>',name:"chevron_right_24"}}i.d(t,{getIcon24ChevronRight:()=>s})},706077:(e,t,i)=>{function s(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M10 2.9a.9.9 0 0 1-.9.9 5.3 5.3 0 0 0-5.3 5.3.9.9 0 0 1-1.8 0A7.1 7.1 0 0 1 9.1 2a.9.9 0 0 1 .9.9ZM8.5 9.55a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm5.96.75a2.39 2.39 0 0 1 2.76.31.77.77 0 0 1 .06 1.13.88.88 0 0 1-1.19.06l-.08-.07c-.26-.18-.48-.16-.75-.03a.98.98 0 0 0-.15.1l-.08.06a.88.88 0 0 1-1.11-.12.77.77 0 0 1 .06-1.13c.1-.09.26-.2.48-.3Zm-.1 4.7c.1-.55-.36-1-.91-1h-2.9c-.55 0-1 .45-.9 1 .02.13.05.25.09.34a2.44 2.44 0 0 0 1.32 1.32c.3.13.62.2.94.2a2.46 2.46 0 0 0 2.26-1.52 1.84 1.84 0 0 0 .1-.35ZM2 14.9a.9.9 0 0 1 1.8 0 5.3 5.3 0 0 0 5.3 5.3.9.9 0 1 1 0 1.8A7.1 7.1 0 0 1 2 14.9Zm12-12a.9.9 0 0 0 .9.9 5.3 5.3 0 0 1 5.3 5.3.9.9 0 0 0 .9.9.91.91 0 0 0 .9-.9A7.1 7.1 0 0 0 14.9 2a.9.9 0 0 0-.9.9ZM21.1 14a.9.9 0 0 0-.9.9 5.3 5.3 0 0 1-5.3 5.3.9.9 0 1 0 0 1.8 7.1 7.1 0 0 0 7.1-7.1.9.9 0 0 0-.9-.9Z"/></svg>',name:"vmoji_outline_24"}}i.d(t,{getIcon24VmojiOutline:()=>s})},437045:(e,t,i)=>{i.d(t,{StickersAnimation:()=>o});var s=i(581197);let o=function(){let e,t,i,r=!1,n=!1,c={},a={},l={},d={};const _={};function u(e){let t=e.getAttribute("data-uid");return t||(t=Math.random().toString(32).substr(2),e.setAttribute("data-uid",t)),t}function m(e,t){_[u(e)]=t}function h(e){let t=e.getAttribute("data-uniq-id");if(!e.querySelector(".svg_sticker_animation"))return!1;let i=l[t];return i||!1}function g(e){if(_[u(e)])return;m(e,!0);let t=h(e),r=e.getAttribute("data-uniq-id");const n=e.getAttribute("data-uid");if(e.classList.contains("animation_play"))return;let d=e.getAttribute("data-animation-path"),g=e.getAttribute("data-sticker-id"),p=!1;const k=a[g];if(g&&(p=(k||d)&&f(e)),p){const _=e.getAttribute("data-animation-class")||"";let u={containers:[e],loop:!0,autoplay:!0,name:n,group:"sticker",lazyLoading:!1,className:`svg_sticker_animation ${_}`};k?u.animationData=k:u.animationUrl=d;let m=e.querySelector(".svg_sticker_animation");m&&m.remove(),t=i.loadAnimation(u),c[g]||t.then((t=>{const i=t.animationData;a[g]=i,l[r]=t,t.addEventListener("firstFrame",(()=>{const t=e.querySelector(".sticker_img");t&&(0,s.hide)(t),e.classList.add("animation_play")}),{once:!0}),t.addEventListener("destroy",(()=>{o.stopAnimation(e)}))})).catch((()=>null))}}function p(){return t().then((e=>(i=e,i)))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){let t=document.getElementById("fc_msg"+e),i=t?t.querySelector(".sticker_animation"):null;o.loadAndPlaySticker(i)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){let t=$(`.msg_id_${e} .sticker_animation`);o.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){let i="_msg"+e;t&&(i="msg_id_"+e);const s=document.querySelector(`.${i}`);let r=s?s.querySelector(".sticker_animation"):null;o.loadAndPlayStickerWithTimer(r,500)},loadAutoplayAnimationStickers:function(e){if(!i)return void p().then((()=>{o.loadAutoplayAnimationStickers(e)}));if(e){if(n)return;n=!0}if(r)return;r=!0;let t=document.querySelectorAll(".sticker_animation_autoplay");t&&each(t,(function(e,t){g(t)})),r=!1},loadAndPlaySticker:function(e){e&&(i?requestAnimationFrame((()=>{g(e)})):p().then((()=>{o.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(!e)return;if(d[e])return;t||(t=1e3);let i=document.getElementById(e);i?.classList.contains("sticker_animation_disabled_timer")||(d[e]=setTimeout((function(){!i&&(i=document.getElementById(e),i?.classList.contains("sticker_animation_disabled_timer"))||(o.loadAndPlaySticker(i),clearTimeout(d[e]),d[e]=!1)}),t))},reloadStickers:function(){l={}},touchStartSticker:function(t){t.addEventListener("contextmenu",o.preventContextMenu,!1),e=setTimeout((function(){o.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()},stopAnimation(e){const t=h(e);t&&t.pause();const i=e.getAttribute("data-uniq-id");e.classList.remove("animation_play");const o=e.querySelector(".sticker_img");o&&(0,s.show)(o),m(e,!1),delete l[i]}};function f(e){let t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;return t<window.innerHeight&&i>=0&&"none"!==e.style.display}}()},348488:(e,t,i)=>{i.d(t,{default:()=>g});var s=i(261347),o=i(613715),r=i(898848),n=i(330882);const c=Object.entries(o.EMOJI_HINTS).map((([e,[t,i]])=>[new RegExp(`(\\s|^)(${(0,r.escapeRE)(i)}${i.endsWith(")")||i.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),e])),a={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};n.browser.mac?a["\\"]="ё":a["`"]="ё";const l=new RegExp(`[${(0,r.escapeRE)(Object.keys(a).join(""))}]`,"gi"),d=e=>e.replace(l,(e=>a[e])),_=Object.entries(a).reduce(((e,[t,i])=>(e[i]=t,e))),u=new RegExp(`[${(0,r.escapeRE)(Object.keys(_).join(""))}]`,"gi"),m=e=>e.replace(u,(e=>_[e])),h=-184940019;const g=class{setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];const t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){const i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=c.reduce(((e,[t,i])=>e.replace(t,((e,t,o,r)=>(t||"")+(0,s.emojiByteHexToSymbol)(i)+(r||"")))),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");const i=[e=(0,s.emojiRemoveSkinToneModifiers)(e)];for(const e of[...i])i.push(d(e)),i.push(m(e));for(const e of[...i])i.push(e.replace(/ё/g,"е")),i.push(e.replace(/е/g,"ё"));for(const e of[...i])i.push(e.replace(/[.!?]+$/,""));return Object.keys(i.reduce(((e,t)=>(e[t]=1,e)),{}))}isBotLinkEnabled(){return this.config.peerId!==h}getBotLinkUrl(){return this.config.mvk?`/mail?act=show&peer=${h}`:`/im?sel=${h}`}getBotLinkImageUrl(e,t="light"){return`/images/stickers_suggestions_bot_${t}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return!1}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}}},489245:(e,t,i)=>{i.r(t),i.d(t,{Emoji:()=>he});var s=i(351118),o=i(138560),r=i(613715),n=i(330882),c=i(237625),a=i(636576),l=i(298077),d=i(749284),_=i(246429),u=i(939646),m=i(672277),h=i(692543),g=i(972332),p=i(261347),f=i(573859),k=i(405404),S=i(478752),w=i(754866),E=i(45992),v=i(348488),T=i(474534),C=i(683234),b=i(270959),j=i(342879),P=i(866467),I=i(898848),y=i(182622),R=i(468073),O=i(952661),L=i(612831),A=i(847771),M=i(440487),x=i(8534),B=i(67631),D=i(416577),N=i(944041),K=i(177838),H=i(493782),U=i(597825),W=i(249823),F=i(957480),V=i(923713),$=i(706077),G=i(19589),z=i(791233),q=i(800713),Y=i(990787),J=i(608919),X=i(250598),Z=i(719361),Q=i(66087),ee=i(227564),te=i(1497),ie=i(848118),se=i(996849),oe=i(565703),re=i(505949),ne=i(554638),ce=i(274222),ae=i(664441),le=i(238681),de=i(459350),_e=i(25261),ue=i(319756),me=i(575362);const he={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,isStickersPreloading:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,TAB_NEW_CONVO_STICKERS:-3,TAB_VMOJI:-4,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",NEW_CONVO:"new_convo",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},SHOW_STICKER_PACK_VIEWS_DELAY:32,STICKER_PACK_VIEW_MARGIN_TOP:3,STICKERS_IN_RAW:4,STICKER_SIDE_SIZE:70,STICKER_PACK_HEADER_HEIGHT:30,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),PACK_FIELD_ID:0,PACK_FIELD_IS_ACTIVE:1,PACK_FIELD_COUNT:6,STICKER_FIELD_IMAGES:6,STICKER_FIELD_IS_FAVORITE:4,STICKER_PACKS_CONTAINER_CLASS:"sticker_pack_views_container",shown:!1,isStickersKeywordsFetching:!1,restoreCaretPosition:null,isAppearanceWatcherSet:!1,init:function(e,t){let i=he.last;he.tabDefaultId=he.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=(0,w.gpeByClass)("_emoji_field_wrap",e),t.emojiWrap=(0,w.domByClass)(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=(0,w.domByClass)(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&(0,w.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=(0,I.vkNow)(),t.suggestions=new v.default(t.suggestionsConfig),t.packViews=new Map,t.activePackViews=new Map,t.packViewsTotalHeight=0,t.renderedPackViews=new Map,t.packsToShow=new Set,t.packsToHide=new Set;const r=(0,S.isRetina)()?128:64;if(he.stickerSizes[r]=!0,(0,oe.isNewStickerPicker)()&&(0,re.initNewStickerPicker)(),t.forceTxt)t.editable=0,(0,d.placeholderInit)(e);else{if(t.editable=1,setTimeout((function(){(0,d.placeholderInit)(e,{editable:1,editableFocus:he.editableFocus,global:t.global}),t.shouldFocus&&he.editableFocus(e,!1,!0)}),0),n.browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}(0,g.addEvent)(window,"mousemove",he.preventMouseOverHandle),(0,g.addEvent)(e,n.browser.opera&&!n.browser.chrome?"click":"mousedown",(function(s){if(s.target&&"IMG"==s.target.tagName&&he.getCode(s.target))return he.editableFocus(e,s.target,s.offsetX>8),(0,g.cancelEvent)(s);he.shown&&!(0,oe.isNewStickerPicker)()&&he.ttClick(i,(0,w.geByClass1)("emoji_smile",t.controlsCont),!0)})),(0,g.addEvent)(e,"mouseup blur",(function(){he.restoreCaretPosition=(0,ne.saveCaretPosition)()})),t.noLineBreaks&&(0,g.addEvent)(e,"blur",(function(t){e.textContent||e.innerText||(0,S.each)((0,w.geByTag)("br",e),(function(e,t){(0,w.re)(t)}))})),(0,g.addEvent)(e,"keypress keydown keyup input paste",(function(s){if(s.canceled)return!1;if("keydown"===s.type){t.onChange&&(he.raw[i]=e.innerHTML);let r=t.ctrlSend?t.ctrlSend():t.noEnterSend;const c=s.ctrlKey||n.browser.mac&&s.metaKey;if((0,oe.isNewStickerPicker)()&&window.StickerPickerViewer?.isShown){const e=s.keyCode===g.KEY.ENTER&&!r,i=s.shiftKey,n=e&&!i&&!c,{isStickersActiveTab:a}=o.$tabbarActiveTabState.getState();if(e&&(c||a))return t.onSend&&t.onSend(),(0,g.cancelEvent)(s);if(n)return}if(s.keyCode==g.KEY.RETURN||10==s.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),(0,g.cancelEvent)(s);let o=cur.ctrl_submit&&!t.noCtrlSend;if((o||r)&&c||!o&&!s.shiftKey&&!c){if(!he.emojiEnter(i,s)||!he.stickerHintMove(s)||(0,ne.isHintsOfMentionsOpen)(e))return!1;if(!r||c)return(0,oe.isNewStickerPicker)()||he.ttClick(i,(0,w.geByClass1)("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),(0,g.cancelEvent)(s)}if(t.noLineBreaks)return(0,g.cancelEvent)(s)}if(s.ctrlKey&&s.keyCode==g.KEY.RETURN){let i=this.value;if(t.editable)he.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){let e=this.selectionStart;this.value=i.slice(0,e)+"\n"+i.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=e+1}else if(document.selection&&document.selection.createRange){this.focus();let e=document.selection.createRange();e.text="\r\n",e.collapse(!1),n.browser.opera&&!n.browser.chrome&&(e.moveEnd("character",0),e.moveStart("character",0)),e.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}const a=!1;if(s.keyCode===g.KEY.TAB&&!c&&!a&&!t.ariaHidden){let o=(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(t.txt));if(o&&(0,w.isVisible)(o)){let e=(0,w.geByClass1)("over",o);if(e?he.stickerHintKeyOut(i,e):he.stickerHintKeyOver(i,(0,w.geByClass1)("emoji_sticker_item",o)),!he.shown)return(0,g.cancelEvent)(s)}if((0,ne.isHintsOfMentionsOpen)(e))return(0,g.cancelEvent)(s);const r=t.txt?.parentNode?.querySelector(".emoji_smile");return(0,oe.isNewStickerPicker)()?he.shown?(he.editableFocus(e,!1,!0,!1,!0),he.hide()):he.show(r):he.shown?(he.editableFocus(e,!1,!0,!1,!0),he.ttClick(i,r,!0)):he.ttClick(i,r,!1,!0,void 0,!0),(0,g.cancelEvent)(s)}if(s.keyCode==g.KEY.ESC){let o=(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(t.txt)),r=!1;if(o&&(0,w.isVisible)(o)&&(he.stickerHintKeyOut(i,(0,w.geByClass1)("emoji_sticker_item",o)),he.stickersHintsHide(o,t,100),r=!0),he.shown&&(he.editableFocus(e,!1,!0,!1,!0),oe.isNewStickerPicker?he.hide():he.ttClick(i,(0,w.geByClass1)("emoji_smile",t.controlsCont),!0),r=!0),r)return(0,g.cancelEvent)(s);if(t.onEsc)return t.onEsc(s)}}if("paste"===s.type)he.onEditablePaste(e,t,i,s),t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),he.checkStickersKeywords(i,t);else if("keyup"===s.type)!t.noLineBreaks||e.textContent||e.innerText||(0,S.each)((0,w.geByTag)("br",e),(function(e,t){(0,w.re)(t)})),t.checkEditable&&t.checkEditable(i,e),he.checkStickersKeywords(i,t),t.onChange&&(he.raw[i]!=e.innerHTML&&he.onChange(t),delete he.raw[i]);else if("keydown"===s.type||"input"===s.type){if(n.browser.mozilla)try{if("keydown"===s.type&&window.getSelection){const e=window.getSelection().getRangeAt(0);he.isInsertBeforeImg=(0,ne.isEndsWithEmoji)(e)&&e.endContainer.length===e.endOffset,he.isInsertAfterSpaceAndBeforeImg=he.isInsertBeforeImg&&" "===e.endContainer.textContent?.at(-1)}if("input"===s.type&&he.isInsertBeforeImg){const e=window.getSelection().getRangeAt(0);if(" "!==s.data&&". "!==s.data&&"deleteContentBackward"!==s.inputType||!(0,ne.isEndsWithBr)(e)){if("insertParagraph"===s.inputType){const t=e.endOffset;(0,w.re)(e.commonAncestorContainer.childNodes[t])}else if("insertText"===s.inputType&&s.data&&he.isInsertAfterSpaceAndBeforeImg&&3===e?.endContainer.nodeType&&e?.endContainer?.textContent){const t=e.endOffset;e.endContainer.textContent=e.endContainer.textContent.replace(/(.)$/," $1"),e.setStart(e.endContainer,t+1),e.setEnd(e.endContainer,t+1)}}else(0,w.re)(e.endContainer.nextSibling)}}catch(s){(0,l.logError)(new Error(`The line break fix in Mozilla crashed with an error: ${s.message}`))}t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),he.checkStickersKeywords(i,t),he.restoreCaretPosition=(0,ne.saveCaretPosition)()}return t.onKeyAction&&t.onKeyAction(s),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(s),!0}))}if(window.Notifier&&Notifier.addRecvClbk("emoji",0,he.lcRecv,!0),he.updateTabs(void 0,void 0,void 0,t),!t?.noStickers&&(he.initPromotedStickerUrls(),!he.isAppearanceWatcherSet)){(0,ue.ensureDIRootWebContainer)().resolve(me.Appearance).onModeChange((0,s.debounce)((async()=>{await Promise.all([he.reloadRecentStickers(),he.reloadPromotedStickerUrls()]),he.updateStickersHints()}),200)),he.isAppearanceWatcherSet=!0}return he.checkNewStickers(t),he.opts[he.last]=t,he.last++},setSuggestionsConfig:function(e,t){he.opts[e].suggestions.setConfig(t)},onChange:function(e){(0,I.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){he.preventMouseOver=!1},lcRecv:function({act:e,newStickers:t,keywords:i}){if("updateTabs"===e)he.updateTabs(t,i)},correctCaret:function(e){let t=e?(0,T.getCaretBoundingRect)(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){let e=t.replace(/\n/g,"<br/>"),i=(0,w.ce)("div",{innerHTML:e});he.cleanCont(i),he.insertHTML(i.innerHTML)}},insertWithoutNL:function(e,t){if(t){let e=t.replace(/\n/g,""),i=(0,w.ce)("div",{innerHTML:e});he.cleanCont(i),he.insertHTML(i.innerHTML)}},focusTrick:function(e,t,i,s,o){o||(o=e);let r=(0,w.ce)("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(r),r.focus(),setTimeout((function(){let n=o.scrollTop;(0,w.re)(r),e.focus(),o.scrollTop=n,he.setRange(s),t((0,S.clean)((0,w.val)(r))),i(e)}),0)},finalizeInsert:function(e){he.cleanCont(e),setTimeout((()=>he.correctCaret(e)),10)},getClipboard:function(e){return e.clipboardData?(0,S.clean)(e.clipboardData.getData("text")):!!window.clipboardData&&(0,S.clean)(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,s){if((0,y.isMarusiaPeer)(he.selectPeer()))s();else if(null!=e.clipboardData){let r=e.clipboardData;function o(e){if(e.match(/^webkit\-fake\-url\:\/\//))return;let o=new Image;return o.crossOrigin="anonymous",o.onload=function(){let e=document.createElement("canvas");e.width=o.width,e.height=o.height,e.getContext("2d").drawImage(o,0,0,e.width,e.height),e.toBlob((function(e){!function(e){let s,o;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+(0,I.irand)(0,100)+".png",(0,w.hasClass)(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else"post_field"==t.id?s=cur.wallAddMedia:(o=(0,w.data)(t,"composer"),s=o&&o.addMedia);s&&(0,I.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,s,e)}(e)}),"image/png"),s(!0)},o.src=e}if(r.items){let n=!1;const{types:c}=r;if(c.includes("Files")||c.includes("text/plain"))for(let a=0,l=r.items.length;a<l;a++){let d=r.items[a];if(d.type.match(/^image\//)&&"file"===d.kind){let _=new FileReader;_.onload=function(e){return o(e.target.result)},_.readAsDataURL(d.getAsFile()),n=!0}else if("text/plain"===d.type)return s()}else if(r.types.includes("text/html")){const u=(0,w.se)(`<div>${r.getData("text/html")}</div>`).querySelectorAll("img");n=u.length>0,u.forEach((e=>{o(e.src)}))}return n}if(-1!==Array.prototype.indexOf.call(r.types,"text/plain"))return s();!function(e){let i=Math.floor(1e3*Math.random()),o=(0,w.geByTag)("img",t);for(let e=0,t=o.length;e<t;e++)o[e]["_before_paste_"+i]=!0;setTimeout((function(){let o=(0,w.geByTag)("img",t),r=!1;for(let t=0,s=o.length;t<s;t++){let s=o[t];s["_before_paste_"+i]||(e(s.src),(0,w.re)(s),r=!0)}r||s()}),1)}((function(e){return o(e)}))}else s()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;const t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;const i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,s,o){let r=!1;"true"===e.getAttribute("contenteditable")&&(r=he.getRange());let n=this.getClipboard(s),c=n&&r&&!o;!t.noCancelEventWhenImagePaste&&this.detectInvalidClipboardData(s)&&(0,g.cancelEvent)(s);let a=this.processImagePaste(s,e,t,function(i){i||(c?(t.noLineBreaks?this.insertWithoutNL(r,n):this.insertWithBr(r,n),setTimeout(this.finalizeInsert.bind(this,e),0)):r&&this.focusTrick(e,t.noLineBreaks?()=>this.insertWithoutNL(r):()=>this.insertWithBr(r),this.finalizeInsert.bind(this,e),r))}.bind(this));(!t.noCancelEventWhenImagePaste&&a||c)&&(0,g.cancelEvent)(s),he.onChange(t)},cleanCont:function(e){let t=e.firstChild;for(;t;){let e=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",he.cleanCont(t);else if("IMG"==t.tagName)he.getCode(t)||(0,w.re)(t);else if("BR"!=t.tagName){let e=he.editableVal(t,{saveEmoji:!0}),i=(0,w.cf)((0,S.clean)(e).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(i,t)}break;case 3:let e=(0,S.clean)(t.textContent||t.innerText),i=(0,r.emojiRegex)();e&&e.match(i)&&(e=e.replace(i,f.emojiReplace),t.parentNode.replaceChild((0,w.cf)(e),t))}t=e}},focus:function(e,t,i=!1){he.editableFocus(e,!1,!0);let s=i||e.parentNode;if(t){let e=(0,w.getXY)(s)[1],t=(0,h.scrollGetY)(),i=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,o=(0,w.getSize)(s)[1];t+i<e+o?(0,m.scrollToY)(e-i+o+60,100):t>e&&(0,m.scrollToY)(e-60,100)}},destroy:function(e){const t=he.opts[e];t&&(t.txt&&t.txt.blur(),e===he.shownId&&(he.shownId=!1,he.shown=!1),delete he.opts[e])},editableFocus:function(e,t,i,s,o){if(!e||o&&document.activeElement===e)return!1;if((e=(0,w.ge)(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){let o=window.getSelection();if(!n.browser.opera||n.browser.chrome||i){let r=document.createRange();t?r.selectNode(t):r.selectNodeContents(e),n.browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),s||r.collapse(!i),o=window.getSelection(),o.removeAllRanges(),o.addRange(r)}else o.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){let s=document.body.createTextRange();s.moveToElementText(t||e),s.collapse(!i),s.select()}},getRange:function(){if(window.getSelection){let e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){let t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return he.editableVal(e);{t=(t=(0,f.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,he.updateStickersHints();let i=(0,w.data)(e,"composer");return i&&window.Composer&&setTimeout((()=>Composer.updateAutoComplete(i))),!0}},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return(0,w.val)(e);let i,s=e.firstChild,o="",r=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");for(;s;){switch(s.nodeType){case 3:i=s.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," "),o+=i;break;case 1:if(i=he.editableVal(s),s.tagName&&s.tagName.match(r)&&i){"\n"!=i.substr(-1)&&(i+="\n");let e=s.previousSibling;for(;e&&3==e.nodeType&&""==(0,S.trim)(e.nodeValue);)e=e.previousSibling;!e||e.tagName&&(e.tagName.match(r)||"BR"==e.tagName)||(i="\n"+i)}else if("IMG"==s.tagName){let e=he.getCode(s);e&&(t&&t.saveEmoji?i+=he.getEmojiHTML(e):i+=he.codeToChr(e))}else"BR"==s.tagName&&(i+="\n");o+=i}s=s.nextSibling}return o},cssEmoji:r.EMOJI_HINTS,getEmojiHTML:f.getEmojiHTML,codeToChr:p.emojiByteHexToSymbol,checkEditable:function(e,t,i){let s=t.scrollHeight,o=he.opts[e];if(!o)return!1;o.scPaddings||(o.scPaddings=(0,S.intval)((0,w.getStyle)(t,"paddingTop"))+(0,S.intval)((0,w.getStyle)(t,"paddingBottom"))),s-=o.scPaddings;let r=o.tt;if(s>i.height+(n.browser.mozilla&&o.isChat?0:5)){if(!o.isSized){(0,w.setStyle)(t,{height:i.height+"px",overflowY:"auto"});let e=(0,w.geByClass1)("emoji_smile",o.controlsCont),s=(0,w.geByClass1)("emoji_smile_icon_promo",o.controlsCont),n=(0,w.ge)("im_upload"),c=(0,C.sbWidth)();o.ttWrap&&(c+=(0,w.getSize)(o.ttWrap)[0]-((0,w.getXY)(o.emojiBtn)[0]-(0,w.getXY)(o.ttWrap)[0])),(0,w.setStyle)(e,vk.rtl?{left:1+c}:{right:1+c}),s&&(0,w.setStyle)(s,vk.rtl?{left:2+c}:{right:2+c}),n&&(0,w.setStyle)(n.parentNode,vk.rtl?{left:1+c}:{right:1+c}),r&&(0,w.setStyle)(r,vk.rtl?{left:(o.ttDiff||31)+c}:{right:(o.ttDiff||31)+c}),o.isSized=!0}}else if(o.isSized){(0,w.setStyle)(t,{height:"auto",overflowY:"hidden"});let e=(0,w.geByClass1)("emoji_smile",o.controlsCont),i=(0,w.geByClass1)("emoji_smile_icon_promo",o.controlsCont),s=(0,w.ge)("im_upload");(0,w.setStyle)(e,vk.rtl?{left:1}:{right:1}),i&&(0,w.setStyle)(i,vk.rtl?{left:2}:{right:2}),s&&(0,w.setStyle)(s.parentNode,vk.rtl?{left:1}:{right:1}),r&&(0,w.setStyle)(r,vk.rtl?{left:o.ttDiff||31}:{right:o.ttDiff||31}),o.isSized=!1}o.onResize&&o.onResize()},stickersHintsShow:function(e,t,i){if((0,w.isVisible)(e)||(0,u.fadeIn)(e,i),!t.stickerEventsInited){(e&&(0,w.geByClass1)("_sticker_hints_inner",e)).addEventListener("wheel",he.onWheelStickersHints),(0,g.addEvent)(document,"keydown",he.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},(0,g.addEvent)(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&((0,g.removeEvent)(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(s){if(t.hintsClicked)return(0,g.cancelEvent)(s),!0;he.stickersHintsHide(e,t,i)},(0,g.addEvent)(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0}(0,oe.isNewStickerPicker)()?(0,ee.moveStickersHintsToStickerPicker)(t.id,!1):he.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){if((0,u.fadeOut)(e,i),(0,g.removeEvent)(document,"keydown",he.stickerHintMove),t.onHintsMouseDown&&(0,g.removeEvent)(e,"mousedown",he.onHintsMouseDown),t.onHintsWheel){(e&&(0,w.geByClass1)("_sticker_hints_inner",e)).removeEventListener("wheel",he.onWheelStickersHints)}t.txt&&(t.onTxtBlur&&((0,g.removeEvent)(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&(0,g.removeEvent)(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){let e=t.txt&&(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(t.txt));e&&!(0,w.isVisible)(e)&&(delete t.stickerHintsString,he.checkStickersKeywords(t.id,t,!1))},(0,g.addEvent)(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete he.shownHintId,he.sendHintsLog()},stickerHintOver:function(e){he.stickerHintOut(e),(0,w.addClass)(e,"over")},stickerHintOut:function(e){(0,S.each)((0,w.geByClass)("over",(0,w.domPN)(e)),(function(){(0,w.removeClass)(this,"over")}))},stickerHintClick:function(e,t,i,s){let o=he.opts[e]||{},r=o.txt,n=r&&(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(r)),c="suggestion_"+he.stickerSuggestionQuery;"stories"===o.ref&&(c="story_suggestion_"+he.stickerSuggestionQuery);if(t<0)he.previewSticker(!1,s,{stickerId:-t,sticker_referrer:c});else{(0,w.val)(r,"");let i={};const{stickerLayers:n=""}=s.dataset;n&&(i.layers=JSON.parse(n.replace(/'/g,'"'))),he.stickerClick(e,t,null,c,false,i),o.checkEditable&&o.checkEditable(e,r)}return he.stickersHintsHide(n,o,0),!1},stickerHintKeyOver:function(e,t){he.stickerHintOver(t),he.shownHintId=e},stickerHintKeyOut:function(e,t){he.stickerHintOut(t),delete he.shownHintId},stickerHintMove:function(e){let t=he.shownHintId;if(void 0===t)return!0;let i=he.opts[t],s=i&&(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(i.txt));if(s&&(0,w.isVisible)(s)){let t=(0,w.geByClass1)("over",s)||(0,w.geByClass1)("emoji_sticker_item",s);switch(e.keyCode){case g.KEY.LEFT:return t=(0,w.domPS)(t),t&&(he.stickerHintOver(t),he.checkStickersHintsScroll(t)),(0,g.cancelEvent)(e),!1;case g.KEY.RIGHT:return t=(0,w.domNS)(t),t&&(he.stickerHintOver(t),he.checkStickersHintsScroll(t)),(0,g.cancelEvent)(e),!1;case g.KEY.ENTER:return t.click(),(0,g.cancelEvent)(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&((0,w.addClass)(e,"StickersHints__marginTransition"),(0,w.removeClassDelayed)(e,"StickersHints__marginTransition")),(0,w.setStyle)(e,{marginLeft:0});let s=(0,w.getXY)(e),o=(0,w.getSize)(e),r=he.getEmojiTtXY(t.tt);t.tt&&r&&r[0]&&s[0]+o[0]+10>r[0]&&s[1]+o[1]>r[1]&&(0,w.setStyle)(e,{marginLeft:r[0]-s[0]-o[0]-10}),(0,w.domFC)(e)||he.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){let t;return t=e&&(0,w.hasClass)(e,he.SHOWN_TT_CLS)?(0,w.getXY)(e):[0,0],t},onMoneyTransferSuggestionClick:function(e,t,i){const s=he.opts[e],o=s.txt.parentNode.querySelector("._sticker_hints");if(he.stickersHintsHide(o,s,0),"send"===t&&s.suggestions.isMoneySendEnabled()||"request"===t&&s.suggestions.isMoneyRequestEnabled()){const{fromId:e,peer:o}=s.suggestions.config;E.default.onClick(e,o,t,i,{onSendStart:()=>{s.clearText&&s.clearText()}});const r=he.moneyTransferTextMatch&&he.moneyTransferTextMatch.input||"";(0,a.statlogsValueEvent)("stickers_money_transfer_suggestions","select",[t],r)}},renderMoneyTransferSuggestions:function(e,t){const i=he.opts[e],s=(0,S.isRetina)()?128:64,o={};return i.suggestions.isMoneyRequestEnabled()?o.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${s}.png" />\n      </a>`:o.request="",i.suggestions.isMoneySendEnabled()?o.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${s}.png" />\n      </a>`:o.send="",t.request?o.request+o.send:o.send+o.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;let s=i?0:100,o=t.txt,r=(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(o)),n=function(i,s){if(!he.stickers[he.TAB_RECENT_STICKERS])return;let o=he.sortStickersHints(window.stickersKeywords[i]),n=he.stickers[he.TAB_RECENT_STICKERS].promoted,c="";s&&(c+=he.renderMoneyTransferSuggestions(e,s)),(0,S.each)(o,(function(){c+=he.render.stickerHintRs(e,this,n[this])})),t.onStickersSuggestion?.(o),t.suggestions.isBotLinkEnabled()&&(c+=he.renderSuggestionsBotLink(e)),he.showStickersHints(r,t,c)},c=function(){let i=t.suggestions.getQueries(he.val(o));if(!i.length)return;const c=i[0],a=t.suggestions.isMoneyTransferEnabled()&&E.default.match(c,1);if(a&&(i=[E.default.DEFAULT_QUERY]),he.moneyTransferTextMatch=a,!r&&(r=he.initStickersHints(o),!r))return!1;if(c==t.stickerHintsString)return;const l=i.find((e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length||a));if(he.stickerSuggestionQuery=l,l)if(he.stickers[he.TAB_RECENT_STICKERS])n(l,a);else{let i=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){i&&i(),e&&(i?t.onRecentEmojiUpdate=i:delete t.onRecentEmojiUpdate,n(l,a))},he.emojiLoadMore(e)}else he.stickersHintsHide(r,t,s);t.stickerHintsString=c};i?c():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(c,r&&(0,w.isVisible)(r)?0:200))},showStickersHints:function(e,t,i){let s=e&&(0,w.geByClass1)("_sticker_hints_inner",e);if(!s||t.noStickers)return!1;he.clearHintsLog(),(0,w.val)(s,i),he.stickersHintsShow(e,t,100),s.scrollLeft=0,he.checkStickersHintsScroll(e,s.scrollLeft)},checkStickersHintsScroll:function(e,t){let i=(0,w.domClosest)("_sticker_hints",e),s=i&&(0,w.geByClass1)("_sticker_hints_inner",i),o=i&&(0,w.geByClass1)("_sticker_left",i),r=i&&(0,w.geByClass1)("_sticker_right",i);if(!s)return!1;const n=(0,w.getSize)(o)[0],c=(0,w.getSize)(r)[0];if((0,w.hasClass)(e,"emoji_sticker_item")){let i=e.offsetLeft-8-n,o=e.offsetLeft+(0,w.getSize)(e)[1]+2+c-s.clientWidth;s.scrollLeft>i&&(s.scrollLeft=i),s.scrollLeft<o&&(s.scrollLeft=o),t=s.scrollLeft}let l=t>0,d=t+s.clientWidth<s.scrollWidth;(0,w.toggle)(o,l),(0,w.toggleClass)(i,"sticker_hints_left_pad",l),(0,w.toggle)(r,d),(0,w.toggleClass)(i,"sticker_hints_right_pad",d),t=void 0===t?s.scrollLeft:t;const _=s.querySelectorAll(".emoji_sticker_item"),u=l?n+8:0,m=d?c+2:0,h=Array.from(_).filter((e=>e.offsetLeft-u>=t&&e.offsetLeft+e.offsetWidth+m-s.clientWidth<=t));he.logHints(h.map((e=>(0,S.intval)(e.getAttribute("data-sticker-id")))).filter((e=>e)));const g=h.map((e=>e.getAttribute("data-money-transfer-type"))).filter((e=>e));if(g.length){const e=he.moneyTransferTextMatch&&he.moneyTransferTextMatch.input||"";(0,a.statlogsValueEvent)("stickers_money_transfer_suggestions","show",g,e)}},logHints:function(e){he.logHintsTimeout&&clearTimeout(he.logHintsTimeout),he.logHintsTimeout=setTimeout((()=>{he.hintsLogBuffer=e.reduce(((e,t)=>(e[t]=1,e)),he.hintsLogBuffer||{})}),he.logHintsDelay)},clearHintsLog:function(){he.logHintsTimeout&&clearTimeout(he.logHintsTimeout),he.hintsLogBuffer={}},sendHintsLog:function(){const e=he.hintsLogBuffer&&Object.keys(he.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),he.clearHintsLog()},scrollStickersHints:function(e,t,i){let s=(0,w.domClosest)("_sticker_hints",e),o=s&&(0,w.geByClass1)("_sticker_hints_inner",s),r=s&&(0,w.geByClass1)("_sticker_left",s),n=s&&(0,w.geByClass1)("_sticker_right",s);if(!o)return!1;let c=o.scrollLeft+t*(o.clientWidth-2*(0,w.getSize)(e)[0]),a=(0,w.geByClass)("emoji_sticker_item",o);(0,S.each)(a,(function(e,i){return t>0&&i.offsetLeft-8-(0,w.getSize)(r)[0]>c?(c=a[e-1]&&a[e-1].offsetLeft-8-(0,w.getSize)(r)[0]||c,!1):t<0&&i.offsetLeft+(0,w.getSize)(i)[1]+2+(0,w.getSize)(n)[0]-o.clientWidth>c?(c=i.offsetLeft+(0,w.getSize)(i)[1]+2+(0,w.getSize)(n)[0]-o.clientWidth||c,!1):void 0})),c=Math.max(0,Math.min(o.scrollWidth-o.clientWidth,c)),(0,u.animate)(o,{scrollLeft:c},{duration:Math.abs(o.scrollLeft-c)+50,transition:u.Fx.Transitions.easeOutCubic}),he.checkStickersHintsScroll(o,c)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,he.checkStickersHintsScroll(t,t.scrollLeft)},isPromotedStickerPosition:e=>!(!e||(e+1)%4),sortStickersHints:function(e){const t=he.stickers?.[he.TAB_RECENT_STICKERS]?.stickers?.map((e=>e[0]))??[],i=e.filter((e=>t.includes(e))),s=[];for(const t of e)t<0?s.push(t):i.includes(t)||i.push(t);const o=[],r=s.length+i.length;for(let e=0;e<r;e++)if(!s.length||i.length&&!he.isPromotedStickerPosition(e)){const e=i.shift();e&&o.push(e)}else{const e=s.shift();e&&o.push(e)}return o},initStickersHints:function(e){return!!e&&(0,w.domPN)(e).insertBefore((0,w.se)(`<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,H.getIcon24ChevronLeft)().icon}\n      </div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,U.getIcon24ChevronRight)().icon}\n      </div>\n    </div>`),e)},updateStickersHints:function(e){he.opts&&(0,S.each)(he.opts,(function(t,i){e&&delete i.stickerHintsString,he.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){const{suggestions:t}=he.opts[e],i=(0,S.isRetina)()?128:64,s=G.colorScheme.isDarkScheme()?"dark":"light";return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i,s)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();const{suggestions:i}=he.opts[t];(0,a.statlogsValueEvent)(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},reloadPromotedStickerUrls:()=>new Promise(((e,t)=>{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:t=>{ls.set("promoted_stickers_urls",{time:(0,I.vkNow)(),stickerUrls:t}),i._dG("promotedStickerUrls",t),e()},onFail:()=>{t()}})})),initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){let e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>(0,I.vkNow)()-he.stickersKeywordsExpire)i._dG("promotedStickerUrls",e.stickerUrls);else{let e={act:"get_promoted_stickers"};ajax.post("al_im.php",e,{onDone:function(e){ls.set("promoted_stickers_urls",{time:(0,I.vkNow)(),stickerUrls:e}),i._dG("promotedStickerUrls",e)}})}}},emojiEnter:function(e,t){let i=he.opts[e],s=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(s?!(t.ctrlKey||n.browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){let t=(0,w.geByTag1)("img",i.emojiOvered)||(0,w.geByTag1)("i",i.emojiOvered);he.addEmoji(e,he.getCode(t),i.emojiOvered)}return(0,g.cancelEvent)(t)}return!0},insertMozillaHTML:function(e){const t=window.getSelection?.()?.getRangeAt(0);t&&0!==t.startOffset&&(0,ne.isEndsWithBr)(t)?(document.execCommand("insertHTML",!1,e+"<br>"),(0,w.re)(t.endContainer.nextSibling?.nextSibling)):document.execCommand("insertHTML",!1,e)},insertMsieHTML:function(e){if(document.selection){let t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{let t=document.getSelection().getRangeAt(0),i=document.createElement("span");t.surroundContents(i),i.innerHTML=e,t.collapse(!1)}},insertHTML:function(e=""){e.match(/\s+$/)&&(e=e.replace(/ $/," ")),n.browser.msie&&parseInt(n.browser.version)<12?he.insertMsieHTML(e):n.browser.mozilla?he.insertMozillaHTML(e):document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t){if(!1===e||!1===t)return!1;let i=he.opts[e];if(i){if(!((0,I.vkNow)()-i.ttShowT<he.CLICK_DELAY)){if(i.editable){let e=he.getEmojiHTML(t,he.codeToChr(t),!0),s=i.txt,o=!!window.getSelection&&window.getSelection();!o||o.rangeCount&&i.txt?.contains(o.focusNode)||(he.restoreCaretPosition?.(),o=window.getSelection?.());let r=!1;if(o&&o.rangeCount){let e=o.getRangeAt(0);r=e.commonAncestorContainer?e.commonAncestorContainer:e.parentElement?e.parentElement():e.item(0)}let c=r;for(;c&&c!=s;)c=c.parentNode;let a=s.lastChild||{};n.browser.mozilla&&"BR"==a.tagName&&!a.previousSibling&&(0,w.re)(s.lastChild),c||he.editableFocus(s,!1,!0),he.insertHTML(e);let l=(0,w.geByClass)("emoji",s);l.push.apply(l,(0,w.geByClass)("emoji_css",s));for(let e in l)if(l.hasOwnProperty(e)){let t=l[e].previousSibling;if(t&&3==t.nodeType&&t.textContent&&32==t.textContent.charCodeAt(0)){let e=t.previousSibling;e&&3==e.nodeType&&e.textContent&&160==e.textContent.charCodeAt(e.textContent.length-1)&&(0,w.re)(t)}}s.check&&s.check(),setTimeout((()=>he.correctCaret(s)),5),he.onChange(i);let d=(0,w.data)(s,"composer");d&&window.Composer&&Composer.updateAutoComplete(d)}else{let e,s,o,r=i.txt,c=r.value;e=n.browser.iphone||n.browser.ipad?he.codeToChr(t):he.cssEmoji[t][1]+" ",null!=r.selectionStart&&null!=r.selectionEnd?(s=r.selectionEnd,r.value=c.slice(0,r.selectionStart)+e+c.slice(s),r.selectionStart=r.selectionEnd=s+e.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(r.focus(),o=document.selection.createRange(),o.text=e,o.select())}i.checkEditable&&i.checkEditable(e,i.txt),he.checkStickersKeywords(e,i),i.saveDraft&&i.saveDraft(),i.onEmojiAdded&&i.onEmojiAdded(),he.incrRecentEmojiRate(e,t),he.restoreCaretPosition=(0,ne.saveCaretPosition)()}}else(0,l.logError)(new Error(`addEmoji got no opts by optId: ${e}, Emoji.opts === ${JSON.stringify(he.opts)}`))},showShadow:function(){return!(n.browser.msie&&n.browser.version<10)},scrollTabsTo(e,t,i=!1){const s=he.opts[e];if(!s.tt)return;const o=s.tt.querySelector(".emoji_tabs_wrap"),r=o.querySelector(".emoji_tabs_cont"),n=r.getBoundingClientRect().width-o.getBoundingClientRect().width,c=Math.max(0,Math.min(t,n));o.parentNode.classList.toggle("emoji_tabs--scrollable-left",c>0),o.parentNode.classList.toggle("emoji_tabs--scrollable-right",c<n),r.classList.toggle("emoji_tabs_cont--no-transition",i),r.style.setProperty("--scroll-left",-c+"px"),s.tabsScrollLeft=c,he.vmojiTooltipCheckVisibilityByScroll(c,s.tt,e)},scrollTabsBy(e,t,i=!1){const{tabsScrollLeft:s=0}=he.opts[e];he.scrollTabsTo(e,s+t,i)},throwTabsScroll(e){he.scrollTabsBy(e,0,!0)},scrollTabsLeft(e){he.destroyVmojiOnboardingTooltip(),he.scrollTabsBy(e,-170)},scrollTabsRight(e){he.scrollTabsBy(e,170)},tabsWheel:function(e,t){(0,g.cancelEvent)(e);const i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;he.scrollTabsBy(t,i,!0)},scrollToTab:function(e,t){const{tt:i}=he.opts[t],s=i.querySelector(`.emoji_tab_${e}`);if(!s)return;const o=s.getBoundingClientRect(),r=s.closest(".emoji_tabs_cont").getBoundingClientRect(),n=s.closest(".emoji_tabs_wrap").getBoundingClientRect(),c=o.left-r.left-(n.width-o.width)/2;he.scrollTabsTo(t,c),he.selectTab(t,e,s)},selectTab:function(e,t,i){const s=he.opts[e];if(void 0===i&&(i=(0,w.geByClass1)("emoji_tab_"+t,s.tt)),void 0===i)return;const o=i.closest(".emoji_tabs");o.querySelector(".emoji_tab_sel")?.classList.remove("emoji_tab_sel"),i.classList.add("emoji_tab_sel"),s.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t);const r=i.closest(".emoji_tabs_group");r&&(r.classList.add("emoji_tabs_group--expanded"),r.style.setProperty("--width",r.scrollWidth+"px")),o.querySelectorAll(".emoji_tabs_group").forEach((e=>{e!==r&&e.classList.remove("emoji_tabs_group--expanded")}))},show:function(e,t){(0,oe.isNewStickerPicker)()?he.showNewPicker(e):he.showOldPicker(e,t)},showNewPicker:function(e){let t=(0,w.data)(e.parentNode,"optId");if(void 0===t||!window.StickerPickerViewer)return;const i=he.opts[t];if(!i)return;const{noStickers:s,pickerHeight:o,pickerPosition:r,pickerBottomMargin:n,isCloseForwardPush:c}=i;Object.assign(window.StickerPickerViewer,{onlyEmoji:s,optId:t,height:o,position:r,isCloseForwardPush:c}),n&&window.StickerPickerViewer.positionSizeManager.setMarginElement(n),i.onShowPicker?.(e),window.StickerPickerViewer.show(e),he.shown=!0},showOldPicker:function(e,t){const i=(0,w.data)(e.parentNode,"optId");void 0!==i&&he.ttShow(i,e,t)},hide:function(e,t,i){(0,oe.isNewStickerPicker)()?he.hideNewPicker():he.hideOldPicker(e,t,i)},hideNewPicker:function(e){window.StickerPickerViewer?.hide({noTimeout:e}),he.shown=!1},hideOldPicker:function(e,t,i){let s=(0,w.data)(e.parentNode,"optId");void 0!==s&&he.ttHide(s,e,t,i)},ttShow:function(e,t,i){let s=he.opts[e];clearTimeout(s.ctt),clearTimeout(s.stt),s.scrolling&&(s.afterScrollFn=!1),s.ttShown||(t?s.obj=t:t=s.obj,s.stt=setTimeout((function(){he.ttClick(e,t,!1,!0,i)}),he.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,s){let o=he.opts[e];if(clearTimeout(o.stt),!o.ttShown)return;if(o.scrolling)return void(o.afterScrollFn=()=>he.ttHide(e,t,i,s));t=t||o.obj||(0,w.geByClass1)("emoji_smile",o.controlsCont);let r=function(){he.ttClick(e,t,!0,!1,i)};s?r():(clearTimeout(o.ctt),o.ctt=setTimeout(r,he.HIDE_TT_TIMEOUT))},isVmojiStubIconVisibile(e){const t=e.querySelector(".emoji_tabs_wrap"),i=e.querySelector(".emoji_tab--vmoji-stub");if(!i||!t)return;const s=t.getBoundingClientRect(),o=i.getBoundingClientRect();return s.x<o.x},destroyVmojiOnboardingTooltip(){he.vmojiOnboardingTooltipTimer&&(clearTimeout(he.vmojiOnboardingTooltipTimer),he.vmojiOnboardingTooltipTimer=null),he.vmojiOnboardingTooltip&&(he.vmojiOnboardingTooltip.destroy&&he.vmojiOnboardingTooltip.destroy(),he.vmojiOnboardingTooltip=null);const e=document.querySelector(".emoji_tab--vmoji-stub");e&&e.removeEventListener("click",he.vmojiOnboardingToltipSendHideRequest)},buildVmojiOnboardingTooltip(e,t){if(he.vmojiOnboardingTooltipWasDone||he.vmojiOnboardingTooltipTimer||he.vmojiOnboardingTooltip?._isShown)return;const i=he.stickers[he.TAB_VMOJI]&&he.stickers[he.TAB_VMOJI].vmoji_tooltip_info;if(!e||!i)return;const s=e.querySelector(".emoji_tab--vmoji-stub");s&&(he.vmojiOnboardingTooltipTimer=setTimeout((()=>{he.vmojiOnboardingTooltipTimer=null,he.vmojiOnboardingTooltip=new X.default(s,{content:i.content,autoShow:!1,width:"auto",forceSide:"top",appendTo:e,withCloseButton:!0,autoAdjustToViewport:!1,noAutoHideOnWindowClick:!0,cls:"EmojiTab__onboardingTooltip",delay:0,onClick:function(e){e.stopPropagation(),he.vmojiOnboardingToltipSendHideRequest(),he.tabSwitch(he.TAB_VMOJI,he.TAB_VMOJI,t)}}),he.vmojiOnboardingTooltip.show&&he.vmojiOnboardingTooltip.show(),s.addEventListener("click",he.vmojiOnboardingToltipSendHideRequest,!0),window.cur.destroy?.push(he.destroyVmojiOnboardingTooltip)}),500))},vmojiTooltipCheckVisibilityByScroll(e,t,i){0===e?he.buildVmojiOnboardingTooltip(t,i):he.destroyVmojiOnboardingTooltip()},vmojiOnboardingToltipSendHideRequest(){const e=he.stickers[he.TAB_VMOJI]&&he.stickers[he.TAB_VMOJI].vmoji_tooltip_info;if(!e||he.vmojiOnboardingTooltipWasDone)return;const{vmojiOnboardingHintHash:t,vmojiOnboardingHintId:i}=e;window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t,hint_id:i}),he.vmojiOnboardingTooltipWasDone=!0,he.destroyVmojiOnboardingTooltip()},ttClick:function(e,t,i,s,o,r){window.stManager.add(["emoji.css"],(()=>{he.buildOldPicker(e,t,i,s,o,r)}))},buildOldPicker:function(e,t,i,s,o,r){let c=he.opts[e];if(!c)return;if(i&&!he.shown||s&&he.shown)return;if(!t&&!(t=he.shown||(0,w.ge)(-3==cur.peer?"imw_smile":"im_smile")))return;t.tt&&t.tt.destroy&&t.tt.destroy(),!c.tt&&c.sharedTT&&c.sharedTT.emojiTT&&(c.tt=c.sharedTT.emojiTT,c.emojiScroll=c.sharedTT.emojiScroll,c.allEmojiId=c.sharedTT.emojiAllId);let a,l=c.tt;if(!l){let t=he.getPrevTab(c.noStickers);c.curTab=cur.stickersTab=t,t==he.TAB_EMOJI||c.noStickers||(he.stickers[he.TAB_RECENT_STICKERS]=ls.get("recent_stickers"));let i='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabsLeft('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabsRight('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';i+=he.getTabsCode([[0,1]],e),i+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',c.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(i+=he.getTabsCode(window.emojiStickers,e));let s="",o='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',r="showTooltip(this, {text: '"+(0,P.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";c.rPointer?o+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+r+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':o+=' onmouseover="'+r+'"',i+="</span></span>",c.noStickers||(i+='<a class="emoji_shop" '+o+'><div class="emoji_sprite emoji_shop_icon">'+(he.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(he.hasNewStickers)+"</div>":"")+"</div></a>"),he.showShadow()||(s+=" emoji_no_opacity"),c.noStickers&&(s+=" emoji_no_tabs"),l=(0,w.ce)("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+s,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs">'+i+"</div></div>",onmouseenter:function(t){(0,w.hasClass)(l,"emoji_animated")||he.ttShow(e,!1,t)},onmouseleave:function(t){(0,w.hasClass)(l,"emoji_animated")||he.ttHide(e,!1,t)}}),c.tt=l,he.reappendEmoji(e,l),he.emojiOver(e,(0,w.geByClass1)("emoji_scroll_smiles",l).firstChild),(0,S.each)(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){(0,g.addEvent)((0,w.geByClass1)(this,c.tt),"DOMMouseScroll wheel",(function(t){he.tabsWheel(t,e)}))})),c.sharedTT&&(c.sharedTT.emojiTT=l),he.throwTabsScroll(e)}if(!1!==he.shownId&&he.shownId!=e&&he.ttClick(he.shownId,(0,w.geByClass1)("emoji_smile",he.opts[he.shownId].controlsCont),!0),he.preventMouseOver=!1,c.emojiExpanded||he.emojiUIScroll(e,l),he.shown)he.hideTt(l),a=(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(c.txt)),a&&(0,w.isVisible)(a)&&he.checkStickersHintsSize(a,c,!0),he.shown=!1,he.shownId=!1,c.ttShown=!1,c.emojiFocused=!1,c.emojiOvered=!1,cur.onMouseClick=!1,(0,g.removeEvent)(document,"keydown",he.emojiMove),(0,w.removeClass)(t,"emoji_smile_on"),c.onHide&&c.onHide(),he.destroyVmojiOnboardingTooltip();else{if(!(0,w.getXY)(c.emojiBtn)[0]||!(0,w.getXY)(c.emojiBtn)[1])return;c.openedByTabKey=!!r,he.showTt(l),he.buildVmojiOnboardingTooltip(l,e),he.repositionEmoji(e,t,l),a=(0,w.geByClass1)("_sticker_hints",(0,w.domPN)(c.txt)),a&&(0,w.isVisible)(a)&&he.checkStickersHintsSize(a,c,!0),he.shownId=e,he.shown=t,cur.emojiList=(0,w.geByClass1)("emoji_list",l),c.ttShown=!0,c.ttShowT=(0,I.vkNow)(),c.emojiFocused=!0,(0,g.removeEvent)(document,"keydown",he.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){let i=t.target;for(;i;){if("im_texts"==i.id||(0,w.hasClass)(i,"emoji_tt_wrap")||(0,w.hasClass)(i,"imw_emoji_wrap"))return!1;i=i.parentNode}he.ttClick(e,!1,!0)},(0,g.addEvent)(document,"keydown",he.emojiMove)}),0),(0,w.addClass)(t,"emoji_smile_on"),c.emojiScroll&&c.emojiExpanded&&(c.emojiScroll.update(),n.browser.msie&&0===c.curTab&&c.emojiOvered&&he.scrollToListEl(e,c.emojiOvered)),c.currentPeerId=void 0,window.emojiStickers&&he.resetStickerPackViews(e),he.tabSwitch(c.curTab,c.curTab,e,!1,!0),c.onRecentEmojiUpdate&&c.onRecentEmojiUpdate(!0),c.onShow&&c.onShow(),c.tt.classList.toggle("emoji_tt_can_gift",!("im"===cur.module&&cur.gid))}return he.hideStickersStoreNotification(),he.noNewStickers=!0,c.noStickersStore?(0,w.addClass)((0,w.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):(0,w.removeClass)((0,w.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),(0,g.cancelEvent)(o)},getPrevTab:e=>e?he.TAB_EMOJI:ls.get("stickers_tab")||he.TAB_EMOJI,curEmojiKeys:{},curEmojiRecent:{},loadingPeerInfo:{},getPeerId:()=>cur.peer,getPeerInfo(e){if(this.loadingPeerInfo[e])return this.loadingPeerInfo[e];if(!R.Ranges.isUserId(e))return Promise.resolve(null);const t=new Promise(((t,i)=>ajax.post("stickers.php",{act:"get_peer_info",peer_id:e},{onDone:i=>{this.loadingPeerInfo[e]=null,t(i)},onFail(){this.onDone(null)}})));return this.loadingPeerInfo[e]=t,t},emojiLoadMore:function(e,t={},i){let s=he.opts[e];s.emojiMoreSt||(s.emojiMoreSt=1,he.emojiFetchMore(t).then((({stickers:t,recentEmoji:o})=>{he.updateEmojiList(t,o,e,s),(0,I.isFunction)(i)&&i()}),(e=>{console.error("Emoji.emojiLoadMore error ",e),s.emojiMoreSt=0})),he.curEmojiRecent&&s.onRecentEmojiUpdate&&s.onRecentEmojiUpdate())},emojiFetchMore(e={}){e.act="get_emoji_list",he.stickerPacksToLoad&&(e.sticker_packs_to_load=he.stickerPacksToLoad.join(",")),he.hasNewStickers<0&&(e.new_shown=1);const t=Object.assign(e.sizes||{},he.stickerSizes);return e.sizes=t&&Object.keys(t).join(","),new Promise(((t,i)=>{ajax.post("al_im.php",e,{onDone:function(...e){t(e)},onFail:function(e){return i(e),!0}})})).then((([e,i,s,o,r,n])=>{if(he.buildStickersIndex(e),void 0!==e[he.TAB_FAVORITE_STICKERS]){let t=e[he.TAB_FAVORITE_STICKERS];he.tabDefaultId=he.TAB_FAVORITE_STICKERS,he.favoriteAvailable=!0,he.favoriteRemindOn=!!t.remind_on,he.favoriteRemindOff=!!t.remind_off,he.favoriteLimit=t.limit,he.favoriteLimitNoticed=t.limit_noticed,he.sendHintsLogHash=r,E.default.setIntroViewed(n)}o&&(0,S.extend)(cur.lang,o),Object.assign(he.stickerSizes,t);const c=[];return void 0!==Object.values(e).find((e=>e.vmoji_character_id))&&c.push(window.jsc("web/vmoji.js")),s&&c.push(window.jsc("web/stickers.js")),window.stManager.add(c).then((()=>({stickers:e,recentEmoji:i})))}))},emojiPreloadMore(e,t){he.isStickersPreloading||(he.isStickersPreloading=!0,he.emojiFetchMore(e).then((({stickers:e,recentEmoji:i})=>{he.stickers=e,he.stickers[he.TAB_RECENT_STICKERS]&&ls.set("recent_stickers",he.stickers[he.TAB_RECENT_STICKERS]);const s=he.emojiGetRecentFromStorage();s?he.curEmojiRecent=he.filterEmoji(s):he.emojiOldRecentPrepare(i),t&&t()}),(e=>{console.error("Emoji.emojiPreloadMore error ",e)})).finally((()=>{he.isStickersPreloading=!1})))},reloadRecentStickers:()=>new Promise((e=>{he.emojiPreloadMore({},e)})),buildStickersIndex:function(e){let t={};if(e)for(let i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers){let s=e[i].stickers,o=s.length;for(;o--;){let e=s[o];t[e[0]]={sticker:e,packId:i}}}he.stickersById=t},updateEmojiList:function(e,t,i,s){he.stickers=e,s.emojiMoreSt=0,he.stickers[-1]&&(ls.set("recent_stickers",he.stickers[-1]),he.updateRecentEmoji(i)),s.allEmojiId=0,s.sharedTT&&(s.sharedTT.emojiAllId=0),he.onStickersLoad&&(s.afterLoad=1),he.onStickersLoad&&window.emojiStickers&&(he.onStickersLoad(),he.onStickersLoad=!1);let o=he.emojiGetRecentFromStorage();o?he.curEmojiRecent=he.filterEmoji(o):(he.emojiOldRecentPrepare(t,i),he.updateEmojiCont(i)),he.updateRecentEmoji(i),s.onRecentEmojiUpdate&&s.onRecentEmojiUpdate(!0)},filterEmoji:function(e){let t=Object.keys(e);e:for(let e in k.EMOJI_SECTIONS_CODES)if(k.EMOJI_SECTIONS_CODES.hasOwnProperty(e))for(let i in k.EMOJI_SECTIONS_CODES[e])if(k.EMOJI_SECTIONS_CODES[e].hasOwnProperty(i)){let s=k.EMOJI_SECTIONS_CODES[e][i],o=t.indexOf(s);if(-1!=o&&(t.splice(o,1),0==t.length))break e}let i={};for(let s in e)e.hasOwnProperty(s)&&-1==t.indexOf(s)&&(i[s]=e[s]);return t.length>0&&he.setRecentEmojiList(i),i},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){let t={};for(let i in e)if(e.hasOwnProperty(i)){let s,o,r=e[i];(0,I.isString)(r)?(s=1,o=r):(s=r,o=i),t[o]=s}he.setRecentEmojiList(he.filterEmoji(t))},getRecentEmojiSorted:function(){let e=[];for(let t in he.curEmojiRecent)if(he.curEmojiRecent.hasOwnProperty(t)){let i=he.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));let t=[];for(let i in e)e.hasOwnProperty(i)&&t.push(e[i][0]);return t.slice(0,20)},incrRecentEmojiRate:function(e,t){he.emojiRecentRateTime||(he.emojiRecentRateTime=Date.now()/1e3-6);let i=Date.now()/1e3-he.emojiRecentRateTime;if(i>=6){let e=Math.min(100,Math.floor(i/6));for(let i in he.curEmojiRecent)if(he.curEmojiRecent.hasOwnProperty(i)){if(i==t)continue;he.curEmojiRecent[i]*=Math.pow(.998076,e)}he.emojiRecentRateTime+=6*e}he.curEmojiRecent[t]||(he.curEmojiRecent[t]=0),he.curEmojiRecent[t]+=1;let s=he.getRecentEmojiSorted();k.EMOJI_SECTIONS_CODES[-1]=s,s.length>=20&&-1==s.indexOf(t)&&(s.splice(-1),s.push(t));let o={};for(let e in s)if(s.hasOwnProperty(e)){let t=s[e];o[t]=he.curEmojiRecent[t]}he.setRecentEmojiList(o),window.Notifier&&Notifier.lcSend("recent_emoji_set",o)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),he.curEmojiRecent=e},updateEmojiCont:function(e){let t=he.opts[e];t&&0==t.curTab&&((0,w.val)((0,w.geByClass1)("emoji_scroll_smiles",t.tt),he.getInitEmojiContent(e)),he.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){let i="",s=he.emojiGetRecentFromStorage();s&&he.setRecentEmojiList(s),k.EMOJI_SECTIONS_CODES[-1]=he.getRecentEmojiSorted();let o=t||he.SORTED_EMOJI_SECTIONS_CODES;for(let t in o)if(o.hasOwnProperty(t)){let s=o[t];i+=he.getEmojiCategoryHtml(e,s)}return i},getInitEmojiContent:function(e){he.setEmojiLastAddedCategoryIdx(e,1);return he.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){let i="",s=k.EMOJI_SECTIONS_CODES[t];if(!s.length)return i;let o='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+he.getEmojiCategoryText(t)+"</div></div>";return o+=he.emojiGetCatCont(e,s),i+=o,i},getEmojiCategoryText:function(e){switch(-1===e?"recent":parseInt(e,10)){case"recent":return(0,P.getLang)("global_emoji_cat_recent");case 1:return(0,P.getLang)("global_emoji_cat_1");case 2:return(0,P.getLang)("global_emoji_cat_2");case 3:return(0,P.getLang)("global_emoji_cat_3");case 4:return(0,P.getLang)("global_emoji_cat_4");case 5:return(0,P.getLang)("global_emoji_cat_5");case 6:return(0,P.getLang)("global_emoji_cat_6");case 7:return(0,P.getLang)("global_emoji_cat_7");case 8:return(0,P.getLang)("global_emoji_cat_8");case 9:return(0,P.getLang)("global_emoji_cat_9")}},getEmojiLastAddedCategoryIdx:function(e){return he.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){he.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){let t=he.opts[e],i=t.tt,s=he.getEmojiLastAddedCategoryIdx(e);if(t.emojiCategoryAdding||t.allEmojiLoaded)return;if(t.emojiCategoryAdding=!0,!s)return void(0,c.debugLog)("No emoji last category idx");let o=(0,w.geByClass1)("emoji_scroll_smiles",i);if(s++,he.SORTED_EMOJI_SECTIONS_CODES.length>s){let i=he.SORTED_EMOJI_SECTIONS_CODES[s];o.insertAdjacentHTML("beforeEnd",he.getEmojiCategoryHtml(e,i)),he.setEmojiLastAddedCategoryIdx(e,s),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1},hideTt:function(e){(0,w.removeClass)(e,he.SHOWN_TT_CLS)},showTt:function(e){(0,w.addClass)(e,he.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){let i="",s="",o=t.length-1;for(let r=0;r<=o;r++)s+=he.emojiWrapItem(e,t[r],r),(r>0&&r%10==9||r>=o)&&(i+='<div class="emoji_smiles_row">'+s+"</div>",s="");return i},updateRecentEmoji:function(e){let t=he.getRecentEmojiSorted(),i=he.emojiGetCatCont(e,t),s=(0,w.ge)("emoji_recent_list"+e+"_-1");if(!s)return;let o=s.nextSibling;for(;o&&(o=o.nextSibling,(0,w.hasClass)(o.previousSibling,"emoji_smiles_row"));)(0,w.re)(o.previousSibling);let r=(0,w.ce)("div",{innerHTML:i}),n=s.nextSibling,c=s.parentNode;for(;o=r.firstChild;)c.insertBefore(o,n)},findStickerIndex:function(e,t){if(e){let i=e.stickers,s=i.length;for(;s--;)if(String(i[s][0])===String(t))return s}return-1},findSticker:function(e,t){let i=he.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return he.findStickerIndex(he.stickers[he.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return he.findSticker(he.stickers[he.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return he.findStickerIndex(he.stickers[he.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return he.findSticker(he.stickers[he.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(he.stickersById&&he.stickersById.hasOwnProperty(e))return he.stickersById[e].sticker},isStickersLoaded:function(){if(he.stickers)for(let e in he.stickers)if(he.stickers.hasOwnProperty(e)&&e!==String(he.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){let i=he.TAB_FAVORITE_STICKERS,s="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+i;return cur.stickersTab===i&&(s+=" emoji_tab_sel"),he.isStickersLoaded()?(0!==t&&0!==he.stickers[i]?.stickers?.length||(s+=" unshown"),'<a class="'+s+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'):""}},favorite:{reminder:function(e){let t=(0,w.hasClass)(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(he[i])return;let s={text:function(){return t?(0,P.getLang)("purchases_stickers_favorite_rm_tt"):(0,P.getLang)("purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},o=(0,w.domClosest)("ui_scroll_container",e);s.appendEl=o;let r=(0,w.domClosest)("ui_scroll_overflow",e),n=(0,w.getXYRect)(e),c=(0,w.getXYRect)(r),a=n.top-c.top,l=(c.right,n.right,c.bottom-n.bottom),d=n.left-c.left,_=(c.width||c.right-c.left)/2;(!vk.rtl&&d>_||vk.rtl&&d<_)&&(s.needLeft=!0,s.shift[0]=9),s.forcetodown=a<he.FAV_ICON_TT_MIN_HEIGHT,s.forcetoup=l<he.FAV_ICON_TT_MIN_HEIGHT,(0,j.showTooltip)(e,s),he[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})},markStickerAsFavorite:function(e){e[he.STICKER_FIELD_IS_FAVORITE]=1},markStickerAsUnfavorite:function(e){e[he.STICKER_FIELD_IS_FAVORITE]=0},addFavoriteSticker:function(e,t){const i=he.stickers[he.TAB_FAVORITE_STICKERS]?.stickers,s=he.findPackSticker(t);if(!i||!s)return;he.favorite.markStickerAsFavorite(s),i.unshift(s),he.favorite.increaseFavoritePackSize();const o=he.findRecentSticker(t);o&&he.favorite.markStickerAsFavorite(o),ls.set("recent_stickers",he.stickers[he.TAB_RECENT_STICKERS]);for(const[e,i]of Object.entries(he.opts)){if(i.noStickers)continue;he.favorite.changeRenderedPackViewsByStickerId(e,t,!0);const s=i.activePackViews.has(he.TAB_FAVORITE_STICKERS);he.resetStickerPackViews(e,!s),he.favorite.showFavoriteTab(i.tt)}},deleteFavoriteSticker:function(e,t){const i=he.stickers[he.TAB_FAVORITE_STICKERS];if(!i)return;const s=he.findFavoriteStickerIndex(t);if(-1===s)return;i.stickers.splice(s,1),he.favorite.reduceFavoritePackSize();const o=he.findRecentSticker(t);o&&he.favorite.markStickerAsUnfavorite(o),ls.set("recent_stickers",he.stickers[he.TAB_RECENT_STICKERS]);const r=he.findPackSticker(t);r&&he.favorite.markStickerAsUnfavorite(r);for(const[e,s]of Object.entries(he.opts))if(!s.noStickers){if(!i.stickers.length){he.favorite.hideFavoriteTab(s.tt);const t=s.tt.querySelector(".emoji_favorite_stickers_cont");t&&t.parentElement.remove(),s.renderedPackViews.delete(he.TAB_FAVORITE_STICKERS),he.selectTab(e,he.TAB_RECENT_STICKERS)}he.favorite.changeRenderedPackViewsByStickerId(e,t,!1),he.resetStickerPackViews(e,!s.activePackViews.has(he.TAB_FAVORITE_STICKERS))}},reduceFavoritePackSize:function(){const e=window.emojiStickers.find((e=>e[0]===he.TAB_FAVORITE_STICKERS));e&&e[he.PACK_FIELD_COUNT]&&(e[he.PACK_FIELD_COUNT]=e[he.PACK_FIELD_COUNT]-1)},increaseFavoritePackSize:function(){const e=window.emojiStickers.find((e=>e[0]===he.TAB_FAVORITE_STICKERS));e&&(e[he.PACK_FIELD_COUNT]=e[he.PACK_FIELD_COUNT]+1)},showFavoriteTab:function(e){const t=e.querySelector(`.emoji_tab_${he.TAB_FAVORITE_STICKERS}`);t&&t.classList.remove("unshown")},hideFavoriteTab:function(e){const t=e.querySelector(`.emoji_tab_${he.TAB_FAVORITE_STICKERS}`);t&&t.classList.add("unshown")},changeRenderedPackViewsByStickerId:function(e,t,i){const s=he.opts[e],o=he.findPackSticker(t);for(const[r,n]of s.renderedPackViews){const s=n.querySelector(`[data-sticker-id="${t}"]`);if(i){if(s)s.classList.add("faved"),s.querySelector(".emoji_sticker_item_fav")?.classList.add("on");else if(r===he.TAB_FAVORITE_STICKERS){const t=he.renderStickerView(e,r,o),i=n.querySelector("[data-sticker-id]");i?i.parentNode.insertBefore(t,i):n.appendChild(t)}}else s&&(r===he.TAB_FAVORITE_STICKERS?s.parentNode.removeChild(s):(s.classList.remove("faved"),s.querySelector(".emoji_sticker_item_fav")?.classList.remove("on")))}}},updateEmojiCatTitle:function(e){let t=he.opts[e];if(!t||!t.emojiScroll)return;let i,s,o,r=(0,w.ge)("emoji_block_"+e),n=(0,w.geByClass)("emoji_cat_title_helper",r),a=t.emojiScroll.data.scrollTop,l=(0,w.geByClass1)("emoji_cats_title_helper",t.tt);if(n.length){let e=n[0];i=he.getSizeCached(e)[1]}for(let e=n.length-1;e>=0;e--)if(a>n[e].offsetTop-i){s=n[e],o=e;break}if(!s)return(0,c.debugLog)("title not found");let d=(0,S.intval)((0,w.attr)(s,"data-id"));if(t.curEmojiCatId!=d){t.curEmojiCatId=d;let e=[s],r=n[o-1];r&&((0,w.addClass)(r,"emoji_cat_title_fix"),(0,w.setStyle)(r.firstChild,"transform","translateY("+(s.offsetTop-r.offsetTop-i)+"px)"));let c=s.nextSibling;for(;c;)(0,w.hasClass)(c,"emoji_cat_title_fix")&&e.push(c),c=c.nextSibling;for(let t in e)e.hasOwnProperty(t)&&((0,w.removeClass)(e[t],"emoji_cat_title_fix"),(0,w.setStyle)(e[t].firstChild,"transform","translateY(0px)"));(0,w.val)(l,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&a>=s.offsetTop&&a>0?((0,w.val)(l,(0,w.val)(s)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(a<s.offsetTop||0==a)&&((0,w.val)(l,""),t.emojiTitleHelperIsSet=0)},emojiWrapItem:function(e,t,i){let s,o=he.cssEmoji[t];s=o?' title="'+o[1]+'"':"";let r="";return n.browser.mobile||(r=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+s+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+r+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+he.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){let i=he.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),he.hideTt(t))},ttCalcHeight:function(e,t,s){i._dG("headH",window.headH||(0,w.ge)("page_header")&&he.getSizeCached((0,w.ge)("page_header"))[1]||0);let o=(window.pageNode&&window.browser.mozilla?Math.min((0,w.getSize)(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||(0,w.getScroll)()[3],r=window.scrollGetY?(0,h.scrollGetY)():(0,w.getScroll)()[1],n=(0,w.getXY)(t)[1],c=he.getSizeCached(t)[1],a=(0,w.geByClass1)("emoji_list",s),l=he.opts[e].emojiSmileHeigh,d=window.headH,_=he.opts[e].emojiRowsCount;(0,w.isAncestor)(t,pageNode)||(d=0),(0,w.setStyle)(a,{height:_*l+8});let u,m=r+d,g=r+o,p=s,f=(0,w.getSize)(s)[1],k=0,S=0,E=0;for(;p!==document.body&&(p=(0,w.domClosestOverflowHidden)(p));){let e=(0,w.getXY)(p)[1];m=Math.max(m,e),g=Math.min(g,e+(0,w.getSize)(p)[1])}for(k=n-9-m,S=g-n-c-9,u=k<f&&S<f?k>=S:k>=f,he.opts[e].forceUp&&(u=!0),E=u?k:S;E<f&&_>3;)_--,f-=l;he.opts[e].emojiRowsCount=_,he.opts[e].emojiSmileHeigh=l,(0,w.setStyle)(a,{height:_*l+8}),(0,w.toggleClass)(s,"tt_down",u),(0,w.toggleClass)(s,"tt_up",!u)},repositionEmoji:function(e,t,i){let s,o=he.opts[e];if(!o)return;if(i.parentNode&&w.getXY&&w.getStyle&&w.setStyle&&w.geByClass&&(s=(0,w.geByClass1)("emoji_rpointer",i))){let e=parseInt((0,w.getStyle)(i,"width")),o=266,r=7,n=10,c=(0,w.getXY)(t)[0],a=parseInt((0,w.getStyle)(t,"width")),l=(0,w.getXY)(i.parentNode)[0];c+a/2<o+r+n?((0,w.setStyle)(i,"left",-e-l),(0,w.setStyle)(s,"left",c+a/2-2*n+"px")):((0,w.setStyle)(i,"left",""),(0,w.setStyle)(s,"left",""))}else(0,w.setStyle)(i,"left","");let r=(0,w.geByClass1)("emoji_list",i),n=(0,w.geByClass1)("emoji_smile_cont",r);if(he.opts[e].emojiSmileHeigh=n&&he.getSizeCached(n)[1]||26,he.opts[e].emojiRowsCount=9,he.ttCalcHeight(e,t,i),o.ttWrap){let e=(0,w.getSize)(o.ttWrap)[0]-((0,w.getXY)(o.emojiBtn)[0]-(0,w.getXY)(o.ttWrap)[0]);(0,w.setStyle)(i,"right",e-o.ttDiff+"px")}},emojiOver:function(e,t,i){if(n.browser.mobile||i&&he.preventMouseOver)return!0;let s=he.opts[e];(0,w.addClass)(t,"emoji_over"),s.emojiOvered&&s.emojiOvered!=t&&(0,w.removeClass)(s.emojiOvered,"emoji_over"),s.emojiOvered=t},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-he.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){he.addNextEmojiCategoty(i),he.updateEmojiCatTitle(i)}),0),he.updateEmojiCatTitle(i)},calcStickerPackViews(e){const t=this.opts[e],i=new Map;let s=0,o=s;const{forceStickerPack:r,emojiScroll:n}=t;if(!window.emojiStickers)return;const c=[];for(const e of window.emojiStickers){const t=e[0];if(!this.stickers.hasOwnProperty(t))continue;const i=e[1],s=e[4]&&r===t,o=t===he.TAB_VMOJI;if(!i&&!s)continue;const{stickers:n}=this.stickers[t];(n.length||o)&&c.push(e)}const a=[],l=[];for(const e of c){const t=e[0],i=e[9];t<0||i?a.push(e):l.push(e)}[...a,...l].forEach((e=>{const t=e[0],r=t===he.TAB_VMOJI,{stickers:c}=this.stickers[t];let a=Math.ceil(c.length/he.STICKERS_IN_RAW)*he.STICKER_SIDE_SIZE;a+=he.STICKER_PACK_HEADER_HEIGHT,r&&n&&(a+=n.data.viewportHeight);const l={id:t,top:s,bottom:s+a};i.set(t,l),s+=a,o+=a})),t.packViews=i,t.packViewsTotalHeight=o},renderStickerPackView(e,t){const i=this.opts[e],{id:s}=t,o=i.renderedPackViews.get(s);if(o)return o;const r=window.emojiStickers.find((([e])=>e===s));if(!r)return"";if(!he.stickers.hasOwnProperty(s))return"";const{stickers:n,images:c}=he.stickers[s],a=s===this.TAB_RECENT_STICKERS,l=s===this.TAB_FAVORITE_STICKERS,d=s===this.TAB_VMOJI;let _="";if(_+=he.getStickerPackBlockHeaderHtml(e,r),a)_+=`<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont${e}">`;else if(l)_+=`<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont${e}">`;else if(d&&!vk.widget){const e=c[G.colorScheme.isDarkScheme()?"dark":"light"]||Object.values(c)[0];_+=he.getVmojiStubHtml(e)}for(const t of n)_+=this.renderStickerViewHtml(e,s,t);(a||l)&&(_+="</div>");const u=(0,w.se)(`\n     <div style="\n        position: absolute;\n        width: 100%;\n     ">${_}</div>\n  `);return i.renderedPackViews.set(s,u),u},getStickerPackBlockHeaderHtml:function(e,t){const i=t[0],s=t[8],o=t[9];let{title:r,base_id:n,can_gift:c}=he.stickers[i],a="";if(a+=`\n    <div class="clear emoji_stickers_pack_header">\n      <div class="emoji_stickers_pack_header_main">\n        <div class="emoji_stickers_pack_title">${r}</div>`,n&&!vk.widget){let e="emoji_stickers_pack_settings";s&&(e+=" emoji_stickers_pack_settings--new"),a+=`<a class="${e}" href="javascript:void(0);" onclick="Emoji.showProductSettings(${n});" title="${(0,P.getLang)("purchases_stickers_select_style")}">${(0,W.getIcon20GearOutline)().icon}</a>`}if(o&&!vk.widget&&(a+=`\n      <a\n        class="emoji_stickers_pack_settings"\n        href="javascript:void(0);"\n        onclick="Vmoji.showAvatar(${vk.id}, '${o}', ${i});"\n        title="${(0,P.getLang)("purchases_stickers_keyboard_pack_setup")}"\n      >\n        ${(0,W.getIcon20GearOutline)().icon}\n      </a>\n    `),a+='\n    </div>\n    <div class="emoji_stickers_pack_header_aside">',c&&!vk.widget){a+=`\n      <div\n        class="emoji_stickers_pack_peer_info"\n        data-product-id="${i}"\n        ${n&&n!==i?"data-is-style":""}\n      ></div>\n      <a\n        class="emoji_stickers_pack_gift"\n        onclick="Emoji.giftStickerToCurrentPeer(${i}, event, { sticker_referrer: &quot;${de.StickersReferrer.TYPE_STICKERS_KEYBOARD}&quot; });"\n      >\n        ${(0,F.getIcon20GiftOutline)().icon}\n      </a>`}return a+="\n    </div>\n  </div>",a},getVmojiStubHtml:function(e){return`\n    <div class="emoji_vmoji_stub">\n      <div class="emoji_vmoji_create_avatar">\n        <img class="emoji_vmoji_create_avatar__image" src="${e}" alt="" />\n        ${O.FlatButton.render({className:"emoji_vmoji_create_avatar__button",appearance:O.FlatButtonAppearance.TERTIARY,size:O.FlatButtonSize.M,children:(0,P.getLang)("vmoji_keyboard_create_avatar"),restAttrs:{onclick:"Emoji.createVmojiAvatar();"}}).outerHTML}\n      </div>\n    </div>\n  `},mountStickerPackView(e,t){const i=this.opts[e].tt.querySelector(`.emoji_scroll_stickers .${he.STICKER_PACKS_CONTAINER_CLASS}`);if(!i)return;const s=this.renderStickerPackView(e,t);s.parentNode!==i&&i.appendChild(s);const{top:o,bottom:r}=t;s.style.cssText+=`height: ${r-o}px; top: ${o}px;`},showStickerPackView(e,t){const i=this.opts[e],{packViews:s,activePackViews:o}=i,r=s.get(t);r&&r!==o.get(t)&&(this.mountStickerPackView(e,r),o.set(r.id,r))},unmountStickerPackView(e,t){const i=this.opts[e].renderedPackViews.get(t);i&&i.parentNode&&(i.querySelectorAll(".sticker_animation").forEach((e=>{z.StickersAnimation.stopAnimation(e,!0)})),i.parentNode.removeChild(i))},hideStickerPackView(e,t){const i=this.opts[e];this.unmountStickerPackView(e,t),i.activePackViews.delete(t)},resetStickerPackViews(e,t=!1){const i=this.opts[e];he.calcStickerPackViews(e);const s=document.querySelector(`.${he.STICKER_PACKS_CONTAINER_CLASS}`);s&&(s.style.height=i.packViewsTotalHeight+"px");let o=0;if(t){const{packViews:e,activePackViews:t}=i;for(const{id:i,top:s}of e.values()){const e=t.get(i);e&&e.top!==s&&(o=s-e.top)}}he.calcStickerPacksToShowHide(e),o?he.updateStickerPackViews(e,(()=>{i.emojiScroll.scrollTop(i.emojiScroll.data.scrollTop+o)})):he.updateStickerPackViews(e)},calcStickerPacksToShowHide:function(e){const t=this.opts[e];if(!t.emojiScroll)return;const{scrollTop:i,viewportHeight:s}=t.emojiScroll.data,{packViews:o,activePackViews:r}=t;t.packsToShow=new Set,t.packsToHide=new Set([...r.keys()]);for(const{id:e,top:r,bottom:n}of o.values())if(!(n<=i)){if(r>i+s)break;t.packsToShow.add(e),t.packsToHide.delete(e)}},hideStickerPacksViews:function(e){const t=this.opts[e],{packsToHide:i}=t;for(const t of i)this.hideStickerPackView(e,t)},showStickerPacksViews:function(e){const t=this.opts[e],{packsToShow:i}=t;for(const t of i)this.showStickerPackView(e,t)},updateStickerPackViews:function(e,t){he.hideStickerPacksViews(e),he.showStickerPacksViews(e),t&&t(e)},scrollToFirstShownPackTab:function(e){const t=this.opts[e].packsToShow.values().next().value;t&&this.scrollToTab(t,e)},scrollToStickerPackView:function(e,t,i){const s=this.opts[e],o=s.packViews.get(t);o&&s.emojiScroll.scrollTop(o.top,i?0:200)},emojiUIScroll:function(e,t){let i=he.opts[e];(0,w.addClass)(t,"emoji_expanded"),he.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll((0,w.geByClass1)("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,(0,I.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&J.tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i&&(i.curTab==he.TAB_EMOJI?he.updateEmojiCategories(t,i,e):(he.calcStickerPacksToShowHide(e),he.scrollToFirstShownPackTab(e),he.updateStickerPackViews(e)))},onresize:({container:e,data:t})=>{e.style.setProperty("--scroll-viewport-height",t.viewportHeight+"px")}}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},renderStickerViewHtml(e,t,i){const s=i[0],o=i[2],r=i[3],c=i[4],a=i[5]||"",l=this.getStickerReferrer(t,e);let d="";if(n.browser.msie&&!n.browser.msie_edge||!r)d=`<a\n      id="emoji_sticker_item${e}_${t}_${s}"\n      data-opt-id="${e}"\n      data-sticker-id="${s}"\n      data-pack-id="${t}"\n      data-src="${o}"\n      data-fav="${c}"\n      data-fav-hash="${a}"\n      class="emoji_sticker_item sticker_item_${s} ${c?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${s}, ${t}, &quot;${l}&quot;);">\n      <img class="emoji_sticker_image" src="${o}" />\n    </a>`;else{const i=(0,I.rand)(1,1e5);d=`<a\n      id="emoji_sticker_item${e}_${t}_${s}"\n      data-opt-id="${e}"\n      data-sticker-id="${s}"\n      data-pack-id="${t}"\n      data-src="${o}"\n      data-animation-path="${r}"\n      data-uniq-id="${i}"\n      data-fav="${c}"\n      data-fav-hash="${a}"\n      class="emoji_sticker_item sticker_item_${s} ${c?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${s}, ${t}, &quot;${l}&quot;);">\n      <div\n        data-uniq-id="${i}"\n        onmouseenter="StickersAnimation.loadAndPlaySticker(this, true);"\n        class="sticker_animation"\n        data-sticker-id="${s}"\n        data-animation-path="${r}">\n        <img class="sticker_img emoji_sticker_image" src="${o}" />\n      </div>\n    </a>`}return d},renderStickerView:(e,t,i)=>(0,w.se)(he.renderStickerViewHtml(e,t,i)),emojiMove:function(e){let t=he.shownId,i=he.opts[t];if(he.shown&&i&&i.emojiFocused&&i.openedByTabKey){let s=null;if(i.emojiOvered)switch(e.keyCode){case g.KEY.LEFT:s=he.getEmojiEl(i.emojiOvered,"left"),(0,g.cancelEvent)(e);break;case g.KEY.RIGHT:s=he.getEmojiEl(i.emojiOvered,"right"),(0,g.cancelEvent)(e);break;case g.KEY.UP:s=he.getEmojiEl(i.emojiOvered,"up");break;case g.KEY.DOWN:s=he.getEmojiEl(i.emojiOvered,"down");break;case g.KEY.ENTER:if(!he.emojiEnter(t,e))return(0,g.cancelEvent)(e),!1;break;default:return!0}else s=he.getFirstEmojiEl(t);if(s)return he.preventMouseOver=!0,he.emojiOver(t,s),he.scrollToListEl(t,s),!1}return!0},scrollToListEl:function(e,t){let i=he.opts[e];if(!i||!i.emojiScroll)return;let s=t.offsetTop,o=Math.max(s+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,s-30));i.emojiScroll.data.scrollTop!=o&&i.emojiScroll.scrollTop(o)},anim:function(e,t){clearInterval(cur._imAnim);let i=1/(300/13),s=Math.floor(300/13),o=0,r=(0,w.domLC)(e),n=(0,w.domFC)(e),c=t?0:45,a=t?45:0,l=t?1:0,d=t?0:1;cur._imAnim=setInterval((function(){++o;let _=o>=s?a:c+1.95*o*(t?1:-1),u=_-45,m=o>=s?d:l+i*o*(t?-1:1),h=1-m;r.style.WebkitTransform=r.style.OTransform=r.style.transform="rotate("+_+"deg)",n.style.WebkitTransform=n.style.OTransform=n.style.transform="rotate("+u+"deg)",r.style.opacity=m,n.style.opacity=h,o>=s&&(clearInterval(cur._imAnim),(t?w.addClass:w.removeClass)(e,"emoji_smile_on"),r.style.WebkitTransform=r.style.OTransform=r.style.transform=n.style.WebkitTransform=n.style.OTransform=n.style.transform=r.style.opacity=n.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div data-testid="emoji-smile" class="emoji_smile _emoji_btn" title="'+e+'" onmouseenter="return Emoji.show(this, event);" onmouseleave="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:f.emojiToHTML,emojiReplace:f.emojiReplace,emojiRegex:(0,r.emojiRegex)(),getCode:function(e){let t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){let i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},showProductSettings(e){(0,x.previewStickerProduct)(e,{settings:!0})},updatePeerInfo(e,t=!1){const i=he.opts[e];if("im"===cur.module&&cur.gid)return void this.renderPeerInfo(e,null);const s=this.getPeerId();(s!==i.currentPeerId||t)&&(i.currentPeerId=s,s?(i.tt.classList.add("emoji_tt_peer_info_loading"),this.getPeerInfo(s).then((t=>{i.tt.classList.remove("emoji_tt_peer_info_loading"),s===i.currentPeerId&&this.renderPeerInfo(e,t)}))):this.renderPeerInfo(e,null))},renderPeerInfo(e,t){const i=he.opts[e];if(!t)return void i.tt.classList.add("emoji_tt_peer_info_unavailable");i.tt.classList.remove("emoji_tt_peer_info_unavailable");const s=t.product_ids.reduce(((e,t)=>(e[t]=1,e)),{});i.tt.querySelectorAll(".emoji_stickers_pack_peer_info").forEach((e=>{const i=e.dataset.productId;if(s.hasOwnProperty(i)){const i=void 0!==e.dataset.isStyle;e.innerHTML=`\n        <img\n          class="emoji_stickers_pack_peer_info__photo"\n          src="${t.photo}"\n          width="16"\n          height="16"\n          loading="lazy"\n        />\n        <div\n          class="emoji_stickers_pack_peer_info__purchased_icon"\n        >\n          ${(0,V.getIcon12CheckCircleFill)().icon}\n        </div>\n        <div\n          class="emoji_stickers_pack_peer_info__tooltip_overlay"\n          data-tooltip-text="${i?t.tooltip_style:t.tooltip_pack}"\n          onmouseover="Emoji.showPeerInfoTooltip(event);"\n        ></div>\n      `}else e.innerHTML=""}))},showPeerInfoTooltip(e){(0,j.showTooltip)(e.target,{text:e.target.dataset.tooltipText,center:!0,black:!0,shift:[4,8],appendEl:e.target.closest(".emoji_block_cont")})},getTabCont:function(e){he.calcStickerPackViews(e);const t=he.opts[e];return`<div class="${he.STICKER_PACKS_CONTAINER_CLASS}" style="height: ${t.packViewsTotalHeight}px;"></div>`},updateStickersCont:function(e){let t=he.opts[e],i=he.getTabCont(e);(0,w.geByClass1)("emoji_scroll_stickers",t.tt).innerHTML=i},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i){if(null==e)return;let s=he.opts[i],o=s.tt;"number"==typeof e&&(e=(0,w.geByClass1)("emoji_tab_"+e,o)),s.curEmojiCatId=null,t==he.TAB_EMOJI?he.showEmojiTab(i,t,e):he.showStickersTab(i,t,e)},showEmojiTab:function(e,t,i){let s=he.opts[e],o=s.tt,r=(0,w.geByClass1)("emoji_scroll_smiles",o),n=(0,w.geByClass1)("emoji_scroll_stickers",o),c=(0,w.geByClass1)("emoji_cats_title_helper",o);(0,w.hide)(n),(0,w.show)(r),(0,w.show)(c),s.emojiInited||((0,w.val)(r,he.getInitEmojiContent(e)),s.emojiInited=!0),s.imagesLoader&&s.imagesLoader.processLoad(),s.emojiOvered&&s.curTab===he.TAB_EMOJI&&he.emojiOver(e,he.getFirstEmojiEl(e)),s.curTab!=he.TAB_EMOJI&&s.emojiScroll&&s.emojiScroll.scrollTop(0),he.updateRecentEmoji(e),he.updateEmojiCatTitle(e),he.selectTab(e,t,i)},showStickersTab:function(e,t,i){let s=he.opts[e],o=s.tt,r=(0,w.geByClass1)("emoji_scroll_smiles",o),n=(0,w.geByClass1)("emoji_scroll_stickers",o),c=(0,w.geByClass1)("emoji_cats_title_helper",o);if((0,w.hide)(r),(0,w.show)(n),(0,w.hide)(c),he.shouldLoadStickers(t))he.onStickersLoad=function(){he.updateTabsOpt(e,void 0,!1),he.stickers?.[t]||(t=he.TAB_RECENT_STICKERS),he.tabSwitch(t,t,e)},he.stickersLoadingProgress(e,t,i),s.stickersInited=!1,s.curTab=null,he.emojiLoadMore(e);else{const o=window.emojiStickers.find((e=>e[0]===t));o&&o[7]&&(0,M.updateUserProductState)(t,L.UserProductStateKey.IsNew,0,!1).then((()=>{Array.from(document.querySelectorAll(`.emoji_tab_${t}`)).forEach((e=>{e.classList.remove("emoji_tab_is_new")}))})),s.stickersInited||(he.updateStickersCont(e),s.stickersInited=!0),he.calcStickerPackViews(e),he.calcStickerPacksToShowHide(e),he.scrollToStickerPackView(e,t,!0),he.updateStickerPackViews(e),he.selectTab(e,t,i)}s.afterLoad&&(s.afterLoad=0),s.stickersInited&&he.updatePeerInfo(e)},shouldLoadStickers:function(e){let t=he.stickers&&(0,S.clone)(he.stickers);return t&&delete t[he.TAB_RECENT_STICKERS],!window.emojiStickers||!t||(0,I.isEmpty)(t)||!t[e]&&e!=he.TAB_RECENT_STICKERS},getFirstEmojiEl:function(e){let t=he.opts[e],i=(0,w.geByClass1)("emoji_scroll_smiles",t.tt).firstChild;for(;i;){if((0,w.hasClass)(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){let i,s=0,o=e.parentNode,r=0,n=o.firstChild;for(;n&&(r++,n!==e);)n=n.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)i="left"==t?e.previousSibling:e.nextSibling,i||("left"==t?(t="up",r=10):(t="down",r=1));else{if("up"!=t&&"down"!=t)break;{let e=o;for(;e&&(e="up"==t?e.previousSibling:e.nextSibling,e&&!(0,w.hasClass)(e,"emoji_smiles_row")););if(!e)break;if(r&&e){let t=0,s=e.firstChild;for(;s&&t<r;){if(t++,t>=r){i=s;break}s=s.nextSibling}}if(i||!e)break;i="up"==t||r&&"down"==t?e.lastChild:e.firstChild}}if(s++,s>20){(0,c.debugLog)("ERR!!");break}}return i},addRecentSticker(e){const t=this.stickers[this.TAB_RECENT_STICKERS];if(!t)return;const i=this.findPackSticker(e);if(!i)return;const s=t.stickers.findIndex((([t])=>String(t)===String(e)));-1!==s&&t.stickers.splice(s,1),t.stickers.unshift(i);for(const[t,s]of Object.entries(this.opts)){if(s.noStickers)continue;const o=s.renderedPackViews.get(this.TAB_RECENT_STICKERS);if(o){const s=o.querySelector(`[data-sticker-id="${e}"]`)||this.renderStickerView(t,this.TAB_RECENT_STICKERS,i),r=o.querySelector("[data-sticker-id]");r&&r!==s&&r.parentNode.insertBefore(s,r)}if(s.tt){const e=s.tt.querySelector(`.emoji_tab_${this.TAB_RECENT_STICKERS}.unshown`);e&&e.classList.remove("unshown")}he.resetStickerPackViews(t,!s.activePackViews.has(he.TAB_RECENT_STICKERS))}ls.set("recent_stickers",this.stickers[this.TAB_RECENT_STICKERS])},stickerUGCClick:(e,t,i)=>{const s=he.opts[e];Date.now()-s.ttShowT<he.CLICK_DELAY||s.preventDoubleClick&&Date.now()-s.preventDoubleClick<he.CLICK_DELAY||(s.preventDoubleClick=Date.now(),s.onUGCStickerSend?.(t,i),he.hideNewPicker())},stickerClick:function(e,t,i,s,o,r){const n=he.opts[e];if(!(Date.now()-n.ttShowT<he.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<he.CLICK_DELAY)){if(n.preventDoubleClick=Date.now(),!(0,oe.isNewStickerPicker)()&&!o){let e=!0;i&&(e=window.emojiStickers?.find((([e])=>e===i))?.[1]),e&&he.addRecentSticker(t)}n.onStickerSend&&n.onStickerSend(t,s,"animation",r),(0,a.statlogsValueEvent)("stickers_usage",n.ref,t,s),(0,oe.isNewStickerPicker)()?he.hideNewPicker(!0):he.ttHide(e,!1,!1,!0),n.recentSticker=t}},stickerOver:function(e,t){let i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if((0,I.isObject)(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){let s=(cur.tooltips||[]).length,o=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+s,e.image?"":"tt_text_only"];if(o=o.join(" "),!e.show)return;let r={index:s,className:o,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){let t=e.container,i=(0,w.getSize)(e.container)[1];if(i>=225)return;let s=(0,S.intval)((225-i)/2)+10,o=(0,S.intval)((0,w.getStyle)(t,"top",!0))+s;(0,w.setStyle)(t,"top",o)}};(0,w.gpeByClass)("_im_peer_history_w",t)&&(r.appendParentCls="_im_peer_history_w"),(0,j.showTooltip)(t,r)}})},selectPeer:function(e){if(void 0!==e){let t=he.opts[e];if(t.peer)return t.peer}let t=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==t&&cur.wdd.imw_dd){let e=0;for(let i in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(i)&&(t=cur.wdd.imw_dd.selected[i][0],e+=1);e>1&&(t="")}return t},showMyStickers:function(){cur.boxMyStickers=(0,b.showBox)("al_im.php",{act:"stickers_my"},{stat:["im.css",window.jsc("web/imn.js"),window.jsc("web/sorter.js")]})},getSelectedStickersStoreTabId(){const e=document.querySelector("#im_stickers_tabs");if(e){const t=e.querySelector(".ui_tab_sel");if(t){const[,e]=t.parentNode.id.match(/^tbt_stickers_(.*)$/)||[];return e}}},showStickersStore:function(e,t,i={},s={}){const o=new URLSearchParams;t&&o.append("ref",t);const r=`/stickers/catalog${o.size?`?${o.toString()}`:""}`;s?.isOpenInNewWindow?window.open(r,"_blank"):window.nav.go(r),he.hideStickersStoreNotification()},handlePreviewStickerDestroy:function(){const e=new URL(window.location.href);e.pathname.match(/stickers\/.+/)&&window.nav.setLoc(`stickers${e.search}`)},previewSticker:function(e,t,i,s){return e===de.RANDOM_PRODUCT_ID?((0,ie.openStickersRandomSelectorView)({payload:{recipientIds:i?.peerId?[i.peerId]:[],attemptId:i?.randomPackAttemptId},modalBoxOptions:{onDestroy:he.handlePreviewStickerDestroy},ref:i?.sticker_referrer}),(0,g.cancelEvent)(s),!1):((0,te.openStickersLayerView)({product_id:e,sticker_id:i?.stickerId,recipient_ids:i?.giftTo,vmoji_character_id:i?.characterId,reference:i?.sticker_referrer||"stickers_store",modalBoxOptions:{onDestroy:()=>{i?.onDestroy(),he.handlePreviewStickerDestroy()}},onPurchase:async()=>{await Promise.all([he.reloadRecentStickers(),he.reloadPromotedStickerUrls()]),he.updateStickersHints(!0)}}),(0,g.cancelEvent)(s),!1)},getStickerPack(e){if(window.emojiStickers){const t=window.emojiStickers.find((t=>t[he.PACK_FIELD_ID]===e))||null;return Promise.resolve(t)}return new Promise(((t,s)=>{ajax.post("al_im.php",{act:"a_stickers_list"},{onDone(s){i._dG("emojiStickers",s),t(s?he.getStickerPack(e):null)},onFail:()=>(s(),!0)})}))},getClosestTextInput(e){if(e.getAttribute("contenteditable"))return e;const t=e.closest(".js-im-page, .fc_tab, .mv_chat");return t?t.matches(".fc_tab")?t.querySelector(".fc_editable"):t.matches(".js-im-page")?document.querySelector("._im_text"):t.matches(".mv_chat")?t.querySelector(".mv_chat_reply_input"):null:null},showPackInKeyboard(e,t){const i=he.getClosestTextInput(t);if(!i||void 0===i.emojiId)return;const s=he.opts[i.emojiId];(0,oe.isNewStickerPicker)()||he.ttClick(i.emojiId,i.parentNode.parentNode.querySelector("._emoji_btn"),!1,!0);const o=s.tt.querySelector(`.emoji_tab_${e}`),r=void 0!==Object.keys(he.stickers||{}).find((e=>e!==he.TAB_RECENT_STICKERS));r?he.tabSwitch(o,e,i.emojiId):(he.onStickersLoad=()=>he.tabSwitch(e,e,i.emojiId),he.stickersLoadingProgress(i.emojiId,e,o))},clickSticker:function(e,t,i,s={}){if(window.cur.emojiStickersDisabled?.[e])return!0;const{vmoji:o}=s;if(o&&!window.vk.widget){const{avatarOwnerId:i,avatarCharacterId:s}=o;if(!i)return window.vk.widget||he.previewSticker(e,!1,{sticker_referrer:"message"}),!1;if(i===window.vk.id&&t){const o=(0,oe.isNewStickerPicker)()?window.StickerPickerViewer?.api.getPack({productId:e}):he.getStickerPack(e);Promise.all([o,he.getVmojiAvatar()]).then((([o,r])=>{const n=(0,oe.isNewStickerPicker)()?o?.product?.active:Boolean(o?.[he.PACK_FIELD_IS_ACTIVE]);r&&r.character_id===s&&n?(0,oe.isNewStickerPicker)()?window.StickerPickerViewer?.showPack(e,t):he.showPackInKeyboard(e,t):(0,Y.showVmojiAvatar)(i,s,e)}))}else(0,Y.showVmojiAvatar)(i,s,e);return!1}if(t)return(0,se.showPackByClickOnSticker)(e,t),!1;window.vk.widget||he.previewSticker(e,!1,{sticker_referrer:"message"})},stickersLoadingProgress:function(e,t,i){let s=he.opts[e];(0,w.removeClass)((0,w.geByClass1)("emoji_tab_sel",s.tt),"emoji_tab_sel"),(0,w.addClass)(i,"emoji_tab_sel"),(0,w.geByClass1)("emoji_scroll_stickers",s.tt).innerHTML='<div class="emoji_scroll_progress">'+(0,w.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,s,o){if(i){if(O.FlatButton.getAppearance(i)===O.FlatButtonAppearance.SECONDARY)return!0}O.FlatButton.lock(i);return D.Cart.create([e]).order({hash:s,ref:o}).then((e=>{if(O.FlatButton.unlock(i),e&&!e.error){(0,_.showDoneBox)((0,K.getPurchaseResult)(e));try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}cur.boxStickersStore?cur.boxStickersStore.reload():nav.reload({params:{tab:he.getSelectedStickersStoreTabId()},preventScroll:!0})}})),(0,g.cancelEvent)(t)},stickerAct:function(e,t,i,s,o){const r=O.FlatButton.getAppearance(e)===O.FlatButtonAppearance.SECONDARY;if(o&&r)return!0;let n=(o?r:(0,w.hasClass)(e,"_im_sticker_activated"))?1:0,c=cur.tabbedStickersBox;if(c)for(let e in c.tbUpdate)c.tbUpdate.hasOwnProperty(e)&&(c.tbUpdate[e]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:n,from_btn:o?1:0},{onDone:function(i,s,r,c){o||(O.FlatButton.setLabel(e,i),e.onmouseover="",(0,w.setStyle)(e,{width:"auto"}),(0,w.toggleClass)(e,"_im_sticker_activated",!n)),(0,S.each)((0,w.geByClass)("_sticker_btn_"+t),(function(){O.FlatButton.setLabel(this,c),this.onmouseover="";const e=n?O.FlatButtonAppearance.PRIMARY:O.FlatButtonAppearance.SECONDARY;O.FlatButton.setAppearance(this,e)})),he.updateTabs(s,r,!0);let a=e.parentNode.parentNode;if(!o){if(cur.stickersSorter.destroy(),n){(0,w.show)("im_stickers_deact");let e=(0,w.ge)("im_stickers_deact_wrap");e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a),(0,w.setStyle)(a,{cursor:"default"})}else{(0,w.geByTag1)("div","im_stickers_my_wrap").appendChild(a),(0,w.ge)("im_stickers_deact_wrap").childNodes.length||(0,w.hide)("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:()=>O.FlatButton.lock(e),hideProgress:()=>O.FlatButton.unlock(e)}),(0,g.cancelEvent)(s)},getTabsCode:function(e,t){let i=[];e&&i.push.apply(i,e),i.length>1&&(he.hasNewStickers=!1);let o=he.opts[t].forceStickerPack,r="",n="",c="";for(const e of i){const i=e[0],a=e[1],l=e[3],d=e[4]&&i===o,_=e[5];if(!a&&!l&&!d)continue;const u=e[6],m=e[7],h=e[8],g=e[9];let p;if(a||d?(i>0&&-1===he.stickerPacksToLoad.indexOf(i)&&he.stickerPacksToLoad.push(i),p="Emoji.tabSwitch(this, "+i+", "+t+"); return cancelEvent(event);"):p="Emoji.previewSticker("+i+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",e[2]&&(he.hasNewStickers=e[2]),i===he.TAB_VMOJI){r+=`\n        <a class="${(0,s.classNames)(`emoji_tab emoji_tab_${i} emoji_tab--vmoji-stub`,{emoji_tab_sel:cur.stickersTab==i})}" onmousedown="${p}" onclick="return cancelEvent(event);">\n          ${(0,$.getIcon24VmojiOutline)().icon}\n        </a>\n      `}else if(i===he.TAB_RECENT_STICKERS){let e="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+i;cur.stickersTab==i&&(e+=" emoji_tab_sel"),r+='<a class="'+e+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(i===he.TAB_FAVORITE_STICKERS)r+=he.tabs.favoriteTabContent(p,u);else if(i){let e="emoji_tab emoji_tab_img_cont emoji_tab_"+i;(m||h)&&(e+=" emoji_tab_is_new"),cur.stickersTab==i&&(e+=" emoji_tab_sel"),a||d||(e+=" emoji_tab_promo"),g&&(e+=" emoji_tab--vmoji");let t='<a class="'+e+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+_+'" class="emoji_tab_img" /></a>';g?c+=t:d?n=t+n:n+=t}else{let e="emoji_tab emoji_tab_"+i;cur.stickersTab==i&&(e+=" emoji_tab_sel"),a||(e+=" emoji_tab_promo"),r+='<a class="'+e+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+i+'"></div></a>'}}return c&&(c=`<span class="emoji_tabs_group emoji_tabs_group--vmoji">${c}</span>`),r+c+n},updateTabsOpt:function(e,t,i=!0){let s=he.opts[e];if(s.noStickers)return;let o=(0,w.ge)("emoji_tabs_cont_"+e);o&&(o.innerHTML=he.getTabsCode(window.emojiStickers,e)),i&&he.throwTabsScroll(e),he.checkNewStickers(s),void 0!==typeof t&&(s.stickersInited=!!t)},updateTabs:function(e,t,s,o){e&&s&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});let r=0;void 0===t?((0,Q.initStickersKeywords)(),window.stickersKeywordsData||(r=1)):(i._dG("stickersKeywordsData",t),(0,Q.setStickersKeywords)(window.stickersKeywordsData,s)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||o?.noStickers||(0,Z.cachedStickersKeywordsTime)().then((e=>{he.isStickersKeywordsFetching||(he.isStickersKeywordsFetching=!0,ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:r,cache_time:e},{onDone:(...e)=>{he.isStickersKeywordsFetching=!1,he.updateTabs(...e)},onFail:()=>{he.isStickersKeywordsFetching=!1}}))})):i._dG("emojiStickers",e);for(let e in he.opts)he.opts.hasOwnProperty(e)&&he.updateTabsOpt(e,!1);let n=he.stickers&&(0,S.clone)(he.stickers);n&&delete n[he.TAB_RECENT_STICKERS],he.onStickersLoad&&window.emojiStickers&&!(0,I.isEmpty)(n)&&(he.onStickersLoad(),he.onStickersLoad=!1)},showStickersStoreNotification(){Array.from(document.querySelectorAll(".emoji_smile")).filter((e=>!e.querySelector(".emoji_smile_icon_promo"))).forEach((e=>{e.appendChild((0,w.ce)("div",{className:"emoji_smile_icon_promo"}))})),ce.leftMenu.setBadge(ae.PAGE_ID_STICKERS,"prominent")},hideStickersStoreNotification(){document.querySelectorAll(".emoji_smile_icon_promo").forEach((e=>{e.parentNode.removeChild(e)})),ce.leftMenu.removeBadge(ae.PAGE_ID_STICKERS)},checkNewStickers:function(e){let t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(let e in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(e)&&window.emojiStickers[e][2]){he.hasNewStickers=window.emojiStickers[e][2];break}he.hasNewStickers<0&&!he.noNewStickers&&setTimeout((()=>he.showStickersStoreNotification()),(0,w.hasClass)(t,"fc_editable")?200:0)}},giftStickerToCurrentPeer(e,t,i){const s=this.getPeerId();R.Ranges.isUserId(s)||R.Ranges.isChatOrChannelPeer(s)?this.giftSticker(e,s,t,i):this.giftSticker(e,"",t,i)},giftSticker:function(e,t,i,s){return(0,_e.isNewStickersGiftModalEnabled)()?((0,_e.showStickersGiftModal)({giftIds:[(0,_e.convertStickerIdToGiftId)(e)],recipientIds:t?String(t).split(",").map((e=>Number(e))):[],referrer:s.ref,stickerReferrer:s.sticker_referrer||"stickers_store"}),(0,g.cancelEvent)(i)):((0,B.giftStickerProducts)([e],t?String(t).split(",").map((e=>Number(e))):[],{ref:s.sticker_referrer||"stickers_store",gift_ref:s.ref}),(0,g.cancelEvent)(i))},toggleStickers:function(e,t){let i=he.opts[e];i&&(i.noStickers=t,i.tt&&((0,w.toggleClass)(i.tt,"emoji_no_tabs",t),i.curTab&&he.tabSwitch(0,0,e)))},getSizeCached:function(e){return(e=(0,w.ge)(e))?(void 0!==e[he.CACHED_WIDTH_PROP]&&void 0!==e[he.CACHED_HEIGHT_PROP]||(e[he.CACHED_WIDTH_PROP]=e.offsetWidth,e[he.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[he.CACHED_WIDTH_PROP],e[he.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=(0,w.ge)(e))&&(e[he.CACHED_WIDTH_PROP]=void 0,e[he.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e,t=null){const i=he.opts[t];return i&&"stories"===i.ref?he.STICKER_REFERRERS.STORY_KEYBOARD:e===he.TAB_RECENT_STICKERS?he.STICKER_REFERRERS.RECENT:e===he.TAB_FAVORITE_STICKERS?he.STICKER_REFERRERS.FAVORITE:e===he.TAB_NEW_CONVO_STICKERS?he.STICKER_REFERRERS.NEW_CONVO:he.STICKER_REFERRERS.KEYBOARD},render:{stickerHintRs:function(e,t,i){let s=t,o="";const r=s<0;if(s<0)o=window.promotedStickerUrls&&window.promotedStickerUrls[-s];else if(i)o=i[2];else{const e=(0,N.getSticker)(s);e&&(o=(0,A.getStickerImageUrl)(e,64,64))}let c=i?i[3]:"";const a=i?.[7]||[];let l={optId:e,selId:0,stickerId:s,stickerUrl:o,class:r?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+s+", '"+o+"', this)"},d="";return(!n.browser.msie||n.browser.msie_edge)&&c&&o?(d=he.hintsStickerItemAnimation(),l.animationUrl=c,l.class+=" sticker_animation"):a.length?(l.layers=(0,I.escapeAttr)(JSON.stringify(a)),d=(0,le.hintsPopupStickerItem)()):o&&(d=he.hintsStickerItem()),(0,w.rs)(d,l)}},resetStickersCache(){he.stickers={},he.resetVmojiAvatarCache(),cur.boxMyStickers&&(cur.boxMyStickers.isVisible()||cur.boxMyStickers.setOptions({onShow(){cur.boxMyStickers.hide(),he.showMyStickers()}}))},showVmojiAvatar:Y.showVmojiAvatar,createVmojiAvatar:Y.createVmojiAvatar,_vmojiAvatarCache:void 0,getVmojiAvatar:()=>void 0!==he._vmojiAvatarCache?Promise.resolve(he._vmojiAvatarCache):(0,q.vmojiGetAvatar)().then((({avatar:e=null})=>(he._vmojiAvatarCache=e,e))),resetVmojiAvatarCache(){he._vmojiAvatarCache=void 0},__eof:1}},474534:(e,t,i)=>{i.d(t,{getCaretBoundingRect:()=>s});const s=function(e){const t=e.getBoundingClientRect();let i=null,s=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)s=document.selection.createRange(),i=s.getClientRects()||[],i.length||(s.text="_",s.moveStart("character",-1),i=s.getClientRects(),s.text=""),i=i[i.length-1];else if(window.getSelection){const e=getSelection();if(e.anchorNode){if(s=e.getRangeAt(0),s.collapsed){const e=s.startOffset;s.setStart(s.startContainer,0),i=s.getClientRects(),s.setStart(s.startContainer,e)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}},405404:(e,t,i)=>{i.d(t,{EMOJI_SECTIONS_CODES:()=>r});var s=i(261347);const o={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},r=Object.keys(o).reduce(((e,t)=>(e[t]=o[t].map((e=>(0,s.emojiSymbolToByteHex)(e))),e)),{})},791233:(e,t,i)=>{i.d(t,{StickersAnimation:()=>o.StickersAnimation});var s=i(351118),o=i(437045);o.StickersAnimation.init({animatorLoader:()=>(0,s.asyncImportLoader)((()=>Promise.all([i.e(23666),i.e("langs/web/rlottie")]).then(i.bind(i,804046)).then((({LottieManager:e})=>e))))})},45992:(e,t,i)=>{i.d(t,{default:()=>h});var s=i(641608),o=i(458840);const r=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],n=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],c=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],a=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],l=new RegExp(`(${a.join(")|(")})`);function d(e,t){return"amount"===e?function(e){const t=e.match(l);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}const _=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...r,...n,...c,...a].join("|")}))+)\\s*$`),u=new RegExp(`(${r.join("|")})|(${n.join("|")})|(${c.join("|")})|(${a.join("|")})`,"gi"),m={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e,t=0){let i=e.toLowerCase().replace(/ё/g,"е").match(_);if(i){const t={input:e,request:i[1],send:i[2],context:i[3]};for(;i=u.exec(t.context),i;){const e={receiver:i[1],subject:i[2],method:i[3],amount:i[4]};for(const[i,s]of Object.entries(e))s&&(t[i]=d(i,s))}if(t.subject||t.method||t.amount)return t}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i,r=0,n={}){if(this.introViewed){const o=[e,t,i,r].join("_");s.MoneyTransfer.showMoneyTransferBox({tab:i,amount:r,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===o},void 0,(()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=n.onSendStart)})),this.lastBoxId=o}else(0,o.showWiki)({w:"moneysend_promo",fromId:e,toId:t,action:i,...r?{amount:r}:{}}),this.introViewed=!0}},h=m},608919:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{tooltips:()=>tooltips});var _shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(898848),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(972332),_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(939646),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(478752),_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(754866),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(237625);const tooltips={show:function(el,options){if(window.AudioPage&&window.AudioPage.forceFix&&window.AudioPage.forceFix(),el.hidetimer)return el.hidetimer&&clearTimeout(el.hidetimer),void(el.hidetimer=0);if(!el.tt)return;if("object"==typeof el.tt&&(el.tt.shown=!1),el.ttimer&&clearTimeout(el.ttimer),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(options.text)){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domByClass)(el.tt.container,"tt_text");if(e){const t=options.text();if(!t)return;e.innerHTML=t}}const opts=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(el.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(el.tt.opts):{},options||{}),isNewTT=void 0!==opts.dir;if(!el.tt.el)return el.tt="show",void(el.ttimer=setTimeout((function(){if(el.tt.el)return opts.showdt=0,void tooltips.show(el,opts);el.tt="shownow"}),opts.showdt||0));let canshow;if(opts.js){const evalString="(function(){return function(){var tip=this;"+opts.js+"};})()";try{const evalResult=eval(evalString),evalApply=evalResult.apply(el.tt);canshow=!1!==evalApply}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,evalString)}}else canshow=!0;canshow&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(el.tt.container)?el.tt.showing||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(el.tt.container,{opacity:1},void 0!==opts.showsp?opts.showsp:200):el.ttimer=setTimeout((function(){const e=el.tt.container;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e))return;const t=opts.forcexy?opts.forcexy:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(el),i=opts.forcesize?opts.forcesize:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(el,!1,!0);let s=opts.toup;const o=vk.rtl&&!opts.asrtl||opts.asrtl&&!vk.rtl,r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("page_header_wrap")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(el,"page_layout")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("page_header_wrap"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("ads-app-header")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("ads-app-header"):[0,0];if(!i[0]&&!i[1])return void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container);e.style.opacity=0,opts.width&&(e.style.width="auto"===opts.width?"auto":opts.width+"px"),opts.maxWidth&&(e.style["max-width"]=opts.maxWidth+"px"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e),isNewTT||(e.firstChild.className="toup"+(opts.toup?1:""));let n=opts.shift;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(n)&&(n=n()),void 0!==n&&2==n.length&&n.push(n[1]);let c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e);const a=document.body.scrollTop||htmlNode.scrollTop||0;let l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e);const d=t[1]-l[1]-n[1]-r[1]-a,_=lastWindowHeight-(t[1]+i[1]+l[1]+n[2])+a,u=d<0,m=_<0;let h=d<0;u&&m?(d>_&&d+a>0&&(s=!0,h=!1),s&&h?s=!1:s||!m||h||(s=!0)):s&&u?s=!1:s||!m||u||(s=!0);let g=opts.needLeft||(opts.black||opts.checkLeft)&&window.lastWindowWidth&&lastWindowWidth-(t[0]+(o?i[0]+n[0]:l[0]-n[0]))<1,p="";opts.forceright&&(g=0),opts.forcetodown&&(s=!1),opts.forcetoup&&(s=!0),isNewTT?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_down"),p=opts.dir&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["up","down","left","right"])?"tt_"+opts.dir:"tt_"+(s?"down":"up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,p),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.toggleClass)(e,"toleft",!!g),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)):(p="toup"+(s?1:""),(s!=opts.toup||g)&&(p+=g?" toleft":"",l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)),e.firstChild.className=p,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,s?"tt_toup":""));const f=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(c);if(t[0]-=f[0],t[1]-=f[1],el.tt.zIndexEls=[],!opts.noZIndex)for(;c&&c!=document.body&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(c,"scroll_fix");){const e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getStyle)(c,"zIndex")),t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(c.ttCount);if(e&&!t)break;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(c,"zIndex",opts.zIndex||100),el.tt.zIndexEls.push(c),c.ttCount=t+1,c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(c)}let k;k=isNewTT?!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["left","right"])||opts.forcetoup||opts.forcetodown?s?t[1]-(l[1]+n[1]):t[1]+i[1]+n[2]:t[1]-Math.floor(l[1]/2)-n[1]:t[1]+(s?-(l[1]+n[1]):i[1]+n[2]);const S=k+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slide)*(s?-1:1);let w=t[0]+(o?n[0]+i[0]-l[0]:s?-n[0]:-(n[3]||n[0]));g&&(w-=(l[0]-(opts.reverseOffset||39))*(o?-1:1)),opts.center&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,"tocenter"),l[0]!=i[0]&&(w-=o?0:(l[0]-i[0])/2));const E=w+(o?-1:1)*(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slideX);if(opts.showIfFit&&(w+f[0]<0||w+f[0]+l[0]>lastWindowWidth||k+f[1]<0||k+f[1]+l[1]>lastWindowHeight))return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container);el.tt.showing=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e,{top:S,left:E});const v={opacity:1};E!=w&&(v.left=w),S!=k&&(v.top=k),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(e,v,void 0!==opts.showsp?opts.showsp:200,(function(){el.tt&&el.tt.showing&&(el.tt.showing=!1),opts.onShowEnd&&opts.onShowEnd(),"object"==typeof el.tt&&el.tt&&(el.tt.shown=!0)})),opts.onShowStart&&opts.onShowStart(el.tt)}),opts.showdt||0))},clearZindex:function(e){e.tt&&e.tt.opts&&e.tt.zIndexEls&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e.tt.zIndexEls,(function(){const e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(this.ttCount);e<=1?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(this,"zIndex",""),this.ttCount=0):this.ttCount=e-1}))},hide:function(e,t){if("shownow"!==e.tt){if(e.tt&&"object"==typeof e.tt&&(e.tt.shown=!1),(t||{}).fasthide)return clearTimeout(e.hidetimer),clearTimeout(e.ttimer),e.hidetimer=0,e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);e.hidetimer||(e.hidetimer=setTimeout((function(){if(e.hidetimer=0,clearTimeout(e.ttimer),!e.tt||"hide"==e.tt||e.tt.el&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e.tt.container))return e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);const i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(e.tt.opts):{},t||{});e.tt.el?e.ttimer=setTimeout((function(){i.hasover||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"none"}),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.fadeOut)(e.tt.container,void 0!==i.showsp?i.showsp:200,(function(){e.tt&&e.tt.container&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"auto"}),tooltips.clearZindex(e)})),i.onHide&&i.onHide()}),i.hidedt||0):e.tt="hide"}),1))}},hideAll:function(e){if(cur.tooltips)for(let t=0;t<cur.tooltips.length;++t){const i=cur.tooltips[t];e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(i.el,e)||(i.opts.forceNoHide||(i.el&&i.el.ttimer&&clearTimeout(i.el.ttimer),i.hide({fasthide:!0})))}},rePositionTT:function(e){if(!e)return;const t=e.opts,i=e.el,s=e.container,o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(i),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(i,!1,!0);if(!r[0]&&!r[1])return;const n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(s),c=t.needLeft||t.black&&lastWindowWidth&&lastWindowWidth-(o[0]+n[0])<1,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(s.firstChild,"toup1")||t.toup||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(s,"tt_down");let l=t.shift;const d=vk.rtl&&!t.asrtl||t.asrtl&&!vk.rtl;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(l)&&(l=l());const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(s));o[0]-=_[0],o[1]-=_[1];let u=o[0]+(d?l[0]+r[0]-n[0]:a?-l[0]:-(l[3]||l[0]));c&&(u-=n[0]-39),t.center&&n[0]!=r[0]&&(u-=(n[0]-r[0])/2);const m=o[1]+(a?-(n[1]+l[1]):r[1]+l[2]);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(s,{left:u,top:m})},rePositionAll:function(){if(cur.tooltips)for(let e=0;e<cur.tooltips.length;++e){const t=cur.tooltips[e].opts;t&&(t.nohideover||t.nohide)&&tooltips.rePositionTT(cur.tooltips[e])}},destroy:function(e){if(e){if(clearTimeout(e.ttimer),clearTimeout(e.hidetimer),e.tt&&e.tt.el){if(e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.cleanElems)(e.tt.container),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"click",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(window,"scroll",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(document,"click",e.tthide),e.tt.container){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e.tt.container);t&&t.removeChild(e.tt.container)}tooltips.clearZindex(e),e.tt.el=!1}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeAttr)(e,"tt","tthide","ttimer","hidetimer")}},destroyAll:function(e){if(cur.tooltips){for(let t=0;t<cur.tooltips.length;++t)e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(cur.tooltips[t].el,e)||cur.tooltips[t].destroy();e||delete cur.tooltips}},create:function(e,t){let i;void 0!==t.shift&&2==t.shift.length&&t.shift.push(t.shift[1]);const s=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({shift:t.black?[11,8,8]:void 0!==t.dir?[2,8,8]:[2,3,3],toup:!0},t);t.black&&!s.dir&&(s.dir="auto",s.typeClass="tt_black"),e.tthide||(e.tthide=tooltips.hide.pbind(e),t.nohide||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(window,"scroll",e.tthide),t.hideOnTooltipContainerClick||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"click",e.tthide),t.hasover||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(document,"click",e.tthide)));const o=s.no_shadow?" tt_no_shadow":"";if(!s.content){if(e.tt&&!s.force)return e.hidetimer?(clearTimeout(e.hidetimer),void(e.hidetimer=0)):void 0;if(!s.text){if(!s.url)return;return clearTimeout(e.ttimer),void(e.ttimer=setTimeout((function(){e.tt="show",ajax.post(s.url,s.params||{},{onDone:function(t,i){const o=e.tt,r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(s);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(r,{content:t||"",js:i}),tooltips.create(e,r),"shownow"==o&&tooltips.show(e,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(r,{showdt:0}))},onFail:function(){return!0},cache:s.cache||0}),tooltips.show(e,s)}),s.ajaxdt||0))}s.content='<div class="tt_text">'+((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(s.text)?s.text():s.text),s.link&&(s.content+='<br /><a style="display: flex; margin-top: 8px" target="_blank" href="'+s.link.link+'">'+s.link.text+"</a>"),s.content+="</div>"}let r;r=void 0!==s.dir?"tt_w":"tt";const n=r+" "+(void 0!==s.dir?s.typeClass||"tt_default":"")+" "+(s.className||"");if(e.tt&&e.tt.el){const i=e.tt.container;e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.geByClass1)("wrapped",i).innerHTML=s.content,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt,{opts:s,show:tooltips.show.pbind(e,t)}),i.className=n,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(i)}else{let r;r=s.black?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:s.content,className:n},{display:"none"}):void 0!==s.dir?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:'<div class="wrapped">'+s.content+"</div>",className:n+o},{display:"none"}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:`<table cellspacing="0" cellpadding="0">\n    <tr><td colspan="3" class="tt_top"><div class="top_pointer"></div></td></tr>\n    <tr>\n      <td class="side_sh"></td>\n      <td class="outer"><table cellspacing="0" cellpadding="0">\n        <tr><td class="side_sh"></td>\n          <td class="wrapped">${s.content}</td>\n        <td class="side_sh"></td></tr>\n        <tr><td colspan="3"><div class="bottom_sh"></div></td></tr>\n      </table></td>\n      <td class="side_sh"></td>\n    </tr>\n    <tr><td colspan="3" class="tt_bottom"><div class="bottom_sh"></div><div class="bottom_pointer${o}"></div></td></tr>\n  </table>`,className:n},{display:"none"});let c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e);if(t.appendEl)c=t.appendEl;else if(t.appendParentCls)c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)(t.appendParentCls,c);else if(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_w",c)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_default",c),!c)do{c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosestPositioned)(c||e,{noOverflow:!0})}while((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(c,"tt_noappend"));c||(c=document.body),c.appendChild(r),i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({el:e,opts:s,show:tooltips.show.pbind(e,t),hide:e.tthide,destroy:tooltips.destroy.pbind(e),container:r},s.tip||{}),s.nohideover||s.text&&!s.hasover||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(r,"mouseover",i.show),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(r,"mouseout",i.hide)),s.hideOnTooltipContainerClick&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(r,"click",i.hide),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(i.container,"fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(i.container,{position:"absolute"}),e.tt=i,cur.tooltips||(cur.tooltips=[]),cur.tooltips.push(i)}s.init&&s.init(i)},addAudio:function(e,t,i,s){ajax.post("audio.php",{act:"a_add",oid:t,aid:i,hash:s},{onDone:function(){e.parentNode.replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{className:"fl_r add_audio_plus done"}),e)},onFail:function(){return!0},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.nextSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.previousSibling)},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.previousSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.nextSibling)}})}}},353679:(e,t,i)=>{i.d(t,{DEFAULT_CACHE:()=>a,ORDER_ERRORS:()=>d,ORDER_ITEM_ERRORS:()=>_,SAMPLE_RECIPIENT_ID:()=>l,STICKER_ANIMATION:()=>c,STICKER_IMAGE:()=>n,STICKER_PACK_ICON:()=>o,STICKER_PACK_THUMB:()=>r});var s=i(612831);const o={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},r={"102_png":{id:"102.png",width:102,height:102,theme:s.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:s.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:s.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:s.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:s.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:s.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:s.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:s.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:s.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:s.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:s.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:s.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},n={"64_png":{id:"64.png",width:64,height:64,theme:s.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:s.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:s.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:s.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:s.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:s.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:s.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:s.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:s.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:s.Theme.DARK}},c={[s.Theme.LIGHT]:"animation.json",[s.Theme.DARK]:"animation.b.json"},a={products:(0,s.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},l=-1;var d=function(e){return e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items",e}({}),_=function(e){return e.DUPLICATE_PRODUCT="duplicate_product",e}({})},612831:(e,t,i)=>{i.d(t,{ProductsByType:()=>_,Theme:()=>s,UserProductStateKey:()=>c,createProductsMap:()=>n,imageSizeCache:()=>r,imageSizesIndex:()=>o,isBasePack:()=>a,isPackProduct:()=>d,isStyleProduct:()=>l});var s=function(e){return e.LIGHT="light",e.DARK="dark",e.DEFAULT="light",e}({});const o=Symbol(),r=Symbol(),n=e=>new Map(e);var c=function(e){return e.IsNew="is_new",e}({});const a=e=>void 0!==e.sticker_ids,l=e=>void 0!==e.base_id,d=e=>a(e)&&!l(e);class _{add(e){e&&(d(e)?this.pack.add(e):l(e)&&this.style.add(e))}getPack(){return this.pack.values().next().value}getStyles(){return Array.from(this.style.values())}getCount(){return this.pack.size+this.style.size}constructor(e=[]){this.pack=new Set,this.style=new Set,e.forEach((e=>this.add(e)))}}},847771:(e,t,i)=>{i.d(t,{getStickerAnimationUrl:()=>d,getStickerImageUrl:()=>l,getStickerPackIconUrl:()=>_,isSampleOrderItem:()=>u,logStickersError:()=>m});var s=i(612831),o=i(353679),r=i(298077);const n=(e,t,i,o=s.Theme.DEFAULT)=>{const r=window.devicePixelRatio,n=[t*=r,i*=r,o].toString();let c=e[s.imageSizeCache];if(c&&c.has(n)){const e=c.get(n);if(e)return e}c||(c=new Map,e[s.imageSizeCache]=c);const a=(e=>{let t=e[s.imageSizesIndex];return t||(t=Object.values(e).sort(((e,t)=>e.width-t.width||e.height-t.height)),e[s.imageSizesIndex]=t),t})(e).filter((e=>!e.theme||e.theme===o)),l=a.find((e=>e.width>=t&&e.height>=i))||a[a.length-1];return c.set(n,l),l},c=(e,t,i=s.Theme.DEFAULT)=>n(o.STICKER_IMAGE,e,t,i),a=(e,t)=>e.image.base_url+"/"+t.id+(e.image.version?`?${e.image.version}`:"");function l(e,t,i,o=s.Theme.DEFAULT){if(e.render?.images){const{images:s}=e.render;let r;s.sort(((e,t)=>e.width-t.width||e.height-t.height));for(const e of s)if(e.width>=t&&e.height>=i){if(e.theme===o)return e.url;r=e}if(r)return r.url}return a(e,c(t,i,o))}const d=(e,t=s.Theme.DEFAULT)=>e.animation?e.animation.base_url+"/"+o.STICKER_ANIMATION[t]+(e.animation.version?`?${e.animation.version}`:""):"",_=(e,t,i,r=s.Theme.DEFAULT)=>((e,t)=>e.icon.base_url+"/"+t.id+(e.thumb.version?`?${e.thumb.version}`:""))(e,((e,t,i=s.Theme.DEFAULT)=>n(o.STICKER_PACK_ICON,e,t,i))(t,i,r)),u=e=>e.recipient_id===o.SAMPLE_RECIPIENT_ID,m=e=>{(0,r.logError)(new Error(`Stickers: ${e}`),{environment:"stickers"})}},33732:(e,t,i)=>{i.d(t,{POPUP_STICKER_CLASS:()=>r,POPUP_STICKER_ICON_CLASS:()=>n,POPUP_STICKER_ICON_CLASS_ANIMATED:()=>c,POPUP_STICKER_ICON_CLASS_ROTATED:()=>a,POPUP_STICKER_WRAPPER_CLASS:()=>s,POPUP_STICKER_WRAPPER_CLASS_ANIMATION_IS_PLAYING:()=>o,STICKER_CLASS:()=>l,StickersSettingsApiMethods:()=>d});const s="popupStickerWrapper",o="popupStickerWrapperAnimationIsPlaying",r="popupSticker",n="popupStickerIcon",c="popupStickerIconAnimated",a="popupStickerIconRotated",l="stickerImageWrapper",d={getSettings:"stickers.getSettings",setPopupSettings:"stickers.setPopupSettings"}},590162:(e,t,i)=>{i.d(t,{$isBuying:()=>c,buyFx:()=>n});var s=i(146322),o=i(636843),r=i(459350);const n=o.stickers.createEffect((async e=>{const t=window.Stickers.Cart.create([r.RANDOM_PRODUCT_ID]);await t.load();let i=null;try{i=await t.order({v:s.API_VERSION,ignoreEmptyError:!0,emptyErrorLoader:!1,randomStickerPackAttemptId:e.attemptId,ref:e.ref,gift_ref:e.ref})}catch{}return i&&i.random_selector_result&&!i.error?i:null})),c=o.stickers.createStore(!1).on(n,(()=>!0)).on(n.finally,(()=>!1))},459350:(e,t,i)=>{i.d(t,{RANDOM_PRODUCT_ID:()=>s,StickersGroup:()=>r,StickersReferrer:()=>n,UGC_STICKERS_APP_ID:()=>o});const s=10101,o=51538586;var r=function(e){return e.LAYER="layer",e}({}),n=function(e){return e.TYPE_STICKERS_KEYBOARD="stickers_keyboard2",e}({})},865014:(e,t,i)=>{i.d(t,{openRandomSelectorPacksModal:()=>s});const s=i(636843).stickers.createEvent()},522267:(e,t,i)=>{i.d(t,{openRandomSelectorResultModal:()=>s});const s=i(636843).stickers.createEvent()},554638:(e,t,i)=>{i.d(t,{isEndsWithBr:()=>c,isEndsWithEmoji:()=>n,isHintsOfMentionsOpen:()=>o,saveCaretPosition:()=>r});var s=i(754866);const o=e=>{const t=(0,s.data)(e,"composer");return t?.wdd&&(0,s.isVisible)(t.wdd.listWrap)},r=()=>{const e=window.getSelection?.(),t=e?.rangeCount?e.getRangeAt(0):null;if(!t)return null;const i={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset};return()=>{const e=window.getSelection?.();if(!e)return;e.removeAllRanges();const t=document.createRange();t.setStart(i.startContainer,i.startOffset),t.setEnd(i.endContainer,i.endOffset),e.addRange(t)}},n=e=>"IMG"===e?.endContainer?.nextSibling?.nodeName,c=e=>"BR"===e?.endContainer?.nextSibling?.nodeName},719361:(e,t,i)=>{i.d(t,{cachedStickersKeywordsTime:()=>d,getStickerKeywordsCacheData:()=>a,setStickerKeywordsCacheData:()=>l});var s=i(77783),o=i(469004),r=i(298077);const n="stickers_keywords";const c=function(){if(!(()=>{let e=!1;try{indexedDB}catch(t){if("SecurityError"!==t.name)throw t;e=!0}return"indexedDB"in window.self&&!e})())return null;try{return(0,s.createStore)("emoji-db-v1","emoji-cache")}catch(e){return(0,r.logError)(new Error("Failed to open indexedDB for StickersCache...")),null}}();function a(){return c?(0,s.get)(n,c):Promise.resolve(o.ls.get(n))}function l(e){return c?(0,s.set)(n,e,c).then((()=>{o.ls.remove(n)})):Promise.resolve(o.ls.set(n,e))}function d(){return a().then((e=>{const t=e?.time||0;return Math.floor(t/1e3)}))}},66087:(e,t,i)=>{i.d(t,{initStickersKeywords:()=>l,setStickersKeywords:()=>d});var s=i(754866),o=i(719361),r=i(898848),n=i(469004);let c=null;function a(){return c?Promise.resolve(c):Promise.resolve().then(i.bind(i,489245)).then((e=>(c=e.Emoji,c)))}function l(){window.stickersKeywordsData?d(window.stickersKeywordsData):(0,o.getStickerKeywordsCacheData)().then((e=>{e&&a().then((t=>{const{keywords:s,time:o}=e;o>(0,r.vkNow)()-t.stickersKeywordsExpire&&i._dG("stickersKeywordsData",s),window.stickersKeywordsData&&d(window.stickersKeywordsData)}))}))}function d(e,t){if(!e)return;i._dG("stickersKeywords",{});let c="";const l=e.reduce(((e,t)=>{const{user_stickers:i,promoted_stickers:s}=t;let{words:o}=t;const n=s.map((e=>-e)),a=i.concat(n);return Array.isArray(o)||(o=[...Object.values(o)]),o.forEach((t=>{c+="\n"+(0,r.htsc)(t),e.push(a)})),e}),[]);c=function(e){const t=document.createElement("div");return(0,s.val)(t,e),t.textContent||t.innerText}(c),c&&c.slice(1).split("\n").forEach(((e,t)=>{window.stickersKeywords[e]=l[t]})),a().then((e=>{if(!e.stickers[e.TAB_RECENT_STICKERS]){let t=n.ls.get("recent_stickers");t&&(e.stickers[e.TAB_RECENT_STICKERS]=t)}})),t&&(0,o.setStickerKeywordsCacheData)({time:(0,r.vkNow)(),keywords:e}).then((()=>{a().then((e=>{e.updateStickersHints(!0)}))}))}},227564:(e,t,i)=>{i.d(t,{moveStickersHintsToStickerPicker:()=>o});const s="StickersHints__marginTransition",o=(e,t)=>{const i=window.Emoji.opts[e];if(!i?.txt)return;const o=i.txt.parentNode.querySelector("._sticker_hints");if(!o)return;if(!("none"!==getComputedStyle(o).getPropertyValue("display")))return;t&&(o.classList.add(s),requestAnimationFrame((()=>o.classList.remove(s)))),o.style.setProperty("margin-left","0px");const{right:r}=o.getBoundingClientRect();if(window.StickerPickerViewer){const{isShown:e,isDown:t,wrapper:i}=window.StickerPickerViewer;if(!e||!i||t)return;const s=-(r-i.getBoundingClientRect().left+10);o.style.setProperty("margin-left",`${s}px`)}}},430127:(e,t,i)=>{i.d(t,{POPUP_STICKER_HINT_ICON_CLASS:()=>o,POPUP_STICKER_ICON:()=>s,POPUP_TQ_CLICK_RUN_ANIMATION:()=>r,TQ_DATA_IS_LOCAL_RENDER:()=>l,TQ_DATA_MESSAGE_ID:()=>c,TQ_DATA_OBJECT_LAYERS_KEY:()=>n,TQ_DATA_Z_INDEX_MOUNT_NODE:()=>a});const s=(0,i(35245).getIcon12Play)().icon,o="popupStickerHinticon",r="Stickers/run_popup_animation_on_click",n="stickerLayers",c="stickerMessageId",a="zIndexMountNode",l="isLocalRender"},238681:(e,t,i)=>{i.d(t,{hintsPopupStickerItem:()=>n});var s=i(614098),o=i(430127),r=i(33732);const n=()=>`\n  <a \n    id="emoji_sticker_item%optId%_%selId%_%stickerId%"\n    data-pack-id="%selId%"\n    data-sticker-layers="%layers%" \n    data-sticker-id="%stickerId%" \n    class="emoji_sticker_item %class%" \n    onclick="%onclick%" \n    onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)">\n      <img class="emoji_sticker_image" src="%stickerUrl%" />\n      <div class="${s.STICKER_ICON_CLASS} ${r.POPUP_STICKER_ICON_CLASS} ${o.POPUP_STICKER_HINT_ICON_CLASS}">${o.POPUP_STICKER_ICON}</div>\n  </a>\n`},505949:(e,t,i)=>{i.d(t,{initNewStickerPicker:()=>a,isStickerPickerOpen:()=>n.isStickerPickerOpen,setUserEnvForStickerPicker:()=>l});var s=i(528079),o=i(565703),r=i(224194),n=i(382528);let c=0;const a=async()=>{if(!(window.StickerPickerViewer||(c++,c>3)))try{const{StickerPickerViewer:e}=await Promise.all([i.e(91498),i.e(89631),i.e(762),i.e(96851),i.e(5375),i.e(89887),i.e(14262),i.e(7743),i.e(94160),i.e(36502),i.e("langs/web/NewStickerPicker")]).then(i.bind(i,131554));i._dG("StickerPickerViewer",new e)}catch{setTimeout((()=>{a()}),3e3)}},l=()=>{(0,s.setUserEnv)({[o.STICKERS_CONFDATA_KEY.UGC]:(0,o.isUGCStickersEnabled)(),[o.STICKERS_CONFDATA_KEY.PROMO_VMOJI_COUNTER]:!0,sticker_picker_fast_select_pack:!0,"stickers.popup":(0,r.isPopUpStickersEnabled)(),static_updates_manager_in_sticker_picker:!0})}},737970:(e,t,i)=>{i.d(t,{IS_OPEN_BODY_SELECTOR:()=>s});const s="StickerPickerIsOpen"},382528:(e,t,i)=>{i.d(t,{isStickerPickerOpen:()=>o});var s=i(737970);const o=()=>window.document.body.classList.contains(s.IS_OPEN_BODY_SELECTOR)},996849:(e,t,i)=>{i.d(t,{checkStopActionOnEventOnSticker:()=>_,checkStopActionOnEventOnStickerPopupIcon:()=>d,previewSticker:()=>n,showPackByClickOnSticker:()=>c,wrapSticker:()=>l});var s=i(614098),o=i(565703),r=i(33732);const n=(e,t,i)=>window.Emoji.previewSticker(e,!1,{sticker_referrer:i??"message",randomPackAttemptId:t}),c=(e,t)=>{(0,o.isNewStickerPicker)()?window.StickerPickerViewer?.api.getPack({productId:e}).then((i=>{Boolean(i?.product?.active)?window.StickerPickerViewer?.showPack(e,t):n(e)})).catch((()=>{n(e)})):window.Emoji.getStickerPack(e).then((i=>{Boolean(i&&i[window.Emoji.PACK_FIELD_IS_ACTIVE])?window.Emoji.showPackInKeyboard(e,t):n(e)}))},a=e=>`stickerSize${e}`,l=({stickerHtml:e,stickerWrapperClass:t="",icon:i,iconClass:o,size:r,iconTqAttrs:n})=>{const c=i?`<div class="${s.STICKER_ICON_CLASS} ${o}" ${n}>${i}</div>`:"";return`\n  <div class="${[s.STICKER_ROW_CLASS,t,a(r)].join(" ")}">\n    ${e}\n    ${c}\n  </div>\n`},d=e=>{const t=e?.target;return!!t?.closest("."+r.POPUP_STICKER_ICON_CLASS)},_=e=>{const t=e?.target;return!!t?.closest("."+s.STICKER_ROW_CLASS)||(!!t?.closest("."+r.POPUP_STICKER_WRAPPER_CLASS)||!!d(e))}},944041:(e,t,i)=>{i.d(t,{getCache:()=>a,getPackByStickerId:()=>m,getSticker:()=>d,getStickers:()=>_,updateCache:()=>l});var s=i(761520),o=i(353679),r=i(612831),n=i(469004),c=i(177838);const a=()=>{if(!window.stickersCache){const e=n.ls.get("stickers_cache");i._dG("stickersCache",{...o.DEFAULT_CACHE,...e})}return window.stickersCache},l=e=>{i._dG("stickersCache",{...a(),...e})},d=e=>a().stickers.get(e),_=e=>{const{stickers:t}=a();return e.map((e=>t.get(e)))},u=e=>{const t=d(e);if(!t||!t.pack_id)return null;const i=(0,c.getProductFromCache)(a,t.pack_id);return i&&(0,r.isBasePack)(i)?i:null},m=e=>{const t=u(e);return t?Promise.resolve(t):new Promise((t=>{s.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone(s){Promise.resolve().then(i.bind(i,440487)).then((({cacheProductsData:e})=>{e(s)})),t(u(e))},onFail:e=>(console.error(e),t(null),!0)})}))}},416577:(e,t,i)=>{i.d(t,{Cart:()=>d});var s=i(761520),o=i(433409),r=i(353679),n=i(440487),c=i(177838),a=i(944041),l=i(246429);class d{static create(e,t=[]){const i=e.map((e=>({product_id:e,amount:1})));return new d(i,t)}copy(){const e=new d(this.getItems(),this.getRecipientIds());return e.setOrder(this.getOrder()),e}getItems(){return Array.from(this.items.values())}setItems(e){this.items=new Map(e.map((e=>[e.product_id,e])))}loadItems(){const e=Array.from(this.items.keys());return(0,n.getProducts)(e).then((()=>{for(const e of Array.from(this.items.values()))e.product=(0,c.getProductFromCache)(a.getCache,e.product_id)}))}getProducts(){return(0,n.getProductsFromCache)(Array.from(this.items.keys()))}hasProduct(e){return this.items.has(e)}addProduct(e,t=!1){if(!this.hasProduct(e)){const i={product_id:e,amount:1};t?this.setItems([...this.getItems(),i]):this.setItems([i,...this.getItems()]),this.onChange&&this.onChange()}}removeProduct(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())}getRecipientIds(e=!1){return this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[r.SAMPLE_RECIPIENT_ID]:[]}setRecipientIds(e){this.recipientIds=new Set(e)}hasRecipientId(e){return this.recipientIds.has(e)}addRecipientId(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())}removeRecipientId(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())}setOrder(e){if(this._order=e,e){this.recipientIds.clear();for(const t of e.items)t.recipient_id!==r.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(t.recipient_id)}}loadOrder(e){const t=e.items.map((e=>e.product_id));return(0,n.getProducts)(t).then((t=>({...e,items:e.items.map(((e,i)=>({...e,product:t[i]})))})),(()=>e))}getOrder(){return this._order}getRecipientsMap(){return this.recipients}getRecipients(){return Array.from(this.recipients.values())}getRecipientById(e){return this.recipients.get(e)}addRecipients(e){this.recipients=new Map([...this.getRecipients(),...e].map((e=>[e[0],e])))}getJSON(){return JSON.stringify({items:this.getItems().map((e=>({...e,product:void 0}))),recipient_ids:this.getRecipientIds(!0)})}isLoaded(){return null!==this.getOrder()}cancelLoad(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)}load(e=!1){return this.cancelLoad(),new Promise((t=>{this.loadTimeout=window.setTimeout((()=>{this.loadCancellationToken=new o.AjaxCancellationToken,s.ajax.post("stickers.php",{act:"preview_products_order",cart:this.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:this.loadCancellationToken,onDone:e=>{(0,n.cacheProductsData)(e),Promise.all([this.loadItems(),this.loadOrder(e.order)]).then((([,i])=>{this.setOrder(i),e.recipients&&this.addRecipients(e.recipients),t(this)}),(()=>{}))},onFail:e=>(e&&window.__dev&&console.error(e),t(this),!0)})}),300)}))}order({ignoreEmptyError:e,emptyErrorLoader:t,...i}={}){return new Promise((o=>{s.ajax.post("stickers.php",{act:"order_products",cart:this.getJSON(),hash:i.hash||this.getOrder()?.hash,message:i.message,is_private:i.is_private?1:0,ref:i.ref,gift_ref:i.gift_ref,v:i.v,random_sticker_pack_attempt_id:i.randomStickerPackAttemptId},{onDone:e=>{requestAnimationFrame((()=>{(0,l.hideBoxLoader)()})),(0,n.cacheProductsData)(e),e.result.random_selector_result=e.random_selector_result,Promise.all([this.loadOrder(e.order),this.loadOrder(e.result)]).then((([e,t])=>{this.setOrder(e),o(t)}),(()=>{}))},onFail:i=>!i&&e?(t&&requestAnimationFrame((()=>{(0,l.showBoxLoader)()})),!0):(i&&console.error(i),o(null),!0)})}))}constructor(e,t=[]){this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}}},747463:(e,t,i)=>{i.d(t,{default:()=>O});var s=i(474848),o=i(296540),r=i(794310),n=i(246429),c=i(270959),a=i(102088),l=i(866467),d=i(454154),_=i(373080),u=i(175400),m=i(141821),h=i(612831),g=i(353679),p=i(944041),f=i(177838),k=i(736846),S=i(293297),w=i(24311),E=i(212125),v=i(565069),T=i(410149),C=i(764557),b=i(67631),j=i(19589),P=i(351118),I=i(211413),y=i(847771),R=i(25261);const O=({pack:e,cart:t,options:{recipientIds:i=[],ref:O,gift_ref:L},closeBox:A})=>{const[M]=(0,k.usePack)(e.id);M&&(e=M);const[x,B]=(0,S.useStyles)(e.style_ids||[]),[D,N]=(0,E.useCart)((()=>t)),[K]=(0,w.useWithProducts)(D.getItems()),H=D.getProducts(),U=D.getOrder(),W=(0,p.getSticker)(e.sticker_ids[0]),F=function(e){if(!e)return null;const t=[],i=[];for(const s of e.items){const{product:e,error:o}=s;e&&!o&&((0,h.isPackProduct)(e)?t.push(s):(0,h.isStyleProduct)(e)&&i.push(s))}const s=i.reduce(((e,t)=>e+(t.price?.current||0)),0);if(t.length){const e=t.reduce(((e,t)=>e+(t.price?.current||0)),0);return e?i.length?s?(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_for_styles_for",i.length),"pack_price",(0,l.getLang)("global_n_votes",e),"styles_num",i.length,"styles_price_sum",s):(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_for_styles_free",i.length),"pack_price",(0,l.getLang)("global_n_votes",e),"styles_num",i.length):(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_for"),"pack_price",(0,l.getLang)("global_n_votes",e)):i.length?s?(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_free_styles_for",i.length),"styles_num",i.length,"styles_price_sum",(0,l.getLang)("global_n_votes",s)):(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_free_styles_free",i.length),"styles_num",i.length):(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_free"))}if(i.length)return s?(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_styles_for",i.length),"styles_num",i.length,"styles_price_sum",(0,l.getLang)("global_n_votes",s)):(0,a.langStr)((0,l.getLang)("purchases_stickers_order_summary_styles_free",i.length),"styles_num",i.length);return null}(U),V=!N&&U&&!U.error,[$,G]=(0,o.useState)(!1);let z=null;if(U)if(U.error){if(U.error===g.ORDER_ERRORS.NOT_SIGNED_IN){const e=()=>{(0,n.showDoneBox)((0,l.getLang)("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))};z=(0,s.jsx)(d.Button,{mode:"primary",size:"m",loading:N,onClick:e,children:(0,l.getLang)("purchases_stickers_get_pack_btn")})}else if(U.error===g.ORDER_ERRORS.NO_VALID_ITEMS){if(1===U.items.length){const{product:e,error:t}=U.items[0];if(e&&t!==g.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&e.purchase_details){const{label:t,title:i,text:o,button_title:r,button_url:n}=e.purchase_details,a=()=>{(0,c.showFastBox)(i||(0,l.getLang)("purchases_stickers_catalog_purchase_details_title"),o,n&&r||void 0,n?()=>{window.location.href=n}:void 0)};z=(0,s.jsx)(d.Button,{mode:"primary",size:"m",loading:N,onClick:a,children:t||(0,l.getLang)("purchases_stickers_product_unavailable")})}}if(!z){const e=!U.items.find((e=>e.error!==g.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT));z=(0,s.jsx)(d.Button,{mode:"secondary",size:"m",disabled:!0,children:e?(0,l.getLang)("purchases_stickers_product_purchased"):(0,l.getLang)("purchases_stickers_product_unavailable")})}}}else{const e=()=>{$||(G(!0),D.order({ref:O,gift_ref:L}).then((e=>{G(!1),e&&!e.error&&(0,n.showDoneBox)((0,f.getPurchaseResult)(e))}),(()=>{})))},t=N||$;z=(0,s.jsx)(C.default,{mode:"primary",size:"m",loading:t,disabled:t,price:U.price,text:U.price.current?(0,l.getLang)("purchases_stickers_buy_for"):(0,l.getLang)("purchases_stickers_get_for_free"),onClick:e})}const q=!N&&void 0!==H.find((e=>e?.can_gift)),Y=K.reduce(((e,t)=>(t.product&&t.product.copyright&&e.add(t.product.copyright),e)),new Set),J=j.colorScheme.isDarkScheme()?h.Theme.DARK:h.Theme.LIGHT;return(0,s.jsxs)("article",{className:"StickerPackPreview",children:[(0,s.jsxs)("header",{className:"StickerPackPreview__header",children:[(0,s.jsx)(I.MessageBoxDismissButton,{onClick:A}),W&&(0,s.jsx)(r.Sticker,{className:"StickerPackPreview__icon",loading:"lazy",size:128,UNSAFE_imageUrl:(0,y.getStickerImageUrl)(W,128,128,J),UNSAFE_animationUrl:(0,y.getStickerAnimationUrl)(W,J)}),(0,s.jsxs)("div",{className:"StickerPackPreview__info",children:[(0,s.jsx)(_.InnerHTML,{Component:"h1",className:"StickerPackPreview__title",children:e.title}),(0,s.jsx)(_.InnerHTML,{Component:"div",className:"StickerPackPreview__author",children:e.author}),(0,s.jsx)(_.InnerHTML,{Component:"div",className:"StickerPackPreview__description",children:e.description})]})]}),x.length>0&&(0,s.jsx)(v.default,{className:"StickerPackPreview__styles",styles:x,isLoading:B,isAdded:e=>D.hasProduct(e.id),add:e=>D.addProduct(e.id),remove:e=>D.removeProduct(e.id),gift:e=>{return t=e.id,void((0,R.isNewStickersGiftModalEnabled)()?(0,R.showStickersGiftModal)({giftIds:[(0,R.convertStickerIdToGiftId)(t)],recipientIds:i,referrer:L,stickerReferrer:O}):(0,b.giftStickerProducts)([t],i));var t}}),(0,s.jsxs)("div",{className:"StickerPackPreview__footerContainer",children:[(0,s.jsx)("section",{className:"StickerPackPreview__items",children:K.map((e=>(0,s.jsx)(T.default,{item:e,showHeader:x.length>0,remove:e.product&&(0,h.isStyleProduct)(e.product)?()=>D.removeProduct(e.product_id):void 0},e.product_id)))}),Y.size>0&&(0,s.jsx)("section",{className:"StickerPackPreview__copyrights",children:Array.from(Y).map(((e,t)=>(0,s.jsx)("div",{className:"StickerPackPreview__copyright",children:(0,P.decodeHTMLEntities)(e)},t)))}),(0,s.jsxs)("footer",{className:"StickerPackPreview__footer",children:[!N&&(V||q)&&(0,s.jsx)("div",{className:"StickerPackPreview__footerNote",children:F}),(0,s.jsxs)(u.ButtonGroup,{children:[q&&(0,s.jsx)(d.Button,{mode:"primary",size:"m",onClick:()=>(()=>{if((0,R.isNewStickersGiftModalEnabled)())return void(0,R.showStickersGiftModal)({giftIds:K.map((e=>(0,R.convertStickerIdToGiftId)(e.product_id))),recipientIds:i,referrer:L,stickerReferrer:O});const e=D.copy();e.setRecipientIds(i),(0,b.giftStickersCart)(e)})(),before:(0,s.jsx)(m.Icon24Gift,{width:20,height:20}),children:(0,l.getLang)("purchases_stickers_gift")}),z]})]})]})]})}},749429:(e,t,i)=>{i.d(t,{StickerPackSettings:()=>j});var s=i(474848),o=i(296540),r=i(694244),n=i(782174),c=i(299494),a=i(63614),l=i(303800),d=i(700272),_=i(373080),u=i(908242),m=i(175400),h=i(454154),g=i(866467),p=i(612831),f=i(440487),k=i(416577),S=i(736846),w=i(293297),E=i(565069),v=i(528085),T=i(764557),C=i(67631),b=i(25261);const j=({pack:e,options:t,closeBox:i,updateBox:j})=>{const[P,I]=(0,S.usePack)(e.id);P&&(e=P);const[y,R]=(0,w.useStyles)(e.style_ids||[]),O=I||R;(0,o.useEffect)((()=>{j()}),[O]);const L={...e,base_id:e.id,title:(0,g.getLang)("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:e.sticker_ids},A=[L,...y],M=A.find((e=>e&&e.is_active))||L,[x,B]=(0,o.useState)(),D=x&&A.find((e=>e&&e.id===x)),N=e=>{B(e&&e.id)},K=D||M,H=K===L?(0,g.getLang)("purchases_stickers_product_preview_title_base_pack"):(0,g.langReplace)((0,g.getLang)("purchases_stickers_product_preview_title_style"),{title:K.title});(0,o.useEffect)((()=>{K.is_new&&(0,f.updateUserProductState)(K.id,p.UserProductStateKey.IsNew,0).finally((()=>{}))}),[K,K.is_new]);const[U,W]=(0,o.useState)(!1),[F,V]=(0,o.useState)(!1);return(0,s.jsxs)(r.ModalBox,{children:[(0,s.jsx)(n.ModalHeader,{onClose:i,closeAriaLabel:(0,g.getLang)("global_close"),children:(0,g.langReplace)((0,g.getLang)("purchases_stickers_style_selection_for_pack"),{title:e?.title??""})}),(0,s.jsx)(c.ModalScrollView,{maxHeight:600,children:(0,s.jsx)(a.ModalBody,{insetLevel:0,children:O?(0,s.jsx)(l.Div,{children:(0,s.jsx)(d.Spinner,{stretched:!0})}):(0,s.jsxs)(s.Fragment,{children:[A.length>0&&(0,s.jsx)(E.default,{className:"StickerPackSettings__styles",styles:A,isLoading:R,activeStyle:M,selectedStyle:K,select:e=>N(e)}),(0,s.jsx)("div",{className:"StickerPackSettings__footerContainer",children:(0,s.jsxs)("section",{className:"StickerPackSettings__stylePreview",children:[(0,s.jsx)(_.InnerHTML,{Component:"h2",className:"StickerPackSettings__stylePreviewTitle",children:H}),(0,s.jsx)(v.default,{product:K})]})})]})})}),(0,s.jsx)(u.ModalFooter,{actions:(0,s.jsxs)(m.ButtonGroup,{children:[K.can_gift&&(0,s.jsx)(h.Button,{mode:"secondary",size:"m",onClick:()=>{return e=K.id,void((0,b.isNewStickersGiftModalEnabled)()?(0,b.showStickersGiftModal)({giftIds:[(0,b.convertStickerIdToGiftId)(e)],recipientIds:t.recipientIds||[],referrer:t.gift_ref,stickerReferrer:t.ref}):(0,C.giftStickerProducts)([e],t.recipientIds||[]));var e},children:(0,g.getLang)("stickers_layer_gift")}),K.is_purchased?(0,s.jsx)(h.Button,{mode:"primary",size:"m",disabled:K===M,loading:F,onClick:()=>{return e=K,void(F||(V(!0),(0,f.activateProduct)(e).then((()=>{V(!1),N(void 0)}),(()=>{}))));var e},children:(0,g.getLang)("purchases_stickers_product_settings_save")}):(0,s.jsx)(T.default,{className:"StickerPackSettings__buy",mode:"primary",size:"m",price:K.price.purchase,text:K.price.purchase.current?(0,g.getLang)("purchases_stickers_buy_for"):(0,g.getLang)("purchases_stickers_get_for_free"),loading:U,onClick:()=>{return e=K,void(U||(W(!0),k.Cart.create([e.id]).load().then((e=>e.order())).then((()=>{W(!1)}),(()=>{}))));var e}})]})})]})}},25221:(e,t,i)=>{i.d(t,{StickerProductsGift:()=>C});var s=i(474848),o=i(296540),r=i(694244),n=i(782174),c=i(63614),a=i(303800),l=i(700272),d=i(945206),_=i(944048),u=i(908242),m=i(817590),h=i(246429),g=i(102088),p=i(866467),f=i(612831),k=i(847771),S=i(212125),w=i(890221),E=i(150445),v=i(764557),T=i(351118);const C=({cart:e,options:{ref:t,gift_ref:i},closeBox:C,updateBox:b})=>{const[j,P]=(0,S.useCart)(e),I=!j.isLoaded()&&P;(0,o.useEffect)((()=>{b()}),[I]);const y=j.getRecipientIds(),R=j.getOrder(),O=R&&!R.error&&R.items.find((e=>!e.error&&!(0,k.isSampleOrderItem)(e))),[L,A]=function(e){if(!e)return[null,null];let t;for(const i of e.items){const{product:e}=i;if(e&&(0,f.isPackProduct)(e)){t=e;break}}let i=e.items.filter((({product:e})=>e?.can_gift));const s=i.filter((e=>!e.error&&!(0,k.isSampleOrderItem)(e)));s.length&&(i=s);const o=new f.ProductsByType(i.map((e=>e.product))),r=o.pack.values().next().value,n=Array.from(o.style);let c="",a="";if(1===n.length)c=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_title_1_style"),"title",n[0].title),r?a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_with_pack"),"title",r.title):t&&(a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_for_pack"),"title",t.title));else if(r){if(c=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_title_pack"),"title",r.title),n.length)switch(n.length){case 2:a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_with_2_styles"),"title1",n[0].title,"title2",n[1].title);break;case 3:a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_with_3_styles"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);break;case 4:a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);break;default:const e=n.length-3;a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_with_3_styles_and_n_more",e),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title,"n",e)}}else if(n.length){switch(n.length){case 2:c=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_title_2_styles"),"title1",n[0].title,"title2",n[1].title);break;case 3:c=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_title_3_styles"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);break;case 4:c=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);break;default:const e=n.length-3;c=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_title_3_styles_and_n_more",e),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title,"n",e)}t&&(a=(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_description_for_pack"),"title",t.title))}n.length?a+=" "+(0,p.getLang)("purchases_stickers_gift_description_styles"):a+=" "+(0,p.getLang)("purchases_stickers_gift_description");return[c,a]}(R),[,M]=(0,o.useState)(null);(0,o.useLayoutEffect)((()=>{const e=j.getRecipients();if(M(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:e,items:e,noResult:(0,p.getLang)("gifts_nobody_found"),introText:(0,p.getLang)("gifts_start_typing_recipient"),maxItems:20,onChange:(e,t)=>{1===e?j.addRecipientId(+t):j.removeRecipientId(+t)}})),y.length)for(const e of y){const t=j.getRecipientById(e);t&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,t)}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return()=>{window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[I]);const[x,B]=(0,o.useState)(""),[D,N]=(0,o.useState)(!1),[K,H]=(0,o.useState)(!1),U=()=>{K||(H(!0),j.order({message:x,is_private:D,ref:t,gift_ref:i}).then((e=>{H(!1),e&&!e.error&&((0,h.showDoneBox)(function(e,t){const i=new f.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),s=function(e){const t=e.getPack(),i=e.getStyles();if(t)return i.length?(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_pack_and_styles",i.length),"title",t.title,"styles_num",i.length):(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_pack"),"title",t.title);if(i.length)switch(i.length){case 1:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_1_style"),"title",i[0].title);case 2:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_2_styles"),"title1",i[0].title,"title2",i[1].title);case 3:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_3_styles"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);case 4:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);default:{const e=i.length-3;return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_products_3_styles_and_n_more",e),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title,"n",e)}}return null}(i);if(!s)return null;const o=new Set;for(const i of e.items){const{error:e,recipient_id:s}=i;if(e)continue;const r=t(s);r&&o.add(r)}const r=function(e,t){const i=Array.from(e.values());switch(i.length){case 0:return null;case 1:{const e=1===t?(0,p.getLang)("purchases_stickers_gift_result_1_recipient_single","raw"):(0,p.getLang)("purchases_stickers_gift_result_1_recipient_multiple","raw");return(0,g.langStr)((0,p.langSex)(i[0][8],e),"name",i[0][8])}case 2:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_2_recipients",t),"name1",i[0][8],"name2",i[1][8]);case 3:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_3_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8]);case 4:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_4_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8]);case 5:return(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_result_5_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"name5",i[4][8]);default:{const e=i.length-4,s=1===t?(0,p.getLang)("purchases_stickers_gift_result_4_recipients_and_n_more_single"):(0,p.getLang)("purchases_stickers_gift_result_4_recipients_and_n_more_multiple");return(0,g.langStr)(s,"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"n",e)}}return null}(o,i.getCount());if(!r)return null;return(0,g.langStr)(r,"products",s)}(e,(e=>j.getRecipientById(e)))),C())}),(()=>{})))};return(0,o.useEffect)((()=>{window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",K)}),[K]),(0,s.jsxs)(r.ModalBox,{"data-testid":"sticker-gift-modal",children:[(0,s.jsx)(n.ModalHeader,{onClose:C,closeAriaLabel:(0,p.getLang)("global_close"),children:(0,p.getLang)("purchases_stickers_gift_box_title")}),(0,s.jsx)(c.ModalBody,{insetLevel:2,children:I?(0,s.jsx)(a.Div,{children:(0,s.jsx)(l.Spinner,{stretched:!0})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.default,{order:R,forceValid:!O}),(0,s.jsx)("h1",{className:"StickerProductsGift__productsTitle",children:(0,T.decodeHTMLEntities)(L||"")}),(0,s.jsx)("p",{className:"StickerProductsGift__productsDescription",children:(0,T.decodeHTMLEntities)(A||"")}),R&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("dl",{className:"StickerProductsGift__price",children:[(0,s.jsx)("dt",{className:"StickerProductsGift__priceLabel",children:(0,p.getLang)("purchases_gift_price_label")})," ",(0,s.jsx)("dd",{className:"StickerProductsGift__priceValue",children:(0,p.getLang)("global_n_votes",R.price.current)})]}),(0,s.jsx)("div",{className:"StickerProductsGift__balance",children:(0,g.langStr)((0,p.getLang)("gifts_you_have_X_votes"),"votes",(0,p.getLang)("global_n_votes",R.balance))})]}),(0,s.jsxs)("div",{className:"StickerProductsGift__recipients",children:[(0,s.jsx)("label",{className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput",children:(0,p.getLang)("gifts_receiver")}),(0,s.jsxs)("div",{className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown",children:[(0,s.jsx)("div",{className:"fl_r wdd_arr"}),(0,s.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:(0,p.getLang)("gifts_choose_recipients")})]})]}),(0,s.jsxs)("div",{className:"StickerProductsGift__message",children:[(0,s.jsx)("label",{className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput",children:(0,p.getLang)("purchases_gift_your_message")}),(0,s.jsx)(d.Textarea,{id:"StickerProductsGiftMessageInput",rows:3,value:x,onChange:e=>B(e.currentTarget.value),onResize:()=>b(),disabled:K})]}),(0,s.jsx)(_.Checkbox,{noPadding:!0,stretched:!1,checked:D,disabled:K,onChange:()=>N(!D),children:(0,p.getLang)("gifts_receiver_only")})]})}),(0,s.jsx)(u.ModalFooter,{before:(0,s.jsx)("div",{className:"StickerProductsGift__footerNote",children:!P&&R&&(0,s.jsxs)("div",{className:"StickerProductsGift__details",children:[(0,p.getLang)("purchases_stickers_gift_details_label"),(0,s.jsx)(m.HintIcon,{gap:"l",tooltip:{placement:"top",...(0,E.stickerProductsGiftDetails)({order:R,recipients:j.getRecipientsMap()})}})]})}),actions:(0,s.jsx)(v.default,{className:"StickerProductsGift__gift",mode:O?"primary":"secondary",size:"m",loading:P||K,disabled:!O,price:R?.price,text:O?(0,g.langStr)((0,p.getLang)("purchases_stickers_gift_send_for"),"price",(0,p.getLang)("global_n_votes",R?.price.current)):(0,p.getLang)("purchases_stickers_gift_send"),onClick:()=>U()})})]})}},150445:(e,t,i)=>{i.d(t,{stickerProductsGiftDetails:()=>_});var s=i(474848),o=i(296540),r=i(351118),n=i(373080),c=i(102088),a=i(866467),l=i(847771),d=i(612831);const _=({order:e,recipients:t})=>{const i=function(e){if(!e)return null;let t=e.items.filter((({product:e})=>e?.can_gift));const i=t.filter((e=>!e.error&&!(0,l.isSampleOrderItem)(e)));i.length&&(t=i);const s=[],o=[];for(const e of t){const{product:t}=e;t&&((0,d.isPackProduct)(t)?s.push(e):(0,d.isStyleProduct)(t)&&o.push(e))}const r=o.reduce(((e,t)=>e+(t.price?.current||0)),0);if(s.length){const e=s.reduce(((e,t)=>e+(t.price?.current||0)),0);return o.length?(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_summary_pack_with_styles",o.length),"pack_price_sum",(0,a.getLang)("global_n_votes",e),"styles_num",o.length,"styles_price_sum",(0,a.getLang)("global_n_votes",r)):(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",(0,a.getLang)("global_n_votes",e))}if(o.length)return(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_summary_styles",o.length),"styles_num",o.length,"styles_price_sum",(0,a.getLang)("global_n_votes",r));return null}(e)||"",_=new Map;for(const i of e.items){const{error:e,product:s,recipient_id:o}=i;if(e)continue;const r=t.get(o);if(!r)continue;let n=_.get(r);n||(n=new d.ProductsByType,_.set(r,n)),n.add(s)}const m=Array.from(_.entries()),h=m.length,g={maxWidth:291,text:m.map((([e,t])=>(0,s.jsxs)(o.Fragment,{children:[(0,s.jsx)(n.InnerHTML,{Component:"span",children:e[1]}),": ",(0,r.decodeHTMLEntities)(u(t)||"")," "]},e[0])))};return g[i&&h?"header":"text"]=(0,s.jsx)(n.InnerHTML,{children:i}),g};function u(e){const t=e.getPack(),i=e.getStyles();let s="";return i.length&&(s=i.map((e=>(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_recipient_style_title"),"title",e.title))).join(", ")),t?s?(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",s):(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_recipient_pack"),"title",t.title):s?(0,c.langStr)((0,a.getLang)("purchases_stickers_gift_details_recipient_styles"),"style_titles",s):null}},890221:(e,t,i)=>{i.d(t,{default:()=>l});var s=i(474848),o=i(351118),r=i(612831),n=i(847771);const c={s:56,m:96,l:168},a="sticker-products-gifts-icon",l=({order:e,forceValid:t=!1})=>{const i=new Map,l=new Map;if(e)for(const t of e.items){const{product:e}=t;e&&((0,r.isPackProduct)(e)?i.has(e)?i.get(e)?.push(t):i.set(e,[t]):(0,r.isStyleProduct)(e)&&(l.has(e)?l.get(e)?.push(t):l.set(e,[t])))}const d=i.keys().next().value,_=(d?1:0)+l.size,u=_>1?_>2?"s":"m":"l",m=c[u],h=Array.from(l.entries());t||h.sort((([,e],[,t])=>t.filter((e=>!e.error)).length-e.filter((e=>!e.error)).length));const g=h.slice(0,3);let p=h.slice(3),f=!0;if(!t){const e=p.filter((([,e])=>e.find((e=>!e.error))));e.length?p=e:f=!1}return(0,s.jsxs)("ul",{className:"StickerProductsGiftIcons",children:[d&&(0,s.jsx)("li",{"data-testid":a,className:(0,o.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${u}`,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!t&&!i.get(d)?.find((e=>!e.error))}),style:{backgroundImage:`url(${(0,n.getStickerPackIconUrl)(d,m,m)})`}},d.id),g.map((([e,i])=>(0,s.jsx)("li",{"data-testid":a,className:(0,o.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${u}`,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!t&&!i.find((e=>!e.error))}),style:{backgroundImage:`url(${(0,n.getStickerPackIconUrl)(e,m,m)})`}},e.id))),p.length?(0,s.jsxs)("li",{"data-testid":a,className:(0,o.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${u}`,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!f}),children:["+",p.length]},"more"):null]})}},522109:(e,t,i)=>{i.d(t,{StickerStylePreview:()=>u});var s=i(474848),o=i(694244),r=i(782174),n=i(63614),c=i(908242),a=i(175400),l=i(454154),d=i(866467),_=i(528085);const u=({style:e,options:{add:t},closeBox:i})=>(0,s.jsxs)(o.ModalBox,{children:[(0,s.jsx)(r.ModalHeader,{onClose:i,closeAriaLabel:(0,d.getLang)("global_close"),children:(0,d.langReplace)((0,d.getLang)("purchases_stickers_stickers_of_style"),{title:e.title})}),(0,s.jsx)(n.ModalBody,{insetLevel:2,children:(0,s.jsx)(_.default,{product:e})}),(0,s.jsx)(c.ModalFooter,{actions:(0,s.jsxs)(a.ButtonGroup,{children:[(0,s.jsx)(l.Button,{mode:"tertiary",size:"m",onClick:i,children:(0,d.getLang)("global_cancel")}),t&&(0,s.jsx)(l.Button,{mode:"primary",size:"m",onClick:()=>t(e),children:(0,d.getLang)("purchases_stickers_preview_add_item")})]})})]})},565069:(e,t,i)=>{i.d(t,{default:()=>_});var s=i(474848),o=i(351118),r=i(866467),n=i(783856),c=i(700272),a=i(817590),l=i(141686),d=i(166433);const _=({className:e,styles:t,isLoading:i,isAdded:_,add:u,remove:m,gift:h,activeStyle:g,selectedStyle:p,select:f})=>{const k=(0,l.default)({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(i)return(0,s.jsx)("section",{className:(0,o.classNames)("StickerStylesMenu","StickerStylesMenu--loading",e),children:(0,s.jsx)(n.Overlay,{children:(0,s.jsx)(c.Spinner,{size:"regular"})})});const S=[{title:(0,r.getLang)("purchases_stickers_purchased_styles"),styles:t.filter((e=>e.is_purchased&&!e.is_disabled))},{title:(0,r.getLang)("purchases_stickers_other_styles"),styles:t.filter((e=>!e.is_purchased&&!e.is_disabled&&!e.is_hidden)),tooltip:(0,r.getLang)("purchases_stickers_styles_hint")}].filter((e=>e.styles.length));return S.length?(0,s.jsxs)("section",{className:(0,o.classNames)("StickerStylesMenu",e),ref:k.ref,onWheel:e=>k.onWheel(e),children:[(0,s.jsx)("a",{className:(0,o.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!k.hasPrev}),onClick:()=>k.prev()}),(0,s.jsx)("a",{className:(0,o.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!k.hasNext}),onClick:()=>k.next()}),(0,s.jsx)("div",{className:"StickerStylesMenu__wrapper",children:S.map(((e,t)=>(0,s.jsxs)("section",{className:"StickerStylesMenu__group",children:[(0,s.jsxs)("h2",{className:"StickerStylesMenu__groupTitle",children:[e.title,e.tooltip&&(0,s.jsx)(a.HintIcon,{gap:"l",tooltip:{text:e.tooltip,placement:"bottom"}})]}),(0,s.jsx)("div",{className:"StickerStylesMenu__groupItems",children:e.styles.map((e=>(0,s.jsx)(d.default,{className:"StickerStylesMenu__item",style:e,isLoading:i,isAdded:_&&_(e),add:u&&(()=>u(e)),remove:m&&(()=>m(e)),gift:h&&(()=>h(e)),isActive:void 0===g?void 0:e===g,isSelected:void 0===p?void 0:e===p,select:f&&(()=>f(e))},e.id)))})]},t)))})]}):null}},166433:(e,t,i)=>{i.d(t,{default:()=>g});var s=i(474848),o=i(351118),r=i(866467),n=i(373080),c=i(175400),a=i(454154),l=i(794310),d=i(612831),_=i(944041),u=i(141821),m=i(847771),h=i(19589);const g=({className:e,style:t,isAdded:i=!1,add:g,remove:p,gift:f,isActive:k,isSelected:S,select:w})=>{let E;E=t.is_new?t.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):t.title;const v=(0,_.getSticker)(t.style_sticker_ids[0]),T=e=>t=>{t.stopPropagation(),e()},C=h.colorScheme.isDarkScheme()?d.Theme.DARK:d.Theme.LIGHT;return(0,s.jsxs)("div",{className:(0,o.classNames)("StickerStylesMenuItem",e,{"StickerStylesMenuItem--selected":Boolean(S),"StickerStylesMenuItem--added":Boolean(i),"StickerStylesMenuItem--new":t.is_new}),onClick:()=>{w?w():i?p&&p():g&&g()},children:[v&&(0,s.jsx)(l.Sticker,{className:"StickerStylesMenuItem__icon",loading:"lazy",size:100,UNSAFE_imageUrl:(0,m.getStickerImageUrl)(v,100,100,C),UNSAFE_animationUrl:(0,m.getStickerAnimationUrl)(v,C)}),(0,s.jsx)(n.InnerHTML,{Component:"div",className:"StickerStylesMenuItem__title",children:E}),t.is_purchased?void 0===k?(0,s.jsx)("div",{className:"StickerStylesMenuItem__notice",children:(0,r.getLang)("purchases_stickers_you_have_it")}):k&&(0,s.jsx)("div",{className:"StickerStylesMenuItem__notice",children:(0,r.getLang)("purchases_stickers_active_style")}):t.price.purchase.regular?(0,s.jsx)("div",{className:"StickerStylesMenuItem__price",children:(0,r.getLang)("global_n_votes",t.price.purchase.current)}):(0,s.jsx)("div",{className:"StickerStylesMenuItem__price",children:(0,r.getLang)("purchases_for_free_btn")}),(g||p||f&&t.can_gift)&&(0,s.jsxs)(c.ButtonGroup,{gap:"s",stretched:!0,children:[i?p&&(0,s.jsx)(a.Button,{stretched:!0,mode:"secondary",size:"s",onClick:T(p),children:(0,r.getLang)("purchases_stickers_preview_remove_item")}):g&&(0,s.jsx)(a.Button,{stretched:!0,mode:"primary",size:"s",onClick:T(g),children:(0,r.getLang)("purchases_stickers_preview_add_item")}),f&&t.can_gift&&(0,s.jsx)(a.Button,{before:(0,s.jsx)(u.Icon24Gift,{width:20,height:20}),size:"s",mode:"primary",onClick:T(f)})]})]})}},410149:(e,t,i)=>{i.d(t,{default:()=>l});var s=i(474848),o=i(102088),r=i(866467),n=i(373080),c=i(612831),a=i(528085);const l=({item:e,showHeader:t=!1,remove:i})=>{if(!e.product)return null;let l="";return(0,c.isPackProduct)(e.product)?l=(0,o.langStr)((0,r.getLang)("purchases_stickers_product_preview_title_pack"),"title",e.product.title):(0,c.isStyleProduct)(e.product)&&(l=(0,o.langStr)((0,r.getLang)("purchases_stickers_product_preview_title_style"),"title",e.product.title)),(0,s.jsxs)("div",{className:"StickersCartItem",children:[t&&(0,s.jsxs)("div",{className:"StickersCartItem__header",children:[(0,s.jsx)(n.InnerHTML,{Component:"span",className:"StickersCartItem__title",children:l}),i&&(0,s.jsx)("span",{className:"StickersCartItem__actions",children:(0,s.jsx)("button",{className:"StickersCartItem__remove",onClick:()=>i(),children:(0,r.getLang)("purchases_stickers_preview_remove_item")})})]}),(0,s.jsx)(a.default,{className:"StickersCartItem__preview",product:e.product})]})}},764557:(e,t,i)=>{i.d(t,{default:()=>a});var s=i(474848),o=i(296540),r=i(454154),n=i(351118),c=i(866467);const a=({className:e,price:t,text:i,placeholder:a,...l})=>{let d=(0,o.useMemo)((()=>{if(t){let e;t.current!==t.regular&&t.regular&&(e=(0,s.jsx)("span",{className:"StickersPriceButton__regular",children:t.current?t.regular:(0,c.langStr)((0,c.getLang)("purchases_stickers_n_for_m"),"%n","","%m",(0,c.getLang)("global_n_votes",t.regular))},"regular"));const o=(0,s.jsx)("span",{className:"StickersPriceButton__current",children:t.current?(0,c.getLang)("global_n_votes",t.current):(0,c.getLang)("purchases_for_free_btn").toLowerCase()},"current");return i?i.split(/(\{regular_price\}|\{price\})/).map(((t,i)=>"{regular_price}"===t?e:"{price}"===t?o:t?(0,s.jsx)("span",{className:"StickersPriceButton__label",children:t},`label${i}`):void 0)):[e,o]}return[a]}),[i,a,t?.regular,t?.current]);return(0,s.jsx)(r.Button,{className:(0,n.classNames)("StickersPriceButton",e),...l,children:d})}},528085:(e,t,i)=>{i.d(t,{default:()=>d});var s=i(474848),o=i(351118),r=i(794310),n=i(19589),c=i(612831),a=i(944041),l=i(847771);const d=({className:e,product:t})=>{if(!(0,c.isPackProduct)(t)&&!(0,c.isStyleProduct)(t))return null;const i=(0,a.getStickers)((0,c.isStyleProduct)(t)?t.style_sticker_ids:t.sticker_ids),d=n.colorScheme.isDarkScheme()?c.Theme.DARK:c.Theme.LIGHT;return(0,s.jsx)("div",{className:(0,o.classNames)("StickersProductPreview",e),children:(0,s.jsx)("ul",{className:"StickersProductPreview__stickers",children:i.map((e=>e&&(0,s.jsx)(r.Sticker,{className:"StickersProductPreview__sticker",loading:"lazy",size:128,UNSAFE_imageUrl:(0,l.getStickerImageUrl)(e,128,128,d),UNSAFE_animationUrl:(0,l.getStickerAnimationUrl)(e,d)},e.id)))})})}},614098:(e,t,i)=>{i.d(t,{REGULAR_SIZES:()=>r,SIZE_512:()=>o,STICKER_ICON_CLASS:()=>c,STICKER_ROW_CLASS:()=>n,StickerSize:()=>s});var s=function(e){return e[e.SMALL=128]="SMALL",e[e.MIDDLE=168]="MIDDLE",e[e.BIG=208]="BIG",e}({});const o=512,r=[64,128,256,352,o],n="stickerRow",c="stickerIcon"},212125:(e,t,i)=>{i.d(t,{useCart:()=>o});var s=i(296540);const o=e=>{const[t,i]=(0,s.useState)(e),[o,r]=(0,s.useState)(null),n=(0,s.useCallback)((()=>{const e=t.load();r(e),e.then((t=>{i(t),r((t=>t===e?null:t))}),(()=>{}))}),[t]);return(0,s.useEffect)((()=>(t.onChange=n,t.isLoaded()||n(),()=>{t.onChange=null,t.cancelLoad()})),[t]),[t,null!==o]}},736846:(e,t,i)=>{i.d(t,{usePack:()=>r});var s=i(612831),o=i(132380);const r=e=>{const[t,i]=(0,o.useProduct)(e);return t&&(0,s.isPackProduct)(t)?[t,i]:[void 0===t?void 0:null,i]}},132380:(e,t,i)=>{i.d(t,{useProduct:()=>c});var s=i(296540),o=i(440487),r=i(177838),n=i(944041);const c=e=>{const[,t]=(0,s.useState)({}),i=(0,r.getProductFromCache)(n.getCache,e);return void 0===i?((0,o.getProduct)(e,!1).then((()=>t({})),(()=>{})),[i,!0]):[i,!1]}},284299:(e,t,i)=>{i.d(t,{useProducts:()=>r});var s=i(296540),o=i(440487);const r=e=>{const[,t]=(0,s.useState)({}),i=(0,o.getProductsFromCache)(e);return i.some((e=>void 0===e))?((0,o.getProducts)(e,!1).then((()=>t({})),(()=>{})),[i,!0]):[i,!1]}},141686:(e,t,i)=>{i.d(t,{default:()=>a});var s=i(296540);const o={getOffset:()=>({x:0,y:0}),scrollTo:()=>{},scrollBy:()=>{},onWheel:()=>{},updateItems:()=>{},hasPrev:!1,hasNext:!1,prev:()=>{},next:()=>{}};function r(e,t){switch(t.type){case"updateState":return{...e,...t.state};case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?{...e,hasPrev:t.hasPrev,hasNext:t.hasNext}:e;default:throw new Error}}const n=e=>{const t=Array.from(e.entries());for(let e=0;e<t.length;e++){const[i,s]=t[e];if(s&&s.intersectionRatio)return s.intersectionRatio<1?i:t[e-1]?t[e-1][0]:null}return null},c=e=>{const t=Array.from(e.entries());for(let e=t.length-1;e>=0;e--){const[i,s]=t[e];if(s&&s.intersectionRatio)return s.intersectionRatio<1?i:t[e+1]?t[e+1][0]:null}return null};const a=function(e){const t=(0,s.useRef)(null),[i,a]=(0,s.useReducer)(r,o),l=(0,s.useCallback)((e=>{a({type:"updateState",state:e})}),[a]),d=(0,s.useCallback)((s=>{if(t.current&&i.onMouseWheel&&t.current.removeEventListener("mousewheel",i.onMouseWheel),s){const t=s.querySelector(e.wrapperSelector);if(t){let o={x:0,y:0};const r=new Map,d=()=>o;let _;const u=()=>{_&&_.disconnect(),_=new IntersectionObserver((e=>{for(const t of e)r.has(t.target)&&r.set(t.target,t);a({type:"updateNav",hasPrev:null!==n(r),hasNext:null!==c(r)})}),{root:s,threshold:[0,1]}),r.clear();for(const t of s.querySelectorAll(e.itemSelector))r.set(t,null),_.observe(t)},m=i=>{let r=0;t.offsetWidth>s.offsetWidth&&(r=Math.max(0,Math.min(t.offsetWidth-s.offsetWidth,i.x)));let n=0;t.offsetHeight>s.offsetHeight&&(n=Math.max(0,Math.min(t.offsetHeight-s.offsetHeight,i.y))),t.style.transform=`translate3d(-${r}px, -${n}px, 0)`,t.style.transitionDuration=i.noTransition?"0s":"",o={x:r,y:n},e.onScroll&&e.onScroll(r,n)},h=e=>{m({...e,x:o.x+e.x,y:o.y+e.y})},g=e=>{h({x:e.deltaX,y:e.deltaY,noTransition:!0})},p=()=>{const e=n(r);if(e){const i=getComputedStyle(t),s=parseInt(i.paddingLeft)||0,o=parseInt(i.paddingTop)||0,r=t.getBoundingClientRect(),n=e.getBoundingClientRect();m({x:n.left-r.left-s,y:n.top-r.top-o})}},f=()=>{const e=c(r);if(e){const i=getComputedStyle(t),o=parseInt(i.paddingBottom)||0,r=parseInt(i.paddingRight)||0,n=s.getBoundingClientRect(),c=t.getBoundingClientRect(),a=e.getBoundingClientRect();m({x:a.left-c.left-n.width+a.width+r,y:a.top-c.top-n.height+a.height+o})}},k=e=>{e.deltaX&&e.preventDefault()};s.addEventListener("mousewheel",k),l({...i,onMouseWheel:k,updateItems:u,getOffset:d,scrollTo:m,scrollBy:h,onWheel:g,prev:p,next:f})}}t.current=s}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,s.useLayoutEffect)((()=>{i.updateItems()})),{ref:d,...i}}},293297:(e,t,i)=>{i.d(t,{useStyles:()=>r});var s=i(612831),o=i(284299);const r=e=>{const[t,i]=(0,o.useProducts)(e),r=[];for(const e of t)e&&(0,s.isStyleProduct)(e)&&r.push(e);return[r,i]}},24311:(e,t,i)=>{i.d(t,{useWithProducts:()=>r});var s=i(296540),o=i(284299);function r(e){const[t,i]=(0,o.useProducts)(e.map((e=>e.product_id)));return[(0,s.useMemo)((()=>e.map(((e,i)=>({...e,product:t[i]})))),[e]),i]}},8534:(e,t,i)=>{i.d(t,{previewStickerProduct:()=>S});var s=i(474848),o=i(440961),r=i(865708),n=i(205338),c=i(540462),a=i(270959),l=i(866467),d=i(612831),_=i(177838),u=i(944041),m=i(416577),h=i(246429),g=i(747463),p=i(749429),f=i(522109);const k=new Map;function S(e,t){let i,S;const w={...t};function E(){return i?.bodyNode.querySelector(".StickersProductPreviewBox")}function v(){i?.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function T(){i?.updateBoxCoords()}function C(e,t){let i=null,a=null;if((0,d.isPackProduct)(e))i=e.is_purchased&&w?.settings?(0,s.jsx)(p.StickerPackSettings,{pack:e,options:w,closeBox:v,updateBox:T}):(0,s.jsx)(g.default,{pack:e,cart:t,options:w,closeBox:v,updateBox:T}),a=e.name;else if((0,d.isStyleProduct)(e)){const o=(0,_.getProductFromCache)(u.getCache,e.base_id);if(o)return t.addProduct(o.id,!0),void C(o,t);i=(0,s.jsx)(f.StickerStylePreview,{style:e,options:w,closeBox:v,updateBox:T}),a=e.name}const l=E();if(l&&i&&((0,c.partConfigEnabled)("enable_create_root")?(S||(S=(0,n.createRoot)(l)),S.render((0,s.jsx)(r.AppRootProvider,{children:i}))):o.render((0,s.jsx)(r.AppRootProvider,{children:i}),l),a)){const e=window.nav.objLoc[0].split("/");"stickers"===e[0]&&e[1]!==a&&window.nav.setLoc({0:"stickers/"+a})}}const b=(0,h.showBoxLoader)(!1),j=m.Cart.create([e]);return Promise.all([j.load(),window.stManager.add(["stickers.css"])]).then((([t])=>{if((0,h.isBoxLoadingCancelled)(b))return;(0,h.hideBoxLoader)();const s=(0,_.getProductFromCache)(u.getCache,e);s&&!s.is_disabled?(i=new a.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow(){C(s,t),requestAnimationFrame((()=>{T(),function(){if(k.has(e)){const t=(0,h.getBoxLayerWrap)();t&&(t.scrollTop=k.get(e)||0),k.delete(e)}}()}))},onBeforeHide(){!function(){const t=(0,h.getBoxLayerWrap)();t&&k.set(e,t.scrollTop)}()},onHideAttempt:()=>(function(){if((0,c.partConfigEnabled)("enable_create_root"))S?.unmount();else{const e=E();e&&o.unmountComponentAtNode(e)}}(),!0)}),i.content('<div class="StickersProductPreviewBox"></div>'),i.show()):(0,a.showFastBox)((0,l.getLang)("global_box_error_title"),(0,l.getLang)("purchases_stickers_product_not_found"))}),(()=>{})),{hide:v}}},440487:(e,t,i)=>{i.r(t),i.d(t,{activateProduct:()=>m,cacheProductsData:()=>n,fetchProducts:()=>u,getProduct:()=>_,getProducts:()=>d,getProductsFromCache:()=>c,loadProducts:()=>l,updateUserProductState:()=>h});var s=i(761520),o=i(177838),r=i(944041);const n=(e,t=[])=>{const i=(0,r.getCache)();if(e.stickers){const{stickers:t}=i;for(const i of e.stickers)t.has(i.id)?t.set(i.id,{...t.get(i.id),...i}):t.set(i.id,i)}if(e.products)for(const t of e.products)i.products.set(t.id,t),i.productPromises.delete(t.id);for(const e of t)i.products.has(e)||i.products.set(e,null),i.productPromises.delete(e);e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,r.updateCache)(i)},c=e=>{const t=(0,r.getCache)().products;return e.map((e=>t.get(e)))};function a(){let{productsPromise:e}=(0,r.getCache)();return e||(e=new Promise((e=>setTimeout((()=>{const t=(0,r.getCache)().productIdsQueue,i=Array.from(t);t.clear(),(0,r.updateCache)({productIdsQueue:t,productsPromise:void 0}),s.ajax.post("stickers.php",{act:"get_products",product_ids:i},{onDone(t){n(t,i),e([])},onFail:t=>(console.error(t),n({},i),e([]),!0)})}),300))),(0,r.updateCache)({productsPromise:e})),e}const l=e=>{if(!e.length)return Promise.resolve([]);const{productPromises:t,productIdsQueue:i}=(0,r.getCache)(),s=new Set;for(const o of e)if(t.has(o)){const e=t.get(o);e&&s.add(e)}else{i.add(o);const e=a();t.set(o,e),s.add(e)}return(0,r.updateCache)({productIdsQueue:i,productPromises:t}),Promise.all(s).then((()=>c(e)))},d=(e,t=!0)=>{const i=t?e.filter((e=>void 0===(0,o.getProductFromCache)(r.getCache,e))):e;return i.length?l(i).then((()=>c(e))):Promise.resolve(c(e))},_=(e,t=!0)=>{if(t){const t=(0,o.getProductFromCache)(r.getCache,e);if(void 0!==t)return Promise.resolve(t)}return l([e]).then((()=>(0,o.getProductFromCache)(r.getCache,e)))},u=e=>(function(e){const{products:t}=(0,r.getCache)();for(const i of e){const e=t.get(i.id);(null===e||e&&e.hash!==i.hash)&&t.delete(i.id)}(0,r.updateCache)({products:t})}(e),d(e.map((e=>e.id)))),m=e=>new Promise((t=>{s.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone(e){n(e),t()},onFail:e=>(console.error(e),t(),!0)})})),h=(e,t,i,o=!0)=>new Promise((r=>{s.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:i},{onDone(e){o&&n(e),r()},onFail:e=>(console.error(e),r(),!0)})}))},67631:(e,t,i)=>{i.d(t,{giftStickerProducts:()=>h,giftStickersCart:()=>m});var s=i(474848),o=i(440961),r=i(865708),n=i(270959),c=i(205338),a=i(540462),l=i(416577),d=i(177838),_=i(944041),u=i(25221);function m(e,t){const{productsGiftLock:i}=(0,_.getCache)();if(i)return null;let l,m;(0,_.updateCache)({productsGiftLock:!0});const h={...t};function g(){return l?.bodyNode.querySelector(".StickersProductsGift")}function p(){l?.hide()}function f(){l?.updateBoxCoords()}return(0,d.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css",window.jsc("web/wide_dd.js"),"wide_dd.css"])]).then((([e])=>{(0,d.hideLoader)(),l=new n.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow(){!function(e){const t=g();t&&((0,a.partConfigEnabled)("enable_create_root")?(m||(m=(0,c.createRoot)(t)),m.render((0,s.jsx)(r.AppRootProvider,{children:(0,s.jsx)(u.StickerProductsGift,{cart:e,options:h,closeBox:p,updateBox:f})}))):o.render((0,s.jsx)(r.AppRootProvider,{children:(0,s.jsx)(u.StickerProductsGift,{cart:e,options:h,closeBox:p,updateBox:f})}),t))}(e),requestAnimationFrame((()=>{f()}))},onHideAttempt:()=>(function(){const e=g();(0,a.partConfigEnabled)("enable_create_root")?m?.unmount():e&&o.unmountComponentAtNode(e)}(),!0),onHide(){(0,_.updateCache)({productsGiftLock:!1})}}),l.content('<div class="StickersProductsGift"></div>'),l.show()}),(()=>{})),{hide:p}}function h(e,t=[],i){return m(l.Cart.create(e,t),i)}},177838:(e,t,i)=>{i.d(t,{findClosestStickerSize:()=>f,getLangCode:()=>p,getProductFromCache:()=>k,getPurchaseResult:()=>h,hideLoader:()=>m,showLoader:()=>u,updateStickersFromQueue:()=>g});var s=i(102088),o=i(866467),r=i(19589),n=i(754866),c=i(246429),a=i(612831),l=i(614098),d=i(847771);function _(){return document.querySelector("#box_loader")}function u(){const e=_();(0,c.refreshBoxLoaderCoords)(),(0,n.show)(e),(0,n.show)(document.querySelector("#box_layer_wrap"))}function m(){(0,n.hide)(_())}function h(e){const t=new a.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),i=t.getPack(),r=t.getStyles();if(i)return r.length?(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_pack_and_styles",r.length),"pack_title",i.title,"n",r.length):(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_pack"),"title",i.title);if(r.length)switch(r.length){case 1:return(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_1_style"),"title",r[0].title);case 2:return(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:const e=r.length-3;return(0,s.langStr)((0,o.getLang)("purchases_stickers_purchase_result_3_styles_and_n_more",e),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",e)}return null}function g(e){!function(e){const t=r.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light";e.querySelectorAll(`.sticker_img[${t}]`).forEach((e=>{const i=e.getAttribute(t);i&&(e.src=i)}))}(e)}const p=()=>window.vk.lang||"ru",f=e=>e>l.SIZE_512?((0,d.logStickersError)("Нет размера стикера больше 512px"),l.SIZE_512):l.REGULAR_SIZES.find((t=>t>=e)),k=(e,t)=>e().products.get(t)},848118:(e,t,i)=>{i.d(t,{openStickersRandomSelectorView:()=>p});var s=i(32489),o=i(574061),r=i(444091),n=i(636843),c=i(590162),a=i(865014),l=i(522267),d=i(190929),_=i(246429);const u={},m=n.stickers.createEvent(),h=n.stickers.createStore(u).reset(m),g=n.stickers.createEffect((e=>{(0,_.hideBoxLoader)(),(0,o.openView)({...e,view:r.ViewId.RANDOM_SELECTOR,modalBoxOptions:{onDestroy:()=>{e.modalBoxOptions?.onDestroy?.(),m()}},payload:{onGift:()=>{(0,d.showGiftModal)({giftId:10101,recipientIds:e.payload?.recipientIds??[],referrer:e.ref})},reference:e.ref}})})),p=n.stickers.createEvent();(0,s.sample)({clock:p,target:h}),(0,s.sample)({source:h,filter:e=>e!==u,target:g});const f=n.stickers.createEffect((()=>{(0,o.openView)({view:r.ViewId.RANDOM_SELECTOR_PACKS})}));(0,s.sample)({clock:a.openRandomSelectorPacksModal,target:f});const k=n.stickers.createEffect((()=>{(0,o.openView)({view:r.ViewId.RANDOM_SELECTOR_RESULT})}));(0,s.sample)({clock:l.openRandomSelectorResultModal,target:k}),(0,s.sample)({clock:c.buyFx.finally,source:h,filter:()=>!(0,_.curBox)(),fn:e=>({...e,payload:{...e.payload,preventReload:!0}}),target:g})},800713:(e,t,i)=>{i.d(t,{VmojiLangSection:()=>h,storeActivateProduct:()=>u,storeDeactivateProduct:()=>m,vmojiGetAvatar:()=>n,vmojiGetCharacterById:()=>d,vmojiGetLangs:()=>g,vmojiGetStickerPacks:()=>l,vmojiGetStickerPacksRecommendationBlock:()=>a,vmojiGetStickerPacksRecommendationBlocks:()=>c,vmojiPurchaseProduct:()=>r,vmojiSetAvatarState:()=>_,vmojiSubscribeToQueue:()=>o});var s=i(957994);const o=()=>(0,s.api)("vmoji.subscribeToQueue",{}),r=(e,t=!1)=>(0,s.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0}),n=e=>{const t={};return e&&Object.assign(t,{avatar_id:e}),(0,s.api)("vmoji.getAvatar",t)},c=e=>(0,s.api)("vmoji.getStickerPacksRecommendationBlocks",e),a=(e,t)=>{const i={block_id:e};return t&&Object.assign(i,{count:t}),(0,s.api)("vmoji.getStickerPacksRecommendationBlock",i)},l=e=>(0,s.api)("vmoji.getStickerPacks",e),d=(e,t)=>(0,s.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0}),_=(e,t)=>(0,s.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0}),u=e=>(0,s.api)("store.activateProduct",{type:"stickers",product_id:e}),m=e=>(0,s.api)("store.deactivateProduct",{type:"stickers",product_id:e});var h=function(e){return e.LAYER="layer",e.PURCHASE="purchase",e}({});const g=e=>new Promise(((t,i)=>{window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:()=>{t()},onFail:()=>(i(),!1)})}))},386779:(e,t,i)=>{i.d(t,{LangPackIdProvider:()=>r,useLangPackId:()=>n});var s=i(296540);const o=(0,s.createContext)(void 0),r=o.Provider;function n(){return(0,s.useContext)(o)}},220866:(e,t,i)=>{i.d(t,{lang:()=>s});const s=(0,i(32489).createDomain)()},495520:(e,t,i)=>{i.d(t,{$packs:()=>n,loadPack:()=>o,loadPackFx:()=>r});var s=i(220866);const o=async({name:e,lang:t,domain:i,cacheAge:s=600})=>{const o=new URL("/js/lang-pack.js",(r=i)?r.startsWith("http")?r:`https://${r}`:`https://${location.hostname}`);var r;o.searchParams.set("name",e),o.searchParams.set("format","json"),o.searchParams.set("cache_age",String(s)),void 0!==t&&o.searchParams.set("lang",String(t));const n=await fetch(String(o));return await n.json()},r=s.lang.createEffect((async({id:e,name:t,lang:i,domain:s,cacheAge:r=600})=>({id:e,pack:await o({name:t,lang:i,domain:s,cacheAge:r})}))),n=s.lang.createStore({}).on(r.doneData,((e,{id:t,pack:i})=>({...e,[t]:i})))},1578:(e,t,i)=>{i.d(t,{useLangPack:()=>n});var s=i(293721),o=i(495520),r=i(386779);function n(){const e=(0,r.useLangPackId)();if(!e)throw new Error("Отсутствует обертка LangPackProvider");const t=(0,s.useUnit)(o.$packs)[e];return{translate:(e,i)=>{if(!e||!t)return" ";const{keys:s}=t;if(!(e in s))return e;let o=String(s[e]);return i&&(o=o.replace(/{([^]+?)}/g,((e,t)=>{const s=i[t];return void 0===s?"":String(s)}))),o},pack:t}}},138560:(e,t,i)=>{i.d(t,{$tabbarActiveTab:()=>a,$tabbarActiveTabState:()=>l,setTabbarActiveTab:()=>c});var s=i(32489),o=i(175325),r=i(348385),n=i(516413);const c=o.stickersEmojiKeyboard.createEvent(),a=o.stickersEmojiKeyboard.createStore(n.Tab.EMOJI).on(c,((e,t)=>t)),l=(0,s.combine)(a,(e=>({isEmojiActiveTab:e===n.Tab.EMOJI,isStickersActiveTab:e===n.Tab.STICKERS})));(0,s.sample)({clock:r.changeAPIOptions,source:r.$api,fn:e=>e.cache.tabbarActiveTab.get()||n.Tab.EMOJI,target:c})},516413:(e,t,i)=>{i.d(t,{Tab:()=>s});var s=function(e){return e.EMOJI="emoji",e.STICKERS="stickers",e}({});Object.values(s)},794310:(e,t,i)=>{i.d(t,{Sticker:()=>p});var s=i(474848),o=i(351118),r=i(812153),n=i(296540),c=i(220208),a=i(197989),l=i(221223),d=i(216670),_=i(235717),u=i(743330);const m=92,h=16,g=new Set;function p({size:e,theme:t,plain:i,configs:p,dynamic:f,favorite:k,disabled:S,defaultConfigId:w,onFavoriteClick:E,sticker:v,noAnimation:T,renderAsStaticImage:C,UNSAFE_imageUrl:b,UNSAFE_animationUrl:j,name:P,group:I="sticker",loading:y,className:R,style:O,onClick:L,...A}){const{hasPointer:M}=(0,c.useAdaptivityWithJSMediaQueries)(),x=(0,d.getStickerContext)(v),B=(0,l.useOverlay)(x),{imageUrl:D,animationUrl:N}=(0,n.useMemo)((()=>{if(b||j)return{imageUrl:b,animationUrl:j};if(!v)return{};const i=_.BaseUrlBuilder.getAnimation({type:t,animations:x.animations})?.url||x.animationUrl;return{imageUrl:new _.BaseUrlBuilder({size:e,theme:t,configs:p,defaultConfigId:w,imageId:x.id,configContext:x.imageConfigContext,images:t===_.Theme.LIGHT?x.images:x.imagesWithBackground}).build(),animationUrl:i}}),[e,t,v,p,w,b,j]),[K,H]=(0,n.useState)(!g.has(D)),{lottieContainerRef:U,lottieLoading:W,lottieError:F}=(0,r.useLottie)({group:I,width:e,height:e,loop:!0,autoplay:!T,name:N||"",animationUrl:B?void 0:N});(0,n.useEffect)((()=>{f||H(!g.has(D))}),[D,f]);const V=!N||F||C,$=K&&W,G=Boolean(!i&&L),z=$||Boolean(B),q=e/m,Y=Math.round(h*q);return(0,s.jsx)(c.Flex,{noWrap:!0,align:"center",justify:"center","data-testid":`sticker${N?"-animated":""}${x.id?`-${x.id}`:""}`,className:(0,o.classNames)(u.default.sticker,S&&u.default.disabled,z&&u.default.placeholder,G&&u.default.tappable,R),style:{"--sticker-size":`${e}px`,"--sticker-scale":String(q.toFixed(2)),width:e,height:e,...O},onClick:e=>L?.(e,D||void 0),...A,children:(0,s.jsxs)("div",{ref:U,className:u.default.in,children:[E&&M&&!$&&(0,s.jsx)(a.FavoriteButton,{className:u.default.favorite,active:k,width:Y,height:Y,onClick:e=>{e.stopPropagation(),E?.()}}),V&&!B&&(0,s.jsx)("img",{className:u.default.content,alt:"",crossOrigin:"anonymous",src:D,loading:y,onError:()=>{H(!g.has(D))},onLoad:()=>{g.add(D),H(!1)}}),B]})})}},197989:(e,t,i)=>{i.d(t,{FavoriteButton:()=>c});var s=i(474848),o=i(351118),r=i(760435),n=i(465063);function c({active:e,className:t,...i}){return(0,s.jsx)(r.Icon20Favorite,{className:(0,o.classNames)(n.default.favorite,{[n.default.active]:e},t),...i})}},877496:(e,t,i)=>{i.d(t,{AgeRestrictedOverlay:()=>c});var s=i(474848),o=i(1578),r=i(319204),n=i(502567);function c(){const{translate:e}=(0,o.useLangPack)();return(0,s.jsx)(n.Overlay,{icon:(0,s.jsx)(r.Icon2418CircleOutline,{}),description:e("stickers_kit_sticker_age_restricted")})}},88738:(e,t,i)=>{i.d(t,{BannedOverlay:()=>c});var s=i(474848),o=i(884433),r=i(1578),n=i(502567);function c(){const{translate:e}=(0,r.useLangPack)();return(0,s.jsx)(n.Overlay,{icon:(0,s.jsx)(o.Icon24BlockOutline,{}),description:e("stickers_kit_sticker_banned")})}},703006:(e,t,i)=>{i.d(t,{DeletedOverlay:()=>c});var s=i(474848),o=i(782281),r=i(1578),n=i(502567);function c(){const{translate:e}=(0,r.useLangPack)();return(0,s.jsx)(n.Overlay,{icon:(0,s.jsx)(o.Icon24DeleteOutline,{}),description:e("stickers_kit_sticker_deleted")})}},326370:(e,t,i)=>{i.d(t,{ModerationOverlay:()=>c});var s=i(474848),o=i(762964),r=i(1578),n=i(502567);function c(){const{translate:e}=(0,r.useLangPack)();return(0,s.jsx)(n.Overlay,{icon:(0,s.jsx)(o.Icon24ClockOutline,{}),description:e("stickers_kit_ugc_sticker_in_moderation")})}},502567:(e,t,i)=>{i.d(t,{Overlay:()=>n});var s=i(474848),o=i(220208),r=i(357381);function n({icon:e,description:t}){return(0,s.jsxs)(o.Flex,{noWrap:!0,direction:"column",justify:"center",align:"center",className:r.default.overlay,children:[e,t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Spacing,{size:2}),(0,s.jsx)(o.Subhead,{dangerouslySetInnerHTML:{__html:t},useAccentWeight:!0})]})]})}},221223:(e,t,i)=>{i.d(t,{useOverlay:()=>a});var s=i(474848),o=i(88738),r=i(703006),n=i(326370),c=i(877496);function a({isUGC:e,isDeleted:t,isBanned:i,isRejected:a,isClaimed:l,isActiveAgeRestriction:d}){return e?t?(0,s.jsx)(r.DeletedOverlay,{}):i||a?(0,s.jsx)(o.BannedOverlay,{}):l?(0,s.jsx)(n.ModerationOverlay,{}):d?(0,s.jsx)(c.AgeRestrictedOverlay,{}):null:null}},216670:(e,t,i)=>{i.d(t,{getStickerContext:()=>o});var s=i(256640);function o(e){return e instanceof s.StickerContext?e:new s.StickerContext(e)}},256640:(e,t,i)=>{i.d(t,{StickerContext:()=>s,getStickerContext:()=>o});class s{get rawData(){return this.ugc||this.base}get isUGC(){return Boolean(this.ugc)}get isPopup(){return Boolean(this.base?.popup)}get isBase(){return Boolean(this.base)}get id(){return this.base?.sticker_id||this.ugc?.id}get ownerId(){return this.ugc?.owner_id}get packId(){return this.base?.product_id||this.ugc?.pack_id}get images(){return this.base?.images||this.ugc?.images}get imagesWithBackground(){return this.base?.images_with_background||this.base?.images||this.ugc?.images}get animations(){return this.base?.animations}get animationUrl(){return this.base?.animation_url}get imageConfigContext(){return this.base?.image_config_context}get isAllowed(){return!!this.isUGC||this.base?.is_allowed}get isActiveAgeRestriction(){return"age_18"===this.ugc?.active_restriction}get isBanned(){return"banned"===this.ugc?.status}get isRejected(){return"rejected"===this.ugc?.status}get isDeleted(){return Boolean(this.ugc?.is_deleted)}get isClaimed(){return Boolean(this.ugc?.is_claimed)}get popupLayers(){return this.base?.popup?.layers}constructor(e){e&&("id"in e?this.ugc=e:"sticker_id"in e&&(this.base=e))}}function o(...e){return new s(...e)}},235717:(e,t,i)=>{i.d(t,{BaseUrlBuilder:()=>n,BaseUrlImageVariant:()=>r,Theme:()=>o});var s=i(386099),o=function(e){return e.LIGHT="light",e.DARK="dark",e}({}),r=function(e){return e.SQUARE="square",e}({});class n{setSize(e){return this.size=e,this}setTheme(e){return this.theme=e,this}setFormat(e){return this.format=e,this}setImageId(e){return this.imageId=e,this}setDefaultConfigId(e){return this.defaultConfigId=e,this}setImages(e){return this.images=e,this}setConfigs(e){return this.configs=e,this}setConfigContext(e){return this.configContext=e,this}build(){return this.images?this.findImage():this.configContext||this.configs?.length?this.buildBaseUrl():void 0}static build({config:e,variant:t,size:i,retinaSize:o,format:r=n.DEFAULT_FORMAT}){if(!e)return"";const{base_url:c,version:a}=e;o&&s.PIXEL_RATIO>s.DEFAULT_PIXEL_RATIO&&(i=o);return`${c}/${t}${i>1?`_${i}x`:""}.${r}${void 0!==a?`?${a}`:""}`}get retinaSize(){return this.upscale?Number(this.size)*s.PIXEL_RATIO:Number(this.size)}static getAnimation({type:e,animations:t}){return t?.find((t=>t.type===e))}findImage(){const e=this.retinaSize;if(this.images?.length)return(this.images.find((t=>t.theme===this.theme&&(t.height>=e||t.width>=e)))??this.images.find((t=>t.height>=e||t.width>=e))??this.images[this.images.length-1])?.url}buildBaseUrl(){const{config_id:e}=this.configContext||{},t=this.configs?.find((({id:t})=>t===e||t===this.defaultConfigId));if(!t)return this.findImage();const{pattern:i,sizes:s,theme_modifiers:o}=t;return i.replace(/{([^]+?)}/g,((e,t)=>{switch(t){case"image_id":return this.getImageIdModifier();case"size":return this.getSizeModifier(s);case"version":return this.getVersionModifier();case"theme_modifier":return this.getCommonModifier(o,this.theme);case"format":return this.getCommonModifier(this.formatModifiers,this.format)}return""}))}getImageIdModifier(){return String(this.imageId)}getSizeModifier(e){const t=this.retinaSize,i=e.find((({width:e,height:i})=>e>=t||i>=t));if(!i)return String(t);const{modifier:s,format_modifiers:o}=i;return this.formatModifiers=o,s}getVersionModifier(){const e=this.configContext?.version;return e?String(e):""}getCommonModifier(e,t){const i=e?.find((({id:e})=>e===t));if(!i)return"";const{modifier:s}=i;return s}constructor({size:e,theme:t,format:i,upscale:s,imageId:o,defaultConfigId:r,images:c,configs:a,configContext:l}){this.format=n.DEFAULT_FORMAT,this.upscale=!0,this.size=e,this.theme=t||"light",this.format=i||"png",this.imageId=o,this.defaultConfigId=r,void 0!==s&&(this.upscale=s),c?.[0]?.theme&&(c=c.sort((({theme:e},{theme:i})=>Number(e===t)-Number(i===t)))),this.images=c,this.configs=a,this.configContext=l}}n.DEFAULT_FORMAT="png"},384597:(e,t,i)=>{function s(e,t,i){return Math.max(t,Math.min(e,i))}i.d(t,{clamp:()=>s})},386099:(e,t,i)=>{i.d(t,{DEFAULT_PIXEL_RATIO:()=>o,PIXEL_RATIO:()=>r});var s=i(384597);const o=1,r="undefined"!=typeof window?Math.ceil((0,s.clamp)(window.devicePixelRatio,1,2)):o},743330:(e,t,i)=>{i.d(t,{default:()=>s});const s={sticker:"Sticker__sticker--F1vBN",placeholder:"Sticker__placeholder--C8dEf",in:"Sticker__in--DSGaC",tappable:"Sticker__tappable--xd9lO",content:"Sticker__content--tbTpn",disabled:"Sticker__disabled--u9u2z",favorite:"Sticker__favorite--rPyfx"}},465063:(e,t,i)=>{i.d(t,{default:()=>s});const s={favorite:"FavoriteButton__favorite--6DIaW",active:"FavoriteButton__active--nhIe3"}},357381:(e,t,i)=>{i.d(t,{default:()=>s});const s={overlay:"Overlay__overlay--vmL4M"}},141821:(e,t,i)=>{i.d(t,{Icon24Gift:()=>r});var s=i(474848),o=(i(296540),i(506447));const r=e=>(0,s.jsx)(o.SvgIconRootV2,{viewBox:"0 0 24 24",width:24,height:24,vkuiIconId:"gift_24",vkuiProps:e,children:(0,s.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,s.jsx)("path",{d:"M0 0h24v24H0z"}),(0,s.jsx)("path",{fill:"currentColor",d:"M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2m-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5q1.5.5 3 5 1.5-4.5 3-5c1.5-.5 3.5 1 3.5 2.5S15 8 12 8"})]})})}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/a175c702.15594520.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/web/chunks/a175c702.15594520.js",e),e}