try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[28330],{428330:(e,t,o)=>{o.d(t,{_:()=>D});var i=o(178009),n=o(956905),l=o(917128),a=o(326107),r=o(719273),s=o(257263),d=o(419299),u=o(888920),p=o(752855),c=o(80965),f=o(111198),h=o(7907),_=o(799835),g=o(126607),m=o(928363),b=o(2096),v=o(405546),w=o(375512),S=o(389597),y=o(722007),U=o(144819),k=o(725308),C=o(786241),T=o(705880),x=o(71541),O=o(422091),F=o(9467),L=o(830356),A=o(161933);const z=new x.E(new O.z),P={c:1,h:{},reg:function(e){return P.h[P.c]=(0,a.Tn)(e)?e:function(){},P.c++}},D={init:function(e,t,n,l){o._dG("uploadInterface",void 0!==window.uploadInterface?window.uploadInterface+1:0);let r=window.uploadInterface;return(0,a.__)(["obj","dropbox","options","vars","types","uploadUrls","callbacks","checks","dragTimer","sessions","files"],(function(e,t){D[t]||(D[t]={})})),this.obj[r]=(0,i.ge)(e),l.dropbox&&(this.dropbox[r]=(0,i.ge)(l.dropbox)),this.vars[r]=n,l.file_input=(0,i.ge)(l.file_input),this.options[r]=l,l.clear&&window.cur.destroy.push(D.deinit.pbind(r)),this.uploadUrls[r]=t,l.customShowProgress?l.customShowProgress():this.obj[r]&&("INPUT"!==this.obj[r].tagName||this.checkFileApi()?this.obj[r].innerHTML='<div class="upload_check loading">'+(0,c.P1)("","pr_medium upload_pr")+"</div>":this.obj[r]=(0,i.ge)(l.fieldEl)||this.obj[r].parentNode.firstChild),l.noCheck?this.embed(r):this.check(r),r},deinit:function(e){if(!D.obj[e])return;let t=(D.options[e]||{}).dragEvObj;if(t&&((0,n.Nn)(t,"dragenter"),(0,n.Nn)(t,"dragover"),(0,n.Nn)(t,"dragleave")),(0,a.__)(["obj","dropbox","options","vars","types","uploadUrls","callbacks"],(function(t,o){D[o]&&delete D[o][e]})),D.callbacks){let t=["oncheck","ondone","onfail"];(0,a.__)(D.flashCallbacks(),(function(e,o){t.push(e)})),(0,a.__)(t,(function(t,o){delete D.callbacks[o+e]}))}clearTimeout(D.checks["timer"+e]),clearTimeout(D.dragTimer[e]),delete D.dragTimer[e]},check:function(e){let t=this.obj[e],o=this.vars[e],n=this.options[e],l=n.check_url?n.check_url:this.uploadUrls[e],a={};if(n.signed){if(!l)return D.onCheckComplete(e);(0,r.X)(a,{_jsonp:P.reg((function(t){D.onCheckComplete(e,t)}))})}else{if(!n.check_hash&&!n.server)return D.onCheckComplete(e);if(n.use_go_uploader)return D.onCheckComplete(e);this.callbacks["oncheck"+e]=D.onCheckComplete.pbind(e);let t=["mid","aid","gid","hash","rhash"];for(let e in t)t.hasOwnProperty(e)&&(a[t[e]]=o[t[e]]);n.check_aid&&(a.aid=n.check_aid),n.check_gid&&(a.gid=n.check_gid),n.check_hash&&(a.hash=n.check_hash),n.check_rhash&&(a.rhash=n.check_rhash),o.https_resp&&(a.https_resp=o.https_resp),(0,r.X)(a,{al:1,act:"check_upload",type:n.type,ondone:"Upload.callbacks.oncheck"+e})}let s='<form action="'+l+'" enctype="multipart/form-data" method="post" id="check_upload_form'+e+'" target="check_iframe'+e+'">';for(let e in a)a.hasOwnProperty(e)&&(s+='<input type="hidden" name="'+e+'" value="'+a[e]+'" />');s+='</form><iframe style="visibility: hidden; width: 1px; height: 1px;" id="check_iframe'+e+'" name="check_iframe'+e+'"></iframe>';let d=(0,i.ce)("div",{id:"check_upload_"+e,innerHTML:s,className:n.checkClass||""},{display:"none"});(0,i.ge)("check_upload_"+e)&&(0,i.re)("check_upload_"+e),t.appendChild(d);let u=(0,i.ge)("check_upload_form"+e);if(!u)return;if(!(0,A.hS)()){try{u&&u.submit(),clearTimeout(D.checks["timer"+e]),this.checks["timer"+e]=setTimeout(D.serverFail.pbind(e),1e4)}catch(e){(0,v.cY)(e)}return}const p=document.getElementById("check_upload_"+e),c=new FormData;[...p.querySelectorAll("input")].forEach((e=>{c.append(e.name,e.value)})),fetch(l,{method:"POST",body:c}).then((()=>D.callbacks["oncheck"+e]()))},onCheckComplete:function(e,t){clearTimeout(D.checks["timer"+e]),delete D.checks["timer"+e];let o={},i=D.options[e],n=t;if(i.signed)o=(0,h.O)(t||"{}");else{t=(t=t||"").split("&");for(let e in t)if(t.hasOwnProperty(e)){let i=t[e].split("=");o[i[0]]=i[1]}n=o}i.customHideProgress&&i.customHideProgress(),o.error||o.fail?D.serverFail(e,n):(i.noCheck=1,i.onCheckComplete?i.onCheckComplete(e):D.embed(e),D.serverSuccess(e,n))},serverFail:function(e,t){let o=D.obj[e],i=D.options[e],n=D.vars[e];if(!o)return;if(!i.signed&&!i.server)return;if(D.fails||(D.fails={}),D.fails[e]=D.fails[e]?D.fails[e]+1:1,i.signed){let n=D.uploadUrls[e].split("?"),a=(0,m.fromQueryString)(n[1]),s=(0,r.X)({act:"check_result",_resign:a._query||n[1]},t?{_query:t}:{_check:i.check_url.split("?")[1]});return void window.ajax.post("upload_fails.php",s,{onDone:function(t,n,a,s){D.fails[e]<i.max_attempts?(D.uploadUrls[e]=t,(0,r.X)(D.options[e],{check_url:n,base_url:a,static_url:s}),D.check(e)):(o.innerHTML="",i.lang&&i.lang.cannot_upload_title&&i.lang.cannot_upload_text&&(0,l.NL)({title:i.lang.cannot_upload_title,width:430,bodyStyle:"padding: 20px; line-height: 160%;"},i.lang.cannot_upload_text))}})}let a=(0,r.X)({act:"fail",role:i.type,mid:n.mid,oid:n.oid,gid:n.gid,aid:n.aid,server:i.server,st2_server:i.st2_server,error:i.error,hash:i.error_hash,hash_extra:n.hash_extra},t);i.custom_hash&&(0,r.X)(a,{custom_hash:i.custom_hash,photo_hash:n.photo_hash,size:n.size,fid:n.fid,vid:n.vid,tag:n.tag}),n.transform_entry&&(0,r.X)(a,{transform_entry:n.transform_entry,transform_hash:n.transform_hash,security_hash:n.security_hash}),window.ajax.post("upload_fails.php",a,{onDone:function(t,n,a){D.fails[e]<i.max_attempts?(D.uploadUrls[e]=t,(0,r.X)(D.options[e],a),(0,r.X)(D.vars[e],n),D.check(e)):(o.innerHTML="",i.lang&&i.lang.cannot_upload_title&&i.lang.cannot_upload_text&&(0,l.NL)({title:i.lang.cannot_upload_title,width:430,bodyStyle:"padding: 20px; line-height: 160%;"},i.lang.cannot_upload_text))}})},serverSuccess:function(e,t){let o=D.options[e],i=D.vars[e];if(D.checked=D.checked||{},D.checked[e]=1,o.signed)return void window.ajax.post("upload_fails.php",{act:"check_result",_query:t});if(!o.server&&!o.error_hash)return;let n=(0,r.X)({act:"success",mid:i.mid,oid:i.oid,gid:i.gid,aid:i.aid,server:o.server,error:o.error,hash:o.error_hash},t);window.ajax.post("upload_fails.php",n)},embed:function(e){let t=null!=e.num?e.num:e,o=this.obj[t],n=this.dropbox[t],l=this.options[t];l.noEmbed?(0,i.re)("check_upload_"+e):l.noCheck&&o&&(this.checkFileApi()?this.initFileApi(t,o,n):l.noForm||this.initForm(t,o))},checkFileApi:()=>(window.XMLHttpRequest||window.XDomainRequest)&&(window.FormData||window.FileReader&&(window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary||window.ArrayBuffer&&window.Uint8Array&&(window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder))),initForm:function(e,t){let o=e,n=this.vars[o],l=this.options[o];this.types[o]="form";let a='<form action="'+this.uploadUrls[o]+'" enctype="multipart/form-data" method="post" id="file_uploader_form'+o+'" target="upload_iframe'+o+'" style="text-align: center; width: 100%;">';if(l.signed)(0,r.X)(n,{_jsonp:P.reg((function(e){D.onUploadComplete(o,e)}))});else{let e=D.onUploadComplete.pbind(o),t=D.onUploadError.pbind(o);this.callbacks["ondone"+o]=function(){let t=e.pbind.apply(e,arguments);setTimeout((function(){t()}),1)},this.callbacks["onfail"+o]=function(){let e=t.pbind.apply(t,arguments);setTimeout((function(){e()}),1)},(0,r.X)(n,{al:1,ondone:"Upload.callbacks.ondone"+o,onfail:"Upload.callbacks.onfail"+o})}for(let e in n)n.hasOwnProperty(e)&&(a+='<input type="hidden" name="'+e+'" value="'+n[e]+'" />');let s='<input type="file" class="file" size="28" onchange="'+(l.uploadButton?"Upload.onUploadFileSelected("+o+")":"Upload.onUploadStart("+o+");")+'" name="'+l.file_name+'" style="cursor: pointer;"'+(l.accept?' accept="'+l.accept+'"':"")+'/></form><iframe style="position: absolute; visibility: hidden; width: 1px; height: 1px;" id="upload_iframe'+o+'" name="upload_iframe'+o+'"></iframe>';l.label?a+=l.label.split("{file}").join(s):a+=s,t.innerHTML=a;let d=l.file_input,u=(0,i.vo)("file",t,"input");delete l.file_input,d&&u&&(u.parentNode.replaceChild(d,u),d.onchange=function(){D.onUploadStart(o)},(0,i.p)(d,"changed")&&((0,i.p)(d,"changed",!1),d.onchange())),l.uploadButton&&l.setUploadAction?l.setUploadAction(e,(function(){D.onUploadStart(o)})):l.uploadButton&&!0!==l.uploadButton&&((0,i.ge)(l.uploadButton).onclick=function(){D.onUploadStart(o)})},buttonOver:function(e){(0,i.iQ)((0,i.ge)("lite_upload"+e).nextSibling,"hover")},buttonOut:function(e){(0,i.vy)((0,i.ge)("lite_upload"+e).nextSibling,"hover"),(0,i.vy)((0,i.ge)("lite_upload"+e).nextSibling,"active")},buttonDown:function(e){(0,i.iQ)((0,i.ge)("lite_upload"+e).nextSibling,"active")},buttonUp:function(e){(0,i.vy)((0,i.ge)("lite_upload"+e).nextSibling,"active")},initFileApi:function(e,t,o){let l,a=this.options[e],r=a&&a.dragEl||window.boxLayerWrap;if(o&&r&&(D.addedDocEvent||((0,n.W2)(document,"drop",D.drop),D.addedDocEvent=!0),a.dragEvObj=r,(0,n.W2)(r,"dragenter",D.dragEnter.pbind(e)),(0,n.W2)(r,"dragover",D.dragOver.pbind(e)),(0,n.W2)(r,"dragleave",D.dragOut.pbind(e))),this.types[e]="fileApi",a.chooseBox)l='<input class="file" type="file" size="28" onchange="Upload.onFileApiSend('+e+', this.files);"'+(a.multiple?' multiple="true"':"")+(a.accept?' accept="'+a.accept+'"':"")+' name="'+a.file_name+'" style="cursor: pointer;"/>';else if(a.uploadButton)a.lang.button_browse||(a.lang.button_browse="Выбрать файл"),l='<button class="flat_button upload_btn fl_l '+(a.buttonClass||"")+'" onclick="this.nextSibling.nextSibling.click()">'+a.lang.button_browse+'</button><div class="upload_selected fl_l" style="padding: 4px 0 0 10px;"></div><input class="file" type="file" size="28" onchange="geByClass1(\'upload_selected\', this.parentNode).innerHTML = Upload.getFilesNames('+e+", this.files); Upload.onUploadFileSelected("+e+')"'+(a.multiple?' multiple="true"':"")+(a.accept?' accept="'+a.accept+'"':"")+' name="'+a.file_name+'" style="visibility: hidden; position: absolute;"/><br class="clear" />';else if(a.lang.button_browse||(a.lang.button_browse="Выбрать файл"),a.flat_button){const t=u.kc.render({className:"upload_btn"+(a.buttonClass||""),appearance:p.M.PRIMARY,size:p.v.M,children:a.lang.button_browse,restAttrs:{onclick:"document.querySelector('.flat_button_file').click()"}}),o=`<input class="file flat_button_file" type="file" size="28"\n                     onchange="Upload.onFileApiSend('${e}', this.files);" ${a.multiple?' multiple="true"':""} ${a.accept?' accept="'+a.accept+'"':""} name="${a.file_name}" style="visibility: hidden; position: absolute;"/>\n                `,i=document.createElement("div");i.appendChild(t),i.insertAdjacentHTML("beforeend",o),l=i.innerHTML}else l='<button class="flat_button upload_btn '+(a.buttonClass||"")+'" onclick="this.nextSibling.click()">'+a.lang.button_browse+'</button><input class="file" type="file" size="28" onchange="Upload.onFileApiSend('+e+', this.files);"'+(a.multiple?' multiple="true"':"")+(a.accept?' accept="'+a.accept+'"':"")+' name="'+a.file_name+'" style="visibility: hidden; position: absolute;"/>';a.label&&!a.flat_button?t.innerHTML=a.label.split("{file}").join(l):t.innerHTML=l;let s=a.file_input,d=(0,i.vo)("file",t,"input");s&&d&&(d.parentNode.replaceChild(s,d),s.onchange=function(){D.onFileApiSend(e,this.files)},(0,i.p)(s,"changed")&&((0,i.p)(s,"changed",!1),setTimeout(s.onchange.bind(s),0))),a.uploadButton&&a.setUploadAction?a.setUploadAction(e,(function(){D.onFileApiSend(e,(0,i.p7)("input",t).files)})):a.uploadButton&&!0!==a.uploadButton&&((0,i.ge)(a.uploadButton).onclick=function(){D.onFileApiSend(e,(0,i.p7)("input",t).files)})},switchMode:function(e){D.options[e].noCheck=1,D.embed(e)},onUploadFileSelected:function(e){D.options[e].onUploadFileSelected&&D.options[e].onUploadFileSelected()},onUploadStart:function(e,t){window.cur.fileApiUploadStarted=!0;let o=void 0!==e.ind?e.ind:e;if("form"==D.types[o]){(0,i.ge)("file_uploader_form"+o).submit(),(0,i.vo)("file",D.obj[o]).disabled=!0}let n=D.options[o];n.eventCallbacks?.onUploadStart?.(e,t),n.onUploadStart&&(!n.isNeedCheckClipOrVideo||n.isShort||n.is_private_owner?n.onUploadStart(e,t):this.checkFileParams(e.file,n.clips_from_video_duration_min_limit,n.clips_from_video_duration_max_limit).then((({hasMetadata:o,isVideoAsClip:i})=>{n.onUploadStart({...e,is_upload_clip_from_video:i,is_no_metadata:!o},t)})))},getErrorAdditional:function(e){return e.error&&void 0!==e.server&&void 0!==e.bwact?(-1!==e.error.indexOf(":")?",":":")+" from upl_"+(0,a.Jk)(e.server)+"?act="+e.bwact.replace(/[^a-zA-Z_0-9]/g,""):""},onUploadComplete:function(e,t,o){let n,l=void 0!==e.ind?e.ind:e,a=D.options[l];if(void 0!==o&&l===e&&(e=o),"object"==typeof e&&(e.ind=l),"form"==D.types[l]){(0,i.vo)("file",D.obj[l]).disabled=!1}if(a.onUploadComplete){const o=o=>{let i="";a.signed&&(n=o?(0,h.O)(o):"",n?i=D.getErrorAdditional(n):o='{"error":"ERR_CLIENT_UPLOAD_FAIL: upload request bad result, url \\"'+D.uploadUrls[l]+'\\""}'),a.onUploadComplete(e,o,i),"form"===D.types[l]&&D.onUploadCompleteAll(e,o),a.eventCallbacks?.onUploadComplete?.(e,t)};a.useGoUploader&&a.forPlaylist?window.ajax.post("/al_video.php",{act:a.isVertical?"do_save_loaded_playlist_vertical_thumb":"do_save_loaded_playlist_thumb",owner_id:D.vars[l].owner_id,thumb_size:D.vars[l].thumb_size,thumb:t},{onDone:e=>o(JSON.stringify(e)),onFail:()=>(o(),!1)}):a.useGoUploader&&!a.forPlaylist?(0,y.FH)("video.saveUploadedThumb",{owner_id:D.vars[l].owner_id,thumb_json:t,thumb_size:D.vars[l].thumb_size,random_tag:D.vars[l].random_tag}).then((e=>o(JSON.stringify(e)))).catch((()=>o())):o(t)}"video"===a.type?(0,d.Jx)("upload_video_fails",1,a.server,"success"):"photo"===a.type?(0,d.Jx)("upload_photo_fails",1,a.server,"success"):"doc"===a.type&&(0,d.Jx)("upload_doc_fails",1,a.server,"success")},onUploadCompleteAll:function(e,t,o){let n=void 0!==e.ind?e.ind:e,l=D.options[n];if(void 0!==o&&n===e&&(e=o),"fileApi"===D.types[n]){let e=(0,i.vo)("file",D.obj[n],"input");e&&(e.value="")}let a={duration:Date.now()-l.uploadStartedTs,type:l.type,total_size:l.filesTotalSize};"subtitles"!==l.type&&this.sendUploadStat(n,a),l.onUploadCompleteAll&&l.onUploadCompleteAll(e,t)},onUploadError:function(e,t){let o=void 0!==e.ind?e.ind:e,n=D.options[o]||{};if("form"===D.types[o]){(0,i.vo)("file",D.obj[o]).disabled=!1}n.signed?n.onUploadComplete&&n.onUploadComplete(e,'{"error":"ERR_CLIENT_UPLOAD_FAIL: upload request fail, code \\"'+t.replace(/([\\\"])/g,"\\$1").replace(/\n/g,"\\n")+'\\", url \\"'+D.uploadUrls[o]+'\\""}'):n.onUploadError&&n.onUploadError(e,t),n.eventCallbacks?.onUploadError?.(e,t)},onConnectionLost:function(e){let t=void 0!==e.ind?e.ind:e,o=D.options[t];o.onConnectionLost&&o.onConnectionLost(e)},onUploadProgress:function(e,t,o){let i=void 0!==e.ind?e.ind:e,n=D.options[i];n.onUploadProgress&&n.onUploadProgress(e,t,o)},onDebug:function(e,t){let o=void 0!==e.ind?e.ind:e,i=D.options[o];i.onDebug&&i.onDebug(e,t)},onSelectClick:function(e,t){let o=void 0!==e.ind?e.ind:e,i=D.options[o];i.onSelectClick&&i.onSelectClick(e,t)},getFilesNames:function(e,t){if(!t||!t.length)return;let o=this.options[e];return o.multiple?(o.lang.selected_num_files||(o.lang.selected_num_files=["","%s файл","%s файла","%s файлов"]),(0,_.Q1)(t.length,o.lang.selected_num_files)):t[0].name.replace(/[&<>"']/g,"")},checkFileType:function(e,t,o){let i=!1;if(o&&""!==o){let t=!0;if((0,a.__)(o.split(";"),(function(o,i){if(i=i.substr(1).toLowerCase(),e.substr(-i.length).toLowerCase()==i)return t=!1,!1})),!t)return!1}return(0,a.__)(t.split(";"),(function(t,o){if(o=o.substr(1).toLowerCase(),e.substr(-o.length).toLowerCase()==o||".*"==o)return i=!0,!1})),i},checkFilesSizes:function(e,t){let o=this.options[e];if(o.forPlaylist&&o.useGoUploader)return!0;if(o.file_size_limit)for(let i in t)if(t.hasOwnProperty(i)){let n=t[i];if(n.size&&n.size>o.file_size_limit){let t=o.lang.filesize_error;return t&&t.indexOf("{count}")>=0&&(t=o.file_size_limit>=1048576?t.replace("{count}",(0,a.Jk)(o.file_size_limit/1048576)):t.replace("{count}",(0,a.Jk)(o.file_size_limit/1024))),t&&(0,l.NL)({title:(0,_.Xo)("global_error"),width:430,bodyStyle:"padding: 20px; line-height: 160%;",onHide:function(){D.embed(e),delete cur.notStarted}},t,(0,_.Xo)("global_cancel")),!1}}return!0},checkFilesDuration:async function(e,t=0,o=0){if(t||o)for(let i in e)if(e.hasOwnProperty(i)){let n=e[i];const a=await(0,C.H)(n);if(null!==a&&(a.duration>o||a.duration<t))return(0,l.NL)({title:(0,_.Xo)("global_error"),width:430,bodyStyle:"padding: 20px; line-height: 160%;"},(0,_.Xo)("video_clip_duration_limit_text_1s"),(0,_.Xo)("global_close")),!1}return!0},checkFileParams:async function(e,t=0,o=0){const i=await(0,C.H)(e);return{hasMetadata:!!i&&"duration"in i&&"height"in i&&"width"in i,isVideoAsClip:i&&i.width<i.height&&i.duration<o&&i.duration>t}},checkShortVideoAspectRatio:async function(e,t=0,o=0){if(o)for(let i in e)if(e.hasOwnProperty(i)){let n=e[i];const l=await(0,C.H)(n);if(l&&l.width<l.height&&l.duration<o&&l.duration>t)return!0}return!1},checkClipSize:async function(e,t=0){if(t){const o=e[0].size;if(o&&o>t)return(0,l.NL)({title:(0,_.Xo)("global_notify_error_occured"),width:430,bodyStyle:"padding: 20px; line-height: 160%;"},(0,_.Xo)("video_clip_size_limit_text_8gb"),(0,_.Xo)("video_clip_size_limit_ok_btn")),!1}return!0},onFileApiSend:async function(e,t,o){if(!t||!t.length)return;let i=this.options[e];if(i.isShort&&(0,d.Jx)("clips_uploader",1,"upload_file"),i.file_types){let e=[];if((0,a.__)(t,(function(t,o){D.checkFileType(o.name,i.file_types,i.file_disallowed_types)&&e.push(o)})),!e.length)return void(i.onNoFilteredCallback&&i.onNoFilteredCallback(t));t=e}if(i.filterCallback&&!(t=i.filterCallback(e,t)).length)return;if(i.reverse_files&&(t=Array.prototype.slice.call(t).reverse()),!i.multiple&&t.length>1&&(t=[t[0]]),!this.checkFilesSizes(e,t))return;if(i.isShort&&!await this.checkFilesDuration(t,i.clips_duration_min_limit,i.clips_duration_max_limit))return void D.embed(e);if(i.isShort&&!await this.checkClipSize(t,i.clips_size_max_limit))return void D.embed(e);if(!i.isShort&&!i.is_private_owner&&i.isNeedCheckClipOrVideo){if(1===t.length){const o=D.vars[e];if(await this.checkShortVideoAspectRatio([t[0]],i.clips_from_video_duration_min_limit,i.clips_from_video_duration_max_limit)){const e=await(0,L.eo)(o.oid);return(0,L.rd)(t,e),void(0,L.gH)(o.oid)}}await i.getNewClipUploadConfig()}if(i.photoBox&&!o)return D.onPhotoAdd(e,t);if(i.withoutAutoUpload&&!o)return void(i.onFilesSelected&&i.onFilesSelected(e,t));i.beforeUpload&&i.beforeUpload(e),window.cur.notStarted=window.cur.fileApiUploadStarted=!0,i.multi_progress||this.onUploadStart({ind:e,fileName:(t[0].fileName||t[0].name||"").replace(/[&<>"']/g,""),file:t[0]});let n=t.length;if(i.max_files){let o=cur.attachCount;if(!o&&cur.addMedia){let e=-1;for(let t in cur.addMedia)t>e&&(e=t);e>=0&&cur.addMedia[e]&&cur.addMedia[e].attachCount&&(o=cur.addMedia[e].attachCount)}let a=o?o():0,r=(i.max_files_warning||(0,_.Xo)("global_attach_max_n_files",i.max_files)).replace("{count}",i.max_files);i.max_files-a<t.length?(n=i.max_files-a,(0,l.NL)({title:(0,_.Xo)("global_error"),width:430,bodyStyle:"padding: 20px; line-height: 160%;",onHide:function(){D.embed(e),delete cur.notStarted,i.onMaxCount&&i.onMaxCount()}},r,(0,_.Xo)("global_continue"),(function(){D.uploadFiles(e,t,n),i.max_files_hide_last?(0,b.kI)().hide():(0,b.H_)().hideAll()}),(0,_.Xo)("global_cancel"))):(i.force_max_files&&(n=Math.min(n,i.max_files-(cur.savedPhotos||[]).length)),this.uploadFiles(e,t,n))}else this.uploadFiles(e,t,n)},onPhotoAdd:function(e,t){let o=0,n=0;D.fileList=D.fileList||{},D.fileList[e]||(D.fileList[e]=[],D.options[e].onPhotoBox&&(o=!0)),(0,a.__)(t,(function(t,o){n++;let l=D.options[e].photoBox,a=new RegExp("image.*");o.type.match(a),cur.uploaderPhotoId=(cur.uploaderPhotoId||0)+1;let r=cur.uploaderPhotoId;D.fileList[e][r]=o;let s=(0,i.ce)("img"),d=(0,i.ce)("div",{id:"photos_add_item"+r,className:"photos_add_item",innerHTML:'<span class="photos_add_img photos_add_wait" id="photos_add_cont'+r+'" onmouseover="PhotosAdd.thumbOver('+r+', this);" onmouseout="PhotosAdd.thumbOut('+r+');"><span class="photos_add_s" id="photos_add_s'+r+'">&nbsp;</span></span><span class="bg">&nbsp;</span>'});l.appendChild(d);let u=new FileReader;u.onload=function(e){s.src=e.target.result,s.onload=function(){s.onload=!1;let e,t,o={w:s.width,h:s.height};o.w>130&&(e=130/o.w,o.w=130,o.h=parseInt(o.h*e)),o.h>130&&(t=130/o.h,o.h=130,o.w=parseInt(o.w*t));let n=(0,i.ce)("canvas",{width:o.w,height:o.h});n.getContext("2d").drawImage(s,0,0,o.w,o.h);let l=n.toDataURL("image/jpeg");s.src=l;let a=(0,i.ge)("photos_add_s"+r),d=Math.max(o.w,80),u=Math.min(o.h,98);(0,i.eC)(a,{width:d,height:u,marginLeft:Math.ceil((130-d)/2)}),a.innerHTML="",a.appendChild(s),s.onload=function(){setTimeout((function(){a.parentNode.className="photos_add_img"}),0),s.onload=!1},D.finishTask()}},D.taskToQ((function(){u.readAsDataURL(o)}))})),o&&n&&D.options[e].onPhotoBox(),D.options[e].onPhotoAdd&&n&&D.options[e].onPhotoAdd()},uploadPhotos:function(e){let t=[],o=D.fileList[e];for(let e in o)o[e]&&t.push((0,r.X)(o[e],{fileRef:e}));return D.options[e].onUploadStart&&D.options[e].onUploadStart(),!!t.length&&(cur.uploadCount=Math.min(500,t.length),D.uploadFiles(e,t,cur.uploadCount),!0)},taskToQ:function(e){if(D.previewFileQ||(D.previewFileQ=[]),e&&D.previewFileQ.push(e),D.doingQ)return;let t=D.previewFileQ.shift();t&&(D.doingQ=!0,t())},finishTask:function(){setTimeout((function(){D.doingQ=!1,D.taskToQ()}),100)},uploadFiles:function(e,t,o){if(o<=0)return;let i,n=this.options[e],l=n.signed?this.vars[e]:(0,r.X)(this.vars[e],{ajx:1}),a=0,s=0,d=0,u=0,p=[];if(n.uploading&&(a=n.filesTotalSize||0,s=n.filesTotalCount||0,u=n.filesLoadedCount||0,d=n.filesLoadedSize||0,p=n.filesQueue),n.file_match&&(i=new RegExp(n.file_match,"i")),"add_video"===l.act&&this.vars?.[e]?.oid){const t=(0,U.WO)({id:Date.now(),ownerId:this.vars?.[e]?.oid});(0,r.X)(this.vars[e],{batchId:t})}let c=!1;for(let l=0;l<o;l++){let o=(t[l].fileName||t[l].name||"").replace(/[&<>"']/g,"");!n.file_match||o.match(i)?(n.multi_progress&&!n.multi_sequence&&this.onUploadStart({ind:e,fileName:o,file:t[l]}),a+=t[l].size,s+=1,p.push(t[l])):c=!0}if(p.reverse(),(0,r.X)(n,{filesQueue:p,filesTotalSize:a,filesLoadedSize:d,filesLoadedCount:u,filesTotalCount:s,uploadStartedTs:Date.now()}),p.length>0)if(void 0!==window.cur.multiProgressIndex)window.cur.nextQueues||(window.cur.nextQueues=[]),window.cur.nextQueues.push(e);else{let t=(0,m.toQueryString)(l),o=this.uploadUrls[e]?this.uploadUrls[e]+(this.uploadUrls[e].match(/\?/)?"&":"?")+t:"";n.use_go_uploader&&(o=this.uploadUrls[e]),this.uploadFile(e,p.pop(),o),n.multi_progress&&(window.cur.multiProgressIndex=e)}else c&&D.onUploadError(e,"file type not supported")},getFileInfo:function(e,t,o){return t.multi_progress?{ind:e,fileName:o?(o.fileName||o.name||"").replace(/[&<>"']/g,""):"",num:t.filesLoadedCount,totalSize:t.filesTotalSize,loadedSize:t.filesLoadedSize,totalCount:t.filesTotalCount,file:o}:e},supportsChunkedUpload:function(){return!!Blob&&!!(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice)&&!!FileReader},uploadFileChunkedWithSDK:async function(e,t,o){let i=D.options[e];const n=D.vars[e];let l,a,s=D.getFileInfo(e,i,t);i.multi_sequence&&(window.cur.fileApiUploadStarted=!0);const{hasMetadata:d,isVideoAsClip:u}=await this.checkFileParams(t,i.clips_from_video_duration_min_limit,i.clips_from_video_duration_max_limit);let p,c;l=u,a=!d,(0,F.z2)("client_dev_null_video_uploader_errors")&&(c=w.Mb.ERROR,p={info:()=>null,warn:()=>null,error:(e,t,o)=>{let i;try{i=JSON.stringify({errorData:t,uploadInfo:o})}catch(e){i=e.toString()}z.logEvent({key:"video_uploader_errors",json:i,value_str:e,value_str2:o.video.id})},debug:()=>null});const f=i.uploaderConfig??{chunkSize:i.chunkSize||S.Ms,threadNumber:S.g9,maxRetryNumber:S.oA},h=(1e17*Math.random()).toString(16);i.is_upload_clip_from_video=l&&!i.is_private_owner,a&&(i.is_no_metadata=!0);const _=await this.getUploadDetails(t.size,i,n);"video"===i.type&&_?.owner_id&&_?.video_id&&(0,T.oP)(t,_.owner_id,_.video_id);const g=w.wn.createUploadSession(_.upload_url,t,{...f,logLevel:c,logger:p,headers:{"Session-ID":h},onRestored:e=>{const t=(0,m.fromQueryString)(e.url).vkVideoId;i.onUploadedVideoIdReceived&&i.onUploadedVideoIdReceived(s,t)},onProgress:o=>{(0,r.X)(s,D.getFileInfo(e,i,t)),D.onUploadProgress(s,o,100)},onSuccess:o=>{i.filesLoadedSize+=t.size,i.filesLoadedCount+=1,(0,r.X)(s,D.getFileInfo(e,i,t)),D.onUploadComplete(s,JSON.stringify(o));i.filesQueue&&i.filesQueue.length>0?D.uploadFile(e,i.filesQueue.pop()):(D.startNextQueue(e),D.onUploadCompleteAll(s,JSON.stringify(o)),i.uploading=!1)},onFail:e=>{D.onUploadError(s,String(e))}});D.sessions[e]=g,i.uploadCancelFn=g.cancel.bind(g),g.upload()},getUploadDetails(e,t,o){if(t.isShort||t.is_upload_clip_from_video){const t={file_size:e};return k.z.isGroupId(o.oid)&&(t.group_id=Math.abs(o.oid)),(0,y.FH)("shortVideo.create",t)}return new Promise(((i,n)=>{const l="add_video"===o?.act&&o?.oid&&o?.batchId?{batch_id:o.batchId}:null;return window.ajax.post("al_video.php?act=get_upload_url",{...l,file_size:e,user_agent:window.navigator.userAgent,owner_id:o.oid,tag:o.tag,from:o.from,extra_upload_options:t.extraUploadOptions},{onDone:e=>{i(e)},onFail:e=>{n(e)}})}))},uploadFileChunked:function(e,t,o){let i=this.options[e],n=D.getFileInfo(e,i,t);i.multi_sequence&&this.onUploadStart(n);let l={file:t,fileName:(t.name||t.fileName).replace(/[&<>"']/g,""),fileSize:t.size,fileMime:t.type,retryCount:0,timeouts:[],activeRequests:[],requestsProgress:{},pointer:0,state:{url:o,started:Date.now(),loaded:null,chunkSize:i.chunkSize||4194304,sessionId:(1e17*Math.random()).toString(16)}};l.abort=function(e){(0,a.__)(e.timeouts,(function(e,t){clearTimeout(t)})),(0,a.__)(e.activeRequests,(function(e,t){t.abort()})),e.timeouts=[],e.activeRequests=[]}.bind(null,l),l.chunksNum=Math.ceil(l.fileSize/l.state.chunkSize),l.chunksLeft=l.chunksNum;let s=function(e){l.storageKey=["upload",e,l.fileSize].join("_"),i.uploading=!0,i.chunkedUpload=l;let t=g.ls.get(l.storageKey);t&&(Date.now()-t.started<864e5?(l.state=t,o=t.url):g.ls.remove(l.storageKey));try{console.log("%c Warning: if devtools is logging network requests it may cause high memory usage during file upload","font-size:16px;color:orange;")}catch(e){}u()};const d=D.vars[e];function u(){for(l.pointer=0,l.chunksLeft=l.chunksNum;l.activeRequests.length<4&&l.pointer<l.fileSize;)p()}function p(){let e=l.pointer,t=Math.min(e+l.state.chunkSize,l.fileSize)-1;if(e>=l.fileSize)return;let o=!1;l.state.loaded&&(0,a.__)(l.state.loaded.split(","),(function(i,n){let a=n.match(/^(\d+)-(\d+)\/\d+$/),r=parseInt(a[1]),s=parseInt(a[2]);if(e>=r&&t<=s)return o=!0,l.chunksLeft-=Math.ceil((s+1-e)/l.state.chunkSize),l.pointer=s+1,!1})),o?(f(),p()):(c(e,t),l.pointer+=l.state.chunkSize)}function c(s,d){let _=(t.slice||t.webkitSlice||t.mozSlice).call(t,s,d+1),m=new XMLHttpRequest;m.open("POST",o,!0),m.upload.onprogress=function(e){m.readyState!==XMLHttpRequest.DONE&&(e.lengthComputable&&(l.requestsProgress[s]=e.loaded),f())},m.onload=function(c){var _;l.activeRequests.splice((0,a.qh)(l.activeRequests,c.target),1),l.retryCount=0,--l.chunksLeft,201==c.target.status?(l.chunksLeft?(l.state.loaded=c.target.responseText,g.ls.set(l.storageKey,l.state),p()):(l.state.loaded=c.target.responseText,g.ls.set(l.storageKey,l.state),u()),delete l.requestsProgress[s],f()):200==c.target.status?(g.ls.remove(l.storageKey),_=c.target.responseText,(0,r.X)(n,D.getFileInfo(e,i,t)),D.options[e].filesLoadedSize+=l.fileSize,D.options[e].filesLoadedCount+=1,D.onUploadComplete(n,_),D.options[e].filesQueue&&D.options[e].filesQueue.length>0?D.uploadFile(e,D.options[e].filesQueue.pop(),o):(D.startNextQueue(e),D.onUploadCompleteAll(n,_),i.uploading=!1)):(g.ls.remove(l.storageKey),l.abort(),D.onUploadError(n),D.options[e].filesQueue.length||(D.startNextQueue(e),D.onUploadCompleteAll(n,c.target.responseText),i.uploading=!1),h(c.target.status,c.target.responseText,s+"-"+d))},m.onerror=function(e){if(l.activeRequests.splice((0,a.qh)(l.activeRequests,e.target),1),++l.retryCount<=50){let e=setTimeout(c.bind(null,s,d),300*l.retryCount);l.timeouts.push(e)}else l.abort(),D.onConnectionLost(n);f(),h(e.target.status,e.target.responseText,s+"-"+d)},m.setRequestHeader("X-Uploading-Mode","parallel"),m.setRequestHeader("Content-Disposition",'attachment, filename="'+encodeURI(l.fileName)+'"'),m.setRequestHeader("Content-Type",l.fileMime||"application/octet-stream"),m.setRequestHeader("Content-Range","bytes "+s+"-"+d+"/"+l.fileSize),m.setRequestHeader("Session-ID",l.state.sessionId),m.send(_),_=null,l.activeRequests.push(m)}function f(){let o=l.fileSize,s=(l.chunksNum-l.chunksLeft)*l.state.chunkSize;(0,a.__)(l.requestsProgress,(function(e,t){s+=t})),(0,r.X)(n,D.getFileInfo(e,i,t)),i.multi_progress?D.onUploadProgress(n,s,o):D.onUploadProgress(e,Math.min(s+i.filesLoadedSize,i.filesTotalSize),i.filesTotalSize)}function h(e,t,i){window.ajax.post("al_video.php",{act:"uploadVideoFailStat",url:o,error:e+","+t,range:i,sessionId:l.state.sessionId,chunksLeft:l.chunksLeft,loaded:l.state.loaded})}window.ajax.post("al_video.php?act=get_upload_url",{file_size:t.size?t.size:0,user_agent:window.navigator.userAgent,owner_id:d.oid,tag:d.tag,from:d.from,extra_upload_options:i.extraUploadOptions},{onDone:function(a){l.state.url=a.upload_url,o=l.state.url,D.uploadUrls[e]=o,function(e,t){let o=1048576,i=Math.floor(e.size/2)-o/2,n=[e.slice(0,o),e.slice(i,i+o),e.slice(e.size-o,e.size)];!function e(o){let i=n.shift();if(!i)return void t(o);let l=new FileReader;l.addEventListener("loadend",(function(t){let i=new Uint8Array(t.target.result),n=function(){let e=65535,t=65535;return{append:o,result:i};function o(o){let i=o.length,n=0;for(;i;){let l=i>359?359:i;i-=l;do{t+=e+=o[n++]}while(--l);e=((65535&e)>>>0)+(e>>>16),t=((65535&t)>>>0)+(t>>>16)}}function i(){return e=((65535&e)>>>0)+(e>>>16),t=((65535&t)>>>0)+(t>>>16),(t<<16>>>0|e)>>>0}}();n.append(i),o+=n.result().toString(16),e(o)})),l.readAsArrayBuffer(i)}("")}(t,s),i.onUploadedVideoIdReceived&&i.onUploadedVideoIdReceived(n,a.video_id)},onFail:function(){D.terminateUpload(e,t.name)}})},isNeedRequestUrl:function(e){let t=this.options[e];return t.requestOptionsForFile&&"video"===t.type},getUploadOptions:function(e,t){let o=this.options[e],i=cur.gid||0;k.z.isGroupId(cur.oid)&&(0,a.RV)(cur.module,["public","groups","ads","app"])&&(0,a.RV)(o.from,["article","post","ads"])&&(i=-cur.oid),D.options[e].uploadOptionsXhr=window.ajax.post("al_video.php?act=get_upload_params",{gid:i,from:o.from},{onDone:function(o){let i=(0,m.toQueryString)(o.vars),n=o.options.url+(o.options.url.match(/\?/)?"&":"?")+i;(0,r.X)(D.options[e],o.options),(0,r.X)(D.vars[e],o.vars),D.uploadUrls[e]=n,D.check(e),D.uploadFile(e,t,n,!0)},onFail:function(){D.terminateUpload(e,t.name)}})},uploadFile:function(e,t,o,i){let n=this.options[e];if(this.files[e]=t,D.isNeedRequestUrl(e)&&!i)return void D.getUploadOptions(e,t);if(n.chunked&&D.supportsChunkedUpload())return void this.uploadFileChunkedWithSDK(...arguments);let l=f.T.msie&&(0,a.Jk)(f.T.version)<10?window.XDomainRequest:window.XMLHttpRequest,d=D.getFileInfo(e,n,t);n.multi_sequence&&this.onUploadStart(d),n.uploading=!0;let u=null;if(window.FormData){let i=new FormData;t instanceof File?i.append(n.file_name,t):i.append(n.file_name,t,t.filename.replace(/[&<>"']/g,"")),u=new l;let a=!0;u.open("POST",o,!0),u.onload=function(i){(0,r.X)(d,D.getFileInfo(e,n,t)),D.options[e].filesLoadedSize+=t.size,D.options[e].filesLoadedCount+=1,D.onUploadComplete(d,i.target.responseText),D.options[e].filesQueue&&D.options[e].filesQueue.length>0?D.uploadFile(e,D.options[e].filesQueue.pop(),o):(D.startNextQueue(e),D.onUploadCompleteAll(d,i.target.responseText),n.uploading=!1)},u.onerror=function(i){(0,r.X)(d,D.getFileInfo(e,n,t)),D.options[e].filesTotalSize-=t.size,D.options[e].filesTotalCount-=1,D.onUploadError(d,i.target.responseText),D.options[e].filesQueue.length>0?D.uploadFile(e,D.options[e].filesQueue.pop(),o):(D.startNextQueue(e),D.onUploadCompleteAll(d,i.target.responseText),n.uploading=!1)},u.upload.onprogress=function(o){u.readyState!==XMLHttpRequest.DONE&&(a=!1,(0,r.X)(d,D.getFileInfo(e,n,t)),o.lengthComputable&&(n.multi_progress?D.onUploadProgress(d,o.loaded,o.total):D.onUploadProgress(e,Math.min(o.loaded+n.filesLoadedSize,n.filesTotalSize),n.filesTotalSize)))},u.send(i)}else{(0,s.bl)({name:"upload_tmp_stat",value:1,keys:["window_formdata_not_exists"]});try{if(l&&!l.prototype.sendAsBinary&&window.ArrayBuffer&&window.Uint8Array){let e=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;e&&(l.prototype.sendAsBinary=function(t){let o=new window.ArrayBuffer(t.length),i=new Uint8Array(o,0);for(let e=0;e<t.length;e++)i[e]=255&t.charCodeAt(e);let n=new e;n.append(o);let l=n.getBlob();this.send(l)})}let i=new FileReader;i.onload=function(){u=new l,u.onload=function(i){(0,r.X)(d,D.getFileInfo(e,n,t)),D.options[e].filesLoadedSize+=t.size,D.options[e].filesLoadedCount+=1,D.onUploadComplete(d,i.target.responseText),D.options[e].filesQueue.length>0?D.uploadFile(e,D.options[e].filesQueue.pop(),o):(D.startNextQueue(e),D.onUploadCompleteAll(d,i.target.responseText))},u.onerror=function(i){(0,r.X)(d,D.getFileInfo(e,n,t)),D.options[e].filesTotalSize-=t.size,D.options[e].filesTotalCount-=1,D.onUploadError(d,i.target.responseText),D.options[e].filesQueue.length>0?D.uploadFile(e,D.options[e].filesQueue.pop(),o):(D.startNextQueue(e),D.onUploadCompleteAll(d,i.target.responseText),n.uploading=!1)},u.upload.onprogress=function(o){(0,r.X)(d,D.getFileInfo(e,n,t)),o.lengthComputable&&(n.multi_progress?(D.onUploadProgress(d,o.loaded,o.total),n.uploading=!1):D.onUploadProgress(e,Math.min(o.loaded+n.filesLoadedSize,n.filesTotalSize),n.filesTotalSize))},u.open("POST",o,!0);let s="---------"+(0,a.rK)(1111111111,9999999999);u.setRequestHeader("Content-Type","multipart/form-data, boundary="+s);let p="--"+s+"\r\n";p+="Content-Disposition: form-data; name='"+n.file_name+"'; filename='"+t.name.replace(/[&<>"']/g,"")+"'\r\n",p+="Content-Type: application/octet-stream\r\n\r\n",p+=i.result+"\r\n",p+="--"+s+"--",u.sendAsBinary(p)},i.readAsBinaryString(t)}catch(e){try{console.error(e)}catch(e){}}}D.options[e].xhr=u},retryUpload(e){const t=D.sessions[e];t&&t.destroy(),this.uploadFileChunkedWithSDK(e,this.files[e])},terminateUpload:function(e,t,o){try{let n=D.vars[e],l=D.options[e],a=(0,m.toQueryString)(n),r=l.filesQueue,s=!1,d=l.multi_progress?{ind:e,fileName:t?.replace(/[&<>"']/g,"")}:e,u=t?e+"_"+t:e;for(let e in r)if(t==(r[e].fileName||r[e].name||"").replace(/[&<>"']/g,"")){r.splice(e,1),s=!0;break}o&&o.tt&&o.tt.destroy&&o.tt.destroy(),(0,i.re)("upload"+u+"_progress_wrap"),D.onUploadComplete(d,'{"error":"ERR_UPLOAD_TERMINATED: upload request was terminated"}'),!s&&l.uploadCancelFn&&l.uploadCancelFn();let p=this.uploadUrls[e]+(this.uploadUrls[e].match(/\?/)?"&":"?")+a;s||(r.length>0?D.uploadFile(e,r.pop(),p):(D.startNextQueue(e),D.onUploadCompleteAll(d,"")))}catch(e){try{console.error(e)}catch(e){}}},terminateAllUploads:function(){this.checked&&(0,a.__)(this.checked,(e=>{if(e=+e,!D.isSomethingUploading(e))return;let t=D.options[e];if(!t)return;let o="";t.filesQueue&&t.filesQueue.length&&(t.filesQueue=[]),t.xhr&&4!==t.xhr.readyState&&0!==t.xhr.readyState&&(o=t.file_name),t.chunked&&t.chunkedUpload&&t.chunkedUpload.activeRequests.length&&(o=t.chunkedUpload.fileName,this.terminateUpload(e,o)),o&&this.terminateUpload(e,o)}))},startNextQueue:function(e){if(void 0===cur.multiProgressIndex&&setTimeout((function(){delete cur.fileApiUploadStarted}),1e3),e!=cur.multiProgressIndex)return;if(this.options[e].multi_progress&&cur.nextQueues&&cur.nextQueues.length){let e=cur.nextQueues[0],t=D.options[e].filesQueue;for(cur.nextQueues.splice(0,1);0==t.length&&cur.nextQueues.length>0;)e=cur.nextQueues[0],cur.nextQueues.splice(0,1),t=D.options[e].filesQueue;if(t.length>0){let o=D.vars[e],i=(0,m.toQueryString)(o),n=D.uploadUrls[e]+(D.uploadUrls[e].match(/\?/)?"&":"?")+i;D.uploadFile(e,t.pop(),n),cur.multiProgressIndex=e}else delete cur.multiProgressIndex,setTimeout((function(){delete cur.fileApiUploadStarted}),1e3)}else delete cur.multiProgressIndex,setTimeout((function(){delete cur.fileApiUploadStarted}),1e3)},isFileDrag:function(e){if(!e||e.target&&("IMG"==e.target.tagName||"A"==e.target.tagName))return!1;if(!e.dataTransfer.types)return!0;for(let t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1},dragEnter:function(e,t){cur.uploadDragStarted&&1!=cur.uploadDragStarted||(cur.uploadDragStarted=D.isFileDrag(t)?2:1),1!=cur.uploadDragStarted&&D.dropbox[e]?(setTimeout((function(){clearTimeout(D.dragTimer[e]),delete D.dragTimer[e]}),0),D.options[e].onDragEnter&&D.options[e].onDragEnter(t),(0,i.WU)(D.dropbox[e]),(0,n.TL)(t)):(0,n.TL)(t)},dragOut:function(e,t){if(1==cur.uploadDragStarted||!D.dropbox[e])return void(0,n.TL)(t);D.dragTimer[e]&&(clearTimeout(D.dragTimer[e]),delete D.dragTimer[e]);const o=function(){const t=D.options[e],o=D.dropbox[e];t.visibleDropbox||(0,i.jD)(o),t.onDragOut&&t.onDragOut(),(0,i.vy)(o,"dropbox_over")};!t.clientX&&!t.clientY?o():D.dragTimer[e]=setTimeout(o,100),(0,n.TL)(t)},dragOver:function(e,t){if(1==cur.uploadDragStarted||!D.dropbox[e])return void(0,n.TL)(t);let o=D.insideDropbox(e,t);t.dataTransfer&&"copy"!==t.dataTransfer.dropEffect&&(t.dataTransfer.dropEffect=o?"copy":"none"),(0,i.p1)(D.dropbox[e],"dropbox_over",o),(0,n.TL)(t)},drop:function(e){return(0,a.__)(D.dropbox,(function(t,o){o&&(D.insideDropbox(t,e)&&D.onFileApiSend(t,e.dataTransfer.files),D.options[t].visibleDropbox||(0,i.jD)(o),D.options[t].onDrop&&D.options[t].onDrop(),(0,i.vy)(o,"dropbox_over"))})),delete cur.uploadDragStarted,(0,n.TL)(e),!1},insideDropbox:function(e,t){let o=t.target;for(;o.parentNode;){if(o==D.dropbox[e])return!0;o=o.parentNode}return!1},isSomethingUploading:function(e){let t=D.options[e];return!!t&&(!(!t.filesQueue||!t.filesQueue.length)||(!(!t.xhr||4===t.xhr.readyState||0===t.xhr.readyState)||(!(!t.uploadOptionsXhr||4===t.uploadOptionsXhr.readyState||0===t.uploadOptionsXhr.readyState)||!!(t.chunked&&t.chunkedUpload&&t.chunkedUpload.activeRequests.length))))},flashCallbacks:function(){return{onUploadStart:D.onUploadStart,onUploadProgress:D.onUploadProgress,onUploadSuccess:D.onUploadComplete,onUploadComplete:D.onUploadCompleteAll,onUploadError:D.onUploadError,onDebug:D.onDebug,onMouseDown:D.buttonDown,onMouseUp:D.buttonUp,onMouseOver:D.buttonOver,onMouseOut:D.buttonOut,onSelectClick:D.onSelectClick}},sendUploadStat:function(e,t){let o=D.options[e],i=D.vars[e];if(o.signed||!o.error_hash)return;let n=(0,r.X)({act:"stat",mid:i.mid,oid:i.oid,gid:i.gid,aid:i.aid,server:o.server,error:o.error,hash:o.error_hash},t);window.ajax.post("upload_fails.php",n)}}},705880:(e,t,o)=>{o.d(t,{tG:()=>d,Fo:()=>s,im:()=>p,DU:()=>u,HY:()=>r,oP:()=>c});var i=o(799835),n=o(389597),l=o(793694),a=function(e){return e.DECODE_VIDEO_METAINFO="decode_video_metainfo",e}({});function r(e){return new Promise((t=>{try{const o=document.createElement("video");o.preload="metadata",o.onloadedmetadata=()=>{const e=o.duration||0,i=o.videoWidth,n=o.videoHeight;t({duration:e,width:i,height:n})},o.onerror=()=>t(null),o.src=window.URL.createObjectURL(e)}catch(e){t(null)}}))}function s(e,t){const o=(e.name.split(".").pop()||"").toLowerCase(),i=(t||n.lQ).includes(o);return!!(e.type&&e.type.match(/^video/i)||i)}var d=function(e){return e[e.SHORT_VIDEO_TOO_SHORT=100]="SHORT_VIDEO_TOO_SHORT",e[e.SHORT_VIDEO_TOO_LONG=101]="SHORT_VIDEO_TOO_LONG",e[e.INCORRECT_PUBLISH_DATE=-1]="INCORRECT_PUBLISH_DATE",e[e.LIMIT_POSTPONE_POSTS=-2]="LIMIT_POSTPONE_POSTS",e[e.LIMIT_POSTPONE_POSTS_PER_DAY=-3]="LIMIT_POSTPONE_POSTS_PER_DAY",e[e.SAME_POSTPONE_POST_DATE=-4]="SAME_POSTPONE_POST_DATE",e[e.LIMIT_POSTS_PER_DAY=-5]="LIMIT_POSTS_PER_DAY",e[e.SHORT_VIDEO_CONVERT=20]="SHORT_VIDEO_CONVERT",e[e.CLAIMED_NOT_UPLOADED=15]="CLAIMED_NOT_UPLOADED",e}({});function u(e,t){switch(e){case 100:return(0,i.Xo)("video_upload_encode_error_too_short_1s");case 101:return(0,i.Xo)("video_upload_encode_error_too_long");case 20:return(0,i.Xo)("video_upload_error_uploading");case-1:return(0,i.Xo)("video_upload_error_incorrect_publish_date");case-2:return(0,i.Xo)("video_upload_error_limit_postpone_posts");case-3:return(0,i.Xo)("video_upload_error_day_limit_postpone_posts");case-4:return(0,i.Xo)("video_upload_error_same_publish_date");case-5:return(0,i.Xo)("video_upload_error_day_limit_posts");default:return t||(0,i.Xo)("global_unknown_error")}}function p(e){switch(e){case-2:return(0,i.Xo)("video_upload_error_info_limit_postpone_posts");case-3:return(0,i.Xo)("video_upload_error_info_day_limit_postpone_posts");case-4:return(0,i.Xo)("video_upload_error_info_same_publish_date")}}const c=async(e,t,o)=>{const i=await r(e);i?.duration&&i?.width&&l.hF.logEvent({event_type:a.DECODE_VIDEO_METAINFO,video_owner_id:t,video_id:o,decode_metainfo:JSON.stringify({width:i.width,height:i.height,video_duration:i.duration,format:(e.name.split(".").pop()||"").toLowerCase()})})}},786241:(e,t,o)=>{function i(e){return new Promise((t=>{try{const o=document.createElement("video");o.preload="metadata",o.onloadedmetadata=()=>{const e=o.duration||0,i=o.videoWidth,n=o.videoHeight;t({duration:e,width:i,height:n})},o.onerror=()=>t(null),o.src=window.URL.createObjectURL(e)}catch(e){t(null)}}))}o.d(t,{H:()=>i})}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/28330.d0af1e3f.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/28330.d0af1e3f.js",e),e}