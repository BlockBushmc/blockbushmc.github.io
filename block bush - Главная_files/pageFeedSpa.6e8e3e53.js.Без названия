try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[30372],{908149:(e,t,i)=>{i.d(t,{T:()=>pe});var s=i(221020),r=i(42107),o=i(946918),n=i(356035),a=i(46644),c=i(516427),d=i(311029),l=i(180329),h=i(590715),u=i(237582),g=i(9467),p=i(432410),f=i(634164),m=i(423654),v=i(876126),_=i(772812);const y="vkitAdsBannerHeader__bannerHeader--ZW16h",b="vkitAdsBannerHeader__bannerHeaderTitle--oRLky",S=({href:e,avatarSrc:t,title:i,subtitle:r,className:o,onTitleClick:n})=>(0,s.Y)("div",{className:(0,f.$)(y,o),children:(0,s.FD)(l.s,{align:"center",children:[(0,s.Y)(v.g,{size:40,src:t,fallbackIcon:(0,s.Y)(p.J,{}),href:e,target:"_blank","aria-hidden":!0,alt:""}),(0,s.FD)("div",{className:b,children:[(0,s.Y)(m.N,{href:e,target:"_blank",onClick:n,children:i}),(0,s.Y)("div",{className:(0,_.I)("color_text_secondary"),children:r})]})]})});var k=i(389829);const C="vkitAdsImagesGalleryClosedComments__root--HvE2c",w=({description:e})=>(0,s.FD)(l.s,{justify:"center",align:"center",direction:"column",gap:"2xl",className:C,children:[(0,s.Y)(k.A,{className:(0,_.I)("color_icon_tertiary")}),(0,s.Y)("div",{className:(0,_.I)("color_text_secondary"),children:e})]});var F=i(976813),Y=i(174928),L=i(162889);const D="ImagesGallery__sidebar--Bra2o",I="ImagesGallery__gallery--mWqjj",M="ImagesGallery__galleryImage--LE7KT",P=({attachmentItems:e,attachmentIndex:t,modalHeight:i,modalWidth:r,title:n,subtitle:a,avatarSrc:c,href:d,statistics:p})=>{const{getLang:f}=(0,o.B)(),m=e.filter((e=>e.image)),v=m.findIndex((({id:i})=>i===e[t].id));return(0,s.FD)(l.s,{noWrap:!0,children:[(0,s.Y)(h.Z,{slideIndex:v,showArrows:!0,looped:!0,bullets:"dark",dragDisabled:!1,className:I,children:m.map((({id:e,image:t})=>{const o=Number(t?.height),n=Number(t?.width),a=o<i?o:i,c=n<r?n:r;return(0,s.Y)(u.v,{src:t?.url,heightSize:a,widthSize:c,"aria-hidden":!0,className:M,objectFit:"contain",keepAspectRatio:!0,noBorder:!0},e)}))}),(0,s.FD)(l.s,{direction:"column",className:D,style:{width:L.N,height:i},children:[(0,s.Y)(S,{title:n,subtitle:a,avatarSrc:c,href:d,onTitleClick:()=>{if(!(0,g.z2)("ads_viewer_enabled"))return;const e=p?.find((e=>e.type===F.d.click));e&&(0,Y.xr)({pixel:{type:F.d.click,url:e.url}})}}),(0,s.Y)(w,{description:f("photos_comments_restricted")})]})]})};var O=i(460096),A=i(815287),x=i(962644),T=i(378169),E=i(999051);const j="vkitAdsVideoPreview__videoPreview--Ds45P",q="vkitAdsVideoPreview__icon--9JUXw",R=({backgroundImage:e,loading:t})=>(0,s.Y)("div",{"aria-busy":!0,"aria-live":"polite",className:j,style:{backgroundImage:e},children:t?(0,s.Y)(E.y,{size:"l"}):(0,s.Y)(T.d,{className:q})});var N=i(593355);function z({durationCurrent:e,durationResult:t,setDuration:i}){return(0,s.Y)(N.A,{backMode:"contrast",fillMode:"contrast",hideHandle:!0,max:t,min:0,size:"xl",value:e,onChange:i})}var B=i(648179),K=i(191601),W=i(799649);const H=(0,A.memo)((function({playing:e,label:t,onSetPlaying:i}){return(0,s.Y)(W.K,{activeMode:"opacity",hoverMode:"opacity",className:(0,_.I)("color_icon_contrast"),onClick:()=>i(!e),label:t,children:e?(0,s.Y)(B.o,{}):(0,s.Y)(K.K,{})})}));var J=i(284146),Q=i(638945);const V="vkitAdsDuration__durationCurrent--wYRl2",G="vkitAdsDuration__durationSeparator--QSOgr",$="vkitAdsDuration__duration--U4eci";function U({durationCurrent:e,durationResult:t}){return(0,s.FD)(l.s,{gap:"xs",children:[(0,s.Y)(Q.HL,{weight:"2",className:V,children:(0,J.a)(Math.round(e))}),(0,s.Y)(Q.HL,{weight:"2",className:G,children:"/"}),(0,s.Y)(Q.HL,{weight:"2",className:$,children:(0,J.a)(Math.round(t))})]})}var X=i(470704),Z=i(617981);const ee="vkitAdsVolumeControls__volumeBar--sevQ9",te=(0,A.memo)((function({muted:e,volume:t,label:i,onSetMuted:r,onSetVolume:o}){return(0,s.FD)(l.s,{align:"center",noWrap:!0,children:[(0,s.Y)(W.K,{activeMode:"opacity",hoverMode:"opacity",className:(0,_.I)("color_icon_contrast"),label:i,onClick:()=>r(!e),children:e?(0,s.Y)(X.f,{}):(0,s.Y)(Z.k,{})}),(0,s.Y)("div",{className:ee,children:(0,s.Y)(N.A,{backMode:"contrast",fillMode:"contrast",hideHandle:!0,min:0,max:1,value:t,onChange:o})})]})})),ie="VideoWrapper__container--9a642",se="VideoWrapper__videoContainer--kFGTL",re="VideoWrapper__header--4AN6n",oe="VideoWrapper__bottomControls--tOz90",ne=({videoSrc:e,videoDuration:t=0,videoPreviewUrl:i,title:r,subtitle:n,avatarSrc:a,href:c,statistics:d})=>{const{getLang:h}=(0,o.B)(),[u,p]=(0,A.useState)(!1),[f,m]=(0,A.useState)(!1),[v,_]=(0,A.useState)(!1),[y,b]=(0,A.useState)(1),[k,C]=(0,A.useState)(0),[w,L]=(0,A.useState)(t),D=(0,A.useMemo)((()=>({id:0,owner_id:0,duration:t,files:{src:e}})),[t,e]),I=(0,A.useCallback)((e=>C(e.toString())),[]),M=(0,A.useCallback)((()=>m(!0)),[]),P=(0,A.useCallback)((e=>{e&&(p(!1),C(0))}),[]),T=(0,A.useCallback)((e=>L(e)),[]),E=(0,A.useCallback)((()=>{if(!(0,g.z2)("ads_viewer_enabled"))return;const e=d?.find((e=>e.type===F.d.click));e&&(0,Y.xr)({pixel:{type:F.d.click,url:e.url}})}),[]),j="number"==typeof k?k:void 0,q=Number(k);return(0,s.FD)("div",{className:ie,children:[(0,s.FD)("div",{className:se,children:[!f&&(0,s.Y)(R,{backgroundImage:`url(${i})`,loading:u&&!f}),(0,s.Y)(O.r,{loop:!1,muted:v,playing:u,video:D,volume:y,newCurrentTime:j,onCurrentTimeChanged:I,onStarted:M,onVideoEndedChanged:P,onDurationChanged:T,mode:"contain",platform:"web"}),(0,s.Y)(x.h,{onClick:()=>p(!u)}),f&&(0,s.FD)(x.h,{className:oe,children:[(0,s.Y)(z,{durationCurrent:q,durationResult:w,setDuration:C}),(0,s.FD)(l.s,{justify:"space-between",children:[(0,s.FD)(l.s,{align:"center",children:[(0,s.Y)(H,{playing:u,label:h(u?"pause":"play"),onSetPlaying:p}),(0,s.Y)(U,{durationCurrent:q,durationResult:w})]}),(0,s.Y)(te,{muted:v,volume:y,label:h(v?"volume_on":"volume_off"),onSetMuted:_,onSetVolume:b})]})]})]}),(0,s.Y)(S,{title:r,subtitle:n,avatarSrc:a,href:c,className:re,onTitleClick:E})]})};const ae=({banner:e,options:t,modalHeight:i,modalWidth:r})=>{const{getLang:n}=(0,o.B)(),{attachmentIndex:a}=t,{title:c,items:d,adLabel:l,ageRestrictions:h,description:u,trackingLink:g,urlToNavigateOnClick:p,ctaLink:f,icon:m,statistics:v}=e,_=h?` · ${h}`:"",y=l?.show&&l.text?l.text+_:u,b=g||p||f||"",S=m?.url||"";if(!d)return n("global_error_generic_reason");const{video:k,image:C}=d[a];if(k){const e=function(e,t){if(Array.isArray(e)){const i=[...e].sort(((e,t)=>(e.width||0)-(t.width||0)));return i.find((e=>(e?.width||0)>t))?.src||i[0]?.src}return e?.src}(k.mediafiles,r);return(0,s.Y)(ne,{videoSrc:e,videoDuration:k?.duration,videoPreviewUrl:k?.preview?.url,title:c||"",subtitle:y||"",avatarSrc:S,href:b,statistics:v})}return C?(0,s.Y)(P,{attachmentItems:d,attachmentIndex:a,modalHeight:i,modalWidth:r,title:c||"",subtitle:y||"",avatarSrc:S,href:b,statistics:v}):n("global_error_generic_reason")};var ce=i(331635),de=i(327813);class le{constructor(e){this.props=e,this.handleClose=()=>{this.props.current.onClose()},this.banner=this.props.current.banner,this.options=this.props.current.options,this.modalHeight=this.props.current.modalHeight,this.modalWidth=this.props.current.modalWidth,(0,de.l_)(this)}}le=(0,ce.Cg)([r.z8.transient(),(0,ce.Sn)("design:type",Function),(0,ce.Sn)("design:paramtypes",[void 0===r.Ji?Object:r.Ji])],le);const{Provider:he,useModel:ue}=(0,r.Qd)(le,{initInEffect:!1}),ge=(0,n.P)((function(){const{getLang:e}=(0,o.B)(),{handleClose:t,banner:i,options:r,modalHeight:n,modalWidth:l}=ue();return(0,s.FD)(a.n,{"aria-label":e("adsoffice_modalbox_aria_label"),width:l,height:n,maxWidth:l,maxHeight:n,children:[(0,s.Y)(c.wyA,{onClick:t}),(0,s.Y)(d.c,{insetLevel:0,children:(0,s.Y)(ae,{banner:i,options:r,modalWidth:l,modalHeight:n})})]})})),pe=(0,r.jn)(he,ge)},162889:(e,t,i)=>{i.d(t,{N:()=>s});const s=310},384788:(e,t,i)=>{i.d(t,{M:()=>n});var s=i(221020),r=i(815287),o=i(187233);const n=(0,r.forwardRef)((function(e,t){return(0,s.Y)(o.i,{...e,getRootRef:t,mode:"vertical",spacing:0,paddingBottom:8,paddingTop:8})}))},440346:(e,t,i)=>{i.d(t,{v:()=>s});const s=e=>{if(!e)return"";return new URLSearchParams(`q=${e}`).get("q")??""}},259351:(e,t,i)=>{i.r(t),i.d(t,{Page:()=>Wi});var s=i(221020),r=i(300647),o=i(742343),n=i(516427),a=i(786558),c=i(431463),d=i(516800),l=i(975580),h=i(206474),u=i(988549),g=i(245541);const p="photos",f="recommended",m="search",v="likes",_="comments",y="friends";var b=i(440346),S=i(331635),k=i(327813),C=i(815287),w=i(916533),F=i(273193),Y=i(9443),L=i(42107),D=i(885053),I=i(82560),M=i(830996),P=i(569597),O=i(928959);const A={STORIES_CREATOR:(0,C.lazy)((async()=>({default:(await Promise.all([i.e(19785),i.e(25795),i.e(61194),i.e(25701),i.e(68930),i.e(68835),i.e(32672),i.e(72093),i.e("langs/core_spa/StoriesCreatorModalWeb")]).then(i.bind(i,184716))).StoriesCreatorWidget})))};class x{[L.zr](){this.storiesBlockManager.removeCustomEvents(),this.storiesBlockManager.reset()}async[L.Ts](){this.motionService.load(),this.storiesBlockManager.init()}get viewerId(){return this.authService.userId??0}constructor(e,t,i,s,r,o){this.authService=e,this.langs=t,this.newsfeedApi=i,this.motionService=s,this.collageModalService=r,this.storiesBlockManager=o,this.isSourcesModalOpened=!1,this.modalController=new P.o(A),this.getCollageModalService=()=>this.motionService.collageModalService,this.handleCloseSourcesModal=()=>{this.isSourcesModalOpened=!1},this.handleOpenSourcesModal=e=>{(0,O.T)(e.nativeEvent),this.isSourcesModalOpened=!0},this.handleStoryboxQueryParams=e=>{try{const t=JSON.parse(atob(e));if(t){const e={...t,...t.mini_app_id&&{miniAppId:t.mini_app_id},photoUrl:t.url?t.url:t.blob,stickers:t.stickers,attachment:t.attachment,serviceInfo:t.service_info};this.modalController.open({type:"STORIES_CREATOR",props:{config:{storyBox:e,close:()=>this.modalController.close()}}})}}catch(e){console.error("failed storybox init")}},(0,k.l_)(this)}}x=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===w.u?Object:w.u,void 0===F.Y?Object:F.Y,void 0===Y.a?Object:Y.a,void 0===I.O?Object:I.O,void 0===D.c?Object:D.c,void 0===M.W?Object:M.W])],x);const{Provider:T,useModel:E}=(0,L.Qd)(x,{initInEffect:!1}),j=e=>{const{children:t}=e,i=(0,c.I)(),{langs:r}=E(),o=(({feedSection:e,q:t,langs:i})=>{switch(e){case p:return i.getLang("news_title_photos");case f:return i.getLang("news_tab_recommended_for_you");case m:return t?i.langReplace(i.getLang("news_title_search"),{tag0:"","/tag0":"",q:(0,b.v)(t)}):i.getLang("news_search");case v:return i.getLang("news_title_reactions");case _:return i.getLang("news_title_comments");case y:return i.getLang("updates_tab_friends");default:return i.getLang("news_title_posts")}})({feedSection:i.section,q:i.q||i["c[q]"],langs:r});return(0,s.Y)(g.Q,{title:o,children:t})};var q=i(356035),R=i(982444),N=i(370633),z=i(328738),B=i(794345),K=i(225093),W=i(661449),H=i(202436),J=i(849645),Q=i(739838),V=i(97929),G=i(645189),$=i(975472),U=i(144819),X=i(968706),Z=i(830443),ee=i(344550),te=i(937314);class ie{createFeedServiceDecorator(){return new X.H(this.props.current.feedHistoryCacheKey,this.props.current.previousFeedHistoryCacheKey,this.mainFeedService.instance,this.feedDataService)}fetchInitialFeedWithTypeFromSettings(){this.feedAccountSettings.feedType&&(this.mainFeedService.setNewsFeedType(this.feedAccountSettings.feedType),this._feedServiceDecorator=this.createFeedServiceDecorator(),this._feedServiceDecorator.fetch({count:5,forced_blocks:this.props.current.forcedBlocks},{prefetch:!0}))}resetFeedWithNewFeedType(){this.feedAccountSettings.feedType&&(this.mainFeedService.setNewsFeedType(this.feedAccountSettings.feedType),this._feedServiceDecorator=this.createFeedServiceDecorator(),this._feedServiceDecorator.reset(),this._feedServiceDecorator.fetch({count:5},{prefetch:!0}))}get feedServiceDecorator(){return this._feedServiceDecorator}async[L.Ts](){void 0===this.feedAccountSettings.feedType||void 0===this.mainFeedService.newsfeedType||this.feedAccountSettings.feedType===this.mainFeedService.newsfeedType?"initial"===this.status?(await this.feedAccountSettings.fetch(),void 0!==this.feedAccountSettings.feedType&&void 0!==this.mainFeedService.newsfeedType&&this.feedAccountSettings.feedType!==this.mainFeedService.newsfeedType?this.resetFeedWithNewFeedType():this.fetchInitialFeedWithTypeFromSettings()):this._feedServiceDecorator=this.createFeedServiceDecorator():this.resetFeedWithNewFeedType()}[L.yo](e){if(this.userEnv.partConfigEnabled("frontend.feed_scroll_restoration_from_non_feed_page")){const t=this._feedServiceDecorator?.cacheKey;t!==e.feedHistoryCacheKey&&this._feedServiceDecorator?.setCacheKey(e.feedHistoryCacheKey)}}[L.zr](){this._feedServiceDecorator?.destroy(),this.reactions.destroy(),this.feedAccountSettings.dispose()}get items(){return this._feedServiceDecorator?.items??[]}get status(){return this._feedServiceDecorator?.requestState.status??"initial"}get error(){return this._feedServiceDecorator?.requestState.error}get module(){return this.metaData.get().module}get isAuthorized(){return this.authService.isAuthorized}get userIdString(){return String(this.authService.userId)}get newsfeedType(){return this.mainFeedService.newsfeedType}get isFullyLoaded(){return this._feedServiceDecorator?.requestState.allAvailableItemsLoaded??!1}get isResultEmpty(){return this._feedServiceDecorator?.isResultEmpty??!1}get postConfig(){return{hasNotificationsInMenu:!0,hasNoCoownershipDeclineInMenu:!0,isMetaPostMenuEnabled:!0,ignoreSlavePost:!0,footer:{showReactedFriends:this.newsfeedType===B._6}}}constructor(e,t,i,s,r,o,n,a,c,d,l,h){this.props=e,this.mainFeedService=t,this.addPostService=i,this.errorLogger=s,this.metaData=r,this.authService=o,this.feedDataService=n,this.feedApi=a,this.feedAccountSettings=c,this.snackbar=d,this.langs=l,this.userEnv=h,this.reactions=new Z.O,this._feedServiceDecorator=void 0,this.onCreateDraft=(e,t)=>(0,te.G)({snackbar:this.snackbar,langs:this.langs,ownerId:t}),this.onCreatePost=async(e,t)=>{const i=(0,U.WO)({ownerId:t,id:e});await this.addPostService.addPost(i),this._feedServiceDecorator?.prependItemInList(i)},this.onEmptyResultButtonClick=async()=>{this.mainFeedService.newsfeedType===B.ey&&await this.feedApi.setFeedType({type:"top"}),this.props.current.reload()},this.errorLogger.setConfig({scope:"MainFeed",type:"container"}),(0,k.l_)(this)}}ie=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===K.B?Object:K.B,void 0===W.r?Object:W.r,void 0===ee.X?Object:ee.X,void 0===J.e?Object:J.e,void 0===w.u?Object:w.u,void 0===$.k?Object:$.k,void 0===Q.x?Object:Q.x,void 0===H.D?Object:H.D,void 0===V.q?Object:V.q,void 0===F.Y?Object:F.Y,void 0===G.J?Object:G.J])],ie);const{Provider:se,useModel:re}=(0,L.Qd)(ie,{initInEffect:!1});var oe=i(473529),ne=i(332855),ae=i(378119),ce=i(217500),de=i(808911),le=i(484868),he=i(472978),ue=i(259137),ge=i(959832);const pe=(0,ce.f)({loader:async()=>{const{StoriesBlockFeed:e}=await(0,de.p)((()=>Promise.all([i.e(4832),i.e(98587),i.e(80949),i.e("langs/core_spa/StoriesBlock")]).then(i.bind(i,537315))));return e},DefaultLoading:()=>(0,s.Y)(le.w,{}),name:"StoriesBlock",onLazyModuleLoadStarted:()=>{const e=(0,he.Aj)();(0,he.FK)(e);const t=(0,ue.Y)().isAjaxNav?0:1;(0,ge.KN)({nonce:e,isFullPageLoad:Boolean(t)})},onLazyModuleLoaded:()=>{const e=(0,he.aM)();if(e){const t=(0,ue.Y)().isAjaxNav?0:1;(0,ge.wW)({nonce:e,isFullPageLoad:Boolean(t)})}},options:{hasError:!1,logError:e=>{const t=(0,he.aM)();t&&(0,ge.Fk)({error:e,nonce:t})}}});var fe=i(867937),me=i(700777),ve=i(538163),_e=i(405697),ye=i(409698),be=i(319758),Se=i(946918);const ke=({onButtonClick:e,title:t,buttonText:i,mode:r})=>{const o=(0,Se.B)(),{reload:n}=(0,d.Z)();return(0,s.FD)(N.Y,{mode:r,children:[(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(_e.O,{stretched:!0,icon:(0,s.Y)(be._,{}),action:(0,s.Y)(ye.$,{onClick:e??n,align:"center",size:"m",appearance:"neutral",mode:"secondary",children:i??o.getLang("wall_empty_result_stub_button_text")}),children:t??o.getLang("wall_empty_result_stub_text")}),(0,s.Y)(R.K,{size:"4xl"})]})};var Ce=i(384788),we=i(540917),Fe=i(217708),Ye=i(447598),Le=i(22392),De=i(615544);const Ie=(0,q.P)((function({status:e,error:t,items:i,emptyState:r,skeleton:o,externalEmptyState:a,noBorders:d=!1,isFullyLoaded:l,postConfig:h,isResultEmpty:u,feedServiceDecorator:g,newsfeedType:p,NewsfeedItem:f,restoreScrollWithRaf:m,onScrollRestorationWithLayer:v}){const _=(0,Se.B)(),y=(0,Fe.I)(),b=(0,C.useRef)(null),{forced_blocks:S}=(0,c.I)(),k=(0,De.y)(),{key:w}=(0,Le.z)(),F=(a??(0===i.length&&"success"===e))&&r,Y=t&&(({error:e,message:t})=>9===e?.error_code?"Too many requests":e?.error_msg??t)(t);return F?r:"initial"===e||0===i.length&&"loading"===e||!g?(0,s.Y)(Ye.I.Loader,{children:o}):"error"!==e||y.partConfigEnabled("frontend.feed_error_in_end_enabled")?u&&!F?(0,s.Y)(ke,{}):(0,s.Y)(Ye.I.Content,{children:(0,s.FD)(N.Y,{Component:Ce.M,padding:"none",mode:d?"plain":"card",noTopRounded:d,noBottomRounded:d,getRootRef:b,children:[(0,s.Y)(we.F,{feedServiceDecorator:g,newsfeedType:p,offsetTop:b.current?.offsetTop,forcedBlocks:S,isLayerOpened:k,historyKey:w,restoreScrollWithRaf:m,onScrollRestorationWithLayer:v,children:({index:e,item:t,uniqueItemId:i,getItemUiState:r,observers:o,scheduleAdsInvalidation:n})=>(0,s.Y)(f,{item:t,index:e,uniqueItemId:i,observers:o,getItemUiState:r,scheduleAdsInvalidation:n,config:h})}),"loading"===e&&(0,s.Y)(me.q,{children:_.getLang("wall_posts_loading")}),"loading"!==e&&l&&(0,s.Y)(n.wi6,{children:_.getLang("news_shown_last_news")}),"error"===e&&y.partConfigEnabled("frontend.feed_error_in_end_enabled")&&(0,s.Y)(ve.J,{message:Y,mode:"plain"})]})}):(0,s.Y)(ve.J,{message:Y,mode:d?"plain":"card"})}));function Me(e){return(0,s.Y)(Ie,{...e,NewsfeedItem:fe.L})}var Pe=i(540587),Oe=i(233788);const Ae=(0,q.P)((function(){const{status:e,error:t,items:i,module:r,postConfig:o,userIdString:n,onCreatePost:a,onCreateDraft:c,newsfeedType:d,isFullyLoaded:l,isResultEmpty:h,feedServiceDecorator:u,onEmptyResultButtonClick:g}=re();return(0,s.FD)("div",{"data-testid":"feed_main_container",children:[(0,s.Y)(pe,{}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(oe.V,{ownerId:n,creationEntryPoint:"feed",screen:r,postingTimelineCreationEntryPoint:ne.I8.FEED_INPUT,renderPostingFormBlock:!0,loading:(0,s.Y)(ae.l,{}),afterCreateSuccess:a,afterDraftCreateSuccess:c,withoutExternalMargins:!0}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(Me,{emptyState:(0,s.Y)(ke,{onButtonClick:g}),status:e,error:t,items:i,isFullyLoaded:l,isResultEmpty:h,postConfig:o,feedServiceDecorator:u,newsfeedType:d,skeleton:(0,s.FD)(N.Y,{padding:"none",children:[(0,s.Y)(z.K,{}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(z.K,{})]})})]})})),xe=(0,Oe.L)((0,Pe.V)(se,Ae),ve.J,"PageFeed");var Te=i(851452),Ee=i(597593),je=i(392775),qe=i(189620),Re=i(972629),Ne=i(331503);var ze=i(651253),Be=i(877351),Ke=i(340310),We=i(951609),He=i(486526);const Je="photo_100,photo_base,sex,video_files,friend_status,first_name_gen,last_name_gen,first_name_acc,screen_name,verified,trending,emoji_status,image_status,has_unseen_stories,is_government_organization,trust_mark,has_live_cover,has_stories,is_nft,is_nft_photo,is_esia_verified,is_tinkoff_verified,is_sber_verified,oauth_verification,is_verified,social_button_type,is_work_group,work_group_info,url,is_member,friend_status,can_write_private_message,can_message,wall";var Qe=i(376572),Ve=i(848549);class Ge{get totalCount(){return this._totalCount}get count(){return this.ids.length}get items(){const e=[];for(const t of this.ids){const i=this.usersMap.get(t);i&&e.push(i)}return e}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(e,t){let i,s=[];return e.q?(i=await this.friendsApi.search({...e,q:String(e.q)},{signal:t.signal}),s=i.items?.map((e=>(this.usersMap.has(e.id)||this.usersMap.set(e.id,e),e)))||[]):(i=await this.friendsApi.get(e,{signal:t.signal}),s=i.items?.filter((e=>{if(t=e,void 0!==t?.id){const t=this.usersMap.has(e.id);return t||this.usersMap.set(e.id,e),!t}var t;return!1}))||[]),{items:s,count:i.count}}async fetch(e){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const t=await this.request(e,this.abortController);this.handleResponse(t,e)}async fetchNext(){if(!this.prevRequestParams||this.isLoading||this.isLoaded)return;this.isLoading=!0,this.abortController=new AbortController;const{count:e=0,offset:t=0}=this.prevRequestParams??{},i=t+e,s={...this.prevRequestParams,offset:i},r=await this.request(s,this.abortController);this.handleResponse(r,s)}handleResponse(e,t){const{count:i=0,offset:s=0}=t,r=e.items.map((e=>e.id));this._totalCount=e.count,this.isLoaded=e.count<=s+i,this.ids=s?[...this.ids,...r]:r,this.prevRequestParams=t,this.isLoading=!1,this.abortController=null}processSources(e){e.forEach((e=>{this.usersMap.has(e.id)||(this.usersMap.set(e.id,e),this.ids.push(e.id))}))}constructor(e){this.friendsApi=e,this.usersMap=new Map,this.ids=[],this.abortController=null,this.prevRequestParams=null,this._totalCount=0,this.initialLoad=!1,this.isLoading=!1,this.isLoaded=!1,(0,k.l_)(this)}}class $e{get totalCount(){return this._totalCount}get count(){return this.ids.length}get items(){const e=[];for(const t of this.ids){const i=this.groupsMap.get(t);i&&e.push(i)}return e}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(e,t){let i,s;return e.q?(i=await this.catalogApi.getSearchGroups({...e,q:String(e.q)},{signal:t.signal}),s=i.groups?.filter((e=>(this.groupsMap.has(e?.id)||this.groupsMap.set(e?.id,e),1===e?.member_status)))||[]):(i=await this.groupsApi.get(e,{signal:t.signal}),s=i.items?.filter((e=>{if(t=e,void 0!==t?.id){const t=this.groupsMap.has(e.id);return this.groupsMap.has(e.id)||this.groupsMap.set(e.id,e),!t}var t;return!1}))||[]),{items:s,count:"count"in i?i.count:0}}async fetch(e){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const t=await this.request(e,this.abortController);this.handleResponse(t,e)}async fetchNext(){if(!this.prevRequestParams||this.isLoading||this.isLoaded)return;this.isLoading=!0,this.abortController=new AbortController;const{count:e=0,offset:t=0}=this.prevRequestParams??{},i=t+e,s={...this.prevRequestParams,offset:i},r=await this.request(s,this.abortController);this.handleResponse(r,s)}handleResponse(e,t){const{count:i=0,offset:s=0}=t,r=e.items.map((e=>e.id));this._totalCount=e.count??0,this.isLoaded=(e.count??0)<=s+i,this.ids=s?[...this.ids,...r]:r,this.prevRequestParams=t,this.isLoading=!1,this.abortController=null}processSources(e){e.forEach((e=>{this.groupsMap.has(e.id)||(this.groupsMap.set(e.id,e),this.ids.push(e.id))}))}constructor(e,t){this.groupsApi=e,this.catalogApi=t,this.groupsMap=new Map,this.ids=[],this.abortController=null,this.prevRequestParams=null,this._totalCount=0,this.initialLoad=!1,this.isLoading=!1,this.isLoaded=!1,(0,k.l_)(this)}}class Ue{async[L.Ts](){try{const[e,t,i]=await Promise.allSettled([this.feedApi.getBanned({extended:1,fields:Je}),this.membersList.fetch({count:50,extended:1,fields:Je}),this.groupsList.fetch({count:50,extended:1})]);(0,k.h5)((()=>{if("fulfilled"===e.status&&"fulfilled"===t.status&&"fulfilled"===i.status){const t=e.value;this.bannedIdsResponse=t;const{groups:i,profiles:s}=t;s&&this.membersList.processSources(s),i&&this.groupsList.processSources(i),s?.forEach((e=>{this.bannedMembers[e.id]=!0})),i?.forEach((e=>{this.bannedGroups[e.id]=!0})),this.isBaseDataLoaded=!0}}))}catch(e){(0,k.h5)((()=>{this.status="error",this.isBaseDataLoaded=!0,this.errorLogger.log(e)}))}}resetQuery(){this.searchQuery="","members"===this.currentTab?this.membersSearchList.reset():"groups"===this.currentTab&&this.groupsSearchList.reset()}get currentFilterText(){switch(this.currentFilter){case"visible":return this.langs.getLang("wall_sources_sort_visible");case"hidden":return this.langs.getLang("wall_sources_sort_hidden");default:return this.langs.getLang("wall_sources_sort_all")}}get groupsArray(){const e=this.currentFilter,t=this.searchQuery?this.groupsSearchList.items:this.groupsList.items;switch(e){case"visible":return t.filter((e=>!this.bannedGroups[e.id]));case"hidden":return t.filter((e=>this.bannedGroups[e.id]));default:return t}}get membersArray(){const e=this.currentFilter,t=this.searchQuery?this.membersSearchList.items:this.membersList.items;switch(e){case"visible":return t.filter((e=>!this.bannedMembers[e.id]&&this.authService.userId!==e.id));case"hidden":return t.filter((e=>this.bannedMembers[e.id]&&this.authService.userId!==e.id));default:return t}}get isLoading(){return"loading"===this.status}prepareBanOwnersRequestParams(e,t){const i=[];if(e.length>0){const s=Math.ceil(e.length/100);for(let r=0;r<s;r++){const s=e.slice(100*r,100*r+100);"member"===t?i.push({user_ids:s.join(",")}):"group"===t&&i.push({group_ids:s.join(",")})}}return i}async batchBanMembers(e,t,i){const s=this.prepareBanOwnersRequestParams(e,"member"),r=this.prepareBanOwnersRequestParams(t,"group");if(r.length===s.length){const e=[];for(let t=0;t<s.length;t++)e.push(i({...s[t],...r[t]}));return Promise.all(e)}if(0!==s.length||0!==r.length){const e=s.map((e=>i(e))),t=r.map((e=>i(e)));return Promise.all(e.concat(t))}}constructor(e,t,i,s,r,o,n,a,c){this.props=e,this.errorLogger=t,this.authService=i,this.feedApi=s,this.friendsApi=r,this.groupsApi=o,this.catalogApi=n,this.newsfeedApi=a,this.langs=c,this.status="default",this.isBaseDataLoaded=!1,this.isResultSaving=!1,this.currentTab="members",this.searchQuery="",this.currentFilter="",this.membersIds=[],this.groupsIds=[],this.bannedIdsResponse={},this.bannedGroups={},this.bannedMembers={},this.onChangeMember=(e,t)=>{this.bannedMembers[e]=t},this.onChangeGroup=(e,t)=>{this.bannedGroups[e]=t},this.onLoadMore=async()=>{if(!this.searchQuery){this.status="loading";try{"members"===this.currentTab?await this.membersList.fetchNext():"groups"===this.currentTab&&await this.groupsList.fetchNext(),this.status="default"}catch(e){this.status="error",this.errorLogger.log(e)}}},this.changeTab=e=>{this.currentTab=e,this.resetQuery()},this.search=e=>{this.searchQuery=e,this.status="loading",this.searchDebounced()},this._search=async()=>{if(!this.searchQuery)return this.resetQuery(),void(this.status="default");try{"members"===this.currentTab?await this.membersSearchList.fetch({count:50,q:this.searchQuery,extended:1,fields:Je}):"groups"===this.currentTab&&await this.groupsSearchList.fetch({q:this.searchQuery,owner_id:this.authService.userId??0}),this.status="default"}catch(e){if(this.status="error",!(0,Qe.T)(e)||(0,Ve.z)(e))return}},this.searchDebounced=(0,He.s)(this._search,500),this.closeModal=()=>{this.props.current.closeModal()},this.changeCurrentFilter=e=>{this.currentFilter!==e&&(this.currentFilter=e)},this.saveResult=async()=>{const{groups:e,profiles:t}=this.bannedIdsResponse;this.isResultSaving=!0;const i=e?.map((e=>String(e.id)))||[],s=t?.map((e=>String(e.id)))||[],r=[],o=[],n=[],a=[];Object.keys(this.bannedGroups).forEach((e=>{i.includes(e)||o.push(e)})),Object.keys(this.bannedMembers).forEach((e=>{s.includes(e)||r.push(e)})),i.forEach((e=>{this.bannedGroups[Number(e)]||a.push(e)})),s.forEach((e=>{this.bannedMembers[Number(e)]||n.push(e)}));try{this.batchBanMembers(r,o,this.newsfeedApi.addBan.bind(this)),this.batchBanMembers(n,a,this.newsfeedApi.deleteBan.bind(this))}catch(e){if(this.status="error",!(0,Qe.T)(e)||(0,Ve.z)(e))return this.isResultSaving=!1,void(this.status="loading")}this.isResultSaving=!1,this.closeModal()},this.membersList=new Ge(this.friendsApi),this.membersSearchList=new Ge(this.friendsApi),this.groupsList=new $e(this.groupsApi,this.catalogApi),this.groupsSearchList=new $e(this.groupsApi,this.catalogApi),(0,k.l_)(this)}}Ue=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===ze.v?Object:ze.v,void 0===w.u?Object:w.u,void 0===Q.x?Object:Q.x,void 0===Be._?Object:Be._,void 0===Ke.D?Object:Ke.D,void 0===We.g?Object:We.g,void 0===Y.a?Object:Y.a,void 0===F.Y?Object:F.Y])],Ue);const{Provider:Xe,useModel:Ze}=(0,L.Qd)(Ue,{initInEffect:!1});var et=i(93059),tt=i(505174),it=i(46644),st=i(47417),rt=i(511727),ot=i(817740),nt=i(311029),at=i(721990),ct=i(865940),dt=i(772812),lt=i(120125),ht=i(999051),ut=i(37390),gt=i(540431),pt=i(645964),ft=i(724075),mt=i(799835),vt=i(91720);const _t=(0,q.P)((function({item:e,onChange:t,selected:i}){const r=(0,pt.Cg)(e);return(0,s.Y)(et.N,{before:(0,s.Y)(tt.e,{size:40,src:e.photo_100,alt:r}),checked:i,onChange:()=>t(e.id,i),"data-testid":`feed_sources_users_list_item_${e.id}`,children:r})})),yt=(0,q.P)((function({item:e,onChange:t,selected:i}){return(0,s.Y)(et.N,{before:(0,s.Y)(tt.e,{size:40,src:e.photo_100,alt:e.name}),checked:i,onChange:()=>t(e.id,i),"data-testid":`feed_sources_groups_list_item_${e.id}`,children:e.name})})),bt=(0,q.P)((function({isLoading:e,searchQuery:t}){const i=(0,Se.B)();return e?null:(0,s.Y)(_e.O,{"data-testid":"feed_sources_empty_placeholder",children:t?i.langReplace((0,mt.Xo)("global_search_not_found"),{search:t}):i.getLang("settings_olist_empty")})})),St=(0,q.P)((function(){const{currentTab:e,search:t,searchQuery:i,currentFilter:r,currentFilterText:o,changeCurrentFilter:n,onChangeMember:a,onChangeGroup:c,onLoadMore:d,closeModal:l,changeTab:h,saveResult:u,bannedGroups:g,bannedMembers:p,groupsArray:f,membersArray:m,isLoading:v,isBaseDataLoaded:_,isResultSaving:y}=Ze(),b=(0,Se.B)(),[S,k]=(0,C.useState)(null);return(0,ft.M)(!0,d,S),(0,C.useEffect)((()=>{S&&(S.scrollTop=0)}),[e]),(0,s.FD)(it.n,{width:560,"aria-label":b.getLang("wall_sources_title"),children:[(0,s.Y)(st.r,{onClose:l,closeAriaLabel:b.getLang("box_close"),children:(0,s.FD)(rt.o,{children:[(0,s.Y)(ot.O,{"data-testid":"feed_sources_header_tabs_members",selected:"members"===e,onClick:()=>{h("members")},children:b.getLang("wall_sources_people")}),(0,s.Y)(ot.O,{"data-testid":"feed_sources_header_tabs_groups",selected:"groups"===e,onClick:()=>{h("groups")},children:b.getLang("wall_sources_groups")})]})}),(0,s.FD)(nt.c,{insetLevel:1,children:[(0,s.Y)(at.v,{"data-testid":"feed_sources_header_search_input",value:i,placeholder:b.getLang("global_search"),autoFocus:!0,onChange:e=>t(e.target.value)}),(0,s.Y)(ct.v,{content:(0,s.FD)(s.FK,{children:[(0,s.Y)(ct.v.Item,{after:(0,s.Y)(ct.v.Checkbox,{type:"circle",checked:!r}),onClick:()=>{n("")},"data-testid":"feed_sources_filter_all",children:b.getLang("wall_sources_sort_all")}),(0,s.Y)(ct.v.Item,{after:(0,s.Y)(ct.v.Checkbox,{type:"circle",checked:"visible"===r}),onClick:()=>{n("visible")},"data-testid":"feed_sources_filter_visible",children:b.getLang("wall_sources_sort_visible")}),(0,s.Y)(ct.v.Item,{after:(0,s.Y)(ct.v.Checkbox,{type:"circle",checked:"hidden"===r}),onClick:()=>{n("hidden")},"data-testid":"feed_sources_filter_hidden",children:b.getLang("wall_sources_sort_hidden")})]}),children:(0,s.Y)(ye.$,{className:(0,dt.I)("color_text_secondary"),mode:"tertiary",after:(0,s.Y)(gt.w,{}),"data-testid":"feed_sources_filter",children:o})}),(0,s.Y)(R.K,{size:"s"}),(0,s.Y)(lt._,{autoHideScrollbar:!0,height:380,getRef:k,children:_?(0,s.FD)(s.FK,{children:["groups"===e&&(0,s.Y)(s.FK,{children:f.length?f.map((e=>(0,s.Y)(yt,{item:e,onChange:c,selected:!g[e.id]},e.id))):(0,s.Y)(bt,{isLoading:v,searchQuery:i})}),"members"===e&&(0,s.Y)(s.FK,{children:m.length?m.map((e=>(0,s.Y)(_t,{item:e,onChange:a,selected:!p[e.id]},e.id))):(0,s.Y)(bt,{isLoading:v,searchQuery:i})}),v&&(0,s.Y)(ht.y,{})]}):(0,s.Y)(ht.y,{})})]}),(0,s.Y)(ut.j,{actions:[(0,s.Y)(ye.$,{size:"m",mode:"secondary",disabled:y,onClick:l,"data-testid":"feed_sources_footer_actions_cancel",children:b.getLang("global_cancel")},"cancel"),(0,s.Y)(ye.$,{size:"m",onClick:u,disabled:y,loading:y,"data-testid":"feed_sources_footer_actions_save",children:b.getLang("global_save")},"ok")]})]})}));St.displayName="FeedSources";const kt=(0,vt.N)(Xe,St),Ct=(0,q.P)((function(){const{selectedId:e,handleSelect:t,handleReselect:i,items:r,isSourcesModalOpened:o,handleCloseSourcesModal:n}=(()=>{const{isSourcesModalOpened:e,handleOpenSourcesModal:t,handleCloseSourcesModal:i}=E(),{navigate:r}=(0,d.Z)(),{section:o}=(0,c.I)(),n=(0,Se.B)(),a=(0,Re.O)({section:o}),l=(0,C.useMemo)((()=>[{type:"group",expanded:!0,id:Re.W.news,href:"/feed",...Ne.Lq,label:n.getLang("news_title"),after:(0,s.Y)(je.J,{"aria-label":n.getLang("news_tune_source_feed_news"),onClick:t,"data-testid":"feed_right_menu_sources_action_edit",children:(0,s.Y)(qe.M,{})}),items:[{type:"item",href:`/feed?section=${B.NM.photos}`,...Ne.Lq,id:Re.W.photos,label:n.getLang("photos_photos"),"data-testid":"feed_right_menu_sources_photos"},{type:"item",href:`/feed?section=${B.NM.friends}`,...Ne.Lq,id:Re.W.friends,label:n.getLang("updates_tab_friends"),"data-testid":"feed_right_menu_sources_friends"}]},{type:"item",href:`/feed?section=${B.NM.search}`,...Ne.Lq,id:Re.W.search,label:n.getLang("global_search"),"data-testid":"feed_right_menu_global_search"},{type:"separator"},{href:`/feed?section=${B.NM.likes}`,...Ne.Lq,type:"item",id:Re.W.reactions,label:n.getLang("settings_upd_wall_likes"),"data-testid":"feed_right_menu_wall_likes"}]),[]),h=(0,C.useCallback)((e=>{window.scroll(0,0),r(`/feed?section=${e}`)}),[r]),u=(0,C.useCallback)((e=>{window.dispatchEvent(new CustomEvent("feed-refresh",{detail:{feedId:e}}))}),[]);return{selectedId:a,handleSelect:h,handleReselect:u,items:l,isSourcesModalOpened:e,handleCloseSourcesModal:i,handleOpenSourcesModal:t}})(),a=(0,Se.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(Ee.z,{id:"feed_sources",onClose:n,isShown:o,type:"card",children:(0,s.Y)(kt,{closeModal:n})}),(0,s.Y)(Te.y,{"aria-label":a.getLang("wall_right_nav"),role:"navigation",separator:"hide",selectedId:e,onReselect:i,onSelect:t,items:r})]})}));var wt=i(398035),Ft=i(767147);class Yt extends wt.D{get feedType(){return"friends"}getRequestPromise(e,t){return this.feedApi.getNewsFeed({section:B.NM.friends,count:e.count,filters:B.$i,fields:B.BG,source_ids:B.em,start_from:e.start_from},{signal:t.signal,maxRetries:this.userEnv.getConfigValue("feed_requests_retries_count")?.["newsfeed.get"]})}constructor(e,t,i){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.userEnv=i,(0,k.Gn)(this,{feedType:k.EW})}}Yt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f,void 0===G.J?Object:G.J])],Yt);class Lt{async[L.Ts](){"initial"===this.status&&await this.feedServiceDecorator.fetch({count:5})}[L.zr](){this.feedServiceDecorator.destroy()}get items(){return this.feedServiceDecorator.items}get status(){return this.feedServiceDecorator.requestState.status}get error(){return this.feedServiceDecorator.requestState.error}get module(){return this.metaData.get().module}get userIdString(){return String(this.authService.userId)}get isFullyLoaded(){return this.feedServiceDecorator.requestState.allAvailableItemsLoaded}get isResultEmpty(){return this.feedServiceDecorator.isResultEmpty}constructor(e,t,i,s,r,o,n,a){this.props=e,this.friendsFeedService=t,this.snackbar=i,this.langs=s,this.errorLogger=r,this.metaData=o,this.authService=n,this.feedDataService=a,this.feedServiceDecorator=new X.H(this.props.current.feedHistoryCacheKey,this.props.current.previousFeedHistoryCacheKey,this.friendsFeedService,this.feedDataService),this.postConfig={hasNotificationsInMenu:!0},this.onCreateDraft=(e,t)=>(0,te.G)({snackbar:this.snackbar,langs:this.langs,ownerId:t}),this.onCreatePost=()=>{this.snackbar.show({type:"ok",text:this.langs.getLang("wall_feed_post_created")})},this.onEmptyResultButtonClick=()=>{this.props.current.navigate("/friends?act=find")},this.errorLogger.setConfig({scope:"FriendsFeed",type:"container"}),(0,k.l_)(this)}}Lt=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===Yt?Object:Yt,void 0===V.q?Object:V.q,void 0===F.Y?Object:F.Y,void 0===ee.X?Object:ee.X,void 0===J.e?Object:J.e,void 0===w.u?Object:w.u,void 0===$.k?Object:$.k])],Lt);const{Provider:Dt,useModel:It}=(0,L.Qd)(Lt,{initInEffect:!1}),Mt=(0,q.P)((function(){const{status:e,error:t,items:i,onCreatePost:r,onCreateDraft:o,module:n,userIdString:a,isFullyLoaded:c,isResultEmpty:d,feedServiceDecorator:l,onEmptyResultButtonClick:h,postConfig:u}=It();return(0,s.FD)(s.FK,{children:[(0,s.Y)(oe.V,{ownerId:a,creationEntryPoint:"feed",screen:n,postingTimelineCreationEntryPoint:ne.I8.FEED_INPUT,renderPostingFormBlock:!0,loading:(0,s.Y)(ae.l,{}),afterCreateSuccess:r,afterDraftCreateSuccess:o,withoutExternalMargins:!0}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(Me,{emptyState:(0,s.Y)(ke,{onButtonClick:h}),status:e,error:t,items:i,postConfig:u,skeleton:(0,s.FD)(N.Y,{padding:"none",children:[(0,s.Y)(z.K,{}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(z.K,{})]}),isFullyLoaded:c,isResultEmpty:d,feedServiceDecorator:l})]})})),Pt=(0,Oe.L)((0,Pe.V)(Dt,Mt),ve.J,"FriendsFeed");class Ot extends wt.D{get feedType(){return"photos"}getRequestPromise(e,t){const i={section:B.NM.photos,count:e.count,filters:B.OU,fields:B.cx,start_from:e.start_from,source_ids:B.Jq};return this.feedApi.getNewsFeed(i,{signal:t.signal,maxRetries:this.userEnv.getConfigValue("feed_requests_retries_count")?.["newsfeed.get"]})}constructor(e,t,i){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.userEnv=i,(0,k.Gn)(this,{feedType:k.EW})}}Ot=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f,void 0===G.J?Object:G.J])],Ot);class At{async[L.Ts](){"initial"===this.status&&await this.feedServiceDecorator.fetch({count:5})}[L.zr](){this.feedServiceDecorator.destroy()}get items(){return this.feedServiceDecorator.items}get status(){return this.feedServiceDecorator.requestState.status}get error(){return this.feedServiceDecorator.requestState.error}get module(){return this.metaData.get().module}get userIdString(){return String(this.authService.userId)}get isFullyLoaded(){return this.feedServiceDecorator.requestState.allAvailableItemsLoaded}get isResultEmpty(){return this.feedServiceDecorator.isResultEmpty}constructor(e,t,i,s,r,o,n,a,c){this.props=e,this.photosFeedService=t,this.snackbar=i,this.langs=s,this.errorLogger=r,this.metaData=o,this.authService=n,this.feedDataService=a,this.feedApi=c,this.feedServiceDecorator=new X.H(this.props.current.feedHistoryCacheKey,this.props.current.previousFeedHistoryCacheKey,this.photosFeedService,this.feedDataService),this.onCreateDraft=(e,t)=>(0,te.G)({snackbar:this.snackbar,langs:this.langs,ownerId:t}),this.onCreatePost=()=>{this.snackbar.show({type:"ok",text:this.langs.getLang("wall_feed_post_created")})},this.onEmptyResultButtonClick=async()=>{await this.feedApi.setFeedType({type:"top"}),this.props.current.navigate("/feed")},this.errorLogger.setConfig({scope:"PhotosFeed",type:"container"}),(0,k.l_)(this)}}At=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===Ot?Object:Ot,void 0===V.q?Object:V.q,void 0===F.Y?Object:F.Y,void 0===ee.X?Object:ee.X,void 0===J.e?Object:J.e,void 0===w.u?Object:w.u,void 0===$.k?Object:$.k,void 0===Q.x?Object:Q.x])],At);const{Provider:xt,useModel:Tt}=(0,L.Qd)(At,{initInEffect:!1}),Et=(0,q.P)((function(){const{status:e,error:t,items:i,module:r,onCreatePost:o,onCreateDraft:n,userIdString:a,isFullyLoaded:c,isResultEmpty:d,feedServiceDecorator:l,onEmptyResultButtonClick:h}=Tt();return(0,s.FD)(s.FK,{children:[(0,s.Y)(oe.V,{ownerId:a,creationEntryPoint:"feed",screen:r,postingTimelineCreationEntryPoint:ne.I8.FEED_INPUT,renderPostingFormBlock:!0,loading:(0,s.Y)(ae.l,{}),afterCreateSuccess:o,afterDraftCreateSuccess:n,withoutExternalMargins:!0}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(Me,{emptyState:(0,s.Y)(ke,{onButtonClick:h}),status:e,error:t,items:i,skeleton:(0,s.FD)(N.Y,{padding:"none",children:[(0,s.Y)(z.K,{}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(z.K,{})]}),isFullyLoaded:c,isResultEmpty:d,feedServiceDecorator:l})]})})),jt=(0,Oe.L)((0,Pe.V)(xt,Et),ve.J,"PhotosFeed"),qt={POST:"post",COMMENT:"comment",VIDEO:"video",CLIP:"clip",MARKET:"market"};class Rt extends wt.D{get feedType(){return"likes"}getRequestPromise(e,t){return this.feedApi.getLikesFeed({count:e.count,start_from:e.start_from,like_types:Object.values(qt).join(),fields:B.V7},{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,(0,k.Gn)(this,{feedType:k.EW})}}Rt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],Rt);class Nt extends wt.D{get feedType(){return"likes:photo"}getRequestPromise(e,t){return this.feedApi.getLikesFeed({count:e.count,start_from:e.start_from,like_types:this.likesType,fields:B.V7},{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.likesType="photo",(0,k.Gn)(this,{feedType:k.EW})}}Nt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],Nt);class zt extends wt.D{get feedType(){return"likes:wall"}getRequestPromise(e,t){return this.feedApi.getLikesFeed({count:e.count,start_from:e.start_from,like_types:this.likesType,fields:B.V7},{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.likesType=qt.POST,(0,k.Gn)(this,{feedType:k.EW})}}zt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],zt);class Bt extends wt.D{get feedType(){return"likes:wall_reply"}getRequestPromise(e,t){return this.feedApi.getLikesFeed({count:e.count,start_from:e.start_from,like_types:this.likesType,fields:B.V7},{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.likesType=qt.COMMENT,(0,k.Gn)(this,{feedType:k.EW})}}Bt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],Bt);class Kt extends wt.D{get feedType(){return"likes:video"}getRequestPromise(e,t){return this.feedApi.getLikesFeed({count:e.count,start_from:e.start_from,like_types:this.likesType,fields:B.V7},{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.likesType=qt.VIDEO,(0,k.Gn)(this,{feedType:k.EW})}}Kt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],Kt);class Wt extends wt.D{get feedType(){return"likes:clips"}getRequestPromise(e,t){return this.feedApi.getLikesFeed({count:e.count,start_from:e.start_from,like_types:this.likesType,fields:B.V7},{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,this.likesType=qt.CLIP,(0,k.Gn)(this,{feedType:k.EW})}}Wt=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],Wt);class Ht{get instance(){if(!this.filter)return this.commonLikesFeedService;switch(this.filter){case"wall":return this.postLikesFeedService;case"wall_reply":return this.commentLikesFeedService;case"clips":return this.clipLikesFeedService;case"photo":return this.photoLikesFeedService;case"video":return this.videoLikesFeedService;default:return this.commonLikesFeedService}}updateFilter(e){this.filter=e}constructor(e,t,i,s,r,o){this.commonLikesFeedService=e,this.postLikesFeedService=t,this.commentLikesFeedService=i,this.videoLikesFeedService=s,this.clipLikesFeedService=r,this.photoLikesFeedService=o,this.filter=void 0,(0,k.l_)(this)}}Ht=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Rt?Object:Rt,void 0===zt?Object:zt,void 0===Bt?Object:Bt,void 0===Kt?Object:Kt,void 0===Wt?Object:Wt,void 0===Nt?Object:Nt])],Ht);class Jt{createFeedServiceDecorator(){return new X.H(this.props.current.feedHistoryCacheKey,this.props.current.previousFeedHistoryCacheKey,this.likesFeedService.instance,this.feedDataService)}get feedServiceDecorator(){return this._feedServiceDecorator}get feedPlatformConfig(){return this.props.current.feedPlatformConfig}async[L.Ts](){this.likesFeedService.updateFilter(this.props.current.filter),this._feedServiceDecorator=this.createFeedServiceDecorator(),"initial"===this.status&&(this.emptyStateLoading=!0,await this.checkIfAnyLikes({count:5}),(0,k.h5)((()=>{this.emptyStateLoading=!1,this.hasAnyLikes&&void 0!==this.filter&&this.feedServiceDecorator.fetch({count:5})})))}[L.zr](){this.feedServiceDecorator.destroy(),this.reactions.destroy(),this.likesFeedService.updateFilter(void 0)}[L.yo](e){if(this.userEnv.partConfigEnabled("frontend.feed_scroll_restoration_from_non_feed_page")){const t=this.feedServiceDecorator?.cacheKey;t!==e.feedHistoryCacheKey&&this.feedServiceDecorator?.setCacheKey(e.feedHistoryCacheKey)}}get items(){return this.feedServiceDecorator.items}get photoItems(){const e=this.feedDataService.getItemIdObjects("likes:photo");return this.feedDataService.getItemsWithKeys(e)}get hasAnyExceptPhotoLikes(){return this.feedDataService.getItemIdObjects("likes").length>0}get hasAnyPhotoLikes(){return this.feedDataService.getItemIdObjects("likes:photo").length>0}get hasAnyLikes(){return this.hasAnyExceptPhotoLikes||this.hasAnyPhotoLikes}get showEmptyPlaceholder(){return!["initial","loading"].includes(this.status)&&!this.hasAnyLikes}get status(){return this.feedServiceDecorator.requestState.status}get error(){return this.feedServiceDecorator.requestState.error}get loadedFully(){return this.feedServiceDecorator.requestState.allAvailableItemsLoaded}get module(){return this.metaData.get().module}get userIdString(){return String(this.authService.userId)}get filter(){return this.props.current.filter}get isClipsTabEnabled(){return!this.userEnv.partConfigEnabled("frontend.clips_tab_disabled_in_likes_feed")}get postConfig(){return{hasNotificationsInMenu:!0,disableNotInterestingInMenu:!0,ignoreSlavePost:!0,shouldHideMenuForClipsAndVideos:!0}}constructor(e,t,i,s,r,o,n,a,c,d,l,h){this.props=e,this.likesFeedService=t,this.metaData=i,this.authService=s,this.errorLogger=r,this.snackbar=o,this.langs=n,this.logger=a,this.feedDataService=c,this.commonLikesFeedService=d,this.photoLikesFeedService=l,this.userEnv=h,this.emptyStateLoading=!1,this.reactions=new Z.O,this._feedServiceDecorator=this.createFeedServiceDecorator(),this.checkIfAnyLikes=async e=>{try{await this.feedServiceDecorator.preload(this.commonLikesFeedService,e),await this.feedServiceDecorator.preload(this.photoLikesFeedService,{count:20})}catch(e){this.errorLogger.log(e)}},this.onCreateDraft=(e,t)=>(0,te.G)({snackbar:this.snackbar,langs:this.langs,ownerId:t}),this.onCreatePost=()=>{this.snackbar.show({type:"ok",text:this.langs.getLang("wall_feed_post_created")})},this.errorLogger.setConfig({scope:"LikesFeed",type:"container"}),this.reactions.reaction((()=>this.props.current.filter),(e=>{this.feedServiceDecorator.destroy(),this.likesFeedService.updateFilter(e),this._feedServiceDecorator=this.createFeedServiceDecorator(),this.feedServiceDecorator.fetch({count:5})})),(0,k.l_)(this)}}Jt=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===Ht?Object:Ht,void 0===J.e?Object:J.e,void 0===w.u?Object:w.u,void 0===ee.X?Object:ee.X,void 0===V.q?Object:V.q,void 0===F.Y?Object:F.Y,void 0===ze.v?Object:ze.v,void 0===$.k?Object:$.k,void 0===Rt?Object:Rt,void 0===Nt?Object:Nt,void 0===G.J?Object:G.J])],Jt);const{Provider:Qt,useModel:Vt}=(0,L.Qd)(Jt,{initInEffect:!1});var Gt=i(187233),$t=i(225505);class Ut{get photosWithKey(){return this.props.current.itemsWithKeys.map((({item:{value:e},key:t})=>"photos"in e&&e?.photos&&"items"in e.photos?{photo:e.photos.items?.[0],key:t}:void 0)).filter((e=>Boolean(e)))}get status(){return this.props.current.status}get navigate(){return this.props.current.navigate}get config(){return this.props.current.config}constructor(e,t){this.props=e,this.authService=t,this.handlePhotoClick=(e,t)=>{this.authService.userId&&this.config.showPhoto(e,t,this.authService.userId)},this.handleShowAllPhotosClick=()=>{this.authService.userId&&this.config.showAllPhotos({userId:this.authService.userId,navigate:this.navigate})},(0,k.l_)(this)}}Ut=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===w.u?Object:w.u])],Ut);const{Provider:Xt,useModel:Zt}=(0,L.Qd)(Ut,{initInEffect:!1});var ei=i(685789),ti=i(423654),ii=i(638945),si=i(685441),ri=i(475118),oi=i(413621),ni=i(300806),ai=i(180329),ci=i(46284);const di=({spacing:e,noAnimation:t=!1})=>(0,s.FD)(Gt.i,{mode:"vertical",spacing:e,paddingTop:20,children:[(0,s.FD)(ai.s,{justify:"space-between",children:[(0,s.Y)(ai.s.Item,{children:(0,s.Y)(ci.E,{width:84,height:12,borderRadius:4,noAnimation:t})}),(0,s.Y)(ai.s.Item,{children:(0,s.Y)(ci.E,{width:84,height:12,borderRadius:4,noAnimation:t})})]}),(0,s.Y)(R.K,{size:16}),(0,s.Y)("div",{children:(0,s.Y)(ri.x,{columns:"dynamic",columnSpacing:4,rowSpacing:0,children:(0,s.Y)(ri.x.HorizontalScroll,{padding:0,showArrows:!1,children:Array(5).fill(null).map(((e,i)=>(0,s.Y)(ri.x.Item,{children:(0,s.Y)(ci.E,{width:96,height:96,borderRadius:"default",noAnimation:t})},i)))})})})]}),li=(0,q.P)((function(){const{status:e,photosWithKey:t,handlePhotoClick:i,handleShowAllPhotosClick:r,config:o}=Zt(),n=(0,Se.B)();return["initial","loading","error"].includes(e)?(0,s.Y)(di,{spacing:o.paddingSpacing,noAnimation:"error"===e}):"success"!==e||t?.length?(0,s.FD)(s.FK,{children:[(0,s.FD)(Gt.i,{mode:"vertical",spacing:8,paddingTop:6,paddingBottom:0,children:[(0,s.Y)(R.K,{size:1}),(0,s.Y)(ei.Q,{aside:(0,s.Y)(ti.N,{onClick:r,"data-testid":"feed_likes_tabs_photo",children:(0,s.Y)(ii.fz,{children:n.getLang("global_show_all")})}),children:(0,s.Y)(si.Y,{children:n.getLang("fave_likes_photo")})})]}),(0,s.Y)(R.K,{}),"success"===e&&(0,s.Y)(ri.x,{columns:"dynamic",columnSpacing:4,rowSpacing:0,children:(0,s.Y)(ri.x.HorizontalScroll,{padding:o.paddingSpacing,children:t?t.map((({photo:e,key:t},r)=>{const{id:o,sizes:a,owner_id:c}=e;return(0,s.Y)(ri.x.Item,{children:(0,s.Y)(oi._,{onClick:()=>i(c,o),borderRadius:"s",src:(0,ni.q)(a??[],96*window.devicePixelRatio)?.url,size:96,alt:"",tabIndex:0,"data-testid":`likes-feed-photo${r}`,loading:"lazy","aria-label":n.getLang("fave_link_type_photo")})},t)})):null})}),(0,s.Y)(R.K,{})]}):null}));li.displayName="LikesFeedPhotoBlock";const hi=(0,vt.N)(Xt,li);var ui=i(882976);const gi=()=>(0,s.Y)(Gt.i,{mode:"vertical",spacing:16,children:Array(5).fill(null).map(((e,t)=>(0,s.FD)(C.Fragment,{children:[(0,s.Y)(ci.E,{width:45,height:12}),6!==t&&(0,s.Y)(R.K,{size:28,mode:"vertical"})]},t)))}),pi=({onTabSelect:e,selectedTabKey:t,loading:i,clipsTabEnabled:r=!0})=>{const{getLang:o}=(0,Se.B)(),n=[{key:void 0,name:o("mobile_feed_likes_tab_all"),testId:"all"},{key:"wall",name:o("mobile_feed_likes_tab_wall"),testId:"wall"},{key:"wall_reply",name:o("mobile_feed_likes_tab_wall_reply"),testId:"wall_reply"},{key:"video",name:o("mobile_feed_likes_tab_video"),testId:"video"}];return r&&n.splice(-1,0,{key:"clips",name:o("mobile_feed_likes_tab_clips"),testId:"clips"}),i?(0,s.Y)(gi,{}):(0,s.Y)(ui.t,{mode:"default",layoutFillMode:"shrinked",withFade:!0,children:n.map((({key:i,name:r,testId:o},n)=>(0,s.Y)(ot.O,{selected:t===i,onClick:()=>e(i),"data-testid":`feed_likes_tabs_${o}`,children:r},n)))})};var fi=i(992341),mi=i(983538);const vi=(0,q.P)((function(){const{status:e,error:t,items:i,photoItems:r,userIdString:o,module:n,onCreatePost:a,onCreateDraft:c,filter:l,loadedFully:h,feedPlatformConfig:u,showEmptyPlaceholder:g,postConfig:p,hasAnyPhotoLikes:f,feedServiceDecorator:m}=Vt(),{navigate:v}=(0,d.Z)(),{getLang:_}=(0,Se.B)(),y=()=>(0,s.Y)(_e.O,{icon:(0,s.Y)(fi.n,{}),children:_("news_no_likes")});return(0,s.FD)(s.FK,{children:[(0,s.FD)(s.FK,{children:[(0,s.Y)(oe.V,{ownerId:o,creationEntryPoint:"feed",screen:n,postingTimelineCreationEntryPoint:ne.I8.FEED_INPUT,renderPostingFormBlock:!0,loading:(0,s.Y)(ae.l,{}),afterCreateSuccess:a,afterDraftCreateSuccess:c,withoutExternalMargins:!0}),(0,s.Y)(R.K,{size:"2xl"})]}),(0,s.FD)(N.Y,{padding:"none",children:[g?y():(0,s.FD)(s.FK,{children:[(0,s.Y)(hi,{navigate:v,config:u,itemsWithKeys:r,status:f?"success":e}),(0,s.Y)(Gt.i,{mode:"vertical",spacing:4,paddingTop:8,paddingBottom:0,children:(0,s.Y)(pi,{selectedTabKey:l,loading:"initial"===e,onTabSelect:e=>{u.filterLikes({filter:e,navigate:v})}})}),(0,s.Y)(Gt.i,{mode:"vertical",spacing:8,paddingTop:4,paddingBottom:0,children:(0,s.Y)($t.w,{})}),(0,s.Y)(mi.B,{id:"page-feed",children:(0,s.Y)(Me,{status:e,error:t,items:i,emptyState:y(),skeleton:(0,s.Y)(z.K,{}),isFullyLoaded:h,postConfig:p,noBorders:!0,feedServiceDecorator:m})})]}),(0,s.Y)(R.K,{size:32,mode:"horizontal"})]})]})})),_i=(0,Oe.L)((0,Pe.V)(Qt,vi),ve.J,"LikesFeed");var yi=i(33556),bi=i(842495),Si=i(726246);const ki={commonFeed:bi.N,likesFeed:{paddingSpacing:20,filterLikes:({filter:e,navigate:t})=>{let i="/feed?section=likes";e&&(i=`${i}&filter=${e}`),t(i)},showAllPhotos:({userId:e,navigate:t})=>{t(`/feed?section=likes&z=album${e}_0000000`)},showPhoto:(e,t,i)=>{(0,yi.c)(`${e}_${t}`,`liked${i}`)}},searchFeed:{query:({q:e,sort:t,navigate:i})=>{const s=new URLSearchParams({section:"search",...e?{"c[q]":e}:{},...void 0!==t?{"c[sort]":String(t)}:{}});(0,Si.D8)((()=>{window.dispatchEvent(new CustomEvent("check-feed-common-autoplay"))}),!0),i(`/feed?${s.toString()}`)}}};class Ci extends wt.D{get feedType(){return"search"}getRequestPromise(e,t){const i={q:e.q,extended:1,sort_by_rating:e.sort_by_rating,count:e.count,start_from:e.start_from,fields:B.V7};return this.feedApi.getSearchFeed(i,{signal:t.signal})}constructor(e,t){super(t),this.feedApi=e,this.feedServiceAggregator=t,(0,k.Gn)(this,{feedType:k.EW})}}Ci=(0,S.Cg)([L.z8.global(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===Q.x?Object:Q.x,void 0===Ft.f?Object:Ft.f])],Ci);class wi{async[L.Ts](){"initial"===this.status&&this.query&&await this.fetch()}[L.zr](){this.feedServiceDecorator.destroy(),this.query="",this.sort=0,this._queryReactionDisposer?.()}get items(){return this.feedServiceDecorator.items}get status(){return this.feedServiceDecorator.requestState.status}get error(){return this.feedServiceDecorator.requestState.error}get loadedFully(){return this.feedServiceDecorator.requestState.allAvailableItemsLoaded}get module(){return this.metaData.get().module}get userIdString(){return String(this.authService.userId)}get isAuthorized(){return this.authService.isAuthorized}constructor(e,t,i,s,r,o,n,a){this.props=e,this.searchFeedService=t,this.snackbar=i,this.langs=s,this.errorLogger=r,this.metaData=o,this.authService=n,this.feedDataService=a,this.query="",this.sort=0,this._queryReactionDisposer=null,this.feedServiceDecorator=new X.H(this.props.current.feedHistoryCacheKey,this.props.current.previousFeedHistoryCacheKey,this.searchFeedService,this.feedDataService),this.fetch=async()=>{this.feedServiceDecorator.reset(),await this.feedServiceDecorator.fetch({q:this.query,sort_by_rating:this.sort,count:5})},this.onCreateDraft=(e,t)=>(0,te.G)({snackbar:this.snackbar,langs:this.langs,ownerId:t}),this.onCreatePost=()=>{this.snackbar.show({type:"ok",text:this.langs.getLang("wall_feed_post_created")})},this.onChangeSearchQuery=(e,t)=>{this.query.trim()!==e.trim()?(this.query=e,this.debouncedFetchAndUpdateQueryParam(t)):this.query=e},this.debouncedFetchAndUpdateQueryParam=(0,He.s)((e=>{e(this.query,this.sort),this.fetch()}),666),this.errorLogger.setConfig({scope:"SearchFeed",type:"container"}),this.query=(0,b.v)(e.current.q),this.sort=e.current.sort??0,this._queryReactionDisposer=(0,k.mJ)((()=>[this.props.current.q,this.props.current.sort]),(([e,t])=>{const i=(0,b.v)(e),s=t??0;i===this.query&&s===this.sort||(this.query=i,this.sort=s,this.fetch())})),(0,k.l_)(this)}}wi=(0,S.Cg)([L.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===L.Ji?Object:L.Ji,void 0===Ci?Object:Ci,void 0===V.q?Object:V.q,void 0===F.Y?Object:F.Y,void 0===ee.X?Object:ee.X,void 0===J.e?Object:J.e,void 0===w.u?Object:w.u,void 0===$.k?Object:$.k])],wi);const{Provider:Fi,useModel:Yi}=(0,L.Qd)(wi,{initInEffect:!1});var Li=i(165596);const Di=(0,q.P)((function(){const{status:e,error:t,items:i,module:r,onCreatePost:o,onCreateDraft:n,loadedFully:a,userIdString:c,langs:l,query:h,onChangeSearchQuery:u,feedServiceDecorator:g}=Yi(),{navigate:p}=(0,d.Z)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(N.Y,{separator:"hide",children:(0,s.Y)(at.v,{type:"text",placeholder:l.getLang("news_search"),value:h,onChange:e=>{u(e.target.value,((e,t)=>ki.searchFeed.query({q:e,sort:t,navigate:p})))}})}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(pe,{section:"search",query:h}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(oe.V,{ownerId:c,creationEntryPoint:"feed",screen:r,postingTimelineCreationEntryPoint:ne.I8.FEED_INPUT,renderPostingFormBlock:!0,loading:(0,s.Y)(ae.l,{}),afterCreateSuccess:o,afterDraftCreateSuccess:n,withoutExternalMargins:!0}),(0,s.Y)(R.K,{size:"2xl"}),(0,s.Y)(Me,{status:e,error:t,items:i,isFullyLoaded:a,feedServiceDecorator:g,emptyState:(0,s.Y)(N.Y,{children:(0,s.Y)(_e.O,{icon:(0,s.Y)(Li.D,{}),children:l.getLang("updates_no_news")})}),skeleton:(0,s.Y)(N.Y,{children:(0,s.Y)(me.q,{})}),externalEmptyState:!(i.length||h)&&("initial"===e||"success"===e)||0===i.length&&"success"===e})]})})),Ii=(0,Oe.L)((0,Pe.V)(Fi,Di),ve.J,"SearchFeed"),Mi=(0,q.P)((function(){const e=(0,c.I)(),t=e["c[sort]"]?Number(e["c[sort]"]):void 0;return(0,s.Y)(Ii,{q:e.q||e["c[q]"],sort:t?1:0,feedCommonConfig:ki.commonFeed})})),Pi=(0,q.P)((function({section:e,filter:t}){const{navigate:i}=(0,d.Z)();switch(e){case B.NM.friends:return(0,s.Y)(Pt,{navigate:i,feedCommonConfig:ki.commonFeed});case B.NM.photos:return(0,s.Y)(jt,{navigate:i,feedCommonConfig:ki.commonFeed});case B.NM.likes:return(0,s.Y)(_i,{feedCommonConfig:ki.commonFeed,filter:t,feedPlatformConfig:ki.likesFeed});case B.NM.search:return(0,s.Y)(Mi,{});default:return(0,s.Y)(s.FK,{children:B.NM[e]})}}));var Oi=i(793722),Ai=i(908149);const xi={modal:{ModalComponent:Ee.z}},Ti=(0,q.P)((({collageModalService:e})=>{const{isModalOpened:t,banner:i,options:r,closeCollageModal:o}=e;if(!t||!i||!r)return null;const n=xi.modal.ModalComponent,{modalHeight:a,modalWidth:c}=function({banner:e,options:t}){const{clientHeight:i,clientWidth:s}=document.documentElement;let r=i,o=s;if(e.items){const n=e.items[t.attachmentIndex];if(n.image){const t=e.items.filter((e=>e.image)),{maxImageHeight:n,maxImageWidth:a}=t.reduce(((e,t)=>{const i={...e};return t.image&&t.image.height&&t.image.height>i.maxImageHeight&&(i.maxImageHeight=t.image.height),t.image&&t.image.width&&t.image.width>i.maxImageWidth&&(i.maxImageWidth=t.image.width),i}),{maxImageHeight:0,maxImageWidth:0});n<i&&(r=n),a+310<s&&(o=a+310)}if(n.video){const{width:e,height:t}=n.video.preview;t<i&&(r=t),e<s&&(o=e)}}return r<300&&(r=300),o<610&&(o=610),r+122>=i&&(r-=122),o+112>=s&&(o-=112),{modalHeight:r,modalWidth:o}}({banner:i,options:r});return(0,s.Y)(n,{onClose:o,isShown:t,id:"selecting-user-group-modal",type:"card",children:(0,s.Y)(Ai.T,{onClose:o,banner:i,options:r,modalHeight:a,modalWidth:c})})}));var Ei=i(389759),ji=i(292184);const qi=(0,q.P)((function(){const{langs:e}=E(),{navigate:t}=(0,d.Z)(),i=(0,c.I)(),r=i["c[sort]"]?Number(i["c[sort]"]):void 0;return(0,s.Y)(Gt.i,{mode:"vertical",paddingBottom:0,spacing:0,children:(0,s.Y)(N.Y,{padding:"s",children:(0,s.Y)(ji.T,{Component:"label",before:(0,s.Y)(Ei.S,{className:(0,dt.I)("color_icon_negative")}),after:(0,s.Y)(n.dOG,{name:"sort_by_rating",checked:Boolean(r),onChange:()=>ki.searchFeed.query({q:i.q||i["c[q]"],sort:r?0:1,navigate:t})}),children:(0,s.Y)(ii.tW,{children:e.getLang("wall_top_posts")})})})})}));var Ri=i(282624);const Ni=e=>["wall","video","wall_reply","clips"].includes(e??"");function zi(e){return!!e&&e in B.NM}function Bi(e){return e!==B.NM.search}const Ki=(0,q.P)((function(){const e=(0,c.I)(),{section:t,filter:i,storybox:g,forced_blocks:p,force_recom:f}=e,{getCollageModalService:m,handleStoryboxQueryParams:v,modalController:_}=E(),y=m(),{reload:b}=(0,d.Z)(),S=(0,Se.B)();(0,C.useEffect)((()=>{g&&v(g)}),[g]);const k=(0,C.useMemo)((()=>{switch(t){case B.NM.search:return S.getLang("news_title_search");case B.NM.friends:return S.getLang("updates_tab_friends");case B.NM.photos:return S.getLang("news_title_photos");case B.NM.likes:return S.getLang("news_title_reactions");default:return S.getLang("news_title_posts")}}),[t]),w=t===B.NM.search&&(e.q||e["c[q]"]);return(0,s.FD)(s.FK,{children:[(0,s.Y)(r.X,{}),(0,s.Y)(n.s6o,{Component:"h1",id:"feed-page-title",children:k}),(0,s.FD)(a.J,{screenReaderReverse:!0,children:[(0,s.FD)(o.N,{children:[(0,s.Y)(Ct,{}),w&&(0,s.Y)(qi,{}),Bi(t)&&(0,s.Y)(Oi.s,{url:"al_feed_right_block.php",queryParams:{act:"default",response_type:"simple",force_recom:f}})]}),(0,s.Y)(a.J.Main,{role:"main","data-testid":"feed_wall",children:(0,s.FD)(l.F,{children:[(0,s.Y)(h.a,{config:[u.Pr.feedSectionPhotos,u.Pr.feedSectionLikes,u.Pr.feedSectionFriends,u.Pr.feedSectionSearch],children:zi(t)&&(0,s.Y)(Pi,{section:t,filter:Ni(i)?i:void 0})}),(0,s.Y)(h.a,{config:[u.Pr.feed,u.Pr.feedLegacy],children:(0,s.Y)(xe,{feedCommonConfig:ki.commonFeed,reload:b,forcedBlocks:p})})]})})]}),(0,s.Y)(Ti,{collageModalService:y}),(0,s.Y)(Ri.H,{controller:_})]})})),Wi=()=>(0,s.Y)(L.DA,{name:"routeFeed",children:(0,s.Y)(T,{children:(0,s.Y)(j,{children:(0,s.Y)(Ki,{})})})})},842495:(e,t,i)=>{i.d(t,{N:()=>r});var s=i(940506);const r={initVideoAutoplay:()=>{window.stManager.add([window.jsc("web/video.js")],s.default.initVideoAutoplay)}}},392775:(e,t,i)=>{i.d(t,{J:()=>a});var s=i(221020),r=i(634164),o=i(516427);const n="vkitRightMenuItemButton__button--jV96i",a=({className:e,propagateEvent:t,onClick:i,onKeyDown:a,...c})=>{const d=t?i:e=>{i?.(e),e.stopPropagation()},l=t?a:e=>{a?.(e),e.stopPropagation()};return(0,s.Y)(o.SB4,{...c,activeMode:"opacity",hoverMode:"opacity",className:(0,r.$)(n,e),onClick:d,onKeyDown:l})}}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/pageFeedSpa.6e8e3e53.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/pageFeedSpa.6e8e3e53.js",e),e}