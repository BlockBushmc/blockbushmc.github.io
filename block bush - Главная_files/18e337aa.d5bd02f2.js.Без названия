try{(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[70380],{819501:(e,t,s)=>{function i(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><linearGradient id="like_circle_fill_red_20__a" gradientUnits="userSpaceOnUse" x1="-10" x2="10" y1="10" y2="30"><stop offset="0" stop-color="#ff5263"/><stop offset="1" stop-color="#ff3347"/></linearGradient><path d="M0 10a10 10 0 1 1 20 0 10 10 0 0 1-20 0z" fill="url(#like_circle_fill_red_20__a)"/><path d="M12.2 6.5c1.55 0 2.8 1.2 2.8 2.7 0 1.5-.63 2.24-3.28 4.23l-1.2.9a.86.86 0 0 1-1.03 0l-1.21-.9C5.63 11.44 5 10.69 5 9.19 5 7.7 6.25 6.5 7.8 6.5c.83 0 1.55.4 2.2 1.15.65-.75 1.37-1.15 2.2-1.15z" fill="#fff"/></svg>',name:"like_circle_fill_red_20"}}s.d(t,{getIcon20LikeCircleFillRed:()=>i})},857656:(e,t,s)=>{s.d(t,{Stickers:()=>a});var i=s(19589),o=s(105330);const a={getStickerUrl:function(e,t){let s=String(t);if(i.colorScheme.isDarkScheme()&&(s=s.replace(/b$/,"")+"b"),window.Emoji){const t=Emoji.stickersById?.[e]?.sticker[Emoji.STICKER_FIELD_IMAGES]?.[s];if(t)return t}const a={id:e,size:s};if((0,o.isMvk)()){if(window.stickers_cache){const t=window.stickers_cache.getStickerImage(e,s);if(t)return t}return window.store.stickers&&function(e,t){return e.replace(/%([^%]+?)%/g,(e=>(e=e.slice(1,-1),t.hasOwnProperty(e)?t[e]:"")))}(window.store.stickers.url_template,{id:e,size:s})}return window.getTemplate("stickers_sticker_url",a)},getStickerPopupLayer:function(e){return(0,o.isMvk)()&&window.stickers_cache?.getStickerPopupLayer(e)||[]}}},992826:(e,t,s)=>{s.d(t,{VideoChat:()=>x});var i=s(754866),o=s(749284),a=s(972332),n=s(478752),r=s(342879),c=s(251703),l=s(65759),d=s(866467),h=s(3171),m=s(957994),p=s(736290),g=s(312587),_=s(468073),u=s(895461),v=s(540667),f=s(420707),w=s(581197),C=s(306979),y=s(361121),k=s(351118),S=s(856289);const x={MAX_COMMENTS_NUM:50,MAX_LIKES_PER_BATCH:5,MAX_STICKERS_PER_BATCH:5,init(e,t){if(x.block&&x.destroy(),!e)return;x.block=e,x.options=(0,n.extend)({},t),x.messagesWrap=(0,i.domByClass)(e,"mv_chat_messages_wrap"),x.stickersWrap=(0,i.domByClass)(e,"mv_chat_stickers_wrap"),x.initChatComponent(t.messageData),this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.scrollBottomBtnWrap=(0,i.domByClass)(e,"mv_chat_new_messages_btn_wrap"),x.replyForm=(0,i.domByClass)(e,"mv_chat_reply_form"),x.replyForm&&(x.replyInput=(0,i.domByClass)(e,"mv_chat_reply_input"),x.initReplyInput()),x.firstMsgIntro=(0,i.domByClass)(e,"mv_chat_first_message_intro");[x.messagesWrap,x.replyForm].forEach((e=>e?.classList.add("chat_hide_button_enabled"))),x.initChatHideButton(),x.stickerManager?.destroy(),x.stickerManager=null,x.stickersCanvasWrap=null},initReplyInput(){(0,o.placeholderInit)(x.replyInput,{editable:!0,global:!0}),window.stManager.add([window.jsc("web/emoji.js"),"notifier.css"],(function(){const e=Emoji.init(x.replyInput,{forceStickerPack:x.options.forceStickerPack,controlsCont:x.replyForm,noLineBreaks:1,noCtrlSend:1,noStickers:!!x.options.noStickers||(0,S.isVideoStandalone)(),ref:"video_chat",onSend:function(){x.sendMessage()},checkEditable:function(){x.checkFormHeight(),x.checkTextLen()},onStickerSend:function(e){x.sendSticker(e)}});(0,i.data)(x.replyForm,"optId",e)}))},initChatComponent(e){const t=(0,S.isVideoStandalone)()?(0,d.getLang)("video_live_comments_stub_text"):(0,d.getLang)("video_first_message_intro");x.firstMessageIntroText=x.firstMessageIntroText||t,x.VideoChatComponent=v.VideoChatComponent,(0,m.api)("video.getComments",{owner_id:mvcur.mvData.oid,video_id:mvcur.mvData.vid,count:30,sort:"desc",extended:1,fields:"verified,domain,photo",access_key:mvcur.mvData.itemAccessHash}).then((e=>{x.VideoChatComponent.init({messages:(0,g.formatMessages)(mvcur.mvData.oid,x.options?.chatActionHash||"",e),firstMessageIntroText:x.firstMessageIntroText}),x.toggleStateClasses()}))},initChatHideButton(){x.chatHideButtonText=x.chatHideButtonText||(0,d.getLang)("video_action_button_hide_chat"),x.VideoChatHideButtonComponent=C.VideoChatHideButtonComponent,x.VideoChatHideButtonComponent.init({btnText:x.chatHideButtonText}),x.chatHideButton=x.block?.querySelector("#video_chat_hide_button")||x.chatHideButton},checkFormHeight(){const e=x.replyForm;let t=e.offsetHeight;if(x.chatHideButton){t+=x.chatHideButton.offsetHeight}e.lastHeight!==t&&(e.lastHeight=t,(0,i.setStyle)(x.messagesWrap,{bottom:t+"px"}))},checkTextLen(e=x.replyInput){const t=(0,n.trim)(Emoji.editableVal(e));if(e.lastLen===t.length)return;if((e.lastLen=t.length)>mvcur.maxChatReplyLength){const t=cur.storyLayer?(0,d.getLang)("stories_live_chat_msg_too_long"):(0,d.getLang)("video_live_chat_msg_too_long");(0,r.showTooltip)(e,{black:1,text:t,shift:!!cur.storyLayer&&[-30,10]})}else window.tooltips&&tooltips.destroy(e)},stickerClick:(e,t,s)=>(window.stManager.add([window.jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.clickSticker(e,t,s)})),!1),getMessageAccessFlags(e,t){e=parseInt(e,10),t=parseInt(t,10);const{adminLevel:s,canDeleteComments:i,canPinComments:o}=Videoview.getMvData(),a=s>h.GroupAdminLevel.USER;let n=!1;window.replyAsList?.length&&(n=window.replyAsList.some((e=>e[0]===t)));const r=window.vk.id;return{canDeleteComment:a||!!i||e===r||t===r||n,canReportComment:e!==t&&t!==r&&!n,canPinComment:!!o}},receiveMessage(e,t,s,i,o,a,r,c,l,d,h,m){if((0,n.intval)(l))return void x.appendSticker(l,s);const{canDeleteComment:p,canReportComment:g,canPinComment:_}=x.getMessageAccessFlags(e,s);x.appendMessageRefactoring({id:t,author_id:Number(s),owner_id:Number(e),text:c,owner_href:a,photo_url:o,is_verified:h,owner_name:i,can_delete:!!p,can_report:1===Number(m)||!!g,can_pin:!!_,action_hash:x.options.chatActionHash})},receiveDelete(e,t){x.sendCustomEvent(f.CustomEventType.DELETE_MESSAGE,t)},checkStickerFlood(e,t){const s=mvcur.queueBatchId;x._stickersLimits&&x._stickersLimits.batch==s||(x._stickersLimits={batch:s,like:0,sticker:0},x._stickersDelay=0);const i="like"==e?"like":"sticker",o="like"==i?x.MAX_LIKES_PER_BATCH:x.MAX_STICKERS_PER_BATCH;return!(++x._stickersLimits[i]>o&&t!=vk.id)},appendSticker(e,t,s=!0){if(!x.isHidden()&&!Videoview.isFS&&"hidden"!=document.visibilityState&&"animation"in document.body.style&&"onanimationend"in window&&!this.prefersReducedMotion){if(t==vk.id){const t=x.recentlySentSticker;if(t&&t.stickerId==e&&t.fromQueue!=s&&Date.now()-t.time<3e3)return;x.recentlySentSticker={stickerId:e,fromQueue:s,time:Date.now()}}else if(!x.checkStickerFlood(e,t))return;if(!x.stickersCanvasWrap){const e=document.createElement("canvas");e.width=100,e.height=320,e.classList.add("mv_chat_stickers_wrap");const t=document.querySelector(".videoplayer")||document.querySelector(".LiveWebPlayer__content");t&&(t.append(e),x.stickersCanvasWrap=e)}x.stickerManager=x.stickerManager||new u.StickerManager(x.stickersCanvasWrap),x.stickerManager.add(e,"like"==e)}},appendStickersBatch(){const e=x._stickersBatch;if(e&&(x._stickersBatch=null,!x.isHidden())){if(!x.stickersWrap){const e=document.createElement("div");e.classList.add("mv_chat_stickers_wrap");const t=document.querySelector(".videoplayer");t&&(t.append(e),x.stickersWrap=e)}x.stickersWrap?.appendChild(e)}},removeStickers(){if(x.stickersWrap)for(let e;e=(0,i.domFC)(x.stickersWrap);)(0,a.removeEvent)(e),e.remove()},appendMessageRefactoring(e){x._messagesBatchData=x._messagesBatchData||[],e?.owner_name&&(e.owner_name=(0,k.decodeHTMLEntities)(e.owner_name)),x._messagesBatchData.push(e),x._messagesBatchData.length>x.MAX_COMMENTS_NUM&&(x._messagesBatchData=x._messagesBatchData.slice(Math.max(x._messagesBatchData.length-x.MAX_COMMENTS_NUM,0))),window.Videoview.isHighloadLive&&(x.isHidden()||window.Videoview.isFS||"hidden"===document.visibilityState)||x.sendBatchOfMessages()},sendBatchOfMessages(){!x._appendMessageTimeout&&x._messagesBatchData?.length&&(x._appendMessageTimeout=setTimeout((()=>{x.sendCustomEvent(f.CustomEventType.NEW_MESSAGES,x._messagesBatchData),x._messagesBatchData=[],x._appendMessageTimeout=null}),0))},sendCustomEvent(e,t={}){window.dispatchEvent(new CustomEvent(f.CustomEventName,{detail:{eventType:e,data:t}}))},appendMessage(e,t){const s=x._messagesBatch||(x._messagesBatch=document.createDocumentFragment()),i="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;if(x.messagesWrap.querySelector(i)||s.querySelector(i))return;const o=(0,w.createElementFromHTML)(e);[...o.querySelectorAll(".mv_chat_message_show_action_false")].forEach((e=>{e.parentNode.removeChild(e)})),s.appendChild(o);const a=s.childNodes;for(;s.childNodes.length>x.MAX_COMMENTS_NUM;)a[0].remove()},toggleScrollBottomBtn(e){(0,i.toggleClass)(this.scrollBottomBtnWrap,"hidden",!e)},scrollBottom(){window.VideoChat.sendCustomEvent(f.CustomEventType.SCROLL_BOTTOM),window.VideoChat.toggleScrollBottomBtn(!1)},replyAsAnimate(e,t,s){const o=e&&(0,i.geByClass1)("mv_chat_reply_author_photo",e),a=o&&(0,i.geByClass)("mv_chat_reply_author_photo_img",o),n=(0,i.hasClass)(e,"mv_chat_author_secondary")?0:1;a&&a[n]&&(a[n].src=s),(0,i.toggleClass)(e,"mv_chat_author_secondary")},replyAsGroup(e,t){window.replyAsList?x.replyAsGroupTT(e,t):(s._dG("replyAsList",[]),s._dG("replyAsData",{}),(0,i.domData)(e,"can_reply_as_any_group")?ajax.post("/al_groups.php?act=get_editor_clubs",{},{cache:1,onDone:function(i){s._dG("replyAsList",i),(0,n.each)(i,(function(e,[t,s,i,o]){window.replyAsData[t]=this})),x.replyAsGroupTT(e,t)}}):x.replyAsGroupTT(e,t))},replyAsGroupList(e,t,s){s?.[3]&&(s[3]=(0,k.decodeHTMLEntities)(s[3]));const o=[s];let a=(0,i.domByClass)(e,"mv_chat_reply_group_data");if(a){let e=[(0,i.domData)(a,"group_id"),(0,i.domData)(a,"group_photo"),(0,i.domData)(a,"group_href"),(0,i.domData)(a,"group_name")];o.push(e),window.replyAsData[e[0]]=e}return(0,n.each)(window.replyAsList,(function(e,[s,i,a,n]){s!=t&&o.push(this)})),o},replyAsGroupOver(e){const t=(0,i.gpeByClass)("mv_chat_reply_form",e);(0,r.showTooltip)(e,{text:function(){return(0,i.domData)(t,"from-oid")<0?(0,d.getLang)("global_on_behalf_group"):(0,d.getLang)("global_on_behalf_me")},black:1,shift:[9,8,8]})},replyAsGroupTT(e,t){const s=x.replyAsProfileData(),o=(0,i.gpeByClass)("mv_chat_reply_form",e),r=o&&(0,i.domData)(o,"from-oid");let c=(0,i.data)(e,"tt");if(!s)return!1;if(!c){const o=x.replyAsGroupList(e,t,s);let l="";(0,n.each)(o,(function(e,[t,s,i,o]){l+=(0,n.getTemplate)("video_chat_message_author_select_row",{author_id:t,author_href:i,author_photo:s,author_name:(0,k.escape)(o),classes:r==t?" active":""})})),c=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+l+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"top",offset:function(){return[0,-5]},onFirstTimeShow:function(t){const s=(0,i.geByClass)("post_from_tt_row",t);(0,n.each)(s,(function(t,s){(0,a.addEvent)(s,"click",x.setReplyAsGroup.pbind(e,{from:(0,i.domData)(this,"from-oid")}))})),this.rows=s,this.scroll=new uiScroll((0,i.geByClass1)("_post_scroll_wrap",t)),setTimeout((function(){c.scroll.update(),c.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(!c.scroll)return;const t=(0,i.geByClass1)("active",e),s=t?t.offsetTop-(c.scroll.data.viewportHeight-(0,i.getSize)(t)[1])/2:0;c.scroll.scrollTop(s)}),0)},onHide:function(e){}}),(0,i.data)(e,"tt",c)}t&&c.isShown()&&x.setReplyAsGroup(e,{from:r==vk.id?t:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),c.isShown()||c.show()},replyAsProfileData:()=>window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData,setReplyAsGroup(e,t){if(!e)return!1;const s=(0,i.domClosest)("mv_chat_reply_form",e),o=(0,i.data)(e,"tt"),a=t.from||(t.fromGroup?cur.oid:vk.id),r=a==vk.id?x.replyAsProfileData():window.replyAsData&&window.replyAsData[a];return!((0,i.domData)(s,"from-oid")==a||!r||r[0]!=a)&&((0,i.domData)(s,"from-oid",a),x.replyAsAnimate(s,r[2],r[1]),o&&o.rows&&(0,n.each)(o.rows,(function(){(0,i.toggleClass)(this,"active",(0,i.domData)(this,"from-oid")==a)})),e.setAttribute("aria-label",_.Ranges.isGroupId(a)?(0,d.getLang)("wall_reply_as_group"):(0,d.getLang)("wall_reply_as_user")),!1)},sendMessage(){if(x.messageSending)return;const e={Message:(0,n.trim)(Emoji.val(x.replyInput))};if(!e.Message)return void(0,i.elfocus)(x.replyInput);if(Date.now()-x.lastMsgSent<1e3)return window.tooltips&&tooltips.destroy(x.replyInput),void(0,r.showTooltip)(x.replyInput,{text:(0,d.getLang)("video_live_chat_too_fast"),black:1});const t=Videoview.getMvData(),s=(0,i.geByClass1)("mv_chat_reply_form",this.block);s&&(0,i.domData)(s,"from-oid")&&(e.from_oid=(0,i.domData)(s,"from-oid")),ajax.post("al_video.php?act=post_comment",(0,n.extend)(e,{video:t.videoRaw,hash:t.hash,videoviewer_chat:1,item_access_hash:mvcur.mvData.itemAccessHash,ref:"video_chat"}),{onDone:function(e,t,s){x.messageSending=!1,s?.[0]?x.appendMessageRefactoring(s[0]):e&&t&&x.appendMessage(e,t),Emoji.val(x.replyInput,""),x.checkFormHeight(),x.lastMsgSent=Date.now(),mvcur.player&&mvcur.player.vars.stats_tmr&&(0,c.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onFail:function(e){if(x.messageSending=!1,x.replyInput)return window.tooltips&&tooltips.destroy(x.replyInput),(0,r.showTooltip)(x.replyInput,{text:e,showdt:200,forcetodown:0,slide:15,black:1}),(0,i.elfocus)(x.replyInput),!0}}),x.messageSending=!0},sendSticker(e){const t=Videoview.getMvData();ajax.post("al_video.php?act=live_send_sticker",{sticker_id:e,owner_id:t.oid,video_id:t.vid,hash:t.hash,item_access_hash:mvcur.mvData.itemAccessHash},{onDone(){x.appendSticker(e,vk.id,!1)},onFail:t=>("action_disabled"===t&&x.appendSticker(e,vk.id,!1),!0)})},showActionsMenu(e,t){const s=(0,g.getMsgElement)(e,t),i=s?.querySelector(".mv_chat_message_actions");i.style.visibility="visible"},hideActionsMenu(e,t){const s=(0,g.getMsgElement)(e,t),i=s?.querySelector(".mv_chat_message_actions");i.style.visibility=""},hidePinnedMessage(){p.PinnedMessageComponent.init()},showPinnedMessage(e,t,s,i,o,a,n=!1,r=!1,c=!1,l=""){if(!l){const t=(0,g.getMsgElement)(e,a),s=t?.querySelector(".mv_chat_message_text");l=s?.innerHTML}p.PinnedMessageComponent.init({ownerId:e,commentId:a,text:l||"",authorId:t,authorName:s,authorHref:i,authorVerified:o,canUnpin:n,canDelete:r,canReport:c})},deleteMessage(e,t){ajax.post("al_video.php?act=delete_comment",{comment:e,hash:t,videoview_chat:1,ref:"video_chat"},{onDone(t){const{itemId:s}=(0,y.splitRawId)(e);s&&x.sendCustomEvent(f.CustomEventType.DELETE_MESSAGE,{msgId:s,stubText:t});document.querySelector(`#pinned_message${e}`)&&x.hidePinnedMessage()}})},showReportVideoChatCommentForm(e,t){(0,l.showReportForm)("video_comment",e,t,(()=>{const s=(0,g.getMsgElement)(e,t);s&&(s.classList.add("_deleted"),s.classList.add("_show_deleted_stub"),(0,i.val)((0,i.domByClass)(s,"mv_chat_message_content"),(0,d.getLang)("global_report_sent")))}))},pinMessage(e,t,s,i,o,a,n,r,c){(0,m.api)("video.pinComment",{owner_id:e,comment_id:a}).then((()=>{x.showPinnedMessage(e,t,s,i,o,a,!0,n,r,c)}))},unpinMessage(e,t){(0,m.api)("video.unpinComment",{owner_id:e,comment_id:t}).then((()=>{x.hidePinnedMessage()}))},isHidden(){return!!this.hidden||Videoview.isMinimized()},isChatBlockInitialized(){return Boolean(this.block)},setHidden(e){this.hidden=e},toggle(){const e=x.isHidden();this.setHidden(!e),x.toggleStateClasses(),e||x.removeStickers(),window.Videoview.isHighloadLive&&e&&(x.sendBatchOfMessages(),window.Videoview.queueReconnect())},onFullscreenChange(e){window.VideoChat.onResize(),window.Videoview.isHighloadLive&&!e&&(x.sendBatchOfMessages(),window.Videoview.queueReconnect())},toggleStateClasses(){const e=!!this.block,t=x.isHidden(),s=Videoview.isMinimized();(0,i.toggleClass)("mv_box","_has_chat",e&&!s),(0,i.toggleClass)("mv_box","_hide_chat",e&&!s&&t);let o="";e&&(x.sendBatchOfMessages(),o=t?(0,d.getLang)("video_aria_expand_chat"):(0,d.getLang)("video_aria_minimize_chat"));(0,i.ge)("mv_top_pl_toggle")&&(0,i.attr)("mv_top_pl_toggle","aria-label",o)},onResize(){x.block&&(x._chatHeight=x.block.offsetHeight)},getHeight:()=>x.block?x._chatHeight||(x._chatHeight=x.block.offsetHeight):0,destroy(){if(x.block){if(x.replyForm){const e=(0,i.data)(x.replyForm,"optId");void 0!==e&&Emoji.destroy(e),(0,i.removeData)(x.replyForm),(0,i.removeData)(x.replyInput),x.replyForm=x.replyInput=null}x.removeStickers(),(0,i.removeData)(x.block),x.block.remove(),x.block=null,x.messagesWrap=null,x.stickersWrap=null,v.VideoChatComponent.destroy(),x._messagesBatchData=null,x.stickersCanvasWrap=null,x.stickerManager?.destroy(),x.options=null,clearTimeout(x._appendMessageTimeout),clearTimeout(x._appendStickerTimeout),x._appendMessageTimeout=null,x._appendStickerTimeout=null,x._messagesBatch=null,x.firstMsgIntro=null,x.messageSending=!1,x.toggleStateClasses()}}}},404939:(e,t,s)=>{s.d(t,{getImageIsomorphic:()=>o});var i=s(744757);const o=({images:e,width:t=0,height:s,isRetina:o=!1})=>{if(!e||0===e.length)return"";const a=o?2:1,n=t*a,r=("number"==typeof s?s:t)*a,c=[...e];(0,i.sort)(c,((e,t)=>e.height<t.height?-1:e.height>t.height?1:e.width<t.width?-1:e.width>t.width?1:0));for(let e=0;e<c.length;e++)if(c[e].width>=n&&c[e].height>=r)return c[e];return c[c.length-1]}},744757:(e,t,s)=>{function i(e,t){return e.sort(t)}function o(e){return Array.isArray(e)}s.d(t,{isArray:()=>o,sort:()=>i})},3171:(e,t,s)=>{s.d(t,{ANALYTICS_SCREEN_OTHER:()=>a,ANALYTICS_SCREEN_SETTINGS:()=>o,GroupAdminLevel:()=>i});const i={USER:0,MODERATOR:1,EDITOR:2,ADMINISTRATOR:3,HOST:4,EVENT_CREATOR:5,CREATOR:6,PSEUDO_LEVEL_ADVERTISER:100},o="settings",a="other"},591485:(e,t,s)=>{s.d(t,{getOwnerAvatar:()=>a});var i=s(404939),o=s(898848);const a=e=>{if(e){if("photo"in e){if((0,o.isArray)(e.photo)){const t=(0,i.getImageIsomorphic)({images:e.photo,width:50,isRetina:(0,o.isRetina)()});return t&&t.url||""}return e.photo||""}if("photo_100"in e&&"photo_100"in e)return(0,o.isRetina)()?e.photo_100||e.photo_50||"":e.photo_50||""}return""}},895461:(e,t,s)=>{s.d(t,{StickerManager:()=>n});var i=s(898848),o=s(857656),a=s(819501);class n{add(e,t=!1){if(this.stickers.length>8)return;const s=new Image;s.onload=()=>{this.stickers.push({img:s,id:e,x:t?this.likeStartX:this.stickerStartX,y:t?this.startY-60:this.startY,isLike:t,startTime:Date.now()+(0,i.irand)(0,600),speed:(0,i.irand)(2,3),size:t?20:64,scale:t?2:1,opacity:t?.8:0,rotateDegree:(0,i.irand)(0,4),rotateDirection:Math.random()<.5?-1:1}),this.drawNextFrame()},s.src=t?"data:image/svg+xml; charset=utf8, "+encodeURIComponent((0,a.getIcon20LikeCircleFillRed)().icon):o.Stickers.getStickerUrl(e,((0,i.isRetina)()?128:64)+"b")}drawSticker(e){if(e.startTime>Date.now()||!this.ctx)return;if(e.isLike&&(e.scale=2),e.y<=this.startY&&e.y>=this.startY-25){const t=e.opacity+.15;if(e.opacity=Math.min(t,1),!e.isLike){const t=e.scale+.04;e.scale=Math.min(t,1)}}else if(e.y>=this.endY&&e.y<=this.endY+25){const t=e.opacity-.15;e.opacity=Math.max(t,0)}const t=e.size*e.scale,s=1===e.scale?e.x:e.x+(e.size-t)/2;e.rotateDegree+=.1*e.rotateDirection,e.rotateDegree<0?(e.rotateDegree=0,e.rotateDirection*=-1):e.rotateDegree>4&&(e.rotateDegree=4,e.rotateDirection*=-1),e.y-=e.speed,this.ctx&&(this.ctx.globalAlpha=e.opacity),this.ctx.setTransform(e.scale,0,0,e.scale,s,e.y),this.ctx.rotate(e.rotateDegree*Math.PI/180),this.ctx.drawImage(e.img,s,e.y),this.ctx&&(this.ctx.globalAlpha=1)}drawNextFrame(){this.isRendering||(this.isRendering=!0,this.rAF=requestAnimationFrame(this.animate))}destroy(){this.rAF&&(cancelAnimationFrame(this.rAF),this.rAF=null)}constructor(e){this.stickers=[],this.endY=32,this.isRendering=!1,this.scaleRatio=1,this.animate=()=>{this.ctx&&(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvasWidth*this.scaleRatio,this.canvasHeight*this.scaleRatio),this.stickers=this.stickers.filter((e=>e.y>this.endY)),this.stickers.forEach((e=>{this.drawSticker(e)})),this.isRendering=!1,this.stickers.some((e=>e.y>this.endY))?this.drawNextFrame():(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvasWidth*this.scaleRatio,this.canvasHeight*this.scaleRatio)))},this.ctx=e.getContext("2d"),this.canvasWidth=e.width,this.canvasHeight=e.height,this.stickerStartX=(this.canvasWidth-64)/2,this.likeStartX=this.canvasWidth-20-20,this.startY=this.canvasHeight-64,this.ctx&&(0,i.isRetina)()&&(this.scaleRatio=window.devicePixelRatio||1,this.ctx.canvas.width=this.canvasWidth*this.scaleRatio,this.ctx.canvas.height=this.canvasHeight*this.scaleRatio,this.ctx.canvas.style.width=`${this.canvasWidth}px`,this.ctx.canvas.style.height=`${this.canvasHeight}px`,this.ctx.scale(this.scaleRatio,this.scaleRatio))}}},552849:(e,t,s)=>{s.d(t,{VideoChat:()=>k});var i=s(474848),o=s(296540),a=s(651220),n=s(468298),r=s(724648),c=s(720836),l=s(865708),d=s(15978),h=s(744440),m=s(783856),p=s(279734),g=s(612196),_=s(373080),u=s(351118),v=s(753072),f=s(420707),w=s(386635),C=s(274233),y=s(648277);const k=({messages:e=[],firstMessageIntroText:t})=>{const[s,k]=(0,o.useState)(e),[S,x]=(0,o.useState)(!1),[M,E]=(0,o.useState)(!1),[T,A]=(0,o.useState)(0),[I,b]=(0,o.useState)(null),R=(0,o.useRef)(null),D=e=>{e.scrollToIndex(1e3,{align:"end",behavior:"auto"}),E(!1),x(!1)},B=(0,a.useVirtualizer)({count:s.length,overscan:5,estimateSize:()=>36,getScrollElement:()=>R.current,paddingStart:T,onChange:e=>{const{isScrolling:t,scrollDirection:s,getTotalSize:i,scrollElement:o}=e;if(!o)return;const a=i(),n=o.clientHeight+o.scrollTop+30<a;M&&n&&window.VideoChat?.toggleScrollBottomBtn(!0),t&&"backward"===s&&o.clientHeight+o.scrollTop!==a?x(!0):(o.clientHeight+o.scrollTop===a&&(x(!1),E(!1),window.VideoChat?.toggleScrollBottomBtn(!1)),S||D(B))}});if((0,o.useEffect)((()=>{let e;return I&&(e=setTimeout((()=>{b(null)}),1e3)),()=>{clearTimeout(e)}}),[I]),(0,o.useEffect)((()=>{const e=e=>{const{eventType:t}=e.detail;switch(t){case f.CustomEventType.NEW_MESSAGES:const t=e.detail.data;k((e=>{let s=[...e,...t];s=(0,C.removeDuplicateById)(s);const i=document.querySelector(".mv_chat_messages_wrap")?.getBoundingClientRect().height??0,o=R?.current,a=Math.ceil((o?.scrollHeight??0)-i)===o?.scrollTop,n=Math.max(s.length-50,0);return n>0&&a&&(s=s.slice(n)),s})),E(!0),B.notify();break;case f.CustomEventType.DELETE_MESSAGE:const{msgId:i,stubText:o}=e.detail.data,a=s.findIndex((e=>e.id===String(i)));-1!==a&&(k((e=>e.map(((e,t)=>t===a?{...e,text:o,deleted:!0}:e)))),S||D(B),B.notify());break;case f.CustomEventType.SCROLL_BOTTOM:D(B);break;case f.CustomEventType.HIGHLIGHT_MESSAGE:const n=e.detail.data,r=s.findIndex((e=>e.id===String(n)));-1!==r&&(B.scrollToIndex(r,{align:"end",behavior:"auto"}),b(s[r].id));break;case f.CustomEventType.UPDATE_TOP_PADDING:A(e.detail.data)}};return window.addEventListener(f.CustomEventName,e),()=>{window.removeEventListener(f.CustomEventName,e)}}),[s,S]),(0,o.useEffect)((()=>{s.length&&D(B)}),[]),!s.length)return(0,i.jsx)(r.Flex,{noWrap:!0,className:v.default.stub,children:(0,i.jsx)(c.Placeholder,{icon:(0,i.jsx)(n.Icon56CommentsOutline,{}),children:t})});const L=B.getVirtualItems();return(0,i.jsx)(l.AppRootProvider,{children:(0,i.jsx)(d.AppearanceProvider,{value:"dark",children:(0,i.jsx)(h.CustomScrollView,{boxRef:R,children:(0,i.jsx)("div",{className:v.default.in,style:{height:B.getTotalSize()},children:L.map((({key:e,index:t,start:o})=>{const{owner_href:a,photo_url:n,text:c,can_delete:l,can_report:d,can_pin:h,deleted:f}=s[t];return(0,i.jsxs)(m.Overlay,{placement:"top",stretch:!0,Component:r.Flex,noWrap:!0,align:"start","data-index":t,getRootRef:B.measureElement,className:(0,u.classNames)(v.default.message,s[t].id===I&&v.default.messageHighlight),style:{transform:`translateY(${o}px)`},children:[(0,i.jsx)(p.Link,{href:a,target:"_blank",children:(0,i.jsx)(g.Avatar,{src:n,size:24,loading:"lazy"})}),(0,i.jsxs)(r.Flex.Item,{flex:"content",flexBasis:0,className:(0,u.classNames)(v.default.messageContent,f&&v.default.deleteMessageContent),children:[!f&&(0,i.jsx)(y.VideoChatOwnerName,{message:s[t]}),(0,i.jsx)(_.InnerHTML,{className:v.default.messageText,Component:"span",children:c})]}),!f&&(l||h||d)&&(0,i.jsx)(w.VideoChatMessageActions,{message:s[t]})]},e)}))})})})})}},386635:(e,t,s)=>{s.d(t,{VideoChatMessageActions:()=>u});var i=s(474848),o=s(757295),a=s(380977),n=s(518710),r=s(56188),c=s(866467),l=s(724648),d=s(507852),h=s(578392),m=s(271036),p=s(538522),g=s(753072);const _=e=>(0,i.jsx)(l.Flex.Item,{...e,flex:"fixed"}),u=({message:e})=>{const{id:t,owner_id:s,author_id:u,owner_href:v,owner_name:f,is_verified:w,text:C,can_delete:y,can_report:k,can_pin:S,action_hash:x}=e,M=()=>{window.VideoChat?.pinMessage(s,u,f,v,w,t,y,k,C)},E=()=>{window.VideoChat?.deleteMessage((0,p.joinRawId)({ownerId:s,itemId:Number(t)}),x)},T=()=>{window.VideoChat?.showReportVideoChatCommentForm(s,t)};return[S,y,k].filter(Boolean).length>1?(0,i.jsx)(l.Flex,{noWrap:!0,Component:_,className:g.default.messageActions,children:(0,i.jsx)(d.DropdownActionSheet,{placement:"bottom-start",content:(0,i.jsxs)(i.Fragment,{children:[S&&(0,i.jsx)(d.DropdownActionSheet.Item,{type:"contrast",onClick:M,before:(0,i.jsx)(o.Icon20PinOutline,{}),children:(0,c.getLang)("video_pin_message")}),y&&(0,i.jsx)(d.DropdownActionSheet.Item,{type:"contrast",onClick:E,before:(0,i.jsx)(a.Icon20Cancel,{}),children:(0,c.getLang)("global_delete")}),k&&(0,i.jsx)(d.DropdownActionSheet.Item,{type:"contrast",onClick:T,before:(0,i.jsx)(n.Icon20ReportOutline,{}),children:(0,c.getLang)("global_report_spam")})]}),children:(0,i.jsx)(r.Icon20More,{})})}):(0,i.jsx)(l.Flex,{noWrap:!0,Component:_,className:g.default.messageActions,children:(0,i.jsxs)(i.Fragment,{children:[S&&(0,i.jsx)(h.TextTooltip,{text:(0,c.getLang)("video_pin_message"),placement:"right",children:(0,i.jsx)(m.IconButton,{noPadding:!0,activeMode:"opacity",hoverMode:"opacity",onClick:M,children:(0,i.jsx)(o.Icon20PinOutline,{})})}),y&&(0,i.jsx)(h.TextTooltip,{text:(0,c.getLang)("global_delete"),placement:"right",children:(0,i.jsx)(m.IconButton,{noPadding:!0,activeMode:"opacity",hoverMode:"opacity",onClick:E,children:(0,i.jsx)(a.Icon20Cancel,{})})}),k&&(0,i.jsx)(h.TextTooltip,{text:(0,c.getLang)("global_report_spam"),placement:"right",children:(0,i.jsx)(m.IconButton,{noPadding:!0,activeMode:"opacity",hoverMode:"opacity",onClick:T,children:(0,i.jsx)(n.Icon20ReportOutline,{})})})]})})}},648277:(e,t,s)=>{s.d(t,{VideoChatOwnerName:()=>d});var i=s(474848),o=s(286347),a=s(699032),n=s(279734),r=s(336150),c=s(546642),l=s(753072);const d=({message:e})=>{const{owner_id:t,author_id:s,owner_href:d,owner_name:h,is_verified:m}=e,p=s===t,g=p?l.default.adminOwnerName:l.default.ownerName,_=(0,i.jsx)(i.Fragment,{children:m?(0,i.jsx)(a.VerifiedLabel,{href:d,target:"_blank",children:(0,i.jsx)("span",{className:g,children:h})}):(0,i.jsx)(n.Link,{href:d,target:"_blank",children:(0,i.jsx)("span",{className:g,children:h})})});return p?(0,i.jsx)("span",{className:l.default.adminOwnerNameWrapper,children:(0,i.jsxs)(r.ContentBadge,{capsule:!0,appearance:"accent-tint",size:"m",children:[(0,i.jsx)(c.EllipsisText,{maxLines:1,maxWidth:180,children:_}),(0,i.jsx)(r.ContentBadge.IconSlot,{children:(0,i.jsx)(o.Icon12Favorite,{})})]})}):_}},420707:(e,t,s)=>{s.d(t,{CustomEventName:()=>i,CustomEventType:()=>o});const i="VideoCustomEvent/CHAT_UPDATE";var o=function(e){return e.NEW_MESSAGES="NEW_MESSAGES",e.DELETE_MESSAGE="DELETE_MESSAGE",e.SCROLL_BOTTOM="SCROLL_BOTTOM",e.HIGHLIGHT_MESSAGE="HIGHLIGHT_MESSAGE",e.UPDATE_TOP_PADDING="UPDATE_TOP_PADDING",e}({})},337213:(e,t,s)=>{s.d(t,{VideoChatHideButton:()=>d});var i=s(474848),o=s(296540),a=s(351118),n=s(865708),r=s(15978),c=s(783856),l=s(102855);const d=({btnText:e})=>{const t=(0,o.useCallback)((0,a.debounce)((e=>window.Videoview?.toggleSideBlock?.(e)),100),[]);return(0,i.jsx)(n.AppRootProvider,{children:(0,i.jsx)(r.AppearanceProvider,{value:"dark",children:(0,i.jsx)(c.Overlay,{Component:"button",placement:"bottom",stretch:!0,className:l.default.button,onClick:t,id:"video_chat_hide_button",children:e})})})}},306979:(e,t,s)=>{s.d(t,{VideoChatHideButtonComponent:()=>c});var i=s(384483),o=s(337213),a=s(142278);const n="VideoChatHideButton";let r;const c={init:function(e){(0,i.getReactRootEl)(n)&&(r=(0,a.createReactInitiator)(o.VideoChatHideButton,(0,i.getReactRootEl)(n)),r.render(e))},destroy:function(){r?.unmount?.()}}},540667:(e,t,s)=>{s.d(t,{VideoChatComponent:()=>r});var i=s(384483),o=s(552849),a=s(142278);let n;const r={init:function(e){n=(0,a.createReactInitiator)(o.VideoChat,(0,i.getReactRootEl)("VideoChat")),n.render(e)},destroy:function(){n?.unmount()}}},736290:(e,t,s)=>{s.d(t,{APP_NAME:()=>o,PinnedMessageComponent:()=>a});var i=s(384483);const o="PinnedMessage";const a={init:function(e){(0,i.initReactApplication)(o,e||{})}}},312587:(e,t,s)=>{s.d(t,{formatMessages:()=>m,getMsgElement:()=>h});var i=s(468073),o=s(33305),a=s(898848),n=s(148636),r=s(839348),c=s(641495),l=s(591485),d=s(856289);const h=(e,t)=>document.querySelector(`#mv_chat_msg${e}_${t}`),m=(e,t,{items:s,profiles:h,groups:m})=>{let p=[];return s.length&&s.reverse().forEach((s=>{const g=s.from_id,_=i.Ranges.isGroupId(g)?m.find((e=>e.id===i.Ranges.convertOwnerIdToGroupId(g))):h.find((e=>e.id===g));if(_&&window.VideoChat){const{canDeleteComment:i,canReportComment:h,canPinComment:m}=window.VideoChat.getMessageAccessFlags(e,g);let u=(0,a.clean)(s.text.replace(/\s\s+/g," ").replace(/\s/g," "));u=(0,n.replaceHyperLinks)(u,n.linksReplacer),u=(0,r.replaceMentions)(u,((...e)=>e[4]));const v={id:String(s.id),action_hash:t,author_id:g,can_delete:i,can_pin:m,can_report:h,is_verified:Boolean(_.verified),owner_href:(0,d.isVideoStandalone)()?(0,d.getOwnerVideosPageURL)(_):(0,o.getOwnerHref)(_),owner_id:e,owner_name:(0,c.getOwnerName)(_),photo_url:(0,l.getOwnerAvatar)(_),text:u};p.push(v)}})),p}},274233:(e,t,s)=>{s.d(t,{removeDuplicateById:()=>i});const i=e=>{const t=new Set;return e.reduce(((e,s)=>{const i=s.id;return t.has(i)||e.push(s),t.add(i),e}),[])}},753072:(e,t,s)=>{s.d(t,{default:()=>i});const i={in:"VideoChat__in--6xYeY",message:"VideoChat__message--dF3dY",messageHighlight:"VideoChat__messageHighlight--4aw6W",messageContent:"VideoChat__messageContent--QWbTM",deleteMessageContent:"VideoChat__deleteMessageContent--StjNv",ownerName:"VideoChat__ownerName--xCUHI",adminOwnerName:"VideoChat__adminOwnerName--Terkn",adminOwnerNameWrapper:"VideoChat__adminOwnerNameWrapper--kVv9W",messageText:"VideoChat__messageText--1vEZC",messageActions:"VideoChat__messageActions--R8AFh",stub:"VideoChat__stub--aEmtA"}},102855:(e,t,s)=>{s.d(t,{default:()=>i});const i={button:"VideoChatHideButton__button--ZI94z"}},757295:(e,t,s)=>{s.d(t,{Icon20PinOutline:()=>a});var i=s(474848),o=(s(296540),s(506447));const a=e=>(0,i.jsx)(o.SvgIconRootV2,{viewBox:"0 0 20 20",width:20,height:20,vkuiIconId:"pin_outline_20",vkuiProps:e,children:(0,i.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,i.jsx)("path",{d:"M0 0h20v20H0z"}),(0,i.jsx)("path",{fill:"currentColor",fillRule:"nonzero",d:"M11.332 2.604a.75.75 0 0 1 1.266-.384l5.182 5.183a.75.75 0 0 1-.383 1.265l-1.54.308a.3.3 0 0 0-.152.082l-2.463 2.463a.3.3 0 0 0-.086.187l-.297 3.858a1.012 1.012 0 0 1-1.724.638l-3.139-3.139-4.716 4.716a.75.75 0 0 1-1.133-.977l.073-.084 4.715-4.716-3.139-3.138a1.01 1.01 0 0 1-.084-1.336l.084-.095c.171-.171.397-.275.638-.294l3.859-.296a.3.3 0 0 0 .187-.086l2.463-2.464a.3.3 0 0 0 .081-.151Zm1.196 1.668-.033.166c-.07.348-.24.667-.491.918L9.54 7.819a1.8 1.8 0 0 1-1.133.521l-2.801.216 5.837 5.837.216-2.8c.03-.374.174-.729.413-1.015l.108-.118 2.464-2.463c.25-.251.57-.422.918-.492l.165-.033z"})]})})},468298:(e,t,s)=>{s.d(t,{Icon56CommentsOutline:()=>a});var i=s(474848),o=(s(296540),s(506447));const a=e=>(0,i.jsx)(o.SvgIconRootV2,{viewBox:"0 0 56 56",width:56,height:56,vkuiIconId:"comments_outline_56",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,i.jsx)("path",{fill:"currentColor",d:"m27.234 42.143.965 1.149zm-10.09 8.477-.966-1.149zM8.5 15a1.5 1.5 0 0 0 0-3zm20.895 20.672-.965 1.148zm9.462 7.948.965-1.149zM5 36.5v-18H2v18zm9.5 3.5h-6v3h6zm2.5 9.854V42.5h-3v7.354zm9.27-8.86-10.092 8.477 1.93 2.297 10.091-8.476zm1.93 2.298c.223-.189.507-.292.8-.292v-3c-.999 0-1.966.352-2.73.995zM14 49.854c0 2.124 2.482 3.28 4.108 1.914l-1.93-2.297a.5.5 0 0 1 .822.383zM14.5 43a.5.5 0 0 1-.5-.5h3a2.5 2.5 0 0 0-2.5-2.5zM2 36.5A6.5 6.5 0 0 0 8.5 43v-3A3.5 3.5 0 0 1 5 36.5zm3-18A3.5 3.5 0 0 1 8.5 15v-3A6.5 6.5 0 0 0 2 18.5zM46.5 5h-28v3h28zM12 11.5v18h3v-18zm41 18v-18h-3v18zM41.5 36h5v-3h-5zm.5 6.854V35.5h-3v7.354zM18.5 36h7.679v-3H18.5zm9.93.82 9.462 7.948 1.93-2.297-9.463-7.948zM26.179 36a3.5 3.5 0 0 1 2.25.82l1.93-2.297A6.5 6.5 0 0 0 26.18 33zM39 42.854a.5.5 0 0 1 .822-.383l-1.93 2.297c1.626 1.366 4.108.21 4.108-1.914zM41.5 33a2.5 2.5 0 0 0-2.5 2.5h3a.5.5 0 0 1-.5.5zm8.5-3.5a3.5 3.5 0 0 1-3.5 3.5v3a6.5 6.5 0 0 0 6.5-6.5zm-38 0a6.5 6.5 0 0 0 6.5 6.5v-3a3.5 3.5 0 0 1-3.5-3.5zM18.5 5a6.5 6.5 0 0 0-6.5 6.5h3A3.5 3.5 0 0 1 18.5 8zm28 3a3.5 3.5 0 0 1 3.5 3.5h3A6.5 6.5 0 0 0 46.5 5z"})})}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/18e337aa.d5bd02f2.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/web/chunks/18e337aa.d5bd02f2.js",e),e}