try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[75656],{35531:(e,t,s)=>{s.d(t,{j:()=>n});var o=s(331635),i=s(42107),r=s(349785);class n{log({screen:e,elementName:t}){this.statlog.send({name:"feed_ui_degradation",value:"",keys:[e,t]})}constructor(e){this.statlog=e}}n=(0,o.Cg)([i.z8.container(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[void 0===r.R?Object:r.R])],n)},373478:(e,t,s)=>{s.d(t,{f:()=>h});var o=s(221020),i=s(201910),r=s(815287),n=s(26455),a=s(42107),u=s(849645),d=s(651253),c=s(35531);function l({children:e,fallback:t,onError:s}){const i=(0,a.NF)(),l=(0,r.useMemo)((()=>({metadata:i.resolve(u.e),logger:i.resolve(d.v),uiDegradationLogger:i.resolve(c.j)})),[i]),h=(0,r.useCallback)((e=>{s?.(e,l)}),[l,s]);return(0,o.Y)(n.t,{fallback:t,onError:h,children:e})}function h(e,{Fallback:t,onError:s}){function r(i){return(0,o.Y)(l,{fallback:t&&(0,o.Y)(t,{}),onError:(e,t)=>s?.(e,t,i),children:(0,o.Y)(e,{...i})})}return r.displayName=(0,i.G)("FeedErrorBoundary",e),r}},213350:(e,t,s)=>{s.d(t,{$:()=>i,N:()=>r});var o=s(3816);const i=(e,t,s)=>{if(!s)return new Error(`[${e}] ${t}`);const i=(0,o.U)(s),r=new Error(`[${e}] ${t}: ${i.message}`);return r.name=i.name,r.stack=i.stack,r},r=(e,t)=>i("FeedWidgetErrorBoundary",t,e)},91720:(e,t,s)=>{s.d(t,{N:()=>a});var o=s(42107),i=s(373478),r=s(201910),n=s(213350);const a=(e,t,{Fallback:s,name:a,getMetadataFromProps:u}={})=>(0,i.f)((0,o.jn)(e,t),{onError:(e,{metadata:s,logger:o,uiDegradationLogger:i},d)=>{const c=s.get().screen,l=a??(0,r.M)(t);o.log((0,n.N)(e,l),{metaData:{breadcrumb:{data:{screen:c,...u?.(d)}}}}),i.log({screen:c,elementName:l})},Fallback:s})},560527:(e,t,s)=>{s.d(t,{z:()=>h});var o=s(331635),i=s(327813),r=s(42107),n=s(245854),a=s(802872),u=s(236954),d=s(986146),c=s(735840),l=s(78023);class h{doOptimisticMutation(e){return(0,c.b)({mutations:this.mutations,...e})}getComment(e){const t=this.store.getComment(e);if(t)return t}mutateComment(e,t,s){const o=this.getComment(e);(0,n.h)(o,t,s)}updateComment(e,t){this.mutateComment(e,t)}updateCommentState(e,t){const s=this.getComment(e)?.state??"default";return this.mutateComment(e,{state:t}),()=>{(0,i.h5)((()=>{this.mutateComment(e,{state:s})}))}}updateCommentUiState(e,t){const s=this.getComment(e)?.uiState??"default";return this.mutateComment(e,{uiState:t}),()=>{(0,i.h5)((()=>{this.mutateComment(e,{uiState:s})}))}}setTemporaryActive(e){const t=this.getComment(e)?.uiState??"default";this.updateCommentUiState(e,"selected"),setTimeout((()=>this.updateCommentUiState(e,t)),1500)}updateCommentThreadMeta(e,t){this.mutateComment(e,{thread:(0,d.O)(t)})}replaceCommentThreadMeta(e,t){const s=this.getComment(e);s&&(0,i.hZ)(s,"thread",(0,d.O)(t))}updateCommentLikes(e,t){const s=this.getComment(e);if(!s)return;const{likes:o,originalLikesData:r}=(0,u.IY)(s.likes,t),n={...r,...o};let a,d;if(s.likesList){const{likesList:e,originalLikesListData:t}=(0,u.iF)({count:n.count,hasLike:Boolean(n.user_likes),likesList:s.likesList,userData:this.accountProfileInfoService.data?{id:this.accountProfileInfoService.data.id,photo_200:this.accountProfileInfoService.data.photo_200}:void 0});a={...s.likesList,...e},d=t}return(0,i.h5)((()=>{(0,i.hZ)(s,"likes",n),a&&(0,i.hZ)(s,"likesList",a)})),()=>{(0,i.h5)((()=>{(0,i.hZ)(s,"likes",r),d&&(0,i.hZ)(s,"likesList",d)}))}}updateCommentsOrder(e,t){const s=this.store.getCommentsOrderByPost(e),o=s.order;return(0,n.h)(s,{order:t}),()=>{(0,i.h5)((()=>{(0,n.h)(s,{order:o})}))}}updateCommentsMetaByPost(e,t){const s=this.store.getCommentsMetaByPost(e);(0,n.h)(s,t)}constructor(e,t){this.store=e,this.accountProfileInfoService=t,this.mutations=new Map,(0,i.l_)(this)}}h=(0,o.Cg)([r.z8.container(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[void 0===a.g?Object:a.g,void 0===l.W?Object:l.W])],h)},802872:(e,t,s)=>{s.d(t,{g:()=>u});var o=s(331635),i=s(327813),r=s(42107),n=s(986146),a=s(989078);class u{createCommentFromApi(e){return t=e,{...t,thread:(0,n.O)(t.thread),state:t.deleted?"deleted":"default",uiState:"default",rawId:a.u.comment(t),postRawId:a.u.commentPost(t),wallRawId:a.u.commentWall(t)};var t}addCommentToStore(e){const t=this.createCommentFromApi(e),s=e.thread?.items;return e.post_id||e.owner_id||!s?.[0]||(t.postRawId=a.u.commentPost(s[0]),t.post_id=s[0].post_id,t.owner_id=s[0].owner_id),this.commentsMap.set(t.rawId,t),s?.length&&s.forEach((e=>this.addCommentToStore(e))),t}addCommentsMetaByPost(e,t){this.commentsMetaByPostMap.set(e,t)}addCommentsOrderByPost(e,t){this.commentsOrderByPostMap.set(e,t)}setInitialCommentsIdsByPost(e,t){this._initialCommentsByPost.set(e,t)}getInitialCommentsByPost(e){const t=this._initialCommentsByPost.get(e);return t?this.getCommentsByIds(t):void 0}resetInitialCommentsByPost(){this._initialCommentsByPost=new Map}getComment(e){return this.commentsMap.get(e)}getThreadMeta(e){return this.getComment(e)?.thread}getCommentsByIds(e){return e.reduce(((e,t)=>{const s=this.getComment(t);return s&&e.push(s),e}),[])}getCommentsMetaByPost(e){return this.commentsMetaByPostMap.get(e)??{count:0}}getCommentsOrderByPost(e){return this.commentsOrderByPostMap.get(e)??{order:"smart",items:[]}}constructor(){this.commentsMap=new Map,this.commentsMetaByPostMap=new Map,this.commentsOrderByPostMap=new Map,this.replyMultiline=void 0,this._initialCommentsByPost=new Map,(0,i.l_)(this)}}u=(0,o.Cg)([r.z8.global(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[])],u)},989078:(e,t,s)=>{s.d(t,{u:()=>i});var o=s(144819);const i={comment:e=>(0,o.WO)({id:Number(e.id),ownerId:Number(e.from_id)}),commentPost:e=>(0,o.WO)({id:Number(e.post_id),ownerId:Number(e.owner_id)}),commentWall:e=>(0,o.WO)({id:Number(e.id),ownerId:Number(e.owner_id)}),replyComment:e=>(0,o.WO)({id:Number(e.reply_to_comment),ownerId:Number(e.reply_to_user)})}},986146:(e,t,s)=>{s.d(t,{O:()=>o});const o=(e={count:0})=>{const{items:t,...s}=e;return{...s,firstFromId:t?.[0]?.from_id}}},195578:(e,t,s)=>{s.d(t,{K:()=>v});var o=s(331635),i=s(327813),r=s(42107),n=s(144819),a=s(529275),u=s(245854),d=s(303134),c=s(794345),l=s(236954),h=s(651253),m=s(735840),p=s(78023),g=s(560527);class v{doOptimisticMutation(e){return(0,m.b)({mutations:this.mutations,...e})}getItem(e){const t=this.feedEntitiesStore.getItem(e);if(t)return t;this.errorLogger.log("Feed entity is missing")}getItemPost(e){const t=this.getItem(e);if(t){if((0,d.i4)(t))return t;this.errorLogger.log("item has an incorrect type")}}getItemPostOrVideo(e){const t=this.getItem(e);if(t){if((0,d.i4)(t)||(0,d.P4)(t))return t;this.errorLogger.log("item has an incorrect type")}}getItemMetaPost(e){const t=this.getItem(e);if(t){if((0,d.Xh)(t))return t;this.errorLogger.log("item has an incorrect type")}}mutateItem(e,t,s){const o=this.getItem(e);(0,u.h)(o,t,s)}mutateFeedPostItemRemoveCoOwnershipRequests(e,t){const s=this.getItemPost(e);s&&s.value.coowners&&s.value.coowners.requests&&s.value.coowners.requests.splice(s.value.coowners.requests.findIndex((e=>e.coowner_id===t)),1)}mutateFeedPostItemCoOwnerStatus(e,t,s){const o=this.getItemPost(e);if(!o)return;if(!o.value.coowners||!o.value.coowners.list)return;const i=o.value.coowners.list.findIndex((e=>e.owner_id===t));"rejected"!==s?-1===i?o.value.coowners.list.push({owner_id:t,status:void 0,is_current_user:!0,can_subscribe:!1,is_subscribed:!1}):o.value.coowners.list[i].status=s:-1!==i&&o.value.coowners.list.splice(i,1)}markAllApprovedCoOwnersAsPended(e){const t=this.getItemPost(e);if(!t)return;if(!t.value.coowners||!t.value.coowners.list)return;if(t.value.coowners.list[0].is_current_user)for(const[s,o]of t.value.coowners.list.entries())0!==s&&"approved"===o.status&&(o.status="pending",this.addCoOwnerRequest(e,o),this.removeFeedPostItemHeaderSource(e,o.owner_id));else this.errorLogger.log("Function has been called not by post owner")}addCoOwnerRequest(e,t){const s=this.getItemPost(e);s&&s.value.owner_id&&t.is_current_user&&"pending"===t.status&&s.value.coowners&&!s.value.coowners.requests?.find((e=>e.coowner_id===t.owner_id))&&(s.value.coowners.requests||(s.value.coowners.requests=[]),s.value.coowners.requests.push({coowner_id:t.owner_id,owner_id:s.value.owner_id,request_rejected_privacy_link:""}))}removeCoOwner(e,t){const s=this.getItemPost(e);s&&s.value.coowners&&s.value.coowners.list&&s.value.coowners.list.splice(s.value.coowners.list.findIndex((e=>e.owner_id===t)),1)}addFeedPostItemHeaderSource(e,t){const s=this.getItemPost(e);s&&(1===s.value.header?.title?.source_ids?.length&&s.value.header.title.source_ids.push(t),1===s.value.header?.photo?.source_ids?.length&&s.value.header.photo.source_ids.push(t))}addAnyIdFeedPostItemHeaderSource(e){const t=this.getItemPost(e);if(!t)return;const s=t.value.coowners?.list?.find(((e,t)=>0!==t&&(!e.status||"approved"===e.status)));s&&(1===t.value.header?.title?.source_ids?.length&&t.value.header.title.source_ids.push(s.owner_id),1===t.value.header?.photo?.source_ids?.length&&t.value.header.photo.source_ids.push(s.owner_id))}removeFeedPostItemHeaderSource(e,t){const s=this.getItemPost(e);s&&(s.value.header?.title?.source_ids?.length&&s.value.header.title.source_ids.splice(s.value.header.title.source_ids.findIndex((e=>e===t)),1),s.value.header?.photo?.source_ids?.length&&s.value.header.photo.source_ids.splice(s.value.header.photo.source_ids.findIndex((e=>e===t)),1))}togglePostPin(e){const t=this.getItemPost(e);t&&(t.value.is_pinned=t.value.is_pinned?0:1)}mutateFeedItemLikes(e,{likes:t,reactions:s,likesList:o}){const i=(e,{likes:t})=>{var s;(s=e).likes??(s.likes=structuredClone(c.Bq)),(0,u.h)(e,{likes:t})},r=(e,{likesList:t})=>{var s;(s=e).likesList??(s.likesList=structuredClone(c.UA)),(0,u.h)(e,{likesList:t})},n=(e,{reactions:t})=>{var s;(s=e).reactions??(s.reactions=structuredClone(c.Lj)),t&&(e.reactions.count=t.count??e.reactions.count,-1===t.user_reaction?e.reactions.user_reaction=void 0:e.reactions.user_reaction=t.user_reaction??e.reactions.user_reaction,t.items&&(t.items.length&&(e.reactions.items.length=0),e.reactions.items.push(...t.items)))},a=this.getItem(e);if(a)if((0,d.P4)(a))i(a.value,{likes:t}),r(a,{likesList:o});else if((0,d.i4)(a))i(a.value,{likes:t}),n(a.value,{reactions:s}),r(a,{likesList:o});else if((0,d.bQ)(a)&&a.value.ads[0].post){const{post:e}=a.value.ads[0];i(e,{likes:t}),n(e,{reactions:s}),r(a,{likesList:o})}}mutateFeedMetaPostPhotoLikes(e,t,s){const o=this.getItemMetaPost(e);if(o)if("photo_tag"!==o.type){if("photo"===o.type||"wall_photo"===o.type){if(!o.value.photos||!o.value.photos.items)return void this.errorLogger.log(`cant find photo with id=${e} in photos.items`);const i=o.value.photos.items.findIndex((({id:e})=>e===t));if(-1===i)return void this.errorLogger.log(`cant find photo with id=${e} in photos.items to mutate it`);const r=o.value.photos.items[i].likes?.count??(s?1:0),n=o.value.photos.items[i].likes?.friend_ids??[];o.value.photos.items[i].likes={user_likes:s?1:0,count:s?r+1:r-1,friend_ids:n}}}else{if(!o.value?.photo_tags||!o.value.photo_tags.items)return void this.errorLogger.log("no photo_tags.items for mutation");const i=o.value.photo_tags.items.findIndex((({id:e})=>e===t));if(-1===i)return void this.errorLogger.log(`cant find photo with id=${e} in photo_tags.items to mutate it`);const r=o.value.photo_tags.items[i].likes?.count??(s?1:0);o.value.photo_tags.items[i].likes={user_likes:s?1:0,count:s?r+1:r-1}}}mutateFeedItemReactionOptimistically(e,t){const s=this.getItem(e);if(s)switch(s.type){case"post":return this.mutateFeedPostItemReactionOptimistically(e,t);case"post_ads":return this.mutateFeedItemPromoPostReactionOptimistically(e,t);case"video":return this.mutateFeedItemVideoLikesOptimistically(e);default:return}}mutateFeedItemReaction(e,{likes:t,reactions:s,likesList:o,reactionId:r,supportsReactions:n}){if(s&&t?.user_likes&&void 0!==r){const{reactions:t,originalReactionsData:o}=(0,l.Mg)(r,s);return this.mutateFeedItemLikes(e,{reactions:t}),()=>{(0,i.h5)((()=>{this.mutateFeedItemLikes(e,{reactions:o})}))}}{const{likes:a,originalLikesData:u}=(0,l.IY)(t),d={likes:a},c={likes:u};if(n){const{reactions:e,originalReactionsData:t}=(0,l.Mg)(u.user_likes?-1:r,s);d.reactions=e,c.reactions=t}const{likesList:h,originalLikesListData:m}=(0,l.iF)({count:a.count,likesList:o,hasLike:Boolean(a.user_likes),userData:this.accountProfileInfoService.data?{id:this.accountProfileInfoService.data.id,photo_200:this.accountProfileInfoService.data.photo_200}:void 0});return d.likesList=h,c.likesList=m,this.mutateFeedItemLikes(e,d),()=>{(0,i.h5)((()=>{this.mutateFeedItemLikes(e,c)}))}}}mutateFeedPostItemReactionOptimistically(e,t){const s=this.getItemPost(e);if(s)return this.mutateFeedItemReaction(e,{likes:s.value.likes,reactions:s.value.reactions,likesList:s.likesList,reactionId:t,supportsReactions:!0})}mutateFeedItemVideoLikesOptimistically(e){const t=this.getItem(e);if(t&&(0,d.P4)(t))return this.mutateFeedItemReaction(e,{likes:t.value.likes,likesList:t.likesList})}mutateFeedItemPromoPostReactionOptimistically(e,t){const s=this.getItem(e);if(!s||!(0,d.bQ)(s))return;const{post:o}=s.value.ads?.[0];return o?this.mutateFeedItemReaction(e,{likes:o.likes,reactions:o.reactions,likesList:s.likesList,reactionId:t,supportsReactions:!0}):void 0}mutateFeedItemState(e,t){const s=this.getItem(e);s&&((0,d.i4)(s)||(0,d.Xh)(s)||(0,d.P4)(s)?s.postState=t:((0,d.bQ)(s)||(0,d.Kh)(s))&&(0,d.L8)(t)&&(s.adState=t))}toggleComments(e){const t=this.getItem(e);t&&"comments"in t.value&&t.value.comments&&(t.value.comments.can_open=t.value.comments.can_open?0:1,t.value.comments.can_close=t.value.comments.can_close?0:1,this.commentsMutationService.updateCommentsMetaByPost(e,{can_post:Boolean(t.value.comments.can_close),show_reply_button:Boolean(t.value.comments.can_close)}))}incrementFeedItemViewsCount(e){const t=this.getItem(e);t?t.viewsCount?t.viewsCount+=t.viewsCount:t.viewsCount=1:this.errorLogger.log("mutateFeedItemViewsCount: no item")}mutateFeedPostItemBadges({ownerId:e,postId:t,badges:s}){const{counters:o}=s;if(!o)return void this.errorLogger.log("mutateBadgeCounters: no counters");const i=(0,n.WO)({ownerId:e,id:t}),r=this.getItem(i);if(!r)return void this.errorLogger.log("mutateBadgeCounters: no item");if(!(0,d.i4)(r))return void this.errorLogger.log("mutateBadgeCounters: not FeedPostItem");if(!r.value.badges)return void this.errorLogger.log("mutateBadgeCounters: item has no badges");if(!r.value.badges.counters)return void(r.value.badges.counters=o);const a=o.reduce(((e,t)=>(e.set(t.type,t),e)),new Map);r.value.badges.counters?.forEach((e=>{a.has(e.type)&&((0,u.h)(e,a.get(e.type)),a.delete(e.type))})),a.size&&r.value.badges.counters.push(...a.values())}mutateFeedPostItemCommentsCounter(e,t){const s=this.getItemPost(e);if(!s)return;const o=s.value.comments?.count??0;return"comments"in s.value&&s.value.comments&&(s.value.comments.count=t),()=>{(0,i.h5)((()=>{"comments"in s.value&&s.value.comments&&(s.value.comments.count=o)}))}}incrementFeedPostItemCommentsCounter(e,t){const s=this.getItemPost(e);if(!s)return;const o=s.value.comments?.count??0;return"comments"in s.value&&s.value.comments&&(s.value.comments.count=o+t),()=>{(0,i.h5)((()=>{"comments"in s.value&&s.value.comments&&(s.value.comments.count=o)}))}}constructor(e,t,s,o){this.accountProfileInfoService=e,this.feedEntitiesStore=t,this.commentsMutationService=s,this.errorLogger=o,this.mutations=new Map,(0,i.l_)(this)}}v=(0,o.Cg)([r.z8.container(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[void 0===p.W?Object:p.W,void 0===a.B?Object:a.B,void 0===g.z?Object:g.z,void 0===h.v?Object:h.v])],v)},529275:(e,t,s)=>{s.d(t,{B:()=>y});var o=s(331635),i=s(327813),r=s(42107);var n=s(144819);const a=e=>(0,n.WO)({id:Number(e.id),ownerId:Number(e.owner_id)}),u=e=>(0,n.WO)({id:e.date,ownerId:e.source_id}),d=e=>(0,n.WO)({id:Number(e.post_id),ownerId:Number(e.source_id)}),c=e=>(0,n.WO)({id:Number(e.post_id),ownerId:Number(e.source_id)}),l=e=>(0,n.WO)({id:e.date,ownerId:e.source_id}),h=e=>{const t="post"===e.ads[0]?.type?Number(e.ads[0].post?.id):e.ads_id1,s="post"===e.ads[0]?.type?Number(e.ads[0].post?.owner_id):e.ads_id2;return(0,n.WO)({id:t,ownerId:s})};var m=s(303134);var p=s(645189),g=s(651253),v=s(349785);const _=()=>(0,n.WO)({id:Math.random(),ownerId:Math.random()});var f=s(309910);class y{get debugConsole(){return(0,f.R)((()=>this.userEnv.partConfigEnabled("webinf_show_error_logs")),{prefix:"FeedUnsupportedItem:"})}createFeedItemFromApi(e,t=!0){const s=(({item:e,logError:t,generateRawId:s,features:o={}})=>{const i=e.type;switch(i){case"post":return(0,m.gB)(e)?{type:i,value:e,id:a(e),postState:"default",apiType:i}:void t(i);case"wall_photo":case"photo":return{type:i,value:e,id:u(e),postState:"default",apiType:i};case"photo_tag":return{type:i,value:e,id:l(e),postState:"default",apiType:i};case"user_rec":case"friends_recomm":case"recommended_groups":case"recommended_channels":case"videos_for_you":case"market_carousel":case"mini_apps_carousel":case"recommended_games_carousel":case"recommended_game":return{type:i,value:e,id:s(),apiType:i};case"ads":{if(!(0,m.id)(e)||!(e=>"post"===e?.ads?.[0]?.type||"web_sdk"===e?.ads?.[0]?.type)(e)&&!o.adsFilterDisabled)return void t(i);const s={type:"ads",value:e,id:h(e),adState:"default",apiType:i};return(0,m.Wj)(s)?{type:"post_ads",value:e,id:h(e),adState:"default",apiType:i}:s}case"video":case"clip":{const t=e,s="video"===i?t.video?.items?.[0]:t.clip?.items?.[0];if(!s)return;const o={can_like:s.can_like??0,count:s.likes?.count??0,user_likes:s.likes?.user_likes??1};return{type:"video",value:{...t,likes:o,type:i,id:s.id||0,owner_id:t.source_id,views:{count:s.views||s.local_views||0}},id:d({...t,post_id:s.id}),apiType:i,postState:"default"}}case"market":return{type:i,value:e,id:c(e),apiType:i};default:t()}})({item:e,logError:this.createLogError(e),generateRawId:_,features:{adsFilterDisabled:this.userEnv.partConfigEnabled("frontend.feed_spa_old_cub_support")||this.userEnv.partConfigEnabled("feed_spa_old_cub_support")}});if(s?.type)return t&&this.itemsMap.set(s.id,s),s}getItem(e){return this.itemsMap.get(e)}updateItemFromApi(e){return this.createFeedItemFromApi(e)}constructor(e,t,s){this.userEnv=e,this.errorLogger=t,this.statlog=s,this.itemsMap=new Map,this.createLogError=e=>t=>{const s=t?"feed_unsupported_item_subtypes":"feed_unsupported_item_types",o=t??e.type;this.statlog.send({name:s,value:"",keys:[o]}),this.debugConsole.debug(`${s}: type: ${o}, item data:`,e)},(0,i.l_)(this)}}y=(0,o.Cg)([r.z8.global(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[void 0===p.J?Object:p.J,void 0===g.v?Object:g.v,void 0===v.R?Object:v.R])],y)},767147:(e,t,s)=>{s.d(t,{f:()=>l});var o=s(331635),i=s(327813),r=s(42107),n=s(529275),a=s(651253),u=s(195578),d=s(416212),c=s(570440);class l{constructor(e,t,s,o,r){this.ownerService=e,this.errorLogger=t,this.feedEntitiesStore=s,this.feedReactionSetsStore=o,this.feedEntitiesMutationService=r,(0,i.l_)(this)}}l=(0,o.Cg)([r.z8.global(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[void 0===c.v?Object:c.v,void 0===a.v?Object:a.v,void 0===n.B?Object:n.B,void 0===d.k?Object:d.k,void 0===u.K?Object:u.K])],l)},303134:(e,t,s)=>{s.d(t,{Ei:()=>h,Kh:()=>c,L8:()=>l,P4:()=>u,Wj:()=>i,Xh:()=>d,bQ:()=>r,gB:()=>n,i4:()=>a,id:()=>o});const o=e=>"ads"===e.type,i=e=>o(e.value)&&"post"===e.value.ads?.[0].type,r=e=>"post_ads"===e.type&&"post"===e.value.ads?.[0].type,n=e=>"post"===e.type&&"inner_type"in e&&"wall_wallpost"===e.inner_type,a=e=>n(e.value),u=e=>"video"===e.type,d=e=>"photo"===e.type||"wall_photo"===e.type||"photo_tag"===e.type,c=e=>"ads"===e.type,l=e=>"default"===e||"adReport"===e||"reportFormSubmitted"===e||"notInterested"===e,h=e=>"likes"===e?.type&&"likes"in e},245854:(e,t,s)=>{s.d(t,{h:()=>i});const o=e=>{if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"===Object.prototype.toString.call(e)}return!1},i=(e={},t={},s={})=>{for(const r of Object.keys(t))Array.isArray(e[r])&&Array.isArray(t[r])?(s.mergeArrays||(e[r].length=0),e[r].push(...t[r])):o(e[r])&&o(t[r])?e[r]=i(e[r],t[r],s):e[r]=void 0===t[r]?s.overrideUndefined?t[r]:e[r]:t[r];return e}},735840:(e,t,s)=>{async function o({mutations:e,key:t,mutateApi:s,updateUi:o,updateUiValue:i,onSuccess:r,onError:n}){const a=e.get(t);"pending"===a?.status&&a.abortController.abort();const u=Symbol(),d=o(i),c=new AbortController;e.set(t,{abortController:c,status:"pending",undo:d,token:u});try{const o=await s(i,c.signal),n=e.get(t);if(n?.token!==u)return;return e.delete(t),r?.(o),o}catch(s){const o=e.get(t);if(o?.token!==u)return;o.undo?.(),e.delete(t),n?.(s)}}s.d(t,{b:()=>o})},416212:(e,t,s)=>{s.d(t,{k:()=>n});var o=s(331635),i=s(327813),r=s(42107);class n{getReactionSet(e){return this.reactionSets.get(e)}addReactionSet(e){this.reactionSets.set(e.id,e.items)}constructor(){this.reactionSets=new Map,(0,i.l_)(this)}}n=(0,o.Cg)([r.z8.global(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[])],n)},236954:(e,t,s)=>{s.d(t,{IY:()=>i,Mg:()=>r,iF:()=>n});var o=s(794345);const i=(e,t)=>{const s=structuredClone(e??o.Bq);return t?{likes:{count:Math.max(s.count+(s.group_liked?-1:1),0),group_liked:!s.group_liked},originalLikesData:s}:{likes:{count:Math.max(s.count+(s.user_likes?-1:1),0),user_likes:s.user_likes?0:1,can_like:s.can_like?0:1,author_liked:s.can_like_as_author?!s.author_liked:s.author_liked},originalLikesData:s}},r=(e,t)=>({reactions:{user_reaction:e},originalReactionsData:structuredClone(t??o.Lj)}),n=({count:e,hasLike:t,likesList:s=o.UA,userData:i})=>{const r=structuredClone(s??o.UA);let n=[];return n=t?i?[i,...s?.items]:[...s?.items]:s?.items.filter((e=>e.id!==i?.id)),{likesList:{count:e,items:n},originalLikesListData:r}}},570440:(e,t,s)=>{s.d(t,{v:()=>_});var o=s(331635),i=s(327813),r=s(42107),n=s(819300),a=s(626692),u=s(119872),d=s(725308),c=s(448264),l=s(266287),h=s(8439),m=s(150242),p=s(293023),g=s(651253),v=s(800191);class _{setUserGroupEntity(e,t){e?.forEach((e=>{this.usersStore.addToCache([e]),this.usersSubscribeService.setSubscriptionStatus(e.id,e.friend_status||m.h.NOT_A_FRIEND)})),t?.forEach((e=>{this.groupsProvider.createGroupFromApi({apiGroup:e})}))}provideUserGroupEntityById(e,t){if(e){if(d.z.isUserId(e))return this.provideUserEntityById(e,t);if(d.z.isGroupId(e)){const s=this.getGroupEntityByOwnerId(e);return s||t?s:void this.errorLogger.log(new Error(`The owner (group) is not found, id=${e}`))}}}provideUserEntityById(e,t){if(d.z.isUserId(e)){const s=this.getUserEntityById(e);return s||t?s:void this.errorLogger.log(new Error(`The owner (user) is not found, id=${e}`))}}getUserEntityById(e){if(d.z.isUserId(e))return this.usersStore.getCachedUsers({ids:[e]}).get(e)}getGroupEntityByOwnerId(e){if(d.z.isGroupId(e))return this.groupsProvider.getGroup(d.z.convertOwnerIdToGroupId(e))}getCachedUsers(e){return this.usersStore.getCachedUsers({ids:e})}getOwnerShortUrlById(e){const t=this.provideUserGroupEntityById(e);if(!t)return"";if(d.z.isUserId(e)){return t.screen_name}return d.z.isGroupId(e)?t.screen_name??"":""}getOwnerHrefById(e){const t=this.provideUserGroupEntityById(e);return t?(0,c.W)(t):""}getUserGroupPhotoSrc(e){const t=this.provideUserGroupEntityById(e);return t?(0,l.l)(t):""}getOwnerNameById(e,t=!0,s,o){const i=this.provideUserGroupEntityById(e,o);return(0,h.H)(i,t,s)}isMemberOrMembershipRequested(e){return d.z.isGroupId(e)?this.groupsSubscribeService.getIsMemberOrSentRequest(d.z.convertOwnerIdToGroupId(e)):!!d.z.isUserId(e)&&this.usersSubscribeService.getIsSubscribed(e)}isSubscribingOnOwnerById(e){return d.z.isGroupId(e)?this.groupsSubscribeService.getIsLoading(d.z.convertOwnerIdToGroupId(e)):!!d.z.isUserId(e)&&this.usersSubscribeService.getIsLoading(e)}toggleSubscriptionByOwnerId(e,t={}){d.z.isGroupId(e)&&this.groupsSubscribeService.toggle(d.z.convertOwnerIdToGroupId(e),{...t}),d.z.isUserId(e)&&this.usersSubscribeService.toggleSubscription({user_id:e,...t})}markStoryAsSeen(e){const t=this.provideUserGroupEntityById(e);if(!t)return;const s=[];if(d.z.isUserId(e)){const e=t;s.push({...e,has_unseen_stories:!1})}const o=[];if(d.z.isGroupId(e)){const e=t;o.push({...e,is_member:e.is_member?1:0,is_favorite:e.is_favorite?1:0,is_subscribed:e.is_subscribed?1:0,has_unseen_stories:!1})}this.setUserGroupEntity(s,o)}async getFirstStory(e){const{items:t}=await this.storiesApi.get({owner_id:e}),s=t?.[0]?.stories;if(s?.length)return s.find((e=>!e.seen))||s[0]}constructor(e,t,s,o,r,n){this.usersStore=e,this.errorLogger=t,this.groupsProvider=s,this.groupsSubscribeService=o,this.usersSubscribeService=r,this.storiesApi=n,(0,i.l_)(this)}}_=(0,o.Cg)([r.z8.container(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[void 0===p.S?Object:p.S,void 0===g.v?Object:g.v,void 0===n.s?Object:n.s,void 0===a.Y?Object:a.Y,void 0===u.H?Object:u.H,void 0===v.o?Object:v.o])],_)},293023:(e,t,s)=>{s.d(t,{S:()=>n});var o=s(331635),i=s(327813),r=s(42107);class n{getCachedUsers({ids:e=[]}){const t=new Map;return new Set(e).forEach((e=>{const s=this._cacheByIds.get(e);s&&t.set(e,s)})),t}addToCache(e){const t=new Map;return e.forEach((e=>{const s=e.id,o={...this._cacheByIds.get(s)||{},...e};t.set(s,o),this._cacheByIds.set(s,o)})),t}constructor(){this._cacheByIds=new Map,(0,i.l_)(this)}}n=(0,o.Cg)([r.z8.global(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[])],n)},561412:(e,t,s)=>{s.d(t,{X:()=>u});var o=s(327813),i=s(160010),r=s(3816);var n=s(386404),a=s(99677);class u{async fetch(e,t){let s=!1;const u=Symbol();this._requestToken=u;try{this.abortController&&(this._internalAbort=!0,this.abortController.abort("New request")),this._status="loading",this._error=void 0,this.abortController=new AbortController;const s=await this.request(e,this.abortController,{prefetch:!!t?.prefetch});let i;return s&&"data"in s?s.data&&(i=s.data):s&&(i=s),(0,o.h5)((()=>(this._requestToken===u&&(this._status="success",i&&"startFrom"in i?(this._startFrom=i.startFrom,this._offset=0):i&&"count"in i&&void 0!==i.count?(i.count>0?this._offset+=i.count:this._offset=0,this._startFrom=void 0):(this._offset=0,this._startFrom=void 0),i&&"count"in i&&(this._count=i.count)),this.doFinally(e,!1),s&&"onDone"in s&&s.onDone(),t?.onSuccess?t.onSuccess(i):i)))}catch(c){(this._internalAbort||c&&((d=c)&&"object"==typeof d&&"type"in d&&"string"==typeof d.type&&d.type===n.$.NETWORK_ERROR&&"error"in d&&d.error instanceof Error&&(0,a.E)(d.error)))&&(s=!0),(0,o.h5)((()=>{if(this._requestToken===u){this._status=s?"loading":"error",this.errorLogger.log(c);const o=function(e,t="Unknown error"){return(0,i.d)(e)?{...e,message:e.error?.error_msg,name:e.type}:(0,r.U)(e,t)}(c);this._error=o,this.doFinally(e,s),t?.onError?.(o)}}))}var d}doFinally(e,t){this._previousRequestParams=e,t||(this.abortController=void 0),this._internalAbort=!1}abort(){this.abortController&&(this.abortController.abort("Request state reset"),this._internalAbort=!0,this.abortController=void 0)}reset(){this.abort(),this._error=void 0,this._status="initial",this._startFrom=void 0,this._offset=0,this._requestToken=null,this._previousRequestParams=void 0}get cache(){return{error:this._error,status:this._status,startFrom:this._startFrom,offset:this._offset,requestToken:this._requestToken,previousRequestParams:this._previousRequestParams}}applyCache({error:e,status:t,startFrom:s,previousRequestParams:o,offset:i}){this.abort(),this._error=e,this._status="loading"===t?"success":t,this._startFrom=s,this._offset=i??0,this._requestToken=null,this._previousRequestParams=o}get error(){return this._error}get status(){return this._status}get startFrom(){return this._startFrom}get offset(){return this._offset}get previousRequestParams(){return this._previousRequestParams}clearRequestParams(){this._previousRequestParams=void 0,this._startFrom=void 0,this._offset=0}get allAvailableItemsLoaded(){return"success"===this._status&&!this._startFrom&&0===this._offset}get count(){return this._count}constructor(e,t){this.request=e,this.errorLogger=t,this._error=void 0,this._status="initial",this._offset=0,this._internalAbort=!1,this._requestToken=null,(0,o.l_)(this)}}},783292:(e,t,s)=>{s.d(t,{$:()=>n});var o=s(331635),i=s(820282),r=s(42107);class n extends i.S{get namespace(){return"donut"}constructor(...e){super(...e),this.getPaymentLink=this.makeMethod("getPaymentLink",!0),this.getInfo=this.makeMethod("getInfo",!0),this.getSubscription=this.makeMethod("getSubscription",!0),this.getSettings=this.makeMethod("getSettings"),this.setSettings=this.makeMethod("setSettings"),this.getBankCardLink=this.makeMethod("getBankCardLink"),this.setVisibilityInGroup=this.makeMethod("setVisibilityInGroup"),this.getSubscriptions=this.makeMethod("getSubscriptions"),this.changeSubscriptionAmount=this.makeMethod("changeSubscriptionAmount"),this.changeSubscriptionPeriod=this.makeMethod("changeSubscriptionPeriod"),this.getUnsubscribePopupData=this.makeMethod("getUnsubscribePopupData"),this.cancelSubscription=this.makeMethod("cancelSubscription"),this.revertUnsubscription=this.makeMethod("revertUnsubscription"),this.getPaymentAvailability=this.makeMethod("getPaymentAvailability"),this.getLevelCoverUploadServer=this.makeMethod("getLevelCoverUploadServer"),this.saveLevelCover=this.makeMethod("saveLevelCover"),this.getGoals=this.makeMethod("getGoals"),this.addGoal=this.makeMethod("addGoal"),this.editGoal=this.makeMethod("editGoal"),this.deleteGoal=this.makeMethod("deleteGoal"),this.completeGoal=this.makeMethod("completeGoal"),this.reorderGoals=this.makeMethod("reorderGoals"),this.getLevels=this.makeMethod("getLevels"),this.addLevel=this.makeMethod("addLevel"),this.editLevel=this.makeMethod("editLevel"),this.deleteLevel=this.makeMethod("deleteLevel"),this.beforeDeleteLevel=this.makeMethod("beforeDeleteLevel"),this.addLevelTrial=this.makeMethod("addLevelTrial"),this.closeLevelTrial=this.makeMethod("closeLevelTrial"),this.deleteLevelTrial=this.makeMethod("deleteLevelTrial"),this.editLevelTrial=this.makeMethod("editLevelTrial"),this.getLevelsTrials=this.makeMethod("getLevelsTrials"),this.checkCensoredValidate=this.makeMethod("checkCensoredValidate"),this.changeLevelSubscription=this.makeMethod("changeLevelSubscription"),this.getOneTimePayments=this.makeMethod("getOneTimePayments"),this.isDon=this.makeMethod("isDon"),this.getCountContentInherited=this.makeMethod("getCountContentInherited")}}n=(0,o.Cg)([r.z8.global()],n)},26455:(e,t,s)=>{s.d(t,{t:()=>r});var o=s(815287);const i={hasError:!1};class r extends o.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){this.props.onError?.(e)}reset(){this.props.onReset?.(),this.setState(i)}render(){const{children:e,fallback:t}=this.props,{hasError:s}=this.state;if(s){const e={reset:this.reset.bind(this)};return"function"==typeof t?(0,o.createElement)(t,e):t}return e}constructor(...e){super(...e),this.state=i}}},201910:(e,t,s)=>{function o(e){return e.displayName||e.name||"Component"}function i(e,t){return`${e}(${o(t)})`}s.d(t,{G:()=>i,M:()=>o})},448264:(e,t,s)=>{s.d(t,{W:()=>o});const o=e=>"url"in e?e.url:"screen_name"in e?`/${e.screen_name}`:void console.warn("The url owner could not be found")},266287:(e,t,s)=>{s.d(t,{l:()=>o});const o=e=>{const t=e.photo_base||e.photo_200||e.photo_100||e.photo_50;return t||console.warn("The photo owner could not be found"),t}},309910:(e,t,s)=>{function o(e,t){return new Proxy(console,{get(s,o,i){const r=Reflect.get(s,o,i);return"function"!=typeof r?r:function(...i){if(!e())return;const{prefix:n}=t??{},a=["debug","error","info","log","warn"].includes(o)?[`${n}:`].concat(i):i;return Reflect.apply(r,s,a)}}})}s.d(t,{R:()=>o})}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/75656.0c708801.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/75656.0c708801.js",e),e}