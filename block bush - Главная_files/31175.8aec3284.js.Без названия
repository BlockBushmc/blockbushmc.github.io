try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[31175,54952],{701576:(t,e,i)=>{i.d(e,{a4:()=>E,dP:()=>k,_f:()=>P,O6:()=>v,Y1:()=>A,ZT:()=>b,TM:()=>I,Qq:()=>C});var s=i(144819),o=i(441878),n=i(533520),a=i(799835),r=i(284146);const d=(t,e)=>{switch(e){case"upcoming":return(0,a.Xo)("global_video_soon");case"started":case"waiting":return(0,a.Xo)("global_video_online");default:return(0,r.a)(t)}};var c=i(355949);var l=i(9467),h=i(85923),p=i(926321),u=i(548893),g=i(231770);const _=t=>{const e={url:t.url||t.src||"",width:t.width,height:t.height,type:t.type};return t.type&&(e.type=t.type),e},m=new Set(["m","x","o"]),v=t=>{switch(t.type){case h.O.ALBUM:return t.album?.thumb?.sizes?.map(_)||[];case h.O.MARKET_ALBUM:return t.market_album?.photo?.sizes?.map(_)||[];case h.O.DOC:const i=(e=t.doc?.preview,e?.photo?.sizes?e.photo.sizes.map(_):e?.video?[_(e.video)]:e?.graffiti?[_(e.graffiti)]:[]);return t.doc&&(0,u.V$)(t.doc)?i.filter((t=>t.type&&m.has(t.type))):i;case h.O.PHOTO:return t.photo?.sizes?.map(_)||[];case h.O.VIDEO:case h.O.CLIP:const n=t.video||t.clip;if((0,l.AW)("video_disable_common_covers")||(0,l.z2)("disable_common_covers_of_videos")||(0,l.z2)("disable_common_covers_of_videos_on_web")||(0,l.z2)("disable_common_covers_of_videos_rollout")){if(!n?.image)return[];const t=(0,p.A)(n.image);if(t){return[{...t,url:(0,p.U)(t.url,t.width,t.height)}].map(_)}(0,o.v)(new Error(`Unexpectedly no base picture. Video url - ${(0,s.WO)({ownerId:n.owner_id??0,id:n.id??0})}`))}let a=n?.image?.filter((t=>!t.with_padding));return a?.length||(a=n?.image),a?.map(_)||[];case h.O.GRAFFITI:const{width:r,height:d,url:c,photo_200:g,photo_586:v}=t.graffiti||{};if(r&&d&&c)return[{url:c,width:r,height:d}];if(g||v){const t=[];return g&&t.push({url:g,width:200,height:200}),v&&t.push({url:v,width:586,height:586}),t}return[];case h.O.MINI_APP:{const e=t.mini_app?.images?.map(_);if(!e)return[];const i=e.filter((t=>t.width/t.height!=1));return i.length?i:e}}var e;return[]},y=["upcoming","waiting"],f=["started","upcoming","waiting"],S=({tag:t,hideAdultMarketTags:e})=>t.is_adult&&e?(0,a.Xo)("wall_market_tags_adult_text"):t.link.product?.price.loyalty_amount_text||t.link.product?.price.text,w=(t,e)=>t.map((t=>{const{id:i,is_adult:s,link:o,x:n,y:r}=t;return{isAdult:s,title:e&&s?(0,a.Xo)("wall_market_tags_adult_header"):o.title,price:S({tag:t,hideAdultMarketTags:e}),url:o.url,shown:!0,id:i,x:n,y:r}})),b=t=>{const e="interactive"===t.type,i=e?(0,a.Xo)("video_interactive_label"):t.platform,s=f.find((e=>e===t.live_status)),o="live"===t.type&&!!s;return{kind:"video",platform:i,canPlay:!t.live_status||!y.includes(t.live_status),formattedDuration:t.duration?d(t.duration,t.live_status):void 0,hidePlayButton:!!t.restriction,isInteractive:e,isLive:o,liveType:s}},P=({attachment:t,onMediaAttachments:e,onRestrictedAudio:i,onOpenAttachmentAudioListModal:s,photoMarketTags:o,hasMarketTagsLabelShift:r,onClickMarketItem:d,onGetMarketItemUrl:h,onToggleMarketLabel:p,hasPhotoMarketTags:_,hideAdultMarketTags:m,trackCode:v,isSpa:y,audioSnippetEnabled:f=!1})=>{const{photo:S,doc:P,album:A,video:k,market_album:C}=t;let I=null;if(e){const{postClickAnalytics:t,postActionAnalytics:o,postId:n,mode:a}=e;I=(0,g.c)({onMediaAttachments:e.attachments,mode:a,postActionAnalytics:o,postClickAnalytics:t,postId:n,onRestrictedAudio:i,onOpenAttachmentAudioListModal:s,trackCode:v,feedAttachmentOnmediaAudiosListEnabled:(0,l.z2)("feed_attachment_onmedia_audios_list"),isSpa:y,audioSnippetEnabled:f})}if(S){const t=(0,l.z2)("feed_photo_market_tags"),e=(0,l.z2)("feed_photo_market_tags_link_wrapper"),i=o&&p?t=>{p(t,o)}:void 0,s=e&&h?t=>{const e=o?.find((e=>e.id===t.id));if(o&&e)return h(e)}:void 0;return{kind:"photo",hasNFT:Boolean(S.nft?.nft_public_id),hasMarket:t?_:S.has_tags,onMediaAttachment:I??void 0,marketTags:t?{items:o?w(o,m):void 0,onItemClick:t=>{const e=o?.find((e=>e.id===t.id));o&&e&&d?.(e)},onToggleMarketLabel:i,getItemUrl:s,hasMarketTagsLabelShift:r}:void 0,marketLabelText:(0,a.Xo)("wall_photo_market_tags_aria_label"),nftLabelText:(0,a.Xo)("wall_photo_nft_aria_label")}}return P?(0,u.V$)(P)?{kind:"gif",formattedSize:(0,n.v)(P.size),label:(0,a.Xo)("wall_gif_play_label")}:{kind:"doc",ext:P.ext,formattedSize:(0,n.v)(P.size)}:k?b(k):A?{kind:"album",title:A.title,size:A.size,formattedSize:(0,a.Q1)(A.size,(0,a.Xo)("mobile_post_photos_count","raw"))}:C?{kind:"market_album",title:C.title,size:C.count,formattedSize:(E=C,E.type===c.L.MARKET_SERVICES||-2===E.id||-3===E.id?(0,a.Q1)(E.count,(0,a.Xo)("profile_X_market_services_items","raw")):(0,a.Q1)(E.count,(0,a.Xo)("profile_X_market_items","raw")))}:void 0;var E},A=t=>{const e=(t=>{switch(t.type){case h.O.ALBUM:return t.album?.thumb?.restrictions;case h.O.MARKET_ALBUM:return t.market_album?.photo?.restrictions;case h.O.PHOTO:return t.photo?.restrictions;case h.O.VIDEO:return t.video?.restriction;case h.O.CLIP:return t.clip?.restriction}})(t);if((!e||0!==e.disclaimer_type||e.icon_name)&&e){const i=(t=>"delete_outline"===t.icon_name?"deleted":t.blur||t.can_preview?"restricted":"blocked")(e),s=[h.O.VIDEO,h.O.CLIP].includes(t.type)?(0,a.Xo)("video_restriction_title_unavailable"):(0,a.Xo)("photos_geo_restriction_title");let o=e.button?.title;return o||"restricted"!==i||(o=(0,a.Xo)("wall_restriction_action_text")),{type:i,text:"blocked"===i?e.text:e.title,shortText:s,actionText:o}}},k=t=>{const{id:e=0}=t.album||t.photo||t.doc||t.video||t.clip||t.market_album||t.graffiti||t.audio||t.link||{};return String(e)},C=(t,e)=>({id:k(t),sizes:v(t)||[],overlay:P({attachment:t,hasPhotoMarketTags:e?.(t)}),canExtendBackground:"photo"===t.type||"doc"===t.type}),I=t=>{switch(t.type){case h.O.ALBUM:case h.O.PHOTO:case h.O.MARKET_ALBUM:case h.O.VIDEO:case h.O.CLIP:case h.O.GRAFFITI:return!0;case h.O.DOC:return Boolean(t.doc?.preview)}return!1},E=t=>t.paywall?.snippet.photos&&t.paywall.snippet.photos.map(_)||[]},708577:(t,e,i)=>{i.d(e,{P:()=>o});var s=i(326107);const o=(t,e)=>[t.id,0,t.stream_url??"",(0,s.uH)(t.name),"",0,0,0,"",0,0,e??"",{radio:!0,externalStream:!0},"",t.logo_url||t.logo_png_url||"",{},"","","",!1,t.track_code||"",0,0,!0,"",!1,""]},197118:(t,e,i)=>{i.d(e,{P:()=>s});var s=function(t){return t.CURRENT="current",t.PLAYLIST="playlist",t.MY="my",t.ALBUM="album",t.TEMP="temp",t.RECOM="recoms",t.SEARCH="search",t.FEED="feed",t.LIVE="live",t.WALL="wall",t.RECENT="recent",t.RADIO="radio",t}({})},666843:(t,e,i)=>{i.d(e,{V:()=>h});var s=i(221020),o=i(364517),n=i(814700),a=i(925810),r=i(815287),d=i(48711),c=i(264454);const l=t=>t?`module:${t}`:"",h=t=>{const{children:e,platformAudioPlayer:i,ownerId:h}=t,[p,u]=(0,r.useState)(a.w.NO),[g,_]=(0,r.useState)(null),[m,v]=(0,r.useState)(null),[y,f]=(0,r.useState)(0),[S,w]=(0,r.useState)(0),[b,P]=(0,r.useState)(l(h)),A=(0,r.useRef)(m);A.current=m;const k=()=>{i&&(_(i.getCurrentAudio()||null),v(i.getCurrentPlaylist()||null),f(i.getCurrentAudioProgress()||0),w(i.getCurrentAudioVolume()||0))},C=(0,o.K)((()=>{u(a.w.INIT),k()})),I=(0,o.K)((()=>{k()})),E=(0,o.K)((()=>{u(a.w.LOADING),k()})),L=(0,o.K)((()=>{u(a.w.PLAYING),k()})),T=(0,o.K)((()=>{u(a.w.PAUSED),k()})),M=(0,o.K)((()=>{k()})),O=(0,r.useMemo)((()=>(0,c.n)((()=>{if(!i)return;f(i.getCurrentAudioProgress()||0);const t=A.current;t&&!t.hasFetchingData||v(i.getCurrentPlaylist()||null)}),1e3)),[]),D=(0,o.K)((()=>{u(a.w.STOPPED),k()})),x=(0,o.K)((()=>{u(a.w.ENDED),k()}));(0,r.useEffect)((()=>{P(l(h))}),[h]),(0,r.useEffect)((()=>{if(i)return i.subscribe(d.A.INIT,C,b),i.subscribe(d.A.VOLUME,I,b),i.subscribe(d.A.PLAY_REQUESTED,E,b),i.subscribe(d.A.PLAY,L,b),i.subscribe(d.A.PAUSE,T,b),i.subscribe(d.A.PLAYLIST_CHANGED,M,b),i.subscribe(d.A.PROGRESS,O,b),i.subscribe(d.A.STOP,D,b),i.subscribe(d.A.ENDED,x,b),()=>{i.unsubscribe(d.A.INIT,C,b),i.unsubscribe(d.A.VOLUME,I,b),i.unsubscribe(d.A.PLAY_REQUESTED,E,b),i.unsubscribe(d.A.PLAY,L,b),i.unsubscribe(d.A.PAUSE,T,b),i.unsubscribe(d.A.PLAYLIST_CHANGED,M,b),i.unsubscribe(d.A.PROGRESS,O,b),i.unsubscribe(d.A.STOP,D,b),i.unsubscribe(d.A.ENDED,x,b)}}),[i,b]),(0,r.useEffect)((()=>{i&&(i.isPlaying()?u(a.w.PLAYING):i.getCurrentAudio()?u(a.w.PAUSED):u(a.w.NO)),k()}),[]);const R={platformAudioPlayer:i,status:p,currentAudio:g,currentPlaylist:m,currentAudioProgress:y,currentAudioVolume:S,audioPlayerContext:b};return(0,s.Y)(n.j.Provider,{value:R,children:e})}},814700:(t,e,i)=>{i.d(e,{j:()=>n});var s=i(815287),o=i(925810);const n=(0,s.createContext)({status:o.w.NO,currentAudio:null,currentPlaylist:null,currentAudioProgress:0,currentAudioVolume:0,audioPlayerContext:""})},925810:(t,e,i)=>{i.d(e,{H:()=>o,w:()=>s});var s=function(t){return t.NO="no",t.INIT="init",t.LOADING="loading",t.PLAYING="playing",t.PAUSED="paused",t.ENDED="ended",t.STOPPED="stopped",t}({});const o=-110},136141:(t,e,i)=>{i.d(e,{R:()=>n});var s=i(815287),o=i(814700);const n=()=>(0,s.useContext)(o.j)},184840:(t,e,i)=>{i.d(e,{t:()=>c});var s=i(327813),o=i(819674),n=i(848549),a=i(937998),r=i(558372),d=i(848500);class c{setMaxPhotosCount(t){this._maxPhotosCount=t}get isReadyForUpload(){return"inited"===this._uploaderInitStatus}get isErrorUploaderInit(){return"error"===this._uploaderInitStatus}get photos(){return this._photos}get photoIds(){return this._photos.map((({realPhotoId:t})=>t)).filter((t=>void 0!==t))}get isUploadingPhotos(){return this._photos.some((t=>"loading"===t.status))}get inputAccept(){return(this.params.uploadMimeFileTypes??d.VK).join(",")}clearState(){this.uploader=null,this._uploaderInitStatus="not-inited",this._photos=[]}constructor(t){this.uploader=null,this._uploaderInitStatus="not-inited",this._photos=[],this._controllers=new Map,this.setPayload=t=>{this.payload=t},this.setUploaderInitStatus=t=>{this._uploaderInitStatus=t},this.handleUploadFileEnd=t=>{const e=t.files.file1?.file;if(t.cancelled)return;if(!e)return void this.logErrorToSentryAndConsole("UploadPhotoService: Can not find file");const i=t.responseString;if(!i)return void this.logErrorToSentryAndConsole("UploadPhotoService: Can not find response");const s=e.id,o=t.files.file1?.errorCode;o?this.updatePhotoStatus({id:s,status:"error",errorCode:o}):this.getRealPhotoId({responseString:i,id:s})},this.handleUploadFileError=t=>{const e=t.files?.file1?.file;if(t.cancelled)return;if(!e)return void this.logErrorToSentryAndConsole("UploadPhotoService: Can not find file");const i=e.id;this.updatePhotoStatus({id:i,status:"error"})},this.handleUploadFileProgress=t=>{const e=t.files?.file1?.file;if(!e||t.cancelled)return;const i=100*t.loadedSize/t.totalSize,s=e.id;this.updatePhotoProgress({id:s,progress:i})},this.initUploader=async()=>{try{const{upload_url:t}=await this.params.fetchUploadServer();(0,s.h5)((()=>{this.uploader=a.r.init(this.params.uploaderId,{uploadUrl:t,multiple:!0,multipleMaxBatchSize:1,uploadMode:r.h.parallel,onLoadEnd:this.handleUploadFileEnd,onError:this.handleUploadFileError,onProgress:this.handleUploadFileProgress}),this.setUploaderInitStatus("inited")}))}catch{this.setUploaderInitStatus("error"),this.logErrorToSentryAndConsole("UploadPhotoService: init uploader error")}},this.updatePhotoStatus=({id:t,status:e,realPhotoId:i,errorCode:s})=>{const o=this._photos.find((e=>e.temporaryId===t));o&&(o.status=e,o.realPhotoId=i??o.realPhotoId,"error"===e&&this.params.onErrorUploadFile?.({id:Number(o.realPhotoId??t),ownerId:this.payload.ownerId,temporaryId:t,errorCode:s}))},this.updatePhotoProgress=({id:t,progress:e})=>{const i=this._photos.find((e=>e.temporaryId===t));i&&(i.progress=e)},this.handleChangeEvent=t=>{this.uploadPhotos({files:t})},this.setCallbacks=t=>{Object.assign(this.params,t)},this.uploadPhotos=({files:t,onFilteredPhotos:e})=>{if(null===this.uploader)return void this.logErrorToSentryAndConsole("UploadPhotoService: Can not find uploader");if(!t.length)return;const i=this.photos.length,s=this._maxPhotosCount-i,n=Math.min(i-this._maxPhotosCount,0);n&&this.params.onLimitExceededError?.(n);const a=this.params.uploadMimeFileTypes??d.VK,r=t.filter((t=>(0,d.HY)(t,a)));r.length!==t.length&&this.params.onUnsupportedFormatError?.(t.length-r.length);const c=r.slice(0,s).map((t=>{const e="id"in t?String(t.id):(0,o.A)();return t.id=e,t}));e?.(c);const l=c.map((t=>({status:"loading",file:t,temporaryId:t.id,url:URL.createObjectURL(t)})));this.addPhotos(l),this.uploader.handleSendFiles(c)},this.retryUploadPhoto=t=>{if(null===this.uploader)return void this.logErrorToSentryAndConsole("UploadPhotoService: Can not find uploader");const e=this.photos.find((e=>e.temporaryId===t));e?.file&&(this.updatePhotoStatus({id:t,status:"loading"}),this.uploader.handleSendFiles([e.file]))},this.getRealPhotoId=async({id:t,responseString:e})=>{try{this._controllers.set(t,new AbortController);const i=await this.params.savePhoto(e,this.payload,{signal:this._controllers.get(t)?.signal}),s=i[0].id;this.updatePhotoStatus({status:"uploaded",id:t,realPhotoId:s}),this.params.onReceivedRealPhotoId?.(i[0],t)}catch(e){(0,n.z)(e)||this.updatePhotoStatus({status:"error",id:t})}finally{this._controllers.delete(t)}},this.addPhotos=t=>{this._photos=this._photos.concat(t)},this.removePhoto=t=>{this._photos.splice(this._photos.findIndex((e=>e.temporaryId===t)),1)},this.logErrorToSentryAndConsole=t=>{console.error(t),this.params.errorLogger.log(new Error(t))},this.cancelPhotoUpload=t=>{this._controllers.get(t)?.abort();const e=this.uploader?.uploadEvents.find((e=>"id"in e.files.file1.file&&e.files.file1.file.id===t));if(e)try{this.uploader?.cancelUpload(e)}catch(t){this.logErrorToSentryAndConsole("UploadPhotoService: Can not cancel uploading")}},(0,s.l_)(this),this.params=t,this._maxPhotosCount=t.maxPhotosCount??10,this.initUploader()}}},922604:(t,e,i)=>{i.d(e,{iJ:()=>s});const s="performance-stats"},259137:(t,e,i)=>{function s(){let t=Date.now();if("ajax"in window&&"navStart"in window.ajax&&window.ajax.navStart)return{elapsed:t-Number(window.ajax.navStart),isAjaxNav:!0};const e="vkTabLoaded"in window&&void 0!==window.vkTabLoaded?Number(window.vkTabLoaded):Date.now(),i="vkLastNav"in window&&void 0!==window.vkLastNav?Number(window.vkLastNav):Date.now();return t<i&&(t=e+Math.floor(performance.now())),{elapsed:t-i,isAjaxNav:i!==e}}i.d(e,{Y:()=>s})},961120:(t,e,i)=>{i.d(e,{F:()=>o});var s=i(860656);function o(t,e,i){return(0,s.b)(t,(()=>"function"==typeof i?i():i),{version:e})()}},472978:(t,e,i)=>{i.d(e,{Aj:()=>r,FK:()=>n,aM:()=>a});var s=i(922604);const o=(0,i(961120).F)(`${s.iJ}`,0,{latestFeedBlockPreloadNonce:null});function n(t){o.latestFeedBlockPreloadNonce=t}function a(){return o.latestFeedBlockPreloadNonce}function r(){return`${Math.floor(performance.now()).toString(36)}:${Math.random().toString(36).slice(2)}`}},959832:(t,e,i)=>{i.d(e,{Fk:()=>l,KN:()=>n,KY:()=>d,Tt:()=>c,ld:()=>r,uC:()=>h,wW:()=>a});var s=i(557232);const o=(0,s.u)((()=>Promise.all([i.e(12334),i.e("langs/core_spa/stories-perf-metrics")]).then(i.bind(i,480187)))),n=t=>{o(((e,i)=>{e.trackStoryBlockLoadingStart((0,s.n)(t,i))}))},a=t=>{o(((e,i)=>{e.trackStoryBlockChunkLoadingEnd((0,s.n)(t,i))}))},r=t=>{o(((e,i)=>{e.trackStoryBlockDataLoadingEnd((0,s.n)(t,i))}))},d=t=>{o(((e,i)=>{e.trackStoryBlockPerfFeedRendered((0,s.n)(t,i))}))},c=t=>{o(((e,i)=>{e.trackStoryBlockStoryBlockRendered((0,s.n)(t,i))}))},l=t=>{o(((e,i)=>{e.trackStoryBlockChunkLoadingError((0,s.n)(t,i))}))},h=t=>{o(((e,i)=>{e.trackStoryBlockDataLoadingError((0,s.n)(t,i))}))}},419995:(t,e,i)=>{i.d(e,{qh:()=>y});var s=i(969152),o=i(17697);class n{logEvent(t){const e={...this.productionStatCollector.getBaseEvent(),type:s.l.TYPE_POSTING_TIMELINE,[s.l.TYPE_POSTING_TIMELINE]:t};this.productionStatCollector.logEvent(e)}constructor(){this.productionStatCollector=new o.H}}var a=i(806710);class r{setStartTime(t){null!==this.endTime&&t>this.endTime&&(this.endTime=null),this.startTime=t}setEndTime(t){null!==this.startTime&&this.startTime<=t&&(this.endTime=t)}getStatValue(){return null!==this.startTime&&null!==this.endTime&&this.startTime<=this.endTime?{start_time:this.startTime,end_time:this.endTime}:null}getValue(){const{startTime:t,endTime:e}=this;return{startTime:t,endTime:e}}constructor(){this.startTime=null,this.endTime=null}}class d{setAttachmentType(t){this.attachmentType=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}getStatValue(){const{attachmentType:t,timeRange:e}=this;if(t){const i=e.getStatValue();if(i)return{time_range:i,picker_type:t}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:a.q.PICKER_OPENING,[a.q.PICKER_OPENING]:t}:null}getValue(){const{attachmentType:t,timeRange:e}=this;return{attachmentType:t,timeRange:e}}constructor(){this.attachmentType=null,this.timeRange=new r}}class c{setFileType(t){this.fileType=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}getStatValue(){const{fileType:t,timeRange:e}=this;if(t){const i=e.getStatValue();if(i)return{file_type:t,time_range:i}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:a.q.FILE_UPLOADING,[a.q.FILE_UPLOADING]:t}:null}getValue(){const{fileType:t,timeRange:e}=this;return{fileType:t,timeRange:e}}constructor(){this.fileType=null,this.timeRange=new r}}class l{setStartTime(t){this.value.setStartTime(t)}setEndTime(t){this.value.setEndTime(t)}getStatEvent(){const t=this.value.getStatValue();return t?{type:a.q.POST_PUBLISHING_TIME_RANGE,[a.q.POST_PUBLISHING_TIME_RANGE]:t}:null}getValue(){return this.value.getValue()}constructor(){this.value=new r}}class h{setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}setMessage(t){this.message=t}setCode(t){this.code=t}getStatValue(){const{timeRange:t,message:e,code:i}=this,s=t.getStatValue();return s?{time_range:s,message:e,code:i}:null}getStatEvent(){const t=this.getStatValue();return t?{type:a.q.POST_PUBLISHING_ERROR,[a.q.POST_PUBLISHING_ERROR]:t}:null}getValue(){const{timeRange:t,message:e,code:i}=this;return{timeRange:t,message:e,code:i}}constructor(){this.timeRange=new r}}class p{setFileType(t){this.fileType=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}setMessage(t){this.message=t}setCode(t){this.code=t}getStatValue(){const{fileType:t,timeRange:e,message:i,code:s}=this;if(t){const o=e.getStatValue();if(o)return{file_type:t,time_range:o,message:i,code:s}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:a.q.FILE_UPLOADING_ERROR,[a.q.FILE_UPLOADING_ERROR]:t}:null}getValue(){const{fileType:t,timeRange:e,message:i,code:s}=this;return{fileType:t,timeRange:e,message:i,code:s}}constructor(){this.fileType=null,this.timeRange=new r}}class u{setAttachmentType(t){this.attachmentType=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}getStatValue(){const{attachmentType:t,timeRange:e}=this;if(t){const i=e.getStatValue();if(i)return{time_range:i,picker_type:t}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:a.q.PICKER_ATTACHMENT_ATTACHING,[a.q.PICKER_ATTACHMENT_ATTACHING]:t}:null}getValue(){const{attachmentType:t,timeRange:e}=this;return{attachmentType:t,timeRange:e}}constructor(){this.attachmentType=null,this.timeRange=new r}}class g{setMessage(t){this.message=t}setCode(t){this.code=t}getStatValue(){const{message:t,code:e}=this;return{message:t,code:e}}getStatEvent(){const t=this.getStatValue();return t?{type:a.q.ERROR,[a.q.ERROR]:t}:null}getValue(){const{message:t,code:e}=this;return{message:t,code:e}}}const _=()=>1e3*Date.now(),m=()=>({time:_()});var v=i(9467);const y=new class{logStartTimeline(t={}){if(this.screenStartTime?.time&&_()-this.screenStartTime?.time<=18e7)return;this.resetEventItem();const{isEditing:e,postType:i,creationEntryPoint:s,trackCode:o}=t;this.screenStartTime=m(),this.context={is_editing:e??!1,post_type:i??a.Mc.REGULAR,creation_entry_point:s??a.I8.OTHER,track_code:o??""}}logScreenInitialization(){this.screenInitializedTime||(this.screenInitializedTime=m())}logScreenInteractionReady(){this.screenInteractionTime||(this.screenInteractionTime=m())}logScreenClose(){this.finishTimeline(),this.sendCurrentEvent()}logStartSending(){this.currentEvents.postPublishingTimeRange||(this.currentEvents.postPublishingTimeRange=new l),this.currentEvents.postPublishingTimeRange.setStartTime(_())}logSuccessfullySend(){this.currentEvents.postPublishingTimeRange&&(this.currentEvents.postPublishingTimeRange.setEndTime(_()),this.events.push(this.currentEvents.postPublishingTimeRange),this.finishTimeline(),this.sendCurrentEvent())}logPostPublishingError({code:t,message:e}){if(!(0,v.z2)("posting_web_perf_stats_post_publishing_enabled"))return;const{postPublishingTimeRange:i}=this.currentEvents;if(!i)return;const s=i.getValue()?.startTime;if(!s)return;const o=new h;o.setStartTime(s),o.setEndTime(_()),o.setCode(t??0),o.setMessage(e??"unknown"),this.events.push(o),delete this.currentEvents.postPublishingTimeRange}finishTimeline(){this.screenCloseTime=m()}logPickerOpening({pickerType:t}){const e=new d;e.setStartTime(_()),e.setAttachmentType(t),this.currentEvents.pickerOpening=e}logPickerReady(){const{pickerOpening:t}=this.currentEvents;t&&(t.setEndTime(_()),this.events.push(t),delete this.currentEvents.pickerOpening)}logStartFileUploading({fileType:t,rawId:e}){this.uploadingFiles[e]||(this.uploadingFiles[e]={startTime:_(),fileType:t})}logFileLoaded({rawId:t}){if(!this.uploadingFiles[t])return;const{startTime:e,fileType:i}=this.uploadingFiles[t],s=new c;s.setStartTime(e),s.setEndTime(_()),s.setFileType(i),delete this.uploadingFiles[t],this.events.push(s)}logFileLoadingError({code:t,message:e,rawId:i}){const s=this.uploadingFiles[i];if(!s)return;const o=s.fileType,n=s.startTime;if(!n||!o)return;const a=new p;a.setStartTime(n),a.setEndTime(_()),a.setFileType(o),t&&a.setCode(t),e&&a.setMessage(e),this.events.push(a),delete this.uploadingFiles[i]}logStartAttaching({pickerType:t}){const e=new u;e.setStartTime(_()),e.setAttachmentType(t),this.currentEvents.pickerAttachmentAttaching=e}logFinishAttaching(){const{pickerAttachmentAttaching:t}=this.currentEvents;t&&(t.setEndTime(_()),this.events.push(t),delete this.currentEvents.pickerAttachmentAttaching)}logError({code:t,message:e}){const i=new g;t&&i.setCode(t),e&&i.setMessage(e.slice(0,128)),this.events.push(i)}changePostType(t){this.context&&(this.context.post_type=t)}changePostParams(t={}){if(!this.context)return;const{isEditing:e,postType:i,creationEntryPoint:s,trackCode:o}=t,n={};null!=e&&(n.is_editing=e),null!=i&&(n.post_type=i),null!=s&&(n.creation_entry_point=s),null!=o&&(n.track_code=o),this.context={...this.context,...n}}sendCurrentEvent(){const t=this.createStatEventItem();t&&this.postingTimelineCollector.logEvent(t),this.resetEventItem()}createStatEventItem(){const{screenStartTime:t,screenInitializedTime:e,screenInteractionTime:i,screenCloseTime:s,context:o,events:n}=this;if(t&&i&&e&&s&&o){const a=[];n.forEach((t=>{const e=t.getStatEvent();e&&(a.length<50||t instanceof l)&&a.push(e)}));return{screen_start_time:t,screen_initialized_time:e,screen_interaction_time:i,screen_close_time:s,context:o,events:a}}return null}resetEventItem(){this.screenStartTime=null,this.screenCloseTime=null,this.screenInitializedTime=null,this.screenInteractionTime=null,this.context=null,this.events=[],this.currentEvents={}}constructor(){this.screenStartTime=null,this.screenInteractionTime=null,this.screenInitializedTime=null,this.screenCloseTime=null,this.context=null,this.events=[],this.currentEvents={},this.uploadingFiles={},this.postingTimelineCollector=new n}}},806710:(t,e,i)=>{i.d(e,{I8:()=>o,Mc:()=>s,gY:()=>r,q:()=>n,ss:()=>a});const s={REGULAR:"regular",POSTPONED:"postponed",SUGGESTED:"suggested",POST_TEXT_LIVE:"post_text_live",POST_DONUT:"post_donut",EDIT:"edit",COMMENT:"comment",COMMENT_BOARD:"comment_board",COMMENT_MARKET:"comment_market"},o={PROFILE_INPUT:"profile_input",FEED_INPUT:"feed_input",COMMUNITY_INPUT:"community_input",OTHER:"other"},n={FILE_UPLOADING:"file_uploading",FILE_UPLOADING_ERROR:"file_uploading_error",PICKER_OPENING:"picker_opening",PICKER_ATTACHMENT_ATTACHING:"picker_attachment_attaching",POST_PUBLISHING_TIME_RANGE:"post_publishing_time_range",POST_PUBLISHING_ERROR:"post_publishing_error",ERROR:"error"},a={ALBUM:"album",ARTICLE:"article",DOCUMENT:"document",MARKET:"market",MUSIC:"music",PLACE:"place",PHOTO:"photo",PHOTO_VK:"photo_vk",POLL:"poll",SERVICE:"service",TAKE_PHOTO:"take_photo",VIDEO:"video",VIDEO_VK:"video_vk"},r={PHOTO:"photo",VIDEO:"video",DOCUMENT:"document"}},711672:(t,e,i)=>{i.d(e,{r:()=>a});var s=i(965970),o=i(297520),n=i(628839);const a=(t,e)=>(0,s.r)(t,{features:e,wrapAwayIfExternal:o.Xo,maybeStripVKSiteURLOriginAnySubdomain:n.up})},649972:(t,e,i)=>{i.d(e,{F:()=>a});var s=i(986407),o=i(443660),n=i(931198);const a=(t,e)=>t?{...t,name:(0,o.H)(t),href:(0,n.D)(t,e),verified:1===t.verified,is_nft:(0,s.E)(t)}:{name:"",href:""}},59512:(t,e,i)=>{i.d(e,{S:()=>d});var s=i(711672),o=i(9467);const n=(t,e)=>{if("Text"===e.kind){const i=t[t.length-1];"Text"===i?.kind?i.text+=e.text:t.push({kind:"Text",text:e.text})}else t.push(e);return t};var a=i(161933);const r=t=>{switch(t.kind){case"MassMention":return{kind:"Text",text:t.displayName};case"AliasedUrl":return{...t,kind:"Url"};default:return t}};function d(t,e){return(0,s.r)(t,{isAliasedUrlEnabled:e?.isAliasedUrlEnabled,fix_cyrillic_in_external_urls:!0,fix_cyrillic_in_external_plain_urls:(0,o.z2)("fix_cyrillic_in_external_plain_urls"),fix_double_br_in_line_break_with_paragraph:!0,feed_redesign_text_react_post:!(0,a.HS)()||e?.isLineBreakWithParagraphEnabled,feed_redesign_fix_mention:(0,o.z2)("feed_redesign_fix_mention"),feed_redesign_fix_hashtag_mention:(0,o.z2)("feed_redesign_fix_hashtag_mention")}).reduce(((t,e)=>n(t,r(e))),[])}},111153:(t,e,i)=>{i.d(e,{F:()=>g});var s=i(595253),o=i(490455),n=i(228909),a=i(945215),r=i(197118),d=i(863473),c=i(631251),l=i(750714),h=i(544528),p=i(708577),u=i(925810);class g{playAudio(t,e,i,n){const a=new c.X(this.webAudioPlayer,(0,s.X)().resolve(o.d)).getPlaylistId(),r=n?this.webAudioPlayer.getPlaylist(n.type,n.ownerId,n.albumId,"",n.blockId,n.context):a?this.webAudioPlayer.getCurrentPlaylist():this.webAudioPlayer.getPlaylist(d.X.TYPE_TEMP,window.vk.id),l=(0,h.U)(t),p=e?.map((t=>(0,h.U)(t)));this.webAudioPlayer.getPlaylistQueue().setSortedQueue(p),this.webAudioPlayer.playAudioItem({audio:l,playlist:r,context:i})}playPlaylist(t,e){this.webAudioPlayer.playPlaylist(t.owner_id,t.id,t.access_key,e)}playBlockPlaylist(t){const e=this.webAudioPlayer.getCurrentPlaylist(),i=this.webAudioPlayer.getPlaylistByBlockId(t)||new d.X({hasMore:!0,blockId:t});if(e&&e.equals(i)&&this.webAudioPlayer.isPlaying())this.webAudioPlayer.pauseByButton();else{const t=i.getContext();i.loadByBlockId("",(e=>{this.webAudioPlayer.playList({audio:e.getAudiosList()[0],playlist:e,context:t})}))}}playRadio(t,e,i,s){const o=this.webAudioPlayer.getPlaylist(r.P.RADIO,e.ownerId,u.H,void 0,e.blockId),n=(0,p.P)(t,s),a=i?.map((t=>(0,p.P)(t,s)));a&&this.webAudioPlayer.getPlaylistQueue().setSortedQueue(a),this.webAudioPlayer.playAudioItem({audio:n,playlist:o,context:s})}playPreviousAudio(){this.webAudioPlayer.playPrev()}playNextAudio(){this.webAudioPlayer.playNext()}pauseByButton(){this.webAudioPlayer.pauseByButton()}pauseByChangeChannel(){this.webAudioPlayer.pauseByChangeChannel()}pause(){this.webAudioPlayer.pause()}resume(){this.webAudioPlayer.resume()}stop(){this.webAudioPlayer.stop()}setVolume(t){this.webAudioPlayer.setVolume(t)}setCurrentAudioProgress(t){this.webAudioPlayer.seek(t)}getCurrentAudio(){return(0,l.W)(this.webAudioPlayer.getCurrentAudio())}getCurrentAudioProgress(){return this.webAudioPlayer.getCurrentProgress()}getCurrentAudioVolume(){return this.webAudioPlayer.getVolume()}getCurrentPlaylist(){const{musicPlaylistProvider:t}=this,e=this.webAudioPlayer.getCurrentPlaylist();if(!e)return null;const i=e.getPlaylistId(),s=e.getOwnerId(),o=e.getAccessHash();if("string"==typeof i)return null;const a=new n._({id:i,ownerId:s,accessKey:o});let r=null,d=!1;e.isTruePlaylistType()&&(r=t.get(a,{ref:null})??null,r||this.brokenListIds.has(a.fullId)||(t.ensure(a,{ref:null}).catch((()=>{this.brokenListIds.add(a.fullId)})),d=!0));const c=e.getCoverUrl(),l=c?{width:300,height:300,photo_300:c,sizes:[{width:300,height:300,src:c,type:"z"}]}:void 0,h={id:i,owner_id:s,access_key:o,title:e.getTitle(),subtitle:e.getSubtitle(),count:e.getTotalCount(),plays:e.getListens(),update_time:e.getLastUpdated(),is_following:e.isFollowed(),description:e.getDescription(),photo:l,thumbs:l?[l]:void 0,hasFetchingData:d},p=r?.originalIdentity;return p&&(h.original={owner_id:p.ownerId,playlist_id:p.id,access_key:p.accessKey}),h}getCurrentPlaylistId(){return this.webAudioPlayer.getCurrentPlaylist()?.getPlaylistId()}subscribe(t,e,i){return this.webAudioPlayer.on(i,t,e)}unsubscribe(t,e,i){if(void 0!==i)return this.webAudioPlayer.off(i)}isPlaying(){return this.webAudioPlayer.isPlaying()}notify(t,...e){this.webAudioPlayer.notify(t,...e)}constructor(t){this.brokenListIds=new Set,this.webAudioPlayer=t,this.ads=t.ads,this.musicPlaylistProvider=(0,s.X)().resolve(a.X)}}},952048:(t,e,i)=>{i.d(e,{n:()=>p});var s=i(221020),o=i(1269),n=i(595253),a=i(473529),r=i(332855),d=i(378119),c=i(725308);const l=()=>{const t=window.cur?.module;return"groups"===t||"public"===t?r.I8.COMMUNITY_INPUT:"feed"===t?r.I8.FEED_INPUT:"profile"===t?r.I8.PROFILE_INPUT:r.I8.OTHER},h=t=>{const e=window.cur?.module;return"groups"===e||"public"===e?t?"group_suggest":"group":"feed"===e?"feed":"profile"===e?"profile":""},p=({container:t=null,postRaw:e,ownerId:i,isEdit:r,modalDefaultOpened:p,postingTimelineStartTimeMs:u,isSuggest:g,isGroupEditor:_,isOnboardingEnabled:m,isChannelEnabled:v,initData:y,groupChannelUrl:f,creationEntryPoint:S,afterCreateSuccess:w,afterEditSuccess:b,afterDraftCreateSuccess:P})=>{var A,k;const C=Boolean(document.querySelector("#gtop_first_post_to_wall")),I=!r&&!p,E=(0,o.v)((()=>(0,s.Y)(n.R,{children:(0,s.Y)(a.V,{ownerId:i,isEdit:r,postRaw:e,loading:(0,s.Y)(d.l,{isUserSuggest:g&&c.z.isUserId(Number(i)),isGroupSuggest:(g||!_)&&c.z.isGroupId(Number(i)),isOnboardingEnabled:m,isChannelEnabled:v}),loadingError:null,postingTimelineStartTimeMs:u,postingTimelineCreationEntryPoint:l(),screen:window.cur?.module??"",isSuggest:g,isGroupEditor:_,modalDefaultOpened:p,initData:y,isFirstPostToWall:C,creationEntryPoint:S??h(Boolean(g)),renderPostingFormBlock:I,isOnboardingEnabled:m,groupChannelUrl:f,isChannelEnabled:v,afterCreateSuccess:w,afterEditSuccess:b,afterDraftCreateSuccess:P,withoutExternalMargins:C})})),t,{destroyAfterNavigation:!1}),L=()=>{E.isMounted()||E.render({})};var T;(L(),(A=window.cur)._back??(A._back={}),(k=window.cur._back).hide??(k.hide=[]),window.cur._back.hide.push(E.unmount),I)&&((T=window.cur._back).show??(T.show=[]),window.cur._back.show?.push(L))}},431885:(t,e,i)=>{i.d(e,{D:()=>s});var s=function(t){return t.UP="up",t.DOWN="down",t}({})},120193:(t,e,i)=>{i.d(e,{LH:()=>a,Vt:()=>s,bo:()=>o,pO:()=>r,rU:()=>n,yS:()=>d});const s={RESIZE:"VideoPlayerSyncEvents/RESIZE",TOGGLE_FAVORITE:"VideoPlayerSyncEvents/TOGGLE_FAVORITE",TOGGLE_ADDING_TO_MY_VIDEOS:"VideoPlayerSyncEvents/TOGGLE_ADDING_TO_MY_VIDEOS",SUGGESTIONS_OVERLAY_PLAYER_STATUS_CHANGED:"SUGGESTIONS_OVERLAY_PLAYER_STATUS_CHANGED",PLAYER_RESTRICTION_CLICK:"VideoPlayerSyncEvents/PLAYER_RESTRICTION_CLICK"},o={VIEW_BLOCK:"VideoForYouEvents/VIEW_BLOCK"},n={TOGGLE_AUTOPLAY:"VideoPlaylistEvents/TOGGLE_AUTOPLAY",SUBSCRIPTION_STATE_CHANGE:"VideoPlaylistEvents/SUBSCRIPTION_STATE_CHANGE"},a={CHANGE_VIDEO_INFO:"VideoEditEvents/CHANGE_VIDEO_INFO",CHANGE_ITEM_ACCESS_HASH:"VideoEditEvents/CHANGE_ITEM_ACCESS_HASH",UPDATE_VIDEO:"VideoEditEvents/UPDATE_VIDEO",FORCE_RELOAD_PLAYER:"VideoEditEvents/FORCE_RELOAD_PLAYER"},r={OPEN_EPISODE_LIST:"VideoEvents/OPEN_EPISODE_LIST",UPDATE_ACTIVE_EPISODE:"VideoEvents/UPDATE_ACTIVE_EPISODE",CLOSE_VIDEOVIEW:"VideoEvents/CLOSE_VIDEOVIEW"},d="loopVideo"},869523:(t,e,i)=>{i.d(e,{F:()=>l});var s=i(331635),o=i(327813),n=i(42107),a=i(338221),r=i(849645),d=i(306042),c=i(475982);class l{constructor(t,e){this.productionStats=t,this.metaData=e,this.logEvent=({trackCode:t,position:e,start_view:i,end_view:s,screen:o})=>{this.productionStats.send({type:"type_view",screen:o??this.getScreenValue(),type_view:{item:{type:"catalog_item",track_code:t},position:e,start_view:String(1e3*i),end_view:String(1e3*s)}}),this.productionStats.send({type:"type_view",screen:o??this.getScreenValue(),type_view:{type:"type_video_card_event",item:{type:"video",track_code:t},position:e,start_view:String(1e3*i),end_view:String(1e3*s),type_video_card_event:{event_type:"show"}}})},this.getScreenValue=()=>{const t=this.metaData.get().screen;if(t)return(0,d.Z)(t)?c.G[t]:t},(0,o.l_)(this)}}l=(0,s.Cg)([n.z8.transient(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.X?Object:a.X,void 0===r.e?Object:r.e])],l)},12027:(t,e,i)=>{i.d(e,{L:()=>d});var s=i(815287),o=i(140094),n=i(42107),a=i(217708),r=i(869523);const d=({videos:t,position:e,delay:i=1e3})=>{const d=(0,n.NF)(),{logEvent:c}=d.resolve(r.F),{partConfigEnabled:l}=(0,a.I)(),h=(0,s.useRef)(!1),{ref:p}=(0,o.Wx)({threshold:.8,triggerOnce:!1,onChange:s=>{l("frontend.vkcom_video_card_view_log")&&(h.current=s,setTimeout((i=>{h.current&&t.length&&t.forEach(((t,s)=>{t&&t.track_code&&c({trackCode:t.track_code,start_view:i,end_view:Date.now(),position:e??s})}))}),i,Date.now()))}});return{ref:p}}},386151:(t,e,i)=>{i.d(e,{r:()=>h});var s=i(331635),o=i(289375),n=i(849645),a=i(556039),r=i(42107),d=i(337951),c=i(529275),l=i(356979);class h{get screen(){return(0,d.q)(this.metaData.get().screen,this.feedPostModal.isModalOpened)}getTrackCode(t){const e=this.feedEntitiesStore.getItem(t);if("ads"===e?.apiType){const t="ads"in e.value?e.value.ads?.[0]:void 0;if(t?.post)return t.post.track_code??""}return e?.value.track_code??""}send(t){const e=this.screen;return this.productionStats.send({type:"type_action",screen:e,type_action:t})}sendStartPostAudio(t){this.send({previous_screen:undefined,type:`${a.y9}start_audio`,type_feed_post_start_audio:{...t,track_code:this.getTrackCode(t.feedItemId)}})}sendStartPostPlaylist(t){this.send({previous_screen:undefined,type:`${a.y9}start_playlist`,type_feed_post_start_playlist:{...t,track_code:this.getTrackCode(t.feedItemId)}})}sendProductTagShow(t){this.send({type:`${a.n0}show_product_pin`,type_feed_show_product_pin:t})}sendAppShow(t){this.send({type:"type_feed_block_mini_apps_item",type_feed_block_mini_apps_item:t})}sendShowUserRecCard(t){this.send({type:"type_feed_user_rec_item",type_feed_user_rec_item:{type:"type_feed_user_rec_show",type_feed_user_rec_show:t}})}sendOpenUserRecCard(t){this.send({type:"type_feed_user_rec_item",type_feed_user_rec_item:{type:"type_feed_user_rec_visit",type_feed_user_rec_visit:t}})}constructor(t,e,i,s){this.productionStats=t,this.metaData=e,this.feedEntitiesStore=i,this.feedPostModal=s}}h=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===o.X?Object:o.X,void 0===n.e?Object:n.e,void 0===c.B?Object:c.B,void 0===l.y?Object:l.y])],h)},173327:(t,e,i)=>{i.d(e,{F:()=>d});var s=i(331635),o=i(42107),n=i(289375),a=i(849645),r=i(529275);class d{getTrackCode(t){return this.feedEntitiesStore.getItem(t)?.value.track_code}logPostContextMenuActionEvent(t,e,i="post",s){const o=void 0!==e?this.getTrackCode(e):void 0;this.productionStats.send({type:"type_click",screen:this.metaData.get().screen,type_click:{type:"type_feed_item_menu_action",type_feed_item_menu_action:t,item:{type:i,track_code:o??s}}})}sendCopyLinkAction(t){this.logPostContextMenuActionEvent({action:"copy_link"},t.feedItemId)}sendClickToDotsAction(t){this.logPostContextMenuActionEvent({action:"click_to_dots"},t.feedItemId,"post",t.trackCode)}sendOpenAdvertiserInfoAction(t){this.logPostContextMenuActionEvent({action:"open_advertiser_info"},t.feedItemId,"ads")}sendCopyEridAction(t){this.logPostContextMenuActionEvent({action:"copy_erid"},t.feedItemId,"ads")}sendOpenOriginalAction(t){this.logPostContextMenuActionEvent({action:"open_original"},t.feedItemId)}sendSendDonutAction(t){this.logPostContextMenuActionEvent({action:"send_donut"},t.feedItemId)}sendEditPostAction(t){this.logPostContextMenuActionEvent({action:"edit_post"},t.feedItemId)}sendPostStatOpenAction(t){this.logPostContextMenuActionEvent({action:"post_stat"},t.feedItemId)}sendUnsubscribeCommentsAction(t){this.logPostContextMenuActionEvent({action:"unsubscribe_comments"},t.feedItemId)}sendDeclineSuggestedPostAction(t){this.logPostContextMenuActionEvent({action:"decline_suggested_post"},t.feedItemId)}sendPublishSuggestedPostAction(t){this.logPostContextMenuActionEvent({action:"post_suggested_post"},t.feedItemId)}sendPublishDelayedPostAction(t){this.logPostContextMenuActionEvent({action:"publish_delayed_post"},t.feedItemId)}sendMakeDonutPostPublicAction(t){this.logPostContextMenuActionEvent({action:"make_donut_post_public"},t.feedItemId)}sendCloseCommentsAction(t){this.logPostContextMenuActionEvent({action:"close_comments"},t.feedItemId)}sendDeletePostAction(t){this.logPostContextMenuActionEvent({action:"delete_post"},t.feedItemId)}constructor(t,e,i){this.productionStats=t,this.metaData=e,this.feedEntitiesStore=i}}d=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.X?Object:n.X,void 0===a.e?Object:a.e,void 0===r.B?Object:r.B])],d)},556039:(t,e,i)=>{i.d(e,{_u:()=>o,lU:()=>r,n0:()=>n,sg:()=>s,y9:()=>a});const s=".wall_item, .post_item, .js-wall_item",o=".feed_row",n="type_feed_",a="type_feed_post_",r="skip_scroll_after_item_size_change"},975472:(t,e,i)=>{i.d(e,{k:()=>y});var s=i(331635),o=i(529275),n=i(327813),a=i(42107),r=i(192133);function d(){return(0,n.sH)({error:void 0,status:"initial",startFrom:void 0,previousRequestParams:void 0})}const c={id:void 0,startTimeMs:0,remainingTimeMs:0,currentMultiplier:1,handler:void 0};var l=i(819674);class h{get cache(){return{uiState:(0,n.HO)(this.uiState),serviceState:this.serviceState}}reset(){this.clearAllTimeouts(),this._status="initial",this.setState({uiState:(0,r.bM)(this.feedType)}),this.serviceState=d()}get status(){return this._status}setStatus(t){this._status=t}hasAdsInvalidationTimeout(t){return this._adsInvalidationTimeoutIdByUniqueItemId.has(t)}deleteAdsInvalidationTimeout(t){return this._adsInvalidationTimeoutIdByUniqueItemId.delete(t)}clearInvalidationTimeout(){this._invalidationTimeout.id&&this.debugConsole.log("clear invalidation timeout:",this.feedType),clearTimeout(this._invalidationTimeout.id),this._invalidationTimeout={...c,currentMultiplier:this._invalidationTimeout.currentMultiplier}}clearAllTimeouts(){this.clearInvalidationTimeout(),this._adsInvalidationTimeoutIdByUniqueItemId.forEach((t=>clearTimeout(t))),this._adsInvalidationTimeoutIdByUniqueItemId.clear()}pauseInvalidationTimeout(){this._invalidationTimeout.currentMultiplier=c.currentMultiplier,this.debugConsole.log("reset multiplier for invalidation timeout:",this.feedType);if(!(this._invalidationTimeout.remainingTimeMs>0&&!!this._invalidationTimeout.id))return;clearTimeout(this._invalidationTimeout.id);const t=performance.now()-this._invalidationTimeout.startTimeMs;this._invalidationTimeout.remainingTimeMs-=t,this.debugConsole.log(`pause invalidation timeout: ${this.feedType}, remaining time:`,Math.round(this._invalidationTimeout.remainingTimeMs/1e3)),this._invalidationTimeout.remainingTimeMs<=0?this._invalidationTimeout.handler?.():this._invalidationTimeout.id=c.id}resumeInvalidationTimeout(){if(!(this._invalidationTimeout.remainingTimeMs>0&&this._invalidationTimeout.id===c.id))return this.clearAllTimeouts(),!1;const{handler:t,remainingTimeMs:e}=this._invalidationTimeout;return t&&e?(this.debugConsole.log(`resume invalidation timeout: ${this.feedType}, at:`,Math.round(e/1e3)),this._invalidationTimeout.id=window.setTimeout(t,e),this._invalidationTimeout.startTimeMs=performance.now(),!0):(this.clearAllTimeouts(),!1)}setInvalidationTimeout(t,e){const{currentMultiplier:i}=this._invalidationTimeout;this.debugConsole.log(`set invalidation timeout: ${this.feedType}, currentMultiplier:`,i);const s=e*i;this._invalidationTimeout={id:window.setTimeout(t,s),startTimeMs:performance.now(),remainingTimeMs:s,currentMultiplier:2*i,handler:t}}setAdsInvalidationTimeout(t,e,i){this._adsInvalidationTimeoutIdByUniqueItemId.set(t,window.setTimeout(e,i))}getItemState(t){const e=this.uiState.items.get(t.id);if(e)return e;const i=(0,r.NT)(t);return(0,n.h5)((()=>{this.uiState.items.set(t.id,i)})),i}createItemUiStateSetter(t,e){return i=>{(0,n.h5)((()=>{this.getItemState(t)[e]=i}))}}getItemUiState(t,e){return this.getItemState(t)[e]}get stateAccessors(){return{items:t=>{switch(t.type){case"post":case"post_ads":case"photo":case"wall_photo":case"photo_tag":{const e=t;return{type:t.type,carouselSlideIndex:this.getItemUiState(e,"carouselSlideIndex"),setCarouselSlideIndex:this.createItemUiStateSetter(e,"carouselSlideIndex"),textExpanded:this.getItemUiState(e,"textExpanded"),setTextExpanded:this.createItemUiStateSetter(e,"textExpanded"),size:this.getItemUiState(e,"size"),setSize:this.createItemUiStateSetter(e,"size")}}case"video":{const e=t;return{type:"video",textExpanded:this.getItemUiState(e,"textExpanded"),setTextExpanded:this.createItemUiStateSetter(e,"textExpanded"),size:this.getItemUiState(e,"size"),setSize:this.createItemUiStateSetter(e,"size")}}default:{const e=t;return{type:t.type,size:this.getItemUiState(e,"size"),setSize:this.createItemUiStateSetter(e,"size")}}}},scrollPosition:this.uiState.scrollPosition,setScrollPosition:this.setScrollPosition,initialScrollOffset:this.uiState.initialScrollOffset,setInitialScrollOffset:this.setInitialScrollOffset,scrollMargin:this.uiState.scrollMargin,setScrollMargin:this.setScrollMargin,itemIdObjects:this.uiState.itemIdObjects,setItemIdObjects:this.setItemIdObjects,prependItemInList:t=>{this.uiState.itemIdObjects.unshift({id:t,uid:(0,l.A)()})},sort:this.sort,addItemToListWithSort:(t,e)=>{let i=0;for(;i<this.uiState.itemIdObjects.length&&e(this.uiState.itemIdObjects[i].id,t)<0;)i++;this.uiState.itemIdObjects.splice(i,0,{id:t,uid:(0,l.A)()})}}}constructor(t,e){this.feedType=t,this.debugConsole=e,this._status="initial",this._invalidationTimeout={...c},this._adsInvalidationTimeoutIdByUniqueItemId=new Map,this.uiState=(0,r.bM)(this.feedType),this.serviceState=d(),this.setState=t=>{"uiState"in t&&(this.uiState=t.uiState),"serviceState"in t&&(this.serviceState=t.serviceState)},this.setScrollPosition=t=>{this.uiState.scrollPosition=t},this.setScrollMargin=t=>{this.uiState.scrollMargin=t},this.setInitialScrollOffset=t=>{this.uiState.initialScrollOffset=t},this.setItemIdObjects=t=>{this.uiState.itemIdObjects.push(...t)},this.sort=t=>{this.uiState.itemIdObjects.sort(((e,i)=>t(e.id,i.id)))},(0,n.l_)(this)}}var p=i(645189);class u{get cacheLifetimeSec(){return this.userEnv.partConfigEnabled("web_spa_feed_without_cache")?0:this.userEnv.partConfigEnabled("frontend.shorten_feed_cache")?10:600}constructor(t){this.userEnv=t,this.adsCacheLifetimeSec=this.userEnv.partConfigEnabled("web_spa_feed_without_cache")?0:5400,this.defaultOptions={cacheLifeTimeSec:this.cacheLifetimeSec,adsCacheLifeTimeSec:this.adsCacheLifetimeSec,hasWallComments:!1,preload:!1,withAds:!1},this.config={"news:recent":{cacheLifeTimeSec:this.cacheLifetimeSec,adsCacheLifeTimeSec:this.adsCacheLifetimeSec,preload:!0,withAds:!0},"news:top":{cacheLifeTimeSec:this.cacheLifetimeSec,adsCacheLifeTimeSec:this.adsCacheLifetimeSec,preload:!0,withAds:!0},"likes:clips":this.defaultOptions,"likes:market":this.defaultOptions,"likes:photo":this.defaultOptions,"likes:video":this.defaultOptions,"likes:wall":this.defaultOptions,"likes:wall_reply":this.defaultOptions,friends:this.defaultOptions,likes:this.defaultOptions,photos:this.defaultOptions,search:{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1},wall:{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1,hasWallComments:!0},"wall:search":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1},"wall:all":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1,hasWallComments:!0},"wall:owner":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1,hasWallComments:!0},"wall:others":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1,hasWallComments:!0},"wall:postponed":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1},"wall:suggests":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1},"wall:archived":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1},"wall:donut":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1,hasWallComments:!0},"wall:drafts":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1},"wall:drafts_simple":{cacheLifeTimeSec:0,adsCacheLifeTimeSec:0,preload:!1,withAds:!1}},(0,n.l_)(this)}}u=(0,s.Cg)([a.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===p.J?Object:p.J])],u);var g=i(309910);class _{get feedShowDebugLogsEnabled(){return this.userEnv.partConfigEnabled("feed_show_debug_logs")}get debugConsole(){return(0,g.R)((()=>this.feedShowDebugLogsEnabled),{prefix:"FeedCache"})}isFeedCacheable(t){return this.options[t].cacheLifeTimeSec>0}hasWallComments(t){return this.options[t].hasWallComments}constructor(t,e){this.feedCacheConfig=t,this.userEnv=e,this.stateByFeedType=new Map,this.options=this.feedCacheConfig.config,this.get=t=>{let e=this.stateByFeedType.get(t);return e||(e=new h(t,this.debugConsole),this.stateByFeedType.set(t,e)),e},this.set=(t,e)=>{this.get(t).setState(e)},this.reset=t=>{t&&this.get(t).reset()},(0,n.l_)(this)}}_=(0,s.Cg)([a.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===u?Object:u,void 0===p.J?Object:p.J])],_);class m{setCache(t,e){if(t&&(this.feedCacheByKey.set(t,{...e,key:t}),this.feedCacheByKey.size>25)){const t=this.feedCacheByKey.keys().next();if(!t.done){const e=t.value;this.deleteCache(e)}}}getCache(t){return t?this.feedCacheByKey.get(t):void 0}deleteCache(t){t&&this.feedCacheByKey.has(t)&&this.feedCacheByKey.delete(t)}constructor(){this.feedCacheByKey=new Map,(0,n.l_)(this)}}m=(0,s.Cg)([a.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],m);var v=i(857135);class y{get feedShowDebugLogsEnabled(){return this.userEnv.partConfigEnabled("feed_show_debug_logs")}get feedScrollRestorationFromNonFeed(){return this.userEnv.partConfigEnabled("frontend.feed_scroll_restoration_from_non_feed_page")}get debugConsole(){return(0,g.R)((()=>this.feedShowDebugLogsEnabled),{prefix:"FeedCache"})}setWindowInFocus(t){this.windowInFocus=t}get activeFeedType(){return this._activeFeed.type}isInCachedFeed(t){return t===this.activeFeedType&&this.windowInFocus}get hasWallComments(){return!!this.activeFeedType&&this.feedStateListService.hasWallComments(this.activeFeedType)}get hasAnotherFeedActive(){return this._activeFeed.count>1}setActiveFeed(t){this._activeFeed.type=t,this._activeFeed.count++}unsetActiveFeed(){this._activeFeed.count--,this._activeFeed.count<=0&&(this._activeFeed.count=0,this._activeFeed.type=void 0)}cleanupFeedOnUrlChange(t,e,i){return!(!this.feedStateListService.isFeedCacheable(t)||!e)&&(this.applyCleanup(t,i),!0)}cleanupFeedOnDestroyOrInit(t,e){const i=this.feedStateListService.get(t);return(!this.feedStateListService.isFeedCacheable(t)&&"initial"!==i.status||"outdated"===i.status)&&(this.applyCleanup(t,e),!0)}cleanupFeedOnFocus(t,e){const i=this.feedStateListService.get(t);return!(!this.feedStateListService.isFeedCacheable(t)||"outdated"!==i.status)&&(this.applyCleanup(t,e),!0)}applyCleanup(t,e){const i=this.feedStateListService.get(t);e(this.feedStateListService.options[t].preload&&"outdated"===i.status)}getPageHistoryCache(t){return this.feedHistoryCache.getCache(t)}markActual(t){const e=this.feedStateListService.get(t);["initial","preloaded"].includes(e.status)&&e.setStatus("actual")}addItemIds(t,e){const i=this.feedStateListService.get(t),s=e.map((t=>({id:t,uid:(0,l.A)()})));i.stateAccessors.setItemIdObjects(s),"initial"===i.status&&e.length>0&&i.setStatus("preloaded")}getUiStatus(t){return this.feedStateListService.get(t).status}setState(t,e){this.feedStateListService.get(t).setState(e)}getRequestStateCache(t){return this.feedStateListService.get(t).cache.serviceState}reset(t){this.feedStateListService.get(t).reset()}getItemsWithKeys(t){const e=[];if(!t.length)return e;for(const i of t){const t=(0,v.Kn)(i),s=this.feedEntitiesStore.getItem(i.id);if(!s||!t)continue;const o={item:s,key:t};e.push(o)}return e}getItemById(t){return this.feedEntitiesStore.getItem(t)}getItemIdObjects(t){return this.getUiStateAccessors(t).itemIdObjects}getUiStateAccessors(t){return this.feedStateListService.get(t).stateAccessors}constructor(t,e,i,s){this.feedHistoryCache=t,this.feedStateListService=e,this.feedEntitiesStore=i,this.userEnv=s,this._activeFeed={type:void 0,count:0},this.windowInFocus=!0,this.allItemsCount=void 0,this.scheduleInvalidation=(t,e)=>{const i=this.feedStateListService.get(t);if(i.resumeInvalidationTimeout())return;if("outdated"===i.status||!this.feedStateListService.isFeedCacheable(t))return;const s=this.feedStateListService.options[t];i.setInvalidationTimeout((()=>{(0,n.h5)((()=>{i.setStatus("outdated"),i.clearAllTimeouts(),this.debugConsole.log("invalidate cache:",t),this.isInCachedFeed(t)||(e(s.preload||!this.windowInFocus),!s.preload&&this.windowInFocus||(this.debugConsole.log("preload feed on timeout:",t),this.scheduleInvalidation(t,e)))}))}),1e3*s.cacheLifeTimeSec)},this.pauseInvalidationTimeout=t=>this.feedStateListService.get(t).pauseInvalidationTimeout(),this.scheduleAdsInvalidation=(t,e,i)=>{const s=this.feedStateListService.options[t],o=this.feedStateListService.get(t);!o.hasAdsInvalidationTimeout(e)&&this.feedStateListService.isFeedCacheable(t)&&s.withAds&&o.setAdsInvalidationTimeout(e,(()=>{(0,n.h5)((()=>{o.hasAdsInvalidationTimeout(e)&&(o.deleteAdsInvalidationTimeout(e),i(s.preload||this.isInCachedFeed(t)))}))}),1e3*s.adsCacheLifeTimeSec)},this.setCache=(t,e)=>{const i=this.feedStateListService.get(t),{uiState:s,serviceState:o}=i.cache;this.feedHistoryCache.setCache(e,{feedType:t,serviceCache:o,uiState:s})},this.getItemUiState=t=>{if(this.activeFeedType)return this.getUiStateAccessors(this.activeFeedType).items(t)},this.getSingleItemUiState=t=>this.getItemUiState(t)??(0,r.vD)(t),(0,n.l_)(this)}}y=(0,s.Cg)([a.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===m?Object:m,void 0===_?Object:_,void 0===o.B?Object:o.B,void 0===p.J?Object:p.J])],y)},968706:(t,e,i)=>{i.d(e,{H:()=>o});var s=i(327813);class o{init(){this.feedDataService.setActiveFeed(this.feedType),this.pauseInvalidationTimeout();const t=this.feedDataService.getPageHistoryCache(this.cacheKey);if(t){const{serviceCache:e,uiState:i}=t;return this.feedService.requestState.applyCache(e),this.feedDataService.setState(this.feedType,{uiState:i,serviceState:e}),!0}this.cleanupAndPreloadFeedOnDestroyOrInit()||this.itemIdObjects.length||["loading","initial"].includes(this.requestState.status)||this.reset()}get cacheKey(){return this._cacheKey}setCacheKey(t){this._cacheKey=t}cleanupAndPreloadFeedOnDestroyOrInit(){return this.feedDataService.cleanupFeedOnDestroyOrInit(this.feedType,(t=>{this.reset(),t&&this.preload(this.feedService,{count:5})}))}pauseInvalidationTimeout(){this.feedDataService.pauseInvalidationTimeout(this.feedType)}scheduleInvalidation(){this.feedDataService.scheduleInvalidation(this.feedService.feedType,(t=>{this.reset(),t&&this.preload(this.feedService,{count:5})}))}get feedType(){return this.feedService.feedType}onSuccess(t){return e=>{if(!e)return;const i=e.items.map((t=>t.id));return this.feedDataService.addItemIds(t.feedType,i),this.doFinally(t)(),i}}doFinally(t){return()=>this.feedDataService.setState(t.feedType,{serviceState:t.requestState.cache})}get requestState(){return this.feedService.requestState}get itemsWithKeys(){return this.feedDataService.getItemsWithKeys(this.itemIdObjects)}get items(){return this.itemsWithKeys.map((({item:t})=>t))}get itemIdObjects(){return this.feedDataService.getItemIdObjects(this.feedType)}inEmptyState(){return!this.itemIdObjects.length&&"success"===this.requestState.status}get scrollPosition(){return this.feedDataService.getUiStateAccessors(this.feedType).scrollPosition}get initialScrollOffset(){return this.feedDataService.getUiStateAccessors(this.feedType).initialScrollOffset}get scrollMargin(){return this.feedDataService.getUiStateAccessors(this.feedType).scrollMargin}get isResultEmpty(){return"success"===this.requestState.status&&!this.itemIdObjects.length}get allItemsCount(){return this.requestState.count}constructor(t,e,i,o){this._cacheKey=t,this.previousCacheKey=e,this.feedService=i,this.feedDataService=o,this.destroy=()=>{this.feedDataService.hasAnotherFeedActive&&this.feedDataService.activeFeedType===this.feedType||(this.feedDataService.feedScrollRestorationFromNonFeed?(this.requestState.abort(),this.feedDataService.hasAnotherFeedActive&&this.cleanupAndPreloadFeedOnDestroyOrInit()):this.cleanupAndPreloadFeedOnDestroyOrInit(),this.scheduleInvalidation()),this.feedDataService.unsetActiveFeed()},this.cleanupAndFetchFeedOnUrlChange=(t,e=!1)=>this.feedDataService.cleanupFeedOnUrlChange(this.feedType,e,(()=>(this.reset(),this.fetch(t)))),this.tabBlurHandler=t=>{t.target instanceof Window&&(this.feedDataService.setWindowInFocus(!1),this.scheduleInvalidation())},this.tabFocusHandler=t=>{t.target instanceof Window&&(this.feedDataService.setWindowInFocus(!0),this.pauseInvalidationTimeout(),this.feedDataService.cleanupFeedOnFocus(this.feedType,(()=>{this.reset(),this.fetch({count:5})})))},this.scheduleAdsInvalidation=(t,e)=>{this.feedDataService.scheduleAdsInvalidation(this.feedType,t,e)},this.fetch=async(t,e)=>{if(!["loading","success"].includes(this.requestState.status)&&!this.requestState.startFrom)return this.feedService.fetch(t,{onSuccess:this.onSuccess(this.feedService),onError:this.doFinally(this.feedService),prefetch:e?.prefetch})},this.fetchNext=async t=>this.feedService.fetchNext(t,{onSuccess:this.onSuccess(this.feedService),onError:this.doFinally(this.feedService)}),this.preload=async(t,e)=>(t.reset(),t.fetch(e,{onSuccess:this.onSuccess(t),onError:this.doFinally(t)})),this.reset=()=>{this.feedDataService.reset(this.feedType);const t=this.feedDataService.getRequestStateCache(this.feedType);return this.feedService.requestState.applyCache(t),this},this.setCache=()=>{(this.itemIdObjects.length||this.inEmptyState())&&this.feedDataService.setCache(this.feedType,this.cacheKey)},this.markActual=()=>{this.feedDataService.markActual(this.feedType)},this.getItemUiState=t=>this.feedDataService.getUiStateAccessors(this.feedType).items(t),this.prependItemInList=t=>{this.feedDataService.getUiStateAccessors(this.feedType).prependItemInList(t)},this.addItemToListWithSort=(t,e)=>{this.feedDataService.getUiStateAccessors(this.feedType).addItemToListWithSort(t,e)},this.sort=t=>{this.feedDataService.getUiStateAccessors(this.feedType).sort(t)},this.setScrollPosition=t=>{this.itemIdObjects.length&&this.feedDataService.getUiStateAccessors(this.feedType).setScrollPosition(t)},this.setInitialScrollOffset=t=>{this.itemIdObjects.length&&this.feedDataService.getUiStateAccessors(this.feedType).setInitialScrollOffset(t)},this.setScrollMargin=t=>{this.feedDataService.getUiStateAccessors(this.feedType).setScrollMargin(t)},this.init(),(0,s.l_)(this)}}},192133:(t,e,i)=>{i.d(e,{NT:()=>d,bM:()=>r,vD:()=>c,wk:()=>o});var s=i(327813);const o={size:{height:700,width:0}},n={...o,carouselSlideIndex:0,textExpanded:!1},a={...o,textExpanded:!1};function r(t){return(0,s.sH)({itemIdObjects:[],scrollPosition:0,initialScrollOffset:0,scrollMargin:void 0,items:new Map},{},{name:`FeedUiState:${t}`})}const d=t=>{switch(t.type){case"post":case"post_ads":case"photo":case"wall_photo":case"photo_tag":return{type:t.type,...n};case"video":return{type:t.type,...a};default:return{type:t.type,...o}}};function c(t){const e={setSize:()=>{}};switch(t.type){case"post":case"post_ads":case"photo":case"wall_photo":case"photo_tag":{const i={type:t.type,...n,...e,setCarouselSlideIndex:()=>{},setTextExpanded:()=>{}};return(0,s.sH)(i)}case"video":{const i={type:t.type,...a,...e,setTextExpanded:()=>{}};return(0,s.sH)(i)}default:{const i={type:t.type,...o,...e};return(0,s.sH)(i)}}}},857135:(t,e,i)=>{i.d(e,{Kn:()=>o,O0:()=>n});const s="(-?[\\d.]+)_(-?[\\d.]+)",o=({id:t,uid:e})=>`${t}___${e}`,n=t=>"string"==typeof t&&new RegExp(`^${s}___[a-f\\d]{8}-[a-f\\d]{4}-[a-f\\d]{4}-[a-f\\d]{4}-[a-f\\d]{12}$`).test(t)},344550:(t,e,i)=>{i.d(e,{X:()=>l});var s=i(331635),o=i(42107),n=i(651253),a=i(213350);const r={scope:"ScopedErrorLogger",percentage:20};class d{}d=(0,s.Cg)([o.z8.container()],d);class c{setConfig(t){const e=Object.assign({},r,t);if("container"===t.type)this.containerConfig.config=e;else this._config=e}get local(){return this._config}get container(){return this.containerConfig.config}get config(){return{scope:this.scope,percentage:this.percentage}}get scope(){const t=[this.container?.scope,this.local?.scope].filter(Boolean);return 0===t.length?r.scope:t.join(" ")}get percentage(){return this.local?.percentage??this.container?.percentage??r.percentage}constructor(t){this.containerConfig=t}}c=(0,s.Cg)([o.z8.transient(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===d?Object:d])],c);const l=(t=>{class e{get config(){return this.configMangar.config}constructor(e,i){this.errorLogger=e,this.configMangar=i,this.setConfig=this.configMangar.setConfig.bind(this.configMangar),this.log=(e,i={})=>{const{error:s,data:o}=i;if(100*Math.random()<this.configMangar.config.percentage){const i=(0,a.$)(t+" "+this.configMangar.scope,e,s);return this.errorLogger.log(i,{metaData:{breadcrumb:{data:o}}})}}}}return e=(0,s.Cg)([o.z8.transient(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.v?Object:n.v,void 0===c?Object:c])],e)})("FeedError")},356979:(t,e,i)=>{i.d(e,{y:()=>a});var s=i(331635),o=i(327813),n=i(42107);class a{constructor(){this.isModalOpened=!1,this.setModalOpened=(t=!1)=>{this.isModalOpened=t},(0,o.l_)(this)}}a=(0,s.Cg)([n.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],a)},42334:(t,e,i)=>{i.d(e,{g:()=>n});var s=i(331635),o=i(42107);class n{constructor(){this._stores=new Map,this.set=(t,e)=>{this._stores.set(t,e)},this.get=t=>this._stores.get(t),this.remove=t=>{this._stores.delete(t)},this.has=t=>this._stores.has(t)}}n=(0,s.Cg)([o.z8.container()],n)},821713:(t,e,i)=>{i.d(e,{f:()=>a});var s=i(331635),o=i(42107),n=i(327813);class a{addWatcher(t,e){this.watchers.set(t,e)}getWatcher(t){return this.watchers.get(t)}constructor(){this.watchers=new Map,(0,n.l_)(this)}}a=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],a)},665590:(t,e,i)=>{i.d(e,{By:()=>o,S4:()=>s});function s(t){return String(1e3*t)}const o=(t,e)=>{const i=[];return t.forEach(((t,s)=>{t.forEach((t=>{t.visible&&(e.call(t),i.push({viewTimePost:t,itemIntersectingData:{observerName:s}}))}))})),i}},848158:(t,e,i)=>{i.d(e,{S:()=>a});var s=i(331635),o=i(42107),n=i(711350);class a{async initViewLogger(){if(this.viewLogger=await this.viewStatsLoggerFactory.ensure(),!this.viewLogger)return;const t=Array.from(this.observerItemsMap.entries()).map((([t,e])=>Array.from(e.values()).map((e=>({element:e.element,itemIntersectingData:{observerName:t},viewTimePost:e,type:""})))));this.viewLogger.logPastEvents(t.flat())}constructor(t){this.viewStatsLoggerFactory=t,this.observerItemsMap=new Map,this.viewLogger=void 0,this.getObserverItem=(t,e)=>this.observerItemsMap.get(t)?.get(e),this.setObserverItem=(t,e)=>{this.observerItemsMap.has(t)?this.observerItemsMap.get(t)?.set(e.item.id,e):this.observerItemsMap.set(t,new Map([[e.item.id,e]]))},this.initViewLogger()}}a=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.h?Object:n.h])],a)},711350:(t,e,i)=>{i.d(e,{h:()=>d});var s=i(331635),o=i(42107),n=i(645189),a=i(651253),r=i(808911);class d{async ensure(){if(this.userEnv.partConfigEnabled("feed_view_stats_logger")){if(!this.instance)try{const{ViewStatsLogger:t}=await(0,r.p)((()=>Promise.all([i.e(66073),i.e("langs/core_spa/ViewStatsLogger")]).then(i.bind(i,608138))),1);this.instance=new t}catch(t){this.errorLogger.log(t)}return this.instance}}constructor(t,e){this.userEnv=t,this.errorLogger=e,this.instance=void 0}}d=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.J?Object:n.J,void 0===a.v?Object:a.v])],d)},233788:(t,e,i)=>{i.d(e,{L:()=>a});var s=i(373478),o=i(201910),n=i(213350);const a=(t,e,i)=>(0,s.f)(t,{onError:(e,{metadata:s,logger:a,uiDegradationLogger:r})=>{const d=s.get().screen,c=i??(0,o.M)(t);a.log((0,n.N)(e,c),{metaData:{breadcrumb:{data:{screen:d}}}}),r.log({screen:d,elementName:c})},Fallback:e})},540917:(t,e,i)=>{i.d(e,{F:()=>st});var s=i(221020),o=i(356035),n=i(331635),a=i(42107),r=i(327813),d=i(645189),c=i(848158),l=i(195578),h=i(832595),p=i(86218),u=i(208182);const g=["friends_recomm","user_rec","recommended_games_carousel","recommended_groups","recommended_channels","videos_for_you","market_carousel","mini_apps_carousel"];var _=i(961829);class m{constructor(t,e,i){this.feedEntitiesMutationService=t,this.viewHandlers=e,this.viewRecBlocksHandlers=i,this.onStartViewAfterVisibilityChange=t=>{t.forEach((t=>{this.onStartView(t.viewTimePost,t.itemIntersectingData)}))},this.onEndViewAfterVisibilityChange=(t,e)=>{const i=t.reduce(((t,{viewTimePost:i,itemIntersectingData:s})=>{if(s.observerName===u.U.t50&&i.item.viewsCount)return t;if(-1===i.startTime||-1===i.endTime)return t;const{width:o,height:n}=e(i.item),a={element:i.element,itemIntersectingData:s,viewTimePost:i,type:i.item?.apiType},r={index:i.index,itemId:i.item.id,width:o,height:n,startTime:i.startTime,endTime:i.endTime,screen:i.screen};return this.feedEntitiesMutationService.incrementFeedItemViewsCount(i.item.id),t.push({type:i.item?.apiType,observerName:s.observerName,logData:a,statsData:r}),t}),[]),s=i.filter((t=>("ads"===t.type||"ads_post"===t.type||"post_ads"===t.type)&&t.observerName===u.U.t50)),o=i.filter((t=>!!t.type&&g.includes(t.type)&&t.observerName===u.U.t35)),n=i.filter((t=>"ads"!==t.type&&"ads_post"!==t.type&&"post_ads"!==t.type&&t.observerName===u.U.t35&&(0,_.e)(t.statsData.itemId)));o.length>0&&this.viewRecBlocksHandlers.onEndViewBlockTrackEventsAfterVisibilityChange(o),s.length>0&&this.viewHandlers.onEndViewPostTrackEventsAfterVisibilityChange(s),n.length>0&&this.viewHandlers.onEndViewPostAfterVisibilityChange(n)},this.onStartView=(t,e)=>{if(e.observerName===u.U.t50&&t.item?.viewsCount)return;const i={element:t.element,itemIntersectingData:e,viewTimePost:t,type:t.item?.type};this.viewHandlers.onStartViewPost(i)}}}m=(0,n.Cg)([a.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===l.K?Object:l.K,void 0===h.S?Object:h.S,void 0===p.S?Object:p.S])],m);var v=i(309910),y=i(665590),f=i(903473),S=i(192133),w=i(472978),b=i(259137),P=i(959832);class A{handleFirstFeedRender(){this.storyPerfStats()}storyPerfStats(){const t=(0,w.aM)();if(t){const e=(0,b.Y)().isAjaxNav?0:1;(0,P.KY)({nonce:t,isFullPageLoad:Boolean(e)})}}}A=(0,n.Cg)([a.z8.global()],A);class k{constructor(t){this.view=t}}k=(0,n.Cg)([a.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===A?Object:A])],k);var C=i(356979);let I,E,L=a.zr;class T{get isScrollRestorationFromNonFeedPageEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_scroll_restoration_from_non_feed_page")}[L](){this.endView(),this.feedPostViewStatsStore.observerItemsMap.clear(),this.modalOpenedReactionDisposer()}get shouldLockScroll(){return this._shouldLockScroll}get onScrollRestorationWithLayer(){return this.props.current.onScrollRestorationWithLayer}get feedServiceDecorator(){return this.props.current.feedServiceDecorator}get newsfeedType(){return this.props.current.newsfeedType}get itemsWithKeys(){if(this.props.current.filteredIds?.length){const t=new Set(this.props.current.filteredIds);return this.feedServiceDecorator.itemsWithKeys.filter((e=>!t.has(e.item.id)))}return this.feedServiceDecorator.itemsWithKeys}get scrollPosition(){return this.feedServiceDecorator.scrollPosition}get initialScrollOffset(){return this.feedServiceDecorator.initialScrollOffset}get scrollMargin(){return this.feedServiceDecorator.scrollMargin??this.props.current.offsetTop}get status(){return this.feedServiceDecorator.requestState.status}get allAvailableItemsLoaded(){return this.feedServiceDecorator.requestState.allAvailableItemsLoaded}get feedShowDebugLogsEnabled(){return this.userEnv.partConfigEnabled("feed_show_debug_logs")}get debugConsole(){return(0,v.R)((()=>this.feedShowDebugLogsEnabled),{prefix:"FeedScrollRestoration"})}get observerItemsMap(){return this.feedPostViewStatsStore.observerItemsMap}get offsetTop(){return this.props.current.offsetTop}get withoutSaveScroll(){return this.props.current.withoutSaveScroll}get gap(){return this.props.current.gap??20}get forcedBlocks(){return this.props.current.forcedBlocks}get isLayerOpened(){return this.props.current.isLayerOpened}get scrollContainerRef(){return this.props.current.scrollContainerRef}get lazyLoadingDisabled(){return Boolean(this.props.current.lazyLoadingDisabled)}get isErrorDisabledLoading(){return this.userEnv.partConfigEnabled("frontend.feed_error_in_end_enabled")}get restoreScrollWithRaf(){return Boolean(this.props.current.restoreScrollWithRaf)}get isStatusAllowedForFetchNext(){const t=["initial","loading"];return this.isErrorDisabledLoading&&t.push("error"),!t.includes(this.status)}constructor(t,e,i,s,o,n){this.props=t,this.userEnv=e,this.feedPostViewStatsStore=i,this.feedPostViewStatsVisibilityHandlers=s,this.feedHandlers=o,this.feedPostModal=n,this.itemSizesFallback=new Map,this._shouldLockScroll=!1,this[D]=()=>{this._shouldLockScroll=this.props.current.isLayerOpened},this[x]=t=>{!t.isLayerOpened&&this._shouldLockScroll&&(this._shouldLockScroll=!1)},this.markActual=this.feedServiceDecorator.markActual,this.setCache=this.feedServiceDecorator.setCache,this.tabBlurHandler=this.feedServiceDecorator.tabBlurHandler,this.tabFocusHandler=this.feedServiceDecorator.tabFocusHandler,this.getItemUiState=this.feedServiceDecorator.getItemUiState,this.setScrollPosition=t=>this.feedServiceDecorator.setScrollPosition(t),this.setInitialScrollOffset=t=>this.feedServiceDecorator.setInitialScrollOffset(t),this.setScrollMargin=t=>this.feedServiceDecorator.setScrollMargin(t),this.fetchNext=this.feedServiceDecorator.fetchNext,this.scrollToIndexEnabled=()=>this.userEnv.partConfigEnabled("feed_spa_scroll_to_index"),this.scheduleAdsInvalidation=this.feedServiceDecorator.scheduleAdsInvalidation,this.getItemSize=t=>this.getItemUiState(t).size,this.getItemSizeFallback=t=>this.itemSizesFallback.get(t)??{...S.wk.size},this.handlers=this.feedHandlers,this.endView=()=>{this.feedPostViewStatsVisibilityHandlers.onEndViewAfterVisibilityChange((0,y.By)(this.observerItemsMap,f.v.prototype.endView),this.getItemSizeFallback)},this.handleStartView=t=>this.feedPostViewStatsVisibilityHandlers.onStartViewAfterVisibilityChange(t),this.handleEndView=t=>this.feedPostViewStatsVisibilityHandlers.onEndViewAfterVisibilityChange(t,this.getItemSizeFallback),(0,r.l_)(this,{getItemSize:!1,itemSizesFallback:!1}),this.modalOpenedReactionDisposer=(0,r.mJ)((()=>this.props.current.isLayerOpened),(t=>{this.feedPostModal.setModalOpened(t)}))}}I=D=a.Ts,E=x=a.yo,T=(0,n.Cg)([a.z8.transient(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===d.J?Object:d.J,void 0===c.S?Object:c.S,void 0===m?Object:m,void 0===k?Object:k,void 0===C.y?Object:C.y])],T);const{Provider:M,useModel:O}=(0,a.Qd)(T,{initInEffect:!1});var D,x,R=i(651220),Y=i(734e3),F=i(815287),B=i(486526);const N="undefined"==typeof window||"onscrollend"in window,z=(t,e)=>{const i=t.scrollElement;if(!i)return;const s=t.targetWindow;if(!s)return;let o=0;const n=N?()=>{}:(0,B.s)((()=>{e(o,!1)}),t.options.isScrollingResetDelay,s),a=s=>()=>{o=i[t.options.horizontal?"scrollX":"scrollY"],"fixed"===i.document.documentElement.style.position?o=-1*parseInt(i.document.documentElement.style[t.options.horizontal?"left":"top"]):"hidden"===i.document.body.style.overflow&&(o=-1*parseInt(i.document.body.style[t.options.horizontal?"left":"top"])),n(),e(o,s)},r=a(!0),d=a(!1);return d(),i.addEventListener("scroll",r,{passive:!0}),i.addEventListener("scrollend",d,{passive:!0}),()=>{i.removeEventListener("scroll",r),i.removeEventListener("scrollend",d)}};var V=i(724075),U=i(516427);var G=i(694828);var j=i(556039),W=i(857135),H=i(11830),$=i(527652),K=i(874167);var q=i(395089);const Q=(t,e="before")=>{if(!t)return;const i="after"===e?"nextElementSibling":"previousElementSibling";let s=t;for(;s&&(s=s[i]||s.parentElement?.[i],s);)if(s instanceof HTMLElement){const t=(0,q.i)(s);if(t.length>0){const i="after"===e?0:t.length-1;return t[i].focus({preventScroll:!0}),void t[i].scrollIntoView({behavior:"smooth",block:"center"})}}},J=(t,e="before",i)=>{if(!t)return;const s="after"===e?"nextElementSibling":"previousElementSibling";let o=document.activeElement?.closest("article");if(o||(o=document.elementFromPoint(window.innerWidth/2,window.innerHeight/2)?.closest("article")),!o)return;i.preventDefault();const n=o[s];n instanceof HTMLElement&&(n.focus({preventScroll:!0}),n.scrollIntoView({behavior:"smooth",block:"center"}))},X=t=>{const e=(0,F.useRef)(t);return(0,F.useEffect)((()=>{e.current=t})),e.current};const Z=()=>((0,U.K$F)(),null),tt=(0,o.P)((function({children:t,scroll:e,useItemsVirtualizer:i}){const{itemsWithKeys:o,getItemUiState:n,scrollPosition:a,setScrollPosition:d,initialScrollOffset:c,setInitialScrollOffset:l,offsetTop:h,scrollMargin:p,withoutSaveScroll:g,forcedBlocks:_,isLayerOpened:m,gap:v,setScrollMargin:S,markActual:w,setCache:b,fetchNext:P,allAvailableItemsLoaded:A,scrollToIndexEnabled:k,feedShowDebugLogsEnabled:C,scheduleAdsInvalidation:I,debugConsole:E,observerItemsMap:L,handleEndView:T,handleStartView:M,newsfeedType:D,tabBlurHandler:x,tabFocusHandler:R,getItemSize:Y,itemSizesFallback:B,scrollContainerRef:N,lazyLoadingDisabled:z,isStatusAllowedForFetchNext:q,handlers:X,isScrollRestorationFromNonFeedPageEnabled:tt,shouldLockScroll:et,onScrollRestorationWithLayer:it,restoreScrollWithRaf:st}=O();(0,V.M)(q&&!A&&!z,(()=>P({forced_blocks:_})),N?.current??window,!1,3);const ot=(0,F.useRef)(null),nt=(0,F.useRef)(null),at=ot.current?.offsetTop??0,[rt,dt]=(0,F.useState)(!a),ct=(0,F.useRef)(o);ct.current=o;const lt=function(t){const[e]=(0,F.useState)((()=>({[u.U.t35]:new G.N(u.U.t35,{threshold:.35,rootMargin:`-${t}px 0px 0px 0px`}),[u.U.t50]:new G.N(u.U.t50,{threshold:.5,rootMargin:`-${t}px 0px 0px 0px`})})));return e}(at);!function({observerItemsMap:t,isLayerOpened:e,onStartView:i,onEndView:s}){const o=e;(0,F.useEffect)((()=>{if(!t||o)return;const e=()=>{"hidden"===window.document.visibilityState?s?.((0,y.By)(t,f.v.prototype.endViewOnVisibility)):i?.((0,y.By)(t,f.v.prototype.startView))};return window.addEventListener("visibilitychange",e),()=>{window.removeEventListener("visibilitychange",e)}}),[t,i,s,o])}({observerItemsMap:L,onStartView:M,onEndView:T,newsfeedType:D,isLayerOpened:m}),(0,F.useEffect)((()=>{if(rt)return;const t=window.setTimeout((()=>{dt(!0)}),500);return()=>window.clearTimeout(t)}),[]);const ht=(0,F.useCallback)(((t,e)=>{const i=e.indexFromElement(t),s=ct.current?.[i]?.item;if(!s)return;const{setSize:o}=n(s),a={height:t.offsetHeight,width:t.offsetWidth};o(a),B.set(s,a)}),[]),pt=i({count:o.length,estimateSize:t=>Y(o[t].item).height,getItemKey:t=>o[t].key,scrollToFn:(t,i,s)=>{if(g)return;const o=s.shouldAdjustScrollPositionOnItemSizeChange?.();o?s.shouldAdjustScrollPositionOnItemSizeChange=void 0:(E.log("scroll adjustments:",i.adjustments),e(t,i,s))},overscan:3,gap:v,scrollMargin:p??at,initialOffset:c??0,measureElement:(t,e,i)=>{if(ht(t,i),e?.borderBoxSize){const t=e.borderBoxSize[0];if(t){return Math.round(t[i.options.horizontal?"inlineSize":"blockSize"])}}return t[i.options.horizontal?"offsetWidth":"offsetHeight"]}}),ut=pt.getVirtualItems(),gt=ut.length>0;(0,F.useEffect)((()=>{gt&&X.view.handleFirstFeedRender()}),[gt]);const _t=(0,F.useRef)(pt);(0,F.useLayoutEffect)((()=>{C&&(Reflect.set(window,"virtualizer",pt),Reflect.set(window,"getItems",(()=>ct.current.map((t=>(0,r.HO)(t))))))}),[]);const mt=(0,F.useRef)(null),vt=(0,U.Ll8)();(0,F.useLayoutEffect)((()=>{if(E.log("previous initialScrollOffset",c),g)return;if(et)return;const t=()=>{if(E.log("previous scrollPosition",a),k()&&0!==a)_t.current.scrollToIndex(a,{align:"start"});else{if(0===a&&0===_t.current.scrollOffset)return;_t.current.scrollToOffset(a)}};tt&&st?(mt.current&&cancelAnimationFrame(mt.current),mt.current=requestAnimationFrame((()=>{t()}))):t()}),[a,g,et]),(0,F.useLayoutEffect)((()=>{if(!tt)return;if(!et||!gt)return;let t=a;k()&&0!==a&&(t=_t.current.measurementsCache[a]?.start),isNaN(t)||(vt.scrollTo(0,t),it?.())}),[et,gt,a]),(0,F.useEffect)((()=>{nt.current=h??at}),[h]),(0,F.useEffect)((()=>()=>{if(_t.current.getTotalSize()&&!g&&(nt.current&&S(nt.current),null!==_t.current.scrollOffset)){if(k()){const t=_t.current.getVirtualItemForOffset(_t.current.scrollOffset);if(!t)return;d(((t,e)=>{let i=t.index;return e>(t=>t.start+(t.end-t.start)/2)(t)&&i++,i})(t,_t.current.scrollOffset))}else d(_t.current.scrollOffset);l(_t.current.scrollOffset)}}),[]),(0,F.useEffect)((()=>()=>{if(C){const t=o.map((({item:t,key:e})=>[e,Y(t)]));Reflect.set(pt,"measuredItemSizesByKey",t),Reflect.set(pt,"measuredItemSizes",t.map((([,t])=>`height:${t.height},width:${t.width}`)).join(",")),Reflect.set(pt,"measuredItemKeys",t.map((([t])=>t)).join(","))}}),[]),(0,F.useEffect)(w,[]),(0,F.useEffect)((()=>b),[]),(0,F.useEffect)((()=>()=>{E.log("range:",_t.current.calculateRange()),E.log("scrollPosition",_t.current.scrollOffset),E.log("initialScrollOffset",c),E.log("items count:",ct.current.length),E.log("item keys:",ct.current.map((({key:t})=>t)).join(",")),E.log("item sizes:",ct.current.map((({item:t})=>Y(t).height)).join(","))}),[]),(0,F.useEffect)((()=>(window.addEventListener("blur",x),window.addEventListener("focus",R),()=>{window.removeEventListener("blur",x),window.removeEventListener("focus",R)})),[]),(0,F.useEffect)((()=>{const t=()=>{_t.current.shouldAdjustScrollPositionOnItemSizeChange=()=>!0};return window.addEventListener(j.lU,t),()=>{window.removeEventListener(j.lU,t)}}),[]),(0,F.useEffect)((()=>()=>{Object.values(lt).forEach((t=>t?.disconnect()))}),[]);const yt=(0,F.useCallback)((t=>{if(!t)return;const e=()=>_t.current.measureElement(t);_t.current.isScrolling&&"backward"===_t.current.scrollDirection?setTimeout(e):e()}),[]);var ft;return ft=ot,(0,F.useEffect)((()=>{const t=t=>{if(t.ctrlKey)switch(t.key.toLowerCase()){case"home":t.preventDefault(),Q(ft.current,"before");break;case"end":t.preventDefault(),Q(ft.current,"after")}switch(t.key.toLowerCase()){case"pageup":J(ft.current,"before",t);break;case"pagedown":J(ft.current,"after",t)}};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}),[]),(0,s.FD)(F.Fragment,{children:[et&&(0,s.Y)(Z,{}),(0,s.Y)("div",{role:"feed",ref:ot,style:{height:pt.getTotalSize(),position:"relative",overflowAnchor:"none"},children:ut.map((e=>{const{item:i}=o[e.index];return(0,W.O0)(e.key)?(0,s.Y)("article",{"data-index":e.index,ref:rt?yt:void 0,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start-pt.options.scrollMargin}px)`},tabIndex:0,"aria-labelledby":(a=e.index,`${(0,H._)(a)} ${(0,H._)(a,!0)} ${(0,$.y)(a)} ${(0,$.y)(a,!0)} ${(0,K.l)(a)} ${(0,K.l)(a,!0)}`),"aria-setsize":-1,"aria-posinset":e.index,children:t({index:e.index,item:i,getItemUiState:n,scheduleAdsInvalidation:I,observers:lt,uniqueItemId:e.key})},e.key):null;var a}))})]})})),et=(0,o.P)((function({children:t,scrollContainerRef:e}){return(0,s.Y)(tt,{scroll:Y.Ox,useItemsVirtualizer:t=>(0,R.Te)({...t,getScrollElement:()=>e.current??null}),children:t})})),it=(0,o.P)((function({children:t}){return(0,s.Y)(tt,{scroll:Y.e8,useItemsVirtualizer:t=>(0,R.XW)({...t,observeElementOffset:z}),children:t})}));function st({children:t,feedServiceDecorator:e,historyKey:i,...o}){return function(t,e){const i=X(e);(0,F.useEffect)((()=>{const s=s=>{(function(t){if("object"==typeof t&&null!==t&&"detail"in t){const e=t.detail;return"object"==typeof e&&null!==e&&"feedId"in e&&"string"==typeof e.feedId}return!1})(s)&&e===i&&t.cleanupAndFetchFeedOnUrlChange({count:5},!0)};return window.addEventListener("feed-refresh",s),()=>window.removeEventListener("feed-refresh",s)}),[t,e,i])}(e,i),(0,s.Y)(M,{feedServiceDecorator:e,...o,children:o.scrollContainerRef?(0,s.Y)(et,{scrollContainerRef:o.scrollContainerRef,children:t}):(0,s.Y)(it,{children:t})})}},527652:(t,e,i)=>{i.d(e,{y:()=>s});const s=(t,e=!1)=>`subtitle-${t}${e?"-nested":""}`},874167:(t,e,i)=>{i.d(e,{l:()=>s});const s=(t,e=!1)=>`text-${t}${e?"-nested":""}`},11830:(t,e,i)=>{i.d(e,{_:()=>s});const s=(t,e=!1)=>`title-${t}${e?"-nested":""}`},57596:(t,e,i)=>{i.d(e,{M:()=>H});var s=i(221020),o=i(225505),n=i(314817),a=i(187233),r=i(700777),d=i(516427),c=i(235834),l=i(505174),h=i(180329),p=i(638945),u=i(772812),g=i(982444),_=i(182023),m=i(928959),v=i(356035),y=i(815287),f=i(518227),S=i(331635),w=i(327813),b=i(42107),P=i(345482),A=i(651253);const k=t=>t instanceof HTMLImageElement,C=t=>t instanceof HTMLBRElement;var I=i(326107),E=i(649515);const L=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$"),T=t=>{let e="";if(t.className.includes("emoji")){let i=t.src&&t.src.match(/\/([a-f0-9*]+)(_2x)?.png/);e=i?i[1]:t.getAttribute("emoji")??""}return e},M=t=>(t||"").replace(/^\s+|\s+$/g,""),O=t=>{if(!t)return"";let e,i=t.firstChild,s="";for(;i;){switch(i.nodeType){case 3:i instanceof Text&&(e=i.data.replace(/[ ]+/g," "),s+=e);break;case 1:if(e=O(i),(0,I.vq)(i)&&i.tagName.match(L)&&e){e.endsWith("\n")||(e+="\n");let t=i.previousSibling;for(;t&&3===t.nodeType&&""===M(t.nodeValue);)t=t.previousSibling;!t||(0,I.vq)(t)&&(t.tagName.match(L)||C(t))||(e="\n"+e)}else if(k(i)){let t=T(i);t&&(e+=(0,E.R)(t))}else C(i)&&(e+="\n");s+=e}i=i.nextSibling}return s};var D=i(69789),x=i(778722),R=i(486526),Y=i(645964),F=i(511806);const B=({profile:t,group:e,app:i})=>{let s="",o="",n="";return t?(s=(0,Y.Cg)({...t,maiden_name:""}),o="domain"in t?String(t.domain):"",n=(0,F.R)(t)):e?(s=(e.name||"").replace(/[()]/g,""),o=e.screen_name||"",n=(0,F.R)(e)):i&&(s=i.title||"",o=i.screen_name||"",n=i.icon_75||""),{name:s,domain:o,avatar:n}};class N{get inputRef(){return this.props.current.inputRef}get containerRef(){return this.props.current.containerRef}get isLoading(){return Boolean(this._abortController)}async getMentionsList(t){if(this._prevQuery!==t||!this.mentionsList.length){this._abortController?.abort(),this._abortController=new AbortController;try{const e=await this.searchApi.getHints({q:t,search_global:1,fields:D.nP},{signal:this._abortController.signal});(0,w.h5)((()=>{this.mentionsList=e.items,this._prevQuery=t}))}catch(t){x.E||this.errorLogger.log(t)}finally{(0,w.h5)((()=>{this._abortController=null}))}}}[b.zr](){this.clearMentions()}constructor(t,e,i){this.props=t,this.searchApi=e,this.errorLogger=i,this.mentionsList=[],this._abortController=null,this._selectedRange=null,this._prevQuery="",this.onClickMention=t=>{const e=this.mentionsList[t];if(e){const{name:t,domain:i}=B(e);this.setMentionQuery(i,t,this.props.current.onChangeText)}},this.getMentionQuery=()=>{const t=this.inputRef?.current;let e;if(t&&["textarea","input"].includes(t.tagName.toLowerCase()))e=t.value.slice(0,t.selectionEnd??t.value.length);else{const t=(0,_.qK)();if(!t)return null;this._selectedRange=t,e=t.endContainer.childNodes.length?t.endContainer.childNodes[Math.max(t.endOffset-1,0)]?.textContent:t.endContainer.textContent?.slice(0,t.endOffset)}return e?.match(RegExp("(^@|\\s@|^#\\w+@|^\\*|\\s\\*)([\\p{L}\\d_.]+$|$)","u"))?.[2]},this.setMentionQuery=(t,e,i)=>{const s=this.inputRef?.current,o=!!s&&["textarea","input"].includes(s.tagName.toLowerCase()),n=o?(t=>{const e=t.value??"";return{text:e,caretIndex:null!=t.selectionEnd?t.selectionEnd:e.length}})(s):(t=>{if(!t)return null;const e=t.endContainer?.textContent??"";return e?{text:e,caretIndex:t.endOffset}:null})(this._selectedRange);if(n){let a=n.caretIndex;const r=n.caretIndex;for(;a>0&&!/[@*]/.test(n.text[a-1]);)a--;const d=n.text[a-1]||"";if("@"===d||"*"===d){const d=/\w/.test(n.text[a-2]||""),c=`${t}${d?" ":` (${e}) `}`,l=n.text.slice(0,a)+c+n.text.slice(r);let h=a+t.length+1;if(d||(h+=e.length+3),o){s.value=l;try{s.setSelectionRange(h,h)}catch(t){this.errorLogger.log(t)}s.focus(),i?.(O(s))}else if(this._selectedRange){const t=this._selectedRange.endContainer;if(!t)return;t.textContent=l;try{this._selectedRange.setStart(t,h),this._selectedRange.setEnd(t,h),(0,_.eG)(this._selectedRange)}catch(t){this.errorLogger.log(t)}let e=this._selectedRange.endContainer.parentElement?.closest("[contenteditable]")??null;!e&&this._selectedRange.endContainer instanceof HTMLElement&&(e=this._selectedRange.endContainer),e&&i?.(O(e))}}}this.mentionsList=[],this._prevQuery=""},this.checkMentions=(0,R.s)((async()=>{const t=this.getMentionQuery();"string"==typeof t?this.getMentionsList(t):this.clearMentions()}),500),this.clearMentions=()=>{this.mentionsList=[],this._prevQuery="",this._abortController?.abort()},(0,w.l_)(this)}}N=(0,S.Cg)([b.z8.transient(),(0,S.Sn)("design:type",Function),(0,S.Sn)("design:paramtypes",[void 0===b.Ji?Object:b.Ji,void 0===P.J?Object:P.J,void 0===A.v?Object:A.v])],N);const{Provider:z,useModel:V}=(0,b.Qd)(N,{initInEffect:!1}),U="Mentions__root--AXWZ3",G="Mentions__mentions--Gj7Sr";var j=i(91720);const W=(0,v.P)((function(){const{onClickMention:t,checkMentions:e,mentionsList:i,isLoading:v,inputRef:S,containerRef:w}=V(),b=(0,y.useRef)(null),[P,A,k]=(0,f.i)(0);(0,y.useEffect)((()=>{b.current&&b.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),[b.current]),(0,y.useEffect)((()=>{A(0)}),[i]),(0,y.useEffect)((()=>{v&&!i.length&&w?.current&&(0,_.mG)(w.current)}),[v]);const C=(0,y.useCallback)((e=>{!v&&i.length&&("ArrowUp"===e.key?((0,m.T)(e),A((t=>Math.max(0,t-1)))):"ArrowDown"===e.key?((0,m.T)(e),A((t=>Math.min(i.length-1,t+1)))):"Enter"===e.key&&((0,m.T)(e),t(k.current)))}),[i,v,k]),I=()=>{e()};return(0,y.useEffect)((()=>(document.addEventListener("keydown",C),S?.current?.addEventListener("click",I),S?.current?.addEventListener("input",I),()=>{document.removeEventListener("keydown",C),S?.current?.removeEventListener("click",I),S?.current?.removeEventListener("input",I)})),[]),v||i.length?(0,s.FD)("div",{className:U,children:[(0,s.Y)(o.w,{wide:!0}),(0,s.Y)(n.g,{children:(0,s.Y)(a.i,{mode:"vertical",spacing:8,paddingTop:4,paddingBottom:4,className:G,children:v?(0,s.Y)(a.i,{children:(0,s.Y)(r.q,{})}):i.map(((e,i)=>{const{avatar:o,name:n,domain:a}=B(e);return(0,s.Y)(d.SB4,{onClick:()=>t(i),onMouseOver:()=>A(i),hovered:P===i,getRootRef:P===i?b:null,children:(0,s.Y)(c.G,{before:(0,s.Y)(l.e,{size:20,src:o}),children:(0,s.FD)(h.s,{noWrap:!0,align:"center",children:[(0,s.Y)(p.$j,{Component:"span",className:(0,u.I)("color_text_primary"),children:n}),(0,s.Y)(g.K,{mode:"vertical",size:6}),(0,s.Y)(p.tW,{className:(0,u.I)("color_text_secondary"),children:"@"+a})]})})},e.profile?.id||e.group?.id||i)}))})})]}):null}));W.displayName="Mentions";const H=(0,j.N)(z,W)},368970:(t,e,i)=>{i.d(e,{BG:()=>s,Ig:()=>o,JG:()=>a,Vy:()=>n});const s=50,o=40,n=44,a=24},953177:(t,e,i)=>{i.d(e,{HP:()=>s,Sj:()=>n,sr:()=>o,w3:()=>a});const s=500,o=10,n="wall_photo_attach",a=4294967296},383483:(t,e,i)=>{i.d(e,{M:()=>_});var s=i(331635),o=i(327813),n=i(42107),a=i(640290);var r=i(905582),d=i(63366),c=i(445426),l=i(182023),h=i(463882),p=i(651253),u=i(953177);const g=["video","photo","clip"];class _{setCallbacks(t){this._callbacks=Object.assign(this._callbacks,t)}setMaxAttachmentsCount(t){this._maxAttachmentsCount=t}parseUrls(t){let e=[];if(e=function(t,e){let i=/(?:([!()?@., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9_\-]+\.)+(?:[a-z]{2,10}|xn--p1ai|xn--j1amh|xn--80asehdb|xn--80aswg|xn--90ais))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)]*(&nbsp;|[ \t\r\n \u00A0]))|([!()?., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9а-яєґї_\-]+\.)+(?:рф|укр|онлайн|сайт|срб|бел))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)]*(&nbsp;|[ \t\r\n \u00A0])))/i;e&&(i=/(?:([!()?@., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9_\-]+\.)+(?:[a-z]{2,10}|xn--p1ai|xn--j1amh|xn--80asehdb|xn--80aswg|xn--90ais))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)&]*(&nbsp;|[ \t\r\n \u00A0]|$))|([!()?., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9а-яєґї_\-]+\.)+(?:рф|укр|онлайн|сайт|срб|бел))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)&]*(&nbsp;|[ \t\r\n \u00A0]|$)))/i);const s=[];let o;for(;t&&(o=t.match(i),o&&void 0!==o.index);){if(t=t.substr(o.index+o[0].length),!o||!o.length||o[0].startsWith("@"))continue;let e=0;o[4]||(e=7),s.push({url:o[2+e],query:o[5+e]||"",domain:o[4+e]})}return s}(t.replaceAll(this.aliasedLinkRegex,""),!0),!e.length)return[];return(0,r.A)(e,"url").map((({url:t})=>t))}setText(t){this._text=t}parseText(t){this.setText(t);const e=this.parseUrls(t),i=e.filter((t=>!this.parsedUrls.includes(t)));this.parsedUrls=e,i.length&&this.triggerParseDebounced(i)}get attachments(){return this._callbacks.getAttachments?.()??[]}handleMediaAttachment(t){const e=t.filter((t=>g.includes(t.type)));if(!e.length)return;const i=this.attachments;let s=this._text;const o=[];e.forEach((t=>{const{itemId:e,ownerId:n}=(0,c.AJ)(t),a=i.find((0,c.tx)(t.type,e,n));if(t.source_url&&!a){const e=this.getUrlRegex(t.source_url),i=this.getUrlRegex(decodeURIComponent(t.source_url));o.push(e,i),s=s.replace(e,"").replace(i,"")}})),o.length&&this.deletedUrls.push(...o),s!==this._text&&this._callbacks.onUpdateText?.(s)}filterAttachmentsByLimit(t){const e=[];let i=this._callbacks.getAttachmentsLength?.(!0)??0;return t.forEach((t=>{(t=>"photo"===t.type||"video"===t.type)(t)&&++i>this._maxAttachmentsCount||e.push(t)})),e}get aliasedLinkRegex(){return new RegExp("(?:\\[[^\\]]*\\]|\\[[^\\]\\s]*(?=\\s|$))","gm")}[n.zr](){this.fetching=!1,this.hasError=!1}constructor(t,e){this.wallService=t,this.errorLogger=e,this._callbacks={},this._text="",this._maxAttachmentsCount=u.sr,this.fetching=!1,this.hasError=!1,this.deletedUrls=[],this.parsedUrls=[],this.clearParsedUrls=()=>{this.parsedUrls=[]},this.triggerParseDebounced=(0,d.A)((async t=>{this.fetching=!0;try{const e=await this.wallService.parseAttachedLink({links:JSON.stringify(t),name_case:"Gen",parsing_type:"posting_v2"});(0,o.h5)((()=>{if(!e.data.length)return;let t=e.data;this._callbacks.canAddAttachmentWithFeedback&&(t=e.data.filter((({type:t})=>this._callbacks.canAddAttachmentWithFeedback?.({type:t}))));const i=this.filterAttachmentsByLimit(t);this.handleMediaAttachment(i);const s=i.map((t=>g.includes(t.type)?t:{...t,parsed:!0}));this._callbacks.onAddAttachments?.(s,!0)}))}catch(t){(0,o.h5)((()=>{this.hasError=!0}))}finally{(0,o.h5)((()=>{this.fetching=!1}))}}),500),this.clearDeletedUrls=()=>{this.deletedUrls=[]},this.removeTextFromContentEditable=(t,e,i="")=>{try{let s=(0,l.JC)(t);return t.innerText.includes(e)&&(t.innerText=t.innerText.replace(e,i),s+=i.length-e.length,(0,l.vZ)(t,s)),!0}catch{}return!1},this.removeRegexFromContentEditable=(t,e,i="")=>{try{let s=(0,l.JC)(t);if(e.test(t.innerText)){t.innerText=t.innerText.replace(e,i);const o=t.innerText.match(e)?.[0];return s+=i.length-(o?.length??0),(0,l.vZ)(t,s),!0}}catch(t){this.errorLogger.log(t)}return!1},this.getUrlRegex=t=>new RegExp(`(?<!\\[)(${(0,h.N)(t)})(?!\\|[^\\]]*\\])`),(0,o.l_)(this)}}_=(0,s.Cg)([n.z8.transient(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.C?Object:a.C,void 0===p.v?Object:p.v])],_)},174520:(t,e,i)=>{i.d(e,{H:()=>o,d:()=>s});const s=-6,o=-7},443680:(t,e,i)=>{i.d(e,{N:()=>n});var s=i(690250),o=i(300806);const n=(t=[],e)=>{const i=Math.ceil(e*Math.max(window.devicePixelRatio,1));if((0,s.fA)(t)){const e=(0,s.My)(t,i);return e?.url}return(0,o.q)(t,i)?.url}},533293:(t,e,i)=>{i.d(e,{B:()=>f});var s=i(331635),o=i(327813),n=i(99201),a=i(651253),r=i(42107),d=i(725308);class c{constructor(t,e){this.photosApi=t,this.errorLogger=e,this._uploadUrlPromise=null,this._photoUploadUrl="",this.fetchPhotoUploadServer=async()=>{if(this._photoUploadUrl||this._uploadUrlPromise)return this._uploadUrlPromise?this._uploadUrlPromise:{upload_url:this._photoUploadUrl};try{this._uploadUrlPromise=this.photosApi.getWallUploadServer({upload_v2:1},{grouping:!1});const t=await this._uploadUrlPromise;return(0,o.h5)((()=>{t.upload_url&&(this._photoUploadUrl=t.upload_url)})),t}catch(t){throw t}finally{(0,o.h5)((()=>{this._uploadUrlPromise=null}))}},this.savePhoto=(t,e,i)=>{const s={photo:t,upload_v2:1};return e.ownerId&&d.z.isGroupId(e.ownerId)?s.group_id=d.z.convertOwnerIdToGroupId(e.ownerId):s.user_id=e.ownerId,this.photosApi.saveWallPhoto(s,{grouping:!1,...i})},(0,o.l_)(this)}}c=(0,s.Cg)([r.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.U?Object:n.U,void 0===a.v?Object:a.v])],c);var l=i(375512),h=i(617989),p=i(328911);const u=new Set(["avi","mp4","3gp","mpeg","mov","flv","f4v","wmv","mkv","webm","vob","rm","rmvb","m4v","mpg","ogv","ts","m2ts","mts","mxf","quicktime"]);var g=i(407072);class _{get videos(){return this._videos}get inputAccept(){return["video/*",...Array.from(u).map((t=>`.${t}`))].join(",")}clearState(){this._controllers.forEach((t=>{t.abort()})),this._encodeTimeoutIds.forEach((t=>{clearTimeout(t)})),this._controllers=new Map,this._encodeTimeoutIds=new Map,this._uploadSessions=[],this._videos=new Map}constructor(t,e){this.videoApi=t,this.errorLogger=e,this._uploadSessions=[],this._videos=new Map,this._controllers=new Map,this._encodeTimeoutIds=new Map,this.uploadVideos=async({files:t,ownerId:e,params:i={},callbacks:s})=>{const o=(t=>t.reduce(((t,e,i)=>{const s=(e.name.split(".").pop()||"").toLowerCase(),o=u.has(s);return(e.type&&e.type.match(/^video/i)||o)&&("id"in e||(e.id=String(Date.now()+i)),t.push(e)),t}),[]))(t);s?.setFilteredFiles&&await s.setFilteredFiles(o),o.length!==t.length&&s?.onUnsupportedVideoFormatError?.(t.length-o.length),e&&d.z.isGroupId(e)&&(i.group_id=d.z.convertOwnerIdToGroupId(e));for(const t of o){if(!t)return;this._controllers.set(t.id,new AbortController);try{const{video_id:e=0,owner_id:o=0,upload_url:n}=await this.videoApi.save(i,{signal:this._controllers.get(t.id)?.signal});if(s?.updateVideo?.({id:e,owner_id:o},g.q.Uploading,t.id),this._videos.set((0,p.o)({itemId:e,ownerId:o}),{videoId:e,ownerId:o,uploadUrl:n,file:t,status:n?g.q.Uploading:g.q.UploadError,encodePercents:0,uploadPercents:0}),!n)return;const a=l.wn.createUploadSession(n,t,{chunkSize:4194304,threadNumber:4,maxRetryNumber:10,label:t.id??Date.now().toString(),headers:{"Session-ID":(1e17*Math.random()).toString(16)},onProgress:t=>{this.updateVideo({videoId:e,ownerId:o,uploadPercents:t})},onSuccess:e=>this.encodeVideo(e,t.id,s),onFail:()=>{s?.errorVideo?.(e,o),this.updateVideo({videoId:e,ownerId:o,status:g.q.UploadError})}});this._uploadSessions.push(a),a.upload()}catch(i){"AbortError"!==i?.error?.name&&s?.errorVideo?.(Number(t.id),e,i),this.errorLogger.log(i)}finally{this._controllers.delete(t.id)}}},this.encodeVideo=async(t,e,i)=>{const{video_id:s,owner_id:o,video_hash:n}=t;this.updateVideo({videoId:s,ownerId:o,status:g.q.Encoding}),this._controllers.set(e,new AbortController);try{const a=await this.videoApi.encodeProgress({video_id:s,owner_id:o,hash:n},{signal:this._controllers.get(e)?.signal});if(a){const{error:t,is_claimed:r,thumb:d,all_thumbs:c,percents:l,is_uv_upload:h,duration:p}=a;if(t)return void this.updateVideo({videoId:s,ownerId:o,status:g.q.EncodeError});if(r)return this.updateVideo({videoId:s,ownerId:o,status:g.q.BlockedError}),void i?.onBlockedVideoError?.(s,o);const u={id:s,owner_id:o,access_key:n};if(a.duration&&(u.duration=a.duration),a.image?.length&&(u.image=a.image.filter((t=>!t.with_padding))),l>=100&&(void 0!==p||h)&&d&&c)return i?.updateVideo?.(u,g.q.Encoded,e),void this.updateVideo({videoId:s,ownerId:o,status:g.q.Encoded,encodePercents:l});i?.updateVideo?.(u,g.q.Encoding,e),this.updateVideo({videoId:s,ownerId:o,encodePercents:l})}const r=setTimeout((()=>this.encodeVideo(t,e,i)),1e3);this._encodeTimeoutIds.set(e,r)}catch(t){"AbortError"!==t?.error?.name&&i?.errorVideo?.(s,o,t),this.updateVideo({videoId:s,ownerId:o,status:g.q.EncodeError})}finally{this._controllers.delete(e)}},this.updateVideo=({videoId:t,ownerId:e,status:i,uploadPercents:s,encodePercents:o})=>{const n=(0,p.o)({itemId:t,ownerId:e}),a=this._videos.get(n);a&&("number"==typeof s&&(a.uploadPercents=s),"number"==typeof o&&(a.encodePercents=o),i&&a.status!==i&&(a.status=i))},this.removeVideo=(t,e)=>{this._videos.delete((0,p.o)({itemId:t,ownerId:e}))},this.cancelUpload=()=>{this._uploadSessions.forEach((t=>{try{t.cancel()}catch(t){this.errorLogger.log(t)}}))},this.cancelVideoUpload=t=>{this._controllers.get(t)?.abort(),clearTimeout(this._encodeTimeoutIds.get(t));const e=this._uploadSessions.find((e=>e.key.split("_")[0]===t));if(e)try{e.cancel()}catch(t){this.errorLogger.log(t)}},(0,o.l_)(this)}}_=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===h.C?Object:h.C,void 0===a.v?Object:a.v])],_);var m=i(184840),v=i(848500),y=i(953177);class f{get videos(){return this.videoUploadService.videos}get photos(){return this.photoUploadService.photos}removeAttachment(t,e,i){if("photo"===t){const t=this.photos?.find((t=>t.realPhotoId===e))?.temporaryId;t&&this.photoUploadService.removePhoto(t)}else"video"===t&&e&&i&&this.videoUploadService.removeVideo(e,i)}get inputAccept(){return`${this.videoUploadService.inputAccept},${this.photoUploadService.inputAccept}`}setOwnerId(t){this._ownerId=t,this.photoUploadService.setPayload({ownerId:t})}setMaxAttachmentsCount(t){this._maxAttachmentsCount=t,this.photoUploadService.setMaxPhotosCount(t)}[r.zr](){this.videoUploadService.clearState(),this.photoUploadService.clearState()}constructor(t,e){this.uploadPhotoAttachService=t,this.videoUploadService=e,this._ownerId=null,this._maxAttachmentsCount=y.sr,this._callbacks={},this.setCallbacks=t=>{this._callbacks=Object.assign(this._callbacks,t)},this.uploadFiles=t=>{const e=this._callbacks.getAttachmentsLength?.()||0,i=t.length;t.length=Math.min(t.length,this._maxAttachmentsCount-e),i!==t.length&&this._callbacks.onLimitExceededError?.(i-t.length);const s=t.filter((t=>t.size<y.w3));s.length!==t.length&&this._callbacks.onSizeExceedsLimitError?.();const o=s.map((t=>(t.id=String(Date.now()+Math.floor(1e3*Math.random())),t))),n=o.filter((t=>(0,v.HY)(t,this.videoAcceptTypesArray))),a=o.filter((t=>(0,v.HY)(t,this.photoAcceptTypesArray)));a.forEach((t=>{this._callbacks.logStartFileUploading?.({rawId:t.id,fileType:"photo",fileSize:t.size})})),n.forEach((t=>{this._callbacks.logStartFileUploading?.({rawId:t.id,fileType:"video",fileSize:t.size})})),!a.length||this._callbacks.canAddAttachmentWithFeedback&&!this._callbacks.canAddAttachmentWithFeedback({type:"photo"})||(this.photoUploadService.setCallbacks({onReceivedRealPhotoId:this._callbacks.updatePhoto,onErrorUploadFile:this._callbacks.errorPhoto}),this.photoUploadService.uploadPhotos({files:a,onFilteredPhotos:t=>{this._callbacks.setFilteredFiles?.(t)}})),this._ownerId&&n.length&&(!this._callbacks.canAddAttachmentWithFeedback||this._callbacks.canAddAttachmentWithFeedback({type:"video"}))&&this.videoUploadService.uploadVideos({files:n,ownerId:this._ownerId,params:{target:"post"},callbacks:this._callbacks}),t.length!==n.length+a.length&&this._callbacks.onUnsupportedFileFormatError?.()},this.getPercents=(t,e)=>{for(const[,i]of this.videos)if(i.videoId===t&&i.ownerId===e||i.file?.id===String(t))return i.uploadPercents/2+i.encodePercents/2;const i=this.photos.find((e=>e.realPhotoId===t||Number(e.file?.id)===t));return i?.progress||0},this.pasteFilesFromClipboard=t=>{t.preventDefault(),t.stopPropagation();const e=t.clipboardData?.items;if(!e)return;const i=[];for(let t=0;t<e.length;t++){const s=e[t].type.split("/")[1];if(this.inputAccept.includes(s)){const s=e[t].getAsFile();s&&i.push(s)}}i.length&&this.uploadFiles(i)},this.cancelAttachUpload=t=>{if("video"===t.type){const e=Number(t.video?.id),i=this.videoUploadService.videos.get((0,p.o)({itemId:e,ownerId:Number(t.video?.owner_id)}));this.cancelUpload(i?.file?.id??e)}else if("photo"===t.type){const e=Number(t.photo?.id),i=this.photoUploadService.photos.find((t=>t.realPhotoId===e||Number(t.file?.id)===e));this.cancelUpload(i?.file?.id??e)}},this.cancelUpload=t=>{this.videoUploadService.cancelVideoUpload(String(t)),this.photoUploadService.cancelPhotoUpload(String(t))},(0,o.l_)(this),this.photoUploadService=new m.t({errorLogger:this.uploadPhotoAttachService.errorLogger,uploaderId:y.Sj,savePhoto:this.uploadPhotoAttachService.savePhoto,fetchUploadServer:this.uploadPhotoAttachService.fetchPhotoUploadServer,onLimitExceededError:this._callbacks.onLimitExceededError,onUnsupportedFormatError:this._callbacks.onUnsupportedPhotoFormatError}),this.photoAcceptTypesArray=this.photoUploadService.inputAccept.split(","),this.videoAcceptTypesArray=this.videoUploadService.inputAccept.split(",")}}f=(0,s.Cg)([r.z8.transient(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===c?Object:c,void 0===_?Object:_])],f)},86218:(t,e,i)=>{i.d(e,{S:()=>u});var s=i(331635),o=i(42107),n=i(289375),a=i(849645),r=i(810638),d=i(529275),c=i(42334),l=i(344550);class h{get screen(){return this.metaData.get().screen}getBlockState(t,e){return this.blockStateManager.get(t)??this.blockStateManager.get(e)}constructor(t,e,i,s,o){this.productionStats=t,this.metaData=e,this.feedEntitiesStore=i,this.blockStateManager=s,this.errorLogger=o,this.sendViewTime=({itemId:t,startTime:e,endTime:i,itemType:s,index:o,width:n,height:a,stateAsync:d})=>{const c=this.feedEntitiesStore.getItem(t),l=s,h=c?.value.track_code??"";if(!d){const e=this.getBlockState(s,t);e?d=e?.status:(d=r.T.NONE,this.errorLogger.log(`block state not found for type - ${l}`))}const p=i-e;this.log({type:"type_feed_recommendation_block_view",type_feed_recommendation_block_view:{ref:this.screen,time:Date.now()??0,position:o,state_async:d,duration_async:d!==r.T.LOADED?p:0,block_type:l,track_code:h,width:n,height:a}})},this.sendView=t=>{const{itemId:e,itemType:i,index:s}=t,o=this.feedEntitiesStore.getItem(e),n=o?.value.track_code??"";this.log({type:"type_feed_recommendation_block_view",type_feed_recommendation_block_view:{ref:this.screen,time:Date.now()??0,track_code:n,position:s,block_type:i}})},this.log=t=>{this.productionStats.send({type:"type_view",screen:this.screen,type_view:t})},o.setConfig({scope:"RecBlocksViewCollector"})}}h=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.X?Object:n.X,void 0===a.e?Object:a.e,void 0===d.B?Object:d.B,void 0===c.g?Object:c.g,void 0===l.X?Object:l.X])],h);var p=i(651253);class u{constructor(t,e){this.view=t,this.errorLogger=e,this.onStartViewBlock=this.view.sendView.bind(this.view),this.onEndViewBlock=this.view.sendViewTime.bind(this.view),this.onEndViewBlockTrackEventsAfterVisibilityChange=t=>{t.forEach((({statsData:t,type:e})=>{const i=t.itemType||e;i?this.view.sendViewTime({...t,itemType:i}):this.errorLogger.log(new Error("stats event should contain type field"))}))}}}u=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===h?Object:h,void 0===p.v?Object:p.v])],u)},903473:(t,e,i)=>{i.d(e,{v:()=>s});class s{get id(){return this.item.id}startView(){this.startTime=performance.now(),this.visible=!0}endView(){this.endTime=performance.now(),this.visible=!1}endViewOnVisibility(){this.endTime=performance.now()}reset(){this.startTime=-1,this.endTime=-1,this.visible=!1}resetWithTimer(){return window.setTimeout((()=>{this.reset()}),2500)}setScreen(t){this._screen=t}setSize(t,e){this.size={width:t,height:e}}get screen(){return this._screen}get canStartTracking(){return-1===this.startTime&&!this.visible}get isViewStarted(){return this.visible&&-1!==this.startTime}constructor({item:t,element:e,index:i}){this.visible=!1,this.startTime=-1,this.endTime=-1,this.size={width:0,height:0},this._screen="",this.item=t,this.element=e,this.index=i}}},18574:(t,e,i)=>{i.d(e,{I:()=>r});var s=i(221020),o=i(356035),n=i(815287),a=i(812742);const r=(0,o.P)((function({children:t,onActiveEnable:e,onActiveDisable:i}){const o=function({onActiveDisable:t,onActiveEnable:e}){const i=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,a.g)();return(0,n.useEffect)((()=>{const n=new IntersectionObserver((([i])=>{if(1===i.intersectionRatio){const t=setTimeout((()=>{e()}),500);s.current=t}else if(0===i.intersectionRatio){const e=s.current;null!==e&&clearTimeout(e),t()}else{const t=s.current;null!==t&&clearTimeout(t)}}),{threshold:[0,1],rootMargin:o?`-${o}px 0px 0px 0px`:"0px"});return i.current&&n.observe(i.current),()=>{const t=s.current;null!==t&&clearTimeout(t),i.current&&n.unobserve(i.current)}}),[o]),i}({onActiveEnable:e,onActiveDisable:i});return(0,s.Y)("div",{ref:o,children:t})}))},585155:(t,e,i)=>{i.d(e,{I:()=>u});var s=i(221020),o=i(356035),n=i(1778),a=i(342495),r=i(705560),d=i(240557),c=i(818670);const l=({ActionComponent:t=c.f.Action,...e})=>(0,s.Y)(t,{"data-testid":"musicoverlaybadge-action-owning",SIdleIcon:n.w,SActiveIcon:a.N,MIdleIcon:r.F,MActiveIcon:d.O,...e});var h=i(286788);const p=({ActionComponent:t=h.f.Action,...e})=>(0,s.Y)(t,{"data-testid":"musicoverlaybadge-action-owning",SIdleIcon:n.w,SActiveIcon:a.N,MIdleIcon:r.F,MActiveIcon:d.O,...e}),u=(0,o.P)((function({action:t,size:e,ActionComponent:i,tooltipText:o,isRedesignEnabled:n,isTrackDisabled:a}){const{title:r,isActive:d,isPending:c,isDisabled:h,onExecute:u}=t;return n?(0,s.Y)(p,{active:d,loading:c,disabled:h||a,size:e,ActionComponent:i,onClick:u,tooltipText:o,"aria-label":r}):(0,s.Y)(l,{active:d,loading:c,disabled:h,size:e,ActionComponent:i,onClick:u,"aria-label":r})}))},876779:(t,e,i)=>{i.d(e,{z:()=>w});var s=i(221020),o=i(356035),n=i(511657),a=i(303521),r=i(206777),d=i(721665),c=i(772812),l=i(960625);const h={normal:{idle:n.h,plays:a.$},autoplay:{idle:r.e,plays:d.t}},p=({mode:t,state:e,label:i,...o})=>{const n=h[t][e];return(0,s.Y)(l.L,{"data-testid":"musicattach-playbackcontrol",label:i,...o,children:(0,s.Y)(n,{className:(0,c.I)("color_icon_contrast")})})};var u=i(191601),g=i(648179),_=i(558309),m=i(617981),v=i(56471);const y={normal:{idle:u.K,plays:g.o},autoplay:{idle:_.j,plays:m.k}},f=({mode:t,state:e,tooltipText:i,label:o,...n})=>{const a=y[t][e];return(0,s.Y)(v.f,{placement:"left",text:i,children:(0,s.Y)(l.L,{"data-testid":"musicattach-playbackcontrol",label:o,size:36,...n,children:(0,s.Y)(a,{className:(0,c.I)("color_icon_contrast")})})})};var S=i(946918);const w=(0,o.P)((function({player:t,disabled:e,isRedesignEnabled:i,onPlaybackControlClick:o,playbackControlState:n}){const a=(0,S.B)(),r=t.isPlaying?a.getLang("global_audio_pause"):a.getLang("global_audio_play"),d=e||t.isDisabled;function c(){d||(i?o?.():t.onTogglePlayWithAutoplay())}return i&&n?(0,s.Y)(f,{mode:t.settings.isAutoplayEnabled?"autoplay":"normal",state:n,onClick:c,disabled:d,"aria-label":r}):(0,s.Y)(p,{mode:t.settings.isAutoplayEnabled?"autoplay":"normal",state:b(t),onClick:c,disabled:d,"aria-label":r})}));function b({isPlaying:t}){return t?"plays":"idle"}},304322:(t,e,i)=>{i.d(e,{h:()=>d});var s=i(331635),o=i(42107),n=i(428069),a=i(524706),r=i(161308);class d{createMusicTrack(t){return this.musicFactory.createTrack({...t,channel:this.channel})}createPodcastEpisode(t){return this.podcastFactory.createEpisode({...t,channel:this.channel})}get channel(){return this.player.onMediaAttachment}constructor(t,e,i){this.player=t,this.musicFactory=e,this.podcastFactory=i}}d=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===r.Y?Object:r.Y,void 0===n.P?Object:n.P,void 0===a.O?Object:a.O])],d)},409588:(t,e,i)=>{i.d(e,{J:()=>_t});var s=i(221020),o=i(356035),n=i(526205),a=i(42107),r=i(18574),d=i(876779),c=i(434518),l=i(763812),h=i(331635),p=i(327813),u=i(721126),g=i(454718),_=i(830443),m=i(273193),v=i(916533),y=i(320366),f=i(313178),S=i(990126),w=i(159220),b=i(959267),P=i(861700),A=i(788535),k=i(655732),C=i(156589),I=i(304322),E=i(501429),L=i(759076),T=i(103312),M=(0,l._)("_analytics");let O=a.Ts,D=a.zr;class x{[O](){this.player.init(),this.reactions.reaction((()=>!!this.player.initialized&&this.isActive),(t=>{t?this.player.autoplay():this.player.autopause()}),{fireImmediately:!0}),this.reactions.reaction((()=>this.audioList),(t=>{this.player.destroy(),this._player=this.playerFactory.create({list:t,analytics:(0,c._)(this,M)[M]}),this.player.init()}))}[D](){this.reactions.destroy(),this.player.destroy()}get mode(){return this.props.current.mode}get isActive(){return this._isActive}get isDisabled(){return!!this.audio?.data.isBlocked}get audio(){const t=this.audioList.head.at(0);if(!t)return null;switch(t.type){case y.h.MusicTrack:return this.audioModelFactory.createMusicTrack({getSource:()=>({audio:t.data.apiAudio,trackCode:t.context.trackCode})});case y.h.PodcastEpisode:return this.audioModelFactory.createPodcastEpisode({getSource:()=>({audio:t.data.apiAudio,trackCode:t.context.trackCode})});default:(0,u.S)(t)}}get cover(){return this.audio?.cover??null}get legalNoticeLines(){return this.audio?.legalNoticeLines??null}get player(){return this._player}get isIdle(){return!this.player.isPlaying&&!this.player.isPaused}get myMusicAction(){const{audio:t}=this;return t&&t.type===y.h.MusicTrack?this.audioActionsProvider.provideToggleMyMusic({data:t.data,getSource:()=>({audio:t.data.apiAudio,trackCode:t.data.trackCode}),onExecuted:t=>{(0,c._)(this,M)[M].logToggleOwning({state:t.isActive})}}):null}get openMusicPageAction(){const{audio:t}=this;return t&&t.type===y.h.MusicTrack?this.audioActionsProvider.provideOpen({data:t.data,target:"_blank",onExecuted:()=>{(0,c._)(this,M)[M].logOpen({isAutoplayEnabled:this.settings.isAutoplayEnabled})}}):null}get tooltipTextActionLang(){const t=this.myMusicAction?.isActive?this.langs.getLang("audio_onmedia_remove_item"):this.langs.getLang("audio_onmedia_add_item");return this.langs.langReplace(t,{audio_item:this.langs.getLang("global_audio_track").toLowerCase()})}get tooltipTextInfoLang(){return this.langs.langReplace(this.langs.getLang("audio_onmedia_open_item"),{audio_item:this.langs.getLang("global_audio_track").toLowerCase()})}get tooltipTextCoverLang(){return this.player.isPlaying?this.langs.getLang("me_attach_track_pause_aria_label"):this.langs.getLang("global_audio_play")}get playbackControlState(){return this.player.isPlaying?"plays":"idle"}get isOnMediaAudioRedesignFixEnabled(){return this.settings.isOnMediaAudioRedesignFixEnabled}get audioList(){const{cachedAudioSource:t,cachedAudioList:e}=this,{audio:i}=this.props.current;return e&&t&&(0,g.b)(t,i)?e:(this.cachedAudioList=this.audioListProvider.createFromAPI([i]),this.cachedAudioSource=i,this.cachedAudioList)}makeAnalyticsPropsGetter(){return()=>({list:this.audioList,postActionAnalytics:this.props.current.postActionAnalytics,postClickAnalytics:this.props.current.postClickAnalytics,postHandlers:this.props.current.isSpa?this.postHandlers:void 0,feedItemId:this.props.current.postId})}constructor(t,e,i,s,o,n,a,r,d,l,h,u){Object.defineProperty(this,M,{writable:!0,value:void 0}),this.props=t,this.audioListProvider=e,this.playerFactory=i,this.settings=s,this.langs=o,this.postHandlers=d,this.audioModelFactory=l,this.cachedAudioSource=null,this.cachedAudioList=null,this.reactions=new _.O,this._isActive=!1,this.onActiveEnable=()=>{this._isActive=!0},this.onActiveDisable=()=>{this._isActive=!1},this.onMusicTrackOverlayBadgeClick=()=>{this.openMusicPageAction?.onExecute?.()},this.onPlaybackControlClick=()=>{this.player.onTogglePlayWithAutoplay()},this.onPlayClick=()=>{this.player.isDisabled||this.player.onTogglePlayWithAutoplay()},this.audioActionsProvider=new C.A({langs:o,authService:a,musicService:n,audioDislikesAnalytics:r,channel:i.channel,platformConfig:h,notifications:u,overrides:h.musicAudioActionOverrides}),(0,c._)(this,M)[M]=new T.L(this.makeAnalyticsPropsGetter()),this._player=this.playerFactory.create({list:this.audioList,analytics:(0,c._)(this,M)[M]}),(0,p.Gn)(this)}}(0,h.Cg)([p.sH.ref,(0,h.Sn)("design:type",void 0===w.g?Object:w.g)],x.prototype,"_player",void 0),(0,h.Cg)([p.sH],x.prototype,"_isActive",void 0),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"mode",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"isActive",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"isDisabled",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"audio",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"cover",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"legalNoticeLines",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"player",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"isIdle",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"myMusicAction",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"openMusicPageAction",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"tooltipTextActionLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"tooltipTextInfoLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"tooltipTextCoverLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"playbackControlState",null),(0,h.Cg)([p.XI.bound],x.prototype,"onActiveEnable",void 0),(0,h.Cg)([p.XI.bound],x.prototype,"onActiveDisable",void 0),(0,h.Cg)([p.XI.bound],x.prototype,"onMusicTrackOverlayBadgeClick",void 0),(0,h.Cg)([p.XI.bound],x.prototype,"onPlaybackControlClick",void 0),(0,h.Cg)([p.XI.bound],x.prototype,"onPlayClick",void 0),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],x.prototype,"isOnMediaAudioRedesignFixEnabled",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type","undefined"==typeof IAttachmentAudioList?Object:IAttachmentAudioList),(0,h.Sn)("design:paramtypes",[])],x.prototype,"audioList",null),x=(0,h.Cg)([a.z8.transient(),(0,h.Sn)("design:type",Function),(0,h.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===f.z?Object:f.z,void 0===b.i?Object:b.i,void 0===E.m?Object:E.m,void 0===m.Y?Object:m.Y,void 0===S.v?Object:S.v,void 0===v.u?Object:v.u,void 0===k.$?Object:k.$,void 0===L.i?Object:L.i,void 0===I.h?Object:I.h,void 0===P.w?Object:P.w,void 0===A.F?Object:A.F])],x);const{Provider:R,useModel:Y}=(0,a.Qd)(x,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var F=i(634164),B=i(928959),N=i(56471),z=i(516427),V=i(180329),U=i(638945),G=i(818670),j=i(947008);var W=i(450103);function H(t){const e=(0,W.V)();return{maxWidth:t.maxWidth??e.maxWidth}}const $="vkitMusicTrackOverlayBadge__root--3xbP7",K="vkitMusicTrackOverlayBadge__rootDisabled--lfiIn",q="vkitMusicTrackOverlayBadge__title--h5gdn",Q=({title:t,action:e,noticeIcon:i,cover:o,coverAlt:n="Music track cover",titleTickerMode:a,disabled:r,tooltipText:d,...c})=>{const{maxWidth:l}=H(c),h={maxWidth:l},p=function(t,e){if((0,j.Et)(e))return Math.max(e-48+(t?0:16),0)}(!!e,l);return(0,s.Y)(N.f,{placement:"top",text:d,shown:!!r&&void 0,"data-testid":"music-track-overlay-badge",children:(0,s.Y)(z.SB4,{style:h,className:(0,F.$)($,r&&K),...c,children:(0,s.FD)(V.s,{gap:4,direction:"row",align:"center",margin:"none",noWrap:!0,children:[(0,s.Y)(G.f.Cover,{size:"s",src:o,alt:n}),(0,s.Y)(G.f.FadedTicker,{mode:a,maxWidth:p,children:(0,s.Y)(U.HL,{weight:"2",className:q,"data-testid":"music-track-overlay-badge-title",children:t})}),!(!i&&!e)&&(0,s.Y)(V.s.Item,{children:(0,s.FD)(V.s,{gap:4,align:"center",margin:"none",noWrap:!0,onClick:B.T,onMouseEnter:B.T,onMouseLeave:B.T,children:[!!i&&(0,s.Y)(V.s.Item,{children:i}),!!e&&(0,s.Y)(V.s.Item,{children:e})]})})]})})})};var J=i(187233),X=i(982444),Z=i(702484),tt=i(286788),et=i(663194);const it="vkitMusicTrackOverlayBadge__root--2zKcB",st="vkitMusicTrackOverlayBadge__rootDisabled--e2JnY",ot="vkitMusicTrackOverlayBadge__text--9LqrT",nt="vkitMusicTrackOverlayBadge__title--OiUHc",at="vkitMusicTrackOverlayBadge__contentFlexItem--dV9k8",rt=({title:t,action:e,noticeIcon:i,cover:o,coverIconName:n,coverAlt:a="Music track cover",titleTickerMode:r,disabled:d,coverButtonAriaLabel:c,infoButtonAriaLabel:l,tooltipText:h,tooltipTextCover:p,tooltipTextInfo:u,tooltipTextAction:g,onCoverClick:_,onTextInfoClick:m,...v})=>{const{maxWidth:y}=H(v),{ref:f,sizes:S}=(0,Z.L)(),w={maxWidth:y},b=function(t,e,i){if((0,j.Et)(e))return Math.max(e-et.Vv+(t?0:et.zh)+(i?0:et.Ap),0)}(!!e,y,!!i);return(0,s.Y)(N.f,{placement:"top",text:h,shown:!!d&&void 0,"data-testid":"musictrackoverlaybadge_roottooltip",children:(0,s.Y)(J.i,{style:w,className:(0,F.$)(it,d&&st),...v,children:(0,s.FD)(V.s,{gap:[8,0],direction:"row",align:"center",margin:"none",noWrap:!0,children:[(0,s.Y)(V.s.Item,{flex:"fixed",children:(0,s.Y)(N.f,{placement:"top",text:p,maxWidth:et.wo,offsetByMainAxis:2,"data-testid":"musictrackoverlaybadge_coverbuttontooltip",children:(0,s.Y)(z.SB4,{onClick:_,hoverMode:"none",disabled:d,focusVisibleMode:"outside","aria-label":c,"data-testid":"musictrackoverlaybadge_coverbutton",children:(0,s.Y)(tt.f.Cover,{size:"m",src:o,alt:a,overlayIconName:n})})})}),(0,s.Y)(V.s.Item,{className:at,children:(0,s.FD)(V.s,{gap:[4,0],direction:"row",align:"center",margin:"none",noWrap:!0,children:[(0,s.Y)(V.s.Item,{className:at,style:{maxWidth:S.width>=et.dU?`${S.width}px`:"100%"},children:(0,s.Y)(N.f,{placement:"top",text:u,maxWidth:et.wo,offsetByMainAxis:4,"data-testid":"musictrackoverlaybadge_infobuttontooltip",children:(0,s.Y)(z.SB4,{onClick:m,className:ot,hoverMode:"none",disabled:d,"aria-label":l,"data-testid":"musictrackoverlaybadge_infobutton",children:(0,s.Y)(tt.f.FadedTicker,{mode:S.width>=et.dU?r:"none",maxWidth:b,TypographyComponent:U.tW,typographyProps:{weight:"2"},children:(0,s.Y)(U.tW,{weight:"2",className:nt,getRootRef:f,children:t})})})})}),!(!i&&!e)&&(0,s.Y)(V.s.Item,{children:(0,s.FD)(V.s,{gap:[4,0],align:"center",margin:"none",noWrap:!0,onClick:B.T,onMouseEnter:B.T,onMouseLeave:B.T,children:[(e||i)&&(0,s.Y)(X.K,{size:4,mode:"vertical"}),!!i&&(0,s.Y)(V.s.Item,{children:i}),!!e&&(0,s.Y)(V.s.Item,{children:(0,s.Y)(N.f,{placement:"top",text:g,maxWidth:et.wo,offsetByMainAxis:2,"data-testid":"musictrackoverlaybadge_actiontooltip",children:e})})]})})]})})]})})})};var dt=i(585155),ct=i(955611),lt=i(898018),ht=i(946918);const pt=(0,o.P)((function(){const t=(0,ht.B)(),e=Y(),{onPlayClick:i,player:o,audio:n,myMusicAction:a,isDisabled:r,openMusicPageAction:d,legalNoticeLines:c,tooltipTextActionLang:l,tooltipTextInfoLang:h,tooltipTextCoverLang:p,isOnMediaAudioRedesignFixEnabled:u}=e;if(!n)return;const g=o.isPlaying?t.getLang("global_audio_pause"):t.getLang("global_audio_play"),_=t.getLang("audio_restriction_title_geo");return(0,s.FD)(s.FK,{children:[u&&(0,s.Y)(rt,{title:(0,s.Y)(ct.F,{audio:n}),action:a&&(0,s.Y)(dt.I,{action:a,size:"m",tooltipText:l,isRedesignEnabled:u}),cover:e.cover?.pickByWidth(22)?.src,coverIconName:o.isPlaying?"pause":"play",titleTickerMode:ut({isDisabled:r}),onCoverClick:i,onTextInfoClick:()=>{d?.href&&(window.open(d?.href,d?.target,"noopener,noreferrer"),e.onMusicTrackOverlayBadgeClick?.())},onClick:t=>(t.preventDefault(),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),!1),"aria-label":g,tooltipText:_,tooltipTextCover:p,tooltipTextInfo:h,noticeIcon:!!c?.length&&(0,s.Y)(lt.X,{lines:c})}),!u&&(0,s.Y)(Q,{title:(0,s.Y)(ct.F,{audio:n}),action:a&&(0,s.Y)(dt.I,{action:a,size:"s"}),cover:e.cover?.pickByWidth(22)?.src,titleTickerMode:ut({isDisabled:r}),onClick:t=>{t.stopPropagation(),e.onMusicTrackOverlayBadgeClick()},href:d?.href||void 0,target:d?.target||void 0,Component:d?.href?"a":"div","aria-label":g,tooltipText:_,noticeIcon:!!c?.length&&(0,s.Y)(lt.X,{lines:c})})]})}));function ut({isDisabled:t}){return t?"none":"always"}const gt=(0,o.P)((function(){const t=Y(),{onPlaybackControlClick:e,player:i,audio:o,isDisabled:a,isOnMediaAudioRedesignFixEnabled:c}=t;return o?(0,s.Y)(r.I,{onActiveEnable:t.onActiveEnable,onActiveDisable:t.onActiveDisable,children:(0,s.Y)(n.h,{badgeMode:t.mode,playbackControl:(0,s.Y)(d.z,{disabled:a,player:i,isRedesignEnabled:c,onPlaybackControlClick:e,playbackControlState:t.playbackControlState}),children:(0,s.Y)(pt,{})})}):null})),_t=(0,a.jn)(R,gt)},955611:(t,e,i)=>{i.d(e,{F:()=>d});var s=i(221020),o=i(356035),n=i(815287),a=i(165051);function r(t){switch(t.type){case"music_track":{let e=function(t){if(0===t.length)return"";return t.map((t=>t.map((t=>t.title)).join(", "))).join(" feat. ")}([t.authors.mainList,t.authors.featList].filter((t=>t.length>0)));return e||(e=t.authors.single?.title??""),e}case"podcast_episode":return t.author.title}}const d=(0,o.P)((function({audio:t}){const e=t.data.title,i=r(t),o=(0,n.useMemo)((()=>{const t=[];return i&&t.push(i),e&&t.push(e),t}),[e,i]);return(0,s.Y)(a.r,{separator:" — ",children:o})}))},43455:(t,e,i)=>{i.d(e,{x:()=>$});var s=i(221020),o=i(356035),n=i(526205),a=i(42107),r=i(18574),d=i(876779),c=i(434518),l=i(763812),h=i(331635),p=i(327813),u=i(273193),g=i(916533),_=i(849645),m=i(320366),v=i(937717),y=i(990126),f=i(144819),S=i(160515),w=i(861700),b=i(788535),P=i(655732),A=i(156589),k=i(103312),C=i(501429),I=i(128384),E=i(161308),L=i(159220),T=i(959267),M=i(304322),O=i(759076),D=i(830443),x=(0,l._)("_analytics");let R=a.Ts,Y=a.zr;class F{[R](){this.audioListPlayer.init(),this.reactions.reaction((()=>this.audioList),(t=>{this.audioListPlayer.destroy(),this._player=this.playerFactory.create({list:t,analytics:(0,c._)(this,x)[x]}),this.audioListPlayer.init()}))}[Y](){this.reactions.destroy(),this.audioListPlayer.destroy()}get audioListPlayer(){return this._player}get mode(){return this.props.current.mode}get isDisabled(){return!!this.currentAudio?.data.isBlocked}get audiosLength(){return this.audios?.length??0}get currentChannelType(){return this.audioPlayer.playing&&(this._currentChannelType=this.audioPlayer.playing.id),this._currentChannelType}get playerCurrentAudio(){return this.settings.isAutoplayActive||this.currentChannelType===I.L.OnMediaAttachment?this.audioListPlayer.currentAudio:this.audioListPlayer.currentAudioOnMediaList}get currentAudio(){let t=this.audioList?.audioAt(0);if((this.settings.isAutoplayActive||this.currentChannelType===I.L.OnMediaAttachment)&&!this.audioListPlayer.isCurrentList)return this.provideAudio(t);if(!this.audioListPlayer.isCurrentAttachmentList&&this.currentChannelType===I.L.Main)return this.provideAudio(t);const e=this.playerCurrentAudio;if(e){const i=this.findAudioFromListById(e.identity);i&&(t=i)}return this.provideAudio(t)}get audios(){return this.props.current.audios}get postId(){return this.props.current.postId}get cover(){return this.currentAudio.cover}get isAutoplayPlayerPlaying(){return this.audioListPlayer.isPlaying&&this.settings.isAutoplayActive}get legalNoticeLines(){return this.currentAudio?.legalNoticeLines??null}get myMusicAction(){let t=this.currentAudio;return t&&"music_track"===t.type?this.audioActionsProvider.provideToggleMyMusic({data:t.data,getSource:()=>({audio:t.data.apiAudio,trackCode:t.data.trackCode}),onExecuted:t=>{(0,c._)(this,x)[x].logToggleOwning({state:t.isActive})}}):null}openAttachmentListAction(){let t=this.currentAudio;if(!t||"music_track"!==t.type)return null;this.props.current.onOpenAttachmentAudioListModal?.({postId:this.postId,analyticsData:{trackCode:this.props.current.trackCodePost??"",screen:this.metaData.get().screen,ref:this.metaData.get().screen}}),(0,c._)(this,x)[x].logOpen({isAutoplayEnabled:this.settings.isAutoplayEnabled})}get tooltipTextActionLang(){if(this.areFullListDisabled)return;const t=this.myMusicAction?.isActive?this.langs.getLang("audio_onmedia_remove_item"):this.langs.getLang("audio_onmedia_add_item");return this.langs.langReplace(t,{audio_item:this.langs.getLang("global_audio_track").toLowerCase()})}get tooltipTextInfoLang(){if(this.areFullListDisabled)return;const t=this.langs.getLang("global_audio_track_list");return this.langs.langReplace(this.langs.getLang("audio_onmedia_open_item"),{audio_item:t})}get tooltipTextCoverLang(){if(!this.areFullListDisabled)return this.audioListPlayer.isListPlaying||this.isAutoplayPlayerPlaying?this.langs.getLang("me_attach_track_pause_aria_label"):this.langs.getLang("global_audio_play")}get subtitleLang(){if(this.audiosLength>1){const t=this.audiosLength-1;return this.langs.langReplace(this.langs.numeric(t,this.langs.getLang("audio_onmedia_n_more_tracks",!0)),{count:String(t)})}}get playbackControlState(){return this.isAutoplayPlayerPlaying?"plays":"idle"}get coverIconName(){if(!this.isDisabled)return this.audioListPlayer.isListPlaying||this.isAutoplayPlayerPlaying?"pause":"play"}get areFullListDisabled(){return this.audioList.items.every((t=>(0,S.z)(t.data.apiAudio)))}get isOnMediaAudioRedesignFixEnabled(){return this.settings.isOnMediaAudioRedesignFixEnabled}get isAudioListLegalNoticeIconEnabled(){return this.settings.isAudioListLegalNoticeIconEnabled}get audioList(){return this.audioListProvider.getEnsured(this.postId,this.audios)}makeAnalyticsPropsGetter(){return()=>({list:this.audioList,postActionAnalytics:this.props.current.postActionAnalytics,postClickAnalytics:this.props.current.postClickAnalytics,postHandlers:this.props.current.isSpa?this.postHandlers:void 0,feedItemId:this.props.current.postId})}findAudioFromListById(t){return this.audioList?.items?.find((e=>(0,f.WO)({id:e.identity.id,ownerId:e.identity.ownerId})===(0,f.WO)({id:t.id,ownerId:t.ownerId})))??void 0}provideAudio(t){switch(t.type){case m.h.MusicTrack:return this.audioModelFactory.createMusicTrack({getSource:()=>({audio:t.data.apiAudio,trackCode:t.context.trackCode}),context:{targetOwnerId:this.authService.userIdOrAnonim}});case m.h.PodcastEpisode:return this.audioModelFactory.createPodcastEpisode({getSource:()=>({audio:t.data.apiAudio,trackCode:t.context.trackCode})})}}constructor(t,e,i,s,o,n,a,r,d,l,h,u,g,_){Object.defineProperty(this,x,{writable:!0,value:void 0}),this.props=t,this.audioListProvider=e,this.settings=i,this.langs=s,this.authService=o,this.playerFactory=n,this.audioPlayer=a,this.audioModelFactory=r,this.metaData=d,this.postHandlers=l,this._currentChannelType=null,this.reactions=new D.O,this.onMusicTrackOverlayBadgeClick=()=>{this.openAttachmentListAction()},this.onPlaybackControlClick=()=>{this.isDisabled||this.toggleMute()},this.onPlayClick=()=>{this.isDisabled||(this.isAutoplayPlayerPlaying?this.audioListPlayer.onTogglePlayWithAutoplay():this.audioListPlayer.onTogglePlayAttachmentList(this.currentAudio.entity))},this.toggleMute=()=>{this.isDisabled||this.audioListPlayer.onTogglePlayWithAutoplay()},this.autoplay=()=>{this.audioListPlayer.autoplay()},this.autopause=()=>{this.audioListPlayer.autopause()},this.onRestrictedAudio=t=>{t&&this.props.current.onRestrictedAudio?.(t)},this.audioActionsProvider=new A.A({langs:s,authService:o,musicService:u,audioDislikesAnalytics:g,channel:n.channel,platformConfig:h,notifications:_,overrides:h.musicAudioActionOverrides}),(0,c._)(this,x)[x]=new k.L(this.makeAnalyticsPropsGetter()),this.audioListProvider.cache(this.postId,this.audios),this._player=this.playerFactory.create({list:this.audioList,analytics:(0,c._)(this,x)[x]}),(0,p.Gn)(this)}}(0,h.Cg)([p.sH.ref,(0,h.Sn)("design:type",void 0===L.g?Object:L.g)],F.prototype,"_player",void 0),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"audioListPlayer",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"mode",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"isDisabled",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"audiosLength",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"currentChannelType",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"playerCurrentAudio",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type","undefined"==typeof TAttachmentAudioModel?Object:TAttachmentAudioModel),(0,h.Sn)("design:paramtypes",[])],F.prototype,"currentAudio",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"audios",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"postId",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"cover",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"isAutoplayPlayerPlaying",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"legalNoticeLines",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"myMusicAction",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"tooltipTextActionLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"tooltipTextInfoLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"tooltipTextCoverLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"subtitleLang",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",String),(0,h.Sn)("design:paramtypes",[])],F.prototype,"playbackControlState",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",Object),(0,h.Sn)("design:paramtypes",[])],F.prototype,"coverIconName",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",Boolean),(0,h.Sn)("design:paramtypes",[])],F.prototype,"areFullListDisabled",null),(0,h.Cg)([p.XI.bound],F.prototype,"onMusicTrackOverlayBadgeClick",void 0),(0,h.Cg)([p.XI.bound],F.prototype,"onPlaybackControlClick",void 0),(0,h.Cg)([p.XI.bound],F.prototype,"onPlayClick",void 0),(0,h.Cg)([p.XI.bound],F.prototype,"toggleMute",void 0),(0,h.Cg)([p.XI.bound],F.prototype,"autoplay",void 0),(0,h.Cg)([p.XI.bound],F.prototype,"autopause",void 0),(0,h.Cg)([p.EW,(0,h.Sn)("design:type",void 0),(0,h.Sn)("design:paramtypes",[])],F.prototype,"isOnMediaAudioRedesignFixEnabled",null),(0,h.Cg)([p.EW,(0,h.Sn)("design:type","undefined"==typeof IAttachmentAudioList?Object:IAttachmentAudioList),(0,h.Sn)("design:paramtypes",[])],F.prototype,"audioList",null),F=(0,h.Cg)([a.z8.transient(),(0,h.Sn)("design:type",Function),(0,h.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===v.h?Object:v.h,void 0===C.m?Object:C.m,void 0===u.Y?Object:u.Y,void 0===g.u?Object:g.u,void 0===T.i?Object:T.i,void 0===E.Y?Object:E.Y,void 0===M.h?Object:M.h,void 0===_.e?Object:_.e,void 0===O.i?Object:O.i,void 0===w.w?Object:w.w,void 0===y.v?Object:y.v,void 0===P.$?Object:P.$,void 0===b.F?Object:b.F])],F);const{Provider:B,useModel:N}=(0,a.Qd)(F,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var z=i(705470),V=i(585155),U=i(955611),G=i(898018);const j=(0,o.P)((function(){const t=N(),{onPlayClick:e,audios:i,myMusicAction:o,isDisabled:n,tooltipTextActionLang:a,tooltipTextInfoLang:r,tooltipTextCoverLang:d,isOnMediaAudioRedesignFixEnabled:c,onMusicTrackOverlayBadgeClick:l,coverIconName:h,areFullListDisabled:p,onRestrictedAudio:u,legalNoticeLines:g,isAudioListLegalNoticeIconEnabled:_}=t,m=_&&g?.length&&(0,s.Y)(G.X,{lines:g});return i&&t.currentAudio?(0,s.Y)(z.t,{title:(0,s.Y)(U.F,{audio:t.currentAudio}),subtitle:t.subtitleLang,action:o&&(0,s.Y)(V.I,{action:o,size:"m",tooltipText:a,isRedesignEnabled:c,isTrackDisabled:n}),contentDisabled:p?void 0:n,textInfoDisabled:p,cover:t.cover?.pickByWidth(22)?.src,titleTickerMode:W({isDisabled:n}),onCoverClick:e,onClick:e=>(e.preventDefault(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),p&&u(t.currentAudio?.entity.apiAudio),!1),disabled:n,onTextInfoClick:l,tooltipTextCover:d,tooltipTextInfo:r,coverIconName:h,maxWidth:275,noticeIcon:m}):null}));function W({isDisabled:t}){return t?"none":"always"}const H=(0,o.P)((function(){const t=N(),{onPlaybackControlClick:e,audioListPlayer:i,isDisabled:o,isOnMediaAudioRedesignFixEnabled:a}=t;return(0,s.Y)(r.I,{onActiveEnable:t.autoplay,onActiveDisable:t.autopause,children:(0,s.Y)(n.h,{badgeMode:t.mode,playbackControl:(0,s.Y)(d.z,{disabled:o,player:i,isRedesignEnabled:a,onPlaybackControlClick:e,playbackControlState:t.playbackControlState}),children:(0,s.Y)(j,{})})})})),$=(0,a.jn)(B,H)},452077:(t,e,i)=>{i.d(e,{N:()=>Et});var s=i(221020),o=i(356035),n=i(526205),a=i(42107),r=i(18574),d=i(876779),c=i(634164),l=i(815287),h=i(516427),p=i(180329),u=i(962644),g=i(818670);const _="vkitCover__image--6rsY7",m=t=>(0,s.Y)(g.f.Cover,{size:"m",fallbackIconModifiers:_,draggable:"false",...t});var v=i(772812),y=i(982444),f=i(638945),S=i(165051),w=i(880414);const b="vkitInfo__text--8ycEk",P="vkitInfo__title--qe4Hk",A=({title:t,subtitle:e,titleTickerMode:i="auto",tickerSpeed:o="regular",maxWidth:n,onTickerFrameWidthUpdated:a})=>{const r=(0,l.useRef)(null),d=(0,l.useRef)(null),h=(0,c.$)((0,v.I)("color_text_contrast"),b),p=(0,s.Y)(y.K,{size:2}),u=.6*(d.current?.offsetWidth??1/0),_=(r.current?.offsetWidth??0)>=u?i:"none";return(0,s.FD)(S.r,{separator:p,children:[(0,s.Y)(g.f.FadedTicker,{mode:_,speed:o,maxWidth:n,onFrameWidthUpdated:a,children:(0,s.Y)(f.HL,{getRootRef:r,weight:"2",className:(0,c.$)(P,h),inline:!0,"data-testid":"info-title",children:t})}),(0,s.Y)(w.b,{TypographyComponent:f.HL,lines:1,className:h,level:"1",weight:"2",children:(0,s.Y)("span",{ref:d,children:e})})]})};var k=i(947008);var C=i(734223);const I="vkitMusicPlaylistOverlayBadge__root--x9Jkt",E="vkitMusicPlaylistOverlayBadge__content--7wGrS",L="vkitMusicPlaylistOverlayBadge__contentDisabled--474Ro",T="vkitMusicPlaylistOverlayBadge__actionContainer--R1VNP",M=Object.assign((({cover:t,coverAlt:e="Music playlist cover",action:i,title:o,subtitle:n,titleTickerMode:a,tickerSpeed:r,fadeMaskMode:d,maxHeight:g,disabled:_,noticeIcon:v,...y})=>{const{maxWidth:f}=(0,C.L)(y),[S,w]=(0,l.useState)(0);let b=Math.min(Math.max(132,S+80),f??1/0);v&&(b+=12);const P={maxWidth:f,maxHeight:g,minWidth:b},M=function(t,e){if((0,k.Et)(e))return Math.max(e-80+(t?0:28),0)}(!!i,f);return(0,s.FD)("div",{"data-testid":"musicbadge",style:P,className:I,children:[(0,s.Y)(u.h,{Component:h.SB4,borderRadius:"inherit",hoverMode:"background",activeMode:"background",...y}),(0,s.Y)("div",{className:(0,c.$)(E,_&&L),children:(0,s.FD)(p.s,{gap:8,margin:"none",noWrap:!0,children:[(0,s.Y)(p.s.Item,{flex:"fixed",children:(0,s.Y)(m,{src:t,alt:e})}),(0,s.Y)(p.s.Item,{flex:"grow",children:(0,s.FD)(p.s,{gap:4,align:"center",margin:"none",noWrap:!0,children:[(0,s.Y)(p.s.Item,{flex:"grow",children:(0,s.Y)(A,{title:o,subtitle:n,titleTickerMode:a,tickerSpeed:r,fadeMaskMode:d,maxWidth:M,onTickerFrameWidthUpdated:w})}),!!v&&(0,s.Y)(p.s.Item,{children:(0,s.Y)(p.s,{align:"center",justify:"center",className:T,children:v})}),!!i&&(0,s.Y)(p.s.Item,{children:(0,s.Y)(p.s,{align:"center",justify:"center",className:T,children:i})})]})})]})})]})}),{Action:({disabled:t,...e})=>(0,s.Y)(g.f.Action,{size:"m",disabled:t,...e})});var O=i(705470),D=i(585155);function x(t){if("album"!==t.type)return null;return function(...t){return t.map((t=>t.map((t=>t.title)).filter(Boolean).join(", "))).filter(Boolean).join(" feat. ")}(t.authors?.mainList??[],t.authors?.featList??[])}const R=(0,o.P)((function({list:t}){const{title:e}=t.data,i="album"===t.type?x(t):null,o=(0,l.useMemo)((()=>{const t=[];return i&&t.push(i),e&&t.push(e),t}),[e,i]);return(0,s.Y)(S.r,{separator:" — ",children:o})}));var Y=i(23692),F=i(355812);const B=(0,o.P)((function({list:t}){const e=[t.typeLabel,N(t)].filter(Boolean);return e.length?(0,s.Y)(S.r,{separator:(0,s.Y)(F.O,{spacing:4}),children:e}):null}));function N(t){const e=t.data.album?.releaseYear;return e?e.toString():null}const z=(0,o.P)((function({list:t}){const{typeLabel:e}=t;if("album"===t.type)return(0,s.Y)(B,{list:t});const{entity:i}=t,o=i.originalOwner??i.owner,n=o&&function(t){switch(t.type){case Y._.Group:return t.data.title;case Y._.User:return[t.data.firstName,t.data.lastName].filter(Boolean).join(" ")}}(o),a=[e,n].filter(Boolean);return a.length?(0,s.Y)(S.r,{separator:(0,s.Y)(F.O,{spacing:4}),children:a}):null}));var V=i(434518),U=i(763812),G=i(331635),j=i(327813),W=i(454718),H=i(830443),$=i(849645),K=i(273193),q=i(249018),Q=i(321171),J=i(945215),X=i(159220),Z=i(959267),tt=i(990126),et=i(194257),it=i(861700),st=i(788535),ot=i(161308),nt=i(595432),at=i(484658);class rt extends at.b{constructor(t,e,i,s,o,n,a,r){super({audioConfig:t,notifications:e,langs:i,channel:s.onMediaAttachment,musicService:o,entityProvider:n,audioGroups:a,albumFactory:r})}}rt=(0,G.Cg)([a.z8.container(),(0,G.Sn)("design:type",Function),(0,G.Sn)("design:paramtypes",[void 0===it.w?Object:it.w,void 0===st.F?Object:st.F,void 0===K.Y?Object:K.Y,void 0===ot.Y?Object:ot.Y,void 0===tt.v?Object:tt.v,void 0===J.X?Object:J.X,void 0===et.K?Object:et.K,void 0===nt.K?Object:nt.K])],rt);var dt=i(309266),ct=i(760724);class lt extends ct.D{logOpen(t){const e=this.toClickEvent(t);e&&(this.postHandlers&&this.props.feedItemId?this.postHandlers.click.onOpenPlaylist({...e,feedItemId:this.props.feedItemId}):this.postClickAnalytics?.onOpenPlaylist(e))}logPlayList(t){const{audioItem:e}=this;e&&(this.postHandlers&&this.props.feedItemId?this.postHandlers.action.sendStartPostPlaylist({audio_item:e,autoplay_mode:t?"autoplay":"manual",feedItemId:this.props.feedItemId}):this.postActionAnalytics?.sendStartPostPlaylist({audio_item:e,autoplay_mode:t?"autoplay":"manual"}))}logToggleOwning({state:t,...e}){const i=this.toClickEvent(e);i&&(this.postHandlers&&this.props.feedItemId?t?this.postHandlers.click?.onAddedPlaylist({...i,feedItemId:this.props.feedItemId}):this.postHandlers.click?.onRemovedPlaylist({...i,feedItemId:this.props.feedItemId}):t?this.postClickAnalytics?.onAddedPlaylist(i):this.postClickAnalytics?.onRemovedPlaylist(i))}get audioItem(){const{playlist:t}=this;if(!t)return null;const{id:e,ownerId:i}=t.identity;return{item_id:e,item_owner_id:i,item_type:ht(t)}}toClickEvent({isAutoplayEnabled:t}){const{audioItem:e}=this;return e?{audio_item:e,autoplay_mode:t?"autoplay":"manual"}:null}get playlist(){const{list:t}=this;return(0,q._)(t)?t:null}constructor(t){super(t),(0,j.Gn)(this)}}function ht(t){return(0,q._)(t,Q.b.MusicAlbumPlaylist)?t.subtype===dt.h.Single?"single":"album":"playlist"}(0,G.Cg)([j.EW,(0,G.Sn)("design:type",Object),(0,G.Sn)("design:paramtypes",[])],lt.prototype,"audioItem",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",Object),(0,G.Sn)("design:paramtypes",[])],lt.prototype,"playlist",null);var pt=i(501429),ut=i(759076),gt=(0,U._)("_analytics"),_t=(0,U._)("_makeAnalyticsPropsGetter"),mt=(0,U._)("_makePlaylistActionsCallbacks");let vt=a.Ts,yt=a.zr;class ft{[vt](){this.player.init(),this.reactions.reaction((()=>!!this.player.initialized&&this.isActive),(t=>{t?this.player.autoplay():this.player.autopause()}),{fireImmediately:!0}),this.reactions.reaction((()=>this.playlistEntity),(t=>{this.player.destroy(),this._player=this.playerFactory.create({list:t,analytics:(0,V._)(this,gt)[gt]}),this.player.init()}))}[yt](){this.reactions.destroy(),this.player.destroy()}get mode(){return this.props.current.mode}get isActive(){return this._isActive}get isDisabled(){return!this.playlist.canPlay}get playlist(){return this.musicPlaylistModelFactory.create({entity:this.playlistEntity,actionsCallbacks:(0,V._)(this,mt)[mt]()})}get player(){return this._player}get toggleFollowingAction(){return this.playlist.actions.toggleFollowing}get openAction(){return this.playlist.actions.open}get playlistType(){return this.playlist.entity.type}get isOnMediaAudioRedesignFixEnabled(){return this.settings.isOnMediaAudioRedesignFixEnabled}get tooltipTextInfoLang(){return this.langs.langReplace(this.langs.getLang("audio_onmedia_open_item"),{audio_item:this.audioItemLang.toLowerCase()})}get tooltipTextActionLang(){const t=this.toggleFollowingAction?.isActive?this.langs.getLang("audio_onmedia_remove_item"):this.langs.getLang("audio_onmedia_add_item");return this.langs.langReplace(t,{audio_item:this.audioItemLang.toLowerCase()})}get tooltipTextCoverLang(){const t=this.player.isPlaying?this.langs.getLang("audio_onmedia_pause_track"):this.langs.getLang("global_audio_play");return this.langs.langReplace(t,{audio_item:this.audioItemLang.toLowerCase()})}get playbackControlState(){return this.player.isPlaying?"plays":"idle"}get isIdle(){return!this.player.isPlaying&&!this.player.isPaused}get isAudioListLegalNoticeIconEnabled(){return this.settings.isAudioListLegalNoticeIconEnabled}get audioItemLang(){let t=this.langs.getLang("global_audio_playlist");return(0,q._)(this.playlist.entity,Q.b.MusicAlbumPlaylist)&&(t=this.langs.getLang("audio_music_album_playlist_type_album")),t}get playlistEntity(){const{cachedPlaylistEntitySource:t,cachedPlaylistEntity:e}=this,{playlist:i}=this.props.current;return e&&t&&(0,W.b)(t,i)?e:(this.cachedPlaylistEntity=this.musicPlaylistProvider.provideFromAPI(i,{ref:this.playlistRef}),this.cachedPlaylistEntitySource=i,this.cachedPlaylistEntity)}get playlistRef(){switch(this.metaData.get().module){case"feed":return"feed";case"profile":return"user_wall";case"groups":return"group_wall";default:return null}}constructor(t,e,i,s,o,n,a,r){Object.defineProperty(this,_t,{value:St}),Object.defineProperty(this,mt,{value:wt}),Object.defineProperty(this,gt,{writable:!0,value:void 0}),this.props=t,this.musicPlaylistProvider=e,this.musicPlaylistModelFactory=i,this.playerFactory=s,this.metaData=o,this.settings=n,this.langs=a,this.postHandlers=r,this.cachedPlaylistEntitySource=null,this.cachedPlaylistEntity=null,this.reactions=new H.O,this._isActive=!1,this.onActiveEnable=()=>{this._isActive=!0},this.onActiveDisable=()=>{this._isActive=!1},this.onPlaybackControlClick=()=>{this.player.onTogglePlayWithAutoplay()},this.onPlayClick=()=>{this.player.isDisabled||this.player.onTogglePlayWithAutoplay()},(0,V._)(this,gt)[gt]=new lt((0,V._)(this,_t)[_t]()),this._player=this.playerFactory.create({list:this.playlistEntity,analytics:(0,V._)(this,gt)[gt]}),(0,j.Gn)(this)}}function St(){return()=>({list:this.playlistEntity,postActionAnalytics:this.props.current.postActionAnalytics,postClickAnalytics:this.props.current.postClickAnalytics,postHandlers:this.props.current.isSpa?this.postHandlers:void 0,feedItemId:this.props.current.postId})}function wt(){const{isAutoplayEnabled:t}=this.settings;return{onOpen:()=>{(0,V._)(this,gt)[gt].logOpen({isAutoplayEnabled:t})},onToggleFollowing:t=>{(0,V._)(this,gt)[gt].logToggleOwning({state:t.isActive})}}}(0,G.Cg)([j.sH.ref,(0,G.Sn)("design:type",void 0===X.g?Object:X.g)],ft.prototype,"_player",void 0),(0,G.Cg)([j.sH],ft.prototype,"_isActive",void 0),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"mode",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"isActive",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"isDisabled",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"playlist",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"player",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"toggleFollowingAction",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"openAction",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"playlistType",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"isOnMediaAudioRedesignFixEnabled",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"tooltipTextInfoLang",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"tooltipTextActionLang",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"tooltipTextCoverLang",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"playbackControlState",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"isIdle",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"isAudioListLegalNoticeIconEnabled",null),(0,G.Cg)([j.XI.bound],ft.prototype,"onActiveEnable",void 0),(0,G.Cg)([j.XI.bound],ft.prototype,"onActiveDisable",void 0),(0,G.Cg)([j.XI.bound],ft.prototype,"onPlaybackControlClick",void 0),(0,G.Cg)([j.XI.bound],ft.prototype,"onPlayClick",void 0),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"audioItemLang",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"playlistEntity",null),(0,G.Cg)([j.EW,(0,G.Sn)("design:type",void 0),(0,G.Sn)("design:paramtypes",[])],ft.prototype,"playlistRef",null),ft=(0,G.Cg)([a.z8.transient(),(0,G.Sn)("design:type",Function),(0,G.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===J.X?Object:J.X,void 0===rt?Object:rt,void 0===Z.i?Object:Z.i,void 0===$.e?Object:$.e,void 0===pt.m?Object:pt.m,void 0===K.Y?Object:K.Y,void 0===ut.i?Object:ut.i])],ft);const{Provider:bt,useModel:Pt}=(0,a.Qd)(ft,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var At=i(898018);const kt=(0,o.P)((function(){const{onPlayClick:t,player:e,playlist:i,isDisabled:o,toggleFollowingAction:n,openAction:a,tooltipTextActionLang:r,tooltipTextCoverLang:d,tooltipTextInfoLang:c,isOnMediaAudioRedesignFixEnabled:l,isAudioListLegalNoticeIconEnabled:h}=Pt(),p=h&&i?.legalNoticeLines?.length&&(0,s.Y)(At.X,{lines:i.legalNoticeLines});return(0,s.FD)(s.FK,{children:[l&&(0,s.Y)(O.t,{title:(0,s.Y)(R,{list:i}),subtitle:(0,s.Y)(z,{list:i}),action:n&&(0,s.Y)(D.I,{action:n,size:"m",tooltipText:r,isRedesignEnabled:l}),cover:i.cover?.pickByWidth?.(72)?.src,titleTickerMode:Ct({isDisabled:o}),onTextInfoClick:o?void 0:a.onExecute,onCoverClick:t,onClick:t=>(t.preventDefault(),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),!1),disabled:o,tooltipTextCover:d,tooltipTextInfo:c,coverIconName:e.isPlaying?"pause":"play",maxWidth:275}),!l&&(0,s.Y)(M,{title:(0,s.Y)(R,{list:i}),subtitle:(0,s.Y)(z,{list:i}),action:n&&(0,s.Y)(D.I,{action:n,size:"m",ActionComponent:M.Action}),cover:i.cover?.pickByWidth(72)?.src,titleTickerMode:Ct({isDisabled:o}),onClick:o?void 0:a.onExecute,href:a.href??void 0,disabled:o,noticeIcon:p})]})}));function Ct({isDisabled:t}){return t?"none":"always"}const It=(0,o.P)((function(){const t=Pt(),{onPlaybackControlClick:e,player:i,isDisabled:o,isOnMediaAudioRedesignFixEnabled:a}=t;return(0,s.Y)(r.I,{onActiveEnable:t.onActiveEnable,onActiveDisable:t.onActiveDisable,children:(0,s.Y)(n.h,{badgeMode:t.mode,playbackControl:(0,s.Y)(d.z,{disabled:o,player:i,isRedesignEnabled:a,onPlaybackControlClick:e,playbackControlState:t.playbackControlState}),children:(0,s.Y)(kt,{})})})})),Et=(0,a.jn)(bt,It)},231770:(t,e,i)=>{i.d(e,{c:()=>d});var s=i(221020),o=i(409588),n=i(452077),a=i(43455),r=i(347261);function d({onMediaAttachments:t,mode:e,postClickAnalytics:i,postActionAnalytics:d,postId:c,onRestrictedAudio:l,onOpenAttachmentAudioListModal:h,trackCode:p,feedAttachmentOnmediaAudiosListEnabled:u,isSpa:g,audioSnippetEnabled:_}){const m=t.map((t=>t?.audio)).filter((t=>void 0!==t));if(m.length>1&&u)return(0,s.Y)(a.x,{audios:m,mode:e,postId:c,onRestrictedAudio:l,onOpenAttachmentAudioListModal:h,trackCodePost:p,postClickAnalytics:i,postActionAnalytics:d,isSpa:g});const v=t[0];if(v){let{type:t,audio:a,audio_playlist:l}=v;switch(t){case"audio":if(!a)break;return _&&(a=(0,r.P)(a)),(0,s.Y)(o.J,{postId:c,audio:a,mode:e,isSpa:g,postClickAnalytics:i,postActionAnalytics:d});case"audio_playlist":if(!l)break;return(0,s.Y)(n.N,{postId:c,playlist:l,mode:e,isSpa:g,postClickAnalytics:i,postActionAnalytics:d})}}return null}},916982:(t,e,i)=>{i.d(e,{E:()=>h});var s=i(221020),o=i(815287),n=i(928959),a=i(93944),r=i(364517),d=i(31649),c=i(516427),l=i(799649);const h=({arrowedElementRef:t,Component:e=d.A,withLongTapOnTouchScreen:i,children:h,trigger:p,autoFocus:u,onShownChange:g,role:_,placement:m="bottom",arrowProps:v,ariaLabelPopover:y,ariaLabelPopoverTriggerButton:f,...S})=>{const w=!p.includes("click"),b=w&&![!0,"true"].includes(h.props.ariaHidden)&&-1!==h.props.tabIndex,P=window.matchMedia("(pointer: coarse)").matches&&i,[A,k]=(0,o.useState)(!1),C=(0,o.useRef)(null),I=(0,o.useRef)(null),[E,L]=(0,o.useState)(null),[T,M]=(0,o.useState)(null),O=(0,r.K)((()=>{if(!t?.current||!C.current)return;const e=m.includes("bottom")||m.includes("top")?"left":"top",i=m.includes("bottom")||m.includes("top")?"width":"height",s=C.current?.getBoundingClientRect(),o=s[e]+s[i]/2,n=t.current.getBoundingClientRect(),a=n[e]+n[i]/2;M(a-o)}));(0,o.useEffect)((()=>{if(!t?.current||!C.current)return;const e=new ResizeObserver((()=>{O()}));return e.observe(C.current),()=>{e.disconnect()}}),[]);const D=(0,r.K)(h.props.onClick);(0,o.useEffect)((()=>{const t=t=>{t.isTrusted?(D?.(t),p.includes("click")||t.stopPropagation()):(t.preventDefault(),L(I.current))};return C.current?.addEventListener("click",t),()=>{C.current?.removeEventListener("click",t)}}),[p.includes("click"),D]);const[,x]=(0,c.X5Z)(h,{onClick:void 0,"aria-hidden":w,tabIndex:w?-1:0},C);return(0,a.H)({onLongPress:()=>{P&&k(!0)},onStart:t=>{P&&t.preventDefault()},onCancel:t=>{P&&D?.(t)},elementRef:C},[P]),x?(0,s.FD)(s.FK,{children:[(0,s.Y)(e,{onShownChange:(t,e)=>{g?.(t,e),t||"hover"!==e||L(null),t&&O(),P&&k(t)},shown:P?A:void 0,restoreFocus:E||!1,autoFocus:!!E||u,trigger:P?"manual":["click","hover"],placement:m,"aria-label":y,arrowProps:{...v||{},offset:T??v?.offset,"aria-hidden":!0},role:"dialog",...S,children:x}),b&&(0,s.Y)(c.s6o,{children:h}),w&&(0,s.Y)(c.s6o,{children:(0,s.Y)(l.K,{"aria-expanded":!1,label:f||y||h.props.label,getRootRef:I,onClick:t=>{(0,n.T)(t),C.current?.click()},children:h.props.children})})]}):(0,s.Y)(e,{arrowProps:v,placement:m,trigger:p,role:_,autoFocus:u,"aria-label":y,onShownChange:g,...S,children:h})}},208182:(t,e,i)=>{i.d(e,{U:()=>s});var s=function(t){return t.t35="t35",t.t50="t50",t}({})},85923:(t,e,i)=>{i.d(e,{O:()=>s});const s={ACTION_BUTTON:"action_button",ALBUM:"album",APP:"app",ARTICLE:"article",ARTIST:"artist",AUDIO:"audio",AUDIO_PLAYLIST:"audio_playlist",CLIP:"clip",CURATOR:"curator",DOC:"doc",DONUT_LINK:"donut_link",EVENT:"event",GEO:"geo",GRAFFITI:"graffiti",GROUP:"group",LINK:"link",MARKET:"market",MARKET_ALBUM:"market_album",MARKET_LINK:"market_link",MINI_APP:"mini_app",NARRATIVE:"narrative",NOTE:"note",ONLINE_BOOKING:"online_booking",PAGE:"page",PHOTO:"photo",PHOTOS_LIST:"photos_list",PODCAST:"podcast",POLL:"poll",POSTED_PHOTO:"posted_photo",PRETTY_CARDS:"pretty_cards",SITUATIONAL_THEME:"situational_theme",STICKER:"sticker",TEXTLIVE:"textlive",TEXTPOST:"textpost",TEXTPOST_PUBLISH:"textpost_publish",VIDEO:"video",VIDEO_PLAYLIST:"video_playlist",MESSAGE_TO_BC:"message_to_bc"}},477042:(t,e,i)=>{i.d(e,{O:()=>r});var s=i(221020),o=i(815287),n=i(229767),a=i(739991);const r=({getTextFormatArray:t,onFormattedDisplayedTextClick:e,label:i,tooltipText:r})=>{const[d,c]=(0,o.useState)(!1),l=()=>{c(!0)};return{renderDisplayedText:(o,{accented:c}={})=>{const h=t(o);return"string"==typeof h?h:(0,s.Y)(s.FK,{children:h.map(((t,o)=>{if("string"==typeof t)return t;if("emoji"in t){const{emoji:e}=t;return(0,s.Y)("img",{className:"emoji",src:`/emoji/e/${e.code}${e.retina?"_2x":""}.png`,alt:e.alt},o)}if("obsceneBlur"in t){const{obsceneBlur:h}=t;return(0,s.Y)(n.f,{dataId:a.ZE,"aria-label":i,obscene:h.obscene,blur:h.blur,tooltipText:r,onClick:d?void 0:t=>{e(t,l)},unblurred:d,accented:c},o)}return null}))})}}}},124102:(t,e,i)=>{i.d(e,{$:()=>d});var s=i(59512),o=i(336888),n=i(111198),a=i(998079),r=i(649515);class d{parseText(){return this._text?(0,s.S)(this._text,{isAliasedUrlEnabled:!0,isLineBreakWithParagraphEnabled:!0}):[]}getChunks(){return this._chunks||(this._chunks=this.parseText()),this._chunks}get obsceneWordsCount(){return this._obsceneText.obsceneWordsCount}getText(){return this._text}replaceEmoji(t){return n.T.ipad||n.T.iphone?t:(Array.isArray(t)||(t=[t]),t.reduce(((t,e)=>{if("string"!=typeof e)return[...t,e];const i=e.match((0,a.U)());if(!i)return[...t,e];return e.split((0,a.U)()).forEach(((e,s)=>{t.push(e),s>=i.length||t.push({emoji:{code:(0,r.V)(i[s]),retina:window.devicePixelRatio>=2,alt:i[s]}})})),t}),[]))}constructor(t,e){this._replaceEmoji=e,this.getTextFormatArray=t=>{const e=this._obsceneText.getObsceneBlurArray(t);return this._replaceEmoji?this.replaceEmoji(e):e},this._obsceneText=new o.h(t),this._text=this._obsceneText.encodeObscene()}}},759076:(t,e,i)=>{i.d(e,{i:()=>C});var s=i(331635),o=i(42107),n=i(257581),a=i(710345),r=i(289375),d=i(849645),c=i(556039),l=i(452200),h=i(725308),p=i(337951),u=i(529275);function g(t){return t instanceof Object&&"feedItemId"in t&&void 0!==t.feedItemId&&"postType"in t&&"string"==typeof t.postType&&(e=t.postType,["photo","photo_tag","wall_photo"].includes(e));var e}var _=i(356979);class m{get screen(){return(0,p.q)(this.metaData.get().screen,this.feedPostModal.isModalOpened)}getTrackCode(t){const e=this.feedEntitiesStore.getItem(t);if("ads"===e?.apiType){const t="ads"in e.value?e.value.ads?.[0]:void 0;if(t?.post)return t.post.track_code??""}return e?.value.track_code??""}getItemId(t){const e=this.feedEntitiesStore.getItem(t);if(e)return"id"in e.value?e.value.id:void 0}getItemOwnerId(t){const e=this.feedEntitiesStore.getItem(t);if(e)return"owner_id"in e.value?e.value.owner_id:void 0}send(t){const e=this.screen;return this.productionStats.send({type:"type_click",screen:e,type_click:t})}createInteractionEventSender(t,e="wall_item"){return(i,s={})=>{const o=this.screen;this.send({item:{type:t},type:"type_feed_interaction_item",type_feed_interaction_item:{ref:o,item:s.event_subtype??e,track_code:this.getTrackCode(i),...s}})}}createOpenEventSender(){return(t,e)=>{const i=this.screen;this.send({item:{track_code:this.getTrackCode(t)},type:"type_feed_open_item",type_feed_open_item:{ref:i,...e}})}}createPhotoPostInteractionEventSender(t){return(e,i={})=>{const s=this.screen,{ownerId:o,id:n}=(0,l.v)(e);var a;void 0!==(a=i).content_type&&void 0!==a.photo_raw_id&&void 0!==a.created_timestamp&&this.send({item:{track_code:this.getTrackCode(e),id:n,owner_id:o,screen:s},type:"type_photo_post_interaction_item",type_photo_post_interaction_item:{...i,event_type:t}})}}createAudioClickEventSender(t){return e=>{const i=`type_feed_post_${t}`;this.send({item:{track_code:this.getTrackCode(e.feedItemId)},type:i,[i]:e})}}createAudioPlaylistClickEventSender(t){return e=>{const i=`type_feed_post_${t}`;this.send({item:{track_code:this.getTrackCode(e.feedItemId)},type:i,[i]:e})}}createModalSharingOpenEvent(){return t=>{this.send({item:{track_code:this.getTrackCode(t.feedItemId),type:"post"},type:"type_modal_sharing_open",type_modal_sharing_open:{event:t.event}})}}createDonutPaymentClickEventSender(t){return e=>{this.productionStats.send({type:"type_click",screen:e.screen,type_click:{item:{type:"post",id:this.getItemId(e.feedItemId),owner_id:this.getItemOwnerId(e.feedItemId),track_code:this.getTrackCode(e.feedItemId)},type:"type_donut_support_author_click",type_donut_support_author_click:{item_type:e.item_type}}}),this.send({item:{type:"post",id:this.getItemId(e.feedItemId),owner_id:this.getItemOwnerId(e.feedItemId),track_code:this.getTrackCode(e.feedItemId)},type:"type_feed_post_donut_payment_click",type_feed_post_donut_payment_click:{subtype:t}})}}createCoOwnersEventClickEventSender(t=a.n.ClickSetUpInvitationsButton){return e=>{const i=this.getItemOwnerId(e.feedItemId);i&&this.send({item:{id:this.getItemId(e.feedItemId),owner_id:i},type:"type_feed_coowners_event",type_feed_coowners_event:{event_type:t,item_owner_id:e.itemOwnerId}})}}createActionButtonClickEvent(){return(t,e)=>{const i=this.screen,s={type:"type_click",type_click:{type:"type_action_button_click",type_action_button_click:e,item:{track_code:this.getTrackCode(t)}},screen:i};this.productionStats.send(s)}}sendProductTagsHide(t){this.send({type:`${c.n0}hide_product_pin_click`,type_feed_hide_product_pin_click:t,item:{track_code:this.getTrackCode(t.feedItemId)}})}sendProductCardOpenClick(t){this.send({type:`${c.n0}open_market_item_click`,type_feed_open_market_item_click:t,item:{track_code:this.getTrackCode(t.feedItemId),id:t.item.id}})}constructor(t,e,i,s){this.productionStats=t,this.metaData=e,this.feedEntitiesStore=i,this.feedPostModal=s,this.onInlineCommentInputClick=t=>{const{ownerId:e,id:i}=(0,l.v)(t);this.send({item:{track_code:this.getTrackCode(t),id:i,owner_id:e},type:"type_feed_inline_comment_input_click",type_feed_inline_comment_input_click:{}})},this.onPostExpandText=t=>{const{source:e}=t;this.send({item:{track_code:this.getTrackCode(t.feedItemId)},type:"type_feed_post_expand_text",type_feed_post_expand_text:{source:e}})},this.onPostCollapseText=t=>{this.send({item:{track_code:this.getTrackCode(t)},type:"type_feed_post_collapse_text",type_feed_post_collapse_text:{}})},this.onOpenCommentsModal=t=>{const{entryPoint:e,commentId:i}=t;this.send({type:"type_feed_open_comments_modal",type_feed_open_comments_modal:{entry_point:e,track_code:this.getTrackCode(t.feedItemId),comment_id:i}})},this.obsceneTextAlertBoxOpened=t=>{this.send({type:"type_obscene_word",type_obscene_word:{track_code:this.getTrackCode(t.feedItemId)}})},this.onUnBlurText=t=>{this.send({type:"type_reveal_obscene_words",type_reveal_obscene_words:{track_code:this.getTrackCode(t.feedItemId),count:t.count}})},this.onOpenReactionsModalClick=t=>{const{entryPoint:e}=t;this.send({item:{track_code:this.getTrackCode(t.feedItemId)},type:"type_feed_open_reactions_modal",type_feed_open_reactions_modal:{entry_point:e}})},this.openGroupOrUser=(t,e,i,s=!1)=>{let o=s?this.onOpenParentUser:this.onOpenUser;h.z.isGroupId(t)&&(o=s?this.onOpenParentGroup:this.onOpenGroup),o(i,e)},this.openGroupOrUserInCoOwnerModal=(t,e,i,s=!1)=>{let o=s?this.onOpenParentUserCoOwnerModal:this.onOpenUserCoOwnerModal;h.z.isGroupId(t)&&(o=s?this.onOpenParentGroupCoOwnerModal:this.onOpenGroupCoOwnerModal),o(i,e)},this.onOpenCoOwnersModal=(t,e,i,s)=>{let o=s?this.onOpenParentCoOwnersModalFromComboAvatar:this.onOpenCoOwnersModalFromComboAvatar;"from_header"===i&&(o=s?this.onOpenParentCoOwnersModalFromHeader:this.onOpenCoOwnersModalFromHeader),o(e,t)},this.onFollow=(t,e,i)=>{const s=this.screen;this.send({type:"type_feed_follow_click",item:{ref:s,track_code:this.getTrackCode(i),...t},type_feed_follow_click:e})},this.onUnfollow=(t,e,i)=>{const s=this.screen;this.send({type:"type_feed_unfollow_click",item:{ref:s,track_code:this.getTrackCode(i),...t},type_feed_unfollow_click:e})},this.toggleFollow=(t,e,i,s)=>{let o=this.onUnfollow;s&&(o=this.onFollow),o(t,e,i)},this.sendOpenStoryEvent=t=>{this.send({type:"type_feed_open_story_click",type_feed_open_story_click:{entry_point:t.entryPoint},item:{track_code:this.getTrackCode(t.feedItemId)}})},this.onCarouselNextClick=this.createInteractionEventSender("click_next"),this.onCarouselPrevClick=this.createInteractionEventSender("click_previous"),this.onPhotoOpen=this.createInteractionEventSender("open_photo"),this.onOpenGeoFeed=this.createInteractionEventSender("open_geo_feed"),this.onExtLinkClick=this.createInteractionEventSender("ext_link_click"),this.onIntLinkClick=this.createInteractionEventSender("int_link_click"),this.onExtLinkClickSnippet=this.createInteractionEventSender("ext_link_click_snippet"),this.onIntLinkClickSnippet=this.createInteractionEventSender("int_link_click_snippet"),this.onOpenGroup=this.createInteractionEventSender("open_group"),this.onOpenParentGroup=this.createInteractionEventSender("open_parent_group"),this.onOpenGroupCoOwnerModal=this.createInteractionEventSender("open_group","coowner_modal_card"),this.onOpenParentGroupCoOwnerModal=this.createInteractionEventSender("open_parent_group","coowner_modal_card"),this.onOpenUser=this.createInteractionEventSender("open_user"),this.onOpenParentUser=this.createInteractionEventSender("open_parent_user"),this.onOpenUserCoOwnerModal=this.createInteractionEventSender("open_user","coowner_modal_card"),this.onOpenParentUserCoOwnerModal=this.createInteractionEventSender("open_parent_user","coowner_modal_card"),this.onOpenCoOwnersModalFromHeader=this.createInteractionEventSender("view_owners","from_header"),this.onOpenParentCoOwnersModalFromHeader=this.createInteractionEventSender("view_parent_owners","from_header"),this.onOpenCoOwnersModalFromComboAvatar=this.createInteractionEventSender("view_owners","from_combo_avatar"),this.onOpenParentCoOwnersModalFromComboAvatar=this.createInteractionEventSender("view_parent_owners","from_combo_avatar"),this.onPostHideWeek=this.createInteractionEventSender("hide","week"),this.onPostHideAlways=this.createInteractionEventSender("hide","always"),this.onPostUnHideWeek=this.createInteractionEventSender("unhide","week"),this.onPostUnHideAlways=this.createInteractionEventSender("unhide","always"),this.onSendDonut=this.createInteractionEventSender("send_donut"),this.onPostOpen=this.createOpenEventSender(),this.onOpenPrettyCard=this.createInteractionEventSender("click_pretty_card"),this.onUnmuteAudio=this.createAudioClickEventSender("unmute_audio"),this.onMuteAudio=this.createAudioClickEventSender("mute_audio"),this.onPauseAudio=this.createAudioClickEventSender("pause_audio"),this.onOpenAudio=this.createAudioClickEventSender("open_audio"),this.onAddedAudio=this.createAudioClickEventSender("added_audio"),this.onRemovedAudio=this.createAudioClickEventSender("removed_audio"),this.onOpenPlaylist=this.createAudioPlaylistClickEventSender("open_playlist"),this.onAddedPlaylist=this.createAudioPlaylistClickEventSender("added_playlist"),this.onRemovedPlaylist=this.createAudioPlaylistClickEventSender("removed_playlist"),this.onClickBackgroundOnBlurredPost=this.createDonutPaymentClickEventSender("attachment_background"),this.onClickDonutButtonOnBlurredPost=this.createDonutPaymentClickEventSender("attachment_button"),this.onLikesBarOnBlurredPost=this.createDonutPaymentClickEventSender("likes_activity"),this.onClickFooterOnBlurredPost=this.createDonutPaymentClickEventSender("footer"),this.onClickSetUpInvitationsButton=this.createCoOwnersEventClickEventSender(),this.onModalSharingOpen=this.createModalSharingOpenEvent(),this.onPhotoPostOpenPhoto=this.createPhotoPostInteractionEventSender("open_photo"),this.onPhotoPostClickToComment=this.createPhotoPostInteractionEventSender("click_to_comment"),this.onPhotoPostClickToSharing=this.createPhotoPostInteractionEventSender("click_to_sharing"),this.onPhotoPostClickNext=this.createPhotoPostInteractionEventSender("click_next"),this.onPhotoPostClickPrevious=this.createPhotoPostInteractionEventSender("click_previous"),this.onActionButtonClickEvent=this.createActionButtonClickEvent()}}m=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===r.X?Object:r.X,void 0===d.e?Object:d.e,void 0===u.B?Object:u.B,void 0===_.y?Object:_.y])],m);var v=i(173327),y=i(349785),f=i(390860),S=i(821713),w=i(303134);class b{sendMotionEvent(t,e){this.getMotionWatcher(t)?.raiseEvent(e)}getMotionWatcher(t){return this.motionWatchersStore.getWatcher(t)}checkItemIsPromopost(t){const e=this.feedEntitiesStore.getItem(t);return e&&(0,w.Wj)(e)}createPromopostEvent(t,{multiple:e}={}){return(i,s)=>{this.checkItemIsPromopost(i)&&this.sendMotionEvent(i,{event:t,params:s,multiple:e})}}constructor(t,e){this.motionWatchersStore=t,this.feedEntitiesStore=e,this.onAddReaction=this.createPromopostEvent("likePost",{multiple:!0}),this.onModalSharingOpen=this.createPromopostEvent("sharePost",{multiple:!0})}}b=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===S.f?Object:S.f,void 0===u.B?Object:u.B])],b);class P{constructor(t,e,i,s,o){this.statlog=t,this.feedPostClickAnalytics=e,this.feedPostContextMenuAnalytics=i,this.productAnalyticsLogger=s,this.feedPromopostClickAnalytics=o,this.onAddedAudio=t=>{this.feedPostClickAnalytics.onAddedAudio(t)},this.onCarouselNextClick=t=>{g(t)?this.feedPostClickAnalytics.onPhotoPostClickNext(t.feedItemId,{photo_raw_id:t.photoRawId,content_type:t.contentType,created_timestamp:t.createdTimestamp}):this.feedPostClickAnalytics.onCarouselNextClick(t.feedItemId)},this.onCarouselPrevClick=t=>{g(t)?this.feedPostClickAnalytics.onPhotoPostClickPrevious(t.feedItemId,{photo_raw_id:t.photoRawId,content_type:t.contentType,created_timestamp:t.createdTimestamp}):this.feedPostClickAnalytics.onCarouselPrevClick(t.feedItemId)},this.onClickBackgroundOnBlurredPost=t=>{this.feedPostClickAnalytics.onClickBackgroundOnBlurredPost(t)},this.onClickDonutButtonOnBlurredPost=t=>{this.feedPostClickAnalytics.onClickDonutButtonOnBlurredPost(t)},this.onClickFooterOnBlurredPost=t=>{this.feedPostClickAnalytics.onClickFooterOnBlurredPost(t)},this.onExtLinkClick=t=>{this.feedPostClickAnalytics.onExtLinkClick(t.feedItemId,{event_subtype:t.eventSubtype})},this.onExtLinkClickSnippet=t=>{this.feedPostClickAnalytics.onExtLinkClickSnippet(t.feedItemId,{event_subtype:t.eventSubtype})},this.onIntLinkClick=t=>{this.feedPostClickAnalytics.onIntLinkClick(t.feedItemId,{event_subtype:t.eventSubtype})},this.onIntLinkClickSnippet=t=>{this.feedPostClickAnalytics.onIntLinkClickSnippet(t.feedItemId,{event_subtype:t.eventSubtype})},this.onLikesBarOnBlurredPost=t=>{this.feedPostClickAnalytics.onLikesBarOnBlurredPost(t)},this.onMuteAudio=t=>{this.feedPostClickAnalytics.onMuteAudio(t)},this.onOpenAudio=t=>{this.feedPostClickAnalytics.onOpenAudio(t)},this.onOpenCommentsModal=t=>{this.feedPostClickAnalytics.onOpenCommentsModal(t)},this.onOpenGeoFeed=t=>{this.feedPostClickAnalytics.onOpenGeoFeed(t.feedItemId)},this.onOpenPlaylist=t=>{this.feedPostClickAnalytics.onOpenPlaylist(t)},this.onOpenReactionsModalClick=t=>{this.feedPostClickAnalytics.onOpenReactionsModalClick(t)},this.onOpenUser=t=>{this.feedPostClickAnalytics.onOpenUser(t.feedItemId,{event_subtype:t.eventSubtype})},this.onOpenGroup=t=>{this.feedPostClickAnalytics.onOpenGroup(t.feedItemId,{event_subtype:t.eventSubtype})},this.onOpenSharingModal=t=>{this.feedPostClickAnalytics.onModalSharingOpen({...t,event:"modal_sharing_open"}),this.feedPromopostClickAnalytics.onModalSharingOpen(t.feedItemId)},this.openGroupOrUser=(t,e,i,s)=>{this.feedPostClickAnalytics.openGroupOrUser(t,e,i,s)},this.onPauseAudio=t=>{this.feedPostClickAnalytics.onPauseAudio(t)},this.onPhotoOpen=t=>{g(t)?this.feedPostClickAnalytics.onPhotoPostOpenPhoto(t.feedItemId,{photo_raw_id:t.photoRawId,content_type:t.contentType,created_timestamp:t.createdTimestamp}):this.feedPostClickAnalytics.onPhotoOpen(t.feedItemId,{event_subtype:t.eventSubtype})},this.onPostCollapseText=t=>{this.feedPostClickAnalytics.onPostCollapseText(t.feedItemId)},this.onPostExpandText=t=>{this.feedPostClickAnalytics.onPostExpandText(t)},this.onPostHideAlways=t=>{this.feedPostClickAnalytics.onPostHideAlways(t.feedItemId)},this.onPostHideWeek=t=>{this.feedPostClickAnalytics.onPostHideWeek(t.feedItemId)},this.onPostOpen=t=>{this.feedPostClickAnalytics.onPostOpen(t.feedItemId,{source:t.source})},this.onPostUnHideAlways=t=>{this.feedPostClickAnalytics.onPostUnHideAlways(t.feedItemId)},this.onPostUnHideWeek=t=>{this.feedPostClickAnalytics.onPostUnHideWeek(t.feedItemId)},this.onRemovedAudio=t=>{this.feedPostClickAnalytics.onRemovedAudio(t)},this.onRemovedPlaylist=t=>{this.feedPostClickAnalytics.onRemovedPlaylist(t)},this.onSendDonut=t=>{this.feedPostClickAnalytics.onSendDonut(t.feedItemId)},this.onUnmuteAudio=t=>{this.feedPostClickAnalytics.onUnmuteAudio(t)},this.onAddedPlaylist=t=>{this.feedPostClickAnalytics.onAddedPlaylist(t)},this.onFollow=(t,e,i)=>{this.feedPostClickAnalytics.onFollow(t,e,i)},this.onUnfollow=(t,e,i)=>{this.feedPostClickAnalytics.onUnfollow(t,e,i)},this.toggleFollow=(t,e,i,s)=>{this.feedPostClickAnalytics.toggleFollow(t,e,i,s)},this.openGroupOrUserInCoOwnerModal=(t,e,i,s)=>{this.feedPostClickAnalytics.openGroupOrUserInCoOwnerModal(t,e,i,s)},this.onOpenCoOwnersModal=(t,e,i,s)=>{this.feedPostClickAnalytics.onOpenCoOwnersModal(t,e,i,s)},this.sendProductCardOpenClick=t=>{this.feedPostClickAnalytics.sendProductCardOpenClick(t)},this.sendProductTagsHide=t=>{this.feedPostClickAnalytics.sendProductTagsHide(t)},this.onContextMenuCopyLinkAction=t=>{this.feedPostContextMenuAnalytics.sendCopyLinkAction(t)},this.onContextMenuClickToDotsAction=t=>{this.feedPostContextMenuAnalytics.sendClickToDotsAction(t)},this.onContextMenuOpenAdvertiserInfoAction=t=>{this.feedPostContextMenuAnalytics.sendOpenAdvertiserInfoAction(t)},this.onContextMenuCopyEridAction=t=>{this.feedPostContextMenuAnalytics.sendCopyEridAction(t)},this.onContextMenuOpenOriginalAction=t=>{this.feedPostContextMenuAnalytics.sendOpenOriginalAction(t)},this.onContextMenuSendDonutAction=t=>{this.feedPostContextMenuAnalytics.sendSendDonutAction(t)},this.onContextMenuEditPostAction=t=>{this.feedPostContextMenuAnalytics.sendEditPostAction(t)},this.onContextMenuPostStatOpenAction=t=>{this.feedPostContextMenuAnalytics.sendPostStatOpenAction(t)},this.onContextMenuUnsubscribeCommentsAction=t=>{this.feedPostContextMenuAnalytics.sendUnsubscribeCommentsAction(t)},this.onContextMenuDeclineSuggestedPostAction=t=>{this.feedPostContextMenuAnalytics.sendDeclineSuggestedPostAction(t)},this.onContextMenuPublishSuggestedPostAction=t=>{this.feedPostContextMenuAnalytics.sendPublishSuggestedPostAction(t)},this.onContextMenuPublishDelayedPostAction=t=>{this.feedPostContextMenuAnalytics.sendPublishSuggestedPostAction(t)},this.onContextMenuPublishPostponedPostAction=({postType:t,creationEntryPoint:e,navScreen:i})=>{"draft"===t&&this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:n.u3.PostDraft,creationEntryPoint:e,navScreen:i})},this.onContextMenuMakeDonutPostPublicAction=t=>{this.feedPostContextMenuAnalytics.sendMakeDonutPostPublicAction(t)},this.onContextMenuCloseCommentsAction=t=>{this.feedPostContextMenuAnalytics.sendCloseCommentsAction(t)},this.onContextMenuDeletePostAction=t=>{this.feedPostContextMenuAnalytics.sendDeletePostAction(t)},this.onClickSetUpInvitationsButton=t=>{this.feedPostClickAnalytics.onClickSetUpInvitationsButton(t)},this.onUnBlurText=t=>{this.feedPostClickAnalytics.onUnBlurText(t)},this.obsceneTextAlertBoxOpened=t=>{this.feedPostClickAnalytics.obsceneTextAlertBoxOpened(t)},this.onCommentButtonClick=t=>{this.feedPostClickAnalytics.onPhotoPostClickToComment(t.feedItemId,{photo_raw_id:t.photoRawId,content_type:t.contentType,created_timestamp:t.createdTimestamp})},this.onInlineCommentInputClick=t=>{this.feedPostClickAnalytics.onInlineCommentInputClick(t.feedItemId)},this.onSharingButtonClick=t=>{this.feedPostClickAnalytics.onPhotoPostClickToSharing(t.feedItemId,{photo_raw_id:t.photoRawId,content_type:t.contentType,created_timestamp:t.createdTimestamp})},this.onOpenStory=t=>{this.feedPostClickAnalytics.sendOpenStoryEvent(t)},this.sendCaptionClickEvent=t=>{this.statlog.send({name:t.name,value:"",keys:["clicked_caption"]})},this.onClickFakeNewsCaption=()=>{this.sendCaptionClickEvent({name:"fake_news_base"})},this.onOpenPrettyCard=this.feedPostClickAnalytics.onOpenPrettyCard.bind(this.feedPostClickAnalytics),this.onClickPrettyCardsNext=this.feedPostClickAnalytics.onCarouselNextClick.bind(this.feedPostClickAnalytics),this.onClickPrettyCardsPrev=this.feedPostClickAnalytics.onCarouselPrevClick.bind(this.feedPostClickAnalytics),this.onActionButtonClick=(t,e)=>{this.feedPostClickAnalytics.onActionButtonClickEvent(t,e)},this.onAddReactionPost=t=>{this.feedPromopostClickAnalytics.onAddReaction(t)}}}P=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===y.R?Object:y.R,void 0===m?Object:m,void 0===v.F?Object:v.F,void 0===f.I?Object:f.I,void 0===b?Object:b])],P);var A=i(386151);class k{constructor(t,e){this.feedActionAnalytics=t,this.statlog=e,this.sendStartPostAudio=t=>{this.feedActionAnalytics.sendStartPostAudio(t)},this.sendStartPostPlaylist=t=>{this.feedActionAnalytics.sendStartPostPlaylist(t)},this.sendCaptionRenderEvent=t=>{this.statlog.send({name:t.name,value:"",keys:["post_render"]})},this.onRenderFakeNewsCaption=()=>{this.sendCaptionRenderEvent({name:"fake_news_base"})},this.sendProductTagShow=t=>{this.feedActionAnalytics.sendProductTagShow(t)},this.sendStartAudioOrPlaylist=(t,e,i,s)=>{"audio"===i?this.sendStartPostAudio({feedItemId:s,subtype:e,audio_item:{item_id:t.id,item_owner_id:t.owner_id,item_type:i}}):this.sendStartPostPlaylist({feedItemId:s,autoplay_mode:e,audio_item:{item_id:t.id,item_owner_id:t.owner_id,item_type:i}})}}}k=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===A.r?Object:A.r,void 0===y.R?Object:y.R])],k);class C{constructor(t,e){this.click=t,this.action=e}}C=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===P?Object:P,void 0===k?Object:k])],C)},832595:(t,e,i)=>{i.d(e,{S:()=>I});var s=i(331635),o=i(42107),n=i(452200),a=i(303134),r=i(529275),d=i(545657),c=i(289375),l=i(849645),h=i(322809),p=i(665590),u=i(711350),g=i(164869),_=i(651253),m=i(847328);function v(t){return"view_post"===t.e}function y(t){return"view_post_time"===t.e}class f{send(t){this.events.push(t),this.scheduleSend()}sendAllEventsImmediately(t){clearTimeout(this.timeoutId),this.events=this.events.concat(t),this.sendToApi()}sendToApi(){let t=0;try{if(t=this.events.length,0===t)return;const e=this.makeTrackEventsData(this.events.filter(v)),i=this.makeViewTimeData(this.events.filter(y));(0,m.TY)("stats.trackEvents",{events:JSON.stringify([e,i])})}catch(t){this.errorLogger.log(t)}finally{this.events=[]}}makeTrackEventsData(t){return t.reduce(((t,e)=>{const i={postId:[e.postId,e.type,e.ref,e.position,e.adData].join("|"),repostId:e.repostId??"",trackCode:e.trackCode??""};return t.post_ids.push(i.postId),t.repost_ids.push(i.repostId),t.track_code.push(i.trackCode),t}),{post_ids:[],repost_ids:[],track_code:[],e:"view_post"})}makeViewTimeData(t){return{e:"view_post_time",views:t.map((t=>({post_id:t.postId,times:`${t.duration}`,widths:`[${t.width}]`,heights:`[${t.height}]`,ref:t.ref,track_code:t.trackCode})))}}scheduleSend(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>{this.sendToApi()}),2500)}constructor(t,e){this.statsApi=t,this.errorLogger=e,this.events=[],this.timeoutId=void 0}}f=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===g._?Object:g._,void 0===_.v?Object:_.v])],f);var S=i(623384);class w{sendToStatEventsAdd(t){const e=this.prepareStatEventsAddViewEvent(t);this.viewLogger?.logViewTimeSent(e),e&&this.productionStats.send(e)}sendAdImpressionEvent(t){const e=this.prepareAdEvent(t);e&&this.adApi.registerAdEvents({events:JSON.stringify([e])})}sendViewPostToStatsTrackEvents(t){const e=this.prepareViewPostEvent(t);this.viewLogger?.logTrackEventsSent(e),e&&this.postAdsStats.send(e)}sendViewPostTimeToStatsTrackEvents(t){const e=this.prepareViewPostTimeEvent(t);this.viewLogger?.logTrackEventsSent(e),e&&this.postAdsStats.send(e)}sendViewPostToAudienceResearch(t,e){const i=this.feedEntitiesStore.getItem(t);if(!i||!(0,a.i4)(i))return;const s=(0,S.x)(e),{urls:o,events:n}=i.value.research??{};this.audienceResearchService.send({urls:o,events:n,surface:s})}sendViewPostToStatsTrackEventsImmediately(t){const e=t.map((({statsData:t})=>[this.prepareViewPostEvent({index:t.index,itemId:t.itemId,width:t.width,height:t.height,startTime:t.startTime,endTime:t.endTime,screen:t.screen}),this.prepareViewPostTimeEvent({itemId:t.itemId,startTime:t.startTime,endTime:t.endTime,screen:t.screen,width:t.width,height:t.height})]));this.viewLogger?.logTrackEventsSent(e),this.postAdsStats.sendAllEventsImmediately(e.flat().filter((t=>void 0!==t)))}prepareViewPostTimeEvent(t){const{endTime:e,startTime:i,itemId:s,width:o,height:n,screen:a=this.metaData.get().screen}=t;if(-1===e||-1===i)return;if(!s)return;const r=this.feedEntitiesStore.getItem(s);let d=r?.value.track_code;if(r?.value&&"ads"in r?.value&&!d){const t=r?.value.ads?.[0];d=t?.post?.track_code}return{e:"view_post_time",duration:e-i,ref:a,postId:s,width:o,height:n,trackCode:d}}prepareViewPostEvent(t){const{itemId:e,index:i,repostId:s,startTime:o,endTime:n,screen:a=this.metaData.get().screen}=t;if(-1===n||-1===o)return;if(!e)return;const r=this.feedEntitiesStore.getItem(e),d=r?.apiType??"post";let c,l=r?.value.track_code;if(r?.value&&"ads"in r?.value){const t=r?.value.ads?.[0];c=t?.ad_data,l||(l=t?.post?.track_code)}else r?.value&&"ad_data"in r?.value&&(c=r?.value.ad_data);return{e:"view_post",type:d,ref:a,position:i,postId:e,repostId:s,trackCode:l,adData:c}}prepareStatEventsAddViewEvent(t){const{endTime:e,startTime:i,itemId:s,index:o,width:a,height:r,itemType:d,screen:c=this.metaData.get().screen}=t;if(-1===e||-1===i)return;if(!s)return;const l=this.feedEntitiesStore.getItem(s),h=d??l?.apiType??"post",u=l?.value.track_code,{id:g,ownerId:_}=(0,n.v)(s),m={type:h,id:g,owner_id:_,track_code:u};return{screen:c,type:"type_view",type_view:{position:o,end_view:(0,p.S4)(e),start_view:(0,p.S4)(i),item:m,type:"type_feed_item",type_feed_item:{event_type:h,width:a,height:r}}}}prepareAdEvent(t){const{itemId:e}=t;if(!e)return;const i=this.feedEntitiesStore.getItem(e);let s;if(i?.value&&"ads"in i?.value){const t=i?.value.ads?.[0];s=t?.ad_data_impression}return s?{event_type:"impression",ad_data_impression:s}:void 0}async initViewLogger(){this.viewLogger=await this.viewStatsLoggerFactory.ensure()}constructor(t,e,i,s,o,n,a){this.productionStats=t,this.feedEntitiesStore=e,this.metaData=i,this.postAdsStats=s,this.viewStatsLoggerFactory=o,this.adApi=n,this.audienceResearchService=a,this.initViewLogger()}}w=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===c.X?Object:c.X,void 0===r.B?Object:r.B,void 0===l.e?Object:l.e,void 0===f?Object:f,void 0===u.h?Object:u.h,void 0===h.c?Object:h.c,void 0===d.T?Object:d.T])],w);var b=i(863516),P=i(90919),A=i(645189),k=i(903473),C=i(337951);class I{async initViewLogger(){this.viewLogger=await this.viewStatsLoggerFactory.ensure()}get isFeedAudienceResearchEnabled(){return this.userEnv.isToggleEnabled("feed_audience_research")}get isTmrTrackerEnabled(){return this.userEnv.partConfigEnabled("frontend.feed_spa_tmr_tracking")}constructor(t,e,i,s,o){this.feedPostViewStats=t,this.viewStatsLoggerFactory=e,this.myTrackerService=i,this.userEnv=s,this.metaData=o,this.viewLogger=void 0,this.myTracker=null,this.onStartViewPost=(t,e)=>{const i=e?.screen||this.metaData.get().screen;t?.viewTimePost?.setScreen(i),this.viewLogger?.logViewStarted(t,t),e&&this.userEnv.partConfigEnabled("frontend.spa_feed_ads_register_event")&&this.feedPostViewStats.sendAdImpressionEvent(e)},this.onEndViewPost=(t,e)=>{if(this.viewLogger?.logViewEnded(e,e),this.feedPostViewStats.sendToStatEventsAdd(t),this.isTmrTrackerEnabled&&this.myTracker?.increment(),this.isFeedAudienceResearchEnabled&&e?.viewTimePost?.id){const i=t?.screen||this.metaData.get().screen;this.feedPostViewStats.sendViewPostToAudienceResearch(e?.viewTimePost?.id,i)}},this.onEndViewPostTrackEvents=(t,e)=>{this.viewLogger?.logViewEnded(e,e),this.feedPostViewStats.sendViewPostToStatsTrackEvents(t),this.feedPostViewStats.sendViewPostTimeToStatsTrackEvents({itemId:t.itemId,startTime:t.startTime,endTime:t.endTime,screen:t.screen,width:t.width,height:t.height}),this.isTmrTrackerEnabled&&this.myTracker?.increment()},this.onEndViewPostAfterVisibilityChange=t=>{t.forEach((({logData:t,statsData:e})=>{if(-1!==e.endTime&&-1!==e.startTime&&(this.viewLogger?.logViewEnded(t,t),this.feedPostViewStats.sendToStatEventsAdd(e),this.isTmrTrackerEnabled&&this.myTracker?.increment(),this.isFeedAudienceResearchEnabled&&t?.viewTimePost?.id)){const i=e?.screen||this.metaData.get().screen;this.feedPostViewStats.sendViewPostToAudienceResearch(t?.viewTimePost?.id,i)}}))},this.onEndViewPostTrackEventsAfterVisibilityChange=t=>{t.forEach((({logData:t,statsData:e})=>{-1!==e.endTime&&-1!==e.startTime&&(this.viewLogger?.logViewEnded(t,t),this.isTmrTrackerEnabled&&this.myTracker?.increment())})),this.feedPostViewStats.sendViewPostToStatsTrackEventsImmediately(t)},this.onSendPostImmediately=(t,e)=>{const i=new k.v({item:e.postItem,index:t.index,element:e.element}),s={element:i.element,viewTimePost:i,type:t.itemType};let o=this.metaData.get().screen;e.isLayerOpened&&(o=(0,C.q)(o,e.isLayerOpened)),s.viewTimePost.setScreen(o),s.viewTimePost.startView(),this.viewLogger?.logViewStarted(s,s),s.viewTimePost.endView();const n=e.postSize,a={index:t.index,itemId:t.itemId,width:n.width,height:n.height,itemType:t.itemType,screen:i.screen,startTime:s.viewTimePost.startTime,endTime:s.viewTimePost.endTime};"ads"===s.type||"post_ads"===s.type||"ads_post"===s.type?this.onEndViewPostTrackEvents(a,s):this.onEndViewPost(a,s)},this.myTracker=this.myTrackerService.ensureActivityCounter({activityId:b.f.FeedPostViewEventCount}),this.initViewLogger()}}I=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===w?Object:w,void 0===u.h?Object:u.h,void 0===P.N?Object:P.N,void 0===A.J?Object:A.J,void 0===l.e?Object:l.e])],I)},694828:(t,e,i)=>{i.d(e,{N:()=>o,a:()=>s});const s=t=>`feed-id-visible-${t}`;class o{observe(t,e){this.items.get(t)||this.observer?.observe(t),this.items.set(t,e)}unobserve(t){this.items.delete(t),this.observer?.unobserve(t)}disconnect(){this.observer?.disconnect()}constructor(t,e){if(this.items=new WeakMap,!("IntersectionObserver"in window))return;const i={threshold:e.threshold,rootMargin:e.rootMargin??"0px"};this.observer=new IntersectionObserver((e=>{e.forEach((e=>{if(!(e.target instanceof HTMLElement))return;const o=this.items.get(e.target);if(!o)return;const n={observerName:t,threshold:i.threshold,isIntersecting:e.isIntersecting,intersectionRatio:e.intersectionRatio},a=new CustomEvent(s(o),{detail:n});window.dispatchEvent(a)}))}),i)}}},623384:(t,e,i)=>{i.d(e,{x:()=>o});var s=i(68510);const o=t=>{switch(t){case"feed_search":case"feed_other":case"feed_friends_recent":case"feed_photos_recent":case"feed_news_recent":case"feed_news_top":case"feed_friends":case"feed_top":case"feed_recent":case"feed_likes":case"feed":case"search":case"places":return s.F.feed_post;case"profile_user":case"group":case"public":case"profile":case"wall":case"club":return s.F.wall_post;case"wall_post":return s.F.single_post;default:return s.F.other}}},548893:(t,e,i)=>{i.d(e,{V$:()=>o,Wz:()=>n,jy:()=>a});var s=i(328911);const o=t=>"gif"===t.ext&&Boolean(t.preview?.video),n=t=>{if(!t.url)return"";try{return new URL(t.url).searchParams.get("hash")??""}catch{}return""},a=t=>(0,s.o)({ownerId:t.owner_id,itemId:t.id})},360864:(t,e,i)=>{i.d(e,{L:()=>s});const s=t=>Boolean(t&&"comments"in t.value&&t.value.comments?.count)},347261:(t,e,i)=>{i.d(e,{P:()=>s});const s=t=>t.preview_url?{...t,url:t.preview_url.url}:t},466968:(t,e,i)=>{i.d(e,{D:()=>n});var s=i(327813),o=i(161933);class n{get vkcomKitBrowserGlitchesOptimizeFix(){return!1}constructor(t,e){this.getBackdropBlur=t,this.userEnv=e,this.mediaGridFeatures={isHeightLimitEnabled:(0,o.HS)(),isFullWidthEnabled:(0,o.HS)(),isBrowserGlitchesFixEnabled:this.vkcomKitBrowserGlitchesOptimizeFix},(0,s.l_)(this)}}},774505:(t,e,i)=>{i.d(e,{CE:()=>n,us:()=>a});var s=i(451465),o=i(516427);const n=()=>s.T.chrome?"svg":"backdrop_blur",a=t=>t===o.ODD.VKCOM?n():s.T.chrome?"svg":s.T.safari?"backdrop_blur":"blur"},967747:(t,e,i)=>{i.d(e,{eE:()=>n,sr:()=>s,x6:()=>o});const s=2,o=2048,n=3},69789:(t,e,i)=>{i.d(e,{BL:()=>l,Bf:()=>Q,Dw:()=>_,EC:()=>G,EH:()=>x,EP:()=>u,GJ:()=>tt,GZ:()=>Y,HP:()=>q,JG:()=>h,LY:()=>Z,MV:()=>c,Q1:()=>C,RP:()=>ot,Rn:()=>B,Sf:()=>H,XC:()=>st,Xr:()=>b,YD:()=>V,YP:()=>U,Zk:()=>z,a9:()=>E,aR:()=>O,cL:()=>y,d:()=>it,fY:()=>I,g:()=>W,gB:()=>w,gP:()=>L,gz:()=>$,hI:()=>et,hJ:()=>J,iB:()=>A,jt:()=>g,kj:()=>X,ku:()=>T,n$:()=>F,nP:()=>R,nV:()=>nt,oH:()=>d,pp:()=>K,q$:()=>m,q_:()=>D,r9:()=>N,rk:()=>k,sr:()=>p,t$:()=>M,tA:()=>r,yT:()=>P,yg:()=>v,zD:()=>j,zN:()=>f,zW:()=>S});var s=i(907846),o=i(344265),n=i(799835),a=i(257581);const r=550,d=690,c=44,l=56,h=24,p=10,u=1e3,g=300,_=5,m=1e3,v=50,y={BASE:"base",POLL:"poll",PHOTO_PICKER:"photo_picker",VIDEO_PICKER:"video_picker",AUDIO_PICKER:"audio_picker",GEO_PICKER:"geo_picker",PHOTO_CROP:"photo_crop",PHOTO_EDITOR:"photo_editor",PHOTO_VIEWER:"photo_viewer",CO_OWNERS_PICKER:"co_owners_picker",ADD_PRODUCT:"add_product",SETTINGS:"settings",BEST_FRIENDS:"best_friends",ACTION_BUTTONS:"action_buttons",FILE:"file_picker",PRIVACY:"privacy",EDIT_REPLY:"edit_reply",OLD_POST_EDIT_ALERT:"old_post_edit_alert",PODCAST_EPISODE_PICKER:"podcast_episode_picker",DONUT_TEASER:"donut_teaser",DRAFTS_LIST:"drafts_list"},f={BASE:"base",SETTINGS:"settings",VIDEO_PICKER:"video_picker",MEDIA_PICKER:"media_picker",ADDITIONAL_SETTINGS:"additional_settings",ACTION_BUTTONS:"action_buttons",GEO_PICKER:"geo_picker",ORD:"ord",FILE:"file",PHOTO_PICKER:"photo_picker"},S=f.BASE;var w=function(t){return t.Groups="groups",t.Profile="profile",t.Feed="feed",t}({}),b=function(t){return t.Likes="likes",t.Comments="comments",t.List="list",t.Photos="photos",t.Recommended="recommended",t.News="news",t.Search="search",t.Friends="friends",t.Groups="groups",t}({});const P={likes:a.cQ.FeedLikes,comments:a.cQ.FeedComments,list:a.cQ.FeedCustomListRecent,photos:a.cQ.FeedPhotosRecent,recommended:a.cQ.FeedRecommended,news:{recent:a.cQ.FeedRecent,top:a.cQ.FeedTop},search:a.cQ.FeedSearch,friends:a.cQ.FeedFriendsRecent,groups:a.cQ.FeedGroupsRecent},A={wall:a.cQ.Wall,group:a.cQ.Group,profile:a.cQ.Profile};var k=function(t){return t.TWO_BY_THREE="TWO_BY_THREE",t.FOUR_BY_FIVE="FOUR_BY_FIVE",t.THREE_BY_FOUR="THREE_BY_FOUR",t.SQUARE="SQUARE",t.FOUR_BY_THREE="FOUR_BY_THREE",t.SIXTEEN_BY_NINE="SIXTEEN_BY_NINE",t.ORIGINAL="ORIGINAL",t}({}),C=function(t){return t.CAROUSEL="CAROUSEL",t.GRID="GRID",t}({});const I={CAROUSEL:{label:(0,n.Xo)("wall_posting_carousel_view"),icon:s.M,key:"CAROUSEL"},GRID:{label:(0,n.Xo)("wall_posting_grid_view"),icon:o.B,key:"GRID"}};const E={SQUARE:{ratio:1,gapOffset:68,label:"1:1",value:"1_1",key:"SQUARE"},TWO_BY_THREE:{ratio:2/3,gapOffset:131,label:"2:3",value:"2_3",key:"TWO_BY_THREE"},THREE_BY_FOUR:{ratio:.75,gapOffset:120,label:"3:4",value:"3_4",key:"THREE_BY_FOUR"},FOUR_BY_FIVE:{ratio:.8,gapOffset:120,label:"4:5",value:"4_5",key:"FOUR_BY_FIVE"},SIXTEEN_BY_NINE:{ratio:1.78,gapOffset:68,label:"16:9",value:"16_9",key:"SIXTEEN_BY_NINE"},FOUR_BY_THREE:{ratio:1.33,gapOffset:68,label:"4:3",value:"4_3",key:"FOUR_BY_THREE"},ORIGINAL:{ratio:void 0,gapOffset:68,label:"global_posting_carousel_ratio_original",value:"original",key:"ORIGINAL"}},L=E.SIXTEEN_BY_NINE.ratio,T=E.TWO_BY_THREE.ratio,M=E.THREE_BY_FOUR,O=I.CAROUSEL,D=Object.values(E),x="photo_200,photo_100,sex,video_files,friend_status,first_name_gen,last_name_gen,screen_name,verified,trending,emoji_status,image_status,has_unseen_stories,is_government_organization,has_live_cover,has_stories,is_nft,is_nft_photo,is_esia_verified,is_tinkoff_verified,is_sber_verified,oauth_verification,social_button_type,is_work_group,work_group_info,url,can_write_private_message,can_message,caption",R="domain,maiden_name,sex,photo,photo_50,photo_100,screen_name";var Y=function(t){return t.Ok="ok",t.Error="error",t}({}),F=function(t){return t.PostingAttachmentsErrorMusicAlert="posting_attachments_error_music_alert",t.PostingMusicWithoutPhotoDependencyAlert="posting_music_without_photo_dependency_alert",t.PostingRemovePhotoWithProductsAlert="posting_remove_photo_with_products_alert",t.PostingRemovePhotoWithProductsMusicAlert="posting_remove_photo_with_products_music_alert",t.PostingCropPhotoWithProductsAlert=" posting_crop_photo_width_products_alert",t.PostingChangeRatioPhotoWithProductsAlert=" posting_change_ratio_photo_width_products_alert",t.PostingExitAlert="posting_exit_alert",t.PostingRemovePhotoWithProductsPodcastAlert="posting_remove_photo_with_products_podcast_alert",t.PostingPodcastWithoutPhotoDependencyAlert="posting_podcast_without_photo_dependency_alert",t.PostingCommentsClosedAlert="posting_comments_closed_alert",t}({}),B=function(t){return t.NetworkGeneralError="network_general_error",t.PhotoGeneralUploadError="photo_general_upload_error",t.PhotoWrongSizeError="photo_wrong_size_error",t.VideoGeneralUploadError="video_general_upload_error",t.PhotoUnsupportedFormat="photo_unsupported_format",t.FileSizeExceedsLimit="file_size_exceeds_limit",t.FileSizeBelowMinimum="file_size_below_minimum",t.VideoUnsupportedFormat="video_unsupported_format",t.FileUnsupportedFormat="file_unsupported_format",t.VideoBlockedUpload="video_blocked_upload",t.AttachmentLimitExceeded="attachment_limit_exceeded",t.AttachmentsLimitExceeded="attachments_limit_exceeded",t.PoolEditNotAllowed="pool_edit_not_allowed",t.OrdEditNotAllowed="ord_edit_not_allowed",t.InvalidPublishDateParam="invalid_publish_date_param",t.CoOwnersErrorLoad="co_owners_load_error",t.CoOwnersSelectedItemsLimitReached="co_owners_selected_items_limit_reached",t.ProductsLimitExceeded="products_limit_exceeded",t.EmptyPostAlertTitle="empty_post_alert_title",t.AddCoOwnersWithActionButtons="add_co_owners_with_action_buttons",t.AddActionButtonsWithCoOwners="add_action_buttons_with_co_owners",t.SignSettingChangeDisabled="sign_setting_change_disabled",t.SignSettingDisabledDueToCoauthors="sign_setting_disabled_due_to_coauthors",t.VideoUploadGroupNotAllowed="video_upload_group_not_allowed",t.DraftWithPublishDateNotAllowed="draft_width_publish_date_not_allowed",t}({}),N=function(t){return t.InvalidMessageParam="One of the parameters specified was missing or invalid: invalid message param",t.EmptyPostNotAllowed="One of the parameters specified was missing or invalid: Required any of text,photo,video attachments",t.InvalidPublishDateParam="One of the parameters specified was missing or invalid: invalid publish_date param",t.InvalidCreatePoolEndDateParam="One of the parameters specified was missing or invalid: end_date should be greater or equal to",t.InvalidEditPoolEndDateParam="One of the parameters specified was missing or invalid: end_date should be greater than",t.NotUploadedAllVideos="One of the parameters specified was missing or invalid: attachments support only uploaded video",t.NotUploadedAllPhotos="One of the parameters specified was missing or invalid: attachments support only uploaded photo",t.VideoUploadNotAllowed="Permission to perform this action is denied: owner has not right for this action, can't add video",t.AccessToTheWallIsClosed="Access to adding post denied: access to the wall is closed",t}({}),z=function(t){return t.FileSizeBelowMinimumError="File size below minimum",t.UploadingPhotoError="Error uploading photo",t.UploadingVideoError="Error uploading video",t.LoadingUserOwnerError="Error loading user",t.LoadingPickerDataError="Error loading picker data",t.LoadingCoOwnersError="Error loading co owners",t.UnsupportedVideoFormatError="Unsupported video format",t.UnsupportedPhotoFormatError="Unsupported photo format",t.UnsupportedFileFormatError="Unsupported file format",t.FileSizeExceedsLimit="File size exceeds limit",t.VideoBlockedUpload="Video blocked upload",t.ErrorLoadingBestFriendsPicker="Error loading best friends picker",t.ErrorLoadingPhotoPicker="Error loading photo picker",t.ErrorLoadingAudioPicker="Error loading audio picker",t.ErrorLoadingPollPicker="Error loading poll picker",t.ErrorLoadingProductPicker="Error loading product picker",t.ErrorLoadingVideoPicker="Error loading video picker",t}({});const V=-15,U=-14,G=-8,j=-156,W=-165,H=-10,$=-183,K="panel",q=500,Q=100,J="fileId",X=.01,Z=9e3,tt=4601,et={items:{},forAdd:{},forDelete:{}},it="miniapp",st="https://vkvideo.ru/legal/terms",ot=10,nt=112},178491:(t,e,i)=>{i.d(e,{Cg:()=>p,wr:()=>g,qT:()=>u});var s=i(815287),o=i(978350),n=i(317708),a=i(353014),r=i(217708);const d={1:"A",2:"B",3:"C",4:"D"},c=()=>{const t=(0,r.I)();return{getCurrentExperimentGroup:()=>{if(!t.isToggleEnabled("feed_image_auto_crop"))return"A";const e=t.getToggleAbGroupId("feed_image_auto_crop");return d[e]||"C"}}},l={HIGHER_MIN:1.94/3,HIGHER_MID:.64,HIGHER_MAX:1.9/3,WIDER_MIN:16/8.64,WIDER_MID:16/(9*.95),WIDER_MAX:16/(9*.94)},h={A:null,B:{portrait:{min:l.HIGHER_MIN,max:o.w.HIGHER},landscape:{min:o.w.WIDER,max:l.WIDER_MIN},square:{min:o.w.SQUARE,max:o.w.SQUARE}},C:{portrait:{min:l.HIGHER_MID,max:o.w.HIGHER},landscape:{min:o.w.WIDER,max:l.WIDER_MID},square:{min:o.w.SQUARE,max:o.w.SQUARE}},D:{portrait:{min:l.HIGHER_MAX,max:o.w.HIGHER},landscape:{min:o.w.WIDER,max:l.WIDER_MAX},square:{min:o.w.SQUARE,max:o.w.SQUARE}}},p=()=>{const{getCurrentExperimentGroup:t}=c(),e=t(),i=h[e],s=(t,e)=>{if(!i||!t||!e)return!1;const s=(0,n.GF)({width:t,height:e}),o=(0,a._R)(t,e);return!!o&&(s>=i[o].min&&s<=i[o].max)};return{getImageOptimizedCrop:(t,e)=>{if(!t||!e)return;let i=(0,a._R)(t,e);if(s(t,e)){if("landscape"===i){const i=Math.floor(e*o.w.WIDER);return{width:i,height:e,x:Math.floor((t-i)/2),y:0}}if("portrait"===i){const i=Math.floor(t/o.w.HIGHER);return{width:t,height:i,x:0,y:Math.floor((e-i)/2)}}}},shouldAutoCropPhoto:s}},u=(t,e)=>{const{shouldAutoCropPhoto:i}=p();return(0,s.useMemo)((()=>i(t,e)),[t,e])},g=(t,e)=>{const{getImageOptimizedCrop:i}=p();return(0,s.useMemo)((()=>i(t,e)),[t,e])}},64165:(t,e,i)=>{i.d(e,{e:()=>h});var s=i(331635),o=i(327813),n=i(42107),a=i(273193),r=i(97929),d=i(69789),c=i(711672);const l=t=>(0,c.r)(t).map((t=>{switch(t.kind){case"Text":return t.text;case"Email":return t.email;case"Url":return`<a href="${t.href}" target="_blank">${t.caption}</a>`;case"Hashtag":return t.tag;case"Mention":case"MassMention":return t.displayName;case"ScreenNameMention":return t.displayName?t.displayName:`@${t.screenName}`;case"LineBreak":return"<br/>";default:return null}})).filter(Boolean).join("");class h{clearInputFieldErrors(){this._inputFieldErrors={}}clearInputFieldError(t){delete this._inputFieldErrors[t]}get inputFieldErrors(){return this._inputFieldErrors}[n.zr](){Array.from(this.shownSnackbars.values()).forEach(clearTimeout),this.shownSnackbars=new Map,this._inputFieldErrors={}}get mappedErrors(){return[{error:d.r9.InvalidPublishDateParam,lang:this.langs.getLang("wall_postpone_error_date")},{error:d.r9.EmptyPostNotAllowed,lang:this.langs.getLang("wall_posting_empty_post_alert_title")},{error:d.r9.InvalidMessageParam,lang:this.langs.getLang("wall_posting_empty_post_alert_title")},{error:d.r9.InvalidCreatePoolEndDateParam,lang:this.langs.getLang("wall_posting_poll_until_in_past_alert_title")},{error:d.r9.InvalidEditPoolEndDateParam,lang:this.langs.getLang("wall_posting_poll_until_in_past_alert_title")},{error:d.r9.NotUploadedAllVideos,lang:this.langs.getLang("wall_posting_not_all_loaded_yet_alert_title")},{error:d.r9.NotUploadedAllPhotos,lang:this.langs.getLang("wall_posting_not_all_loaded_yet_alert_title")},{error:d.r9.VideoUploadNotAllowed,lang:this.langs.getLang("wall_posting_video_upload_not_allowed_title")},{error:d.r9.AccessToTheWallIsClosed,lang:this.langs.getLang("wall_posting_access_to_the_wall_is_closed_title")}]}constructor(t,e){this.langs=t,this.snackbar=e,this._inputFieldErrors={},this.shownSnackbars=new Map,this.setInputFieldError=(t,e)=>{this._inputFieldErrors[t]=e},this.showSnackbar=t=>{const{text:e,subtitle:i,...s}=t;if(this.shownSnackbars.has(e))return;const o=()=>{this.shownSnackbars.delete(e)},n=setTimeout(o,d.LY);this.snackbar.show({duration:d.LY,onClose:()=>{clearTimeout(n),o()},text:l(e),subtitle:i?l(i):void 0,interpolate:!0,...s}),this.shownSnackbars.set(t.text,n)},this.hideSnackbar=t=>{this.snackbar.hide(t)},this.showErrorSnackbar=t=>{this.showSnackbar(this.getErrorOptions(t))},this.showCustomErrorSnackbar=t=>{this.showSnackbar({text:t,type:d.GZ.Error})},this.showMappedErrorSnackbar=t=>{this.showSnackbar({type:d.GZ.Error,text:this.getMappedErrorOptions(t)})},this.getErrorOptions=t=>{switch(t){case d.Rn.NetworkGeneralError:return{text:this.langs.getLang("wall_posting_network_general_error_text"),subtitle:this.langs.getLang("wall_posting_network_general_error_subtitle"),type:d.GZ.Error};case d.Rn.CoOwnersSelectedItemsLimitReached:return{text:this.langs.getLang("wall_posting_selected_coowners_limit_reached_text"),type:d.GZ.Error};case d.Rn.PhotoGeneralUploadError:return{text:this.langs.getLang("wall_posting_photo_general_upload_error_text"),type:d.GZ.Error};case d.Rn.PhotoWrongSizeError:return{text:this.langs.getLang("wall_posting_photo_wrong_size_error_text"),type:d.GZ.Error};case d.Rn.VideoGeneralUploadError:return{text:this.langs.getLang("wall_posting_video_general_upload_error_text"),type:d.GZ.Error};case d.Rn.PhotoUnsupportedFormat:return{text:this.langs.getLang("wall_posting_photo_unsupported_format_text"),subtitle:this.langs.getLang("wall_posting_photo_unsupported_format_subtitle"),type:d.GZ.Error};case d.Rn.FileSizeExceedsLimit:return{text:this.langs.getLang("wall_posting_file_size_exceeds_limit_text"),subtitle:this.langs.getLang("wall_posting_file_size_exceeds_limit_subtitle"),type:d.GZ.Error};case d.Rn.FileSizeBelowMinimum:return{text:this.langs.getLang("wall_posting_file_size_below_minimum_text"),subtitle:this.langs.getLang("wall_posting_file_size_below_minimum_subtitle"),type:d.GZ.Error};case d.Rn.VideoUnsupportedFormat:return{text:this.langs.getLang("wall_posting_video_unsupported_format_text"),subtitle:this.langs.getLang("wall_posting_video_unsupported_format_subtitle"),type:d.GZ.Error};case d.Rn.FileUnsupportedFormat:return{text:this.langs.getLang("wall_posting_file_unsupported_format_text"),subtitle:this.langs.getLang("wall_posting_file_unsupported_format_subtitle"),type:d.GZ.Error};case d.Rn.VideoBlockedUpload:return{text:this.langs.getLang("wall_posting_video_blocked_upload_text"),subtitle:this.langs.getLang("wall_posting_video_blocked_upload_subtitle"),type:d.GZ.Error};case d.Rn.ProductsLimitExceeded:return{text:this.langs.numeric(d.Dw,this.langs.getLang("market_attach_products_overflow",!0)),type:d.GZ.Error};case d.Rn.AttachmentLimitExceeded:return{text:this.langs.getLang("wall_posting_attachment_limit_exceeded_text"),subtitle:this.langs.getLang("wall_posting_attachment_limit_exceeded_subtitle"),type:d.GZ.Error};case d.Rn.AttachmentsLimitExceeded:return{text:this.langs.getLang("wall_posting_attachments_limit_exceeded_text"),subtitle:this.langs.getLang("wall_posting_attachments_limit_exceeded_subtitle"),type:d.GZ.Error};case d.Rn.PoolEditNotAllowed:return{text:this.langs.getLang("wall_posting_poll_edit_warn"),type:d.GZ.Error};case d.Rn.OrdEditNotAllowed:return{text:this.langs.getLang("wall_posting_ord_snackbar_disabled_text"),type:d.GZ.Error};case d.Rn.InvalidPublishDateParam:return{text:this.langs.getLang("wall_postpone_error_date"),type:d.GZ.Error};case d.Rn.EmptyPostAlertTitle:return{text:this.langs.getLang("wall_posting_empty_post_alert_title"),type:d.GZ.Error};case d.Rn.AddCoOwnersWithActionButtons:return{text:this.langs.getLang("wall_posting_add_coowner_with_action_button"),type:d.GZ.Error};case d.Rn.AddActionButtonsWithCoOwners:return{text:this.langs.getLang("wall_posting_add_action_button_with_coowner"),type:d.GZ.Error};case d.Rn.SignSettingChangeDisabled:return{text:this.langs.getLang("wall_posting_sign_setting_change_disabled_text"),type:d.GZ.Error};case d.Rn.SignSettingDisabledDueToCoauthors:return{text:this.langs.getLang("wall_posting_settings_coowners_signed_alert_title"),type:d.GZ.Error};case d.Rn.VideoUploadGroupNotAllowed:return{text:this.langs.getLang("wall_posting_video_upload_group_not_allowed_title"),type:d.GZ.Error};case d.Rn.DraftWithPublishDateNotAllowed:return{text:this.langs.getLang("wall_posting_draft_with_publish_date_not_allowed_title"),bottomAction:{label:this.langs.getLang("wall_posting_draft_with_publish_date_not_allowed_action_label"),onClick:(t,e)=>{this.hideSnackbar(e)}},type:d.GZ.Error};default:return{text:this.langs.getLang("global_unexpected_error_try_later"),type:d.GZ.Error}}},this.getMappedErrorOptions=t=>this.mappedErrors.find((({error:e})=>t.startsWith(e)))?.lang??this.langs.getLang("global_unexpected_error_try_later"),this.isVideoUploadNotAllowed=t=>t.startsWith(d.r9.VideoUploadNotAllowed),this.onAttachmentLimitExceededError=t=>{t&&t>1?this.showErrorSnackbar(d.Rn.AttachmentsLimitExceeded):this.showErrorSnackbar(d.Rn.AttachmentLimitExceeded)},this.onAudioAttachmentLimitExceededError=t=>{this.showCustomErrorSnackbar(this.langs.numeric(t,this.langs.getLang("wall_posting_audio_attachments_limit_exceeded_text",!0)))},this.onNetworkErrorSnackbar=()=>{this.showErrorSnackbar(d.Rn.NetworkGeneralError)},this.onShowAdsPostEditError=({onClose:t})=>{this.showSnackbar({text:this.langs.getLang("wall_posting_restriction_ads_post_edit_text"),subtitle:this.langs.getLang("wall_posting_restriction_ads_post_edit_subtitle"),type:d.GZ.Error,action:{label:this.langs.getLang("wall_posting_restriction_ads_post_edit_action"),onClick:(e,i)=>{this.hideSnackbar(i),t()}}})},(0,o.l_)(this)}}h=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.Y?Object:a.Y,void 0===r.q?Object:r.q])],h)},991237:(t,e,i)=>{i.d(e,{H:()=>l,I:()=>h});var s=i(331635),o=i(327813),n=i(42107),a=i(645189),r=i(69789),d=i(399902);const c=t=>t&&(t=>Object.values(r.zN).includes(t))(t)?t:r.zW,l={CREATE_POLL:"createPoll",PRIVACY:"privacy",BEST_FRIENDS:"best_friends",AUDIO_PICKER:"audioPicker",CO_OWNERS:"co_owners",DONUT_PUBLISH_DATE:"donut_publish_date",FILE:"file",OLD_POST_EDIT_ALERT:"old_post_edit_alert",DONUT_TEASER:"donut_teaser"};class h{get popout(){return this._popout}get alertProps(){return this._alertProps}get activeModal(){return this._activeModal}get panel(){const t=new URLSearchParams(window.location.search).get(r.pp);return c(t)}openExitAlert(){this.onNavigateBack&&this.setAlertProps({type:r.n$.PostingExitAlert,onClose:this.closePopout,onSubmit:()=>this.goBackPanel(!0)})}init(t){const{onNavigate:e,onNavigateBack:i,onLeave:s,onHasChanges:n,isEdit:a,onChangeModal:r}=t;(0,o.h5)((()=>{this.onNavigate=e,this.onNavigateBack=i,this.onLeave=s,this.onHasChanges=n,this.isEdit=a,this.onChangeModal=r}))}goToPanel(t){this.onNavigate?.((t=>(0,d.G)(window.location.pathname,{[r.pp]:t}))(t))}goBackPanel(t){!t&&this.isEdit&&this.panel===r.zW&&this.onHasChanges?.()?this.openExitAlert():this.panel===r.zW&&this.onLeave?this.onLeave():this.onNavigateBack?.()}openPopout(t){this._alertProps=null,this._popout=t}[n.zr](){this._popout=null,this._activeModal=null,this.onNavigate=void 0,this.onNavigateBack=void 0,this.onHasChanges=void 0}constructor(t){this.userEnv=t,this._popout=null,this._alertProps=null,this._activeModal=null,this.isEdit=!1,this.onNavigate=void 0,this.onNavigateBack=void 0,this.onLeave=void 0,this.onHasChanges=void 0,this.onChangeModal=void 0,this.openPopoutOldPostEditAlert=()=>{this.openModal(l.OLD_POST_EDIT_ALERT)},this.setAlertProps=t=>{this._alertProps={...t,onClose:t.onClose??this.closePopout}},this.closePopout=()=>{this._popout=null},this.openModal=t=>{this._activeModal=t,this.onChangeModal?.(t)},this.closeModal=()=>{this._activeModal=null,this.onChangeModal?.(null)},this.openAudioPickerScreen=()=>this.openModal(l.AUDIO_PICKER),this.openPollScreen=()=>this.openModal(l.CREATE_POLL),this.openFileScreen=()=>this.openModal(l.FILE),this.openBestFriendsScreen=()=>this.openModal(l.BEST_FRIENDS),this.openGeoPickerScreen=()=>this.goToPanel(r.zN.GEO_PICKER),this.openSettingsScreen=()=>this.goToPanel(r.zN.SETTINGS),this.openAdditionalSettingsScreen=()=>this.goToPanel(r.zN.ADDITIONAL_SETTINGS),this.goToMainScreen=()=>this.goToPanel(r.zN.BASE),this.openPhotoPickerScreen=()=>this.goToPanel(r.zN.PHOTO_PICKER),this.openVideoPickerScreen=()=>this.goToPanel(r.zN.VIDEO_PICKER),this.openMediaPickerScreen=()=>this.goToPanel(r.zN.MEDIA_PICKER),this.openPrivacyScreen=()=>this.openModal(l.PRIVACY),this.openActionButtonsScreen=()=>this.goToPanel(r.zN.ACTION_BUTTONS),this.openCoAuthorshipScreen=()=>this.openModal(l.CO_OWNERS),this.openOrdScreen=()=>this.goToPanel(r.zN.ORD),this.openDonutPublishDateScreen=()=>this.openModal(l.DONUT_PUBLISH_DATE),this.openDonutTeaserScreen=()=>this.openModal(l.DONUT_TEASER),(0,o.l_)(this)}}h=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.J?Object:a.J])],h)},104776:(t,e,i)=>{i.d(e,{Uy:()=>n,fj:()=>r,jM:()=>o,vM:()=>a});var s=i(946333);const o=t=>t.reduce(((t,e)=>{if(e.sizes){const i=(0,s.ZN)(e);i&&(t[e.id]=i)}return t}),{}),n=t=>t.reduce(((t,e)=>(t[e.id]=e,t)),{}),a=t=>t.reduce(((t,e)=>{const i=e.item_id;return t[i]||(t[i]=[]),t[i].push(e),t}),{}),r=({crop:t,tag:e,imageMaxSize:i,imageSizeModifier:s=1})=>{const{x:o,y:n,width:a,height:r}=t,d=o+a,c=n+r;if(!e.x||!e.y)return!1;const l=e.x*i.width*s,h=e.y*i.height*s;return o<l&&l<d&&n<h&&h<c}},652228:(t,e,i)=>{i.d(e,{k:()=>y});var s=i(331635),o=i(327813),n=i(42107),a=i(289375),r=i(332855);const d="type_posting_timeline";var c=i(879158);class l{setStartTime(t){null!==this.endTime&&t>this.endTime&&(this.endTime=null),this.startTime=t}setEndTime(t){null!==this.startTime&&this.startTime<=t&&(this.endTime=t)}getStatValue(){return null!==this.startTime&&null!==this.endTime&&this.startTime<=this.endTime?{start_time:this.startTime,end_time:this.endTime}:null}getValue(){const{startTime:t,endTime:e}=this;return{startTime:t,endTime:e}}constructor(){this.startTime=null,this.endTime=null}}class h{setStartTime(t){this.value.setStartTime(t)}setEndTime(t){this.value.setEndTime(t)}getStatEvent(){const t=this.value.getStatValue();return t?{type:r.q.POST_PUBLISHING_TIME_RANGE,[r.q.POST_PUBLISHING_TIME_RANGE]:t}:null}getValue(){return this.value.getValue()}constructor(){this.value=new l}}class p{setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}setMessage(t){this.message=t}setCode(t){this.code=t}getStatValue(){const{timeRange:t,message:e,code:i}=this,s=t.getStatValue();return s?{time_range:s,message:e,code:i}:null}getStatEvent(){const t=this.getStatValue();return t?{type:r.q.POST_PUBLISHING_ERROR,[r.q.POST_PUBLISHING_ERROR]:t}:null}getValue(){const{timeRange:t,message:e,code:i}=this;return{timeRange:t,message:e,code:i}}constructor(){this.timeRange=new l}}class u{setAttachmentType(t){this.attachmentType=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}getStatValue(){const{attachmentType:t,timeRange:e}=this;if(t){const i=e.getStatValue();if(i)return{time_range:i,picker_type:t}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:r.q.PICKER_OPENING,[r.q.PICKER_OPENING]:t}:null}getValue(){const{attachmentType:t,timeRange:e}=this;return{attachmentType:t,timeRange:e}}constructor(){this.attachmentType=null,this.timeRange=new l}}class g{setFileType(t){this.fileType=t}setFileSize(t){this.fileSize=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}getStatValue(){const{fileType:t,fileSize:e,timeRange:i}=this;if(t){const s=i.getStatValue();if(s)return{file_type:t,file_size:e,time_range:s}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:r.q.FILE_UPLOADING,[r.q.FILE_UPLOADING]:t}:null}getValue(){const{fileType:t,fileSize:e,timeRange:i}=this;return{fileType:t,fileSize:e,timeRange:i}}constructor(){this.fileType=null,this.fileSize=0,this.timeRange=new l}}class _{setFileType(t){this.fileType=t}setFileSize(t){this.fileSize=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}setMessage(t){this.message=t}setCode(t){this.code=t}getStatValue(){const{fileType:t,fileSize:e,timeRange:i,message:s,code:o}=this;if(t){const n=i.getStatValue();if(n)return{file_type:t,file_size:e,time_range:n,message:s,code:o}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:r.q.FILE_UPLOADING_ERROR,[r.q.FILE_UPLOADING_ERROR]:t}:null}getValue(){const{fileType:t,fileSize:e,timeRange:i,message:s,code:o}=this;return{fileType:t,fileSize:e,timeRange:i,message:s,code:o}}constructor(){this.fileType=null,this.fileSize=0,this.timeRange=new l}}class m{setAttachmentType(t){this.attachmentType=t}setStartTime(t){this.timeRange.setStartTime(t)}setEndTime(t){this.timeRange.setEndTime(t)}getStatValue(){const{attachmentType:t,timeRange:e}=this;if(t){const i=e.getStatValue();if(i)return{time_range:i,picker_type:t}}return null}getStatEvent(){const t=this.getStatValue();return t?{type:r.q.PICKER_ATTACHMENT_ATTACHING,[r.q.PICKER_ATTACHMENT_ATTACHING]:t}:null}getValue(){const{attachmentType:t,timeRange:e}=this;return{attachmentType:t,timeRange:e}}constructor(){this.attachmentType=null,this.timeRange=new l}}class v{setMessage(t){this.message=t}setCode(t){this.code=t}getStatValue(){const{message:t,code:e}=this;return{message:t,code:e}}getStatEvent(){const t=this.getStatValue();return t?{type:r.q.ERROR,[r.q.ERROR]:t}:null}getValue(){const{message:t,code:e}=this;return{message:t,code:e}}}class y{changePostParams(t){const{isEditing:e,postType:i,creationEntryPoint:s,trackCode:o}=t;this.context={is_editing:e,creation_entry_point:s,post_type:i,track_code:o}}logStartTimeline({screen:t,screenStartTime:e}){this.screen=t,this.screenStartTime=e?{time:e}:(0,c.E6)()}changeScreenStartTime(t){this.screenStartTime={time:t}}logScreenInitialization(){this.screenInitializedTime=(0,c.E6)()}logScreenInteractionReady(){this.screenInteractionTime=(0,c.E6)()}logScreenClose(){this.finishTimeline(),this.sendCurrentEvent()}logStartSending(){this.currentEvents.postPublishingTimeRange||(this.currentEvents.postPublishingTimeRange=new h),this.currentEvents.postPublishingTimeRange.setStartTime((0,c.RU)())}logSuccessfullySend(){this.currentEvents.postPublishingTimeRange&&(this.currentEvents.postPublishingTimeRange.setEndTime((0,c.RU)()),this.events.push(this.currentEvents.postPublishingTimeRange),this.finishTimeline(),this.sendCurrentEvent())}logPostPublishingError({code:t,message:e}){const{postPublishingTimeRange:i}=this.currentEvents;if(!i)return;const s=i.getValue()?.startTime;if(!s)return;const o=new p;o.setStartTime(s),o.setEndTime((0,c.RU)()),t&&o.setCode(t),e&&o.setMessage(e),this.events.push(o),delete this.currentEvents.postPublishingTimeRange}finishTimeline(){this.screenCloseTime=(0,c.E6)()}logPickerOpening({pickerType:t}){const e=new u;e.setStartTime((0,c.RU)()),e.setAttachmentType(t),this.currentEvents.pickerOpening=e}logPickerReady(){const{pickerOpening:t}=this.currentEvents;t&&(t.setEndTime((0,c.RU)()),this.events.push(t),delete this.currentEvents.pickerOpening)}logFileLoaded({rawId:t}){if(!this.uploadingFiles[t])return;const{startTime:e,fileType:i,fileSize:s}=this.uploadingFiles[t],o=new g;o.setStartTime(e),o.setEndTime((0,c.RU)()),o.setFileType(i),o.setFileSize(s),delete this.uploadingFiles[t],this.events.push(o)}logFileLoadingError({code:t,message:e,rawId:i}){const s=this.uploadingFiles[i];if(!s)return;const o=s.fileType,n=s.startTime;if(!n||!o)return;const a=new _;a.setStartTime(n),a.setEndTime((0,c.RU)()),a.setFileType(o),a.setFileSize(s.fileSize),t&&a.setCode(t),e&&a.setMessage(e),this.events.push(a),delete this.uploadingFiles[i]}logStartAttaching({pickerType:t}){const e=new m;e.setStartTime((0,c.RU)()),e.setAttachmentType(t),this.currentEvents.pickerAttachmentAttaching=e}logFinishAttaching(){const{pickerAttachmentAttaching:t}=this.currentEvents;t&&(t.setEndTime((0,c.RU)()),this.events.push(t),delete this.currentEvents.pickerAttachmentAttaching)}logStartAttachingFromMediaPicker(){this.attachingFromMediaPickerTime=(0,c.RU)()}logFinishAttachingFromMediaPicker({withPhoto:t,withVideo:e}){if(!this.attachingFromMediaPickerTime)return;const i=(0,c.RU)();if(t){const t=new m;t.setStartTime(this.attachingFromMediaPickerTime),t.setEndTime(i),t.setAttachmentType(r.ss.PHOTO_VK),this.events.push(t)}if(e){const t=new m;t.setStartTime(this.attachingFromMediaPickerTime),t.setEndTime(i),t.setAttachmentType(r.ss.VIDEO_VK),this.events.push(t)}this.attachingFromMediaPickerTime=null}logError({code:t,message:e}){const i=new v;t&&i.setCode(t),e&&i.setMessage(e.slice(0,128)),this.events.push(i)}sendCurrentEvent(){const t=this.createStatEventItem();t&&this.productionStats.send({type:d,screen:this.screen??this.context?.creation_entry_point??"",[d]:t}),this.resetEventItem()}createStatEventItem(){const{screenStartTime:t,screenInitializedTime:e,screenInteractionTime:i,screenCloseTime:s,context:o,events:n}=this;if(t&&i&&e&&s&&o){const a=[];n.forEach((t=>{const e=t.getStatEvent();e&&(a.length<50||t instanceof h)&&a.push(e)}));return{screen_start_time:t,screen_initialized_time:e,screen_interaction_time:i,screen_close_time:s,context:o,events:a}}return null}resetEventItem(){this.screenStartTime=null,this.screenCloseTime=null,this.screenInitializedTime=null,this.screenInteractionTime=null,this.context=null,this.events=[],this.currentEvents={}}constructor(t){this.productionStats=t,this.screen=null,this.screenStartTime=null,this.screenInteractionTime=null,this.screenInitializedTime=null,this.screenCloseTime=null,this.context=null,this.events=[],this.currentEvents={},this.uploadingFiles={},this.attachingFromMediaPickerTime=null,this.logStartFileUploading=({fileType:t,fileSize:e,rawId:i})=>{this.uploadingFiles[i]||(this.uploadingFiles[i]={startTime:(0,c.RU)(),fileType:t,fileSize:e})},(0,o.l_)(this)}}y=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.X?Object:a.X])],y)},97348:(t,e,i)=>{i.d(e,{i:()=>v});var s=i(331635),o=i(327813),n=i(42107),a=i(141789),r=i(916533),d=i(617989),c=i(99201),l=i(645189),h=i(725308),p=i(144819),u=i(938653),g=i(945782);const _=t=>(0,p.yP)({id:Number(t?.id),ownerId:Number(t?.owner_id),accessKey:t?.access_key}),m=t=>(0,p.yP)({id:Number(t?.id),ownerId:Number(t?.owner_id)});class v{async updateDraftStatus(){try{this.draftStatus=Boolean(await(this.atom?.get()))}catch{}}setOwnerId(t){this.store&&(this.atom=this.store?.createAtom(String(t)),this.updateDraftStatus())}async save(t){this.atom&&(await this.atom.set(t),await this.updateDraftStatus())}async get(){try{const t=await(this.atom?.get());if(!t)return null;if(!t.attachments)return t;const e=await this.getFilteredVideoRawIds(t),i=await this.getFilteredPhotoRawIds(t),s=[];return t.attachments.forEach((t=>{switch(t.type){case"video":{const i=e?.[m(t.video)];i&&s.push({...t,video:{...t.video,...i}});break}case"photo":{const e=i?.[m(t.photo)];e&&s.push({...t,photo:{...t.photo,...e}});break}default:s.push(t)}})),t.attachments=s,t}catch{return null}}async delete(){this.atom&&(await this.atom.delete(),await this.updateDraftStatus(),(0,o.h5)((()=>{this.atom=null})))}async deleteAll(){await(this.store?.clear()),await this.updateDraftStatus(),(0,o.h5)((()=>{this.atom=null}))}async getFilteredVideoRawIds(t){try{const e=t.attachments?.filter((t=>"video"===t.type)).map((t=>t.video));if(!e?.length)return null;const i=(await this.videoApi.get({videos:e.map(_).join(",")})).items.filter((t=>!(0,u.xY)(t.privacy_view)&&!t.restriction));return i.reduce(((t,e)=>(t[m(e)]=e,t)),{})}catch{return null}}async getFilteredPhotoRawIds(t){try{const e=t.attachments?.filter((t=>"photo"===t.type&&t.photo&&h.z.isFakeDocOwner(t.photo.owner_id))).map((t=>t.photo))??[],i=t.attachments?.filter((t=>"photo"===t.type&&t.photo&&!h.z.isFakeDocOwner(t.photo.owner_id))).map((t=>t.photo))??[];let s=[];if(i.length){s=(await this.photosApi.getById({photos:i.map(_).join(",")})).filter((t=>!(0,g.LB)(t)))}return[...e,...s].reduce(((t,e)=>(t[m(e)]=e,t)),{})}catch{return null}}[n.zr](){this.store?.destroy()}constructor(t,e,i,s){this.authService=t,this.videoApi=e,this.photosApi=i,this.userEnv=s,this.atom=null,this.store=null,this.draftStatus=!1,(0,o.l_)(this),this.authService.userId&&(this.store=(0,a.E)({dbName:"posting-draft",storeName:String(this.authService.userId),version:1}))}}v=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===r.u?Object:r.u,void 0===d.C?Object:d.C,void 0===c.U?Object:c.U,void 0===l.J?Object:l.J])],v)},390860:(t,e,i)=>{i.d(e,{I:()=>p});var s=i(331635),o=i(42107),n=i(327813),a=i(289375);class r{logClickEvent(t){this.productionStats.send({screen:t.nav_screen??"",type:"type_click",type_click:{type:"type_posting_item",type_posting_item:t}})}logSnippetClickEvent(t){this.productionStats.send({screen:t.nav_screen??"",type:"type_click",type_click:{type:"type_feed_posting_snippet_edit_item",type_feed_posting_snippet_edit_item:t}})}constructor(t){this.productionStats=t,(0,n.l_)(this)}}r=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.X?Object:a.X])],r);class d{logClickEvent(t,e,i=""){this.productionStats.send({screen:i,type:"type_click",type_click:{item:e,type:"type_feed_coowners_event",type_feed_coowners_event:t}})}constructor(t){this.productionStats=t,(0,n.l_)(this)}}d=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.X?Object:a.X])],d);var c=i(257581),l=i(234824);const h={baseNavScreen:c.cQ.Posting1};class p{changeConfig(t){this.config={...this.config,...t}}getBaseClickEventParams(t){const{ownerId:e,creationEntryPoint:i,postId:s,baseNavScreen:o,creationSessionId:n}=this.config;return{creation_entry_point:i,owner_id:e,post_id:s,nav_screen:t??o,creation_session_id:n,creation_session_id_int:n}}logClickAttachmentEvent(t){const{clickAttachmentEventType:e,vkTicket:i,attachmentsInfo:s,navScreen:o}=t;this.postingAnalytics.logClickEvent({...this.getBaseClickEventParams(o),click_attachment_event:{click_attachment_event_type:e,...s?{attachments_info:s}:{},...i?{vk_ticket:i}:{}}})}logClickNavigationEvent(t){const{navigationEventType:e,navScreen:i}=t;this.postingAnalytics.logClickEvent({...this.getBaseClickEventParams(i),navigation_event:{navigation_event_type:e}})}logClickArticleEvent(t){const{articleEventType:e,navScreen:i}=t;this.postingAnalytics.logClickEvent({...this.getBaseClickEventParams(i),article_event:{article_event_type:e}})}logDraftEvent(t){const{draftEventType:e,navScreen:i}=t;this.postingAnalytics.logClickEvent({...this.getBaseClickEventParams(i),draft_event:{draft_event_type:e}})}logRemoteDraftEvent(t){const{remoteDraftEventType:e,navScreen:i,creationEntryPoint:s}=t,o=this.getBaseClickEventParams(i);this.postingAnalytics.logClickEvent({...o,creation_entry_point:s??o.creation_entry_point,remote_draft_event:{remote_draft_event_type:e}})}logAddAttachmentEvent(t){const{attachmentsInfo:e,addAttachmentEventType:i,navScreen:s,vkTicket:o}=t;this.postingAnalytics.logClickEvent({...this.getBaseClickEventParams(s),add_attachment_event:{add_attachment_event_type:i,attachments_info:e,...o?{vk_ticket:o}:{}}})}logSettingsEvent(t){const{settingsEventType:e,navScreen:i,postponedTime:s,copyrightUrl:o,hasCommentsOn:n,hasNotificationOn:a}=t;this.postingAnalytics.logClickEvent({...this.getBaseClickEventParams(i),settings_event:{settings_event_type:e,postponed_time:s,copyright_url:o,has_comments_on:n,has_notification_on:a}})}logCoauthorsEvent(t){const{ownerId:e,postId:i,baseNavScreen:s}=this.config;e&&this.coauthorsAnalyticsLogger.logClickEvent({event_type:t},{id:i,owner_id:e},s)}logAddPhotoAttachmentsEvents(t){const e=t.map((t=>({attachment_owner_id:t.owner_id,attachment_item_id:t.id,attachment_type:c.wh.Photo})));this.logAddAttachmentEvent({addAttachmentEventType:c.ZX.AttachMyPhoto,attachmentsInfo:e})}logAddVideoAttachmentsEvents(t){const e=t.map((t=>({attachment_owner_id:t.owner_id,attachment_item_id:t.id,attachment_type:c.wh.Video})));this.logAddAttachmentEvent({addAttachmentEventType:c.ZX.AttachMyVideo,attachmentsInfo:e})}logAddMediaAttachmentsEvents(t){const e=[],i=[];t.forEach((t=>{const{id:s,owner_id:o}=t.data,{type:n}=t,a={attachment_type:"photo"===n?c.wh.Photo:c.wh.Video,attachment_item_id:s,attachment_owner_id:o};"photo"===n?e.push(a):"video"===n&&i.push(a)})),e.length&&this.logAddAttachmentEvent({addAttachmentEventType:c.ZX.AttachMyVideo,attachmentsInfo:e}),i.length&&this.logAddAttachmentEvent({addAttachmentEventType:c.ZX.AttachMyPhoto,attachmentsInfo:i})}logProductAttachmentsEvent(t,e){let i="";const s=(0,l.e)(e.link.url);s&&(i=(0,l.DH)(s)),this.logAddAttachmentEvent({addAttachmentEventType:t,attachmentsInfo:[{attachment_owner_id:e.owner_id,attachment_item_id:e.item_id,attachment_type:c.wh.Photo,attachments_string_value:i}]})}logProductSelectAttachmentsEvent(t){const e=[];t.forEach((t=>{e.push({attachment_owner_id:t.owner_id,attachment_item_id:t.item_id,attachment_type:c.wh.Photo,attachments_string_value:`market_${t.object.replace("product","")}`})})),e.length&&this.logAddAttachmentEvent({addAttachmentEventType:c.ZX.ProductSelect,attachmentsInfo:e})}logDeleteAttachment(t,e,i,s){const{addAttachmentEventType:o,attachmentType:n}=((t,e)=>{let i=null,s=null;return"photo"===t?(i=e?c.ZX.DeleteAttachPhoto:c.ZX.DeleteAttachMyPhoto,s=c.wh.Photo):"video"===t?(i=e?c.ZX.DeleteAttachVideo:c.ZX.DeleteAttachMyVideo,s=c.wh.Video):"geo"===t?(i=c.ZX.DeleteAttachPlace,s=c.wh.Geo):"poll"===t?(i=c.ZX.DeleteAttachPoll,s=c.wh.Poll):"audio"===t?(i=c.ZX.DeleteAttachMusic,s=c.wh.Audio):"audio_playlist"===t?(i=c.ZX.DeleteAttachAlbum,s=c.wh.AudioPlaylist):"market"===t?(i=c.ZX.ProductDelete,s=c.wh.Market):"doc"===t&&(i=c.ZX.DeleteAttachFile,s=c.wh.Doc),{addAttachmentEventType:i,attachmentType:s}})(i,s);o&&n&&this.logAddAttachmentEvent({addAttachmentEventType:o,attachmentsInfo:[{attachment_owner_id:t,attachment_item_id:e,attachment_type:n}]})}logOpenMusicSnippetModal(){this.postingAnalytics.logSnippetClickEvent({...this.getBaseClickEventParams(),event_type:"open_modal_audio_snippet"})}logStartMusicSnippetPlay(){this.postingAnalytics.logSnippetClickEvent({...this.getBaseClickEventParams(),event_type:"start_listen_audio_snippet"})}logMusicSnippetOn(){this.postingAnalytics.logSnippetClickEvent({...this.getBaseClickEventParams(),event_type:"audio_snippet_on"})}logMusicSnippetOff(){this.postingAnalytics.logSnippetClickEvent({...this.getBaseClickEventParams(),event_type:"audio_snippet_off"})}get navScreen(){return this.config.baseNavScreen}get creationEntryPoint(){return this.config.creationEntryPoint}get creationSessionId(){return this.config.creationSessionId}reset(){this.config=h}constructor(t,e){this.postingAnalytics=t,this.coauthorsAnalyticsLogger=e,this.config={...h,creationSessionId:Math.floor(2147483647*Math.random())},(0,n.l_)(this)}}p=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===r?Object:r,void 0===d?Object:d])],p)},879158:(t,e,i)=>{i.d(e,{E6:()=>c,Mc:()=>p,RU:()=>d,Zq:()=>l,sx:()=>h,xu:()=>u});var s=i(332855),o=i(257581),n=i(844257),a=i(69789),r=i(991237);const d=()=>1e3*Date.now(),c=()=>({time:d()}),l=t=>{const{postData:e,isAdmin:i,isGroup:o}=t;return"suggest"===e.post_type||o&&!i?s.Mc.SUGGESTED:"postpone"===e.post_type||e.date&&e.date>(0,n.Z)()?s.Mc.POSTPONED:e.donut?.is_donut?s.Mc.POST_DONUT:s.Mc.REGULAR},h=t=>{switch(t){case a.zN.SETTINGS:return o.cQ.Posting2;case a.zN.PHOTO_PICKER:return o.cQ.PostingAttachPhoto;case a.zN.VIDEO_PICKER:return o.cQ.PostingAttachVideo;case a.zN.ADDITIONAL_SETTINGS:return o.cQ.PostingSettings;default:return o.cQ.Posting1}},p=t=>t===r.H.AUDIO_PICKER?o.cQ.PostingAttachMusic:t===r.H.CREATE_POLL?o.cQ.PostingAttachPoll:o.cQ.Posting1,u=t=>{switch(t){case a.cL.PHOTO_PICKER:return o.cQ.PostingAttachPhoto;case a.cL.VIDEO_PICKER:return o.cQ.PostingAttachVideo;case a.cL.POLL:return o.cQ.PostingAttachPoll;case a.cL.PHOTO_VIEWER:return o.cQ.PostingPhotoViewer;case a.cL.AUDIO_PICKER:return o.cQ.PostingAttachMusic;case a.cL.SETTINGS:return o.cQ.Posting2;case a.cL.ADD_PRODUCT:return o.cQ.PostingAttachProduct;case a.cL.GEO_PICKER:return o.cQ.PostingAttachPlace;case a.cL.DRAFTS_LIST:return o.cQ.DraftsList;default:return o.cQ.Posting1}}},445426:(t,e,i)=>{i.d(e,{AJ:()=>s,tx:()=>o,zQ:()=>n});const s=t=>{const e=t[t.type];if(!e)return{type:t.type,itemId:void 0,ownerId:void 0};const i="id"in e?Number(e.id):void 0,s="owner_id"in e?Number(e.owner_id):void 0;return{type:t.type,itemId:i,ownerId:s}},o=(t,e,i)=>s=>{const o=s?.[t];return!!o&&(!e||!("id"in o)||(i&&"owner_id"in o?o.id===e&&o.owner_id===i:o.id===e))},n=(t,e)=>{const{itemId:i,ownerId:n}=s(e),a=t.findIndex(o(e.type,i,n));-1!==a?t[a]=e:t.push(e)}},946333:(t,e,i)=>{i.d(e,{OG:()=>l,R9:()=>f,S6:()=>c,WQ:()=>u,XI:()=>h,ZN:()=>p,iw:()=>_,rc:()=>y,u$:()=>v,yB:()=>m});var s=i(745632),o=i(648992),n=i(69789),a=i(228838),r=i(174520),d=i(443680);const c=t=>`${t.owner_id}_${t.id}`,l=t=>{if(!t)return;const e=(t=>"delete_outline"===t.icon_name?"deleted":t.blur||t.can_preview?"restricted":"blocked")(t);return{type:e,text:"blocked"===e?t.text:t.title,actionText:t.button?.title}},h=t=>{const e=t?.album_id,i=[r.H,r.d,n.zD,n.g,n.Sf,n.YD,a.Wc,n.gz];return e&&(e>0||i.includes(e))},p=t=>{if(t)return t.orig_photo?t.orig_photo:(0,s.z)(t.sizes)},u=t=>t?t.orig_photo?[t.orig_photo]:t.sizes:[],g=t=>{const e=p(t);if(e)return e.width/e.height},_=async t=>{if(t.orig_photo)return t;const e=(0,d.N)(t.sizes,Number.MAX_VALUE);if(!e)return t;const i=await(0,o.y)(e);return{...t,orig_photo:{height:i.height,type:"base",url:e,width:i.width}}},m=t=>{const e=g(t);if(e)return Math.min(Math.max(e,n.ku),n.gP)},v=t=>n.q_.find((e=>e.ratio&&Math.abs(e.ratio-t)<n.kj)),y=t=>{const e=n.q_.reduce(((e,{ratio:i})=>i&&Math.abs(i-t)<Math.abs(e-t)?i:e),0);return v(e)||n.t$},f=(t,e)=>{if(!e||!t)return!1;const i=g(e);if(!i)return!1;return Math.abs(Math.floor(100*i)-Math.floor(100*t))>1}},234824:(t,e,i)=>{i.d(e,{AN:()=>d,DH:()=>c,X2:()=>n,Yx:()=>o,e:()=>l,px:()=>r,uy:()=>a});var s=i(328911);const o=t=>{const e=t.match(/product(-?[0-9]+)_([0-9]+)/),i=t.match(/product\/(-?[0-9]+)-([0-9]+)/),s=e||i;return s?{ownerId:Number(s[1]),itemId:Number(s[2])}:null},n=(t,e)=>{const i=o(e.link.url);return i?{type:"photo",owner_id:t.owner_id,item_id:t.id,access_key:t.access_key,object:`product${(0,s.o)({ownerId:i.ownerId,itemId:i.itemId})}`,x:e.x,y:e.y}:null},a=t=>(0,s.o)({ownerId:t.item_id,itemId:t.id}),r=(t,e)=>({type:e.type,owner_id:t.owner_id,item_id:t.id,tag_id:e.id,access_key:t.access_key}),d=(t,e,i)=>({isNew:!0,id:Math.random(),type:"photo",owner_id:t.owner_id,item_id:t.id,product_id:0,link:{url:e.url,photo:{sizes:e.marketItem.thumb},title:e.marketItem.title,product:{price:e.marketItem.price}},x:i.x,y:i.y}),c=({ownerId:t,productId:e})=>`market_${t}_${e}`,l=t=>{const e=t.split("/").at(-1);if(!e)return null;const i=e.match(/^(-?\d+)-(\d+)$/),s=i?.[1],o=i?.[2];return s&&o?{ownerId:Number(s),productId:Number(o)}:null}},819048:(t,e,i)=>{i.d(e,{Vb:()=>c,_w:()=>l,mn:()=>d});var s=i(441878),o=i(144819),n=i(926321),a=i(9467),r=i(69789);const d=t=>Boolean(t?.date),c=t=>{const e=(t=>(t.width??1)/(t.height??1))(t);return Math.min(Math.max(e,r.ku),r.gP)},l=t=>{if((0,a.AW)("video_disable_common_covers")||(0,a.z2)("disable_common_covers_of_videos")||(0,a.z2)("disable_common_covers_of_videos_on_web")||(0,a.z2)("disable_common_covers_of_videos_rollout")){const e=(0,n.A)(t?.image);if(e)return[{...e,url:(0,n.U)(e.url,e.width,e.height)}];(0,s.v)(new Error(`Unexpectedly no base picture. Video url - ${(0,o.WO)({ownerId:t.owner_id??0,id:t.id??0})}`))}const e=t?.image?.filter((t=>!t.with_padding))??[];return e.length?e:t?.image??[]}},244428:(t,e,i)=>{i.d(e,{c:()=>S,i:()=>f});var s=i(331635),o=i(327813),n=i(42107),a=i(561412),r=i(570440),d=i(127574),c=i(802872),l=i(273193),h=i(651253),p=i(645189),u=i(725308),g=i(975472),_=i(830443),m=i(967747),v=i(360864);class y{async[n.Ts](){"initial"===this.status&&(await this.feedServiceDecorator.fetch({filter:this.filter,domain:this.wallName,count:this.postsCount},{prefetch:!this.props.current.disablePrefetch}),(0,o.h5)((()=>{this.items.length||(this._firstCommentsLoaded=!0)})))}get feedServiceDecorator(){return this.props.current.feedServiceDecorator}get ownerId(){return this.props.current.ownerId}get filter(){return this.props.current.filter}get wallName(){return this.ownerId.toString()}async[n.yo](){await this.feedServiceDecorator.fetch({filter:this.filter,domain:this.wallName,count:this.postsCount})}[n.zr](){this.feedServiceDecorator.reset(),this.props.current.feedServiceDecorator||this.feedServiceDecorator.destroy(),this.filterReactionDisposer(),this.commentsStore.resetInitialCommentsByPost(),this.reactions.destroy()}get items(){return this.feedServiceDecorator.items}get status(){return this.feedServiceDecorator.requestState.status}get error(){return this.feedServiceDecorator.requestState.error}get ownerName(){return this.ownerService.getOwnerNameById(this.ownerId,!0,void 0,!0)}get title(){return"error"===this.status?this.langs.getLang("global_error"):this.props.current.title?this.props.current.title:u.z.isGroupId(this.ownerId)?this.langs.langReplace(this.langs.getLang("wall_page_title_group"),{name:this.ownerName}):u.z.isUserId(this.ownerId)?this.langs.langReplace(this.langs.getLang("wall_page_title_profile"),{name:this.ownerName}):""}get offsetTop(){return this.props.current.offsetTop}get withoutSaveScroll(){return this.props.current.withoutSaveScroll}get newsfeedItem(){return this.props.current.NewsfeedItem}get scrollContainerRef(){return this.props.current.scrollContainerRef}get postsIdsWithLoadingComments(){return this._postsIdsWithLoadingComments}get isCommentsLoading(){return"loading"===this.commentsRequestState.status}get postsCount(){return this.userEnv.partConfigEnabled("frontend.web_wall_comments_loading_fix")?10:20}get hideComments(){return this.props.current.hideComments}get needShowSkeleton(){return"initial"===this.status||0===this.items.length&&"loading"===this.status||!this.feedServiceDecorator||!this._firstCommentsLoaded&&this.userEnv.partConfigEnabled("frontend.web_wall_comments_loading_fix")}get needShowSpinner(){return this.items.length>0&&"loading"===this.status||this.isCommentsLoading&&this.userEnv.partConfigEnabled("frontend.web_wall_comments_loading_fix")}constructor(t,e,i,s,n,r,d,c){this.ownerService=t,this.langs=e,this.props=i,this.feedDataService=s,this.commentsService=n,this.commentsStore=r,this.errorLogger=d,this.userEnv=c,this.reactions=new _.O,this._firstCommentsLoaded=!1,this._postsIdsWithLoadingComments=[],this.filterReactionDisposer=(0,o.mJ)((()=>this.filter),(async(t,e)=>{t!==e&&(await this.handleFilterChange(t),(0,o.h5)((()=>{this.items.length||(this._firstCommentsLoaded=!0)})))}),{fireImmediately:!1}),this.commentsRequestState=new a.X(this.commentsService.fetchCommentsForPosts.bind(this.commentsService),this.errorLogger),this.fetchCommentsForPosts=(t,e)=>{if(this.props.current.hideComments||!this.feedDataService.hasWallComments)return void(this._firstCommentsLoaded=!0);if("initial"===this.status||!t.length&&"loading"===this.status)return;if(!t.length)return void(this._firstCommentsLoaded=!0);const i=new Set(e.map((t=>t.id))),s=[],o=[];for(const e of t){const t=e.id;i.has(e.id)||(this.commentsStore.getInitialCommentsByPost(t)||(s.push(t),(0,v.L)(e)&&o.push(t)))}if(this.userEnv.partConfigEnabled("frontend.web_wall_comments_loading_fix")){if(0===o.length)return void(this._firstCommentsLoaded=!0);this._postsIdsWithLoadingComments=this._postsIdsWithLoadingComments.concat(s);const t=()=>{if(this.userEnv.partConfigEnabled("frontend.web_wall_comments_loading_fix")){const t=new Set(s);this._postsIdsWithLoadingComments=this._postsIdsWithLoadingComments.filter((e=>!t.has(e))),this._firstCommentsLoaded=!0}};this.commentsRequestState.fetch({owner_id:this.ownerId,posts_ids:o,thread_items_count:1,count:m.eE},{onSuccess:t,onError:t})}else{if(!s.length)return void(this._firstCommentsLoaded=!0);const t=()=>{this._firstCommentsLoaded=!0};this.commentsRequestState.fetch({owner_id:this.ownerId,posts_ids:s,thread_items_count:1,count:m.eE},{onSuccess:t,onError:t})}},this.handleFilterChange=t=>(this._firstCommentsLoaded=!1,this.feedServiceDecorator.reset(),this.commentsStore.resetInitialCommentsByPost(),this.feedServiceDecorator.fetch({filter:t,domain:this.wallName,count:5})),this.fetchNext=()=>{this.feedServiceDecorator.fetchNext({count:this.postsCount})},this.reactions.reaction((()=>this.items),this.fetchCommentsForPosts),this.reactions.reaction((()=>this.status),(t=>{"error"===t&&(this._firstCommentsLoaded=!0)})),(0,o.l_)(this)}}y=(0,s.Cg)([n.z8.transient(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===r.v?Object:r.v,void 0===l.Y?Object:l.Y,void 0===n.Ji?Object:n.Ji,void 0===g.k?Object:g.k,void 0===d.y?Object:d.y,void 0===c.g?Object:c.g,void 0===h.v?Object:h.v,void 0===p.J?Object:p.J])],y);const{Provider:f,useModel:S}=(0,n.Qd)(y,{initInEffect:!1})},432729:(t,e,i)=>{i.d(e,{v:()=>r});var s=i(221020),o=i(356035),n=i(634164),a=i(815287);const r=(0,o.P)((function({className:t,children:e}){const{onMouseEnter:i,onMouseLeave:o,ref:r}=(()=>{const t=(0,a.useRef)(null),e=(0,a.useRef)(null),i=(0,a.useCallback)((i=>{e.current&&clearTimeout(e.current),e.current=setTimeout((()=>{t.current&&window.Emoji.show(t.current,i)}),300)}),[]),s=(0,a.useCallback)((i=>{e.current&&clearTimeout(e.current),t.current&&window.Emoji.hide(t.current,i)}),[]);return{ref:t,onMouseEnter:i,onMouseLeave:s}})();return(0,s.Y)("div",{className:(0,n.$)(t,"_emoji_wrap"),children:e({className:"_emoji_btn",ref:r,onMouseEnter:i,onMouseLeave:o})})}))},190682:(t,e,i)=>{i.d(e,{D:()=>g});var s=i(221020),o=i(815287),n=i(516427),a=i(326977),r=i(314817),d=i(982444),c=i(180329),l=i(856623);const h=[],p=t=>{"Escape"===t.key&&(t.stopPropagation(),h.at(-1)?.())},u="MiniAppPopoutWrapper__wrapper--FyyZC",g=({onClick:t,children:e,scrollTarget:i,handleEscape:g=!0,onEscape:_=t,zIndex:m="1000",lockedScroll:v=!0})=>{const y=(0,o.useRef)(null);(0,n.K$F)(v),(({enabled:t=!0,onEscape:e})=>{const i=(0,o.useRef)(e);(0,o.useLayoutEffect)((()=>{i.current=e}),[e]),(0,o.useEffect)((()=>{if(l.Sw&&t&&i.current)return 0===h.length&&document.addEventListener("keydown",p,{passive:!0,capture:!0}),h.push((()=>i.current?.())),()=>{h.pop(),0===h.length&&document.removeEventListener("keydown",p,{capture:!0})}}),[])})({enabled:g,onEscape:_});const f=(0,o.useCallback)((e=>{y.current?.contains(e.target)||(e.stopPropagation(),t?.())}),[t]);return(0,o.useEffect)((()=>{y.current?.focus()}),[y.current]),(0,s.Y)(a.z,{id:"mini-app-popout-wrapper",zIndex:m,onClick:f,children:(0,s.Y)(r.g,{getRootRef:i,children:(0,s.FD)("div",{className:u,onClick:f,children:[(0,s.Y)(d.K,{size:"4xl"}),(0,s.Y)(c.s,{justify:"center",align:"center",noWrap:!0,children:(0,s.Y)("div",{ref:y,tabIndex:0,children:e})}),(0,s.Y)(d.K,{size:"4xl"})]})})})}},429363:(t,e,i)=>{i.d(e,{L:()=>K});var s=i(221020),o=i(356035),n=i(56188),a=i(42107),r=i(46644),d=i(516427),c=i(961486),l=i(311029),h=i(225505),p=i(323525),u=i(357543),g=i(946918),_=i(474604),m=i(651566),v=i(55604),y=i(244716),f=i(835754),S=i(815287),w=i(331635),b=i(327813),P=i(645189),A=i(273193),k=i(916533),C=i(849645),I=i(456603),E=i(780836),L=i(54952),T=i(16205),M=i(695554),O=i(877912);class D extends O.D{connect({launchId:t,lifecycle:e,...i}){const{sanitizedLifecycle:s,unwrap:o}=this.initializeLifecycle(e);this.launchId=t,this.addLaunchRecord({...i,id:t,lifecycle:s,close:this.launchService.closeLayer}),this.setupDestroyHook(t,s,o)}constructor(t,e){super(t),this.launchService=e}}D=(0,w.Cg)([a.z8.container(),(0,w.Sn)("design:type",Function),(0,w.Sn)("design:paramtypes",[void 0===T.E?Object:T.E,void 0===M.z?Object:M.z])],D);var x=i(41221);const R={Loader:S.Fragment,Content:S.Fragment};var Y=i(985917),F=i(109911);class B{get pageModel(){return this._pageModel}get launchId(){return this.props.current.launchId}get hash(){return this.props.current.hash||""}get query(){return this.props.current.query}get internalRef(){return this.props.current.internalRef}get hasActionMenu(){const t=this.pageModel.platformScreen===I.ZJ.INSTALL,e=this.pageModel.platformScreen===I.ZJ.UNAVAILABLE;return this.props.current.hasActionMenu&&!t&&!e}get hasCloseButton(){return this.props.current.hasCloseButton}get refreshCoordinates(){return this.props.current.refreshCoordinates}get onClose(){return this.props.current.onClose}get onResize(){return this.props.current.onResize}get isLayer(){return this.props.current.isLayer}get getScrollTarget(){return this.props.current.getScrollTarget}get navigationSection(){return this.props.current.navigationSection||R}get navigate(){return this.props.current.navigate}constructor(t,e,i,s,o,n,a,r,d,c){this.tooltips=t,this.props=e,this._pageModel=new Y.h(i,s,o,n,a,r,e,d),(0,b.l_)(this),r.setCloseAction(this.onClose),c.setNavigateAction(this.props.current.navigate)}}B=(0,w.Cg)([a.z8.transient(),(0,w.Sn)("design:type",Function),(0,w.Sn)("design:paramtypes",[void 0===E.S?Object:E.S,void 0===a.Ji?Object:a.Ji,void 0===P.J?Object:P.J,void 0===A.Y?Object:A.Y,void 0===k.u?Object:k.u,void 0===L.m?Object:L.m,void 0===C.e?Object:C.e,void 0===D?Object:D,void 0===F.Z?Object:F.Z,void 0===x.u?Object:x.u])],B);const{Provider:N,useModel:z}=(0,a.Qd)(B,{initInEffect:!1});var V=i(538781),U=i(459303),G=i(804288),j=i(181166);const W="MiniAppModalBase__container--WjSSP",H="MiniAppModalBase__control--oMoQG",$=(0,o.P)((function(){const[t,e]=(0,S.useState)(j.B),[i,o]=(0,S.useState)(j.k),{pageModel:a,launchId:w,hasActionMenu:b,hasCloseButton:P,query:A={},hash:k,onClose:C,onResize:I,tooltips:E,isLayer:L,getScrollTarget:T,internalRef:M,navigationSection:O,navigate:D}=z(),{platformId:x,appId:R,actorId:Y,actorGroupId:F,onPlatformScreenChange:B,allowResize:N,miniAppAds:$,onAppMessage:K,connector:q,handlerProvider:Q,appData:J,legalDocuments:X,isInstallPlatformScreenType:Z,isWithoutLayerControls:tt,isWithoutLayerCloseButton:et}=a,{getLang:it}=(0,g.B)(),st=P&&!et,ot=b&&!tt,nt=(0,S.useCallback)(((t,i)=>{e(t),o(i),I?.(t,i)}),[]),at=(0,S.useRef)(null);return(0,S.useEffect)((()=>{E.clear(),nt(t,i)}),[]),(0,s.FD)(r.n,{width:t,height:i,"aria-label":"",maxWidth:t,"data-testid":"mini_app_layer_modal",focusTrap:!0,children:[st&&J&&(0,s.Y)(d.wyA,{className:H,"data-testid":"layer_dismiss_button",onClick:C,children:it("global_close")}),P&&ot&&J&&(0,s.Y)(c.d,{className:H,ariaLabel:it("apps_app_actions"),"data-testid":"layer_action_menu_button",getRootRef:at,children:(0,s.Y)(f.r,{appData:J,content:(0,s.Y)(n.F,{}),onClose:C,hasDeveloperButton:!0,allowTooltips:!0,container:at,navigate:D})}),(0,s.Y)(l.c,{insetLevel:0,children:(0,s.Y)(_.S,{separator:"hide",padding:"none",mode:"plain",children:(0,s.Y)(p.G,{containerClassName:W,launchId:w,isLayer:L,connector:q,handlerProvider:Q,appId:R,actorId:Y,platformId:x,hash:k,query:(0,u.h_)(A),groupId:F,platformScreens:{unavailableScreen:y.A,installScreen:v.$,notFoundScreen:m.b},onPlatformScreenChange:B,modalRunners:{showModal:V.t,showOverlayModal:U.J},loadSecondaryParams:!0,loadHelpHints:!0,allowResize:N,platformAdsConfig:$.platformAdsConfig,onResized:nt,defaultHeight:j.k,onMessage:K,getScrollTarget:T,navigationSection:O,after:J&&Z&&(0,s.FD)(s.FK,{children:[(0,s.Y)(h.w,{wide:!0}),(0,s.Y)(G.t,{isGame:J.isAnyGame,legacyDocuments:X})]}),internalRef:M},R)})})]})})),K=(0,a.jn)(N,$)},181166:(t,e,i)=>{i.d(e,{B:()=>s,k:()=>o});const s=600,o=500},12584:(t,e,i)=>{i.d(e,{l:()=>Me});var s=i(221020),o=i(356035),n=i(423654),a=i(638945),r=i(772812),d=i(47417),c=i(311029),l=i(187233),h=i(721990),p=i(120125),u=i(292184),g=i(413621),_=i(37390),m=i(409698),v=i(946918),y=i(781326),f=i(616647),S=i(815287),w=i(111153),b=i(547214),P=i(666843),A=i(331635),k=i(327813),C=i(848549),I=i(414618),E=i(42107),L=i(144819);class T{get rawId(){const{id:t,owner_id:e}=this.data;return(0,L.WO)({id:t,ownerId:e})}constructor(t){this.data=t,(0,k.l_)(this)}}class M{getAudio(t){return this.data.audiosMap.get(t)}createAudioFromApi(t){const e=new T(t);return this.data.audiosMap.set(e.rawId,e),e}constructor(){this.data={audiosMap:new Map},(0,k.l_)(this)}}class O{get totalCount(){return this._totalCount}get count(){return this.ids.length}get items(){const t=[];for(const e of this.ids){const i=this.audioProvider.getAudio(e);i&&t.push(i)}return t}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(t,e){let i;t.q?i=await this.audioApi.search({...t,q:String(t.q),search_own:1},{signal:e.signal}):(i=await this.audioApi.get({...t,extended:1,fields:"can_see_audio"},{signal:e.signal}),this.isPlaylistAccessDenied=0===i.profiles?.find((({id:e})=>e===t.owner_id))?.can_see_audio);return{items:i.items?.map((t=>this.audioProvider.createAudioFromApi(t)))||[],count:i.count}}async fetch(t){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const e=await this.request(t,this.abortController);this.handleResponse(e,t)}async fetchNext(){if(!this.prevRequestParams||this.isLoading||this.isLoaded)return;this.isLoading=!0,this.abortController=new AbortController;const{count:t=0,offset:e=0}=this.prevRequestParams??{},i=e+t,s={...this.prevRequestParams,offset:i},o=await this.request(s,this.abortController);this.handleResponse(o,s)}handleResponse(t,e){const{count:i=0,offset:s=0}=e,o=t.items.map((t=>t.rawId));this._totalCount=t.count,this.isLoaded=t.count<=s+i,this.ids=s?[...this.ids,...o]:o,this.prevRequestParams=e,this.isLoading=!1,this.abortController=null}constructor(t,e){this.audioProvider=t,this.audioApi=e,this.ids=[],this.chunkSize=50,this.abortController=null,this.prevRequestParams=null,this._totalCount=0,this.initialLoad=!1,this.isLoading=!1,this.isLoaded=!1,this.isPlaylistAccessDenied=!1,(0,k.l_)(this)}}class D{createSearchList(){return new O(this.audioProvider,this.audioApi)}constructor(t,e){this.audioProvider=t,this.audioApi=e,(0,k.l_)(this)}}D=(0,A.Cg)([E.z8.container(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===M?Object:M,void 0===I.B?Object:I.B])],D);class x{get rawId(){const{id:t,owner_id:e}=this.data;return(0,L.WO)({id:t,ownerId:e})}constructor(t){this.data=t,(0,k.l_)(this)}}class R{getAudioPlaylist(t){return this.data.playlistsMap.get(t)}createAudioPlaylistFromApi(t){const e=new x(t);return this.data.playlistsMap.set(e.rawId,e),e}constructor(){this.data={playlistsMap:new Map},(0,k.l_)(this)}}class Y{get count(){return this.ids.length}get items(){const t=[];for(const e of this.ids){const i=this.audioPlaylistProvider.getAudioPlaylist(e);i&&t.push(i)}return t}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(t,e){let i;i=t.q?await this.audioApi.searchPlaylists({...t,q:String(t.q)},{signal:e.signal}):await this.audioApi.getPlaylists(t,{signal:e.signal});return{items:i.items?.map((t=>this.audioPlaylistProvider.createAudioPlaylistFromApi(t)))||[],count:i.count}}async fetch(t){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const e=await this.request(t,this.abortController);this.handleResponse(e,t)}async fetchNext(){if(!this.prevRequestParams||this.isLoading||this.isLoaded)return;this.isLoading=!0,this.abortController=new AbortController;const{count:t=0,offset:e=0}=this.prevRequestParams??{},i=e+t,s={...this.prevRequestParams,offset:i},o=await this.request(s,this.abortController);this.handleResponse(o,s)}handleResponse(t,e){const{count:i=0,offset:s=0}=e,o=t.items.map((t=>t.rawId));this.isLoaded=t.count<=s+i,this.ids=s?[...this.ids,...o]:o,this.prevRequestParams=e,this.isLoading=!1,this.abortController=null}constructor(t,e){this.audioPlaylistProvider=t,this.audioApi=e,this.ids=[],this.abortController=null,this.prevRequestParams=null,this.initialLoad=!1,this.isLoading=!1,this.isLoaded=!1,(0,k.l_)(this)}}class F{createSearchList(){return new Y(this.audioPlaylistProvider,this.audioApi)}constructor(t,e){this.audioPlaylistProvider=t,this.audioApi=e,(0,k.l_)(this)}}F=(0,A.Cg)([E.z8.container(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===R?Object:R,void 0===I.B?Object:I.B])],F);class B{get count(){return this.ids.length}get items(){const t=[];for(const e of this.ids){const i=this.audioPlaylistProvider.getAudioPlaylist(e);i&&t.push(i)}return t}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(t,e){let i;if(!t.q)return this.reset(),{items:[],count:0};i=await this.audioApi.searchAlbums({...t,q:String(t.q)},{signal:e.signal});return{items:i.items?.map((t=>this.audioPlaylistProvider.createAudioPlaylistFromApi(t)))||[],count:i.count}}async fetch(t){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const e=await this.request(t,this.abortController);this.handleResponse(e,t)}async fetchNext(){if(!this.prevRequestParams||this.isLoading||this.isLoaded)return;this.isLoading=!0,this.abortController=new AbortController;const{count:t=0,offset:e=0}=this.prevRequestParams??{},i=e+t,s={...this.prevRequestParams,offset:i},o=await this.request(s,this.abortController);this.handleResponse(o,s)}handleResponse(t,e){const{count:i=0,offset:s=0}=e,o=t.items.map((t=>t.rawId));this.isLoaded=t.count<=s+i,this.ids=s?[...this.ids,...o]:o,this.prevRequestParams=e,this.isLoading=!1,this.abortController=null}constructor(t,e){this.audioPlaylistProvider=t,this.audioApi=e,this.ids=[],this.abortController=null,this.prevRequestParams=null,this.initialLoad=!1,this.isLoading=!1,this.isLoaded=!1,(0,k.l_)(this)}}class N{createSearchList(){return new B(this.audioPlaylistProvider,this.audioApi)}constructor(t,e){this.audioPlaylistProvider=t,this.audioApi=e,(0,k.l_)(this)}}N=(0,A.Cg)([E.z8.container(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===R?Object:R,void 0===I.B?Object:I.B])],N);var z=i(228909),V=i(432320),U=i(585666),G=i(799609),j=i(320366),W=i(58102),H=i(990126),$=i(630769),K=i(627255),q=i(444155);class Q extends U.f{checkPending(t){return this.pendingEntities.has(this.toEntityIdentity(t))}createContextualFromAPI(t,e){const i=t.track_code;if(!i)throw new Error("trackCode is not defined in source");return this.create({identity:new z._((0,G.z)(t)),data:(0,$.ct)(t),state:{}},{...e,trackCode:i})}constructEntity(t,e){return new W.R({...t,context:e,repository:this.repository,trackProvider:this.trackProvider,service:this.service})}setState(){}getContextKey(t){return`${t.list?.identity.fullId??""}/${t.trackCode}`}async ensureForTrack(t){const e=this.get(this.toEntityIdentity(t.identity),t.context);return e||this.fetchForTrack(t)}async fetchForTrack(t){const e=(0,L.yP)(t.identity),{identity:i}=t;try{this.markPending(i);const s=await this.repository.audioGetAudioPreviewUrl({preview_type:"longtap",audio_id:e});return this.create({identity:this.toEntityIdentity(t.identity),data:{...t.data,type:j.h.MusicSnippet,url:s.url,clip:(0,$.yL)(s)},state:{}},t.context)}finally{this.unmarkPending(i)}}toEntityIdentity(t){return new z._(t)}markPending(t){this.pendingEntities.add(this.toEntityIdentity(t))}unmarkPending(t){this.pendingEntities.delete(this.toEntityIdentity(t))}constructor(t,e,i){super(),this.repository=t,this.trackProvider=e,this.service=i,this.pendingEntities=new q.S}}(0,A.Cg)([k.XI,(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",["undefined"==typeof IContextualMusicTrack?Object:IContextualMusicTrack]),(0,A.Sn)("design:returntype",Promise)],Q.prototype,"fetchForTrack",null),(0,A.Cg)([k.XI,(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",["undefined"==typeof IMusicAudioIdentityData?Object:IMusicAudioIdentityData]),(0,A.Sn)("design:returntype",void 0)],Q.prototype,"markPending",null),(0,A.Cg)([k.XI,(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",["undefined"==typeof IMusicAudioIdentityData?Object:IMusicAudioIdentityData]),(0,A.Sn)("design:returntype",void 0)],Q.prototype,"unmarkPending",null),Q=(0,A.Cg)([E.z8.global(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===V.J?Object:V.J,void 0===K.E?Object:K.E,void 0===H.v?Object:H.v])],Q);const J=(t,e)=>e?`${t}_${e}`:t;class X{getFetching(t,e){return this.data.popoutFetchingPromisesMapByAudioId.has(J(t,e))}getPopup(t,e){return this.data.popoutMapByAudioId.get(J(t,e))}async ensureFetchPopup(t,e){const i=this.getPopup(t,e);return i||this.fetchPopup(t,e)}async fetchPopup(t,e){const i=await this.getFetchPopupPromise(t,e);return(0,k.h5)((()=>{this.data.popoutMapByAudioId.set(J(t,e),i)})),i}getFetchPopupPromise(t,e){const i=this.data.popoutFetchingPromisesMapByAudioId.get(J(t,e));if(i)return i;const s=new Promise((async(i,s)=>{try{i(await this.audioApi.getRestrictionPopup({audio_id:t,restriction:e}))}catch{s()}finally{(0,k.h5)((()=>{this.data.popoutFetchingPromisesMapByAudioId.delete(J(t,e))}))}}));return this.data.popoutFetchingPromisesMapByAudioId.set(J(t,e),s),s}constructor(t){this.audioApi=t,this.data={popoutMapByAudioId:new Map,popoutFetchingPromisesMapByAudioId:new Map},(0,k.l_)(this)}}X=(0,A.Cg)([E.z8.container(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===I.B?Object:I.B])],X);var Z=i(642052),tt=i(486526),et=i(273193),it=i(645189),st=i(725308),ot=i(376572),nt=i(160010),at=i(257581);const rt="base",dt="playlists",ct="playlist",lt="albums",ht="album",pt="selected_audios",ut="myAudio",gt="currentOwner";var _t=i(368970);class mt{[E.Ts](){this.fetchAudios(),this.helpHints.ensureAll(),this.props.current.selectedAudios?.length&&(this.multipleAudioSelectEnabled?this.selectedAudios=this.props.current.selectedAudios:this.selectedAudios=[this.props.current.selectedAudios[0]]),this.multipleAudioSelectEnabled&&this.props.current.selectedPlaylist&&(this.selectedPlaylist=this.props.current.selectedPlaylist),this.props.current.productAnalyticsLogger?.logClickAttachmentEvent({clickAttachmentEventType:at.uT.OpenMusic}),this.isAudioSnippetEnabled&&(this._audioSnippetModeSelected=Boolean(this.defaultAudioSnippetSelected))}get hasInitialData(){return Boolean(this.props.current.selectedAudios?.length||this.props.current.selectedPlaylist)}get canSubmit(){return this.multipleAudioSelectEnabled&&this.hasInitialData||this.selectedAudios.length}get sourceId(){return this._currentSource===ut?this.props.current.currentUserId:this.ownerId}get selectedAudiosIds(){return new Set(this.selectedAudios.map((({id:t})=>t)))}get withSourceSelector(){const{isAdmin:t,sourceSelectorEnabled:e}=this.props.current;return e&&t}get screen(){const t=this.screenHistory.at(-1);return t||rt}get currentAudioLists(){return this.currentSource===ut?{audiosList:this._myAudiosList,audiosSearchList:this._myAudiosSearchList,audioPlaylistsList:this._myAudioPlaylistsList,audioPlaylistsSearchList:this._myAudioPlaylistsSearchList,audioPlaylistAudiosList:this._myAudioPlaylistAudiosList,audioAlbumsSearchList:this._audioAlbumsSearchList}:{audiosList:this._audiosList,audiosSearchList:this._audiosSearchList,audioPlaylistsList:this._audioPlaylistsList,audioPlaylistsSearchList:this._audioPlaylistsSearchList,audioPlaylistAudiosList:this._audioPlaylistAudiosList,audioAlbumsSearchList:this._audioAlbumsSearchList}}get currentSource(){return this._currentSource}get isAudioSnippetEnabled(){return Boolean(this.props.current.isAudioSnippetEnabled)}setCurrentSource(t){this._currentSource=t,this._myAudiosList.isLoading||this._myAudiosList.count||this._myAudiosList.fetch({count:_t.BG,owner_id:this.props.current.currentUserId}),this._currentSource=t,this.isAccessDenied=!1,this.resetQuery(),this.setAudiosScreen()}get audios(){return this.searchQuery?this.currentAudioLists.audiosSearchList.items:this.currentAudioLists.audiosList.items}get playlists(){return this.searchPlaylistQuery?this.currentAudioLists.audioPlaylistsSearchList.items:this.currentAudioLists.audioPlaylistsList.items}get albums(){return this.currentAudioLists.audioAlbumsSearchList.items}get playlistAudios(){return this.searchQuery?this.currentAudioLists.audiosSearchList.items:this.currentAudioLists.audioPlaylistAudiosList.items}get isPlaylistAccessDenied(){return this.currentAudioLists.audioPlaylistAudiosList.isPlaylistAccessDenied}resetQuery(){this.searchQuery="",this.currentAudioLists.audiosSearchList.reset()}resetPlaylistQuery(){this.searchPlaylistQuery="",this.currentAudioLists.audioPlaylistsSearchList.reset(),this.currentAudioLists.audioAlbumsSearchList.reset()}get isLoading(){return this.currentAudioLists.audiosSearchList.isLoading||this.currentAudioLists.audiosList.isLoading}get isLoadingPlaylists(){return this.currentAudioLists.audioPlaylistsList.isLoading||this.currentAudioLists.audioPlaylistsSearchList.isLoading}get isLoadingAlbums(){return this.currentAudioLists.audioAlbumsSearchList.isLoading}get isLoadedFullyAlbums(){return this.currentAudioLists.audioAlbumsSearchList.isLoaded}get isLoadingPlaylistAudios(){return this.currentAudioLists.audioPlaylistAudiosList.isLoading||this.currentAudioLists.audiosSearchList.isLoading}get isEmptyAudios(){return!this.isLoading&&!this.audios.length}get isEmptyPlaylistAudios(){return!this.isLoadingPlaylistAudios&&!this.playlistAudios.length}get isEmptyPlaylists(){return!this.isLoadingPlaylists&&!this.playlists.length}get isEmptyAlbums(){return!this.isLoadingAlbums&&!this.albums.length}get headerText(){return this.screen===dt?this.langs.getLang("wall_posting_audio_playlist_picker_header_text"):this.screen===ct||this.screen===ht?this.currentPlaylist?.title??"":this.screen===lt?this.langs.getLang("audio_search_block_albums_title"):this.screen===pt?this.langs.getLang("wall_posting_audio_selected_audios_header_text"):this.langs.getLang("wall_posting_audio_picker_header_text")}get footerText(){if(this.screen!==pt)return this.multipleAudiosSelected?this.langs.getLang("wall_posting_audio_picker_footer_audio_selected").replace("{count}",String(this.selectedAudios.length)):this.langs.getLang("wall_posting_audio_picker_footer_no_audio_selected")}get multipleAudioSelectEnabled(){return this.props.current.multipleAudioSelectEnabled}get multipleAudiosSelected(){return this.selectedAudios.length>1}get singleAudioSelected(){return 1===this.selectedAudios.length}get subtitleText(){if(this.screen===lt)return this.langs.getLang("wall_posting_audio_album_picker_subtitle").replace("{query}",this.searchPlaylistQuery)}get sourceIsGroup(){return st.z.isGroupId(this.sourceId)}get audioNotFoundText(){return this.searchQuery?this.langs.getLang("audio_search_no_found"):this.screen===ct||this.screen===ht?this.isAccessDenied?this.langs.getLang("wall_posting_access_denied"):this.langs.getLang("audio_picker_playlist_tracks_empty_placeholder"):this.sourceIsGroup?this.langs.getLang("audio_picker_group_music_not_found"):this.langs.getLang("audio_picker_user_music_not_found")}get playlistsNotFoundText(){return this.searchPlaylistQuery?this.langs.getLang("audio_search_playlists_no_found"):this.sourceIsGroup?this.langs.getLang("audio_picker_group_playlists_not_found"):this.langs.getLang("audio_picker_user_playlists_not_found")}get hasBackLabel(){return Boolean(this.screen!==rt||this.props.current.onGoBack)}get snippetOnboardingText(){const t=this.props.current.snippetOnboardingKey;if(t)return this.helpHints.get(t)?.description}get playableAudioTrack(){const t=this._audioSnippetModeSelected&&this._audioSnippetTrack&&!this._audioSnippetLoading;return this.singleAudioSelected&&t?this._audioSnippetTrack:this.selectedAudios[0]}get snippetLoading(){return this._audioSnippetLoading}get snippetModeSelected(){return this._audioSnippetModeSelected}get defaultAudioSnippetSelected(){return this.props.current.defaultAudioSnippetSelected}get productAnalyticsLogger(){return this.props.current.productAnalyticsLogger}constructor(t,e,i,s,o,n,a,r,d,c){this.props=t,this.audioListsProvider=e,this.audioPlaylistListsProvider=i,this.audioAlbumListsProvider=s,this.musicSnippetProvider=o,this.musicTrackProvider=n,this.langs=a,this.userEnv=r,this.audioRestrictionPopupProvider=d,this.helpHints=c,this.screenHistory=[],this.currentPlaylist=null,this.playing=!1,this.selectedAudios=[],this.selectedAudiosEdit=[],this.selectedPlaylist=null,this._currentSource=gt,this.isAccessDenied=!1,this._audioSnippetTrack=null,this._audioSnippetModeSelected=!1,this._audioSnippetLoading=!1,this.snippetDropdownShown=!1,this.searchQuery="",this.searchPlaylistQuery="",this.changeScreen=t=>{this.screenHistory.push(t)},this.handleSourceSelectorToggle=()=>{this.setCurrentSource(this.currentSource===ut?gt:ut)},this.onSelect=(t,e)=>{this.props.current.timelineLogger?.logStartAttaching?.(),this.props.current.onSelect((0,k.HO)(t),e)},this.onSelectWholePlaylist=(t,e=!1)=>{if(this.currentPlaylist)if(this.isPlaylistAccessDenied&&this.userEnv.partConfigEnabled("posting_audio_restriction_audio_private_setting"))this.handleShowPrivatePlaylistError();else if(this.currentPlaylist.restriction)this.showPlaylistRestriction(this.currentPlaylist);else{if(this.multipleAudioSelectEnabled&&this.selectedAudios.length&&!e&&this.props.current.setAlertProps)return this.screen===ht?void this.openAlbumWithAudioAlert(t):void this.openPlaylistWithAudioAlert(t);this.selectedAudios=[],this.props.current.onPlaylistSelect((0,k.HO)(this.currentPlaylist))}},this.attachCurrentSelectedAudios=()=>{if(this.screen===pt)return this.selectedAudios=this.selectedAudiosEdit,this.selectedAudiosEdit=[],void this.handleGoToPrevScreen();this.currentPlaylist=null,this.onSelect((0,k.HO)(this.selectedAudios),this._audioSnippetModeSelected)},this.onSetCurrentAudio=async(t,e,i=!1)=>{if(this.multipleAudioSelectEnabled){if(this.selectedPlaylist&&!i&&this.props.current.setAlertProps)return this.screen===ht?void this.openAudioWithAlbumAlert(t,e):void this.openAudioWithPlaylistAlert(t,e);if(this.selectedAudiosIds.has(e.id))this.selectedAudios=this.selectedAudios.filter((({id:t})=>t!==e.id));else{if(this.selectedAudios.length>=this.props.current.audiosLimit)return void this.handleLimitExceededError();if(e.content_restricted)return void this.showAudioRestriction(e);this.selectedAudios.push(e)}this.selectedPlaylist=null}else if(this.selectedAudiosIds.has(e.id))this.selectedAudios=[];else{if(e.content_restricted)return void this.showAudioRestriction(e);this.selectedAudios=[e]}this._audioSnippetModeSelected&&(this.singleAudioSelected?(await this.loadAudioSnippet(this.selectedAudios[0]),this.props.current.productAnalyticsLogger?.logMusicSnippetOn()):this._audioSnippetTrack=null),Boolean(this.snippetOnboardingText)&&this.singleAudioSelected&&(0,k.h5)((()=>{this.snippetDropdownShown=!0}))},this.onRemoveSelectedAudiosEdit=t=>{this.selectedAudiosEdit=this.selectedAudiosEdit.filter((({id:e})=>e!==t.id))},this.onSelectPlaylist=t=>{this.setPlaylistAudiosScreen(t)},this.onSelectAlbum=t=>{this.setAlbumAudiosScreen(t)},this.onClose=()=>{this.props.current.onClose()},this.handleLimitExceededError=()=>{this.props.current.onError(this.langs.numeric(this.props.current.audiosLimit,this.langs.getLang("wall_posting_audio_attachments_limit_exceeded_text",!0)))},this.handleShowPrivatePlaylistError=()=>{this.props.current.onError(this.langs.getLang("wall_posting_rule_restrict_audio_private_setting"))},this.fetchAudios=async()=>{try{0===this.currentAudioLists.audiosList.count&&await this.currentAudioLists.audiosList.fetch({count:_t.BG,owner_id:this.sourceId}),this.props.current.timelineLogger?.logPickerReady?.()}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError(),this.props.current.timelineLogger?.logError?.(),this.handleGoBack()}},this.fetchPlaylistAudios=async()=>{const t={count:_t.BG};if(this.currentPlaylist){this.currentPlaylist.original?(t.owner_id=this.currentPlaylist.original.owner_id,t.playlist_id=this.currentPlaylist.original.playlist_id,t.access_key=this.currentPlaylist.original.access_key):(t.owner_id=this.currentPlaylist.owner_id,t.playlist_id=this.currentPlaylist.id,t.access_key=this.currentPlaylist.access_key),this.currentAudioLists.audioPlaylistAudiosList.reset();try{await this.currentAudioLists.audioPlaylistAudiosList.fetch(t)}catch(t){if((0,nt.d)(t)&&15===Number(t.error?.error_code))return this.currentAudioLists.audioPlaylistAudiosList.isLoading=!1,void(this.isAccessDenied=!0);if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError(),this.handleGoToPrevScreen()}}},this.fetchPlaylists=async()=>{try{0===this.currentAudioLists.audioPlaylistsList.count&&await this.currentAudioLists.audioPlaylistsList.fetch({count:_t.BG,owner_id:this.sourceId})}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError(),this.handleGoToPrevScreen()}},this.fetchNext=async()=>{try{this.searchQuery?await this.currentAudioLists.audiosSearchList.fetchNext():await this.currentAudioLists.audiosList.fetchNext()}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError()}},this.fetchNextPlaylists=async()=>{try{this.searchPlaylistQuery?await this.currentAudioLists.audioPlaylistsSearchList.fetchNext():await this.currentAudioLists.audioPlaylistsList.fetchNext()}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError()}},this.fetchNextPlaylistAudios=async()=>{try{this.searchPlaylistQuery?await this.currentAudioLists.audioPlaylistsSearchList.fetchNext():await this.currentAudioLists.audioPlaylistAudiosList.fetchNext()}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError()}},this.fetchNextAlbums=async()=>{try{await this.currentAudioLists.audioAlbumsSearchList.fetchNext()}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError()}},this._searchAudio=async()=>{if(this.searchQuery)try{await this.currentAudioLists.audiosSearchList.fetch({q:this.searchQuery,count:_t.BG,owner_id:this.sourceId})}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError()}else this.resetQuery()},this._searchAudioPlaylist=async()=>{if(this.searchAudioPlaylist)try{await Promise.allSettled([this.currentAudioLists.audioPlaylistsSearchList.fetch({q:this.searchPlaylistQuery,count:_t.BG,owner_id:this.sourceId}),this.currentAudioLists.audioAlbumsSearchList.fetch({q:this.searchPlaylistQuery,count:_t.Ig})])}catch(t){if(!(0,ot.T)(t)||(0,C.z)(t))return;this.handleShowError()}else this.resetPlaylistQuery()},this.searchAudioDebounced=(0,tt.s)(this._searchAudio,500),this.searchAudio=t=>{this.searchQuery=t,this.currentAudioLists.audiosSearchList.isLoading=!0,this.searchAudioDebounced()},this.searchAudioPlaylistDebounced=(0,tt.s)(this._searchAudioPlaylist,500),this.searchAudioPlaylist=t=>{this.searchPlaylistQuery=t,this.currentAudioLists.audioPlaylistsSearchList.isLoading=!0,this.currentAudioLists.audioAlbumsSearchList.isLoading=!0,this.searchAudioPlaylistDebounced()},this.handleGoBack=()=>{this.props.current.onGoBack?this.props.current.onGoBack():this.onClose()},this.handleShowError=()=>{this.props.current.onError(this.langs.getLang("wall_posting_network_general_error_text"),this.langs.getLang("wall_posting_network_general_error_subtitle"))},this.handleGoToPrevScreen=()=>{this.screenHistory.pop()},this.setAlbumsScreen=()=>{this.resetQuery(),this.currentPlaylist=null,this.changeScreen(lt)},this.setPlaylistsScreen=()=>{this.fetchPlaylists(),this.resetQuery(),this.currentPlaylist=null,this.changeScreen(dt)},this.setAudiosScreen=()=>{this.resetPlaylistQuery(),this.changeScreen(rt)},this.setSelectedAudiosScreen=()=>{this.selectedAudiosEdit=this.selectedAudios,this.changeScreen(pt)},this.setPlaylistAudiosScreen=t=>{this.currentPlaylist=t,this.changeScreen(ct),this.fetchPlaylistAudios()},this.setAlbumAudiosScreen=t=>{this.currentPlaylist=t,this.changeScreen(ht),this.fetchPlaylistAudios()},this.handlePlayAudio=t=>{this.props.current.productAnalyticsLogger?.logClickAttachmentEvent({clickAttachmentEventType:at.uT.MusicPreview}),t.content_restricted?this.showAudioRestriction(t):this.playing=!0},this.handlePlayPlaylist=t=>{this.props.current.productAnalyticsLogger?.logClickAttachmentEvent({clickAttachmentEventType:at.uT.MusicPreview}),t.restriction?this.showPlaylistRestriction(t):this.playing=!0},this.showPlaylistRestriction=async t=>{t.restriction&&this.props.current.onError(t.restriction.title,t.restriction.text)},this.showAudioRestriction=async t=>{if(t.content_restricted){const e=await this.audioRestrictionPopupProvider.ensureFetchPopup((0,L.WO)({id:t.id,ownerId:t.owner_id}),t.content_restricted);this.props.current.onError(e.title,e.text)}},this.handlePauseAudio=()=>{this.playing=!1},this.openAudioWithPlaylistAlert=(t,e)=>{this.props.current.setAlertProps?.(t,this.langs.getLang("wall_posting_audio_picker_attach_audio_instead_playlist_title"),this.langs.getLang("wall_posting_audio_picker_attach_audio_instead_playlist_text"),(()=>this.onSetCurrentAudio(t,e,!0)))},this.openAudioWithAlbumAlert=(t,e)=>{this.props.current.setAlertProps?.(t,this.langs.getLang("wall_posting_audio_picker_attach_audio_instead_album_title"),this.langs.getLang("wall_posting_audio_picker_attach_audio_instead_album_text"),(()=>this.onSetCurrentAudio(t,e,!0)))},this.openPlaylistWithAudioAlert=t=>{this.props.current.setAlertProps?.(t,this.langs.getLang("wall_posting_audio_picker_attach_playlist_instead_audio_title"),this.langs.getLang("wall_posting_audio_picker_attach_playlist_instead_audio_text"),(()=>this.onSelectWholePlaylist(t,!0)))},this.openAlbumWithAudioAlert=t=>{this.props.current.setAlertProps?.(t,this.langs.getLang("wall_posting_audio_picker_attach_album_instead_audio_title"),this.langs.getLang("wall_posting_audio_picker_attach_album_instead_audio_text"),(()=>this.onSelectWholePlaylist(t,!0)))},this.sortSelectedAudiosEdit=(t,e)=>{const i=this.selectedAudiosEdit.length,s=t>=0?t:i+t,o=e>=0?e:i+e;s!==o&&this.selectedAudiosEdit[s]&&this.selectedAudiosEdit[o]&&s>=0&&o>=0&&this.selectedAudiosEdit.splice(o,0,...this.selectedAudiosEdit.splice(s,1))},this.handleOpenMusicScreen=()=>{this.multipleAudiosSelected&&this.setSelectedAudiosScreen()},this.onSnippetModeChange=async()=>{this._audioSnippetModeSelected=!this._audioSnippetModeSelected,this._audioSnippetModeSelected?(await this.loadAudioSnippet(this.selectedAudios[0]),this.props.current.productAnalyticsLogger?.logMusicSnippetOn()):(this._audioSnippetTrack=null,this.props.current.onSnippetModeChange?.(this._audioSnippetModeSelected),this.props.current.productAnalyticsLogger?.logMusicSnippetOff())},this.loadAudioSnippet=async t=>{this._audioSnippetLoading=!0;const e=this.musicTrackProvider.createContextualFromAPI(t,{}),i=await this.musicSnippetProvider.fetchForTrack(e);i&&t.url===this.selectedAudios[0]?.url?(0,k.h5)((()=>{null!==i.url&&(this._audioSnippetTrack={...this.selectedAudios[0],url:i.url}),this._audioSnippetLoading=!1})):(0,k.h5)((()=>{this._audioSnippetLoading=!1}))},this.hideSnippetOnboarding=()=>{const t=this.props.current.snippetOnboardingKey;t&&this.helpHints.hide(t)},this.onSnippetDropdownShownChange=t=>{t!==this.snippetDropdownShown&&(this.snippetDropdownShown=t,this.snippetDropdownShown&&this.props.current.productAnalyticsLogger?.logOpenMusicSnippetModal(),this.snippetOnboardingText&&t&&this.hideSnippetOnboarding())},(0,k.l_)(this),this.ownerId=t.current.ownerId,this._audiosList=this.audioListsProvider.createSearchList(),this._audiosSearchList=this.audioListsProvider.createSearchList(),this._audioPlaylistsList=this.audioPlaylistListsProvider.createSearchList(),this._audioPlaylistsSearchList=this.audioPlaylistListsProvider.createSearchList(),this._audioPlaylistAudiosList=this.audioListsProvider.createSearchList(),this._myAudiosList=this.audioListsProvider.createSearchList(),this._myAudiosSearchList=this.audioListsProvider.createSearchList(),this._myAudioPlaylistsList=this.audioPlaylistListsProvider.createSearchList(),this._myAudioPlaylistsSearchList=this.audioPlaylistListsProvider.createSearchList(),this._myAudioPlaylistAudiosList=this.audioListsProvider.createSearchList(),this._audioAlbumsSearchList=this.audioAlbumListsProvider.createSearchList()}}mt=(0,A.Cg)([E.z8.transient(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===E.Ji?Object:E.Ji,void 0===D?Object:D,void 0===F?Object:F,void 0===N?Object:N,void 0===Q?Object:Q,void 0===K.E?Object:K.E,void 0===et.Y?Object:et.Y,void 0===it.J?Object:it.J,void 0===X?Object:X,void 0===Z.a?Object:Z.a])],mt);const{Provider:vt,useModel:yt}=(0,E.Qd)(mt,{initInEffect:!1});var ft=i(837002),St=i(999051),wt=i(405697),bt=i(398001),Pt=i(724075),At=i(888817),kt=i(925810),Ct=i(136141),It=i(630218),Et=i(180329),Lt=i(908759),Tt=i(928959);const Mt=({audio:t,hideProgress:e,after:i,onClick:o,onButtonClick:n})=>{const a=(0,Ct.R)(),r=a.currentAudio?.id===t.id,d=r&&a.status===kt.w.PLAYING,c=r?a.currentAudioProgress:1,h=Boolean(t?.content_restricted);return(0,s.Y)(l.i,{spacing:0,paddingTop:4,paddingBottom:4,mode:"vertical","data-testid":"posting_audio_audio_track_row",children:(0,s.Y)(It.S,{disableOpacity:h,thumb:t?.album?.thumb?.photo_135,title:t.title,artists:[{name:t.artist}],duration:t.duration,progress:c,hasThumbPlaying:d,hasThumbActivated:r,explicit:t.is_explicit,onClick:e=>n?.(e,t),onThumbClick:h?void 0:e=>{(0,Tt.T)(e),o(t)},after:(0,s.FD)(Et.s,{align:"center",noWrap:!0,gap:12,children:[!e&&(0,s.Y)(Lt.R,{duration:t.duration,progress:d?c:1,mode:"normal",size:"s"}),i]})})})};var Ot=i(953177);const Dt=({audios:t,isLoading:e,onSelectAudio:i,onLoadMore:o,isEmpty:n,scrollRef:a,selectedAudiosIds:r,onPlay:d,onPause:c,audioPlayer:h,notFoundText:p,multipleAudioSelectEnabled:u,isAccessDenied:g})=>{(0,Pt.M)(!0,(0,At.n)(o,Ot.HP),a);const _=(0,S.useCallback)((t=>{h?.isPlaying()&&h?.getCurrentAudio()?.id===t.id?(h?.stop(),c()):(h?.playAudio(t,[t]),d(t))}),[h]);return(0,s.FD)(l.i,{spacing:12,paddingTop:0,mode:"vertical",children:[t.map((t=>{const e=r.has(t.data?.id);return(0,s.Y)(Mt,{audio:t.data,onClick:_,onButtonClick:i,hideProgress:e&&!u,after:(u||e)&&(0,s.Y)(ft.f.Checkbox,{type:"circle",checked:e,readOnly:!0,size:24,"data-testid":"posting_audio_audio_track_selected_icon"})},t.rawId)})),e&&(0,s.Y)(St.y,{size:"regular"}),Boolean(n&&!e||g)&&(0,s.Y)(wt.O,{icon:!g&&(0,s.Y)(bt.S,{}),children:p})]})};var xt=i(685789),Rt=i(685441),Yt=i(475118),Ft=i(455172),Bt=i(880414),Nt=i(165051),zt=i(504959),Vt=i(7258);const Ut=(0,o.P)((function({album:t,onSelectAlbum:e,onPlayClick:i,isMobile:o}){const n=(0,Ct.R)(),r=n.currentPlaylist?.id===t.data.id,d=r&&n.status===kt.w.PLAYING,c=[t.data.photo,...t.data.thumbs??[]].map((t=>t?.photo_270||"")).filter(Boolean),l=t.data.main_artists?.map((t=>t.name)).join(", ");return(0,s.Y)(Ft.R,{size:o?"s":"l",thumbs:c,noOverlay:o,onClick:i=>{(0,zt.t)(i)&&e(t.data)},countLabel:t.data.count,playsLabel:(0,Vt.B)(t.data.plays),hasThumbActivated:r,hasThumbPlaying:d,onPlayPauseClick:()=>i(t.data),title:(0,s.Y)(Bt.b,{TypographyComponent:a.EY,lines:1,children:t.data.title}),subtitle:(0,s.FD)(Nt.r,{separator:" ",children:[(0,s.Y)(Bt.b,{TypographyComponent:a.LE,weight:"3",lines:1,children:l}),!!t.data.year&&(0,s.Y)(a.LE,{weight:"3",children:t.data.year})]})},t.rawId)})),Gt=({audioPlayer:t,onPlay:e,onPause:i})=>(0,S.useCallback)((s=>{t?.isPlaying()&&t?.getCurrentPlaylist()?.id===s.id?(t?.stop(),i()):(t?.playPlaylist(s),e(s))}),[t,e]),jt=(0,o.P)((function({albums:t,isLoading:e,onSelectAlbum:i,onLoadMore:o,onPlay:a,onPause:r,isEmpty:d,audioPlayer:c,isMobile:h}){const p=(0,v.B)(),u=Gt({audioPlayer:c,onPlay:a,onPause:r});return d||e?null:(0,s.FD)(s.FK,{children:[(0,s.Y)(l.i,{mode:"vertical",spacing:6,paddingTop:0,paddingBottom:0,children:(0,s.Y)(xt.Q,{aside:(0,s.Y)(n.N,{onClick:o,"data-testid":"posting_audio_picker_top_albums_show_all",children:p.getLang("audio_feed_show_all_block")}),children:(0,s.Y)(Rt.Y,{mode:"tertiary",children:p.getLang("audio_search_block_albums_title")})})}),(0,s.Y)(Yt.x,{columns:"dynamic",rowSpacing:0,columnSpacing:0,children:(0,s.Y)(Yt.x.HorizontalScroll,{padding:h?16:8,children:t.map((t=>(0,s.Y)(Yt.x.Item,{children:(0,s.Y)(Ut,{album:t,onPlayClick:u,onSelectAlbum:i,isMobile:h})},t.rawId)))})}),(0,s.Y)(l.i,{mode:"vertical",spacing:6,paddingTop:0,paddingBottom:0,children:(0,s.Y)(xt.Q,{children:(0,s.Y)(Rt.Y,{mode:"tertiary",children:p.getLang("audio_search_block_global_playlists_title_redesign")})})})]})}));var Wt=i(505174),Ht=i(292350),$t=i(709351);const Kt=({playlist:t,onAddPlaylist:e})=>{const i=(0,v.B)();return(0,s.Y)("div",{"data-testid":"posting_audio_playlist_item_row",children:(0,s.Y)(u.T,{onClick:()=>e(t),after:(0,s.Y)(Ht.U,{className:(0,r.I)("color_icon_secondary")}),"data-testid":"posting_audio_playlist_image",before:t.photo?(0,s.Y)(g._,{"data-testid":"posting_audio_playlist_thumb",size:40,src:t.photo?.photo_135,borderRadius:"l",alt:t.title}):(0,s.Y)(Wt.e,{"data-testid":"posting_audio_playlist_thumb",withTransparentBackground:!0,noBorder:!0,size:40,children:(0,s.Y)($t.V,{className:(0,r.I)("color_icon_secondary")})}),subtitle:i.numeric(t.count,i.getLang("wall_posting_audio_playlist_audio_count",!0)),extraSubtitle:t.year,children:(0,s.Y)("span",{"data-testid":"posting_audio_playlist_title",children:t.title})},t.id)})},qt=({playlists:t,isLoading:e,onSelectPlaylist:i,onLoadMore:o,isEmpty:n,scrollRef:a,notFoundText:r})=>((0,Pt.M)(!0,(0,At.n)(o,Ot.HP),a),(0,s.FD)(l.i,{mode:"vertical",spacing:6,paddingTop:0,children:[t.map((t=>(0,s.Y)(Kt,{playlist:t.data,onAddPlaylist:i},`${t.data.id}_${t.data.owner_id}`))),e&&(0,s.Y)(St.y,{size:"regular"}),n&&!e&&(0,s.Y)(wt.O,{stretched:!0,icon:(0,s.Y)(bt.S,{}),children:r})]})),Qt=({audioPlayer:t,albums:e,isLoading:i,isLoaded:o,onSelectAlbum:n,onLoadMore:a,onPlay:r,onPause:d,isEmpty:c,scrollRef:h})=>{const p=(0,v.B)(),u=Gt({audioPlayer:t,onPlay:r,onPause:d});return(0,Pt.M)(!o&&!i,(0,At.n)(a,Ot.HP),h),(0,s.FD)(l.i,{mode:"vertical",spacing:8,paddingTop:4,children:[(0,s.Y)(Yt.x,{columns:4,columnSpacing:4,rowSpacing:4,children:e.map((t=>(0,s.Y)(Yt.x.Item,{children:(0,s.Y)(Ut,{album:t,onPlayClick:u,onSelectAlbum:n})},t.rawId)))}),i&&(0,s.Y)(St.y,{size:"regular"}),c&&!i&&(0,s.Y)(wt.O,{stretched:!0,icon:(0,s.Y)(bt.S,{}),children:p.getLang("audio_search_playlists_no_found")})]})};var Jt=i(560265),Xt=i(996729),Zt=i(516427),te=i(799649),ee=i(947008);const ie=({selectedAudios:t,onRemoveAudio:e,isEmpty:i,onPlay:o,audioPlayer:n,sortSelectedAudios:a})=>{const d=(0,v.B)(),c=(0,S.useCallback)((t=>{n?.isPlaying()&&n?.getCurrentAudio()?.id===t.id?n?.stop():(n?.playAudio(t,[t]),o(t))}),[n]),h=(0,S.useMemo)((()=>t.map((({id:t,title:e})=>({id:String(t),label:e})))),[t]);return(0,s.FD)(l.i,{spacing:12,paddingTop:0,mode:"vertical",children:[(0,s.Y)(Xt.L,{items:h,onSortChange:(t,e,i)=>{(0,ee.Et)(e)&&(0,ee.Et)(i)&&a(e,i)},children:(0,s.Y)(Zt.B8B,{children:t.map((t=>(0,s.Y)(Xt.L.Item,{id:String(t.id),label:t.title,children:(0,s.Y)("div",{children:(0,s.Y)(Mt,{audio:t,onClick:c,after:(0,s.Y)(te.K,{"data-testid":"posting_audio_selected_audio_track_remove",className:(0,r.I)("color_icon_secondary"),label:d.getLang("global_clear"),onClick:()=>e(t),children:(0,s.Y)(Jt.S,{})})})})},t.id)))})}),i&&(0,s.Y)(wt.O,{stretched:!0,icon:(0,s.Y)(bt.S,{}),children:d.getLang("wall_posting_audio_picker_selected_audios_empty_placeholder")})]})};var se=i(225505),oe=i(563063),ne=i(434518),ae=i(763812),re=i(454718),de=i(313178),ce=i(161308),le=i(45734),he=i(112249);class pe{destroy(){this.isPlaying&&this.channel.stop()}get isPlaying(){return this.isCurrentList&&this.channel.playing}get isPaused(){return this.isCurrentList&&this.channel.paused}get progress(){return this.channel.progress}get isCurrentList(){const{currentListIdentity:t}=this.channel;return!!t&&(0,le.C)(t,this.list.identity)}get currentAudio(){return this.channel.currentAudio}async playAudio(t,e){const i=he.YR.PlayButton;this.isPaused&&this.isCurrentAudio(t)?this.channel.resume(i):await this.channel.playAudio(t,this.list,i),this.channel.currentAudio&&e&&this.analytics?.logPlaySnippet()}pause(){this.isPlaying&&this.channel.pause(he.Ub.PauseButton)}constructor(t){this.playingChannel=null,this.isCurrentAudio=t=>this.currentAudio?.identity.fullId===t.identity.fullId&&this.currentAudio?.url===t.url,this.list=t.list,this.channel=t.channel,this.analytics=t.analytics,this.playingChannel=t.playingChannel,(0,k.Gn)(this)}}class ue{create({list:t,analytics:e}){return new pe({channel:this.audioPlayer.posting,list:t,playingChannel:this.audioPlayer.playing,analytics:e})}constructor(t){this.audioPlayer=t}}ue=(0,A.Cg)([E.z8.container(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===ce.Y?Object:ce.Y])],ue);class ge{logPlaySnippet(){const{productAnalyticsLogger:t}=this;t&&t.logStartMusicSnippetPlay()}get productAnalyticsLogger(){return this.props.productAnalyticsLogger??null}get props(){return this.getProps()}constructor(t){this.getProps=t,(0,k.Gn)(this)}}(0,A.Cg)([k.EW,(0,A.Sn)("design:type",Object),(0,A.Sn)("design:paramtypes",[])],ge.prototype,"productAnalyticsLogger",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type","undefined"==typeof IAudioPreviewPlayerAnalyticsProps?Object:IAudioPreviewPlayerAnalyticsProps),(0,A.Sn)("design:paramtypes",[])],ge.prototype,"props",null);var _e=(0,ae._)("_analytics");let me=E.zr;class ve{get snippetDropdownShown(){return this.props.current.snippetDropdownShown}[me](){this.player.destroy()}get isDisabled(){return!!this.audioTrack?.isBlocked}get audioTrack(){return this.audioList.head.at(0)}get player(){return this.playerFactory.create({list:this.audioList,analytics:(0,ne._)(this,_e)[_e]})}get audioList(){const{cachedAudioSource:t,cachedAudioList:e}=this,{audio:i}=this.props.current;return e&&t&&(0,re.b)(t,i)?e:(this.cachedAudioList=this.audioListProvider.createFromAPI([i]),this.cachedAudioSource=i,this.cachedAudioList)}makeAnalyticsPropsGetter(){return()=>({productAnalyticsLogger:this.props.current.productAnalyticsLogger})}get onClearClick(){return this.props.current.onClearClick}get snippetModeSelected(){return this.props.current.snippetModeSelected}get audio(){return this.props.current.audio}get snippetLoading(){return this.props.current.snippetLoading}get snippetOnboardingText(){return this.props.current.snippetOnboardingText}constructor(t,e,i){Object.defineProperty(this,_e,{writable:!0,value:void 0}),this.props=t,this.audioListProvider=e,this.playerFactory=i,this.cachedAudioSource=null,this.cachedAudioList=null,this._isActive=!1,this.onPlaybackControlClick=t=>{this.player.isPlaying?this.player.pause():this.player.playAudio(t,this.snippetModeSelected)},this.changeSnippetDropdownShown=t=>{this.props.current.onSnippetDropdownShownChange(t)},this.onSnippetModeChange=()=>{this.player.destroy(),this.props.current.onSnippetModeChange()},this.onSnippetOnboardingShown=()=>this.props.current.onSnippetOnboardingShown(),(0,ne._)(this,_e)[_e]=new ge(this.makeAnalyticsPropsGetter()),(0,k.Gn)(this)}}(0,A.Cg)([k.sH],ve.prototype,"_isActive",void 0),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"snippetDropdownShown",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"isDisabled",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"audioTrack",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"player",null),(0,A.Cg)([k.XI.bound],ve.prototype,"onPlaybackControlClick",void 0),(0,A.Cg)([k.EW,(0,A.Sn)("design:type","undefined"==typeof IAttachmentAudioList?Object:IAttachmentAudioList),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"audioList",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"onClearClick",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"snippetModeSelected",null),(0,A.Cg)([k.XI.bound],ve.prototype,"changeSnippetDropdownShown",void 0),(0,A.Cg)([k.XI.bound],ve.prototype,"onSnippetModeChange",void 0),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"audio",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"snippetLoading",null),(0,A.Cg)([k.EW,(0,A.Sn)("design:type",void 0),(0,A.Sn)("design:paramtypes",[])],ve.prototype,"snippetOnboardingText",null),(0,A.Cg)([k.XI.bound],ve.prototype,"onSnippetOnboardingShown",void 0),ve=(0,A.Cg)([E.z8.transient(),(0,A.Sn)("design:type",Function),(0,A.Sn)("design:paramtypes",[void 0===E.Ji?Object:E.Ji,void 0===de.z?Object:de.z,void 0===ue?Object:ue])],ve);const{Provider:ye,useModel:fe}=(0,E.Qd)(ve,{initInEffect:!1});var Se=i(393741),we=i(865940),be=i(800687),Pe=i(78021);const Ae=({thumb:t,title:e,subtitle:i,explicit:o,audio:n,after:a,onClick:r,isPlaying:d,isActive:c,duration:h,hasRestriction:p})=>{const u=(0,v.B)();return(0,s.Y)(l.i,{spacing:0,paddingTop:4,paddingBottom:4,mode:"vertical","data-testid":"posting_audio_audio_track_row",children:(0,s.Y)(It.S,{thumbLabel:d?u.getLang("global_audio_pause"):u.getLang("global_audio_play"),disableOpacity:p,thumb:t,title:e,artists:[{name:i}],hasThumbPlaying:d,hasThumbActivated:c,explicit:o,duration:h,onThumbClick:p?void 0:t=>{(0,Tt.T)(t),r(n)},after:(0,s.Y)(Et.s,{align:"center",noWrap:!0,gap:12,children:a})})})},ke=(0,o.P)((function(){const{onPlaybackControlClick:t,player:e,audioTrack:i,snippetDropdownShown:o,changeSnippetDropdownShown:n,snippetModeSelected:d,onClearClick:c,onSnippetModeChange:h,snippetLoading:p,audio:u,isDisabled:g,snippetOnboardingText:_,onSnippetOnboardingShown:m}=fe(),y=(0,v.B)(),f=(0,s.Y)(te.K,{size:24,label:y.getLang("global_snippet_audio"),onClick:t=>{t.stopPropagation(),n(!0)},hasHover:!1,hasActive:!1,"data-testid":"audio-snippet-options-button",children:(0,s.Y)(Pe.S,{className:(0,r.I)("color_icon_secondary")})}),S=(0,s.FD)(s.FK,{children:[p&&(0,s.Y)(St.y,{}),!p&&_&&!o&&(0,s.Y)(Se.V,{shown:!o,mode:"1",appearance:"lime",tilt:"right",tipPosition:"top-left",size:56,content:_,onMarkerClick:()=>{m(),n(!0)},usePortal:!1,disableFlipMiddleware:!0,autoUpdateOnTargetResize:!0,children:f}),!p&&!_&&f,(0,s.Y)(we.v,{restoreFocus:!1,trigger:"manual",shown:o,onShownChange:t=>{setTimeout((()=>n(t)),0)},placement:"top-end",width:340,size:"s",content:(0,s.Y)(l.i,{mode:"vertical",spacing:8,paddingTop:8,paddingBottom:8,children:(0,s.FD)(Et.s,{justify:"space-between",noWrap:!0,children:[(0,s.FD)(Et.s,{direction:"column",gap:2,children:[(0,s.Y)(l.i,{mode:"vertical",spacing:4,paddingTop:8,paddingBottom:12,children:(0,s.Y)(a.LE,{className:(0,r.I)("color_text_secondary"),children:y.getLang("global_snippet_audio")})}),(0,s.Y)(l.i,{mode:"vertical",spacing:4,paddingTop:0,paddingBottom:0,children:(0,s.FD)(Et.s,{direction:"column",gap:2,children:[(0,s.Y)(a.LE,{children:y.getLang("global_use_audio_snippet")}),(0,s.Y)(a.LE,{className:(0,r.I)("color_text_secondary"),children:(0,s.Y)(be.I,{children:y.getLang("global_use_audio_snippet_description")})})]})})]}),(0,s.Y)(Et.s,{justify:"end",align:"center",children:(0,s.Y)(Zt.dOG,{"data-testid":"audio-snippet-toggle",checked:d,onChange:h})})]})}),"data-testid":"audio-snippet-onboarding","aria-label":y.getLang("global_actions_button"),children:(0,s.Y)(te.K,{size:24,label:y.getLang("global_delete"),onClick:c,hasHover:!1,hasActive:!1,children:(0,s.Y)(Jt.S,{className:(0,r.I)("color_icon_secondary")})})})]});if(u)return(0,s.Y)(Ae,{audio:u,thumb:u.album?.thumb?.photo_135,title:d?`${u.title} — ${u.artist}`:u.title,subtitle:d?y.getLang("wall_posting_audio_snippet_player_title"):u.artist,explicit:Boolean(u.is_explicit),isPlaying:e.isPlaying,isActive:!g&&!p,onClick:()=>{i&&t(i)},hasRestriction:Boolean(u.content_restricted),after:S,duration:u.duration})})),Ce=(0,E.jn)(ye,ke),Ie=(0,o.P)((function({withBorder:t=!1,cellHeight:e=_t.Vy}){const i=(0,v.B)(),{screen:o,snippetModeSelected:n,isAudioSnippetEnabled:a,onSnippetModeChange:d,selectedAudios:c,onSetCurrentAudio:h,handleOpenMusicScreen:p,multipleAudiosSelected:_,snippetDropdownShown:m,onSnippetDropdownShownChange:y,snippetLoading:f,playableAudioTrack:S,snippetOnboardingText:w,hideSnippetOnboarding:b,productAnalyticsLogger:P}=yt();if(!a||!c.length||o===pt)return null;const A=c.length-1,k=i.langReplace(i.numeric(A,i.getLang("audio_onmedia_n_more_tracks",!0)),{count:String(A)}),C=c[0];return(0,s.FD)(s.FK,{children:[t&&(0,s.Y)(se.w,{size:1,padding:!1}),(0,s.FD)(l.i,{mode:"vertical",spacing:8,paddingTop:0,paddingBottom:0,children:[_&&(0,s.Y)(u.T,{onClick:p,minHeight:e,hasHover:!1,hasActive:!1,chevron:_?"always":void 0,before:(0,s.Y)(g._,{fallbackIcon:(0,s.Y)(oe.F,{className:(0,r.I)("color_icon_secondary")}),size:40,src:C.album?.thumb?.photo_135,borderRadius:"m",alt:C.title}),subtitle:k,children:(0,s.Y)("span",{children:C.title})}),!_&&null!==S&&(0,s.Y)(l.i,{mode:"vertical",spacing:8,paddingTop:0,paddingBottom:0,children:(0,s.Y)(Ce,{audio:S,snippetDropdownShown:m,onClearClick:t=>h(t,C),snippetModeSelected:n,onSnippetModeChange:d,snippetLoading:f,snippetOnboardingText:w,onSnippetOnboardingShown:b,onSnippetDropdownShownChange:y,productAnalyticsLogger:P})})]})]})}));var Ee=i(948350),Le=i(91720);const Te=(0,o.P)((function(){const t=(0,v.B)(),{screen:e,setAlbumsScreen:i,setPlaylistsScreen:o,searchAudio:A,searchAudioPlaylist:k,onSelectPlaylist:C,onSelectAlbum:I,onSelectWholePlaylist:E,searchQuery:L,searchPlaylistQuery:T,isLoading:M,isLoadingPlaylists:O,isLoadingPlaylistAudios:D,isAudioSnippetEnabled:x,ownerId:R,audios:Y,playlists:F,playlistAudios:B,onClose:N,fetchNext:z,fetchNextPlaylists:V,fetchNextPlaylistAudios:U,handleGoBack:G,isEmptyPlaylists:j,isEmptyAlbums:W,isLoadingAlbums:H,isLoadedFullyAlbums:$,isEmptyAudios:K,handleGoToPrevScreen:q,headerText:Q,footerText:J,selectedAudios:X,onSetCurrentAudio:Z,attachCurrentSelectedAudios:tt,handlePlayAudio:et,handlePauseAudio:it,withSourceSelector:st,currentSource:ot,handleSourceSelectorToggle:nt,fetchNextAlbums:at,handlePlayPlaylist:ut,albums:_t,subtitleText:mt,isEmptyPlaylistAudios:vt,audioNotFoundText:ft,playlistsNotFoundText:St,playing:wt,isAccessDenied:bt,selectedAudiosIds:Pt,setSelectedAudiosScreen:At,selectedAudiosEdit:kt,onRemoveSelectedAudiosEdit:Ct,multipleAudioSelectEnabled:It,sortSelectedAudiosEdit:Et,canSubmit:Lt,hasBackLabel:Tt,snippetOnboardingText:Mt,hideSnippetOnboarding:Ot}=yt(),xt=(0,S.useRef)(null),Rt=(0,S.useMemo)((()=>new w.F((0,b.MW)())),[]);(0,S.useEffect)((()=>{xt?.current&&(xt.current.scrollTop=0)}),[e]),(0,S.useEffect)((()=>()=>{wt&&Rt?.stop()}),[wt]),(0,S.useEffect)((()=>()=>{Mt&&Ot()}),[]);const Yt=st?(0,s.Y)(n.N,{onClick:nt,children:ot===gt?t.getLang("audio_picker_select_user_audios"):t.getLang("audio_picker_select_group_audios")}):void 0,Ft=e===lt||e===pt,Bt=mt||Yt,Nt=x&&X.length>0&&e!==pt,zt=X.length>1?(0,s.Y)(n.N,{onClick:At,noUnderline:!0,"data-testid":"posting_posting_audio_selected_audios_many",children:J}):(0,s.Y)(a.LE,{className:(0,r.I)("color_text_secondary"),"data-testid":"posting_posting_audio_selected_audios",children:J});return(0,s.FD)(s.FK,{children:[(0,s.Y)(d.r,{onClose:N,closeAriaLabel:t.getLang("global_close"),onBack:e===rt?G:q,backLabel:Tt?t.getLang("global_back"):void 0,subtitle:Bt,id:"audio_picker_header",children:Q}),(0,s.FD)(P.V,{ownerId:R,platformAudioPlayer:Rt??void 0,children:[(0,s.Y)(c.c,{insetLevel:0,children:(0,s.FD)(l.i,{mode:"vertical",spacing:4,paddingTop:0,paddingBottom:0,children:[(e===ct||e===ht)&&(0,s.Y)(h.v,{value:L,"data-testid":"posting_audio_search_audio_in_playlist_input",onChange:t=>A(t.target.value),placeholder:t.getLang("wall_posting_audio_picker_search_placeholder")}),e===dt&&(0,s.Y)(h.v,{value:T,"data-testid":"posting_audio_search_playlists_input",onChange:t=>k(t.target.value),placeholder:t.getLang("wall_posting_audio_picker_search_placeholder")}),e===rt&&(0,s.Y)(h.v,{value:L,"data-testid":"posting_audio_search_audio_input",onChange:t=>A(t.target.value),placeholder:t.getLang("wall_posting_audio_picker_search_placeholder")})]})}),(0,s.FD)(p._,{height:(0,Ee.d)({isSmall:!0,withSubtitle:Boolean(Bt),withoutSearch:Ft,withSnippet:Nt}),autoHideScrollbar:!0,getRef:xt,children:[e===rt&&!L&&(0,s.Y)(l.i,{spacing:4,paddingTop:4,paddingBottom:4,mode:"vertical",children:(0,s.Y)(u.T,{"data-testid":"posting_audio_open_playlists_screen",before:(0,s.Y)(g._,{size:40,borderRadius:"l",children:(0,s.Y)(y.k,{})}),onClick:o,children:t.getLang("wall_posting_audio_picker_playlists_button_text")})}),(e===ct||e===ht)&&(0,s.FD)(s.FK,{children:[(0,s.Y)(l.i,{spacing:4,paddingTop:0,paddingBottom:4,mode:"vertical",children:(0,s.FD)(u.T,{"data-testid":"posting_audio_attach_playlist_button",before:(0,s.Y)(f.Z,{className:(0,r.I)("color_icon_accent")}),onClick:E,disabled:bt||D,children:[e===ct&&t.getLang("wall_posting_audio_picker_attach_playlist"),e===ht&&t.getLang("wall_posting_audio_picker_attach_album")]})}),(0,s.Y)(Dt,{multipleAudioSelectEnabled:It,scrollRef:xt?.current??null,isLoading:D,audios:B,onLoadMore:U,onSelectAudio:Z,isEmpty:vt,audioPlayer:Rt,onPlay:et,onPause:it,selectedAudiosIds:Pt,notFoundText:ft,isAccessDenied:bt})]}),e===dt&&(0,s.FD)(s.FK,{children:[!W&&(0,s.Y)(jt,{albums:_t,onSelectAlbum:I,isLoading:H,onLoadMore:i,isEmpty:W,audioPlayer:Rt,onPlay:ut,onPause:it}),(0,s.Y)(qt,{scrollRef:xt?.current,isLoading:O||H,playlists:F,onSelectPlaylist:C,onLoadMore:V,isEmpty:j,notFoundText:St})]}),e===lt&&(0,s.Y)(Qt,{scrollRef:xt?.current,isLoading:H,isLoaded:$,albums:_t,onSelectAlbum:I,onLoadMore:at,isEmpty:W,audioPlayer:Rt,onPlay:ut,onPause:it}),e===rt&&(0,s.Y)(Dt,{multipleAudioSelectEnabled:It,scrollRef:xt?.current??null,isLoading:M,audios:Y,onLoadMore:z,onSelectAudio:Z,isEmpty:K,audioPlayer:Rt,onPlay:et,onPause:it,selectedAudiosIds:Pt,notFoundText:ft}),e===pt&&(0,s.Y)(ie,{selectedAudios:kt,onRemoveAudio:Ct,isEmpty:!kt.length,audioPlayer:Rt,onPlay:et,sortSelectedAudios:Et})]})]}),x&&(0,s.Y)(Ie,{withBorder:!0}),(0,s.Y)(_.j,{before:x?null:It?zt:(0,s.Y)(a.LE,{className:(0,r.I)("color_text_secondary"),"data-testid":"posting_posting_audio_picker_rules",children:t.getLang("wall_posting_audio_picker_rules")}),actions:(0,s.Y)(m.$,{disabled:!Lt,size:"l",stretched:!0,onClick:tt,"data-testid":"posting_audio_attach_audio_button",children:t.getLang("wall_posting_audio_picker_attach_audio")})})]})}));Te.displayName="AudioPicker";const Me=(0,Le.N)(vt,Te)},842514:(t,e,i)=>{i.d(e,{N:()=>K});var s=i(221020),o=i(47417),n=i(409698),a=i(423654),r=i(638945),d=i(187233),c=i(721990),l=i(120125),h=i(999051),p=i(405697),u=i(37390),g=i(772812),_=i(356035),m=i(439712),v=i(946918),y=i(815287),f=i(333702),S=i(83413),w=i(713581),b=i(311029);const P=(0,_.P)((function({error:t,onReload:e,onBack:i,onClose:a}){const r=(0,v.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(o.r,{onBack:i,backLabel:r.getLang("global_back"),onClose:a,closeAriaLabel:r.getLang("global_close"),children:r.getLang("docs_head_title")}),(0,s.Y)(b.c,{insetLevel:0,children:(0,s.Y)(l._,{autoHideScrollbar:!0,maxHeight:400,children:(0,s.Y)(d.i,{paddingBottom:0,paddingTop:0,children:(0,s.Y)(p.O,{action:(0,s.Y)(n.$,{onClick:e,children:r.getLang("global_reload")}),children:t})})})})]})}));var A=i(46284),k=i(292184),C=i(94988),I=i(948350);const E=({onClose:t,onBack:e,hasSubtitle:i})=>{const n=(0,v.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(o.r,{onBack:e,backLabel:n.getLang("global_back"),after:(0,s.Y)(A.E,{width:140,height:28}),onClose:t,closeAriaLabel:n.getLang("global_close"),subtitle:i?(0,s.Y)(A.E,{width:100,height:16}):void 0,children:n.getLang("docs_head_title")}),(0,s.Y)(d.i,{paddingBottom:0,children:(0,s.Y)(d.i,{paddingBottom:8,paddingTop:8,children:(0,s.Y)(A.E,{height:32})})}),(0,s.Y)(l._,{height:(0,I.d)({isSmall:!0}),autoHideScrollbar:!0,children:(0,s.Y)(d.i,{paddingBottom:0,paddingTop:0,children:Array(15).fill(null).map(((t,e)=>(0,s.Y)(k.T,{before:(0,s.Y)(C.B,{children:(0,s.Y)(A.E,{width:40,height:40})}),subtitle:(0,s.Y)(A.E,{width:200}),hasHover:!1,hasActive:!1,children:(0,s.Y)(A.E,{width:320})},e)))})})]})};var L=i(331635),T=i(327813),M=i(42107),O=i(508461),D=i(762044),x=i(582876),R=i(916533),Y=i(273193),F=i(725308),B=i(160010),N=i(328911),z=i(571559),V=i(486526),U=i(257581);class G{async[M.Ts](){this.isListLoading=!0,this._ownerId?(this.groupMode=this.isGroupOwner,await this.fetchData()):this.isError=this.langs.getLang("docs_load_data_server_error"),(0,T.h5)((()=>{this.isListLoading=!1})),this.props.current.timelineLogger?.logPickerReady?.()}get hasSelectedDocs(){return Boolean(this.selectedDocs.length>0&&this.docsList.count)}get isGroupOwner(){return F.z.isGroupId(this._ownerId)}get groupId(){return F.z.convertOwnerIdToGroupId(this._ownerId)}get filesLimit(){return this.props.current.filesLimit}async fetchData(){await this.ensureOwnerGroup(),this.isError||await this.fetchDocs()}async fetchDocs(){try{await this.docsList.fetch({count:30,ownerId:Number(this.groupMode?this._ownerId:this.authService.userId),searchType:1,q:this.searchQuery||""}),this.checkAlreadySelectedDocs(),this.isError=""}catch(t){this.handleApiError(t),this.feedErrorService.handleNetworkError(t)}}get ownerGroup(){if(this.isGroupOwner)return this.groupsProvider.getGroup(this.groupId)}async ensureOwnerGroup(){if(this.isGroupOwner)try{await this.groupsProvider.fetchGroupsByIds({groupIds:[this.groupId],fields:["ban_info","counters"]}),this.ownerGroup?.ban_info&&(this.isError=this.langs.getLang("docs_blacklisted_by_group")),void 0===this.ownerGroup?.counters?.docs&&(0,T.h5)((()=>{this.groupMode=!1,this.docsDisabled=!0}))}catch(t){this.handleApiError(t)}}handleApiError(t){(0,B.d)(t)&&t.error.error_code===z.jdo?this.isError=this.langs.getLang("blank_no_group_docs_view"):this.isError=this.langs.getLang("global_error_occured")}get hasBackLabel(){return Boolean(this.props.current.onGoBack)}[M.zr](){this._clearState()}constructor(t,e,i,s,o,n){this.authService=t,this.docsListsProvider=e,this.groupsProvider=i,this.langs=s,this.feedErrorService=o,this.props=n,this.uploadFileState=null,this.isListLoading=!1,this.isError="",this.groupMode=!1,this.docsDisabled=!1,this.selectedDocs=[],this.searchQuery="",this._search=(0,V.s)((async()=>{await this.fetchDocs()}),500),this.onChangeSearchQuery=t=>{this.searchQuery=t,this._search()},this.toggleGroupMode=()=>{this.groupMode=!this.groupMode,this.fetchDocs()},this.checkAlreadySelectedDocs=()=>{if(!this.selectedDocs.length&&this.props.current.selectedDocs?.length){const t=new Map(this.docsList.items.map((t=>[t.rawId,t])));this.props.current.selectedDocs.forEach((({owner_id:e,id:i})=>{const s=(0,N.o)({ownerId:e,itemId:i}),o=t.get(s);o&&this.selectedDocs.push(o)}))}},this.onLoadMore=async()=>{if(this._ownerId)try{await this.docsList.fetchNext(),this.checkAlreadySelectedDocs()}catch(t){this.handleApiError(t)}},this._clearState=()=>{this.searchQuery="",this.isError="",this.docsList.reset()},this.onOpenUploadDoc=()=>{this.uploadFileState={onClose:()=>{this.uploadFileState=null},onSaveSuccess:t=>{this.uploadFileState=null,t&&this.onAttach([t])},onUploadError:this.handleUploadError,onUploadStart:this.handleUploadStart,onUploadSuccess:this.handleUploadSuccess},this.props.current.productAnalyticsLogger?.logClickAttachmentEvent({clickAttachmentEventType:U.uT.ClickToAddFile})},this.onAttach=t=>{this.props.current.timelineLogger?.logStartAttaching?.(),this.props.current.onAttach(t),this.handleGoBack()},this.onSelectDoc=t=>{const e=this.selectedDocs.findIndex((e=>e.rawId===t.rawId));e>=0?this.selectedDocs.splice(e,1):this.selectedDocs.length===this.props.current.filesLimit?1===this.props.current.filesLimit?this.selectedDocs=[t]:this.props.current.onError?.(this.langs.numeric(this.props.current.filesLimit,this.langs.getLang("wall_post_file_attachments_limit_exceeded_text",!0))):this.selectedDocs.push(t)},this.handleGoBack=()=>{this.props.current.onGoBack?this.props.current.onGoBack():this.closeModal()},this.closeModal=()=>{this.props.current.closeModal?.()},this.handleUploadStart=(t,e)=>{this.props.current.timelineLogger?.logStartFileUploading?.(e)},this.handleUploadSuccess=()=>{this.props.current.timelineLogger?.logFileLoaded?.()},this.handleUploadError=t=>{this.props.current.timelineLogger?.logFileLoadingError?.(t)},this._ownerId=Number(this.props.current.ownerId||this.authService.userId),this.docsList=e.createSearchList(),(0,T.l_)(this)}}G=(0,L.Cg)([M.z8.transient(),(0,L.Sn)("design:type",Function),(0,L.Sn)("design:paramtypes",[void 0===R.u?Object:R.u,void 0===O.O?Object:O.O,void 0===D.S?Object:D.S,void 0===Y.Y?Object:Y.Y,void 0===x.m?Object:x.m,void 0===M.Ji?Object:M.Ji])],G);const{Provider:j,useModel:W}=(0,M.Qd)(G,{initInEffect:!1});var H=i(91720);const $=(0,_.P)((function(){const t=W(),{isError:e,isListLoading:i,onAttach:_,docsList:b,handleGoBack:A,closeModal:k,onChangeSearchQuery:C,searchQuery:L,onOpenUploadDoc:T,uploadFileState:M,toggleGroupMode:O,groupMode:D,onLoadMore:x,onSelectDoc:R,isGroupOwner:Y,docsDisabled:F,selectedDocs:B,hasSelectedDocs:N,hasBackLabel:z,filesLimit:V}=t,U=(0,v.B)(),[G,j]=(0,y.useState)(null),H=Y&&!F;return(0,f.M)(!b.isLoading&&!b.isLoadedFully,x,G),e?(0,s.Y)(P,{error:e,onClose:k,onBack:A,onReload:()=>{t.fetchDocs()}}):i?(0,s.Y)(E,{onClose:k,onBack:A,hasSubtitle:H}):M?(0,s.Y)(w.P,{...M}):(0,s.FD)(s.FK,{children:[(0,s.Y)(o.r,{onBack:A,backLabel:z?U.getLang("global_back"):void 0,onClose:k,centered:!0,closeAriaLabel:U.getLang("global_close"),after:(0,s.Y)(n.$,{onClick:T,children:U.getLang("docs_add_file")}),id:"file_picker_header",subtitle:H?(0,s.Y)(a.N,{onClick:O,children:(0,s.Y)(r.tW,{children:D?U.getLang("docs_choose_switch_user"):U.getLang("docs_choose_switch_group")})}):void 0,children:U.getLang("docs_head_title")}),(0,s.Y)(d.i,{paddingBottom:0,children:(0,s.Y)(m.n,{children:()=>(0,s.Y)(c.v,{placeholder:U.getLang("docs_placeholder"),value:L,onChange:t=>C(t.target.value)})})}),(0,s.Y)(l._,{height:(0,I.d)({isSmall:!0}),autoHideScrollbar:!0,getRef:j,children:(0,s.FD)(d.i,{paddingBottom:0,paddingTop:0,children:[Boolean(b.count)&&b.items.map((t=>(0,s.Y)(S.E,{doc:t,onClick:R,onSelectTag:C,isSelected:Boolean(B.find((e=>e.data.id===t.data.id&&e.data.owner_id===t.data.owner_id)))},t.rawId))),b.isLoading&&(0,s.Y)(d.i,{mode:"vertical",children:(0,s.Y)(h.y,{size:"regular"})}),!b.isLoading&&!b.count&&(0,s.Y)(p.O,{"data-testid":"docs_list_placeholder",children:U.getLang("mobile_docs_no_doc")})]})}),(0,s.Y)(u.j,{before:1===V?(0,s.Y)(r.LE,{className:(0,g.I)("color_text_secondary"),children:U.getLang("wall_posting_file_limit")}):void 0,actions:(0,s.Y)(n.$,{size:"l",stretched:!0,onClick:()=>_(B),"data-testid":"posting_file_attach_button",disabled:!N,children:U.getLang("global_add")})})]})}));$.displayName="FilePicker";const K=(0,H.N)(j,$)},90447:(t,e,i)=>{i.d(e,{f:()=>Bt});var s=i(221020),o=i(356035),n=i(331635),a=i(42107),r=i(327813),d=i(250096),c=i(848549),l=i(725308);class h{get count(){return this._count}get countReceived(){return this._countReceived}get isLoading(){return this._isLoading}get isLoaded(){return Boolean(this.prevRequestParams)}get isLoadedFully(){return this._isLoadedFully}getAlbumById(t){return this.albumsProvider.getAlbum(t)}get albums(){const t=[];return this.ids.forEach((e=>{const i=this.getAlbumById(e);i&&t.push(i)})),t}get notEmptyAlbums(){return this.albums.filter((t=>t.data.size>0))}dispose(){this.controller?.abort()}done(t,e){const{count:i=0,offset:s=0}=t,o=e.items.map((({rawId:t})=>t));return this._countReceived=this._countReceived+e.count,this._isLoadedFully=0===e.count||this._count<=s+i,this.ids=s?[...this.ids,...o]:o,this._isLoading=!1,this.controller=null,this.prevRequestParams=t,o}async fetch(t=new AbortController){this.reset(),this.controller=t,this._isLoading=!0;const e={},{ownerId:i}=this.config.params;i&&(l.z.isUserId(i)?e.user_id=i:l.z.isGroupId(i)&&(e.group_id=l.z.convertOwnerIdToGroupId(i)));try{const[i,s]=await Promise.all([this.request(this.config.params,t),this.photosApi.getAlbumsCount(e,{signal:t.signal})]);return(0,r.h5)((()=>{this._count=s})),this.done(this.config.params,i)}finally{this._isLoading=!1}}async fetchMore(t=new AbortController){if(!this.prevRequestParams||this._isLoading||this._isLoadedFully)return;this.controller=t,this._isLoading=!0;const{count:e=0,offset:i=0}=this.prevRequestParams??{},s=i+e,o={...this.prevRequestParams,offset:s},n=await this.request(o,t);return this.done(o,n)}async request(t,e){const{ownerId:i,count:s,offset:o,needCovers:n,needSystem:a,photoSizes:r}=t,c=await this.photosApi.getAlbums({owner_id:i,count:s,offset:o,need_covers:(0,d.Iz)(n),need_system:(0,d.Iz)(a),photo_sizes:(0,d.Iz)(r)},{signal:e.signal});return{items:this.albumsProvider.createAlbumsFromApi(c.items),count:c.count}}reset(){this.controller?.abort(),this.resetData()}resetData(){this._count=0,this._isLoading=!1,this._isLoadedFully=!1,this.ids=[],this.prevRequestParams=null,this.controller=null}constructor(t,e,i){this.config=t,this.albumsProvider=e,this.photosApi=i,this.ids=[],this.prevRequestParams=null,this.controller=null,this._count=0,this._countReceived=0,this._isLoading=!1,this._isLoadedFully=!1,(0,r.l_)(this)}}class p{get rawId(){return(0,d._y)({id:this._data.id,ownerId:this._data.owner_id})}get data(){return this._data}constructor(t){this._data=t,(0,r.l_)(this)}}class u{createAlbumFromApi(t){const e=new p(t);return this.albumsMap.set(e.rawId,e),e}createAlbumsFromApi(t){return t.map((t=>this.createAlbumFromApi(t)))}getAlbum(t){return this.albumsMap.get(t)}constructor(){this.albumsMap=new Map,(0,r.l_)(this)}}u=(0,n.Cg)([a.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[])],u);var g=i(99201);class _{createList(t){return new h(t,this.albumsProvider,this.photosApi)}constructor(t,e){this.albumsProvider=t,this.photosApi=e,(0,r.l_)(this)}}_=(0,n.Cg)([a.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===u?Object:u,void 0===g.U?Object:g.U])],_);class m{get count(){return this._count}get isLoading(){return this._isLoading}get isLoaded(){return Boolean(this.prevRequestParams)}get isLoadedFully(){return this._isLoadedFully}getPhotoById(t){return this.photosProvider.getPhoto(t)}get photos(){const t=[];return this.ids.forEach((e=>{const i=this.getPhotoById(e);i&&t.push(i)})),t}reversePhotos(){this.ids=this.ids.reverse()}dispose(){this.controller?.abort()}done(t,e){const{count:i=0,offset:s=0}=t,o=e.items.map((({rawId:t})=>t));return this._isLoadedFully=e.count<=s+i,this._count=e.count,s?this.ids.push(...o):this.ids=o,this._isLoading=!1,this.controller=null,this.prevRequestParams=t,o}async fetch(t=new AbortController){this.reset(),this.controller=t,this._isLoading=!0;const e={...this.config.params,offset:0},i=await this.request(e,t);return this.done(e,i)}async fetchMore(t=new AbortController){if(!this.prevRequestParams||this._isLoading||this._isLoadedFully)return;this.controller=t,this._isLoading=!0;const{count:e=0,offset:i=0}=this.prevRequestParams??{},s=i+e,o={...this.prevRequestParams,offset:s},n=await this.request(o,t);return this.done(o,n)}request(t,e){return this.config.fetchMethod(t,{signal:e.signal})}reset(){this.controller?.abort(),this.resetData()}resetData(){this._count=0,this._isLoading=!1,this._isLoadedFully=!1,this.ids=[],this.prevRequestParams=null,this.controller=null}constructor(t,e){this.config=t,this.photosProvider=e,this.ids=[],this.prevRequestParams=null,this.controller=null,this._count=0,this._isLoading=!1,this._isLoadedFully=!1,(0,r.l_)(this)}}var v=i(634478);class y{createList(t){return new m({fetchMethod:this.fetchAllPhotos,params:t},this.photosProvider)}constructor(t,e){this.photosProvider=t,this.photosApi=e,this.fetchAllPhotos=async(t,e)=>{const{ownerId:i,offset:s,count:o,extended:n}=t,a=await this.photosApi.getAll({owner_id:i,offset:s,count:o,extended:(0,d.Iz)(n)},e);return{items:this.photosProvider.createPhotosFromApi(a.items),count:a.count}},(0,r.l_)(this)}}y=(0,n.Cg)([a.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===v.v?Object:v.v,void 0===g.U?Object:g.U])],y);class f{createList(t){return new m({fetchMethod:this.fetchPhotos,params:t},this.photosProvider)}constructor(t,e){this.photosProvider=t,this.photosApi=e,this.fetchPhotos=async(t,e)=>{const{ownerId:i,albumId:s,photosIds:o,offset:n,count:a,rev:r,extended:c}=t,l=o?.map((t=>`${i}_${t}`)).join(",")??"",h=await this.photosApi.get({photo_ids:l,owner_id:i,album_id:String(s),offset:n,count:a,rev:(0,d.Iz)(r),extended:(0,d.Iz)(c)},e);return{items:this.photosProvider.createPhotosFromApi(h.items),count:h.count}},(0,r.l_)(this)}}f=(0,n.Cg)([a.z8.container(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===v.v?Object:v.v,void 0===g.U?Object:g.U])],f);var S=i(228838),w=i(174520);class b{get isLoaded(){return this.albumsList.isLoaded}get isLoading(){return this.albumsList.isLoading}get isLoadedFully(){return this.albumsList.isLoadedFully}get albums(){return this.albumsList.notEmptyAlbums.filter((t=>t.data.id!==S.Wc&&t.data.id!==w.d&&t.data.id!==w.H))}get count(){return this.albums.length}get error(){return this.rawError}dispose(){this.albumsList.dispose()}clearError(){this.rawError=null}async fetch(){this.clearError();try{return await this.albumsList.fetch()}catch(t){return this.rawError=t,[]}}constructor(t,e){this.albumsListProvider=e,this.rawError=null,this.ownerId=t.ownerId,this.albumsList=e.createList({params:{ownerId:this.ownerId,needCovers:!0,photoSizes:!0,needSystem:!0}}),(0,r.l_)(this)}}class P{get isLoaded(){return this.photosAllList.isLoaded}get isLoading(){return this.photosAllList.isLoading}get isLoadedFully(){return this.photosAllList.isLoadedFully}get photos(){return this.photosAllList.photos}get count(){return this.photosAllList.count}get error(){return this.rawError}dispose(){this.photosAllList.dispose()}clearError(){this.rawError=null}async fetch(){this.clearError();try{return await this.photosAllList.fetch()}catch(t){return this.rawError=t,[]}}async fetchMore(){this.clearError();try{return await this.photosAllList.fetchMore()}catch(t){return this.rawError=t,[]}}constructor(t,e,i=24){this.photosAllListProvider=e,this.chunkSize=i,this.rawError=null,this.ownerId=t.ownerId,this.photosAllList=e.createList({ownerId:this.ownerId,count:this.chunkSize,extended:!0}),(0,r.l_)(this)}}class A{get isLoaded(){return this.photosList?.isLoaded??!1}get isLoading(){return this.photosList?.isLoading??!1}get isLoadedFully(){return this.photosList?.isLoadedFully??!1}get photos(){return this.photosList?.photos??[]}reversePhotos(){this.photosList?.reversePhotos()}get error(){return this.rawError}dispose(){this.photosList?.dispose()}clearError(){this.rawError=null}async fetch({albumId:t,reverse:e=!0}){this.clearError();try{return this.photosList?.reset(),this.photosList=this.photosListProvider.createList({albumId:t,ownerId:this.ownerId,count:this.chunkSize,rev:e,extended:!0}),await this.photosList.fetch()}catch(t){return this.rawError=t,[]}}async fetchMore(){this.clearError();try{return await(this.photosList?.fetchMore())}catch(t){return this.rawError=t,[]}}constructor(t,e,i=24){this.photosListProvider=e,this.chunkSize=i,this.rawError=null,this.ownerId=t.ownerId,(0,r.l_)(this)}}class k{async fetch(){this.albumsList?.isLoaded||await this.albumsList.fetch(),this.photosAllList?.isLoaded||await this.photosAllList.fetch();const t=this.albumsList.error||this.photosAllList.error;if(t)throw t}dispose(){this.closeAlbum(),this.albumsList.dispose(),this.photosAllList.dispose(),this.photosFromAlbumList.dispose()}async changeSort(){if(this.openedAlbum)if(this.photosFromAlbumReverse=!this.photosFromAlbumReverse,this.photosFromAlbumList.isLoadedFully)this.photosFromAlbumList.reversePhotos();else{await this.photosFromAlbumList.fetch({albumId:this.openedAlbum.data.id,reverse:this.photosFromAlbumReverse});const t=this.photosFromAlbumList.error;if(t)throw t}}async openAlbum(t){this.openedAlbum=t,await this.photosFromAlbumList.fetch({albumId:t.data.id});const e=this.photosFromAlbumList.error;if(e)throw e}closeAlbum(){this.openedAlbum=null,this.photosFromAlbumReverse=!0}constructor(t,e,i,s){this.albumsListProvider=e,this.photosAllListProvider=i,this.photosListProvider=s,this.photosFromAlbumReverse=!0,this.openedAlbum=null;const{ownerId:o}=t;this.ownerId=o,this.albumsList=new b({ownerId:this.ownerId},this.albumsListProvider),this.photosAllList=new P({ownerId:this.ownerId},this.photosAllListProvider),this.photosFromAlbumList=new A({ownerId:this.ownerId},this.photosListProvider)}}var C=i(376572),I=i(257581);const E="main",L="allAlbums",T="photosFromAlbum";var M=function(t){return t.CurrentOwner="currentOwner",t.User="user",t}({}),O=i(273193);const D=E;class x{[a.Ts](){this.ownerId&&this.fetch()}[a.yo](){this.props.current.needUpdates&&(this.selectedPhotos={},this.props.current.selectedPhotos.forEach((t=>{this.selectedPhotos[(0,d.Ox)(t)]=t})))}[a.zr](){this.dispose()}async fetch(){try{await this._ownerPhotos.fetch(),this.props.current.timelineLogger?.logPickerReady?.()}catch(t){if(!(0,C.T)(t)||(0,c.z)(t))return;this.handleShowError(),this.props.current.timelineLogger?.logError?.(),this.closePicker()}}dispose(){this._ownerPhotos.dispose(),this._userPhotos?.dispose?.(),this.selectedPhotos={},this.currentScreen=D}showAllAlbumsScreen(){this.currentScreen=L}showMainScreen(){this.currentScreen=E}async showPhotosFromAlbums(t){this.currentScreen!==T&&(this.openedAlbumFrom=this.currentScreen),this.currentScreen=T,this.props.current.productAnalyticsLogger?.logClickAttachmentEvent?.({clickAttachmentEventType:I.uT.OpenAlbum});try{await this.photos.openAlbum(t)}catch(t){if(!(0,C.T)(t)||(0,c.z)(t))return;this.handleShowError(),this.closeAlbum()}}closeAlbum(){this.photos.closeAlbum(),this.openedAlbumFrom&&(this.currentScreen=this.openedAlbumFrom),this.openedAlbumFrom=null}get limitPhotos(){return this.props.current.photosLimit}get selectedPhotoCount(){return Object.keys(this.selectedPhotos).length}get canSelectPhoto(){return this.selectedPhotoCount<this.limitPhotos}get hadSelectedPhotos(){return Object.keys(this.selectedPhotos).length>0}get isDirty(){return this.hadSelectedPhotos||this.props.current.selectedPhotos.length>0}get photosSelection(){const t={};return Object.keys(this.selectedPhotos).forEach((e=>{t[e]=!0})),t}get selectedPhotosCount(){return Object.keys(this.selectedPhotos).length}get attachemntTypes(){return{photo:this.selectedPhotosCount}}get openedAlbumTitle(){return this.photos.openedAlbum?.data.title||""}get withSourceSelector(){const{sourceSelectorEnabled:t,isAdmin:e}=this.props.current;return Boolean(t&&e)}get currentSource(){return this._currentSource}get photos(){return this.currentSource===M.User&&this._userPhotos?this._userPhotos:this._ownerPhotos}get hasBackLabel(){return Boolean(this.openedAlbumFrom||this.props.current.onGoBack)}constructor(t,e,i,s,o){this.props=t,this.albumsListProvider=e,this.photosAllListProvider=i,this.photosListProvider=s,this.langs=o,this._userPhotos=null,this.currentScreen=D,this.selectedPhotos={},this.openedAlbumFrom=null,this._currentSource=M.CurrentOwner,this.changeSort=()=>{this.photos.changeSort()},this.togglePhotoSelection=(t,e)=>{if(this.selectedPhotos[t.rawId]){if(!1===this.props.current.canRemoveAttachmentWithFeedback?.({event:e,type:"photo",replaceTypes:this.attachemntTypes,itemId:t.data.id,ownerId:t.data.owner_id}))return;delete this.selectedPhotos[t.rawId]}else{if(!this.canSelectPhoto)return void this.handleLimitExceededError();if(!1===this.props.current.canAddAttachmentWithFeedback?.({event:e,type:"photo",replaceTypes:this.attachemntTypes}))return;this.selectedPhotos[t.rawId]=t.data}this.props.current.onPickPhoto?.(t.data,e)},this.handleSourceSelectorToggle=()=>{this.setCurrentSource(this.currentSource===M.User?M.CurrentOwner:M.User)},this.setCurrentSource=t=>{if(t===M.User){if(!this._userPhotos)return;this._userPhotos.photosAllList.isLoaded||this._userPhotos.photosAllList.isLoading||this._userPhotos.fetch()}this.currentScreen=E,this._currentSource=t},this.handlePickPhotos=()=>{this.props.current.timelineLogger?.logStartAttaching?.();const t=[];for(const e in this.selectedPhotos)this.selectedPhotos[e]&&t.push(this.selectedPhotos[e]);this.props.current.onPhotoSelect?.(t)},this.handleLimitExceededError=()=>{this.props.current.onError(this.langs.getLang("wall_posting_attachment_limit_exceeded_text"),this.langs.numeric(this.props.current.totalLimit??this.props.current.photosLimit,this.langs.getLang("wall_attachments_limit_exceeded_subtitle",!0)))},this.handleShowError=()=>{this.props.current.onError(this.langs.getLang("wall_posting_network_general_error_text"),this.langs.getLang("wall_posting_network_general_error_subtitle"))},this.closePicker=()=>{this.props.current.onGoBack?this.props.current.onGoBack():this.closeModal()},this.closeModal=()=>{this.props.current.onCloseModal?.()},this.handleGoBack=()=>{this.photos.openedAlbum?this.closeAlbum():this.closePicker()},(0,r.l_)(this),this.ownerId=Number(this.props.current.ownerId),this.props.current.selectedPhotos&&this.props.current.selectedPhotos.forEach((t=>{this.selectedPhotos[(0,d.Ox)(t)]=t})),this._ownerPhotos=new k({ownerId:this.props.current.isAdmin?this.ownerId:this.props.current.currentUserId},this.albumsListProvider,this.photosAllListProvider,this.photosListProvider),this.withSourceSelector&&(this._userPhotos=new k({ownerId:this.props.current.currentUserId},this.albumsListProvider,this.photosAllListProvider,this.photosListProvider))}}x=(0,n.Cg)([a.z8.transient(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===a.Ji?Object:a.Ji,void 0===_?Object:_,void 0===y?Object:y,void 0===f?Object:f,void 0===O.Y?Object:O.Y])],x);const{Provider:R,useModel:Y}=(0,a.Qd)(x,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var F=i(946918),B=i(423654),N=i(47417),z=i(638945);const V=(0,o.P)((function(t){const{withSourceSelector:e,currentSource:i,onSourceSelectorToggle:o,closeModal:n,handleGoBack:a,hasBackLabel:r}=t,d=(0,F.B)(),c=e?(0,s.Y)(B.N,{onClick:o,children:i===M.CurrentOwner?d.getLang("photos_picker_select_user_photos"):d.getLang("photos_picker_select_group_photos")}):void 0;return(0,s.Y)(N.r,{backLabel:r?d.getLang("global_back"):void 0,closeAriaLabel:d.getLang("global_close"),subtitle:c,onClose:()=>{n()},onBack:()=>{a()},centered:!0,id:"photo_picker_header",children:(0,s.Y)(z.$j,{children:d.getLang("photos_choose_photo_title")})})}));var U=i(405697),G=i(187233),j=i(475118),W=i(999051),H=i(982444),$=i(516427),K=i(413621),q=i(237582),Q=i(772812),J=i(664344),X=i(38020),Z=i(995921),tt=i(953008),et=i(796968),it=i(945782);const st=122.5;var ot=i(443680);const nt=(0,o.P)((function(t){const e=(0,F.B)(),{photo:i,canSelect:o,borderRadius:n}=t,a=(0,ot.N)(i.data.sizes,st),r=Y(),d=Boolean(r.photosSelection[i.rawId]),c=d||o,l=(0,it.LB)(i.data),h=(0,it.th)(i.data),p=!l&&!h,u=h&&!l;return(0,s.Y)($.SB4,{role:"checkbox","aria-checked":d,"aria-label":e.getLang("photos_default_aria_label"),onClick:t=>{r.togglePhotoSelection(i,t)},"data-testid":"posting_photo_picker_photos_item",children:(0,s.FD)(K._,{src:h?void 0:a,size:st,...n,alt:"",fallbackIcon:l?(0,s.Y)(Z.$,{}):p?(0,s.Y)(tt.k,{}):void 0,children:[c&&(0,s.FD)(q.v.OverlayItem,{placement:"top-right",paddingRight:0,paddingTop:0,children:[d&&(0,s.Y)(J.c,{}),!d&&o&&(0,s.Y)(X.U,{})]}),u&&(0,s.Y)(et.q,{className:(0,Q.I)("color_icon_contrast")})]})})}));var at=i(333702),rt=i(888817),dt=i(46284);const ct=20,lt=t=>{const{count:e=ct}=t,i=e>ct?ct:e;return(0,s.Y)(j.x,{columns:4,spacing:1,children:Array(i).fill(null).map(((t,e)=>(0,s.Y)(j.x.Item,{children:(0,s.Y)(dt.E,{width:st,height:st})},e)))})},ht=(t,e)=>{const i=Math.ceil(e/4),s=Math.ceil(t/4);return{borderStartStartRadius:1===t?"m":"s",borderStartEndRadius:4===t?"m":"s",borderEndStartRadius:t%4==1&&s===i?"m":"s",borderEndEndRadius:t%4==0&&t===e?"m":"s"}};var pt=i(953177);const ut=(0,o.P)((function(t){const{photos:e,loading:i,loaded:o,needCheckScroll:n,canSelect:a,estimatedCount:r,onLoadMore:d,scrollRef:c}=t,l=(0,F.B)();(0,at.M)(Boolean(n),(0,rt.n)(d,pt.HP),c);return o&&0===e.length?(0,s.Y)(U.O,{children:l.getLang("photos_no_photos_loaded")}):(0,s.FD)(G.i,{paddingBottom:0,paddingTop:0,children:[(0,s.Y)(G.i,{paddingBottom:0,paddingTop:0,children:o?(0,s.Y)(j.x,{columns:4,columnSpacing:4,rowSpacing:4,children:e.map(((t,i)=>(0,s.Y)(j.x.Item,{children:(0,s.Y)(nt,{photo:t,canSelect:a,borderRadius:ht(i+1,e.length)})},t.rawId)))}):(0,s.Y)(lt,{count:r})}),o&&i&&(0,s.Y)(G.i,{children:(0,s.Y)(W.y,{})}),(0,s.Y)(H.K,{size:24})]})}));var gt=i(685441),_t=i(589637),mt=i(225505);const vt=()=>(0,s.FD)(s.FK,{children:[(0,s.Y)(dt.E,{width:206,height:156}),(0,s.Y)(H.K,{size:6}),(0,s.Y)(dt.E,{width:144,height:12}),(0,s.Y)(H.K,{size:6}),(0,s.Y)(dt.E,{width:96,height:12})]}),yt=()=>(0,s.FD)(s.FK,{children:[(0,s.Y)(H.K,{size:4}),(0,s.Y)(j.x,{columns:"dynamic",rowSpacing:4,columnSpacing:12,children:(0,s.Y)(j.x.HorizontalScroll,{padding:24,children:Array(10).fill(null).map(((t,e)=>(0,s.Y)(j.x.Item,{children:(0,s.Y)(vt,{})},e)))})})]});var ft=i(246983),St=i(962644),wt=i(180329);const bt=()=>(0,s.Y)(St.h,{Component:wt.s,justify:"end",children:(0,s.Y)(G.i,{mode:"vertical",spacing:8,paddingTop:8,children:(0,s.Y)(ft.m,{})})});var Pt=i(7258);const At=(0,o.P)((function(){const t=(0,F.B)(),e=(()=>{const t=(0,F.B)();return e=>{const i=e.size;return 0===i?t.getLang("photo_album_empty_description"):t.numeric(i,t.getLang("photo_album_count",!0)).replace("{count}",(0,Pt.B)(i,{roundingMode:"floor"}))}})(),i=Y(),{albumsList:o}=i.photos;return o.isLoaded&&0===o.albums.length||!o.isLoaded&&!o.isLoading?null:(0,s.FD)(s.FK,{children:[(0,s.Y)(G.i,{paddingBottom:0,paddingTop:4,children:(0,s.Y)(gt.Y,{size:"small",children:t.getLang("photos_Albums")})}),(0,s.Y)(H.K,{size:1}),o.isLoaded?(0,s.Y)(j.x,{columns:"dynamic",rowSpacing:12,children:(0,s.Y)(j.x.HorizontalScroll,{padding:18,children:o.albums.map((t=>(0,s.Y)(j.x.Item,{children:(0,s.Y)(_t.N,{cover:t.data.sizes,mode:"outside",title:t.data.title,description:e(t.data),itemSize:"m",adultLocked:Boolean(t.data.restrictions?.blur),onClick:()=>i.showPhotosFromAlbums(t),"data-testid":"posting_photo_picker_top_albums_item",children:Boolean(t.data.is_locked)&&(0,s.Y)(bt,{})})},t.rawId)))})}):(0,s.Y)(yt,{}),(0,s.Y)(G.i,{paddingBottom:0,children:(0,s.Y)(mt.w,{})})]})})),kt=(0,o.P)((function({scrollRef:t}){const e=Y(),i=(0,F.B)(),{photosAllList:o}=e.photos,n=e.currentScreen===E&&!o.isLoading&&!o.isLoadedFully;return(0,s.FD)(s.FK,{children:[(0,s.Y)(At,{}),(0,s.Y)(G.i,{paddingBottom:8,paddingTop:0,children:(0,s.Y)(gt.Y,{size:"small",children:i.getLang("photos_picker_all_photos_title")})}),(0,s.Y)(ut,{photos:o.photos,loading:o.isLoading,loaded:o.isLoaded,needCheckScroll:n,canSelect:e.canSelectPhoto,onLoadMore:()=>o.fetchMore(),scrollRef:t})]})}));var Ct=i(799649),It=i(867696);const Et=(0,o.P)((function({scrollRef:t}){const e=Y(),i=(0,F.B)(),{photosFromAlbumList:o,openedAlbum:n}=e.photos;if(!o)return null;const a=e.currentScreen===T&&!o.isLoading&&!o.isLoadedFully,r=i.getLang("photos_picker_album_title").replace("{title}",n?.data.title??"");return(0,s.FD)(s.FK,{children:[(0,s.Y)(G.i,{paddingBottom:4,paddingTop:4,children:(0,s.FD)(wt.s,{direction:"row",justify:"space-between",children:[(0,s.Y)(gt.Y,{size:"small","data-testid":"posting_photo_picker_album_title",children:r}),o.photos.length>1&&(0,s.Y)(Ct.K,{onClick:e.changeSort,label:i.getLang("wall_posting_change_sort"),activeMode:"opacity",hoverMode:"opacity",hasActive:!1,children:(0,s.Y)(It.O,{className:(0,Q.I)("color_icon_accent")})})]})}),(0,s.Y)(ut,{photos:o.photos,loading:o.isLoading,loaded:o.isLoaded,needCheckScroll:a,canSelect:e.canSelectPhoto,estimatedCount:n?.data.size,onLoadMore:()=>o.fetchMore(),scrollRef:t})]})}));var Lt=i(37390),Tt=i(409698);const Mt=(0,o.P)((function(){const t=(0,F.B)(),e=Y(),i=t.numeric(e.selectedPhotoCount,t.getLang("photos_picker_selected_photos")).replace("{count}",String(e.selectedPhotoCount)).replace("{total}",String(e.limitPhotos));return(0,s.Y)(Lt.j,{before:(0,s.Y)("span",{"data-testid":"posting_photo_picker_counter",children:i}),actions:(0,s.FD)(s.FK,{children:[(0,s.Y)(Tt.$,{size:"m",mode:"secondary",appearance:"accent",onClick:()=>e.closePicker(),"data-testid":"posting_photo_picker_footer_cancel_button",children:t.getLang("global_cancel")}),(0,s.Y)(Tt.$,{size:"m",mode:"primary",appearance:"accent",onClick:()=>e.handlePickPhotos(),"data-testid":"posting_photo_picker_footer_submit_button",children:t.getLang("photos_picker_select_photos",!0)})]})})}));var Ot=i(120125),Dt=i(311029),xt=i(815287),Rt=i(948350),Yt=i(91720);const Ft=(0,o.P)((function(){const t=Y(),[e,i]=(0,xt.useState)(null);return(0,xt.useEffect)((()=>{e&&(e.scrollTop=0)}),[t.currentScreen]),(0,s.FD)(s.FK,{children:[(0,s.Y)(V,{currentSource:t.currentSource,withSourceSelector:t.withSourceSelector,onSourceSelectorToggle:t.handleSourceSelectorToggle,closeModal:t.closeModal,handleGoBack:t.handleGoBack,hasBackLabel:t.hasBackLabel}),(0,s.Y)(Ot._,{height:(0,Rt.d)({isDirty:t.isDirty,withSubtitle:t.withSourceSelector}),autoHideScrollbar:!0,getRef:i,children:(0,s.FD)(Dt.c,{insetLevel:0,tabIndex:0,children:[t.currentScreen===E&&(0,s.Y)(kt,{scrollRef:e}),t.currentScreen===T&&(0,s.Y)(Et,{scrollRef:e})]})}),t.isDirty&&(0,s.Y)(Mt,{})]})}));Ft.displayName="PhotoPicker";const Bt=(0,Yt.N)(R,Ft)},341250:(t,e,i)=>{i.d(e,{_9:()=>n,c0:()=>a,k4:()=>d,kA:()=>s,s$:()=>o,t0:()=>r});const s=62,o=636,n=514,a=16,r=48,d=56},948350:(t,e,i)=>{i.d(e,{d:()=>o});var s=i(341250);const o=t=>t?.isSmall?s._9-(t?.withSubtitle?s.c0:0)+(t?.withoutSearch?s.t0:0)-(t?.withSnippet?s.k4:0):s.s$-(t?.isDirty?s.kA:0)-(t?.withSubtitle?s.c0:0)-(t?.withSnippet?s.k4:0)},207037:(t,e,i)=>{i.d(e,{G:()=>Bt});var s=i(221020),o=i(423654),n=i(47417),a=i(120125),r=i(37390),d=i(409698),c=i(356035),l=i(946918),h=i(724075),p=i(888817),u=i(187233),g=i(475118),_=i(999051),m=i(31164),v=i(931198),y=i(938653),f=i(164780),S=i(649972);const w=t=>({...(0,f.tF)(t.data)??(0,S.F)(t.owner?.data)}),b=(0,c.P)((function({video:t,isVideoSelected:e,onSelect:i,selectButtonAriaLabel:o}){const n=e(t.rawId),a=t.data.restriction?{}:{selectMode:"card",onSelect:e=>i(t,e),selectButtonAriaLabel:o};return(0,s.Y)(g.x.Item,{children:(0,s.Y)(m.O,{video:{...(0,y.x0)(t.data),owner:w(t),href:void 0},noAvatar:!0,selected:n,onAuthorClick:e=>((t,e)=>{t.preventDefault(),e.owner&&window.open((0,v.D)(e.owner.data),"_blank")?.focus()})(e,t),...a})})})),P=(0,c.P)((function({videoPickerModel:t,scrollRef:e}){const i=(0,l.B)(),{isVideoSelected:o,pickVideo:n,isOwnLoading:a,ownVideos:r,fetchOwnNext:d,isOwnLoadedFully:c}=t;return(0,h.M)(Boolean(!a&&!c),(0,p.n)(d,100),e),(0,s.FD)(u.i,{children:[(0,s.Y)(u.i,{paddingTop:8,paddingBottom:8,children:(0,s.Y)(g.x,{columns:2,spacing:16,children:r.map((t=>(0,s.Y)(b,{video:t,onSelect:n,isVideoSelected:o,selectButtonAriaLabel:i.getLang("global_select")},t.rawId)))})}),a&&(0,s.Y)(u.i,{children:(0,s.Y)(_.y,{})})]})}));var A=i(405697),k=i(685441),C=i(46284),I=i(127594);const E=()=>(0,s.Y)(g.x,{columns:2,spacing:16,children:Array(6).fill(null).map(((t,e)=>(0,s.Y)(g.x.Item,{children:(0,s.Y)(I.x,{})},e)))});var L=i(685789),T=i(225505);const M=(0,c.P)((function(){const t=(0,l.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(L.Q,{aside:(0,s.Y)(C.E.Text,{height:13,lines:1,children:t.getLang("video_show_all")}),children:(0,s.Y)(k.Y,{mode:"tertiary",children:(0,s.Y)(C.E.Text,{height:14,lines:1,children:t.getLang("wall_posting_video_picker_search_own_videos_header")})})}),(0,s.Y)(g.x,{columns:2.1,spacing:16,children:(0,s.Y)(g.x.HorizontalScroll,{padding:12,children:Array(6).fill(null).map(((t,e)=>(0,s.Y)(g.x.Item,{children:(0,s.Y)(I.x,{})},e)))})}),(0,s.Y)(u.i,{paddingTop:12,paddingBottom:0,children:(0,s.Y)(T.w,{wide:!0})})]})})),O=(0,c.P)((function({videoPickerModel:t}){const{isVideoSelected:e,ownVideos:i,isOwnLoading:n,pickVideo:a,isOwnEmptyList:r,openVideoOwnSearch:d}=t,c=(0,l.B)();return r||n?null:(0,s.FD)(s.FK,{children:[(0,s.Y)(L.Q,{aside:(0,s.Y)(o.N,{onClick:d,"data-testid":"posting_video_picker_own_videos_show_all",children:c.getLang("audio_feed_show_all_block")}),children:(0,s.Y)(k.Y,{mode:"tertiary","data-testid":"posting_video_picker_owner_results",children:c.getLang("wall_posting_video_picker_search_own_videos_header")})}),(0,s.Y)(g.x,{columns:2.1,spacing:16,children:(0,s.Y)(g.x.HorizontalScroll,{padding:12,children:i.map((t=>(0,s.Y)(b,{video:t,onSelect:a,isVideoSelected:e,selectButtonAriaLabel:c.getLang("global_select")},t.rawId)))})}),(0,s.Y)(u.i,{paddingTop:12,paddingBottom:0,children:(0,s.Y)(T.w,{wide:!0})})]})}));var D=i(78021),x=i(772812),R=i(370633),Y=i(721990),F=i(600106);const B="video_picker_search_input",N=(0,c.P)((({videoSearchModel:t,fetching:e,getRootRef:i})=>{const o=(0,l.B)(),{search:n,fetchSuggestions:a,searchBySuggestion:r,onChangeSearch:d,onKeyDown:c,videoFiltersService:{hasAppliedFilters:h,onIconFilterClick:p}}=t,u=e?(0,s.Y)(_.y,{size:"small"}):(0,s.Y)(D.S,{"data-testid":"posting_video_picker_filter",className:h?(0,x.I)("color_icon_accent"):void 0});return(0,s.Y)(F.a,{zIndex:1e3,isFetching:e,withEmptyQuery:!0,withAutoComplete:!0,offsetByMainAxis:-2,fetchSuggestions:a,searchBySuggestion:r,autocompleteOffsetByCrossAxis:36,autocompleteOffsetByMainAxis:31.5,renderSearchInput:(t,a)=>(0,s.Y)(R.Y,{mode:"plain",getRootRef:i,separator:"hide",children:(0,s.Y)(Y.v,{...t,id:B,noPadding:!0,icon:n&&u,value:a||n,onChange:d,mode:"default",placeholder:o.getLang("video_search_videos"),iconLabel:o.getLang("search_catalog_filter_text"),onKeyDown:c,onIconClick:e?void 0:p,"data-testid":"posting_video_picker_search"})})},`${e}`)}));var z=i(815287),V=i(865940);var U=i(978325),G=i(638945),j=i(541687),W=i(704620),H=i(516427),$=i(981252),K=i(42107),q=i(331635),Q=i(327813),J=i(273193);class X{get sortOptions(){return[{value:"-1",label:this.langs.getLang("video_by_relevance")},{value:"0",label:this.langs.getLang("video_search_by_date")},{value:"1",label:this.langs.getLang("video_search_by_duration")}]}get lensOptions(){return[{value:"0",label:this.langs.getLang("video_search_any_duration")},{value:"2",label:this.langs.getLang("video_search_long")},{value:"1",label:this.langs.getLang("video_search_short")}]}get dateOptions(){return[{value:0,label:this.langs.getLang("video_search_any_time")},{value:86400,label:this.langs.getLang("video_search_last_24")},{value:604800,label:this.langs.getLang("video_search_last_week")},{value:2592e3,label:this.langs.getLang("video_search_last_month")},{value:31536e3,label:this.langs.getLang("video_search_last_year")}]}get filters(){return{date:this.props.current.filters.date??0,hd:Boolean(this.props.current.filters.hd??!1),live:Boolean(this.props.current.filters.live??!1),len:this.props.current.filters.len??"0",sort:this.props.current.filters.sort??"-1"}}constructor(t,e){this.props=t,this.langs=e,this.onChangeSort=t=>{const e=t.target.value;this.submit("sort","-1"===e?null:e)},this.onChangeLen=t=>{const e=t.target.value;this.submit("len","0"===e?null:e)},this.onChangeDate=t=>{const e=t.target.value;this.submit("date","0"===e?null:e)},this.onChangeHD=t=>{const e=t.target.checked;this.submit("hd",e?1:null)},this.onChangeLive=t=>{const e=t.target.checked;this.submit("live",e?1:null)},this.submit=(t,e)=>{this.props.current.onChange(t,e)},(0,Q.l_)(this)}}X=(0,q.Cg)([K.z8.transient(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[void 0===K.Ji?Object:K.Ji,void 0===J.Y?Object:J.Y])],X);const{Provider:Z,useModel:tt}=(0,K.Qd)(X,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0}),et=({top:t,...e})=>(0,s.Y)(U.e,{...e,top:(0,s.Y)(G.tW,{children:t})}),it=(0,c.P)((function(){const t=(0,l.B)(),{filters:e,lensOptions:i,onChangeLen:o,dateOptions:n,onChangeDate:a,sortOptions:r,onChangeSort:d,onChangeHD:c,onChangeLive:h}=tt();return(0,s.Y)(j.H,{children:(0,s.FD)(W.f,{spacing:2,children:[(0,s.Y)(et,{top:t.getLang("video_search_by_duration"),children:(0,s.Y)(H.l6P,{value:e.len,options:i,onChange:o,forceDropdownPortal:!1})}),(0,s.Y)(et,{top:t.getLang("video_search_by_date"),children:(0,s.Y)(H.l6P,{value:e.date,options:n,onChange:a,forceDropdownPortal:!1})}),(0,s.Y)(et,{top:t.getLang("video_search_order"),children:(0,s.Y)(H.l6P,{value:e.sort,options:r,onChange:d,forceDropdownPortal:!1})}),(0,s.Y)(u.i,{paddingTop:8,paddingBottom:0,children:(0,s.FD)(et,{noPadding:!0,children:[(0,s.Y)($.S,{checked:e.hd,onChange:c,children:t.getLang("video_hd_checkbox")}),(0,s.Y)($.S,{checked:e.live,onChange:h,children:t.getLang("video_filter_live")})]})})]})})})),st=(0,K.jn)(Z,it),ot=(0,c.P)((function({videoFiltersService:t,children:e}){const{filters:i,setFilter:o,shown:n,setShown:a}=t,r=(0,z.useRef)(null);((t,e,i=!0)=>{(0,z.useEffect)((()=>{if(!i)return;const s=i=>{!t.current||i.target instanceof Node&&t.current.contains(i.target)||e(i)};return document.addEventListener("mousedown",s,{passive:!0}),document.addEventListener("touchstart",s,{passive:!0}),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}}),[t,e,i])})(r,(()=>a(!1)),n);return(0,s.Y)(V.v,{width:240,shown:n,trigger:"manual",getRootRef:r,autoFocus:!1,offsetByMainAxis:6,restoreFocus:!1,placement:"bottom-end",content:(0,s.Y)(st,{filters:i,onChange:(t,e)=>{o(t,e)}}),children:e})})),nt=(0,c.P)((function({videoPickerModel:t,scrollRef:e}){const i=(0,l.B)(),{isVideoSelected:o,videos:n,isLoaded:a,isLoading:r,isLoadedFully:d,pickVideo:c,isEmptyList:m,fetchNext:v,searchQuery:y,currentSource:f,videoSearchModel:S}=t;return(0,h.M)(Boolean(!r&&!d),(0,p.n)(v,100),e),(0,s.FD)(u.i,{children:[(0,s.Y)(u.i,{paddingTop:0,paddingBottom:0,children:(0,s.Y)(ot,{videoFiltersService:S.videoFiltersService,children:(0,s.Y)(N,{videoSearchModel:S,fetching:r})},f)}),m?(0,s.Y)(A.O,{stretched:!0,noPadding:!0,children:y?i.getLang("wall_posting_video_picker_no_video_found_placeholder").replace("{query}",y):i.getLang("video_no_uploaded_videos_title_yet")}):(0,s.Y)(s.FK,{children:a?(0,s.FD)(s.FK,{children:[Boolean(y&&!m)&&(0,s.FD)(s.FK,{children:[(0,s.Y)(O,{videoPickerModel:t}),(0,s.Y)(k.Y,{mode:"tertiary","data-testid":"posting_video_picker_global_results",children:i.getLang("wall_posting_video_picker_search_videos_header")})]}),(0,s.Y)(u.i,{paddingTop:8,paddingBottom:8,children:(0,s.Y)(g.x,{columns:2,spacing:16,children:n.map((t=>(0,s.Y)(b,{video:t,onSelect:c,isVideoSelected:o,selectButtonAriaLabel:i.getLang("global_select")},t.rawId)))})})]}):(0,s.FD)(s.FK,{children:[Boolean(y)&&(0,s.FD)(s.FK,{children:[(0,s.Y)(M,{}),(0,s.Y)(k.Y,{mode:"tertiary",children:(0,s.Y)(C.E.Text,{height:13,lines:1,width:80,children:i.getLang("wall_posting_video_picker_search_videos_header")})})]}),(0,s.Y)(u.i,{paddingTop:8,paddingBottom:8,children:(0,s.Y)(E,{})})]})}),a&&r&&(0,s.Y)(u.i,{children:(0,s.Y)(_.y,{})})]})}));var at=i(144942),rt=i(848549),dt=i(668650),ct=i(617989);class lt{get totalCount(){return this._totalCount}get isLoaded(){return Boolean(this.prevRequestParams)}get count(){return this.ids.length}get items(){const t=[];for(const e of this.ids){const i=this.videoProvider.getVideo(e);i&&t.push(i)}return t}constructor(t,e){this.videoProvider=t,this.videoApi=e,this.ids=[],this.abortController=null,this.prevRequestParams=null,this._totalCount=0,this.initialLoad=!1,this.isLoading=!1,this.isLoadedFully=!1,this.reset=()=>{this.abortController?.abort(),this.resetState()},this.resetState=()=>{this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null,this.prevRequestParams=null},this.request=async(t,e)=>{let i;i=t.q?await this.videoApi.search({...t,q:String(t.q)},{signal:e.signal}):await this.videoApi.get({...t,album_id:-1},{signal:e.signal});const s=[];return i.items?.forEach((t=>{const e=this.videoProvider.createVideoFromApi(t);e&&s.push(e)})),{items:s,count:i.count}},this.fetch=async t=>{this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const e=await this.request(t,this.abortController);this.handleResponse(e,t)},this.fetchNext=async()=>{if(!this.prevRequestParams||this.isLoading||this.isLoadedFully)return;this.isLoading=!0,this.abortController=new AbortController;const{count:t=0,offset:e=0}=this.prevRequestParams??{},i=e+t,s={...this.prevRequestParams,offset:i},o=await this.request(s,this.abortController);this.handleResponse(o,s)},this.handleResponse=(t,e)=>{const{count:i=0,offset:s=0}=e,o=t.items.map((t=>t.rawId));this._totalCount=t.count,this.isLoadedFully=t.count<=s+i,this.ids=s?[...this.ids,...o]:o,this.prevRequestParams=e,this.isLoading=!1,this.abortController=null},(0,Q.l_)(this)}}var ht=i(197834),pt=i(817076),ut=i(104416),gt=i(4176),_t=i(687089);class mt{getVideo(t){return this.data.videosMap.get(t)}createVideoFromApi(t){if(!(0,ht.m)(t))return;const e=new at.C(t,this.favoriteService,this.likesService,this.ownerStoreFactory.ensureByFields([]),this.videoDeletingService);return this.data.videosMap.set(e.rawId,e),e}constructor(t,e,i,s){this.ownerStoreFactory=t,this.likesService=e,this.favoriteService=i,this.videoDeletingService=s,this.data={videosMap:new Map},(0,Q.l_)(this)}}mt=(0,q.Cg)([K.z8.container(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[void 0===pt.c?Object:pt.c,void 0===ut.R?Object:ut.R,void 0===gt.J?Object:gt.J,void 0===_t.n?Object:_t.n])],mt);class vt{createSearchList(){return new lt(this.videoProvider,this.videoApi)}constructor(t,e){this.videoProvider=t,this.videoApi=e,(0,Q.l_)(this)}}vt=(0,q.Cg)([K.z8.container(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[void 0===mt?Object:mt,void 0===ct.C?Object:ct.C])],vt);var yt=i(486526),ft=i(376572),St=i(925331),wt=i(294590);const bt=["-1","0","1","2"],Pt=["0","1","2"];var At=i(928959);class kt{setCallbacks(t){this.callbacks=Object.assign(this.callbacks??{},t)}get shown(){return this._shown}get filters(){return this._filters}get hasAppliedFilters(){return Object.values(this._filters).filter((t=>void 0!==t)).length>0}get apiFilters(){const{len:t,date:e,sort:i,hd:s,live:o}=this._filters,n={sort:i?Number(i):void 0,date:e,hd:s?1:void 0,live:o?1:void 0};if(t){const e="1"===t?"shorter":"longer";n[e]="shorter"===e?300:1200}return Object.keys(n).forEach((t=>{void 0===n[t]&&delete n[t]})),n}constructor(){this._filters={},this._shown=!1,this.setShown=t=>{this._shown=t},this.toggleShown=()=>{this._shown=!this._shown},this.onIconFilterClick=t=>{(0,At.T)(t),this.toggleShown(),document.activeElement?.id===B&&document.activeElement.blur()},this.setFilter=(t,e)=>{const i=String(e);switch(t){case"len":this._filters.len=(t=>Pt.includes(t))(i)?i:void 0;break;case"sort":this._filters.sort=(t=>bt.includes(t))(i)?i:void 0;break;case"date":this._filters.date=(0,wt.k)(i)?Number(i):void 0;break;case"hd":this._filters.hd="1"===i||void 0;break;case"live":this._filters.live="1"===i||void 0}this.callbacks.onFiltersUpdate(this.apiFilters)},this.resetFilters=()=>{this.setShown(!1),this._filters={},this.callbacks.onFiltersUpdate(this.apiFilters)},(0,Q.l_)(this)}}kt=(0,q.Cg)([K.z8.transient(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[])],kt);var Ct=i(46996);class It{setCallbacks(t){this.callbacks=Object.assign(this.callbacks??{},t)}get search(){return this._search}[K.zr](){this.resetSearch()}constructor(t,e){this.videoFiltersService=t,this.searchSuggesterCatalogProvider=e,this._search="",this.prevFilters={},this.prevSearch="",this.callbacks=void 0,this.onChangeSearch=t=>{this._search=t.target.value,t.target.value||this.resetSearch()},this.resetSearch=()=>{this._search="",this.videoFiltersService.resetFilters()},this.onSearchVideo=()=>{const t=this.videoFiltersService.hasAppliedFilters?this.videoFiltersService.apiFilters:{};this._search===this.prevSearch&&(0,Ct.A)(this.prevFilters,t)||(this.callbacks?.onSearch({...t,q:this._search}),this.prevSearch=this._search,this.prevFilters=t)},this.onSearch=t=>{this._search=t,this.onSearchVideo()},this.onKeyDown=t=>{"Enter"===t.key&&this.onSearchVideo()},this.fetchSuggestions=async({query:t,reason:e},i)=>{const s={q:t,show_suggests:1,input_method:"focus"===e?"query_view_click":void 0};return t?await this.searchSuggesterCatalogProvider.fetchSearchVideoCatalog(s,i):await this.searchSuggesterCatalogProvider.fetchSearchVideoWeb2Catalog(s,i)},this.searchBySuggestion=t=>{this.onSearch(t.query)},(0,Q.l_)(this),this.videoFiltersService.setCallbacks({onFiltersUpdate:()=>this.onSearchVideo()})}}It=(0,q.Cg)([K.z8.transient(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[void 0===kt?Object:kt,void 0===St.I?Object:St.I])],It);var Et=i(916533);const Lt="base",Tt="own_search";var Mt=function(t){return t.CurrentOwner="currentOwner",t.User="user",t}({});class Ot{[K.Ts](){this.videoSearchModel.setCallbacks({onSearch:this.searchVideo}),this.fetch(),this.props.current.selectedVideos.length&&(this.props.current.selectedVideos.forEach((t=>{const{owner_id:e,id:i}=t;this.selectedVideosMap.set(at.C.createRawId({id:i,ownerId:e}),t)})),this.wasSelectedVideos=!0)}[K.yo](){this.props.current.needUpdates&&(this.selectedVideosMap.clear(),this.props.current.selectedVideos.forEach((t=>{const{owner_id:e,id:i}=t;this.selectedVideosMap.set(at.C.createRawId({id:i,ownerId:e}),t)})))}get screen(){const t=this.screenHistory.at(-1);return t||Lt}get sourceId(){return this._currentSource===Mt.User?this.props.current.currentUserId:this.ownerId}get hasAppliedFilters(){return Object.values(this.filters).filter((t=>void 0!==t)).length>0}get withSourceSelector(){const{isAdmin:t,sourceSelectorEnabled:e}=this.props.current;return e&&t}get currentVideoList(){return this.searchQuery?this.videosSearchList:this.videosList}get currentSource(){return this._currentSource}setCurrentSource(t){this.resetQuery(),this.videoSearchModel.resetSearch(),this._currentSource=t,this.currentVideoList.isLoading||this.currentVideoList.count||this.currentVideoList.fetch({owner_id:this.sourceId,count:20})}get videos(){return this.currentVideoList.items}get ownVideos(){return this.videosOwnSearchList.items}resetQuery(){this.searchQuery="",this.filters={},this.currentVideoList.reset()}get isLoading(){return this.currentVideoList.isLoading}get isOwnLoading(){return this.videosOwnSearchList.isLoading}get videosLimit(){return this.props.current.videosLimit}get isLoadedFully(){return this.currentVideoList.isLoadedFully}get isOwnLoadedFully(){return this.videosOwnSearchList.isLoadedFully}get totalCount(){return this.currentVideoList.totalCount}get isLoaded(){return this.currentVideoList.isLoaded}get isOwnLoaded(){return this.videosOwnSearchList.isLoaded}get isEmptyList(){return this.isLoaded&&!this.isLoading&&!this.currentVideoList.count}get isOwnEmptyList(){return this.isOwnLoaded&&!this.isOwnLoading&&!this.videosOwnSearchList.count}get canPickVideo(){return this.selectedVideosMap.size<this.videosLimit}get hasFooter(){return Boolean(this.selectedVideosMap.size>0||this.wasSelectedVideos)}get selectedVideosCount(){return this.selectedVideosMap.size}get attachemntTypes(){return{video:this.selectedVideosCount}}get isEmptyVideos(){return!this.isLoading&&!this.videos.length}get hasBackLabel(){return Boolean(this.screen!==Lt||this.props.current.onGoBack)}[K.zr](){this.dispose()}constructor(t,e,i,s,o){this.props=t,this.VideoPickerVideoListsProvider=e,this.videoSearchModel=i,this.authService=s,this.langs=o,this.screenHistory=[],this.wasSelectedVideos=!1,this.selectedVideosMap=new Map,this._currentSource=Mt.CurrentOwner,this.searchQuery=void 0,this.filters={},this.changeScreen=t=>{this.screenHistory.push(t)},this.handleSourceSelectorToggle=()=>{this.setCurrentSource(this.currentSource===Mt.User?Mt.CurrentOwner:Mt.User)},this.fetch=async()=>{try{0===this.currentVideoList.count&&await this.currentVideoList.fetch({owner_id:this.sourceId,count:20}),this.props.current.timelineLogger?.logPickerReady?.()}catch(t){if(!(0,ft.T)(t)||(0,rt.z)(t))return;this.handleShowError(),this.props.current.timelineLogger?.logError?.(),this.handleGoBack()}},this.fetchNext=async()=>{try{await this.currentVideoList.fetchNext()}catch(t){if(!(0,ft.T)(t)||(0,rt.z)(t))return;this.handleShowError()}},this.fetchOwnNext=async()=>{try{await this.videosOwnSearchList.fetchNext()}catch(t){if(!(0,ft.T)(t)||(0,rt.z)(t))return;this.handleShowError()}},this._searchVideo=async()=>{if(this.searchQuery||this.currentVideoList.count)try{const t=this.sourceId===this.authService.userId,e={q:this.searchQuery,...this.filters,count:20},i=[this.currentVideoList.fetch(e),this.videosOwnSearchList.fetch({...e,owner_id:this.sourceId,search_own:(0,dt.I)(t)})];await Promise.allSettled(i)}catch(t){if(!(0,ft.T)(t)||(0,rt.z)(t))return;this.handleShowError()}else this.currentVideoList.fetch({owner_id:this.sourceId,count:20})},this.searchVideoDebounced=(0,yt.s)(this._searchVideo,500),this.searchVideo=({q:t,shorter:e,longer:i,date:s,sort:o,hd:n,live:a})=>{this.resetQuery(),t&&(this.searchQuery=t,this.filters={shorter:e,longer:i,date:s,hd:n,live:a},o&&(this.filters.sort=o)),this.currentVideoList.reset(),this.currentVideoList.isLoading=!0,this.searchVideoDebounced()},this.pickVideo=(t,e)=>{if(this.selectedVideosMap.has(t.rawId)){if(!1===this.props.current.canRemoveAttachmentWithFeedback?.({event:e,type:"video",replaceTypes:this.attachemntTypes,itemId:t.data.id,ownerId:t.data.owner_id}))return;this.selectedVideosMap.delete(t.rawId)}else{if(!this.canPickVideo)return void this.handleLimitExceededError();if(!1===this.props.current.canAddAttachmentWithFeedback?.({event:e,type:"video",replaceTypes:this.attachemntTypes}))return;this.selectedVideosMap.set(t.rawId,t.data)}this.props.current.onPickVideo?.(t.data,e)},this.isVideoSelected=t=>this.selectedVideosMap.has(t),this.handleGoBack=()=>{this.screen===Lt&&(this.props.current.onGoBack?this.props.current.onGoBack():this.closeModal()),this.screenHistory.pop()},this.closeModal=()=>{this.props.current.closeModal?.()},this.handleCancel=()=>{this.props.current.onGoBack?this.props.current.onGoBack():this.closeModal()},this.handlePickVideos=()=>{this.props.current.timelineLogger?.logStartAttaching?.(),this.props.current.onVideoSelect?.(Array.from(this.selectedVideosMap.values()))},this.handleLimitExceededError=()=>{this.props.current.onError(this.langs.getLang("wall_posting_attachment_limit_exceeded_text"),this.langs.numeric(this.props.current.totalLimit??this.props.current.videosLimit,this.langs.getLang("wall_attachments_limit_exceeded_subtitle",!0)))},this.dispose=()=>{this.selectedVideosMap.clear(),this.wasSelectedVideos=!1},this.handleShowError=()=>{this.props.current.onError(this.langs.getLang("wall_posting_network_general_error_text"),this.langs.getLang("wall_posting_network_general_error_subtitle"))},this.openVideoOwnSearch=()=>{this.changeScreen(Tt)},(0,Q.l_)(this),this.ownerId=Number(t.current.ownerId),this.videosList=this.VideoPickerVideoListsProvider.createSearchList(),this.videosSearchList=this.VideoPickerVideoListsProvider.createSearchList(),this.videosOwnSearchList=this.VideoPickerVideoListsProvider.createSearchList(),this._currentSource=this.props.current.isAdmin?Mt.CurrentOwner:Mt.User}}Ot=(0,q.Cg)([K.z8.transient(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[void 0===K.Ji?Object:K.Ji,void 0===vt?Object:vt,void 0===It?Object:It,void 0===Et.u?Object:Et.u,void 0===J.Y?Object:J.Y])],Ot);const{Provider:Dt,useModel:xt}=(0,K.Qd)(Ot,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var Rt=i(948350),Yt=i(91720);const Ft=(0,c.P)((function(){const t=xt(),e=(0,l.B)(),[i,c]=(0,z.useState)(null),h=t.screen===Tt,p=t.withSourceSelector?(0,s.Y)(o.N,{onClick:t.handleSourceSelectorToggle,noUnderline:h,mode:h?"secondary":"default",disabled:h,"data-testid":"posting_video_picker_switch_owner",children:t.currentSource===Mt.CurrentOwner?e.getLang("video_picker_select_user_videos"):e.getLang("video_picker_select_group_videos")}):void 0;return(0,s.FD)(s.FK,{children:[(0,s.Y)(n.r,{onBack:t.handleGoBack,backLabel:t.hasBackLabel?e.getLang("global_back"):void 0,onClose:t.closeModal,closeAriaLabel:e.getLang("global_close"),"data-testid":"posting_video_picker_back",subtitle:p,centered:!0,id:"video_picker_header",children:e.getLang("video_picker_title")}),(0,s.FD)(a._,{height:(0,Rt.d)({isDirty:t.hasFooter,withSubtitle:t.withSourceSelector}),autoHideScrollbar:!0,getRef:c,children:[t.screen===Lt&&(0,s.Y)(nt,{videoPickerModel:t,scrollRef:i}),h&&(0,s.Y)(P,{videoPickerModel:t,scrollRef:i})]}),t.hasFooter&&(0,s.Y)(r.j,{before:(0,s.Y)("span",{"data-testid":"posting_video_picker_counter",children:e.getLang("video_picker_selected_videos").replace("{count}",String(t.selectedVideosCount)).replace("{total}",String(t.videosLimit))}),actions:(0,s.FD)(s.FK,{children:[(0,s.Y)(d.$,{size:"m",mode:"secondary",appearance:"accent",onClick:t.handleCancel,"data-testid":"posting_video_picker_cancel",children:e.getLang("global_cancel")}),(0,s.Y)(d.$,{size:"m",mode:"primary",appearance:"accent",onClick:t.handlePickVideos,"data-testid":"posting_video_picker_submit",children:e.getLang("video_picker_submit")})]})})]})}));Ft.displayName="VideoPicker";const Bt=(0,Yt.N)(Dt,Ft)},783661:(t,e,i)=>{i.d(e,{s:()=>Hc});var s=i(221020),o=i(516427),n=i(42107),a=i(356035),r=i(46644),d=i(815287),c=i(331635),l=i(327813),h=i(830443),p=i(879093),u=i(668650),g=i(407072),_=i(848549),m=i(527992),v=i(433674),y=i(762044),f=i(106407),S=i(642052),w=i(725308);const b=t=>{let e;switch(t.type){case"profile":e=t.profile?.id;break;case"group":e=t.group?.id&&w.z.convertGroupIdToOwnerId(t.group?.id)}if(void 0===e)throw new Error("id is undefined");return e};class P{addItems(t){t.forEach((t=>{this.items[String(b(t))]=t}))}getCoOwner(t){return this.items[String(t)]}getCoOwners(t){return t.reduce(((t,e)=>{const i=this.getCoOwner(e);return i&&t.push({id:e,item:i}),t}),[])}constructor(){this.items={},(0,l.l_)(this)}}P=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[])],P);var A=i(998286);const k=({domain:t})=>t;class C{isFetching(t){return this.data.PostingDraftsCountPromisesMapByDomain.has(k(t))}getPostingDraftsCount(t){return this.data.PostingDraftsCountMapByDomain.get(k(t))}async ensureFetchPostingDraftsCount(t){const e=this.getPostingDraftsCount(t);return void 0!==e?e:this.fetchPostingDraftsCount(t)}async fetchPostingDraftsCount(t){const e=k(t),i=this.data.PostingDraftsCountMapByDomain.get(e),s=await this.getFetchPostingDraftsCountPromise(t);return(0,l.h5)((()=>{const t=this.data.PostingDraftsCountMapByDomain.get(e);t!==i&&void 0!==t||this.data.PostingDraftsCountMapByDomain.set(e,s)})),this.data.PostingDraftsCountMapByDomain.get(e)??s}increment(t,e=1){return this.adjust(t,Math.abs(e))}decrement(t,e=1){return this.adjust(t,-Math.abs(e))}adjust(t,e){const i=k(t),s=this.data.PostingDraftsCountMapByDomain.get(i)??0,o=Math.max(0,s+e);return this.data.PostingDraftsCountMapByDomain.set(i,o),o}set(t,e){const i=k(t),s=Math.max(0,Math.trunc(e));return this.data.PostingDraftsCountMapByDomain.set(i,s),s}invalidate(t){const e=k(t);this.data.PostingDraftsCountMapByDomain.delete(e),this.data.PostingDraftsCountPromisesMapByDomain.delete(e)}getFetchPostingDraftsCountPromise(t){const e=k(t),i=this.data.PostingDraftsCountPromisesMapByDomain.get(e);if(i)return i;const s=new Promise((async(i,s)=>{try{i((await this.wallApi.get({filter:"drafts",domain:t.domain,count:1})).count)}catch(t){s(t)}finally{(0,l.h5)((()=>{this.data.PostingDraftsCountPromisesMapByDomain.delete(e)}))}}));return this.data.PostingDraftsCountPromisesMapByDomain.set(e,s),s}constructor(t){this.wallApi=t,this.data={PostingDraftsCountMapByDomain:new Map,PostingDraftsCountPromisesMapByDomain:new Map},(0,l.l_)(this)}}C=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===A.t?Object:A.t])],C);var I=i(951767),E=i(978178),L=i(97348);var T=i(69789),M=i(645964);const O=t=>{const e=[];return t.list?.forEach((t=>{"pending"!==t.status&&"approved"!==t.status||e.push(t.owner_id)})),e},D=t=>"first_name"in t?(0,M.Cg)(t):"name"in t?t.name:"";var x=i(234824),R=i(844257),Y=i(684574),F=i(144819),B=i(250096),N=i(144942),z=i(46996),V=i(445426);const U=(t,e)=>`${t}${e}`;var G=i(736819);function j(t){if(t)switch(t.type){case"donut_goal":return`donut_goal${t.donut_goal?.goal_id}`;case"donut_level":return t.donut_level?`donut_level${t.donut_level.level_id}`:"donut_level";default:return t.type}}const W=({rememberedActionButton:t,apiActionButton:e})=>!!t&&(t.type===e.type&&Object.entries(t).every((([t,i])=>(0,G.n)(i,e[t]))));const H="default",$="best_friends",K="friends",q="donut",Q="donut_level";var J=i(946333),X=i(161933),Z=i(756452),tt=i(648992);const et=t=>Boolean(t.type.match("image.*")),it=async({temporaryId:t,ownerId:e,file:i})=>{const s=await(async t=>{try{if((0,Z.E)(t))return null;if(et(t)){const e=await(0,tt.y)(URL.createObjectURL(t));return{url:e.src,width:e.width,height:e.height}}{const e=await(0,X.mc)(URL.createObjectURL(t)),[i]=await(0,X.kT)(e,[0]);return{url:i.src,width:i.width,height:i.height}}}catch(t){return null}})(i);return et(i)?{type:"photo",photo:{id:t,owner_id:e,sizes:s?[{...s,type:"base"}]:[],album_id:T.YP,orig_photo:s,date:0,has_tags:!1}}:{type:"video",video:{id:t,owner_id:e,image:s?[s]:[],width:s?.width,height:s?.height}}},st=t=>"photo"===t||"video"===t||"clip"===t,ot=t=>st(t.type);var nt=i(711672),at=i(336888);const rt="/away.php?to=",dt=t=>t.startsWith("http://")||t.startsWith("https://")?t:`https://${t}`,ct=(t,e=!1)=>{const i=t.replace(at.i,"$1"),s=(0,nt.r)(i,{isAliasedUrlEnabled:!0}).filter((t=>"AliasedUrl"===t.kind));let o=i;return s.forEach((t=>{if(e)o=o.replaceAll(t.originalUrl,decodeURIComponent(t.originalHref));else{let{href:e}=t;e.startsWith(rt)&&(e=decodeURIComponent(e.replace(rt,""))),o=o.replaceAll(t.originalUrl,e)}})),o},lt=(t,e)=>{const{attachments:i}=t,s=Boolean(i?.find((t=>ot(t)))),o=[],n=[];if(!i)return{primaryAttachments:o,secondaryAttachments:n};const a=i.filter((t=>"audio"===t.type)).length>1;return i.forEach((t=>{const i=((t,e)=>{switch(t.type){case"poll":return`poll${t.poll?.owner_id}_${t.poll?.id}`;case"video":return`video${t.video?.owner_id}_${t.video?.id}`;case"clip":return`video${t.clip?.owner_id}_${t.clip?.id}`;case"photo":return`photo${(0,F.yP)({ownerId:t.photo?.owner_id??0,id:t.photo?.id??0,accessKey:t.photo?.access_key})}`;case"doc":return`doc${t.doc?.owner_id}_${t.doc?.id}`;case"audio":const i=`audio${(0,F.yP)({ownerId:t.audio?.owner_id??0,id:t.audio?.id??0,accessKey:t.audio?.access_key})}`;return e?`${i}?snippet=1`:i;case"audio_playlist":return`audio_playlist${t.audio_playlist?.owner_id}_${t.audio_playlist?.id}`;case"link":return dt(String(t.link?.url));case"article":return`article${t.article?.owner_id}_${t.article?.id}`;case"situational_theme":return`situational_theme${t.situational_theme?.id}`;case"podcast":return`podcast${t.podcast?.owner_id}_${t.podcast?.id}`;default:return null}})(t,!a&&e);i&&(!s||"link"!==t.type&&"article"!==t.type)&&(ot(t)?o.push(i):n.push(i))})),{primaryAttachments:o,secondaryAttachments:n}};var ht=i(819048),pt=i(328911);const ut=t=>{const e=t[t.type],i=e&&"id"in e&&e.id?Number(e.id):0,s=e&&"owner_id"in e&&e.owner_id?e.owner_id:0;return U(t.type,(0,pt.o)({ownerId:s,itemId:i}))},gt={inner_type:"wall_wallpost",attachments:[],text:"",_attachments_list:[],_commentsEnabled:!0,_notificationsEnabled:!0,_attachmentsViewKey:T.aR.key,_photoAttachmentsCrop:{},_signed:void 0,_coOwnersIds:[]};var _t=function(t){return t.Public="public",t.FriendsOnly="friends_only",t.BestFriendsOnly="best_friends_only",t}({});class mt{setPost(t){this.post=t}resetPost(){this.post=gt}get postData(){return this.post}get postTextLimit(){const t=this.config.getPostLimit?.()??1/0,e=this.text.length;return{counterIsShown:t-e<=50,limitExceeded:t<e,counter:`${e}/${t}`}}get attachmentsTypes(){const t=this.post.attachments.reduce(((t,e)=>(t[e.type]||(t[e.type]=0),t[e.type]++,t)),{});return this.post.text&&(t.text=this.post.text.length),t}get isPostponed(){return Boolean("postpone"===this.post.post_type||this.post.date&&this.post.date>(0,R.Z)())}get isPostponedPostDate(){return Boolean(this.post.date&&this.post.date>(0,R.Z)())}get isSuggested(){return"suggest"===this.post.post_type}get publishDate(){return this.post.date?new Date(1e3*this.post.date):void 0}get text(){return this.post.text??""}setPrivacyBestFriends(){this.post.best_friends_only=1,this.post.friends_only=void 0,this.clearCoOwners(),this.config.onChangePrivacy?.("best_friends_only")}setPrivacyFriends(){this.post.friends_only=1,this.post.best_friends_only=void 0,this.clearCoOwners(),this.config.onChangePrivacy?.("friends_only")}setPrivacyDonut(t){this.post.donut?this.post.donut.is_donut=!0:this.post.donut={is_donut:!0},this.post.donut.donut_level_id=t||void 0,this.clearCoOwners(),this.config.onChangeDonutPrivacy?.(t)}setPrivacyAll(){this.post.friends_only=void 0,this.post.best_friends_only=void 0,this.post.donut&&(this.post.donut.is_donut=!1,this.post.donut.donut_paid_until=void 0,this.config.onChangeDonutPrivacy?.()),this.config.onChangePrivacy?.("public")}get donutTeaserText(){return this.post.donut?.donut_teaser_text}get ordData(){return this.post._ordData||null}get markedAsAds(){return Boolean(this.ordData?.is_ad||this.postData.marked_as_ads)}get poll(){return this.post.attachments?.find((t=>"poll"===t.type))?.poll}editPoll(t){if(this.post.attachments)for(let e=0,i=this.post.attachments.length;e<i;++e)if("poll"===this.post.attachments[e].type){this.post.attachments[e].poll=t;break}}get attachmentsAspect(){if(!this.hasMediaAttachments||this.attachmentsView.key!==T.Q1.CAROUSEL)return;const t=this.attachments[0]?.video||this.attachments[0]?.clip;if(this.hasOnlyVideoAttachments&&t){const e=(0,ht.Vb)(t),i=(0,J.rc)(e);return{...T.a9[T.rk.ORIGINAL],gapOffset:i.gapOffset,ratio:e}}if(this.photos?.[0]){const t=this.post.attachments_meta?.carousel_ratio??(0,J.yB)(this.photos[0]);if(t){const e=(0,J.u$)(t);if(e)return e;const i=(0,J.rc)(t);return this.config.isPhotoAutoCropEnabled||this.hasSingleMediaAttachment?{...T.a9[T.rk.ORIGINAL],gapOffset:i.gapOffset,ratio:t}:i}}}get attachmentsView(){return this.post._attachmentsViewKey&&this.hasMediaAttachments?T.fY[this.post._attachmentsViewKey]:T.aR}get isGridAttachmentView(){return this.attachmentsView.key===T.Q1.GRID}get isCarouselAttachmentView(){return this.attachmentsView.key===T.Q1.CAROUSEL}get photoAttachmentsCrop(){return this.isCarouselAttachmentView?this.post._photoAttachmentsCrop||{}:void 0}addAttachment(t){(0,V.zQ)(this.post.attachments,t)}sortAttachments(t,e){const i=this.attachments.length,s=t>=0?t:i+t,o=e>=0?e:i+e;if(s===o||!this.attachments[s]||!this.attachments[o])return;const n=(0,V.AJ)(this.attachments[s]),a=(0,V.AJ)(this.attachments[o]),r=this.post.attachments?.findIndex((0,V.tx)(n.type,n.itemId,n.ownerId)),d=this.post.attachments?.findIndex((0,V.tx)(a.type,a.itemId,a.ownerId));r>=0&&d>=0&&this.post.attachments.splice(d,0,...this.post.attachments.splice(r,1))}get attachments(){return this.post.attachments?.filter((t=>ot(t)))||[]}get photos(){return this.post.attachments?.filter((t=>"photo"===t.type)).map((t=>t.photo))}get photosFromCustomAlbums(){return this.post.attachments?.filter((t=>"photo"===t.type&&(0,J.XI)(t.photo))).map((t=>t.photo))}get videos(){return this.post.attachments?.filter((t=>"video"===t.type)).map((t=>t.video))}get videosFromPicker(){return this.post.attachments?.filter((t=>"video"===t.type&&(0,ht.mn)(t.video))).map((t=>t.video))}get mediaAttachments(){return this.post.attachments?.filter((t=>ot(t))).map((t=>{if("video"===t.type||"clip"===t.type){const e=t.video??t.clip,{id:i,owner_id:s}=e;return{type:"video",rawId:U("video",(0,F.WO)({ownerId:s,id:i})),data:e}}{const e=t.photo,{id:i,owner_id:s}=e;return{type:"photo",rawId:U("photo",(0,F.WO)({ownerId:s,id:i})),data:e}}}))}get currentActionButtonType(){const t=this.post.attachments?.find((t=>"action_button"===t.type))?.action_button;if(t)return j(t);const e=this.post._attachments_list?.find((t=>"action_button"===t.type))?.action_button;return e?j(e):void 0}get selectedActionButton(){const t=this.post.attachments?.find((t=>"action_button"===t.type))?.action_button;if(t)return t;const e=this.post._attachments_list?.find((t=>"action_button"===t.type))?.action_button;return e||void 0}get doc(){return this.post.attachments?.find((t=>"doc"===t.type))?.doc}get docGifPreviewSize(){const t=this.doc?.preview?.photo?.sizes;if(t)return t[t.length-1]}get isDocValidMediaAttach(){const t=this.doc,e=this.docGifPreviewSize;if(!t||"gif"!==t.ext||this.mediaAttachments?.length||!e)return!1;const{height:i,width:s}=e;if(!i||!s)return!1;const o=s/i;return o>=.75&&o<=1.7}get geo(){return this.post.attachments?.find((t=>"geo"===t.type))?.geo}get link(){return this.post.attachments?.find((t=>"link"===t.type&&t.link?.photo?.sizes?.length))?.link}get article(){return this.post.attachments?.find((t=>"article"===t.type&&t.article?.photo?.sizes?.length))?.article}get commentsEnabled(){return Boolean(this.post._commentsEnabled)}setCommentsEnabled(t){this.post._commentsEnabled=t,this.config.onChangeComments?.(t)}get isActionButtonRemembered(){return Boolean(this.post._isActionButtonRemembered)}setIsActionButtonRemembered(t){this.post._isActionButtonRemembered=t}get notificationsEnabled(){return Boolean(this.post._notificationsEnabled)}setNotificationsEnabled(t){this.post._notificationsEnabled=t,this.config.onChangeNotifications?.(t)}get audios(){return this.post.attachments?.filter((t=>"audio"===t.type&&t.audio))?.map((t=>t.audio))}get audioPlaylist(){return this.post.attachments?.find((t=>"audio_playlist"===t.type))?.audio_playlist}get podcastEpisode(){return this.post.attachments?.find((t=>"podcast"===t.type))?.podcast}get signed(){return this.post._signed}get coOwnersIds(){return this.post._coOwnersIds||[]}setCoOwners(t){this.post._coOwnersIds=t}clearCoOwners(){this.setCoOwners([])}get hasChanges(){const t={...this.post,text:this.post.text?.trim()},e={...this._initialPost,text:this._initialPost?.text?.trim()};return Boolean(!(0,z.A)(t,e)||Boolean(this.signed)!==Boolean(this.post.signer_id)||this.post.coowners&&!(0,z.A)(this.coOwnersIds,O(this.post.coowners)))}get showCreateArticleButton(){return this.text.length>T.q$&&this.attachments.length===this.post.attachments.length&&!this.selectedActionButton&&!this.coOwnersIds.length}get isActivePrivacyFriends(){return Boolean(this.post.friends_only)}get isActivePrivacyBestFriends(){return Boolean(this.post.best_friends_only)}get isActivePrivacyDonut(){return Boolean(this.post.donut?.is_donut)}get isActivePrivacyDonutLevel(){return Boolean(this.post.donut?.is_donut&&this.post.donut?.donut_level_id)}get privacyType(){return this.isActivePrivacyBestFriends?$:this.isActivePrivacyFriends?K:this.isActivePrivacyDonutLevel?Q:this.isActivePrivacyDonut?q:H}get donutPaidUntil(){return this.post.donut?.paid_duration&&this.post.donut?.paid_duration>0&&this.post.date?new Date(1e3*(this.post.date+this.post.donut?.paid_duration)):this.post.donut?.donut_paid_until?new Date(1e3*this.post.donut?.donut_paid_until):void 0}get hasOnlyVideoAttachments(){return Boolean(this.attachments.length&&this.attachments.every((({type:t})=>"video"===t||"clip"===t)))}get hasUploadedVideoAttachment(){return Boolean(this.attachments.length&&this.attachments.some((({type:t,uploaded:e})=>"video"===t&&e)))}get mediaAttachAspectArray(){const t=this.photos?.[0];if(t&&this.hasSingleMediaAttachment){const e=(0,J.yB)(t);if(e){if(!(0,J.u$)(e))return T.q_}}return T.q_.filter((({key:t})=>t!==T.rk.ORIGINAL))}get hasMediaAttachments(){return Boolean(this.attachments.length)}get hasSingleMediaAttachment(){return Boolean(1===this.attachments.length)}get isReply(){return Boolean(this.post.copy_history?.length)}get postId(){return this.post.id}get checkSign(){return Boolean(this._initialPost?.check_sign)}get hasPrimaryAttachments(){return Boolean(this.attachments.length||this.link||this.article||this.isDocValidMediaAttach)}get hasContent(){return Boolean(this.hasPrimaryAttachments||this.text.trim().length)}updateAudioSnippetMode(t){this._audioSnippetModeSelected=t}get audioSnippetModeSelected(){return this._audioSnippetModeSelected}get isDraft(){return"draft"===this.postData.post_type}constructor(t,e={}){if(this._audioSnippetModeSelected=!1,this.setPublishDate=t=>{this.post.date=t?(0,R.Z)(t):void 0},this.setText=t=>{this.post.text=t},this.setDonutTeaserText=t=>{this.post.donut||(this.post.donut={is_donut:!0}),this.post.donut.donut_teaser_text=t},this.setOrdData=t=>{this.post._ordData=t,this.config.onChangeOrd?.()},this.setAttachmentsAspect=t=>{this.post.attachments_meta||(this.post.attachments_meta={}),this.post.attachments_meta.carousel_ratio=t?.ratio},this.setAttachmentsView=t=>{this.post._attachmentsViewKey=t.key},this.setPhotoAttachmentsCrop=(t,e)=>{const i=this.post.attachments.find((e=>"photo"===e.type&&e.photo&&(0,B.Ox)(e.photo)===t))?.photo?.orig_photo;i&&i.width===e.width&&i.height===e.height?this.post._photoAttachmentsCrop?.[t]&&delete this.post._photoAttachmentsCrop?.[t]:(this.post._photoAttachmentsCrop||(this.post._photoAttachmentsCrop={}),this.post._photoAttachmentsCrop[t]=e)},this.addAttachments=(t,e=!1)=>{const i=[...this.post.attachments];if(t.forEach((t=>{(0,V.zQ)(i,t)})),e){const e=new Set(t.map(ut));t=t.filter((t=>t.parsed&&!e.has(ut(t))))}this.post.attachments=i},this.updatePhotosSelection=async t=>{const e=await Promise.all(t.map(J.iw)),i={};e?.forEach((t=>{i[(0,J.S6)(t)]=!0}));const s=[],o={};this.post.attachments?.forEach((t=>{"photo"!==t.type||t.photo?.album_id===T.YP||t.photo?.album_id===T.EC?s.push(t):t.photo&&i[(0,J.S6)(t.photo)]&&(s.push(t),o[(0,J.S6)(t.photo)]=!0)})),e.forEach((t=>{o[(0,J.S6)(t)]||s.push({type:"photo",photo:t})})),this.post.attachments=s},this.removeAttachment=(t,e,i)=>{const s=this.post.attachments?.findIndex((0,V.tx)(t,e,i));if(!(0,Y.E)(s)||-1===s)return!1;const o=this.post.attachments?.splice(s,1)?.[0];return"photo"===t&&o?.photo&&(this.post._photoAttachmentsCrop&&delete this.post._photoAttachmentsCrop[(0,J.S6)(o.photo)],this.photos?.length||delete this.post.attachments_meta?.carousel_ratio),!0},this.updateVideosSelection=t=>{const e=new Map;t.forEach((t=>{const{owner_id:i,id:s}=t;e.set(N.C.createRawId({id:s,ownerId:i}),!0)}));const i=[],s=new Map;this.post.attachments?.forEach((t=>{if("video"===t.type&&t.video?.date){if(t.video){const{owner_id:o,id:n}=t.video;if(o&&n){const a=N.C.createRawId({id:n,ownerId:o});e.has(a)&&(i.push(t),s.set(a,!0))}}}else i.push(t)})),t.forEach((t=>{const{owner_id:e,id:o}=t;s.has(N.C.createRawId({id:o,ownerId:e}))||i.push({type:"video",video:t})})),this.post.attachments=i},this.updateMediasSelection=t=>{const e=new Map;t.forEach((t=>{e.set(t.rawId,!0)}));const i=[],s=new Map;this.post.attachments?.forEach((t=>{if("video"!==t.type&&"photo"!==t.type)i.push(t);else if(t.photo){const o=`photo${(0,J.S6)(t.photo)}`;e.has(o)&&(i.push(t),s.set(o,!0))}else{const{owner_id:o,id:n}=t.video;if(o&&n){const a=`video${(0,F.WO)({id:n,ownerId:o})}`;e.has(a)&&(i.push(t),s.set(a,!0))}}})),t.forEach((t=>{s.has(t.rawId)||("photo"===t.type?i.push({type:"photo",photo:t.data}):i.push({type:"video",video:t.data}))})),this.post.attachments=i},this.setEmptyAttach=async t=>{this.post.attachments||(this.post.attachments=[]);const e=await it(t);this.addAttachment(e)},this.setVideoAttach=(t,e,i=!1)=>{this.post.attachments||(this.post.attachments=[]);let s=this.post.attachments.findIndex((i=>"video"===i.type&&i.video?.id===t.id&&i.video?.owner_id===t.owner_id||String(i.video?.id)===e));s>=0?this.post.attachments.splice(s,1,{type:"video",video:{...this.post.attachments[s].video,...t},uploaded:i}):this.post.attachments.push({type:"video",video:t,uploaded:i})},this.updateVideoAttach=async t=>{const{id:e,ownerId:i,reload:s,listId:o}=t.detail;if(!e||!i)return;let n={id:Number(e),owner_id:Number(i),access_key:o};if(s&&this.config.onUpdateVideoAttach){const t=await this.config.onUpdateVideoAttach((0,F.WO)({id:Number(e),ownerId:Number(i)}));t&&(n=t)}this.setVideoAttach(n)},this.setPhotoAttach=(t,e,i=!1)=>{this.post.attachments||(this.post.attachments=[]);let s=this.post.attachments.findIndex((i=>"photo"===i.type&&i.photo?.id===t.id&&i.photo?.owner_id===t.owner_id||String(i.photo?.id)===e));s>=0?this.post.attachments.splice(s,1,{type:"photo",photo:{...this.post.attachments[s].photo,...t},uploaded:i}):this.post.attachments.push({type:"photo",photo:t,uploaded:i})},this.onPrefillActionButton=(t,e)=>{this.onSelectActionButton(t,e),this._initialPost&&this.post._attachments_list&&(this._initialPost._attachments_list=this.post._attachments_list)},this.onSelectActionButton=(t,e)=>{this.removeActionButton(),this.post._attachments_list||(this.post._attachments_list=[]);let i={type:t};if(e)if(e.donut_goal)i.donut_goal=e.donut_goal;else if(e.donut_level)i.donut_level=e.donut_level;else if(e.vk_ticket){const t=e.vk_ticket_data;i.vk_ticket=function(t,e){if(e)return e}(e.vk_ticket,t)}this.post._attachments_list.push({type:"action_button",action_button:i})},this.removeActionButton=()=>{this.removeAttachment("action_button"),this.post._attachments_list?.splice(this.post._attachments_list.findIndex((t=>"action_button"===t.type)),1)},this.onAddProduct=t=>{const e=Object.fromEntries(t.map((t=>[t.id,t])));this.post.attachments?.forEach((t=>{"photo"===t.type&&t.photo&&e[t.photo.id]&&(t.photo=e[t.photo.id])}))},this.onAttachDoc=t=>{const e=t[0];if(!this.post.attachments||!e)return;const i=this.post.attachments.find((t=>"doc"===t.type));i?i.doc=e.data:this.post.attachments.push({type:"doc",doc:e.data}),this.config.onDocAttached?.(e)},this.onGeoSelect=({place:t})=>{this.addAttachment({type:"geo",geo:{place:t}}),this.config?.onGeoSelect?.(t)},this.removePoll=()=>this.removeAttachment("poll"),this.setSigned=t=>{this.post._signed=t},this.extractPostDataForCreateRequest=()=>{let t={message:this.text,close_comments:this.commentsEnabled?0:1,mute_notifications:this.notificationsEnabled?0:1,publish_date:this.postData.date};t.is_action_button_remembered=this.isActionButtonRemembered?1:0,this.postData.best_friends_only?t.best_friends_only=1:this.postData.friends_only&&(t.friends_only=1),this.ordData&&!this.isActivePrivacyDonut&&(t.mark_as_ads=this.ordData.is_ad?1:0,t.ord_external_id=this.ordData.ord_pred_id,t.ord_erid=this.ordData.erid),this.postData.donut?.is_donut&&(this.postData.donut?.donut_paid_until?t.donut_paid_until=this.postData.donut?.donut_paid_until:t.donut_paid_duration=-1,t.donut_level_id=this.postData.donut?.donut_level_id,t.donut_teaser_text=this.postData.donut?.donut_teaser_text);const{primaryAttachments:e,secondaryAttachments:i}=lt(this.postData,this._audioSnippetModeSelected);if(e.length&&(t.primary_attachments=e.join(","),this.post._photoAttachmentsCrop&&(t.photo_attachments_crop=JSON.stringify(Object.entries(this.post._photoAttachmentsCrop).map((([t,e])=>({photo_id:t,...e}))))),t.primary_attachments_mode=this.isGridAttachmentView&&this.attachments.length>1?"grid":"carousel",this.attachmentsAspect&&this.attachmentsAspect.key!==T.rk.ORIGINAL&&(t.primary_attachments_ratio=`${this.attachmentsAspect.value}_manual`)),t.attachments=i.join(","),this.postData._attachments_list?.length&&(t.attachments_list=JSON.stringify(this.postData._attachments_list)),this.link&&!this.attachments.length&&(t.link_photo_id=(0,F.WO)({id:Number(this.link.photo?.id),ownerId:Number(this.link.photo?.owner_id)}),t.link_title=this.link.title),this.geo?.place){const{id:e,latitude:i,longitude:s}=this.geo.place;t.place_id=e,t.lat=i,t.long=s}return this.coOwnersIds.length&&(t.co_owner_ids=this.coOwnersIds.join(",")),t},this.extractPostDataForEditRequest=()=>{const t={message:this.text,publish_date:this.postData.date,post_id:Number(this.postData.post_id||this.postData.id),close_comments:this.commentsEnabled?0:1};(this.isPostponed||this.isDraft)&&(t.mute_notifications=this.notificationsEnabled?0:1,this.postData.best_friends_only?t.best_friends_only=1:this.postData.friends_only&&(t.friends_only=1)),this.postData.donut?.is_donut&&(this.postData.donut?.donut_paid_until?t.donut_paid_until=this.postData.donut?.donut_paid_until:t.donut_paid_duration=-1,t.donut_level_id=this.postData.donut?.donut_level_id,t.donut_teaser_text=this.postData.donut?.donut_teaser_text);const{primaryAttachments:e,secondaryAttachments:i}=lt(this.postData,this._audioSnippetModeSelected);if(e.length&&(t.primary_attachments=e.join(","),this.post._photoAttachmentsCrop&&(t.photo_attachments_crop=JSON.stringify(Object.entries(this.post._photoAttachmentsCrop).map((([t,e])=>({photo_id:t,...e}))))),t.primary_attachments_mode=this.isGridAttachmentView&&this.attachments.length>1?"grid":"carousel",this.attachmentsAspect&&this.attachmentsAspect.key!==T.rk.ORIGINAL&&(t.primary_attachments_ratio=`${this.attachmentsAspect.value}_manual`)),t.attachments=i.join(","),this.postData._attachments_list?.length&&(t.attachments_list=JSON.stringify(this.postData._attachments_list)),this.link&&!this.attachments.length&&(t.link_photo_id=(0,F.WO)({id:Number(this.link.photo?.id),ownerId:Number(this.link.photo?.owner_id)}),t.link_title=this.link.title),this.geo?.place){const{id:e,latitude:i,longitude:s}=this.geo.place;t.place_id=e,t.lat=i,t.long=s}return this.coOwnersIds.length&&(t.co_owner_ids=this.coOwnersIds.join(",")),t},this.setDonutDuration=t=>{this.post.donut||(this.post.donut={is_donut:!0}),this.post.donut.donut_paid_until=t?(0,R.Z)(t):void 0,this.post.donut.paid_duration=-1},this.config=e,this.config.audioSnippetMode&&(this._audioSnippetModeSelected=!0),t){this.post={...t},t.text&&(this.post.text=ct(t.text,e.removeProtocolFix)),this.post._attachmentsViewKey=Object.values(T.fY).find((e=>e.key.toLowerCase()===t.attachments_meta?.primary_mode))?.key||T.aR.key,this.setSigned(Boolean(this.isSuggested?!t.check_sign:t.signer_id)),this.post.coowners?.list&&this.setCoOwners(O(this.post.coowners)),(this.isSuggested||this.isDraft)&&(this.post.date=void 0),(this.isSuggested||this.isPostponed||this.isDraft)&&(this.post._notificationsEnabled=!e.getMuteNotifications?.()),this.isActivePrivacyDonutLevel&&this.post.donut&&(this.post.donut.donut_teaser_text=e.getDonutCustomTeaserText?.()),this.post.comments?.can_close?this.post._commentsEnabled=!0:this.post.comments?.can_open&&(this.post._commentsEnabled=!1);const s=this.post.attachments.filter((t=>"audio_playlist"===t.type));if(s.length){this.post.attachments=this.post.attachments.filter((t=>"audio_playlist"!==t.type&&"audio"!==t.type));const t=s.find((({type:t})=>"audio_playlist"===t));t&&this.post.attachments.push(t)}const o=this.post.attachments.filter((t=>"audio"===t.type)),n=this.config.getAudiosLimit?.()??1;o.length>n&&(this.post.attachments=this.post.attachments.filter((t=>"audio"!==t.type)),this.post.attachments.push(...o.slice(0,n))),this.config.audioSnippetMode&&1===o.length&&(this._audioSnippetModeSelected=Boolean(o[0].audio?.preview_url));const a=this.post.attachments.filter((t=>"doc"===t.type));if(a.length>1){this.post.attachments=this.post.attachments.filter((t=>"doc"!==t.type));const t=a.find((({type:t})=>"doc"===t));t&&this.post.attachments.push(t)}const r=this.post.attachments.find((t=>"action_button"===t.type));if(r){const t="action_button"===(i=r).type&&i.action_button?{type:"action_button",action_button:{type:i.action_button.type,donut_goal:i.action_button.donut_goal,donut_level:i.action_button.donut_level}}:null;t&&(this.post._attachments_list=[t])}this.post.geo&&this.post.attachments.push({type:"geo",geo:this.post.geo}),this.post.attachments=this.post.attachments.filter((({type:t})=>"market"!==t&&"action_button"!==t))}else this.post=gt;var i;this._initialPost=(0,l.HO)(this.post),(0,l.l_)(this)}}var vt=i(879158);class yt{get alertProps(){return this._alertProps}get videoPreviewOpened(){return this._videoPreviewOpened}get popout(){return this._popout}get isDirtyStatus(){return this.isDirty}get dirtyCheckStatus(){return this.shouldDirtyCheck}get getCurrentModal(){return this.currentModal}constructor(t){this.config=t,this._popout=null,this._alertProps=null,this.currentModal=T.cL.BASE,this.prevModals=[],this._videoPreviewOpened=!1,this.isDirty=!1,this.shouldDirtyCheck=!1,this.setDirty=t=>{this.isDirty=t},this.setShouldDirtyCheck=t=>{this.shouldDirtyCheck=t},this.setVideoPreviewOpened=t=>{this._videoPreviewOpened=t},this.changeModal=(t,e)=>{const i=this.currentModal;this.currentModal=t,e?(this.shouldDirtyCheck=e.shouldDirtyCheck,this.prevModals.push(e.prevModal??i)):(this.shouldDirtyCheck=!1,this.prevModals.push(i)),this.config.onChangeModal(t,i)},this.setAlertProps=t=>{this._alertProps={...t,onClose:t.onClose??this.closePopout}},this.openPopout=t=>{this._alertProps=null,this._popout=t},this.closePopout=()=>{this._popout=null},this.goBack=()=>{const t=this.prevModals.pop(),e=this.currentModal;this.currentModal=t??T.cL.BASE,this.config.onChangeModal(this.currentModal,e)},this.openPollScreen=()=>this.changeModal(T.cL.POLL,{shouldDirtyCheck:!0}),this.openFileScreen=()=>this.changeModal(T.cL.FILE),this.openBestFriendsScreen=()=>this.changeModal(T.cL.BEST_FRIENDS),this.openAudioPickerScreen=()=>this.changeModal(T.cL.AUDIO_PICKER),this.openPodcastEpisodePickerScreen=()=>this.changeModal(T.cL.PODCAST_EPISODE_PICKER),this.openGeoPickerScreen=()=>this.changeModal(T.cL.GEO_PICKER),this.openSettingsScreen=()=>this.changeModal(T.cL.SETTINGS),this.goToMainScreen=()=>this.changeModal(T.cL.BASE),this.openPhotoPickerScreen=()=>this.changeModal(T.cL.PHOTO_PICKER),this.openVideoPickerScreen=()=>this.changeModal(T.cL.VIDEO_PICKER),this.openAddProductScreen=()=>this.changeModal(T.cL.ADD_PRODUCT),this.openPrivacyScreen=()=>this.changeModal(T.cL.PRIVACY),this.openActionButtonsScreen=()=>this.changeModal(T.cL.ACTION_BUTTONS),this.openCoAuthorshipScreen=()=>this.changeModal(T.cL.CO_OWNERS_PICKER),this.openEditReplyScreen=()=>this.changeModal(T.cL.EDIT_REPLY),this.openPhotoCropScreen=()=>this.changeModal(T.cL.PHOTO_CROP),this.openPhotoEditorScreen=()=>this.changeModal(T.cL.PHOTO_EDITOR),this.openPhotoViewerScreen=()=>this.changeModal(T.cL.PHOTO_VIEWER),this.openDonutTeaserScreen=()=>this.changeModal(T.cL.DONUT_TEASER),this.openDraftsListScreen=()=>this.changeModal(T.cL.DRAFTS_LIST),this.openPopoutOldPostEditAlert=()=>this.changeModal(T.cL.OLD_POST_EDIT_ALERT,{prevModal:T.cL.BASE,shouldDirtyCheck:!1}),(0,l.l_)(this)}}var ft=i(273193),St=i(383753),wt=i(916533),bt=i(340310),Pt=i(617989),At=i(645189),kt=i(99201),Ct=i(876141),It=i(651253),Et=i(64165),Lt=i(991237);const Tt=({ownerId:t,postId:e})=>e?`${t}_${e}`:`${t}`;class Mt{getFetching(t){return this.data.postingSettingsPromisesMapByPostingSettingsId.has(Tt(t))}getPostingSettings(t){return this.data.postingSettingsMapByPostingSettingsId.get(Tt(t))}async ensureFetchPostingSettings(t){const e=this.getPostingSettings(t);return e||this.fetchPostingSettings(t)}async fetchPostingSettings(t){const e=await this.getFetchPostingSettingsPromise(t);return(0,l.h5)((()=>{this.data.postingSettingsMapByPostingSettingsId.set(Tt(t),e)})),e}getFetchPostingSettingsPromise(t){const e=this.data.postingSettingsPromisesMapByPostingSettingsId.get(Tt(t));if(e)return e;const i=new Promise((async(e,i)=>{try{e(await this.wallApi.getPostingSettings({owner_id:t.ownerId,post_id:t.postId,is_ad:t.isAd?1:0}))}catch{i()}finally{(0,l.h5)((()=>{this.data.postingSettingsPromisesMapByPostingSettingsId.delete(Tt(t))}))}}));return this.data.postingSettingsPromisesMapByPostingSettingsId.set(Tt(t),i),i}constructor(t){this.wallApi=t,this.data={postingSettingsMapByPostingSettingsId:new Map,postingSettingsPromisesMapByPostingSettingsId:new Map},(0,l.l_)(this)}}Mt=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===A.t?Object:A.t])],Mt);var Ot=i(947008);const Dt={attachment_any_dependency:[],attachment_dependencies:[],restrict_attachments_combination:[],primary_attachments_mode_restricted_attachments:[],media_size_restriction:[]};class xt{async setParams(t){const{ownerId:e,postId:i,isAd:s}=t;this._ownerId=e,this._postId=i,this._isAd=s,await this.fetchSettings()}async setParamsAndFetch(t){const{ownerId:e,postId:i,isAd:s}=t;this._ownerId=e,this._postId=i,this._isAd=s,await this.fetchSettings()}async fetchSettings(){this.fetching=!0;try{const t=await this.settingsProvider.ensureFetchPostingSettings({ownerId:Number(this._ownerId),postId:this._postId,isAd:this._isAd});(0,l.h5)((()=>{this.postingSettings=this.filterActionButtons(t),t.rules?.forEach((t=>{const e=t.type;this.postingRules[e]&&t[e]&&this.postingRules[e].push(t[e])}))}))}catch(t){(0,l.h5)((()=>{this.hasError=!0}))}finally{(0,l.h5)((()=>{this.fetching=!1,this.loaded=!0}))}}filterActionButtons(t){const e=t.attachments;if(!e)return t;const i=this.userEnv.partConfigEnabled("frontend.web_posts_vk_tickets")?"buy_ticket":"vk_ticket";return{...t,attachments:{...e,action_buttons:e.action_buttons?.filter((t=>t.type!==i))}}}checkPrimaryAttachmentsModeRestrictedAttachments(t,e){const i={};return this.postingRules.primary_attachments_mode_restricted_attachments.forEach((s=>{const{attachments:o,error_popup:n,error_message:a,mode:r}=s;if(r!==e?.toLocaleLowerCase())return;o.find((e=>t[e]))&&o.forEach((t=>{i[t]={error_message:a,error_popup:n}}))})),i}checkAttachmentAnyDependency(t){const e={};return this.postingRules.attachment_any_dependency.forEach((i=>{const{attachment:s,dependencies:o,error_message:n}=i;if(!t[s])return;o.find((e=>t[e]))||(e[s]={error_message:n},o.forEach((t=>{e[t]={error_message:n}})))})),e}checkAttachmentDependencies(t){const e={};return this.postingRules.attachment_dependencies.forEach((i=>{const{attachment:s,dependencies_attachments:o,error_message:n}=i;if(!t[s])return;o.every((e=>t[e]))||(e[s]={error_message:n},o.forEach((t=>{e[t]={error_message:n}})))})),e}checkRestrictAttachmentsCombination(t){const e={};return this.postingRules.restrict_attachments_combination.forEach((i=>{const{attachments_combination:s,error_message:o}=i;s.every((e=>t[e]))&&s.forEach((t=>{e[t]={error_message:o}}))})),e}canCheckView(t,e){if(!this.postingSettings?.rules)return{};const i=this.checkPrimaryAttachmentsModeRestrictedAttachments(t,e);return{[e]:Object.values(i)[0],...i}}checkAttachments(t,e){if(!this.postingSettings?.rules)return{};return{...this.checkAttachmentAnyDependency(t),...this.checkAttachmentDependencies(t),...this.checkRestrictAttachmentsCombination(t),...this.checkPrimaryAttachmentsModeRestrictedAttachments(t,e)}}canAddAttachment({attachmentsTypes:t,attachmentType:e,replaceTypes:i={},mode:s}){const o={[e]:0,...t,...i};return o[e]++,this.checkAttachments(o,s)}canRemoveAttachment({attachmentsTypes:t,attachmentType:e,replaceTypes:i={},mode:s}){const o={[e]:0,...t,...i};return o[e]&&o[e]--,this.checkAttachments(o,s)}get userCommentsAreClosed(){return Boolean(this.postingSettings?.wall?.user?.comments_are_closed)}get groupCommentsAreClosed(){return Boolean(this.postingSettings?.wall?.group?.comments_are_closed)}get hasDonutButtons(){return Boolean(this.donutGoals.length||this.donutLevels.length)}get actionButtons(){return this.postingSettings?.attachments?.action_buttons??[]}get savedActionButton(){const t=this.postingSettings?.attachments?.action_button_remembered;if(t)return this.allActionButtons.find((e=>W({rememberedActionButton:t,apiActionButton:e})))}get hasActionButtonsOnboarding(){return this.actionButtons.some((({type:t})=>"message_to_community"===t||"open_market"===t||"online_booking"===t))}get donutGoals(){return this.postingSettings?.attachments?.donut_goal_action_buttons??[]}get donutLevels(){return this.postingSettings?.attachments?.donut_level_action_buttons??[]}get postMaxLength(){return this.postingSettings?.post?.max_length??0}get hasAudioMaxCount(){return(0,Ot.Et)(this.postingSettings?.attachments?.audio?.max_count)}get audioMaxCount(){return this.postingSettings?.attachments?.audio?.max_count??1}get isAdsPost(){return Boolean(this.postingSettings?.post?.is_ads)}get allActionButtons(){return[...this.actionButtons,...this.donutGoals,...this.donutLevels]}get groupWallStatus(){return this.postingSettings?.wall?.group?.wall}[n.zr](){this.fetching=!1,this.postingSettings=void 0,this.postingRules=Dt,this.hasError=!1,this._ownerId=void 0,this._isAd=void 0}constructor(t,e){this.settingsProvider=t,this.userEnv=e,this.postingSettings=void 0,this.fetching=!1,this.loaded=!1,this.hasError=!1,this.postingRules=Dt,this._ownerId=void 0,this._postId=void 0,this._isAd=void 0,this.ensureSavedActionButton=async()=>{if(this.loaded)return this.savedActionButton;const t=await this.settingsProvider.ensureFetchPostingSettings({ownerId:Number(this._ownerId),postId:this._postId,isAd:this._isAd}),e=t.attachments?.action_button_remembered;return(await this.ensureAllActionButtons()).find((t=>W({rememberedActionButton:e,apiActionButton:t})))},this.ensureAllActionButtons=async()=>{if(this.loaded)return this.allActionButtons;const t=await this.settingsProvider.ensureFetchPostingSettings({ownerId:Number(this._ownerId),postId:this._postId,isAd:this._isAd});return[...t.attachments?.action_buttons??[],...t.attachments?.donut_goal_action_buttons??[],...t.attachments?.donut_level_action_buttons??[]]},(0,l.l_)(this)}}xt=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Mt?Object:Mt,void 0===At.J?Object:At.J])],xt);var Rt=i(909589),Yt=i(941745),Ft=i(652228);class Bt{async fetchUserData(){this._loadingData=!0;try{const t=await this.usersProvider.fetchUsersByIds({userIds:[Number(this.authService.userId)]});(0,l.h5)((()=>{this._data=t[0]??null,this._data&&(this._isClosed=Boolean(this._data.is_closed))}))}catch(t){this.onShowError()}finally{(0,l.h5)((()=>{this._loadingData=!1}))}}async openProfile(){this._loadingSetPrivacy=!0;try{await this.accountApi.setPrivacy({key:"closed_profile",value:"false"}),(0,l.h5)((()=>{this._isClosed=!1}))}catch{this.onShowError()}finally{(0,l.h5)((()=>{this._loadingSetPrivacy=!1}))}}async openProfileComments(){this._loadingOpenComments=!0;try{await this.settingsGeneralApi.setAccountSettings({value:"false",key:"pr_no_wall_replies"}),(0,l.h5)((()=>{this._isCommentsEnabled=!0}))}catch(t){this.onShowError()}finally{(0,l.h5)((()=>{this._loadingOpenComments=!1}))}}get isClosedProfile(){return Boolean(this._isClosed)}get isUserCommentsEnabled(){return Boolean(this._isCommentsEnabled)}get data(){return this._data}get loadingData(){return Boolean(this._loadingData)}get loadingSetPrivacy(){return Boolean(this._loadingSetPrivacy)}get loadingOpenComments(){return Boolean(this._loadingOpenComments)}get loading(){return this.loadingData||this.loadingSetPrivacy}constructor(t,e,i,s,o,n){this.authService=t,this.errorManager=e,this.usersProvider=i,this.accountApi=s,this.settingsGeneralApi=o,this.postingTimelineLogger=n,this._data=null,this._isClosed=!1,this._isCommentsEnabled=!1,this._loadingData=!1,this._loadingSetPrivacy=!1,this._loadingOpenComments=!1,this.onShowError=()=>{this.errorManager.onNetworkErrorSnackbar(),this.postingTimelineLogger.logError({message:T.Zk.LoadingUserOwnerError})},(0,l.l_)(this)}}Bt=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===wt.u?Object:wt.u,void 0===Et.e?Object:Et.e,void 0===v.y?Object:v.y,void 0===Rt.y?Object:Rt.y,void 0===Yt.q?Object:Yt.q,void 0===Ft.k?Object:Ft.k])],Bt);var Nt=i(601884),zt=i(797719),Vt=i(376572),Ut=i(782405);class Gt{async fetchGroupData(){this._loadingData=!0;try{const t=await this.groupsProvider.fetchGroupsByIds({groupIds:[this.config.groupId],fields:["is_closed","can_post_donut","counters","admin_level"]});(0,l.h5)((()=>{this._data=t[0]??null,this._data&&(this._isClosed=this._data.is_closed!==Ut.x.OPEN)}))}catch(t){this.config.onError?.()}finally{(0,l.h5)((()=>{this._loadingData=!1}))}}async openGroup(){this._loadingSetPrivacy=!0;try{await this.groupsApi.edit({access:0,group_id:this.config.groupId}),(0,l.h5)((()=>{this._isClosed=!1}))}catch(t){this.config.onError?.()}finally{(0,l.h5)((()=>{this._loadingSetPrivacy=!1}))}}async openGroupComments(){this._loadingOpenComments=!0;try{await this.groupsApi.edit({group_id:this.config.groupId,enable_replies:1}),(0,l.h5)((()=>{this._isCommentsEnabled=!0}))}catch(t){this.config.onError?.()}finally{(0,l.h5)((()=>{this._loadingOpenComments=!1}))}}get isClosedGroup(){return Boolean(this._isClosed)}get isGroupCommentsEnabled(){return Boolean(this._isCommentsEnabled)}get data(){return this._data}get loadingData(){return Boolean(this._loadingData)}get loadingOpenComments(){return Boolean(this._loadingOpenComments)}get loadingSetPrivacy(){return Boolean(this._loadingSetPrivacy)}get loading(){return this.loadingData||this.loadingSetPrivacy}constructor(t,e,i){this.config=t,this.groupsProvider=e,this.groupsApi=i,this._data=null,this._isClosed=!1,this._isCommentsEnabled=!1,this._loadingData=!1,this._loadingSetPrivacy=!1,this._loadingOpenComments=!1,(0,l.l_)(this)}}class jt{init(){const{profiles:t,groups:e,selectedCoOwnersIds:i}=this._config;this._initiallySelectedCoOwners=Boolean(i.length),this.setCoOwnersData({profiles:t,groups:e?.map((t=>this.groupsProvider.createGroupFromApi({apiGroup:t,fields:""})))});const s=this._config.selectedCoOwnersIds?.[0];s&&this.fetchNeededCoOwnerData(s);const o=[];t?.forEach((t=>{o.push({profile:t,type:"profile",description:""})})),e?.forEach((t=>{o.push({group:t,type:"group",description:""})})),this.coOwnersDataService.addItems(o)}setCoOwnersData(t){const e={...this._profiles};t.profiles?.forEach((t=>{e[t.id]=t})),this._profiles=e;const i={...this._groups};t.groups?.forEach((t=>{i[t.id]=t})),this._groups=i}async fetchNeededCoOwnerData(t){this._isLoading=!0;try{if(w.z.isGroupId(t)&&!this._groups[t]){const e=(await this.groupsProvider.fetchGroupsByIds({groupIds:[w.z.convertOwnerIdToGroupId(t)],fields:["name","photo_100"]},{signal:this.abortController.signal}))[0];e&&(this._groups[t]=e)}else if(w.z.isUserId(t)&&!this._profiles[t]){const e=(await this.usersProvider.fetchUsersByIds({userIds:[t],fields:["photo_100"]},{signal:this.abortController.signal}))[0];e&&(0,l.h5)((()=>{this._profiles[t]=e}))}}catch(t){this.errorManager.showErrorSnackbar(T.Rn.CoOwnersErrorLoad),this._config.onError?.()}finally{(0,l.h5)((()=>{this._isLoading=!1}))}}get isLoading(){return this._isLoading}get profiles(){return this._profiles}get groups(){return this._groups}get initiallySelectedCoOwners(){return this._initiallySelectedCoOwners}dispose(){this._groups=[],this._profiles=[],this._isLoading=!1,this.abortController.abort()}constructor(t,e,i,s,o){this.usersProvider=e,this.groupsProvider=i,this.errorManager=s,this.coOwnersDataService=o,this._profiles={},this._groups={},this.abortController=new AbortController,this._isLoading=!1,this._initiallySelectedCoOwners=!1,(0,l.l_)(this),this._config=t,this.init()}}var Wt=i(566401),Ht=i(360809),$t=i(300806),Kt=i(104776),qt=i(390860),Qt=i(257581);class Jt{get tagsItemsValues(){return Object.values(this._tags.items)}get previewPhotoTag(){const t=this.photos.find((t=>t.has_tags));return this.tagsItemsValues.find((({item_id:e})=>e===t?.id))}get tagsCount(){return this.tagsItemsValues.length}get previewSrc(){if(!this.previewPhotoTag?.link.photo?.sizes)return;const t=(0,$t.q)(this.previewPhotoTag.link.photo.sizes,36,36);return t?.url}get tags(){return(0,l.HO)(this._tags)}get maxPhotoSizeRecord(){return(0,Kt.jM)(this.photos)}get photosRecord(){return(0,Kt.Uy)(this.photos)}get tagsByPhotoId(){return(0,Kt.vM)(this.tagsItemsValues)}get outOfBoundsTagsByPhotoId(){return(0,Kt.vM)(this.outOfBoundsTags)}get outOfBoundsTags(){const t=this.photoAttachmentsCrop;if(!t)return[];return this.tagsItemsValues.filter((e=>{const i=this.photosRecord[e.item_id],s=this.maxPhotoSizeRecord[e.item_id];if(!i)return!1;const o=t[(0,J.S6)(i)];return!(!o||!s)&&!(0,Kt.fj)({crop:o,tag:e,imageMaxSize:s})}))}getTagsOutsideCrop(t,e){const i=this.tagsByPhotoId[t];return i?i.filter((t=>{const i=this.maxPhotoSizeRecord[t.item_id];return!(0,Kt.fj)({crop:e,tag:t,imageMaxSize:i})})):[]}get hasTags(){return this.tagsCount>0}[n.zr](){this.abortController?.abort()}constructor(t,e,i){this.tagsService=t,this.errorManager=e,this.productAnalyticsLogger=i,this._tags=T.hI,this._callbacks={},this.photoAttachmentsCrop=void 0,this.photos=[],this.abortController=void 0,this.photosWithFailedTags={},this.photosIdsWithLoadedTags=new Set,this.setCallbacks=t=>{this._callbacks=Object.assign(this._callbacks,t)},this.updatePhotosAndTags=t=>{this.photos=t.photos,this._tags=t.tags,this.validateTags(),this.updatePhotoTags()},this.updatePhotos=t=>{this.photos=t,this.validateTags(),this.updatePhotoTags()},this.updatePhotoAttachmentsCrop=t=>{this.photoAttachmentsCrop=t,this.deleteOutOfBoundsTags()},this.validateTags=()=>{const t=Object.entries(this._tags.items),e=new Set(this.photos.map((({id:t})=>t)));t.forEach((([t,i])=>{e.has(i.item_id)||(this.photosIdsWithLoadedTags.delete(i.item_id),delete this._tags.items[t],delete this._tags.forAdd[t],delete this._tags.forDelete[t])}))},this.updatePhotoTags=async()=>{this.abortController?.abort(),this.abortController=new AbortController,this.photosWithFailedTags={};const t=new Set(this.tagsItemsValues.map((({item_id:t})=>t))),e=this.photos.filter((e=>e.has_tags&&!t.has(e.id)&&!this.photosIdsWithLoadedTags.has(e.id)));await Promise.all(e.map((t=>this.fetchTagsForPhoto(t)))),this.deleteOutOfBoundsTags(),(0,Wt.A)(this.photosWithFailedTags)||this.handleShowError()},this.fetchTagsForPhoto=async t=>{try{const e=await this.tagsService.getList({type:"photo",owner_id:t.owner_id,item_id:t.id,access_key:t.access_key},{signal:this.abortController?.signal});(0,l.h5)((()=>{e.items.forEach((t=>{this._tags.items[(0,x.uy)(t)]=t})),this.photosIdsWithLoadedTags.add(t.id)}))}catch(e){if(!(0,Vt.T)(e)||(0,_.z)(e))return;(0,l.h5)((()=>{this.photosWithFailedTags[t.id]=t}))}},this.deleteTag=t=>{if(!t)return;const e=(0,x.uy)(t),i=this._tags.items[e],s=this.photos.find((({id:t})=>t===i?.item_id));if(!i||!s)return;if(this.productAnalyticsLogger.logProductAttachmentsEvent(Qt.ZX.ProductDelete,i),delete this._tags.forAdd[e],delete this._tags.items[e],i.isNew||(this._tags.forDelete[e]=(0,x.px)(s,i)),s.id!==i?.item_id)return s;const o=this.tagsItemsValues.filter((({item_id:t})=>t===s.id)).length;s.tags={count:o},s.has_tags=Boolean(s.tags.count),this._callbacks.updatePhoto?.(s)},this.handleSave=async()=>{const t=[...Object.entries(this._tags.forDelete).map((async([t,e])=>{try{return await this.tagsService.delete(e),{key:t,type:"delete"}}catch(e){throw new Error(`Failed to delete tag with key '${t}': ${e.message}`)}})),...Object.entries(this._tags.forAdd).map((async([t,e])=>{try{return await this.tagsService.add(e),{key:t,type:"add"}}catch(e){throw new Error(`Failed to add tag with key '${t}': ${e.message}`)}}))],e=await Promise.allSettled(t),i=[];if(e.forEach((t=>{if("fulfilled"===t.status){const{key:e,type:i}=t.value;"delete"===i?delete this._tags.forDelete[e]:delete this._tags.forAdd[e]}else i.push(t.reason)})),i.length>0){const t=i.map((t=>t.message)).join("\n");throw new Error(`Some tag operations failed:\n${t}`)}},this.clearTags=()=>{this._tags=T.hI},this.deleteOutOfBoundsTags=()=>{this.outOfBoundsTags.forEach((t=>{const e=(0,x.uy)(t),i=this.photosRecord[t.item_id];delete this._tags.forAdd[e],delete this._tags.items[e],t.isNew||(this._tags.forDelete[e]=(0,x.px)(i,t))}))},this.handleShowError=()=>{this.errorManager.onNetworkErrorSnackbar()},(0,l.l_)(this)}}Jt=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Ht.D?Object:Ht.D,void 0===Et.e?Object:Et.e,void 0===qt.I?Object:qt.I])],Jt);var Xt=i(332855);const Zt=t=>{let e="";const{firstNameGen:i,lastNameGen:s}=t;return i&&(e=i),s&&(e=e?`${e} ${s}`:s),e};var te=i(928959),ee=i(873187),ie=i(141789);class se{async get(t){try{const e=this.ensureAtom(t);return await e.get()}catch(t){return null}}async set(t,e){try{const i=this.ensureAtom(t);await i.set({lastPublishedDateTime:e})}catch(t){return}}ensureAtom(t){const e=this.convertOwnerIdToKey(t);return this._atoms[e]||(this._atoms[e]=this._store.createAtom(e)),this._atoms[e]}constructor(t){this.authService=t,this._atoms={},this.convertOwnerIdToKey=t=>String(t),this.authService.userId&&(this._store=(0,ie.E)({dbName:"posting-postponed",storeName:String(this.authService.userId),version:1}),(0,l.l_)(this))}}se=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===wt.u?Object:wt.u])],se);class oe{[n.zr](){this._store?.destroy()}constructor(t){this.authService=t,this._atoms={},this._store=null,this.get=async t=>{try{const e=this.ensureAtom(t);return await e.get()}catch(t){return null}},this.set=async(t,e)=>{try{const i=this.ensureAtom(t);await i.set(e)}catch(t){return}},this.delete=async t=>{try{const e=this.ensureAtom(t);return await e.delete()}catch(t){return}},this.has=async t=>Boolean(this.get(t)),this.ensureStore=()=>(this._store||(this._store=(0,ie.E)({dbName:"posting-action-buttons",storeName:String(this.authService.userId),version:1})),this._store),this.ensureAtom=t=>{const e=(t=>String(t))(t);return this._atoms[e]||(this._atoms[e]=this.ensureStore().createAtom(e)),this._atoms[e]},(0,l.l_)(this)}}oe=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===wt.u?Object:wt.u])],oe);var ne=i(533293),ae=i(383483),re=i(466968),de=i(774505);class ce{get isFeatureEnabled(){return this.userEnv.partConfigEnabled("frontend.web_posts_vk_tickets")}get selectedTicket(){return this._selectedTicket}get selectedTicketDate(){const t=this._selectedTicket?.seance?.date;if(!t)return;const e=this.langs.getLang("months_sm_of",!0);return this.langs.compactDate(new Date(t),e,{excludeTime:!0})}get selectedTicketCity(){return this._selectedTicket?.seance?.city}get isModalVisible(){return this._isTicketModalVisible}constructor(t,e){this.langs=t,this.userEnv=e,this._isTicketModalVisible=!1,this._selectedTicket=void 0,this.isVkTicketButton=t=>"vk_ticket"===j(t),this.clearTicket=()=>{this._selectedTicket=void 0},this.selectTicket=t=>{this._selectedTicket=t},this.hideModal=()=>{this._isTicketModalVisible=!1},this.showModal=()=>{this._isTicketModalVisible=!0},(0,l.l_)(this)}}ce=(0,c.Cg)([n.z8.global(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===ft.Y?Object:ft.Y,void 0===At.J?Object:At.J])],ce);class le{async[n.Ts](){const{screen:t,postingTimelineStatsStartTime:e,initData:i,localDraftManager:s,section:o,isAdsPromotedCreate:n,isPostingOpenerVkr:a}=this.props.current;this.localDraftManager=s??new L.i(this.authService,this.videoApi,this.photosApi,this.userEnv),this.helpHints.ensureAll(),this.postingTimelineLogger.logStartTimeline({screen:t,screenStartTime:e}),this._isAdsPromotedCreate=n??!1,this._isPostingOpenerVkr=a??!1;const{closeModal:r,onCreateSuccess:d,onEditSuccess:c,onCreateDraftSuccess:h,onSuggestedPublished:p,ownerId:g,platform:_,postRaw:m}=this.props.current;if(this.closeModal=r,this.onCreateDraftSuccess=h,this.onCreateSuccess=d,this.onEditSuccess=c,this.onSuggestedPublished=p,this.ownerId=g?Number(g):this.currentUserId,this.isGroup=w.z.isGroupId(this.ownerId),this._platform=_,m&&(this.postRaw=m),this.isGroup?this.fetchGroup():this.fetchBestFriends(),this.platformBasedInit(),this.ownerId){const t=this.postRaw&&(t=>{const e=t.split("_");if(e.length<2)return null;const i=Number(e[1]);return i||null})(this.postRaw)||void 0;this.uploadManager.setOwnerId(this.ownerId),this.uploadManager.setMaxAttachmentsCount(T.sr),this.userEnv.partConfigEnabled("new_posting_fix_fetching_settings")?await this.settingsManager.setParamsAndFetch({ownerId:this.ownerId,postId:t,isAd:this._isAdsPromotedCreate}):this.settingsManager.setParams({ownerId:this.ownerId,postId:t,isAd:this._isAdsPromotedCreate})}this.uploadManager.setCallbacks(this.callbacks),this.attachedLinkManager.setCallbacks(this.callbacks);let v=[];if(v.push(this.marketAttachItemsService.fetchAttachInitialData({count:1,is_services:0})),v.push(this.loadPostponedPublishDate()),i&&"object"==typeof i&&!Array.isArray(i)){let t={inner_type:"wall_wallpost",attachments:[]};"text"in i&&i.text&&"string"==typeof i.text&&(t.text=i.text),"owner_id"in i&&i.owner_id&&"number"==typeof i.owner_id&&(t.owner_id=i.owner_id),"attachments"in i&&Array.isArray(i.attachments)&&i.attachments.length&&(t.attachments=i.attachments),"best_friends_only"in i&&i.best_friends_only&&"boolean"==typeof i.best_friends_only&&(t.best_friends_only=(0,u.I)(i.best_friends_only)),this.postManager.setPost(t),this.attachedLinkManager.parseText(this.postManager.text)}if(m&&v.push(this.fetchPost()),m||(this.isRemoteDraftsEnabled&&this.loadPostingDraftsCount(),i||v.push(this.loadLocalDraft())),this.isUser&&v.push(this.userOwner.fetchUserData()),this.isGroup&&(this.groupOwner=new Gt({groupId:this.groupId},this.groupsProvider,this.groupsApi),v.push(this.groupOwner.fetchGroupData())),v.length&&(await Promise.all(v),this._hasLoadingError))return this.errorManager.onNetworkErrorSnackbar(),this.props.current.onLoadingError?.(),void this.postingTimelineLogger.logError({message:T.Zk.LoadingPickerDataError});let y=[];if(this.postManager.postData.coowners?y=O(this.postManager.postData.coowners):this.postManager.postData._coOwnersIds?.length&&(y=this.postManager.postData._coOwnersIds),this.coOwnersSettings=new jt({selectedCoOwnersIds:y,profiles:this.postProfiles,groups:this.postGroups,onError:()=>{this.postingTimelineLogger.logError({message:T.Zk.LoadingCoOwnersError})}},this.usersProvider,this.groupsProvider,this.errorManager,this.coOwnersDataService),this.reactions.reaction((()=>(0,l.HO)(this.checkedAttachments)),(t=>{t&&this.checkInputFieldErrors(t)})),this.reactions.reaction((()=>this.postManager.attachments.length),((t,e)=>{t>e&&(this._attachmentsSlideIndex=t-1)})),this.postingTimelineCreationEntryPoint=this.props.current.postingTimelineCreationEntryPoint??Xt.I8.OTHER,this.postingTimelineLogger.logScreenInteractionReady(),this.productAnalyticsLogger.changeConfig({ownerId:Number(g),creationEntryPoint:this.props.current.creationEntryPoint}),t===T.gB.Groups)this.navScreen=Qt.cQ.Community;else if(t===T.gB.Profile)this.navScreen=Qt.cQ.Profile;else if(t===T.gB.Feed){const t=o||String(window.cur?.section);t===T.Xr.News?this.navScreen=T.yT[T.Xr.News][String(window.cur?.subsection)]:this.navScreen=T.yT[t]||Qt.cQ.Feed}else Object.values(Qt.cQ).includes(t)&&(this.navScreen=t);this.isRemoteDraftsEnabled&&this.postManager.isDraft?this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.Open,navScreen:this.navScreen}):this.productAnalyticsLogger.logClickNavigationEvent({navigationEventType:Qt.X3.Open,navScreen:this.navScreen})}get currentUserId(){return this.authService.userId??0}get isEdit(){return Boolean(this.postRaw)&&!this.postManager.isDraft}get isNewPostCase(){return!this.isEdit}get isAdsPromotedCreate(){return this._isAdsPromotedCreate}get isPostingOpenerVkr(){return this._isPostingOpenerVkr}platformBasedInit(){const{onNavigate:t,onNavigateBack:e,onLeave:i}=this.props.current;this._platform!==o.ODD.VKCOM?this.layoutManager.init({onNavigate:t,onNavigateBack:e,onLeave:i,onHasChanges:()=>this.postManager.hasChanges,isEdit:Boolean(this.postRaw),onChangeModal:t=>{null===t?this.productAnalyticsLogger.changeConfig({baseNavScreen:(0,vt.sx)(this.layoutManager.panel)}):this.productAnalyticsLogger.changeConfig({baseNavScreen:(0,vt.Mc)(t)})}}):(this.addProductManager.setCallbacks(this.callbacks),this.reactions.reaction((()=>(0,l.HO)(this.postManager.photos)),(t=>{t&&this.addProductManager.updatePhotos(t)})),this.reactions.reaction((()=>(0,l.HO)(this.postManager.photoAttachmentsCrop)),(t=>{this.addProductManager.updatePhotoAttachmentsCrop(t)})))}platformBasedBack(){this._platform===o.ODD.VKCOM?this.modalManager.goBack():this.layoutManager.closeModal()}get platformBasedManager(){return this._platform!==o.ODD.VKCOM?this.layoutManager:this.modalManager}get checkedAttachments(){return this.settingsManager.checkAttachments(this.postManager.attachmentsTypes,this.postManager.attachmentsView.key)}get signedSettingIsShown(){return this.isGroup&&(this.isAdmin||!this.isAdmin&&this.settingsManager.groupWallStatus!==I.N.OPEN)}get hasProcessing(){return this._postingNewPost}get isFetchingPost(){return this._fetchingPost}get hasLoader(){return this._fetchingPost||this._loadingLocalDraft||this._fetchingGroup||this.settingsManager.fetching||this.marketAttachItemsService.isInitialLoading}get hasMarketSelfAttachItems(){return Object.values(this.addProductManager.tags.forAdd??{}).some((t=>{const e=(0,x.Yx)(t.object);return!!e&&e.ownerId===this.ownerId}))}get hasMarketAttachItems(){return Boolean(this.marketAttachItemsService.groupItems.length||this.marketAttachItemsService.faveItems.length)}get hasMarketAttachedItems(){return this.addProductManager.hasTags}get photosLimit(){const t=this.postManager.photos?.filter((t=>!(0,J.XI)(t)))||[];return T.sr-((this.postManager.videos?.length??0)+t.length)}get videosLimit(){const t=this.postManager.videos?.filter((t=>!(0,ht.mn)(t)))||[];return T.sr-((this.postManager.photos?.length??0)+t.length)}async loadPostingDraftsCount(){try{this.postingDraftsCountProvider.ensureFetchPostingDraftsCount({domain:this.ownerId.toString()})}catch(t){this.errorLogger.log(t)}}async fetchPost(){this._fetchingPost=!0;try{const t=await this.postService.fetchPost({extended:1,posts:String(this.postRaw),fields:T.EH});(0,l.h5)((()=>{this.postProfiles=t.profiles,this.postGroups=t.groups;const e=t.items?.[0];if(e){if(this.postManager=new mt(e,this.postManagerConfig),this.uploadManager.setCallbacks(this.callbacks),this.vkTickets.isFeatureEnabled&&this.isEdit){const t=e.attachments.find((t=>"action_button"===t.type&&"vk_ticket"===t?.action_button?.type));t&&t.action_button?.vk_ticket&&this.vkTickets.selectTicket(t.action_button.vk_ticket)}if(e.copy_history?.length)return void this.modalManager.openEditReplyScreen();this.checkOldPostEditWidthFeedback(e),this.checkInputFieldErrors(this.checkedAttachments),this.productAnalyticsLogger.changeConfig({postId:e?.id})}}))}catch(t){(0,l.h5)((()=>{this._hasLoadingError=!0}))}finally{(0,l.h5)((()=>{this._fetchingPost=!1}))}}async fetchBestFriends(){try{const t=100,{items:e}=await this.bestFriendsApi.getWithFields({count:t,fields:Nt.b.join()});this.setBestFriends((0,zt.R)(e))}catch(t){(0,l.h5)((()=>{this._hasLoadingError=!0}))}}async loadLocalDraft(){this._loadingLocalDraft=!0;try{if(!this.localDraftManager)return;this.localDraftManager.setOwnerId(this.ownerId);const t=await this.localDraftManager.get();t?(this.postManager.setPost(t),this.attachedLinkManager.setText(this.postManager.text)):await this.loadSavedActionButton(),this.reactions.reaction((()=>(0,l.HO)(this.postManager.postData)),(t=>{t&&this.localDraftManager?.save(t)}))}finally{(0,l.h5)((()=>{this._loadingLocalDraft=!1}))}}async loadPostponedPublishDate(){try{const t=await this.postponedPostsManager.get(this.ownerId);this._postponedLastPublishedDateTime=t?.lastPublishedDateTime??null}catch(t){}}async loadSavedActionButton(){try{if(!this.postManager.selectedActionButton){const t=await this.settingsManager.ensureSavedActionButton();if(t)return this.postManager.onPrefillActionButton(t.type,t),void await this.actionButtonsManager.delete(this.ownerId);const e=await this.actionButtonsManager.get(this.ownerId);if(e){const i=await this.settingsManager.ensureAllActionButtons();return void(i.find((e=>(({atomActionButton:t,apiActionButton:e})=>!!t&&t.type===e.type&&(!t.additionalData||Object.entries(t.additionalData).every((([t,i])=>(0,G.n)(i,e[t])))))({atomActionButton:t,apiActionButton:e})))&&(this.postManager.onPrefillActionButton(e.type,e.additionalData),this.postManager.setIsActionButtonRemembered(!0)))}}}catch{}}get groupId(){return w.z.convertOwnerIdToGroupId(this.ownerId)}async fetchGroup(){this._fetchingGroup=!0;try{await this.groupsProvider.fetchGroupsByIds({groupIds:[this.groupId],fields:["can_post_donut","can_upload_video"]}),(0,l.h5)((()=>{const t=this.groupsProvider.getGroup(this.groupId);this.adminLevel=t?.admin_level,this.isDonutEnabled=Boolean(t?.can_post_donut);const e=this.adminLevel===E.y.EDITOR,i=this.adminLevel===E.y.ADMINISTRATOR;this.isAdmin=Boolean(t?.is_admin&&(e||i))}))}catch(t){(0,l.h5)((()=>{this._hasLoadingError=!0}))}finally{(0,l.h5)((()=>{this._fetchingGroup=!1}))}}setBestFriends(t){this.bestFriends=t}get bestFriendsData(){return this.bestFriends}get bestFriendsCount(){return this.bestFriends.length}get signed(){const{signed:t}=this.postManager;return void 0===t&&this.isNewSuggestPost?this.userEnv.partConfigEnabled("wall_new_posting_suggested_signed_default"):Boolean(t)}get firstCoOwner(){if(!this.coOwnersSettings)return null;const{profiles:t,groups:e}=this.coOwnersSettings,i=this.postManager.coOwnersIds;for(let s=0;s<i.length;s++){const o=i[s];if(w.z.isUserId(o)&&t[o])return t[o];if(w.z.isGroupId(o)&&e[o])return e[o]}return null}get coOwnersSelected(){return Boolean(this.postManager.coOwnersIds.length)}get privacySelected(){return Boolean(this.postManager.postData.friends_only||this.postManager.postData.best_friends_only||this.postManager.postData.donut?.is_donut)}get alerts(){return{settingCoOwnersWithPrivacy:this.privacySelected,settingCoOwnersWithClosedProfile:Boolean(this.userOwner?.isClosedProfile),settingCoOwnersWithClosedGroup:Boolean(this.groupOwner?.isClosedGroup),settingCoOwnersWithAuthorSignature:Boolean(this.signed),editingPostWithCoOwners:Boolean(this.coOwnersSelected&&this.postRaw&&this.coOwnersSettings?.initiallySelectedCoOwners&&this.postManager.hasChanges),settingPrivacyWithCoOwners:this.coOwnersSelected,settingCoOwnersWithActionButtons:Boolean(this.postManager.currentActionButtonType),settingActionButtonsWithCoOwners:this.coOwnersSelected}}get coOwnersSettingLoading(){return Boolean(this.userOwner?.loading||this.groupOwner?.loading)}get withFullPermission(){return Boolean(this.isGroup&&this.isAdmin||this.isUser&&this.ownerId===this.currentUserId)}get coOwnersSettingIsShown(){const t=this.isGroup&&this.groupOwner?.isClosedGroup&&this.groupOwner?.data?.admin_level!==E.y.ADMINISTRATOR,e=this.isEdit&&this.privacySelected,i=this.props.current.creationEntryPoint===T.d,{is_archived:s}=this.postManager.postData;return this.withFullPermission&&!this.postManager.isSuggested&&!t&&!i&&!e&&!s}get privacySettingIsShown(){return Boolean(this.withFullPermission&&(this.isNewPostCase||this.postManager.isPostponed||this.postManager.postData.donut?.is_donut)&&(!this.isGroup||this.isDonutEnabled&&!this.isNewSuggestPost&&!this.postManager.isSuggested))}get donutTeaserIsShown(){return Boolean(this.withFullPermission&&this.postManager.isActivePrivacyDonutLevel)}get selectedDonutLevel(){if(this.postManager.isActivePrivacyDonutLevel)return this.settingsManager.postingSettings?.donut?.levels_for_privacy?.find((t=>t.id===this.postManager.postData.donut?.donut_level_id))}get privacySettingIsDisabled(){return Boolean(this.isEdit&&!this.postManager.isPostponed&&!this.postManager.isSuggested)}get publishedDateSettingIsShown(){return this.withFullPermission&&(this.isNewPostCase||this.postManager.isPostponed||this.postManager.isSuggested)}get commentsSettingIsShown(){const t=!this.isGroup||this.adminLevel&&this.adminLevel>=3,e=!this.settingsManager.groupCommentsAreClosed||this.groupOwner?.isGroupCommentsEnabled;return Boolean(this.withFullPermission&&(t||e))}get actionButtonsSettingIsShown(){return Boolean(this.isGroup&&this.isAdmin&&!this.postManager.isSuggested&&(this.settingsManager.hasDonutButtons||this.settingsManager.postingSettings?.attachments?.action_buttons?.length))}get notificationSettingIsShown(){const t=this.isGroup&&this.isAdmin,e=this.isNewPostCase&&(this.isUser||t),i=this.postManager.isSuggested&&t,s=this.postManager.isPostponed&&this.isEdit;return e||i||s}get isUser(){return!this.isGroup}get attachmentsSlideIndex(){return Math.max(Math.min(this._attachmentsSlideIndex,this.postManager.attachments.length-1),0)}get invalidRatioSlideIndex(){return this.postManager.attachments.findIndex((t=>(0,J.R9)(this.postManager.attachmentsAspect?.ratio,t.photo)))}get hasPhotoCrop(){return Boolean((this.postManager.isCarouselAttachmentView||this.postManager.hasSingleMediaAttachment)&&this.isPhotoCropEnabled)}get firstPhotoSlideIndex(){return this.postManager.attachments.findIndex((({type:t})=>"photo"===t))}get selectedPhotoCrop(){return this.selectedPhoto&&this.hasPhotoCrop?this.postManager.photoAttachmentsCrop?.[(0,J.S6)(this.selectedPhoto)]:void 0}get isCreator(){return this.postManager.postData.created_by===this.currentUserId}get signedSettingInAdditionalSettings(){return this.signedSettingIsShown&&!(this.isNewSuggestPost||this.postManager.isSuggested&&this.isCreator)}get signedSettingInMainSettings(){return this.signedSettingIsShown&&(this.isNewSuggestPost||this.postManager.isSuggested&&this.isCreator)}get signedSettingDisabledDueToAuthor(){return this.postManager.checkSign&&this.isEdit&&this.postManager.isSuggested?!this.isCreator:this.postManager.checkSign&&this.isEdit}get hasAdditionalSettings(){return Boolean(this.commentsSettingIsShown||this.notificationSettingIsShown||this.signedSettingInAdditionalSettings||this.isOrdAddShown)}get signedAuthor(){if(!this.isGroup)return"";if(this.postManager.isSuggested){const t=this.postManager.postData.created_by;if(!t)return"";const e=this.postProfiles.find((({id:e})=>t===e));return e?Zt({firstNameGen:e.first_name_gen??"",lastNameGen:e.last_name_gen??""}):""}const t=this.settingsManager.postingSettings?.current_user;if(!t)return"";const{first_name_gen:e,last_name_gen:i}=t;return Zt({firstNameGen:e,lastNameGen:i})}get callbacks(){return{updatePhoto:(t,e)=>{if(Number(t.orig_photo?.height)<T.Bf||Number(t.orig_photo?.width)<T.Bf)return this.errorManager.showErrorSnackbar(T.Rn.FileSizeBelowMinimum),this.postManager.removeAttachment("photo",t.id,t.owner_id),void(e&&this.postingTimelineLogger.logFileLoadingError({rawId:e,message:T.Zk.FileSizeBelowMinimumError}));this.postManager.setPhotoAttach(t,e,!0),e&&this.postingTimelineLogger.logFileLoaded({rawId:e}),this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachPhoto,attachmentsInfo:[{attachment_owner_id:t.owner_id,attachment_item_id:t.id,attachment_type:Qt.wh.Photo}]})},updateVideo:(t,e,i)=>{if(this.postManager.setVideoAttach(t,i,!0),i&&this.postingTimelineLogger.logFileLoaded({rawId:i}),e===g.q.Uploading){const{owner_id:e,id:i}=t;void 0!==e&&void 0!==i&&this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:"short_video"===t.type?Qt.ZX.AttachClip:Qt.ZX.AttachVideo,attachmentsInfo:[{attachment_owner_id:e,attachment_item_id:i,attachment_type:Qt.wh.Video}]})}},errorVideo:(t,e,i)=>{if(i?.error?.error_text)this.errorManager.showCustomErrorSnackbar(i.error.error_text);else if(i?.error?.error_msg){const t=this.groupsProvider.getGroup(this.groupId);!t?.can_upload_video&&this.errorManager.isVideoUploadNotAllowed(i?.error?.error_msg)?this.errorManager.showErrorSnackbar(T.Rn.VideoUploadGroupNotAllowed):this.errorManager.showMappedErrorSnackbar(i?.error?.error_msg)}else this.errorManager.showErrorSnackbar(T.Rn.VideoGeneralUploadError);this.removeAttachment({type:"video",itemId:t,ownerId:e}),this.uploadManager.videoUploadService.removeVideo(t,e),this.postingTimelineLogger.logFileLoadingError({message:T.Zk.UploadingVideoError,rawId:String(t)})},errorPhoto:({id:t,ownerId:e,temporaryId:i,errorCode:s})=>{s===T.GJ?this.errorManager.showErrorSnackbar(T.Rn.PhotoWrongSizeError):this.errorManager.showErrorSnackbar(T.Rn.PhotoGeneralUploadError),this.removeAttachment({type:"photo",itemId:t,ownerId:e}),this.uploadManager.photoUploadService.removePhoto(i),this.postingTimelineLogger.logFileLoadingError({message:T.Zk.UploadingPhotoError,rawId:i})},setFilteredFiles:async t=>{for(const e of t)await this.postManager.setEmptyAttach({temporaryId:Number(e.id),file:e,ownerId:this.ownerId})},canAddAttachmentWithFeedback:this.canAddAttachmentWithFeedback,getAttachmentsLength:t=>t?this.postManager.attachments.filter((({parsed:t})=>!t)).length:this.postManager.attachments.length,getAttachments:()=>this.postManager.attachments,onUnsupportedFileFormatError:()=>{this.errorManager.showErrorSnackbar(T.Rn.FileUnsupportedFormat),this.postingTimelineLogger.logError({message:T.Zk.UnsupportedFileFormatError})},onUnsupportedVideoFormatError:()=>{this.errorManager.showErrorSnackbar(T.Rn.VideoUnsupportedFormat),this.postingTimelineLogger.logError({message:T.Zk.UnsupportedVideoFormatError})},onUnsupportedPhotoFormatError:()=>{this.errorManager.showErrorSnackbar(T.Rn.PhotoUnsupportedFormat),this.postingTimelineLogger.logError({message:T.Zk.UnsupportedPhotoFormatError})},onLimitExceededError:t=>this.errorManager.onAttachmentLimitExceededError(t),onSizeExceedsLimitError:()=>{this.errorManager.showErrorSnackbar(T.Rn.FileSizeExceedsLimit),this.postingTimelineLogger.logError({message:T.Zk.FileSizeExceedsLimit})},onBlockedVideoError:(t,e)=>{this.errorManager.showErrorSnackbar(T.Rn.VideoBlockedUpload),this.postManager.removeAttachment("video",t,e),this.uploadManager.videoUploadService.removeVideo(t,e),this.postingTimelineLogger.logError({message:T.Zk.VideoBlockedUpload})},onUpdateText:t=>this.postManager.setText(t),onAddAttachments:(t,e)=>this.postManager.addAttachments(t,e),logStartFileUploading:this.postingTimelineLogger.logStartFileUploading}}changePostParamsInPostingTimelineLogger({isEditing:t}){return this.postingTimelineLogger.changePostParams({isEditing:t,creationEntryPoint:this.postingTimelineCreationEntryPoint??Xt.I8.OTHER,postType:(0,vt.Zq)({postData:this.postManager.postData,isAdmin:this.isAdmin,isGroup:this.isGroup})})}get isNewSuggestPost(){return Boolean(!this.postRaw&&this.isGroup&&!this.isAdmin&&this.settingsManager.groupWallStatus!==I.N.OPEN)}get isPhotoCropEnabled(){return!1}get isPhotosEarsEnabled(){return this.userEnv.partConfigEnabled("photos_ears_enabled")}get isFixRenderPostEnabled(){return this._platform===o.ODD.VKCOM&&this.userEnv.partConfigEnabled("feed_fix_render_new_post")}get isPublishDateButtonEnabled(){return this._platform===o.ODD.VKCOM&&this.userEnv.partConfigEnabled("posting_move_publish_date_button")}get signedSettingDescription(){return this.isEdit&&!this.postManager.isSuggested||!this.signedAuthor?"":this.isAdmin?this.isAdmin&&this.isEdit&&this.postManager.isSuggested&&!this.signed?this.langs.getLang("wall_posting_settings_not_signed_description"):this.langs.getLang("wall_posting_settings_signed_description").replace("{user_genitive}",this.signedAuthor):this.langs.getLang("wall_posting_settings_signed_description_suggested").replace("{user_genitive}",this.signedAuthor)}get requestRef(){if(this.isNewSuggestPost)return"suggest";if(this.postManager.isSuggested)return"suggest_approve";const{creationEntryPoint:t}=this.productAnalyticsLogger;switch(t){case Qt.yH.FeedPlusButton:return"newsfeed_from_plus";case Qt.yH.Feed:return"newsfeed";case Qt.yH.Group:case Qt.yH.GroupWallButton:case Qt.yH.GroupPlusButton:return"group_from_plus";case Qt.yH.Profile:case Qt.yH.ProfileWallButton:case Qt.yH.ProfileFromPlus:return"profile";case Qt.yH.ProfilePlusButton:return"profile_from_plus"}return"unknown"}get postManagerConfig(){return{removeProtocolFix:this.userEnv.partConfigEnabled("new_posting_remove_protocol_fix_enable"),getPostLimit:()=>this.settingsManager.postMaxLength,getAudiosLimit:()=>this.settingsManager.audioMaxCount,getMuteNotifications:()=>Boolean(this.settingsManager.postingSettings?.post?.mute_notifications),getDonutCustomTeaserText:()=>this.settingsManager.postingSettings?.donut?.custom_teaser_text,onDocAttached:this.handleDocAttached,onGeoSelect:t=>{this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachPlace,attachmentsInfo:[{attachment_owner_id:Number(t.owner_id),attachment_item_id:Number(t.id),attachment_type:Qt.wh.Geo}]})},onChangePrivacy:t=>{let e=Qt.xl.Public;t===_t.FriendsOnly?e=Qt.xl.FriendsOnly:t===_t.BestFriendsOnly&&(e=Qt.xl.BestFriendsOnly),this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ChangePrivacy,postPrivacy:e})},onChangeDonutPrivacy:t=>{this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ChangeDonutPrivacy,donutStatus:t})},onChangeOrd:()=>{this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ClickToAdvertisingMark})},onChangeNotifications:t=>{this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ChangeNotifications,hasNotificationOn:t})},onChangeComments:t=>{this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ChangeComments,hasCommentsOn:t})},onUpdateVideoAttach:async t=>{const{items:e}=await this.videoApi.get({videos:t});return e?.[0]},audioSnippetMode:this.userEnv.isToggleEnabled("feed_posting_music_snippet"),isPhotoAutoCropEnabled:this.isPhotoAutoCropEnabled}}get isOrdAddShown(){return(!this.isGroup||this.isGroup&&this.isAdmin)&&!this.postManager.isActivePrivacyDonut}get proposedPublishedDate(){const t=this._postponedLastPublishedDateTime?new Date(this._postponedLastPublishedDateTime+36e5):null;return t?.setSeconds(0),t&&Number(t)>Date.now()?t:null}get userCommentsAreClosed(){return this.settingsManager.userCommentsAreClosed&&!this.userOwner?.isUserCommentsEnabled}get groupCommentsAreClosed(){return this.settingsManager.groupCommentsAreClosed&&!this.groupOwner?.isGroupCommentsEnabled}get isAudioSnippetEnabled(){return this.userEnv.isToggleEnabled("feed_posting_music_snippet")}get isRemoteDraftsEnabled(){return this.userEnv.isToggleEnabled("feed_posting_new_draft")&&this.withFullPermission}get audioSnippetSelected(){return this.postManager.audioSnippetModeSelected}get title(){return this._isAdsPromotedCreate?this.langs.getLang("wall_posting_ads_header_text"):this.postManager.isDraft?this.langs.getLang("wall_posting_draft_header_text"):this.isEdit?this.langs.getLang("wall_posting_edit_header_text"):this.langs.getLang("wall_posting_base_header_text")}get draftsCount(){return this.postingDraftsCountProvider.getPostingDraftsCount({domain:this.ownerId.toString()})}get showDraftsEntrypoint(){return this.isRemoteDraftsEnabled&&this.isNewPostCase&&!this.postManager.isDraft}get showDraftsSaveAction(){const t=this.postManager.isPostponed&&!this.postManager.isPostponedPostDate&&this.isEdit;return this.isRemoteDraftsEnabled&&(this.postManager.isDraft||this.isNewPostCase||t)&&!this.postManager.isSuggested}[n.zr](){this.postManager.hasPrimaryAttachments||this.postManager.text.trim()||this.clearLocalDraft(),this.postingTimelineLogger.logScreenClose(),this.productAnalyticsLogger.logClickNavigationEvent({navigationEventType:Qt.X3.Close,navScreen:this.navScreen}),this.postManager.resetPost(),this.reactions.dispose(),this.postSubmitted=!1,this._platform=void 0,this._hasLoadingError=!1,this._hasSubmitingError=!1,this._postingNewPost=!1,this._fetchingPost=!1,this._loadingLocalDraft=!1,this._fetchingGroup=!1,this.productAnalyticsLogger.reset(),this.vkTickets.clearTicket()}get isPhotoAutoCropEnabled(){return this.userEnv.isToggleEnabled("feed_image_auto_crop")}constructor(t,e,i,s,o,n,a,r,d,c,u,g,m,v,y,f,S,w,b,P,A,k,C,E,L,M,O,D,x,R){this.props=t,this.langs=e,this.postService=i,this.bestFriendsApi=s,this.authService=o,this.errorManager=n,this.uploadManager=a,this.usersProvider=r,this.groupsProvider=d,this.groupsApi=c,this.videoApi=u,this.layoutManager=g,this.settingsManager=m,this.marketAttachItemsService=v,this.attachedLinkManager=y,this.postingTimelineLogger=f,this.addProductManager=S,this.userEnv=w,this.helpHints=b,this.productAnalyticsLogger=P,this.postponedPostsManager=A,this.coOwnersDataService=k,this.photosApi=C,this.userOwner=E,this.actionButtonsManager=L,this.host=M,this.vkTickets=O,this.postingDraftsCountProvider=D,this.errorLogger=x,this.miniAppOrdService=R,this._postingNewPost=!1,this._loadingLocalDraft=!1,this._fetchingPost=!1,this._fetchingGroup=!1,this._hasLoadingError=!1,this._hasSubmitingError=!1,this._attachmentsSlideIndex=0,this._isAdsPromotedCreate=!1,this._isPostingOpenerVkr=!1,this.selectedPhoto=void 0,this.isAdmin=!1,this.isDonutEnabled=!1,this.postSubmitted=!1,this.postProfiles=[],this.postGroups=[],this.postingTimelineCreationEntryPoint=null,this._postponedLastPublishedDateTime=null,this.creationSessionIdInt=void 0,this.bestFriends=[],this.coOwnersSettings=null,this.reactions=new h.O,this.navScreen=Qt.cQ.Posting,this.handleDocAttached=t=>{this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachFile,attachmentsInfo:[{attachment_owner_id:Number(t.data.id),attachment_item_id:Number(t.data.owner_id),attachment_type:Qt.wh.Doc}]})},this.modalManager=new yt({onChangeModal:(t,e)=>{t===T.cL.BASE&&e===T.cL.SETTINGS&&this.productAnalyticsLogger.logClickNavigationEvent({navigationEventType:Qt.X3.GoStage1}),t===T.cL.SETTINGS&&e===T.cL.BASE&&this.productAnalyticsLogger.logClickNavigationEvent({navigationEventType:Qt.X3.GoStage2}),this.productAnalyticsLogger.changeConfig({baseNavScreen:(0,vt.xu)(t)})}}),this.postManager=new mt(void 0,this.postManagerConfig),this.canChangeAttachmentsViewWithFeedback=({mode:t})=>{if(!t)return!0;const e=this.settingsManager.canCheckView(this.postManager.attachmentsTypes,t);return!e[t]?.error_message||(this.errorManager.showCustomErrorSnackbar(e[t].error_message),!1)},this.canAddAttachmentWithFeedback=({event:t,type:e,replaceTypes:i})=>{const s=this.settingsManager.canAddAttachment({replaceTypes:i,attachmentsTypes:this.postManager.attachmentsTypes,attachmentType:e,mode:this.postManager.attachmentsView.key});if(!s[e]?.error_message)return!0;const o="video"===e,n="audio"===e||"audio_playlist"===e,a="podcast"===e,r=Boolean(s.audio||s.audio_playlist||s.podcast);return(n||a)&&r&&s[e]?.error_popup?(this.platformBasedManager.setAlertProps({type:T.n$.PostingAttachmentsErrorMusicAlert,payload:s[e].error_popup,toggleRef:t?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.setAttachmentsView({view:T.fY[T.Q1.CAROUSEL]}),this.canAddAttachmentWithFeedback({event:t,type:a?"podcast":"audio"})&&(n?this.platformBasedManager.openAudioPickerScreen():a&&"openPodcastEpisodePickerScreen"in this.platformBasedManager&&this.platformBasedManager.openPodcastEpisodePickerScreen())}}),!1):!(!o||!r)||(this.errorManager.showCustomErrorSnackbar(s[e].error_message),!1)},this.canRemoveAttachmentWithFeedback=({event:t,type:e,replaceTypes:i,itemId:s,ownerId:o})=>{const n=this.settingsManager.canRemoveAttachment({replaceTypes:i,attachmentsTypes:this.postManager.attachmentsTypes,attachmentType:e,mode:this.postManager.attachmentsView.key}),a="video"===e,r="photo"===e,d=Boolean(n.photo),c=Boolean(n.audio||n.audio_playlist),l=Boolean(n.podcast),h=r&&s&&this.addProductManager.tagsByPhotoId[s];return h&&c?(this.platformBasedManager.setAlertProps({type:T.n$.PostingRemovePhotoWithProductsMusicAlert,toggleRef:t?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.postManager.removeAttachment("audio"),this.postManager.removeAttachment("audio_playlist"),this.postManager.removeAttachment("photo",s,o)}}),!1):h&&l?(this.platformBasedManager.setAlertProps({type:T.n$.PostingRemovePhotoWithProductsPodcastAlert,toggleRef:t?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.postManager.removeAttachment("podcast"),this.postManager.removeAttachment("photo",s,o)}}),!1):h?(this.platformBasedManager.setAlertProps({type:T.n$.PostingRemovePhotoWithProductsAlert,toggleRef:t?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.postManager.removeAttachment("photo",s,o),this.autoUpdateAttachmentsViewIfNeed(e)}}),!1):r&&d&&c?(this.platformBasedManager.setAlertProps({type:T.n$.PostingMusicWithoutPhotoDependencyAlert,toggleRef:t?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.postManager.removeAttachment("audio"),this.postManager.removeAttachment("audio_playlist"),this.postManager.removeAttachment("photo",s,o)}}),!1):r&&d&&l?(this.platformBasedManager.setAlertProps({type:T.n$.PostingPodcastWithoutPhotoDependencyAlert,toggleRef:t?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.postManager.removeAttachment("podcast"),this.postManager.removeAttachment("photo",s,o)}}),!1):!(!a||!c)||(!n[e]?.error_message||(this.errorManager.showCustomErrorSnackbar(n[e].error_message),!1))},this.checkInputFieldErrors=t=>{this.errorManager.clearInputFieldErrors(),Object.entries(t).forEach((([t,e])=>{e?.error_message&&this.errorManager.setInputFieldError(t,e?.error_message)}))},this.checkOldPostEditWidthFeedback=t=>{const e=t.attachments.filter((({type:t})=>"audio_playlist"===t)),i=t.attachments.filter((({type:t})=>"audio"===t)),s=t.attachments.filter((({type:t})=>"doc"===t)),o=t.attachments.find((({type:t})=>"market"===t)),n=this.settingsManager.audioMaxCount;(o||e.length>1||e.length&&i.length||i.length>n||s.length>1||!this.postManager.hasContent||!(0,Wt.A)(this.checkedAttachments))&&this.platformBasedManager.openPopoutOldPostEditAlert()},this.setAttachmentsAspect=({aspect:t,event:e})=>{this.postManager.photos?.length&&this.addProductManager.hasTags?this.platformBasedManager.setAlertProps({type:T.n$.PostingChangeRatioPhotoWithProductsAlert,toggleRef:e?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:()=>{this.postManager.setAttachmentsAspect(t),this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.RatioChange})}}):(this.postManager.setAttachmentsAspect(t),this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.RatioChange}))},this.setAttachmentsView=({view:t,isAuto:e})=>{this.canChangeAttachmentsViewWithFeedback({mode:t.key})&&(t.key===T.Q1.GRID?this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ToGrid}):t.key===T.Q1.CAROUSEL&&this.productAnalyticsLogger.logSettingsEvent({settingsEventType:e?Qt.wJ.ToCarouselAuto:Qt.wJ.ToCarousel}),this.postManager.setAttachmentsView(t))},this.canSubmitAttachmentsWithFeedback=()=>{const t=Object.values(this.checkedAttachments)[0];return!t?.error_message||(this.errorManager.showCustomErrorSnackbar(t.error_message),!1)},this.onChangeText=t=>{this.postManager.isReply||this.attachedLinkManager.parseText(t),this.postManager.setText(t)},this.onCreatePoll=t=>{this.postManager.poll?this.postManager.editPoll(t):this.postManager.addAttachment({poll:t,type:"poll"}),this.platformBasedBack(),this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachPoll,attachmentsInfo:[{attachment_owner_id:t.owner_id,attachment_item_id:t.id,attachment_type:Qt.wh.Poll}]})},this.onEditPoll=t=>{this.postManager.editPoll(t),this.platformBasedBack(),this.postingTimelineLogger.logFinishAttaching()},this.onPhotoSelect=async t=>{await this.postManager.updatePhotosSelection(t),this.setAttachmentsSlideIndex(this.postManager.attachments.length-1),this.modalManager.goToMainScreen(),this.layoutManager.goBackPanel(),this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logAddPhotoAttachmentsEvents(t)},this.onVideoSelect=t=>{this.postManager.updateVideosSelection(t),this.setAttachmentsSlideIndex(this.postManager.attachments.length-1),this.modalManager.goToMainScreen(),this.layoutManager.goBackPanel(),this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logAddVideoAttachmentsEvents(t)},this.onAudiosSelect=(t,e=!1)=>{this.postManager.audioPlaylist&&this.removeAttachment({type:"audio_playlist",itemId:this.postManager.audioPlaylist.id,ownerId:this.postManager.audioPlaylist.owner_id}),this.postManager.audios?.length&&this.postManager.audios.forEach((t=>this.removeAttachment({type:"audio",itemId:t.id,ownerId:t.owner_id}))),t.forEach((t=>this.postManager.addAttachment({audio:t,type:"audio"}))),this.onAudioSnippetModeChange(e),this.platformBasedBack(),this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachMusic,attachmentsInfo:t.map((t=>({attachment_owner_id:t.owner_id,attachment_item_id:t.id,attachment_type:Qt.wh.Audio,attachments_string_value:e?"audio_snippet":"audio"})))})},this.onAudioSnippetModeChange=t=>{this.postManager.updateAudioSnippetMode(t)},this.onAudioPlaylistSelect=t=>{this.postManager.audioPlaylist&&this.removeAttachment({type:"audio_playlist",itemId:this.postManager.audioPlaylist.id,ownerId:this.postManager.audioPlaylist.owner_id}),this.postManager.audios?.length&&this.postManager.audios.forEach((t=>this.removeAttachment({type:"audio",itemId:t.id,ownerId:t.owner_id}))),this.postManager.addAttachment({audio_playlist:t,type:"audio_playlist"}),this.platformBasedBack(),this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachAlbum,attachmentsInfo:[{attachment_owner_id:t.owner_id,attachment_item_id:t.id,attachment_type:Qt.wh.AudioPlaylist}]})},this.onPodcastEpisodeSelect=t=>{this.postManager.podcastEpisode&&this.removeAttachment({type:"podcast",itemId:this.postManager.podcastEpisode.id,ownerId:this.postManager.podcastEpisode.owner_id}),this.postManager.addAttachment({podcast:t,type:"podcast"}),this.platformBasedBack()},this.onMediaSelect=t=>{let e=!1,i=!1;for(let s=0;s<t.length;s++){const o=t[s];if("photo"===o.type&&(e=!0),"video"===o.type&&(i=!0),e&&i)break}this.postManager.updateMediasSelection(t),this.layoutManager.goBackPanel(),this.productAnalyticsLogger.logAddMediaAttachmentsEvents(t),this.postingTimelineLogger.logFinishAttachingFromMediaPicker({withPhoto:e,withVideo:i})},this.removeAttachment=({event:t,type:e,itemId:i,ownerId:s})=>{if(t&&(0,te.T)(t),!this.canRemoveAttachmentWithFeedback({event:t,type:e,itemId:i,ownerId:s}))return;let o=!1;if(st(e)){const t=this.postManager.attachments.findIndex((0,V.tx)(e,i,s));t>=0&&(o=Boolean(this.postManager.attachments[t].uploaded))}const n=this.postManager.removeAttachment(e,i,s);if("photo"===e){n||this.postManager.removeAttachment("video",i,s);const t=this.uploadManager.photos?.find((t=>t.realPhotoId===i))?.temporaryId;t&&this.uploadManager.photoUploadService.removePhoto(t)}this.autoUpdateAttachmentsViewIfNeed(e),this.productAnalyticsLogger.logDeleteAttachment(Number(s),Number(i),e,o)},this.autoUpdateAttachmentsViewIfNeed=t=>{st(t)&&this.postManager.isGridAttachmentView&&this.postManager.hasSingleMediaAttachment&&this.setAttachmentsView({view:T.fY[T.Q1.CAROUSEL],isAuto:!0})},this.canCropPhotoWithFeedback=({itemId:t,event:e,crop:i,onSubmit:s})=>!this.addProductManager.getTagsOutsideCrop(t,i).length||(this.platformBasedManager.setAlertProps({type:T.n$.PostingCropPhotoWithProductsAlert,toggleRef:e?.currentTarget,onClose:this.platformBasedManager.closePopout,onSubmit:s}),!1),this.onAddProduct=t=>{this.postManager.onAddProduct(t.photos),this.addProductManager.updatePhotosAndTags(t),this.modalManager.goBack(),this.postingTimelineLogger.logFinishAttaching(),this.productAnalyticsLogger.logProductSelectAttachmentsEvent(Object.values(t.tags.forAdd))},this.onSelectActionButton=(t,e)=>{const i=this.postManager.selectedActionButton?this.langs.getLang("wall_posting_action_button_save_edit_text"):this.langs.getLang("wall_posting_action_button_save_new_text");this.isEdit?this.errorManager.showSnackbar({text:i,type:T.GZ.Ok}):this.errorManager.showSnackbar({text:i,type:T.GZ.Ok,action:{label:this.langs.getLang("wall_posting_action_button_save_action"),onClick:(t,e)=>{this.postManager.setIsActionButtonRemembered(!0),this.errorManager.hideSnackbar(e)}}}),this.postManager.onSelectActionButton(t,e);const s=this.vkTickets.isFeatureEnabled&&"vk_ticket"===t?{vkTicket:{event_id:this.vkTickets.selectedTicket?.id??"",seance_id:this.vkTickets.selectedTicket?.seance?.id??""}}:{};this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.AttachActionButton,attachmentsInfo:[{attachment_type:Qt.wh.ActionButton,attachment_owner_id:this.ownerId,attachments_string_value:t}],...s})},this.removeActionButton=()=>{const t=this.langs.getLang("wall_posting_action_button_save_delete_text");if(this.isEdit?this.errorManager.showSnackbar({text:t,type:T.GZ.Ok}):this.errorManager.showSnackbar({text:t,type:T.GZ.Ok,action:{label:this.langs.getLang("wall_posting_action_button_save_action"),onClick:(t,e)=>{this.postManager.setIsActionButtonRemembered(!0),this.errorManager.hideSnackbar(e)}}}),this.vkTickets.isFeatureEnabled&&this.vkTickets.isVkTicketButton(this.postManager.selectedActionButton)){const t=this.vkTickets.selectedTicket;this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.DeleteActionButton,attachmentsInfo:[{attachment_type:Qt.wh.ActionButton,attachment_owner_id:this.ownerId,attachments_string_value:"vk_ticket"}],vkTicket:{event_id:t?.id??"",seance_id:t?.seance?.id??""}}),this.vkTickets.clearTicket()}this.postManager.removeActionButton()},this.savePost=async()=>this.isEdit&&(!this.postManager.isSuggested||!this.isAdmin)||this.postManager.isDraft?(this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")||this.postManager.isDraft&&!this.postManager.isPostponedPostDate&&this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.PostDraft}),this.editPost({isDraft:!1,isPublishThroughEdit:this.postManager.isDraft})):this.submitPost({isDraft:!1}),this.saveDraft=async()=>this.postRaw?(this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")||this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.SaveDraftChanges}),this.editPost({isDraft:!0})):(this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")||this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.SaveDraft}),this.submitPost({isDraft:!0})),this.submitPost=async({isDraft:t=!1})=>{if(this._postingNewPost)return!1;this.postingTimelineLogger.logStartSending(),this._postingNewPost=!0;try{this.changePostParamsInPostingTimelineLogger({isEditing:!1}),await this.addProductManager.handleSave();const e=this.postManager.extractPostDataForCreateRequest();e.owner_id=this.ownerId;const i=this.isGroup&&(this.settingsManager.groupWallStatus!==I.N.OPEN||this.isAdmin);let s;if(i&&(e.from_group=1),this.postManager.isSuggested&&(e.post_id=this.postManager.postData.id),t&&(e.draft=1),e.signed=this.signed?1:0,this.isNewSuggestPost&&(e.check_sign=this.signed?0:1),this.isPhotoAutoCropEnabled||this.isPhotoCropEnabled||(delete e.photo_attachments_crop,delete e.primary_attachments_ratio),e.photo_attachments_crop&&this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.RatioChange}),e.ref=this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")?this.productAnalyticsLogger.navScreen:this.requestRef,e.entry_point=this.productAnalyticsLogger.creationEntryPoint,this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")&&(e.creation_session_id=this.productAnalyticsLogger.creationSessionId),this.isAdsPromotedCreate){const t=[e.primary_attachments,e.attachments].filter(Boolean).join(","),i={owner_id:e.owner_id,message:e.message,attachments:t||void 0,signed:e.signed,lat:e.lat,long:e.long,place_id:e.place_id,guid:e.guid,link_button:e.link_button,link_title:e.link_title,link_image:e.link_image,primary_attachments_mode:e.primary_attachments_mode},o=await this.postService.createAdsStealth(i);s=o.post_id}else{const t=await this.postService.create(e);s=t.post_id}(0,l.h5)((()=>{this.postSubmitted=!0}));const o=t?this.onCreateDraftSuccess:this.onCreateSuccess;return(0,l.h5)((()=>{this.postManager.isSuggested&&this.postManager.postData.id?(this.onSuggestedPublished?.({ownerId:this.ownerId,postId:this.postManager.postData.id}),this.isFixRenderPostEnabled?o?.({ownerId:this.ownerId,postId:s,fromGroup:i}):o?.({ownerId:this.ownerId,postId:this.postManager.postData.id,fromGroup:i})):o?.({ownerId:this.ownerId,postId:s,fromGroup:i}),this.postManager.isPostponed&&(this.showSuccessPostponedSnackbar(),this.postManager.publishDate&&this.postponedPostsManager.set(this.ownerId,Number(this.postManager.publishDate))),this.isAdsPromotedCreate&&this.showAdsPromotedCreateSnackbar(this.ownerId,s),this.postManager.isSuggested||this.clearLocalDraft(),this.isRemoteDraftsEnabled&&(t?this.postingDraftsCountProvider.increment({domain:this.ownerId.toString()}):this.postManager.isDraft&&this.postingDraftsCountProvider.decrement({domain:this.ownerId.toString()}))})),this.postingTimelineLogger.logSuccessfullySend(),!0}catch(t){return(0,Vt.T)(t)&&!(0,_.z)(t)?this.errorManager.onNetworkErrorSnackbar():t?.error?.error_text?this.errorManager.showCustomErrorSnackbar(t.error.error_text):this.errorManager.showMappedErrorSnackbar(t?.error?.error_msg||""),this.postingTimelineLogger.logPostPublishingError({code:t?.error?.error_code,message:t?.error?.message}),(0,l.h5)((()=>{this._hasSubmitingError=!0})),!1}finally{(0,l.h5)((()=>{this._postingNewPost=!1}))}},this.editPost=async({isDraft:t=!1,isPublishThroughEdit:e=!1})=>{if(this._postingNewPost)return!1;if(!this.postManager.hasChanges&&!e)return this.onEditSuccess?.({ownerId:this.ownerId,postId:Number(this.postManager.postId),needUpdatePost:!1}),!0;this.postingTimelineLogger.logStartSending(),this._postingNewPost=!0;try{if(!this.postRaw)throw new Error;this.changePostParamsInPostingTimelineLogger({isEditing:!0}),await this.addProductManager.handleSave();const i=this.postManager.extractPostDataForEditRequest();i.owner_id=this.ownerId,i.signed=this.signed?1:0,this.isGroup&&!this.isAdmin&&this.postManager.isSuggested&&(i.check_sign=this.signed?0:1),this.isPhotoCropEnabled||(delete i.photo_attachments_crop,delete i.primary_attachments_ratio),t&&(i.draft=1),i.ref=this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")?this.productAnalyticsLogger.navScreen:this.requestRef,i.entry_point=this.productAnalyticsLogger.creationEntryPoint,this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")&&(i.creation_session_id=this.productAnalyticsLogger.creationSessionId);const{post_id:s}=await this.postService.edit(i),o=e?this.onCreateSuccess:this.onEditSuccess;return(0,l.h5)((()=>{this.postSubmitted=!0})),(0,l.h5)((()=>{o?.({ownerId:this.ownerId,postId:this.postManager.isReply&&this.postManager.postId?this.postManager.postId:s}),this.isRemoteDraftsEnabled&&(e&&this.postManager.isDraft&&this.postingDraftsCountProvider.decrement({domain:this.ownerId.toString()}),!e&&this.postManager.isDraft&&this.showDraftUpdatedSnackbar())})),!0}catch(t){return(0,Vt.T)(t)&&!(0,_.z)(t)?this.errorManager.onNetworkErrorSnackbar():t?.error?.error_text?this.errorManager.showCustomErrorSnackbar(t.error.error_text):this.errorManager.showMappedErrorSnackbar(t?.error?.error_msg||""),(0,l.h5)((()=>{this._hasSubmitingError=!0})),this.postingTimelineLogger.logPostPublishingError({code:t?.error?.error_code,message:t?.error?.message}),!1}finally{(0,l.h5)((()=>{this._postingNewPost=!1}))}},this.onSaveBestFriends=t=>{this.setBestFriends(t),t.length?this.postManager.setPrivacyBestFriends():this.postManager.setPrivacyAll(),this.platformBasedBack()},this.handleSelectCoOwners=t=>{this.postManager.setCoOwners(t);const e=t[0];e&&this.coOwnersSettings&&this.coOwnersSettings.fetchNeededCoOwnerData(e),this.platformBasedBack()},this.handleChangePanel=t=>{this.productAnalyticsLogger.changeConfig({baseNavScreen:(0,vt.sx)(t)})},this.setAttachmentsSlideIndex=t=>{this._attachmentsSlideIndex=Math.max(Math.min(t,this.postManager.attachments.length-1),0)},this.setSelectedPhoto=t=>{this.selectedPhoto=t},this.openPhotoEditorScreen=t=>{this.setSelectedPhoto(t),this.modalManager.openPhotoEditorScreen()},this.showSuccessPostponedSnackbar=()=>{if(this.isGroup){const t=this.groupsProvider.getGroup(this.groupId),e=t?.name??t?.screen_name??`club${this.groupId}`;this.errorManager.showSnackbar({type:T.GZ.Ok,text:this.langs.getLang("wall_posting_postponed_success_group_text").replace("{name}",e)})}else this.errorManager.showSnackbar({type:T.GZ.Ok,text:this.langs.getLang("wall_posting_postponed_success_user_text")})},this.showDraftUpdatedSnackbar=()=>{this.errorManager.showSnackbar({type:T.GZ.Ok,text:this.langs.getLang("wall_feed_draft_updated_text")})},this.showAdsPromotedCreateSnackbar=(t,e)=>{const i=`/wall${(0,F.WO)({ownerId:t,id:e})}`,s=`${this.langs.getLang("wall_posting_stealth_post_created_success_text")}. <a href="${i}" target='_blank' rel='noopener noreferrer'>${this.langs.getLang("vkui_ads_easy_promote_edit_popout_go_to_post_btn")}</a>`;this.errorManager.showSnackbar({type:T.GZ.Ok,text:s,action:{label:this.langs.getLang("wall_post_copy_link"),onClick:(t,e)=>{(0,p.e)(`https://${this.host.getDomainName()}${i}`),this.errorManager.hideSnackbar(e)}}})},this.clearLocalDraft=()=>{this.localDraftManager?.delete()},this.handleRemoveGeo=t=>{this.removeAttachment({event:t,type:"geo"})},this.handleRemoveAudio=t=>{1!==this.postManager.audios?.length?this.postManager.audioPlaylist&&this.removeAttachment({event:t,type:"audio_playlist"}):this.removeAttachment({event:t,type:"audio"})},this.handleRemoveDoc=t=>{t.stopPropagation(),this.removeAttachment({event:t,type:"doc"})},this.handleActionButtonsClick=()=>{this.alerts.settingActionButtonsWithCoOwners?this.errorManager.showErrorSnackbar(T.Rn.AddActionButtonsWithCoOwners):this.platformBasedManager.openActionButtonsScreen()},this.handleOpenMusicScreen=(t,e)=>{if(e)this.errorManager.showSnackbar({text:e,type:T.GZ.Error,action:{label:this.langs.getLang("wall_posting_remove_audio_action"),onClick:(e,i)=>{this.handleRemoveAudio(t),this.errorManager.hideSnackbar(i)}}});else{if(this.settingsManager.hasAudioMaxCount){if(!this.canAddAttachmentWithFeedback({event:t,type:this.postManager.audioPlaylist?"audio_playlist":"audio"}))return void this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.ShowMusicErrorMsg})}else if(!this.canAddAttachmentWithFeedback({event:t,type:"audio"}))return void this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.ShowMusicErrorMsg});this.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.MUSIC}),this.platformBasedManager.openAudioPickerScreen()}},this.handleOpenMediaPicker=()=>{this.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.PHOTO_VK}),this.layoutManager.openMediaPickerScreen(),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenPicker}),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenMyPhoto})},this.handleOpenVideoPickerScreen=()=>{this.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.VIDEO_VK}),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenPicker}),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenMyVideo}),this.modalManager.openVideoPickerScreen()},this.handleOpenPhotoPickerScreen=()=>{this.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.PHOTO_VK}),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenPicker}),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenMyPhoto}),this.modalManager.openPhotoPickerScreen()},this.handleOpenPhotoCropScreen=t=>{this.setSelectedPhoto(t),this.modalManager.openPhotoCropScreen()},this.handleOpenPhotoEditorScreen=t=>{this.setSelectedPhoto(t),this.modalManager.openPhotoEditorScreen()},this.handleOpenPhotoViewerScreen=t=>{this.setSelectedPhoto(t),this.modalManager.openPhotoViewerScreen(),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenPhoto})},this.mediaGridConfig=new re.D((()=>(0,de.us)(this._platform)),this.userEnv),this.openOrdMiniApp=(t,e)=>this.miniAppOrdService.openInLayer(t,e),(0,l.l_)(this)}}le=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===ft.Y?Object:ft.Y,void 0===m.K?Object:m.K,void 0===St.o?Object:St.o,void 0===wt.u?Object:wt.u,void 0===Et.e?Object:Et.e,void 0===ne.B?Object:ne.B,void 0===v.y?Object:v.y,void 0===y.S?Object:y.S,void 0===bt.D?Object:bt.D,void 0===Pt.C?Object:Pt.C,void 0===Lt.I?Object:Lt.I,void 0===xt?Object:xt,void 0===f.j?Object:f.j,void 0===ae.M?Object:ae.M,void 0===Ft.k?Object:Ft.k,void 0===Jt?Object:Jt,void 0===At.J?Object:At.J,void 0===S.a?Object:S.a,void 0===qt.I?Object:qt.I,void 0===se?Object:se,void 0===P?Object:P,void 0===kt.U?Object:kt.U,void 0===Bt?Object:Bt,void 0===oe?Object:oe,void 0===Ct.O?Object:Ct.O,void 0===ce?Object:ce,void 0===C?Object:C,void 0===It.v?Object:It.v,void 0===ee.Z?Object:ee.Z])],le);const{Provider:he,useModel:pe}=(0,n.Qd)(le,{initInEffect:!1});var ue=i(314817),ge=i(311029),_e=i(999051),me=i(685441),ve=i(978325),ye=i(837002),fe=i(772812),Se=i(981252),we=i(37390),be=i(409698),Pe=i(439712),Ae=i(705560),ke=i(946918),Ce=i(434178);class Ie{create(t){return this.pollsApi.create(t)}edit(t){return this.pollsApi.edit(t)}getById(t){return this.pollsApi.getById(t)}constructor(t){this.pollsApi=t,(0,l.l_)(this)}}Ie=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Ce.F?Object:Ce.F])],Ie);var Ee=i(452200),Le=i(169151);class Te{async create(t,e){const i=(0,F.WO)({ownerId:t.owner_id??0,id:0});this.loadingMap.set(i,!0);try{const i=await this.pollsApi.create(t,e);return this.createPollFromApi(i)}finally{this.loadingMap.delete(i)}}async edit(t,e){const i=(0,F.WO)({ownerId:t.owner_id,id:t.poll_id});this.loadingMap.set(i,!0);try{if(await this.pollsApi.edit(t,e))return this.fetch(i)}finally{this.loadingMap.delete(i)}}createPollFromApi(t){const e=new Le.s(t);return this.cacheMap.set(e.rawId,e),e}async fetch(t,e){const{id:i,ownerId:s}=(0,Ee.v)(t);this.loadingMap.set(t,!0);try{const t=await this.pollsApi.getById({owner_id:s,poll_id:i,extended:1},e);return this.createPollFromApi(t)}finally{this.loadingMap.delete(t)}}getById(t){return this.cacheMap.get(t)}async addVote(t,e){const i=(0,F.WO)({ownerId:t.owner_id,id:t.poll_id});if(this.getById(i)){this.loadingMap.set(i,!0);try{await this.pollsApi.addVote(t,e)&&this.fetch(i)}catch(t){throw this.loadingMap.delete(i),t}}}async deleteVote(t,e){const i=(0,F.WO)({ownerId:t.owner_id,id:t.poll_id});if(this.getById(i)){this.loadingMap.set(i,!0);try{await this.pollsApi.deleteVote(t,e)&&this.fetch(i)}catch(t){throw this.loadingMap.delete(i),t}}}isLoading(t){return this.loadingMap.has(t)}reset(t){this.loadingMap.delete(t),this.cacheMap.delete(t)}constructor(t){this.pollsApi=t,this.cacheMap=new Map,this.loadingMap=new Map,(0,l.l_)(this)}}Te=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Ce.F?Object:Ce.F])],Te);let Me=0;class Oe{async fetchData(){if(this.isLoaded)return;const{poll:t,isEdit:e}=this.props.current;(0,l.h5)((()=>{if(this.isLoaded=!0,this.isLoading=!1,t){this.isEdit=Boolean(e),this.isAnonymous=Boolean(t.anonymous),this.isMultiple=t.multiple,this.disableUnvote=t.disable_unvote,this.question=t.question,t.end_date&&(this.limitedTime=!0,this.endDate=new Date(1e3*t.end_date));const i={};(0,l.HO)(t.answers).forEach(((t,e)=>{i[e]=t})),this.answers=i,Me=t.answers.length}else this.answers={[++Me]:{text:""},[++Me]:{text:""}};if(this.props.current.postingSettings){const{answers_limit:t,answer_max_length:e,question_max_length:i}=this.props.current.postingSettings.voting;this.answersLimit=t,this.maxQuestionLength=i,this.maxAnswerLength=e}})),this.postingTimelineLogger.logPickerReady()}[n.Ts](){this.fetchData(),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenPoll})}get canAddAnswer(){return!!this.answersLimit&&Object.keys(this.answers).length<this.answersLimit}get canDeleteAnswer(){return Object.keys(this.answers).length>1}get isValid(){let t=!1;for(const e in this.answers)if(this.answers[e].text){t=!0;break}return Boolean(this.question.length&&t)}get pollSPAEnabled(){return this.userEnv.partConfigEnabled("polls_spa")}constructor(t,e,i,s,o,n,a){this.props=t,this.pollsService=e,this.pollsProvider=i,this.errorManager=s,this.postingTimelineLogger=o,this.productAnalyticsLogger=n,this.userEnv=a,this.isLoaded=!1,this.isLoading=!0,this.isRequestPending=!1,this.isEdit=!1,this.ownerId=null,this.answers={},this.question="",this.isAnonymous=!1,this.isMultiple=!1,this.disableUnvote=!1,this.limitedTime=!1,this.endDate=void 0,this.setDisableUnvote=t=>{this.disableUnvote=t},this.setIsMultiple=t=>{this.isMultiple=t},this.setIsAnonymous=t=>{this.isAnonymous=t},this.setLimitedTime=t=>{this.limitedTime=t},this.setEndDate=t=>{this.endDate=t},this.setQuestion=t=>{this.question=t},this.setAnswer=(t,e)=>{this.answers[t]&&(this.answers[t].text=e)},this.deleteAnswer=t=>{this.canDeleteAnswer&&this.answers[t]&&delete this.answers[t]},this.addAnswerRow=()=>{this.canAddAnswer&&(this.answers[++Me]={text:""})},this.createPoll=async()=>{this.isRequestPending=!0;const t=[];for(const e in this.answers)this.answers[e].text&&t.push(this.answers[e].text);const e={question:this.question,is_multiple:this.isMultiple?1:0,is_anonymous:this.isAnonymous?1:0,add_answers:JSON.stringify(t),disable_unvote:this.disableUnvote?1:0};this.limitedTime&&this.endDate&&(e.end_date=(0,R.Z)(this.endDate));try{if(this.pollSPAEnabled){const t=await this.pollsProvider.create(e);this.isRequestPending=!1,this.props.current.onCreatePoll(t.data)}else{const t=await this.pollsService.create(e);this.isRequestPending=!1,this.props.current.onCreatePoll(t)}}catch(t){(0,Vt.T)(t)?this.errorManager.onNetworkErrorSnackbar():t?.error?.error_text?this.errorManager.showCustomErrorSnackbar(t.error.error_text):this.errorManager.showMappedErrorSnackbar(t?.error?.error_msg||""),this.postingTimelineLogger.logError({message:T.Zk.ErrorLoadingPollPicker})}finally{this.isRequestPending=!1}},this.editPoll=async()=>{const{poll:t}=this.props.current;if(!t)return;this.isRequestPending=!0;const e=[],i=[],s={},o={},n={},a=(0,l.HO)(t.answers),r=(0,l.HO)(this.answers);a.forEach((t=>{o[t.id]=t}));for(const t of Object.keys(r)){const{text:i,id:s}=r[t];s?n[s]=r[t]:e.push(i)}for(const t in o)n[t]?o[t].text!==n[t].text&&(s[t]=n[t].text):i.push(t);const d={question:this.question,poll_id:t.id,owner_id:t.owner_id,end_date:0};this.limitedTime&&this.endDate&&(d.end_date=(0,R.Z)(this.endDate)),e.length&&(d.add_answers=JSON.stringify(e)),i.length&&(d.delete_answers=JSON.stringify(i)),Object.keys(s).length&&(d.edit_answers=JSON.stringify(s));try{if(this.pollSPAEnabled){const t=await this.pollsProvider.edit(d);t&&this.props.current.onEditPoll(t.data)}else{if(await this.pollsService.edit(d)){const e=await this.pollsService.getById({owner_id:t?.owner_id,poll_id:t?.id,extended:1});this.props.current.onEditPoll(e)}}}catch(t){(0,Vt.T)(t)?this.errorManager.onNetworkErrorSnackbar():t?.error?.error_text?this.errorManager.showCustomErrorSnackbar(t.error.error_text):this.errorManager.showMappedErrorSnackbar(t?.error?.error_msg||"")}finally{this.isRequestPending=!1}},this.handleCreatePoll=()=>{this.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.POLL}),this.createPoll()},this.handleEditPoll=()=>{this.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.POLL}),this.editPoll()},this.handleDeletePoll=()=>{this.props.current.onDeletePoll?.(),this.closeModal()},this.handleGoBack=()=>{this.props.current.onGoBack()},this.closeModal=()=>{this.props.current.closeModal()},(0,l.l_)(this)}}Oe=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===Ie?Object:Ie,void 0===Te?Object:Te,void 0===Et.e?Object:Et.e,void 0===Ft.k?Object:Ft.k,void 0===qt.I?Object:qt.I,void 0===At.J?Object:At.J])],Oe);const{Provider:De,useModel:xe}=(0,n.Qd)(Oe,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var Re=i(811281);const Ye=(0,a.P)((function(){const t=xe(),e=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:t.handleGoBack,backLabel:e.getLang("global_back"),onClose:t.closeModal,closeAriaLabel:e.getLang("global_close"),children:e.getLang("wall_posting_poll_header_text")}),(0,s.Y)(ue.g,{autoHideScrollbar:!0,children:(0,s.Y)(ge.c,{insetLevel:1,children:t.isLoading?(0,s.Y)(_e.y,{}):(0,s.FD)(s.FK,{children:[(0,s.Y)(me.Y,{children:e.getLang("wall_posting_poll_question_label")}),(0,s.FD)(o.gb$,{children:[(0,s.Y)(ve.e,{children:(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(o.pde,{placeholder:e.getLang("wall_posting_poll_question_placeholder"),maxLength:t.maxQuestionLength,value:t.question,onChange:e=>{t.setQuestion(e.target.value)},"data-testid":"posting_poll_form_title"})})}),(0,s.Y)(me.Y,{children:e.getLang("wall_posting_poll_answer_label")}),Object.keys(t.answers).map(((i,n)=>(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(ve.e,{removable:0!==n,onRemove:()=>t.deleteAnswer(i),children:(0,s.Y)(o.pde,{value:t.answers[i].text,maxLength:t.maxAnswerLength,placeholder:e.getLang("wall_posting_poll_answer_placeholder"),onChange:e=>{t.setAnswer(i,e.target.value)},"data-testid":"posting_poll_form_options",autoFocus:!0})})},i)))]}),t.canAddAnswer&&(0,s.Y)(ye.f,{before:(0,s.Y)(Ae.F,{className:(0,fe.I)("color_icon_secondary")}),onClick:()=>t.addAnswerRow(),"data-testid":"posting_poll_form_option_add",children:e.getLang("wall_posting_poll_add_answer")}),(0,s.Y)(me.Y,{children:e.getLang("wall_posting_poll_options_label")}),(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(Se.S,{checked:t.isAnonymous,disabled:t.isEdit,onChange:e=>t.setIsAnonymous(e.target.checked),"data-testid":"posting_poll_form_anonymous",children:e.getLang("wall_posting_poll_isanon_label")})}),(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(Se.S,{checked:t.isMultiple,disabled:t.isEdit,onChange:e=>t.setIsMultiple(e.target.checked),"data-testid":"posting_poll_form_multuple",children:e.getLang("wall_posting_poll_is_multiple_label")})}),(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(Se.S,{checked:t.disableUnvote,disabled:t.isEdit,onChange:e=>t.setDisableUnvote(e.target.checked),"data-testid":"posting_poll_form_no_cancel",children:e.getLang("wall_posting_poll_disable_unvote_label")})}),(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(Se.S,{checked:t.limitedTime,onChange:e=>t.setLimitedTime(e.target.checked),"data-testid":"posting_poll_form_limited",children:e.getLang("wall_posting_poll_limited_time_label")})}),(0,s.Y)(Pe.n,{children:()=>t.limitedTime?(0,s.Y)(ve.e,{children:(0,s.Y)(o.J3s,{disablePast:!0,enableTime:!0,closeOnChange:!0,value:t.endDate,onChange:t.setEndDate,"data-testid":"posting_poll_form_limited_input"})}):null})]})})}),(0,s.Y)(we.j,{actions:(0,s.Y)(be.$,{size:"m",mode:"primary",appearance:"accent",loading:t.isRequestPending,disabled:t.isRequestPending||t.isLoading||!t.isValid,onClick:t.isEdit?t.handleEditPoll:t.handleCreatePoll,"data-testid":"posting_poll_form_submit",children:e.getLang("wall_posting_poll_submit_button_label")})})]})})),Fe=(0,n.jn)(De,Ye);var Be=i(619984),Ne=i(347600);const ze=(0,Ne.E)((()=>Promise.all([i.e(26645),i.e(32772),i.e(82960),i.e(2282),i.e(25701),i.e(60867),i.e(66894),i.e(54802),i.e(41230),i.e(52867),i.e(61415),i.e(87322),i.e(37026),i.e("langs/core_spa/PostingScreenPhotoEditor")]).then(i.bind(i,680164))),(({PostingScreenPhotoEditor:t})=>t)),Ve=(0,Ne.E)((()=>Promise.all([i.e(32772),i.e(82960),i.e(2282),i.e(52867),i.e(87322),i.e(8019),i.e("langs/core_spa/PostingScreenPhotoCrop")]).then(i.bind(i,572612))),(({PostingScreenPhotoCrop:t})=>t));var Ue=i(47417),Ge=i(187233),je=i(120125),We=i(638945),He=i(721990),$e=i(982444),Ke=i(292184),qe=i(505174),Qe=i(880414),Je=i(94988),Xe=i(46284),Ze=i(478147);const ti=t=>{const{co_ownership_enabled:e,blacklisted:i,blacklisted_by_me:s}=t;return{coownershipDisabled:!e,blacklisted:i,blacklistedByMe:s}},ei=t=>{const{co_ownership_enabled:e}=t;return{coownershipDisabled:!e}},ii=({item:t,after:e,onClick:i})=>{const o=(({profile:t,group:e,description:i})=>{const s=(0,ke.B)();if(t){const{coownershipDisabled:e,blacklisted:i,blacklistedByMe:o}=ti(t);if(e)return s.sex(t.sex??0,s.getLang("wall_choose_post_coauthors_modal_coownership_disabled",!0));if(o)return s.getLang("wall_choose_post_coauthors_modal_coownership_blacklisted_by_me");if(i)return s.sex(t.sex??0,s.getLang("wall_choose_post_coauthors_modal_coownership_blacklisted",!0))}if(e){const{coownershipDisabled:t}=ei(e);if(t)return s.getLang("wall_choose_post_coauthors_modal_group_coownership_disabled")}return i})(t),n=(({profile:t,group:e})=>t?`${t.first_name} ${t.last_name}`:e?.name??"")(t),a=(({profile:t,group:e})=>{if(t){const{coownershipDisabled:e,blacklisted:i,blacklistedByMe:s}=ti(t);return Boolean(e||i||s)}if(e){const{coownershipDisabled:t}=ei(e);return t}return!1})(t),r=(({profile:t,group:e})=>t?t.photo_base:e?.photo_base??"")(t),d=(({profile:t,group:e})=>e?.id?w.z.convertGroupIdToOwnerId(e.id):t?.id)(t);return(0,s.Y)(Ke.T,{"data-testid":"coowner_picker_item","data-ownerid":d,disabled:a,onClick:i,subtitle:(0,s.Y)(We.tW,{"data-testid":"coowner_picker_item_description",children:o}),before:(0,s.Y)(qe.e,{"data-testid":"coowner_picker_item_avatar",size:36,src:r}),after:e,children:(0,s.Y)(Qe.b,{"data-testid":"coowner_picker_item_title",lines:1,children:n})})},si=()=>(0,s.Y)(Ke.T,{hasHover:!1,hasActive:!1,before:(0,s.Y)(Je.B,{children:(0,s.Y)(Xe.E,{width:36,height:36,circle:!0})}),after:(0,s.Y)(Ze.L,{size:24,children:(0,s.Y)(Xe.E,{width:24,height:24,circle:!0})}),subhead:(0,s.Y)(Xe.E,{width:196}),children:(0,s.Y)(Xe.E,{width:96})});var oi=i(16496),ni=i(704178),ai=i(189845),ri=i(876126),di=i(799649),ci=i(475118),li=i(225505),hi=i(11688);const pi=({item:t,onDelete:e})=>{if(!t)return null;const i="group"===t.type,o=i?t.group?.name:t.profile?.first_name,n=i?t.group?.photo_base:t.profile?.photo_base;return(0,s.Y)(ai.F,{"data-testid":"coowner_picker_selected_item_cell",hasHover:!1,hasActive:!1,header:(0,s.Y)(Qe.b,{"data-testid":"coowner_picker_selected_item_title",lines:1,children:o}),children:(0,s.Y)(ri.g,{size:56,src:n,"data-testid":"coowner_picker_selected_item_avatar",children:(0,s.Y)(ri.g.Badge,{placement:"top-right",children:(0,s.Y)(di.K,{"data-testid":"coowner_picker_selected_item_remove_button",size:24,onClick:e,children:(0,s.Y)(hi.i,{})})})})})},ui=(0,a.P)((function({selectedItemsStore:t,dataStore:e}){const i=t.selectedItems.reduce(((t,i)=>{const s=e.getCoOwner(i);return s&&t.push({item:s,id:i}),t}),[]);return i.length?(0,s.FD)(s.FK,{children:[(0,s.Y)(ci.x.HorizontalScroll,{"data-testid":"coowner_picker_selected_items",children:i.map((e=>{const{item:i,id:o}=e;return(0,s.Y)(ci.x.Item,{children:(0,s.Y)(pi,{item:i,onDelete:()=>{t.removeItem(o)}})},o)}))}),(0,s.Y)($e.K,{size:12,children:(0,s.Y)(li.w,{})})]}):null}));var gi=i(724075),_i=i(345482);const mi=["co_ownership_enabled","sex","is_nft","photo_base","blacklisted","blacklisted_by_me"];class vi{get items(){return this.coOwnersData.getCoOwners(this.itemIds)}async fetchNext(){if(!(this.isLoading||this.total&&this.itemIds.length>=this.total)){this.isLoading=!0,this.isError=!1,this.controller=new AbortController;try{const t=await this.searchApi.getCoowners({fields:this.fields,limit:this.limit,q:this.searchQuery,offset:this.itemIds.length},{signal:this.controller.signal}),{items:e,total:i,count:s}=t;this.isLoading=!1,this.coOwnersData.addItems(e),this.itemIds.push(...e.map(b)),this.total=i,this.count=s}catch{this.isLoading=!1,this.isError=!0}}}abort(){this.isLoading&&this.controller&&(this.controller.abort(),this.isLoading=!1,this.isError=!1)}constructor(t,e,{fields:i,limit:s,searchQuery:o}={}){this.searchApi=t,this.coOwnersData=e,this.isLoading=!1,this.isError=!1,this.total=0,this.count=0,this.itemIds=[],(0,l.l_)(this),this.searchQuery=o??"",this.limit=s??50,this.fields=(i??mi).join(",")}}class yi{getList(t){return new vi(this.searchApi,this.coOwnersData,t)}constructor(t,e){this.searchApi=t,this.coOwnersData=e,(0,l.l_)(this)}}yi=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===_i.J?Object:_i.J,void 0===P?Object:P])],yi);var fi=i(486526);class Si{get listMaxHeight(){const t=this.props.current.listMaxHeight,e=this.props.current.selectedItems.selectedItems.length>0;return t&&e?t-100:t}updateList(){this.coOwnersList?.abort(),this.coOwnersList=this.coOwnersLists.getList({searchQuery:this.searchQuery}),this.fetchNext()}constructor(t,e,i){this.coOwnersLists=t,this.dataService=e,this.props=i,this.searchQuery="",this.coOwnersList=void 0,this.fetchNext=()=>{this.coOwnersList?.fetchNext()},this.setSearchQuery=t=>{this.searchQuery=t,this.updateListDebounced()},this.updateListDebounced=(0,fi.s)(this.updateList.bind(this),500),(0,l.l_)(this),this.updateList()}}Si=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===yi?Object:yi,void 0===P?Object:P,void 0===n.Ji?Object:n.Ji])],Si);const{useModel:wi,Provider:bi}=(0,n.Qd)(Si,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0}),Pi=({children:t,maxHeight:e,getRef:i})=>e?(0,s.Y)(je._,{height:e,getRef:i,autoHideScrollbar:!0,children:t}):t,Ai=(0,a.P)((function({children:t}){const e=wi(),i=(0,ke.B)(),[o,n]=(0,d.useState)(null);return(0,gi.M)(!0,e.fetchNext,e.props.current.scrollContainer?e.props.current.scrollContainer:o),e.props.current.selectedItems?(0,s.FD)(s.FK,{children:[(0,s.Y)(Ge.i,{mode:"horizontal",spacing:8,children:(0,s.Y)(We.EY,{className:(0,fe.I)("color_text_secondary"),children:i.getLang("wall_choose_post_coauthors_modal_description")})}),(0,s.Y)(ui,{selectedItemsStore:e.props.current.selectedItems,dataStore:e.dataService}),(0,s.Y)(He.v,{value:e.searchQuery,onChange:t=>{e.setSearchQuery(t.target.value)},"data-testid":"coowner_picker_search_field"}),(0,s.Y)($e.K,{size:4}),(0,s.Y)(Ge.i,{mode:"horizontal",spacing:8,children:(0,s.Y)(We.$j,{size:1,children:e.searchQuery?i.getLang("wall_choose_post_coauthors_modal_global_search"):i.getLang("wall_choose_post_coauthors_modal_recommended_coauthors")})}),(0,s.FD)(Pi,{maxHeight:e.listMaxHeight,getRef:n,children:[!e.coOwnersList?.items.length&&e.coOwnersList?.isLoading&&[...Array(10)].map(((t,e)=>(0,s.Y)(si,{},e))),e.coOwnersList?.items.map((({item:t,id:i})=>{if(((t,e)=>!(!e||(w.z.isGroupId(e)&&t.group?.id?w.z.convertOwnerIdToGroupId(e)!==t.group?.id:!w.z.isUserId(e)||!t.profile?.id||e!==t.profile?.id)))(t,e.props.current.ownerId))return null;const o=e.props.current.selectedItems?.getIsSelected(i);return(0,s.Y)(ii,{item:t,after:o?(0,s.Y)(oi.d,{}):(0,s.Y)(ni.T,{className:(0,fe.I)("color_icon_tertiary")}),onClick:()=>{o||e.props.current.selectedItems?.selectedItems.length!==e.props.current.maxCheckItems?o?e.props.current.selectedItems?.removeItem(i):e.props.current.selectedItems?.addItem(i):e.props.current.onMaxCheckItemsLimitReached?.()}},i)})),t]})]}):null})),ki=(0,n.jn)(bi,Ai);class Ci{constructor(t=[]){this.selectedItems=t,this.getIsSelected=t=>this.selectedItems.includes(t),this.addItem=t=>{this.getIsSelected(t)||this.selectedItems.push(t)},this.removeItem=t=>{const e=this.selectedItems.indexOf(t);e>-1&&this.selectedItems.splice(e,1)},this.cleanItems=()=>{this.selectedItems.splice(0,this.selectedItems.length)},this.init=t=>{this.cleanItems(),this.selectedItems.push(...t)},(0,l.l_)(this)}}class Ii{[n.Ts](){this.props.current.refreshCoordinates?.()}constructor(t){this.props=t,(0,l.l_)(this),this.selectedItems=new Ci([...this.props.current.items])}}Ii=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji])],Ii);const{useModel:Ei,Provider:Li}=(0,n.Qd)(Ii,{initInEffect:!1,isolatedContext:!1,onlyTransient:!0}),Ti=(0,a.P)((function({selectedItemsStore:t,actionButtons:e}){const i=(0,ke.B)();return(0,s.Y)(we.j,{"data-testid":"coowner_picker_footer",before:i.langReplace(i.numeric(t.selectedItems.length,i.getLang("wall_choose_post_coowners_choosen_title",!0)),{count:String(t.selectedItems.length)}),actions:e})})),Mi=(0,n.jn)(Li,(()=>{const t=(0,ke.B)(),e=Ei();return e.selectedItems?(0,s.FD)(s.FK,{children:[(0,s.Y)(Ue.r,{onClose:()=>{e.props.current.onClose?.()},backLabel:t.getLang("global_back"),onBack:e.props.current.onClose,closeAriaLabel:t.getLang("global_close"),children:t.getLang("wall_choose_post_coauthors_modal_header")}),(0,s.Y)(ge.c,{insetLevel:0,children:(0,s.Y)(Ge.i,{mode:"vertical",spacing:12,paddingTop:8,paddingBottom:0,children:(0,s.Y)(ki,{onMaxCheckItemsLimitReached:e.props.current.onMaxCheckItemsLimitReached,selectedItems:e.selectedItems,maxCheckItems:e.props.current.maxCheckItems,listMaxHeight:e.props.current.listMaxHeight,ownerId:e.props.current.ownerId})})}),(0,s.Y)(Ti,{selectedItemsStore:e.selectedItems,actionButtons:(0,s.Y)(s.FK,{children:(0,s.Y)(be.$,{"data-testid":"coowner_picker_save",size:"m",onClick:()=>{e.props.current.onSaveClick?.(e.selectedItems?.selectedItems??[])},children:t.getLang("wall_choose_post_coauthors_modal_save")})})})]}):null}));var Oi=i(710345);class Di{[n.Ts](){this.productAnalyticsLogger.logCoauthorsEvent(Oi.n.CoownersOpenModal)}get selectedIds(){return this.props.current.selectedCoOwnersIds}constructor(t,e){this.props=t,this.productAnalyticsLogger=e,this.handleSelect=t=>{this.props.current.onSelect(t)},this.handleClosePicker=()=>{this.props.current.onClose()},this.handleRefreshCoordinates=()=>{this.props.current.onRefreshCoordinates?.()},(0,l.l_)(this)}}Di=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===qt.I?Object:qt.I])],Di);const{Provider:xi,useModel:Ri}=(0,n.Qd)(Di,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1}),Yi=(0,a.P)((function(){const t=Ri();return(0,s.Y)(Mi,{onMaxCheckItemsLimitReached:t.props.current.onMaxCheckItemsLimitReached,items:t.selectedIds,onSaveClick:t.handleSelect,listMaxHeight:441,refreshCoordinates:t.handleRefreshCoordinates,maxCheckItems:4,onClose:t.handleClosePicker,onCancelClick:t.handleClosePicker,ownerId:t.props.current.ownerId})})),Fi=(0,n.jn)(xi,Yi);var Bi=i(704399),Ni=i(181048),zi=i(754694),Vi=i(867496),Ui=i(429363),Gi=i(352201),ji=i(190682),Wi=i(25313),Hi=i(221473);class $i{async[n.Ts](){this.launchProvider.setLaunchId(this.launchId)}get modalProps(){return this.props.current}get launchId(){return this.props.current.launchId||`${this.appId}_modal`}get appId(){return this.props.current.appId}get appData(){return this.launchProvider.appData}get appTitle(){return this.appData?.title||"Mini App"}get actorId(){const{actorId:t}=this.props.current,{userId:e}=this.authService;return t?Number(t):e??void 0}get hash(){const{hash:t}=this.props.current;return!t||t.startsWith("#")?t:`#${t}`}constructor(t,e,i,s){this.props=t,this.authService=e,this.modalService=i,this.launchProvider=s,this.closeWithConfirmation=()=>{this.modalService.show({type:"MiniAppCloseConfirmationModal",data:{appTitle:this.appTitle},actions:{onConfirm:this.props.current.onClose||zi.l}})},(0,l.l_)(this)}}$i=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===wt.u?Object:wt.u,void 0===Wi.F?Object:Wi.F,void 0===Hi.n?Object:Hi.n])],$i);const{Provider:Ki,useModel:qi}=(0,n.JD)($i,{initInEffect:!1}),Qi=(0,a.P)((function(){(0,Vi.M)((0,Gi.H)({isLayer:!0}));const t=(0,d.useRef)(null),{appId:e,actorId:i,launchId:o,closeWithConfirmation:n,modalProps:a,hash:r}=qi(),{noWrapperClick:c}=a,l=c?zi.l:n;return(0,s.Y)(ji.D,{onClick:l,scrollTarget:t,children:(0,s.Y)(Ui.L,{...a,appId:e,actorId:i,launchId:o,isLayer:!1,hash:r,getScrollTarget:()=>t.current||void 0})})})),Ji=(0,n.jn)(Ki,Qi);var Xi=i(952956);class Zi{[n.Ts](){this.handleMiniAppOpen()}get appId(){const{appUrl:t}=this.props.current;if(!t||!t.includes("app"))return;const e=/app(\d+)/.exec(t);return e?Number(e[1]):void 0}get hash(){const{appUrl:t}=this.props.current;return t&&t.includes("#")?t.split("#")[1]:""}get navigate(){return()=>{}}constructor(t,e,i){this.errorLogger=t,this.webMiniAppLaunchService=e,this.props=i,this.launchId="ticket-app-launch-id",this.handleMiniAppOpen=async()=>{try{const{waitConnect:t}=this.webMiniAppLaunchService.getLaunchWaiter(this.launchId),e=await t;e?.onCustomMessage?.(this.handleCustomMessage)}catch(t){this.errorLogger.log(t)}},this.onClose=()=>{this.props.current.onClose?.()},this.handleCustomMessage=({action:t,payload:e})=>{"tickets_posting_select"===t&&this.props.current.onTicketSelect?.(e)},(0,l.l_)(this)}}Zi=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===It.v?Object:It.v,void 0===Xi.j?Object:Xi.j,void 0===n.Ji?Object:n.Ji])],Zi);const{Provider:ts,useModel:es}=(0,n.Qd)(Zi,{initInEffect:!1}),is=(0,a.P)((function(){const{appId:t,launchId:e,hash:i,onClose:o,navigate:n}=es(),{getLang:a}=(0,ke.B)();return void 0===t?((0,Ni.td)({text:a("global_error_generic_reason")}),null):(0,s.Y)(Ji,{name:"TicketsMiniAppModal",appId:t,launchId:e,onClose:o,isLayer:!1,hash:i,navigate:n,"data-testid":"posting_vk_tickets_miniapp",hasCloseButton:!0})})),ss=(0,n.jn)(ts,is);var os=i(560265),ns=i(292350),as=i(165051),rs=i(355812),ds=i(9467);const cs=(0,a.P)((function({buttons:t=[],onButtonClick:e,selectedButtonTypeString:i,vkTickets:o,onVkTicketsClearButton:n}){const a=(0,ds.z2)("frontend.web_posts_vk_tickets"),{getLang:r}=(0,ke.B)(),d=t=>a&&"vk_ticket"===t.type&&o?.selectedTicket?(0,s.Y)(Qe.b,{lines:1,children:(0,s.FD)(as.r,{separator:(0,s.Y)(rs.O,{spacing:4}),children:[o.selectedTicket.title,o.selectedTicketDate,o.selectedTicketCity]})}):t.description;return t.map((t=>{let c=null;return j(t)===i&&(c=(0,s.Y)(ye.f.Checkbox,{type:"circle",checked:!0,readOnly:!0})),"vk_ticket"===t.type&&a&&(c=o?.selectedTicket?(0,s.Y)(di.K,{label:r("global_delete"),onClick:t=>{t.stopPropagation(),n?.(),o?.clearTicket()},"data-testid":"posting_action_button_vk_ticket_remove",children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}):(0,s.Y)(ns.U,{"data-testid":"posting_action_button_vk_ticket",className:(0,fe.I)("color_icon_tertiary")})),(0,s.Y)(Ke.T,{after:c,subtitle:d(t),onClick:()=>e(t),"data-testid":`posting_action_button_picker_${t.type}`,children:t.title},`${t.type}${t.donut_goal?.goal_id}${t.donut_level?.level_id}`)}))}));class ls{async[n.Ts](){this.props.current.selectedActionButton&&(this.selectedButton=this.props.current.selectedActionButton),this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenActionButton})}get isTicketModalVisible(){return this.vkTickets.isModalVisible&&this.vkTicketAppUrl}get selectedButtonTypeString(){return this.selectedButton?j(this.selectedButton):void 0}get vkTicketAppUrl(){if(!this.vkTickets.isFeatureEnabled||!this.selectedButton||!this.vkTickets.isVkTicketButton(this.selectedButton))return;const t=this.selectedButton?.vk_ticket;return t&&"url"in t?t.url:void 0}get buttons(){return this.props.current.buttons}get donutGoals(){return this.props.current.donutGoals}get donutLevels(){return this.props.current.donutLevels}get hasDonutButtons(){return this.props.current.hasDonutButtons}get hasSelect(){return!(this.vkTickets.isFeatureEnabled&&this.vkTickets.isVkTicketButton(this.selectedButton)&&!this.vkTickets.selectedTicket)&&void 0!==this.selectedButton}[n.zr](){this.selectedButton=void 0}constructor(t,e,i){this.vkTickets=t,this.productAnalyticsLogger=e,this.props=i,this.selectedButton=void 0,this.hideTicketModal=()=>{this.vkTickets.hideModal()},this.onTicketSelect=t=>{t?(this.vkTickets.selectTicket(t),this.hideTicketModal()):this.vkTickets.clearTicket()},this.handleGoBack=()=>{this.props.current.onGoBack()},this.closeModal=()=>{this.props.current.closeModal?.()},this.onSelect=t=>{const e=this.selectedButtonTypeString===j(t);if(this.vkTickets.isFeatureEnabled&&this.vkTickets.isVkTicketButton(t)){const e=this.vkTickets.selectedTicket;return this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.TransitionToButtonDetails,attachmentsInfo:[{attachment_type:Qt.wh.ActionButton,attachment_owner_id:this.props.current.ownerId,attachments_string_value:t.type}],vkTicket:{event_id:e?.id??"",seance_id:e?.seance?.id??""}}),this.vkTickets.showModal(),void(this.selectedButton=t)}this.selectedButton=e?void 0:t},this.onSave=()=>{if(this.selectedButton){let t={type:this.selectedButton.type};this.selectedButton.donut_goal?t.donut_goal=this.selectedButton.donut_goal:this.selectedButton.donut_level?t.donut_level=this.selectedButton.donut_level:this.selectedButton.vk_ticket&&this.vkTickets.isFeatureEnabled&&this.vkTickets.selectedTicket&&(t.vk_ticket=this.selectedButton.vk_ticket,t.vk_ticket_data=this.vkTickets.selectedTicket),this.props.current.onSave?.(this.selectedButton.type,t)}this.handleGoBack()},this.vkTicketsClearButtonAnalytics=()=>{if(!this.vkTickets.isFeatureEnabled)return;const t=this.vkTickets.selectedTicket;this.productAnalyticsLogger.logAddAttachmentEvent({addAttachmentEventType:Qt.ZX.DeleteActionButton,attachmentsInfo:[{attachment_type:Qt.wh.ActionButton,attachment_owner_id:this.props.current.ownerId,attachments_string_value:"vk_ticket"}],vkTicket:{event_id:t?.id??"",seance_id:t?.seance?.id??""}})},(0,l.l_)(this)}}ls=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===ce?Object:ce,void 0===qt.I?Object:qt.I,void 0===n.Ji?Object:n.Ji])],ls);const{Provider:hs,useModel:ps}=(0,n.Qd)(ls,{initInEffect:!1}),us=(0,a.P)((function(){const t=(0,ke.B)(),{handleGoBack:e,closeModal:i,onSelect:o,onSave:n,onTicketSelect:a,hideTicketModal:r,vkTicketsClearButtonAnalytics:d,isTicketModalVisible:c,hasSelect:l,hasDonutButtons:h,buttons:p,donutGoals:u,donutLevels:g,selectedButtonTypeString:_,vkTicketAppUrl:m,vkTickets:v}=ps();return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:e,backLabel:t.getLang("global_back"),onClose:i,closeAriaLabel:t.getLang("global_close"),children:t.getLang("wall_posting_actions_button_header")}),(0,s.Y)(ue.g,{autoHideScrollbar:!0,children:(0,s.FD)(Ge.i,{children:[h&&(0,s.Y)(me.Y,{mode:"secondary",children:t.getLang("wall_posting_actions_buttons_actions_header")}),(0,s.Y)(cs,{buttons:p,selectedButtonTypeString:_,onButtonClick:o,vkTickets:v,onVkTicketsClearButton:d}),Boolean(g.length)&&(0,s.FD)(s.FK,{children:[(0,s.Y)(Bi.F,{size:16}),(0,s.Y)(me.Y,{mode:"secondary",children:t.getLang("wall_posting_actions_buttons_levels_header")}),(0,s.Y)(cs,{buttons:g,selectedButtonTypeString:_,onButtonClick:o})]}),Boolean(u.length)&&(0,s.FD)(s.FK,{children:[(0,s.Y)(Bi.F,{size:16}),(0,s.Y)(me.Y,{mode:"secondary",children:t.getLang("wall_posting_actions_buttons_goals_header")}),(0,s.Y)(cs,{buttons:u,selectedButtonTypeString:_,onButtonClick:o})]})]})}),(0,s.Y)(we.j,{actions:(0,s.Y)(be.$,{size:"m",mode:"primary",appearance:"accent",onClick:n,disabled:!l,"data-testid":"posting_action_button_save_button",children:t.getLang("global_save")})}),c&&Boolean(m)&&(0,s.Y)(ss,{onClose:r,onTicketSelect:a,appUrl:m})]})})),gs=(0,n.jn)(hs,us),_s=(0,Ne.E)((()=>Promise.all([i.e(98657),i.e("langs/core_spa/PostingScreenAddProduct")]).then(i.bind(i,967610))),(({PostingScreenAddProduct:t})=>t));var ms=i(308055),vs=i(865940),ys=i(413621),fs=i(390491),Ss=i(40176),ws=i(352039),bs=i(787920);const Ps=(t=!0)=>{const e=t?"visible":"hidden",i=t?"1":"0",s=document.getElementById("box_layer_bg"),o=document.getElementById("box_layer_wrap");o&&s&&(o.style.visibility=e,s.style.visibility=e,o.style.opacity=i)},As=(0,a.P)((function({errorManager:t,disabled:e,ordData:i,markedAsAds:o,changeOrdData:n,openOrdMiniApp:a,isSpaOrdLaunch:r}){const d=(0,ke.B)();return(0,s.Y)(Ke.T,{"data-testid":"posting_ord_cell",onClick:async()=>{if(e)return void t.showErrorSnackbar(T.Rn.OrdEditNotAllowed);const s=window.cur?.module,o={isSnackbar:!0,edit:!1,options:{noLocChange:1,skipBoxesHide:1,hideBackButton:1,hideCloseButton:1,noClickHide:1,onLoaded:()=>{const t=document.querySelector(".app_actions_menu_wrap");t&&(t.style.display="none"),Ps(!1),s&&(window.cur.module=s)},onHide:()=>Ps(),onFail:()=>Ps()}};if(r)try{const t=await a(i,{isSnackbar:!0,onLoaded:o.options.onLoaded,onHide:()=>Ps()});n(t)}catch{Ps()}else(0,bs.S)(i,n,o)},subtitle:(0,s.Y)("span",{"data-testid":"posting_ord_cell_subtitle",children:o?(0,s.Y)("span",{className:(0,fe.I)("color_text_accent"),children:d.getLang("wall_posting_ord_subtitle_added")}):d.getLang("wall_posting_ord_subtitle_empty")}),children:d.getLang("wall_posting_ord_label")})}));var ks=i(31649),Cs=i(3356),Is=i(782536);class Es{[n.Ts](){this.date=this.props.current.publishDate||this.defaultDateTime}constructor(t,e,i){this.langs=t,this.productAnalyticsLogger=e,this.props=i,this.defaultDateTime=new Date(Date.now()+36e5),this.isCalendarShown=!1,this.date=void 0,this.logOpenCalendar=()=>{this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.OpenPostponed})},this.logChangeDate=()=>{this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.ChangePostponed,postponedTime:Number(this.date)})},this.getSubtitle=()=>{const t=this.props.current.publishDate;return t?this.langs.date(t,(new Date).getFullYear()===t.getFullYear()?this.langs.getLang("global_date_time",!0):this.langs.getLang("global_date_year_time",!0),this.langs.getLang("months_sm_of",!0),{offset:0}):this.langs.getLang("wall_publication_now")},this.handleShownChange=t=>{if(this.isCalendarShown=t,t){const{publishDate:t,changePublishDate:e,proposedPublishedDate:i}=this.props.current;this.logOpenCalendar(),!t&&i?(e(i),this.date=i):(this.date=t||this.defaultDateTime,e(t||this.defaultDateTime))}},this.handleCloseCalendar=()=>{this.handleShownChange(!1),this.logChangeDate()},this.handleKeyDown=t=>{"Escape"===t.key&&(t.stopPropagation(),this.handleCloseCalendar())},this.handleChangeDate=t=>{this.date=t,this.props.current.changePublishDate(t)},this.handleResetChanges=()=>{this.date=void 0,this.props.current.changePublishDate(void 0),this.handleCloseCalendar()},this.handleClearDate=t=>{t.stopPropagation(),this.handleResetChanges()},(0,l.l_)(this)}}Es=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===ft.Y?Object:ft.Y,void 0===qt.I?Object:qt.I,void 0===n.Ji?Object:n.Ji])],Es);const{Provider:Ls,useModel:Ts}=(0,n.Qd)(Es,{initInEffect:!1});var Ms=i(762964);const Os=(0,a.P)((function(){const{getSubtitle:t,handleShownChange:e,isCalendarShown:i,date:o,handleChangeDate:n,handleResetChanges:a,props:{current:{publishDate:r,after:c,disabled:l}}}=Ts(),h=(0,d.useMemo)((()=>new Date),[]),p=(0,d.useMemo)((()=>{const t=new Date;return t.setFullYear(t.getFullYear()+1),t}),[]),u=(0,ke.B)(),g=(0,ms.$)((t=>{t.stopPropagation(),e(!1)}),[e]),_=(0,d.useCallback)(((t,i)=>{if(!t)switch(i){case"callback":case"escape-key":case"click-outside":e(!1)}}),[]);return(0,s.Y)(s.FK,{children:(0,s.Y)(ks.A,{trigger:"manual",placement:"top-end",onShownChange:_,shown:i,role:"dialog",content:(0,s.Y)(Cs.V,{enableTime:!0,value:o,onChange:n,onClose:a,minDateTime:h,maxDateTime:p,getRootRef:g,doneButtonText:u.getLang("wall_posting_reset_calendar_selection")}),children:(0,s.FD)(Is.e,{gap:"m",children:[(0,s.Y)(be.$,{before:r?"":(0,s.Y)(Ms.K,{}),size:"m",mode:"secondary",onClick:()=>e(!i),"data-testid":"posting_postponed_button",disabled:l,children:(0,s.Y)("span",{"data-testid":"posting_postponed_cell_title",children:r?t():u.getLang("wall_posting_planning")})}),c]})})})})),Ds=(0,n.jn)(Ls,Os);var xs=i(34287);const Rs=(0,a.P)((function({geo:t,onClick:e,onRemove:i,isMvk:o}){const n=(0,ke.B)();return(0,s.Y)(Ke.T,{"data-testid":"posting_geo_picker_cell",onClick:e,minHeight:o?T.BL:T.MV,before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:T.JG,alt:"",children:(0,s.Y)(xs.H,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:t?.place?.address,after:!!t&&(0,s.Y)(di.K,{"data-testid":"posting_geo_picker_cell_remove",label:n.getLang("global_delete"),onClick:i,children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),children:(0,s.Y)("span",{"data-testid":"posting_geo_picker_cell_selected_place_title",children:t?.place?.title||n.getLang("wall_posting_place")})})}));var Ys=i(393741),Fs=i(694057),Bs=i(246618),Ns=i(329610),zs=i(216549);const Vs={s:Bs.A,m:Ns.w},Us=(0,a.P)((function({currentActionButtonType:t,onClick:e,buttons:i,onRemove:n,onSelect:a,hasDonutButtons:r,hasOnboardingHighlighter:d,getRootRef:c,hasChevron:l,onboarding:h,onboardingShowProducts:p,onHideOnboarding:u,vkTickets:g,size:_="m"}){const m=(0,ke.B)(),v=Vs[_],y=(0,ds.z2)("frontend.web_posts_vk_tickets"),f=(e,i,s)=>{e.stopPropagation(),t?n():a(i,s)},S=t=>{t.stopPropagation(),n()},w=t=>y&&"vk_ticket"===t.type&&g?.selectedTicket?(0,s.Y)(Qe.b,{lines:1,children:(0,s.FD)(as.r,{separator:(0,s.Y)(rs.O,{spacing:4}),children:[g.selectedTicket.title,g.selectedTicketDate,g.selectedTicketCity]})}):t.description,b=(0,s.Y)(Ys.V,{tipPosition:"top-right",shown:Boolean(h),onClose:u,onClick:u,onMarkerClick:u,size:48,maxWidth:180,mode:"1",appearance:"lime",tilt:"left",content:h?.title,autoUpdateOnTargetResize:!0,children:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:T.JG,children:(0,s.Y)(v,{className:(0,fe.I)("color_icon_secondary")})})});if(1===i.length){const e=i[0],{title:n,type:a}=e;return(0,s.Y)(Ke.T,{Component:"label",before:b,"data-testid":`posting_action_button_selected_${a}`,minHeight:l?T.BL:T.MV,subtitle:w(e),after:(0,s.Y)(o.dOG,{"data-testid":"posting_action_button_switch",checked:j(e)===t,onChange:t=>(0,ds.z2)("feed_posting_action_button_switch_fix")?f(t,a,e):f(t,a)}),getRootRef:c,children:d?(0,s.Y)(Fs.j,{shape:4,appearance:"lime",animated:!0,children:n}):n})}if(t){const o=i.find((e=>j(e)===t));if(o)return(0,s.Y)(Ke.T,{onClick:e,before:b,"data-testid":`posting_action_button_selected_${o.type}`,minHeight:l?T.BL:T.MV,subtitle:w(o),after:(0,s.Y)(di.K,{label:m.getLang("global_delete"),onClick:S,"data-testid":"posting_action_button_remove",children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),getRootRef:c,children:(0,s.Y)("span",{"data-testid":"posting_action_buttons_cell_title",children:o.title})})}return(0,s.Y)(Ke.T,{"data-testid":"posting_open_action_button_picker",before:b,onClick:e,minHeight:l?T.BL:T.MV,subtitle:r?m.getLang("wall_posting_action_button_donut_subtitle"):"",after:l?(0,s.Y)(zs.w,{}):void 0,getRootRef:c,children:d?(0,s.Y)(Fs.j,{shape:4,appearance:"lime",animated:!0,children:m.getLang("wall_posting_action_button")}):(0,s.Y)(Ys.V,{tipPosition:"top-right",shown:Boolean(p),onClose:u,onClick:u,onMarkerClick:u,size:86,maxWidth:254,mode:"6",appearance:"lime",tilt:"right",content:p?.description,autoUpdateOnTargetResize:!0,"data-testid":"posting_action_button_show_products_onboarding",children:(0,s.Y)("span",{children:m.getLang("wall_posting_action_button")})})})})),Gs=(0,a.P)((function({disabledDueToAuthor:t,disabledDueToCoauthors:e,onChange:i,signedSettingDescription:n,signed:a,errorManager:r}){const d=(0,ke.B)();return(0,s.Y)(Ke.T,{Component:"label",after:(0,s.Y)(o.dOG,{checked:a,onChange:s=>{t?r.showErrorSnackbar(T.Rn.SignSettingChangeDisabled):e?r.showErrorSnackbar(T.Rn.SignSettingDisabledDueToCoauthors):i(s.target.checked)},"data-testid":"posting_settings_sign_switch_input"}),subtitle:n,multiline:!0,"data-testid":"posting_settings_sign_switch",children:d.getLang("wall_posting_settings_signed_title")})}));var js=i(91720),Ws=i(31312);class Hs{get saveNotAllowed(){return Boolean(this.props.current.publishDate)}get disabled(){return Boolean(this.props.current.disabled)}get isDraft(){return this.props.current.isDraft}get draftsCount(){return Number(this.props.current.draftsCount)}get text(){return this.isDraft?this.langs.getLang("wall_posting_drafts_changes_save"):this.langs.getLang("wall_posting_drafts_save")}get postingRemoteDraftsOnboarding(){if(!this.disabled&&!this.saveNotAllowed)return this.helpHints.get(Ws.L.ACCOUNT_HINT_POSTING_REMOTE_DRAFTS_ONBOARDING)}constructor(t,e,i,s){this.langs=t,this.props=e,this.errorManager=i,this.helpHints=s,this.handleClick=()=>this.saveNotAllowed?this.errorManager.showErrorSnackbar(T.Rn.DraftWithPublishDateNotAllowed):this.props.current.onClick(),this.hidePostingRemoteDraftsOnboarding=async()=>{this.postingRemoteDraftsOnboarding&&await this.helpHints.hide(Ws.L.ACCOUNT_HINT_POSTING_REMOTE_DRAFTS_ONBOARDING)},(0,l.l_)(this)}}Hs=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===ft.Y?Object:ft.Y,void 0===n.Ji?Object:n.Ji,void 0===Et.e?Object:Et.e,void 0===S.a?Object:S.a])],Hs);const{Provider:$s,useModel:Ks}=(0,n.Qd)(Hs,{initInEffect:!1}),qs=(0,a.P)((function(){const{handleClick:t,text:e,disabled:i,postingRemoteDraftsOnboarding:o,hidePostingRemoteDraftsOnboarding:n}=Ks();return(0,s.Y)(Ys.V,{tipPosition:"top-right",shown:Boolean(o),onClick:n,onClose:n,onMarkerClick:n,size:96,maxWidth:256,mode:"6",appearance:"lime",tilt:"right",content:o?.title,autoUpdateOnTargetResize:!0,children:(0,s.Y)(be.$,{mode:"link",appearance:"accent",onClick:t,disabled:i,"data-testid":"posting_draft_save_action",children:e})})})),Qs=(0,js.N)($s,qs);var Js=i(255121);const Xs=(0,a.P)((function(t){const{onSubmit:e,onCancel:i}=t,o=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",multiline:!0,children:o.getLang("wall_posting_settings_coowners_closed_profile_alert_title")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_closed_profile_alert_submit",onClick:e,children:o.getLang("wall_posting_settings_coowners_closed_profile_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_closed_profile_alert_cancel",onClick:i,children:o.getLang("wall_posting_settings_coowners_closed_profile_alert_cancel")})]})})),Zs=(0,a.P)((function(t){const{onSubmit:e,onCancel:i}=t,o=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",multiline:!0,children:o.getLang("wall_posting_settings_coowners_closed_community_alert_title")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_closed_group_alert_submit",onClick:e,children:o.getLang("wall_posting_settings_coowners_closed_community_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_closed_group_alert_cancel",onClick:i,children:o.getLang("wall_posting_settings_coowners_closed_community_alert_cancel")})]})})),to=(0,a.P)((function(t){const{onSubmit:e,onCancel:i}=t,o=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",multiline:!0,children:o.getLang("wall_posting_settings_coowners_signed_alert_title")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_signed_alert_submit",onClick:e,children:o.getLang("wall_posting_settings_coowners_signed_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_signed_alert_cancel",onClick:i,children:o.getLang("wall_posting_settings_coowners_signed_alert_cancel")})]})})),eo=(0,a.P)((function(t){const{onSubmit:e,onCancel:i}=t,o=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",multiline:!0,children:o.getLang("wall_posting_settings_coowners_privacy_alert_title")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_privacy_alert_submit",onClick:e,children:o.getLang("wall_posting_settings_coowners_privacy_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_coowners_privacy_alert_cancel",onClick:i,children:o.getLang("wall_posting_settings_coowners_privacy_alert_cancel")})]})})),io=(0,a.P)((function(t){const e=(0,ke.B)(),{postManager:i,onboarding:o,firstCoOwner:n,userOwner:a,groupOwner:r,loading:c,alerts:l,onHideOnboarding:h,onOpenPickerClick:p,onChangePrivacy:u}=t,{coOwnersIds:g}=i,{settingCoOwnersWithAuthorSignature:_,settingCoOwnersWithPrivacy:m,settingCoOwnersWithClosedProfile:v,settingCoOwnersWithClosedGroup:y}=l,f=_||m||v||y,[S,w]=(0,d.useState)(!1);if(n){const t=t=>{t.stopPropagation(),i.setCoOwners([])};return(0,s.Y)(Ke.T,{disabled:c,minHeight:T.BL,onClick:p,before:(0,s.Y)(qe.e,{src:n.photo_100,size:T.JG,alt:D(n)}),after:c?(0,s.Y)(_e.y,{}):(0,s.Y)(di.K,{"data-testId":"posting_coowners_remove",label:e.getLang("global_delete"),onClick:t,children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:1===g.length?e.getLang("wall_posting_settings_coowners_one_selected_description"):e.numeric(g.length-1,e.getLang("wall_posting_settings_coowners_many_selected_description",!0)).replace("{count}",String(g.length-1)),"data-testId":"posting_coowners_cell_with_value",children:D(n)})}const b=(0,s.Y)(Ke.T,{disabled:c,minHeight:T.BL,onClick:f?()=>w(!0):p,before:(0,s.Y)(Ys.V,{tipPosition:"top-right",shown:Boolean(o),onClose:h,onClick:h,onMarkerClick:h,size:48,maxWidth:180,mode:"1",appearance:"lime",tilt:"left",content:o?.title,autoUpdateOnTargetResize:!0,children:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:T.JG,alt:e.getLang("global_wall_post_add_coauthors"),children:(0,s.Y)(Js.c,{className:(0,fe.I)("color_icon_secondary")})})}),after:c?(0,s.Y)(_e.y,{}):void 0,"data-testId":"posting_coowners_cell",children:e.getLang("global_wall_post_add_coauthors")});let P;if(f){const t=()=>w(!1);let e;return v?(P="posting_coowners_closed_profile_alert",e=(0,s.Y)(Xs,{onSubmit:()=>a?.openProfile(),onCancel:t})):y?(P="posting_coowners_closed_group_alert",e=(0,s.Y)(Zs,{onSubmit:()=>r?.openGroup(),onCancel:t})):_?(P="posting_coowners_with_author_signature_alert",e=(0,s.Y)(to,{onSubmit:()=>i.setSigned(!1),onCancel:t})):(P="posting_coowners_privacy_alert",e=(0,s.Y)(eo,{onSubmit:u,onCancel:t})),(0,s.Y)(vs.v,{width:250,trigger:"click",shown:S,content:e,onShownChange:t=>{w(t)},"data-testId":P,children:b})}return b}));var so=i(753833);const oo=({type:t,withColorChange:e=!0,donutLevelString:i=""})=>{const o=(0,ke.B)();if(i)return(0,s.Y)("div",{children:o.langReplace(o.getLang("wall_posting_privacy_donut_level_label"),{level:i})});switch(t){case"best_friends":return(0,s.Y)("div",{className:e?(0,fe.I)("color_text_positive"):void 0,children:o.getLang("wall_posting_privacy_type_best_friends")});case"friends":return(0,s.Y)("div",{className:e?(0,fe.I)("color_text_accent"):void 0,children:o.getLang("wall_posting_privacy_type_friends_only")});case"donut":return(0,s.Y)("div",{className:e?(0,fe.I)("color_accent_orange"):void 0,children:o.getLang("wall_posting_privacy_type_donut")});default:return(0,s.Y)("div",{children:o.getLang("wall_posting_privacy_type_all")})}},no=Ws.L.ACCOUNT_HINT_DONUT_CUSTOM_TEASER_TEXT,ao=(0,a.P)((function({onOpenDonutTeaserScreen:t,onClearDonutTeaserText:e,donutTeaserText:i,helpHints:o,after:n}){const a=(0,ke.B)(),r=o?.get(no),d=()=>{r&&o?.hide(no)},c=a.getLang("wall_posting_donut_teaser_header"),l=i?a.langReplace(a.getLang("wall_posting_donut_teaser_custom_text"),{text:i}):a.getLang("wall_posting_donut_teaser_by_default_text");return(0,s.Y)(Ke.T,{onClick:()=>{d(),t()},minHeight:56,"data-testid":"posting_settings_donut_teaser_open",subtitle:l,after:i?(0,s.Y)(di.K,{className:(0,fe.I)("color_icon_secondary"),label:a.getLang("global_clear"),onClick:t=>{t.stopPropagation(),d(),e()},"data-testid":"posting_settings_donut_teaser_remove",children:(0,s.Y)(os.S,{})}):n,children:r?(0,s.Y)(Fs.j,{shape:1,appearance:"lime",animated:!0,children:c}):c})})),ro=(0,a.P)((function(t){const{onSubmit:e}=t,i=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",multiline:!0,subtitle:i.getLang("wall_posting_settings_privacy_coowners_alert_description"),children:i.getLang("wall_posting_settings_privacy_coowners_alert_title")}),(0,s.Y)(vs.v.Item,{keepOpen:!0,type:"destructive",onClick:e,children:i.getLang("wall_posting_settings_privacy_coowners_alert_submit")}),(0,s.Y)(vs.v.Item,{children:i.getLang("wall_posting_settings_privacy_coowners_alert_cancel")})]})}));class co{get isActivePrivacyDonutLevel(){return this.privacyTemp===Q}get donutTeaserIsShown(){return this.isActivePrivacyDonutLevel}get hasDonutLevels(){return Boolean(this.postingSettings?.donut?.levels_for_privacy?.length)}get canSelectDonutType(){const{postManager:t}=this.props.current;return t.privacyType===q&&!t.postData.donut?.donut_level_id}get maxDateTime(){const t=new Date;return t.setFullYear(t.getFullYear()+1),t}get disabled(){return this.props.current.disabled}get isDonutEnabled(){return this.props.current.isDonutEnabled}get isGroup(){return this.props.current.isGroup}get isNewSuggestPost(){return this.props.current.isNewSuggestPost}get bestFriendsCount(){return this.props.current.bestFriendsCount}get postingSettings(){return this.props.current.postingSettings}get postManager(){return this.props.current.postManager}get dropdownControlRef(){return this.props.current.dropdownControlRef}get alerts(){return this.props.current.alerts}get selectedDonutLevel(){if(this.isActivePrivacyDonutLevel)return this.postingSettings?.donut?.levels_for_privacy?.find((t=>t.id===this.donutLevelTemp))}get donutPaidUntilSubtitle(){return this.postManager.isActivePrivacyDonut&&!this.postManager.donutPaidUntil?this.langs.getLang("groups_donut_posting_duration_forever"):this.postManager.donutPaidUntil?this.langs.date(this.postManager.donutPaidUntil,this.langs.getLang("global_date_year_time_noprep"),this.langs.getLang("months_of"),{onlyDate:!0,offset:0}):this.langs.getLang("wall_posting_donut_post_not_selected")}constructor(t,e,i,s,o){this.props=t,this.langs=e,this.helpHints=i,this.productAnalyticsLogger=s,this.userEnv=o,this.privacyTemp=null,this.donutLevelTemp=void 0,this.dropdownShown=!1,this.calendarShown=!1,this.shownAlert=!0,this.setPrivacyTemp=t=>{this.privacyTemp=t},this.setDonutLevelTemp=t=>{this.donutLevelTemp=t},this.setDropdownShown=(t,e)=>{this.props.current.checkIfModalClosingBlocked?.(e),this.dropdownShown=t},this.setCalendarShown=t=>{this.calendarShown=t},this.setShownAlert=t=>{this.shownAlert=t},this.minDateTime=new Date,this.openBestFriendsScreen=t=>(t.preventDefault(),t.stopPropagation(),this.props.current.openBestFriendsScreen?.()),this.openPrivacyScreen=()=>(this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.OpenPrivacy}),this.props.current.openPrivacyScreen?.()),this.openDonutTeaserScreen=()=>this.props.current.openDonutTeaserScreen?.(),this.handleSetPrivacyFriends=()=>{this.props.current.postManager.setPrivacyFriends(),this.onGoBack()},this.handleSetPrivacyAll=()=>{this.props.current.postManager.setPrivacyAll(),this.onGoBack()},this.handleSetPrivacyBestFriends=()=>{this.props.current.postManager.setPrivacyBestFriends(),this.onGoBack()},this.handleSelectPrivacy=()=>{const t=this.privacyTemp;t===H?this.postManager.setPrivacyAll():t===q?this.postManager.setPrivacyDonut():t===Q&&this.donutLevelTemp&&this.postManager.setPrivacyDonut(this.donutLevelTemp),this.onGoBack()},this.handleSetTempDonutLevel=t=>{this.privacyTemp!==Q&&this.setPrivacyTemp(Q),this.setDonutLevelTemp(t)},this.handleChangeTempPrivacy=t=>{this.setPrivacyTemp(t),t!==Q&&this.setDonutLevelTemp(void 0)},this.onGoBack=()=>{this.props.current.onGoBack?.()},this.onCloseModal=()=>{this.props.current.onCloseModal?.()},this.handleApplyDate=()=>{this.setCalendarShown(!1)},this.handleShownChanged=t=>{t?this.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.OpenPrivacy}):this.setShownAlert(!0)},this.handleClearDate=t=>{t.stopPropagation(),this.setCalendarShown(!1),this.postManager.setDonutDuration(void 0)},this.handleChangeDonutDuration=t=>{this.postManager.setDonutDuration(t)},(0,l.l_)(this);const{postManager:n}=this.props.current;this.privacyTemp=n.privacyType,this.privacyTemp===Q&&(this.donutLevelTemp=n.postData.donut?.donut_level_id)}}co=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===ft.Y?Object:ft.Y,void 0===S.a?Object:S.a,void 0===qt.I?Object:qt.I,void 0===At.J?Object:At.J])],co);const{Provider:lo,useModel:ho}=(0,n.Qd)(co,{initInEffect:!1}),po=(0,a.P)((function(){const t=(0,ke.B)(),{disabled:e,isDonutEnabled:i,isGroup:o,minDateTime:n,maxDateTime:a,postManager:r,dropdownShown:d,calendarShown:c,shownAlert:l,openPrivacyScreen:h,openBestFriendsScreen:p,openDonutTeaserScreen:u,bestFriendsCount:g,dropdownControlRef:_,alerts:m,handleSetPrivacyAll:v,handleSetPrivacyFriends:y,handleSetPrivacyBestFriends:f,setDropdownShown:S,setCalendarShown:w,setShownAlert:b,selectedDonutLevel:P,donutPaidUntilSubtitle:A,isNewSuggestPost:k,handleApplyDate:C,handleShownChanged:I,handleClearDate:E,handleChangeDonutDuration:L,donutTeaserIsShown:T,helpHints:M}=ho();_&&(_.current={openDropdown:()=>S(!0)});const{privacyType:O,isActivePrivacyDonut:D,donutPaidUntil:x}=r;return o?!i||k||r.isSuggested?null:(0,s.FD)(s.FK,{children:[(0,s.Y)(Ke.T,{disabled:e,onClick:h,subtitle:(0,s.Y)(oo,{type:O,donutLevelString:P?.title}),"data-testid":"posting_settings_visibility",children:t.getLang("wall_posting_who_can_view")}),D&&(0,s.Y)(ks.A,{trigger:"click",placement:"top-start",onShownChange:w,shown:c,content:(0,s.Y)(Cs.V,{enableTime:!0,disablePast:!0,value:x,onClose:C,onChange:L,minDateTime:n,maxDateTime:a}),children:(0,s.Y)(Ke.T,{minHeight:56,"data-testid":"posting_settings_donut_date_open",subtitle:A,after:x?(0,s.Y)(di.K,{className:(0,fe.I)("color_icon_secondary"),label:t.getLang("global_clear"),onClick:E,"data-testid":"posting_settings_donut_date_remove",children:(0,s.Y)(os.S,{})}):null,children:t.getLang("wall_posting_open_donut_post_date")})}),T&&(0,s.Y)(ao,{onOpenDonutTeaserScreen:u,onClearDonutTeaserText:()=>r.setDonutTeaserText(),donutTeaserText:r.donutTeaserText,helpHints:M})]}):(0,s.Y)(s.FK,{children:(0,s.Y)(vs.v,{trigger:"click",width:250,placement:"bottom-start",shown:d,onShownChange:S,onShownChanged:I,content:m?.settingPrivacyWithCoOwners&&l?(0,s.Y)(ro,{onSubmit:()=>b(!1)}):(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",children:t.getLang("wall_posting_privacy_label")}),(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{onClick:v,after:"default"===O?(0,s.Y)(so.$,{}):null,"data-testid":"posting_settings_visibility_all",children:t.getLang("wall_posting_privacy_type_all")}),(0,s.Y)(vs.v.Item,{onClick:y,after:"friends"===O?(0,s.Y)(so.$,{}):null,"data-testid":"posting_settings_visibility_friends_only",children:t.getLang("wall_posting_privacy_type_friends_only")}),g?(0,s.Y)(vs.v.Item,{after:"best_friends"===O?(0,s.Y)(so.$,{}):null,onClick:f,subtitle:(0,s.Y)("span",{onClick:p,children:t.getLang("wall_posting_privacy_edit_best_friends")}),meta:g,"data-testid":"posting_settings_visibility_best_friends",children:t.getLang("wall_posting_privacy_type_best_friends")}):(0,s.Y)(vs.v.Item,{onClick:p,after:"best_friends"===O?(0,s.Y)(so.$,{}):null,"data-testid":"posting_settings_visibility_best_friends",children:t.getLang("wall_posting_privacy_type_best_friends")})]})]}),children:(0,s.Y)(Ke.T,{disabled:e,minHeight:56,"data-testid":"posting_settings_visibility",subtitle:(0,s.Y)(oo,{type:O}),children:t.getLang("wall_posting_who_can_view")})})})})),uo=(0,n.jn)(lo,po),go=(0,a.P)((function(t){const{onSubmit:e}=t,i=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{type:"header",multiline:!0,subtitle:i.getLang("wall_posting_save_coowners_alert_description"),children:i.getLang("wall_posting_save_coowners_alert_title")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_submit_post_coowners_alert_submit",onClick:e,children:i.getLang("wall_posting_save_coowners_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_submit_post_coowners_alert_cancel",children:i.getLang("wall_posting_save_coowners_alert_cancel")})]})}));var _o=i(533520),mo=i(421654),vo=i(395393),yo=i(443680);const fo=t=>{const e=t?.podcast_info?.cover?.sizes??[];return(0,yo.N)(e,40)},So=(0,a.P)((function(t){const{podcastEpisode:e,errorManager:i,onRemove:o,onOpenPicker:n}=t,a=(0,ke.B)(),r=i.inputFieldErrors.podcast,c=Boolean(r),l=(0,d.useMemo)((()=>e?fo(e):""),[]),h=t=>{r?i.showSnackbar({text:r,type:T.GZ.Error,action:{label:a.getLang("wall_posting_remove_podcast_episode_action"),onClick:(e,s)=>{o(t),i.hideSnackbar(s)}}}):n(t)};return e?(0,s.Y)(Ke.T,{onClick:h,"data-testid":"posting_select_podcast_episode_selected",before:l?(0,s.Y)(ys._,{size:24,src:l,borderRadius:"l",alt:e.title}):(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:24,children:(0,s.Y)(mo.g,{className:(0,fe.I)("color_icon_secondary")})}),minHeight:T.MV,subtitle:e.artist,after:(0,s.Y)(di.K,{"data-testid":"posting_unselect_podcast_episode",label:a.getLang("global_delete"),onClick:t=>{t.stopPropagation(),o(t)},children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),indicator:c&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),children:(0,s.Y)("span",{"data-testid":"posting_select_podcast_episode_selected_title",children:e.title})}):(0,s.Y)(Ke.T,{onClick:h,"data-testid":"posting_select_podcast_episode_cell",before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:24,children:(0,s.Y)(mo.g,{className:(0,fe.I)("color_icon_secondary")})}),indicator:c&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),minHeight:T.MV,children:a.getLang("wall_posting_go_to_podcast_episode_picker_label")})}));var wo=i(56471),bo=i(180329),Po=i(205417),Ao=i(765391),ko=i(634164),Co=i(59512);const Io=({photosEarsEnabled:t,colorScheme:e,maxImageWidth:i,background:s})=>{const n={maxImageWidth:i??550,maxContainerWidth:0,background:s??"blur",sizes:[]};if(t){const t=e===o.zM2.DARK?"black_fields":"gray_fields";n.background=t}return n};var Eo=i(284146),Lo=i(601079),To=i(68912),Mo=i(665888),Oo=i(178491);const Do=(0,a.P)((function(t){const{photo:e,crop:i,ratio:o,primaryAttachProps:n,isPhotoCropEnabled:a}=t,r=(0,d.useMemo)((()=>(0,J.OG)(e.restrictions)),[e.restrictions]),c=e.orig_photo?.width,l=e.orig_photo?.height,h=(0,Oo.wr)(c,l);return h?(0,s.Y)(Mo.y.Crop,{...n,ratio:o,sizes:(0,J.WQ)(e),crop:i,restriction:r,"data-testid":"posting_preview_attachment_item",autoCrop:h}):a?(0,s.Y)(Mo.y.Crop,{...n,ratio:o,sizes:(0,J.WQ)(e),crop:i,restriction:r,"data-testid":"posting_preview_attachment_item"}):(0,s.Y)(Mo.y,{...n,ratio:o,sizes:(0,J.WQ)(e),restriction:r,"data-testid":"posting_preview_attachment_item"})})),xo=(0,a.P)((function(t){const{attachment:e,crop:i,ratio:o,isPhotoCropEnabled:n,isPhotosEarsEnabled:a}=t,r=Io({photosEarsEnabled:a,colorScheme:(0,Lo.A)(),maxImageWidth:200}),d=e.video??e.clip;if(d){const t=(0,ht._w)(d);return(0,s.Y)(To.P,{...r,ratio:o,sizes:t,overlay:{kind:"video",formattedDuration:(0,Eo.a)(Number(d.duration)),platform:d.platform,canPlay:!1,hidePlayButton:!0}})}return e.photo?(0,s.Y)(Do,{photo:e.photo,isPhotoCropEnabled:n,crop:i,ratio:o,primaryAttachProps:r}):null})),Ro=(0,a.P)((function(t){const{postManager:e,onItemClick:i,isPhotosEarsEnabled:o}=t,n=(0,d.useRef)(null);return(0,s.Y)(ci.x,{columns:"dynamic",children:(0,s.Y)(ci.x.HorizontalScroll,{centered:!0,onClick:t=>{n?.current!==t.target&&t.stopPropagation()},getRootRef:n,children:e.attachments.map((t=>{const n=t.photo?e.photoAttachmentsCrop?.[(0,J.S6)(t.photo)]:void 0,a=ut(t),r=e.attachmentsAspect?.ratio??(t=>{const e=[t.photo,t.video,t.clip];for(const t of e)if(t?.width&&t?.height)return t.width/t.height;return 1})(t);return(0,s.Y)(ci.x.Item,{onClick:i,children:(0,s.Y)("div",{style:{width:Math.floor(160*r),padding:"1px 2px"},children:(0,s.Y)(xo,{attachment:t,ratio:e.attachmentsAspect?.ratio,isPhotoCropEnabled:!1,isPhotosEarsEnabled:o,crop:n})})},a)}))})})}));var Yo=i(111198),Fo=i(751447),Bo=i(701576);const No=(0,a.P)((function(t){const{postManager:e,mediaGridConfig:i}=t,o=e.attachments.map((t=>{const e=(0,Bo.Qq)(t);let i,s=(0,Bo.Y1)(t);return i="video"===t.type||"clip"===t.type?{...e.overlay||{},kind:"video",canPlay:!1,isInteractive:!1,hidePlayButton:!0}:{...e.overlay||{},kind:"photo",hasMarket:!1,hasNFT:!1},{...e,restriction:s,overlay:i,canExtendBackground:!0}}));return(0,s.Y)(Fo.h,{background:"gray_fields",features:i.mediaGridFeatures,maxContainerWidth:424,maxImageWidth:424,useMaskImage:Yo.T.safari,attachments:o})}));var zo=i(962644),Vo=i(108852);const Uo="vkitAttachmentSnippetLink__root--j1YN4",Go={feed:"vkitAttachmentSnippetLink__feed--LVUSB",posting:"vkitAttachmentSnippetLink__posting--xxPbG"},jo=({title:t,photo:e,action:i,caption:n,mode:a,maxImageWidth:r,actionButton:d,getRootRef:c,"data-testid":l="snippet-attachment",...h})=>{const p=(0,$t.q)(e,r)?.url;return(0,s.Y)("div",{className:(0,ko.$)(Uo,Go[a]),...h,ref:c,"data-testid":l,children:(0,s.FD)(Vo.k,{action:i,children:[(0,s.Y)(o.glH,{ratio:502/224,children:p&&(0,s.Y)(zo.h,{Component:"img",src:p,alt:"",loading:"lazy","data-testid":"snippet-attachment-image"})}),(0,s.Y)(Ke.T,{subtitle:n,minHeight:56,"data-testid":"snippet-attachment-captions",children:t}),!!d&&(0,s.Y)(zo.h,{placement:"top-right",children:(0,s.Y)(Ge.i,{spacing:8,paddingTop:8,paddingBottom:8,mode:"vertical",children:d})})]})})},Wo=(0,a.P)((function(t){const{article:e}=t,i=(0,ke.B)(),o=(0,d.useMemo)((()=>({title:e.title||"",photo:e.photo?.sizes,caption:e.owner_name?i.langReplace(i.getLang("pages_articles_label_long"),{author:e.owner_name}):i.getLang("pages_articles_label"),maxImageWidth:280})),[e]);return(0,s.Y)(Ge.i,{children:(0,s.Y)(jo,{mode:"posting",...o})})}));var Ho=i(423654);const $o=(0,a.P)((function(t){const{link:e}=t,i=(0,d.useMemo)((()=>({title:e.title||"",photo:e.photo?.sizes,caption:e.caption?(0,s.Y)(Ho.N,{target:"_blank",href:e.url,mode:"secondary",children:e.caption}):"",maxImageWidth:280})),[e]);return(0,s.Y)(jo,{mode:"posting",...i})})),Ko="GifPreview__container--pnsgu",qo=(0,a.P)((function(t){const{doc:e,docPhoto:i,isPhotosEarsEnabled:o}=t,n=Io({photosEarsEnabled:o,colorScheme:(0,Lo.A)(),maxImageWidth:280});return(0,s.Y)("div",{className:Ko,children:(0,s.Y)(To.P,{...n,sizes:[{width:i.width,height:i.height,url:String(e.url)}],noBorderRadius:!0,"data-testid":"posting_attachment_gif_item_preview"})})})),Qo="PostPreview__gridPreviewContainer--rerFb",Jo="PostPreview__gridPreviewContainerSquare--pTht7",Xo="PostPreview__singleAttachContainer--XKXJk",Zo="PostPreview__carouselPreviewContainer--i4Qz0";var tn=i(124102),en=i(477042);const sn=(0,a.P)((function(t){const{postManager:e,ownerId:i,replaceEmoji:n,onEditClick:a,isPhotosEarsEnabled:r,mediaGridConfig:c}=t,l=(0,ke.B)(),[h]=(0,d.useState)((()=>new tn.$(e.text,!0))),{renderDisplayedText:p}=(0,en.O)({getTextFormatArray:h.getTextFormatArray,onFormattedDisplayedTextClick:()=>{},label:"",tooltipText:""});let u=null;if(e.attachments.length)if(e.isCarouselAttachmentView||e.hasSingleMediaAttachment)u=(0,s.Y)("div",{className:Zo,children:(0,s.Y)(Ro,{postManager:e,onItemClick:a,isPhotosEarsEnabled:r})});else{const t=e.attachments.length,i=4===t||9===t;u=(0,s.Y)("div",{className:(0,ko.$)(Qo,i&&Jo),children:(0,s.Y)(No,{postManager:e,mediaGridConfig:c})})}else e.article?u=(0,s.Y)("div",{className:Xo,children:(0,s.Y)(Wo,{article:e.article})}):e.link?u=(0,s.Y)("div",{className:Xo,children:(0,s.Y)($o,{link:e.link})}):e.isDocValidMediaAttach&&e.doc&&e.docGifPreviewSize&&(u=(0,s.Y)("div",{className:Xo,children:(0,s.Y)(qo,{doc:e.doc,docPhoto:e.docGifPreviewSize,isPhotosEarsEnabled:r})}));return(0,s.Y)(wo.f,{text:l.getLang("wall_posting_settings_back_label"),appearance:"white",children:(0,s.FD)(o.SB4,{onClick:a,"aria-label":l.getLang("wall_posting_settings_back_label"),"data-focus-first":!0,tabIndex:0,children:[(0,s.Y)(bo.s,{align:"center",justify:"center",children:u}),e.text.length>0&&(0,s.Y)(Ge.i,{children:n?(0,s.Y)(Ao.o,{config:{fullPostThreshold:1/0,cutThreshold:3,underCutThreshold:0},chunks:(0,Co.S)(e.text),TypographyComponent:We.tW,viewerId:i,className:(0,fe.I)("color_text_secondary"),renderDisplayedText:p}):(0,s.Y)(Po.o,{config:{fullPostThreshold:1/0,cutThreshold:3,underCutThreshold:0},chunks:(0,Co.S)(e.text),TypographyComponent:We.tW,viewerId:i,className:(0,fe.I)("color_text_secondary")})})]})})})),on=Ws.L.ACCOUNT_HINT_FEED_POSTING_COAUTHORS_ONBOARDING_WEB,nn=Ws.L.ACCOUNT_HINT_FEED_POSTING_ACTION_BUTTONS_HINT_WEB,an=Ws.L.ACCOUNT_HINT_GROUPS_POSTING_DONUT_GOALS_ONBOARDING,rn=Ws.L.ACCOUNT_HINT_POSTING_SHOW_PRODUCTS_ACTION_BUTTON_COMMUNITY;var dn=i(563063);const cn=(0,a.P)((function({onOpenMusicScreen:t,chevronVisible:e,errorIndicatorVisible:i,cellHeight:o,avatarSize:n}){const a=(0,ke.B)();return(0,s.Y)(Ke.T,{onClick:t,minHeight:o,"data-testid":"posting_audio_select_audio_cell",before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:n,children:(0,s.Y)(dn.F,{className:(0,fe.I)("color_icon_secondary")})}),indicator:i&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),after:e?(0,s.Y)(zs.w,{}):null,children:a.getLang("wall_posting_go_to_music_label")})})),ln=(0,a.P)((function({playlist:t,onRemoveAudio:e,onOpenMusicScreen:i,errorIndicatorVisible:o,cellHeight:n,avatarSize:a}){const r=(0,ke.B)();return(0,s.Y)(Ke.T,{onClick:i,minHeight:n,"data-testid":"posting_audio_select_playlist_selected",before:t.photo?(0,s.Y)(ys._,{size:a,src:t.photo?.photo_135,borderRadius:"l",alt:t.title}):(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:a,children:(0,s.Y)(dn.F,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:r.numeric(t.count,r.getLang("wall_posting_audio_playlist_audio_count",!0)),indicator:o&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),after:(0,s.Y)(di.K,{"data-testid":"posting_audio_unselect_playlist",label:r.getLang("global_delete"),onClick:t=>{t.stopPropagation(),e(t)},children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),children:(0,s.Y)("span",{"data-testid":"posting_audio_select_playlist_selected_title",children:t.title})})})),hn=(0,a.P)((function({audios:t,onRemoveAudio:e,onOpenMusicScreen:i,errorIndicatorVisible:o,cellHeight:n,avatarSize:a}){const r=(0,ke.B)(),d=t[0],c=t?.length>1,l=c?r.numeric(t.length-1,r.getLang("wall_posting_audio_and_more_tracks_text",!0)):d.artist,h=c?(0,s.Y)(di.K,{"data-testid":"posting_audio_select_more_audio",label:r.getLang("global_add"),onClick:t=>{t.stopPropagation(),i(t)},children:(0,s.Y)(zs.w,{className:(0,fe.I)("color_icon_secondary")})}):(0,s.Y)(di.K,{"data-testid":"posting_audio_unselect_audio",label:r.getLang("global_delete"),onClick:t=>{t.stopPropagation(),e(t)},children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})});return(0,s.Y)(Ke.T,{onClick:i,minHeight:n,"data-testid":"posting_audio_select_audio_selected",before:d.album?(0,s.Y)(ys._,{size:a,src:d.album?.thumb?.photo_135,borderRadius:"m",alt:d.title}):(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:a,children:(0,s.Y)(dn.F,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:l,indicator:o&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),after:h,children:(0,s.Y)("span",{"data-testid":"posting_audio_select_audio_selected_title",children:d.title})})}));var pn=i(368970);const un=(0,a.P)((function({audios:t,playlist:e,onRemoveAudio:i,onOpenMusicScreen:o,errorMessage:n,chevronVisible:a=!0,cellHeight:r=pn.Vy,avatarSize:d=pn.JG}){const c=Boolean(n),l=t=>{o(t,n)};return t?.length?(0,s.Y)(hn,{audios:t,onRemoveAudio:i,onOpenMusicScreen:l,errorIndicatorVisible:c,cellHeight:r,avatarSize:d}):e?(0,s.Y)(ln,{playlist:e,onRemoveAudio:i,onOpenMusicScreen:l,errorIndicatorVisible:c,cellHeight:r,avatarSize:d}):(0,s.Y)(cn,{onOpenMusicScreen:l,errorIndicatorVisible:c,chevronVisible:a,cellHeight:r,avatarSize:d})})),gn=(0,a.P)((function({audio:t,playlist:e,onRemoveAudio:i,onOpenMusicScreen:o,errorMessage:n,chevronVisible:a=!0,cellHeight:r=pn.Vy,avatarSize:d=pn.JG}){const c=(0,ke.B)(),l=Boolean(n),h=t=>{o(t,n)};return t?(0,s.Y)(Ke.T,{onClick:h,minHeight:r,"data-testid":"posting_audio_select_audio_selected",before:t.album?(0,s.Y)(ys._,{size:d,src:t.album?.thumb?.photo_135,borderRadius:"m",alt:t.title}):(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:d,children:(0,s.Y)(dn.F,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:t.artist,indicator:l&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),after:(0,s.Y)(di.K,{"data-testid":"posting_audio_unselect_audio",label:c.getLang("global_delete"),onClick:t=>{t.stopPropagation(),i(t)},children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),children:(0,s.Y)("span",{"data-testid":"posting_audio_select_audio_selected_title",children:t.title})}):e?(0,s.Y)(Ke.T,{onClick:h,minHeight:r,"data-testid":"posting_audio_select_playlist_selected",before:e.photo?(0,s.Y)(ys._,{size:24,src:e.photo?.photo_135,borderRadius:"l",alt:e.title}):(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:d,children:(0,s.Y)(dn.F,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:c.numeric(e.count,c.getLang("wall_posting_audio_playlist_audio_count",!0)),indicator:l&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),after:(0,s.Y)(di.K,{"data-testid":"posting_audio_unselect_playlist",label:c.getLang("global_delete"),onClick:t=>{t.stopPropagation(),i(t)},children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),children:(0,s.Y)("span",{"data-testid":"posting_audio_select_playlist_selected_title",children:e.title})}):(0,s.Y)(Ke.T,{onClick:h,minHeight:r,"data-testid":"posting_audio_select_audio_cell",before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:d,children:(0,s.Y)(dn.F,{className:(0,fe.I)("color_icon_secondary")})}),indicator:l&&(0,s.Y)(vo._,{className:(0,fe.I)("color_icon_negative")}),after:a?(0,s.Y)(zs.w,{}):null,children:c.getLang("wall_posting_go_to_music_label")})})),_n=(0,a.P)((function({onSubmit:t,onCancel:e}){const i=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.FD)(vs.v.Item,{type:"header",multiline:!0,children:[(0,s.Y)(We.tW,{weight:"2",children:i.getLang("wall_posting_settings_group_comments_closed_alert_title")}),(0,s.Y)(We.HL,{children:i.getLang("wall_posting_settings_group_comments_closed_alert_subtitle")})]}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_group_comments_closed_alert_submit",onClick:t,children:i.getLang("wall_posting_settings_group_comments_closed_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_group_comments_closed_alert_cancel",onClick:e,children:i.getLang("wall_posting_settings_group_comments_closed_alert_cancel")})]})})),mn=(0,a.P)((function({onSubmit:t,onCancel:e}){const i=(0,ke.B)();return(0,s.FD)(s.FK,{children:[(0,s.FD)(vs.v.Item,{type:"header",multiline:!0,children:[(0,s.Y)(We.tW,{weight:"2",children:i.getLang("wall_posting_settings_user_comments_closed_alert_title")}),(0,s.Y)(We.HL,{children:i.getLang("wall_posting_settings_user_comments_closed_alert_subtitle")})]}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_user_comments_closed_alert_submit",onClick:t,children:i.getLang("wall_posting_settings_user_comments_closed_alert_submit")}),(0,s.Y)(vs.v.Item,{"data-testId":"posting_user_comments_closed_alert_cancel",onClick:e,children:i.getLang("wall_posting_settings_user_comments_closed_alert_cancel")})]})})),vn=(0,a.P)((function({postManager:t,settingsManager:e,userOwner:i,groupOwner:n}){const a=(0,ke.B)(),r=e.userCommentsAreClosed&&!i?.isUserCommentsEnabled,c=e.groupCommentsAreClosed&&!n?.isGroupCommentsEnabled,l=r||c,h=Boolean(i?.loadingOpenComments||n?.loadingOpenComments),[p,u]=(0,d.useState)(!1),g=(0,s.Y)(Ke.T,{Component:"label","data-testid":"posting_settings_comments_switch",disabled:h,after:(0,s.FD)(s.FK,{children:[h&&(0,s.Y)(_e.y,{}),(0,s.Y)(o.dOG,{checked:t.commentsEnabled&&!l,disabled:h,onChange:e=>{var i;l?u(!0):(i=e.target.checked,t.setCommentsEnabled(i))},"data-testid":"posting_settings_comments_switch_input"})]}),children:a.getLang("wall_posting_comments_switch_label")});let _;if(l){const t=()=>u(!1);let e;return r?(e=(0,s.Y)(mn,{onSubmit:()=>i?.openProfileComments(),onCancel:t}),_="posting_user_comments_closed_alert"):(e=(0,s.Y)(_n,{onSubmit:()=>n?.openGroupComments(),onCancel:t}),_="posting_group_comments_closed_alert"),(0,s.Y)(vs.v,{width:266,trigger:"click",shown:p,content:e,onShownChange:t=>{u(t)},"data-testId":_,children:g})}return g}));var yn=i(800687);const fn=()=>{const t=(0,ke.B)();return(0,s.Y)(We.HL,{weight:"3",className:(0,fe.I)("color_text_secondary"),children:(0,s.Y)(yn.I,{values:{link:(0,s.Y)(Ho.N,{href:T.XC,target:"_blank","data-testid":"posting_video_disclaimer"})},children:t.getLang("wall_posting_added_video_disclaimer_text")})})},Sn="VideoDisclaimerFooter__footer--Qory9",wn=()=>(0,s.Y)(we.j,{className:Sn,children:(0,s.Y)(fn,{})});var bn=i(37227);const Pn=(0,a.P)((function({closeModal:t,postingViewModel:e,checkIfModalClosingBlocked:i}){const n=(0,ke.B)(),a=(0,d.useRef)(null),r=(0,d.useRef)(null),{actionsButtonOnboarding:c,coauthorsOnboarding:l,actionsButtonGoalsOnboarding:h,actionButtonShowProductsOnboarding:p,hideHint:u}=(({helpHints:t,hasActionButtonsOnboarding:e,hasDonutButtons:i,hasActionButtonShowProductsOnboarding:s})=>{const[o,n]=(0,d.useState)(!1);if(o)return{hideHint:zi.l};const a=e=>{n(!0),t.hide(e)},r=t.get(nn);if(r&&e)return{actionsButtonOnboarding:r,hideHint:()=>a(nn)};const c=t.get(rn);if(c&&s)return{actionButtonShowProductsOnboarding:c,hideHint:()=>a(rn)};const l=t.get(an);if(l&&i)return{actionsButtonGoalsOnboarding:l,hideHint:()=>a(an)};const h=t.get(on);return h?{coauthorsOnboarding:h,hideHint:()=>a(on)}:{hideHint:zi.l}})({helpHints:e.helpHints,hasActionButtonsOnboarding:e.settingsManager.hasActionButtonsOnboarding,hasActionButtonShowProductsOnboarding:e.hasMarketAttachedItems&&e.hasMarketSelfAttachItems,hasDonutButtons:e.settingsManager.hasDonutButtons}),g=(0,d.useCallback)((()=>u()),[c]),_=(0,ms.$)(g,[g]),m=e.isEdit&&!(e.postManager.isSuggested&&e.isAdmin),v=e.postManager.hasUploadedVideoAttachment,y=(({isEditMethod:t,isPostponed:e,isNewSuggestPost:i,isPostponedPostDate:s})=>{const o=(0,ke.B)();let n=o.getLang("wall_posting_publish_button_label"),a="posting_submit_button";return t&&e&&!s?(n=o.getLang("wall_publish_now"),a="posting_publish_now_button"):t?(n=o.getLang("wall_posting_save_button_label"),a="posting_save_button"):e?(n=o.getLang("wall_posting_postponed_publish_btn_label"),a="posting_postponed_publish_button"):i&&(n=o.getLang("wall_suggest_group_post"),a="posting_suggest_button"),{text:n,testId:a}})({isEditMethod:m,isNewSuggestPost:e.isNewSuggestPost,isPostponed:e.postManager.isPostponed,isPostponedPostDate:e.postManager.isPostponedPostDate});let f=(0,s.Y)(be.$,{size:"m",mode:"primary",appearance:"accent",loading:e.hasProcessing,disabled:e.hasProcessing,onClick:()=>{e.canSubmitAttachmentsWithFeedback()&&(e.alerts.editingPostWithCoOwners||e.savePost())},"data-testid":y.testId,children:y.text});return e.alerts.editingPostWithCoOwners&&(f=(0,s.Y)(vs.v,{width:250,placement:"top-start",trigger:"click",content:(0,s.Y)(go,{onSubmit:e.savePost}),"data-testid":"posting_submit_post_coowners_alert",onShownChange:(t,e)=>i(e),children:f})),e.publishedDateSettingIsShown&&(f=(0,s.Y)(Ds,{publishDate:e.postManager.publishDate,proposedPublishedDate:e.proposedPublishedDate,changePublishDate:e.postManager.setPublishDate,after:f,disabled:e.hasProcessing})),(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:e.modalManager.goBack,backLabel:n.getLang("wall_posting_settings_back_label"),onClose:()=>t(),closeAriaLabel:n.getLang("global_close"),noSeparator:!0,children:n.getLang("wall_posting_settings_header_text")}),(0,s.Y)(ue.g,{autoHideScrollbar:!0,children:(0,s.Y)(ge.c,{insetLevel:0,children:(0,s.FD)(Ge.i,{getRootRef:a,children:[(0,s.Y)(sn,{replaceEmoji:e.userEnv.partConfigEnabled("feed_posting_post_preview_replace_emoji_enabled"),postManager:e.postManager,ownerId:e.currentUserId,onEditClick:()=>e.modalManager.goToMainScreen(),isPhotosEarsEnabled:e.isPhotosEarsEnabled,mediaGridConfig:e.mediaGridConfig}),(0,s.Y)(Bi.F,{size:12}),(0,s.Y)(Rs,{geo:e.postManager.geo,onClick:()=>{e.modalManager.openGeoPickerScreen()},onRemove:e.handleRemoveGeo}),e.settingsManager.hasAudioMaxCount?(0,s.Y)(un,{audios:e.postManager.audios,playlist:e.postManager.audioPlaylist,onRemoveAudio:e.handleRemoveAudio,onOpenMusicScreen:e.handleOpenMusicScreen,errorMessage:e.errorManager.inputFieldErrors.audio||e.errorManager.inputFieldErrors.audio_playlist,chevronVisible:!1}):(0,s.Y)(gn,{audio:e.postManager.audios?.[0],playlist:e.postManager.audioPlaylist,onRemoveAudio:e.handleRemoveAudio,onOpenMusicScreen:e.handleOpenMusicScreen,errorMessage:e.errorManager.inputFieldErrors.audio||e.errorManager.inputFieldErrors.audio_playlist,chevronVisible:!1}),Boolean(e.groupOwner?.data?.counters?.podcasts)&&e.isAdmin&&(0,s.Y)(So,{podcastEpisode:e.postManager.podcastEpisode,errorManager:e.errorManager,onOpenPicker:t=>{e.canAddAttachmentWithFeedback({event:t,type:"podcast"})&&e.modalManager.openPodcastEpisodePickerScreen()},onRemove:t=>{e.removeAttachment({event:t,type:"podcast"})}}),(0,s.Y)(Ke.T,{"data-testid":"posting_poll_cell",onClick:e.postManager.poll?()=>{e.postManager.poll?.can_edit?e.modalManager.openPollScreen():e.errorManager.showErrorSnackbar(T.Rn.PoolEditNotAllowed)}:t=>{e.canAddAttachmentWithFeedback({event:t,type:"poll"})&&(e.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.POLL}),e.modalManager.openPollScreen())},minHeight:T.MV,before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:T.JG,children:(0,s.Y)(fs.F,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:e.postManager.poll?(0,s.Y)("span",{"data-testid":"posting_poll_cell_title",children:e.postManager.poll.question}):void 0,after:!!e.postManager.poll&&(0,s.Y)(di.K,{label:n.getLang("global_delete"),onClick:t=>{t.stopPropagation(),e.removeAttachment({event:t,type:"poll"})},"data-testid":"posting_poll_cell_remove",children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),children:n.getLang("wall_posting_go_to_polls_label")}),e.hasMarketAttachItems&&(0,s.Y)(Ke.T,{"data-testid":"posting_products_cell",onClick:t=>{e.canAddAttachmentWithFeedback({event:t,type:"market"})?(e.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.MARKET}),e.modalManager.openAddProductScreen(),e.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenProduct})):e.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.ShowProductErrorMsg})},minHeight:T.MV,before:e.addProductManager.previewSrc?(0,s.Y)(ys._,{src:e.addProductManager.previewSrc,size:24,alt:e.addProductManager.previewPhotoTag?.link.title}):(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:T.JG,"aria-label":n.getLang("wall_posting_go_to_product_label"),children:(0,s.Y)(Ss.A,{className:(0,fe.I)("color_icon_secondary")})}),after:!!e.addProductManager.previewPhotoTag&&(0,s.Y)(di.K,{"data-testid":"posting_products_cell_remove",label:n.getLang("global_delete"),onClick:t=>{(0,te.T)(t),e.addProductManager.deleteTag(e.addProductManager.previewPhotoTag)},children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:Boolean(e.addProductManager.previewPhotoTag&&e.addProductManager.tagsCount>1)&&n.numeric(e.addProductManager.tagsCount-1,n.getLang("wall_posting_go_to_product_with_tags_label",!0)),children:(0,s.Y)("span",{"data-testid":"posting_products_cell_title",children:e.addProductManager.previewPhotoTag?e.addProductManager.previewPhotoTag.link.title:n.getLang("wall_posting_go_to_product_label")})}),(0,s.Y)(Ke.T,{onClick:()=>{e.postingTimelineLogger.logPickerOpening({pickerType:Xt.ss.DOCUMENT}),e.modalManager.openFileScreen(),e.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenFile})},minHeight:T.MV,"data-testid":"posting_file_picker_cell",before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:T.JG,children:(0,s.Y)(ws.R,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:!!e.postManager.doc&&(0,_o.v)(e.postManager.doc.size),after:!!e.postManager.doc&&(0,s.Y)(di.K,{"data-testid":"posting_file_picker_cell_remove",label:n.getLang("global_delete"),onClick:e.handleRemoveDoc,children:(0,s.Y)(os.S,{className:(0,fe.I)("color_icon_secondary")})}),children:(0,s.Y)("span",{"data-testid":"posting_file_picker_title",children:e.postManager.doc?e.postManager.doc.title:n.getLang("wall_posting_go_to_file_label")})}),e.actionButtonsSettingIsShown&&(0,s.Y)(Us,{hasOnboardingHighlighter:!!c,getRootRef:_,onClick:e.handleActionButtonsClick,buttons:e.settingsManager.allActionButtons,currentActionButtonType:e.postManager.currentActionButtonType,hasDonutButtons:e.settingsManager.hasDonutButtons,vkTickets:e.vkTickets,onRemove:()=>{u(),e.removeActionButton()},onSelect:(t,i)=>{u(),e.onSelectActionButton(t,i)},onboarding:h,onboardingShowProducts:p,onHideOnboarding:u,size:"s"}),(0,s.Y)(Bi.F,{size:16}),e.coOwnersSettingIsShown&&(0,s.FD)(s.FK,{children:[(0,s.Y)(io,{onboarding:l,postManager:e.postManager,firstCoOwner:e.firstCoOwner,userOwner:e.userOwner,groupOwner:e.groupOwner,loading:e.coOwnersSettingLoading,alerts:e.alerts,onOpenPickerClick:()=>{e.alerts.settingCoOwnersWithActionButtons?e.errorManager.showErrorSnackbar(T.Rn.AddCoOwnersWithActionButtons):e.modalManager.openCoAuthorshipScreen()},onChangePrivacy:()=>{r.current?.openDropdown()},onHideOnboarding:u}),(0,s.Y)(Bi.F,{size:16})]}),e.privacySettingIsShown&&(0,s.Y)(uo,{postManager:e.postManager,isDonutEnabled:e.isDonutEnabled,disabled:e.privacySettingIsDisabled,postingSettings:e.settingsManager.postingSettings,isGroup:e.isGroup,openBestFriendsScreen:e.modalManager.openBestFriendsScreen,openPrivacyScreen:e.modalManager.openPrivacyScreen,openDonutTeaserScreen:e.modalManager.openDonutTeaserScreen,bestFriendsCount:e.bestFriendsCount,dropdownControlRef:r,alerts:e.alerts,isNewSuggestPost:e.isNewSuggestPost,checkIfModalClosingBlocked:i}),e.privacySettingIsShown&&(0,s.Y)(Bi.F,{size:16}),e.signedSettingInMainSettings&&(0,s.FD)(s.FK,{children:[(0,s.Y)(Gs,{onChange:e.postManager.setSigned,disabledDueToCoauthors:Boolean(e.postManager.coOwnersIds.length),disabledDueToAuthor:e.signedSettingDisabledDueToAuthor,errorManager:e.errorManager,signedSettingDescription:e.signedSettingDescription,signed:e.signed}),(0,s.Y)(Bi.F,{size:16})]}),e.hasAdditionalSettings&&(0,s.FD)(o.nD3,{onChange:t=>{t&&e.productAnalyticsLogger.logSettingsEvent({settingsEventType:Qt.wJ.OpenSettings})},children:[(0,s.Y)(o.nD3.Summary,{"data-testid":"posting_additional_settings_cell",children:(0,s.Y)(We.$j,{weight:"2",children:n.getLang("wall_posting_additional_label")})}),(0,s.Y)(o.nD3.Content,{onAnimationEnd:()=>{a.current?.scrollIntoView({block:"end",behavior:"smooth"})},children:(0,s.FD)("div",{children:[e.commentsSettingIsShown&&(0,s.Y)(vn,{postManager:e.postManager,settingsManager:e.settingsManager,userOwner:e.userOwner,groupOwner:e.groupOwner}),e.notificationSettingIsShown&&(0,s.Y)(Ke.T,{Component:"label","data-testid":"posting_settings_notification_switch",subtitle:e.isGroup?n.getLang("wall_posting_comments_switch_subtitle"):n.getLang("wall_posting_notice_friends_switch_subtitle"),after:(0,s.Y)(o.dOG,{checked:e.postManager.notificationsEnabled,onChange:t=>{e.postManager.setNotificationsEnabled(t.target.checked)},"data-testid":"posting_settings_notification_switch_input"}),children:e.isGroup?n.getLang("wall_posting_notice_switch_label"):n.getLang("wall_posting_notice_friends_switch_label")}),e.signedSettingInAdditionalSettings&&(0,s.Y)(Gs,{onChange:e.postManager.setSigned,disabledDueToCoauthors:Boolean(e.postManager.coOwnersIds.length),disabledDueToAuthor:e.signedSettingDisabledDueToAuthor,errorManager:e.errorManager,signedSettingDescription:e.signedSettingDescription,signed:e.signed}),e.isOrdAddShown&&(0,s.Y)(As,{errorManager:e.errorManager,disabled:e.isEdit&&!e.postManager.isSuggested,markedAsAds:e.postManager.markedAsAds,changeOrdData:e.postManager.setOrdData,ordData:e.postManager.ordData,openOrdMiniApp:e.openOrdMiniApp,isSpaOrdLaunch:e.userEnv.partConfigEnabled("spa_ord_miniapp_open")&&(0,bn.Q)()})]})})]})]})})}),v&&(0,s.Y)(wn,{}),(0,s.Y)(we.j,{before:e.showDraftsSaveAction&&(0,s.Y)(Qs,{onClick:e.saveDraft,isDraft:e.postManager.isDraft,publishDate:e.postManager.publishDate,draftsCount:e.draftsCount,disabled:e.hasProcessing}),actions:f})]})}));var An=i(89274),kn=i(954828),Cn=i(275860);class In{[n.Ts](t){this.config=t}[n.yo](t){this.config=t}async saveBestFriends(t,e){try{t.length&&await this.bestFriendsApi.batchEdit({operations:JSON.stringify(t)}),this.config?.onSaveBestFriends(e)}catch{this.handleShowError(),this.postingTimelineLogger.logError({message:T.Zk.ErrorLoadingBestFriendsPicker})}}get bestFriends(){return this.config?.bestFriends??[]}constructor(t,e,i){this.bestFriendsApi=t,this.errorManager=e,this.postingTimelineLogger=i,this.handleGoBack=()=>{this.config?.onGoBack()},this.handleShowError=()=>{this.errorManager.onNetworkErrorSnackbar()},this.closeModal=()=>{this.config?.closeModal()},(0,l.l_)(this)}}In=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===St.o?Object:St.o,void 0===Et.e?Object:Et.e,void 0===Ft.k?Object:Ft.k])],In);const{Provider:En,useModel:Ln}=(0,n.Qd)(In,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1}),Tn=(0,a.P)((function(){const t=Ln(),e=(0,d.useRef)(null),[i,o]=(0,d.useState)(!0),[n,a]=(0,d.useState)(!0),[r,c]=(0,d.useState)([]),[h]=(0,d.useState)(new Cn.v),p=(0,ke.B)();console.log(i,n);const u={emitter:h,usersSelected:(0,l.HO)(t.bestFriends)};return(0,gi.M)(!i,(()=>h.emit("nextPage")),e.current),(0,d.useEffect)((()=>{const t=t=>console.log(t);return h.listenable.on("error",t),h.listenable.on("pending",o),h.listenable.on("availableSave",a),h.listenable.on("usersSelected",c),()=>{h.listenable.off("error",t),h.listenable.off("pending",o),h.listenable.off("availableSave",a),h.listenable.off("usersSelected",c)}}),[h]),(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:t.handleGoBack,backLabel:p.getLang("global_back"),onClose:t.closeModal,closeAriaLabel:p.getLang("global_close"),children:p.getLang("wall_posting_best_friends_modal_header_text")}),(0,s.Y)(ue.g,{autoHideScrollbar:!0,boxRef:e,children:(0,s.Y)(ge.c,{insetLevel:0,children:(0,s.Y)(kn.K,{config:u})})}),(0,s.Y)(we.j,{actions:(0,s.Y)(be.$,{size:"m",mode:"primary",appearance:"accent",onClick:()=>{const e=(0,An.U)(r,(0,l.HO)(t.bestFriends));t.saveBestFriends(e,r)},children:p.getLang("wall_posting_poll_submit_button_label")})})]})})),Mn=(0,n.jn)(En,Tn);var On=i(95763),Dn=i(364517),xn=i(154767),Rn=i(590715);const Yn="vkitSimplePhotoViewer__wrapper--fzG5A",Fn="vkitSimplePhotoViewer__gallery--4Ecrj",Bn="vkitSimplePhotoViewer__container--GIfu0",Nn=({defaultRatio:t,photos:e,initialIndex:i=0,rightFooterItem:o,leftFooterItem:n,onSlideChange:a,getRootRef:r,className:c,getImageOptimizedCrop:l})=>{const[h,p]=(0,d.useState)(i),[u,g]=(0,d.useState)({width:0,height:0}),_=(0,d.useRef)(null);(0,On.w)((()=>{if(!_.current)return;const{offsetWidth:t,offsetHeight:e}=_.current;g({width:t,height:e})}),_);const m=t=>{p(t),a?.(t)},v=(0,Dn.K)((t=>{"ArrowRight"===t.key&&h<e.length-1?(t.stopImmediatePropagation(),m(h+1)):"ArrowLeft"===t.key&&h>0&&(t.stopImmediatePropagation(),m(h-1))}));return(0,d.useEffect)((()=>(window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)})),[v]),(0,s.FD)(bo.s,{direction:"column",className:(0,ko.$)(Yn,c),getRootRef:r,children:[(0,s.Y)(bo.s.Item,{flex:"grow",getRootRef:_,children:(0,s.Y)(xn.Q,{value:"light",children:(0,s.Y)(Rn.Z,{className:Fn,slideWidth:"100%",showArrows:!0,slideIndex:h,arrowSize:"m",onChange:a,initialSlideIndex:i,align:"center",children:e.map((e=>{const{width:i,height:o,ratio:n}=((t,e,i)=>{let s=i||1,o=i||1;const n=(0,$t.q)(t.sizes,Number.MAX_VALUE);n&&!i&&(s=n.width/n.height,o=(n.width+12)/(n.height+24));const a=e.width/e.height,r=o<=a;return{width:r?`calc(${1/a*100}% * ${o})`:"100%",height:r?"100%":`calc(${100*a}% / ${o})`,ratio:s}})(e,u,t),a=e.sizes[0],r=l?l(a.width,a.height):void 0;return(0,s.Y)(xn.Q,{value:"dark",children:(0,s.Y)(Ge.i,{className:Bn,mode:"vertical",spacing:6,style:{width:i,height:o},children:(0,s.Y)(Mo.y.Crop,{ratio:t||n,sizes:e.sizes,crop:e.crop,restriction:e.restriction,"data-testid":"photo_viewer_photo_item",maxImageWidth:u.width,maxContainerWidth:0,autoCrop:r,hasPhotoPreviewCrop:!!r})})},e.id)}))})})}),Boolean(n||o)&&(0,s.FD)(s.FK,{children:[(0,s.Y)(li.w,{wide:!0}),(0,s.Y)(Ge.i,{mode:"horizontal",spacing:4,children:(0,s.Y)(Ge.i,{children:(0,s.FD)(bo.s,{direction:"row",justify:"space-between",align:"center",children:[n,o]})})})]})]})};var zn=i(181237);class Vn{[n.Ts](){if(this.props.current.photo){const t=this.props.current.photo;this.initialSlideIndex=this.props.current.photos?.findIndex((e=>t&&(0,F.WO)({ownerId:t.owner_id,id:t.id})===(0,F.WO)({ownerId:e.owner_id,id:e.id})))||0}else this.handleShowError(),this.handleGoBack()}get currentIndex(){return this._currentIndex}get defaultRatio(){return this.props.current.ratio}get ratio(){return this.defaultRatio?this.defaultRatio:this.maxPhotoSize?this.maxPhotoSize.width/this.maxPhotoSize.height:1}get photos(){return this.props.current.photos?.map((t=>{const e=(0,F.WO)({ownerId:t.owner_id,id:t.id});let i,s=1;if(t.sizes){const e=(0,$t.q)(t.sizes,Number.MAX_VALUE);e&&(s=e.width/e.height)}return this.props.current.crop&&(i=this.props.current.crop[e]),{restriction:(0,J.OG)(t.restrictions),sizes:(0,J.WQ)(t),ratio:s,id:(0,F.WO)({ownerId:t.owner_id,id:t.id}),crop:i}}))||[]}get photo(){return this.props.current.photo}get crop(){return this.photo?this.props.current.crop?.[(0,F.WO)({ownerId:this.photo.owner_id,id:this.photo.id})]:void 0}get maxPhotoSize(){if(this.photo?.sizes)return(0,$t.q)(this.photo.sizes,Number.MAX_VALUE)}get imageContainerDimensions(){return(0,zn.g)({viewWidth:this.props.current.viewWidth,viewHeight:this.props.current.viewHeight,originalWidth:4,originalHeight:3,safeZoneVertical:128})}constructor(t,e,i,s,o){this.errorManager=t,this.langs=e,this.productAnalyticsLogger=i,this.userEnv=s,this.props=o,this.totalCount=0,this.initialSlideIndex=0,this._currentIndex=0,this.setCurrentIndex=t=>{this._currentIndex=t},this.handleGoBack=()=>{this.props.current.onGoBack()},this.handleOpenPhotoEditor=()=>{const t=this.props.current.photos?.[this._currentIndex];t&&this.props.current.onOpenPhotoViewer?.(t)},this.handleShowError=()=>{this.errorManager.showErrorSnackbar(T.Rn.PhotoUnsupportedFormat)},(0,l.l_)(this)}}Vn=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Et.e?Object:Et.e,void 0===ft.Y?Object:ft.Y,void 0===qt.I?Object:qt.I,void 0===At.J?Object:At.J,void 0===n.Ji?Object:n.Ji])],Vn);const{Provider:Un,useModel:Gn}=(0,n.Qd)(Vn,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1}),jn=(0,a.P)((function(){const t=Gn(),e=(0,ke.B)(),{getImageOptimizedCrop:i}=(0,Oo.Cg)();(0,d.useEffect)((()=>{t.setCurrentIndex(t.initialSlideIndex)}),[t.initialSlideIndex]);const n=(0,d.useMemo)((()=>e.numeric(t.currentIndex+1,e.getLang("wall_posting_photo_counter")).replace("{count}",String(t.currentIndex+1)).replace("{total}",String(t.photos.length))),[t.currentIndex,t.photos]);return(0,s.FD)("div",{style:{width:t.imageContainerDimensions.imageContainerWidth,height:t.imageContainerDimensions.imageContainerHeight},"data-testid":"posting_attachment_photo_view_item",children:[(0,s.Y)(Nn,{photos:t.photos,leftFooterItem:(0,s.Y)(We.EY,{className:(0,fe.I)("color_text_secondary"),children:n}),rightFooterItem:(0,s.Y)(be.$,{mode:"secondary",size:"m",onClick:t.handleOpenPhotoEditor,children:e.getLang("wall_posting_photo_editor_action_text")}),onSlideChange:e=>{t.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.ChangePhotoSlide}),t.setCurrentIndex(e)},initialIndex:t.initialSlideIndex,defaultRatio:t.defaultRatio,getImageOptimizedCrop:i}),(0,s.Y)(o.wyA,{onClick:t.handleGoBack,children:e.getLang("global_close")})]})})),Wn=(0,n.jn)(Un,jn);var Hn=i(93059);const{Provider:$n,useModel:Kn}=(0,n.Qd)(co,{initInEffect:!1}),qn=(0,a.P)((function(){const t=(0,ke.B)(),{postManager:e,postingSettings:i,privacyTemp:n,donutLevelTemp:a,hasDonutLevels:r,handleSetTempDonutLevel:d,handleChangeTempPrivacy:c}=Kn(),{isActivePrivacyDonutLevel:l}=e;return(0,s.FD)(ge.c,{insetLevel:1,children:[(0,s.Y)(Ke.T,{onClick:()=>c(H),after:n===H?(0,s.Y)(ye.f.Checkbox,{type:"circle",checked:!0,readOnly:!0}):null,"data-testid":"posting_settings_visibility_all",children:t.getLang("wall_posting_privacy_type_all")}),(0,s.Y)(Ke.T,{onClick:()=>c(q),"data-testid":"posting_settings_visibility_donut",after:n!==q||a?null:(0,s.Y)(ye.f.Checkbox,{type:"circle",checked:!0,readOnly:!0}),children:t.getLang("wall_posting_privacy_type_donut")}),r&&(0,s.FD)(o.nD3,{defaultExpanded:l,children:[(0,s.FD)(o.nD3.Summary,{"data-testid":"posting_settings_visibility_donut_level",children:[(0,s.Y)(We.$j,{level:"1",weight:"3",children:t.getLang("wall_posting_privacy_type_donut_level_title")}),(0,s.Y)(We.EY,{className:(0,fe.I)("color_text_secondary"),children:t.getLang("wall_posting_privacy_type_donut_level_subtitle")})]}),(0,s.Y)(o.nD3.Content,{children:i?.donut?.levels_for_privacy?.map((e=>(0,s.Y)(Ke.T,{onClick:()=>d(e.id),after:e.id===a?(0,s.Y)(ye.f.Checkbox,{type:"circle",checked:!0,readOnly:!0}):null,"data-testid":`posting_settings_visibility_${e.id}`,subtitle:t.langReplace(t.getLang("groups_donut_levels_choice_modal_level_description"),{sum:e.price}),children:e.title},e.id)))})]})]})})),Qn=(0,a.P)((function(){const t=(0,ke.B)(),{postingSettings:e,privacyTemp:i,hasDonutLevels:o,donutLevelTemp:n,handleSetTempDonutLevel:a,handleChangeTempPrivacy:r}=Kn();return(0,s.FD)(ge.c,{insetLevel:1,children:[(0,s.Y)(Hn.N,{"data-testid":"posting_settings_visibility_all",onChange:()=>r(H),checked:i===H,children:t.getLang("wall_posting_privacy_type_all")}),o&&(0,s.FD)(s.FK,{children:[(0,s.Y)($e.K,{size:8}),(0,s.Y)(li.w,{padding:!0}),(0,s.Y)($e.K,{size:4}),(0,s.Y)(me.Y,{mode:"secondary",children:t.getLang("wall_posting_privacy_type_donut_level_title_group")}),e?.donut?.levels_for_privacy?.map(((e,i)=>(0,s.Y)(Hn.N,{onChange:()=>a(e.id),checked:e.id===n,"data-testid":`posting_settings_visibility_level_${i}`,subtitle:t.langReplace(t.getLang("groups_donut_levels_choice_modal_level_description"),{sum:e.price}),children:e.title},e.id)))]})]})})),Jn=(0,a.P)((function(){const t=(0,ke.B)(),{onCloseModal:e,onGoBack:i,canSelectDonutType:o,handleSelectPrivacy:n}=Kn();return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:i,backLabel:t.getLang("global_back"),onClose:e,closeAriaLabel:t.getLang("global_close"),children:t.getLang("wall_posting_privacy_label")}),(0,s.Y)(ue.g,{children:o?(0,s.Y)(qn,{}):(0,s.Y)(Qn,{})}),(0,s.Y)(we.j,{actions:(0,s.Y)(be.$,{onClick:n,size:"l",appearance:"accent","data-testid":"posting_settings_visibility_save_button",children:t.getLang("wall_posting_privacy_select_privacy")})})]})})),Xn=(0,n.jn)($n,Jn);var Zn=i(467950),ta=i(405697),ea=i(540431),ia=i(131203),sa=i(222304),oa=i(578544),na=i(354015),aa=i(70733),ra=i(12027),da=i(626853);const ca="AttachmentsGrid__root--n167K",la="AttachmentsGrid__single--IR4P5",ha=(0,a.P)((function({postManager:t,mediaGridConfig:e,getPercents:i,onCancelUpload:o,onRemoveAttach:n,onOpenPhotoViewer:a,onOpenVideoViewer:r}){const d=(0,ke.B)(),{ref:c}=(0,ra.L)({videos:t.attachments.map((t=>{if("video"===t.type)return t.video}))}),l=t.attachments.map((t=>{const e=(0,Bo.Qq)(t),{itemId:s,ownerId:c}=(0,V.AJ)(t),l=i(s,c);let h,p=(0,Bo.Y1)(t);h="video"===t.type?{...e.overlay||{},kind:"video",canPlay:!1,isInteractive:!1,hidePlayButton:!0}:{...e.overlay||{},kind:"photo",hasMarket:!1,hasNFT:!1};const u=(0,Ot.Et)(l)&&l>0&&l<100,g="photo"===t.type&&(!t.photo?.date||t.photo?.date&&u),_="video"===t.type&&"live"!==t.video?.type&&(!t.video?.duration||t.video?.duration&&u);let m;return!p&&(0,Ot.Et)(l)&&(_||g)&&(p={type:"restricted",noIcon:!0}),t.photo&&a?m={onClick:e=>{(0,da.T)(e),a(t.photo)}}:t.video&&r&&(m={onClick:e=>{(0,da.T)(e),r(t.video)}}),{...e,restriction:p,overlay:{...h,onRemove:e=>{(0,da.T)(e),n(t,e)},progress:l,onCancelUpload:e=>{(0,da.T)(e),o(t,e)},cancelUploadAriaLabel:d.getLang("global_cancel")},action:m,canExtendBackground:!0}})),h=l[0]?.sizes,p=h?h[h.length-1]:null,u=1===l.length&&p&&p.width/p.height<1;return(0,s.Y)("div",{className:(0,ko.$)(ca,u&&la),ref:c,children:(0,s.Y)(Fo.h,{background:"gray_fields",features:e.mediaGridFeatures,maxContainerWidth:424,maxImageWidth:424,maxImageHeight:800,useMaskImage:Yo.T.safari,attachments:l,noSortAnimation:!0,onSortChange:(e,i,s)=>{(0,Ot.Et)(i)&&(0,Ot.Et)(s)&&t.sortAttachments(i,s)}})})}));var pa=i(224173);const ua=(0,a.P)((function({link:t,onRemove:e,isMobile:i=!1}){const o=(0,ke.B)(),n=t=>{(0,te.T)(t.nativeEvent),e(t)},a=(0,d.useMemo)((()=>({title:t.title||"",photo:t.photo?.sizes,caption:t.caption?(0,s.Y)(Ho.N,{target:"_blank",href:dt(t.url),mode:"secondary",children:t.caption}):"",actionButton:(0,s.Y)(be.$,{onClick:n,rounded:!0,"aria-label":o.getLang("global_close"),size:"s",mode:"secondary_transparent",before:(0,s.Y)(pa.X,{}),"data-testid":"posting_link_preview_close_button"}),"data-testid":"posting_link_preview_container",maxImageWidth:550})),[t]);return i?(0,s.Y)(jo,{mode:"feed",...a}):(0,s.Y)(Ge.i,{children:(0,s.Y)(jo,{mode:"posting",...a})})}));var ga=i(675492);const _a=(0,a.P)((function({article:t,onRemove:e,isMobile:i=!1}){const o=(0,ke.B)(),n=t=>{(0,te.T)(t.nativeEvent),e(t)},a=(0,d.useMemo)((()=>({title:t.title||"",sizes:t.photo?.sizes,caption:t.owner_name?o.langReplace(o.getLang("pages_articles_label_long"),{author:t.owner_name}):o.getLang("pages_articles_label"),actionButton:(0,s.Y)(be.$,{onClick:n,rounded:!0,"aria-label":o.getLang("global_close"),size:"s",mode:"secondary_transparent",before:(0,s.Y)(pa.X,{}),"data-testid":"posting_article_preview_close_button"}),maxImageWidth:550,maxContainerWidth:550,"data-testid":"posting_article_preview_container"})),[t]);return i?(0,s.Y)(ga.p,{...a,mode:"feed"}):(0,s.Y)(Ge.i,{children:(0,s.Y)(ga.p,{...a,mode:"posting"})})}));var ma=i(798980),va=i(923444);const ya={maxImageWidth:550,maxContainerWidth:0,background:"blur",sizes:[]},fa=(0,a.P)((function({doc:t,onRemove:e,docPhoto:i,compact:o=!1}){const n=(0,ke.B)(),a=t=>{(0,te.T)(t.nativeEvent),e(t)};return(0,s.Y)(ma.F,{gap:2,gapOffset:96,spacing:4,align:"center",children:[t].map((t=>(0,s.Y)(ma.F.Item,{children:(0,s.Y)(To.P,{...ya,sizes:[{width:i.width,height:i.height,url:String(t.url)}],noBorderRadius:o,actionButton:(0,s.Y)(di.K,{onClick:a,title:n.getLang("global_delete"),noPadding:!0,"data-testid":"posting_attachment_gif_item_remove",children:(0,s.Y)(va.W,{})}),"data-testid":"posting_attachment_gif_item"})},1)))})}));var Sa=i(651337),wa=i(237582),ba=i(296922),Pa=i(325159);const Aa="vkitOnboardingContentBadge__textContainer--nnH4V",ka="vkitOnboardingContentBadge__text--wFUwN",Ca=(Pa.R,({onAnimationEnd:t,text:e,showText:i,before:o,appearance:n="neutral",...a})=>(0,s.Y)(Pa.R,{...a,appearance:n,children:(0,s.FD)(bo.s,{noWrap:!0,children:[o,Boolean(i&&e)&&(0,s.Y)("div",{className:Aa,onTransitionEnd:t,children:(0,s.Y)(Qe.b,{className:ka,lines:1,children:e})})]})})),Ia=({animate:t,photo:e,onOpenPhotoCrop:i})=>{const o=(0,ke.B)(),[n,a]=(0,d.useState)(!1);return(0,d.useEffect)((()=>{t&&a(t)}),[t]),(0,s.Y)(Ca,{mode:"primary",appearance:"overlay",size:"l",onClick:t=>{(0,da.T)(t),i(e)},"aria-label":n?void 0:o.getLang("wall_posting_photo_crop_action_text"),text:o.getLang("wall_posting_photo_crop_action_text"),before:(0,s.Y)(ba.h,{}),showText:n,onAnimationEnd:()=>a(!1)})};var Ea=i(435485);const La=({animate:t,photo:e,onAnimate:i,onOpenPhotoEditor:o})=>{const n=(0,ke.B)(),[a,r]=(0,d.useState)(!1);return(0,d.useEffect)((()=>{t&&(r(t),i())}),[t]),(0,s.Y)(Ca,{mode:"primary",appearance:"overlay",size:"l",onClick:t=>{(0,te.T)(t),o(e)},"aria-label":a?void 0:n.getLang("wall_posting_photo_editor_action_text"),text:n.getLang("wall_posting_photo_editor_action_text"),before:(0,s.Y)(Ea.E,{}),showText:a,onAnimationEnd:()=>r(!1)})},Ta=({photo:t,crop:e,ratio:i,onDelete:o,onCropChanged:n,onOpenPhotoCrop:a,onOpenPhotoEditor:r,onHideCropZoomOnboarding:c,onHidePhotoEditorOnboarding:l,onOpenPhotoViewer:h,hasOnboarding:p,hasEditorOnboarding:u,primaryAttachProps:g,isPhotoCropEnabled:_})=>{const m=(0,ke.B)(),[v,y]=(0,d.useState)(!1),[f,S]=(0,d.useState)(!e&&(0,J.R9)(i,t)),w=t.orig_photo?.height,b=t.orig_photo?.width,P=(0,pt.o)({itemId:Number(t?.id),ownerId:Number(t?.owner_id)}),A=(0,d.useMemo)((()=>(0,J.OG)(t.restrictions)),[t.restrictions]),k=(0,d.useMemo)((()=>{if(!A)return{onClick:e=>{(0,te.T)(e),h(t)}}}),[A]),C=(0,Oo.wr)(b,w);return C?(0,s.Y)(Mo.y.Crop,{...g,ratio:i,sizes:(0,J.WQ)(t),onCropChanged:t=>n(P,t),crop:e,autoCrop:C,actionTopButton:(0,s.Y)(di.K,{onClick:e=>{(0,te.T)(e),o({type:"photo",photo:t},e)},noPadding:!0,"data-testid":"posting_attachment_photo_item_remove",label:m.getLang("global_delete"),children:(0,s.Y)(va.W,{})}),restriction:A,"data-testid":"posting_attachment_item",action:k,children:(0,s.Y)(wa.v.OverlayItem,{padding:8,placement:"bottom-left",children:(0,s.Y)(La,{onOpenPhotoEditor:r,photo:t,animate:u,onAnimate:l})})}):_?(0,s.Y)(Mo.y.Crop,{...g,ratio:i,sizes:(0,J.WQ)(t),onCropChanged:t=>n(P,t),crop:e,noBorderRadius:f,photoAnimationDuration:800,photoLessThanContainerAllowed:f,animateCropChange:f,showAllImageAnimation:f,onPhotoTransitionEnd:()=>{S(!1),p&&(y(!0),c())},actionTopButton:!f&&(0,s.Y)(di.K,{onClick:e=>{(0,te.T)(e),o({type:"photo",photo:t},e)},noPadding:!0,"data-testid":"posting_attachment_photo_item_remove",label:m.getLang("global_delete"),children:(0,s.Y)(va.W,{})}),restriction:A,"data-testid":"posting_attachment_item",action:k,children:!f&&(0,s.Y)(wa.v.OverlayItem,{padding:8,placement:"bottom-left",children:(0,s.Y)(Ia,{onOpenPhotoCrop:a,photo:t,animate:v&&p})})},String(!e)):(0,s.Y)(Mo.y,{...g,ratio:i,sizes:(0,J.WQ)(t),actionButton:(0,s.Y)(di.K,{onClick:e=>{(0,te.T)(e),o({type:"photo",photo:t},e)},noPadding:!0,"data-testid":"posting_attachment_photo_item_remove",label:m.getLang("global_delete"),children:(0,s.Y)(va.W,{})}),restriction:A,"data-testid":"posting_attachment_item",action:k,children:(0,s.Y)(wa.v.OverlayItem,{padding:8,placement:"bottom-left",children:(0,s.Y)(La,{onOpenPhotoEditor:r,photo:t,animate:u,onAnimate:l})})})};var Ma=i(451465);const Oa=({attachment:t,crop:e,ratio:i,onDelete:o,onCropChanged:n,onOpenPhotoCrop:a,onOpenPhotoEditor:r,onOpenPhotoViewer:c,onOpenVideoViewer:l,onHideCropZoomOnboarding:h,onHidePhotoEditorOnboarding:p,percents:u=0,onCancelUpload:g,hasOnboarding:_,hasEditorOnboarding:m,isPhotoCropEnabled:v,isPhotosEarsEnabled:y})=>{const f=(0,ke.B)(),S=0===u||u>=100,w=Io({photosEarsEnabled:y,colorScheme:(0,Lo.A)(),background:Ma.T.safari?"blur":"backdrop_blur"});let b="";"video"in t?b=(0,F.WO)({id:Number(t.video?.id),ownerId:Number(t.video?.owner_id)}):"clip"in t?b=(0,F.WO)({id:Number(t.clip?.id),ownerId:Number(t.clip?.owner_id)}):"photo"in t&&(b=(0,F.WO)({id:Number(t.photo?.id),ownerId:Number(t.photo?.owner_id)}));const P=(0,d.useMemo)((()=>{let e;if("video"in t||"clip"in t){if(e=t.video??t.clip,e&&"image"in e)return e.image}else if("photo"in t&&(e=t.photo,e&&"sizes"in e))return e.sizes;return[]}),[]),A=t.video??t.clip;if(A&&A.image?.length&&(A.duration||"live"===A.type)&&S){const e=(0,ht._w)(A);return(0,s.Y)(To.P,{...w,ratio:i,sizes:e,overlay:{kind:"video",formattedDuration:A.duration?(0,Eo.a)(Number(A.duration)):"",platform:A.platform,canPlay:!0,hidePlayButton:!1,isLive:"live"===A.type,liveType:A.live_status},action:{onClick:()=>l(A)},actionButton:(0,s.Y)(di.K,{onClick:e=>o(t,e),noPadding:!0,"data-testid":"posting_attachment_video_item_remove",label:f.getLang("global_delete"),children:(0,s.Y)(va.W,{})}),"data-testid":"posting_attachment_item"},b)}return"photo"in t&&t.photo?.sizes?.length&&t.photo?.date&&S?(0,s.Y)(Ta,{photo:t.photo,crop:e,ratio:i,onDelete:o,onCropChanged:n,onOpenPhotoCrop:a,onOpenPhotoEditor:r,onOpenPhotoViewer:c,onHideCropZoomOnboarding:h,onHidePhotoEditorOnboarding:p,hasOnboarding:_,hasEditorOnboarding:m,primaryAttachProps:w,isPhotoCropEnabled:v},b):(0,s.Y)(Mo.y.Crop,{hasBlur:!0,...w,background:"white_fields",ratio:i,sizes:P,actionCenterButton:(0,s.Y)(Sa.I,{"aria-label":f.getLang("global_cancel"),value:u,onClick:e=>g(t,e)}),"data-testid":"posting_attachment_item"},b)};var Da=i(417313);const xa="AttachmentsCarousel__root--whNko",Ra=(0,a.P)((function({postManager:t,onCancelUpload:e,onRemoveAttach:i,getPercents:o,initialSlideIndex:n,onboardingSlideIndex:a,editorOnboardingSlideIndex:r,isPhotoCropEnabled:c,isPhotosEarsEnabled:l,onHideCropZoomOnboarding:h,onHidePhotoEditorOnboarding:p,onOpenPhotoCrop:u,onOpenPhotoEditor:g,onSlideChange:_,onOpenPhotoViewer:m,onOpenVideoViewer:v}){const y=(({postManager:t,initialSlideIndex:e,onboardingSlideIndex:i,onSlideChange:s})=>{const[o,n]=(0,d.useState)(t.attachments.length),[a,r]=(0,d.useState)(e),[c,l]=(0,d.useState)(0);return(0,Da.w)((()=>{const e=t.attachments.length;if(o<e){const t=i>-1?i:e-1;r(t),s?.(t),l(Date.now())}n(e)}),[t.attachments.length]),{slideIndex:a,key:c}})({postManager:t,initialSlideIndex:n,onboardingSlideIndex:a,onSlideChange:_});return(0,s.Y)("div",{className:xa,children:(0,s.Y)(ma.F,{...y,gap:8,gapOffset:t.attachmentsAspect?.gapOffset,spacing:4,showArrows:!0,align:"center",onChange:_,children:t.attachments.map(((n,d)=>{const{itemId:_,ownerId:y}=(0,V.AJ)(n),f=n.photo?t.photoAttachmentsCrop?.[(0,J.S6)(n.photo)]:void 0,S=ut(n);return(0,s.Y)(Pe.n,{children:()=>(0,s.Y)(ma.F.Item,{children:(0,s.Y)(Oa,{attachment:n,ratio:t.attachmentsAspect?.ratio,onCropChanged:t.setPhotoAttachmentsCrop,crop:f,onOpenPhotoCrop:u,onOpenPhotoEditor:g,onOpenPhotoViewer:m,onOpenVideoViewer:v,onHideCropZoomOnboarding:h,onHidePhotoEditorOnboarding:p,hasOnboarding:a===d,hasEditorOnboarding:r===d,onDelete:i,percents:o(_,y),onCancelUpload:e,isPhotoCropEnabled:c,isPhotosEarsEnabled:l})})},S)}))})})})),Ya=(0,a.P)((function({uploadManager:t,postManager:e,initialSlideIndex:i,isPhotoCropEnabled:o,isPhotosEarsEnabled:n,onboardingSlideIndex:a,editorOnboardingSlideIndex:r,mediaGridConfig:c,removeAttachment:l,onSlideChange:h,onOpenPhotoCrop:p,onOpenPhotoEditor:u,onOpenPhotoViewer:g,onOpenVideoViewer:_,onHideCropZoomOnboarding:m,onHidePhotoEditorOnboarding:v}){const y=(0,d.useCallback)(((e,i)=>{const{itemId:s,ownerId:o}=(0,V.AJ)(e);l({type:e.type,itemId:s,ownerId:o,event:i}),t.removeAttachment(e.type,s,o)}),[l,t]);if(e.attachments.length){const d=(e,i)=>{t.cancelAttachUpload(e),y(e,i)};return e.isCarouselAttachmentView||e.hasSingleMediaAttachment?(0,s.Y)(Ra,{postManager:e,getPercents:t.getPercents,onCancelUpload:d,onRemoveAttach:y,initialSlideIndex:i,onSlideChange:h,onOpenPhotoCrop:p,onOpenPhotoEditor:u,onboardingSlideIndex:a,editorOnboardingSlideIndex:r,onOpenPhotoViewer:g,onOpenVideoViewer:_,onHideCropZoomOnboarding:m,onHidePhotoEditorOnboarding:v,isPhotoCropEnabled:o,isPhotosEarsEnabled:n}):(0,s.Y)(ha,{postManager:e,mediaGridConfig:c,getPercents:t.getPercents,onCancelUpload:d,onRemoveAttach:y,onOpenPhotoViewer:g,onOpenVideoViewer:_})}return e.link?(0,s.Y)(ua,{link:e.link,onRemove:t=>l({event:t,type:"link",itemId:Number(e.link?.id)})}):e.article?(0,s.Y)(_a,{article:e.article,onRemove:t=>l({event:t,type:"article",itemId:Number(e.article?.id),ownerId:Number(e.article?.owner_id)})}):e.isDocValidMediaAttach&&e.doc&&e.docGifPreviewSize?(0,s.Y)(fa,{doc:e.doc,docPhoto:e.docGifPreviewSize,onRemove:t=>l({event:t,type:"doc"})}):null})),Fa=(0,a.P)((function({onVideoPickerOpen:t,onPhotoPickerOpen:e,removeAttachment:i,onOpenPhotoCrop:n,onOpenPhotoEditor:a,onOpenPhotoViewer:r,onOpenVideoViewer:c,onSlideChange:l,onHideCropZoomOnboarding:h,onHidePhotoEditorOnboarding:p,onboardingSlideIndex:u,editorOnboardingSlideIndex:g,setAttachmentsView:_,setAttachmentsAspect:m,initialSlideIndex:v,uploadManager:y,postManager:f,isPhotoCropEnabled:S,isPhotosEarsEnabled:w,mediaGridConfig:b,checkIfModalClosingBlocked:P}){const A=(0,d.useRef)(null),k=(0,d.useRef)(null),C=(0,ke.B)(),I=f.isCarouselAttachmentView&&!f.hasOnlyVideoAttachments&&f.attachmentsAspect&&S,E=t=>t.key===T.rk.ORIGINAL?C.getLang(t.label):t.label;let L="";return I&&(L=f.attachmentsAspect.key===T.rk.ORIGINAL?C.getLang("global_posting_carousel_ratio_original"):C.langReplace(C.getLang("wall_posting_format_label"),{ratio:f.attachmentsAspect.label})),(0,s.FD)(s.FK,{children:[(0,s.Y)(Ya,{removeAttachment:i,uploadManager:y,postManager:f,onOpenPhotoCrop:n,onOpenPhotoEditor:a,onOpenPhotoViewer:r,onOpenVideoViewer:c,onSlideChange:l,initialSlideIndex:v,onHideCropZoomOnboarding:h,onHidePhotoEditorOnboarding:p,onboardingSlideIndex:u,editorOnboardingSlideIndex:g,isPhotoCropEnabled:S,isPhotosEarsEnabled:w,mediaGridConfig:b}),(0,s.FD)(Ge.i,{spacing:8,paddingTop:8,paddingBottom:8,children:[(0,s.FD)(Is.e,{mode:"horizontal",stretched:!0,children:[f.hasMediaAttachments&&(0,s.FD)(Is.e,{align:"left",mode:"horizontal",children:[!f.hasSingleMediaAttachment&&(0,s.Y)(vs.v,{"aria-label":f.attachmentsView.label,trigger:["hover","click"],hoverDelay:[T.EP,T.jt],onShownChange:(t,e)=>P(e),content:Object.values(T.fY).map((t=>(0,s.Y)(vs.v.Item,{onClick:()=>_({view:t}),after:t===f.attachmentsView?(0,s.Y)(so.$,{}):null,before:(0,s.Y)(t.icon,{className:(0,fe.I)("color_text_primary")}),"data-testid":"posting_base_screen_view_option",children:t.label},t.label))),children:(0,s.Y)(be.$,{mode:"tertiary",appearance:"neutral",size:"m",before:(0,s.Y)(f.attachmentsView.icon,{}),after:(0,s.Y)(ea.w,{}),"data-testid":"posting_base_screen_view_button",children:f.attachmentsView.label})}),I&&(0,s.Y)(vs.v,{"aria-label":L,trigger:["hover","click"],onShownChange:(t,e)=>P(e),content:f.mediaAttachAspectArray.map((t=>(0,s.Y)(vs.v.Item,{onClick:()=>(t=>{if(!k.current)return;const e={currentTarget:k.current,preventDefault:()=>{},stopPropagation:()=>{}};m({aspect:t,event:e})})(t),after:t.key===f.attachmentsAspect?.key?(0,s.Y)(so.$,{}):null,"data-testid":"posting_base_screen_ratio_option",children:E(t)},t.label))),children:(0,s.Y)(be.$,{mode:"tertiary",appearance:"neutral",size:"m",after:(0,s.Y)(ea.w,{}),before:(0,s.Y)(ia.C,{}),"data-testid":"posting_base_screen_ratio_button",getRootRef:k,children:L})})]}),(0,s.FD)(Is.e,{align:"right",stretched:!0,children:[(0,s.Y)(o.s6o,{Component:"input",type:"file",multiple:!0,accept:y.inputAccept,onChange:t=>y.uploadFiles(Array.from(t.target.files||[])),getRootRef:A}),(0,s.Y)(vs.v,{"aria-label":f.hasMediaAttachments?C.getLang("wall_posting_add_more_attachments"):C.getLang("wall_posting_add_media_attachments"),trigger:["hover","click"],hoverDelay:[T.EP,T.jt],onShownChange:(t,e)=>P(e),placement:"bottom-end",content:(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{before:(0,s.Y)(sa.b,{}),onClick:()=>A?.current?.click?.(),"data-testid":"posting_base_screen_download_from_device",children:C.getLang("wall_posting_download_from_device")}),(0,s.Y)(vs.v.Item,{before:(0,s.Y)(oa.g,{}),onClick:e,"data-testid":"posting_base_screen_select_photo_vk",children:C.getLang("wall_posting_photo_vk")}),(0,s.Y)(vs.v.Item,{before:(0,s.Y)(na.z,{}),onClick:t,"data-testid":"posting_base_screen_select_video_vk",children:C.getLang("wall_posting_video_vk")})]}),children:(0,s.Y)(be.$,{before:(0,s.Y)(aa.i,{}),mode:"tertiary",appearance:"accent",after:(0,s.Y)(ea.w,{}),size:"m","data-testid":"posting_base_screen_add_more_attachments",children:f.hasMediaAttachments?C.getLang("wall_posting_add_more_attachments"):C.getLang("wall_posting_add_media_attachments")})})]})]}),(0,s.Y)(Bi.F,{})]})]})}));var Ba=i(215402),Na=i(182023),za=i(556067),Va=i(432729);const Ua="PostInput__input--Y0sR4",Ga="PostInput__placeholder--BxVDh",ja=(0,d.forwardRef)((function({onInput:t,value:e,className:i,testId:n=""},a){const r=(0,ke.B)(),d=!e||"\n"===e;return(0,s.Y)(Pe.n,{children:()=>(0,s.FD)(s.FK,{children:[(0,s.Y)(o.KTU,{as:"span",getRootRef:a,role:"textbox","aria-multiline":!0,"aria-label":r.getLang("wall_posting_post_text_placeholder"),contentEditable:!0,suppressContentEditableWarning:!0,className:(0,ko.$)(Ua,i),onInput:t,"data-testid":n}),d&&(0,s.Y)(zo.h,{Component:"span",offset:[0,1],className:Ga,placement:"top-left","aria-hidden":"true",children:r.getLang("wall_posting_post_text_placeholder")})]})})})),Wa="PostInputWithEmoji__root--v7mn5",Ha="PostInputWithEmoji__input--oRO9c",$a="PostInputWithEmoji__messageInputWrapper--oUMAn",Ka="PostInputWithEmoji__emojiWrapper--VPHvb",qa="PostInputWithEmoji__emoji--6P8Fi",Qa=(0,a.P)((function({postManager:t,containerRef:e,pickerPosition:i,onChangeText:o,inputRef:n}){const a=(0,ke.B)(),{handleInput:r}=(0,za.k)({inputValue:t.text,inputRef:n,onChangeInput:o,emojiOpts:{onUGCStickerSend:zi.l,emojiLoadMore:zi.l,ref:"posting_textarea",global:!1,noStickers:!0,noEnterSend:!0,pickerBottomMargin:12,pickerHeight:240,pickerPosition:i,noCancelEventWhenImagePaste:!0,ariaHidden:!0}});return(0,d.useEffect)((()=>{n?.current&&(n.current.focus(),(0,Na.gX)(n.current))}),[n]),(0,s.Y)("div",{className:(0,ko.$)("_emoji_field_wrap",Wa),children:(0,s.FD)(bo.s,{noWrap:!0,align:"stretch",className:$a,children:[(0,s.Y)(ja,{ref:n,onInput:t=>{"inputType"in t.nativeEvent&&(!t.nativeEvent.inputType||"dataTransfer"in t.nativeEvent&&t.nativeEvent.dataTransfer)&&n?.current&&e?.current&&(0,Na.mG)(e.current),r(t)},className:Ha,value:t.text,testId:"posting_base_screen_input_message"}),(0,s.Y)(Va.v,{className:Ka,children:({className:t,...e})=>(0,s.Y)("div",{className:(0,ko.$)(t,qa,"emoji_smile"),role:"button","aria-label":a.getLang("wall_reply_emoji_hint"),title:a.getLang("wall_reply_emoji_hint"),"data-testid":"posting_base_screen_input_message_emoji_button",...e,children:(0,s.Y)(Ba.w,{className:(0,fe.I)("color_icon_secondary")})})})]})})}));var Ja=i(891941),Xa=i(524161),Za=i(600268);const tr=(0,a.P)((function({onClick:t,draftsCount:e}){const i=(0,ke.B)();return(0,s.Y)(be.$,{appearance:"neutral",mode:"secondary",onClick:t,before:(0,s.Y)(Za.$,{}),after:!!e&&(0,s.Y)(Xa.p,{size:"s",mode:"secondary",children:e}),"data-testid":"posting_drafts_open",children:i.getLang("wall_posting_drafts_open")})}));var er=i(572573),ir=i(40131),sr=i(513530),or=i(120193),nr=i(57596),ar=i(780482),rr=i(881940);const dr=({visible:t})=>{const e=(0,ke.B)();return t?(0,s.Y)(o.azJ,{children:(0,s.Y)(ar.l,{before:(0,s.Y)(rr.G,{}),size:"s",noPadding:!0,borderRadiusMode:"inherit",title:e.getLang("wall_posting_vkr_opener_banner_title"),subtitle:e.getLang("wall_posting_vkr_opener_banner_subtitle")})}):null},cr=(0,a.P)((function(t){const{postTextLimit:e}=t;return e.counterIsShown?(0,s.Y)(We.tW,{className:e.limitExceeded?(0,fe.I)("color_text_negative"):(0,fe.I)("color_text_secondary"),children:e.counter}):null}));var lr=i(382996),hr=i(516768),pr=i(419995);const ur=Ws.L.ACCOUNT_HINT_FEED_POSTING_NEXT_BUTTON_WEB,gr=(0,a.P)((function({postingViewModel:t}){const e=(0,ke.B)(),i=t.helpHints.get(ur);(0,d.useEffect)((()=>{t.postManager.showCreateArticleButton&&t.productAnalyticsLogger.logClickArticleEvent({articleEventType:Qt.fk.ShowArticleCreationButton})}),[t.postManager.showCreateArticleButton]);const o=()=>{i&&t.helpHints.hide(ur)};return(0,s.Y)(we.j,{before:t.postManager.postTextLimit.counterIsShown?(0,s.Y)(cr,{postTextLimit:t.postManager.postTextLimit}):(0,s.Y)(be.$,{mode:"link",appearance:"accent",before:(0,s.Y)(lr.H,{}),target:"_blank",href:e.getLang("wall_posting_publishing_tips_link"),disabled:t.hasProcessing,children:e.getLang("wall_posting_publishing_tips_text")}),actions:(0,s.FD)(s.FK,{children:[t.postManager.showCreateArticleButton&&(0,s.Y)(be.$,{size:"m",mode:"secondary",onClick:async()=>{t.clearLocalDraft?.(),(0,hr.Y)(t.ownerId,0,((t,e)=>{const i=[];return e.forEach((t=>{t.photo?i.push("photo_"+(0,pt.o)({ownerId:t.photo.owner_id,itemId:t.photo.id})):t.video&&i.push("video_"+(0,pt.o)({ownerId:Number(t.video.owner_id),itemId:Number(t.video.id)}))})),{text:t,medias:i}})(t.postManager.text,t.postManager.attachments),{al:1},{onDone:()=>{pr.qh.logPickerReady()},onFail:t=>pr.qh.logError({message:t?JSON.stringify(t):void 0})}),t.productAnalyticsLogger.logClickNavigationEvent({navigationEventType:Qt.X3.ClickArticleCreationButton})},"data-testid":"posting_base_create_article",children:e.getLang("wall_posting_create_article")}),(0,s.Y)(Ys.V,{tipPosition:"top-left",shown:Boolean(i),onClick:o,onClose:o,onMarkerClick:o,size:96,maxWidth:160,mode:"1",appearance:"lime",tilt:"left",content:i?.title,autoUpdateOnTargetResize:!0,children:(0,s.Y)(be.$,{size:"m",mode:"primary",onClick:()=>{o(),t.postManager.hasContent?t.modalManager.openSettingsScreen():t.errorManager.showErrorSnackbar(T.Rn.EmptyPostAlertTitle)},"data-testid":"posting_base_screen_next",disabled:t.postManager.postTextLimit.limitExceeded||t.hasProcessing,loading:t.hasProcessing,children:e.getLang("global_next")})})]})})})),_r="PostingScreenBase__root--RncON",mr="PostingScreenBase__scroll--1aC8t",vr=Ws.L.ACCOUNT_HINT_FEED_POSTING_CROP_ZOOM_WEB,yr=Ws.L.ACCOUNT_HINT_FEED_POSTING_PHOTO_EDITOR_ONBOARDING_WEB,fr=(0,a.P)((function({closeModal:t,setAttachmentsView:e,postingViewModel:i,checkIfModalClosingBlocked:n,modalRef:a}){const r=(0,d.useRef)(i.attachmentsSlideIndex),c=i.helpHints.get(vr)&&i.isPhotoCropEnabled,l=i.helpHints.get(yr),h=c?i.invalidRatioSlideIndex:-1,p=l?i.firstPhotoSlideIndex:-1,[u,g]=(0,d.useState)(!0),_=(0,d.useRef)(null),m=(0,d.useRef)(null),v=(0,Lo.A)(),y=(0,ke.B)(),f=i.postManager.hasPrimaryAttachments,S=t=>{if(!i.modalManager.videoPreviewOpened){const e=t.target;if(!a.current?.contains(e)&&!e?.contains(a.current))return t.preventDefault(),void t.stopPropagation();i.uploadManager.pasteFilesFromClipboard(t)}},w=()=>{i.modalManager.setVideoPreviewOpened(!1)};(0,d.useEffect)((()=>(window.addEventListener("paste",S),window.addEventListener(or.LH.UPDATE_VIDEO,i.postManager.updateVideoAttach),window.addEventListener(or.pO.CLOSE_VIDEOVIEW,w),()=>{window.removeEventListener("paste",S),window.removeEventListener(or.LH.UPDATE_VIDEO,i.postManager.updateVideoAttach),window.removeEventListener(or.pO.CLOSE_VIDEOVIEW,w)})),[]);const b=(0,d.useCallback)((t=>{if(!t?.owner_id||!t?.id)return;const e=(0,pt.o)({ownerId:t.owner_id,itemId:t.id}),s=t.access_key||(0,pt.o)({ownerId:t.owner_id,itemId:-1}),o={queue:1,autoplay:1,minimized:0,saveBoxQueue:1,module:"posting",addParams:i.postRaw?{post_id:i.postRaw}:null};e&&s&&(i.modalManager.setVideoPreviewOpened(!0),(0,sr.showVideo)(e,s??"",o),i.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenVideo}))}),[]),P=(0,d.useCallback)((()=>{i.errorManager.showSnackbar({text:y.getLang("wall_posting_photo_crop_onboarding_text"),before:{content:(0,s.Y)(Ja.U,{className:(0,fe.I)("color_icon_accent")})},action:{label:y.getLang("wall_posting_photo_crop_onboarding_button"),onClick:(t,e)=>{i.errorManager.hideSnackbar(e)}}}),i.helpHints.hide(vr)}),[]),A=(0,d.useCallback)((()=>{i.helpHints.hide(yr)}),[]);return i.hasLoader?(0,s.Y)(ue.g,{children:(0,s.Y)(_e.y,{size:"large"})}):(0,s.FD)(s.FK,{children:[i.settingsManager.isAdsPost&&(0,s.Y)(zo.h,{zIndex:1,onClick:()=>{i.errorManager.onShowAdsPostEditError({onClose:()=>t(!0)})}}),(0,s.Y)(Re.z,{onClose:()=>t(),closeAriaLabel:y.getLang("global_close"),noSeparator:u,centered:!i.showDraftsEntrypoint,after:i.showDraftsEntrypoint&&(0,s.Y)(tr,{draftsCount:i.draftsCount,onClick:i.modalManager.openDraftsListScreen}),children:i.title}),(0,s.Y)(ue.g,{className:mr,getRootRef:_,onScroll:t=>{g(t.target.scrollTop<=0)},children:(0,s.FD)(bo.s,{direction:"column",className:_r,noWrap:!0,children:[(0,s.Y)(Pe.n,{children:()=>f?(0,s.FD)(s.FK,{children:[(0,s.Y)(Fa,{uploadManager:i.uploadManager,postManager:i.postManager,initialSlideIndex:r.current,onSlideChange:i.setAttachmentsSlideIndex,onVideoPickerOpen:i.handleOpenVideoPickerScreen,onPhotoPickerOpen:i.handleOpenPhotoPickerScreen,removeAttachment:i.removeAttachment,onOpenPhotoCrop:i.handleOpenPhotoCropScreen,onOpenPhotoEditor:i.handleOpenPhotoEditorScreen,onOpenPhotoViewer:i.handleOpenPhotoViewerScreen,onOpenVideoViewer:b,onHideCropZoomOnboarding:P,onHidePhotoEditorOnboarding:A,onboardingSlideIndex:h,editorOnboardingSlideIndex:p,setAttachmentsAspect:i.setAttachmentsAspect,setAttachmentsView:e,isPhotoCropEnabled:i.isPhotoCropEnabled,isPhotosEarsEnabled:i.isPhotosEarsEnabled,checkIfModalClosingBlocked:n,mediaGridConfig:i.mediaGridConfig}),(0,s.Y)(Zn.B,{onChange:i.uploadManager.uploadFiles,multiple:!0,overlay:!0,stretched:!0,"data-testid":"posting_base_screen_draganddrop"})]}):(0,s.Y)(Ge.i,{mode:"horizontal",paddingBottom:8,paddingTop:4,children:(0,s.Y)(Ge.i,{mode:"horizontal",paddingBottom:0,children:(0,s.Y)(Zn.B,{onChange:i.uploadManager.uploadFiles,multiple:!0,enableInteractive:!0,"data-testid":"posting_base_screen_draganddrop",children:(0,s.FD)(s.FK,{children:[(0,s.Y)($e.K,{size:56}),(0,s.Y)(ta.O,{icon:"dark"===v?(0,s.Y)(er.J,{}):(0,s.Y)(ir.F,{}),header:y.getLang("wall_posting_dnd_label"),action:(0,s.FD)(Is.e,{mode:"vertical",gap:"s",align:"center",children:[(0,s.Y)(o.ZHH,{accept:i.uploadManager.inputAccept,multiple:!0,mode:"primary",size:"m",appearance:"accent","data-testid":"posting_base_screen_download_from_device",onChange:t=>{i.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenGallery}),i.uploadManager.uploadFiles(Array.from(t.target.files||[]))},children:y.getLang("wall_posting_dnd_button_text")}),(0,s.Y)(vs.v,{placement:"bottom","aria-label":y.getLang("wall_posting_select_from_vk"),hoverDelay:[T.EP,T.jt],trigger:["hover","click"],onShownChange:(t,e)=>n(e),content:(0,s.FD)(s.FK,{children:[(0,s.Y)(vs.v.Item,{before:(0,s.Y)(oa.g,{}),onClick:i.handleOpenPhotoPickerScreen,"data-testid":"posting_base_screen_select_photo_vk",children:y.getLang("wall_posting_photo_vk")}),(0,s.Y)(vs.v.Item,{before:(0,s.Y)(na.z,{}),onClick:i.handleOpenVideoPickerScreen,"data-testid":"posting_base_screen_select_video_vk",children:y.getLang("wall_posting_video_vk")})]}),children:(0,s.Y)(be.$,{mode:"tertiary",appearance:"neutral",after:(0,s.Y)(ea.w,{}),size:"m","data-testid":"posting_base_screen_select_from_vk",children:y.getLang("wall_posting_select_from_vk")})})]})}),(0,s.Y)($e.K,{size:56})]})})})})}),(0,s.Y)(Qa,{postManager:i.postManager,onChangeText:i.onChangeText,containerRef:_,inputRef:m})]})}),(0,s.Y)(nr.M,{onChangeText:i.onChangeText,containerRef:_,inputRef:m}),(0,s.Y)(dr,{visible:i.isPostingOpenerVkr}),(0,s.Y)(gr,{postingViewModel:i})]})}));var Sr=i(432317);const wr=(0,Ne.E)((()=>Promise.all([i.e(34543),i.e(96649),i.e("langs/core_spa/ecomm_market_product_attach")]).then(i.bind(i,975057))),(({ProductAttachModalLegacy:t})=>t));function br(t){(0,Sr.tM)((e=>(0,s.Y)(wr,{...e,...t})),{width:558})}var Pr=i(700777),Ar=i(107495),kr=i(214310),Cr=i(820282);class Ir extends Cr.S{get namespace(){return"classifieds"}constructor(...t){super(...t),this.geocodingReverse=this.makeMethod("geocodingReverse"),this.getProfileInfo=this.makeMethod("getProfileInfo")}}Ir=(0,c.Cg)([n.z8.global()],Ir);class Er{constructor(t){this.classifiedsApi=t,this.pending=!1,this.address=null,this.coords=null,this.error=null,this.controller=null,this.resetError=()=>{this.error=null},this.setCoords=t=>{(0,G.n)(t,this.coords)||(this.coords=t,this.fetchAddress(t))},this.fetchMyLocation=()=>{this.pending=!0,navigator.geolocation.getCurrentPosition(this.successCallback,this.errorCallback)},this.successCallback=({coords:{latitude:t,longitude:e}})=>{const i={latitude:t,longitude:e};(0,G.n)(i,this.coords)?this.pending=!1:this.fetchAddress(i)},this.errorCallback=({code:t})=>{this.pending=!1,t===GeolocationPositionError.PERMISSION_DENIED?this.error="PERMISSION_DENIED":this.error="OTHER"},this.fetchAddress=async(t,e=new AbortController)=>{const{longitude:i,latitude:s}=t;(0,l.h5)((()=>{this.pending=!0,this.controller?.abort(),this.controller=e}));try{const{address:o}=await this.classifiedsApi.geocodingReverse({q:[s,i].join(",")},{signal:e.signal});(0,l.h5)((()=>{this.error=null,this.coords=t,this.address=o}))}catch(t){(0,l.h5)((()=>{(0,_.z)(t)||(this.error="OTHER")}))}finally{(0,l.h5)((()=>{this.pending=!1,this.controller=null}))}},(0,l.l_)(this)}}Er=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Ir?Object:Ir])],Er);var Lr=i(778722);const Tr={latitude:59.935687,longitude:30.325938};class Mr{[n.Ts](){if(this.props.current.selectedGeo){const t=this.props.current.selectedGeo.place?.title.slice(0,T.yg)||"";this.selectedPlace={place:this.props.current.selectedGeo.place,distance:0},t&&this.onChangeSearchQuery(t)}else this.myLocation.fetchMyLocation();this.productAnalyticsLogger.logClickAttachmentEvent({clickAttachmentEventType:Qt.uT.OpenPlace})}get myLocationCoords(){return this.myLocation.coords}get isLoading(){return"loading"===this._status}get isError(){return"error"===this._status}get isLoaded(){return"loaded"===this._status}get isRendered(){return this._isRendered}get searchInProgress(){return this._searchInProgress}get places(){return this.searchResultList}get isEmptySearchResult(){return 0===this.searchResultList.length&&this.searchQuery.length>1&&!this._searchInProgress}get hasSelect(){return void 0!==this.selectedPlace}resetQuery(){this.searchQuery="",this.searchResultList=this.defaultList}[n.zr](){this.searchQuery="",this.searchResultList=[],this.selectedPlace=void 0,this.controller?.abort()}constructor(t,e,i,s,o,n){this.props=t,this.mapsFactory=e,this.placesApi=i,this.myLocation=s,this.errorManager=o,this.productAnalyticsLogger=n,this._placemark=null,this._status="loading",this._coordinates=Tr,this._isRendered=!1,this.searchQuery="",this.defaultList=[],this.searchResultList=[],this.selectedPlace=void 0,this._searchInProgress=!1,this.controller=null,this.setLoading=()=>{this._status="loading"},this.setError=()=>{this._status="error"},this.setLoaded=()=>{this._status="loaded"},this.setIsRendered=t=>{this._isRendered=t},this.renderMap=async t=>{try{const e=this.props.current.selectedGeo;if(this.isLoading||this.setLoading(),await this._map.init(),e){const{latitude:t,longitude:i}=e.place;this._coordinates={latitude:t,longitude:i}}else this.myLocation.coords&&(this._coordinates=this.myLocation.coords);const i={lat:this._coordinates.latitude,lng:this._coordinates.longitude};this._map.render({container:t,center:i,zoom:15}),this.setLoaded(),this.setIsRendered(!0),e&&this.updateMap(this._coordinates.latitude,this._coordinates.longitude)}catch(t){this.setError(),this.handleShowError()}},this.updateMap=(t,e,i=!0)=>{if(this.isRendered){const s={lat:t,lng:e};i&&(this._placemark?.remove(),this._placemark=this._map.addPlacemark({coords:s}),this._placemark.focus()),this._map.setCenter({coords:s,isAnimated:!0})}},this.updateWithMyLocation=()=>{this.myLocation.coords&&(this._coordinates=this.myLocation.coords,this.updateMap(this._coordinates.latitude,this._coordinates.longitude,!1),this.searchPlaces(!0))},this.handleGoBack=()=>{this.props.current.onGoBack()},this.closeModal=()=>{this.props.current.closeModal?.()},this.onSelect=t=>{this.selectedPlace?.place?.id===t.place.id?(this.selectedPlace=void 0,this._placemark?.remove()):(this.selectedPlace=t,this.updateMap(t.place.latitude,t.place.longitude))},this.onSave=()=>{this.selectedPlace&&this.props.current.onSave?.(this.selectedPlace),this.handleGoBack()},this.isPlaceSelected=t=>void 0!==this.selectedPlace&&this.selectedPlace.place.id===t.place.id,this.searchPlaces=async(t=!1)=>{this.controller?.abort(),this._searchInProgress=!0,this.controller=new AbortController;const e={signal:this.controller.signal};try{const i=await this.placesApi.search({count:8,q:this.searchQuery,latitude:this._coordinates.latitude,longitude:this._coordinates.longitude},e);(0,l.h5)((()=>{this.searchResultList=i.items,t&&(this.defaultList=i.items),this._searchInProgress=!1}))}catch(t){(0,Lr.E)(t.error)||(0,l.h5)((()=>{this.handleShowError()})),(0,l.h5)((()=>{this._searchInProgress=!1}))}},this.onChangeSearchQuery=t=>{if(!t)return this.controller?.abort(),void this.resetQuery();this.searchQuery.trim()!==t.trim()?(this.searchQuery=t,this.searchPlacesDebounced()):this.searchQuery=t},this.searchPlacesDebounced=(0,fi.s)(this.searchPlaces,200),this.handleShowError=()=>{this.errorManager.onNetworkErrorSnackbar()},this._map=e.createMap(),(0,l.l_)(this)}}Mr=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===Ar.u?Object:Ar.u,void 0===kr.n?Object:kr.n,void 0===Er?Object:Er,void 0===Et.e?Object:Et.e,void 0===qt.I?Object:qt.I])],Mr);const{Provider:Or,useModel:Dr}=(0,n.Qd)(Mr,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1});var xr=i(284447);const Rr=(0,a.P)((function({place:t,onSelect:e,isPlaceSelected:i}){return(0,s.Y)(Ke.T,{"data-testid":"posting_geo_picker_place_row",onClick:()=>e(t),before:(0,s.Y)(qe.e,{withTransparentBackground:!0,noBorder:!0,size:36,alt:"",children:(0,s.Y)(xr.P,{className:(0,fe.I)("color_icon_secondary")})}),subtitle:t.place.address,minHeight:44,after:i(t)&&(0,s.Y)(ye.f.Checkbox,{type:"circle",checked:!0,readOnly:!0,"data-testid":"posting_geo_picker_search_result_cell_checked"}),children:t.place.title},t.place.id)})),Yr="PostingScreenGeoPicker__mapWrapper--CI09v",Fr="PostingScreenGeoPicker__map--CwVdD",Br=(0,a.P)((function(){const t=(0,ke.B)(),{handleGoBack:e,closeModal:i,onSelect:o,onSave:n,hasSelect:a,renderMap:r,updateWithMyLocation:c,isRendered:l,isLoading:h,searchQuery:p,searchInProgress:u,isEmptySearchResult:g,onChangeSearchQuery:_,isPlaceSelected:m,myLocationCoords:v,places:y}=Dr(),f=(0,d.useRef)(null);return(0,d.useEffect)((()=>{f.current&&r(f.current)}),[]),(0,d.useEffect)((()=>{v&&l&&!a&&c()}),[v,l]),(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:e,backLabel:t.getLang("global_back"),onClose:i,closeAriaLabel:t.getLang("global_close"),children:t.getLang("wall_posting_place")}),(0,s.Y)(Ge.i,{spacing:16,mode:"vertical",paddingBottom:8,"aria-busy":h,"aria-live":"polite",children:(0,s.FD)("div",{className:Yr,children:[h&&(0,s.Y)(zo.h,{placement:"top-left",Component:Xe.E,width:"100%",height:172,borderRadius:8}),(0,s.Y)("div",{ref:f,className:Fr})]})}),(0,s.Y)(Ge.i,{spacing:4,mode:"vertical",paddingTop:0,paddingBottom:0,children:(0,s.Y)(He.v,{"data-testid":"posting_geo_picker_search_input",placeholder:t.getLang("global_search"),value:p,onChange:t=>_(t.target.value),maxLength:T.yg})}),(0,s.FD)(ue.g,{autoHideScrollbar:!0,children:[(0,s.FD)(Ge.i,{spacing:4,mode:"vertical",paddingTop:0,paddingBottom:0,"aria-busy":u,"aria-live":"polite",children:[u&&(0,s.Y)(Pr.q,{height:328,size:"medium"}),!u&&y.map((t=>(0,s.Y)(Rr,{place:t,onSelect:o,isPlaceSelected:m},t.place.id)))]}),g&&(0,s.Y)(ta.O,{stretched:!0,children:t.getLang("wall_posting_places_search_no_found")})]}),(0,s.Y)(we.j,{actions:(0,s.Y)(be.$,{"data-testid":"posting_geo_picker_save_button",size:"m",mode:"primary",appearance:"accent",onClick:n,disabled:!a,children:t.getLang("global_save")})})]})})),Nr=(0,n.jn)(Or,Br);var zr=i(326977);const Vr=(0,a.P)((function(){const{getSubtitle:t,handleShownChange:e,isCalendarShown:i,handleClearDate:o,handleKeyDown:n,handleCloseCalendar:a,date:r,handleChangeDate:c,handleResetChanges:l,props:{current:{after:h,publishDate:p}}}=Ts(),u=(0,d.useMemo)((()=>new Date),[]),g=(0,d.useMemo)((()=>{const t=new Date;return t.setFullYear(t.getFullYear()+1),t}),[]),_=(0,ke.B)(),m=(0,ms.$)((t=>{t.stopPropagation(),a()}),[a]);(0,d.useEffect)((()=>{i&&m.current&&m.current.focus()}),[i]);const v=()=>(0,s.Y)(Ke.T,{minHeight:T.BL,subtitle:(0,s.Y)("span",{"data-testid":"posting_postponed_cell_subtitle",children:t()}),"data-testid":"posting_postponed_cell",onClick:()=>e(!i),after:p?(0,s.Y)(di.K,{"data-testid":"posting_postponed_cell_remove",className:(0,fe.I)("color_icon_secondary"),label:_.getLang("global_clear"),onClick:o,children:(0,s.Y)(os.S,{})}):h,children:(0,s.Y)("span",{"data-testid":"posting_postponed_cell_title",children:_.getLang("wall_posting_when_to_publish")})});return(0,s.FD)(s.FK,{children:[(0,s.Y)(v,{}),i&&(0,s.Y)(zr.z,{onKeyDown:n,onClick:a,noBackground:!0,zIndex:1,fixed:!0,children:(0,s.Y)(Cs.V,{enableTime:!0,value:r,onChange:c,onClose:l,minDateTime:u,maxDateTime:g,doneButtonText:_.getLang("wall_posting_reset_calendar_selection"),getRootRef:m,tabIndex:0})})]})})),Ur=(0,n.jn)(Ls,Vr);var Gr=i(431885);const jr="PostingEditReply__root--bgiq0",Wr=(0,a.P)((function(t){const{postManager:e,isLoading:i,hasProcessing:n,onCloseModal:a,onChangeText:r,onEditPost:c,commentsSettingIsShown:l,publishedDateSettingIsShown:h}=t,p=(0,ke.B)(),u=(0,d.useRef)(null),g=(0,d.useRef)(null);if(i)return(0,s.Y)(ue.g,{children:(0,s.Y)(_e.y,{size:"large"})});return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onClose:a,closeAriaLabel:p.getLang("global_close"),noSeparator:!0,centered:!0,children:p.getLang("wall_posting_edit_header_text")}),(0,s.Y)(ue.g,{autoHideScrollbar:!0,boxRef:u,children:(0,s.Y)(bo.s,{direction:"column",className:jr,noWrap:!0,children:(0,s.Y)(Qa,{pickerPosition:Gr.D.DOWN,containerRef:u,inputRef:g,onChangeText:r,postManager:e})})}),(l||h)&&(0,s.Y)(Bi.F,{size:16}),h&&(0,s.Y)(Ur,{publishDate:e.publishDate,changePublishDate:e.setPublishDate}),l&&(0,s.Y)(Ke.T,{Component:"label",after:(0,s.Y)(o.dOG,{checked:e.commentsEnabled,onChange:()=>{e.setCommentsEnabled(!e.commentsEnabled)}}),children:p.getLang("wall_posting_comments_switch_label")}),(0,s.Y)(we.j,{noSeparator:!0,before:(0,s.Y)(cr,{postTextLimit:e.postTextLimit}),actions:(0,s.Y)(be.$,{size:"m",mode:"primary",onClick:c,loading:n,"data-testid":"posting_edit_reply_button",disabled:e.postTextLimit.limitExceeded,children:p.getLang("wall_posting_save_button_label")})})]})}));var Hr=i(884702),$r=i(347497),Kr=i(920603);const qr=({header:t,text:e,...i})=>(0,s.Y)($r.E,{...i,placement:"top",text:e?(0,s.Y)(Kr.$,{maxWidth:311,maxLines:5,children:e}):void 0,header:t?(0,s.Y)(Kr.$,{maxWidth:311,maxLines:5,children:t}):void 0}),Qr=(0,a.P)((function({payload:t,toggleRef:e,onClose:i,onSubmit:o}){const n=(0,ke.B)();return t&&e?(0,s.FD)(qr,{toggleRef:e,onClose:i,header:t.title,text:t.text,children:[(0,s.Y)(Hr.L,{onClick:o,"data-testid":"posting_attachments_error_popout_submit",children:t.button_text}),(0,s.Y)(Hr.L,{onClick:i,"data-testid":"posting_attachments_error_popout_cancel",children:n.getLang("global_cancel")})]}):null})),Jr=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_music_without_photo_dependency_alert_title"),text:o.getLang("wall_posting_music_without_photo_dependency_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_remove_photo_and_audio_submit",children:o.getLang("global_delete")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_remove_photo_and_audio_cancel",children:o.getLang("global_cancel")})]}):null})),Xr=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_crop_photo_with_products_alert_title"),text:o.getLang("wall_posting_crop_photo_with_products_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_crop_photo_with_products_submit",children:o.getLang("wall_posting_crop_photo_with_products_alert_submit")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_crop_photo_with_products_cancel",children:o.getLang("global_cancel")})]}):null})),Zr=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_remove_photo_with_products_alert_title"),text:o.getLang("wall_posting_remove_photo_with_products_music_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_remove_photo_with_products_music_submit",children:o.getLang("global_delete")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_remove_with_products_music_cancel",children:o.getLang("global_cancel")})]}):null})),td=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_change_ratio_photo_with_products_alert_title"),text:o.getLang("wall_posting_change_ratio_photo_with_products_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_change_ratio_photo_with_products_submit",children:o.getLang("wall_posting_change_ratio_photo_with_products_alert_submit")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_change_ratio_photo_with_products_cancel",children:o.getLang("global_cancel")})]}):null})),ed=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_remove_photo_with_products_alert_title"),text:o.getLang("wall_posting_remove_photo_with_products_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_remove_photo_with_products_submit",children:o.getLang("global_delete")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_remove_photo_with_products_cancel",children:o.getLang("global_cancel")})]}):null})),id=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_remove_photo_with_products_alert_title"),text:o.getLang("wall_posting_remove_photo_with_products_podcast_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_remove_photo_with_products_music_submit",children:o.getLang("global_delete")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_remove_with_products_music_cancel",children:o.getLang("global_cancel")})]}):null})),sd=(0,a.P)((function({toggleRef:t,onClose:e,onSubmit:i}){const o=(0,ke.B)();return t?(0,s.FD)(qr,{toggleRef:t,onClose:e,header:o.getLang("wall_posting_music_without_photo_dependency_alert_title"),text:o.getLang("wall_posting_podcast_without_photo_dependency_alert_text"),children:[(0,s.Y)(Hr.L,{onClick:i,mode:"destructive","data-testid":"posting_attachments_remove_photo_and_audio_submit",children:o.getLang("global_delete")}),(0,s.Y)(Hr.L,{onClick:e,"data-testid":"posting_attachments_remove_photo_and_audio_cancel",children:o.getLang("global_cancel")})]}):null})),od={[T.n$.PostingAttachmentsErrorMusicAlert]:Qr,[T.n$.PostingMusicWithoutPhotoDependencyAlert]:Jr,[T.n$.PostingExitAlert]:null,[T.n$.PostingCommentsClosedAlert]:null,[T.n$.PostingCropPhotoWithProductsAlert]:Xr,[T.n$.PostingRemovePhotoWithProductsMusicAlert]:Zr,[T.n$.PostingChangeRatioPhotoWithProductsAlert]:td,[T.n$.PostingRemovePhotoWithProductsAlert]:ed,[T.n$.PostingPodcastWithoutPhotoDependencyAlert]:sd,[T.n$.PostingRemovePhotoWithProductsPodcastAlert]:id};var nd=i(347820);const ad=(0,a.P)((function({onSubmit:t,onCancel:e,needNewContent:i}){const o=(0,ke.B)();return(0,s.Y)(ta.O,{stretched:!0,action:(0,s.Y)(s.FK,{children:(0,s.FD)(Is.e,{gap:"s",mode:"vertical",stretched:!0,children:[(0,s.Y)(be.$,{onClick:t,mode:"primary",size:"l",appearance:"negative",stretched:!0,children:o.getLang("wall_posting_old_post_edit_alert_action_submit")}),(0,s.Y)(be.$,{onClick:e,mode:"tertiary",size:"l",stretched:!0,children:o.getLang("global_cancel")})]})}),header:o.getLang("wall_posting_old_post_edit_alert_title"),icon:(0,s.Y)(nd.L,{}),id:"posting-old-post-edit",children:i?o.getLang("wall_posting_old_post_edit_alert_need_new_content_text"):o.getLang("wall_posting_old_post_edit_alert_text")})}));var rd=i(128237),dd=i(97929),cd=i(317764),ld=i(461211),hd=i(2096),pd=i(917128),ud=i(303134),gd=i(195578),_d=i(582876),md=i(578904),vd=i(640290),yd=i(952048);const fd=["photo","video"],Sd=new Set(fd);class wd{get post(){return(0,ud.i4)(this.props.current.item)?this.props.current.item:void 0}get postState(){return this.post?.postState}get isDeleted(){return this.postData?.is_deleted}get isPostHidden(){return this.isDeleted||Boolean(this.postState&&["archived","deleted","justPosted"].includes(this.postState))}get postData(){return this.post?.value}get rawId(){return this.post?.id}get dateText(){return this.transformDateToText(this.postData?.edited??this.postData?.date)}get attachments(){return this.postData?.attachments}get mediaAttachments(){return this.attachments?.filter((t=>Sd.has(t.type)))}get firstMediaAttachment(){return this.mediaAttachments?.[0]}get text(){let t=this.postData?.text;return t||(t=this.buildMediaCaption()),ct(t)??""}get ownerId(){return this.postData?.owner_id}get id(){return this.postData?.id}get disabled(){return this.isDeleteInProgress||this.isPublishInProgress}getMediaLabel(t,e){const i=Number(e);let s="";switch(t){case"video":s=this.langs.getLang("wall_posting_draft_video_attachment_label");break;case"photo":s=this.langs.getLang("wall_posting_draft_photo_attachment_label");break;default:s=""}return i>1?`${i} ${s}`:s}get attachmentSrc(){const t=this.firstMediaAttachment;switch(t?.type){case"video":return t.video?.image?.[0]?.url;case"photo":return t.photo?.sizes?.[0]?.url;default:return}}get attachmentBadge(){const t=this.firstMediaAttachment;if("video"===t?.type)return t.video?.duration?(0,Eo.a)(t.video.duration):void 0}constructor(t,e,i,s,o,n,a,r,d,c,h,u){this.postService=t,this.props=e,this.feedEntitiesMutationService=i,this.feedErrorService=s,this.singlePostWallService=o,this.wallService=n,this.postingDraftsCountProvider=a,this.productAnalyticsLogger=r,this.snackbar=d,this.host=c,this.langs=h,this.userEnv=u,this.isDeleteInProgress=!1,this.isPublishInProgress=!1,this.buildMediaCaption=()=>{if(!this.mediaAttachments?.length)return"";const t={};for(const s of this.mediaAttachments){var e,i;const o=s.type;(e=t)[i=o]||(e[i]=0),t[o]++}const s=[];return fd.forEach((e=>{const i=t[e];if(!i)return;const o=this.getMediaLabel(e,i);s.push(o.charAt(0).toUpperCase()+o.slice(1))})),s.join(" · ")},this.transformDateToText=t=>{if(!t)return"";const e=Date.now(),i=1e3*t,s=new Date(i);return(0,cd.c)(e,i)<365&&(0,ld.s)(e,i)?this.langs.date(s,this.langs.getLang("global_short_date_time",!0),this.langs.getLang("months_sm_of",!0),{onlyDate:!0}):this.langs.date(s,this.langs.getLang("global_date_year_time_with_year_word",!0),this.langs.getLang("months_sm_of",!0),{onlyDate:!0})},this.refetchPost=async()=>{this.rawId&&await this.singlePostWallService.refetchPost(this.rawId)},this.updatePostState=t=>{this.rawId&&this.feedEntitiesMutationService.mutateFeedItemState(this.rawId,t)},this.deleteRequest=async()=>{if(this.ownerId)try{const t={owner_id:this.ownerId,post_id:this.id};this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")&&(t.ref=this.productAnalyticsLogger.navScreen,t.entry_point=this.productAnalyticsLogger.creationEntryPoint),await this.wallService.deleteWallPost(t),(0,l.h5)((()=>{this.updatePostState("deleted"),t.owner_id&&this.postingDraftsCountProvider.decrement({domain:t.owner_id.toString()}),this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")||this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.Delete,creationEntryPoint:Qt.yH.ListDeleteDraftThreeDots})}))}catch(t){this.feedErrorService.handleNetworkError(t)}finally{(0,l.h5)((()=>{this.isDeleteInProgress=!1}))}},this.handleDelete=async()=>{this.isDeleteInProgress||(this.isDeleteInProgress=!0,(0,pd.NL)(this.langs.getLang("wall_posting_delete_draft_alert_title"),this.langs.getLang("wall_posting_delete_draft_alert_text"),this.langs.getLang("global_delete"),(()=>{(0,hd.kI)().hide(),this.deleteRequest()}),this.langs.getLang("global_cancel"),(()=>{(0,hd.kI)().hide(),this.isDeleteInProgress=!1})))},this.afterCreateSuccess=(t,e,i)=>(this.updatePostState("justPosted"),this.postingDraftsCountProvider.decrement({domain:e.toString()}),this.props.current.afterCreateSuccess?.({postId:t,ownerId:e,fromGroup:i}),Promise.resolve()),this.afterEditSuccess=()=>(this.refetchPost(),Promise.resolve()),this.handleEdit=(t=!1)=>{this.ownerId&&(0,yd.n)({postRaw:this.rawId,ownerId:String(this.ownerId),isEdit:!0,modalDefaultOpened:!0,postingTimelineStartTimeMs:1e3*Date.now(),creationEntryPoint:t?Qt.yH.ListEditDraftThreeDots:Qt.yH.ListEditDraft,afterEditSuccess:this.afterEditSuccess,afterCreateSuccess:this.afterCreateSuccess})},this.handlePublish=async()=>{if(!this.isPublishInProgress&&this.ownerId){this.isPublishInProgress=!0;try{const t={owner_id:this.ownerId,post_id:this.id};this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")&&(t.ref=this.productAnalyticsLogger.navScreen,t.entry_point=this.productAnalyticsLogger.creationEntryPoint,t.creation_session_id=this.productAnalyticsLogger.creationSessionId),await this.postService.create(t),this.snackbar.show({type:"ok",text:this.langs.getLang("wall_feed_post_created")}),(0,l.h5)((()=>{this.updatePostState("justPosted"),t.owner_id&&this.postingDraftsCountProvider.decrement({domain:t.owner_id.toString()}),this.userEnv.partConfigEnabled("frontend.feed_posting_new_draft_api_analytics")||this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.PostDraft})}))}catch(t){this.feedErrorService.handleNetworkError(t)}finally{(0,l.h5)((()=>{this.isPublishInProgress=!1}))}}},this.handleCopyLink=async()=>{const t=`wall${this.rawId}`,e=`https://${this.host.getDomainName()}/${t}`;await(0,p.e)(e),this.snackbar.show({text:this.langs.getLang("wall_post_link_copied")}),this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.CopyLink})},(0,l.l_)(this)}}wd=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===m.K?Object:m.K,void 0===n.Ji?Object:n.Ji,void 0===gd.K?Object:gd.K,void 0===_d.m?Object:_d.m,void 0===md.a?Object:md.a,void 0===vd.C?Object:vd.C,void 0===C?Object:C,void 0===qt.I?Object:qt.I,void 0===dd.q?Object:dd.q,void 0===Ct.O?Object:Ct.O,void 0===ft.Y?Object:ft.Y,void 0===At.J?Object:At.J])],wd);const{Provider:bd,useModel:Pd}=(0,n.Qd)(wd,{initInEffect:!1});var Ad=i(141575),kd=i(916982);class Cd{get disabled(){return this.props.current.disabled}get actionButtons(){return[{key:"publish",label:this.langs.getLang("wall_publish_now"),loading:this.disabled,disabled:this.disabled,onClick:this.handlePublish,"data-testid":"posting_draft_item_publish"},{key:"edit",onClick:this.handleEdit,"data-testid":"posting_draft_item_edit",label:this.langs.getLang("global_edit")},{key:"copy_link",label:this.langs.getLang("wall_post_copy_link"),onClick:this.handleCopyLink,"data-testid":"posting_draft_item_copy_link",disabled:this.disabled},{key:"delete",onClick:this.handleDelete,"data-testid":"posting_draft_item_delete",mode:"destructive",label:this.langs.getLang("global_delete"),loading:this.disabled,disabled:this.disabled}]}constructor(t,e){this.props=t,this.langs=e,this.handlePublish=t=>{(0,te.T)(t),this.props.current.onPublish()},this.handleEdit=t=>{(0,te.T)(t),this.props.current.onEdit()},this.handleCopyLink=t=>{(0,te.T)(t),this.props.current.onCopyLink()},this.handleDelete=t=>{(0,te.T)(t),this.props.current.onDelete()},(0,l.l_)(this)}}Cd=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===ft.Y?Object:ft.Y])],Cd);const{Provider:Id,useModel:Ed}=(0,n.Qd)(Cd,{initInEffect:!1}),Ld=(0,a.P)((function(){const{langs:t,disabled:e,actionButtons:i}=Ed();return(0,s.Y)(kd.E,{Component:vs.v,trigger:["hover","click"],placement:"bottom-end",offsetByMainAxis:8,offsetByCrossAxis:0,size:"s",usePortal:!0,hideWhenReferenceHidden:!0,disabled:e,content:i.map((t=>(0,s.Y)(vs.v.Item,{loading:t.loading,disabled:t.disabled,onClick:t.onClick,"data-testid":t["data-testid"],type:t.mode,children:t.label},t.key))),"aria-label":t.getLang("global_actions_button"),"data-testid":"post_context_menu",children:(0,s.Y)(di.K,{size:44,label:t.getLang("global_actions_button"),"data-testid":"post_context_menu_toggle",onClick:te.T,disabled:e,children:(0,s.Y)(Ad.z,{})})})})),Td=(0,js.N)(Id,Ld),Md=(0,a.P)((function(){const{rawId:t,attachmentSrc:e,disabled:i,attachmentBadge:o,dateText:n,text:a,handleEdit:r,handleDelete:d,handlePublish:c,handleCopyLink:l,isPostHidden:h}=Pd();return h?null:(0,s.FD)("div",{"data-testId":"post_draft_item","data-post-id":t,children:[(0,s.Y)(Ke.T,{before:(0,s.Y)(ys._,{alt:a,size:80,borderRadius:"l",fallbackIcon:(0,s.Y)(rd.f,{}),src:e,children:o&&(0,s.Y)(ys._.OverlayItem,{paddingRight:4,paddingBottom:4,placement:"bottom-right",children:(0,s.Y)(Pa.R,{appearance:"overlay",children:o})})}),onClick:()=>r(!1),"data-testid":"posting_draft_item","aria-label":a,disabled:i,disableOpacity:i,after:(0,s.Y)(Td,{disabled:i,onEdit:()=>r(!0),onDelete:d,onPublish:c,onCopyLink:l}),subtitle:n,children:(0,s.Y)(Kr.$,{maxLines:2,children:a})}),(0,s.Y)("div",{})]})})),Od=(0,js.N)(bd,Md),Dd=({onButtonClick:t})=>{const e=(0,ke.B)();return(0,s.Y)(zo.h,{centered:!0,children:(0,s.Y)(Ge.i,{mode:"vertical",paddingBottom:12,paddingTop:12,spacing:12,children:(0,s.Y)(ta.O,{stretched:!0,action:(0,s.Y)(be.$,{onClick:t,align:"center",size:"m","data-testid":"wall_posting_drafts_empty_result_stub_button",children:e.getLang("wall_posting_drafts_empty_result_stub_button_text")}),header:e.getLang("wall_posting_drafts_empty_result_stub_title"),children:e.getLang("wall_posting_drafts_empty_result_stub_text")})})})};var xd=i(233788),Rd=i(244428),Yd=i(540917);const Fd=(0,a.P)((function(){const{status:t,items:e,feedServiceDecorator:i,newsfeedItem:o,withoutSaveScroll:n,scrollContainerRef:a}=(0,Rd.c)(),r=o,d=(0,ke.B)();return"initial"===t||0===e.length&&"loading"===t?(0,s.Y)(Pr.q,{children:d.getLang("wall_posting_drafts_loading")}):"error"===t?(0,s.Y)(ta.O,{stretched:!0,children:d.getLang("wall_posting_drafts_placeholder_error")}):(0,s.FD)(Ge.i,{mode:"vertical",spacing:8,paddingBottom:8,paddingTop:8,children:[(0,s.Y)(Yd.F,{feedServiceDecorator:i,gap:0,withoutSaveScroll:n,scrollContainerRef:a,children:({index:t,item:e,getItemUiState:i})=>(0,s.Y)(r,{item:e,index:t,getItemUiState:i})}),"loading"===t&&(0,s.Y)(Pr.q,{children:d.getLang("wall_posting_drafts_loading")})]})})),Bd=(0,xd.L)((0,js.N)(Rd.i,Fd),void 0,"PostingDraftsList");var Nd=i(341250),zd=i(407691),Vd=i(529275);class Ud{feedItemsCompareFunction(t,e){const i=this.feedEntitiesStore.getItem(t),s=this.feedEntitiesStore.getItem(e);if(!i||!s)return 0;const o=i.value,n=s.value;return(0,ud.gB)(o)&&(0,ud.gB)(n)&&o?.date&&n?.date?o.date-n.date:0}constructor(t){this.feedEntitiesStore=t,this.feedItemsEditedDescendingCompareFunction=(t,e)=>{const i=this.feedEntitiesStore.getItem(t),s=this.feedEntitiesStore.getItem(e);if(!i||!s)return 0;const o=i.value,n=s.value;if(!(0,ud.gB)(o)||!(0,ud.gB)(n))return 0;const a=o?.edited??o?.date,r=n?.edited??n?.date;return a&&r?r-a:0}}}Ud=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Vd.B?Object:Vd.B])],Ud);var Gd=i(975472),jd=i(968706);class Wd{[n.Ts](){this.productAnalyticsLogger.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.OpenDraftsList}),this.isDraftsSortByDateEnabled&&this.reactions.reaction((()=>this.editedCount),(t=>{t&&this.feedServiceDecorator.sort(this.wallPostSortingService.feedItemsEditedDescendingCompareFunction)}))}get isDraftsSortByDateEnabled(){return this.userEnv.partConfigEnabled("drafts_sort_by_date")}get ownerId(){return this.props.current.ownerId}get editedCount(){if(this.isDraftsSortByDateEnabled)return this.items?.reduce(((t,e)=>t+Number(e.value.edited)),0)}get items(){return this.feedServiceDecorator.items?.every(ud.i4)?this.feedServiceDecorator.items:void 0}get isAllHidden(){return Boolean(this.items?.length)&&this.items?.every((t=>t.postState&&["archived","deleted","justPosted"].includes(t.postState)||t.value.is_deleted))}get isEmpty(){return this.feedServiceDecorator.isResultEmpty||this.isAllHidden}get afterCreateSuccess(){return this.props.current.afterCreateSuccess}[n.zr](){this.feedServiceDecorator.destroy(),this.reactions.destroy()}constructor(t,e,i,s,o,n){this.props=t,this.draftsSimpleWallService=e,this.feedDataService=i,this.wallPostSortingService=s,this.productAnalyticsLogger=o,this.userEnv=n,this.reactions=new h.O,this.feedServiceDecorator=new jd.H(void 0,void 0,this.draftsSimpleWallService,this.feedDataService),this.handleGoBack=()=>{this.props.current.onGoBack()},this.closeModal=()=>{this.props.current.closeModal?.()},(0,l.l_)(this)}}Wd=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===zd.un?Object:zd.un,void 0===Gd.k?Object:Gd.k,void 0===Ud?Object:Ud,void 0===qt.I?Object:qt.I,void 0===At.J?Object:At.J])],Wd);const{Provider:Hd,useModel:$d}=(0,n.Qd)(Wd,{initInEffect:!1}),Kd="PostingScreenDraftsList__modal--FQXfK",qd=(0,a.P)((function(){const{handleGoBack:t,closeModal:e,ownerId:i,feedServiceDecorator:o,isEmpty:n,afterCreateSuccess:a}=$d(),r=(0,ke.B)(),c=(0,d.useRef)(null),l=(0,d.useCallback)((t=>(0,s.Y)(Od,{...t,afterCreateSuccess:a})),[]);return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:t,backLabel:r.getLang("global_back"),onClose:e??t,closeAriaLabel:r.getLang("global_close"),children:r.getLang("wall_posting_drafts")}),(0,s.Y)(je._,{height:Nd.s$,autoHideScrollbar:!0,getRef:c,children:(0,s.FD)(ge.c,{insetLevel:0,className:Kd,"data-testid":"posting_drafts_modal",children:[n&&(0,s.Y)(Dd,{onButtonClick:t}),(0,s.Y)(Bd,{filter:"drafts",NewsfeedItem:l,ownerId:i,feedServiceDecorator:o,withoutSaveScroll:!0,scrollContainerRef:c})]})})]})})),Qd=(0,js.N)(Hd,qd);var Jd=i(973744);const Xd=Ws.L.ACCOUNT_HINT_FEED_POSTING_PHOTO_WITH_MARKET_ON_GRID_WEB;var Zd=i(398001),tc=i(666843),ec=i(547214),ic=i(111153),sc=i(925810),oc=i(136141),nc=i(630218),ac=i(908759);const rc=t=>{const{value:e,onClick:i,onPlay:o}=t,n=(0,oc.R)(),a=n.currentAudio?.id===e.id,r=a&&n.status===sc.w.PLAYING,c=a?n.currentAudioProgress:1,l=(0,d.useMemo)((()=>fo(e)),[]);return(0,s.Y)(Ge.i,{spacing:0,paddingTop:4,paddingBottom:4,mode:"vertical","data-testid":"posting_podcasts_episode_row",children:(0,s.Y)(nc.S,{thumb:l,title:e.title,artists:[{name:e.artist}],duration:e.duration,progress:c,hasThumbPlaying:r,hasThumbActivated:a,explicit:e.is_explicit,onClick:()=>i(e),onThumbClick:t=>{t.stopPropagation(),o(e)},after:(0,s.Y)(bo.s,{align:"center",noWrap:!0,children:(0,s.Y)(ac.R,{duration:e.duration,progress:r?c:1,mode:"normal",size:"m"})})})})};var dc=i(682941),cc=i(768641),lc=i(238204),hc=i(434518),pc=i(763812),uc=i(843815),gc=i(1872),_c=(0,pc._)("_podcastsApi"),mc=(0,pc._)("_episodeProvider"),vc=(0,pc._)("_maxNextCount");class yc extends gc.B{get isEmpty(){const{count:t}=this;return null!=t&&!t}async fetchAt(t,{range:e=0}={}){const i=(0,uc.Z)(this.length,t),s=this.audioAt(i),o=i+e+1-this.length;if(s&&o<=0)return s;const n=Math.min(o,(0,hc._)(this,vc)[vc]),{items:a,count:r}=await(0,hc._)(this,_c)[_c].getEpisodes({owner_id:this.identity.id,count:n,offset:i}),d=a.map((t=>(0,hc._)(this,mc)[mc].createContextualFromAPI(t,{list:this}))),c=d.at(0);if(!c)throw(0,l.h5)((()=>{this._count=r})),new Error("fetchNext have not return podcast episodes");return(0,l.h5)((()=>{this._count=r,this.items.push(...d)})),c}async fetchNext(t=5){return this.fetchNextByAt(t)}get head(){return this.items}audioAt(t){return this.items.at(t)}get count(){return this._count}findFirstUnfetchedIndex(){const{length:t,count:e}=this;return e===t?-1:t}constructor(t){super(t),Object.defineProperty(this,vc,{get:fc,set:void 0}),Object.defineProperty(this,_c,{writable:!0,value:void 0}),Object.defineProperty(this,mc,{writable:!0,value:void 0}),this._count=null,this.items=(0,l.sH)([]);const{prefetchedEpisodes:e}=t;(0,hc._)(this,_c)[_c]=t.podcastsApi,(0,hc._)(this,mc)[mc]=t.episodeProvider,e&&e.length>0&&this.items.push(...e),(0,l.Gn)(this)}}function fc(){return 100}(0,c.Cg)([l.sH,(0,c.Sn)("design:type",Object)],yc.prototype,"_count",void 0),(0,c.Cg)([l.EW,(0,c.Sn)("design:type",void 0),(0,c.Sn)("design:paramtypes",[])],yc.prototype,"isEmpty",null),(0,c.Cg)([l.EW,(0,c.Sn)("design:type",Object),(0,c.Sn)("design:paramtypes",[])],yc.prototype,"head",null),(0,c.Cg)([l.EW,(0,c.Sn)("design:type",void 0),(0,c.Sn)("design:paramtypes",[])],yc.prototype,"count",null);var Sc=i(321171),wc=i(457518);class bc{get(t){const e=this.toEntityIdentity({id:t}),i=this.lists.get(e);if(!i){const t={identity:e,type:Sc.b.OwnedPodcastEpisodeList},i=new yc({identity:e,getData:this.makeCachedDataGetter(e,t),podcastsApi:this.podcastsApi,episodeProvider:this.episodeProvider,context:{ref:null}});return this.cache(i)}return i}cache(t){return this.lists.set(t.identity,t),t}toEntityIdentity(t){return new wc.h({id:t.id})}makeCachedDataGetter(t,e){let i=e;return()=>{let e=this.listsData.get(t);return e&&(i=e),e??i}}constructor(t,e){this.podcastsApi=t,this.episodeProvider=e,this.lists=new dc.W,this.listsData=new dc.W,(0,l.Gn)(this)}}(0,c.Cg)([l.XI,(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[Number]),(0,c.Sn)("design:returntype","undefined"==typeof IOwnedPodcastEpisodeList?Object:IOwnedPodcastEpisodeList)],bc.prototype,"get",null),(0,c.Cg)([l.XI,(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",["undefined"==typeof IOwnedPodcastEpisodeList?Object:IOwnedPodcastEpisodeList]),(0,c.Sn)("design:returntype","undefined"==typeof IOwnedPodcastEpisodeList?Object:IOwnedPodcastEpisodeList)],bc.prototype,"cache",null),bc=(0,c.Cg)([n.z8.global(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===cc.M?Object:cc.M,void 0===lc.D?Object:lc.D])],bc);var Pc=i(160010),Ac=i(888817);class kc{[n.Ts](){this.fetchPodcastEpisodes()}get podcastEpisodeList(){return this.ownedPodcastEpisodeListProvider.get(this.props.current.ownerId)}async fetchPodcastEpisodes(){if(!(this._isLoading||Number(this.podcastEpisodeList?.count)>0)){this._isLoading=!0;try{await(this.podcastEpisodeList?.fetchAt(0,{range:30}))}catch(t){this.handleRequestError(t)}finally{(0,l.h5)((()=>{this._isLoading=!1}))}}}async fetchMore(){if(!this._isLoading&&!this.isLoadedFully){this._isLoading=!0;try{await(this.podcastEpisodeList?.fetchNext(30))}catch(t){this.handleRequestError(t)}finally{(0,l.h5)((()=>{this._isLoading=!1}))}}}get podcastEpisodes(){return this.podcastEpisodeList?.items}get isLoading(){return this._isLoading}get ownerId(){return this.props.current.ownerId}get isLoadedFully(){const{podcastEpisodeList:t}=this;return!!t&&t.count===this.podcastEpisodes?.length}get isEmpty(){return!this.podcastEpisodeList?.count&&!this.isLoading}handleRequestError(t){((0,Pc.d)(t)||(0,Vt.T)(t))&&this.errorManager.onNetworkErrorSnackbar()}[n.zr](){this.selectedPodcastEpisode=null}constructor(t,e,i){this.props=t,this.ownedPodcastEpisodeListProvider=e,this.errorManager=i,this.selectedPodcastEpisode=null,this._isLoading=!1,this.handleFetchMore=(0,Ac.n)((()=>this.fetchMore()),T.HP),this.handleClose=()=>{this.props.current.onClose()},this.handleSelect=t=>{this.props.current.onSelect(t)},this.handleGoBack=()=>{this.props.current.onGoBack()},(0,l.l_)(this)}}kc=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===bc?Object:bc,void 0===Et.e?Object:Et.e])],kc);const{Provider:Cc,useModel:Ic}=(0,n.Qd)(kc,{initInEffect:!1,isolatedContext:!1,onlyTransient:!1}),Ec=(0,a.P)((function(){const{ownerId:t,podcastEpisodes:e,isEmpty:i,isLoading:o,isLoadedFully:n,handleFetchMore:a,handleClose:r,handleSelect:c,handleGoBack:l}=Ic(),h=(0,ke.B)(),p=(0,d.useMemo)((()=>new ic.F((0,ec.MW)())),[]),[u,g]=(0,d.useState)(null);(0,gi.M)(!o&&!n,a,u);const _=(0,d.useCallback)((t=>{p.isPlaying()&&p.getCurrentAudio()?.id===t.id?p.stop():p.playAudio(t)}),[p]);return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onClose:r,closeAriaLabel:h.getLang("global_close"),onBack:l,backLabel:h.getLang("global_back"),children:h.getLang("wall_posting_podcast_episode_picker_header_text")}),(0,s.Y)(je._,{height:Nd.s$,autoHideScrollbar:!0,getRef:g,children:(0,s.Y)(ge.c,{insetLevel:1,children:(0,s.Y)(tc.V,{ownerId:t,platformAudioPlayer:p,children:(0,s.FD)(Ge.i,{mode:"vertical",spacing:4,paddingTop:8,paddingBottom:4,children:[e?.map((t=>(0,s.Y)(rc,{value:t.data.apiAudio,onPlay:_,onClick:c},t.identity.id))),o&&(0,s.Y)(_e.y,{size:"regular"}),i&&(0,s.Y)(ta.O,{stretched:!0,icon:(0,s.Y)(Zd.S,{}),children:h.getLang("audio_picker_podcasts_not_found")})]})})})})]})})),Lc=(0,n.jn)(Cc,Ec);var Tc=i(783292);class Mc{getFetching(t){const e=this.getParamsKey(t);return this.data.censorshipPromisesMapByParams.has(e)}getCachedResults(t){const e=this.getParamsKey(t);return this.data.censorshipMapByParams.get(e)}async ensureCheckCensoredValidate(t){const e=this.getCachedResults(t);return e||this.fetchCensoredValidate(t)}async fetchCensoredValidate(t){const e=await this.getCensorshipPromise(t);return(0,l.h5)((()=>{const i=this.getParamsKey(t);this.data.censorshipMapByParams.set(i,e)})),e}getCensorshipPromise(t){const e=this.getParamsKey(t),i=this.data.censorshipPromisesMapByParams.get(e);if(i)return i;const s=new Promise((async i=>{if(!Object.keys(t).length)return void i({});const s=new Map,o=Object.entries(t).map((([t,e],i)=>(s.set(i,t),e))).join(",");try{const{results:t}=await this.donutApi.checkCensoredValidate({values:o});if(!t)return void i({});const e={};t.forEach(((t,i)=>{const o=s.get(i);o&&(e[o]="0"!==t)})),i(e)}catch{i({})}finally{(0,l.h5)((()=>{this.data.censorshipPromisesMapByParams.delete(e)}))}}));return this.data.censorshipPromisesMapByParams.set(e,s),s}getParamsKey(t){return JSON.stringify(t)}constructor(t){this.donutApi=t,this.data={censorshipMapByParams:new Map,censorshipPromisesMapByParams:new Map},(0,l.l_)(this)}}Mc=(0,c.Cg)([n.z8.container(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===Tc.$?Object:Tc.$])],Mc);class Oc{async[n.Ts](){this.props.current.text?this._text=this.props.current.text:this._text=this.defaultText}get text(){return this._text}get trimmedText(){return this._text.trim()}get loading(){return this._loading}get errorText(){return this.hasMinLengthError?this.langs.langReplace(this.langs.numeric(T.RP,this.langs.getLang("wall_posting_donut_teaser_min_length_error",!0)),{count:String(T.RP)}):this.hasCensorshipError?this.langs.getLang("wall_posting_donut_teaser_censorship_error"):void 0}get defaultText(){return this.props.current.selectedDonutLevel?.teaser_text??""}get isDefaultText(){return this.trimmedText===this.defaultText}get hasCensorshipError(){return!this.isDefaultText&&this.censorshipProvider.getCachedResults({text:this.trimmedText})?.text}get hasMinLengthError(){return!this.isDefaultText&&this.trimmedText.length<T.RP}get hasError(){return this.hasCensorshipError||this.hasMinLengthError}constructor(t,e,i,s,o){this.props=t,this.productAnalyticsLogger=e,this.censorshipProvider=i,this.langs=s,this.errorManager=o,this._text="",this._loading=!1,this.handleGoBack=()=>{this.props.current.onGoBack()},this.setText=t=>{t.length>T.nV||(this._text=t)},this.setDefaultText=()=>{this._text=this.defaultText},this.closeModal=()=>{this.props.current.closeModal?.()},this.onSave=async()=>{if(!this.hasError){if(this.isDefaultText)return this.props.current.onSave(),void this.handleGoBack();this._loading=!0;try{(await this.censorshipProvider.ensureCheckCensoredValidate({text:this.trimmedText})).text||(this.props.current.onSave(this.trimmedText),this.handleGoBack())}catch(t){((0,Pc.d)(t)||(0,Vt.T)(t))&&this.errorManager.onNetworkErrorSnackbar()}finally{(0,l.h5)((()=>{this._loading=!1}))}}},(0,l.l_)(this)}}Oc=(0,c.Cg)([n.z8.transient(),(0,c.Sn)("design:type",Function),(0,c.Sn)("design:paramtypes",[void 0===n.Ji?Object:n.Ji,void 0===qt.I?Object:qt.I,void 0===Mc?Object:Mc,void 0===ft.Y?Object:ft.Y,void 0===Et.e?Object:Et.e])],Oc);const{Provider:Dc,useModel:xc}=(0,n.Qd)(Oc,{initInEffect:!1});var Rc=i(10929);const Yc=(0,a.P)((function({setText:t,setDefaultText:e,text:i,hasError:o,errorText:n,loading:a,isDefaultText:r}){const d=(0,ke.B)();return(0,s.FD)(Ge.i,{children:[(0,s.Y)(Rc.T,{"data-testid":"posting_donut_teaser_textarea",value:i,onChange:e=>{t(e.target.value)},maxLength:T.nV,rows:2,grow:!1,after:a&&(0,s.Y)(_e.y,{size:"s",className:(0,fe.I)("color_icon_secondary")}),afterAlign:"center",status:o?"error":"default","aria-label":d.getLang("wall_posting_donut_teaser_header")}),(0,s.Y)($e.K,{size:8}),!o&&(0,s.FD)(as.r,{separator:(0,s.Y)(rs.O,{className:(0,fe.I)("color_text_secondary")}),children:[(0,s.FD)(We.tW,{className:(0,fe.I)("color_text_secondary"),inline:!0,children:[i.length," / ",T.nV]}),!r&&(0,s.Y)(Ho.N,{noUnderline:!0,Component:We.tW,"data-testid":"posting_donut_teaser_reset_default_text_button",onClick:e,disabled:a,children:d.getLang("wall_posting_donut_teaser_set_default_button_text")})]}),o&&(0,s.Y)(We.tW,{className:(0,fe.I)("color_text_negative"),children:n})]})})),Fc=(0,a.P)((function(){const t=(0,ke.B)(),{handleGoBack:e,closeModal:i,onSave:o,setText:n,setDefaultText:a,text:r,hasError:d,errorText:c,loading:l,isDefaultText:h}=xc();return(0,s.FD)(s.FK,{children:[(0,s.Y)(Re.z,{onBack:e,backLabel:t.getLang("global_back"),onClose:i,closeAriaLabel:t.getLang("global_close"),children:t.getLang("wall_posting_donut_teaser_header")}),(0,s.Y)(ue.g,{children:(0,s.Y)(Yc,{setText:n,setDefaultText:a,text:r,hasError:d,errorText:c,loading:l,isDefaultText:h})}),(0,s.Y)(we.j,{actions:(0,s.Y)(be.$,{loading:l,size:"m",mode:"primary",appearance:"accent",onClick:o,disabled:d,"data-testid":"posting_donut_teaser_save_button",children:t.getLang("global_done")})})]})})),Bc=(0,n.jn)(Dc,Fc);var Nc=i(90447),zc=i(207037),Vc=i(842514),Uc=i(12584);const Gc=(0,a.P)((function({refreshCoordinates:t,modalRef:e}){const i=(0,ke.B)(),o=pe(),n=o.modalManager.getCurrentModal,a=o.isEdit,r=Math.max(document.documentElement.clientWidth,window.innerWidth||0),c=Math.max(document.documentElement.clientHeight,window.innerHeight||0),{closeModal:l,checkIfModalClosingBlocked:h}=(({hasChanges:t,goBack:e,onClearLocalDraft:i,isDraft:s,isRemoteDraftsEnabled:o,onSaveDraft:n,productAnalyticsLogger:a})=>{const r=(0,ke.B)(),[c,l]=(0,d.useState)(!1),{hideBox:h}=(0,Sr.VS)((d=>c?(l(!1),!1):e?(e(),!1):!!d||(t?(o?(0,pd.NL)(r.getLang("wall_posting_save_draft_alert_title"),r.getLang("wall_posting_save_draft_alert_text"),r.getLang("global_save"),(async()=>{(0,hd.kI)().hide(),await(n?.())&&(i?.(),h(!0))}),r.getLang("wall_posting_exit_alert_action_exit"),(()=>{i?.(),a.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.ExitDraft}),(0,hd.kI)().hide(),h(!0)})):(0,pd.NL)(r.getLang("wall_posting_exit_alert_title"),r.getLang("wall_posting_exit_alert_text"),r.getLang("wall_posting_exit_alert_action_exit"),(()=>{i?.(),a.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.ExitPosting}),(0,hd.kI)().hide(),h(!0)}),r.getLang("global_cancel")),!1):(s?a.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.ExitDraft}):a.logRemoteDraftEvent({remoteDraftEventType:Qt.u3.ExitPosting}),!0)))),p=(0,d.useCallback)((t=>{"escape-key"===t&&l(!0)}),[]);return{closeModal:h,checkIfModalClosingBlocked:p}})({hasChanges:o.postManager.hasChanges&&!o.postSubmitted&&!o.settingsManager.isAdsPost,onClearLocalDraft:o.clearLocalDraft,onSaveDraft:o.saveDraft,isRemoteDraftsEnabled:o.isRemoteDraftsEnabled,isDraft:o.postManager.isDraft,productAnalyticsLogger:o.productAnalyticsLogger,goBack:n===T.cL.PHOTO_VIEWER||n===T.cL.PHOTO_EDITOR?o.modalManager.goBack:void 0}),p=(0,d.useCallback)((t=>{const e=["ArrowRight","ArrowLeft"].includes(t.key),i=["PageUp","PageDown"].includes(t.key);!e&&!i||n===T.cL.PHOTO_VIEWER&&!i||t.stopImmediatePropagation()}),[n]);(0,d.useEffect)((()=>(window.addEventListener("keydown",p,!0),()=>{window.removeEventListener("keydown",p,!0)})),[]),(0,d.useEffect)((()=>{if(!o.modalManager.alertProps?.type)return;const t=od[o.modalManager.alertProps.type];t&&o.modalManager.openPopout((0,s.Y)(t,{...o.modalManager.alertProps}))}),[o.modalManager.alertProps?.type]),(0,d.useEffect)((()=>{t()}),[n]),(0,d.useEffect)((()=>{o.postingTimelineLogger.logScreenInitialization()}),[]);const{photoWithMarketOnGridHint:u,hidePhotoWithMarketOnGridHint:g}=(({errorManager:t,helpHints:e})=>{const i=(0,ke.B)(),o=e.get(Xd);return{photoWithMarketOnGridHint:o,hidePhotoWithMarketOnGridHint:()=>{o?.title&&(t.showSnackbar({text:o.title,before:{content:(0,s.Y)(Jd.Q,{className:(0,fe.I)("color_icon_accent")})},action:{label:i.getLang("wall_posting_photo_crop_onboarding_button"),onClick:(e,i)=>{t.hideSnackbar(i)}}}),e.hide(Xd))}}})(o),_=(0,d.useCallback)((({view:t})=>{o.addProductManager.hasTags&&t.key===T.Q1.GRID&&u&&g(),o.setAttachmentsView({view:t})}),[Boolean(u),o.addProductManager.hasTags]),m=t=>{Object.keys(t.tags.items).length&&o.postManager.attachmentsView.key===T.Q1.GRID&&u&&g(),o.onAddProduct(t)};switch(n){case T.cL.POLL:return(0,s.Y)(Fe,{postingSettings:o.settingsManager.postingSettings,closeModal:l,poll:o.postManager.poll,onCreatePoll:o.onCreatePoll,onEditPoll:o.onEditPoll,onGoBack:o.modalManager.goBack,ownerId:o.ownerId,isEdit:a});case T.cL.PHOTO_PICKER:return(0,s.Y)(Nc.f,{onCloseModal:l,onGoBack:o.modalManager.goBack,ownerId:String(o.ownerId),currentUserId:o.currentUserId,photosLimit:o.photosLimit,totalLimit:T.sr,selectedPhotos:o.postManager.photosFromCustomAlbums??[],isAdmin:o.isAdmin,onPhotoSelect:o.onPhotoSelect,canAddAttachmentWithFeedback:o.canAddAttachmentWithFeedback,canRemoveAttachmentWithFeedback:o.canRemoveAttachmentWithFeedback,sourceSelectorEnabled:!0,onError:(t,e)=>o.errorManager.showSnackbar({type:T.GZ.Error,subtitle:e,text:t}),timelineLogger:{logPickerReady:o.postingTimelineLogger.logPickerReady,logStartAttaching:()=>{o.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.PHOTO}),o.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.PHOTO_VK})},logError:()=>o.postingTimelineLogger.logError({message:T.Zk.ErrorLoadingPhotoPicker})},productAnalyticsLogger:o.productAnalyticsLogger});case T.cL.VIDEO_PICKER:return(0,s.Y)(zc.G,{currentUserId:o.currentUserId,isAdmin:o.isAdmin,ownerId:String(o.ownerId),closeModal:l,onVideoSelect:o.onVideoSelect,videosLimit:o.videosLimit,totalLimit:T.sr,selectedVideos:o.postManager.videosFromPicker??[],onGoBack:o.modalManager.goBack,canAddAttachmentWithFeedback:o.canAddAttachmentWithFeedback,canRemoveAttachmentWithFeedback:o.canRemoveAttachmentWithFeedback,sourceSelectorEnabled:!0,onError:(t,e)=>o.errorManager.showSnackbar({type:T.GZ.Error,subtitle:e,text:t}),timelineLogger:{logPickerReady:o.postingTimelineLogger.logPickerReady,logStartAttaching:()=>o.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.VIDEO}),logError:()=>o.postingTimelineLogger.logError({message:T.Zk.ErrorLoadingVideoPicker})}});case T.cL.FILE:return(0,s.Y)(Vc.N,{ownerId:String(o.ownerId),closeModal:l,filesLimit:1,onGoBack:o.modalManager.goBack,onAttach:o.postManager.onAttachDoc,selectedDocs:o.postManager.doc?[o.postManager.doc]:void 0,timelineLogger:{logFileLoadingError:t=>o.postingTimelineLogger.logFileLoadingError({rawId:T.hJ,message:t}),logFileLoaded:()=>o.postingTimelineLogger.logFileLoaded({rawId:T.hJ}),logStartFileUploading:t=>o.postingTimelineLogger.logStartFileUploading({rawId:T.hJ,fileType:Xt.gY.DOCUMENT,fileSize:t}),logStartAttaching:()=>o.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.DOCUMENT})},productAnalyticsLogger:o.productAnalyticsLogger});case T.cL.GEO_PICKER:return(0,s.Y)(Nr,{onGoBack:o.modalManager.goBack,closeModal:l,onSave:o.postManager.onGeoSelect,selectedGeo:o.postManager.geo});case T.cL.AUDIO_PICKER:return(0,s.Y)(Uc.l,{onSelect:o.onAudiosSelect,onSnippetModeChange:o.onAudioSnippetModeChange,onPlaylistSelect:o.onAudioPlaylistSelect,onClose:l,onGoBack:o.modalManager.goBack,selectedPlaylist:o.postManager.audioPlaylist,selectedAudios:o.postManager.audios,ownerId:o.isAdmin?o.ownerId:o.currentUserId,currentUserId:o.currentUserId,isAdmin:o.isAdmin,audiosLimit:o.settingsManager.audioMaxCount,multipleAudioSelectEnabled:o.settingsManager.hasAudioMaxCount,sourceSelectorEnabled:!0,setAlertProps:(t,e,s,n)=>o.platformBasedManager.setAlertProps({type:T.n$.PostingAttachmentsErrorMusicAlert,payload:{button_text:i.getLang("global_add_media"),title:e,text:s},toggleRef:t?.currentTarget,onSubmit:n}),onError:(t,e)=>o.errorManager.showSnackbar({type:T.GZ.Error,subtitle:e,text:t}),timelineLogger:{logPickerReady:o.postingTimelineLogger.logPickerReady,logStartAttaching:()=>o.postingTimelineLogger.logStartAttaching({pickerType:Xt.ss.MUSIC}),logError:()=>o.postingTimelineLogger.logError({message:T.Zk.ErrorLoadingAudioPicker})},productAnalyticsLogger:o.productAnalyticsLogger,snippetOnboardingKey:Ws.L.ACCOUNT_HINT_FEED_POSTING_AUDIO_SNIPPET_WEB,isAudioSnippetEnabled:o.isAudioSnippetEnabled,defaultAudioSnippetSelected:o.audioSnippetSelected});case T.cL.PHOTO_EDITOR:return(0,s.Y)(d.Suspense,{fallback:(0,s.Y)(Be.H,{}),children:(0,s.Y)(ze,{photo:o.selectedPhoto,onGoBack:o.modalManager.goBack,onDone:o.postManager.setPhotoAttach,viewWidth:r,viewHeight:c,onRefreshCoordinates:t,onCanCropPhotoWithFeedback:o.canCropPhotoWithFeedback})});case T.cL.PHOTO_CROP:return(0,s.Y)(d.Suspense,{fallback:(0,s.Y)(_e.y,{}),children:(0,s.Y)(Ve,{photo:o.selectedPhoto,crop:o.selectedPhotoCrop,onGoBack:o.modalManager.goBack,onDone:o.postManager.setPhotoAttachmentsCrop,viewWidth:r,viewHeight:c,onRefreshCoordinates:t,onCanCropPhotoWithFeedback:o.canCropPhotoWithFeedback})});case T.cL.CO_OWNERS_PICKER:return(0,s.Y)(Fi,{selectedCoOwnersIds:o.postManager.coOwnersIds,onSelect:o.handleSelectCoOwners,onRefreshCoordinates:t,onClose:o.modalManager.goBack,ownerId:o.ownerId,onMaxCheckItemsLimitReached:()=>{o.errorManager.showErrorSnackbar(T.Rn.CoOwnersSelectedItemsLimitReached)}});case T.cL.ACTION_BUTTONS:return(0,s.Y)(gs,{ownerId:o.ownerId,onGoBack:o.modalManager.goBack,closeModal:l,onSave:o.onSelectActionButton,hasDonutButtons:o.settingsManager.hasDonutButtons,buttons:o.settingsManager.actionButtons,donutGoals:o.settingsManager.donutGoals,donutLevels:o.settingsManager.donutLevels,selectedActionButton:o.postManager.selectedActionButton});case T.cL.ADD_PRODUCT:return(0,s.Y)(d.Suspense,{fallback:(0,s.Y)(_e.y,{}),children:(0,s.Y)(_s,{tags:o.addProductManager.tags,aspectRatio:o.isPhotoCropEnabled?o.postManager.attachmentsAspect:void 0,crop:o.isPhotoCropEnabled?o.postManager.photoAttachmentsCrop:void 0,closeModal:l,photos:o.postManager.photos,onSave:m,onGoBack:o.modalManager.goBack,onShowProductAttachModal:br,onProductsLimitExceeded:()=>o.errorManager.showErrorSnackbar(T.Rn.ProductsLimitExceeded),onRefreshCoordinates:t})});case T.cL.SETTINGS:return(0,s.Y)(Pn,{closeModal:l,postingViewModel:o,checkIfModalClosingBlocked:h});case T.cL.BEST_FRIENDS:return(0,s.Y)(Mn,{onGoBack:o.modalManager.goBack,closeModal:l,onSaveBestFriends:o.onSaveBestFriends,bestFriends:o.bestFriendsData});case T.cL.PHOTO_VIEWER:return(0,s.Y)(Wn,{ratio:o.isPhotoCropEnabled?o.postManager.attachmentsAspect?.ratio:void 0,photo:o.selectedPhoto,photos:o.postManager.photos,crop:o.hasPhotoCrop?o.postManager.photoAttachmentsCrop:void 0,onGoBack:o.modalManager.goBack,onOpenPhotoViewer:o.openPhotoEditorScreen,viewWidth:r,viewHeight:c});case T.cL.PRIVACY:return(0,s.Y)(Xn,{disabled:o.privacySettingIsDisabled,isDonutEnabled:o.isDonutEnabled,isGroup:o.isGroup,isNewSuggestPost:o.isNewSuggestPost,onGoBack:o.modalManager.goBack,onCloseModal:l,postManager:o.postManager,postingSettings:o.settingsManager.postingSettings});case T.cL.EDIT_REPLY:return(0,s.Y)(Wr,{postManager:o.postManager,isLoading:o.hasLoader,hasProcessing:o.hasProcessing,onCloseModal:l,onChangeText:o.onChangeText,onEditPost:o.savePost,commentsSettingIsShown:o.commentsSettingIsShown,publishedDateSettingIsShown:o.publishedDateSettingIsShown});case T.cL.OLD_POST_EDIT_ALERT:return(0,s.Y)(ad,{needNewContent:!o.postManager.hasContent,onCancel:l,onSubmit:o.modalManager.goBack});case T.cL.PODCAST_EPISODE_PICKER:return(0,s.Y)(Lc,{ownerId:o.ownerId,onSelect:o.onPodcastEpisodeSelect,onClose:l,onGoBack:o.modalManager.goBack});case T.cL.DONUT_TEASER:return(0,s.Y)(Bc,{text:o.postManager.donutTeaserText,onSave:o.postManager.setDonutTeaserText,closeModal:l,onGoBack:o.modalManager.goBack,selectedDonutLevel:o.selectedDonutLevel});case T.cL.DRAFTS_LIST:return(0,s.Y)(Qd,{ownerId:o.ownerId,closeModal:l,onGoBack:o.modalManager.goBack,afterCreateSuccess:o.onCreateSuccess});default:return(0,s.Y)(fr,{closeModal:l,postingViewModel:o,setAttachmentsView:_,checkIfModalClosingBlocked:h,modalRef:e})}})),jc=(0,a.P)((function({children:t}){const e=(t=>{switch(t){case T.cL.PHOTO_VIEWER:case T.cL.PHOTO_CROP:case T.cL.PHOTO_EDITOR:case T.cL.ADD_PRODUCT:return xn.b.DARK;default:return}})(pe().modalManager.getCurrentModal);return e?(0,s.Y)(o.SvD,{value:e,children:t}):t})),Wc=(0,a.P)((function({closeModal:t,isBuiltIn:e}){const i=(0,ke.B)(),o=pe(),n=o.modalManager.getCurrentModal,a=(t=>{switch(t){case T.cL.PHOTO_VIEWER:case T.cL.PHOTO_CROP:case T.cL.PHOTO_EDITOR:return{height:"fit-content",width:"fit-content",maxWidth:"fit-content"};case T.cL.OLD_POST_EDIT_ALERT:return{height:316,width:420};default:return{height:T.oH,width:T.tA}}})(n),c=(t=>{switch(t){case T.cL.PHOTO_VIEWER:return"posting_photo_viewer";case T.cL.PHOTO_EDITOR:return"posting_photo_editor";default:return"posting_modal_box"}})(n),l=(0,d.useRef)(null);return e?(0,s.FD)(s.FK,{children:[o.modalManager.popout,(0,s.Y)(jc,{children:(0,s.Y)(r.n,{...a,getRef:l,"aria-label":i.getLang("wall_posting_modal_aria_label"),"data-testid":c,focusTrap:!0,children:(0,s.Y)(Gc,{onClose:t,refreshCoordinates:()=>{},modalRef:l})})})]}):(0,s.FD)(s.FK,{children:[o.modalManager.popout,(0,s.Y)(Sr.wI,{onDestroy:t,width:a.width,locale:i.locale,children:({onClose:t,refreshCoordinates:e})=>(0,s.Y)(jc,{children:(0,s.Y)(r.n,{...a,getRef:l,"aria-label":i.getLang("wall_posting_modal_aria_label"),"data-testid":c,focusTrap:!0,children:(0,s.Y)(Gc,{onClose:t,refreshCoordinates:e,modalRef:l})})})})]})})),Hc=({closeModal:t,ownerId:e,postRaw:i,postingTimelineStatsStartTime:a,creationEntryPoint:r,screen:d,initData:c,isBuiltIn:l,onCreate:h,localDraftManager:p,onSuggestedPublished:u,onCreateDraftSuccess:g,afterEditSuccess:_,isAdsPromotedCreate:m,isPostingOpenerVkr:v})=>(0,s.Y)(n.DA,{name:"posting-modal",children:(0,s.Y)(he,{onCreateSuccess:h||t,onEditSuccess:({postId:e,ownerId:i,needUpdatePost:s=!0})=>{t(),s&&_?.(e,i)},onSuggestedPublished:u,onCreateDraftSuccess:g,closeModal:t,ownerId:e,postRaw:i,platform:o.ODD.VKCOM,onLoadingError:t,postingTimelineStatsStartTime:a,creationEntryPoint:r,screen:d,initData:c,localDraftManager:p,isAdsPromotedCreate:m,isPostingOpenerVkr:v,children:(0,s.Y)(Wc,{closeModal:t,isBuiltIn:l})})})},811281:(t,e,i)=>{i.d(e,{z:()=>a});var s=i(221020),o=i(47417),n=i(815287);const a=({children:t,...e})=>{const i=(0,n.useRef)(null);return(0,n.useEffect)((()=>{i.current&&i.current?.focus()}),[]),(0,s.Y)(o.r,{...e,children:(0,s.Y)("span",{ref:i,tabIndex:-1,children:t})})}},619984:(t,e,i)=>{i.d(e,{H:()=>a});var s=i(221020),o=i(700777);const n="PostingPhotoEditorSpinner__spinner--7JzW2",a=()=>(0,s.Y)(o.q,{size:"l",className:n})},181237:(t,e,i)=>{i.d(e,{g:()=>s});const s=({viewHeight:t,viewWidth:e,originalHeight:i,originalWidth:s,safeZoneVertical:o=48,safeZoneHorizontal:n=128})=>{const a=t-o,r=e-n,d=i/s;let c=r,l=c*d;return l>a&&(l=a,c=l/d),{imageContainerWidth:Math.min(c,r),imageContainerHeight:Math.min(l,a)}}},473529:(t,e,i)=>{i.d(e,{V:()=>s});const s=(0,i(891719).F)({loader:async()=>{const{PostingForm:t}=await Promise.all([i.e(66417),i.e("langs/core_spa/postingForm")]).then(i.bind(i,134987));return t},name:"PostingForm"})},93944:(t,e,i)=>{i.d(e,{H:()=>a});var s=i(815287);const o=["touchend","touchcancel","mouseleave"];function n(t){return{x:t.touches[0].pageX,y:t.touches[0].pageY}}const a=({elementRef:t,onClick:e,onLongPress:i,...a},r=[])=>(0,s.useEffect)((()=>{if(t.current){const s=t=>{e?.(t)},r=function(t,e,{threshold:i=300,lockClickThreshold:s=120,cancelMoveDistance:a=0,canStart:r,onStart:d,onFinish:c,onCancel:l}={}){let h,p,u=!1,g=!1;const _=s=>{u||("function"!=typeof r||r(s))&&(u=!0,a&&(h=n(s)),!1!==a&&document.addEventListener("touchmove",y),o.forEach((e=>{t.addEventListener(e,v)})),t.addEventListener("contextmenu",(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}),!1),p=setTimeout((()=>{p=void 0,g=!0,e?.(s)}),i),d?.(s))};function m(){u&&(!1!==a&&document.removeEventListener("touchmove",y),o.forEach((e=>{t?.removeEventListener(e,v)}))),p&&(clearTimeout(p),p=void 0)}function v(t){if(m(),u){if(h=void 0,g)return setTimeout((()=>{g=!1,u=!1}),s),void c?.(t);u&&l?.(t),g=!1,u=!1}}function y(t){if(!a)return void(0===a&&v(t));const e=n(t),i=Math.abs(e.x-(h?.x??0)),s=Math.abs(e.y-(h?.y??0));(i>a||s>a)&&v(t)}function f(t){g&&(t.stopImmediatePropagation(),t.preventDefault())}return t.addEventListener("touchstart",_),t.addEventListener("click",f),()=>{t?.removeEventListener("touchstart",_),t?.removeEventListener("click",f),m()}}(t.current,(t=>i?.(t)),{threshold:400,lockClickThreshold:200,...a});return t.current.addEventListener("click",s),()=>{r(),t.current?.removeEventListener("click",s)}}}),r.concat(t.current))},182023:(t,e,i)=>{i.d(e,{JC:()=>r,eG:()=>o,gX:()=>a,mG:()=>n,qK:()=>s,vZ:()=>d});const s=()=>{const t=window.getSelection();return t&&t.rangeCount>0?t.getRangeAt(0)??null:null},o=t=>{const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(t))},n=(t,e=20)=>{const i=s()?.getBoundingClientRect();if(i&&0===i.height)return;const o=t.getBoundingClientRect(),n=t.scrollTop;if(i&&o){const s=n+i.top-o.top;i.top<o.top?t.scrollTo({top:s,left:0,behavior:"smooth"}):i.top>o.top+o.height&&t.scrollTo({top:s-o.height+e,left:0,behavior:"smooth"})}},a=t=>{try{const e=document.createRange();e.selectNodeContents(t),e.collapse(!1),o(e)}catch(t){}},r=t=>{const e=s();if(e){const i=e.cloneRange();return i.selectNodeContents(t),i.setEnd(e.endContainer,e.endOffset),i.toString().length}return-1},d=(t,e)=>{for(let i of t.childNodes)if(i.nodeType===Node.TEXT_NODE){const t=i.nodeValue?.length??0;if(t>=e){const t=document.createRange();return t.setStart(i,e),t.collapse(!0),o(t),-1}e-=t}else if(-1===(e=d(i,e)))return-1;return e}},40756:(t,e,i)=>{i.d(e,{Q:()=>a});var s=i(331635),o=i(42107),n=i(327813);class a{subscribe(t,e){const i=this._postsCallback.get(t);return i?i.push(e):this._postsCallback.set(t,[e]),()=>this.unsubscribe(t,e)}unsubscribe(t,e){const i=this._postsCallback.get(t);if(!i)return;const s=i.indexOf(e);-1!==s&&(i.splice(s,1),i.length||this._postsCallback.delete(t))}notify(t,e){this._postsCallback.get(t)?.forEach((t=>t(e)))}constructor(){this._postsCallback=new Map,(0,n.l_)(this)}}a=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],a)},127574:(t,e,i)=>{i.d(e,{y:()=>P});var s=i(331635),o=i(998286),n=i(916533),a=i(651253),r=i(273193),d=i(327813),c=i(42107),l=i(802872),h=i(837170),p=i(144819),u=i(226461),g=i(560527),_=i(570440),m=i(40756),v=i(195578),y=i(208712),f=i(160010),S=i(989078);const w=new Set(Object.values(h.q));const b={need_likes:1,fields:h.u,extended:1};class P{async fetchCurrentUser(){try{if(this.ownerService.provideUserGroupEntityById(this.authService.userId,!0))this._currentUserLoaded=!0;else if(this.authService.userId){const t=await this.userProvider.ensure({user_ids:[this.authService.userId],fields:h.u.split(",")});(0,d.h5)((()=>{if(this.authService.userId){const e=t.get(this.authService.userId);e?.data&&(this.ownerService.setUserGroupEntity([e.data]),this._currentUserLoaded=!0)}}))}}catch{this.errorLogger.log(new Error(`The current user is not found, id=${this.authService.userId}`))}}async fetchComments(t,e){let i;try{const s=(0,p.WO)({id:Number(t.post_id),ownerId:Number(t.owner_id)});t.sort&&(i=this.mutationService.updateCommentsOrder(s,t.sort));const o=await this.wallApi.getCommentsExtended({...b,...t},e),n=this.store.getCommentsMetaByPost(s);t.prev_from?o.next_from=n.next_from:t.next_from&&(o.prev_from=n.prev_from);const a=()=>(0,d.h5)((()=>{this.store.addCommentsMetaByPost(s,o),o.items.forEach((t=>{this.store.addCommentToStore(t)})),this.fillProfilesAndGroups(o.profiles,o.groups),this.feedEntitiesMutationService.mutateFeedPostItemCommentsCounter(s,o.count)}));return{data:o,onDone:a}}catch(t){throw i?.(),t}}async fetchThreadComments({commentRawId:t,...e},i){const s=await this.wallApi.getCommentsExtended({...b,...e,sort:"asc"},i),o=this.store.getThreadMeta(t);e.prev_from&&o?s.next_from=o.next_from:e.next_from&&o&&(s.prev_from="prev_from"in o?o.prev_from:void 0);return{data:s,onDone:()=>(0,d.h5)((()=>{const i=this.store.getThreadMeta(t)?.count??0;this.mutationService.replaceCommentThreadMeta(t,s),s.items.forEach((t=>{this.store.addCommentToStore(t)})),this.fillProfilesAndGroups(s.profiles,s.groups);const o=s.count-i;if(o&&e.post_id&&e.owner_id){const t=(0,p.WO)({id:e.post_id,ownerId:e.owner_id});this.feedEntitiesMutationService.incrementFeedPostItemCommentsCounter(t,o)}}))}}fillProfilesAndGroups(t,e){this.ownerService.setUserGroupEntity(t,e)}async fetchCommentsOrder({owner_id:t,post_id:e}){const i=(0,p.WO)({id:e,ownerId:t}),s=await this.wallApi.getCommentOrder({owner_id:t,post_id:e});this.store.addCommentsOrderByPost(i,{order:s.current_order,items:s.items})}deleteComment(t,e){return this.mutationService.doOptimisticMutation({key:`comment:${t.id}:delete_restore`,mutateApi:async(e,i)=>{try{return await this.wallApi.deleteComment(e,{signal:i})}catch(e){if((0,f.d)(e)&&"Access denied: post or comment deleted"===e.error.error_msg)return this.mutationService.updateCommentState(t.rawId,"deletedWithoutRestore"),1;throw e}},updateUi:()=>{const i=this.mutationService.updateCommentState(t.rawId,"deleted"),s=e?this.feedEntitiesMutationService.incrementFeedPostItemCommentsCounter(t.postRawId,-1):void 0;return()=>{i(),s?.()}},updateUiValue:{owner_id:t.owner_id,comment_id:t.id},onError:t=>{throw t}})}deleteThread(t){if(!t.owner_id)throw new Error("CommentsService: comment owner_id is missing");return this.mutationService.doOptimisticMutation({key:`comment:${t.id}:deleteThread_restoreThread`,mutateApi:(t,e)=>this.wallApi.deleteThread(t,{signal:e}),updateUi:()=>this.mutationService.updateCommentState(t.rawId,"deletedWithThread"),updateUiValue:{owner_id:t.owner_id,reply_id:t.id},onError:t=>{throw t}})}restoreThread(t){if(!t.owner_id)throw new Error("CommentsService: comment owner_id is missing");return this.mutationService.doOptimisticMutation({key:`comment:${t.id}:deleteThread_restoreThread`,mutateApi:(t,e)=>this.wallApi.restoreThread(t,{signal:e}),updateUi:()=>this.mutationService.updateCommentState(t.rawId,"deleted"),updateUiValue:{owner_id:t.owner_id,reply_id:t.id},onError:t=>{throw t}})}restoreComment(t,e){return this.mutationService.doOptimisticMutation({key:`comment:${t.id}:delete_restore`,mutateApi:(t,e)=>this.wallApi.restoreComment(t,{signal:e}),updateUi:()=>{const i=this.mutationService.updateCommentState(t.rawId,"default"),s=e?this.feedEntitiesMutationService.incrementFeedPostItemCommentsCounter(t.postRawId,1):void 0;return()=>{i(),s?.()}},updateUiValue:{owner_id:t.owner_id,comment_id:t.id},onError:t=>{throw t}})}async createComment({post_id:t,owner_id:e,message:i,reply_to_comment:s,sticker_id:o,attachments:n,from_group:a,entry_point:r,track_code:d,ref:c}){try{return await this.wallApi.createComment({post_id:t,owner_id:e,message:i??"",reply_to_comment:s,attachments:n,from_group:a,sticker_id:o,entry_point:r,track_code:d,ref:c})}catch(t){throw t}}async editComment({post_id:t,owner_id:e,comment_id:i,message:s,attachments:o},{commentRawId:n,attachmentsData:a}){try{const r=await this.wallApi.editComment({post_id:t,owner_id:e,comment_id:i,message:s,attachments:o});return(0,d.h5)((()=>{this.mutationService.updateComment(n,{text:s??"",attachments:a})})),r}catch(t){throw t}}async fetchComment(t,e,i){try{const{items:s,profiles:o,groups:n,...a}=await this.wallApi.getCommentExtended({extended:1,fields:h.u,...t});return(0,d.h5)((()=>{const{owner_id:t,post_id:r}=s[0];if(t&&r){const e=(0,p.WO)({id:r,ownerId:t});this.store.getCommentsMetaByPost(e).count||this.store.addCommentsMetaByPost(e,{...a,count:1})}this.storeComment(s[0],e,i),this.fillProfilesAndGroups(o,n)})),s[0]}catch(t){throw t}}async fetchCommentsForPosts(t,e){try{const i=await this.wallApi.getCommentsForPosts({...b,preview_length:0,...t,posts_ids:t.posts_ids.join(",")},e);return{data:void 0,onDone:()=>{(0,d.h5)((()=>{i.items.forEach((({comments:t,...e})=>{if(!e.post_id||!(0,u.c)(e.post_id))return;const i=t?.map((t=>S.u.comment(t)));if(i&&this.store.setInitialCommentsIdsByPost(e.post_id,i),this.store.addCommentsMetaByPost(e.post_id,e),e.available_order){const t=e.available_order.map((t=>{switch(t){case"smart":return{id:t,name:this.langs.getLang("wall_replies_order_smart_label")};case"desc":return{id:t,name:this.langs.getLang("wall_replies_order_desc_label")};default:return{id:"asc",name:this.langs.getLang("wall_replies_order_asc_label")}}}));(s=e.order)&&w.has(s)&&this.store.addCommentsOrderByPost(e.post_id,{order:e.order,items:t})}var s;t?.forEach((t=>{t.thread?.count&&(t.thread.next_from="next/0//0"),this.store.addCommentToStore(t)}))})),t.posts_ids.forEach((t=>{this.store.getInitialCommentsByPost(t)||this.store.setInitialCommentsIdsByPost(t,[])})),this.fillProfilesAndGroups(i.profiles,i.groups)}))}}}catch(e){this.errorLogger.log(new Error(`Cannot fetch comments for wall posts, id=${t.owner_id}`))}}storeComment(t,e,i){const{id:s,owner_id:o,post_id:n}=t;void 0!==s&&(0,d.h5)((()=>{const s=Boolean(this.store.getComment(S.u.comment(t))),a=this.store.addCommentToStore({...t,owner_id:o??0});if(!s&&n&&o){const s=(0,p.WO)({id:n,ownerId:o}),r=this.store.getCommentsMetaByPost(s);if(t.reply_to_comment){const e=i??(0,p.WO)({id:Number(t.reply_to_comment),ownerId:Number(t.reply_to_user)}),o=this.store.getThreadMeta(e);this.mutationService.updateCommentsMetaByPost(s,{count:r.count+1});const n=this.store.getComment(e);n?.parents_stack?.length||this.mutationService.updateCommentThreadMeta(e,{count:(o?.count??0)+1})}else this.mutationService.updateCommentsMetaByPost(s,{count:r.count+1});this.feedEntitiesMutationService.incrementFeedPostItemCommentsCounter(s,1),e&&this.commentsNotifierService.notify(s,a)}}))}constructor(t,e,i,s,o,n,a,r,c,l){this.store=t,this.commentsNotifierService=e,this.mutationService=i,this.wallApi=s,this.ownerService=o,this.feedEntitiesMutationService=n,this.userProvider=a,this.authService=r,this.errorLogger=c,this.langs=l,this._currentUserLoaded=!1,this.getOwner=(t,e)=>{if(void 0!==t&&(t!==this.authService.userId||this._currentUserLoaded))return this.ownerService.provideUserGroupEntityById(t,e)},this.fetchCurrentUser(),(0,d.l_)(this)}}P=(0,s.Cg)([c.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===l.g?Object:l.g,void 0===m.Q?Object:m.Q,void 0===g.z?Object:g.z,void 0===o.t?Object:o.t,void 0===_.v?Object:_.v,void 0===v.K?Object:v.K,void 0===y.T?Object:y.T,void 0===n.u?Object:n.u,void 0===a.v?Object:a.v,void 0===r.Y?Object:r.Y])],P)},837170:(t,e,i)=>{i.d(e,{q:()=>o,u:()=>s});const s="photo_50,photo_100,photo_200,first_name_dat,first_name_gen,last_name_gen,sex,verified,is_verified,image_status,can_message,last_seen,mutual,can_write_private_message,deactivated,friend_status,status,activity,members_preview,has_unseen_stories,members_count,member_status,is_member",o={SMART:"smart",ASC:"asc",DESC:"desc"}},582876:(t,e,i)=>{i.d(e,{m:()=>u});var s=i(331635),o=i(273193),n=i(97929),a=i(630865),r=i(651253),d=i(327813),c=i(376572),l=i(848549),h=i(42107);const p=9e3;class u{constructor(t,e,i,s){this.langs=t,this.snackbar=e,this.network=i,this.errorLogger=s,this.handleNetworkError=t=>{this.errorLogger.log(t),(0,c.T)(t)&&!(0,l.z)(t)?this.showNetworkErrorSnackbar():(0,l.z)(t)||this.showGlobalErrorSnackbar()},this.canProceedOnClick=()=>!!this.network.isOnline||(this.showNetworkErrorSnackbar(),!1),this.showNetworkErrorSnackbar=()=>{this.snackbar.show({type:"warning",text:this.langs.getLang("wall_posting_network_general_error_text"),subtitle:this.langs.getLang("wall_posting_network_general_error_subtitle"),duration:p})},this.showGlobalErrorSnackbar=()=>{this.snackbar.show({type:"warning",text:this.langs.getLang("global_unexpected_error_try_later"),duration:p})},this.showMissingPostSnackbar=()=>{this.snackbar.show({text:this.langs.getLang("wall_post_bookmark_missing_post_error"),duration:p})},(0,d.l_)(this)}}u=(0,s.Cg)([h.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===o.Y?Object:o.Y,void 0===n.q?Object:n.q,void 0===a.l?Object:a.l,void 0===r.v?Object:r.v])],u)},398035:(t,e,i)=>{i.d(e,{D:()=>a});var s=i(794345),o=i(327813),n=i(561412);class a{get requestState(){return this._requestState}reset(){this.requestState.reset()}async request(t,e,i){const s=await this.getRequestPromise(t,e,i);return{onDone:()=>(0,o.h5)((()=>{this.feedServiceAggregator.ownerService.setUserGroupEntity(s.profiles,s.groups),s.reaction_sets?.forEach((t=>{this.feedServiceAggregator.feedReactionSetsStore.addReactionSet(t)}))})),data:{items:s.items.map((t=>this.feedServiceAggregator.feedEntitiesStore.createFeedItemFromApi(t))).filter((t=>!!t)),..."next_from"in s&&{startFrom:s.next_from},..."count"in s&&{count:s.count}}}}async fetch(t,e){return this.requestState.clearRequestParams(),this.requestState.fetch(t,e)}async fetchNext(t,e){if("loading"!==this.requestState.status&&!this.requestState.allAvailableItemsLoaded)return this.requestState.fetch({...this.requestState.previousRequestParams,...t,start_from:this.requestState.startFrom,count:t?.count??s.ln,offset:this.requestState.offset},e)}constructor(t){this.feedServiceAggregator=t,this._requestState=new n.X(this.request.bind(this),this.feedServiceAggregator.errorLogger),(0,o.Gn)(this,{reset:o.XI,request:o.XI,fetch:o.XI,fetchNext:o.XI,_requestState:o.sH.deep,requestState:o.EW})}}},337951:(t,e,i)=>{function s(t,e){return e?`web_layer:${t}`:t}i.d(e,{q:()=>s})},407691:(t,e,i)=>{i.d(e,{IQ:()=>g,KN:()=>p,NA:()=>u,p$:()=>l,qF:()=>_,qK:()=>h,q_:()=>m,un:()=>v});var s=i(331635),o=i(42107),n=i(767147),a=i(398035),r=i(794345),d=i(998286),c=i(645189);class l extends a.D{get feedType(){return"wall:all"}getRequestPromise(t,e,i){return(i.prefetch?this.wallApi.getWithPrefetch:this.wallApi.get).bind(this.wallApi)({extended:1,fields:r.V7,filters:r.ZL,filter:t.filter,domain:t.domain,start_from:t.start_from,count:t.count},{maxRetries:this.userEnv.getConfigValue("feed_requests_retries_count")?.["wall.get"],signal:e.signal})}constructor(t,e,i){super(e),this.wallApi=t,this.feedServiceAggregator=e,this.userEnv=i}}l=(0,s.Cg)([o.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===d.t?Object:d.t,void 0===n.f?Object:n.f,void 0===c.J?Object:c.J])],l);class h extends l{get feedType(){return"wall:postponed"}}h=(0,s.Cg)([o.z8.global()],h);class p extends l{get feedType(){return"wall:owner"}}p=(0,s.Cg)([o.z8.global()],p);class u extends l{get feedType(){return"wall:suggests"}}u=(0,s.Cg)([o.z8.global()],u);class g extends l{get feedType(){return"wall:archived"}}g=(0,s.Cg)([o.z8.global()],g);class _ extends l{get feedType(){return"wall:donut"}}_=(0,s.Cg)([o.z8.global()],_);class m extends l{get feedType(){return"wall:drafts"}}m=(0,s.Cg)([o.z8.global()],m);class v extends l{get feedType(){return"wall:drafts_simple"}}v=(0,s.Cg)([o.z8.global()],v)},578904:(t,e,i)=>{i.d(e,{a:()=>l});var s=i(331635),o=i(42107),n=i(767147),a=i(794345),r=i(998286),d=i(419692),c=i(327813);class l{async refetchPost(t){const e=await this.wallApi.getPostById({posts:t,extended:1,copy_history_depth:1,fields:a.V7}),i=e.items[0];(0,c.h5)((()=>{i&&this.feedServiceAggregator.feedEntitiesStore.updateItemFromApi(i),this.feedServiceAggregator.ownerService.setUserGroupEntity(e.profiles,e.groups)}))}async request({rawId:t},e,i){const s=(i?.prefetch?this.wallApi.getPostByIdWithPrefetch:this.wallApi.getPostById).bind(this.wallApi),o=await s({posts:t,extended:1,copy_history_depth:1,fields:a.V7},{signal:e?.signal});return{data:void 0,onDone:()=>(0,c.h5)((()=>{o.items.forEach((t=>{this.feedServiceAggregator.feedEntitiesStore.createFeedItemFromApi(t)})),this.feedServiceAggregator.ownerService.setUserGroupEntity(o.profiles,o.groups),o.reaction_sets?.forEach((t=>{this.feedServiceAggregator.feedReactionSetsStore.addReactionSet(t)}))}))}}constructor(t,e,i){this.wallApi=t,this.likesApi=e,this.feedServiceAggregator=i,(0,c.l_)(this)}}l=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===r.t?Object:r.t,void 0===d.d?Object:d.d,void 0===n.f?Object:n.f])],l)},640290:(t,e,i)=>{i.d(e,{C:()=>r});var s=i(331635),o=i(327813),n=i(42107),a=i(998286);class r{parseAttachedLink(t){return this.wallApi.parseAttachedLink(t)}async restoreWallPost(t){return this.wallApi.restore(t)}async deleteWallPost(t){return this.wallApi.delete(t)}async archiveWallPost(t){return this.wallApi.archive(t)}async revealWallPost(t){return this.wallApi.reveal(t)}async openCommentsWallPost(t){return this.wallApi.openComments(t)}async closeCommentsWallPost(t){return this.wallApi.closeComments(t)}async pinWallPost(t){return this.wallApi.pin(t)}async unpinWallPost(t){return this.wallApi.unpin(t)}async deleteAllWallItems(t){return this.wallApi.deleteAll(t)}constructor(t){this.wallApi=t,(0,o.l_)(this)}}r=(0,s.Cg)([n.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.t?Object:a.t])],r)},106407:(t,e,i)=>{i.d(e,{j:()=>p});var s=i(331635),o=i(327813),n=i(878562),a=i(186742),r=i(651253),d=i(328911),c=i(42107),l=i(647961),h=function(t){return t.Idle="idle",t.Loading="loading",t.LoadingMore="loadingMore",t.InitialLoading="initialLoading",t}({});class p{async fetchAttachInitialData(t){this.loadingStatus=h.InitialLoading;try{const e=await this.marketApi.getItemsForAttach(t),i=this.getSelectedGroupId(e.groups);(0,o.h5)((()=>{this.mapGroupsProductsList.set(i,this.getMarketItemsEntities(e.group_items)),this.mapProductsOffsets.set(i,t.count),this.groups=e.groups,e.fave_items?.forEach((t=>{const e=(0,d.o)({itemId:t.id,ownerId:t.owner_id});this.mapFavoriteProducts.set(e,new l.e(t,this.marketApi,this.faveApi))})),this.mapProductsOffsets.set("five",t.count),this.loadingStatus=h.Idle}))}catch(t){(0,o.h5)((()=>{this.loadingStatus=h.Idle,this.errorLogger.log(new Error("Fetch market attach initial data failed"),{metaData:{breadcrumb:{data:{error:t}}}})}))}}changeSelectedGroup(t){this.setSelectedGroup(t.group_id),this.mapGroupsProductsList.has(t.group_id)||this.fetchGroupProducts(t)}async fetchGroupProductsMore({count:t,is_services:e}){this.loadingStatus=h.LoadingMore;try{const i=this.getSelectedGroupId(this.groups),s=await this.marketApi.getItemsForAttach({count:t,is_services:e,group_id:i,offset:this.offset});(0,o.h5)((()=>{this.mapGroupsProductsList.set(i,[...this.groupItems,...this.getMarketItemsEntities(s.group_items)]),this.mapProductsOffsets.set(i,this.offset+t),this.loadingStatus=h.Idle}))}catch(t){(0,o.h5)((()=>{this.loadingStatus=h.Idle,this.errorLogger.log(new Error("Fetch market attach group more data failed"),{metaData:{breadcrumb:{data:{error:t}}}})}))}}async fetchFiveItemsMore(t){this.loadingStatus=h.LoadingMore;try{const e=await this.faveApi.get({offset:this.fiveOffset,item_type:"product",count:t});(0,o.h5)((()=>{e.items.forEach((t=>{if(t.product){const e=(0,d.o)({itemId:t.product.id,ownerId:t.product.owner_id});this.mapFavoriteProducts.set(e,new l.e(t.product,this.marketApi,this.faveApi))}})),this.mapProductsOffsets.set("five",this.fiveOffset+t),this.loadingStatus=h.Idle}))}catch(t){(0,o.h5)((()=>{this.loadingStatus=h.Idle,this.errorLogger.log(new Error("Fetch market attach five items more data failed"),{metaData:{breadcrumb:{data:{error:t}}}})}))}}get isInitialLoading(){return this.loadingStatus===h.InitialLoading}get isLoading(){return this.loadingStatus===h.Loading}get canShowMore(){return this.groupItems.length>=this.offset}get canFiveShowMore(){return this.faveItems.length>=this.fiveOffset}get isLoadingMore(){return this.loadingStatus===h.LoadingMore}get groupItems(){const t=this.getSelectedGroupId(this.groups);return this.mapGroupsProductsList.get(t)||[]}hasGroupWithItems(t){return this.groups.find((e=>e.id===t))}get faveItems(){return[...this.mapFavoriteProducts.values()]}addCashFiveItem(t){const e=(0,d.o)({itemId:t.data.id,ownerId:t.data.owner_id});return this.mapFavoriteProducts.set(e,t)}removeCashFaveItem(t){const e=(0,d.o)({itemId:t.data.id,ownerId:t.data.owner_id}),i=this.fiveOffset>0?this.fiveOffset-1:0;return this.mapProductsOffsets.set("five",i),this.mapFavoriteProducts.delete(e)}get offset(){const t=this.getSelectedGroupId(this.groups);return this.mapProductsOffsets.get(t)||0}get fiveOffset(){return this.mapProductsOffsets.get("five")||0}async fetchGroupProducts(t){this.loadingStatus=h.Loading;try{const e=await this.marketApi.getItemsForAttach(t);(0,o.h5)((()=>{this.mapGroupsProductsList.set(t.group_id,this.getMarketItemsEntities(e.group_items)),this.mapProductsOffsets.set(t.group_id,t.count),this.loadingStatus=h.Idle}))}catch(t){(0,o.h5)((()=>{this.loadingStatus=h.Idle,this.errorLogger.log(new Error("Fetch market attach group data failed"),{metaData:{breadcrumb:{data:{error:t}}}})}))}}getSelectedGroupId(t){return t.find((t=>t.is_selected))?.id||0}getMarketItemsEntities(t){return t.map((t=>new l.e(t,this.marketApi,this.faveApi)))}setSelectedGroup(t){this.groups.forEach((e=>{e.is_selected=e.id===t}))}constructor(t,e,i){this.marketApi=t,this.faveApi=e,this.errorLogger=i,this.mapGroupsProductsList=new Map,this.mapProductsOffsets=new Map,this.mapFavoriteProducts=new Map,this.loadingStatus=h.Idle,this.groups=[],(0,o.l_)(this)}}p=(0,s.Cg)([c.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.L?Object:n.L,void 0===a.L?Object:a.L,void 0===r.v?Object:r.v])],p)},647961:(t,e,i)=>{i.d(e,{e:()=>n});var s=i(327813),o=i(725308);class n{get data(){return this._marketItem}get cart(){return this._cart}get fave(){return this._fave}getCartToggleParams(){return{group_id:o.z.convertOwnerIdToGroupId(this._marketItem.owner_id),item_id:this._marketItem.id}}getFaveToggleParams(){return{owner_id:this._marketItem.owner_id,id:this._marketItem.id}}async addToCartSingle(){return this.addToCart({quantity:1})}async removeFromCartSingle(){return this.removeFromCart({quantity:1})}async addToCart({quantity:t}){return this.changeCartQuantity({quantity:t})}async removeFromCart({quantity:t}){return this.changeCartQuantity({quantity:-t})}async changeCartQuantity({quantity:t}){const e=this._marketItem.cart_quantity??0;try{this._marketItem.cart_quantity=e+t,this._cart.isLoading=!0,this._cart.isError=!1,t>0?await this.marketApi.addToCart({...this.getCartToggleParams(),quantity:t}):await this.marketApi.removeFromCart({...this.getCartToggleParams(),quantity:-t})}catch{(0,s.h5)((()=>{this._marketItem.cart_quantity=e,this._cart.isError=!0}))}finally{(0,s.h5)((()=>{this._cart.isLoading=!1}))}}async faveAdd(){return this.faveToggle({isFavorite:!0})}async faveRemove(){return this.faveToggle({isFavorite:!1})}async faveToggle({isFavorite:t}){try{this._fave.isLoading=!0,this._marketItem.is_favorite=t,this._fave.isError=!1,t?await this.faveApi.addProduct(this.getFaveToggleParams()):await this.faveApi.removeProduct(this.getFaveToggleParams())}catch{(0,s.h5)((()=>{this._marketItem.is_favorite=!t,this._fave.isError=!0}))}finally{(0,s.h5)((()=>{this._fave.isLoading=!1}))}}constructor(t,e,i){this._marketItem=t,this.marketApi=e,this.faveApi=i,this._cart={isError:!1,isLoading:!1},this._fave={isError:!1,isLoading:!1},(0,s.l_)(this)}}},169151:(t,e,i)=>{i.d(e,{s:()=>a});var s=i(327813),o=i(144819),n=i(725308);class a{get rawId(){return(0,o.WO)({id:this.data.id,ownerId:this.data.owner_id})}get friendsProfiles(){return this.isAnonymous?[]:this.data.friends?.map((t=>this.data.profiles?.find((e=>e.id===t.id)))).filter((t=>void 0!==t))??[]}get friendsId(){return this.isAnonymous?[]:this.data.friends??[]}get question(){return this.data.question}get isAnonymous(){return Boolean(this.data.anonymous)}get isFinished(){return Boolean(this.endDate&&1e3*this.endDate<=Date.now())}get answers(){return this.data.answers}get answersIds(){return this.data.answer_ids}get votes(){return this.data.votes}get canVote(){return this.data.can_vote&&!this.closed&&!this.isFinished&&!this.answersIds?.length}get canUnvote(){return this.data.can_vote&&!this.unvoteDisabled&&!this.closed&&!this.isFinished&&Boolean(this.answersIds?.length)}get unvoteDisabled(){return this.data.disable_unvote}get endDate(){return this.data.end_date}get closed(){return this.data.closed}get multiple(){return this.data.multiple}get canEdit(){return this.data.can_edit}get canShare(){return this.data.can_share}get canReport(){return this.data.can_report}get backgroundType(){return this.data.photo?"photo":"gradient"===this.data.background?.type||"tile"===this.data.background?.type?this.data.background?.type:void 0}get background(){if(this.backgroundType)return["gradient","tile"].includes(this.backgroundType)?this.data?.background:"photo"===this.backgroundType?this.data?.photo:void 0}get owner(){const t=this.data.owner_id;if(n.z.isGroupId(t)){const e=n.z.convertOwnerIdToGroupId(t);return this.data.groups?.find((t=>t.id===e))}return this.data.profiles?.find((e=>e.id===t))}constructor(t){this.data=t,(0,s.l_)(this)}}},925331:(t,e,i)=>{i.d(e,{I:()=>u});var s=i(331635),o=i(327813),n=i(42107),a=i(951609),r=i(345482),d=i(651253),c=i(738471),l=i(567983),h=i(514214),p=i(190905);class u{async fetchClipsCatalog(t,e){const i=await this.catalogApi.getShortVideoSearch(t,e);return this.createCatalog(i)}async fetchSearchVideoCatalog(t,e){try{const i=await this.catalogApi.getVideoSearch(t,e);return this.createCatalog(i)}catch(t){return this.errorLogger.log(t),null}}async fetchSearchVideoWeb2Catalog(t,e){try{const i=await this.catalogApi.getVideoSearchWeb2(t,e);return this.createCatalog(i)}catch(t){return this.errorLogger.log(t),null}}async fetchSearchAllCatalog(t,e){const i=await this.searchApi.getSearchAll(t,e);return this.createCatalog(i)}async fetchCommunitiesCatalog(t,e){const i=await this.catalogApi.getSearchGroups(t,e);return this.createCatalog(i)}updateCatalog(t){return this.createCatalog(t)}createCatalog(t){if(!t.catalog)return null;const e=new c.B({suggestions:(0,l.U)(),search_suggestions:(0,l.U)(),placeholders:(0,h.n)()}),{catalog:i,...s}=t;return new p.W({data:i,catalogApi:this.catalogApi,entitiesSource:s,entities:e})}constructor(t,e,i){this.catalogApi=t,this.searchApi=e,this.errorLogger=i,(0,o.l_)(this)}}u=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.g?Object:a.g,void 0===r.J?Object:r.J,void 0===d.v?Object:d.v])],u)},407072:(t,e,i)=>{i.d(e,{q:()=>s});var s=function(t){return t.Uploading="uploading",t.Encoding="encoding",t.Uploaded="uploaded",t.Encoded="encoded",t.UploadError="uploadError",t.EncodeError="encodeError",t.BlockedError="blockedError",t}({})},687089:(t,e,i)=>{i.d(e,{n:()=>c});var s=i(331635),o=i(327813),n=i(42107),a=i(617989),r=i(452200),d=i(144819);class c{async delete(t,{targetId:e,controller:i}={}){const s=(0,r.v)(t);if(this.isDeleting(t))return!1;const o={video_id:s.id,owner_id:s.ownerId,target_id:e};this.videoDeletingMap.set(t,!0);try{const e=await this.videoApi.delete(o,{signal:i?.signal});return e&&this.videoDeletedMap.set(t,!0),Boolean(e)}finally{this.videoDeletingMap.set(t,!1)}}async restore({videoId:t,ownerId:e},i){const s=(0,d.WO)({id:t,ownerId:e});if(this.isRestoring(s))return!1;this.videoRestoringMap.set(s,!0);try{const o=await this.videoApi.restore({video_id:t,owner_id:e},i);return this.videoDeletedMap.set(s,!1),Boolean(o)}finally{this.videoRestoringMap.set(s,!1)}}isDeleted(t){return this.videoDeletedMap.get(t)}isDeleting(t){return this.videoDeletingMap.get(t)}isRestoring(t){return this.videoRestoringMap.get(t)}constructor(t){this.videoApi=t,this.videoDeletedMap=new Map,this.videoDeletingMap=new Map,this.videoRestoringMap=new Map,(0,o.l_)(this)}}c=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.C?Object:a.C])],c)},360809:(t,e,i)=>{i.d(e,{D:()=>r});var s=i(331635),o=i(327813),n=i(366161),a=i(42107);class r{add(t){return this.tagsApi.add(t)}delete(t){return this.tagsApi.delete(t)}getList(t,e){return this.tagsApi.getList(t,e)}constructor(t){this.tagsApi=t,(0,o.l_)(this)}}r=(0,s.Cg)([a.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.q?Object:n.q])],r)},171351:(t,e,i)=>{i.d(e,{V:()=>d});var s=i(331635),o=i(327813),n=i(42107),a=i(876141),r=i(849645);class d{get domain(){return this.vkHost.getDomainName()}get apiUrl(){return`https://${this.metaData.get().domains.api}/method`}get authUrl(){return`https://${this.metaData.get().domains.connect}/mini_app_token`}get policyConfirmationUrl(){return`https://${this.metaData.get().domains.connect}/mini_app_confirm_policy`}constructor(t,e){this.vkHost=t,this.metaData=e,(0,o.l_)(this)}}d=(0,s.Cg)([n.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.O?Object:a.O,void 0===r.e?Object:r.e])],d)},856299:(t,e,i)=>{i.d(e,{X:()=>c});var s=i(331635),o=i(327813),n=i(42107),a=i(916533),r=i(722934),d=i(645189);class c{async fetchAndCheck(t){const e=await this.loadParamsFromApi(t);return!!e&&this.check(e)}check({type:t,isInstalled:e,isInstallScreen:i,isLayerRestricted:s}){switch(t){case"mini_app":return!s;case"html5_game":case"game":return i&&!e;default:return!1}}async loadParamsFromApi(t){const e=this.isAnonymous&&this.userEnv.partConfigEnabled("frontend.web_spa_mini_apps_layer_anonym_available");let i;if(e){i=(await this.appsApi.getInfoAnonym({app_id:t})).app||null}else{const e=await this.appsApi.getApp({app_id:t,app_fields:["type","is_installed","is_install_screen","is_layer_restricted"].join(",")},{grouping:!this.userEnv.partConfigEnabled("frontend.apps_spa_execute_disabled_for_launch")});i=e?.items?.[0]||null}if(!i)return null;const{type:s,is_installed:o=!1,is_install_screen:n=e,is_layer_restricted:a=!1}=i;return{type:s,isInstalled:o,isInstallScreen:n,isLayerRestricted:a}}get isAnonymous(){return!this.authService.isAuthorized}constructor(t,e,i){this.authService=t,this.appsApi=e,this.userEnv=i,(0,o.l_)(this)}}c=(0,s.Cg)([n.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.u?Object:a.u,void 0===r.V?Object:r.V,void 0===d.J?Object:d.J])],c)},54952:(t,e,i)=>{i.d(e,{I:()=>P,m:()=>k});var s=i(331635),o=i(327813),n=i(365815),a=i(42107),r=i(685431),d=i(916533),c=i(722934),l=i(645189),h=i(651253),p=i(69382),u=i(101922),g=i(171351),_=i(856299),m=i(725308),v=i(878136);class y{transformAppResponse(t,e){const{id:i,title:s,type:o,webview_url:n="",iframe_settings:a,rights:r,need_policy_confirmation:d,is_vkui_internal:c,is_calls_available:l,author_owner_id:h,author_url:p,is_recommended:g,is_favorite:_,are_notifications_enabled:y,icon_139:f,profile_button_available:S,is_button_added_to_profile:w,available_methods:b=[],sdk_methods:P=[],is_mini_app_flow:A,is_widescreen:k,support_url:C,placeholder_info:I,mobile_controls_type:E=v.y.VK_APP,is_badge_allowed:L,is_installed:T=!1,is_layer_restricted:M=!1,is_install_screen:O=!1,is_trusted:D=!1,screen_name:x,description:R,legal_documents:Y,is_iframe_mode:F,my_tracker_timespent_counter_id:B,favicon:N,is_vk_pay_disabled:z=!1,is_need_to_show_launch_screen:V,is_need_to_show_unverified_screen_on_launch:U,without_header:G,without_footer:j,manage_link:W,is_splash_screen_enabled:H,mini_apps_web_call_api_form_data:$,track_code:K}=t;return{handlers:{availableMethods:b,sdkMethods:P},whitelistScopes:"",isApp:(0,u.YB)(t),isMiniApp:(0,u.lq)(t),isGame:(0,u.Zl)(t),isDirectGame:(0,u.iN)(t),isAnyGame:(0,u.xr)(t),isCommunityApp:(0,u.nB)(t),layer:!1,embed:!1,appGroupId:h&&m.z.isGroupId(h)?Math.abs(h):void 0,isInternalApp:c,viewerId:e,needPolicyConfirmation:!!d,supportUrl:C,isCallsAvailable:l,isRecommended:g,isFavorite:_,notificationsEnabled:y,placeholderInfo:I?{title:I.title,subtitle:I.subtitle,reason:I.reason,actionButton:I.action_button,suggestedAppsIds:I.suggested_apps_ids}:void 0,appImage:f,profileButtons:{available:S,installed:w},vkAppConnectHost:this.appApiConfigService.authUrl,isTextliveApp:!1,isVkPayApp:!1,isMiniAppWidget:!1,groupWhitelistScopes:"",isMiniAppFlow:A,bridgeMethodsToBeLogged:[],securityHash:{},mobileControlsType:E,id:i,title:s,url:n,type:o,rights:r,iframeSettings:a,authorUrl:p,isWidescreen:k,screenOrientation:(0,u.Vv)(t),splashScreen:(0,u.w)(t),isBadgeAllowed:L,authorId:h,isInstalled:T,isLayerRestricted:M,isInstallScreen:O,isTrusted:D,description:R,screenName:x,legalDocuments:Y,isIframeMode:F,myTrackerTimeSpentCounterId:B,favicon:N,isVkPayDisabled:z,isNeedToShowLaunchScreen:V,needToShowUnverifiedScreen:U,withoutHeader:G,withoutFooter:j,canRunInLayer:this.appsLayerAvailabilityCheckerService.check({type:o,isInstalled:T,isInstallScreen:O,isLayerRestricted:M}),loadTimestamp:Date.now(),manageLink:W,callApiFormData:$,isSplashScreenEnabled:H,trackCode:K}}transformSecondaryLaunchParams(t){const e={},i={};return Object.entries(t).forEach((([t,s])=>{t.includes("_hash")&&"string"==typeof s?e[t]=s:i[t]=s})),[e,i]}transformJoinAndGetResponse(t){const{type:e,is_installed:i=!1,is_layer_restricted:s=!1,is_install_screen:o=!1,is_can_quit:n=!1,webview_url:a}=t.app;return{isInstalled:i,isInstallScreen:o,isLayerRestricted:s,canRunInLayer:this.appsLayerAvailabilityCheckerService.check({type:e,isInstalled:i,isInstallScreen:o,isLayerRestricted:s}),launchParams:{is_can_quit_vk_app:n},url:a,appAccessToken:t.app_access_token}}constructor(t,e){this.appApiConfigService=t,this.appsLayerAvailabilityCheckerService=e,(0,o.l_)(this)}}y=(0,s.Cg)([a.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===g.V?Object:g.V,void 0===_.X?Object:_.X])],y);class f{prepareLaunchParams(t,e){const[i,s]=this.appDataConfigMappingService.transformSecondaryLaunchParams(t),{bridge_methods_to_be_logged:o,group_whitelist_scopes:n,whitelist_scopes:a,allowed_origin_regexp:r,author_name:d,is_app_hide_controls_in_layer:c,is_app_force_close_control_in_layer:l,is_in_bookmark:h,is_clipboard_write_available:p}=s,{orderId:u,itemId:g,confirmOrder:_}=e||{};return{securityHash:i,launchParams:s,bridgeMethodsToBeLogged:o||[],groupWhitelistScopes:n?.join(",")||"",whitelistScopes:a?.join(",")||"",allowedOriginRegexp:r,orderParams:{orderId:u,itemId:g,confirmOrder:_},authorName:d,hideControlsInLayer:c,forceCloseControlInLayer:l,isInBookmark:h,isClipboardWriteAvailable:p}}async loadSecondaryLaunchParams(t,e){const i=await this.appsApi.getLaunchSecondaryParams({app_id:t,make_order_hash:e?.makeOrder,confirm_order_hash:e?.confirmOrder,confirm_miniapp_order_hash:e?.confirmMiniAppOrder,order_id:e?.orderId},{maxRetries:0});return this.prepareLaunchParams(i,e)}constructor(t,e){this.appsApi=t,this.appDataConfigMappingService=e,(0,o.l_)(this)}}f=(0,s.Cg)([a.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===c.V?Object:c.V,void 0===y?Object:y])],f);class S{set(t,e){this.appsInstallCache.set(t,e)}getAppData(t){const e=this.appsInstallCache.get(t);if(!e?.appData)return null;return Date.now()-e.appData.loadTimestamp<p.sn?e.appData:null}getCachedUrl(t){const e=this.appsInstallCache.get(t);return e?.url}delete(t){this.appsInstallCache.delete(t)}constructor(){this.appsInstallCache=new Map,(0,o.l_)(this)}}S=(0,s.Cg)([a.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],S);var w=i(697518),b=i(357543);const P=["id","title","iframe_settings","rights","need_policy_confirmation","is_vkui_internal","is_calls_available","type","author_owner_id","author_url","is_recommended","is_favorite","are_notifications_enabled","icon_139","icon_278","icon_150","profile_button_available","is_button_added_to_profile","available_methods","sdk_methods","is_mini_app_flow","is_widescreen","placeholder_info","splash_screen","is_badge_allowed","mobile_controls_type","support_url","is_need_to_show_unverified_screen_on_launch","is_need_to_show_launch_screen","is_plugin","screen_orientation","section","genre","downloadable_game_available_platforms","launch_screen_action_button","launch_screen_app_users","is_installed","is_layer_restricted","is_install_screen","is_trusted","screenshots","legal_documents","description","screen_name","author_group_info","legal_documents","is_iframe_mode","launch_screen_video","my_tracker_timespent_counter_id","favicon","is_app_potentially_have_similar","is_vk_pay_disabled","without_header","without_footer","manage_link","is_splash_screen_enabled","launch_screen_action_placeholder","mini_apps_web_call_api_form_data","track_code"],A=["type","is_installed","is_layer_restricted","is_install_screen","is_can_quit","webview_url"];class k{static manageAppLoadState(){return function(t,e,i){const s=t[e];i.value=async function(t,e){const{appId:i}=t;let o=null;this.setAppState(i,{appData:o});try{const n=this.instalCache.getAppData(i);if(n)e?.({appData:n});else{const n=this.instalCache.getCachedUrl(i);o=await s.call(this,t,e),o&&n&&Object.assign(o,{url:n})}this.setAppState(i,{appData:n??o}),this.instalCache.delete(i)}catch(t){throw console.error(`Error loading app data for appId ${i}:`,t),t}return o}}}async requestApiMethod(t,e,i){const s={...i,grouping:!1},o=(0,u.X6)(e),a=await this.apiClient.request(t,o,s),{response:r,error:d=null,execute_errors:c=null}=(0,u.vA)(a)?a:{response:a};if(null==r){if(d||c)throw d||c;throw new w.J({error_code:n.OQ.UNKNOWN,error_reason:"Empty api response"})}return{response:r}}async loadApp({appId:t,loadSecondaryParams:e,query:i,ref:s,openGameCardEventData:o,launchScreenParams:n},a){const r=[this.appsApi.getApp({app_id:t,extended:1,ref:s,app_fields:P.join(","),open_game_card_event_data:JSON.stringify(o),launch_screen_params:n&&JSON.stringify({loc:n.loc||"",install_community_app:Boolean(n.installCommunityApp)})},{grouping:!this.userEnv.partConfigEnabled("frontend.apps_spa_execute_disabled_for_launch")})];e&&r.push(this.appsSecondaryParamsService.loadSecondaryLaunchParams(t,{makeOrder:i?.[p.r9],confirmOrder:i?.[p.jP],confirmMiniAppOrder:i?.[p.$X],orderId:(0,b.K)(i?.[p.OE]),itemId:i?.[p.tX]}));const[d,c]=await Promise.all(r),l=d?.items?.[0];l&&a?.({appResponse:l});const h=l?this.appDataConfigMappingService.transformAppResponse(l,this.authService.userId):null;return h&&c&&Object.assign(h,c),h}setAppState(t,e){this.apps.set(t,e)}async loadAppUrl({appId:t,originUrl:e,ref:i,ownerId:s},o){try{const n={app_id:t,ref:i,url:e,owner_id:s,launch_data:JSON.stringify(o),track_code:o.track_code},{view_url:a,app_access_token:r}=await this.appsApi.getEmbeddedUrl(n,{grouping:!this.userEnv.partConfigEnabled("frontend.disable_get_embedded_url_grouping")});return a&&this.updateAppData(t,{url:a,appAccessToken:r}),a}catch(e){throw console.error(`Failed to fetch embedded URL for appId ${t}: `,e),e}}async getApp(t){const e=this.getAppState(t.appId);return e?e.appData:this.loadApp(t)}async installApp({appId:t,launchQueryData:e={},quietInstall:i=!1,needSettings:s,launchEventData:o}){const{request_id:n,request_key:a,ref:r,tс:d}=e,{track_code:c=d,ref:l=r}=o??{};try{const e={app_id:t,need_settings:i?1:s,request_id:n?Number(n):void 0,request_key:a,track_code:c,ref:l,app_fields:A.join(",")};o&&Object.assign(e,{launch_data:JSON.stringify(o)});const r=await this.appsApi.joinAndGet(e,{grouping:!this.userEnv.partConfigEnabled("frontend.apps_spa_execute_disabled_for_launch")}),d=this.getAppState(t),{layer:h,launchParams:p={}}=d?.appData??{},{launchParams:u,...g}=this.appDataConfigMappingService.transformJoinAndGetResponse(r),_={...g,launchParams:{...p,...u}};this.updateAppData(t,_);const{url:m,canRunInLayer:v}=g;return h&&!v&&d?.appData&&this.instalCache.set(t,{appData:{...d.appData,..._,layer:!1,isInstallScreen:!1,isNeedToShowLaunchScreen:!1},url:m}),m||this.errorLogger.log(new Error("Empty url from apps.joinAndGet")),r}catch(e){throw console.error(`Failed to install app for appId ${t}: `,e),e}}getAppState(t){return this.apps.get(t)??null}updateAppData(t,e){const i=this.getAppState(t),s=i?.appData;return i&&s&&(Object.assign(s,e),this.apps.set(t,{...i,appData:s})),s}getAppConfigQuery({isGame:t,isMiniAppFlow:e},i){return t&&!e?i:{}}getRecommendedApps(t){const e=this.getAppState(t);return e?.appData?.recommendedApps}getActionMenuBanner(t){const e=this.getAppState(t);return e?.appData?.actionMenuBanner}deleteApp(t){this.apps.delete(t)}addAppToGroup({appId:t,groupId:e}){return this.appsApi.addToGroup({app_id:t,group_id:e})}async getAppInstallScreenForAnonym(t){const{app:e}=await this.appsApi.getInfoAnonym({app_id:t});if(e){const i=this.appDataConfigMappingService.transformAppResponse({is_installed:!1,is_install_screen:!0,is_layer_restricted:!1,...e},this.authService.userId);this.setAppState(t,{appData:i})}return e}constructor(t,e,i,s,n,a,r,d){this.appDataConfigMappingService=t,this.apiClient=e,this.authService=i,this.appsApi=s,this.userEnv=n,this.appsSecondaryParamsService=a,this.errorLogger=r,this.instalCache=d,this.apps=new Map,(0,o.l_)(this)}}(0,s.Cg)([k.manageAppLoadState(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",["undefined"==typeof LoadAppProps?Object:LoadAppProps,Function]),(0,s.Sn)("design:returntype",Promise)],k.prototype,"loadApp",null),k=(0,s.Cg)([a.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===y?Object:y,void 0===r.Q?Object:r.Q,void 0===d.u?Object:d.u,void 0===c.V?Object:c.V,void 0===l.J?Object:l.J,void 0===f?Object:f,void 0===h.v?Object:h.v,void 0===S?Object:S])],k)},69382:(t,e,i)=>{i.d(e,{$X:()=>a,OE:()=>r,Rq:()=>c,jP:()=>n,r9:()=>o,sn:()=>l,tX:()=>d});var s=i(878136);const o="make_order",n="confirm_order",a="confirm_miniapp_order",r="order_id",d="item_id",c={[s.Z.ANY]:void 0,[s.Z.LANDSCAPE]:"landscape",[s.Z.PORTRAIT]:"portrait"},l=9e5},101922:(t,e,i)=>{i.d(e,{Vv:()=>_,X6:()=>r,YB:()=>c,Zl:()=>l,iN:()=>h,lq:()=>u,nB:()=>g,st:()=>v,vA:()=>d,w:()=>m,xr:()=>p});var s=i(365815),o=i(697518),n=i(878136),a=i(69382);function r(t){return Object.entries(t).reduce(((t,[e,i])=>{try{return{...t,[e]:"object"==typeof i?JSON.stringify(i):i}}catch{throw new o.J({error_code:s.OQ.INVALID_PARAMS,error_reason:`Param "params[${e}]" should be a valid json`})}}),{})}function d(t){return e=t,"[object Object]"===Object.prototype.toString.call(e)&&"execute_errors"in t;var e}function c({type:t}){return"app"===t}function l({type:t}){return"game"===t}function h({type:t}){return"html5_game"===t}function p(t){return l(t)||h(t)}function u({type:t}){return"mini_app"===t}function g({type:t}){return"community_app"===t}function _(t){const e=t.screen_orientation??n.Z.ANY;return a.Rq[e]}function m(t){const e={defaultIcon:t.icon_278||t.icon_150||t.icon_139,isGame:p(t)};return t.splash_screen&&(e.animatedIcon={src:t.splash_screen.url??"",enableAnimation:t.splash_screen.is_animated??!1,backgroundColor:t.splash_screen.background_color??""}),e}function v(t){return t.is_need_to_show_launch_screen?{shown:!0,appId:t.id,rights:t.rights??[],appImage:t.icon_278||t.icon_150||t.icon_139,title:t.title,isUnverified:!!t.is_need_to_show_unverified_screen_on_launch,isPlugin:!!t.is_plugin,isGame:p(t),friends:t.launch_screen_app_users,actionButton:t.launch_screen_action_button,downloadableGameAvailablePlatforms:t.downloadable_game_available_platforms,genre:t.genre||t.section,screenshots:t.screenshots,description:t.description,authorGroupInfo:t.author_group_info,promoVideo:t.launch_screen_video,hasSimilarApps:t.is_app_potentially_have_similar,needSettings:t.rights?.reduce?.(((t,{mask:e})=>t|e),0),actionPlaceholder:t.launch_screen_action_placeholder}:{shown:!1}}},878136:(t,e,i)=>{i.d(e,{Z:()=>o,y:()=>s});var s=function(t){return t[t.DIRECT_GAME=0]="DIRECT_GAME",t[t.VK_APP=1]="VK_APP",t}({}),o=function(t){return t[t.ANY=0]="ANY",t[t.LANDSCAPE=1]="LANDSCAPE",t[t.PORTRAIT=2]="PORTRAIT",t}({})},357543:(t,e,i)=>{i.d(e,{BN:()=>h,K:()=>l,Sm:()=>c,TO:()=>a,V:()=>r,h_:()=>n,s_:()=>d});var s=i(697518),o=i(365815);const n=t=>Object.entries(t).reduce(((t,[e,i])=>(i&&(t[e]=i),t)),{}),a=({domain:t,pathname:e,query:i,hash:s})=>{const o=new URL(`https://${t}${e}`);return o.search=new URLSearchParams(i).toString(),o.hash=s??"",o.toString()},r=(t,e="")=>{try{const i=new URL(t),s=i.searchParams.get("hash")||i.searchParams.get("app_hash")?"":i.hash||e;return i.hash=s,{url:i.toString(),hash:s}}catch{throw new s.J({error_code:o.OQ.CUSTOM,error_reason:"Invalid webview url"})}},d=({height:t,width:e,isLoading:i,defaultHeight:s,isOverlayActive:o,isLayer:n})=>{const a={};return i?(a.height=s,a.minHeight=s,a):(t&&n&&o&&(a["--layer-height"]=`${t}px`),t&&!o&&(a.height=t,a.maxHeight=t),e&&(a.width=e,a.minWidth=e),a)},c=({iframeSettings:t,isDirectGame:e})=>{const i={border:0,overflow:"hidden",display:"block",colorScheme:"auto"};return e&&(i.backgroundColor=t?.background_color),i},l=t=>Number.isNaN(Number(t))?void 0:Number(t),h=({...t})=>(Object.keys(t).forEach((e=>void 0===t[e]&&delete t[e])),t)},322809:(t,e,i)=>{i.d(e,{c:()=>a});var s=i(331635),o=i(42107),n=i(820282);class a extends n.S{get namespace(){return"adsint"}constructor(...t){super(...t),this.getHideAdReasons=this.makeMethod("getHideAdReasons"),this.hideAdBlock=this.makeMethod("hideAd"),this.registerAdEvents=this.makeMethod("registerAdEvents"),this.getPartnerProgramStatus=this.makeMethod("getPartnerProgramStatus")}}a=(0,s.Cg)([o.z8.global()],a)},951609:(t,e,i)=>{i.d(e,{g:()=>a});var s=i(331635),o=i(820282),n=i(42107);class a extends o.S{get namespace(){return"catalog"}constructor(...t){super(...t),this.getSearchTop=this.makeMethod("getSearchTop"),this.getSearchAll=this.makeMethod("getSearchAll"),this.getAudio=this.makeMethod("getAudio"),this.getAudioArtist=this.makeMethod("getAudioArtist"),this.getAudioCurator=this.makeMethod("getAudioCurator"),this.getAudioSearch=this.makeMethod("getAudioSearch"),this.getGroups=this.makeMethod("getGroups",!0),this.consumeBanner=this.makeMethod("consumeBanner"),this.getSearchGroups=this.makeMethod("getSearchGroups"),this.getSearchChannels=this.makeMethod("getSearchChannels"),this.getVideo=this.makeMethod("getVideo"),this.getVideoWithPrefetch=this.makeMethod("getVideo",!0),this.getSection=this.makeMethod("getSection"),this.getGroupsCollection=this.makeMethod("getGroupsCollection"),this.getBlockItems=this.makeMethod("getBlockItems"),this.getClassifieds=this.makeMethod("getClassifieds"),this.getAudioClips=this.makeMethod("getAudioClips"),this.getAudioClipsSearch=this.makeMethod("getAudioClipsSearch"),this.replaceBlocks=this.makeMethod("replaceBlocks"),this.getShortVideoSearch=this.makeMethod("getShortVideoSearch"),this.getVideoShowcase=this.makeMethod("getVideoShowcase"),this.getVideoSearchSubscriptions=this.makeMethod("getVideoSearchSubscriptions"),this.getVideoSearchWeb2=this.makeMethod("getVideoSearchWeb2"),this.getVideoSearch=this.makeMethod("getVideoSearch"),this.getSearchGames=this.makeMethod("getSearchGames"),this.getSearchMarket=this.makeMethod("getSearchMarket"),this.getPeopleSearch=this.makeMethod("getPeopleSearch"),this.getPeopleSearchWithPrefetch=this.makeMethod("getPeopleSearch",!0),this.getOwnerVideosSearch=this.makeMethod("getOwnerVideosSearch"),this.getSearchMiniApps=this.makeMethod("getSearchMiniApps"),this.getSearchStatuses=this.makeMethod("getSearchStatuses"),this.getStickers=this.makeMethod("getStickers"),this.getStickersSearch=this.makeMethod("getStickersSearch"),this.hideBlock=this.makeMethod("hideBlock")}}a=(0,s.Cg)([n.z8.global()],a)},878562:(t,e,i)=>{i.d(e,{L:()=>a});var s=i(331635),o=i(820282),n=i(42107);class a extends o.S{get namespace(){return"market"}constructor(...t){super(...t),this.add=this.makeMethod("add"),this.edit=this.makeMethod("edit"),this.addToCart=this.makeMethod("addToCart"),this.clearCart=this.makeMethod("clearCart"),this.get=this.makeMethod("get"),this.getAlbums=this.makeMethod("getAlbums"),this.getAlbumById=this.makeMethod("getAlbumById"),this.search=this.makeMethod("search"),this.searchServices=this.makeMethod("searchServices"),this.addAlbum=this.makeMethod("addAlbum"),this.editAlbum=this.makeMethod("editAlbum"),this.addToAlbum=this.makeMethod("addToAlbum"),this.removeFromAlbum=this.makeMethod("removeFromAlbum"),this.setAlbumItems=this.makeMethod("setAlbumItems"),this.getAbandonedCarts=this.makeMethod("getAbandonedCarts"),this.getAttendantItems=this.makeMethod("getAttendantItems"),this.getById=this.makeMethod("getById"),this.getButtons=this.makeMethod("getButtons"),this.getQuickMessages=this.makeMethod("getItemCardQuickMessages"),this.getItemCardWeb=this.makeMethod("getItemCardWeb"),this.getRecommendedItems=this.makeMethod("getRecommendedItems"),this.getItemsForAttach=this.makeMethod("getItemsForAttach"),this.getAdult18Plus=this.makeMethod("getAdult18Plus"),this.getCart=this.makeMethod("getCart"),this.getCartTotalQuantity=this.makeMethod("getCartTotalQuantity"),this.getCounters=this.makeMethod("getCounters"),this.getCommunityShopConditions=this.makeMethod("getCommunityShopConditions"),this.getEditUrl=this.makeMethod("getEditUrl"),this.getGroupActivityStatus=this.makeMethod("getGroupActivityStatus"),this.getItemReviews=this.makeMethod("getItemReviews"),this.getSettings=this.makeMethod("getSettings"),this.getServices=this.makeMethod("getServices"),this.getServicesSection=this.makeMethod("getServicesSection"),this.getServicesAlbums=this.makeMethod("getServicesAlbums"),this.delete=this.makeMethod("delete"),this.deleteAlbum=this.makeMethod("deleteAlbum"),this.deletePhoto=this.makeMethod("deletePhoto"),this.hideItem=this.makeMethod("hideItem"),this.removeFromCart=this.makeMethod("removeFromCart"),this.reorderAlbums=this.makeMethod("reorderAlbums"),this.setAsViewed=this.makeMethod("setAsViewed"),this.setDeliverySettings=this.makeMethod("setDeliverySettings"),this.setPaymentsSettings=this.makeMethod("setPaymentsSettings"),this.setSettings=this.makeMethod("setSettings"),this.setUserIsAdult=this.makeMethod("setUserIsAdult"),this.getSellerResponseTime=this.makeMethod("getSellerResponseTime"),this.getStorefront=this.makeMethod("getStorefront"),this.saveIntegrationSettings=this.makeMethod("saveIntegrationSettings"),this.reorderItems=this.makeMethod("reorderItems"),this.createCommunityReview=this.makeMethod("createCommunityReview"),this.getCommunityReview=this.makeMethod("getCommunityReview"),this.getOrderById=this.makeMethod("getOrderById"),this.getOrders=this.makeMethod("getOrders"),this.getGroupOrders=this.makeMethod("getGroupOrders"),this.getOrderPaymentUrl=this.makeMethod("getOrderPaymentURL"),this.updateCommunityReview=this.makeMethod("updateCommunityReview"),this.getCommunityReviews=this.makeMethod("getCommunityReviews"),this.deleteCommunityReview=this.makeMethod("deleteCommunityReview"),this.restore=this.makeMethod("restore"),this.restoreCommunityReview=this.makeMethod("restoreCommunityReview"),this.getComments=this.makeMethod("getComments"),this.deleteComment=this.makeMethod("deleteComment"),this.restoreComment=this.makeMethod("restoreComment"),this.createComment=this.makeMethod("createComment"),this.editComment=this.makeMethod("editComment"),this.getCommunityReviewFriends=this.makeMethod("getCommunityReviewFriends"),this.getCommunityReviewComments=this.makeMethod("getCommunityReviewComments"),this.createCommunityReviewComment=this.makeMethod("createCommunityReviewComment"),this.deleteCommunityReviewComment=this.makeMethod("deleteCommunityReviewComment"),this.restoreCommunityReviewComment=this.makeMethod("restoreCommunityReviewComment"),this.editCommunityReviewComment=this.makeMethod("editCommunityReviewComment"),this.getCheckoutSettings=this.makeMethod("getCheckoutSettings"),this.setCheckoutSettings=this.makeMethod("setCheckoutSettings"),this.getCheckoutDeliveryPoints=this.makeMethod("getCheckoutDeliveryPoints"),this.createOrder=this.makeMethod("createOrder"),this.createCheckoutOrder=this.makeMethod("createCheckoutOrder"),this.getItemsForReview=this.makeMethod("getItemsForReview"),this.getCategories=this.makeMethod("getCategories"),this.createItemReview=this.makeMethod("createItemReview"),this.updateItemReview=this.makeMethod("updateItemReview"),this.getItemReview=this.makeMethod("getItemReview"),this.deleteItemReview=this.makeMethod("deleteItemReview"),this.restoreItemReview=this.makeMethod("restoreItemReview"),this.getItemReviewComments=this.makeMethod("getItemReviewComments"),this.deleteItemReviewComment=this.makeMethod("deleteItemReviewComment"),this.restoreItemReviewComment=this.makeMethod("restoreItemReviewComment"),this.createItemReviewComment=this.makeMethod("createItemReviewComment"),this.getItemsByVideo=this.makeMethod("getItemsByVideo"),this.getCommunityReviewCreateConfig=this.makeMethod("getCommunityReviewCreateConfig"),this.getItemReviewCreateConfig=this.makeMethod("getItemReviewCreateConfig"),this.getCommunityExternalLinkDetails=this.makeMethod("getCommunityExternalLinkDetails"),this.hasPinnedCommunityReview=this.makeMethod("hasPinnedCommunityReview"),this.pinCommunityReview=this.makeMethod("pinCommunityReview"),this.unpinCommunityReview=this.makeMethod("unpinCommunityReview"),this.getAddresses=this.makeMethod("getAddresses"),this.getProperties=this.makeMethod("getProperties"),this.addPropertyVariant=this.makeMethod("addPropertyVariant"),this.editPropertyVariant=this.makeMethod("editPropertyVariant"),this.deletePropertyVariant=this.makeMethod("deletePropertyVariant"),this.addProperty=this.makeMethod("addProperty"),this.deleteProperty=this.makeMethod("deleteProperty"),this.editProperty=this.makeMethod("editProperty"),this.getDeliveryMethods=this.makeMethod("getDeliveryMethods"),this.changeDeliveryMethods=this.makeMethod("changeDeliveryMethods"),this.groupItems=this.makeMethod("groupItems"),this.ungroupItems=this.makeMethod("ungroupItems")}}a=(0,s.Cg)([n.z8.global()],a)},214310:(t,e,i)=>{i.d(e,{n:()=>a});var s=i(331635),o=i(42107),n=i(820282);class a extends n.S{get namespace(){return"places"}constructor(...t){super(...t),this.getById=this.makeMethod("getById"),this.search=this.makeMethod("search")}}a=(0,s.Cg)([o.z8.global()],a)},434178:(t,e,i)=>{i.d(e,{F:()=>a});var s=i(331635),o=i(820282),n=i(42107);class a extends o.S{get namespace(){return"polls"}constructor(...t){super(...t),this.getBackgrounds=this.makeMethod("getBackgrounds"),this.getAnswersLimit=this.makeMethod("getAnswersLimit"),this.create=this.makeMethod("create"),this.edit=this.makeMethod("edit"),this.getById=this.makeMethod("getById"),this.addVote=this.makeMethod("addVote"),this.deleteVote=this.makeMethod("deleteVote")}}a=(0,s.Cg)([n.z8.global()],a)},366161:(t,e,i)=>{i.d(e,{q:()=>a});var s=i(331635),o=i(820282),n=i(42107);class a extends o.S{get namespace(){return"tags"}constructor(...t){super(...t),this.add=this.makeMethod("add"),this.delete=this.makeMethod("delete"),this.getList=this.makeMethod("getList")}}a=(0,s.Cg)([n.z8.global()],a)},95763:(t,e,i)=>{i.d(e,{w:()=>n});var s=i(815287),o=i(364517);const n=(t,e,i)=>{const n=(0,s.useRef)(null),a=e??n,r=(0,o.K)(t);return(0,s.useEffect)((()=>{const t=a.current;if(!t)return;const e=new ResizeObserver((()=>{r()}));return e.observe(t,i),()=>{e.unobserve(t)}}),[i,a]),a}},844257:(t,e,i)=>{i.d(e,{Z:()=>s});const s=(t=new Date)=>Math.floor(t.getTime()/1e3)},710345:(t,e,i)=>{i.d(e,{n:()=>s});var s=function(t){return t.CoownersOpenModal="coowners_selection_modal_open",t.ClickSetUpInvitationsButton="coowners_setup_invitations_button_click",t}({})},257581:(t,e,i)=>{i.d(e,{X3:()=>o,ZX:()=>a,cQ:()=>l,ei:()=>c,fk:()=>d,u3:()=>u,uT:()=>n,wJ:()=>r,wh:()=>s,xl:()=>p,yH:()=>h});var s=function(t){return t.GeoPlace="geo_place",t.PhotosList="photos_list",t.Group="group",t.PostedPhoto="posted_photo",t.Goods="goods",t.Mask="mask",t.VideoPlaylist="video_playlist",t.Video="video",t.TextpostPublish="textpost_publish",t.Textpost="textpost",t.Textlive="textlive",t.SituationalTheme="situational_theme",t.PrettyCards="pretty_cards",t.Poll="poll",t.Podcast="podcast",t.Photo="photo",t.Page="page",t.Note="note",t.Narrative="narrative",t.MarketAlbum="market_album",t.Market="market",t.Link="link",t.Graffiti="graffiti",t.Geo="geo",t.DonutLink="donut_link",t.Doc="doc",t.Curator="curator",t.AudioPlaylist="audio_playlist",t.Audio="audio",t.Artist="artist",t.Article="article",t.PhotoAlbum="photo_album",t.OnlineBooking="online_booking",t.ActionButton="action_button",t}({}),o=function(t){return t.Open="open",t.Close="close",t.ClickToStoryIcon="click_to_story_icon",t.ClickToClipIcon="click_to_clip_icon",t.ClickToLiveIcon="click_to_live_icon",t.ClickToGalleryIcon="click_to_gallery_icon",t.OpenPostingFromPlus="open_posting_from_plus",t.ClosePostingFromPlus="close_posting_from_plus",t.ClickToPlus="click_to_plus",t.ClickToMore="click_to_more",t.ClickToTextlive="click_to_textlive",t.ClickToLive="click_to_live",t.ClickToGallery="click_to_gallery",t.ClickToStory="click_to_story",t.ClickToClip="click_to_clip",t.EditPublishedPost="edit_published_post",t.EditPostponedPost="edit_postponed_post",t.GoStage1="go_stage_1",t.GoStage2="go_stage_2",t.ClickArticleCreationButton="click_article_creation_button",t}({}),n=function(t){return t.OpenMusic="open_music",t.OpenMyPhoto="open_my_photo",t.OpenAlbum="open_album",t.OpenMarksAll="open_marks_all",t.OpenMyVideo="open_my_video",t.OpenPlaylists="open_playlists",t.OpenDoc="open_doc",t.OpenPoll="open_poll",t.OpenProduct="open_product",t.OpenPlace="open_place",t.OpenFile="open_file",t.SelectPhotoCard="select_photo_card",t.OpenService="open_service",t.SelectionModeProfile="selection_mode_profile",t.SelectionModeCommunity="selection_mode_community",t.ChangePhotoSlide="change_photo_slide",t.ClickToArticle="click_to_article",t.OpenPicker="open_picker",t.ExpandText="expand_text",t.OpenPhoto="open_photo",t.OpenVideo="open_video",t.MusicPreview="music_preview",t.ProductPhotoSelect="product_photo_select",t.ProductPhotoSwipe="product_photo_swipe",t.OpenActionButton="open_action_button",t.OpenGallery="open_gallery",t.ClickToAddFile="click_to_add_file",t.ShowProductErrorMsg="show_product_error_msg",t.ShowMusicErrorMsg="show_music_error_msg",t.TransitionToButtonDetails="transition_to_button_details",t}({}),a=function(t){return t.DeleteAttach="delete_attach",t.AttachPhoto="attach_photo",t.AttachVideo="attach_video",t.AttachMusic="attach_music",t.AttachMyPhoto="attach_my_photo",t.AttachMyVideo="attach_my_video",t.AttachPlaylists="attach_playlists",t.AttachDoc="attach_doc",t.AttachPoll="attach_poll",t.AttachProduct="attach_product",t.AttachAlbum="attach_album",t.AttachArticle="attach_article",t.AttachPlace="attach_place",t.AttachClip="attach_clip",t.AttachFile="attach_file",t.DeleteAttachPhoto="delete_attach_photo",t.DeleteAttachMyPhoto="delete_attach_my_photo",t.DeleteAttachVideo="delete_attach_video",t.DeleteAttachMyVideo="delete_attach_my_video",t.AttachPlaceRecom="attach_place_recom",t.DeleteAttachPlace="delete_attach_place",t.DeleteAttachMusic="delete_attach_music",t.DeleteAttachPoll="delete_attach_poll",t.DeleteAttachAlbum="delete_attach_album",t.DeleteAttachFile="delete_attach_file",t.ProductSelect="product_select",t.ProductDelete="product_delete",t.AttachActionButton="attach_action_button",t.DeleteActionButton="delete_action_button",t}({}),r=function(t){return t.Zoom="zoom",t.RatioChange="ratio_change",t.SelectAuthor="select_author",t.ChangeAuthor="change_author",t.ChangePrivacy="change_privacy",t.SelectPostponed="select_postponed",t.ChangePostponed="change_postponed",t.SelectSubjects="select_subjects",t.ChangeSubjects="change_subjects",t.OpenSettings="open_settings",t.CreateCopyright="create_copyright",t.AttachCopyright="attach_copyright",t.TurnOnNotifications="turn_on_notifications",t.TurnOffNotifications="turn_off_notifications",t.AdTurnOn="ad_turn_on",t.AdTurnOff="ad_turn_off",t.ShowDonsOnly="show_dons_only",t.ShowAll="show_all",t.DonsPostLifetimeChange="dons_post_lifetime_change",t.ToCarousel="to_carousel",t.ToCarouselAuto="to_carousel_auto",t.ToGrid="to_grid",t.OpenPostponed="open_postponed",t.OpenPrivacy="open_privacy",t.ChangeDonutPrivacy="change_donut_privacy",t.ChangeComments="change_comments",t.ChangeNotifications="change_notification",t.ClickToAdvertisingMark="click_to_advertising_mark",t}({}),d=function(t){return t.ShowArticleCreationButton="show_article_creation_button",t}({}),c=function(t){return t.OpenDraft="open_draft",t.DeleteDraft="delete_draft",t.SaveDraft="save_draft",t}({}),l=function(t){return t.Profile="profile",t.Feed="feed",t.Community="community",t.Wall="wall",t.Group="group",t.Posting="posting",t.PostingAttachPhoto="posting_attach_photo",t.PostingAttachPhotoProfile="posting_attach_photo_profile",t.PostingAttachPhotoCommunity="posting_attach_photo_community",t.PostingAttachMusic="posting_attach_music",t.PostingAttachVideo="posting_attach_video",t.PostingAttachVideoProfile="posting_attach_video_profile",t.PostingAttachVideoCommunity="posting_attach_video_community",t.PostingAttachDocument="posting_attach_document",t.PostingAttachPlace="posting_attach_place",t.PostingAttachPlaylist="posting_attach_playlist",t.PostingAttachPoll="posting_attach_poll",t.PostingAttachGood="posting_attach_good",t.PostingAttachArticle="posting_attach_article",t.PostingAttachArticleProfile="posting_attach_article_profile",t.PostingAttachArticleCommunity="posting_attach_article_community",t.PostingAttachAlbum="posting_attach_album",t.PostingAttachAlbumProfile="posting_attach_album_profile",t.PostingAttachAlbumCommunity="posting_attach_album_community",t.PostingSettings="posting_settings",t.POSTINGTIMEDIALOG="POSTING_TIME_DIALOG",t.PostingCreateCustomPoster="posting_create_custom_poster",t.PostingCloseFriendsSelector="posting_close_friends_selector",t.Posting1="posting_1",t.Posting2="posting_2",t.PostingAttachProductPhoto="posting_attach_product_photo",t.PostingPhotoViewer="posting_photo_viewer",t.PostingAttachProduct="posting_attach_product",t.DraftsList="drafts_list",t.FeedLikes="feed_likes",t.FeedComments="feed_comment",t.FeedCustomListRecent="feed_custom_list_recent",t.FeedPhotos="feed_photos",t.FeedUpdates="feed_updates",t.FeedPhotosRecent="feed_photos_recent",t.FeedRecommended="feed_recommended",t.FeedRecent="feed_recent",t.FeedTop="feed_top",t.FeedSearch="feed_search",t.FeedFriendsRecent="feed_friends_recent",t.FeedGroupsRecent="feed_groups_recent",t}({}),h=function(t){return t.Feed="feed",t.FeedPlusButton="feed_plus_button",t.GroupWallButton="group_wall_button",t.Group="group",t.ProfilePlusButton="profile_plus_button",t.ProfileWallButton="profile_wall_button",t.ProfileFromPlus="profile_from_plus",t.Profile="profile",t.ChannelWriteBarButton="channel_write_bar_button",t.PostThreeDotMenuEditItem="post_three_dot_menu_edit_item",t.TextLiveButton="text_live_button",t.Other="other",t.GroupPlusButton="group_plus_button",t.ListEditDraft="list_edit_draft",t.ListEditDraftThreeDots="list_edit_draft_three_dots",t.ListDeleteDraftThreeDots="list_delete_draft_three_dots",t.GroupFeedEditPostponed="group_feed_edit_postponed",t.GroupFeedEditDraft="group_feed_edit_draft",t.GroupWallEditPostponed="group_wall_edit_postponed",t.GroupWallEditDraft="group_wall_edit_draft",t.ClubFeedPrepareSuggested="club_feed_prepare_suggested",t.ClubWallPrepareSuggested="club_wall_prepare_suggested",t.ProfileFeedEditPostponed="profile_feed_edit_postponed",t.ProfileFeedEditDraft="profile_feed_edit_draft",t.ProfileWallEditPostponed="profile_wall_edit_postponed",t.ProfileWallEditDraft="profile_wall_edit_draft",t}({}),p=function(t){return t.Public="public",t.FriendsOnly="friends_only",t.BestFriendsOnly="best_friends_only",t}({}),u=function(t){return t.Open="open",t.OpenDraftsList="open_drafts_list",t.ExitDraft="exit_draft",t.CopyLink="copy_link",t.ExitPosting="exit_posting",t.SaveDraft="save_draft",t.SaveDraftChanges="save_draft_changes",t.PostDraft="post_draft",t.Delete="delete",t}({})},810638:(t,e,i)=>{i.d(e,{T:()=>s});var s=function(t){return t.ERROR="error",t.LOADING="loading",t.LOADED="loaded",t.NONE="none",t}({})},332855:(t,e,i)=>{i.d(e,{I8:()=>o,Mc:()=>s,gY:()=>r,q:()=>n,ss:()=>a});const s={REGULAR:"regular",POSTPONED:"postponed",SUGGESTED:"suggested",POST_DONUT:"post_donut"},o={PROFILE_INPUT:"profile_input",FEED_INPUT:"feed_input",COMMUNITY_INPUT:"community_input",PROFILE_BUTTON_PLUS:"profile_button_plus",PROFILE_WALL_BUTTON:"profile_wall_button",FEED_PLUS_BUTTON:"feed_plus_button",COMMUNITY_PLUS_BUTTON:"community_plus_button",COMMUNITY_SUGGEST:"community_suggest",POST_THREE_DOT_MENU_EDIT_ITEM:"post_three_dot_menu_edit_item",OTHER:"other"},n={FILE_UPLOADING:"file_uploading",FILE_UPLOADING_ERROR:"file_uploading_error",PICKER_OPENING:"picker_opening",PICKER_ATTACHMENT_ATTACHING:"picker_attachment_attaching",POST_PUBLISHING_TIME_RANGE:"post_publishing_time_range",POST_PUBLISHING_ERROR:"post_publishing_error",ERROR:"error"},a={ALBUM:"album",DOCUMENT:"document",MARKET:"market",MUSIC:"music",PLACE:"place",PHOTO:"photo",PHOTO_VK:"photo_vk",POLL:"poll",TAKE_PHOTO:"take_photo",VIDEO:"video",VIDEO_VK:"video_vk"},r={PHOTO:"photo",VIDEO:"video",DOCUMENT:"document"}},99667:(t,e,i)=>{i.d(e,{N:()=>d});var s=i(221020),o=i(634164),n=i(495988),a=i(516427);const r="vkitContentTappable__tappable--I7Od8",d=({width:t,className:e,style:i,...d})=>{const c=t?(0,n.F)(t):{};return(0,s.Y)(a.SB4,{className:(0,o.$)(r,e),style:{...c,...i},...d})}},940372:(t,e,i)=>{i.d(e,{n:()=>r});var s=i(221020),o=i(638945),n=i(880414);const a="vkitContentTitles__subtitle--XA833",r=({title:t,subtitle:e})=>(0,s.FD)(s.FK,{children:[(0,s.Y)(n.b,{TypographyComponent:o.$j,level:"1",lines:1,children:t}),!!e&&(0,s.Y)(n.b,{TypographyComponent:o.tW,className:a,lines:1,children:e})]})},478147:(t,e,i)=>{i.d(e,{L:()=>r});var s=i(221020),o=i(634164);const n="vkitFakeIcon__root--HvZO2",a={16:"vkitFakeIcon__rootSize16--xTxyd",24:"vkitFakeIcon__rootSize24--YJPRh"},r=({size:t=12,className:e,style:i,...r})=>(0,s.Y)("span",{className:(0,o.$)(n,a[t],e),style:{...i,width:t,height:t},...r})},467950:(t,e,i)=>{i.d(e,{B:()=>_});var s=i(221020),o=i(634164),n=i(272057),a=i(516427),r=i(962644);const d="vkitDragAndDropInput__root--Ur4F3",c="vkitDragAndDropInput__rootStretched--fQw27",l="vkitDragAndDropInput__rootOverlay--za7NZ",h="vkitDragAndDropInput__rootVisible--WyRFz",p="vkitDragAndDropInput__in--nLsL3",u="vkitDragAndDropInput__rootHovered--hfYPM",g="vkitDragAndDropInput__input--0KhmY",_=({overlay:t,children:e,stretched:i,enableInteractive:_,...m})=>{const{fileInputId:v,fileInputRef:y,isFilesDragging:f,isDropZoneEntered:S}=(0,n.W)(m),w="data-testid"in m?m["data-testid"]:void 0,b=(0,s.FD)(s.FK,{children:[(0,s.Y)("div",{className:p,children:"function"==typeof e?e({active:S}):e}),(0,s.Y)(r.h,{Component:"input",getRootRef:y,className:g,zIndex:-1,tabIndex:-1,"aria-hidden":!0})]}),P=(0,o.$)(d,t&&l,i&&c,f&&h,S&&u);return _?(0,s.Y)(a.SB4,{Component:"label","data-for":v,className:P,htmlFor:v,hoverMode:"background",activeMode:"background","data-testid":w,hasHoverWithChildren:!0,children:b}):(0,s.Y)("div",{className:P,"data-for":v,"data-testid":w,children:b})}},407587:(t,e,i)=>{i.d(e,{q:()=>r});var s=i(221020),o=i(413621);const n="vkitGridImage__block--7JYgg",a="vkitGridImage__item--iwIko",r=({src:t,borderRadius:e="m",...i})=>{const r=t.slice(0,4);return(0,s.Y)(o._,{borderRadius:e,...i,children:(0,s.Y)("div",{className:n,"aria-hidden":!0,children:r.map((t=>(0,s.Y)("div",{className:a,style:{backgroundImage:`url(${t})`}},t)))})})}},961486:(t,e,i)=>{i.d(e,{d:()=>c});var s=i(221020),o=i(634164),n=i(516427);const a="vkitModalOutsideButton__root--7l8zP",r="vkitModalOutsideButton__rootHover--8JYDB",d="vkitModalOutsideButton__rootActive--ELrms",c=({ariaLabel:t,className:e,children:i,...c})=>(0,s.Y)(n.SB4,{"aria-label":t,className:(0,o.$)(a,"vkitInternalModalOutsideButton",e),hoverMode:r,activeMode:d,...c,children:i})},455172:(t,e,i)=>{i.d(e,{R:()=>x});var s=i(221020),o=i(634164),n=i(962514),a=i(815287),r=i(665473),d=i(495988),c=i(982444),l=i(99667),h=i(940372),p=i(124222),u=i(971084),g=i(551082),_=i(171994),m=i(200538),v=i(928959),y=i(413621),f=i(782536),S=i(799649),w=i(741509),b=i(407587);const P="vkitThumb__noCoverIcon--iEt6h",A="vkitThumb__content--Il06H",k="vkitThumb__contentCell--AuKfP",C="vkitThumb__control--SOrrP",I="vkitThumb__actions--VjfhW",E="vkitThumb__equalizer--oKFwW",L=({size:t,thumbs:e=[],active:i,buttonLabel:n,playing:a,playsLabel:r,countLabel:d,actions:c,onPlayPauseClick:l,controlClassName:h,equalizerClassName:L})=>{const T=t>=140,M=e.filter(Boolean).slice(0,4),O=M.length>0;return(0,s.FD)(y._,{size:t,noBorder:!O,children:[O?(0,s.Y)(b.q,{size:t,src:M}):(0,s.Y)(p.z,{className:P}),i&&(0,s.Y)(y._.Overlay,{theme:"dark",visibility:"always",children:(0,s.FD)(s.FK,{children:[(0,s.Y)("span",{className:E,children:(0,s.Y)(w.r,{playing:a,className:L,size:T?"stretched":"s"})}),c?(0,s.Y)(f.e,{gap:"s",align:"center",mode:"horizontal",className:(0,o.$)(I,h),children:c}):(0,s.Y)(S.K,{className:(0,o.$)(C,h),"data-testid":"play-pause-button",label:n,onClick:t=>{l&&((0,v.T)(t),l(t))},children:a?(0,s.Y)(u.S,{}):(0,s.Y)(g.G,{})}),(0,s.FD)("div",{className:A,children:[(0,s.FD)("div",{className:k,children:[(0,s.Y)(_.Y,{}),(0,s.Y)("span",{children:r})]}),(0,s.FD)("div",{className:k,children:[(0,s.Y)(m.o,{}),(0,s.Y)("span",{children:d})]})]})]})})]})},T="vkitMusicPlaylistItem__stretched--9sdpV",M="vkitMusicPlaylistItem__control--nopcN",O="vkitMusicPlaylistItem__equalizer--6QVqu",D="vkitMusicPlaylistItem__tappable--m7IV9",x=({size:t="m",title:e,subtitle:i,thumbs:p,thumbButtonLabel:u,hasThumbActivated:g,hasThumbPlaying:_,noOverlay:m,countLabel:v,playsLabel:y,href:f,onClick:S,onPlayPauseClick:w,stretched:b,actions:P,getRootRef:A})=>{const[k,C]=(0,r.L)(),I=(0,n.Z)(A,b?k:void 0),[E,x]=(0,a.useState)(!1),R=(0,d.K)({size:t,smallWidth:88,mediumWidth:112,largeWidth:118,extraLargeWidth:162});return(0,s.FD)(l.N,{getRootRef:I,className:(0,o.$)(D,b&&T),hasActive:!1,width:b?void 0:R.width,href:f,onClick:S,onPointerEnter:()=>x(!0),onPointerLeave:()=>x(!1),children:[(0,a.isValidElement)(p)?p:(0,s.Y)(L,{active:!m&&(g||E),buttonLabel:u,playing:_,thumbs:p,actions:P,size:C.width||R.width,onPlayPauseClick:w,countLabel:v,playsLabel:y,controlClassName:M,equalizerClassName:O}),(0,s.Y)(c.K,{size:8}),(0,s.Y)(h.n,{title:e,subtitle:i})]})}},205417:(t,e,i)=>{i.d(e,{o:()=>_});var s=i(221020),o=i(754694),n=i(634164),a=i(928959),r=i(364517),d=i(815287),c=i(638945),l=i(423654),h=i(788350),p=i(486526);const u="vkitPostText__root--IwXgK",g=({TypographyComponent:t=c.EY,chunks:e,viewerId:i,config:g,expanded:_,squareText:m,onShowMoreClick:v,renderShowMoreButton:y,className:f,children:S,onComputedExpandedChanged:w,...b})=>{const P=(0,d.useRef)(null),{lines:A,squareLines:k}=(t=>{const[e,i]=(0,d.useState)(0),[s,o]=(0,d.useState)(0);return(0,d.useEffect)((()=>{const e=t.current;if(!e)return;const s=(0,p.s)((()=>{const{offsetHeight:t,offsetWidth:s}=e,n=e.cloneNode(!1);n.innerHTML="<br>",e.appendChild(n);const a=n.offsetHeight;e.removeChild(n),i(Math.ceil(t/a)),o(Math.ceil(s/a))}),50),n=requestAnimationFrame((()=>{s()}));return window.addEventListener("resize",s),()=>{s.cancel(),cancelAnimationFrame(n),window.removeEventListener("resize",s)}}),[t]),{lines:e,squareLines:s}})(P),C=0<A&&A<g.cutThreshold+g.underCutThreshold,[I,E]=(0,d.useState)(_??C),L=m?k:g.cutThreshold,T=(0,r.K)(w??o.l);(0,d.useEffect)((()=>{void 0!==_&&E(_)}),[_]),(0,d.useEffect)((()=>{E(C),T(C)}),[C,T]);const M=(0,d.useMemo)((()=>e.map(((t,e)=>{switch(t.kind){case"Text":return(0,s.Y)(d.Fragment,{children:t.text},e);case"Email":return(0,s.Y)(l.N,{href:`mailto:${t.email}`,target:"_blank",children:t.email},e);case"Url":return t.isInternal?(0,s.Y)(l.N,{href:t.href,children:t.caption},e):(0,s.Y)(l.N,{href:t.href,target:"_blank",children:t.caption},e);case"Hashtag":return t.screenName?(0,s.Y)(l.N,{href:`/${encodeURIComponent(t.screenName)}?q=${encodeURIComponent(t.tag)}`,children:`${t.tag}@${t.screenName}`},e):(0,s.Y)(l.N,{href:`/feed?q=${encodeURIComponent(t.tag)}&section=search`,children:t.tag},e);case"Mention":const o=0===t.peerId?i:Math.abs(t.peerId);return(0,s.Y)(l.N,{href:`/${t.type}${o}`,children:t.displayName},e);case"ScreenNameMention":return(0,s.Y)(l.N,{href:`/${t.screenName}`,children:t.displayName?t.displayName:`@${t.screenName}`},e);case"LineBreak":return(0,s.Y)("br",{},e)}}))),[e,i]);return(0,s.Y)(t,{className:(0,n.$)(u,f),...b,children:(0,s.FD)(h.u,{getRef:P,mode:"inline",lines:L,expanded:I,expandElement:y?.((t=>{v?.(t),A<=g.fullPostThreshold&&((0,a.T)(t),E(!0))})),children:[M,S]})})},_=(0,d.memo)(g)},798980:(t,e,i)=>{i.d(e,{F:()=>v});var s=i(221020),o=i(634164),n=i(487510),a=i(815287),r=i(867129),d=i(516427),c=i(325159),l=i(590715);const h="vkitCarousel__root--5MHf5",p="vkitCarousel__carousel--G3kht",u="vkitCarousel__withOffset--fOYh0",g="vkitCarousel__item--1bokB",_="vkitCarousel__noVerticalPadding--NPXC5",m="vkitCarousel__counter--Ua9pM",v=Object.assign((({gap:t,gapOffset:e,spacing:i,children:d,showArrows:g,showCounter:_,align:v="center",onChange:y,slideIndex:f=0,className:S,borderRadius:w,dataRoles:b,...P})=>{const[A,k]=(0,a.useState)(f);(0,n.X)((()=>{k(f)}),[f]);const C=(0,a.useCallback)((t=>{k(t),y?.(t)}),[y]),I={"--carousel-gap":(0,r.j)(t),"--carousel-spacing":(0,r.j)(i),"--carousel-border-radius":(0,r.j)(w)};return(0,s.FD)("div",{style:I,className:h,"data-carousel-slide-index":A,"data-testid":"carousel",children:[_&&(0,s.FD)(c.R,{appearance:"overlay",size:"m",capsule:!0,className:m,"data-testid":"carousel-counter","data-role":b?.carouselCounter,children:[A+1,"/",d.length]}),(0,s.Y)(l.Z,{arrowSize:"m",align:v,onChange:C,showArrows:g,slideIndex:f,className:(0,o.$)(S,p,!!e&&u),slideWidth:`calc(100% - ${2*(e??i)-t}px)`,"data-role":b?.gallery,...P,children:d})]})}),{Item:({ratio:t,children:e,className:i,noVerticalPadding:n})=>t?(0,s.Y)(d.glH,{className:(0,o.$)(g,n&&_,i),ratio:t,children:e}):(0,s.Y)("div",{className:(0,o.$)(g,n&&_,i),children:e})})},751447:(t,e,i)=>{i.d(e,{h:()=>tt});var s=i(221020),o=i(634164),n=i(815287),a=i(838565),r=i(867129),d=i(996729),c=i(385687),l=i(978350),h=i(343578),p=i(122134),u=i(261097),g=i(372286),_=i(565667),m=i(37377),v=i(103265),y=i(461565),f=i(140249),S=i(108852),w=i(602694),b=i(616229);const P="vkitMediaGridImage__image--1vTw4",A="vkitMediaGridImage__stub--s7Tcv",k=({thumb:t,restrictionType:e,loading:i,dataRole:o})=>e||t?.url?(0,m.B)(e)?(0,s.Y)(g.C,{src:t?.url,restrictionType:e,className:P,overlay:!0,loading:i,"data-testid":"media-grid-image","data-role":o}):(0,s.Y)(b.b,{restrictionType:e,"data-testid":"media-grid-image-blocked"}):(0,s.Y)("div",{className:A,"data-testid":"media-grid-image-stub"}),C="vkitMediaGridItem__root--Fuut2",I=({size:t,ratio:e,children:i,className:a,attachment:r,onRestrictedClick:c,sortable:l,loading:h,dataRole:p})=>{const u={},{action:g,restriction:_,overlay:v,thumb:b}=r;(e||r.ratio)&&(u["--media-grid-ratio"]=String(e||r.ratio));const P=l?t=>(0,s.Y)(d.L.Item,{id:r.id,label:r.id,children:t.children},r.id):n.Fragment;return(0,s.Y)(P,{children:(0,s.Y)("div",{style:u,className:(0,o.$)(C,a),"data-testid":"media-grid-item",children:(0,s.FD)(S.k,{action:g,"data-role":g?p:void 0,children:[i||(0,s.Y)(k,{thumb:b,restrictionType:_?.type,loading:h,dataRole:g?void 0:p}),(0,m.B)(_?.type)&&v&&(0,s.Y)(w.C,{overlay:v,size:t,hasImage:Boolean(b?.url)}),_&&(0,f.d)({restriction:_,size:t,onRestrictedClick:c})&&(0,s.Y)(y.R,{size:t,restriction:_,onRestrictedClick:c})]})})})},E="vkitMediaGridSingle__rootBlur--GFdd4",L="vkitMediaGridSingle__itemRestrictedHeight--i8MS0",T="vkitMediaGridSingle__image--UXoAC",M="vkitMediaGridSingle__itemMaskImage--Z4avM",O="vkitMediaGridSingle__itemSingle--yEovm",D="vkitMediaGridSingle__itemHasNoHeightLimits--gcQY3",x=({style:t,className:e,background:i,attachments:n,useMaskImage:r,onRestrictedClick:d,maxContainerWidth:c,features:y,dataRole:f})=>{const S=(0,a.D)(),w=(0,v.q)(n[0],S),{restriction:b,ratio:P,thumb:A,hasNoHeightLimits:k,canExtendBackground:C}=w,x=(0,m.B)(b?.type);if(!(C&&x&&A&&P))return(0,s.Y)("div",{className:e,style:t,"data-testid":"media-grid",children:(0,s.Y)(I,{size:"single",attachment:w,className:O,onRestrictedClick:d,dataRole:f})});const R="gray_fields"===i||"black_fields"===i||"white_fields"===i,Y=!R,F=Y&&(A.height!==A.width||S)&&!(0,h.E)(P,l.w.WIDE),B=Y&&(S||(0,h.E)(P,l.w.HIGH)||(0,h.E)(P,l.w.WIDE)&&A.width<c||(0,h.E)(P,l.w.SQUARE)&&A.width<c||(0,h.E)(P,l.w.SQUARE)&&A.height!==A.width),N=t;return F&&(N["--media-grid-single-old-max-height"]=`${_.N}px`),(0,s.Y)("div",{style:N,className:(0,o.$)(e,Y&&E),"data-testid":"media-grid",children:(0,s.FD)(I,{size:"single",attachment:w,onRestrictedClick:d,className:(0,o.$)(O,F&&L,Y&&r&&M,(Y||k)&&D),dataRole:f,children:[R&&(0,s.Y)(u.i,{background:i,features:y}),B&&(0,s.Y)(p.U,{src:A.url,background:i,features:y}),Y&&(0,s.Y)(g.C,{src:A.url,className:T,restrictionType:b?.type,width:A.width||c,height:A.height||c,features:y}),R&&(0,s.Y)(g.C,{overlay:!0,src:A.url,restrictionType:b?.type,hasNoHeightLimits:k,width:A.width||c,height:A.height||c,features:y})]})})};var R=i(317708),Y=i(353014);const F=(t,e,i,s)=>{switch(t){case"single":return"single";case"two_items":return"big";case"triple":return i>0?s&&s>=l.w.WIDE?"small":"regular":"big";case"grid":return e>6?"regular":"big";case"two_rows":return e>=7&&i>1?"small":6===e||5===e&&i>1?"regular":"big"}},B="vkitMediaGridGrid__root--sDQ9h",N="vkitMediaGridGrid__itemGrid--CQsng",z=({attachments:t,className:e,style:i,sortable:n,loading:a,dataRole:r})=>{const d=9===t.length?3:2,c=Math.floor(t.length/d),h=Y.yY.includes(t.length)?[l.w.HIGH]:[],p={...i,"--media-grid-grid-items-in-row":String(c),"--media-grid-grid-item-ratio":String((0,R.LO)(t,h))};return(0,s.Y)("div",{style:p,className:(0,o.$)(e,B),"data-sortable-root":!0,"data-testid":"media-grid",children:t.map(((e,i)=>(0,s.Y)(I,{attachment:e,className:N,size:F("grid",t.length,i),sortable:n,loading:a,dataRole:r},e.id)))})},V="vkitMediaGridTriple__root--BDodB",U="vkitMediaGridTriple__item--1r9vy",G=({attachments:t,className:e,style:i,sortable:n,loading:a,dataRole:r})=>{const[d,c,l]=t,h={...i,"--media-grid-left-main-ratio":String(d.ratio),"--media-grid-right-top-ratio":String(c.ratio),"--media-grid-right-bottom-ratio":String(l.ratio)};return(0,s.FD)("div",{style:h,className:(0,o.$)(e,V),"data-sortable-root":!0,"data-testid":"media-grid",children:[(0,s.Y)(I,{attachment:d,className:U,size:F("triple",t.length,0,d.ratio),sortable:n,loading:a,dataRole:r}),(0,s.Y)(I,{attachment:c,className:U,size:F("triple",t.length,1,c.ratio),sortable:n,loading:a,dataRole:r}),(0,s.Y)(I,{attachment:l,className:U,size:F("triple",t.length,2,l.ratio),sortable:n,loading:a,dataRole:r})]})},j="vkitMediaGridTwoItems__root--EA9Cq",W="vkitMediaGridTwoItems__itemLeft--UUmzE",H="vkitMediaGridTwoItems__itemRight--MoGm6",$=({attachments:t,className:e,style:i,sortable:n,loading:a,dataRole:r})=>{const[d,c]=t,l={...i,"--media-grid-left-ratio":String(d.ratio),"--media-grid-right-ratio":String(c.ratio)};return(0,s.FD)("div",{style:l,className:(0,o.$)(e,j),"data-sortable-root":!0,"data-testid":"media-grid",children:[(0,s.Y)(I,{attachment:d,className:W,size:F("two_items",t.length,0),sortable:n,loading:a,dataRole:r}),(0,s.Y)(I,{attachment:c,className:H,size:F("two_items",t.length,1),sortable:n,loading:a,dataRole:r})]})},K="vkitMediaGridTwoRows__root--MigBP",q="vkitMediaGridTwoRows__item--ifTda",Q=({attachments:t,className:e,style:i,sortable:n,loading:a,dataRole:r})=>{const[d,c,...l]=t,h=(0,R.LO)([d,c]),p=(0,R.LO)(l),u={...i,"--media-grid-second-row-count":String(l.length),"--media-grid-first-row-ratio":String(h),"--media-grid-second-row-ratio":String(p)};return(0,s.FD)("div",{style:u,className:(0,o.$)(e,K),"data-sortable-root":!0,"data-testid":"media-grid",children:[(0,s.Y)(I,{attachment:d,className:q,size:F("two_rows",t.length,0),sortable:n,loading:a,dataRole:r}),(0,s.Y)(I,{attachment:c,className:q,size:F("two_rows",t.length,1),sortable:n,loading:a,dataRole:r}),l.map(((e,i)=>(0,s.Y)(I,{attachment:e,className:q,size:F("two_rows",t.length,i+2),sortable:n,loading:a,dataRole:r},e.id)))]})},J="vkitMediaGrid__root--jWEQR",X="vkitMediaGrid__compact--kWnrm",Z="vkitMediaGrid__rootFullWidth--xxFSH",tt=({features:t,background:e,attachments:i,useMaskImage:p,maxImageWidth:u,maxImageHeight:g=0,maxContainerWidth:_,onRestrictedClick:m,innerBorderRadius:v=2,wrapperBorderRadius:y=8,onSortChange:f,noSortAnimation:S,useBaseImageSize:w,loading:b,dataRole:P})=>{const A=(0,a.D)(),k=(0,n.useRef)(null),C=Boolean(f),I=(0,n.useMemo)((()=>(0,c.E)(i,{maxImageWidth:u,maxImageHeight:g,isHeightLimitEnabled:t.isHeightLimitEnabled,sortable:C,useBaseImageSize:w})),[i,u,g,t.isHeightLimitEnabled,C,w]),E=(0,n.useMemo)((()=>I.map((t=>({id:t.id,label:t.id})))),[I]),L=(0,o.$)(J,A&&X,t.isFullWidthEnabled&&Z),T={"--media-grid-border-radius-inner":(0,r.j)(v),"--media-grid-side-item-border-radius":(0,r.j)(v),"--media-grid-border-radius-wrapper":(0,r.j)(y)};if(1===I.length)return(0,s.Y)(x,{style:T,attachments:I,className:L,background:e,useMaskImage:p,onRestrictedClick:m,maxContainerWidth:_,features:t,dataRole:P});const M=(t=>{switch(t.length){case 2:return $;case 3:return G;case 4:case 9:return z;case 5:case 7:case 8:case 10:return Q;case 6:const e=(0,R.uZ)(t);return(0,h.E)(e,l.w.WIDE)?Q:z;default:return()=>null}})(I),O=f?({children:t})=>(0,s.Y)(d.L,{items:E,onSortChange:f,externRef:k,animation:S?0:150,children:(0,s.Y)("div",{ref:k,children:t})}):n.Fragment;return(0,s.Y)(O,{children:(0,s.Y)(M,{style:T,className:L,attachments:I,sortable:Boolean(f),loading:b,dataRole:P})})}},665888:(t,e,i)=>{i.d(e,{y:()=>a});var s=i(221020),o=i(494013),n=i(476230);const a=Object.assign((t=>(0,s.Y)(o.K,{...t})),{Crop:t=>(0,s.Y)(n.Q,{...t})})},68912:(t,e,i)=>{i.d(e,{P:()=>n});var s=i(221020),o=i(494013);const n=t=>(0,s.Y)(o.K,{"data-testid":"primary-attachment-video",...t})},476230:(t,e,i)=>{i.d(e,{Q:()=>R});var s=i(221020),o=i(754694),n=i(634164),a=i(377776),r=i(487510),d=i(364517),c=i(815287),l=i(838565),h=i(665473),p=i(978350),u=i(237582),g=i(187233),_=i(962644),m=i(461565),v=i(140249);const y=({containerWidth:t,containerHeight:e,crop:i,...s})=>{const o=i?.width??s.width,n=i?.height??s.height,a=o/n,r=t/e,d=((t,e)=>t===e||t<1&&e<1||t>1&&e>1)(r,a);return d?d&&(r>1&&r<=a||r<1&&r>=a)?Math.min(t,e)/Math.min(o,n):Math.max(t,e)/Math.max(o,n):Math.max(t,e)/Math.min(o,n)};var f=i(877248),S=i(37377),w=i(353014),b=i(103265),P=i(602694),A=i(261097),k=i(372286),C=i(108852);const I="vkitPrimaryAttachmentCrop__root--kzTEt",E="vkitPrimaryAttachmentCrop__rootAnimateChanges--LPWXS",L="vkitPrimaryAttachmentCrop__image--KELzF",T="vkitPrimaryAttachmentCrop__children--mIjYm",M="vkitPrimaryAttachmentCrop__rootAllAnimateChanges--vwcxJ",O="vkitPrimaryAttachmentCrop__interactiveWrapper--sN2fY",D="vkitPrimaryAttachmentCrop__noBorderRadius--srajr",x=({crop:t,width:e,height:i,containerWidth:s,containerHeight:o,photoAnimationDuration:n,autoCrop:a,hasPhotoPreviewCrop:r})=>{if(!t)return{};const{y:d,x:c}=t,l=y({width:e,height:i,containerWidth:s,containerHeight:s/(e/i)}),h=y({width:e,height:i,containerWidth:s,containerHeight:o,crop:t});let p=h/l;const u=(0,w._R)(s,o),g=e*l,_=i*l;let m=g,v=_;const f=(_*p-_)/2,S=(g*p-g)/2,b=g/_,P=(0,w._R)(g,_);let A=-1*d*h+f,k=-1*c*h+S;const C=(t,e)=>1+2*t/e;a&&("landscape"===u&&"portrait"===P&&(p=C(a.y,a.height),A=0,v=o,m=v/b),"portrait"===u&&"landscape"===P&&(p=C(a.x,a.width),k=0,m=s,v=m/b)),r&&("landscape"===P?p=C(t.x,t.width):"portrait"===P&&(p=C(t.y,t.height)));const I={"--photo-width":`${a?m:g}px`,"--photo-height":`${a?v:_}px`,"--photo-translate-x":`${k}px`,"--photo-translate-y":`${A}px`,"--photo-scale":String(p),"--photo-container-width":`${s}px`,"--photo-container-height":`${o}px`};return n&&(I["--photo-animation-duration"]=`${n}ms`),I},R=({ratio:t=p.w.SQUARE,restriction:e,sizes:i,maxImageWidth:w,actionTopButton:R,actionBottomButton:Y,overlay:F,action:B,onRestrictedClick:N,hasBlur:z,maxContainerWidth:V,crop:U,onCropChanged:G,animateRatioChange:j,photoLessThanContainerAllowed:W,animateCropChange:H,onPhotoTransitionEnd:$,photoAnimationDuration:K,noBorderRadius:q,useMaxImageWidth:Q,showAllImageAnimation:J,actionCenterButton:X,features:Z,children:tt,background:et,"data-testid":it,autoCrop:st,hasPhotoPreviewCrop:ot})=>{const nt=(0,l.D)(),[at,rt]=(0,c.useState)(U||null),dt=(0,S.B)(e?.type),[ct,lt]=(0,h.L)(),ht=(0,c.useRef)(!1),pt=(0,c.useRef)(t),ut=(0,c.useRef)(W),gt=(0,c.useMemo)((()=>(0,f.f)({sizes:i},{maxImageWidth:Q?w:Number.MAX_VALUE,isHeightLimitEnabled:!0})),[i,w,Q]),_t=(0,b.q)(gt,nt);let mt={"--photo-primary-ratio":`${t}`};const vt=gt.thumb?.width??1,yt=gt.thumb?.height??1,ft=(0,a.d)(st||U);(0,r.X)((()=>{ft&&rt(ft)}),[ft]);const St=(0,d.K)(G??o.l);if((0,c.useEffect)((()=>{const e=void 0!==at?.width,i=!e||Math.abs(Math.floor(at.width/at.height*100)-Math.floor(100*t))>1,s=lt.width,o=lt.height,n=y({width:vt,height:yt,containerWidth:s,containerHeight:o,crop:e?{width:at.width,height:at.height}:void 0}),a=i||!W&&(vt*n<s||yt*n<o);if(lt.width&&lt.height&&a){const e=(({width:t,height:e,containerWidth:i,containerHeight:s})=>{const o=y({width:t,height:e,containerWidth:i,containerHeight:s}),n=i/o,a=s/o;return{width:n,height:a,x:(t-n)/2,y:(e-a)/2}})({width:vt,height:yt,containerWidth:s,containerHeight:s/t});st?(rt(st),St(st)):(rt(e),St(e))}}),[vt,yt,lt.width,lt.height,at?.width,at?.height,St,t,W,st]),W!==ut.current&&(ut.current=W,ht.current=!W),t!==pt.current&&(ht.current=!0,pt.current=t),lt.width&&lt.height&&at){const{width:e}=lt;mt={...mt,...x({crop:at,containerWidth:e,containerHeight:e/t,width:vt,height:yt,photoAnimationDuration:H?K:void 0,autoCrop:!ot&&st?st:void 0,hasPhotoPreviewCrop:ot})}}const wt=H||j&&ht.current,bt=J&&wt;return(0,s.FD)("div",{className:(0,n.$)(I,q&&D,wt&&E,bt&&M),style:mt,ref:ct,onTransitionEnd:()=>{ht.current=!1},"data-testid":it,children:[!!et&&(0,s.Y)(A.i,{src:_t.thumb?.url,background:et,restrictionType:e?.type}),(0,s.Y)(_.h,{children:(0,s.FD)(C.k,{className:O,action:B,children:[dt&&_t.thumb&&at&&(0,s.Y)(k.C,{overlay:!0,Component:u.v,onTransitionEnd:H?$:void 0,className:L,src:_t.thumb.url,restrictionType:z?"restricted":e?.type,widthSize:lt.width||V,heightSize:lt.height||V,noBorder:!0,withTransparentBackground:!0,features:Z,children:(0,s.Y)("div",{className:T,children:tt})}),dt&&F&&(0,s.Y)(P.C,{overlay:F,size:"single"}),e&&(0,v.d)({restriction:e,onRestrictedClick:N})&&(0,s.Y)(m.R,{size:"single",restriction:e,onRestrictedClick:N}),!!R&&(0,s.Y)(_.h,{placement:"top-right",children:(0,s.Y)(g.i,{spacing:8,mode:"vertical",paddingTop:8,paddingBottom:8,children:R})}),!!Y&&(0,s.Y)(_.h,{placement:"bottom-right",children:(0,s.Y)(g.i,{spacing:8,mode:"vertical",paddingTop:8,paddingBottom:8,children:Y})}),!!X&&(0,s.Y)(_.h,{placement:"center",children:X})]})})]})}},526205:(t,e,i)=>{i.d(e,{h:()=>h});var s=i(221020),o=i(928959),n=i(815287),a=i(187233),r=i(180329),d=i(450103),c=i(138592);const l={stretched:.7,clamped:.5},h=({children:t,playbackControl:e,badgeMode:i="stretched",labels:h})=>{const p=(0,c.h)(),u=h||p.labels,g=(0,n.useRef)(null),[_,m]=(0,n.useState)(0),v={maxWidth:Math.min(_*l[i],_-32)};return(0,n.useLayoutEffect)((()=>{const t=g.current;if(!t)return;const e=t.offsetWidth;m(e)}),[]),(0,s.Y)(a.i,{paddingTop:0,paddingBottom:12,spacing:12,getRootRef:g,children:(0,s.FD)(r.s,{direction:"row",align:"end",noWrap:!0,justify:"space-between",children:[(0,s.Y)(r.s.Item,{flex:"fixed",children:(0,s.Y)(d.h,{value:v,children:(0,s.Y)("div",{onClick:o.T,children:t})})}),(0,s.Y)(r.s.Item,{flex:"grow",children:(0,s.FD)(r.s,{gap:12,direction:"column",justify:"end",align:"end",children:[u,(0,s.Y)("div",{onClick:o.T,children:e})]})})]})})}},748868:(t,e,i)=>{i.d(e,{r:()=>h});var s=i(221020),o=i(721126),n=i(772812),a=i(799649),r=i(999051);const d={s:"small",m:"regular"};function c({size:t,children:e,loading:i}){return i?(0,s.Y)(r.y,{size:d[t]}):e}const l={m:{size:28},s:{size:16,noPadding:!0}},h=({size:t="m",active:e,loading:i,SIdleIcon:r,SActiveIcon:d,MIdleIcon:h,MActiveIcon:p,...u})=>{const g=function({active:t,SIdleIcon:e,MIdleIcon:i,SActiveIcon:s,MActiveIcon:n,size:a="m"}){switch(a){case"s":return t?s:e;case"m":return t?n:i;default:return(0,o.S)(a)}}({active:e,size:t,SIdleIcon:r,SActiveIcon:d,MIdleIcon:h,MActiveIcon:p});return(0,s.Y)(c,{size:t,loading:i,children:(0,s.Y)(a.K,{"data-testid":"musicbadge-action",hoverMode:"opacity",activeMode:"opacity",...l[t],...u,children:(0,s.Y)(g,{className:(0,n.I)("color_icon_contrast")})})})}},818670:(t,e,i)=>{i.d(e,{f:()=>w});var s=i(748868),o=i(221020),n=i(767091),a=i(863238),r=i(634164),d=i(516427),c=i(772812),l=i(154767),h=i(413621);const p={s:20,m:32},u={s:n.K,m:a.Q};var g=i(815287),_=i(181508);const m="vkitFadeMask__root--gHaoG",v="vkitFadeMask__leftEdge--aOIWz",y="vkitFadeMask__hideLeftEdge--rAXdA",f=({children:t,visible:e,hideLeftEdge:i,leftEdgeHidingDuration:s=150})=>{const n=(0,g.useRef)(null),a=(0,g.useRef)(null);if((0,g.useEffect)((()=>{a.current&&(a.current.style.animation="none",(0,_.q)(a.current),a.current.style.animation="")}),[i]),!e)return t;const d={"--vkui_internal--fade-mask-left-edge-hiding-duration":`${s}`};return(0,o.Y)("div",{style:d,ref:n,className:m,children:(0,o.Y)("div",{ref:a,className:(0,r.$)(v,i&&y),children:t})})};var S=i(545069);const w={Action:s.r,Cover:({src:t,size:e,fallbackIconModifiers:i,...s})=>{const n=p[e],a=u[e],g=(0,d.Ln7)(n),_=(0,o.Y)(a,{width:g,height:g,className:(0,r.$)((0,c.I)("color_icon_secondary"),i)});return(0,o.Y)(l.Q,{value:"dark",children:(0,o.Y)(h._,{src:t,size:p[e],borderRadius:"l",fallbackIcon:_,draggable:"false",...s})})},FadeMask:f,FadedTicker:({children:t,mode:e,onHold:i,onResume:s,maxWidth:n,onFrameWidthUpdated:a,maskInvisible:r,...d})=>{const c=(0,g.useRef)(!1),[l,h]=(0,g.useState)("none"===e);return(0,o.Y)(f,{visible:!r,hideLeftEdge:l,children:(0,o.Y)(S.R,{mode:e,maxWidth:n,getActiveRef:c,onFrameWidthUpdated:t=>{a?.(t)},onFrameHidden:()=>{h(!0),i?.()},onResume:()=>{h(!1),s?.()},...d,children:t})})},Ticker:S.R}},450103:(t,e,i)=>{i.d(e,{V:()=>r,h:()=>a});var s=i(815287);const o={maxWidth:void 0},n=(0,s.createContext)(o),a=n.Provider,r=()=>{const t=(0,s.useContext)(n);return t||o}},545069:(t,e,i)=>{i.d(e,{R:()=>m});var s=i(221020),o=i(634164),n=i(364517),a=i(95763),r=i(815287),d=i(180329);var c=i(483175);const l={regular:5};function h({frameWidth:t,avgCharacterWidth:e,speed:i="regular"}){return{"--music-overlay-badge-ticker-tick-width":`-${t+12}px`,"--music-overlay-badge-ticker-tick-duration":`${t/(l[i]*e)}s`}}const p="vkitTicker__root--GncuR",u="vkitTicker__tickerSpace--JoGpL",g="vkitTicker__ticker--KxhQb",_="vkitTicker__tickerActive--CPFbV",m=({children:t,maxWidth:e,mode:i,speed:l="regular",onFrameWidthUpdated:m,onFrameHidden:v,onHold:y,onResume:f})=>{const S=(0,r.useRef)(null),w=(0,r.useRef)(null),[b,P]=(0,r.useState)(0),[A,k]=(0,r.useState)(0),{tickHeld:C,holdTick:I}=(({onHold:t,onResumed:e})=>{const[i,s]=(0,r.useState)(!1),o=(0,c.Y)((function(){s(!1),e?.()}),1500);return{tickHeld:i,holdTick:()=>{i||(s(!0),t?.(),o())}}})({onHold:y,onResumed:f});!function(t,e,i){(0,r.useEffect)((()=>{let s;const o=()=>{const n=t.current,a=e.current;if(n&&a){const t=n.getBoundingClientRect();if(a.getBoundingClientRect().right<=t.left)return void i()}s=requestAnimationFrame(o)};return s=requestAnimationFrame(o),()=>{cancelAnimationFrame(s)}}),[i,t,e])}(S,w,(()=>{v?.()}));const E=(0,n.K)((t=>{if(P(t),w.current){const e=w.current.innerText.length||w.current.textContent.length;k(Number(t/e))}m?.(t)}));(0,a.w)((()=>{w.current&&E(w.current.offsetWidth)}),w);const L=function({forceValue:t,frameWidth:e,tickHeld:i}){return null!=t?t:!(!e||i)}({forceValue:"none"!==i&&void 0,frameWidth:b,tickHeld:C}),T=Math.round(Math.min(b,e??b))||0;return(0,s.Y)("div",{className:p,style:{minWidth:T,maxWidth:e&&Math.min(T,e)},ref:S,children:(0,s.Y)("div",{className:u,children:(0,s.FD)(d.s,{style:h({frameWidth:b,avgCharacterWidth:A,speed:l}),className:(0,o.$)(g,L&&_),gap:12,margin:"none",onAnimationIteration:I,noWrap:!0,children:[(0,s.Y)("div",{ref:w,children:t}),L&&(0,s.Y)("div",{children:t})]})})})}},734223:(t,e,i)=>{i.d(e,{L:()=>o});var s=i(450103);function o(t){const e=(0,s.V)();return{maxWidth:t.maxWidth??e.maxWidth}}},765391:(t,e,i)=>{i.d(e,{o:()=>S});var s=i(221020),o=i(754694),n=i(634164),a=i(928959),r=i(962514),d=i(364517),c=i(815287),l=i(638945),h=i(423654),p=i(982444),u=i(782460),g=i(486526);const _="vkitPostText__root--f4OCK",m="vkitPostText__rootPointerMode--fMFH5",v="vkitPostText__zeroWidth--BqvHf",y="vkitPostText__redesignEnabled--yuPC0",f=({TypographyComponent:t=l.EY,chunks:e,viewerId:i,config:f,expanded:S,squareText:w,onShowMoreClick:b,renderShowMoreButton:P,className:A,children:k,onTextClick:C,hasPointerMode:I,onComputedExpandedChanged:E,onExpandChanged:L,onMentionHover:T,lineBreakSize:M=6,renderDisplayedText:O=t=>t,hashtagURL:D=t=>`/${t}`,hashtagMentionURL:x=(t,e)=>`/${e}@${t}`,persistLinesCountOnHide:R,getRootRef:Y,...F})=>{const B=(0,c.useRef)(null),N=(0,r.Z)(Y),{lines:z,squareLines:V}=((t,e,i)=>{const[s,o]=(0,c.useState)(0),[n,a]=(0,c.useState)(0);return(0,c.useEffect)((()=>{const s=e.current,n=t.current;if(!s||!n)return;let r=null;const d=()=>{const{parentElement:t,offsetHeight:e,offsetWidth:c}=s,l=t?.scrollHeight||e,h=0===l&&0===c;let p;h&&null===r&&(r=new IntersectionObserver((([t])=>{t.isIntersecting&&(d(),r?.disconnect(),r=null)})),r.observe(n)),i&&h||(p=parseInt(getComputedStyle(s).lineHeight,10),o(Math.ceil(l/p)),a(Math.ceil(c/p)))},c=(0,g.s)(d,50);d();const l=requestAnimationFrame((()=>{d()}));return window.addEventListener("resize",c),()=>{c.cancel(),cancelAnimationFrame(l),window.removeEventListener("resize",c),r?.disconnect()}}),[t,e,i]),{lines:s,squareLines:n}})(B,N,R),U=0<z&&(z<f.cutThreshold+f.underCutThreshold||w&&z<V),[G,j]=(0,c.useState)(S??U??!1),W=w?V:f.cutThreshold,H=t=>{j(t),L?.(t)},$=(0,d.K)(H),K=(0,d.K)(E??o.l);(0,c.useEffect)((()=>{void 0!==S&&$(S)}),[S,$]),(0,c.useEffect)((()=>{void 0===S&&($(U??!1),K(U??!1))}),[U,K,$,S]);const q=(0,c.useMemo)((()=>e.map(((t,e)=>{switch(t.kind){case"Text":return(0,s.Y)(c.Fragment,{children:O(t.text,{accented:!0})},e);case"Email":return(0,s.Y)(h.N,{href:`mailto:${t.email}`,target:"_blank",...t.additionalLinkProps,children:O(t.email)},e);case"Url":return t.isInternal?(0,s.Y)(h.N,{href:t.href,...t.additionalLinkProps,children:O(t.caption)},e):(0,s.Y)(h.N,{href:t.href,target:"_blank",rel:"nofollow noopener",...t.additionalLinkProps,children:O(t.caption)},e);case"Hashtag":const o=t.screenName?`${t.tag}@${t.screenName}`:t.tag,n=t.screenName?x(encodeURIComponent(t.screenName),encodeURIComponent(t.tag)):D(encodeURIComponent(t.tag));return(0,s.Y)(h.N,{"data-testid":"post-text-hashtag",href:n,...t.additionalLinkProps,children:O(o)},e);case"Mention":const a=0===t.peerId?i:Math.abs(t.peerId);return(0,s.Y)(h.N,{"data-testid":"post-text-mention",href:`/${t.type}${a}`,mention_id:`${t.type}${a}`,onMouseOver:T,...t.additionalLinkProps,children:O(t.displayName)},e);case"ScreenNameMention":return t.displayName?(0,s.Y)(h.N,{href:`/${t.screenName}`,...t.additionalLinkProps,children:O(t.displayName)},e):(0,s.FD)(c.Fragment,{children:["@",O(t.screenName)]},e);case"LineBreak":return"paragraph"===t.type?(0,s.FD)(p.K,{size:M,className:v,children:[(0,s.Y)("br",{})," "]},e):(0,s.Y)("br",{},e)}}))),[e,O,x,D,i,T,M]),Q=!G||(I??!1);return(0,s.Y)(t,{className:(0,n.$)(_,Q&&m,y,A),onClick:t=>{if(C?.(t,G),void 0!==S)return;const e=t.target instanceof Element&&"a"===t.target.tagName.toLowerCase();G||e||H(!0)},style:{"--post-text-line-break-size":`${M}px`},...F,children:(0,s.FD)(u.u,{getRootRef:B,getRef:N,mode:"inline",lines:W,expanded:G,expandElement:P?.((t=>{b?.(t),z<=f.fullPostThreshold&&((0,a.T)(t),H(!0))})),lineBreakSize:M,children:[q,k]})})},S=(0,c.memo)(f)},782460:(t,e,i)=>{i.d(e,{u:()=>P});var s=i(221020),o=i(754694),n=i(486526),a=i(634164),r=i(962514),d=i(364517),c=i(487510),l=i(815287),h=i(880414),p=i(343578);const u="vkitShowMoreText__root--PFmoM",g="vkitShowMoreText__rootExpanded--sezAa",_="vkitShowMoreText__after--5Ihfa",m="vkitShowMoreText__in--OVtdG",v="vkitShowMoreText__rootSingleLine--MMuiC",y="vkitShowMoreText__rootHasAfter--yYk0q",f="vkitShowMoreText__rootAfterLeft--4yHjV",S="vkitShowMoreText__rootDynamic--b2rST",w="vkitShowMoreText__text--imC4n",b={block:void 0,inline:"vkitShowMoreText__rootInline--Q7lEC"},P=({getRootRef:t,getRef:e,mode:i,lines:P=0,dynamic:C,expanded:I,expandElement:E,collapseElement:L,children:T,className:M,onExpandChange:O,lineBreakSize:D=6,...x})=>{const R=(0,r.Z)(e),Y=(0,r.Z)(t),F=(0,l.useRef)(null),B=(0,l.useRef)(null),N=(0,l.useRef)(!1),[z,V]=(0,l.useState)(I),[U,G]=(0,l.useState)(),[j,W]=(0,l.useState)(0),[H,$]=(0,l.useState)(0),[K,q]=(0,l.useState)(!1),[Q,J]=(0,l.useState)(0),[X,Z]=(0,l.useState)(0),[tt,et]=(0,l.useState)(P),it=(0,d.K)(O??o.l);(0,c.X)((()=>{et(P)}),[P]);const st=()=>{N.current=!0};(0,c.X)((()=>{V(I)}),[I]),(0,l.useEffect)((()=>{it(!!z)}),[it,z]),(0,l.useEffect)((()=>{if(C&&K&&!z){const{height:t=0}=B.current?.getBoundingClientRect()||{},{height:e=0}=Y.current?.getBoundingClientRect()||{};J(e-t)}}),[Y,K,C,z]),(0,l.useLayoutEffect)((()=>{if(!Y.current)return;const t=()=>{const t=Y.current,e=F.current,i=R.current,s=B.current;if(!e||!i)return;if(C&&t?.parentElement){const{height:e}=i.getBoundingClientRect(),{height:o}=t.getBoundingClientRect();q(e>o);const{width:n=0,height:a=0}=s?.getBoundingClientRect()||{};return W(n),void $(a)}const o=function(t){if(!t.length)return[];const e={},i=function(t){for(let e=0;e<t.length;e++){if(0===e)continue;const i=t[e],s=t[e-1];if(Math.abs(i.top-s.top)<4.5){const t=s.key??s.top;i.key=t,s.key=t}}return t.filter((({height:t})=>0!==t))}(t);for(const t of i){var s,o;const i=Math.floor(t.key??t.top),a=i>=0?`+${i}`:i,r=(s=e)[o=a]??(s[o]=t);var n;if(t.left>=r.left&&t.width>=r.width)(n=t).position||(n.position=0),t.position++,e[a]=t;t.left>r.left&&Math.floor(e[a].width)&&(e[a].width=r.width+t.width)}return Object.values(e)}(function(t){const e=document.createRange();e.selectNodeContents(t);const i=e.getClientRects(),s=[];for(const t of i){if(s.length>0){const e=s[s.length-1];if((0,p.E)(e.width,t.width)&&(0,p.E)(e.left,t.left)&&(0,p.E)(e.top,t.top))continue}s.push(t)}return s}(i)),n=function(t){if(!t.length)return 0;return Math.floor(t[t.length-1].y-t[0].y)}(o);if(q(o.length>P||n>i.getBoundingClientRect().height),z)return;const{width:a=0,height:r=0}=s?.getBoundingClientRect()||{};if(W(a),$(r),!P||P>=o.length)return;const{width:d=0}=t?.getBoundingClientRect()||{};if(P>1&&A(o[P-1],d,D))return et(P-1),Z(k(o,P-2,d,D)),void(!a||o[P-2].width+a>e.offsetWidth?G(void 0):G(o[P-2].width));Z(k(o,P,d,D)),!a||o[P-1].width+a>e.offsetWidth?G(void 0):G(o[P-1].width)},e=(0,n.s)(t,50),i=requestAnimationFrame((()=>{t()})),s=new ResizeObserver(e);return s.observe(Y.current),()=>{cancelAnimationFrame(i),s.disconnect()}}),[P,E,z,T,K]);const ot={"--vkit_internal--show_more_text_blur_size":"50px","--show-more-text-blur-dynamic-size":"20px","--show-more-text-after-space":U?`${U}px`:void 0,"--show-more-text-after-width":`${j}px`,"--show-more-text-after-height":`${H}px`,"--paragraph-count-before":`${X}`},nt=z?L:K&&E;return(0,s.FD)("div",{"data-testid":"showmoretext",ref:Y,className:(0,a.$)(u,b[i],z&&g,C&&S,K&&y,1===P&&v,void 0!==U&&f,M),style:ot,...x,children:[(0,s.Y)(h.b,{"data-testid":"showmoretext-in"+(z?"-expanded":""),getRootRef:F,className:(0,a.$)("vkitInternalShowMoreTextTextClamp",m),lines:z||C?0:tt,style:Q?{maxHeight:Q}:void 0,children:(0,s.Y)("div",{ref:R,className:w,onMouseDownCapture:st,onTouchStartCapture:st,onFocusCapture:()=>{z||(N.current?N.current=!1:V(!0))},children:T})}),Boolean(nt)&&(0,s.Y)("div",{"data-testid":"showmoretext-after",ref:B,onClick:()=>{void 0===I&&V((t=>!t))},className:_,children:nt})]})};function A(t,e,i){return!t.width||t.width===e&&Math.round(t.height)===i}function k(t,e,i,s){return t.slice(0,e).filter((t=>A(t,i,s)&&Math.round(t.height)===s)).length}},920329:(t,e,i)=>{i.d(e,{Y:()=>f});var s=i(221020),o=i(767091),n=i(863238),a=i(377641),r=i(906547),d=i(634164),c=i(516427),l=i(154767),h=i(413621),p=i(237582),u=i(962644),g=i(772812);const _="vkitCover__overlay--Mr6Rk",m="vkitCover__overlayItem--OPAGW",v={s:20,m:32},y={s:o.K,m:n.Q},f=({src:t,size:e,fallbackIconModifiers:i,overlayIconName:o,alt:n,...f})=>{const S=v[e],w=y[e],b=(0,c.Ln7)(S),P=(0,s.Y)(w,{width:b,height:b,className:(0,d.$)((0,g.I)("color_icon_secondary"),i)});return(0,s.Y)(l.Q,{value:"dark",children:(0,s.Y)(h._,{src:t,size:v[e],borderRadius:"l",fallbackIcon:P,draggable:"false",alt:n,...f,children:(0,s.Y)(p.v.OverlayItem,{placement:"center",className:m,visibility:"on-hover",children:(0,s.FD)(u.h,{mode:"after",centered:!0,className:_,children:[o&&"play"===o&&(0,s.Y)(a.Y,{className:(0,g.I)("color_icon_contrast")}),o&&"pause"===o&&(0,s.Y)(r.I,{className:(0,g.I)("color_icon_contrast")})]})})})})}},286788:(t,e,i)=>{i.d(e,{f:()=>D});var s=i(545069),o=i(221020),n=i(634164),a=i(721126),r=i(56471),d=i(799649),c=i(772812),l=i(999051);const h={s:"small",m:"regular"};function p({size:t,children:e,loading:i}){return i?(0,o.Y)(l.y,{size:h[t]}):e}const u="vkitAction__disabled--OH1pS",g={m:{size:28},s:{size:16,noPadding:!0}};var _=i(920329);const m="vkitFadeMask__root--iHcc5",v="vkitFadeMask__rootActivatedMask--RSnCL",y=({children:t,visible:e,hideLeftEdge:i,activated:s,TypographyComponent:a,leftEdgeHidingDuration:r=150,...d})=>{if(!e)return t;if(!a)return t;const c={"--vkui_internal--fade-mask-left-edge-hiding-duration":`${r}`};return(0,o.Y)(a,{style:c,className:(0,n.$)(m,s&&v),...d,children:t})};var f=i(815287),S=i(364517),w=i(180329),b=i(486526);const P=({onHold:t,onResumed:e})=>{const[i,s]=(0,f.useState)(!1),o=(0,S.K)((0,b.s)((()=>(s(!1),void e?.())),1500));return{tickHeld:i,holdTick:()=>{i||(s(!0),t?.(),o())}}};const A={regular:5};function k({frameWidth:t,avgCharacterWidth:e,speed:i="regular"}){return{"--music-overlay-badge-ticker-tick-width":`-${t+M}px`,"--music-overlay-badge-ticker-tick-duration":`${t/(A[i]*e)}s`}}function C({forceValue:t,frameWidth:e,tickHeld:i}){return null!=t?t:!(!e||i)}const I="vkitTicker__root--FkCFo",E="vkitTicker__tickerSpace--kHSS0",L="vkitTicker__ticker--9xPAm",T="vkitTicker__tickerActive--pER3V",M=12,O=({children:t,mode:e,speed:i="regular",onFrameWidthUpdated:s,onFrameHidden:a,onHold:r,onResume:d,onFrameActivated:c})=>{const l=(0,f.useRef)(null),h=(0,f.useRef)(null),[p,u]=(0,f.useState)(0),[g,_]=(0,f.useState)(0),{tickHeld:m,holdTick:v}=P({onHold:r,onResumed:d}),[y,b]=(0,f.useState)(C({forceValue:"none"!==e&&void 0,frameWidth:p,tickHeld:m}));!function(t,e,i){(0,f.useEffect)((()=>{let s;const o=()=>{const n=t.current,a=e.current;if(n&&a){const t=n.getBoundingClientRect();if(a.getBoundingClientRect().right<=t.left)return void i()}s=requestAnimationFrame(o)};return s=requestAnimationFrame(o),()=>{cancelAnimationFrame(s)}}),[i,t,e])}(l,h,(()=>{a?.()}));const A=(0,S.K)((t=>{u(t),h.current&&_(Number(t/h.current.innerText.length)),s?.(t)}));return(0,f.useEffect)((()=>{const t=h.current;if(!t)return;const e=new ResizeObserver((t=>{const e=t.reduce(((t,e)=>Math.max(t,e.contentRect.width)),0);A(e)}));return e.observe(t),()=>{e.disconnect()}}),[A]),(0,f.useEffect)((()=>{b(C({forceValue:"none"!==e&&void 0,frameWidth:p,tickHeld:m}))}),[e,p,m]),(0,f.useEffect)((()=>{c?.(y)}),[y]),(0,o.Y)("div",{className:I,ref:l,children:(0,o.Y)("div",{className:E,children:(0,o.FD)(w.s,{style:k({frameWidth:p,avgCharacterWidth:g,speed:i}),className:(0,n.$)(L,y&&T),gap:M,margin:"none",onAnimationIteration:v,noWrap:!0,children:[(0,o.Y)("div",{ref:h,children:t}),"none"!==e&&(0,o.Y)("div",{children:t})]})})})},D={Action:({size:t="m",active:e,loading:i,SIdleIcon:s,SActiveIcon:l,MIdleIcon:h,MActiveIcon:_,tooltipText:m,label:v,contentDisabled:y,...f})=>{const S=function({active:t,SIdleIcon:e,MIdleIcon:i,SActiveIcon:s,MActiveIcon:o,size:n="m"}){switch(n){case"s":return t?s:e;case"m":return t?o:i;default:return(0,a.S)(n)}}({active:e,size:t,SIdleIcon:s,SActiveIcon:l,MIdleIcon:h,MActiveIcon:_});return(0,o.Y)(p,{size:t,loading:i,children:(0,o.Y)(r.f,{placement:"top",text:m,maxWidth:240,offsetByMainAxis:4,children:(0,o.Y)(d.K,{"data-testid":"musicbadge-action",hoverMode:"opacity",activeMode:"opacity",label:v,className:(0,n.$)(y&&u),...g[t],...f,children:(0,o.Y)(S,{className:(0,c.I)("color_icon_contrast")})})})})},Cover:_.Y,FadeMask:y,FadedTicker:({children:t,mode:e,onHold:i,onResume:s,maxWidth:n,onFrameWidthUpdated:a,TypographyComponent:r,typographyProps:d={},...c})=>{const l=(0,f.useRef)(!1),[h,p]=(0,f.useState)("none"===e),[u,g]=(0,f.useState)(!1);return(0,o.Y)(y,{visible:!0,hideLeftEdge:h,activated:u,TypographyComponent:r,...d,children:(0,o.Y)(O,{mode:e,getActiveRef:l,onFrameWidthUpdated:t=>{a?.(t)},onFrameHidden:()=>{p(!0),i?.()},onResume:()=>{p(!1),s?.()},onFrameActivated:t=>{g(t)},...c,children:t})})},Ticker:s.R}},705470:(t,e,i)=>{i.d(e,{t:()=>T});var s=i(221020),o=i(634164),n=i(815287),a=i(180329),r=i(56471),d=i(516427),c=i(748868),l=i(734223),h=i(702484),p=i(920329),u=i(663194),g=i(982444),_=i(638945),m=i(165051),v=i(880414),y=i(772812),f=i(286788);const S="vkitInfo__text--QqUS4",w="vkitInfo__textOpacity--aPSNB",b=({title:t,getTitleRef:e,subtitle:i,getSubtitleRef:n,titleTickerMode:a="auto",tickerSpeed:r="regular",maxWidth:d,onTickerFrameWidthUpdated:c})=>{const l=(0,o.$)((0,y.I)("color_text_contrast"),S),h=(0,s.Y)(g.K,{size:1});return(0,s.FD)(m.r,{separator:h,children:[(0,s.Y)(f.f.FadedTicker,{mode:a,speed:r,maxWidth:d,onFrameWidthUpdated:c,TypographyComponent:_.tW,typographyProps:{weight:"2"},children:(0,s.Y)(_.tW,{getRootRef:e,weight:"2",className:l,inline:!0,children:t})}),(0,s.Y)(v.b,{TypographyComponent:_.HL,lines:1,className:(0,o.$)(l,w),level:"2",weight:"3",children:(0,s.Y)("span",{ref:n,children:i})})]})};var P=i(947008);const A="vkitMusicPlaylistOverlayBadge__root--aCmgF",k="vkitMusicPlaylistOverlayBadge__content--uezPn",C="vkitMusicPlaylistOverlayBadge__contentDisabled--MGWrz",I="vkitMusicPlaylistOverlayBadge__contentDimmed--Y0y4p",E="vkitMusicPlaylistOverlayBadge__actionContainer--dNE9u",L="vkitMusicPlaylistOverlayBadge__contentFlexItem--2d2TC",T=Object.assign((({cover:t,coverAlt:e="Music playlist cover",action:i,title:c,subtitle:g,titleTickerMode:_,tickerSpeed:m,fadeMaskMode:v,maxHeight:y,disabled:f,tooltipTextCover:S,tooltipTextInfo:w,tooltipTextAction:T,coverButtonAriaLabel:M,infoButtonAriaLabel:O,onCoverClick:D,onTextInfoClick:x,coverIconName:R,textInfoDisabled:Y,contentDisabled:F,noticeIcon:B,...N})=>{const{maxWidth:z}=(0,l.L)(N),{ref:V,sizes:U}=(0,h.L)(),{ref:G,sizes:j}=(0,h.L)(),[W,H]=(0,n.useState)(0);let $=Math.min(Math.max(132,W+80),z??1/0);B&&($+=12);const K={maxWidth:z,maxHeight:y,minWidth:$},q=function(t,e){if((0,P.Et)(e))return Math.max(e-80+(t?0:28),0)}(!!i,z),Q=.6*(j.width||1/0),J=(U.width||0)>=Q?_:"none";return(0,s.Y)("div",{"data-testid":"musicbadge",style:K,className:A,...N,children:(0,s.Y)("div",{className:(0,o.$)(k,void 0===F&&f&&C),children:(0,s.FD)(a.s,{gap:[8,0],margin:"none",align:"center",noWrap:!0,children:[(0,s.Y)(a.s.Item,{flex:"fixed",children:(0,s.Y)(r.f,{placement:"top",text:S,maxWidth:240,offsetByMainAxis:2,"data-testid":"musicplaylistoverlaybadge_coverbuttontooltip",children:(0,s.Y)(d.SB4,{onClick:D,disabled:f,focusVisibleMode:"outside",hoverMode:"none",className:(0,o.$)(F&&I),"aria-label":M,"data-testid":"musicplaylistoverlaybadge_coverbutton",children:(0,s.Y)(p.Y,{src:t,alt:e,size:"m",overlayIconName:R})})})}),(0,s.Y)(a.s.Item,{className:L,children:(0,s.FD)(a.s,{gap:[4,0],align:"center",margin:"none",noWrap:!0,children:[(0,s.Y)(a.s.Item,{className:L,style:{maxWidth:U.width>=u.dU?`${U.width}px`:"100%"},children:(0,s.Y)(r.f,{placement:"top",text:w,maxWidth:240,offsetByMainAxis:2,"data-testid":"musicplaylistoverlaybadge_infobuttontooltip",children:(0,s.Y)(d.SB4,{onClick:x,disabled:void 0!==Y?Y:f,hoverMode:"none","aria-label":O,"data-testid":"musicplaylistoverlaybadge_infobutton",children:(0,s.Y)(b,{title:c,getTitleRef:V,subtitle:g,getSubtitleRef:G,titleTickerMode:J,tickerSpeed:m,fadeMaskMode:v,maxWidth:q,onTickerFrameWidthUpdated:H})})})}),!!B&&(0,s.Y)(a.s.Item,{children:(0,s.Y)(a.s,{align:"center",justify:"center",className:E,children:B})}),!!i&&(0,s.Y)(a.s.Item,{children:(0,s.Y)(a.s,{align:"center",justify:"center",className:E,children:(0,s.Y)(r.f,{placement:"top",text:T,maxWidth:240,offsetByMainAxis:2,"data-testid":"musicplaylistoverlaybadge_actiontooltip",children:i})})})]})})]})})})}),{Action:c.r})},663194:(t,e,i)=>{i.d(e,{Ap:()=>o,Vv:()=>n,dU:()=>a,wo:()=>r,zh:()=>s});const s=36,o=16,n=44+s+o,a=157-s-o-32-4,r=240},702484:(t,e,i)=>{i.d(e,{L:()=>o});var s=i(815287);function o(){const t=(0,s.useRef)(null),[e,i]=(0,s.useState)({width:0,height:0});return(0,s.useEffect)((()=>{const e=t.current;if(!e)return;const s=new ResizeObserver((([t])=>{const{offsetWidth:e=0,offsetHeight:s=0}=t.target;s&&e&&i({width:e,height:s})}));return s.observe(e),()=>{s.disconnect()}}),[]),{ref:t,sizes:e}}},675492:(t,e,i)=>{i.d(e,{p:()=>P});var s=i(221020),o=i(11006),n=i(300806),a=i(634164),r=i(516427),d=i(405697),c=i(638945),l=i(187233),h=i(292184),p=i(962644),u=i(372286),g=i(108852),_=i(838565),m=i(425522);const v="vkitSnippetAttachment__root--mhk4k",y="vkitSnippetAttachment__actionButton--0CI9i",f="vkitSnippetAttachment__imageWrapper--lJVHc",S={feed:"vkitSnippetAttachment__feed--NkQTo",posting:"vkitSnippetAttachment__posting--1FZIU"},w=360/198,b=550/262,P=({title:t,sizes:e,fallbackIcon:i,iconTitle:P,action:A,caption:k,mode:C,maxImageWidth:I,maxContainerWidth:E,actionButton:L,getRootRef:T,restriction:M,onRestrictedClick:O,ratio:D,imageAriaLabel:x,iconAriaLabel:R,"data-testid":Y="snippet-attachment",onMouseEnter:F,loading:B,renderRestrictionText:N,disableButton:z,dataRoles:V,...U})=>{const G=(0,_.D)(),j=D??(G?w:b),W=e&&(0,n.q)(e,I),H=W||M?(0,s.Y)(o.p,{}):i||(0,s.Y)(o.p,{});return(0,s.Y)("div",{className:(0,a.$)(v,S[C]),...U,ref:T,"data-testid":Y,children:(0,s.FD)(g.k,{action:M?void 0:A,onMouseEnter:F,children:[(0,s.FD)(r.glH,{ratio:j,children:[!W?.url&&!M&&(0,s.Y)(d.O,{icon:H,className:f,"aria-label":R,stretched:!0,children:(0,s.Y)(c.$j,{Component:"span","data-testid":"image-title",level:"2",children:P})}),(W?.url||M)&&(0,s.FD)(p.h,{Component:"div",className:f,centered:!0,children:[W?.url&&(0,s.Y)(u.C,{overlay:!0,fit:"cover",src:W.url,restrictionType:M?.type,width:W.width||E,height:W.height||E,loading:B,"aria-label":x,"data-testid":"snippet-attachment-image","data-role":V?.snippetAttachment}),M&&(0,s.Y)(m.c,{restriction:M,onRestrictedClick:O,hasPhotoBackground:Boolean(W?.url),renderRestrictionText:N})]})]}),!z&&(0,s.Y)(l.i,{mode:"vertical",spacing:G?4:8,paddingBottom:0,paddingTop:0,children:(0,s.Y)(h.T,{subtitle:k,minHeight:56,"data-testid":"snippet-attachment-captions","data-role":V?.button,children:t})}),!!L&&(0,s.Y)("div",{className:y,children:L})]})})}},425522:(t,e,i)=>{i.d(e,{c:()=>f});var s=i(221020),o=i(504117),n=i(867227),a=i(928959),r=i(405697),d=i(982444),c=i(409698),l=i(37377),h=i(772812),p=i(634164),u=i(638945);const g="vkitSnippetRestrictionText__root--bhPIg",_="vkitSnippetRestrictionText__textSecondary--e4fif",m={blocked:_,deleted:_,restricted:"vkitSnippetRestrictionText__textContrast--kH3lT"},v=({restriction:{type:t,text:e,shortText:i},hasPhotoBackground:o,renderRestrictionText:n})=>{const a=e||i,r=o?m[t]:m.blocked;return a?(0,s.Y)(u.$j,{Component:"span",level:"2",className:(0,p.$)(g,r),"data-testid":"restriction-text",children:n?n(a):a}):null},y={restricted:void 0,deleted:o.Y,blocked:n.M},f=({restriction:t,onRestrictedClick:e,hasPhotoBackground:i,renderRestrictionText:o})=>{const{actionText:n,type:p,noIcon:u}=t,g=(0,l.E)(p),_=y[p],m=g&&e&&n;return(0,s.FD)(r.O,{icon:!u&&_&&(0,s.Y)("div",{className:(0,h.I)(g?"color_icon_contrast":"color_text_secondary"),"aria-hidden":!0,children:(0,s.Y)(_,{})}),stretched:!0,children:[(0,s.Y)(v,{restriction:t,hasPhotoBackground:i,renderRestrictionText:o}),m&&(0,s.FD)(s.FK,{children:[(0,s.Y)(d.K,{size:12}),(0,s.Y)(c.$,{size:"m",mode:"primary",appearance:"overlay",onClick:t=>{(0,a.T)(t),e?.(t)},children:n})]})]})}},978350:(t,e,i)=>{i.d(e,{w:()=>s});const s={SQUARE:1,WIDE:4/3,LOW:55/65,LOWER:.8,HIGH:3/4,HIGHER:2/3,WIDER:16/9}},867129:(t,e,i)=>{i.d(e,{j:()=>s});const s=t=>void 0!==t?`${t}px`:void 0}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/31175.8aec3284.js")}catch(t){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/31175.8aec3284.js",t),t}