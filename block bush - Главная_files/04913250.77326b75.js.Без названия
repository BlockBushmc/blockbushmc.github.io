try{(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[83741],{666532:(t,e,i)=>{i.d(e,{AudioOwnerProvider:()=>p});var a=i(331635),s=i(327813),r=i(132028),n=i(468073),o=i(955060),d=i(931430),l=i(58120),u=i(936507),c=i(454278),y=i(219436);class p{isSupported(t){return n.Ranges.isGroupId(t)||n.Ranges.isUserId(t)}get(t){if(n.Ranges.isGroupId(t)){const e=n.Ranges.convertOwnerIdToGroupId(t);return this.groups.get(e)}if(n.Ranges.isUserId(t))return this.users.get(t)}provide(t){switch(t.type){case u.AudioOwnerType.Group:return this.provideGroup(t);case u.AudioOwnerType.User:return this.provideUser(t)}}provideGroup(t){let e=this.groups.get(t.groupId);return e||(e=new d.AudioGroupOwner(t),this.groups.set(e.data.groupId,e)),e}provideUser(t){let e=this.users.get(t.userId);return e||(e=new l.AudioUserOwner(t),this.users.set(e.data.userId,e)),e}provideFromAPI(t){const e=[],i=[];for(const i of t.users??[])try{const t=(0,c.toAudioUserOwnerData)(i);e.push(this.provideUser(t))}catch(t){this.logger.log(t)}for(const e of t.groups??[])try{const t=(0,y.toAudioGroupOwnerData)(e);i.push(this.provideGroup(t))}catch(t){this.logger.log(t)}return{users:e,groups:i}}constructor(t){this.logger=t,this.users=new Map,this.groups=new Map,(0,s.makeObservable)(this)}}(0,a.__decorate)([s.observable.shallow],p.prototype,"users",void 0),(0,a.__decorate)([s.observable.shallow],p.prototype,"groups",void 0),(0,a.__decorate)([s.action,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",["undefined"==typeof TAudioOwnerData?Object:TAudioOwnerData]),(0,a.__metadata)("design:returntype","undefined"==typeof TAudioOwner?Object:TAudioOwner)],p.prototype,"provide",null),(0,a.__decorate)([s.action,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",["undefined"==typeof IAudioGroupOwnerData?Object:IAudioGroupOwnerData]),(0,a.__metadata)("design:returntype","undefined"==typeof IAudioGroupOwner?Object:IAudioGroupOwner)],p.prototype,"provideGroup",null),(0,a.__decorate)([s.action,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",["undefined"==typeof IAudioUserOwnerData?Object:IAudioUserOwnerData]),(0,a.__metadata)("design:returntype","undefined"==typeof IAudioUserOwner?Object:IAudioUserOwner)],p.prototype,"provideUser",null),(0,a.__decorate)([s.action,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",["undefined"==typeof IAudioOwnerProvideAPISource?Object:IAudioOwnerProvideAPISource]),(0,a.__metadata)("design:returntype","undefined"==typeof IAudioOwners?Object:IAudioOwners)],p.prototype,"provideFromAPI",null),p=(0,a.__decorate)([r.scope.global(),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===o.ErrorLogger?Object:o.ErrorLogger])],p)},936507:(t,e,i)=>{i.d(e,{AudioOwnerType:()=>a});var a=function(t){return t.Group="group",t.User="user",t}({})},931430:(t,e,i)=>{i.d(e,{AudioGroupOwner:()=>d});var a=i(434518),s=i(763812),r=i(468073),n=i(936507),o=(0,s._)("_data");class d{get type(){return n.AudioOwnerType.Group}get data(){return(0,a._)(this,o)[o]}get id(){return r.Ranges.convertGroupIdToOwnerId(this.data.groupId)}constructor(t){Object.defineProperty(this,o,{writable:!0,value:void 0}),(0,a._)(this,o)[o]=t}}},58120:(t,e,i)=>{i.d(e,{AudioUserOwner:()=>o});var a=i(434518),s=i(763812),r=i(936507),n=(0,s._)("_data");class o{get type(){return r.AudioOwnerType.User}get data(){return(0,a._)(this,n)[n]}get id(){return this.data.userId}constructor(t){Object.defineProperty(this,n,{writable:!0,value:void 0}),(0,a._)(this,n)[n]=t}}},704323:(t,e,i)=>{i.d(e,{AUDIO_OWNER_IMAGE_SIZES:()=>a});const a=[["photo_50",50],["photo_100",100],["photo_200",200],["photo_200_orig",200],["photo_400",400],["photo_400_orig",400],["photo_base",720]]},219436:(t,e,i)=>{i.d(e,{toAudioGroupOwnerData:()=>r});var a=i(704323),s=i(936507);function r(t){const e=t.name,i=t.screen_name??null;return function(t,e){if(null==t)throw new Error(`${e} required for create AudioUserOwnerData`)}(e,"title"),{type:s.AudioOwnerType.Group,groupId:t.id,title:e,avatar:n(t),domain:i,source:t}}function n(t){if(!t)return null;const e=[];for(const[i,s]of a.AUDIO_OWNER_IMAGE_SIZES){const a=t[i];a&&e.push({src:a,width:s,height:s})}return{sizes:e}}},454278:(t,e,i)=>{i.d(e,{toAudioUserOwnerData:()=>r});var a=i(704323),s=i(936507);function r(t){const e=t.first_name??null,i=t.last_name??null,a=t.domain??null;if(!e&&!i)throw new Error("firstName or lastName required for AudioUserOwnerData");return{type:s.AudioOwnerType.User,userId:t.id,firstName:e,lastName:i,avatar:n(t),domain:a,source:t}}function n(t){if(!t)return null;const e=[];for(const[i,s]of a.AUDIO_OWNER_IMAGE_SIZES){const a=t[i];a&&e.push({src:a,width:s,height:s})}return{sizes:e}}},249819:(t,e,i)=>{i.d(e,{MusicAlbumPlaylist:()=>o});var a=i(331635),s=i(327813),r=i(553351),n=i(957560);class o extends n.MusicPlaylist{get genres(){return this.data.genres}get releaseYear(){return this.data.releaseYear}get subtype(){return this.data.subtype}get authors(){return this.data.authors}get focusTrackIdentities(){return this.head.reduce(((t,e)=>(e.isFocusTrack&&t.push(e.identity),t)),[])}constructor(t){super(t),this.following=new r.MusicPlaylistFollowing({playlist:this,service:t.followingService}),(0,s.makeObservable)(this)}}(0,a.__decorate)([s.computed,(0,a.__metadata)("design:type",void 0),(0,a.__metadata)("design:paramtypes",[])],o.prototype,"focusTrackIdentities",null)},930980:(t,e,i)=>{i.d(e,{MusicChatPlaylist:()=>n});var a=i(327813),s=i(553351),r=i(957560);class n extends r.MusicPlaylist{constructor(t){super(t),this.following=new s.MusicPlaylistFollowing({playlist:this,service:t.followingService}),(0,a.makeObservable)(this)}}},117541:(t,e,i)=>{i.d(e,{MusicGeneratedPlaylist:()=>s});var a=i(957560);class s extends a.MusicPlaylist{get authors(){if(!(this.originalOwner??this.owner))return[]}}},957560:(t,e,i)=>{i.d(e,{MusicPlaylist:()=>p});var a=i(434518),s=i(763812),r=i(331635),n=i(327813),o=i(70148),d=i(562871),l=(0,s._)("_getItemsService"),u=(0,s._)("_getDuration"),c=(0,s._)("_ensureExtendedData"),y=(0,s._)("_getContextualAudioForItem");class p extends d.AudioList{get items(){return this.itemsService.items.filter((({identity:t})=>!this.trackProvider.corruptedIdentities.has(t)))}get head(){const t=[];for(const e of this.items){const i=(0,a._)(this,y)[y](e);if(!i)return t;t.push(i)}return t}get isItemsInitialized(){return this.itemsService.isInitialized}get hasFetchingItems(){return this.itemsService.hasFetching}get isHeadFetching(){return this.items.some((({identity:t})=>this.trackProvider.isFetchingAudio(t)))}get isEmpty(){const{itemsService:t}=this;return t.isInitialized?!this.items.length:!this.count}audioAt(t){const e=this.items.at(t);if(e)return(0,a._)(this,y)[y](e)}get owner(){return this.audioOwnerProvider.get(this.identity.ownerId)??null}get originalOwner(){const t=this.originalIdentity;return t?this.audioOwnerProvider.get(t.ownerId)??null:null}get followedOwner(){const t=this.followedIdentity;return t?this.audioOwnerProvider.get(t.ownerId)??null:null}get originalIdentity(){const t=this.data.originalIdentity;return t?new o.OwnedIdentity(t):null}get followedIdentity(){const t=this.data.followedIdentity;return t?new o.OwnedIdentity(t):null}get isOriginal(){const{originalIdentity:t}=this;return!t||this.identity.fullId===t.fullId}get title(){return this.data.title}get subtitle(){return this.data.subtitle}get description(){return this.data.description}get cover(){return this.data.cover}get thumbs(){return this.data.thumbs}get count(){return this.data.count}get plays(){return this.data.plays}get isExclusive(){return this.data.isExclusive}get isDiscoverable(){return this.data.isDiscoverable}get isExplicit(){return this.data.isExplicit}get legal(){return this.data.legal}get permissions(){return this.data.permissions}get updateDate(){return this.data.updateDate}get source(){return this.data.source}get duration(){return(0,a._)(this,u)[u]()}has(t){return this.itemsService.has(t)}async ensureExtendedData(){await(0,a._)(this,c)[c]()}async ensureItems(){return this.itemsService.ensure()}async fetchItems(){return this.itemsService.fetch()}async fetchAt(t,e={}){let{range:i,prefetch:a}=e;!i&&a&&(i=5);const s=this.getFetchAtIndexes(t,{...e,range:i}).map((t=>this.items.at(t)?.identity));await this.trackProvider.ensureMany(s);const r=(i??0)-s.reduce(((t,e)=>this.trackProvider.corruptedIdentities.has(e)?t+1:t),0);return r>=0&&this.assertFetchAtFetched(t,{...e,range:r}),this.audioAtStrict(t)}fetchNext(t=100){return this.fetchNextByAt(t)}get itemsService(){return(0,a._)(this,l)[l]()}constructor(t){super(t),Object.defineProperty(this,y,{value:h}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),this.audioApi=t.audioApi,this.trackProvider=t.trackProvider,this.audioOwnerProvider=t.audioOwnerProvider,(0,a._)(this,l)[l]=t.getItemsService,(0,a._)(this,u)[u]=t.getDuration,(0,a._)(this,c)[c]=t.ensureExtendedData,(0,n.makeObservable)(this)}}function h(t){const{trackProvider:e}=this;return e.get(t.identity,{list:this,trackCode:t.trackCode})}(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Object),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"items",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Object),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"head",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Boolean),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"isItemsInitialized",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Boolean),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"hasFetchingItems",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Boolean),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"isHeadFetching",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Boolean),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"isEmpty",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"owner",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"originalOwner",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"followedOwner",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"originalIdentity",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"followedIdentity",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",Boolean),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"isOriginal",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"duration",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type","undefined"==typeof ItemsService?Object:ItemsService),(0,r.__metadata)("design:paramtypes",[])],p.prototype,"itemsService",null)},739042:(t,e,i)=>{i.d(e,{MusicUGCGroupPlaylist:()=>n});var a=i(327813),s=i(553351),r=i(957560);class n extends r.MusicPlaylist{get isCurator(){return this.data.isCurator}constructor(t){super(t),this.following=new s.MusicPlaylistFollowing({playlist:this,service:t.followingService}),(0,a.makeObservable)(this)}}},973682:(t,e,i)=>{i.d(e,{MusicUGCUserPlaylist:()=>n});var a=i(327813),s=i(553351),r=i(957560);class n extends r.MusicPlaylist{constructor(t){super(t),this.following=new s.MusicPlaylistFollowing({playlist:this,service:t.followingService}),(0,a.makeObservable)(this)}}},384092:(t,e,i)=>{i.d(e,{MyMusicPlaylist:()=>l});var a=i(434518),s=i(763812),r=i(331635),n=i(327813),o=i(957560),d=(0,s._)("_getEditingService");class l extends o.MusicPlaylist{get editor(){return(0,a._)(this,d)[d]()}get itemsOwning(){return this.itemsService}get isDiscoverable(){return this.editingService.state.isDiscoverable}get editingService(){return(0,a._)(this,d)[d]()}constructor(t){super(t),Object.defineProperty(this,d,{writable:!0,value:void 0}),(0,a._)(this,d)[d]=t.getEditingService,(0,n.makeObservable)(this)}}(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type","undefined"==typeof IMusicPlaylistEditor?Object:IMusicPlaylistEditor),(0,r.__metadata)("design:paramtypes",[])],l.prototype,"editor",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type","undefined"==typeof IMusicPlaylistItemsOwning?Object:IMusicPlaylistItemsOwning),(0,r.__metadata)("design:paramtypes",[])],l.prototype,"itemsOwning",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],l.prototype,"isDiscoverable",null),(0,r.__decorate)([n.computed,(0,r.__metadata)("design:type",void 0),(0,r.__metadata)("design:paramtypes",[])],l.prototype,"editingService",null)},483436:(t,e,i)=>{function a(t){const{id:e,name:i}=t;return{id:e,name:i}}i.d(e,{toMusicGenre:()=>a})},484791:(t,e,i)=>{i.d(e,{MusicAlbumPlaylistSubtype:()=>s});var a=i(549294),s=function(t){return t.Album="album",t.EP="ep",t.Collection="collection",t.Single="single",t}({});a.MusicPlaylistSubtypeCode[a.MusicPlaylistSubtype.Album],a.MusicPlaylistSubtypeCode[a.MusicPlaylistSubtype.EP],a.MusicPlaylistSubtypeCode[a.MusicPlaylistSubtype.Collection],a.MusicPlaylistSubtypeCode[a.MusicPlaylistSubtype.Single]},746970:(t,e,i)=>{i.d(e,{toMusicAlbumPlaylistData:()=>d});var a=i(961076),s=i(891480),r=i(397034),n=i(483436),o=i(484791);function d(t){const{year:e}=t;return{...(0,a.toMusicPlaylistData)(s.AudioListType.MusicAlbumPlaylist,t),releaseYear:e,type:s.AudioListType.MusicAlbumPlaylist,subtype:p(t),genres:l(t),authors:u(t)}}function l(t){const{genres:e}=t;return e?e.map(n.toMusicGenre):[]}function u(t){const{main_artists:e,featured_artists:i,main_artist:a}=t;return{main:e?.map(c)??[],feat:i?.map(c)??[],raw:a??""}}function c(t){return{id:t.id,name:t.name,avatar:y(t)}}function y(t){const e=t.photo;return e?(0,r.mapBaseImagesToAudioImage)(e):null}function p(t){const e=t.album?.type;switch(e){case"album":default:return o.MusicAlbumPlaylistSubtype.Album;case"ep":return o.MusicAlbumPlaylistSubtype.EP;case"collection":return o.MusicAlbumPlaylistSubtype.Collection;case"single":return o.MusicAlbumPlaylistSubtype.Single}}},56252:(t,e,i)=>{i.d(e,{toMusicChatPlaylistData:()=>r});var a=i(961076),s=i(891480);function r(t){return{...(0,a.toMusicPlaylistData)(s.AudioListType.MusicChatPlaylist,t),type:s.AudioListType.MusicChatPlaylist}}},904290:(t,e,i)=>{i.d(e,{toMusicGeneratedPlaylistData:()=>r});var a=i(961076),s=i(891480);function r(t){return{...(0,a.toMusicPlaylistData)(s.AudioListType.MusicGeneratedPlaylist,t),type:s.AudioListType.MusicGeneratedPlaylist}}},417360:(t,e,i)=>{i.d(e,{MusicPlaylistProvider:()=>z});var a=i(434518),s=i(763812),r=i(331635),n=i(327813),o=i(132028),d=i(468073),l=i(70148),u=i(391751),c=i(346675),y=i(951652),p=i(26530),h=i(523417),g=i(891480),m=i(23975),_=i(666532),v=i(249819),f=i(117541),I=i(739042),w=i(973682),b=i(930980),M=i(384092),O=i(158400),A=i(746970),S=i(904290),D=i(451116),k=i(332156),E=i(346136),C=i(56252),G=i(587029),F=i(549294),x=i(500435),j=i(432688),T=i(586327),U=i(164610),L=(0,s._)("_corruptedCoverMainColors"),R=(0,s._)("_setState"),N=(0,s._)("_setEditingServiceState"),B=(0,s._)("_fetch");class z{static getContextKey(t){return t.ref}get events(){return this.emitter.listenable}get(t,e,i){const a=this.entities.get(t);if(!a)return;const s=a.get(z.getContextKey(e));if(s)return s;const r=this.data.get(t);return r?this.construct(r,e,i):void 0}has(t){return this.data.has(t)}checkPending(t){return this.pendingPlaylists.has(t)}checkDeleting(t){return this.pendingDeletedPlaylists.has(t)}checkDeleted(t){return this.deletedPlaylists.has(t)}async ensure(t,e,i){const a=this.get(t,e,i);return a||this.fetch(t,e,i)}async ensureExtendedData(t,e,i){let s=this.get(t,e,i);const r=this.audioOwnerProvider.get(t.ownerId),n=this.durations.get(t);if(!s||!r||"number"!=typeof n||!(0,a._)(this,L)[L].has(t)&&!Y(s))return this.fetch(t,e,i)}create(t,e,i){const s=this.toEntityIdentity(t.identity);return(0,a._)(this,R)[R](s,t.type,e),this.cacheData(t),this.construct(t,i)}cacheEntity(t){const{identity:e}=t;let i=this.entities.get(e);return i||(i=(0,n.observable)(new Map),this.entities.set(e,i)),i.set(z.getContextKey(t.context),t),t}cacheData(t){const{identity:e,followedIdentity:i}=t,a=t.originalIdentity??e,s=this.toEntityIdentity(e),r=this.toEntityIdentity(a),n=i&&this.toEntityIdentity(i);if(this.data.set(s,t),r.fullId!==s.fullId){let i=null;e.ownerId===this.authService.userId&&(i=e),this.data.set(r,{...t,identity:a,originalIdentity:null,followedIdentity:i})}n&&this.data.set(n,{...t,identity:i,originalIdentity:a,followedIdentity:null})}fetch(t,e,i){let s=this.fetchings.get(t);return s||(s=(0,a._)(this,B)[B](t,e,i).finally((()=>{(0,n.runInAction)((()=>{this.fetchings.delete(t)}))})),this.fetchings.set(t,s)),s}construct(t,e,i){const{audioApi:a,authService:s,trackProvider:r,followingService:n,audioOwnerProvider:o}=this,d=this.toEntityIdentity(t.identity),l=()=>this.durations.get(d),u=async()=>{await this.ensureExtendedData(d,e,i)};switch(t.type){case g.AudioListType.MusicAlbumPlaylist:return this.cacheEntity(new v.MusicAlbumPlaylist({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:a,trackProvider:r,audioOwnerProvider:o,followingService:n,getDuration:l,ensureExtendedData:u}));case g.AudioListType.MusicGeneratedPlaylist:return this.cacheEntity(new f.MusicGeneratedPlaylist({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:a,trackProvider:r,audioOwnerProvider:o,getDuration:l,ensureExtendedData:u}));case g.AudioListType.MusicUGCGroupPlaylist:return this.cacheEntity(new I.MusicUGCGroupPlaylist({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:a,trackProvider:r,audioOwnerProvider:o,followingService:n,getDuration:l,ensureExtendedData:u}));case g.AudioListType.MusicUGCUserPlaylist:return this.cacheEntity(new w.MusicUGCUserPlaylist({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:a,trackProvider:r,audioOwnerProvider:o,followingService:n,getDuration:l,ensureExtendedData:u}));case g.AudioListType.MusicChatPlaylist:return this.cacheEntity(new b.MusicChatPlaylist({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:a,trackProvider:r,audioOwnerProvider:o,followingService:n,getDuration:l,ensureExtendedData:u}));case g.AudioListType.MyMusicPlaylist:return this.cacheEntity(new M.MyMusicPlaylist({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),getEditingService:this.makeEditingServiceGetter(d),context:e,audioApi:a,trackProvider:r,audioOwnerProvider:o,authService:s,getDuration:l,ensureExtendedData:u}));default:return(0,h.expectNever)(t)}}provideFromAPI(t,e){const i=this.makeIdentityFromAPI(t);return this.get(i,e)??this.createFromAPI(t,e)}createFromAPI(t,e){const i=(0,T.toMusicPlaylistStateData)(t),a=!!t.permissions?.edit;switch(t.type){case"album":return this.create((0,A.toMusicAlbumPlaylistData)(t),i,e);case"generated":return this.create((0,S.toMusicGeneratedPlaylistData)(t),i,e);case"chat":return this.create((0,C.toMusicChatPlaylistData)(t),i,e);case"ugc":if(a)return this.create((0,E.toMyMusicPlaylistData)(t),i,e);if(d.Ranges.isGroupId(t.owner_id)||t.original?.owner_id&&d.Ranges.isGroupId(t.original?.owner_id))return this.create((0,D.toMusicUGCGroupPlaylistData)(t),i,e);if(d.Ranges.isUserId(t.owner_id)||t.original?.owner_id&&d.Ranges.isUserId(t.original?.owner_id))return this.create((0,k.toMusicUGCUserPlaylistData)(t),i,e)}throw new Error("Unknown playlist type")}provideFromAPIExtendedResponse(t,e){const i=this.makeIdentityFromAPI(t.playlist);return this.get(i,e)??this.createFromAPIExtendedResponse(t,e)}createFromAPIExtendedResponse(t,e){const{playlist:i,profiles:s,groups:r,duration:n}=t,o=this.makeIdentityFromAPI(i);let d;return"number"==typeof n&&this.durations.set(o,n),this.audioOwnerProvider.provideFromAPI({users:s,groups:r}),d=this.createFromAPI(t.playlist,e),Y(d)||(0,a._)(this,L)[L].add(o),d}async copyToMyMusic(t,e){this.authService.ensureUserId();const i=await this.audioApi.savePlaylistAsCopy({owner_id:t.ownerId,playlist_id:t.id}),a=this.createFromAPI(i,e);if(!(0,x.isSpecificMusicPlaylist)(a,g.AudioListType.MyMusicPlaylist))throw new Error("Error creating copy of playlist in my music");return this.emitter.emit("copiedToMyMusic",{source:t,target:a.identity}),a}async delete(t){try{this.markDeletionPending(t),await this.audioApi.deletePlaylist({owner_id:t.ownerId,playlist_id:t.id}),this.markDeleted(t),this.emitter.emit("deleted",{target:t})}finally{(0,n.runInAction)((()=>{this.unmarkDeletionPending(t)}))}}toEntityIdentity(t){return new l.OwnedIdentity(t)}markPending(t){this.pendingPlaylists.add(t)}unmarkPending(t){this.pendingPlaylists.delete(t)}markDeletionPending(t){this.pendingDeletedPlaylists.add(t)}unmarkDeletionPending(t){this.pendingDeletedPlaylists.delete(t)}markDeleted(t){this.deletedPlaylists.add(t)}makeCachedDataGetter(t,e){let i=e;return()=>{let e=this.data.get(t);return e&&(i=e),e??i}}makeItemsServiceGetter(t,e){return()=>this.playlistsItemsService.provide(t,e)}makeEditingServiceGetter(t){return()=>this.editingServices.provide(t)}makeIdentityFromAPI(t){return this.toEntityIdentity((0,U.toMusicPlaylistIdentityData)(t))}constructor(t,e,i,s,r,o){Object.defineProperty(this,R,{value:K}),Object.defineProperty(this,N,{value:V}),Object.defineProperty(this,B,{value:W}),Object.defineProperty(this,L,{writable:!0,value:void 0}),this.audioApi=t,this.authService=e,this.trackProvider=i,this.audioOwnerProvider=s,this.playlistsItemsService=o.playlistItemsServices,this.editingServices=o.playlistEditingServices,this.followingService=o.playlistsFollowing;const d=(0,j.ensureStuffing)(r);this.emitter=d.emitter,this.entities=d.entities,this.data=d.data,this.durations=d.durations,this.fetchings=d.fetchings,this.pendingPlaylists=d.pendingPlaylists,this.pendingDeletedPlaylists=d.pendingDeletedPlaylists,this.deletedPlaylists=d.deletedPlaylists,(0,a._)(this,L)[L]=d.corruptedCoverMainColors,(0,n.makeObservable)(this)}}function K(t,e,i){const{followedIdentity:s}=i,r=i.originalIdentity??t,n=this.toEntityIdentity(r),o=s&&this.toEntityIdentity(s),d=this.authService.userId;(0,u.compareIdentities)(n,t)||t.ownerId!==d||this.followingService.setCache(n,t),o&&!(0,u.compareIdentities)(o,n)&&this.followingService.setCache(n,o),(0,a._)(this,N)[N](t,e,i)}function V(t,e,i){let a,s=null;F.EditableMusicPlaylistsTypes.includes(e)&&(void 0!==i.isDiscoverable&&(s={},s.isDiscoverable=i.isDiscoverable),s&&(a=this.editingServices.provide(t),a.setState(s)))}async function W(t,e,i){try{this.markPending(t);let a={playlist_id:t.id,owner_id:t.ownerId,access_key:t.accessKey,extra_fields:"owner,duration"};i?.enrichFetchParams&&(a=i?.enrichFetchParams(a));const s=await this.audioApi.getPlaylistByIdExtended(a,{signal:i?.abortSignal});return this.createFromAPIExtendedResponse(s,e)}catch(t){throw m.AudioError.fromUnknownError(t)}finally{this.unmarkPending(t)}}function Y(t){return!!t.cover?.mainColor}(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof TMusicPlaylistData?Object:TMusicPlaylistData,"undefined"==typeof IMusicPlaylistStateData?Object:IMusicPlaylistStateData,"undefined"==typeof IMusicPlaylistContext?Object:IMusicPlaylistContext]),(0,r.__metadata)("design:returntype","undefined"==typeof TMusicPlaylist?Object:TMusicPlaylist)],z.prototype,"create",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof P?Object:P]),(0,r.__metadata)("design:returntype","undefined"==typeof P?Object:P)],z.prototype,"cacheEntity",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof TMusicPlaylistData?Object:TMusicPlaylistData]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"cacheData",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity,"undefined"==typeof IMusicPlaylistContext?Object:IMusicPlaylistContext,"undefined"==typeof IMusicPlaylistDataFetchOptions?Object:IMusicPlaylistDataFetchOptions]),(0,r.__metadata)("design:returntype","undefined"==typeof Promise?Object:Promise)],z.prototype,"fetch",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof TMusicPlaylistData?Object:TMusicPlaylistData,"undefined"==typeof IMusicPlaylistContext?Object:IMusicPlaylistContext,"undefined"==typeof IMusicPlaylistDataFetchOptions?Object:IMusicPlaylistDataFetchOptions]),(0,r.__metadata)("design:returntype","undefined"==typeof TMusicPlaylist?Object:TMusicPlaylist)],z.prototype,"construct",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"markPending",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"unmarkPending",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"markDeletionPending",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"unmarkDeletionPending",null),(0,r.__decorate)([n.action,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"markDeleted",null),z=(0,r.__decorate)([o.scope.global(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===c.AudioApi?Object:c.AudioApi,void 0===y.AuthService?Object:y.AuthService,void 0===O.MusicTrackProvider?Object:O.MusicTrackProvider,void 0===_.AudioOwnerProvider?Object:_.AudioOwnerProvider,void 0===p.EmitterFactory?Object:p.EmitterFactory,void 0===G.MusicService?Object:G.MusicService])],z)},432688:(t,e,i)=>{i.d(e,{ensureStuffing:()=>n});var a=i(558137),s=i(70916),r=i(74270);function n(t){const e=(0,a.makeSharedState)("domains/audio/MusicPlaylistProvider/stuffing",(()=>({})),{version:3})();return e.current||(e.current=function(t){return{entities:new s.ObservableIdentityMap,data:new s.ObservableIdentityMap,durations:new s.ObservableIdentityMap,fetchings:new s.ObservableIdentityMap,pendingPlaylists:new r.ObservableIdentitySet,pendingDeletedPlaylists:new r.ObservableIdentitySet,deletedPlaylists:new r.ObservableIdentitySet,corruptedCoverMainColors:new r.ObservableIdentitySet,emitter:t.create()}}(t)),e.current}},961076:(t,e,i)=>{i.d(e,{toMusicPlaylistData:()=>n});i(35215);var a=i(549515),s=i(549294),r=i(164610);new Map([[s.MusicPlaylistSubtypeCode[s.MusicPlaylistSubtype.NoAlbum],s.MusicPlaylistSubtype.NoAlbum],[s.MusicPlaylistSubtypeCode[s.MusicPlaylistSubtype.Album],s.MusicPlaylistSubtype.Album],[s.MusicPlaylistSubtypeCode[s.MusicPlaylistSubtype.EP],s.MusicPlaylistSubtype.EP],[s.MusicPlaylistSubtypeCode[s.MusicPlaylistSubtype.Collection],s.MusicPlaylistSubtype.Collection],[s.MusicPlaylistSubtypeCode[s.MusicPlaylistSubtype.Single],s.MusicPlaylistSubtype.Single],[s.MusicPlaylistSubtypeCode[s.MusicPlaylistSubtype.Chat],s.MusicPlaylistSubtype.Chat]]);function n(t,e){const{title:i,subtitle:a,description:s,count:n,plays:u,exclusive:c,is_explicit:y,no_discover:p,update_time:h,main_color:g}=e,m=y??!1;return{type:t,identity:(0,r.toMusicPlaylistIdentityData)(e),originalIdentity:e.original?(0,r.toSpecificVersionMusicPlaylistIdentityData)(e.original):null,followedIdentity:e.followed?(0,r.toSpecificVersionMusicPlaylistIdentityData)(e.followed):null,title:i,subtitle:a,description:s,cover:o(e,g),thumbs:d(e),count:n,plays:u,isExclusive:c??!1,isExplicit:m,isDiscoverable:!p,updateDate:new Date(1e3*h),permissions:l(e),legal:{isExplicit:m,isForeignAgent:!1},contextFlagsBitmask:e.flags_context,source:{playlist:e}}}function o(t,e){const i=t.photo;return i?(0,a.mapAudioPhotoToAudioImage)(i,e):null}function d(t){return(t.thumbs??[]).map((t=>(0,a.mapAudioPhotoToAudioImage)(t)))}function l(t){const e=t.permissions;return{play:e?.play??!1,share:e?.share??!1,edit:e?.edit??!1,follow:e?.follow??!1,delete:e?.delete??!1,saveAsCopy:e?.save_as_copy??!1}}},586327:(t,e,i)=>{i.d(e,{toMusicPlaylistStateData:()=>s});var a=i(164610);function s(t){const{no_discover:e,original:i,followed:s}=t;return{isDiscoverable:!e,originalIdentity:i?(0,a.toSpecificVersionMusicPlaylistIdentityData)(i):void 0,followedIdentity:s?(0,a.toSpecificVersionMusicPlaylistIdentityData)(s):void 0}}},451116:(t,e,i)=>{i.d(e,{toMusicUGCGroupPlaylistData:()=>r});var a=i(961076),s=i(891480);function r(t){const{is_curator:e}=t;return{...(0,a.toMusicPlaylistData)(s.AudioListType.MusicUGCGroupPlaylist,t),type:s.AudioListType.MusicUGCGroupPlaylist,isCurator:e??!1}}},332156:(t,e,i)=>{i.d(e,{toMusicUGCUserPlaylistData:()=>r});var a=i(961076),s=i(891480);function r(t){return{...(0,a.toMusicPlaylistData)(s.AudioListType.MusicUGCUserPlaylist,t),type:s.AudioListType.MusicUGCUserPlaylist}}},346136:(t,e,i)=>{i.d(e,{toMyMusicPlaylistData:()=>r});var a=i(961076),s=i(891480);function r(t){return(0,a.toMusicPlaylistData)(s.AudioListType.MyMusicPlaylist,t)}},553351:(t,e,i)=>{i.d(e,{MusicPlaylistFollowing:()=>r});var a=i(331635),s=i(327813);class r{get isFollowed(){return this.service.isFollowed(this.originalIdentity)}get state(){return this.isFollowed}get isPending(){return this.service.checkPending(this.followedIdentity??this.originalIdentity)}async activate(){await this.service.follow(this.originalIdentity,{ref:this.ref})}async deactivate(){const{followedIdentity:t}=this;if(!t)throw new Error("Not followed");await this.service.unfollow(t)}async toggle(t,e){const i=e??!this.state;await this[i?"deactivate":"activate"]()}get originalIdentity(){const{identity:t,originalIdentity:e}=this.playlist;return e??this.service.getOriginalIdentity(t)??t}get followedIdentity(){return this.playlist.followedIdentity??this.service.getFollowedIdentity(this.originalIdentity)??null}get ref(){return this.playlist.context.ref}constructor(t){this.playlist=t.playlist,this.service=t.service,(0,s.makeObservable)(this)}}(0,a.__decorate)([s.computed,(0,a.__metadata)("design:type",void 0),(0,a.__metadata)("design:paramtypes",[])],r.prototype,"isFollowed",null),(0,a.__decorate)([s.computed,(0,a.__metadata)("design:type",void 0),(0,a.__metadata)("design:paramtypes",[])],r.prototype,"state",null),(0,a.__decorate)([s.computed,(0,a.__metadata)("design:type",void 0),(0,a.__metadata)("design:paramtypes",[])],r.prototype,"isPending",null)}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/04913250.77326b75.js")}catch(t){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/web/chunks/04913250.77326b75.js",t),t}