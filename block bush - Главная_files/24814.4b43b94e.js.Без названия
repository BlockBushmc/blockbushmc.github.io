try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[24814],{424814:(t,e,r)=>{r.d(e,{AU:()=>gr,Bv:()=>yr,W:()=>li,f_:()=>Wi,rT:()=>ci,sk:()=>wr,xv:()=>Ir});var i,s,o,n,a,u,c=r(319340),l=r(99758),h=Object.create,d=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty,m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),b=(t,e,r)=>(r=null!=t?h(g(t)):{},((t,e,r,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of f(e))!v.call(t,s)&&s!==r&&d(t,s,{get:()=>e[s],enumerable:!(i=p(e,s))||i.enumerable});return t})(!e&&t&&t.__esModule?r:d(r,"default",{value:t,enumerable:!0}),t)),y=m(((t,e)=>{"use strict";var r=function(t){return t&&t.Math===Math&&t};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof global&&global)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()})),w=m(((t,e)=>{"use strict";e.exports=function(t){try{return!!t()}catch{return!0}}})),S=m(((t,e)=>{"use strict";var r=w();e.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))})),_=m(((t,e)=>{"use strict";var r=S(),i=Function.prototype,s=i.apply,o=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(s):function(){return o.apply(s,arguments)})})),T=m(((t,e)=>{"use strict";var r=S(),i=Function.prototype,s=i.call,o=r&&i.bind.bind(s,s);e.exports=r?o:function(t){return function(){return s.apply(t,arguments)}}})),x=m(((t,e)=>{"use strict";var r=T(),i=r({}.toString),s=r("".slice);e.exports=function(t){return s(i(t),8,-1)}})),E=m(((t,e)=>{"use strict";var r=x(),i=T();e.exports=function(t){if("Function"===r(t))return i(t)}})),k=m(((t,e)=>{"use strict";var r="object"==typeof document&&document.all;e.exports=typeof r>"u"&&void 0!==r?function(t){return"function"==typeof t||t===r}:function(t){return"function"==typeof t}})),$=m(((t,e)=>{"use strict";var r=w();e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),A=m(((t,e)=>{"use strict";var r=S(),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}})),P=m((t=>{"use strict";var e={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!e.call({1:2},1);t.f=i?function(t){var e=r(this,t);return!!e&&e.enumerable}:e})),C=m(((t,e)=>{"use strict";e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}})),O=m(((t,e)=>{"use strict";var r=T(),i=w(),s=x(),o=Object,n=r("".split);e.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(t){return"String"===s(t)?n(t,""):o(t)}:o})),R=m(((t,e)=>{"use strict";e.exports=function(t){return null==t}})),L=m(((t,e)=>{"use strict";var r=R(),i=TypeError;e.exports=function(t){if(r(t))throw new i("Can't call method on "+t);return t}})),I=m(((t,e)=>{"use strict";var r=O(),i=L();e.exports=function(t){return r(i(t))}})),N=m(((t,e)=>{"use strict";var r=k();e.exports=function(t){return"object"==typeof t?null!==t:r(t)}})),D=m(((t,e)=>{"use strict";e.exports={}})),B=m(((t,e)=>{"use strict";var r=D(),i=y(),s=k(),o=function(t){return s(t)?t:void 0};e.exports=function(t,e){return arguments.length<2?o(r[t])||o(i[t]):r[t]&&r[t][e]||i[t]&&i[t][e]}})),F=m(((t,e)=>{"use strict";var r=T();e.exports=r({}.isPrototypeOf)})),V=m(((t,e)=>{"use strict";var r=y().navigator,i=r&&r.userAgent;e.exports=i?String(i):""})),M=m(((t,e)=>{"use strict";var r,i,s=y(),o=V(),n=s.process,a=s.Deno,u=n&&n.versions||a&&a.version,c=u&&u.v8;c&&(i=(r=c.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&o&&((!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&((r=o.match(/Chrome\/(\d+)/))&&(i=+r[1]))),e.exports=i})),U=m(((t,e)=>{"use strict";var r=M(),i=w(),s=y().String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol("symbol detection");return!s(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))})),j=m(((t,e)=>{"use strict";var r=U();e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),q=m(((t,e)=>{"use strict";var r=B(),i=k(),s=F(),o=j(),n=Object;e.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return i(e)&&s(e.prototype,n(t))}})),W=m(((t,e)=>{"use strict";var r=String;e.exports=function(t){try{return r(t)}catch{return"Object"}}})),H=m(((t,e)=>{"use strict";var r=k(),i=W(),s=TypeError;e.exports=function(t){if(r(t))return t;throw new s(i(t)+" is not a function")}})),z=m(((t,e)=>{"use strict";var r=H(),i=R();e.exports=function(t,e){var s=t[e];return i(s)?void 0:r(s)}})),Q=m(((t,e)=>{"use strict";var r=A(),i=k(),s=N(),o=TypeError;e.exports=function(t,e){var n,a;if("string"===e&&i(n=t.toString)&&!s(a=r(n,t))||i(n=t.valueOf)&&!s(a=r(n,t))||"string"!==e&&i(n=t.toString)&&!s(a=r(n,t)))return a;throw new o("Can't convert object to primitive value")}})),K=m(((t,e)=>{"use strict";e.exports=!0})),X=m(((t,e)=>{"use strict";var r=y(),i=Object.defineProperty;e.exports=function(t,e){try{i(r,t,{value:e,configurable:!0,writable:!0})}catch{r[t]=e}return e}})),G=m(((t,e)=>{"use strict";var r=K(),i=y(),s=X(),o="__core-js_shared__",n=e.exports=i[o]||s(o,{});(n.versions||(n.versions=[])).push({version:"3.43.0",mode:r?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.43.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),J=m(((t,e)=>{"use strict";var r=G();e.exports=function(t,e){return r[t]||(r[t]=e||{})}})),Z=m(((t,e)=>{"use strict";var r=L(),i=Object;e.exports=function(t){return i(r(t))}})),Y=m(((t,e)=>{"use strict";var r=T(),i=Z(),s=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(t,e){return s(i(t),e)}})),tt=m(((t,e)=>{"use strict";var r=T(),i=0,s=Math.random(),o=r(1.1.toString);e.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++i+s,36)}})),et=m(((t,e)=>{"use strict";var r=y(),i=J(),s=Y(),o=tt(),n=U(),a=j(),u=r.Symbol,c=i("wks"),l=a?u.for||u:u&&u.withoutSetter||o;e.exports=function(t){return s(c,t)||(c[t]=n&&s(u,t)?u[t]:l("Symbol."+t)),c[t]}})),rt=m(((t,e)=>{"use strict";var r=A(),i=N(),s=q(),o=z(),n=Q(),a=et(),u=TypeError,c=a("toPrimitive");e.exports=function(t,e){if(!i(t)||s(t))return t;var a,l=o(t,c);if(l){if(void 0===e&&(e="default"),a=r(l,t,e),!i(a)||s(a))return a;throw new u("Can't convert object to primitive value")}return void 0===e&&(e="number"),n(t,e)}})),it=m(((t,e)=>{"use strict";var r=rt(),i=q();e.exports=function(t){var e=r(t,"string");return i(e)?e:e+""}})),st=m(((t,e)=>{"use strict";var r=y(),i=N(),s=r.document,o=i(s)&&i(s.createElement);e.exports=function(t){return o?s.createElement(t):{}}})),ot=m(((t,e)=>{"use strict";var r=$(),i=w(),s=st();e.exports=!r&&!i((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))})),nt=m((t=>{"use strict";var e=$(),r=A(),i=P(),s=C(),o=I(),n=it(),a=Y(),u=ot(),c=Object.getOwnPropertyDescriptor;t.f=e?c:function(t,e){if(t=o(t),e=n(e),u)try{return c(t,e)}catch{}if(a(t,e))return s(!r(i.f,t,e),t[e])}})),at=m(((t,e)=>{"use strict";var r=w(),i=k(),s=/#|\.prototype\./,o=function(t,e){var s=a[n(t)];return s===c||s!==u&&(i(e)?r(e):!!e)},n=o.normalize=function(t){return String(t).replace(s,".").toLowerCase()},a=o.data={},u=o.NATIVE="N",c=o.POLYFILL="P";e.exports=o})),ut=m(((t,e)=>{"use strict";var r=E(),i=H(),s=S(),o=r(r.bind);e.exports=function(t,e){return i(t),void 0===e?t:s?o(t,e):function(){return t.apply(e,arguments)}}})),ct=m(((t,e)=>{"use strict";var r=$(),i=w();e.exports=r&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),lt=m(((t,e)=>{"use strict";var r=N(),i=String,s=TypeError;e.exports=function(t){if(r(t))return t;throw new s(i(t)+" is not an object")}})),ht=m((t=>{"use strict";var e=$(),r=ot(),i=ct(),s=lt(),o=it(),n=TypeError,a=Object.defineProperty,u=Object.getOwnPropertyDescriptor,c="enumerable",l="configurable",h="writable";t.f=e?i?function(t,e,r){if(s(t),e=o(e),s(r),"function"==typeof t&&"prototype"===e&&"value"in r&&h in r&&!r[h]){var i=u(t,e);i&&i[h]&&(t[e]=r.value,r={configurable:l in r?r[l]:i[l],enumerable:c in r?r[c]:i[c],writable:!1})}return a(t,e,r)}:a:function(t,e,i){if(s(t),e=o(e),s(i),r)try{return a(t,e,i)}catch{}if("get"in i||"set"in i)throw new n("Accessors not supported");return"value"in i&&(t[e]=i.value),t}})),dt=m(((t,e)=>{"use strict";var r=$(),i=ht(),s=C();e.exports=r?function(t,e,r){return i.f(t,e,s(1,r))}:function(t,e,r){return t[e]=r,t}})),pt=m(((t,e)=>{"use strict";var r=y(),i=_(),s=E(),o=k(),n=nt().f,a=at(),u=D(),c=ut(),l=dt(),h=Y();G();var d=function(t){var e=function(r,s,o){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(r);case 2:return new t(r,s)}return new t(r,s,o)}return i(t,this,arguments)};return e.prototype=t.prototype,e};e.exports=function(t,e){var i,p,f,g,v,m,b,y,w,S=t.target,_=t.global,T=t.stat,x=t.proto,E=_?r:T?r[S]:r[S]&&r[S].prototype,k=_?u:u[S]||l(u,S,{})[S],$=k.prototype;for(g in e)p=!(i=a(_?g:S+(T?".":"#")+g,t.forced))&&E&&h(E,g),m=k[g],p&&(t.dontCallGetSet?b=(w=n(E,g))&&w.value:b=E[g]),v=p&&b?b:e[g],(i||x||typeof m!=typeof v)&&(y=t.bind&&p?c(v,r):t.wrap&&p?d(v):x&&o(v)?s(v):v,(t.sham||v&&v.sham||m&&m.sham)&&l(y,"sham",!0),l(k,g,y),x&&(h(u,f=S+"Prototype")||l(u,f,{}),l(u[f],g,v),t.real&&$&&(i||!$[g])&&l($,g,v)))}})),ft=m(((t,e)=>{"use strict";var r=Math.ceil,i=Math.floor;e.exports=Math.trunc||function(t){var e=+t;return(e>0?i:r)(e)}})),gt=m(((t,e)=>{"use strict";var r=ft();e.exports=function(t){var e=+t;return e!=e||0===e?0:r(e)}})),vt=m(((t,e)=>{"use strict";var r=gt(),i=Math.max,s=Math.min;e.exports=function(t,e){var o=r(t);return o<0?i(o+e,0):s(o,e)}})),mt=m(((t,e)=>{"use strict";var r=gt(),i=Math.min;e.exports=function(t){var e=r(t);return e>0?i(e,9007199254740991):0}})),bt=m(((t,e)=>{"use strict";var r=mt();e.exports=function(t){return r(t.length)}})),yt=m(((t,e)=>{"use strict";var r=I(),i=vt(),s=bt(),o=function(t){return function(e,o,n){var a=r(e),u=s(a);if(0===u)return!t&&-1;var c,l=i(n,u);if(t&&o!=o){for(;u>l;)if((c=a[l++])!=c)return!0}else for(;u>l;l++)if((t||l in a)&&a[l]===o)return t||l||0;return!t&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}})),wt=m(((t,e)=>{"use strict";e.exports=function(){}})),St=m((()=>{"use strict";var t=pt(),e=yt().includes,r=w(),i=wt();t({target:"Array",proto:!0,forced:r((function(){return!Array(1).includes()}))},{includes:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")})),_t=m(((t,e)=>{"use strict";var r=B();e.exports=r})),Tt=m(((t,e)=>{"use strict";St();var r=_t();e.exports=r("Array","includes")})),xt=m(((t,e)=>{"use strict";var r=Tt();e.exports=r})),Et=m(((t,e)=>{"use strict";var r=xt();e.exports=r})),kt=m(((t,e)=>{"use strict";var r={};r[et()("toStringTag")]="z",e.exports="[object z]"===String(r)})),$t=m(((t,e)=>{"use strict";var r=kt(),i=k(),s=x(),o=et()("toStringTag"),n=Object,a="Arguments"===s(function(){return arguments}());e.exports=r?s:function(t){var e,r,u;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch{}}(e=n(t),o))?r:a?s(e):"Object"===(u=s(e))&&i(e.callee)?"Arguments":u}})),At=m(((t,e)=>{"use strict";var r=$t(),i=String;e.exports=function(t){if("Symbol"===r(t))throw new TypeError("Cannot convert a Symbol value to a string");return i(t)}})),Pt=m(((t,e)=>{"use strict";var r=gt(),i=At(),s=L(),o=RangeError;e.exports=function(t){var e=i(s(this)),n="",a=r(t);if(a<0||a===1/0)throw new o("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(n+=e);return n}})),Ct=m(((t,e)=>{"use strict";var r=T(),i=mt(),s=At(),o=Pt(),n=L(),a=r(o),u=r("".slice),c=Math.ceil,l=function(t){return function(e,r,o){var l,h,d=s(n(e)),p=i(r),f=d.length,g=void 0===o?" ":s(o);return p<=f||""===g?d:((h=a(g,c((l=p-f)/g.length))).length>l&&(h=u(h,0,l)),t?d+h:h+d)}};e.exports={start:l(!1),end:l(!0)}})),Ot=m(((t,e)=>{"use strict";var r=V();e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)})),Rt=m((()=>{"use strict";var t=pt(),e=Ct().start;t({target:"String",proto:!0,forced:Ot()},{padStart:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})})),Lt=m(((t,e)=>{"use strict";Rt();var r=_t();e.exports=r("String","padStart")})),It=m(((t,e)=>{"use strict";var r=Lt();e.exports=r})),Nt=m(((t,e)=>{"use strict";var r=It();e.exports=r})),Dt=m((()=>{})),Bt=m(((t,e)=>{"use strict";var r=y(),i=V(),s=x(),o=function(t){return i.slice(0,t.length)===t};e.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":r.Bun&&"string"==typeof Bun.version?"BUN":r.Deno&&"object"==typeof Deno.version?"DENO":"process"===s(r.process)?"NODE":r.window&&r.document?"BROWSER":"REST"})),Ft=m(((t,e)=>{"use strict";var r=Bt();e.exports="NODE"===r})),Vt=m(((t,e)=>{"use strict";var r=dt();e.exports=function(t,e,i,s){return s&&s.enumerable?t[e]=i:r(t,e,i),t}})),Mt=m(((t,e)=>{"use strict";var r=T(),i=H();e.exports=function(t,e,s){try{return r(i(Object.getOwnPropertyDescriptor(t,e)[s]))}catch{}}})),Ut=m(((t,e)=>{"use strict";var r=N();e.exports=function(t){return r(t)||null===t}})),jt=m(((t,e)=>{"use strict";var r=Ut(),i=String,s=TypeError;e.exports=function(t){if(r(t))return t;throw new s("Can't set "+i(t)+" as a prototype")}})),qt=m(((t,e)=>{"use strict";var r=Mt(),i=N(),s=L(),o=jt();e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=r(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(r,n){return s(r),o(n),i(r)&&(e?t(r,n):r.__proto__=n),r}}():void 0)})),Wt=m(((t,e)=>{"use strict";var r=kt(),i=$t();e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}})),Ht=m(((t,e)=>{"use strict";var r=kt(),i=ht().f,s=dt(),o=Y(),n=Wt(),a=et()("toStringTag");e.exports=function(t,e,u,c){var l=u?t:t&&t.prototype;l&&(o(l,a)||i(l,a,{configurable:!0,value:e}),c&&!r&&s(l,"toString",n))}})),zt=m(((t,e)=>{"use strict";var r=ht();e.exports=function(t,e,i){return r.f(t,e,i)}})),Qt=m(((t,e)=>{"use strict";var r=B(),i=zt(),s=et(),o=$(),n=s("species");e.exports=function(t){var e=r(t);o&&e&&!e[n]&&i(e,n,{configurable:!0,get:function(){return this}})}})),Kt=m(((t,e)=>{"use strict";var r=F(),i=TypeError;e.exports=function(t,e){if(r(e,t))return t;throw new i("Incorrect invocation")}})),Xt=m(((t,e)=>{"use strict";var r=T(),i=k(),s=G(),o=r(Function.toString);i(s.inspectSource)||(s.inspectSource=function(t){return o(t)}),e.exports=s.inspectSource})),Gt=m(((t,e)=>{"use strict";var r=T(),i=w(),s=k(),o=$t(),n=B(),a=Xt(),u=function(){},c=n("Reflect","construct"),l=/^\s*(?:class|function)\b/,h=r(l.exec),d=!l.test(u),p=function(t){if(!s(t))return!1;try{return c(u,[],t),!0}catch{return!1}},f=function(t){if(!s(t))return!1;switch(o(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!h(l,a(t))}catch{return!0}};f.sham=!0,e.exports=!c||i((function(){var t;return p(p.call)||!p(Object)||!p((function(){t=!0}))||t}))?f:p})),Jt=m(((t,e)=>{"use strict";var r=Gt(),i=W(),s=TypeError;e.exports=function(t){if(r(t))return t;throw new s(i(t)+" is not a constructor")}})),Zt=m(((t,e)=>{"use strict";var r=lt(),i=Jt(),s=R(),o=et()("species");e.exports=function(t,e){var n,a=r(t).constructor;return void 0===a||s(n=r(a)[o])?e:i(n)}})),Yt=m(((t,e)=>{"use strict";var r=B();e.exports=r("document","documentElement")})),te=m(((t,e)=>{"use strict";var r=T();e.exports=r([].slice)})),ee=m(((t,e)=>{"use strict";var r=TypeError;e.exports=function(t,e){if(t<e)throw new r("Not enough arguments");return t}})),re=m(((t,e)=>{"use strict";var r=V();e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)})),ie=m(((t,e)=>{"use strict";var r,i,s,o,n=y(),a=_(),u=ut(),c=k(),l=Y(),h=w(),d=Yt(),p=te(),f=st(),g=ee(),v=re(),m=Ft(),b=n.setImmediate,S=n.clearImmediate,T=n.process,x=n.Dispatch,E=n.Function,$=n.MessageChannel,A=n.String,P=0,C={},O="onreadystatechange";h((function(){r=n.location}));var R=function(t){if(l(C,t)){var e=C[t];delete C[t],e()}},L=function(t){return function(){R(t)}},I=function(t){R(t.data)},N=function(t){n.postMessage(A(t),r.protocol+"//"+r.host)};(!b||!S)&&(b=function(t){g(arguments.length,1);var e=c(t)?t:E(t),r=p(arguments,1);return C[++P]=function(){a(e,void 0,r)},i(P),P},S=function(t){delete C[t]},m?i=function(t){T.nextTick(L(t))}:x&&x.now?i=function(t){x.now(L(t))}:$&&!v?(o=(s=new $).port2,s.port1.onmessage=I,i=u(o.postMessage,o)):n.addEventListener&&c(n.postMessage)&&!n.importScripts&&r&&"file:"!==r.protocol&&!h(N)?(i=N,n.addEventListener("message",I,!1)):i=O in f("script")?function(t){d.appendChild(f("script"))[O]=function(){d.removeChild(this),R(t)}}:function(t){setTimeout(L(t),0)}),e.exports={set:b,clear:S}})),se=m(((t,e)=>{"use strict";var r=y(),i=$(),s=Object.getOwnPropertyDescriptor;e.exports=function(t){if(!i)return r[t];var e=s(r,t);return e&&e.value}})),oe=m(((t,e)=>{"use strict";var r=function(){this.head=null,this.tail=null};r.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}},e.exports=r})),ne=m(((t,e)=>{"use strict";var r=V();e.exports=/ipad|iphone|ipod/i.test(r)&&typeof Pebble<"u"})),ae=m(((t,e)=>{"use strict";var r=V();e.exports=/web0s(?!.*chrome)/i.test(r)})),ue=m(((t,e)=>{"use strict";var r,i,s,o,n,a,u,c=y(),l=se(),h=ut(),d=ie().set,p=oe(),f=re(),g=ne(),v=ae(),m=Ft(),b=c.MutationObserver||c.WebKitMutationObserver,w=c.document,S=c.process,_=c.Promise,T=l("queueMicrotask");T||(a=new p,u=function(){var t,e;for(m&&(t=S.domain)&&t.exit();e=a.get();)try{e()}catch(t){throw a.head&&r(),t}t&&t.enter()},f||m||v||!b||!w?!g&&_&&_.resolve?((o=_.resolve(void 0)).constructor=_,n=h(o.then,o),r=function(){n(u)}):m?r=function(){S.nextTick(u)}:(d=h(d,c),r=function(){d(u)}):(i=!0,s=w.createTextNode(""),new b(u).observe(s,{characterData:!0}),r=function(){s.data=i=!i}),T=function(t){a.head||r(),a.add(t)}),e.exports=T})),ce=m(((t,e)=>{"use strict";e.exports=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch{}}})),le=m(((t,e)=>{"use strict";e.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}})),he=m(((t,e)=>{"use strict";var r=y(),i=k(),s=r.WeakMap;e.exports=i(s)&&/native code/.test(String(s))})),de=m(((t,e)=>{"use strict";var r=J(),i=tt(),s=r("keys");e.exports=function(t){return s[t]||(s[t]=i(t))}})),pe=m(((t,e)=>{"use strict";e.exports={}})),fe=m(((t,e)=>{"use strict";var r,i,s,o,n,a=he(),u=y(),c=N(),l=dt(),h=Y(),d=G(),p=de(),f=pe(),g="Object already initialized",v=u.TypeError,m=u.WeakMap;a||d.state?((o=d.state||(d.state=new m)).get=o.get,o.has=o.has,o.set=o.set,r=function(t,e){if(o.has(t))throw new v(g);return e.facade=t,o.set(t,e),e},i=function(t){return o.get(t)||{}},s=function(t){return o.has(t)}):(f[n=p("state")]=!0,r=function(t,e){if(h(t,n))throw new v(g);return e.facade=t,l(t,n,e),e},i=function(t){return h(t,n)?t[n]:{}},s=function(t){return h(t,n)}),e.exports={set:r,get:i,has:s,enforce:function(t){return s(t)?i(t):r(t,{})},getterFor:function(t){return function(e){var r;if(!c(e)||(r=i(e)).type!==t)throw new v("Incompatible receiver, "+t+" required");return r}}}})),ge=m(((t,e)=>{"use strict";var r=y();e.exports=r.Promise})),ve=m(((t,e)=>{"use strict";var r=y(),i=ge(),s=k(),o=at(),n=Xt(),a=et(),u=Bt(),c=K(),l=M(),h=i&&i.prototype,d=a("species"),p=!1,f=s(r.PromiseRejectionEvent),g=o("Promise",(function(){var t=n(i),e=t!==String(i);if(!e&&66===l||c&&(!h.catch||!h.finally))return!0;if(!l||l<51||!/native code/.test(t)){var r=new i((function(t){t(1)})),s=function(t){t((function(){}),(function(){}))};if((r.constructor={})[d]=s,!(p=r.then((function(){}))instanceof s))return!0}return!(e||"BROWSER"!==u&&"DENO"!==u||f)}));e.exports={CONSTRUCTOR:g,REJECTION_EVENT:f,SUBCLASSING:p}})),me=m(((t,e)=>{"use strict";var r=H(),i=TypeError,s=function(t){var e,s;this.promise=new t((function(t,r){if(void 0!==e||void 0!==s)throw new i("Bad Promise constructor");e=t,s=r})),this.resolve=r(e),this.reject=r(s)};e.exports.f=function(t){return new s(t)}})),be=m((()=>{"use strict";var t,e,r,i,s=pt(),o=K(),n=Ft(),a=y(),u=D(),c=A(),l=Vt(),h=qt(),d=Ht(),p=Qt(),f=H(),g=k(),v=N(),m=Kt(),b=Zt(),w=ie().set,S=ue(),_=ce(),T=le(),x=oe(),E=fe(),$=ge(),P=ve(),C=me(),O="Promise",R=P.CONSTRUCTOR,L=P.REJECTION_EVENT,I=P.SUBCLASSING,B=E.getterFor(O),F=E.set,V=$&&$.prototype,M=$,U=V,j=a.TypeError,q=a.document,W=a.process,z=C.f,Q=z,X=!!(q&&q.createEvent&&a.dispatchEvent),G="unhandledrejection",J=function(t){var e;return!(!v(t)||!g(e=t.then))&&e},Z=function(t,e){var r,i,s,o=e.value,n=1===e.state,a=n?t.ok:t.fail,u=t.resolve,l=t.reject,h=t.domain;try{a?(n||(2===e.rejection&&it(e),e.rejection=1),!0===a?r=o:(h&&h.enter(),r=a(o),h&&(h.exit(),s=!0)),r===t.promise?l(new j("Promise-chain cycle")):(i=J(r))?c(i,r,u,l):u(r)):l(o)}catch(t){h&&!s&&h.exit(),l(t)}},Y=function(t,e){t.notified||(t.notified=!0,S((function(){for(var r,i=t.reactions;r=i.get();)Z(r,t);t.notified=!1,e&&!t.rejection&&et(t)})))},tt=function(t,e,r){var i,s;X?((i=q.createEvent("Event")).promise=e,i.reason=r,i.initEvent(t,!1,!0),a.dispatchEvent(i)):i={promise:e,reason:r},!L&&(s=a["on"+t])?s(i):t===G&&_("Unhandled promise rejection",r)},et=function(t){c(w,a,(function(){var e,r=t.facade,i=t.value;if(rt(t)&&(e=T((function(){n?W.emit("unhandledRejection",i,r):tt(G,r,i)})),t.rejection=n||rt(t)?2:1,e.error))throw e.value}))},rt=function(t){return 1!==t.rejection&&!t.parent},it=function(t){c(w,a,(function(){var e=t.facade;n?W.emit("rejectionHandled",e):tt("rejectionhandled",e,t.value)}))},st=function(t,e,r){return function(i){t(e,i,r)}},ot=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,Y(t,!0))},nt=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw new j("Promise can't be resolved itself");var i=J(e);i?S((function(){var r={done:!1};try{c(i,e,st(nt,r,t),st(ot,r,t))}catch(e){ot(r,e,t)}})):(t.value=e,t.state=1,Y(t,!1))}catch(e){ot({done:!1},e,t)}}};if(R&&(U=(M=function(e){m(this,U),f(e),c(t,this);var r=B(this);try{e(st(nt,r),st(ot,r))}catch(t){ot(r,t)}}).prototype,(t=function(t){F(this,{type:O,done:!1,notified:!1,parent:!1,reactions:new x,rejection:!1,state:0,value:null})}).prototype=l(U,"then",(function(t,e){var r=B(this),i=z(b(this,M));return r.parent=!0,i.ok=!g(t)||t,i.fail=g(e)&&e,i.domain=n?W.domain:void 0,0===r.state?r.reactions.add(i):S((function(){Z(i,r)})),i.promise})),e=function(){var e=new t,r=B(e);this.promise=e,this.resolve=st(nt,r),this.reject=st(ot,r)},C.f=z=function(t){return t===M||t===r?new e(t):Q(t)},!o&&g($)&&V!==Object.prototype)){i=V.then,I||l(V,"then",(function(t,e){var r=this;return new M((function(t,e){c(i,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete V.constructor}catch{}h&&h(V,U)}s({global:!0,constructor:!0,wrap:!0,forced:R},{Promise:M}),r=u.Promise,d(M,O,!1,!0),p(O)})),ye=m(((t,e)=>{"use strict";e.exports={}})),we=m(((t,e)=>{"use strict";var r=et(),i=ye(),s=r("iterator"),o=Array.prototype;e.exports=function(t){return void 0!==t&&(i.Array===t||o[s]===t)}})),Se=m(((t,e)=>{"use strict";var r=$t(),i=z(),s=R(),o=ye(),n=et()("iterator");e.exports=function(t){if(!s(t))return i(t,n)||i(t,"@@iterator")||o[r(t)]}})),_e=m(((t,e)=>{"use strict";var r=A(),i=H(),s=lt(),o=W(),n=Se(),a=TypeError;e.exports=function(t,e){var u=arguments.length<2?n(t):e;if(i(u))return s(r(u,t));throw new a(o(t)+" is not iterable")}})),Te=m(((t,e)=>{"use strict";var r=A(),i=lt(),s=z();e.exports=function(t,e,o){var n,a;i(t);try{if(!(n=s(t,"return"))){if("throw"===e)throw o;return o}n=r(n,t)}catch(t){a=!0,n=t}if("throw"===e)throw o;if(a)throw n;return i(n),o}})),xe=m(((t,e)=>{"use strict";var r=ut(),i=A(),s=lt(),o=W(),n=we(),a=bt(),u=F(),c=_e(),l=Se(),h=Te(),d=TypeError,p=function(t,e){this.stopped=t,this.result=e},f=p.prototype;e.exports=function(t,e,g){var v,m,b,y,w,S,_,T=g&&g.that,x=!(!g||!g.AS_ENTRIES),E=!(!g||!g.IS_RECORD),k=!(!g||!g.IS_ITERATOR),$=!(!g||!g.INTERRUPTED),A=r(e,T),P=function(t){return v&&h(v,"normal"),new p(!0,t)},C=function(t){return x?(s(t),$?A(t[0],t[1],P):A(t[0],t[1])):$?A(t,P):A(t)};if(E)v=t.iterator;else if(k)v=t;else{if(!(m=l(t)))throw new d(o(t)+" is not iterable");if(n(m)){for(b=0,y=a(t);y>b;b++)if((w=C(t[b]))&&u(f,w))return w;return new p(!1)}v=c(t,m)}for(S=E?t.next:v.next;!(_=i(S,v)).done;){try{w=C(_.value)}catch(t){h(v,"throw",t)}if("object"==typeof w&&w&&u(f,w))return w}return new p(!1)}})),Ee=m(((t,e)=>{"use strict";var r,i,s=et()("iterator"),o=!1;try{r=0,(i={next:function(){return{done:!!r++}},return:function(){o=!0}})[s]=function(){return this},Array.from(i,(function(){throw 2}))}catch{}e.exports=function(t,e){try{if(!e&&!o)return!1}catch{return!1}var r=!1;try{var i={};i[s]=function(){return{next:function(){return{done:r=!0}}}},t(i)}catch{}return r}})),ke=m(((t,e)=>{"use strict";var r=ge(),i=Ee(),s=ve().CONSTRUCTOR;e.exports=s||!i((function(t){r.all(t).then(void 0,(function(){}))}))})),$e=m((()=>{"use strict";var t=pt(),e=A(),r=H(),i=me(),s=le(),o=xe();t({target:"Promise",stat:!0,forced:ke()},{all:function(t){var n=this,a=i.f(n),u=a.resolve,c=a.reject,l=s((function(){var i=r(n.resolve),s=[],a=0,l=1;o(t,(function(t){var r=a++,o=!1;l++,e(i,n,t).then((function(t){o||(o=!0,s[r]=t,--l||u(s))}),c)})),--l||u(s)}));return l.error&&c(l.value),a.promise}})})),Ae=m((()=>{"use strict";var t,e=pt(),r=K(),i=ve().CONSTRUCTOR,s=ge(),o=B(),n=k(),a=Vt(),u=s&&s.prototype;e({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(t){return this.then(void 0,t)}}),!r&&n(s)&&(t=o("Promise").prototype.catch,u.catch!==t&&a(u,"catch",t,{unsafe:!0}))})),Pe=m((()=>{"use strict";var t=pt(),e=A(),r=H(),i=me(),s=le(),o=xe();t({target:"Promise",stat:!0,forced:ke()},{race:function(t){var n=this,a=i.f(n),u=a.reject,c=s((function(){var i=r(n.resolve);o(t,(function(t){e(i,n,t).then(a.resolve,u)}))}));return c.error&&u(c.value),a.promise}})})),Ce=m((()=>{"use strict";var t=pt(),e=me();t({target:"Promise",stat:!0,forced:ve().CONSTRUCTOR},{reject:function(t){var r=e.f(this);return(0,r.reject)(t),r.promise}})})),Oe=m(((t,e)=>{"use strict";var r=lt(),i=N(),s=me();e.exports=function(t,e){if(r(t),i(e)&&e.constructor===t)return e;var o=s.f(t);return(0,o.resolve)(e),o.promise}})),Re=m((()=>{"use strict";var t=pt(),e=B(),r=K(),i=ge(),s=ve().CONSTRUCTOR,o=Oe(),n=e("Promise"),a=r&&!s;t({target:"Promise",stat:!0,forced:r||s},{resolve:function(t){return o(a&&this===n?i:this,t)}})})),Le=m((()=>{"use strict";be(),$e(),Ae(),Pe(),Ce(),Re()})),Ie=m((()=>{"use strict";var t,e=pt(),r=K(),i=ge(),s=w(),o=B(),n=k(),a=Zt(),u=Oe(),c=Vt(),l=i&&i.prototype;e({target:"Promise",proto:!0,real:!0,forced:!!i&&s((function(){l.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=a(this,o("Promise")),r=n(t);return this.then(r?function(r){return u(e,t()).then((function(){return r}))}:t,r?function(r){return u(e,t()).then((function(){throw r}))}:t)}}),!r&&n(i)&&(t=o("Promise").prototype.finally,l.finally!==t&&c(l,"finally",t,{unsafe:!0}))})),Ne=m(((t,e)=>{"use strict";Dt(),Le(),Ie();var r=_t();e.exports=r("Promise","finally")})),De=m(((t,e)=>{"use strict";var r=Ne();e.exports=r})),Be=m(((t,e)=>{"use strict";var r=De();e.exports=r})),Fe=m(((t,e)=>{"use strict";var r=w();e.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))})),Ve=m(((t,e)=>{"use strict";var r=Y(),i=k(),s=Z(),o=de(),n=Fe(),a=o("IE_PROTO"),u=Object,c=u.prototype;e.exports=n?u.getPrototypeOf:function(t){var e=s(t);if(r(e,a))return e[a];var o=e.constructor;return i(o)&&e instanceof o?o.prototype:e instanceof u?c:null}})),Me=m(((t,e)=>{"use strict";var r=T(),i=Y(),s=I(),o=yt().indexOf,n=pe(),a=r([].push);e.exports=function(t,e){var r,u=s(t),c=0,l=[];for(r in u)!i(n,r)&&i(u,r)&&a(l,r);for(;e.length>c;)i(u,r=e[c++])&&(~o(l,r)||a(l,r));return l}})),Ue=m(((t,e)=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),je=m(((t,e)=>{"use strict";var r=Me(),i=Ue();e.exports=Object.keys||function(t){return r(t,i)}})),qe=m(((t,e)=>{"use strict";var r=$(),i=w(),s=T(),o=Ve(),n=je(),a=I(),u=s(P().f),c=s([].push),l=r&&i((function(){var t=Object.create(null);return t[2]=2,!u(t,2)})),h=function(t){return function(e){for(var i,s=a(e),h=n(s),d=l&&null===o(s),p=h.length,f=0,g=[];p>f;)i=h[f++],(!r||(d?i in s:u(s,i)))&&c(g,t?[i,s[i]]:s[i]);return g}};e.exports={entries:h(!0),values:h(!1)}})),We=m((()=>{"use strict";var t=pt(),e=qe().entries;t({target:"Object",stat:!0},{entries:function(t){return e(t)}})})),He=m(((t,e)=>{"use strict";We();var r=D();e.exports=r.Object.entries})),ze=m(((t,e)=>{"use strict";var r=He();e.exports=r})),Qe=m(((t,e)=>{"use strict";var r=ze();e.exports=r})),Ke=m(((t,e)=>{"use strict";var r=$(),i=Y(),s=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,n=i(s,"name"),a=n&&"something"===function(){}.name,u=n&&(!r||r&&o(s,"name").configurable);e.exports={EXISTS:n,PROPER:a,CONFIGURABLE:u}})),Xe=m((t=>{"use strict";var e=$(),r=ct(),i=ht(),s=lt(),o=I(),n=je();t.f=e&&!r?Object.defineProperties:function(t,e){s(t);for(var r,a=o(e),u=n(e),c=u.length,l=0;c>l;)i.f(t,r=u[l++],a[r]);return t}})),Ge=m(((t,e)=>{"use strict";var r,i=lt(),s=Xe(),o=Ue(),n=pe(),a=Yt(),u=st(),c=de(),l="prototype",h="script",d=c("IE_PROTO"),p=function(){},f=function(t){return"<"+h+">"+t+"</"+h+">"},g=function(t){t.write(f("")),t.close();var e=t.parentWindow.Object;return t=null,e},v=function(){try{r=new ActiveXObject("htmlfile")}catch{}v=typeof document<"u"?document.domain&&r?g(r):function(){var t,e=u("iframe"),r="java"+h+":";return e.style.display="none",a.appendChild(e),e.src=String(r),(t=e.contentWindow.document).open(),t.write(f("document.F=Object")),t.close(),t.F}():g(r);for(var t=o.length;t--;)delete v[l][o[t]];return v()};n[d]=!0,e.exports=Object.create||function(t,e){var r;return null!==t?(p[l]=i(t),r=new p,p[l]=null,r[d]=t):r=v(),void 0===e?r:s.f(r,e)}})),Je=m(((t,e)=>{"use strict";var r,i,s,o=w(),n=k(),a=N(),u=Ge(),c=Ve(),l=Vt(),h=et(),d=K(),p=h("iterator"),f=!1;[].keys&&("next"in(s=[].keys())?(i=c(c(s)))!==Object.prototype&&(r=i):f=!0),!a(r)||o((function(){var t={};return r[p].call(t)!==t}))?r={}:d&&(r=u(r)),n(r[p])||l(r,p,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:f}})),Ze=m(((t,e)=>{"use strict";var r=Je().IteratorPrototype,i=Ge(),s=C(),o=Ht(),n=ye(),a=function(){return this};e.exports=function(t,e,u,c){var l=e+" Iterator";return t.prototype=i(r,{next:s(+!c,u)}),o(t,l,!1,!0),n[l]=a,t}})),Ye=m(((t,e)=>{"use strict";var r=pt(),i=A(),s=K(),o=Ke(),n=k(),a=Ze(),u=Ve(),c=qt(),l=Ht(),h=dt(),d=Vt(),p=et(),f=ye(),g=Je(),v=o.PROPER,m=o.CONFIGURABLE,b=g.IteratorPrototype,y=g.BUGGY_SAFARI_ITERATORS,w=p("iterator"),S="keys",_="values",T="entries",x=function(){return this};e.exports=function(t,e,o,p,g,E,k){a(o,e,p);var $,A,P,C=function(t){if(t===g&&N)return N;if(!y&&t&&t in L)return L[t];switch(t){case S:case _:case T:return function(){return new o(this,t)}}return function(){return new o(this)}},O=e+" Iterator",R=!1,L=t.prototype,I=L[w]||L["@@iterator"]||g&&L[g],N=!y&&I||C(g),D="Array"===e&&L.entries||I;if(D&&(($=u(D.call(new t)))!==Object.prototype&&$.next&&(!s&&u($)!==b&&(c?c($,b):n($[w])||d($,w,x)),l($,O,!0,!0),s&&(f[O]=x))),v&&g===_&&I&&I.name!==_&&(!s&&m?h(L,"name",_):(R=!0,N=function(){return i(I,this)})),g)if(A={values:C(_),keys:E?N:C(S),entries:C(T)},k)for(P in A)(y||R||!(P in L))&&d(L,P,A[P]);else r({target:e,proto:!0,forced:y||R},A);return(!s||k)&&L[w]!==N&&d(L,w,N,{name:g}),f[e]=N,A}})),tr=m(((t,e)=>{"use strict";e.exports=function(t,e){return{value:t,done:e}}})),er=m(((t,e)=>{"use strict";var r=I(),i=wt(),s=ye(),o=fe(),n=ht().f,a=Ye(),u=tr(),c=K(),l=$(),h="Array Iterator",d=o.set,p=o.getterFor(h);e.exports=a(Array,"Array",(function(t,e){d(this,{type:h,target:r(t),index:0,kind:e})}),(function(){var t=p(this),e=t.target,r=t.index++;if(!e||r>=e.length)return t.target=null,u(void 0,!0);switch(t.kind){case"keys":return u(r,!1);case"values":return u(e[r],!1)}return u([r,e[r]],!1)}),"values");var f=s.Arguments=s.Array;if(i("keys"),i("values"),i("entries"),!c&&l&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),rr=m(((t,e)=>{"use strict";var r=$(),i=ht(),s=C();e.exports=function(t,e,o){r?i.f(t,e,s(0,o)):t[e]=o}})),ir=m((()=>{"use strict";var t=pt(),e=xe(),r=rr();t({target:"Object",stat:!0},{fromEntries:function(t){var i={};return e(t,(function(t,e){r(i,t,e)}),{AS_ENTRIES:!0}),i}})})),sr=m(((t,e)=>{"use strict";er(),ir();var r=D();e.exports=r.Object.fromEntries})),or=m(((t,e)=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),nr=m((()=>{"use strict";er();var t,e=or(),r=y(),i=Ht(),s=ye();for(t in e)i(r[t],t),s[t]=s.Array})),ar=m(((t,e)=>{"use strict";var r=sr();nr(),e.exports=r})),ur=m(((t,e)=>{"use strict";var r=ar();e.exports=r})),cr=m((()=>{"use strict";var t=pt(),e=qe().values;t({target:"Object",stat:!0},{values:function(t){return e(t)}})})),lr=m(((t,e)=>{"use strict";cr();var r=D();e.exports=r.Object.values})),hr=m(((t,e)=>{"use strict";var r=lr();e.exports=r})),dr=m(((t,e)=>{"use strict";var r=hr();e.exports=r})),pr=b(Et(),1),fr=(t,e,r)=>{if("function"==typeof t.canParse)return t.canParse(e,r);try{return new t(e,r),!0}catch{return!1}},gr=((o=gr||{}).PROD="prod",o.VK_ALIAS="vk_alias",o.VIDEOTEST="videotest",o.TEST="test",o.OKCDN="okcdn",o.AUTO="auto",o),vr=((s=vr||{}).Q144P="mobile",s.Q240P="lowest",s.Q360P="low",s.Q480P="medium",s.Q720P="high",s.Q1080P="fullhd",s.Q1440P="quadhd",s.Q2160P="ultrahd",s.UNKNOWN="unknown",s),mr=((i=mr||{}).MP4="mp4",i.DASH="dash",i.DASH_SEP="dash_sep",i.ONDEMAND_DASH="ondemand_dash",i.HLS="hls",i.HLS_FMP4="hls_fmp4",i.ONDEMAND_HLS="ondemand_hls",i.WEBM="webm",i.AV1="av1",i.ONDEMAND_DASH_LIVE="ondemand_dash_live",i.ONDEMAND_HLS_LIVE="ondemand_hls_live",i.WEBRTC="webrtc",i.UNKNOWN="unknown",i.RTMP="rtmp",i),br=((n=br||{}).HTTP1="http1",n.HTTP2="http2",n.HTTP3="http3",n),yr=((u=yr||{}).SLIDER="slider",u.DOUBLE_TAP="double_tap",u.TIME_CODE="time_code",u.EPISODE="episode",u.REWIND="rewind",u.LIVE="live",u.UNKNOWN="unknown",u),wr=((a=wr||{}).GRAPH_SHOW="iGraphShow",a.GRAPH_HIDE="iGraphHide",a.NEXT_AREA="iNextChapterArea",a.NEXT_BUTTON="iNextChapterBtn",a.WATCH_AGAIN="iWatchAgainBtn",a),Sr={action_play:"ap",action_play_interactive:"api",first_bytes:"fb",player_ready:"pr",first_frame:"ff",seek:"sk",watch_coverage_record:"wr",watch_coverage_live:"wl",empty_buffer:"eb",action_stop:"as",close_at_empty_buffer:"cb",content_error:"er",player_interface_click:"pc",next_movie:"nm",track_switch:"ts",failover:"fo",quality:"qt"},_r={vsid:"si",isid:"is",vid:"vi",place:"pl",quality:"qt",cdn_host:"ch",stat_type:"st",param:"pm",vk_app_id:"va",track_code:"tc",connection_type:"cnt",connection_reused:"cr",cached_data:"cd",live:"lv",muted:"mu",mode:"mo",subtitles:"sb",failover:"fo",download_speed:"ds",manual_quality:"mq",ref_domain:"rd",direct_url:"du"},Tr={unknown:"un",mobile:"m",lowest:"ls",low:"l",medium:"md",high:"h",fullhd:"f",quadhd:"q",ultrahd:"u"},xr={pip:"pi",fullscreen:"fs",external:"ex",prefetch:"pr",airplay:"ap",chromecast:"cc",invisible:"iv",minimal:"minimal"},Er={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},kr={apiEnv:"vk_alias",apiKey:"CIOPGQJGDIHBABABA",apiBaseUrl:null,requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageInterval:15e3,disabledOperations:["quality"],disabledCustomFields:[],shorten:!0,maxLoops:100,embedUrlParams:[],useBeacon:!0,synchronizeTime:!0,debugLog:!1,clearStorageAtUnload:!0,useVKComIsMobileLogic:!1,backoff:{start:1e3,factor:1.5,max:3e5,random:.1},useKeepalive:!1,watchCoverageTimeoutFix:!1};var $r,Ar=b(Nt(),1),Pr=class t{static getVSID(){return t.vsid}static generateVSID(){return t.vsid=(0,Ar.default)(Math.floor(Math.random()*2**32).toString(36),13,"0"),t.vsid}},Cr=b(Be(),1),Or=b(Qe(),1),Rr=b(ur(),1),Lr=t=>{let{operation:e,custom:r}=t,i=(0,Rr.default)((0,Or.default)(r).map((([t,e])=>{let r=e;return e&&("mode"===t?r=xr[e]??e:"quality"===t&&(r=Tr[e]??e)),[_r[t]??t,r]})));return{...t,operation:Sr[e]??e,custom:i}},Ir="1.0.95",Nr=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,Dr=class{async authorize(t){return this.authToken=t??await this.refreshAuthToken(),this._authorizeWithBackoff()}logBeacon(t){let e=this.createLogParams(t),r=this.sessionKey;r&&(this.params.apiTransport.sendBeacon("log.externalLog",e,r)||this.logRequest(t).catch((()=>{})))}async logRequest(t){let e="log.externalLog",r=this.createLogParams(t),i=this.sessionKey??await this._authorizeWithBackoff();if(!i)return;let s=async(t,o=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(e,r,i)}catch(r){if(!r||!("error_code"in r))return void this.params.error$.next({id:"logRequestUnknown",category:c.h.NETWORK,message:`Unknown ${e} error`,thrown:r});let i=r?.error_code;switch(i){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this._authorizeWithBackoff(),o>0?s(t,o-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this._authorizeWithBackoff(),o>0?s(t,o-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${i}`,category:c.h.EXTERNAL_API,message:`${e} error`,data:r})}}};return s(t)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,Cr.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(t){let e="WEB",r=!1,i=`@vkontakte/videoplayer-statistics:${Ir}`;if(this.params.config.useVKComIsMobileLogic){let{appVersion:t}=window.navigator;r=Nr.test(t)}else this.params.mobile&&(r=!0);return r&&(e="M_WEB"),this.params.vktvVersion&&(e="SMART_TV",i=this.params.vktvVersion),{collector:"ok.mobile.apps.video",data:JSON.stringify({application:i,platform:e,items:this.params.config.shorten?t.map(Lr):t})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();let t=(0,c.rX)(this.consequentAuthErrors,this.params.config.backoff);return new Promise((e=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{(0,Cr.default)(this._authorize().then(e).catch((t=>this.params.error$.next({id:"AuthorizeBackoff",category:c.h.NETWORK,message:"Otherwise unhandled error in authorization",thrown:t}))),(()=>this.backoffTimeoutId=0))}),t))}))}async _authorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let t={session_data:{version:2,device_id:this.params.deviceId,client_version:Ir.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(t.session_data.auth_token=this.authToken,t.session_data.version=3),this.authorizePromise=(0,Cr.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",t).then((t=>((!t||!t.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:c.h.EXTERNAL_API,message:"No session key",data:t}),this.sessionKey=t?.session_key??void 0,this.sessionKey))).catch((async t=>{this.sessionKey=void 0;let e=t?.error_code;if(401===e)return this.authToken=await this.refreshAuthToken(),this._authorizeWithBackoff();e?this.params.error$.next({id:`Authorize#${e}`,category:c.h.EXTERNAL_API,message:"authorize error",data:t}):this.params.error$.next({id:"AuthorizeUnknown",category:c.h.NETWORK,message:"authorize error",thrown:t})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}constructor(t){this.consequentAuthErrors=0,this.authorized$=new c.Ot(!1),this.params=t}},{NativeAbortSignal:Br,NativeAbortController:Fr}={NativeAbortSignal:($r=typeof self<"u"?self:global).AbortSignal,NativeAbortController:$r.AbortController};var Vr=class{addEventListener(t,e,r){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push({callback:e,options:r})}removeEventListener(t,e){if(!(t in this.listeners))return;let r=this.listeners[t];for(let t=0,i=r.length;t<i;t++)if(r[t].callback===e)return void r.splice(t,1)}dispatchEvent(t){if(!(t.type in this.listeners))return;let e=this.listeners[t.type].slice();for(let r=0,i=e.length;r<i;r++){let i=e[r];try{i.callback.call(this,t)}catch(t){Promise.resolve().then((()=>{throw t}))}i.options&&i.options.once&&this.removeEventListener(t.type,i.callback)}return!t.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Mr=class extends Vr{toString(){return"[object AbortSignal]"}dispatchEvent(t){"abort"===t.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,t)),super.dispatchEvent(t)}throwIfAborted(){let{aborted:t,reason:e="Aborted"}=this;if(t)throw e}static timeout(t){let e=new Ur;return setTimeout((()=>e.abort(new DOMException(`This signal is timeout in ${t}ms`,"TimeoutError"))),t),e.signal}static any(t){let e=new Ur;function r(){e.abort(this.reason),function(){for(let e of t)e.removeEventListener("abort",r)}()}for(let i of t){if(i.aborted){e.abort(i.reason);break}i.addEventListener("abort",r)}return e.signal}constructor(){super(),this.listeners||Vr.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Ur=class{abort(t){let e=function(t){if(void 0===t)if(typeof document>"u")(t=new Error("This operation was aborted")).name="AbortError";else try{t=new DOMException("signal is aborted without reason"),Object.defineProperty(t,"name",{value:"AbortError"})}catch{(t=new Error("This operation was aborted")).name="AbortError"}return t}(t),r=function(t){let e;try{e=new Event("abort")}catch{typeof document<"u"?document.createEvent?(e=document.createEvent("Event"),e.initEvent("abort",!1,!1)):(e=document.createEventObject(),e.type="abort"):e={type:"abort",bubbles:!1,cancelable:!1}}return e.reason=t,e}(e);this.signal.reason=e,this.signal.dispatchEvent(r)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Mr,writable:!0,configurable:!0})}};function jr(t){return t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof t.Request&&!t.Request.prototype.hasOwnProperty("signal")||!t.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Ur.prototype[Symbol.toStringTag]="AbortController",Mr.prototype[Symbol.toStringTag]="AbortSignal");var qr="fetch"in window&&jr({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Wr=qr?function(t){"function"==typeof t&&(t={fetch:t});let{fetch:e,Request:r=e.Request,AbortController:i,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s=!1}=t;if(!jr({fetch:e,Request:r,AbortController:i,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s}))return{fetch:e,Request:o};let o=r;(o&&!o.prototype.hasOwnProperty("signal")||s)&&(o=function(t,e){let i;e&&e.signal&&(i=e.signal,delete e.signal);let s=new r(t,e);return i&&Object.defineProperty(s,"signal",{writable:!1,enumerable:!1,configurable:!0,value:i}),s},o.prototype=r.prototype);let n=e;return{fetch:(t,e)=>{let r=o&&o.prototype.isPrototypeOf(t)?t.signal:e?e.signal:void 0;if(r){let i;try{i=new DOMException("Aborted","AbortError")}catch{i=new Error("Aborted"),i.name="AbortError"}if(r.aborted)return Promise.reject(i);let s=new Promise(((t,e)=>{r.addEventListener("abort",(()=>e(i)),{once:!0})}));return e&&e.signal&&delete e.signal,Promise.race([s,n(t,e)])}return n(t,e)},Request:o}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Hr=qr?Wr.fetch:window.fetch,zr=(qr?Wr.Request:window.Request,qr||window.AbortController,qr||window.AbortSignal,b(Et(),1)),Qr=b(Qe(),1),Kr=class{async resolveApiBaseUrl(){if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let t=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),e=(await(await Hr(t,{method:"GET",mode:"cors",cache:"no-cache"})).json())?.Answer[0]?.data;if(!e)throw new Error("Wrong DNS response");return e}catch(t){return this.params.error$.next({id:"OneStat:ApiTransport:resolveApiBaseUrl",category:c.h.NETWORK,message:"Unhandled resolve api base url error",thrown:t}),Er.vk_alias}finally{this.isApiBaseUrlFetched=!0}}sendBeacon(t,e,r){if(!window.Blob||!window.navigator.sendBeacon)return!1;let i=this._prepareQueryParams({method:t,queryParams:e,sessionKey:r}),s=new window.Blob([i.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,s)}catch(r){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:c.h.NETWORK,message:"Unhandled beacon error",thrown:r,data:{method:t,params:e}})}return!1}async sendRequest(t,e,r){let i=(0,c.tB)(),s=s=>{s instanceof TypeError&&(0,zr.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],s.message)?this.params.error$.next({id:"Network",category:c.h.NETWORK,message:"Request failed",thrown:s}):this.params.error$.next({id:"OneStat:ApiTransport:sendRequest",category:c.h.NETWORK,message:"Unhandled request error",thrown:s,data:{method:t,params:e,sessionKey:r,time:(0,c.tB)()-i}})};this.apiBaseUrl=await this.resolveApiBaseUrl();let o={method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:this._prepareQueryParams({method:t,queryParams:e,sessionKey:r})};return this.params.config.useKeepalive&&(o.keepalive=!0),Hr(`${this.apiBaseUrl}/fb.do`,o).then((t=>{let e=0===Number(t.headers.get("content-length")),r=new Date(t.headers.get("date")??"").getTime(),o=(0,c.tB)()-i;if(isFinite(r)&&this.timeSynchronisation?.addServerTime(r,o),!e)return t.json().then((t=>Object.prototype.hasOwnProperty.call(t,"error_msg")?Promise.reject(t):t),s)}),s)}_prepareQueryParams(t){let e=new URLSearchParams({format:"JSON",method:t.method,application_key:this.apiKey});return void 0!==t.sessionKey&&e.append("session_key",t.sessionKey),(0,Qr.default)(t.queryParams).forEach((([t,r])=>e.append(t,"string"==typeof r?r:JSON.stringify(r)))),e}constructor(t){this.params=t,this.apiKey=t.config.apiKey,this.apiEnv=t.config.apiEnv,this.apiBaseUrl=t.config.apiBaseUrl??Er[this.apiEnv],this.timeSynchronisation=t.timeSynchronisation,this.isApiBaseUrlFetched=!1}},Xr=b(Et(),1),Gr=b(Qe(),1),Jr="onestat_events",Zr=t=>e=>e.timestamp+t>=(0,c.tB)(),Yr=class{safeFlush(){try{this.flush()}catch(t){this.error$.next({id:"LoggerError",category:c.h.WTF,message:t?String(t):"Unknown logger error",thrown:t})}}readFromStorage(){let t=c.RW.get(Jr);try{return t?JSON.parse(t):{}}catch{}return{}}addToStorage(t){if(!this.userSalt)return void this.unsaltedStorage.push(t);let e=this.readFromStorage(),r=(e[this.userSalt]??[]).filter(Zr(this.params.config.storageExpiration));c.RW.set(Jr,JSON.stringify({...e,[this.userSalt]:[...r,t]}))}getFromStorage(){return this.userSalt?(this.readFromStorage()[this.userSalt]??[]).filter(Zr(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let t=this.readFromStorage();delete t[this.userSalt],c.RW.set(Jr,JSON.stringify(t))}housekeepStorage(){let t=this.readFromStorage();for(let[e,r]of(0,Gr.default)(t)){let i=r.filter(Zr(this.params.config.storageExpiration));i.length?t[e]=i:delete t[e],this.loggerDebugLog({message:`${r.length} retrieved from storage, ${i.length} of them actual`})}c.RW.set(Jr,JSON.stringify(t))}log(t){this.addToStorage(t),!this.isPaused&&(this.isUrgent(t)?this.flush():this.lastVsid!==t.custom.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=t.custom.vsid)}flush({wantBeacon:t,clearStorage:e}={wantBeacon:!1,clearStorage:!0}){let r=this.getFromStorage();0!==r.length&&(this.api.authorized$.getValue()?(t&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${r.length} events through beacon`}),this.api.logBeacon(r)):(this.loggerDebugLog({message:`Flushing ${r.length} events`}),this.api.logRequest(r)),e&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}constructor(t){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=t=>{let{operation:e}=t;return(0,Xr.default)(["action_play","watch_coverage_record","watch_coverage_live"],e)},this.params=t,this.api=t.api,this.error$=t.error$,this.userSalt=t.userSalt,this.loggerDebugLog=t.debugLogger.createComponentLog("stat logger"),this.firstFlush=(0,c.eD)((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let e=c.RW.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=(0,c.eD)((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:e}),this.subscription=this.api.authorized$.subscribe((t=>{t&&this.debouncedFlush()})),this.housekeepStorage()}},ti=t=>t&&{[l.Xt.HTTP1]:"http1",[l.Xt.HTTP2]:"http2",[l.Xt.QUIC]:"http3"}[t],ei=t=>{if(void 0!==t)switch(t){case l.T4.MPEG:return"mp4";case l.T4.DASH:case l.T4.DASH_LIVE:case l.T4.DASH_STREAMS:return"dash";case l.T4.DASH_SEP:return"dash_sep";case l.T4.DASH_ONDEMAND:return"ondemand_dash";case l.T4.DASH_WEBM:case l.T4.DASH_LIVE_WEBM:return"webm";case l.T4.DASH_WEBM_AV1:return"av1";case l.T4.DASH_LIVE_CMAF:return"ondemand_dash_live";case l.T4.HLS:case l.T4.HLS_LIVE:return"hls";case l.T4.HLS_FMP4:return"hls_fmp4";case l.T4.HLS_ONDEMAND:return"ondemand_hls";case l.T4.HLS_LIVE_CMAF:return"ondemand_hls_live";case l.T4.WEB_RTC_LIVE:return"webrtc";default:return(0,c.xb)(t)}},ri=(t,e)=>{if(e)return"minimal";switch(t){case void 0:case l.ui.NONE:case l.ui.INLINE:return;case l.ui.FULLSCREEN:return"fullscreen";case l.ui.SECOND_SCREEN:return"chromecast";case l.ui.PIP:return"pip";case l.ui.INVISIBLE:return"invisible";default:return(0,c.xb)(t)}},ii=t=>{switch(t){case"slow-2g":case"2g":return"poor";case"3g":return"good";case"4g":return"excellent"}},si=class{getOffset(){return this.offset??0}setOffset(t){this.offset=t}now(){return Date.now()+(this.offset??0)}date(t=new Date){return t.setTime(t.getTime()+(this.offset??0)),t}addServerTime(t,e){let r=t-Date.now()-e/2;Math.abs(r)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(r):this.offset=Math.round(.2*r+.8*this.offset)}constructor(t){this.offset=void 0,this.offset=t}},oi=b(Nt(),1),ni=(t,e,r)=>{let i=new c.B7,s=i.pipe((0,c.sg)(0),(0,c.jX)()),o=!1,n=!1,a=!1;return e(t.inPiP$,(t=>{o=t,i.next(t?l.ui.PIP:n?l.ui.FULLSCREEN:a?l.ui.INLINE:void 0)})),e(t.inFullscreen$,(t=>{n=t,i.next(t?l.ui.FULLSCREEN:o?l.ui.PIP:a?l.ui.INLINE:void 0)})),r&&e(r.info.surface$,(t=>{switch(t){case l.ui.SECOND_SCREEN:case l.ui.NONE:case l.ui.INLINE:!n&&!o&&(t===l.ui.INLINE&&(a=!0),i.next(t))}})),{surface$:s}},ai="_one-stat_deviceId",ui=()=>{let t=new c.yU;return{subscription:t,subscribe:(e,r)=>{e&&t.add(e.subscribe(r))}}},ci=class{get vsid$(){return new c.Ot(Pr.getVSID())}updateContext(t){this.statContext={...this.statContext,...t}}attachTo(t){let e,r=new c.yU,i=(t,e)=>r.add(t.subscribe(e));i(t.events.willStart$,(()=>{let e=t.info.position$.getValue();this.logActionPlay({position:e}),this.statContext.projectId&&this.logActionPlayInteractive()})),i(t.events.looped$,(()=>{this.resetViewSession(),++this.loopCounter>this.config.maxLoops&&(this.disabled=!0),this.logActionPlay({position:t.info.position$.getValue()})})),i(t.events.seeked$,(()=>{this.logSeek({action:this.seekAction$.getValue(),time:t.info.position$.getValue()}),this.seekAction$.next("unknown")})),i(t.events.paused$,(()=>{this.logPause({position:t.info.position$.getValue()})})),i(t.events.willResume$,(()=>{this.logPlay()})),i(t.events.started$,(()=>{this.statContext.clip&&this.logWatchCoverageRecord({start:0,end:0})})),i(t.events.playing$,(()=>{this.logPlaying()})),i(((t,e)=>new c.cP((r=>{let i,s=new c.yU,o=(0,c.h1)((0,c.Rt)(window,"beforeunload"),t.events.willDestruct$),n=new c.Ot(void 0);s.add(t.info.isLive$.pipe((0,c.jX)()).subscribe((e=>{i&&(i.unsubscribe(),n.next(void 0)),i=e?t.info.liveTime$.pipe((0,c.Tj)((t=>t&&t/1e3))).subscribe(n):t.info.position$.subscribe(n),s.add(i)})));let{playing$:a,paused$:u}=t.events,h=t.events.willSeek$.pipe((0,c.pb)((()=>t.info.playbackState$.getValue()===l.wF.PLAYING))),d=t.events.seeked$.pipe((0,c.pb)((()=>t.info.playbackState$.getValue()===l.wF.PLAYING))),p=!1,f=new c.B7;s.add(h.subscribe((()=>{p||f.next(),p=!0}))),s.add(d.subscribe((()=>p=!1)));let g,v=new c.B7,m=new c.B7,b=(0,c.h1)(a,d,v),y=(0,c.h1)(u,f,o,t.events.looped$,m),w=()=>{m.next(),v.next()};if(s.add(b.subscribe((()=>g=n.getValue()))),s.add(y.subscribe((()=>{let t=n.getValue();(0,c.wD)(g)||g===t||(0,c.wD)(t)||(r.next({from:g,to:t}),g=void 0)}))),e.forceInterval&&isFinite(e.forceInterval))if(e.watchCoverageTimeoutFix){let t,r=()=>{void 0!==t&&(window.clearTimeout(t),t=void 0)};s.add(b.subscribe((()=>{r(),t=window.setTimeout(w,e.forceInterval)}))),s.add(y.subscribe((()=>r()))),s.add((()=>r()))}else{let t=0;s.add(b.subscribe((()=>t=window.setTimeout(w,e.forceInterval)))),s.add(y.subscribe((()=>window.clearTimeout(t))))}return s})))(t,{forceInterval:this.config.watchCoverageInterval,watchCoverageTimeoutFix:this.config.watchCoverageTimeoutFix}),(e=>{let r=t.info.isLive$.getValue(),i=t.info.atLiveEdge$.getValue(),s={start:parseFloat(e.from.toFixed(3)),end:parseFloat(e.to.toFixed(3))};if(i){let e=t.info.liveLatency$.getValue()??0,r=t.info.currentBuffer$.getValue()?.end??0,i=t.info.liveBufferTime$.getValue()??0,o=Math.round(1e3*(e-(r-i))),n=Math.round(1e3*e);o&&n&&(s.latency=o,s.bufferLatency=n)}r?this.logWatchCoverageLive(s):this.logWatchCoverageRecord(s)})),i(t.info.isStalled$,(t=>{t?e=(0,c.tB)():((0,c.R)(e)&&this.logEmptyBuffer({duration:(0,c.tB)()-e}),e=void 0)}));let s=!1;r.add(t.events.fatalError$.pipe((0,c.Oo)()).subscribe((()=>s=!0))),i(t.events.willStop$,(()=>{if(t.info.isStalled$.getValue()){let t=(0,c.R)(e)?(0,c.tB)()-e:void 0;this.logCloseAtEmptyBuffer({duration:t??0}),e=void 0}else s||this.logActionStop()})),i(t.events.managedError$,(({id:t})=>{this.logError({fatal:!1,errorType:t})})),i(t.events.fatalError$,(({id:t})=>{this.logError({fatal:!0,errorType:t})}));let o,n,a,u,h,d=!1;return i(t.events.firstBytes$,(t=>{o=(0,c.tB)(),this.logFirstBytes({time:t})})),i(t.events.willStart$,(()=>n=(0,c.tB)())),i(t.info.currentBuffer$,(t=>{!d&&t&&t.end-t.start>0&&(0,c.R)(o)&&(this.logPlayerReady({duration:(0,c.tB)()-o}),d=!0)})),i(t.events.firstFrame$,(()=>{(0,c.R)(o)&&!d&&(this.logPlayerReady({duration:(0,c.tB)()-o}),d=!0),(0,c.R)(n)&&this.logFirstFrame({time:(0,c.tB)()-n})})),i(t.info.currentVideoStream$,(t=>{t&&(a&&t.id!==a&&this.logTrackSwitch(t),a=t.id)})),i(t.info.currentAudioStream$,(t=>{t&&(u&&t.id!==u&&this.logTrackSwitch(t),u=t.id)})),i(t.info.atLiveEdge$,(t=>this.updateContext({liveEdge:t}))),i((0,c.kg)({muted:t.info.muted$,volume:t.info.volume$}),(({muted:t,volume:e})=>this.updateContext({audible:!t&&e>0}))),i(t.info.currentQuality$,(t=>{let e=(t=>t&&{[c.Xb.INVARIANT]:"unknown",[c.Xb.Q_144P]:"mobile",[c.Xb.Q_240P]:"lowest",[c.Xb.Q_360P]:"low",[c.Xb.Q_480P]:"medium",[c.Xb.Q_576P]:"unknown",[c.Xb.Q_720P]:"high",[c.Xb.Q_1080P]:"fullhd",[c.Xb.Q_1440P]:"quadhd",[c.Xb.Q_2160P]:"ultrahd",[c.Xb.Q_4320P]:"unknown"}[t])(t);this.updateContext({quality:e}),e&&this.logQuality(e)})),i(t.info.isAutoQualityEnabled$,(t=>this.updateContext({autoQuality:t}))),i(t.info.currentFormat$,(t=>this.updateContext({contentType:ei(t)}))),i(t.info.currentPlaybackRate$,(t=>this.updateContext({rate:t}))),i(t.info.is3DVideo$,(t=>this.updateContext({is3d:t}))),i(t.info.hostname$,(t=>{let e=void 0!==h&&h!==t;this.updateContext({cdnHostname:t,failover:e}),e&&this.logFailover(t),h=t})),i(t.info.throughputEstimation$,(t=>this.updateContext({downloadSpeed:t}))),i(t.info.httpConnectionType$,(t=>{this.statContext.firstConnectionType||this.updateContext({firstConnectionType:ti(t)}),this.updateContext({connectionType:ti(t)})})),i(t.info.httpConnectionReused$,(t=>{(0,c.wD)(this.statContext.firstConnectionReused)&&this.updateContext({firstConnectionReused:t}),this.updateContext({connectionReused:t})})),i(t.info.surface$,(t=>{this.uiEvents||this.updateContext({mode:ri(t,this.statContext.isPreviewPlayerView)})})),i((0,c.kg)({current:t.info.currentTextTrack$,available:t.info.availableTextTracks$}),(({current:t,available:e})=>{let r=e.find((({id:e})=>e===t)),i=r&&(r.isAuto?`${r.language}_auto`:r.language);this.updateContext({subtitles:i?.split(".")[0]})})),this.player=t,this.uiEvents&&this.attachToUi(this.uiEvents),this.resubscribeBeforeunload(),this.subscription.add(r),r}attachToUi(t){this.uiEvents=t;let{subscription:e,subscribe:r}=ui();if(!this.player)return e;r(t.actionRewind$,(()=>{this.player&&(this.resetViewSession(),this.logActionPlay({position:this.player.info.position$.getValue()}))})),r(t.actionSeek$,this.seekAction$);let{surface$:i}=ni(this.uiEvents,r,this.player);return r(i,(t=>{this.updateContext({mode:ri(t,this.statContext.isPreviewPlayerView)})})),r(t.actionSetSubtitle$,(t=>this.updateContext({subtitles:t?.split(".")[0]}))),r(t.nextMovie$,(t=>this.logNextMovie(t))),this.resubscribeBeforeunload(),this.subscription.add(e),e}attachToAds(t){let{subscription:e,subscribe:r}=ui();return r(t.slotRequested$,(()=>this.logAdSlotRequest())),r(t.started$,(t=>this.logAdStarted(t))),r(t.paused$,(()=>this.logAdPaused())),r(t.resumed$,(()=>this.logAdResumed())),r(t.ended$,(()=>this.logAdEnded())),r(t.skipped$,(()=>this.logAdSkipped())),r(t.clicked$,(()=>this.logAdClicked())),r(t.error$,(t=>this.logError({errorType:t,fatal:!1}))),this.resubscribeBeforeunload(),this.subscription.add(e),e}attachToInteractive(t){let{subscription:e,subscribe:r}=ui();return r(t.click$,(t=>this.logInterfaceClick(t))),r(t.nextMovie$,(t=>this.logNextMovie(t))),this.resubscribeBeforeunload(),this.subscription.add(e),e}authorize(t){return this.api.authorize(t)}pause(){this.logger.pause(),this.oneStatDebugLog({message:"paused"})}resume(){this.logger.resume(),this.oneStatDebugLog({message:"resumed"})}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}resetViewSession(){this.oneStatDebugLog({message:"VSID reset"}),Pr.generateVSID()}getDeviceId(){return this.deviceId}setFieldBlacklist(){}logInited(){}logReady(t){this.log({operation:"player_ready",param:String(t.time)})}logStarted(...t){this.logActionPlay(...t)}logPlay(){this.log({operation:"play_toggle"})}logPlaying(){this.log({operation:"playing"})}logPause(t){this.log({operation:"pause",param:String(Math.round(t.position))})}logSeek(t){this.log({operation:"seek",param:t.action,time:t.time})}logFirstBytes(t){this.log({operation:"first_bytes",param:String(t.time)})}logFirstFrame(t){this.log({operation:"first_frame",param:String(t.time)})}logError(t){this.log({operation:"content_error",param:`${t.fatal?"fatal":"recoverable"}_${t.errorType}`})}logWatchCoverageRecord(t){this.log({operation:"watch_coverage_record",param:`${t.start}-${t.end}`},{in_history:this.statContext.inHistory?1:void 0})}logWatchCoverageLive(t){let e=this.timeSynchronisation?.getOffset()??0,r=t.start+e,i=t.end+e;this.log({operation:"watch_coverage_live",param:`${r}-${i}`},{in_history:this.statContext.inHistory?1:void 0,latency:t.latency,buffer_latency:t.bufferLatency})}logEmptyBuffer(t){this.log({operation:"empty_buffer",param:String(t.duration)})}logDownloadSpeed(){}logAdSlotRequest(){this.log({operation:"adv",param:"slot_request"})}logAdStarted(t){this.log({operation:"adv",param:t})}logAdPaused(){this.log({operation:"adv",param:"pause"})}logAdResumed(){this.log({operation:"adv",param:"resume"})}logAdEnded(){this.log({operation:"adv",param:"ended"})}logAdSkipped(){this.log({operation:"adv",param:"skip"})}logAdClicked(){this.log({operation:"adv",param:"click"})}logInterfaceClick(t){this.log({operation:"player_interface_click",param:t})}logNextMovie(t){this.log({operation:"next_movie",param:String(t)})}subscribe(){this.resubscribeBeforeunload();let t=window.navigator.connection;t&&"onchange"in t&&"effectiveType"in t&&this.subscription.add((0,c.h1)((0,c.Rt)(t,"change"),(0,c.Ss)(["init"])).subscribe((()=>this.updateContext({network:ii(t.effectiveType)})))),this.config.debugLog&&this.debugLogger.log$.subscribe((t=>{console.debug("%c stat ","background:#fa6470;",`component: ${t.component}.`,t.message)}))}resubscribeBeforeunload(){this.beforeunloadSubscription?.unsubscribe(),this.beforeunloadSubscription=(0,c.Rt)(window,"beforeunload").subscribe((()=>this.logger.flush({wantBeacon:!0,clearStorage:this.config.clearStorageAtUnload}))),this.subscription.add(this.beforeunloadSubscription)}logPlayerReady(t){this.log({operation:"player_ready",param:String(Math.round(t.duration))})}logActionPlay(t){this.log({operation:"action_play",param:String(Math.round(t.position))})}logActionPlayInteractive(){this.statContext.projectId&&this.log({operation:"action_play_interactive",param:String(this.statContext.movieId)},{vid:this.statContext.projectId})}logFailover(t){this.log({operation:"failover",param:t})}logCloseAtEmptyBuffer(t){this.log({operation:"close_at_empty_buffer",param:String(Math.round(t.duration))})}logActionStop(){this.log({operation:"action_stop"})}logTrackSwitch(t){this.log({operation:"track_switch",param:t.id})}logQuality(t){this.log({operation:"quality",param:t})}log(t,e={}){if(this.disabled)return void this.oneStatDebugLog({message:`operation ${t.operation} but statistics is disabled`});if((0,pr.default)(this.config.disabledOperations,t.operation))return void this.oneStatDebugLog({message:`operation ${t.operation} but it is disabled`});this.oneStatDebugLog({message:`operation ${t.operation} ${t.param}`});let r=this.createLogItem(t,e);this.logger.log(r)}createLogItem({operation:t,param:e,time:r},i={}){let s=this.timeSynchronisation?.now()??(0,c.tB)(),o=this.vsid$.getValue();(0,c.tZ)(o);let n,a,u=this.isid$.getValue(),l="empty_buffer"===t||"close_at_empty_buffer"===t?this.statContext.connectionType:this.statContext.firstConnectionType,h=this.statContext.firstConnectionReused;if(this.isEmbed||"embed"===this.statContext.place){n=this.embedParent;let t=[...new URLSearchParams(location.search).entries()].filter((([t,e])=>(0,pr.default)(this.config.embedUrlParams,t)));a=new URLSearchParams(t).toString()}else if("direct"===this.statContext.place){let t=this.statContext.refDomain||document.referrer;n=t&&fr(URL,t)?new URL(t).hostname:t,a=location.href.substring(0,1024)}let d={vsid:o,isid:u,vid:this.statContext.movieId,uid:this.zenUid$.getValue(),ct:this.statContext.contentType,place:this.isEmbed?"embed":this.statContext.place,quality:this.statContext.quality,cdn_host:this.statContext.cdnHostname,stat_type:!0===this.statContext.autoplay?"auto":!1===this.statContext.autoplay?"":void 0,param:e,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode,connection_type:l,connection_reused:!0===h?1:!1===h?0:void 0,cached_data:!0===this.statContext.cached?1:!1===this.statContext.cached?0:void 0,live:this.statContext.liveEdge?1:void 0,muted:!1===this.statContext.audible?1:void 0,mode:this.statContext.mode,subtitles:this.statContext.subtitles,download_speed:this.statContext.downloadSpeed,manual_quality:this.statContext.autoQuality?void 0:1,ref_domain:n,direct_url:a,rate:1===this.statContext.rate||(0,c.wD)(this.statContext.rate)?void 0:this.statContext.rate.toFixed(2),view_360:this.statContext.is3d?1:void 0,aid:this.statContext.albumId,vk_playlist_id:this.statContext.vkPlaylistId,...i};for(let t of this.config.disabledCustomFields)delete d[t];return{operation:t,type:1,time:r,network:this.statContext.network,timestamp:s,custom:d}}constructor(t,e){this.subscription=new c.yU,this.debugLogger=new c.Vy,this.oneStatDebugLog=this.debugLogger.createComponentLog("onestat"),this.loopCounter=0,this.disabled=!1,this.isid$=new c.Ot(void 0),this.zenUid$=new c.Ot(void 0),this.seekAction$=new c.Ot("unknown"),this.statContext=t,this.config=(t=>(0,c.Xz)(t,kr))(e.config??{}),(0,c.R)(e.apiEnv)&&(this.config.apiEnv=e.apiEnv),this.config.synchronizeTime&&(this.timeSynchronisation=new si);let r=new c.B7;this.experimental={error$:r};let i=c.RW.get(ai);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:i?this.deviceId=i:(this.deviceId=function(){let t,e,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),s=0;for(e=0;e<36;e++)8===e||13===e||18===e||23===e?i[e]="-":14===e?i[e]="4":(s<=2&&(s=33554432+16777216*Math.random()|0),t=15&s,s>>=4,i[e]=r[19===e?3&t|8:t]);return i.join("")}(),c.RW.set(ai,this.deviceId)),this.resetViewSession(),e.useIsid&&this.isid$.next(e.isid??(0,oi.default)(Math.floor(Math.random()*2**64).toString(36),13,"0")),this.zenUid$.next(e.zenUid);let s=new Kr({config:this.config,error$:r,timeSynchronisation:this.timeSynchronisation});this.api=new Dr({config:this.config,apiTransport:s,refreshAuthToken:e.refreshAuthToken,mobile:this.statContext.mobile??!1,deviceId:this.deviceId,error$:r,vktvVersion:e.vktvVersion}),this.logger=new Yr({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:r,userSalt:e.userSalt});let{isEmbed:o,topOrigin:n}=(0,c.dh)();this.isEmbed=o,this.embedParent=n?new URL(n).hostname:void 0,this.subscribe()}},li={};((t,e)=>{for(var r in e)d(t,r,{get:e[r],enumerable:!0})})(li,{ActionSeekType:()=>fi,ThinOneStat:()=>Fi,VERSION:()=>Ir});var hi=b(dr(),1),di=b(Et(),1),pi=(t=>(t.AUTO="auto",t.AUTO_POOR="auto_poor",t.AUTO_RICH="auto_rich",t))(pi||{}),fi=(t=>(t.SLIDER="slider",t.DOUBLE_TAP="double_tap",t.TIME_CODE="time_code",t.EPISODE="episode",t.REWIND="rewind",t.LIVE="live",t.UNKNOWN="unknown",t))(fi||{}),gi={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},vi={apiKey:"CIOPGQJGDIHBABABA",apiEnv:"okcdn",apiBaseUrl:null,requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageHeartbeatInterval:30,synchronizeTime:!0,useBeacon:!1,alwaysSendDesktop:!1,watchedNFirstTvtLog:1e3,watchedNDefaultTargetDuration:1e4},mi=b(Be(),1),bi=class{async authorize(t){return this.authToken=t??await this.refreshAuthToken(),this.authorizeWithBackoff()}logBeacon(t){let e=this.createLogParams(t),r=this.sessionKey;r&&(this.params.apiTransport.sendBeacon("log.logUvStat",e,r)||this.logRequest(t).catch((()=>{})))}async logRequest(t){let e="log.logUvStat",r=this.createLogParams(t),i={},s=this.sessionKey??await this.authorizeWithBackoff();if(!s)return;let o=async(t,n=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(e,r,s,i)}catch(r){if(!r||!("error_code"in r))return void this.params.error$.next({id:"logRequestUnknown",category:c.h.NETWORK,message:`Unknown ${e} error`,thrown:r});let i=r?.error_code;switch(i){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this.authorizeWithBackoff(),n>0?o(t,n-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this.authorizeWithBackoff(),n>0?o(t,n-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${i}`,category:c.h.EXTERNAL_API,message:`${e} error`,data:r})}}};return o(t)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,mi.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(t){return{collector:"ok.mobile.apps.video",uv_stat_data:JSON.stringify({application:`@vkontakte/videoplayer-statistics:${Ir}`,platform:t[0].platform,product:t[0].product,events:t})}}authorizeWithBackoff(){if(!this.consequentAuthErrors)return this.doAuthorize();let t=(0,c.rX)(this.consequentAuthErrors);return new Promise((e=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((async()=>{try{let t=await this.doAuthorize();e(t)}catch(t){this.params.error$.next({id:"AuthorizeBackoff",category:c.h.NETWORK,message:"Otherwise unhandled error in authorization",thrown:t})}finally{this.backoffTimeoutId=0}}),t))}))}doAuthorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let t={session_data:{version:2,device_id:this.params.deviceId,client_version:Ir.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(t.session_data.auth_token=this.authToken,t.session_data.version=3),this.authorizePromise=(0,mi.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",t).then((t=>((!t||!t.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:c.h.EXTERNAL_API,message:"No session key",data:t}),this.sessionKey=t?.session_key??void 0,this.sessionKey))).catch((async t=>{this.sessionKey=void 0;let e=t?.error_code;if(401===e)return this.authToken=await this.refreshAuthToken(),this.authorizeWithBackoff();e?this.params.error$.next({id:`Authorize#${e}`,category:c.h.EXTERNAL_API,message:"authorize error",data:t}):this.params.error$.next({id:"AuthorizeUnknown",category:c.h.NETWORK,message:"authorize error",thrown:t})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}constructor(t){this.params=t,this.authorized$=new c.Ot(!1),this.consequentAuthErrors=0}},yi=b(Et(),1),wi=b(Qe(),1),Si=class{sendBeacon(t,e,r){if(!window.Blob||!window.navigator.sendBeacon)return!1;let i=this.prepareQueryParams({method:t,queryParams:e,sessionKey:r}),s=new window.Blob([i.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,s)}catch(r){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:c.h.NETWORK,message:"Unhandled beacon error",thrown:r,data:{method:t,params:e}})}return!1}async sendRequest(t,e,r,i){let s=(0,c.tB)(),o=i=>{i instanceof TypeError&&(0,yi.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],i.message)?this.params.error$.next({id:"Network",category:c.h.NETWORK,message:"Request failed",thrown:i}):this.params.error$.next({id:"ThinOneStat:ApiTransport:sendRequest",category:c.h.NETWORK,message:"Unhandled request error",thrown:i,data:{method:t,params:e,sessionKey:r,time:(0,c.tB)()-s}})};return this.apiBaseUrl=await this.resolveApiBaseUrl(),Hr(`${this.apiBaseUrl}/fb.do`,{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded",...i},body:this.prepareQueryParams({method:t,queryParams:e,sessionKey:r})}).then((t=>{let e=0===Number(t.headers.get("content-length")),r=new Date(t.headers.get("date")??"").getTime(),i=(0,c.tB)()-s;if(isFinite(r)&&this.timeSynchronisation?.addServerTime(r,i),!e)return t.json().then((t=>Object.prototype.hasOwnProperty.call(t,"error_msg")?Promise.reject(t):t),o)}),o)}async resolveApiBaseUrl(){if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let t=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),e=(await(await Hr(t,{method:"GET",mode:"cors",cache:"no-cache"})).json())?.Answer[0]?.data;if(!e)throw new Error("Wrong DNS response");return e}catch(t){return this.params.error$.next({id:"ThinOneStat:ApiTransport:resolveApiBaseUrl",category:c.h.NETWORK,message:"Unhandled resolve api base url error",thrown:t}),gi.vk_alias}finally{this.isApiBaseUrlFetched=!0}}prepareQueryParams(t){let e=new URLSearchParams({format:"JSON",method:t.method,application_key:this.apiKey});return void 0!==t.sessionKey&&e.append("session_key",t.sessionKey),(0,wi.default)(t.queryParams).forEach((([t,r])=>e.append(t,"string"==typeof r?r:JSON.stringify(r)))),e}constructor(t){this.params=t,this.apiKey=t.config.apiKey,this.apiEnv=t.config.apiEnv,this.apiBaseUrl=t.config.apiBaseUrl??gi[this.apiEnv],this.timeSynchronisation=t.timeSynchronisation,this.isApiBaseUrlFetched=!1}},_i=b(Et(),1),Ti=b(Qe(),1),xi="thinonestat_events",Ei=t=>e=>e.client_time+t>=(0,c.tB)(),ki=class{safeFlush(){try{this.flush()}catch(t){this.error$.next({id:"LoggerError",category:c.h.WTF,message:String(t)||"Unknown logger error",thrown:t})}}readFromStorage(){let t=c.RW.get(xi);try{return t?JSON.parse(t):{}}catch{}return{}}addToStorage(t){if(!this.userSalt)return void this.unsaltedStorage.push(t);let e=this.readFromStorage(),r=(e[this.userSalt]??[]).filter(Ei(this.params.config.storageExpiration));c.RW.set(xi,JSON.stringify({...e,[this.userSalt]:[...r,t]}))}getFromStorage(){return this.userSalt?(this.readFromStorage()[this.userSalt]??[]).filter(Ei(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let t=this.readFromStorage();delete t[this.userSalt],c.RW.set(xi,JSON.stringify(t))}housekeepStorage(){let t=this.readFromStorage();for(let[e,r]of(0,Ti.default)(t)){let i=r.filter(Ei(this.params.config.storageExpiration));i.length?t[e]=i:delete t[e],this.loggerDebugLog({message:`${r.length} retrieved from storage, ${i.length} of them actual`})}c.RW.set(xi,JSON.stringify(t))}log(t){this.addToStorage(t),!this.isPaused&&(this.isUrgent(t)?this.flush():this.lastVsid!==t.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=t.vsid)}flush({wantBeacon:t,clearStorage:e}={wantBeacon:!1,clearStorage:!0}){let r=this.getFromStorage();0!==r.length&&(this.api.authorized$.getValue()?(t&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${r.length} events through beacon`}),this.api.logBeacon(r)):(this.loggerDebugLog({message:`Flushing ${r.length} events`}),this.api.logRequest(r)),e&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}constructor(t){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=t=>{let{event_name:e}=t;return(0,_i.default)(["watch_coverage","watch_coverage_live","watched_n","playback_started"],e)},this.params=t,this.api=t.api,this.error$=t.error$,this.userSalt=t.userSalt,this.loggerDebugLog=t.debugLogger.createComponentLog("stat logger"),this.firstFlush=(0,c.eD)((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let e=c.RW.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=(0,c.eD)((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:e}),this.subscription=this.api.authorized$.subscribe((t=>{t&&this.debouncedFlush()})),this.housekeepStorage()}};var $i=class{getOffset(){return this.offset??0}setOffset(t){this.offset=t}now(){return Date.now()+(this.offset??0)}date(t=new Date){return t.setTime(t.getTime()+(this.offset??0)),t}addServerTime(t,e){let r=t-Date.now()-e/2;Math.abs(r)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(r):this.offset=Math.round(.2*r+.8*this.offset)}constructor(t){this.offset=void 0,this.offset=t}},Ai=t=>t&&{[l.Xt.HTTP1]:"http1",[l.Xt.HTTP2]:"http2",[l.Xt.QUIC]:"http3"}[t],Pi=t=>{if(void 0!==t)switch(t){case l.T4.MPEG:return"MP4";case l.T4.DASH:case l.T4.DASH_LIVE:return"DASH";case l.T4.DASH_SEP:return"DASH_SEP";case l.T4.DASH_ONDEMAND:return"ONDEMAND_DASH";case l.T4.HLS_ONDEMAND:return"ONDEMAND_HLS";case l.T4.HLS:case l.T4.HLS_LIVE:return"HLS";case l.T4.HLS_FMP4:return"HLS_FMP4";case l.T4.DASH_WEBM:case l.T4.DASH_LIVE_WEBM:return"WEBM";case l.T4.DASH_LIVE_CMAF:return"ONDEMAND_DASH_LIVE";case l.T4.HLS_LIVE_CMAF:return"ONDEMAND_HLS_LIVE";case l.T4.WEB_RTC_LIVE:return"WEBRTC";case l.T4.DASH_WEBM_AV1:return"AV1";case l.T4.DASH_STREAMS:return"MULTI_DASH";default:return(0,c.xb)(t)}},Ci=t=>{if(void 0!==t)switch(t){case c.Xb.Q_144P:return"144p";case c.Xb.Q_240P:return"240p";case c.Xb.Q_360P:return"360p";case c.Xb.Q_480P:return"480p";case c.Xb.Q_720P:return"720p";case c.Xb.Q_1080P:return"1080p";case c.Xb.Q_1440P:return"1440p";case c.Xb.Q_2160P:return"2160p";case c.Xb.INVARIANT:case c.Xb.Q_576P:case c.Xb.Q_4320P:return"UNKNOWN";default:return(0,c.xb)(t)}},Oi=t=>{if(void 0!==t)switch(t){case"MP4":case"ONDEMAND_DASH":case"ONDEMAND_DASH_LIVE":case"ONDEMAND_HLS":case"ONDEMAND_HLS_LIVE":case"MULTI_DASH":case"WEBM":case"AV1":return"vod";case"DASH":case"HLS":case"HLS_FMP4":case"WEBRTC":return"live";default:return}},Ri=(t,e,r)=>{if(t&&e){if(t===l.T4.MPEG)return r&&e[t]&&e[t][r];return e[t]?.url}},Li=(t,e=!1)=>{if(e)return"minimal";switch(t){case void 0:case l.ui.NONE:return;case l.ui.INLINE:return"inline";case l.ui.FULLSCREEN:return"fullscreen";case l.ui.SECOND_SCREEN:return"chromecast";case l.ui.PIP:return"pip_external"}},Ii=t=>{switch(t){case void 0:return;case l.ui.INVISIBLE:return"background";default:return"foreground"}},Ni=b(Nt(),1),Di="_thin-one-stat_deviceId",Bi=()=>{let t=new c.yU;return{subscription:t,subscribe:(e,r)=>{e&&t.add(e.subscribe(r))}}},Fi=class{get vsid$(){return new c.Ot(Pr.getVSID())}authorize(t){return this.api.authorize(t)}updateContext(t){this.statContext={...this.statContext,...t}}attachTo(t,e){let r,i,s,o,n=new c.yU,a=(t,e)=>n.add(t.subscribe(e));return a((t=>new c.cP((e=>{let r=new c.yU,i=0,s=1,o=0,n=!1,a=!1,u=()=>{if(!n)return;let t=Date.now();o+=(t-i)*s,i=t},{started$:l,playing$:h,paused$:d,willSeek$:p,ended$:f,willDestruct$:g}=t.events,{currentPlaybackRate$:v}=t.info;return r.add(p.subscribe((()=>{n&&(u(),n=!1,a=!0)}))).add((0,c.h1)(l,h).subscribe((()=>{(!n||a)&&(i=Date.now(),n=!0,a=!1)}))).add((0,c.h1)(d,f,g).subscribe((()=>{n&&(u(),n=!1)}))).add(v.subscribe((t=>{n&&u(),s=t,i=Date.now()}))),e.next((()=>{let t=o;return n&&(t+=(Date.now()-i)*s),t})),r})))(t),(t=>{this.getTotalViewTime=t})),a(t.info.isLive$,(t=>this.isLive=t)),a((0,c.kg)({hostname:t.info.hostname$,connectionType:t.info.httpConnectionType$,connectionReused:t.info.httpConnectionReused$}).pipe((0,c.pb)((({hostname:t})=>void 0!==t)),(0,c.pb)((({connectionType:t})=>void 0!==t)),(0,c.pb)((({connectionReused:t})=>void 0!==t))),(({hostname:e,connectionType:i,connectionReused:s})=>{if(void 0!==r&&r!==e){let r={cdn_host:e,connection_type:Ai(i),connection_reused:s,content_type:Pi(t.info.currentFormat$.getValue())};this.logFailover(r)}this.cdnHostname=r=e})),a(t.info.httpConnectionType$,(t=>{this.connectionType=Ai(t)})),a(t.info.httpConnectionReused$,(t=>{this.connectionReused=t})),a(((t,e,r)=>new c.cP((i=>{let s,o=new c.yU,n=new c.Ot(void 0);o.add(t.info.isLive$.pipe((0,c.jX)()).subscribe((e=>{s&&(s.unsubscribe(),n.next(void 0)),s=e?t.info.liveTime$.pipe((0,c.jX)()).subscribe(n):t.info.position$.subscribe(n),o.add(s)})));let{playing$:a,paused$:u,ended$:h,looped$:d}=t.events,p=t.events.willSeek$.pipe((0,c.pb)((()=>t.info.playbackState$.getValue()===l.wF.PLAYING))),f=t.events.seeked$.pipe((0,c.pb)((()=>t.info.playbackState$.getValue()===l.wF.PLAYING))),g=!1,v=new c.B7;o.add(p.subscribe((()=>{g||v.next(),g=!0}))).add(f.subscribe((()=>g=!1)));let m,b=(0,c.h1)((0,c.Rt)(window,"beforeunload"),t.events.willDestruct$),y=new c.B7,w=new c.B7,S=(0,c.h1)(a,v,y),_=(0,c.h1)(u,f,b,h,d,w),T=e.started$&&e.ended$?(0,c.h1)(S,e.ended$):S,x=e.started$&&e.ended$?(0,c.h1)(_,e.started$):_;if(o.add(T.subscribe((()=>m=n.getValue()))).add(x.subscribe((()=>{let t=n.getValue();(0,c.wD)(m)||(0,c.wD)(t)||m===t||(i.next({from:m,to:t}),m=void 0)}))),r.heartbeatInterval&&isFinite(r.heartbeatInterval)){let t=[],e=1e3*r.heartbeatInterval,i=()=>{w.next(),y.next()};o.add(T.subscribe((()=>{let r=window.setTimeout(i,e);t.push(r)}))).add(x.subscribe((()=>{t.forEach((t=>{window.clearTimeout(t)})),t=[]})))}return o})))(t,e,{heartbeatInterval:this.config.watchCoverageHeartbeatInterval}),(e=>{let r={watch_interval:`${Math.round(1e3*e.from)}-${Math.round(1e3*e.to)}`,in_history:!!this.statContext.inHistory,content_type:Pi(t.info.currentFormat$.getValue()),playback_quality:Ci(t.info.currentQuality$.getValue()),recom_info:this.statContext.recomInfo};if(t.info.isLive$.getValue()){let e=t.info.atLiveEdge$.getValue();this.logWatchCoverageLive({...r,live:!!e})}else this.logWatchCoverage(r)})),a(((t,e)=>new c.cP((r=>{let i=new c.yU,s=0;return i.add(t.info.position$.subscribe((()=>{let t=1e3*e.getTotalViewTime();t>s&&(t===e.firstTvtLog||t%e.targetDuration==0)&&(s=t,r.next({target_duration:e.targetDuration,current_tvt:t}))}))),i})))(t,{targetDuration:this.targetDuration,firstTvtLog:this.config.watchedNFirstTvtLog,getTotalViewTime:this.getTotalViewTime}),(t=>{this.logWatchedN(t)})),a(t.events.willReady$,(()=>{if(this.statContext.preload){let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentBuffer$.getValue(),s=t.info.currentQuality$.getValue(),o={target_buffer_time:this.calcBufferTime(i),playback_url:Ri(e,r,s),playback_quality:Ci(s)};this.logPreloadStarted(o)}})),a(t.events.ready$,(()=>{let e=t.info.currentBuffer$.getValue();if(this.statContext.preload){let t={buffer_time:this.calcBufferTime(e)};this.logPreloadEnded(t)}this.logReady({buffer_time:this.calcBufferTime(e)})})),a(t.events.manifestRequested$,(()=>{let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentQuality$.getValue(),s={playback_url:Ri(e,r,i),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logManifestRequest(s)})),a(t.events.firstBytesManifest$,(()=>{let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentQuality$.getValue(),s={playback_url:Ri(e,r,i),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logFirstByteManifest(s)})),a(t.events.manifestReceived$,(()=>{let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentQuality$.getValue(),s={playback_url:Ri(e,r,i),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logManifestReceived(s)})),a(t.events.firstBytesRequested$,(()=>{let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentQuality$.getValue(),s={playback_url:Ri(e,r,i),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logFirstMediaRequest(s)})),a(t.events.firstBytesReceived$,(()=>{let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentQuality$.getValue(),s={playback_url:Ri(e,r,i),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused};this.logFirstByteMedia(s)})),a((0,c.h1)(t.events.willStart$,t.events.looped$),(e=>{e&&this.resetViewSession();let r={isid:this.isid$.getValue(),stream_profile:Oi(Pi(t.info.currentFormat$.getValue())),dpi:96*l.zl.display.pixelRatio,web_layout:this.statContext.isMobile||l.zl.device.isMobile?"mobile":"desktop",preloaded:this.statContext.preload,navigation:this.statContext.navigation,recom_info:this.statContext.recomInfo};this.isEmbed&&(r.iframe_host=this.embedHostname??"unknown"),this.logStartSession(r)})),a(t.events.started$,(()=>{this.isStarted=!0;let e=t.info.currentBuffer$.getValue(),r=t.info.currentQuality$.getValue(),i=t.info.isAutoQualityEnabled$.getValue(),s=t.info.muted$.getValue(),o=t.info.volume$.getValue(),n=t.info.surface$.getValue(),a=t.info.availableTextTracks$.getValue(),u=t.info.currentTextTrack$.getValue(),c=t.info.currentAudioStream$.getValue(),l=t.info.currentPlaybackRate$.getValue(),h={playback_quality:Ci(r),user_quality:i?"auto":Ci(r),player_width:this.playerSize.width,player_height:this.playerSize.height,muted:s,sound_volume:Math.round(100*o),buffer_time:this.calcBufferTime(e),mode:Li(n,this.statContext.isPreviewPlayerView),visibility:Ii(n),subtitles_enabled:u?!!u:this.currentSubtitle?.enabled,auto_subtitles:a.find((({id:t})=>t===u))?.isAuto??this.currentSubtitle?.auto,audio_track_lang:c?.language,playback_rate:l,recom_info:this.statContext.recomInfo};this.logPlaybackStarted(h)})),a((0,c.h1)(t.events.willStart$,t.events.willResume$),(()=>{this.logPlay()})),a(t.events.playing$,(()=>{let e=t.info.currentBuffer$.getValue(),r={buffer_time:this.calcBufferTime(e)};this.logPlaying(r),this.wasPaused&&this.logResume()})),a(t.events.paused$,(()=>{this.wasPaused=!0,this.logPause()})),a(t.events.willStop$,(()=>{this.logStop()})),a((0,c.h1)(t.events.fetcherRecoverableError$,t.events.fatalError$),(()=>{this.statContext.preload&&this.logPreloadError()})),a((0,c.kg)({connectionType:t.info.httpConnectionType$,connectionReused:t.info.httpConnectionReused$}).pipe((0,c.pb)((({connectionReused:t})=>void 0!==t)),(0,c.jX)(((t,e)=>t.connectionType===e.connectionType))),(()=>{let e=t.info.currentFormat$.getValue(),r=t.info.availableSources$.getValue(),i=t.info.currentQuality$.getValue(),s=t.info.rttEstimation$.getValue(),o={playback_url:Ri(e,r,i),cdn_host:this.cdnHostname,connection_type:this.connectionType,connection_reused:this.connectionReused,rtt:s?Math.round(s):void 0};this.logConnectionEstablished(o)})),a(t.events.firstFrame$,(()=>{this.logFirstVideoFrameDecoded()})),a(t.events.willSeek$,(()=>{let t={seek_type:this.seekAction$.getValue()};this.logSeeking(t)})),a(t.events.seeked$,(()=>{let t={seek_type:this.seekAction$.getValue()};this.logSeeked(t),this.seekAction$.next("unknown")})),a(t.info.isStalled$,(e=>{let r=t.info.currentBuffer$.getValue(),i=this.calcBufferTime(r);e&&i&&i>0&&this.logBufferStarvation({buffer_time:i})})),a((0,c.kg)({videoStream:t.info.currentVideoStream$,audioStream:t.info.currentAudioStream$,quality:t.info.currentQuality$}).pipe((0,c.pb)((({videoStream:t,audioStream:e})=>void 0!==t&&void 0!==e)),(0,c.pb)((({quality:t})=>void 0!==t))),(({videoStream:e,audioStream:r,quality:s})=>{if(i!==s){let o=t.info.isAutoQualityEnabled$.getValue(),n=e?.codec,a=r?.codec,u={user_quality:o?"auto":Ci(s),playback_quality:Ci(s),download_quality:Ci(s),codec_info:n&&a?`${n},${a}`:void 0};i=s,this.logQualityChanged(u)}})),a(t.info.surface$,(t=>{let e=Li(t,this.statContext.isPreviewPlayerView);e&&!this.uiEvents&&this.isStarted&&this.logModeChanged({mode:e}),o=Ii(t),s!==o&&this.isStarted&&(s=Ii(t),this.logVisibilityChanged({visibility:o}))})),a((0,c.kg)({muted:t.info.muted$,volume:t.info.volume$}),(({muted:t,volume:e})=>{if(this.isStarted){let r={muted:t,sound_volume:Math.round(100*e)};this.logSoundChanged(r)}})),this.player=t,this.resubscribeBeforeunload(),this.subscription.add(n),n}attachToUi(t){this.uiEvents=t;let{subscribe:e,subscription:r}=Bi();e(t.actionSeek$,this.seekAction$),e(t.playerSize$,(({width:t,height:e})=>{t&&e&&(this.playerSize={width:t,height:e},this.logViewPortChanged({player_width:t,player_height:e}))})),e(t.isLoaderVisible$,(t=>{t&&this.isStarted&&this.logShowLoader()})),e(t.actionSubtitlesSwitched$,(t=>{if(this.currentSubtitle={...t},this.isStarted){let e={subtitles_enabled:t.enabled,subtitles_track_lang:t.lang,auto_subtitles:t.auto};this.logSubtitlesSwitched(e)}}));let{surface$:i}=ni(this.uiEvents,e,this.player);return e(i,(t=>{this.isStarted&&this.logModeChanged({mode:Li(t)})})),e(t.actionQuality$,(t=>{let e=this.player?.info.currentVideoStream$.getValue()?.codec,r=this.player?.info.currentAudioStream$.getValue()?.codec,i={user_quality:(s=t,(0,di.default)((0,hi.default)(pi),s)?"auto":Ci(t)),playback_quality:Ci(this.player?.info.currentQuality$.getValue()),download_quality:Ci(this.player?.info.currentQuality$.getValue()),codec_info:e&&r?`${e},${r}`:void 0};var s;this.logQualityChangeRequested(i)})),this.resubscribeBeforeunload(),this.subscription.add(r),r}attachToAds(t){let{subscription:e,subscribe:r}=Bi();return r(t.init$,(t=>{let e={slot:t};this.logAdvConfiguration(e)})),r(t.slotRequested$,(()=>{this.logAdvRequest()})),r(t.started$,(t=>{let e={adv_section:t};this.logAdvBreakStarted(e)})),r(t.ended$,(t=>{let e={adv_section:t};this.logAdvBreakEnded(e)})),r(t.error$,(t=>{let e={error_message:t};this.logAdvError(e)})),this.resubscribeBeforeunload(),this.subscription.add(e),e}getDeviceId(){return this.deviceId}resetViewSession(){this.thinOneStatDebugLog({message:"VSID reset"}),Pr.generateVSID(),this.eventNumber=0}destroy(){this.api.destroy()}calcBufferTime(t){return t?1e3*Math.round((t.end??0)-(t.start??0)):void 0}createRequiredParams(t){let e=this.vsid$.getValue();(0,c.tZ)(e);let r=this.eventNumber++,i=1e3*((this.isLive?this.player?.info.liveTime$.getValue():this.player?.info.position$.getValue())??0);return{vsid:e,uv_movie_id:this.statContext.movieId,event_name:t,client_time:Date.now(),application:this.statContext.application??`@vkontakte/videoplayer-statistics:${Ir}`,platform:this.statContext.platform??"web:"+(this.statContext.isMobile||l.zl.device.isMobile?"mobile":"desktop"),product:this.statContext.product,event_number:r,playback_position:i,current_tvt:this.getTotalViewTime(),cdn_host:this.cdnHostname}}createRequiredFatParams(){return{stats_version:"2.1.1",browser:this.statContext.browser??l.zl.browser.current,browser_version:this.statContext.browserVersion??String(l.zl.browser.currentVersion),os:this.statContext.os??l.zl.device.os.name,os_version:this.statContext.osVersion??l.zl.device.os.version,device_type:this.statContext.deviceType??(this.statContext.isMobile||l.zl.device.isMobile?"mobile":"desktop"),device_manufacturer:this.statContext.deviceManufacturer??l.zl.device.details.vendor,device_model:this.statContext.deviceModel??l.zl.device.details.model,navigation:this.statContext.navigation}}log(t,e,r=!1){let i=this.createRequiredParams(t),s={};r&&(s=this.createRequiredFatParams()),this.logger.log({...i,...s,...e})}logWatchCoverage(t){this.log("watch_coverage",t,!0)}logWatchCoverageLive(t){this.log("watch_coverage_live",t,!0)}logWatchedN(t){this.log("watched_n",t,!0)}logStartSession(t){this.log("start_session",t,!0)}logPreloadStarted(t){this.log("preload_started",t)}logPreloadEnded(t){this.log("preload_ended",t)}logPreloadError(){this.log("preload_error")}logPlaybackStarted(t){this.log("playback_started",t,!0)}logPlay(){this.log("play")}logManifestRequest(t){this.log("manifest_request",t)}logFirstByteManifest(t){this.log("first_byte_manifest",t)}logFirstMediaRequest(t){this.log("first_media_request",t)}logFirstByteMedia(t){this.log("first_byte_media",t)}logManifestReceived(t){this.log("manifest_received",t)}logConnectionEstablished(t){this.log("connection_established",t)}logFirstVideoFrameDecoded(){this.log("first_video_frame_decoded")}logReady(t){this.log("ready",t)}logPlaying(t){this.log("playing",t)}logPause(){this.log("pause")}logResume(){this.log("resume")}logSeeking(t){this.log("seeking",t)}logSeeked(t){this.log("seeked",t)}logStop(){this.log("stop")}logBufferStarvation(t){this.log("buffer_starvation",t)}logShowLoader(){this.log("show_loader")}logQualityChangeRequested(t){this.log("quality_change_requested",t)}logQualityChanged(t){this.log("quality_changed",t)}logCdnHostChanged(t){this.log("cdn_host_changed",t)}logViewPortChanged(t){this.log("view_port_changed",t)}logModeChanged(t){this.log("mode_changed",t)}logVisibilityChanged(t){this.log("visibility_changed",t)}logSubtitlesSwitched(t){this.log("subtitles_switched",t)}logSoundChanged(t){this.log("sound_changed",t)}logFailover(t){this.log("failover",t)}logAdvConfiguration(t){this.log("adv_configuration",t)}logAdvRequest(){this.log("adv_request")}logAdvBreakStarted(t){this.log("adv_break_started",t)}logAdvBreakEnded(t){this.log("adv_break_ended",t)}logAdvError(t){this.log("adv_error",t)}resubscribeBeforeunload(){this.beforeunloadSubscription?.unsubscribe(),this.beforeunloadSubscription=(0,c.Rt)(window,"beforeunload").subscribe((()=>{})),this.subscription.add(this.beforeunloadSubscription)}constructor(t,e){this.debugLogger=new c.Vy,this.thinOneStatDebugLog=this.debugLogger.createComponentLog("ThinOneStat"),this.eventNumber=1,this.playerSize={width:0,height:0},this.seekAction$=new c.Ot("unknown"),this.isid$=new c.Ot(void 0),this.statContext=t,this.config=(t=>(0,c.Xz)(t,vi))(e.config??{}),this.subscription=new c.yU,this.config.synchronizeTime&&(this.timeSynchronisation=new $i);let r=new c.B7,i=c.RW.get(Di);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:i?this.deviceId=i:(this.deviceId=function(){let t,e,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),s=0;for(e=0;e<36;e++)8===e||13===e||18===e||23===e?i[e]="-":14===e?i[e]="4":(s<=2&&(s=33554432+16777216*Math.random()|0),t=15&s,s>>=4,i[e]=r[19===e?3&t|8:t]);return i.join("")}(),c.RW.set(Di,this.deviceId)),this.statContext.targetDuration?this.targetDuration=this.statContext.targetDuration:this.targetDuration=this.config.watchedNDefaultTargetDuration,this.resetViewSession(),e.useIsid&&this.isid$.next(e.isid??(0,Ni.default)(Math.floor(Math.random()*2**64).toString(36),13,"0"));let s=new Si({error$:r,config:this.config,timeSynchronisation:this.timeSynchronisation});this.api=new bi({config:this.config,apiTransport:s,error$:r,deviceId:this.deviceId,refreshAuthToken:e.refreshAuthToken}),this.logger=new ki({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:r,userSalt:e.userSalt});let{isEmbed:o,topOrigin:n}=(0,c.dh)();this.isEmbed=o,this.embedHostname=n?new URL(n).hostname:void 0}},Vi=t=>"function"==typeof t&&t?.toString().endsWith("{ [native code] }"),Mi=!Vi(window.requestIdleCallback)||!Vi(window.cancelIdleCallback),Ui=Mi?(t,e={})=>{let r=e.timeout||1,i=performance.now();return window.setTimeout((()=>{t({get didTimeout(){return!e.timeout&&performance.now()-i-1>r},timeRemaining:()=>Math.max(0,performance.now()-i+1)})}),1)}:window.requestIdleCallback,ji=Mi?t=>window.clearTimeout(t):window.cancelIdleCallback,qi=class{get time(){return Math.floor(this.timeMs/1e3)}get timeMs(){return null===this.startTime?0:(this.stopTime??this.now())-this.startTime-this.accumulatedTime}get isRunning(){return null!==this.startTime&&null===this.stopTime}start(){this.isRunning||(null!==this.stopTime?(this.accumulatedTime+=this.now()-this.stopTime,this.stopTime=null):this.startTime=this.now())}stop(){this.isRunning&&(this.stopTime=this.now())}reset(){this.startTime=null,this.stopTime=null,this.accumulatedTime=0}now(){return Date.now()}constructor(){this.startTime=null,this.stopTime=null,this.accumulatedTime=0}},Wi=class{attachTo(t){this.subscription.add(t.info.playbackState$.subscribe((t=>this.onPlaybackState(t)))).add(t.info.position$.subscribe((t=>this.onPosition(t)))).add(t.info.atLiveEdge$.subscribe((t=>this.isActiveLive=t))),this.subscription.add(t.events.willSeek$.subscribe((()=>this.onWillSeek()))).add(t.events.seeked$.subscribe((()=>this.onSeeked()))).add(t.events.ended$.subscribe((()=>this.onEnded())))}destroy(){this.stopwatch.reset(),this.subscription.unsubscribe(),window.clearTimeout(this.heartbeatFirstTimeoutId),this.idleCallbackIds.forEach((t=>ji(t))),this.send("stop")}onPlaybackState(t){t===l.wF.PLAYING?this.started?this.play():this.start():t===l.wF.PAUSED&&this.pause()}start(){this.started=!0,this.stopwatch.start(),this.send("start"),this.heartbeatPixels=this.prepareHeartbeatPixels(),this.heartbeatInterval=this.heartbeatPixels[0]?.interval;let t=this.heartbeatPixels[0]?.url,e=this.heartbeatPixels[0]?.delay;if(void 0!==e&&t)try{this.heartbeatFirstTimeoutId=window.setTimeout((()=>{this.sendHeartbeat(t)}),1e3*e)}catch(t){this.log({message:t.message})}}play(){this.stopwatch.start(),this.send("resume")}pause(){this.stopwatch.stop(),this.send("pause")}onPosition(t){if(this.position=t,this.heartbeatInterval&&0!==this.stopwatch.time&&this.stopwatch.time%this.heartbeatInterval==0)for(let[t,{url:e}]of this.heartbeatPixels.entries())this.heartbeatLastTimeSent[t]!==this.stopwatch.time&&(this.heartbeatLastTimeSent[t]=this.stopwatch.time,this.sendHeartbeat(e))}onWillSeek(){this.started&&this.send("stop")}onSeeked(){this.started&&this.send("start")}onEnded(){this.stopwatch.stop(),this.send("stop")}validatePixels(t,e){return t?.filter((t=>t.event===e.event&&e.keys.every((e=>!!t[e]))))}getFrameTimestamp(){let t;if(this.isActiveLive){let e=Math.floor(25*Math.random())+5;t=Date.now()/1e3-e}else t=this.position||0;return Math.floor(t)}getUTC(){return Math.floor(Date.now()/1e3)}prepareUrl(t){return t.replace("{@fts_fake_sec}",String(this.getFrameTimestamp())).replace("{@utc_sec}",String(this.getUTC())).split("&").filter((t=>!/={@[a-zA-Z_]+}/.test(t))).join("&")}preparePixels(t){return this.validatePixels(this.params.pixels,{event:t,keys:["url"]})}prepareHeartbeatPixels(){return this.validatePixels(this.params.pixels,{event:"heartbeat",keys:["url","interval"]})}call(t){try{this.idleCallbackIds.push(Ui((()=>(window.Image?new Image:document.createElement("img")).src=this.prepareUrl(t))))}catch(t){this.log({message:t.message})}}send(t){let e=this.preparePixels(t);for(let{url:t}of e)this.call(t)}sendHeartbeat(t){this.call(t)}constructor(t){this.position=0,this.started=!1,this.heartbeatPixels=[],this.heartbeatLastTimeSent={},this.idleCallbackIds=[],this.stopwatch=new qi,this.subscription=new c.yU,this.params=t;let e=new c.Vy;this.log=e.createComponentLog("MediascopePixel")}}}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/24814.4b43b94e.js")}catch(t){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/24814.4b43b94e.js",t),t}