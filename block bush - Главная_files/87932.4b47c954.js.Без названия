try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[87932],{540828:(e,t,i)=>{i.d(t,{JR:()=>s,UB:()=>o,_J:()=>n,_U:()=>r,aI:()=>a,oU:()=>d});const s=2,r=3,o=["photo_50","photo_100","photo_200","photo_400","is_nft","about","description","followers_count","is_closed","verified","screen_name","friend_status","is_subscribed","followers_count","blacklisted","domain","sex","can_write_private_message","first_name_gen","last_name_gen","first_name_acc","is_service_account"],n=["photo_50","photo_100","photo_200","photo_400","is_nft_photo","description","verified","screen_name","admin_level","member_status","members_count","is_subscribed","is_closed","is_member","ban_info","can_message"],d=Array.from(new Set([...o,...n])),a=["id","club","public","event"]},743918:(e,t,i)=>{i.d(t,{j:()=>O,R:()=>P});var s=i(331635),r=i(327813),o=i(571559),n=i(42107),d=i(160010),a=i(725308),h=i(24584),c=i(340310),p=i(909589),u=i(916533),l=i(645189),_=i(762044),g=i(626692);class m{get isSubscribed(){return this.usersSubscribeService.getIsSubscribed(this.data.id)}get isPendingSubscription(){return this.usersSubscribeService.getIsLoading(this.data.id)}async subscribe(){return await this.usersSubscribeService.subscribe({user_id:this.data.id}),!0}async unsubscribe(){return await this.usersSubscribeService.unsubscribe({user_id:this.data.id}),!0}get name(){return[this.data.first_name,this.data.last_name].filter(Boolean).join(" ").trim()}get screenName(){return this.data.screen_name||`id${this.data.id}`}get isAdmin(){return this.data.id===this.authService.userId}get followersCount(){return this.data.followers_count??0}get canSubscribe(){return!this.isAdmin&&!this.deactivated}get description(){return this.data.about??""}get deactivated(){return Boolean(this.data.deactivated)||Boolean(this.data.is_service_account)}constructor(e,t,i,s){this.ownerId=e,this.data=t,this.usersSubscribeService=i,this.authService=s,(0,r.l_)(this)}}var v=i(581288),w=i(978178);const f="clips";class S{get isSubscribed(){switch(this.groupsSubscribeService.getMemberStatus(this.data.id)){case v.I.MEMBER:case v.I.HAS_SENT_A_REQUEST:return!0;default:return!1}}get isPendingSubscription(){return this.groupsSubscribeService.getIsLoading(this.data.id)}async subscribe(e){return await this.groupsSubscribeService.join({group_id:this.data.id,source:f,track_code:e}),!0}async unsubscribe(e){return await this.groupsSubscribeService.leave({group_id:this.data.id,source:f,track_code:e}),!0}get name(){return this.data.name??""}get screenName(){return this.data.screen_name||`club${this.data.id}`}get isAdmin(){return this.data.admin_level===w.y.ADMINISTRATOR}get followersCount(){return this.data.members_count??0}get canSubscribe(){return!this.isAdmin&&!this.deactivated&&!Boolean(this.data.is_closed)}get description(){return this.data.description??""}get deactivated(){return Boolean(this.data.deactivated)}constructor(e,t,i,s){this.ownerId=e,this.data=t,this.groupsSubscribeService=i,this.shortVideoOwnersProvider=s,(0,r.l_)(this)}}var b=i(540828),k=i(119872),y=i(659802),M=i(645964);class I{addCountersFromApi(e){if(e.counters){const{clips_followers:t,clips_views:i,clips_likes:s}=e.counters,r=(0,M.Li)(e)?e.id:a.z.convertGroupIdToOwnerId(e.id);this.countersMap.set(r,{clips_followers:t,clips_views:i,clips_likes:s})}}get(e){return this.countersMap.get(e)}isPending(e){return this.pendingSet.has(e)}async ensure(e){if(!this.countersMap.get(e)&&!this.pendingSet.has(e)){this.pendingSet.add(e);try{if(a.z.isUserId(e)){(await this.usersApi.get({user_ids:`${e}`,fields:"counters"})).map((e=>this.addCountersFromApi(e)))}else{const t=await this.groupsApi.getById({group_ids:`${a.z.convertOwnerIdToGroupId(e)}`,fields:"counters"});t.groups?.map((e=>this.addCountersFromApi(e)))}}finally{(0,r.h5)((()=>{this.pendingSet.delete(e)}))}}}constructor(e,t){this.usersApi=e,this.groupsApi=t,this.countersMap=new Map,this.pendingSet=new Set,(0,r.l_)(this)}}I=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===h.l?Object:h.l,void 0===c.D?Object:c.D])],I);var O=function(e){return e.OWNER_ID_NOT_FOUND="OWNER_ID_NOT_FOUND",e.OWNER_DOES_NOT_EXIST="OWNER_DOES_NOT_EXIST",e}({});class P{addOwnerFromApi(e){const t=e.id,i=new m(t,e,this.usersSubscribeService,this.authService);this.ownersMap.set(t,i),e.screen_name&&this.ownersByScreenNameMap.set(e.screen_name,i),e.friend_status&&this.usersSubscribeService.setSubscriptionStatus(t,e.friend_status),this.ownerCountersService.addCountersFromApi(e)}addGroupFromApi(e){const t=a.z.convertGroupIdToOwnerId(e.id),i=new S(t,e,this.groupsSubscribeService,this);this.groupsProvider.createGroupFromApi({apiGroup:e,fields:""}),this.ownersMap.set(t,i),e.screen_name&&this.ownersByScreenNameMap.set(e.screen_name,i),this.ownerCountersService.addCountersFromApi(e)}async ensure(e){const t=this.get(e);if(t||this.isError(e))return t;const i=this.promisesMap.get(e);return i||this.fetch(e)}async fetch(e){try{const t=this.runFetch(e);return this.promisesMap.set(e,t),await t}finally{(0,r.h5)((()=>{this.promisesMap.delete(e)}))}}async runFetch(e){if(b.aI.includes(e.toString()))this.errorMap.set(e,"OWNER_ID_NOT_FOUND");else{if(this.userEnv.partConfigEnabled("clips_use_screenname_resolver"))try{this.pendingSet.add(e),this.errorMap.delete(e);const t="string"==typeof e?await this.resolveScreenName(e):this.resolveOwnerId(e);if(!t)return;switch(t.entityType){case"user":await this.fetchUser(t.entityId);break;case"group":await this.fetchGroup(t.entityId)}return this.get(e)||this.errorMap.set(e,"OWNER_DOES_NOT_EXIST"),this.get(e)}catch(t){throw(0,r.h5)((()=>{this.errorMap.set(e,t)})),new Error("Error fetch owner",{cause:t})}finally{(0,r.h5)((()=>{this.pendingSet.delete(e)}))}try{return this.pendingSet.add(e),this.errorMap.delete(e),"number"==typeof e?a.z.isGroupId(e)?await this.fetchGroupOld(e):await this.fetchUserOld(e):await Promise.all([this.fetchUserOld(e),this.fetchGroupOld(e)]),(0,r.h5)((()=>{this.pendingSet.delete(e)})),this.get(e)||this.errorMap.set(e,"OWNER_DOES_NOT_EXIST"),this.get(e)}catch(t){throw(0,r.h5)((()=>{this.pendingSet.delete(e),this.errorMap.set(e,t)})),new Error("Error fetch owner",{cause:t})}}}get(e){return"string"==typeof e?this.ownersByScreenNameMap.get(e):this.ownersMap.get(e)}isPending(e){return Boolean(this.pendingSet.has(e))}isError(e){return Boolean(this.errorMap.get(e))}getError(e){return this.errorMap.get(e)}async fetchUserOld(e){const t=await this.usersApi.getWithPrefetch({user_ids:`${e}`,fields:b.UB.join(",")});(0,r.h5)((()=>{t.forEach((e=>this.addOwnerFromApi(e)))}))}async fetchUser(e){const t=await this.usersApi.getWithPrefetch({user_ids:`${e}`,fields:b.UB.join(",")});(0,r.h5)((()=>{t.forEach((e=>this.addOwnerFromApi(e)))}))}async fetchGroupOld(e){try{const t=await this.groupsApi.getById({group_ids:"number"==typeof e?`${a.z.convertOwnerIdToGroupId(e)}`:e,fields:b._J.join(",")});(0,r.h5)((()=>{t.groups?.forEach((e=>this.addGroupFromApi(e)))}))}catch(t){if(!("string"==typeof e&&t instanceof Error&&(0,d.d)(t)&&t.error.error_code===o.cLy))throw new Error("Error fetch group",{cause:t})}}async fetchGroup(e){const t=await this.groupsApi.getById({group_ids:e.toString(),fields:b._J.join(",")});(0,r.h5)((()=>{t.groups?.forEach((e=>this.addGroupFromApi(e)))}))}async updateDescription(e,t){a.z.isGroupId(e)?(await this.groupsProvider.groupEdit({group_id:a.z.convertOwnerIdToGroupId(e),description:t}),await(this.userEnv.partConfigEnabled("clips_use_screenname_resolver")?this.fetchGroup(e):this.fetchGroupOld(e))):(await this.accountApi.saveInfo({about:t}),await(this.userEnv.partConfigEnabled("clips_use_screenname_resolver")?this.fetchUser(e):this.fetchUserOld(e)))}async resolveScreenName(e){const t=await this.screenNameResolver.ensureMatch({screenName:e,screenTypes:["user","group"]});return t&&{entityId:t.entityId,entityType:t.screenType}}resolveOwnerId(e){return a.z.isGroupId(e)?{entityId:a.z.convertOwnerIdToGroupId(e),entityType:"group"}:{entityId:e,entityType:"user"}}constructor(e,t,i,s,o,n,d,a,h,c){this.groupsProvider=e,this.groupsSubscribeService=t,this.usersSubscribeService=i,this.usersApi=s,this.groupsApi=o,this.accountApi=n,this.authService=d,this.screenNameResolver=a,this.userEnv=h,this.ownerCountersService=c,this.ownersMap=new Map,this.ownersByScreenNameMap=new Map,this.promisesMap=new Map,this.pendingSet=new Set,this.errorMap=new Map,(0,r.l_)(this)}}P=(0,s.Cg)([n.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===_.S?Object:_.S,void 0===g.Y?Object:g.Y,void 0===k.H?Object:k.H,void 0===h.l?Object:h.l,void 0===c.D?Object:c.D,void 0===p.y?Object:p.y,void 0===u.u?Object:u.u,void 0===y.O?Object:y.O,void 0===l.J?Object:l.J,void 0===I?Object:I])],P)},685680:(e,t,i)=>{i.d(t,{e:()=>a});var s=i(331635),r=i(327813),o=i(42107),n=i(184661),d=i(452200);class a{isPending(e){return this.pendingDeleteSet.has(e)}isPendingRestore(e){return this.pendingRestoreSet.has(e)}isDeleted(e){return this.deletedSet.has(e)}getDeletedClips(){return Array.from(this.deletedSet.values())}async delete(e){if(this.isPending(e))return!1;try{const{id:t,ownerId:i}=(0,d.v)(e);this.pendingDeleteSet.add(e);const s=Boolean(await this.shortVideoApi.delete({video_id:t,owner_id:i},{maxRetries:1}));return(0,r.h5)((()=>{s&&this.deletedSet.add(e),this.pendingDeleteSet.delete(e)})),s}catch(t){throw(0,r.h5)((()=>{this.pendingDeleteSet.delete(e)})),new Error("Cannot delete video",{cause:t})}}async restore(e){if(this.isPending(e))return!1;try{this.pendingRestoreSet.add(e);const t=Boolean(await this.shortVideoApi.restore({short_video_raw_id:e},{maxRetries:1}));return(0,r.h5)((()=>{t&&this.deletedSet.delete(e),this.pendingRestoreSet.delete(e)})),t}catch(t){throw(0,r.h5)((()=>{this.pendingRestoreSet.delete(e)})),new Error("Cannot restore video",{cause:t})}}constructor(e){this.shortVideoApi=e,this.deletedSet=new Set,this.pendingDeleteSet=new Set,this.pendingRestoreSet=new Set,(0,r.l_)(this)}}a=(0,s.Cg)([o.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===n.w?Object:n.w])],a)},924396:(e,t,i)=>{i.d(t,{y:()=>c});var s=i(331635),r=i(42107),o=i(144819),n=i(452200),d=i(327813),a=i(184661),h=i(419692);class c{setValuesFromVideo(e){const t=(0,o.WO)({id:e.id,ownerId:e.owner_id});this.likesMap.set(t,{count:e.engagement?.like_count??0,userLikes:Boolean(e.engagement?.is_liked)}),e.track_code&&this.trackCodeMap.set(t,e.track_code)}isPending(e){return this.pendingSet.has(e)}getLikes(e){return this.likesMap.get(e)}isNotInterested(e){return this.notInterestedSet.has(e)}async setLike(e){if(!this.isPending(e))try{const{id:t,ownerId:i}=(0,n.v)(e);this.pendingSet.add(e);const s=await this.likesApi.add({type:"video",owner_id:i,item_id:t,track_code:this.getTrackCode(e)});(0,d.h5)((()=>{this.likesMap.set(e,{count:s.likes,userLikes:!0}),this.pendingSet.delete(e)})),this.isNotInterested(e)&&await this.resetNotInterested(e)}catch(t){throw(0,d.h5)((()=>{this.pendingSet.delete(e)})),new Error("Cannot like clip",{cause:t})}}async setDislike(e){if(!this.isPending(e))try{const{id:t,ownerId:i}=(0,n.v)(e);this.pendingSet.add(e);const s=await this.likesApi.delete({type:"video",owner_id:i,item_id:t,track_code:this.getTrackCode(e)});(0,d.h5)((()=>{this.likesMap.set(e,{count:s.likes,userLikes:!1}),this.pendingSet.delete(e)}))}catch(t){throw(0,d.h5)((()=>{this.pendingSet.delete(e)})),new Error("Cannot dislike clip",{cause:t})}}toggleLike(e){return this.getLikes(e)?.userLikes?this.setDislike(e):this.setLike(e)}async setNotInterested(e){if(this.isPending(e)||this.notInterestedSet.has(e))return!1;try{const{id:t,ownerId:i}=(0,n.v)(e);this.pendingSet.add(e);const s=await this.shortVideoApi.notInterested({video_id:t,owner_id:i,track_code:this.getTrackCode(e)});return(0,d.h5)((()=>{this.pendingSet.delete(e),this.notInterestedSet.add(e)})),this.likesMap.get(e)?.userLikes&&await this.setDislike(e),Boolean(s)}catch(t){throw(0,d.h5)((()=>{this.pendingSet.delete(e)})),new Error("Cannot mark clip as not interested",{cause:t})}}async resetNotInterested(e){if(this.isPending(e)||!this.notInterestedSet.has(e))return!1;try{const{id:t,ownerId:i}=(0,n.v)(e);this.pendingSet.add(e);const s=await this.shortVideoApi.notInterested({video_id:t,owner_id:i,unset:1,track_code:this.getTrackCode(e)});return(0,d.h5)((()=>{this.pendingSet.delete(e),this.notInterestedSet.delete(e)})),Boolean(s)}catch(t){throw(0,d.h5)((()=>{this.pendingSet.delete(e)})),new Error("Cannot unmark clip as not interested",{cause:t})}}toggleNotInterested(e){return this.isNotInterested(e)?this.resetNotInterested(e):this.setNotInterested(e)}getTrackCode(e){return this.trackCodeMap.get(e)??""}constructor(e,t){this.shortVideoApi=e,this.likesApi=t,this.pendingSet=new Set,this.likesMap=new Map,this.notInterestedSet=new Set,this.trackCodeMap=new Map,(0,d.l_)(this)}}c=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.w?Object:a.w,void 0===h.d?Object:h.d])],c)},287932:(e,t,i)=>{i.d(t,{$:()=>y});var s=i(331635),r=i(42107),o=i(327813),n=i(144819),d=i(184661),a=i(743918),h=i(540828);function c(e){return e.parent?c(e.parent):e}function p(e){return Boolean(e.market_item)}function u(e){return Boolean(e.place_info)}function l(e){const{id:t,owner_id:i,privacy_view:s,privacy_comment:r,views:o,comments:n,likes:d,reposts:a,is_subscribed:h,is_favorite:c,can_edit:p,can_like:u,can_delete:l,can_comment:_,can_repost:g,can_subscribe:m,can_download:v,track_code:w,need_mute:f,image:S,files:b,first_frame:k,timeline_thumbs:y,ov_id:M,date:I,description:O,duration:P,action_button:A,ord_info:V,published_at:E,restriction:F,short_video_info:C,width:N,height:T,ads_info:B,is_author:D,processing:j,access_info:R,wall_post_id:U,share_url:G}=e,{co_owners:z,audio:L,source_video:W,clickable_stickers:$,compilations:X,effects:x,masks:J,duet:H,playlists:Q,highlighted_hashtags:Y}=C??{},q={id:t??0,owner_id:i??0,is_muted:Boolean(f),united_video_id:M,duration_seconds:P,description:O,track_code:w,width:N,height:T,covers:S,files:b,first_frames:k,timeline_thumbs:y,is_author:D,publish_timestamp:I,scheduled_timestamp:E,co_owners:z,source_video:W,compilation_ids:X?.map((e=>e.id??0)),effect_ids:x?.map((e=>({effect_id:e.id,effect_owner_id:e.owner_id}))),mask_ids:J?.map((e=>({mask_id:e.id,mask_owner_id:e.owner_id}))),duet:H,playlists:Q,ord:V,ad:B,is_processing:Boolean(j),wall_post_id:U,share_url:G,highlighted_hashtags:Y};var K;return q.engagement={view_count:o,comment_count:n,repost_count:a?.count,like_count:d?.count,is_favorite:c,is_anon_liked:e.short_video_info?.anon_user_like_exists,is_liked:Boolean(d?.user_likes),is_reposted:Boolean(a?.user_reposted),is_subscribed:Boolean(h)},q.access={can_delete:Boolean(l),can_comment:Boolean(_),can_like:Boolean(u),can_repost:Boolean(g),can_subscribe:Boolean(m),can_make_duet:Boolean(e.short_video_info?.can_make_duet),can_download:Boolean(v),edit:{allow:Boolean(p),disclaimers:R?.edit_forbidden_reasons?.map((e=>e.code)).filter(Boolean)}},L&&(q.audio_id={audio_id:L.id,audio_owner_id:L.owner_id}),F&&(q.restriction=function(e){return{...e,title:e.title??"",blur:Boolean(e.blur),can_play:Boolean(e.can_play),button:"play"===e.button?.action?e.button:void 0}}(F)),A&&(q.action_button={object_id:(K=A).id,type:K.type,url:K.url,title:K.snippet?.title||K.snippet?.open_title||""}),s&&r&&(q.privacy={view:s,comment:r}),$&&(q.clickable_stickers={...$,items:$.items.map((e=>e.market_item?{...e,market_item_id:e.market_item.id}:e))}),q}class _{get rawId(){return(0,n.WO)({id:this.data.id,ownerId:this.data.owner_id})}get isDeleted(){return this.shortVideoDeleteService.isDeleted(this.rawId)}get isRestricted(){return Boolean(this.data.restriction&&!this.data.restriction?.can_play)}get isPendingDelete(){return this.shortVideoDeleteService.isPending(this.rawId)}get isEditForbiddenByAd(){return Boolean(this.data.access?.edit?.disclaimers?.some((e=>"ad"===e)))}get owner(){return this.shortVideoOwnersProvider.get(this.data.owner_id)}get availableOnlyForOwner(){return Boolean("only_me"===this.data.privacy?.view?.category)}get audio(){return this.data.audio_id?this.shortVideoAudiosProvider.get((0,n.WO)({id:this.data.audio_id.audio_id,ownerId:this.data.audio_id.audio_owner_id})):void 0}get compilations(){return this.data.compilation_ids?.map((e=>this.shortVideoCompilationsProvider.get(e))).filter(Boolean)??[]}get effects(){return this.data.effect_ids?.map((e=>this.shortVideoEffectsProvider.get((0,n.WO)({id:e.effect_id,ownerId:e.effect_owner_id})))).filter(Boolean)??[]}get masks(){return this.data.mask_ids?.map((e=>this.shortVideoMasksProvider.get((0,n.WO)({id:e.mask_id,ownerId:e.mask_owner_id})))).filter(Boolean)??[]}get marketItem(){const e=this.data.clickable_stickers?.items.find((e=>e.market_item_id));if(e?.market_item_id){const t=this.shortVideoMarketItemsProvider.get(e.market_item_id);if(t)return{...t,ads_label:e.ads_label,is_service:12===c(t.category).id}}}get placeInfo(){const e=this.data.clickable_stickers?.items.find((e=>e.place_id))?.place_id;return e?this.shortVideoPlacesProvider.get(e):void 0}constructor(e,t,i,s,r,n,d,a,h){this.data=e,this.shortVideoOwnersProvider=t,this.shortVideoDeleteService=i,this.shortVideoAudiosProvider=s,this.shortVideoCompilationsProvider=r,this.shortVideoEffectsProvider=n,this.shortVideoMarketItemsProvider=d,this.shortVideoMasksProvider=a,this.shortVideoPlacesProvider=h,(0,o.l_)(this)}}var g=i(685680),m=i(924396);class v{addCompilationFromApi(e){e.id&&this.compilationsMap.set(e.id,e)}get(e){return this.compilationsMap.get(e)}constructor(){this.compilationsMap=new Map,(0,o.l_)(this)}}v=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],v);class w{addAudioFromApi(e){e.id&&this.audiosMap.set((0,n.WO)({id:e.id,ownerId:e.owner_id}),e)}get(e){return this.audiosMap.get(e)}constructor(){this.audiosMap=new Map,(0,o.l_)(this)}}w=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],w);class f{addEffectFromApi(e){this.effectsMap.set((0,n.WO)({id:e.id,ownerId:e.owner_id}),e)}get(e){return this.effectsMap.get(e)}constructor(){this.effectsMap=new Map,(0,o.l_)(this)}}f=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],f);class S{addMarketItemFromApi(e){e.id&&this.marketItemsMap.set(e.id,e)}get(e){return this.marketItemsMap.get(e)}constructor(){this.marketItemsMap=new Map,(0,o.l_)(this)}}S=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],S);class b{addMaskFromApi(e){this.masksMap.set((0,n.WO)({id:e.id,ownerId:e.owner_id}),e)}get(e){return this.masksMap.get(e)}constructor(){this.masksMap=new Map,(0,o.l_)(this)}}b=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],b);class k{addPlaceFromApi(e){e.id&&this.placesMap.set(e.id,e)}get(e){return this.placesMap.get(e)}constructor(){this.placesMap=new Map,(0,o.l_)(this)}}k=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[])],k);class y{addVideoFromApi(e){const t=new _(l(e),this.shortVideoOwnersProvider,this.shortVideoDeleteService,this.shortVideoAudiosProvider,this.shortVideoCompilationsProvider,this.shortVideoEffectsProvider,this.shortVideoMarketItemsProvider,this.shortVideoMasksProvider,this.shortVideoPlacesProvider);this.videoMap.set(t.rawId,t),this.shortVideoLikeService.setValuesFromVideo(t.data),e.short_video_info?.audio&&this.shortVideoAudiosProvider.addAudioFromApi(e.short_video_info?.audio),e.short_video_info?.compilations?.length&&e.short_video_info.compilations.map((e=>this.shortVideoCompilationsProvider.addCompilationFromApi(e))),e.short_video_info?.effects?.length&&e.short_video_info.effects.map((e=>this.shortVideoEffectsProvider.addEffectFromApi(e))),e.short_video_info?.masks?.length&&e.short_video_info.masks.map((e=>this.shortVideoMasksProvider.addMaskFromApi(e)));const i=e.short_video_info?.clickable_stickers?.items.flat().filter(Boolean)??[];i.filter(p).map((e=>this.shortVideoMarketItemsProvider.addMarketItemFromApi(e.market_item))),i.filter(u).map((e=>this.shortVideoPlacesProvider.addPlaceFromApi(e.place_info)))}addShortVideoFromApi(e){if("short_video_full"===e.type){const t=new _(e.item,this.shortVideoOwnersProvider,this.shortVideoDeleteService,this.shortVideoAudiosProvider,this.shortVideoCompilationsProvider,this.shortVideoEffectsProvider,this.shortVideoMarketItemsProvider,this.shortVideoMasksProvider,this.shortVideoPlacesProvider);this.videoMap.set(t.rawId,t),this.shortVideoLikeService.setValuesFromVideo(t.data)}}isPending(e){return this.pendingSet.has(e)}isError(e){return this.errorMap.has(e)}get(e){return this.videoMap.get(e)}delete(e){this.videoMap.delete(e)}async fetch(e,t){const i=e.videos?.split(",")??[];try{i.forEach((e=>this.pendingSet.add(e)));const{videos:s,fields:r}=e,{feed:n,profiles:d,groups:a,compilations:h,masks:c,effects:p,places:u,market_items:l,audios:_}=await this.shortVideoApi.get({short_video_raw_ids:s??"",fields:r},t);(0,o.h5)((()=>{n.items.map((e=>this.addShortVideoFromApi(e))),d?.map((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e))),a?.map((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),_?.map((e=>this.shortVideoAudiosProvider.addAudioFromApi(e))),h?.map((e=>this.shortVideoCompilationsProvider.addCompilationFromApi(e))),p?.map((e=>this.shortVideoEffectsProvider.addEffectFromApi(e))),l?.map((e=>this.shortVideoMarketItemsProvider.addMarketItemFromApi(e))),c?.map((e=>this.shortVideoMasksProvider.addMaskFromApi(e))),u?.map((e=>this.shortVideoPlacesProvider.addPlaceFromApi(e)))}));const g=n.items.filter((({type:e})=>"short_video_full"===e)).map((({item:e})=>e));return{items:g,profiles:d,groups:a,count:g.length}}catch(e){throw(0,o.h5)((()=>{i.forEach((t=>this.errorMap.set(t,e)))})),new Error("Fetch video failed",{cause:e})}finally{(0,o.h5)((()=>{i.forEach((e=>this.pendingSet.delete(e)))}))}}async fetchAllFields(e,t){await this.fetch({videos:`${e}`,fields:h.oU.join(","),extended:1,track_code:t})}async update(e,t){const i=(0,n.WO)({id:e.video_id,ownerId:e.owner_id});try{return this.pendingSet.add(i),await this.shortVideoApi.edit(e,t)}finally{this.pendingSet.delete(i)}}async edit(e,t={}){const i=await this.update(e,t);(0,o.h5)((()=>{i.video&&this.addVideoFromApi(i.video)}))}constructor(e,t,i,s,r,n,d,a,h,c){this.shortVideoOwnersProvider=e,this.shortVideoApi=t,this.shortVideoDeleteService=i,this.shortVideoLikeService=s,this.shortVideoAudiosProvider=r,this.shortVideoCompilationsProvider=n,this.shortVideoEffectsProvider=d,this.shortVideoMarketItemsProvider=a,this.shortVideoMasksProvider=h,this.shortVideoPlacesProvider=c,this.videoMap=new Map,this.pendingSet=new Set,this.errorMap=new Map,(0,o.l_)(this)}}y=(0,s.Cg)([r.z8.container(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a.R?Object:a.R,void 0===d.w?Object:d.w,void 0===g.e?Object:g.e,void 0===m.y?Object:m.y,void 0===w?Object:w,void 0===v?Object:v,void 0===f?Object:f,void 0===S?Object:S,void 0===b?Object:b,void 0===k?Object:k])],y)},119872:(e,t,i)=>{i.d(t,{H:()=>h});var s=i(331635),r=i(42107),o=i(150242),n=i(73762),d=i(327813),a=i(877351);class h{getIsLoading(e){return this.loadings.has(e)}getSubscriptionStatus(e){return this.usersSubscriptionStatus.get(e)}getIsSubscribed(e){switch(this.getSubscriptionStatus(e)){case o.h.IS_FRIEND:case o.h.OUTCOMING_REQUEST:return!0;case o.h.NOT_A_FRIEND:case o.h.INCOMING_REQUEST:default:return!1}}setSubscriptionStatus(e,t){this.usersSubscriptionStatus.set(e,t)}async subscribe(e,t){if(!this.getIsLoading(e.user_id)){this.loadings.add(e.user_id);try{const i=await this.friendsApi.add(e,t);(0,d.h5)((()=>{switch(i){case n.Xp.SEND:case n.Xp.RESEND:this.usersSubscriptionStatus.set(e.user_id,o.h.OUTCOMING_REQUEST);break;case n.Xp.APPROVED:this.usersSubscriptionStatus.set(e.user_id,o.h.IS_FRIEND)}}))}finally{(0,d.h5)((()=>{this.loadings.delete(e.user_id)}))}}}async unsubscribe(e,t){if(!this.getIsLoading(e.user_id)){this.loadings.add(e.user_id);try{const{success:i}=await this.friendsApi.delete(e,t);return(0,d.h5)((()=>{i&&this.usersSubscriptionStatus.set(e.user_id,o.h.NOT_A_FRIEND)})),i}finally{(0,d.h5)((()=>{this.loadings.delete(e.user_id)}))}}}async toggleSubscription(e,t){return this.getIsSubscribed(e.user_id)?this.unsubscribe(e,t):this.subscribe(e,t)}constructor(e){this.friendsApi=e,this.loadings=new Set,this.usersSubscriptionStatus=new Map,(0,d.l_)(this)}}h=(0,s.Cg)([r.z8.global(),(0,s.Sn)("design:type",Function),(0,s.Sn)("design:paramtypes",[void 0===a._?Object:a._])],h)},184661:(e,t,i)=>{i.d(t,{w:()=>n});var s=i(331635),r=i(42107),o=i(820282);class n extends o.S{get namespace(){return"shortVideo"}constructor(...e){super(...e),this.getOwnerVideos=this.makeMethod("getOwnerVideos"),this.getChallenge=this.makeMethod("getChallenge"),this.getClipCounters=this.makeMethod("getClipCounters"),this.get=this.makeMethod("get",!0),this.create=this.makeMethod("create"),this.edit=this.makeMethod("edit"),this.publish=this.makeMethod("publish"),this.delete=this.makeMethod("delete"),this.restore=this.makeMethod("restore"),this.getTopVideos=this.makeMethod("getTopVideos"),this.getRecom=this.makeMethod("getRecom",!0),this.sendPush=this.makeMethod("sendPush"),this.getGroupsForUploading=this.makeMethod("getGroupsForUploading"),this.notInterested=this.makeMethod("notInterested"),this.getPlaylists=this.makeMethod("getPlaylists"),this.addToPlaylist=this.makeMethod("addToPlaylist"),this.removeFromPlaylist=this.makeMethod("removeFromPlaylist"),this.getDownloadUrl=this.makeMethod("getDownloadUrl"),this.getTopTags=this.makeMethod("getTopTags"),this.getUserSettings=this.makeMethod("getUserSettings"),this.getThumbUploadUrl=this.makeMethod("getThumbUploadUrl"),this.saveUploadedThumb=this.makeMethod("saveUploadedThumb"),this.encodeProgress=this.makeMethod("encodeProgress")}}n=(0,s.Cg)([r.z8.global()],n)}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/87932.4b47c954.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/87932.4b47c954.js",e),e}