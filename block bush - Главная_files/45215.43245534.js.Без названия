try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[45215],{434877:(t,e,i)=>{i.d(e,{V:()=>I});var n=i(331635),s=i(327813),r=i(42107),o=i(725308),a=i(651253),d=i(434518),l=i(763812),u=i(23692),c=(0,l._)("_data");class p{get type(){return u._.Group}get data(){return(0,d._)(this,c)[c]}get id(){return o.z.convertGroupIdToOwnerId(this.data.groupId)}constructor(t){Object.defineProperty(this,c,{writable:!0,value:void 0}),(0,d._)(this,c)[c]=t}}var y=(0,l._)("_data");class h{get type(){return u._.User}get data(){return(0,d._)(this,y)[y]}get id(){return this.data.userId}constructor(t){Object.defineProperty(this,y,{writable:!0,value:void 0}),(0,d._)(this,y)[y]=t}}var g=i(945810);function v(t){const e=t.first_name??null,i=t.last_name??null,n=t.domain??null;if(!e&&!i)throw new Error("firstName or lastName required for AudioUserOwnerData");return{type:u._.User,userId:t.id,firstName:e,lastName:i,avatar:f(t),domain:n,source:t}}function f(t){if(!t)return null;const e=[];for(const[i,n]of g.U){const s=t[i];s&&e.push({src:s,width:n,height:n})}return{sizes:e}}var m=i(566979);class I{isSupported(t){return o.z.isGroupId(t)||o.z.isUserId(t)}get(t){if(o.z.isGroupId(t)){const e=o.z.convertOwnerIdToGroupId(t);return this.groups.get(e)}if(o.z.isUserId(t))return this.users.get(t)}provide(t){switch(t.type){case u._.Group:return this.provideGroup(t);case u._.User:return this.provideUser(t)}}provideGroup(t){let e=this.groups.get(t.groupId);return e||(e=new p(t),this.groups.set(e.data.groupId,e)),e}provideUser(t){let e=this.users.get(t.userId);return e||(e=new h(t),this.users.set(e.data.userId,e)),e}provideFromAPI(t){const e=[],i=[];for(const i of t.users??[])try{const t=v(i);e.push(this.provideUser(t))}catch(t){this.logger.log(t)}for(const e of t.groups??[])try{const t=(0,m.G)(e);i.push(this.provideGroup(t))}catch(t){this.logger.log(t)}return{users:e,groups:i}}constructor(t){this.logger=t,this.users=new Map,this.groups=new Map,(0,s.Gn)(this)}}(0,n.Cg)([s.sH.shallow],I.prototype,"users",void 0),(0,n.Cg)([s.sH.shallow],I.prototype,"groups",void 0),(0,n.Cg)([s.XI,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",["undefined"==typeof TAudioOwnerData?Object:TAudioOwnerData]),(0,n.Sn)("design:returntype","undefined"==typeof TAudioOwner?Object:TAudioOwner)],I.prototype,"provide",null),(0,n.Cg)([s.XI,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",["undefined"==typeof IAudioGroupOwnerData?Object:IAudioGroupOwnerData]),(0,n.Sn)("design:returntype","undefined"==typeof IAudioGroupOwner?Object:IAudioGroupOwner)],I.prototype,"provideGroup",null),(0,n.Cg)([s.XI,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",["undefined"==typeof IAudioUserOwnerData?Object:IAudioUserOwnerData]),(0,n.Sn)("design:returntype","undefined"==typeof IAudioUserOwner?Object:IAudioUserOwner)],I.prototype,"provideUser",null),(0,n.Cg)([s.XI,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",["undefined"==typeof IAudioOwnerProvideAPISource?Object:IAudioOwnerProvideAPISource]),(0,n.Sn)("design:returntype","undefined"==typeof IAudioOwners?Object:IAudioOwners)],I.prototype,"provideFromAPI",null),I=(0,n.Cg)([r.z8.global(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[void 0===a.v?Object:a.v])],I)},23692:(t,e,i)=>{i.d(e,{_:()=>n});var n=function(t){return t.Group="group",t.User="user",t}({})},945810:(t,e,i)=>{i.d(e,{U:()=>n});const n=[["photo_50",50],["photo_100",100],["photo_200",200],["photo_200_orig",200],["photo_400",400],["photo_400_orig",400],["photo_base",720]]},566979:(t,e,i)=>{i.d(e,{G:()=>r});var n=i(945810),s=i(23692);function r(t){const e=t.name,i=t.screen_name??null;return function(t,e){if(null==t)throw new Error(`${e} required for create AudioUserOwnerData`)}(e,"title"),{type:s._.Group,groupId:t.id,title:e,avatar:o(t),domain:i,source:t}}function o(t){if(!t)return null;const e=[];for(const[i,s]of n.U){const n=t[i];n&&e.push({src:n,width:s,height:s})}return{sizes:e}}},1872:(t,e,i)=>{i.d(e,{B:()=>c});var n=i(434518),s=i(763812),r=i(327813),o=i(188566),a=(0,s._)("_identity"),d=(0,s._)("_context"),l=(0,s._)("_getData"),u=(0,s._)("_attachContext");class c extends o.B{get identity(){return(0,n._)(this,a)[a]}get context(){return(0,n._)(this,d)[d]}attachContext(t){const e=(0,n._)(this,u)[u];if(!e)throw new Error("Audio is not contextable");return e(t)}get data(){return(0,n._)(this,l)[l]()}get length(){return this.items.length}get type(){return this.data.type}audioAtStrict(t){const e=this.audioAt(t);if(!e)throw new Error("Audio not found");return e}getContextStrict(){const{context:t}=this;if(!t)throw new Error("AudioList is not contextual");return t}constructor(t){super(),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),(0,n._)(this,a)[a]=t.identity,(0,n._)(this,d)[d]=t.context,(0,n._)(this,l)[l]=t.getData,(0,n._)(this,u)[u]=t.attachContext,(0,r.Gn)(this)}}},309266:(t,e,i)=>{i.d(e,{h:()=>s});var n=i(293925),s=function(t){return t.Album="album",t.EP="ep",t.Collection="collection",t.Single="single",t}({});n.nd[n.CM.Album],n.nd[n.CM.EP],n.nd[n.CM.Collection],n.nd[n.CM.Single]},945215:(t,e,i)=>{i.d(e,{X:()=>ot});var n=i(434518),s=i(763812),r=i(331635),o=i(327813),a=i(42107),d=i(725308),l=i(228909),u=i(45734),c=i(414618),p=i(916533),y=i(490455),h=i(721126),g=i(321171),v=i(710231),f=i(434877);class m{get isFollowed(){return this.service.isFollowed(this.originalIdentity)}get state(){return this.isFollowed}get isPending(){return this.service.checkPending(this.followedIdentity??this.originalIdentity)}async activate(){await this.service.follow(this.originalIdentity,{ref:this.ref})}async deactivate(){const{followedIdentity:t}=this;if(!t)throw new Error("Not followed");await this.service.unfollow(t)}async toggle(t,e){const i=e??!this.state;await this[i?"deactivate":"activate"]()}get originalIdentity(){const{identity:t,originalIdentity:e}=this.playlist;return e??this.service.getOriginalIdentity(t)??t}get followedIdentity(){return this.playlist.followedIdentity??this.service.getFollowedIdentity(this.originalIdentity)??null}get ref(){return this.playlist.context.ref}constructor(t){this.playlist=t.playlist,this.service=t.service,(0,o.Gn)(this)}}(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],m.prototype,"isFollowed",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],m.prototype,"state",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],m.prototype,"isPending",null);var I=i(1872),w=(0,s._)("_getItemsService"),S=(0,s._)("_getDuration"),b=(0,s._)("_ensureExtendedData"),C=(0,s._)("_getContextualAudioForItem");class _ extends I.B{get items(){return this.itemsService.items.filter((({identity:t})=>!this.trackProvider.corruptedIdentities.has(t)))}get head(){const t=[];for(const e of this.items){const i=(0,n._)(this,C)[C](e);if(!i)return t;t.push(i)}return t}get isItemsInitialized(){return this.itemsService.isInitialized}get hasFetchingItems(){return this.itemsService.hasFetching}get isHeadFetching(){return this.items.some((({identity:t})=>this.trackProvider.isFetchingAudio(t)))}get isEmpty(){const{itemsService:t}=this;return t.isInitialized?!this.items.length:!this.count}audioAt(t){const e=this.items.at(t);if(e)return(0,n._)(this,C)[C](e)}get owner(){return this.audioOwnerProvider.get(this.identity.ownerId)??null}get originalOwner(){const t=this.originalIdentity;return t?this.audioOwnerProvider.get(t.ownerId)??null:null}get followedOwner(){const t=this.followedIdentity;return t?this.audioOwnerProvider.get(t.ownerId)??null:null}get originalIdentity(){const t=this.data.originalIdentity;return t?new l._(t):null}get followedIdentity(){const t=this.data.followedIdentity;return t?new l._(t):null}get isOriginal(){const{originalIdentity:t}=this;return!t||this.identity.fullId===t.fullId}get title(){return this.data.title}get subtitle(){return this.data.subtitle}get description(){return this.data.description}get cover(){return this.data.cover}get thumbs(){return this.data.thumbs}get count(){return this.data.count}get plays(){return this.data.plays}get isExclusive(){return this.data.isExclusive}get isDiscoverable(){return this.data.isDiscoverable}get isExplicit(){return this.data.isExplicit}get legal(){return this.data.legal}get permissions(){return this.data.permissions}get updateDate(){return this.data.updateDate}get source(){return this.data.source}get duration(){return(0,n._)(this,S)[S]()}has(t){return this.itemsService.has(t)}async ensureExtendedData(){await(0,n._)(this,b)[b]()}async ensureItems(){return this.itemsService.ensure()}async fetchItems(){return this.itemsService.fetch()}async fetchAt(t,e={}){let{range:i,prefetch:n}=e;!i&&n&&(i=5);const s=this.getFetchAtIndexes(t,{...e,range:i}).map((t=>this.items.at(t)?.identity));await this.trackProvider.ensureMany(s);const r=(i??0)-s.reduce(((t,e)=>this.trackProvider.corruptedIdentities.has(e)?t+1:t),0);return r>=0&&this.assertFetchAtFetched(t,{...e,range:r}),this.audioAtStrict(t)}fetchNext(t=100){return this.fetchNextByAt(t)}get itemsService(){return(0,n._)(this,w)[w]()}constructor(t){super(t),Object.defineProperty(this,C,{value:O}),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:void 0}),this.audioApi=t.audioApi,this.trackProvider=t.trackProvider,this.audioOwnerProvider=t.audioOwnerProvider,(0,n._)(this,w)[w]=t.getItemsService,(0,n._)(this,S)[S]=t.getDuration,(0,n._)(this,b)[b]=t.ensureExtendedData,(0,o.Gn)(this)}}function O(t){const{trackProvider:e}=this;return e.get(t.identity,{list:this,trackCode:t.trackCode})}(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Object),(0,r.Sn)("design:paramtypes",[])],_.prototype,"items",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Object),(0,r.Sn)("design:paramtypes",[])],_.prototype,"head",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],_.prototype,"isItemsInitialized",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],_.prototype,"hasFetchingItems",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],_.prototype,"isHeadFetching",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],_.prototype,"isEmpty",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],_.prototype,"owner",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],_.prototype,"originalOwner",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],_.prototype,"followedOwner",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],_.prototype,"originalIdentity",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],_.prototype,"followedIdentity",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",Boolean),(0,r.Sn)("design:paramtypes",[])],_.prototype,"isOriginal",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],_.prototype,"duration",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type","undefined"==typeof ItemsService?Object:ItemsService),(0,r.Sn)("design:paramtypes",[])],_.prototype,"itemsService",null);class E extends _{get genres(){return this.data.genres}get releaseYear(){return this.data.releaseYear}get subtype(){return this.data.subtype}get authors(){return this.data.authors}get focusTrackIdentities(){return this.head.reduce(((t,e)=>(e.isFocusTrack&&t.push(e.identity),t)),[])}constructor(t){super(t),this.following=new m({playlist:this,service:t.followingService}),(0,o.Gn)(this)}}(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],E.prototype,"focusTrackIdentities",null);class M extends _{get authors(){if(!(this.originalOwner??this.owner))return[]}}class D extends _{get isCurator(){return this.data.isCurator}constructor(t){super(t),this.following=new m({playlist:this,service:t.followingService}),(0,o.Gn)(this)}}class A extends _{constructor(t){super(t),this.following=new m({playlist:this,service:t.followingService}),(0,o.Gn)(this)}}class k extends _{constructor(t){super(t),this.following=new m({playlist:this,service:t.followingService}),(0,o.Gn)(this)}}var x=(0,s._)("_getEditingService");class G extends _{get editor(){return(0,n._)(this,x)[x]()}get itemsOwning(){return this.itemsService}get isDiscoverable(){return this.editingService.state.isDiscoverable}get editingService(){return(0,n._)(this,x)[x]()}constructor(t){super(t),Object.defineProperty(this,x,{writable:!0,value:void 0}),(0,n._)(this,x)[x]=t.getEditingService,(0,o.Gn)(this)}}(0,r.Cg)([o.EW,(0,r.Sn)("design:type","undefined"==typeof IMusicPlaylistEditor?Object:IMusicPlaylistEditor),(0,r.Sn)("design:paramtypes",[])],G.prototype,"editor",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type","undefined"==typeof IMusicPlaylistItemsOwning?Object:IMusicPlaylistItemsOwning),(0,r.Sn)("design:paramtypes",[])],G.prototype,"itemsOwning",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],G.prototype,"isDiscoverable",null),(0,r.Cg)([o.EW,(0,r.Sn)("design:type",void 0),(0,r.Sn)("design:paramtypes",[])],G.prototype,"editingService",null);var j=i(627255),F=i(648536),U=i(293925),W=i(766697);new Map([[U.nd[U.CM.NoAlbum],U.CM.NoAlbum],[U.nd[U.CM.Album],U.CM.Album],[U.nd[U.CM.EP],U.CM.EP],[U.nd[U.CM.Collection],U.CM.Collection],[U.nd[U.CM.Single],U.CM.Single],[U.nd[U.CM.Chat],U.CM.Chat]]);function T(t,e){const{title:i,subtitle:n,description:s,count:r,plays:o,exclusive:a,is_explicit:d,no_discover:l,update_time:u,main_color:c}=e,p=d??!1;return{type:t,identity:(0,W.z)(e),originalIdentity:e.original?(0,W.p)(e.original):null,followedIdentity:e.followed?(0,W.p)(e.followed):null,title:i,subtitle:n,description:s,cover:z(e,c),thumbs:X(e),count:r,plays:o,isExclusive:a??!1,isExplicit:p,isDiscoverable:!l,updateDate:new Date(1e3*u),permissions:B(e),legal:{isExplicit:p,isForeignAgent:!1},contextFlagsBitmask:e.flags_context,source:{playlist:e}}}function z(t,e){const i=t.photo;return i?(0,F.X)(i,e):null}function X(t){return(t.thumbs??[]).map((t=>(0,F.X)(t)))}function B(t){const e=t.permissions;return{play:e?.play??!1,share:e?.share??!1,edit:e?.edit??!1,follow:e?.follow??!1,delete:e?.delete??!1,saveAsCopy:e?.save_as_copy??!1}}var N=i(986609);function H(t){const{id:e,name:i}=t;return{id:e,name:i}}var K=i(309266);function R(t){const{genres:e}=t;return e?e.map(H):[]}function V(t){const{main_artists:e,featured_artists:i,main_artist:n}=t;return{main:e?.map(Y)??[],feat:i?.map(Y)??[],raw:n??""}}function Y(t){return{id:t.id,name:t.name,avatar:q(t)}}function q(t){const e=t.photo;return e?(0,N._0)(e):null}function L(t){const e=t.album?.type;switch(e){case"album":default:return K.h.Album;case"ep":return K.h.EP;case"collection":return K.h.Collection;case"single":return K.h.Single}}var $=i(990126),J=i(249018),Q=i(860656),Z=i(682941),tt=i(444155);function et(t){const e=(0,Q.b)("domains/audio/MusicPlaylistProvider/stuffing",(()=>({})),{version:3})();return e.current||(e.current=function(t){return{entities:new Z.W,data:new Z.W,durations:new Z.W,fetchings:new Z.W,pendingPlaylists:new tt.S,pendingDeletedPlaylists:new tt.S,deletedPlaylists:new tt.S,corruptedCoverMainColors:new tt.S,emitter:t.create()}}(t)),e.current}var it=(0,s._)("_corruptedCoverMainColors"),nt=(0,s._)("_setState"),st=(0,s._)("_setEditingServiceState"),rt=(0,s._)("_fetch");class ot{static getContextKey(t){return t.ref}get events(){return this.emitter.listenable}get(t,e,i){const n=this.entities.get(t);if(!n)return;const s=n.get(ot.getContextKey(e));if(s)return s;const r=this.data.get(t);return r?this.construct(r,e,i):void 0}has(t){return this.data.has(t)}checkPending(t){return this.pendingPlaylists.has(t)}checkDeleting(t){return this.pendingDeletedPlaylists.has(t)}checkDeleted(t){return this.deletedPlaylists.has(t)}async ensure(t,e,i){const n=this.get(t,e,i);return n||this.fetch(t,e,i)}async ensureExtendedData(t,e,i){let s=this.get(t,e,i);const r=this.audioOwnerProvider.get(t.ownerId),o=this.durations.get(t);if(!s||!r||"number"!=typeof o||!(0,n._)(this,it)[it].has(t)&&!ut(s))return this.fetch(t,e,i)}create(t,e,i){const s=this.toEntityIdentity(t.identity);return(0,n._)(this,nt)[nt](s,t.type,e),this.cacheData(t),this.construct(t,i)}cacheEntity(t){const{identity:e}=t;let i=this.entities.get(e);return i||(i=(0,o.sH)(new Map),this.entities.set(e,i)),i.set(ot.getContextKey(t.context),t),t}cacheData(t){const{identity:e,followedIdentity:i}=t,n=t.originalIdentity??e,s=this.toEntityIdentity(e),r=this.toEntityIdentity(n),o=i&&this.toEntityIdentity(i);if(this.data.set(s,t),r.fullId!==s.fullId){let i=null;e.ownerId===this.authService.userId&&(i=e),this.data.set(r,{...t,identity:n,originalIdentity:null,followedIdentity:i})}o&&this.data.set(o,{...t,identity:i,originalIdentity:n,followedIdentity:null})}fetch(t,e,i){let s=this.fetchings.get(t);return s||(s=(0,n._)(this,rt)[rt](t,e,i).finally((()=>{(0,o.h5)((()=>{this.fetchings.delete(t)}))})),this.fetchings.set(t,s)),s}construct(t,e,i){const{audioApi:n,authService:s,trackProvider:r,followingService:o,audioOwnerProvider:a}=this,d=this.toEntityIdentity(t.identity),l=()=>this.durations.get(d),u=async()=>{await this.ensureExtendedData(d,e,i)};switch(t.type){case g.b.MusicAlbumPlaylist:return this.cacheEntity(new E({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:n,trackProvider:r,audioOwnerProvider:a,followingService:o,getDuration:l,ensureExtendedData:u}));case g.b.MusicGeneratedPlaylist:return this.cacheEntity(new M({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:n,trackProvider:r,audioOwnerProvider:a,getDuration:l,ensureExtendedData:u}));case g.b.MusicUGCGroupPlaylist:return this.cacheEntity(new D({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:n,trackProvider:r,audioOwnerProvider:a,followingService:o,getDuration:l,ensureExtendedData:u}));case g.b.MusicUGCUserPlaylist:return this.cacheEntity(new A({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:n,trackProvider:r,audioOwnerProvider:a,followingService:o,getDuration:l,ensureExtendedData:u}));case g.b.MusicChatPlaylist:return this.cacheEntity(new k({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),context:e,audioApi:n,trackProvider:r,audioOwnerProvider:a,followingService:o,getDuration:l,ensureExtendedData:u}));case g.b.MyMusicPlaylist:return this.cacheEntity(new G({identity:d,getData:this.makeCachedDataGetter(d,t),getItemsService:this.makeItemsServiceGetter(d,e),getEditingService:this.makeEditingServiceGetter(d),context:e,audioApi:n,trackProvider:r,audioOwnerProvider:a,authService:s,getDuration:l,ensureExtendedData:u}));default:return(0,h.S)(t)}}provideFromAPI(t,e){const i=this.makeIdentityFromAPI(t);return this.get(i,e)??this.createFromAPI(t,e)}createFromAPI(t,e){const i=function(t){const{no_discover:e,original:i,followed:n}=t;return{isDiscoverable:!e,originalIdentity:i?(0,W.p)(i):void 0,followedIdentity:n?(0,W.p)(n):void 0}}(t),n=!!t.permissions?.edit;switch(t.type){case"album":return this.create(function(t){const{year:e}=t;return{...T(g.b.MusicAlbumPlaylist,t),releaseYear:e,type:g.b.MusicAlbumPlaylist,subtype:L(t),genres:R(t),authors:V(t)}}(t),i,e);case"generated":return this.create((s=t,{...T(g.b.MusicGeneratedPlaylist,s),type:g.b.MusicGeneratedPlaylist}),i,e);case"chat":return this.create(function(t){return{...T(g.b.MusicChatPlaylist,t),type:g.b.MusicChatPlaylist}}(t),i,e);case"ugc":if(n)return this.create(function(t){return T(g.b.MyMusicPlaylist,t)}(t),i,e);if(d.z.isGroupId(t.owner_id)||t.original?.owner_id&&d.z.isGroupId(t.original?.owner_id))return this.create(function(t){const{is_curator:e}=t;return{...T(g.b.MusicUGCGroupPlaylist,t),type:g.b.MusicUGCGroupPlaylist,isCurator:e??!1}}(t),i,e);if(d.z.isUserId(t.owner_id)||t.original?.owner_id&&d.z.isUserId(t.original?.owner_id))return this.create(function(t){return{...T(g.b.MusicUGCUserPlaylist,t),type:g.b.MusicUGCUserPlaylist}}(t),i,e)}var s;throw new Error("Unknown playlist type")}provideFromAPIExtendedResponse(t,e){const i=this.makeIdentityFromAPI(t.playlist);return this.get(i,e)??this.createFromAPIExtendedResponse(t,e)}createFromAPIExtendedResponse(t,e){const{playlist:i,profiles:s,groups:r,duration:o}=t,a=this.makeIdentityFromAPI(i);let d;return"number"==typeof o&&this.durations.set(a,o),this.audioOwnerProvider.provideFromAPI({users:s,groups:r}),d=this.createFromAPI(t.playlist,e),ut(d)||(0,n._)(this,it)[it].add(a),d}async copyToMyMusic(t,e){this.authService.ensureUserId();const i=await this.audioApi.savePlaylistAsCopy({owner_id:t.ownerId,playlist_id:t.id}),n=this.createFromAPI(i,e);if(!(0,J._)(n,g.b.MyMusicPlaylist))throw new Error("Error creating copy of playlist in my music");return this.emitter.emit("copiedToMyMusic",{source:t,target:n.identity}),n}async delete(t){try{this.markDeletionPending(t),await this.audioApi.deletePlaylist({owner_id:t.ownerId,playlist_id:t.id}),this.markDeleted(t),this.emitter.emit("deleted",{target:t})}finally{(0,o.h5)((()=>{this.unmarkDeletionPending(t)}))}}toEntityIdentity(t){return new l._(t)}markPending(t){this.pendingPlaylists.add(t)}unmarkPending(t){this.pendingPlaylists.delete(t)}markDeletionPending(t){this.pendingDeletedPlaylists.add(t)}unmarkDeletionPending(t){this.pendingDeletedPlaylists.delete(t)}markDeleted(t){this.deletedPlaylists.add(t)}makeCachedDataGetter(t,e){let i=e;return()=>{let e=this.data.get(t);return e&&(i=e),e??i}}makeItemsServiceGetter(t,e){return()=>this.playlistsItemsService.provide(t,e)}makeEditingServiceGetter(t){return()=>this.editingServices.provide(t)}makeIdentityFromAPI(t){return this.toEntityIdentity((0,W.z)(t))}constructor(t,e,i,s,r,a){Object.defineProperty(this,nt,{value:at}),Object.defineProperty(this,st,{value:dt}),Object.defineProperty(this,rt,{value:lt}),Object.defineProperty(this,it,{writable:!0,value:void 0}),this.audioApi=t,this.authService=e,this.trackProvider=i,this.audioOwnerProvider=s,this.playlistsItemsService=a.playlistItemsServices,this.editingServices=a.playlistEditingServices,this.followingService=a.playlistsFollowing;const d=et(r);this.emitter=d.emitter,this.entities=d.entities,this.data=d.data,this.durations=d.durations,this.fetchings=d.fetchings,this.pendingPlaylists=d.pendingPlaylists,this.pendingDeletedPlaylists=d.pendingDeletedPlaylists,this.deletedPlaylists=d.deletedPlaylists,(0,n._)(this,it)[it]=d.corruptedCoverMainColors,(0,o.Gn)(this)}}function at(t,e,i){const{followedIdentity:s}=i,r=i.originalIdentity??t,o=this.toEntityIdentity(r),a=s&&this.toEntityIdentity(s),d=this.authService.userId;(0,u.C)(o,t)||t.ownerId!==d||this.followingService.setCache(o,t),a&&!(0,u.C)(a,o)&&this.followingService.setCache(o,a),(0,n._)(this,st)[st](t,e,i)}function dt(t,e,i){let n,s=null;U.mK.includes(e)&&(void 0!==i.isDiscoverable&&(s={},s.isDiscoverable=i.isDiscoverable),s&&(n=this.editingServices.provide(t),n.setState(s)))}async function lt(t,e,i){try{this.markPending(t);let n={playlist_id:t.id,owner_id:t.ownerId,access_key:t.accessKey,extra_fields:"owner,duration"};i?.enrichFetchParams&&(n=i?.enrichFetchParams(n));const s=await this.audioApi.getPlaylistByIdExtended(n,{signal:i?.abortSignal});return this.createFromAPIExtendedResponse(s,e)}catch(t){throw v.v.fromUnknownError(t)}finally{this.unmarkPending(t)}}function ut(t){return!!t.cover?.mainColor}(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof TMusicPlaylistData?Object:TMusicPlaylistData,"undefined"==typeof IMusicPlaylistStateData?Object:IMusicPlaylistStateData,"undefined"==typeof IMusicPlaylistContext?Object:IMusicPlaylistContext]),(0,r.Sn)("design:returntype","undefined"==typeof TMusicPlaylist?Object:TMusicPlaylist)],ot.prototype,"create",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof P?Object:P]),(0,r.Sn)("design:returntype","undefined"==typeof P?Object:P)],ot.prototype,"cacheEntity",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof TMusicPlaylistData?Object:TMusicPlaylistData]),(0,r.Sn)("design:returntype",void 0)],ot.prototype,"cacheData",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity,"undefined"==typeof IMusicPlaylistContext?Object:IMusicPlaylistContext,"undefined"==typeof IMusicPlaylistDataFetchOptions?Object:IMusicPlaylistDataFetchOptions]),(0,r.Sn)("design:returntype","undefined"==typeof Promise?Object:Promise)],ot.prototype,"fetch",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof TMusicPlaylistData?Object:TMusicPlaylistData,"undefined"==typeof IMusicPlaylistContext?Object:IMusicPlaylistContext,"undefined"==typeof IMusicPlaylistDataFetchOptions?Object:IMusicPlaylistDataFetchOptions]),(0,r.Sn)("design:returntype","undefined"==typeof TMusicPlaylist?Object:TMusicPlaylist)],ot.prototype,"construct",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],ot.prototype,"markPending",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],ot.prototype,"unmarkPending",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],ot.prototype,"markDeletionPending",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],ot.prototype,"unmarkDeletionPending",null),(0,r.Cg)([o.XI,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",["undefined"==typeof IMusicPlaylistIdentity?Object:IMusicPlaylistIdentity]),(0,r.Sn)("design:returntype",void 0)],ot.prototype,"markDeleted",null),ot=(0,r.Cg)([a.z8.global(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[void 0===c.B?Object:c.B,void 0===p.u?Object:p.u,void 0===j.E?Object:j.E,void 0===f.V?Object:f.V,void 0===y.d?Object:y.d,void 0===$.v?Object:$.v])],ot)}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/45215.43245534.js")}catch(t){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/45215.43245534.js",t),t}