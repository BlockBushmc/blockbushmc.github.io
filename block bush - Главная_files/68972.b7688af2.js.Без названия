try{(self.webpackChunkvk=self.webpackChunkvk||[]).push([[68972],{838421:(e,t,s)=>{s.d(t,{A8:()=>i,B0:()=>o,Bz:()=>r,Wr:()=>a,cz:()=>n});const i={VKID:"id",API:"api"},a=1,n=["vk.com","vk.ru","web.vk.me","m.vk.ru","m.vk.com"],r="cs7777",o="m.cs7777"},435595:(e,t,s)=>{s.d(t,{e:()=>n});var i=s(260718),a=s(838421);function n(){return`https://${(0,i.F)(a.A8.API)}/method`}},654648:(e,t,s)=>{s.d(t,{L:()=>a});var i=s(260718);function a(e){return`https://${(0,i.F)()}/app${e}`}},993647:(e,t,s)=>{s.d(t,{O:()=>n});var i=s(260718),a=s(838421);function n(){return`https://${(0,i.F)(a.A8.VKID)}/mini_app_token`}},260718:(e,t,s)=>{s.d(t,{F:()=>n});var i=s(838421),a=s(161933);function n(e=""){if(window.vk?.apiConfigDomains){const t={[i.A8.API]:window.vk.apiConfigDomains.apiDomain,[i.A8.VKID]:window.vk.apiConfigDomains.connectDomain};return e?t[e]:window.vk.apiConfigDomains.domain}const t=i.cz.includes(location.host),s=(0,a.yz)(),n=location.host.includes(i.B0)?i.B0:i.Bz,r=i.Bz;return e?t?`${e}.${s}`:location.host.replace(n,`${e}.${r}`):t?s:location.host}},179122:(e,t,s)=>{s.d(t,{c:()=>a});var i=s(799835);const a={getLang:i.Xo,langReplace:i.Bn,langSex:(e,t,s)=>(0,i.Zl)(e,s),langNumeric:(e,t,s,a)=>(0,i.Q1)(e,s,a),langShortDateTime:e=>(0,i.rF)(e,(0,i.Xo)("global_short_date_time","raw"),0,(0,i.Xo)("months_of"),!0),langShortDate:(e,t=!0)=>(0,i.rF)(e,(0,i.Xo)("global_short_date","raw"),0,(0,i.Xo)("months_sm_of"),t)}},923284:(e,t,s)=>{s.r(t),s.d(t,{MY_TRACKER_COUNT_EVENT_IDS:()=>n.y,TIMESPENT_SCREEN_COUNTER_IDS:()=>r.fe,TIMESPENT_SERVICE_COUNTER_IDS:()=>r.iR,TimespentCollector:()=>r.v_,counterId:()=>i.uz,getCustomCounterIdTmrUtils:()=>i.fx,getScreenTimespentCollector:()=>r.Fu,getServiceTimespentCollector:()=>r.us,handleModuleChanged:()=>a.j,tmrFinishTimespent:()=>i._J,tmrPushRawEvent:()=>i.yZ,tmrSendTimespentEvent:()=>i.Tw,tmrStartTimespent:()=>i.ns,tmrTrackCustomGoal:()=>i.RF,tmrTrackMiniAppClose:()=>i.Ns,tmrTrackMiniAppCustom:()=>i.UV,tmrTrackMiniAppEvent:()=>i.jJ,tmrTrackMiniAppOpen:()=>i.Hw,tmrTrackPage:()=>i.sh,tmrUpdateUserId:()=>i.ri});var i=s(513151),a=s(530696),n=s(805780),r=s(413210)},115336:(e,t,s)=>{s.d(t,{H:()=>n});var i=s(581922),a=s(429182);const n={showItem(e){(0,i.IP)({id:e,isHidden:!1});const t=(0,a.gr)(e);t&&(t.style.display="")},setBadge(e,t){(0,i.Wb)({id:e,badge:t});const s=(0,a.gr)(e);s&&(s.classList.toggle("LeftMenu__item--withRedDot","prominent"===t),s.classList.toggle("LeftMenu__item--withBlueDot","accent"===t))},removeBadge(e){this.setBadge(e,void 0)}}},581922:(e,t,s)=>{s.d(t,{IP:()=>y,Wb:()=>v,updateItemCount:()=>E,xG:()=>b});var i=s(860656),a=s(32489),n=s(679005),r=s(429182),o=s(926614),l=s(233536),d=s(349465),c=s(595253);function h(e){return t=>t.id===e||t.id===(0,r.IB)(e)}function u(e,t,s){return(0,n.jM)(e,(e=>{e.some((({items:e})=>e.some((e=>{if(t(e))return s(e),!0}))))}))}const _=e=>"footer"===e.id||"legal"===e.id,g=e=>"internal.getWebLeftMenu"===e.method&&void 0!==e.response?.sections;const p=(0,i.b)("left-menu-store",(()=>function(){const e=(0,a.createStore)([]),t=(0,a.createStore)([]),s=(0,a.combine)({sections:e,footerSections:t}),i=(0,a.createEvent)("setLeftMenu"),n=(0,a.createEvent)("setLeftMenuFooter"),d=(0,a.createEvent)("updateItemCount"),c=(0,a.createEvent)("setBadge"),p=(0,a.createEvent)("setHidden"),m=(0,a.createEvent)("closeTooltip");e.on(i,((e,t)=>g(t)?(0,l.rE)(t.response.sections).filter((e=>!_(e))):[])).on(d,((e,{id:t,count:s,href:i})=>u(e,h(t),(e=>{e.count=Math.max(s,0),e.is_hidden=s<0,i&&(e.href=i),t===o.R&&(e.is_hidden=!1)})))).on(c,((e,{id:t,badge:s})=>u(e,h(t),(e=>{e.badge=s})))).on(p,((e,{id:t,isHidden:s})=>u(e,h(t),(e=>{e.is_hidden=s})))).on(m,((e,{hint_id:t})=>{return u(e,(s=t,e=>e.tooltip?.hint_id===s),(e=>{delete e.tooltip}));var s})),t.on(n,((e,t)=>t));const C=(0,a.createEffect)((({hint_id:e,hint_hash:t})=>{(0,r.at)(e,t)}));return(0,a.sample)({source:m,target:C}),(0,a.sample)({clock:i,source:e,filter:(e,t)=>g(t),fn:(e,t)=>(0,l.rE)(t.response.sections).filter(_),target:n}),{$leftMenu:s,setLeftMenu:i,updateItemCount:d,setBadge:c,setItemHidden:p,closeTooltip:m}}()),{version:0}),m=p(),C=(0,c.X)().resolve(d.s),b=e=>{m.setLeftMenu(e),C.setSections(e.response)},E=e=>{m.updateItemCount(e),C.updateItem(e.id,{count:e.count,href:e.href})},v=e=>{m.setBadge(e),C.updateItem(e.id,{badge:e.badge})},y=e=>{m.setItemHidden(e),C.updateItem(e.id,{is_hidden:e.isHidden})}},740451:(e,t,s)=>{function i(e,{msgId:t,tab:s,entrypoint:i}={}){const a=new URLSearchParams;return t&&a.append("cmid",String(t)),i&&a.append("entrypoint",i),a.append("tab",s??"all"),`/im/convo/${e}?${a.toString()}`}s.d(t,{P:()=>i})},68972:(e,t,s)=>{s.d(t,{Q:()=>P});var i=s(331635),a=s(42107),n=s(605372),r=s(558162),o=s(965920),l=s(327813),d=s(566968),c=s(692786),h=s(435595),u=s(654648),_=s(993647),g=s(257263),p=s(722007),m=s(179122);window.vk&&window.vk.id;const C={end:"https://st.mycdn.me/static/misc/0-0-8/call_end.mp3",incoming:"https://st.mycdn.me/static/misc/0-0-8/call_incoming.mp3",outgoing:"https://st.mycdn.me/static/misc/0-0-8/call_outgoing.mp3",connected:"https://st.mycdn.me/static/misc/0-0-8/call_connected.mp3",connecting:"https://st.mycdn.me/static/misc/0-0-8/call_connecting.mp3"};var b=s(115336),E=s(815553),v=s(923284),y=s(432317),S=s(188166),w=s(17697),M=s(2096),f=s(916533),k=s(645189),I=s(208403),A=s(97929),L=s(273193),T=s(651253),B=s(917128),R=s(740451),N=s(115526),O=s(754694);class P{async getCallsSettings(){if(this.callsSettings)return this.callsSettings;const e=await this.callsApi.getSettings({}),t=Object.fromEntries(e.toggles.map((e=>[e.name,e.enabled??!1])));return this.callsSettings={settings:e.settings,toggles:t,anonymPhotoBaseUrls:e.anonym_photo_base_urls},this.callsSettings}get bridge(){return this._bridge}get isInActiveCall(){return this.bridge?.isInActiveCall}get eventBus(){return this.bridge?.eventBus}get store(){return this.bridge?.store}setBridge(e){this._bridge=e}setState(e){this.state=e}async loadBridge(){return this.bridgeLoader?this.bridgeLoader:this.bridge?this.bridge:this.createBridge()}async createBridge(){return this.bridgeLoader=new Promise((async(e,t)=>{this.setState("loading");try{const[{init:t},{ENavigateToConvoDirection:i},{isFastChatMounted:a},{toggles:r,settings:o}]=await Promise.all([Promise.all([s.e(67878),s.e(46559),s.e(51220),s.e(5252),s.e(32772),s.e(82960),s.e(70609),s.e(16131),s.e(31156),s.e(48355),s.e(96647),s.e(51246),s.e(36148),s.e(92555),s.e(82005),s.e(60905),s.e("langs/core_spa/webCallsBridge")]).then(s.bind(s,675853)),Promise.all([s.e(67878),s.e(46559),s.e(51220),s.e(5252),s.e(32772),s.e(82960),s.e(70609),s.e(16131),s.e(31156),s.e(48355),s.e(96647),s.e(51246),s.e(36148),s.e(92555),s.e(82005),s.e(60905),s.e("langs/core_spa/webCallsBridge")]).then(s.bind(s,494483)),Promise.all([s.e(67878),s.e(46559),s.e(51220),s.e(5252),s.e(32772),s.e(82960),s.e(70609),s.e(16131),s.e(31156),s.e(48355),s.e(96647),s.e(51246),s.e(36148),s.e(92555),s.e(82005),s.e(60905),s.e("langs/core_spa/webCallsBridge")]).then(s.bind(s,188812)),this.getCallsSettings(),new Promise((e=>{window.stManager.add(["calls.css"],e)}))]),f=new S.C(new w.H),k=()=>{this.authService.userId&&(0,M.Xv)(this.langs.getLang("calls_feedback_success"))},I=e=>{this.snackbar.show({text:e.title,subtitle:e.text,...e.image&&{before:{avatar:e.image}}})},A=e=>a()?(window.reforgedME?.selectPeer?.(e,"calls",O.l,{forceFastchat:!0}),i.FastChat):(window.nav.go((0,R.P)(e),null,{params:{entrypoint:"calls"}}),i.Messenger),L=(e,t)=>{!e.target.href&&this.bridge&&(this.bridge?.collapseCall(),t&&window.nav.go(t))},T=t({apiWrapper:()=>p.FH,apiWrapperWithAuth:()=>p.FH,actionStatCollector:f,saveStatlogEvents:g.bl,langUtils:m.c,navigateToConvo:A,callSounds:C,navigateToProfile:L,removeLeftMenuItemBadge:()=>{b.H.removeBadge(E.MZ)},myTrackerUtils:v,notifierGetter:()=>window?.Notifier,VKComKitModal:y.wI,miniAppsBridge:{getApiUrl:h.e,getAppShortUrl:u.L,getAuthUrl:_.O,getIsFeatureEnabled:this.featureEnabledService.featureEnabled,writeAndSendWebStats:g.a1},dependencies:{LangsImpl:d.M,APIClientImpl:c.y}});T.eventBus.on(n.O.SUCCESS_FEEDBACK,k),T.eventBus.on(n.O.MISSING_CALL,I),T.eventBus.on(n.O.FATAL_ERROR,(({error:e})=>{this.errorLogger.log(e)})),T.eventBus.on(n.O.OPEN_HISTORY_MODAL,(({section:e})=>{window.nav.go(`?section=${e}`)}));const N=()=>{this.setBridge(T),this.setState("done"),e(T),(0,l.h5)((()=>{this.bridgeLoader=void 0}))};if(!this.authService.isAuthorized)return N();const[{getMember:P},{fetchCallTokenWithApiBaseUrl:D}]=await Promise.all([Promise.all([s.e(67878),s.e(46559),s.e(51220),s.e(5252),s.e(32772),s.e(82960),s.e(70609),s.e(16131),s.e(31156),s.e(48355),s.e(96647),s.e(51246),s.e(36148),s.e(92555),s.e(82005),s.e(60905),s.e("langs/core_spa/webCallsBridge")]).then(s.bind(s,397566)),Promise.all([s.e(67878),s.e(46559),s.e(51220),s.e(5252),s.e(32772),s.e(82960),s.e(70609),s.e(16131),s.e(31156),s.e(48355),s.e(96647),s.e(51246),s.e(36148),s.e(92555),s.e(82005),s.e(60905),s.e("langs/core_spa/webCallsBridge")]).then(s.bind(s,580129))]),G=this.authService.ensureUserId(),[{token:U,apiBaseUrl:F},H]=await Promise.all([D(G,o.is_dev),P(G)]);return await T.init({...window.Calls?.predefinedInitArgs,callsCredentials:{key:o.public_key,is_dev:o.is_dev,privacySettings:{callsIp:o.calls_ip},ip_setting_enabled:o.ip_setting_enabled,me:H},apiBaseUrl:F,sdkToken:U,toggles:{...r,enableSimplePiPVk:window.browser.safari?r.enableSimplePiPSafariVk:r.enableSimplePiPVk,videoSlotsCount:o.video_slots_count,browserWarnings:o.browser_warnings,disabledBanners:o.disabled_banners,customScreenSharePacketSize:o.custom_screen_share_packet_size,customScreenShareCongestionControlThreshold:o.custom_screen_share_congestion_control_threshold,customExternalDomain:o.custom_external_domain,noiseReductionMode:o.noise_reduction_mode,enableVmoji:!0,deviceId:o.device_id,temporaryVirtualBackgrounds:o.temporary_virtual_backgrounds},onError:({msg:e})=>(e&&this.errorLogger.log(e),e&&(0,B.NL)(this.langs.getLang("global_error"),e)),onBeforeCallStart:()=>{window.Notifier.pauseGlobalMedia()},onAfterCallFinish:()=>{window.Notifier.resumeGlobalMedia()},tabIsMaster:()=>window.Notifier.tabIsMaster(),isFriend:()=>!1,removeLeftMenuItemBadge:()=>{b.H.removeBadge(E.MZ)}}),N()}catch(e){this.setState("error"),console.log(e),t(),this.bridgeLoader=void 0}})),this.bridgeLoader}async start(){try{await this.queueService.start()}catch{}}constructor(e,t,i,a,n,o,d,c){this.authService=e,this.userEnv=t,this.callsApi=i,this.queueService=a,this.snackbar=n,this.langs=o,this.errorLogger=d,this.featureEnabledService=c,this.state="initial",this._bridge=void 0,this.bridgeLoader=void 0,this.call=async(...e)=>(await this.loadBridge()).call(...e),this.startGroupCall=async(...e)=>(await this.loadBridge()).startGroupCall(...e),this.startCall=async(...e)=>(await this.loadBridge()).startCall(...e),this.acceptCall=async(...e)=>(await this.loadBridge()).acceptCall(...e),this.joinCallByLink=async(...e)=>(await this.loadBridge()).joinCallByLink(...e),this.joinRoomByLink=async(...e)=>(await this.loadBridge()).joinRoomByLink(...e),this.showJoinPopup=async(...e)=>(await this.loadBridge()).showJoinPopup(...e),this.showCallByNamePopup=async(...e)=>(await this.loadBridge()).showCallByNamePopup(...e),this.showCreateCallByLinkPopup=async(...e)=>(await this.loadBridge()).showCreateCallByLinkPopup(...e),this.showPlanCalendarEventPopup=async(...e)=>(await this.loadBridge()).showPlanCalendarEventPopup(...e),this.showStartCallModal=async(...e)=>(await this.loadBridge()).showStartCallModal(...e),this.joinOrStartCallModal=async(...e)=>(await this.loadBridge()).joinOrStartCallModal(...e),this.showJoinCallByLinkPopup=async(...e)=>(await this.loadBridge()).showJoinCallByLinkPopup(...e),this.subscribeOnQueue=(...e)=>this.bridge?this.bridge.subscribeOnQueue(...e):()=>{},this.collapseCall=()=>{this.bridge?.collapseCall?.()},this.restoreCall=()=>{this.bridge?.restoreCall?.()},this.fullscreenCall=()=>{this.bridge?.fullscreenCall?.()},this.updateChatCounter=(...e)=>{this.bridge?.updateChatCounter?.(...e)},this.log=(...e)=>{if(this.bridge)return this.bridge.log(...e);this.loadBridge().then((()=>{this.bridge?.log?.(...e)}))},this.checkOnlyAuthByGroupId=async(...e)=>(await this.loadBridge()).checkOnlyAuthByGroupId(...e),this.setEditCalendarEvent=async(...e)=>{const t=await this.loadBridge();return t.setEditCalendarEvent?.(...e)},this.showJoinScreen=async(e,t,s,i,a,n,r)=>(await this.loadBridge()).showJoinScreen(e,t,s,i,a,n,r),this.callsSettings=void 0,(0,l.l_)(this,{_bridge:!1,sdkSettings:!1}),s._dG("__CallsAppService",this),s._dG("Calls",this),this.queueService.subscribe((async e=>{if(this.bridge||this.bridgeLoader||e.data.type!==r.rg.IncomingCall)this.bridge?.handleQueueEvent(e);else{(await this.loadBridge()).handleQueueEvent(e)}}))}}P=(0,i.Cg)([a.z8.global(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[void 0===f.u?Object:f.u,void 0===k.J?Object:k.J,void 0===I.Q?Object:I.Q,void 0===o.I?Object:o.I,void 0===A.q?Object:A.q,void 0===L.Y?Object:L.Y,void 0===T.v?Object:T.v,void 0===N.V?Object:N.V])],P)},965920:(e,t,s)=>{s.d(t,{I:()=>p});var i=s(331635),a=s(795200),n=s(42107),r=s(36569),o=s(993006),l=s(645189),d=s(916533),c=s(849645),h=s(558162),u=s(662494),_=s(849862);class g{get cacheInMs(){return 60*this.CACHE_LIFE_IN_MINUTES*1e3}isActualTs(e){return null!==e&&e+this.cacheInMs>Date.now()}getActualCredentialsFromLS(){try{const e=_.L.getItem(this.key);if(!e)return[];const t=JSON.parse(e);if("data"in t&&"lastUpdate"in t&&this.isActualTs(t.lastUpdate))return[t.data,t.lastUpdate]}catch(e){}return[]}put(e){this.data=e,this.lastUpdate=Date.now(),_.L.setItem(this.key,JSON.stringify({data:e,lastUpdate:this.lastUpdate}))}update(e){this.data&&(this.data={...this.data,ts:e},this.lastUpdate=Date.now(),_.L.setItem(this.key,JSON.stringify({data:this.data,lastUpdate:this.lastUpdate})))}get(){if(null===this.data){const[e,t]=this.getActualCredentialsFromLS();if(e&&t)return this.data=e,this.lastUpdate=t,this.data}return this.data&&!this.isActualTs(this.lastUpdate)&&this.drop(),this.data}drop(){this.data=null,this.lastUpdate=null,_.L.removeItem(this.key)}constructor(e,t=u.u.WEB){this.data=null,this.lastUpdate=null,this.CACHE_LIFE_IN_MINUTES=5,this.key=`queue_credential_calls_cache_${e}_${t}`;const[s,i]=this.getActualCredentialsFromLS();s&&i&&(this.data=s,this.lastUpdate=i)}}class p{get queueId(){return["calls",this.authService.ensureUserId(),this.metadata.get().platformId,"1"].join("_")}async start(){const e=this.authService.ensureUserId(),t=this.metadata.get().platformId;if(this.credentialCache=new g(e,t),null===this.credentialCache.get()){const e=await this.messagesApi.getInboundCalls({}),[t]=e?.items??[];t&&this.publish({entity_id:0,entity_type:h.s9.Calls,data:{type:h.rg.IncomingCall,value:t}})}this.startQueue()}startQueue(){const e=this.metadata.get().platformId===u.u.MVK||this.userEnv.partConfigEnabled("frontend.calls_enable_queue_manager_regular_transport"),t=new a.P({debug:this.userEnv.partConfigEnabled("frontend.web_calls_enable_queue_manager_logger"),noSharedWorker:e,withCredentials:!0});t.addQueue(this.queueId,this.credentialsGetter),t.subscribe((async(e,t)=>{(0,h.ru)(t)?1===t.failed?this.credentialCache?.update(Number(t)):this.credentialCache?.drop():t.events.forEach((e=>{this.publish(e)}))}),(()=>{t.destroy(),this.startQueue()}))}publish(e){this.subscribes.forEach((t=>{t(e)}))}subscribe(e){const t=this.subscribes.push(e)-1;return()=>{this.subscribes.splice(t,1)}}constructor(e,t,s,i,a){this.queueApi=e,this.messagesApi=t,this.userEnv=s,this.authService=i,this.metadata=a,this.subscribes=[],this.credentialsGetter=async()=>{const e=this.credentialCache?.get()??null;if(e)return e;const t=await this.queueApi.subscribe({queue_ids:this.queueId},{grouping:!1}),[s]=t.queues,i={key:s.key,ts:s.timestamp,url:t.base_url,id:this.authService.ensureUserId()};return this.credentialCache?.put(i),i}}}p=(0,i.Cg)([n.z8.global(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[void 0===r.C?Object:r.C,void 0===o.h?Object:o.h,void 0===l.J?Object:l.J,void 0===d.u?Object:d.u,void 0===c.e?Object:c.e])],p)},605372:(e,t,s)=>{s.d(t,{O:()=>i,x:()=>a});var i=function(e){return e.DEVICE_CHANGED="device_changed",e.LOCAL_MICROPHONE_VOLUME_CHANGED="local_microphone_volume_changed",e.NAME_CHANGED="name_changed",e.REMOTE_REMOVED="remote_removed",e.REMOTE_STATUS_CHANGED="remote_status_changed",e.SCREEN_SHARING_ENABLED="screen_sharing_enabled",e.SCREEN_SHARING_DISABLED="screen_sharing_disabled",e.ERROR_START_CALL="error_start_call",e.HAND_COUNT_CHANGED="hand_count_changed",e.SUCCESS_FEEDBACK="success_feedback",e.MISSING_CALL="missing_call",e.ERROR="error",e.FATAL_ERROR="fatal_error",e.HANGUP="hangup",e.OUTGOING_CALL_ACCEPTED="outgoing_call_accepted",e.OUTGOING_CALL_DECLINED="outgoing_call_declined",e.INCOMING_CALL_ACCEPTED="incoming_call_accepted",e.INCOMING_CALL_DECLINED="incoming_call_declined",e.SCREEN_SHARING_STARTED="screen_sharing_started",e.SCREEN_SHARING_STOPPED="screen_sharing_stopped",e.CALL_FINISHED_LOCALLY="call_finished_locally",e.CALL_FINISHED_REMOTELY="call_finished_remotely",e.CALL_FINISHED="call_finished",e.CALL_STARTED="call_started",e.LAYOUT_COLLAPSED="layout_collapsed",e.LAYOUT_FULLSCREEN="layout_fullscreen",e.LAYOUT_NORMAL="layout_normal",e.INCOMING_CALL_CANCELED="incoming_call_canceled",e.OUTGOING_CALL_CANCELED="outgoing_call_canceled",e.HISTORY_MODAL_CLOSED="history_modal_closed",e.OPEN_HISTORY_MODAL="open_history_modal",e.INCOMING_CALL_STARTED="incoming_call_started",e.INCOMING_CALL_ACCEPTED_ON_ANOTHER_DEVICE="incoming_call_accepted_on_another_device",e.CALL_ENTERING_ON_ANOTHER_DEVICE="call_entering_on_another_device",e.PARTICIPANT_WAS_KICKED_FROM_CALL="participant_was_kicked_from_call",e.PARTICIPANT_WAS_BLOCKED_IN_CALL="participant_was_blocked_in_call",e}({});const a={onOutgoingCallAccepted:"outgoing_call_accepted",onOutgoingCallDeclined:"outgoing_call_declined",onIncomingCallAccepted:"incoming_call_accepted",onIncomingCallDeclined:"incoming_call_declined",onScreenSharingStarted:"screen_sharing_started",onScreenSharingStopped:"screen_sharing_stopped",onCallFinishedLocally:"call_finished_locally",onCallFinishedRemotely:"call_finished_remotely",onCallFinished:"call_finished",onCallStarted:"call_started",onLayoutCollapsed:"layout_collapsed",onLayoutFullscreen:"layout_fullscreen",onLayoutNormal:"layout_normal",onIncomingCallCanceled:"incoming_call_canceled",onOutgoingCallCanceled:"outgoing_call_canceled",onHistoryModalClosed:"history_modal_closed",onIncomingCallStarted:"incoming_call_started",onIncomingCallAcceptedOnAnotherDevice:"incoming_call_accepted_on_another_device",onCallEnteringOnAnotherDevice:"call_entering_on_another_device",onParticipantWasKickedFromCall:"participant_was_kicked_from_call",onParticipantWasBlockedInCall:"participant_was_blocked_in_call"}},558162:(e,t,s)=>{s.d(t,{Mw:()=>n,rg:()=>a,ru:()=>r,s9:()=>i});var i=function(e){return e.Calls="calls",e}({}),a=function(e){return e.ScheduledCallsUpdate="scheduled_calls_update",e.CurrentCallsUpdate="current_calls_update",e.CallHistoryUpdated="call_history_updated",e.CallGroupHistoryUpdated="call_group_history_updated",e.ChatInfoUpdated="chat_info_updated",e.CallAccepted="call_accepted",e.CallSettingsChanged="call_settings_changed",e.IncomingCall="incoming_call",e.CallFinished="call_finished",e.ParticipantNameChanged="participant_name_changed",e}({});const n=e=>Boolean(e&&"events"in e&&Array.isArray(e.events)&&"ts"in e),r=e=>Number.isFinite(e?.failed)&&Number.isFinite(e?.err)},662494:(e,t,s)=>{s.d(t,{o:()=>i,u:()=>a});var i=function(e){return e.VK_WEB2="vk_web2",e.VK_MVK="vk_mvk",e.VK_WEB_MESSENGER="vk_web_messenger",e.VK_WEB_MESSENGER_SFERUM="vk_web_messenger_sferum",e.VK_DESKTOP_MESSENGER="vk_desktop_messenger",e.VK_DESKTOP_MESSENGER_SFERUM="vk_desktop_messenger_sferum",e}({}),a=function(e){return e[e.WEB=6287487]="WEB",e[e.MVK=7879029]="MVK",e[e.WEB_MESSENGER=8202606]="WEB_MESSENGER",e[e.WEB_MESSENGER_SFERUM=7556576]="WEB_MESSENGER_SFERUM",e[e.DESKTOP_MESSENGER=51453752]="DESKTOP_MESSENGER",e[e.WEB_STANDALONE=51542479]="WEB_STANDALONE",e[e.WEB_TUTORIA=51849377]="WEB_TUTORIA",e}({})},115526:(e,t,s)=>{s.d(t,{V:()=>l});var i=s(331635),a=s(327813),n=s(42107),r=s(645189),o=s(62495);class l{get mappedConfigValues(){const e=this.getMotionStickyExperimentGroup(),t=this.userEnv.isToggleEnabled("sa_ads_sticky_motion")||this.userEnv.isToggleEnabled("sa_ads_mvk_sticky_motion"),s=e>0,i=0===e&&t||2===e,a=this.userEnv.getToggleAbGroupId("sa_ads_inter_multi_motion")??this.userEnv.getToggleAbGroupId("sa_ads_mvk_inter_multi_motion")??0,n=this.userEnv.isToggleEnabled("sa_ads_inter_multi_motion")||this.userEnv.isToggleEnabled("sa_ads_mvk_inter_multi_motion"),r=a>0,l=0===a&&n||2===a;return{[o.o.AnonymousLaunch]:this.userEnv.partConfigEnabled("frontend.mini_apps_anonymous_launch"),[o.o.PerfomanceStatsInGames]:this.userEnv.partConfigEnabled("frontend.perfomance_stats_in_games"),[o.o.MiniAppsSDKMyTracker]:this.userEnv.partConfigEnabled("frontend.mini_apps_sdk_my_tracker_integration"),[o.o.InterstitialMultiNewWaterfall]:this.userEnv.partConfigEnabled("mini_apps_ads_interstitial_multi_new_waterfall"),[o.o.WriteDebugStats]:this.userEnv.partConfigEnabled("mini_apps_ads_write_debug_stats"),[o.o.MiniAppsVkBridgeFloodControl]:this.userEnv.partConfigEnabled("frontend.mini_apps_vk_bridge_flood_control"),[o.o.CheckAllowedScopesNoValidation]:this.userEnv.partConfigEnabled("mini_apps_check_allowed_scopes_no_validation"),[o.o.StickyMotionExperiment]:s,[o.o.StickyMotion]:i,[o.o.InterstitialMultiMotionExperiment]:r,[o.o.InterstitialMultiMotion]:l,[o.o.MiniAppSpaModalInShowNativeAds]:this.userEnv.partConfigEnabled("frontend.mini_apps_spa_modal_in_vk_web_app_show_native_ads")}}constructor(e){this.userEnv=e,this.featureEnabled=e=>this.mappedConfigValues[e],this.getMotionStickyExperimentGroup=()=>this.userEnv.getToggleAbGroupId("sa_ads_sticky_motion")??this.userEnv.getToggleAbGroupId("sa_ads_mvk_sticky_motion")??0,(0,a.l_)(this)}}l=(0,i.Cg)([n.z8.container(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[void 0===r.J?Object:r.J])],l)},208403:(e,t,s)=>{s.d(t,{Q:()=>r});var i=s(331635),a=s(42107),n=s(820282);class r extends n.S{get namespace(){return"calls"}constructor(...e){super(...e),this.getSettings=this.makeMethod("getSettings"),this.getCallJoinHistory=this.makeMethod("getCallJoinHistory"),this.getCallPreview=this.makeMethod("getCallPreview"),this.getAnonymousToken=this.makeMethod("getAnonymousToken"),this.getAnonymousAccessTokenPayload=this.makeMethod("getAnonymousAccessTokenPayload"),this.getCallSettings=this.makeMethod("getCallSettings"),this.getAsrTranscriptions=this.makeMethod("getAsrTranscriptions"),this.editAsrTranscription=this.makeMethod("editAsrTranscription"),this.deleteAsrTranscriptions=this.makeMethod("deleteAsrTranscriptions"),this.getHistory=this.makeMethod("getHistory"),this.getGroupHistory=this.makeMethod("getGroupHistory"),this.getParticipantsByIds=this.makeMethod("getParticipantsByIds"),this.clearGroupHistory=this.makeMethod("clearGroupHistory"),this.clearHistory=this.makeMethod("clearHistory"),this.deleteGroupHistoryRecords=this.makeMethod("deleteGroupHistoryRecords"),this.deleteHistoryRecords=this.makeMethod("deleteHistoryRecords")}}r=(0,i.Cg)([a.z8.global()],r)},993006:(e,t,s)=>{s.d(t,{h:()=>r});var i=s(331635),a=s(42107),n=s(820282);class r extends n.S{get namespace(){return"messages"}constructor(...e){super(...e),this.getCallParticipants=this.makeMethod("getCallParticipants"),this.getCallPreview=this.makeMethod("getCallPreview"),this.getCurrentCalls=this.makeMethod("getCurrentCalls"),this.getInboundCalls=this.makeMethod("getInboundCalls"),this.searchConversations=this.makeMethod("searchConversations"),this.searchConversationMembers=this.makeMethod("searchConversationMembers"),this.getConversations=this.makeMethod("getConversations"),this.getGroupsForCall=this.makeMethod("getGroupsForCall"),this.getConversationMembers=this.makeMethod("getConversationMembers"),this.editCall=this.makeMethod("editCall"),this.getScheduledCalls=this.makeMethod("getScheduledCalls"),this.getConversationsById=this.makeMethod("getConversationsById"),this.deleteScheduledCall=this.makeMethod("deleteScheduledCall"),this.vkRoomsJoinCall=this.makeMethod("vkRoomsJoinCall"),this.send=this.makeMethod("send"),this.sendReaction=this.makeMethod("sendReaction"),this.deleteReaction=this.makeMethod("deleteReaction"),this.forceCallFinish=this.makeMethod("forceCallFinish"),this.denyMessagesFromGroup=this.makeMethod("denyMessagesFromGroup"),this.allowMessagesFromGroup=this.makeMethod("allowMessagesFromGroup"),this.getHistoryAttachments=this.makeMethod("getHistoryAttachments"),this.getById=this.makeMethod("getById"),this.getReactionsAssets=this.makeMethod("getReactionsAssets"),this.getChatPreview=this.makeMethod("getChatPreview")}}r=(0,i.Cg)([a.z8.global()],r)},36569:(e,t,s)=>{s.d(t,{C:()=>r});var i=s(331635),a=s(820282),n=s(42107);class r extends a.S{get namespace(){return"queue"}constructor(...e){super(...e),this.subscribe=this.makeMethod("subscribe")}}r=(0,i.Cg)([n.z8.global()],r)},795200:(e,t,s)=>{s.d(t,{P:()=>c});var i=s(819674);class a{_postMessage(e){this._worker.port.postMessage(e)}_handleMessage(e){switch(this._isDebug&&"ping"!==e.data.type&&console.debug("Message received from worker\n",e.data),e.data.type){case"ping":e.data.payload===this._clientId&&(this._postMessage({type:"pong"}),this._checkKeepAlivePortInterval());break;case"longpoll-event":e.data.payload.clientId===this._clientId&&this._onMessage?.(e.data.payload.queueId,e.data.payload.data);break;case"request-credentials":e.data.payload.clientId===this._clientId&&this._requestCredentials(e.data.payload.queueId)}}_checkKeepAlivePortInterval(){this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),this._keepAliveTimeout=setTimeout((()=>this._onReset?.()),15e3)}_setBeforeUnloadListener(){const e=()=>this.destroy();return window.addEventListener("beforeunload",e),e}async _requestCredentials(e){const t=this._credentialsGetters.get(e);if(t&&!this._credentialsProcessing.has(e)){this._credentialsProcessing.add(e);try{const s=await t();this._postMessage({type:"set-credentials",payload:{queueId:e,params:s,withCredentials:this._withCredentials}})}catch(e){console.error("[SharedWorkerTransport][_requestCredentials]",e)}finally{this._credentialsProcessing.delete(e)}}}destroy(){this._postMessage({type:"disconnect",payload:this._clientId}),this._worker.port.close(),window.removeEventListener("beforeunload",this._onBeforeUnloadLink),this._onMessage=null,this._onReset=null}addQueue(e,t){this._credentialsGetters.set(e,t),this._postMessage({type:"add-queue",payload:{queueId:e}})}subscribe(e,t){this._onMessage=e,this._onReset=t}removeQueue(e){this._credentialsGetters.delete(e),this._postMessage({type:"remove-queue",payload:{queueId:e}})}toggleDebug(e){const t=Boolean(e);this._isDebug=t,this._postMessage({type:"debug",payload:t})}constructor(e=!1){this._onReset=null,this._onMessage=null,this._keepAliveTimeout=null,this._isDebug=!1,this._clientId=(0,i.A)(),this._worker=new SharedWorker(new URL(self.location.origin+"/dist/"+s.u(85352),s.b)),this._onBeforeUnloadLink=this._setBeforeUnloadListener(),this._credentialsGetters=new Map,this._credentialsProcessing=new Set,this._withCredentials=e,this._worker.onerror=e=>console.error(e),this._worker.port.onmessage=e=>this._handleMessage(e),this._postMessage({type:"connect",payload:this._clientId}),this._worker.port.start(),this._checkKeepAlivePortInterval()}}var n=s(754694),r=s(947008);class o{createMessage(e){return this.prefix?e.map(((e,t)=>0===t&&"string"==typeof e?`[${this.prefix}] ${e}`:e)):e}debug(...e){this.enabled&&console.debug(...this.createMessage(e))}log(...e){this.enabled&&console.log(...this.createMessage(e))}warn(...e){this.enabled&&console.warn(...this.createMessage(e))}error(...e){this.enabled&&console.error(...this.createMessage(e))}constructor(e,t=""){this.enabled=e,this.prefix=t}}class l{add(e,t,s){void 0!==s&&(this._withCredentials=s);const i=this._queues.get(e);(i?.ts||0)<t.ts&&this._queues.set(e,{...t}),this._start()}remove(e){const t=this._queues.get(e);t&&this._retryCount.delete(t?.url),this._queues.delete(e)}has(e){return this._queues.has(e)}_start(){for(const e of this._queues.values())this._processing.has(e.url)||this._processing.set(e.url,setTimeout((()=>this._processUrl(e.url)),this._getTimeoutValue(e.url)))}_getTimeoutValue(e){const t=this._getRetryCount(e);return 1===t?4:2*t*1e3}_getRetryCount(e){return this._retryCount.get(e)??1}_increaseRetryCount(e){const t=this._getRetryCount(e)+1;return this._retryCount.set(e,t),t}_resetRetryCount(e){this._retryCount.set(e,1)}async _processUrl(e){const t=[],s=[];for(const[i,a]of this._queues.entries())a.url===e&&(t.push(i),s.push(a));if(!t.length||!s.length)return void this._processing.delete(e);let i;try{const t=function(e,t){const s=e[0].url,i=e[0].id;let a=e[0].key,n=`${e[0].ts}`;for(let r=1;r<e.length;++r){if(e[r].id!==i){const s=`Invalid userId pair: ${i}, ${e[r].id}`;throw t?.error(s),new Error(s)}if(e[r].url!==s){const i=`Invalid baseUrl pair: ${s}, ${e[r].url}`;throw t?.error(i),new Error(i)}a+=`${e[r].key}`,n+=`_${e[r].ts}`}return`${s}?act=a_check&key=${a}&id=${i}&ts=${n}&wait=25`}(s,this._logger),a=await this._request(t);i=Array.isArray(a)?a:[a],this._resetRetryCount(e)}catch(s){i=[],this._increaseRetryCount(e)>=20&&t.forEach((()=>i.push(this._createFailedResponse())))}finally{this._processing.delete(e)}for(let e=0;e<i.length;++e)this._publish(t[e],i[e]),this._updateTs(t[e],i[e]);this._start()}_request(e){return fetch(e,this._withCredentials?{credentials:"include",mode:"cors"}:void 0).then((e=>e.json()))}_updateTs(e,t){if(!(0,r.Gv)(t)||!("ts"in t))return;const s=this._queues.get(e),i=Number(t.ts);!(0,r.b0)(s)&&s.ts<i&&(s.ts=i)}_createFailedResponse(){return{err:1,failed:1}}constructor(e,t,s=!1){this._queues=new Map,this._processing=new Map,this._publish=e,this._logger=t,this._withCredentials=s,this._retryCount=new Map}}class d{addQueue(e,t){this.credentialsGetters.set(e,t),this.longpollManager.has(e)||this.requestCredentials(e)}async requestCredentials(e){const t=this.credentialsGetters.get(e);if(t&&!this.credentialsProcessing.has(e)){this.credentialsProcessing.add(e);try{this.logger.debug(`request credentials for ${e}`);const s=await t();this.longpollManager.add(e,s)}catch(e){this.logger.error("[requestCredentials]",e)}finally{this.credentialsProcessing.delete(e)}}}removeQueue(e){this.credentialsGetters.delete(e),this.credentialsProcessing.delete(e),this.longpollManager.remove(e)}subscribe(e,t){this.onMessage=e,t&&(this.onReset=t)}toggleDebug(e){this.logger.enabled=Boolean(e)}destroy(){this.onMessage=n.l,this.onReset=n.l;for(let[e]of this.credentialsGetters)this.longpollManager.remove(e)}constructor(e){this.credentialsGetters=new Map,this.credentialsProcessing=new Set,this.onMessage=n.l,this.onReset=n.l,this.logger=new o(!1,"RegularTransport"),this.callbackHandler=(e,t)=>{this.logger.debug(`response for ${e}`,t);const s=(0,r.Z4)(t)&&("err"in t||"failed"in t);s&&this.longpollManager.remove(e),this.onMessage(e,t),s&&this.onReset()},this.longpollManager=new l(this.callbackHandler,this.logger,e)}}class c{addQueue(e,t){return this._transport?.addQueue(e,t),this}removeQueue(e){return this._transport?.removeQueue(e),this}subscribe(e,t){return this._transport?.subscribe(e,t),this}destroy(){this._transport?.destroy()}toggleDebug(e){this._transport?.toggleDebug(e)}constructor({debug:e,noSharedWorker:t,withCredentials:s}={}){"undefined"==typeof SharedWorker||t?this._transport=new d(s):this._transport=new a(s),this.toggleDebug(e)}}}}]),"undefined"!=typeof window&&window.stManager?.done?.("dist/core_spa/chunks/68972.b7688af2.js")}catch(e){throw"undefined"!=typeof window&&window.stManager?.fail?.("dist/core_spa/chunks/68972.b7688af2.js",e),e}